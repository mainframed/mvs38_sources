         TITLE 'IEDQBI  POLLSTOP-VARYOFF ROUTINE'                       00070000
IEDQBI   CSECT                                                          00100000
*********************************************************************** 01050000
*                                                                     * 01120000
* MODULE NAME=IEDQBI                                                  * 01190000
*                                                                     * 01260000
* COPYRIGHT='NONE'                                                    * 01330000
*                                                                     * 01400000
* STATUS = VERSION 10.0                                        @Y17XAMG 01470000
*                                                                     * 01540000
* FUNCTION --                                                         * 01610000
*   THIS ROUTINE DEACTIVATES THE CURRENTLY CONNECTED TERMINAL FOR     * 01680000
*   ENTERING.  THIS FUNCTION IS NOT PERFORMED FOR DIAL TERMINALS,     * 01750000
*   TSO, PROCESS ENTRIES, OR LOCK MODE.  AT THE FIRST OF THE          * 01820000
*   ROUTINE IT IS DETERMINED WHAT THE MAXIMUM NUMBER OF BUFFERS       * 01890000
*   NEEDED SHOULD BE.  ANY BUFFERS NOT USED BY THE END OF THE         * 01960000
*   ROUTINE WILL BE RETURNED TO THE BUFFER POOL.  THE BUFFERS ARE     * 02030000
*   USED TO CREATE OPERATOR CONTROL COMMANDS FOR VARYING A TERMINAL   * 02100000
*   OFF THROUGH OPERATOR CONTROL OR HAVING OPERATOR CONTROL PRINT A   * 02170000
*   MESSAGE SAYING THAT THE TERMINAL HAS BEEN VARIED OFF.  IF THE     * 02240000
*   CURRENTLY CONNECTED TERMINAL/CONTROL UNIT (270X) IS IN THE        * 02310000
*   ACTIVE SIDE OF THE INVITATION LIST THEN ALL OCCURANCES OF THAT    * 02380000
*   TERMINAL ARE MOVED TO THE INACTIVE SIDE OF THE INVITATION LIST.   * 02450000
*   THIS IS FOR SPECIFIC AND GENERAL POLL.  A BUFFER WILL BE BUILT    * 02520000
*   WITH A COMMAND TO OPERATOR CONTROL TO PRINT MESSAGE, IED026I,     * 02590000
*   WHICH INDICATES A TERMINAL HAS BEEN STOPPED.  IF THE CURRENTLY    * 02660000
*   CONNECTED TERMINAL, 270X, GENERAL POLL, IS ON THE INACTIVE SIDE   * 02730000
*   OF THE INVITATION LIST, THEN GENERAL POLL IS DEACTIVATED BY       * 02800000
*   MOVING THE CONTROL UNIT ENTRIES ASSOCIATED WITH THE CURRENTLY     * 02870000
*   CONNECTED TERMINAL TO THE INACTIVE SIDE OF THE INVITATION LIST.   * 02940000
*   SPECIFIC POLL IS THEN STARTED FOR ALL TERMINALS ASSOCIATED WITH   * 03010000
*   THE EXCEPTION OF THE CURRENTLY CONNECTED TERMINAL.  TWO BUFFERS   * 03080000
*   ARE THEN BUILT FOR OPERATOR CONTROL TO PRINT MESSAGES TO          * 03150000
*   INDICATE THAT GENERAL POLL HAS BEEN STOPPED (IED144I) AND THAT    * 03220000
*   THE TERMINAL HAS BEEN STOPPED (IED026I).                          * 03290000
*   IF THE CURRENTLY CONNECTED TERMINAL IS 3705, SPECIFIC POLL,       * 03360000
*   THEN THE TRMRSACT BIT IS TURNED ON AND A BUFFER IS BUILT FOR      * 03430000
*   OPERATOR CONTROL TO HAVE THE TERMINAL STOPPED MESSAGE, IED026I,   * 03500000
*   PRINTED.  IF THE CURRENTLY CONNECTED TERMINAL IS A CONTROL UNIT   * 03570000
*   ATTACHED TO A 3705, THEN A BUFFER IS BUILT FOR OPERATOR CONTROL   * 03640000
*   TO DO A V XXX,OFFTP,E.  THIS WILL CAUSE GENERAL POLL TO           * 03710000
*   BE STOPPED AND SPECIFIC POLL TO BE STARTED.  IF THE CURRENTLY     * 03780000
*   CONNECTED TERMINAL IS 3705, GENERAL POLL, THEN THE PREVIOUS       * 03850000
*   OPERATION OF BUILDING A BUFFER FOR OPERATOR CONTROL TO STOP       * 03920000
*   GENERAL POLL IS DONE, THEN ANOTHER BUFFER IS BUILT FOR OPERATOR   * 03990000
*   CONTROL TO DO A V XXX,OFFTP,E FOR THE CURRENTLY CONNECTED         * 04060000
*   TERMINAL.                                                         * 04130000
*   IF THE FUNCTION TO BE PERFORMED IS VARYOFF THEN A ROUTINE         * 04200000
*   DETERMINES FROM THE OPTION TARGET= ON THE IEDVOFF MACRO,          * 04270000
*   WHETHER TO DO A V LINE NO.,OFFTP,C OR V STATNAME,OFFTP,B OR       * 04340000
*   F JOBNAME,DEACT.                                                    04370000
*   ONE OF THESE COMMANDS IS BUILT IN A BUFFER TO BE SENT TO OPERATOR * 04410000
*   CONTROL.                                                          * 04480000
*   IF INTVL= IS SPECIFIED (POLLSTOP AND VARYOFF) THEN A TIME DELAY   * 04550000
*   ELEMENT IS BUILT.  THE SUBTASK ASSOCIATED WITH THIS ELEMENT IS    * 04620000
*   LOCATED AT THE END OF THIS MODULE.  WHEN THE ELEMENT IS TAKEN     * 04690000
*   OFF THE TIME DELAY QUEUE THE SUBTASK BUILDS A VARY ONTP COMMAND   * 04760000
*   OR A MODIFY COMMAND IN A BUFFER FOR OPERATOR CONTROL. IF THE      * 04790000
*   COMMAND WAS V STATNAME,OFFTP,B, THEN THE VARY ONTP COMMAND WILL   * 04830000
*   BE V STATNAME,ONTP,B INSTEAD OF V STATNAME,ONTP,E OR F JOBNAME,   * 04900000
*   ACTIV, WHEN THE COMMAND IS F JOBNAME,DEACT.                       * 04970000
*                                                                     * 05040000
* ENTRY POINTS --                                                     * 05110000
*   IEDQBI                                                            * 05180000
*   SUBTASK FOLLOWING IEDQBI                                          * 05250000
*                                                                     * 05320000
* INPUT                                                               * 05390000
*   REGISTER 0 - ZERO (IEDQBD)                                        * 05460000
*   REGISTER 1 - ADDRESS OF PARAMETER LIST (IEDQUI)                   * 05530000
*   REGISTER 1 - ELEMENT (OR ZERO) FROM IEDQBD                        * 05600000
*   REGISTER 3 - ADDRESS OF SCB                                       * 05670000
*   REGISTER 4 - ADDRESS OF LCB                                       * 05740000
*   REGISTER 7 - ADDRESS OF QCB                                       * 05810000
*   REGISTER 8 - ADDRESS OF PARAMETER LIST (IEDQBD)                   * 05880000
*   REGISTER 9 - ADDRESS OF AVT SAVE AREA (IEDQUI)                    * 05950000
*   REGISTER 11 - DISPATCHER BASE ADDRESS                             * 06020000
*   REGISTER 12 - IEDQBI BASE ADDRESS                                 * 06090000
*   REGISTER 13 - ADDRESS OF AVTSAVE2                                 * 06160000
*                                                                     * 06230000
* OUTPUT --                                                           * 06300000
*   REGISTER 1 - CHAIN OF ELEMENTS TO BE POSTED                       * 06370000
*   REGISTER 4 - ADDRESS OF LCB                                       * 06440000
*   REGISTER 11 - DISPATCHER BASE ADDRESS                             * 06510000
*   REGISTER 13 - ADDRESS OF AVTSAVE2                                 * 06580000
*                                                                     * 06650000
* EXTERNAL REFERENCES --                                              * 06720000
*   AVTRNMPT - TO COMPUTE ADDRESS OF TERMINAL ENTRY                   * 06790000
*   IEDQBJ - TO EVALUATE COUNT= EXPRESSION IF SPECIFIED               * 06860000
*   DSPPOSTR - TO INSERT ELEMENT ON READY QUEUE                       * 06930000
*   AVTHG01 - TO PUT ELEMENT ON TIME DELAY QUEUE                      * 07000000
*                                                                     * 07070000
* EXITS, NORMAL --                                                    * 07140000
*   TO IEDQUI IF ENTERED FROM IEDQUI                                  * 07210000
*   TO DISPATCHER IF ENTERED FROM IEDQBD                              * 07280000
*   TO DISPATCHER IF ENTRY POINT WAS SUBTASK                          * 07350000
*                                                                     * 07420000
* EXITS, ERROR --                                                     * 07490000
*   SAME AS NORMAL                                                    * 07560000
*                                                                     * 07630000
* TABLES/WORK AREAS --                                                * 07700000
*   TCAM AVT, SCB, DCB, UCB, LCB, TERMNAME TABLE,                     * 07770000
*   TERMINAL ENTRY, QCB, BUFFER PREFIX.                               * 07840000
*                                                                     * 07910000
* ATTRIBUTES --                                                       * 07980000
*   REUSABLE, REFRESHABLE, ENABLED                                    * 08050000
*                                                                     * 08120000
* CHARACTER CODE DEPENDENCY --                                        * 08190000
*   NONE.                                                             * 08260000
*                                                                     * 08330000
* CHANGE ACTIVITY=AS FOLLOWS:                                         * 08334000
*A000000-999999                                                @XA09783 08338000
*A312800,389600,504000,644800                                  @OY12413 08342000
*C245600                                                       @OY12413 08346000
*A894400                                                       @OY12681 08350000
*C216000                                                       @OY12950 08354000
*A316800,472000,477600                                         @OX12530 08358000
*A206400                                                       @OS77020 08362000
*C216000,216600                                                @OS77020 08366000
*A502400,645100                                                @Y17XAMG 08370000
*C184800,503200,504600,645200,645400                           @Y17XAMG 08374000
*A361900,361200,345800                                         @OZ08370 08378000
*C223300,345800,3619-362600                                    @OZ08370 08382000
*D363300-364000                                                @OZ08370 08386000
*A092400,191100,742700,329700                                  @OS77950 08390000
*C139300,191800                                                @OS77950 08394000
*A825301                                                       @OZ25852 08394200
*C161000                                                       @OZ25789 08394400
*A163100                                                       @OZ25789 08394600
* DUMMY APAR                                                   @OZ27328 08394800
*A473060,473840                                                @OY19464 08396800
*A350700                                                       @OZ29485 08396986
*A160307                                                       @OZ32423 08397086
*D515900                                                       @OZ32423 08397186
*                                                                     * 08400000
*********************************************************************** 08470000
         EJECT                                                          08540000
R0       EQU   0                        ENTRY INDICATOR                 08680000
RLENGTH  EQU   5                        LENGTH OF INVITATION ENTRY      08750000
R1       EQU   1                        DISPATCHER PARM LIST            08820000
RPARM    EQU   1                        TCB ADDRESSABILITY     @Y17XARR 08850000
RTERM    EQU   7                        TERM ENTRY BASE                 08890000
RDCB     EQU   2                        DCB ADDRESS                     08960000
RSCB     EQU   3                        SCB ADDRESS                     09030000
RWORK1   EQU   3                        WORK REGISTER                   09100000
RTNT     EQU   3                        REG FOR TNT INDEX               09170000
RLCB     EQU   4                        LCB ADDRESS                     09240000
RLCBX    EQU   11                       LCBX EXTENSION ADDR    @OS77950 09260000
RWRK     EQU   15                       WORK REGISTER          @OS77950 09280000
RNDX     EQU   5                        INDEX                           09310000
MOVELEN  EQU   8                        LENGTH FOR EXECUTES             09380000
RLIST    EQU   10                       INV LIST ADDRESS                09450000
RQCB     EQU   7                        ADDRESS OF QCB FOR BD           09520000
RWORK    EQU   7                        SWAP ENTRY                      09590000
ROFF     EQU   8                        OFFSET                          09660000
R9       EQU   9                        WORK REG.                       09730000
RDISP    EQU   11                       DISPATCHER BASE ADDRESS         09800000
RPOINT   EQU   11                       POINTER WITHIN BUFFER           09870000
RBFR     EQU   6                        BFR FOR 3705                    09940000
RBASE    EQU   12                       BASE                            10010000
RAVT     EQU   13                       AVTSAVE2                        10080000
RRET     EQU   14                       COUNTER                         10150000
R14      EQU   14                       RETURN ADDRESS                  10220000
RSAV     EQU   15                       FOR OFFSET                      10290000
RENTRY   EQU   15                        CURRENT ENTRY POINTER          10360000
R15      EQU   15                       BRANCH ADDRESS                  10430000
ZERO     EQU   0                         CONSTANT 0                     10500000
ONE      EQU   1                        CONSTANT 1                      10570000
TWO      EQU   2                        CONSTANT 2                      10640000
THREE    EQU   3                        CONSTANT 3                      10710000
FOUR     EQU   4                        CONSTANT 4                      10780000
FIVE     EQU   5                        CONSTANT 5                      10850000
SIX      EQU   6                        CONSTANT 6                      10920000
SEVEN    EQU   7                        CONSTANT 7                      10990000
EIGHT    EQU   8                        CONSTANT 8                      11060000
NINE     EQU   9                        CONSTANT 9                      11130000
TWELVE   EQU   12                       CONSTANT 12                     11200000
FOURTEEN EQU   14                       CONSTANT 14                     11270000
SIXTEEN  EQU   16                       CONSTANT 16                     11340000
TWENTY   EQU   20                       CONSTANT 20                     11410000
TWENTY4  EQU   24                       CONSTANT 24                     11480000
OFFBBIT  EQU   X'10'                    BIT FOR OFFTP,B                 11550000
OFFCBIT  EQU   X'20'                    BIT FOR OFFTP,C                 11620000
DEACTBIT EQU   X'40'                    BIT FOR DEACT                   11650000
CLEAR    EQU   X'22'                    NO. OF BYTES TO CLEAR IN PREFIX 11690000
EOT      EQU   X'80'                    EOT FLAG                        11760000
ENDACT   EQU   X'FE'                    END OF ACTIVE ENTRIES           11830000
XFF      EQU   X'FF'                    GENREAL MASK BITS               11900000
MASKF0   EQU   X'F0'                    MASK FOR ZONE DECIMAL DIGIT     11970000
SNGLTRM  EQU   X'E0'                    SINGLE ENTRY                    12040000
CUSW     EQU   X'08'                    CONTROL UNIT SWITCH             12110000
ACTIVSW  EQU   X'80'                    ACTIVE SWITCH                   12180000
ORDERBIT EQU   X'01'                    TRYING TO ORDER ENTRIES         12250000
POL01    EQU   X'01'                    BIT TO SET FOR SPECIAL 3705     12320000
POL02    EQU   X'02'                    BUT TO SPECIFY MSG.             12390000
TIC02    EQU   X'02'                    TIC FOR SECOND UNIT IN BFR      12460000
TIC08    EQU   X'08'                    BYTE TO TIC TO NEXT UNIT        12530000
UNIT01   EQU   X'01'                    ONE UNIT PER BFR                12600000
UNIT02   EQU   X'02'                    TWO UNITS PER BFR               12670000
*                                          BUFFERS GOING TO OP CNTL     12740000
PRFLNGTH EQU   X'2C'                    LENGTH OF BFR PREFIX            12810000
DATAOFF  EQU   X'20'                    OFFSET  FOR START OF DATA       12880000
FE       EQU   X'FE'                    END OF LIST            @OX12530 12950000
VARYLEN  EQU   X'0C'                    LENGTH OF DATA-TRMNAME          13020000
*                                       (LEN OF CMD+1 TO TAKE CARE OF   13090000
*                                         LEN-1 OF TERMNAME)            13160000
MCMDLEN  EQU   10                       LEN OF MODIFY CMD      @YM08412 13190000
         SPACE 2                                                        13230000
*        USING STATEMENTS                                             * 13300000
         SPACE 2                                                        13370000
         USING IHADCB,RDCB                                              13440000
         USING IEDQTRM,RTERM                                            13510000
         USING AVTSAVE2,RAVT                                            13580000
         USING IEDQSCB,RSCB                                             13650000
         USING INPARM,ROFF                                              13720000
         USING IEDQPRF,RBFR                                             13790000
         USING IEDQLCB,RLCB                                             13860000
         USING IEDQLCBX,RLCBX                                  @OS77950 13930000
         USING *,RBASE                                                  14000000
         SPACE 2                                                        14070000
*        ENTRY FROM IEDQBD                                              14140000
         SPACE 2                                                        14210000
IEDQBI   IEDHJN   STRTHERE                                              14280000
         LTR   R0,R0                    WAS ENTRY FROM IEDQBD           14350000
         BZ    BDENTRY                    BRANCH YES                    14420000
         SPACE                                                          14490000
         O     RBASE,SPMASK             INDICATE ENTRY FROM IEDQUI      14560000
         LR    ROFF,R1                  PARM LIST TO REG 8              14630000
         ST    RAVT,AVTPARM-IEDQAVTD(,R9)  SAVE SAVE AREA ADDRESS       14700000
         LA    RAVT,AVTSAVE2-IEDQAVTD(,R9)  SET UP AVT BASE             14770000
         SR    RNDX,RNDX                INDICATE NOTHING TO POST        14840000
         B     LOCTERM                  GO LOCATE TERMINAL              14910000
         SPACE 2                                                        14980000
BDENTRY  EQU   *                                                        15050000
         LPR   RQCB,RQCB                INSURE POSITIVE ADDRESS         15120000
         ST    RQCB,LCBERBQB-ONE        SET TO POST ERB TO BD           15190000
         ST    R1,LCBERBLK-ONE          ADD TO POST LIST                15260000
         MVI   LCBERBPY,PRIRCQCB        SET PRIORITY                    15330000
         LA    RNDX,LCBERB              ERB TO POST                     15400000
         SPACE 2                                                        15470000
*        LOCATE TERMINAL ENTRY                                          15540000
         SPACE 2                                                        15610000
LOCTERM  EQU   *                                                        15680000
         ST    ROFF,AVTSAVE3+TWENTY4    SAVE PARM LIST ADDR             15750000
         ST    RNDX,AVTSAVE3+TWENTY     SAVE ERB ADDRESS                15820000
         L     R15,AVTRNMPT             GET ADDR OF TERMNAME TABLE      15890000
         LH    R1,LCBTTCIN              GET INDEX OF CURRENT TERM.      15960000
         N     R1,AVTCLRHI              CLEAR HIGH ORDER BITS           16030000
         BNZ   GOTTCIN                  HAS TTCIN              @OZ25789 16030700
         L     RDCB,LCBDCBPT            GET DCB ADDRESS        @OZ32423 16030886
         TM    DCBDSORG-IHADCB(RDCB),AVTE80 3705 TERMINAL ?    @OZ32423 16030986
         BO    RETDISP                  YES, GET OUT.          @OZ32423 16031086
         TM    INPFLAG,INPVARY          VARYOFF                @OZ25789 16031400
         BNO   RETDISP                                         @OZ25789 16032100
         TM    INPFLAG,INPLINE          VARYOFF FOR LINE       @OZ25789 16032800
         BNO   RETDISP                                         @OZ25789 16033500
         TM    INPFLAG,INPCOUNT         COUNT SPECIFIED        @OZ25789 16034200
         BO    RETDISP                                         @OZ25789 16034900
         B     NOTTRM                                          @OZ25789 16035600
GOTTCIN  EQU   *                                               @OZ25789 16036300
         BALR  R14,R15                  GO GET TERM ENTRY               16170000
         SPACE                                                          16240000
         LR    RTERM,R1                 COPY TERM ADDRESS               16310000
NOTTRM   EQU   *                                               @OZ25789 16320000
         LA    R15,ONE                  ASSUME 1 UNIT                   16380000
         TM    INPFLAG,INPVARY          VARYOFF SPECIFIED               16450000
         BO    NOGENPL                    BYPASS 3270/2260 TEST         16520000
         SPACE                                                          16590000
         SR    R14,R14                  CLEAR FOR IC                    16660000
         IC    R14,TRMCHCIN             CHARACTERISTICS INDEX           16730000
         BCTR  R14,0                    MINUS ONE                       16800000
         MH    R14,AVTDCTLN             TIMES DCT ENTRY LENGTH @Y17XAMG 16870000
         AL    R14,AVTCSTCS             TABLE ORIGIN                    16940000
         TM    TWO(R14),TWO             LOCAL DEVICE                    17010000
         BO    NOGENPL                   BRANCH YES NO GEN POLL         17080000
         SPACE                                                          17150000
         TM    ONE(R14),FOUR            3270 REMOTE                     17220000
         BO    ISGENPL                    BRANCH YES                    17290000
         SPACE                                                          17360000
         TM    THREE(R14),TWO           2260                            17430000
         BZ    NOGENPL                    BRANCH NO                     17500000
         SPACE                                                          17570000
ISGENPL  EQU   *                                                        17640000
         ALR   R15,R15                  GET EXTRA UNIT                  17710000
NOGENPL  EQU   *                                                        17780000
         CLC   AVTKEYLE,MSGLEN          NEED TWO UNITS/MESSAGE          17850000
         BNL   ONEOK                      BRANCH NO                     17920000
         SPACE                                                          17990000
         ALR   R15,R15                  DOUBLE BUFFER REQUIREMENT       18060000
ONEOK    EQU   *                                                        18130000
         TM    INPFLAG,INPINVL          IS INTVL= SPECIFIED             18200000
         BZ    GOTREQ                     BRANCH NO                     18270000
         SPACE                                                          18340000
         LA    R15,ONE(,R15)            GET ONE MORE                    18410000
GOTREQ   EQU   *                                                        18480000
         BAL   R14,GETBFR               GET BUFFER UNITS                18550000
         SPACE                                                          18620000
         LTR   R15,R15                  ENOUGH BUFFERS - 0=OK           18690000
         BNZ   RETDISP                  RETURN CONDITION CODE '0C'      18760000
         TM    INPFLAG,INPVARY          VARY OFF?              @OS77020 18830000
         BO    VOFF                     YES, SKIP PSTOP TESTS  @OS77020 18900000
         SPACE 2                                                        18970000
*        CHECK FOR SINGLE NONDIAL TERMINAL                            * 19040000
         SPACE 2                                                        19110000
         L     RDCB,LCBDCBPT            GET DCB ADDR           @OS77950 19116000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80 TERM ATTACHED 3705 @OS77950 19122000
         BO    NXTCK                    BYPASS STATUS PND CHK  @OS77950 19128000
         SR    RWRK,RWRK                CLEAR WORK REGISTER    @OS77950 19134000
         IC    RWRK,DCBEIOBX            INSERT LCB LENGTH      @OS77950 19140000
         SH    RWRK,HALF8               REDUCE LENGTH BY 8     @OS77950 19146000
         LA    RLCBX,ZERO(RWRK,RLCB)    LCB EXTENSION ADDR     @OS77950 19152000
         TM    LCBXFLAG,LCBERPND        SOH% PENDING ?         @OS77950 19158000
         BO    RETDISP1                 BRANCH YES             @OS77950 19164000
         SPACE                                                          19170000
NXTCK    TM    TRMSTATE,SNGLTRM         IS THIS SINGLE TERM    @OS77950 19180000
         BNZ   RETDISP1                 IF NO - GO TO DSPCHAIN          19250000
         TM    TRMSTATE,TRMPREF         DOES A PREFIX EXIST    @XM05658 19253000
         BNO   NOPREFIX                 NO BRANCH              @XM05658 19256000
         LR    R15,RTERM                GET TERM ENTRY         @Y17XARR 19260000
         S     R15,TRMPREFL             BACKUP TO THE PREFIX   @Y17XARR 19270000
         TM    TRMBYTE0-IEDNTRM(R15),TRMSNA  SNA?              @Y17XARR 19280000
         BO    RETDISP1                 REJECT                 @Y17XARR 19300000
NOPREFIX DS    0H                                              @XM05658 19320000
         L     R15,TRMDESTQ-ONE         QCB ADDRESS                     19390000
         TM    QCBFLAG-IEDQQCB(R15),QCBTSSES   TSO SESSION ACTIVE       19460000
         BO    RETDISP1                 BRANCH YES                      19530000
         SPACE 2                                                        19600000
         TM    LCBSTAT2,LCBDIAL        IS THIS A DIAL TERMINAL          19670000
         BO    RETDISP1                 BRANCH YES             @OS77020 19740000
         SPACE 2                                                        19810000
         TM    SCBSTATE,SCBMSGLN+SCBLCK1N  CHECK FOR MSG LOCK OR        19880000
*                                            EXTENDED LOCK BITS ON      19950000
         BNZ   RETDISP1                 BR IF LOCK MODE ON              20020000
         SPACE                                                          20090000
         DROP  RSCB                                                     20160000
         USING IEDQTNTD,RTNT                                            20230000
         SPACE 2                                                        20300000
*   CHECK TO SEE IF THE COUNT OPTION  IS SPECIFIED                      20370000
         SPACE 2                                                        20440000
VOFF     EQU   *                                                        20510000
         TM    INPFLAG,INPCOUNT         WAS COUNT= CODED                20580000
         BZ    NOCOUNT                    BRANCH NO                     20650000
         SPACE                                                          20720000
         LA    RDCB,FOUR(,ROFF)         PARM LIST FOR BJ                20790000
         TM    INPIND,INPMSK            WAS MASK SPECIFIED              20860000
         BO    NOMASK                     BRANCH NO                     20930000
         SPACE                                                          21000000
         LA    RDCB,FOUR(,RDCB)         BUMP PAST ERROR MASK            21070000
NOMASK   EQU   *                                                        21140000
         SR    R15,R15                  CLEAR REGISTER                  21210000
         IC    R15,ZERO(RDCB)           INDEX TO IEDQBJ                 21280000
         AL    R15,AVTMSGS-1            VCON TABLE ADDRESS              21350000
         L     R15,0(,R15)              ADDRESS OF IEDQBJ               21420000
         BALR  R14,R15                  LINK TO IEDQBJ                  21490000
         SPACE                                                          21560000
         LTR   R15,R15                  CHECK RETURN CODE FROM BJ       21630000
         BNZ   RETDISP1                 DO NOT EXECUTE FUNCTION         21700000
         SPACE                                                          21770000
*       NORMAL RETURN TO +4                                             21840000
         SPACE 2                                                        21910000
*        CHECK FOR TERMINAL ATTACHED VIA 3705                         * 21980000
         SPACE 2                                                        22050000
NOCOUNT  EQU   *                                                        22120000
         XC    AVTDOUBL(EIGHT),AVTDOUBL INIT WORK AREA                  22190000
         L     R1,AVTSAVE3+TWENTY       POST LIST TO R1                 22260000
         TM    INPFLAG,INPVARY          IS THIS IEDVOFF        @OZ08370 22330000
         BO    VARYOFF                  BRANCH YES                      22400000
         L     RDCB,LCBDCBPT            GET LGB OR DCB ADDRESS          22470000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80   IS TERM ATTACHED VIA 3705 22540000
         BO    YES3705                  IF YES - GO TO YES3705          22610000
         SPACE 2                                                        22680000
*        ACCESS INVITATION LIST                                       * 22750000
         SPACE 2                                                        22820000
*         CODE FOR 270X  TERMINALS                                      22890000
         SR    RNDX,RNDX                INIT REG                        22960000
         IC    RNDX,LCBUCBX             LOAD INVLIST INDEX              23030000
         SLL   RNDX,TWO                 MULTIPLY POINTER BY 4           23100000
         L     RLIST,DCBINVLI(RNDX)     GET ADDR OF INVLIST             23170000
         SPACE 2                                                        23240000
*        CHECK FOR CONTENTION BOX                                     * 23310000
         SPACE 2                                                        23380000
         CLI   TWO(RLIST),ONE           CHECK FOR CONTENTION BOX        23450000
         BE    RETDISP2                 IF YES, DO NOTHING              23520000
         SPACE                                                          23590000
         CLI   ONE(RLIST),ZERO          ANY ACTIVE ENTRIES?             23660000
         BE    RETDISP2                 NO                              23730000
         SPACE 2                                                        23800000
*        INITIALIZATION                                               * 23870000
         SR    RLENGTH,RLENGTH          INIT REG                        23940000
         IC    RLENGTH,TWO(,RLIST)      LENGTH OF ENTRY                 24010000
         LR    RWORK1,RLENGTH           LENGTH OF ENTRY                 24080000
         BCTR  RWORK1,0                 DECREMENT FOR EXECUTE           24150000
         SPACE 2                                                        24220000
*        CHECK STATUS OF INVITATION LIST                              * 24290000
         SPACE 2                                                        24360000
NXTENTRY EQU   *                                                        24430000
         LH    ROFF,AVTDOUBL            GET NEXT ENTRY                  24500000
         LA    ROFF,ONE(ROFF)           INCR BY ONE                     24570000
         STH   ROFF,AVTDOUBL            STORE BACK                      24640000
         CLC   AVTDOUBL+ONE(ONE),ZERO(RLIST)   OUT OF ENTRIES?          24710000
         BH    TEST                     YES                             24780000
         SPACE 2                                                        24850000
         ALR   ROFF,ROFF                MULTIPLY BY TWO                 24920000
         LR    RENTRY,RLIST             BEGINNING                       24990000
         SR    RENTRY,ROFF              BACK TO ENTRY                   25060000
         CLC   ZERO(TWO,RENTRY),LCBTTCIN   TO BE DEACTIVATED            25130000
         BNE   NXTENTRY                 NO                              25200000
         SPACE 2                                                        25270000
*        SEARCH ACTIVE LIST FOR CORRECT INDEX                           25340000
         SPACE 2                                                        25410000
         LA    RENTRY,SEVEN(,RLIST)     POINTER TO FIRST ENTRY INDEX    25480000
         SR    RRET,RRET                CLEAR                           25550000
         IC    RRET,ONE(,RLIST)         NO. OF ACTIVE ENTRIES           25620000
         SPACE 2                                                        25690000
CKNEXTA  EQU   *                                                        25760000
         AR    RENTRY,RLENGTH           GO TO NEXT ENTRY'S INDEX        25830000
         CLC   ZERO(ONE,RENTRY),AVTDOUBL+ONE   DOES INDEX MATCH         25900000
         BE    DACTIVT                  BR TO DEACTIVATE TERMINAL ENTRY 25970000
         SPACE 2                                                        26040000
         BCT   RRET,CKNEXTA             NOT END OF ACTIVE, GO BACK      26110000
         SPACE 2                                                        26180000
*        SEARCH FOR ENTRY IN INACTIVE LIST                            * 26250000
         SPACE 2                                                        26320000
         TM    AVTDOUBL+TWO,ACTIVSW     IS ACTIVE SWITCH ON             26390000
         BO    NXTENTRY                 YES                             26460000
         XC    AVTDOUBL+FOUR(FOUR),AVTDOUBL+FOUR   CLEAR WORK AREA      26530000
         TM    THREE(RLIST),EOT         IS THIS EOT-FE (BSC)            26600000
         BNO   ADD1                     IF NO - ONLY ADD 1              26670000
         SPACE 2                                                        26740000
         LA    RENTRY,ONE(,RENTRY)      ADD EXTRA ONE FOR EOT           26810000
ADD1     EQU   *                                                        26880000
         LA    RENTRY,ONE(RENTRY)       ADD ONE FOR 'FE'                26950000
         IC    RRET,ZERO(,RLIST)        GET TOTAL ENTRIES               27020000
         MVC   AVTDOUBL+SEVEN(ONE),ONE(RLIST)   GET NO. OF ACTIVE ENTS. 27090000
         S     RRET,AVTDOUBL+FOUR       COMPUTE INACTIVE ENTRIES        27160000
         BZ    NXTENTRY                 YES                             27230000
         SPACE 2                                                        27300000
CKINACT  EQU   *                                                        27370000
         AR    RENTRY,RLENGTH           GET TO NEXT INDEX               27440000
         CLC   ZERO(ONE,RENTRY),AVTDOUBL+ONE  DOES INDEX MATCH          27510000
         BE    CKCU                     YES                             27580000
         SPACE 2                                                        27650000
         BCT   RRET,CKINACT             LOOK AT NEXT ENTRY              27720000
         B     NXTENTRY                 IF NOT INACTIVE, GET NEXT ENT.  27790000
         SPACE 2                                                        27860000
*        SET UP TO MOVE ENTRY FROM ACTIVE TO INACTIVE                 * 27930000
         SPACE 2                                                        28000000
DACTIVT  EQU   *                                                        28070000
         OI    AVTDOUBL+TWO,ACTIVSW     TURN ON ACTIVE SW               28140000
DACTIVCU EQU   *                                                        28210000
         L     ROFF,AVTSAVE3+TWENTY4    PARM LIST ADDRESS      @OY12413 28280000
         TM    INPFLAG,INPVARY          VARY OFF               @OY12413 28350000
         BO    VARYOFF                  BRANCH IF YES          @OY12413 28420000
         L     R9,LCBINVPT-1            GET INV LIST ENTRY POINTER      28490000
         LA    R9,ZERO(,R9)             CLEAR HIGH ORDER BYTE           28560000
         CR    RENTRY,R9                WHERE IS ENTRY COMPARED TO      28630000
*                                         LCBINVPT                      28700000
         BNL   NOUPDTE                  DON'T UPDATE LCBINVPT           28770000
         SR    RWORK,RWORK              CLEAR REGISTER         @OX12530 28840000
         IC    RWORK,ONE(,RLIST)        NO. ACTIVE ENTRIES     @OX12530 28910000
         STH   RWORK,AVTSAVE3+TWO       SAVE NO. ACTIVE ENTRIE @OX12530 28980000
         SR    RWORK,RWORK              CLEAR REGISTER         @OX12530 29050000
         LR    RWORK,RLENGTH            LENGTH OF EACH ENTRY   @OX12530 29120000
         MH    RWORK,AVTSAVE3+TWO       TOTAL LENGTH OF ENTRIE @OX12530 29190000
         LA    RWORK,EIGHT(RWORK,RLIST)  ADDR OF END OF LIST   @OX12530 29260000
*                                        INDICATOR             @OX12530 29330000
         CLI   ZERO(RWORK),FE           END OF LIST            @OX12530 29400000
         BE    NOTEOT                   YES, BRANCH            @OX12530 29470000
         LA    RWORK,ONE(,RWORK)        ADJUST FOR EOT CHARACT @OX12530 29540000
NOTEOT   EQU   *                                               @OX12530 29610000
         CR    RWORK,R9                 R9 IN INVITATION LIST  @OX12530 29680000
         BL    NOUPDTE                  NO, DON'T CHAMGE LCB   @OX12530 29750000
         SLR   R9,RLENGTH               CORRECT THE POINTER             29820000
         IC    RDCB,LCBINVPT-1          SAVE HIGH ORDER BYTE            29890000
         ST    R9,LCBINVPT-1            RESTORE POINTER                 29960000
         STC   RDCB,LCBINVPT-1          RESTORE HIGH ORDER BYTE         30030000
         SPACE                                                          30100000
NOUPDTE  EQU   *                                                        30170000
         LR    RWORK,RENTRY                                             30240000
         SR    RENTRY,RLENGTH           SET TO ENTRY LENGTH-1           30310000
         BCT   RRET,SWAPLOOP            SWAP ENTRIES                    30380000
         SPACE 2                                                        30450000
         B     LOOPOUT                  MOVE LAST ENTRY                 30520000
         SPACE 2                                                        30590000
SWAPLOOP EQU   *                                                        30660000
         EX    RWORK1,SWAP1              SWAP TWO                       30730000
         EX    RWORK1,SWAP2             SUCCESSIVE                      30800000
         EX    RWORK1,SWAP1             ENTRIES                         30870000
         AR    RENTRY,RLENGTH           MOVE TO                         30940000
         AR    RWORK,RLENGTH            NEXT ENTRY                      31010000
         BCT   RRET,SWAPLOOP            NOT DONE RETURN                 31080000
         SPACE 2                                                        31150000
LOOPOUT  EQU   *                                                        31220000
         LR    RRET,RLENGTH             RESTORE LENGTH FOR MOVE         31290000
         TM    THREE(RLIST),EOT         IS THIS EOT-FE (BSC)            31360000
         BO    SETEOT                   YES                             31430000
         SPACE 2                                                        31500000
SETLOOP  EQU   *                                                        31570000
         MVC   ONE(ONE,RWORK),ZERO(RWORK)   MOVE ONE CHARACTER          31640000
         BCTR  RWORK,ZERO                      AT A TIME                31710000
         BCT   RRET,SETLOOP                    UNTIL FINISHED           31780000
         MVI   ONE(RWORK),ENDACT        INSERT ACTIVE END CHAR.         31850000
         B     RSETACT                  GO RESET ACTIVE COUNT           31920000
         SPACE 2                                                        31990000
SETEOT   EQU   *                                                        32060000
         MVC   AVTSAVE3+TWO(TWO),ONE(RWORK)    SAVE EOT CHARS.          32130000
         SPACE                                                          32200000
SETEOT1  EQU   *                                                        32270000
         MVC   TWO(ONE,RWORK),ZERO(RWORK)    MOVE ONE CHARACTER         32340000
         BCTR  RWORK,ZERO                       AT A TIME               32410000
         BCT   RRET,SETEOT1                     UNTIL FINISHED          32480000
         SPACE                                                          32550000
         MVC   ONE(TWO,RENTRY),AVTSAVE3+TWO    RESTORE EOT CHARS.       32620000
         SPACE 2                                                        32690000
RSETACT  EQU   *                                                        32760000
         IC    RRET,ONE(,RLIST)         COUNT OF ACTIVE ENTRIES         32830000
         BCTR  RRET,ZERO                DECREMENT ACTIVE COUNT          32900000
         STC   RRET,ONE(,RLIST)         STORE COUNT BACK                32970000
         LTR   RRET,RRET                ZERO ACTIVE ENTRIES ?  @OS77950 32980000
         BNZ   CKMVE                    NO, CONTINUE           @OS77950 32990000
         NI    LCBXFLAG,LCBGPSTP        YES, TURN OFF GEN POLL @OS77950 33000000
         B     TEST                                            @OS77950 33010000
CKMVE    EQU   *                                               @OS77950 33020000
         TM    AVTDOUBL+TWO,ACTIVSW     CHECK FOR HAVING MOVED          33040000
*                                          AN ACTIVE TERMINAL ENTRY     33110000
         BO    NXTENTRY                 YES                             33180000
         SPACE 2                                                        33250000
         B     CKCU1                    BR TO LOOK FOR NEXT CNTL UNIT   33320000
         SPACE 2                                                        33390000
*        CHECK ACTIVE LIST FOR CONTROL UNIT ASSOCIATED WITH           * 33460000
*        TERMINAL ENTRY IN INACTIVE LIST                              * 33530000
         SPACE 2                                                        33600000
CKCU     EQU   *                                                        33670000
         SR    RENTRY,RLENGTH           BACK UP TO FIRST OF ENTRY       33740000
         MVC   AVTDOUBL+THREE(ONE),ONE(RENTRY)   CONTROL UNIT ADDRESS   33810000
CKCU1    EQU   *                                                        33880000
         LA    RENTRY,SEVEN(,RLIST)     GET TO FIRST ENTRY              33950000
         SR    RENTRY,RLENGTH           BACK UP ONE                     34020000
         IC    RRET,ONE(RLIST)          GET ACTIVE COUNT                34090000
         LTR   RRET,RRET                CHECK ACTIVE COUNT              34160000
         BZ    NXTENTRY                 IF ZERO, GET NEXT ENTRY         34230000
         SPACE 2                                                        34300000
CKNEXTCU EQU   *                                                        34370000
         AR    RENTRY,RLENGTH           GO TO NEXT ENTRY                34440000
         CLC   ONE(ONE,RENTRY),AVTDOUBL+THREE    CONTROL UNIT MATCH?    34510000
         BNE   UPDATE                   NO CONTROL UNIT        @OZ08370 34580000
         CLC   THREE(TWO,RENTRY),X7F7F  IS THIS A 3270 CNTL UN @OZ08370 34587000
         BE    SETUP                    YES                    @OZ08370 34594000
         CLC   THREE(TWO,RENTRY),X2222  IS THIS ASCII CNTL UNI @OZ08370 34601000
         BE    SETUP                    YES                    @OZ08370 34608000
         CLI   TWO(RENTRY),XFF          IS THIS 2260 CNTL UNIT @OZ08370 34615000
         BE    SETUP                    YES                    @OZ08370 34622000
         SPACE                                                          34629000
UPDATE   EQU   *                                               @OZ08370 34636000
         BCT   RRET,CKNEXTCU            NOT END OF ACTIVE, GO BACK      34650000
         SPACE 2                                                        34720000
         B     NXTENTRY                 END OF ACTIVE LIST,GET NEXT ENT 34790000
         SPACE 2                                                        34860000
*        SET UP POINTERS TO MOVE CONTROL UNIT                         * 34930000
SETUP    EQU   *                                                        35000000
         OI    AVTDOUBL+TWO,CUSW        TURN ON CONTROL UNIT SW         35070000
         NI    LCBXFLAG,LCBGPSTP        TURN OFF GEN POLL BIT  @OZ29485 35100086
         AR    RENTRY,RLENGTH           SET UP POINTER                  35140000
         SR    ROFF,ROFF                CLEAR FOR IC                    35210000
         IC    ROFF,ZERO(,RENTRY)       GET INDEX                       35280000
         AR    ROFF,ROFF                DOUBLE INDEX TO FIND TNT        35350000
         LNR   ROFF,ROFF                NEGATE OFFSET                   35420000
         AR    ROFF,RLIST               BACK UP TO OFFSET               35490000
         MVC   AVTSAVE3(TWO),ZERO(ROFF)   SAVE TNT OFFSET               35560000
         B     DACTIVCU                 DEACTIVATE CONTROL UNIT         35630000
         SPACE 2                                                        35700000
*        TEST TO SEE IF A CONTROL UNIT HAS BEEN MOVED.                * 35770000
*        IF IT HAS, THEN SPECIFIC TERMINALS IN INACTIVE LIST          * 35840000
*        ASSOCIATED WITH THAT CONTROL UNIT SHOULD BE MOVED TO ACTIVE  * 35910000
*        LIST.                                                        * 35980000
         SPACE 2                                                        36050000
TEST     EQU   *                                                        36120000
         TM    AVTDOUBL+TWO,CUSW        CONTROL UNIT MOVED     @OZ08370 36140000
         BO    MOVESPEC                 YES                    @OZ08370 36160000
         TM    AVTDOUBL+TWO,ACTIVSW     ACTIVE TERM MOVED      @OZ08370 36190000
         BZ    RETDISP1                 NO                     @OZ08370 36260000
         SPACE                                                          36470000
         B     GENMSG                   FINISHED                        36540000
         SPACE 2                                                        36610000
*        MOVE SPECIFIC TERMINALS FROM INACTIVE TO ACTIVE LIST         * 36680000
         SPACE 2                                                        36750000
MOVESPEC EQU   *                                                        36820000
         SR    RRET+ONE,RRET+ONE        CLEAR ODD NUMBERED REG.         36890000
         IC    RRET+ONE,ONE(,RLIST)      GET NO. OF ACTIVE ENTRIES      36960000
         MR    RRET,RLENGTH             GET LENGTH OF ACTIVE LIST       37030000
         LR    RRET,RRET+ONE            GET RESULTS OF MULTIPLY         37100000
         LA    RENTRY,EIGHT(RRET,RLIST)  GET TO INACTIVE LIST           37170000
         TM    THREE(RLIST),EOT         EOT ENTRY PRESENT?              37240000
         BNO   INCR1                    NO                              37310000
         SPACE 2                                                        37380000
         LA    RENTRY,ONE(,RENTRY)      ADJUST POINTER TO FIRST ENTRY   37450000
         SPACE 2                                                        37520000
INCR1    EQU   *                                                        37590000
         LA    RENTRY,ONE(,RENTRY)                                      37660000
         SR    RENTRY,RLENGTH           BACK UP ONE                     37730000
         SR    ROFF,ROFF                CLEAR                           37800000
         IC    ROFF,ZERO(,RLIST)        COMPUTE                         37870000
         MVC   AVTDOUBL+SEVEN(ONE),ONE(RLIST)    NO. OF                 37940000
         S     ROFF,AVTDOUBL+FOUR               INACTIVE ENTRIES        38010000
         SPACE 2                                                        38080000
CKNEXT1  EQU   *                                                        38150000
         AR    RENTRY,RLENGTH           GET TO NEXT ENTRY               38220000
         CLC   ZERO(ONE,RENTRY),AVTDOUBL+THREE   COMPARE CONTROL CHAR   38290000
         BE    TESTTNT                  CHECK TNT INDEX                 38360000
         SPACE 2                                                        38430000
         BCT   ROFF,CKNEXT1             IF NOT END, GO BACK             38500000
         B     GENMSG                   FINISHED                        38570000
         SPACE 2                                                        38640000
*        TEST TO SEE IF THIS IS TERMINAL IN "ERROR"                   * 38710000
         SPACE 2                                                        38780000
TESTTNT  EQU   *                                                        38850000
         SR    RRET,RRET                CLEAR                           38920000
         IC    RRET,ZERO(RWORK1,RENTRY) GET INDEX                       38990000
         ALR   RRET,RRET                MULTIPLY BE TWO                 39060000
         LR    RWORK,RLIST              GET FIRST OF LSIT               39130000
         SR    RWORK,RRET               BACK TO ENTRY                   39200000
         CLC   ZERO(TWO,RWORK),LCBTTCIN   TO BE ACTIVATED               39270000
         BE    CKNEXT1                                                  39340000
         SPACE 2                                                        39410000
         CLC   TWO(TWO,RENTRY),X7F7F    IS THIS A 3270 CONTROL UNIT     39480000
         BE    CKNEXT1                  YES                             39550000
         CLC   TWO(TWO,RENTRY),X2222    CHECK FOR ASCII CONTROL UNIT    39620000
         BE    CKNEXT1                  YES                             39690000
         SPACE 2                                                        39760000
         CLI   ONE(RENTRY),XFF          IS THIS A 2260 CONTROL UNIT     39830000
         BE    CKNEXT1                  YES                             39900000
         SPACE 2                                                        39970000
*        MOVE ENTRY FROM INACTIVE TO ACTIVE                           * 40040000
         SPACE 2                                                        40110000
MOVE     EQU   *                                                        40180000
         ALR   RENTRY,RWORK1            POINT TO INDEX                  40250000
         MVC   AVTDOUBL+SEVEN(ONE),ZERO(RENTRY)   SAVE INDEX            40320000
         SR    RENTRY,RLENGTH           POINT TO PREVIOUS ENTRY         40390000
         LR    RWORK,RENTRY                                             40460000
         SR    RWORK,RLENGTH            POINT TO PREVIOUS ENTRY         40530000
ACTIVATE EQU   *                                                        40600000
         CLI   ZERO(RENTRY),ENDACT      FIRST INACTIVE ENTRY            40670000
         BE    MACTIVE                  YES                             40740000
         SPACE 2                                                        40810000
SWAPLOP2 EQU   *                                                        40880000
         EX    RWORK1,SWAP1             SWAP ONE POSITION               40950000
         EX    RWORK1,SWAP2             WITH THE NEXT                   41020000
         EX    RWORK1,SWAP1             SUCCESSIVE POSITION             41090000
         TM    AVTDOUBL+TWO,ORDERBIT    TRYING TO ARRANGE               41160000
         BO    CKPOS                    YES                             41230000
         SPACE 2                                                        41300000
         SR    RENTRY,RLENGTH           BACK UP ONE ENTRY               41370000
         SR    RWORK,RLENGTH            BACK PREVIOUS ENTRY BY ONE      41440000
         B     ACTIVATE                 CHECK FOR INACTIVE ENTRY        41510000
         SPACE 2                                                        41580000
MACTIVE  EQU   *                                                        41650000
         TM    THREE(RLIST),EOT         EOT ENTRY PRESENT?              41720000
         BO    MACTIVE1                 YES                             41790000
         SPACE 2                                                        41860000
         EX    RWORK1,MOVACT            PLACE ENTRY ON ACTIVE SIDE      41930000
         LA    RRET,ZERO(RLENGTH,RENTRY)   POINT TO NEW END OF ACTIVE   42000000
         BCTR  RENTRY,ZERO              GET ON LESS                     42070000
         BCTR  RWORK,ZERO               GET ONE LESS                    42140000
         MVI   ZERO(RRET),ENDACT        RESET ACTIVE POINTER            42210000
         SPACE 2                                                        42280000
MACTIVE2 EQU   *                                                        42350000
         BCTR  RENTRY,0                 BACK UP POINTER                 42420000
         BCTR  RWORK,0                  BACK UP POINTER                 42490000
         SR    RRET,RRET                CLEAR                           42560000
         IC    RRET,ONE(,RLIST)         GET NO. OF ACTIVE ENTRIES       42630000
         LA    RRET,ONE(,RRET)          INCR. FOR BCT                   42700000
         SPACE 2                                                        42770000
ACTLOOP  EQU   *                                                        42840000
         BCT   RRET,ACTPOS              IF NOT LAST POSITION , COMPARE  42910000
         SPACE 2                                                        42980000
RETURNA  EQU   *                                                        43050000
         L     R9,LCBINVPT-1            GET INV LIST POINTER            43120000
         LA    R9,ZERO(,R9)             CLEAR HIGH ORDER BYTE           43190000
         SR    RENTRY,RWORK1            POINT TO FIRST OF ENTRY         43260000
         CR    RENTRY,R9                WHERE IS ENTRY COMPARED TO      43330000
*                                         LCBINVPT?                     43400000
         BH    ARND                     DON'T UPDATE LCBINVPT           43470000
         STH   RLENGTH,AVTSAVE3+TWO     LENGTH OF EACH ENTRY   @OX12530 43540000
         SR    RRET,RRET                CLEAR REGISTER         @OX12530 43610000
         IC    RRET,ONE(,RLIST)         NO. ACTIVE ENTRIES     @OX12530 43680000
         MH    RRET,AVTSAVE3+TWO        TOTAL LENGTH OF ENTRIES@OX12530 43750000
         LA    RRET,EIGHT(RRET,RLIST)   ADDR OF END OF LIST    @OX12530 43820000
*                                        INDICATOR             @OX12530 43890000
         CLI   ZERO(RRET),FE            END OF LIST            @OX12530 43960000
         BE    NOTEOT1                  YES, BRANCH            @OX12530 44030000
         LA    RRET,ONE(,RRET)          ADJUST FOR EOT CHARACT @OX12530 44100000
NOTEOT1  EQU   *                                               @OX12530 44170000
         CR    RRET,R9                  R9 IN INVITATION LIST  @OX12530 44240000
         BL    ARND                     NO, DON'T CHANGE LCB   @OX12530 44310000
         ALR   R9,RLENGTH               ADJUST LCBINVPT                 44380000
         IC    RDCB,LCBINVPT-1          SAVE HIGH ORDER BYTE            44450000
         ST    R9,LCBINVPT-1            UPDATE POINTER                  44520000
         STC   RDCB,LCBINVPT-1          RESTORE HIGH ORDER BYTE         44590000
         SPACE                                                          44660000
ARND     EQU   *                                                        44730000
         SR    RRET,RRET                CLEAR REGISTER         @OX12530 44800000
         IC    RRET,ONE(,RLIST)         GET                             44870000
         LA    RRET,ONE(,RRET)          AND INCREMENT                   44940000
         STC   RRET,ONE(,RLIST)         NUMBER OF ACTIVE ENTRIES        45010000
         NI    AVTDOUBL+TWO,XFF-ORDERBIT   TURN OFF BIT                 45080000
         B     MOVESPEC                 CHECK TO SEE IF ANYMORE TO MOV) 45150000
         SPACE 2                                                        45220000
ACTPOS   EQU   *                                                        45290000
         CLC   ZERO(ONE,RENTRY),AVTDOUBL+SEVEN  ENTRY IN RIGHT POSITION 45360000
         BL    RETURNA                  PREVIOUS ENTRY LESS, FINISHED   45430000
         SPACE 2                                                        45500000
         OI    AVTDOUBL+TWO,ORDERBIT    TRYING TO ARRANGE               45570000
         B     SWAPLOP2                 GO SWAP ENTRIES                 45640000
         SPACE 2                                                        45710000
CKPOS    EQU   *                                                        45780000
         SR    RENTRY,RLENGTH           BACK UP ONE                     45850000
         SR    RWORK,RLENGTH            ENTRY                           45920000
         B     ACTLOOP                  GO CHECK FOR CORRECT ORDER      45990000
         SPACE 2                                                        46060000
MACTIVE1 EQU   *                                                        46130000
         BCTR  RENTRY,ZERO              BACK UP TWO FOR EOT-FE          46200000
         BCTR  RWORK,ZERO                                               46270000
         MVC   AVTSAVE3+TWO(TWO),ZERO(RENTRY)  SAVE EOT-FE              46340000
         EX    RWORK1,MOVEACT1          MOVE TO ACTIVE                  46410000
         LR    RRET,RENTRY              RESET TO                        46480000
         ALR   RRET,RLENGTH               MOVE EOT-FE                   46550000
         MVC   ZERO(TWO,RRET),AVTSAVE3+TWO   RESET EOT-FE               46620000
         B     MACTIVE2                                                 46690000
         SPACE 2                                                        46760000
*        CHECK FOR GENERAL POLL ACTIVE. (TERMINAL ATTACHED VIA 3705)  * 46830000
         SPACE 2                                                        46900000
YES3705  EQU   *                                               @XM05658 46970000
         SR    ROFF,ROFF                                       @XM05658 46990000
         LH    ROFF,LCBTTCIN                                   @XM05658 47010000
         LR    R14,RTERM                                       @XM05658 47180000
         LA    R15,TRMPRFSZ             TRM PREFIX SIZE        @XM05658 47187000
         SR    R14,R15                  PREFIX ADDRESS         @XM05658 47194000
         CLI   TRMTYPE-IEDNTRM(R14),TRMCLUST IF CLUSTER        @XM05658 47201000
         BE    ISCLUS                         BRANCH           @XM05658 47208000
         TM    TRMBYTE0-IEDNTRM(R14),TRMGP   IF GP TERMINAL    @XM05658 47215000
         BZ    CHKSPEC                        DO NOT BRANCH    @XM05658 47222000
         TM    TRMBYTE2-IEDNTRM(R14),TRMGPACT IF GP IS ACTIVE  @XM05658 47229000
         BO    FINDCU                          BRANCH          @XM05658 47236000
CHKSPEC  TM    TRMBYTE2-IEDNTRM(R14),TRMRSACT IF TERMINAL IS   @XM05658 47250000
         BZ    RETDISP1                        INACTIVE,BRCH   @XM05658 47257000
         TM    TRMBYTE0-IEDNTRM(R14),TRMSNA   IF SNA TERMINAL  @XM05658 47264000
         BO    DACTSNA                         BRANCH          @XM05658 47271000
         TM    TRMBYTE0-IEDNTRM(R14),TRMINPUT IF CANNOT SEND   @XM05658 47278000
         BZ    RETDISP1                        DATA, BRANCH    @XM05658 47285000
         B     ISSPEC                 BRANCH TO SEND VARY CMD  @XM05658 47292000
FINDCU   L     R15,AVTRNMPT           LOAD TTE ADDR SEARCH RT  @XM05658 47299000
         OI    AVTDOUBL+TWO,CUSW      MUST SEND TERM VARY CMD  @XM05658 47306000
         LR    RWORK1,R1             SAVE POST LIST ENTRY ADDR @OY19464 47313000
         SR    R1,R1                 INSURE THAT HI BYTES ZERO @XM05658 47320000
NEXTCOH  LH    R1,TRMCOHRT-IEDNTRM(R14) LOAD COHORT TTCIN      @XM05658 47328000
         LR    ROFF,R1                STORE TTCIN              @XM05658 47336000
         BALR  R14,R15                GO GET TTE ADDR          @XM05658 47344000
         LR    R14,R1                 MOVE TTE ADDR            @XM05658 47352000
         LA    R1,TRMPRFSZ            GET PREFIX               @XM05658 47360000
         SR    R14,R1                  ADDR                    @XM05658 47368000
         CLI   TRMTYPE-IEDNTRM(R14),TRMCLUST HAS CLUSTER BEEN  @XM05658 47376000
         BNE   NEXTCOH                 FOUND? NO, BRANCH       @XM05658 47384000
         LR    R1,RWORK1               RESTORE POST LIST ADDR  @OY19464 47388000
ISCLUS   EQU   *                                               @XM05658 47392000
         BAL   R14,COMPTRMN           GET ADDR TO TERM NAME    @XM05658 47400000
         BAL   R14,BLANKS             STRIP BLANKS FROM NAME   @XM05658 47408000
         BAL   R14,PREFIX             SET UP BUFFER PREFIX     @XM05658 47416000
         BAL   R14,MOVEDATA           MOVE COMMAND INTO BUFFER @XM05658 47424000
         TM    AVTDOUBL+TWO,CUSW      IS TERM COMMAND NEEDED   @XM05658 47432000
         BNO   POSTIT                  NO, BRANCH              @XM05658 47440000
         ST    RBFR,AVTSAVE3          SAVE BUFFER ADDR         @XM05658 47448000
         LR    ROFF,RBFR                                       @XM05658 47456000
         L     RBFR,PRFLINK-ONE       GET NEXT BFR IN CHAIN    @XM05658 47464000
         MVC   PRFLINK-IEDQPRF(THREE,ROFF),PRFLINK CHAIN BUFF  @XM05658 47472000
ISSPEC   LH    ROFF,LCBTTCIN          GET TERMINAL TTCIN       @XM05658 47480000
         N     ROFF,AVTCLRHI          ZERO HI BYTES            @XM05658 47488000
         BAL   R14,COMPTRMN           GET TERMINAL NAME        @XM05658 47496000
         BAL   R14,BLANKS             STRIP BLANKS FROM NAME   @XM05658 47504000
         BAL   R14,PREFIX             SET UP BUFFER            @XM05658 47512000
         BAL   R14,MOVEDATA           MOVE COMMAND             @XM05658 47520000
         BAL   R14,POST               POST BUFFER              @XM05658 47528000
         TM    AVTDOUBL+TWO,CUSW      WAS CLUS CMD BUILT?      @XM05658 47536000
         BNO   CHCKINTV               NO, SEE IF INTV SPECIF'D @XM05658 47544000
         L     RBFR,AVTSAVE3          RESTORE ADDR OF CMD      @XM05658 47552000
POSTIT   BAL   R14,POST               POST BUFFER              @XM05658 47560000
         B     CHCKINTV               SEE IF INTV SPECIFIED    @XM05658 47568000
         SPACE 2                                                        48790000
*   THIS SUBROUTINE COMPUTES ADDRESS OF TERMNAME AND ALSO               48860000
*   COMPUTES LENGTH-1 OF NAME.  (THIS IS LATER USED FOR EX MVC)         48930000
         SPACE                                                          49000000
COMPTRMN EQU   *                                                        49070000
         LR    R0,RRET                  SAVE RETURN ADDRESS             49140000
         L     RTNT,AVTRNMPT            GET ADDR OF TRMNAME TABLE       49210000
         SR    RLENGTH,RLENGTH          CLEAR REG                       49280000
         IC    RLENGTH,TNTENLEN         GET LENGTH OF NAME FIELD        49350000
         LA    RWORK,THREE(,RLENGTH)   ADJUST ENTRY WITH LENGTH OF      49420000
*                                             ADDR. FIELD               49490000
         LR    RSAV,ROFF                SAVE TNT VALUE                  49560000
         BCTR  RSAV,ZERO                ADJUST TNT OFFSET BEFORE MULT   49630000
         MR    RSAV-ONE,RWORK           COMPUTE OFFSET WITHIN TABLE     49700000
         LA    RWORK,TNTFIRST(RSAV)     ADDR OF TERMNAME ENTRY          49770000
         LR    RRET,R0                  GET RETURN ADDRESS              49980000
         BR    RRET                     RETURN                          50050000
         SPACE                                                          50120000
BLANKS   EQU   *                                                        50190000
         LR    RWORK1,RWORK             MAKE SURE NAME IS NOT PADDED    50260000
         ALR   RWORK1,RLENGTH              WITH BLANKS                  50330000
TRYAGIN  EQU   *                                                        50400000
         BCTR  RLENGTH,ZERO             DECR. LENGTH                    50470000
         BCTR  RWORK1,ZERO              LOOK AT LAST BYTE OF NAME       50540000
         CLI   ZERO(RWORK1),AVTEBLNK    IS IT A BLANK?                  50610000
         BE    TRYAGIN                  LOOK AT NEXT ONE                50680000
         BR    RRET                                                     50750000
         SPACE 2                                                        50820000
PREFIX   EQU   *                                                        50890000
         ST    RRET,RRETSAVE            SAVE RETURN ADDRESS    @YM08502 50895000
         SR    RWORK1,RWORK1            CLEAR TO INSERT THE LEN@YM08412 50900000
         ICM   RWORK1,THREE,AVTKEYLE    GET THE UNIT SIZE      @YM08412 50910000
         BCTR  RWORK1,0                 DECREMENT FOR EX       @YM08412 50920000
         EX    RWORK1,CLRINSTR                 ZERO OUT BFR    @YM08412 50960000
         LA    RWORK1,AVTOPCOB          GET ADDR OF OP CTL QCB          51030000
         ST    RWORK1,PRFQCBA-ONE        PUT QCB ADDR INTO PREFIX       51100000
         ST    RLCB,PRFLCB-ONE          SET UP LCB ADDRESS              51170000
         OI    PRFLCB+TWO,POL01         SET BIT FOR SPECIAL CASE        51240000
         TM    AVTDOUBL+TWO,DEACTBIT    DEACT OR VARY?         @YM08412 51246000
         BNO   VARYLENG                 VARY,SKIP SETTING M LEN@YM08412 51252000
         L     RWORK,AVTTCB             GET THE TCB ADDRESS    @YM08528 51254000
         L     RWORK,TCBTIO-IEDQTCB(RWORK) GET THE JOBNAME     @YM08528 51256000
         LA    RLENGTH,EIGHT            LONGEST LENGTH POSSIBLE@YM09083 51258000
         BAL   RRET,BLANKS              STRIP BLANKS           @YM08528 51260000
         LR    RPOINT,RLENGTH           SAVE THE EXACT LENGTH  @YM08528 51262000
         LH    ROFF,LCBTTCIN            GET THE TNT INDEX      @YM08412 51264000
         N     ROFF,AVTCLRHI            CLEAR HIGH ORDER HALF  @YM08412 51270000
         BAL   RRET,COMPTRMN            GET THE TERMNAME       @YM08412 51276000
         BAL   RRET,BLANKS              STRIP BLANKS FROM NAME @YM08412 51282000
         LA    RWORK1,MCMDLEN+TWO(RLENGTH,RPOINT) COMPUTE TOTAL@YM09098 51288000
         B     PTTODATA                 READY TO COMPUTE OFFSET@YM08412 51294000
VARYLENG EQU   *                                               @YM08412 51300000
         LA    RWORK1,VARYLEN+ONE(,RLENGTH) COMPUTE LENGTH OF DATA      51310000
PTTODATA EQU   *                                               @YM08412 51340000
         LA    RWORK1,DATAOFF(,RWORK1)   COMPUTE LENGTH OF DATA         51380000
         STH   RWORK1,PRFSIZE           SET UP SIZE OF DATA IN PREFIX   51450000
         LH    MOVELEN,AVTKEYLE         GET LENGTH OF BFR UNIT          51520000
         MVC   PRFSCAN(TWO),HALF32      OFFSET INTO BFR FOR DATA        51660000
         CR    RWORK1,MOVELEN           COMPARE LENGTH OF DATA WITH     51730000
*                                         REMAINING SPACE               51800000
         BH    DELINK2                  GET ANOTHER BFR. UNIT           51870000
         LA    RPOINT,PRFLNGTH(,RBFR)   COMPUTE ADDR OF WHERE DATA STS  51940000
         MVI   PRFNBUNT,UNIT01          ONE UNIT BUFFER                 52010000
         MVI   PRFTIC,TIC08             SET UP TIC FIELD                52080000
         L     RRET,RRETSAVE            RESTORE RETURN ADDRESS @YM08502 52110000
         BR    RRET                     RETURN                          52150000
         SPACE 2                                                        52850000
MOVEDATA EQU   *                                               @XM05658 52857000
         MVC   ZERO(THREE,RPOINT),VARY  MOVE ' V ' INTO BFR    @XM05658 52864000
         LA    RPOINT,THREE(,RPOINT)    MOVE PTR TO NEXT FLD   @XM05658 52871000
         EX    RLENGTH,MOVENAME         MOVE TRM. NAME         @XM05658 52878000
         LA    RPOINT,ONE(RPOINT,RLENGTH) UPDATE POINTER       @XM05658 52885000
         MVC   ZERO(NINE,RPOINT),OFFTP  MOVE REST OF CMD       @XM05658 52892000
         SR    R15,R15                  SET GOOD RETRUN CODE   @XM05658 52899000
         BR    R14                      RETURN                 @XM05658 52906000
DELINK2  EQU   *                                                        52920000
         MVI   PRFNBUNT,UNIT02          TWO UNITS                       52990000
         LH    RWORK1,PRFSIZE           CORRECT SIZE BY SPACE LEFT      53060000
         ALR   RWORK1,MOVELEN              OVER IN LAST UNIT            53130000
         STH   RWORK1,PRFSIZE           RESTORE SIZE                    53200000
         LH    RWORK1,PRFSCAN           CORRECT SCAN PTR. BY SPACE      53270000
         ALR   RWORK1,MOVELEN              LEFT OVER IN LAST UNIT       53340000
         STH   RWORK1,PRFSCAN           RESTORE SCAN PTR.               53410000
         L     RPOINT,PRFLINK-ONE       GET NEXT BFR                    53480000
         ST    RPOINT,PRFTIC            LINK TWO UNITS TOGETHER         53550000
         MVI   PRFTIC,TIC08             SET UP TIC TO NEXT UNIT         53620000
         L     RWORK1,PRFLINK-ONE-IEDQPRF(RPOINT)  GET NEXT BFR         53690000
         ST    RWORK1,PRFLINK-ONE                                       53760000
         MVI   PRFTIC+THREE-IEDQPRF(RPOINT),TIC02  TIC IN SECOND UNIT   53830000
         MVI   PRFTIC-IEDQPRF(RPOINT),TIC08     SET UP TIC FIELD        53900000
         LA    RPOINT,TWELVE(,RPOINT)   POINT TO MSG. FIELD             53970000
         L     RRET,RRETSAVE            RESTORE RETURN ADDRESS @YM08502 54000000
         BR    RRET                     RETURN                          54040000
         SPACE 2                                                        54110000
*    THIS SECTION OF CODE PUTS A BUFFER ON A CHAIN TO                   54180000
*     LATER BE POSTED TO THE DISPATCHER.                                54250000
         SPACE                                                          54320000
POST     EQU   *                                                        54390000
         L     R0,PRFLINK-ONE                                           54460000
         ST    R1,PRFLINK-ONE           PUT OLD BUFFERS ON NEW ONE      54530000
         MVI   PRFPRI,PRIMHBFR          SET UP PRIORITY                 54600000
         LR    R1,RBFR                                                  54670000
         LR    RBFR,R0                  GET NEXT BFR ADDRESS            54740000
         BR    RRET                     RETURN                          54810000
         SPACE 2                                                        54880000
*   THE FOLLOWING SECTION OF CODE SETS UP BUFFERS FOR OPERATOR          54950000
*   CONTROL TO JUST PRINT A MESSAGE SAYING THAT THE TERMINAL            55020000
*   OR THE CONTROL UNIT HAS BEEN STOPPED.                               55090000
         SPACE 2                                                        55160000
*  FIX BUFFER FOR TERMINAL STOPPED                                      55230000
         SPACE                                                          55300000
GENMSG   EQU   *                                                        55370000
         XC    PRFSTAT1(ONE),PRFSTAT1   CLEAR FIELD                     55440000
         LA    RWORK1,AVTOPCOB          GET OPERATOR CONTROL QCB ADDR   55510000
         ST    RWORK1,PRFQCBA-ONE       PUT IT INTO PREFIX              55580000
         LH    ROFF,LCBTTCIN            GET TNT OFFSET                  55650000
         N     ROFF,AVTCLRHI            CLEAR HIGH PART                 55720000
         BAL   RRET,COMPTRMN            GET ADDR OF TRMNAME             55790000
         SPACE                                                          55860000
         BAL   RRET,BLANKS              STRIP BLANKS FROM TERMNAME      55930000
         SPACE                                                          56000000
         ST    RLCB,PRFLCB-ONE          SET UP LCB ADDRESS              56070000
         MVI   PRFNBUNT,UNIT01          SET NO. OF UNITS/BFR            56140000
         MVI   PRFTIC,TIC08             SET UP TIC FIELD                56210000
         OI    PRFLCB+TWO,POL02         SET SPECIAL BIT FOR MSG         56280000
         MVC   PRFCRCD-ONE(FOUR),MSG1A  GET MSG NO. FOR TERM.           56350000
         LA    RPOINT,PRFNHDR           WHERE TO MOVE NAME              56420000
         EX    RLENGTH,MOVENAME                                         56490000
         LA    RPOINT,ONE(RLENGTH,RPOINT)  POINT TO FIRST BYTE          56560000
*                                          AFTER NAME                   56630000
         BAL   RRET,PAD                 PAD NAME WITH BLANKS            56700000
         SPACE                                                          56770000
         BAL   RRET,POST                POST MSG BFR                    56840000
         TM    AVTDOUBL+TWO,CUSW        IS THERE A CONTROL UNIT         56910000
*                                          MSG TO PRINT                 56980000
         BNO   CHCKINTV                                                 57050000
         SPACE                                                          57120000
*   BUILD BUFFER FOR CONTROL UNIT                                       57190000
         SPACE                                                          57260000
         XC    PRFSTAT1(ONE),PRFSTAT1   CLEAR FIELD                     57330000
         LA    RWORK1,AVTOPCOB          GET OPERATOR CONTROL QCB ADDR   57400000
         ST    RWORK1,PRFQCBA-ONE       PUT IT INTO PREFIX              57470000
         LH    ROFF,AVTSAVE3            GET TNT INDEX FOR CU            57540000
         N     ROFF,AVTCLRHI            CLEAR HIGH                      57610000
         BAL   RRET,COMPTRMN            COMPUTE TRMNAME ADDRESS         57680000
         SPACE                                                          57750000
         BAL   RRET,BLANKS              STRIP BLANKS FROM TERMNAME      57820000
         SPACE                                                          57890000
         ST    RLCB,PRFLCB-ONE          SET UP LCB ADDRESS              57960000
         MVI   PRFNBUNT,UNIT01          SET NO. OF UNITS/BFR            58030000
         MVI   PRFTIC,TIC08             SET UP TIC FIELD                58100000
         OI    PRFLCB+TWO,POL02         SET SPECIAL BIT FOR MSG.        58170000
         MVC   PRFCRCD-ONE(FOUR),MSG90  GET MSG NO. FOR C.U.            58240000
         LA    RPOINT,PRFNHDR           WHERE TO MOVE NAME              58310000
         EX    RLENGTH,MOVENAME                                         58380000
         LA    RPOINT,ONE(RLENGTH,RPOINT)   POINT TO FIRST BYTE         58450000
*                                          AFTER NAAE                   58520000
         BAL   RRET,PAD                 PAD NAME WITH BLANKS            58590000
         SPACE                                                          58660000
         BAL   RRET,POST                POST BUFFER                     58730000
         SPACE                                                          58800000
         B     CHCKINTV                                                 58870000
         SPACE 2                                                        58940000
*   THE FOLLOWING SECTION OF CODE PADS THE TERMINAL NAME                59010000
*   WITH BLANKS TO MAKE IT 8 CHARACTERS LONG.                           59080000
         SPACE                                                          59150000
PAD      EQU   *                                                        59220000
         LA    RLENGTH,ONE(,RLENGTH)    INCR. LENGTH                    59290000
         CH    RLENGTH,HALF8            IS NAME 8 CHARACTERS?           59360000
         BER   RRET                     YES                             59430000
         MVI   ZERO(RPOINT),AVTEBLNK    PAD NAME WITH BLANKS            59500000
         LA    RPOINT,ONE(,RPOINT)                                      59570000
         B     PAD                                                      59640000
         SPACE                                                          59710000
VARYOFF  EQU   *                                                        59780000
         TM    INPFLAG,INPLINE          IS TARGET=LINE SPECIFIED?       59850000
         BO    MOVOFFC                  BR YES                          59920000
         SPACE                                                          59990000
MOVOFFB  EQU   *                                                        60060000
         L     RDCB,LCBDCBPT            GET LCB OR DCB ADDRESS @OY12413 60130000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80      3705 TERM     @OY12413 60200000
         BNO   VARYOFF1                 BRANCH IF NO           @OY12413 60270000
         LR    R14,RTERM                                       @Y17XAMG 60340000
         LA    R15,TRMPRFSZ             TRM PREFIX SIZE        @Y17XAMG 60410000
         SR    R14,R15                  TRM PREFIX ADDRESS     @Y17XAMG 60480000
         TM    TRMBYTE2-IEDNTRM(R14),TRMRSACT   TERM INACTIVE? @Y17XAMG 60550000
*                                        FOR SPEC POLL         @OY12413 60620000
         BZ    RETDISP1                 YES BR                 @OY12413 60690000
         TM    TRMBYTE0-IEDNTRM(R14),TRMSNA      SNA?          @Y17XARR 60710000
         BO    DACTSNA                  YES,REQUEST DEACT      @Y17XARR 60730000
VARYOFF1 EQU   *                                               @OY12413 60760000
         OI    AVTDOUBL+TWO,OFFBBIT     SET UP FOR INTVL IF NEEDED      60830000
         LH    ROFF,LCBTTCIN            GET TNT INDEX TO FIND           60900000
         BAL   RRET,COMPTRMN              TRMNAME                       60970000
         SPACE                                                          61040000
         BAL   RRET,BLANKS              STRIP BLANKS FROM TERMNAME      61110000
         SPACE                                                          61180000
         BAL   RRET,PREFIX              SET UP BFR PREFIX               61250000
         SPACE                                                          61320000
         MVC   ZERO(THREE,RPOINT),VARY  MOVE ' V ' CMD INTO BFR         61390000
         LA    RPOINT,THREE(,RPOINT)    MOVE PTR. TO NEXT FIELD         61460000
         EX    RLENGTH,MOVENAME         MOVE TRM. NAME INTO BFR         61530000
         LA    RPOINT,ONE(RPOINT,RLENGTH)   UPDATE PTR.                 61600000
         MVC   ZERO(NINE,RPOINT),OFFTPB   MOVE CMD INTO BFR             61670000
         BAL   RRET,POST                GO POST BFR                     61740000
         SR    R15,R15                  CLEAR REG                       61810000
         B     CHCKINTV                 CHECK INTERVAL SPECIFIED        61880000
         SPACE                                                          61950000
DACTSNA  EQU   *                                               @Y17XARR 61953000
         OI    AVTDOUBL+TWO,DEACTBIT    SET FOR INTERVAL       @Y17XARR 61956000
         BAL   RRET,PREFIX              SETUP BFR PREFIX       @Y17XARR 61968000
         MVC   ZERO(THREE,RPOINT),MODIFY MOVE CMD INTO BFR     @Y17XARR 61971000
         LA    RPOINT,THREE(,RPOINT)    BUMP PASSED THE CMD    @Y17XARR 61974000
         L     RWORK,AVTTCB             GET THE TCB ADDRESS    @Y17XARR 61980000
         L     RWORK,TCBTIO-IEDQTCB(RWORK)  GET JOBNAME        @Y17XARR 61981000
         LA    RLENGTH,EIGHT            GET MAX LENGTH         @YM08528 61982000
         BAL   RRET,BLANKS              STRIP BLANKS           @YM08528 61984000
         EX    RLENGTH,MOVENAME         MOVE JOBNAME           @YM08528 61986000
         LA    RPOINT,ONE(RLENGTH,RPOINT) BUMP PASSED JOBNAME  @YM08528 61988000
         MVC   ZERO(SEVEN,RPOINT),DEACT MOVE IN MODIFY CMD TYPE@Y17XARR 61992000
         LA    RPOINT,SEVEN(,RPOINT)    BUMP PASSED M CMD TYPE @Y17XARR 61995000
         LH    ROFF,LCBTTCIN            GET THE TNT INDEX      @Y17XARR 61995600
         N     ROFF,AVTCLRHI            CLEAR HIGH ORDER HALF  @YM08412 61996200
         BAL   RRET,COMPTRMN            GET THE TERMNAME       @Y17XARR 61996800
         BAL   RRET,BLANKS              STRIP BLANKS FROM NAME @Y17XARR 61997400
         EX    RLENGTH,MOVENAME         MOVE RESOURCE NAME     @Y17XARR 61998000
         LA    RPOINT,ONE(RLENGTH,RPOINT) BUMP PASSED RESOURCE @Y17XARR 62001000
         MVI   ZERO(RPOINT),AVTEBLNK    MOVE IN A DELIMITER    @YM09009 62003000
         LA    RPOINT,ONE(RPOINT)       BUMP PASSED THE BLANK  @YM09009 62005000
         BAL   RRET,POST                POST THE BFR           @Y17XARR 62007000
         SR    R15,R15                  ZERO RETCDE            @Y17XARR 62010000
         B     CHCKINTV                 CHECK INTERVAL SPECIFID@Y17XARR 62013000
MOVOFFC  EQU   *                                                        62020000
         OI    AVTDOUBL+TWO,OFFCBIT     SET UP FOR INTV IF NEEDED       62090000
         L     RDCB,LCBDCBPT            GET DCB ADDR.                   62160000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80  IS THIS 3705 TERM.?        62230000
         BO    FINDGRP                  YES, FIND GROUP NAME            62300000
         SPACE                                                          62370000
         LA    RLENGTH,TWO              GET LENGTH-1 OF LINE NO.        62440000
         BAL   RRET,PREFIX              SET UP BFR PREFIX               62510000
         SPACE                                                          62580000
         BAL   RRET,FINDUCB             FIND UCB ADDRESS                62650000
         SPACE                                                          62720000
         USING    UCBOB,RDCB            SET UP DSECT                    62790000
         SPACE                                                          62860000
         MVC   ZERO(THREE,RPOINT),VARY  MOVE ' V ' CMD INTO BFR         62930000
         LA    RPOINT,THREE(,RPOINT)    MOVE PTR TO NEXT FIELD          63000000
         MVC   ZERO(THREE,RPOINT),UCBNAME  GET LINE NUMBER              63070000
         B     ENDPROC                                                  63140000
         SPACE 2                                                        63210000
FINDGRP  EQU   *                                                        63280000
         LA    RWORK,DCBDDNAM-IHADCB(RDCB)   GET ADDR OF GRPNAME        63350000
         LA    RLENGTH,EIGHT            GET LENGTH OF NAME              63420000
         BAL   RRET,BLANKS              STRIP BLANKS FROM GRPNAME       63490000
         SPACE                                                          63560000
         LA    RLENGTH,FOUR(,RLENGTH)   INCR FOR ',RLN'                 63630000
         BAL   RRET,PREFIX              SET UP BFR PREFIX               63700000
         MVC   ZERO(THREE,RPOINT),VARY  MOVE ' V ' CMD INTO BFR         63770000
         LA    R0,FOUR                  PUT 4 INTO R0                   63840000
         SR    RLENGTH,R0               ADJUST TO LENGTH-1 OF TRMN      63910000
         LA    RPOINT,THREE(,RPOINT)    MOVE PTR TO NEXT FIELD          63980000
         EX    RLENGTH,MOVENAME         MOVE GRPNAME INTO BFR           64050000
         ST    RPOINT,AVTSAVE3+SIXTEEN  SAVE ADDR OF GRPNAME FOR        64120000
*                                         INTVL IF NECESSARY            64190000
         STC   RLENGTH,AVTSAVE3+SIXTEEN   SAVE LENGTH OF GRPNAME        64260000
         LA    RPOINT,ONE(RLENGTH,RPOINT)  POINT TO FIELD AFTER NAME    64330000
         MVC   ZERO(ONE,RPOINT),OFFTPC   MOVE IN COMMA                  64400000
         LA    RPOINT,ONE(,RPOINT)      MOVE POINTER ONE MORE           64470000
         LH    ROFF,LCBTTCIN            GET TNT INDEX                   64540000
         N     ROFF,AVTCLRHI            CLEAR HIGH ORDER PART           64610000
         BAL   RRET,COMPTRMN            GET ADDR OF TERM ENTRY          64680000
         SPACE                                                          64750000
         ALR   RWORK,RLENGTH            POINT TO QCB ADDRESS            64820000
         MVC   AVTDOUBL+FIVE(THREE),0(RWORK)   GET TRM ADDR             64890000
         L     RWORK,AVTDOUBL+FOUR      PUT TRM ADDR INTO REG           64960000
         L     RWORK,TRMDESTQ-ONE-IEDQTRM(RWORK)                        65030000
         SR    RWORK1,RWORK1            CLEAR REG FOR IC                65100000
         IC    RWORK1,QCBRELLN-IEDQQCB(RWORK)  GET REL. LINE NO.        65170000
         CVD   RWORK1,AVTSAVE3+EIGHT    CONVERT REL LINE NO. TO DEC.    65240000
         UNPK  ZERO(THREE,RPOINT),AVTSAVE3+FOURTEEN(TWO)                65310000
         OI    TWO(RPOINT),MASKF0       FIX ZONE FOR LAST DIGIT         65380000
         SPACE                                                          65450000
ENDPROC  EQU   *                                                        65520000
         LA    RPOINT,THREE(,RPOINT)    UPDATE POINTER                  65590000
         MVC   ZERO(NINE,RPOINT),OFFTPC  MOVE IN COMMAND                65660000
         BAL   RRET,POST                POST BFR                        65730000
         SPACE                                                          65800000
         B     CHCKINTV                 SEE IF INTV SPECIFIED           65870000
         SPACE                                                          65940000
FINDUCB  EQU   *                                                        66010000
         SR    R15,R15                  CLEAR FOR IC                    66080000
         IC    R15,LCBUCBX                                              66150000
         SLL   R15,TWO                  MULTIPLY BY FOUR                66220000
         L     RDCB,DCBDEBAD-IHADCB(,RDCB)                              66290000
         L     RDCB,DEBUCBAD-DEBNMSUB(R15,RDCB)                         66360000
         LR    RWORK1,RDCB              SAVE UCB ADDR.                  66430000
         BR    RRET                     RETURN                          66500000
         SPACE 2                                                        66570000
*   THE FOLLOWING SECTION OF CODE CHECKS TO SEE IF THE                  66640000
*   INTERVAL OPTION IS SPECIFIED.                                       66710000
         SPACE                                                          66780000
CHCKINTV EQU   *                                                        66850000
         L     ROFF,AVTSAVE3+TWENTY4    GET ADDR OF PARM LIST           66920000
         TM    INPFLAG,INPINVL          IS INTERVAL SPECIFIED           66990000
         BZ    RETDISP2                                                 67060000
         SPACE                                                          67130000
*   BUILD TIME DELAY QUEUE ELEMENT                                      67200000
         SPACE                                                          67270000
         MVI   PRFNBUNT,EIGHT           SET UP OFFSET FOR TIME DELAY    67340000
         IC    R9,INPLEN                GET LENGTH OF PARMLIST          67410000
         LA    RWORK,ENDACT             LOAD FE INTO WORK REG.          67480000
         NR    R9,RWORK                 MAKE SURE LENGTH IS EVEN        67550000
         LA    RWORK,TWO                LOAD 2 INTO WORK REG            67620000
         SR    R9,RWORK                 GET TO INTERVAL OPTION FIELD    67690000
         LH    R9,INPIND(R9)            R9 NOW CONTAINS HWD INTVL       67760000
         STH   R9,PRFSRCE               SET UP PREFIX FOR TIME          67830000
*                                          DELAY QUEUE                  67900000
         MVI   PRFSIZE,EIGHT                                            67970000
         LA    R9,QCBNAME                                               68040000
         ST    R9,PRFTIC                                                68110000
         MVI   PRFPRI,PRIRELSE          SET PRIORITY                    68180000
         TM    AVTDOUBL+TWO,OFFCBIT     WAS OFFTP,C SPECIFIED?          68250000
         BNO   GETNDX                                                   68320000
         SPACE                                                          68390000
         MVI   PRFTIC,OFFCBIT           SET OFFTP,C BIT                 68460000
         L     RDCB,LCBDCBPT            GET DCB ADDR.                   68530000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80  IS THIS A 3705 TERM?       68600000
         BO    MOVERLN                  YES                             68670000
         SPACE                                                          68740000
         LA    RLENGTH,THREE            GET LINE NO. INSTEAD OF TERM    68810000
         LA    RWORK,UCBNAME-UCBOB(,RWORK1) ADDRESS OF LINE NO.         68880000
         B     CONTIN                                                   68950000
         SPACE                                                          69020000
MOVERLN  EQU   *                                                        69090000
         SR    RLENGTH,RLENGTH          CLEAR FOR IC                    69160000
         IC    RLENGTH,AVTSAVE3+SIXTEEN  GET LENGTH-1 OF GRPNAME        69230000
         LA    RLENGTH,FIVE(,RLENGTH)   ADD 5 FOR ',RLN' & ADJUST       69300000
*                                          LENGTH BY ONE                69370000
         L     RWORK,AVTSAVE3+SIXTEEN   GET ADDR OF GRPNAME,RLN         69440000
         B     CONTIN                                                   69510000
         SPACE                                                          69580000
GETNDX   EQU   *                                                        69650000
         LH    ROFF,LCBTTCIN            GET TNT INDEX                   69720000
         BAL   RRET,COMPTRMN            COMPUTE TERMNAME ADDRESS        69790000
         SPACE                                                          69860000
         BAL   RRET,BLANKS              STRIP BLANKS FROM TERMNAME      69930000
         SPACE                                                          70000000
         LA    RLENGTH,ONE(,RLENGTH)    STORE CORRECT LENGTH            70070000
         TM    AVTDOUBL+TWO,OFFBBIT     WAS CMD OFFTP,B?                70140000
         BNO   CONTINUE                 NO, THEN MUST BE OFFTP,E        70210000
*                                       (NO BIT IS SET FOR OFFTP,E)     70280000
         SPACE                                                          70350000
         MVI   PRFTIC,OFFBBIT           SET BIT FOR ONTP LATER          70420000
CONTINUE EQU   *                                                        70430000
         TM    AVTDOUBL+TWO,DEACTBIT    DEACT?                 @Y17XARR 70440000
         BNO   CONTIN                   NO CONTINUE            @Y17XARR 70450000
         MVI   PRFTIC,DEACTBIT          SET ACTIV LATER        @Y17XARR 70460000
         SPACE                                                          70490000
CONTIN   EQU   *                                                        70560000
         STC   RLENGTH,PRFSIZE+ONE                                      70630000
         LA    RPOINT,PRFNHDR                                           70700000
         BCTR  RLENGTH,ZERO             DECR FOR EXECUTE                70770000
         EX    RLENGTH,MOVENAME         MOVE TERMINAL NAME              70840000
*   CODE MAY BE ADDED LATER TO SAVE CONTROL UNIT ADDRESS INSTEAD        70910000
*   OF TERMNAME.  IN THAT CASE A ZERO WILL BE STORED AT PRFSIZE+1       70980000
*   TO INDICATE CONTROL UNIT ADDRESS                                    71050000
         SPACE                                                          71120000
         ST    R1,AVTDOUBL              SAVE CHAIN OF ELEMS             71190000
         LR    R1,RBFR                  GET ADDR OF TIME DELAY QELEM    71260000
         L     RBFR,PRFLINK-1           GET NEXT BFR ADDR               71330000
         XC    PRFLINK-IEDQPRF(THREE,R1),PRFLINK-IEDQPRF(R1)            71400000
         L     R15,AVTHG01              GET READY TO PLACE ELEM.        71470000
         LA    RAVT,AVTSAVE3               ON TIME DELAY QUEUE          71540000
         BALR  R14,R15                                                  71610000
         SPACE                                                          71680000
         SH    RAVT,HALF48              RESTORE REG 13                  71750000
         SR    R15,R15                  CLEAR R15                       71820000
         L     R1,AVTDOUBL              RESTORE R1                      71890000
         B     RETDISP2                 RETURN                          71960000
         SPACE 2                                                        72030000
*    RETURN TO THE DISPATCHER                                           72100000
         SPACE                                                          72170000
RETDISP  EQU   *                                                        72240000
         SR    RBFR,RBFR                CLEAR REG                       72310000
         SPACE                                                          72380000
RETDISP1 EQU   *                                                        72450000
         L     R1,AVTSAVE3+TWENTY       RESTORE POST LIST               72520000
         SPACE                                                          72590000
RETDISP2 EQU   *                                                        72660000
         LA    RBFR,ZERO(,RBFR)         ZERO HIGH ORDER BYTE            72730000
         LTR   RBFR,RBFR                ANY BUFFERS TO REMOVE           72800000
         BZ    NOXTRAS                    BRANCH NO                     72870000
         SPACE                                                          72940000
         SR    R14,R14                  CLEAR                           73010000
         LR    R0,RBFR                  SAVE FIRST UNIT ADDRESS         73080000
         SPACE                                                          73150000
NEXTRET  EQU   *                                                        73220000
         CLC   PRFLINK,AVTFZERO         END OF CHAIN                    73290000
         BE    RETFND                     BRANCH YES                    73360000
         SPACE                                                          73430000
         L     RBFR,PRFLINK-1           NEXT UNIT                       73500000
         BCT   R14,NEXTRET                COUNT UNITS AND BRANCH        73570000
         SPACE                                                          73640000
RETFND   EQU   *                                                        73710000
         MVC   PRFLINK,AVTBFREB+1       ADD UNITS TO AVAILABLE CHAIN    73780000
         ST    R0,AVTBFREB              RETURN UNITS                    73850000
         LH    R0,AVTAVFCT              AVAILABLE COUNT                 73920000
         N     R0,AVTCLRHI              CLEAR HIGH ORDER BYTE           73990000
         BCTR  R14,ZERO                 DECREMENT R14                   74060000
         LPR   R14,R14                  CONVERT TO POSITIVE             74130000
         ALR   R0,R14                   ADD NUMBER RETURNED             74200000
         STH   R0,AVTAVFCT              STORE UPDATED COUNT             74270000
         DROP  RLCBX                                           @OS77950 74290000
         USING IEDQDISP,RDISP                                  @OS77950 74310000
NOXTRAS  EQU   *                                                        74340000
         L     RDISP,AVTEA              RESTORE DISPATCHER ADDRESS      74410000
         LTR   RBASE,RBASE              CHECK ENTRY                     74480000
         BNP   NEXTEL                     ENTRY FROM IEDQBD -  @Y17XAMX 74550000
         BAL   R14,DSPCHAIN                                    @Y17XAMX 74580000
*                                       RETURN IS TO DISPATCHER         74620000
NEXTEL   EQU   *                                                        74690000
         LTR   R1,R1                    IS THERE ANOTHER ELEMENT        74760000
         BZ    GOTOUI                   NOTHING ON ELEM. CHAIN          74830000
         L     R9,FOUR(,R1)             NEXT ELEMENT ADDRESS            74900000
         BAL   R14,DSPPOSTR             INSERT ELEMENT ON READY Q       74970000
         SPACE                                                          75040000
         LA    R1,0(,R9)                CLEAR HIGH ORDER BYTE           75110000
         B     NEXTEL                   POST ANOTHER ELEMENT            75180000
         SPACE                                                          75250000
GOTOUI   EQU   *                                                        75320000
         L     RBASE,AVTUI              RETURN IS TO IEDQUI             75390000
         L     RAVT,AVTPARM             RESTORE SAVE AREA ADDRESS       75460000
         B     FOUR(,RBASE)               RETURN TO IEDQUI              75530000
GETBFR   EQU   *                                                        75600000
         LH    R0,AVTAVFCT              AVAILABLE UNIT COUNT            75670000
         N     R0,AVTCLRHI              ACCOUNT FOR 32K+                75740000
         SR    R0,R15                   DECREMENT COUNT                 75810000
         LA    RBFR,AVTBFREB-FOUR       SET FOR FIRST TIME              75880000
*        CONSTANTS                                                      75950000
NEXTBF   EQU   *                                                        76020000
         L     RBFR,PRFLINK-1           NEXT UNIT                       76090000
         LA    RBFR,0(,RBFR)            CLEAR HI BYTE                   76160000
         LTR   RBFR,RBFR                OUT OF UNITS                    76230000
         BZ    SETRT                      YES, SET RET CODE TO 12       76300000
         SPACE                                                          76370000
         XC    PRFSTAT1(ONE),PRFSTAT1   CLEAR FIELD                     76440000
         BCT   R15,NEXTBF               LOOP TILL ALL OBTAINED          76510000
         SPACE                                                          76580000
         STH   R0,AVTAVFCT              STORE NEW COUNT                 76650000
         L     R0,AVTBFREB              FIRST UNIT ADDRESS              76720000
         MVC   AVTBFREB+1(THREE),PRFLINK  DELINK UNITS                  76790000
         XC    PRFLINK-ONE(FOUR),PRFLINK-ONE ZERO LINK FIELD OF BFR     76860000
*                                         BUFFER ON THE CHAIN           76930000
         LR    RBFR,R0                  FIRST UNIT ADDRESS TO RBFR      77000000
         BR    RRET                                                     77070000
         SPACE                                                          77140000
SETRT    EQU   *                                                        77210000
         LA    R15,TWELVE               SET RET CODE (NOT ENOUGH BFRS)  77280000
         BR    RRET                     RETURN                          77350000
         SPACE 2                                                        77420000
*   SUBTASK FOR TIME DELAY QUEUE                                        77490000
         SPACE                                                          77560000
         DS    0F                       START ON FULLWORD BDY.          77630000
QCBNAME  EQU   *-8                      DUMMY QCB                       77700000
STCB     DC    AL1(DSPMCPL4)                                            77770000
         DC    AL3(STCB)                                                77840000
ROUTINE  EQU   *                                                        77910000
         USING ROUTINE,R15                                              77980000
         L     RBASE,BASE                                               78050000
         DROP  R15                                                      78120000
         USING IEDQBI,RBASE                                             78190000
         LR    RBFR,R1                                                  78260000
         MVC   AVTDOUBL(ONE),PRFTIC     SAVE TP INDICATOR               78820000
         SR    RLENGTH,RLENGTH          CLEAR REG                       78825000
         IC    RLENGTH,PRFSIZE+1        GET LENGTH                      78830000
*                                          OF TERMNAME                  78835000
         LA    RWORK1,VARYLEN-1(,RLENGTH)  COMPUTE LEN OF DATA @YM08412 78840000
         TM    AVTDOUBL,DEACTBIT        DEACT OR VARY          @YM08412 78845000
         BNO   COMPUTE                  VARY                   @YM08412 78850000
         LA    RWORK1,MCMDLEN+1(,RLENGTH) MODIFY LEN- JOBNME L @YM09098 78855000
         SR    RPARM,RPARM               CLEAR TO SAVE TERMNAME@YM09098 78855400
         IC    RPARM,PRFSIZE+ONE         PICKUP TERMNAME LENGTH@YM09098 78855800
         LR    RPOINT,RWORK1             SAVE THE LEN-JOBNAME L@YM09098 78856200
         L     RWORK,AVTTCB              GET THE TCAM TCB ADDR @YM09098 78856600
         L     RWORK,TCBTIO-IEDQTCB(RWORK) GET JOBNAME PTR     @YM09098 78857000
         LA    RLENGTH,EIGHT             MAXIMUM LENGTH        @YM09098 78857400
         BAL   RRET,BLANKS               GET TOTAL LENGTH-1    @YM09098 78857800
         LA    RLENGTH,ONE(,RLENGTH)     GET TOTAL LENGTH      @YM09098 78858200
         LR    RWORK1,RPOINT             RESTORE LEN-JOBNME L  @YM09098 78858600
         ALR   RWORK1,RLENGTH            GET THE TOTAL LENGTH  @YM09098 78859000
COMPUTE  EQU   *                                               @YM08412 78860000
         LA    RWORK1,DATAOFF(,RWORK1)                                  78865000
         LH    MOVELEN,AVTKEYLE         GET LENGTH OF BFR UNIT          78870000
         SH    MOVELEN,HALF32                                           78875000
         ST    RLCB,PRFLCB-ONE          SAVE LCB ADDRESS                78890000
         MVI   PRFNBUNT,UNIT01          SET UP NO. OF UNITS/BFR         78960000
         MVI   PRFTIC,TIC08             SET UP TIC FIELD                79030000
         CR    RWORK1,MOVELEN           COMPARE LENGTH                  79100000
*                                         OF DATA WITH SPACE IN BFR     79170000
         BH    BUF3                                                     79240000
         LA    RPOINT,PRFLNGTH(,RBFR)   COMPUTE ADDR OF WHERE DATA      79310000
*                                          STARTS                       79380000
         MVC   PRFSCAN(TWO),HALF32      SET SCAN POINTER                79450000
         SPACE                                                          79520000
MOVEIT   EQU   *                                                        79590000
         XC    PRFLINK,PRFLINK          CLEAR LINK FIELD                79660000
         OI    PRFLCB+TWO,POL01         SET SPECIAL BIT                 79730000
         STH   RWORK1,PRFSIZE           SET UP SIZE OF DATA IN          79800000
*                                          PREFIX                       79870000
         LA    RWORK1,AVTOPCOB          GET ADDR OF OP CTL QCB          79940000
         ST    RWORK1,PRFQCBA-1         PUT QCB ADDR INTO PREFIX        80010000
         MVI   PRFPRI,PRIMHBFR          SET PRIORITY TO 'E4'            80080000
         TM    AVTDOUBL,DEACTBIT        DEACT?                 @Y17XARR 80085000
         BNO   VARYCMD                  NO, VARY               @Y17XARR 80090000
         MVC   ZERO(THREE,RPOINT),MODIFY  SET CMD              @Y17XARR 80095000
         LA    RPOINT,THREE(,RPOINT)    POINT PASSED THE CMD   @Y17XARR 80100000
         L     RWORK,AVTTCB             GET TCB ADDR           @Y17XARR 80105000
         L     RWORK,TCBTIO-IEDQTCB(RWORK)   GET JOBNAME       @Y17XARR 80107000
         LA    RLENGTH,EIGHT            MAX LENGTH             @YM08528 80109000
         BAL   RRET,BLANKS              STRIP BLANKS           @YM08528 80113000
         EX    RLENGTH,MOVENAME         MOVE THE JOBNAME       @YM08528 80117000
         LA    RPOINT,ONE(RLENGTH,RPOINT) BUMP PASSED THE NAME @YM08528 80121000
         MVC   ZERO(SEVEN,RPOINT),ACTIV SET MODIFY CMD         @Y17XARR 80125000
         LA    RPOINT,SEVEN(,RPOINT)    POINT PASSED THE CMD   @YM09098 80130000
         LR    RLENGTH,RPARM            RESTORE TERMNAME       @YM09098 80131000
*                                       LENGTH              @YM09098    80132000
         B     MOVENME                  READY TO MOVE THE NAME @Y17XARR 80135000
VARYCMD  EQU   *                                               @Y17XARR 80140000
         MVC   0(THREE,RPOINT),VARY     MOVE 'VARY' CMD        @Y17XARR 80150000
         LA    RPOINT,THREE(,RPOINT)    MOVE PTR. TO NEXT FIELD@Y17XARR 80190000
MOVENME  EQU   *                                               @Y17XARR 80230000
         LA    RWORK,PRFNHDR            GET ADDR OF NAME                80290000
         BCTR  RLENGTH,ZERO             DECR. FOR EXECUTE               80360000
         EX    RLENGTH,MOVENAME         MOVE NAME                       80430000
         ALR   RPOINT,RLENGTH                                           80500000
         LA    RPOINT,ONE(,RPOINT)                                      80570000
         TM    AVTDOUBL,DEACTBIT        DEACT                  @Y17XARR 80590000
         BNO   CKOFFTPC                 CHECK OFFTP,C          @YM09009 80610000
         MVI   ZERO(RPOINT),AVTEBLNK    SET DELIMITER          @YM09009 80617000
         B     NEXT4                    POST THE BUFFER        @YM09009 80624000
CKOFFTPC EQU   *                                               @YM09009 80631000
         TM    AVTDOUBL,OFFCBIT         WAS OFFTP,C SPECIFIED?          80640000
         BNO   NEXT1                    NO                              80710000
         SPACE                                                          80780000
         MVC   ZERO(SIX,RPOINT),ONTP    SET UP CMD FOR ONTP             80850000
         B     NEXT4                                                    80920000
         SPACE                                                          80990000
NEXT1    EQU   *                                                        81060000
         TM    AVTDOUBL,OFFBBIT         WAS OFFTP,B SPECIFIED?          81130000
         BNO   NEXT2                    NO                              81200000
         SPACE                                                          81270000
         MVC   ZERO(EIGHT,RPOINT),ONTPB  SET UP CMD FOR ONTP,B          81340000
         B     NEXT4                                                    81410000
         SPACE                                                          81480000
NEXT2    EQU   *                                                        81550000
         MVC   0(EIGHT,RPOINT),ONTPE    MOVE CMD ONTP,E INTO BFR        81620000
         SPACE                                                          81690000
NEXT4    EQU   *                                                        81760000
         LR    R1,RBFR                  SET UP                          81830000
         L     RDISP,AVTEA              GET DISPATCHER'S BASE ADDR      81900000
         BAL   R14,DSPCHAIN                 RETURN             @Y17XAMX 81970000
         SPACE                                                          82040000
BUF3     EQU   *                                                        82110000
         LR    R1,RBFR                  PUT BFR BACK ON QUEUE TO        82180000
*                                          WAIT UNTIL A BFR IS FREE     82250000
         LA    R15,ONE                  GET ADDR OF AVAIL BFR           82320000
         BAL   RRET,GETBFR              GET A BUFFER                    82390000
         LTR   R15,R15                  WAS THERE A BUFFER              82460000
         BZ    REMOVE                   YES                             82530000
         LR    RBFR,R1                  RESTORE BFR POINTER    @OZ25852 82540000
         L     RDISP,AVTEA              GET DISPATCHER'S BASE ADDR      82600000
         MVI   PRFPRI,PRISYSDT          NO BUFFERS AVAILABLE,  @OY12681 82670000
*                                        LOWER PRIORITY        @OY12681 82740000
         BAL   R14,DSPPOST         WAIT UNTIL A BFR IS FREE    @Y17XAMX 82810000
REMOVE   EQU   *                                                        82880000
         AR    RWORK1,MOVELEN                                           82950000
         XC    EIGHT(CLEAR,RBFR),EIGHT(RBFR)  CLEAR PART OF PREFIX      83020000
         LR    RPOINT,RBFR                                              83090000
         LR    RBFR,R1                  RESTORE BUFFER POINTER          83160000
         ST    RPOINT,PRFTIC            LINK UNITS TOGETHER             83230000
         MVI   PRFTIC,TIC08             SET UP TIC FIELD                83300000
         MVI   PRFTIC+THREE-IEDQPRF(RPOINT),TIC02  TIC IN SECOND UNIT   83370000
         MVI   PRFTIC-IEDQPRF(RPOINT),TIC08  SET UP TIC FIELD           83440000
         MVI   PRFNBUNT,UNIT02          SET UP NO. OF UNITS/BFR         83510000
         LA    MOVELEN,DATAOFF(,MOVELEN)  COMPUTE SCAN PTR              83580000
         STH   MOVELEN,PRFSCAN          SET SCAN PTR                    83650000
         LA    RPOINT,TWELVE(,RPOINT)                                   83720000
         B     MOVEIT                                                   83790000
         SPACE 2                                                        83860000
*      CONSTANTS & DATA                                                 83930000
         SPACE                                                          84000000
         DS    0F                                                       84070000
SPMASK   DC    X'80000000'              MASK FOR IEDQUI ENTRY           84140000
HALF48   DC    X'0048'                  HALFWORD 48                     84700000
HALF2    DC    H'2'                     HALFWORD OF 2                   84770000
HALF32   DC    H'32'                    HALFWORD OF 32                  84840000
HALF8    DC    H'8'                     HALFWORD OF 8                   84910000
TRMPREFL DC    A(TRMPRFSZ)              PREFIX LENGTH OF TRM   @Y17XARR 84913000
VARY     DC    C' V '                   VARY COMMAND                    84916000
MODIFY   DC    C' F '                   MODIFY COMMAND         @Y17XARR 84922000
ACTIV    DC    C',ACTIV='               ACTIV COMMAND          @Y17XARR 84928000
DEACT    DC    C',DEACT='               DEACT COMMAND          @Y17XARR 84934000
OFFTPB   DC    C',OFFTP,B '             END OF VARY COMMAND             84940000
OFFTPC   DC    C',OFFTP,C '             END OF VARY COMMAND             84946000
OFFTP    DC    C',OFFTP,E '             END OF VARY COMMAND             84952000
ONTP     DC    C',ONTP '                END OF VARY COMMAND             84958000
ONTPB    DC    C',ONTP,B '              END OF VARY COMMAND             84964000
ONTPE    DC    C',ONTP,E '              END OF VARY COMMAND             84970000
X7F7F    DC    X'7F7F'                  CONTROL UNIT CHARS. FOR 3270    84980000
X2222    DC    X'2222'                  CONTROL UNIT CHARS FOR ASCII    85050000
MSGLEN   DC    H'56'                    MAXIMUM LENGTH OF DATA @YM08502 85120000
MSG1A    DC    X'001A0000'              MSG NO. FOR TERMINAL STOPPED    85190000
MSG90    DC    X'00900000'              MSG NO. FOR CU STOPPED          85260000
BASE     DC    A(IEDQBI)                ESTABLISH ADDRESSABILITY        85330000
RRETSAVE DC    F'0'                     REG 14 SAVEAREA        @YM08502 85360000
MOVENAME MVC   ZERO(ZERO,RPOINT),ZERO(RWORK)            MOVE TRM NAME   85400000
SWAP1    XC    ONE(ZERO,RWORK),ONE(RENTRY)    SWAP TWO                  85470000
SWAP2    XC    ONE(ZERO,RENTRY),ONE(RWORK)    SUCCESSIVE ENTRIES        85540000
MOVACT   MVC   ZERO(ZERO,RENTRY),ONE(RENTRY)   MOVE ENTRY               85610000
MOVEACT1 MVC   ZERO(ZERO,RENTRY),TWO(RENTRY)   MOVE ENTRY               85680000
CLRINSTR XC   TWELVE(ZERO,RBFR),TWELVE(RBFR) CLEAR BUFFER      @YM08412 85750000
*        DSECTS                                                       * 85820000
         EJECT                                                          85890000
INPARM   DSECT                                                          85960000
INPIND   DS    AL1                      INDEX TO IEDQBI                 86030000
INPMSK   EQU   X'01'                    MASK NOT SPECIFIED              86100000
INPLEN   DS    AL1                      LENGTH OF PARAMETER LIST        86170000
INPFLAG  DS    XL1                      FLAG BYTE                       86240000
INPCOUNT EQU   X'80'                    COUNT= SPECIFIED                86310000
INPINVL  EQU   X'20'                    INTVL= SPECIFIED                86380000
INPLINE  EQU   X'10'                    TARGET=LINE SPECIFIED           86450000
INPVARY  EQU   X'08'                    VARYOFF MACRO CALL              86520000
INPMASK  DS    XL5                      ERROR MASK                      86590000
INPCIND  DS    AL1                      INDEX TO IEDQBJ                 86660000
INPCC    DS    XL1                      CONDITION CODE                  86730000
INPNOCLR EQU   X'40'                    CLEAR= NO SPECIFIED             86800000
INPUPDAT EQU   X'20'                    UPDATE= SPECIFIED               86870000
INPUPADD EQU   X'10'                    UPDATE=ADD                      86940000
INPCNINT EQU   X'80'                    COUNT(3) = INTEGER              87010000
INPOPT   DS    AL1                      INDEX TO OPTION FIELD           87080000
INPOPT2  DS    AL1                      OPTION FIELD2 OR 0              87150000
INPINTG  DS    XL4                      INTEGER FOR COUNT(3)            87220000
INPINTV  DS    XL2                      INTERVAL                        87290000
         EJECT                                                          87360000
         TAVTD                                                          87430000
         EJECT                                                          87570000
         DCBD  DSORG=TX                                                 87640000
         EJECT                                                          87710000
         TDEBD                                                          87780000
         EJECT                                                          87850000
         TDISPD                                                         87920000
         EJECT                                                          88060000
         TLCBD                                                          88130000
         EJECT                                                          88270000
         TPRFD                                                          88290000
         EJECT                                                          88410000
         TPRIOR                                                         88480000
         EJECT                                                          88550000
         TQCBD                                                          88690000
         EJECT                                                          88760000
         TSCBD                                                          88900000
         EJECT                                                          88970000
         TTCBD                                                          89040000
         EJECT                                                          89180000
         TTNTD                                                          90180000
         EJECT                                                          91180000
         TTRMD                                                          92180000
         EJECT                                                          93180000
         DSECT                                                          94180000
         IEFUCBOB                                                       95180000
         SPACE 3                                                        96180000
         END                                                            97180000
