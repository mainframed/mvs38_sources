         TITLE 'SECOND LOAD OF LINE CLOSE - IGG02036'                   00005010
IGG02036 CSECT                                                          00010010
*A-000000-999999                                               @X31X8T0 00015010
         SPACE 3                                                        00020010
*CHANGE-ACTIVITY = AS FOLLOWS:                                   S21903 00025010
******************** MICROFICHE FLAGS *********************** SUPT CODE 00030010
*C279000,506500                                                  A49239 00035010
*A221000,506000                                                  A41030 00040010
*C098000                                                         A49219 00045010
*A083100-083700                                                  S22025 00050010
*D506500,541000                                                  S22025 00055010
*A002000                                                         S21903 00060010
*C003000,081000,540000-548000                                    S21903 00065010
*A175000,531000                                                 SA60820 00070010
*D221300-221600                                                 SA60820 00075010
*A079000,334000,405000,536000,549000,551000                      X01004 00080010
*C187000,301000-307000,317600,320000-324000,326000,374000-380000,X01004 00085010
*C477000-488000,507000,539000                                    X01004 00090010
*D329000,422000-475000                                           X01004 00095010
*A097000,128000,374483,534000                                    Y01004 00100010
*A376720,376920,377920,539000,559400                             X02004 00105010
*C079500,375120-375160,375240-375280,375360,375520-375560,       X02004 00110010
*C376480,379240-379360                                           X02004 00115010
*A374210,374270,376150,379320,507800                             Y05330 00120010
*C378240                                                         Y05330 00125010
*D110000,261000,507150,513000,515000,523000                      Y01948 00130010
*A376360,376390,378040,507880                                   OY00465 00135010
*D378280-378360                                                 OY00465 00140010
*C379640-379720                                                 OY00451 00145010
*D507100                                                        OY00451 00150010
*A303000                                                        SA65392 00155010
*C261500                                                        SA65392 00160010
*D522000,532000                                                 SA65392 00165010
*A261800-261900,534500                                          SA64788 00170010
*A261000,514000                                                 SA62357 00175010
*C261000,263000                                                 SA62357 00180010
*D264000-279000,290000,523000                                   SA62357 00185010
*A380500,559600                                                 OX02223 00190010
*A 374780,507450                                                OY00530 00195010
*C375300                                                        OY03847 00200010
*D375450-375650,379960-380200                                   OY03847 00205010
*A317600                                                        OY03895 00210010
*A377036,377054                                                 OY00512 00215010
*A514100,514200                                                 OY03305 00220010
*C262000-280000,157700                                          OY03305 00225010
*D376360                                                        OY00541 00250910
*A376370,379720                                                 OY00541 00251010
*C379660,379840                                                 OY00541 00251110
*A379920                                                        OY00532 00251210
*A380500,559600                                                 OX02223 00253810
*C090000,128000,137000-138000,212350,333000,376060-376090,376150 Y02027 00253910
*C376160,376270,376300,418200,428000-432000                      Y02027 00254010
*D507840,37770-377790,543000-549200                              Y02027 00254110
*A019200-019800,042000,089200,089500,090700-092100,138200,148300 Y02027 00254210
*A148600,212320,332100-332500,334050-334150,376100,376155,380750 Y02027 00254310
*A402300-403000,418820,118320,471000,554300                      Y02027 00254410
*A402300-403000,418820,418320,471000,554300                      Y02027 00254510
*C160000,161000,222000,261500-261000,280000,317300,318000        Y02027 00254610
*C354000,355000,376270,514500                                    Y02027 00254710
*D516000,520000,521000                                           Y02027 00254810
*A222050,262100-262700,549700-549900                             Y02027 00254910
*C321000-321300,325500-326100                                    Y02027 00255010
*D322000-322400,334200-334600                                    Y02027 00255110
*C301600                                                       @ZA01133 00255610
*A537500                                                       @ZA01133 00256110
*A377960,378040                                                @YA03928 00257110
*A549000,549200                                                @SA70907 00257210
*C216000,537000,377780                                         @SA70907 00257310
*D217000-226000,527500,535000-536000,542500-547000             @SA70907 00257410
*D376160,379326-379353                                           X03039 00273810
*C004000,105000-106000,146000,150000,378240,379760-379800      @Z30X8TM 00281810
*C379880,507250                                                @Z30X8TM 00287810
*D379323,542500,549600                                         @Z30X8TM 00293810
*A301400,374870,514100                                         @XA03965 00296810
*C375800,551300                                                @ZA06161 00297010
*C159000                                                       @OY11974 00297110
*C537500                                                       @OZ24288 00297310
*                                                              @G36XRTP 00297610
*A379880                                                       @G36XRTP 00298110
*C105000,379440,379520,379560,507250                           @G36XRTP 00298610
*D379926-379942                                                @G36XRTP 00299110
         SPACE 3                                                        00300010
*********************************************************************** 00310010
*                                                                     * 00320010
*MODULE-NAME = IGG02036    (TCAM,TERMINATION)                  @G36XRTP 00330010
*                                                                S21903 00340010
*DESCRIPTIVE-NAME = SECOND LOAD OF LINE CLOSE                    S21903 00350010
*                                                                S21903 00360010
*COPYRIGHTS = 'NONE'                                             S21903 00370010
*                                                                S21903 00380010
*STATUS = VERSION 10.0                                         @G36XRTP 00400010
*                                                                     * 00500010
*FUNCTION - OPERATION                                                 * 00600010
*   IGG02036 EXAMINES THE TCB DEB CHAIN TO DETERMINE IF THERE         * 00700010
*   ARE ADDITIONAL TCAM LINE GROUP OR MESSAGE QUEUES DCB'S TO         * 00800010
*   BE CLOSED, IF THERE ARE NONE THE ADDRESS OF THE TCAM              * 00900010
*   DISPATCHER IS ZEROED IN THE CVT, ANY LINE BUFFERS AND/OR          * 01000010
*   CORE QUEUE DATA SETS ARE FREED UP ALONG WITH ANY LINE             * 01100010
*   CROSS REFERENCE TABLE.  I/O OPERATIONS ARE PURGED ON ALL          * 01200010
*   THE LINES AND THE LINES ARE DISABLED.  THE ERROR TAB AND          * 01300010
*   ATTENTION TAB FIELDS IN THE UCBS FOR THESE LINES WILL BE          * 01400010
*   RESET AND ALL LINE CONTROL BLOCKS FOR THIS DCB WILL BE            * 01500010
*   FREED UP.  IF THERE IS A LINE CROSS REFERENCE TABLE, THE          * 01600010
*   ENTRIES USED BY THESE LINES WILL BE RE-INITIALIZED AND            * 01700010
*   CAN BE USED AGAIN.                                                * 01800010
*                                                                     * 01900010
*   MODIFICATIONS TO THE DCB ARE MADE TO THE COPY OF THE         Y02027 01920010
*   DCB SINCE COMMON CLOSE WILL OVERLAY THE REAL DCB WITH        Y02027 01940010
*   THE COPY OF THE DCB.                                         Y02027 01960010
*                                                                     * 01980010
*INPUT - THE REGISTERS 5, 6, 7, AND 8 ARE THE INPUT AS FOLLOWS        * 02000010
*   5 -  THE ADDRESS OF THE WTG TABLE PREFIX                     Y02027 02100010
*   6 -  THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE        * 02300010
*   7 -  THE ADDRESS OF THE COPY OF THE CURRENT DCB              Y02027 02400010
*   8 -  THE ADDRESS OF THE CURRENT ENTRY IN THE WHERE-TO-GO          * 02600010
*        TABLE                                                        * 02700010
*                                                                     * 02800010
*ENTRY POINTS - THIS ROUTINE IS ENTERED AT IGG02036 VIA AN            * 02900010
*   XCTL FROM THE CLOSE EXECUTOR IGG02035 OR IT MAY BE RE-ENTERED     * 03000010
*   FROM THE RELOOP PORTION OF THIS EXECUOTR IF IT IS DETERMINED      * 03100010
*   THAT THERE IS ANOTHER DATA CONTROL BLOCK TO BE CLOSED. THE   Y02027 03200010
*   MODULE RECEIVES CONTROL FROM IGG02035 IN PROTECT KEY 0       Y02027 03250010
*                                                                     * 03300010
*OUTPUT - REGISTERS 7 AND 8 WILL BE POSITIONED AT THE NEXT            * 03400010
*   ENTRIES IN THE WHERE-TO-GO TABLE PREFIX AND THE WHERE-       Y02027 03500010
*   TO-GO TABLE RESPECITIVELY.                                   Y02027 03600010
*                                                                     * 03700010
*EXTERNAL ROUTINES - NONE                                             * 03800010
*                                                                     * 03900010
*EXITS - NORMAL                                                       * 04000010
*   THIS ROUTINE EXITS VIA AN XCTL TO THE EXECUTOR IDENTIFIED         * 04100010
*   BY THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE.              * 04200010
*   THE EXIT IS MADE IN THE PROTECT KEY OF DATA MANAGEMENT.      Y02027 04250010
*                                                                     * 04300010
*TABLES - WORK AREAS - THE WHERE-TO-GO TABLE CONTAINS THE             * 04400010
*   ID AND TTR OF THE CLOSE EXECUTORS, AND THE WHERE-TO-         Y02027 04500010
*   GO TABLE PREFIX CONTAINS THE ADDRESS OF A COPY OF            Y02027 04550010
*   EACH DCB SPECIFIED IN THE CLOSE MACRO INSTRUCTION            Y02027 04600010
*   SPECIFIED IN THE CLOSE MACRO INSTRUCTION.                         * 04700010
*                                                                     * 04800010
*ATTRIBUTES - THIS ROUITNE IS EXECUTED IN THE TRANSIENT AREA AS       * 04900010
*   ENABLED, PRIVILEGED, AND RE-ENTRANT.                              * 05000010
*********************************************************************** 05020010
*********************************************************************** 05050010
         EJECT                                                          05100010
* REGISTER USAGE                                                        05200010
*                                                                       05300010
RE       EQU   0                        WORK REGISTER                   05400010
RF       EQU   1                        WORK REGISTER                   05500010
RDCB     EQU   2                        ADDRESS OF THE CURRENT DCB      05600010
RTIOT    EQU   3                        ADDRESS OF THE TIOT             05700010
RCORE    EQU   4                        ADDRESS OF DCB WORK AREA        05800010
RPAR     EQU   5                        ADDRESS OF FIRST ENTRY IN       05900010
*                                         DCB PARAMETER LIST            06000010
RWTG     EQU   6                        ADDRESS OF WHERE-TO-GO          06100010
*                                         TABLE                         06200010
RPARC    EQU   7                        ADDRESS OF CURRENT ENTRY IN     06300010
*                                         DCB PARAMETER LIST            06400010
RWTGC    EQU   8                        ADDRESS OF CURRENT ENTRY IN     06500010
*                                         IN WTG TABLE                  06600010
RAVT     EQU   9                        ADDRESS OF THE AVT              06700010
RUCB     EQU   10                       ADDRESS OF THE CURRENT UCB      06800010
RDEB     EQU   11                       BASE OF THIS ROUTINE            06900010
RBASE    EQU   12                       WORK REGISTER                   07000010
RC       EQU   13                       WORK REGISTER                   07100010
RD       EQU   14                       WORK REGISTER                   07200010
RJ       EQU   15                       WORK REGISTER                   07300010
*                                                                       07400010
         USING IEDQDEB+36,RDEB          DEB DSECT                       07500010
         USING IEDQTCB,RD               TCB DSECT                       07600010
         USING IHADCB,RDCB                                              07700010
         USING IEDQLCB,RCORE            LCB DSECT                       07800010
         USING IEDQAVTD,RAVT                                            07900010
         USING IEDQTNTD,RUCB                                     X02004 07950010
*                                                                       08000010
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY S21903 08100010
         USING *,RBASE                                                  08200010
         SPACE 2                                                        08250010
IGG02036 IEDHJN START                                            Y02027 08300010
         SPACE 2                                                        08350010
         SR    RTIOT,RTIOT              CLEAR A COUNT REGISTER          08400010
         EJECT                                                          08500010
RESTART  EQU   *                                                        08600010
         LA    RTIOT,ONE(RTIOT)         INCREMENT THE COUNT OF THE      08700010
*                                         PASSES THRU THIS MODULE       08800010
         L     RJ,FOUR(RWTGC)           ADDR OF OPEN WORK AREA   Y02027 08900010
         USING FORCORE,RJ               OPEN WORK AREA DSECT     Y02027 08930010
         L     RDCB,DXUDCBAD            GET CURRENT DCB ADDRESS  Y02027 08960010
         L     RF,CVTPTR                LOAD ADDRESS OF CVT      Y02027 09000010
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 09050010
         L     RF,CVTAQAVT              GET TCX ADDRESS          Y02027 09100010
         USING IEDQTCX,RF               TCX ADDRESSABILITY       Y02027 09200010
         L     RAVT,TCXAVT              GET THE AVT ADDRESS      Y02027 09300010
         L     RDEB,DCBDEBAD            GET THE DEB ADDRESS      Y02027 09500010
         L     RD,DEBTCBAD              GET THE TCB ADDRESS      Y02027 09700010
         L     RDEB,TCBDEB              LOAD THE ADDRESS OF THE         09900010
*                                         FIRST DEB ON THE CHAIN        10000010
         SR    RUCB,RUCB                CLEAR A COUNT REGISTER          10100010
CLRDEBAD EQU   *                                                        10200010
         L     RC,DEBDCBAD              LOAD THE ADDRESS OF THE DCB     10300010
*                                         FOR THIS DEB                  10400010
         TM    DSORG(RC),LINEDCB+DISKDCB+DCB3705    LINE GRP   @G36XRTP 10500010
*                                       OR MSG Q OR                     10600010
*                                       CHECKPOINT DCB           S22024 10700010
         BZ    LASTEST                  NO, BRANCH               S22024 10800010
         LA    RUCB,ONE(RUCB)           INCREMENT THE COUNT OF DEBS     11100010
*                                         ON THE CHAIN                  11200010
LASTEST  EQU   *                                                        11300010
         L     RDEB,FOUR(RDEB)          GET NEXT DEB ADDRESS     S22024 11400010
         LA    RDEB,AVTEZERO(RDEB)      CLEAR HIGH ORDER BYTE    S22024 11500010
         LTR   RDEB,RDEB                ANY MORE DEBS IN CHAIN   S22024 11600010
         BNZ   CLRDEBAD                 YES, CHECK THEM          S22024 11700010
         CR    RTIOT,RUCB               COMPARE THE NUMBER OF PASSES    12100010
*                                         THROUGH THIS MODULE WITH      12200010
*                                         THE NUMBER OF DEBS ON THE     12300010
*                                         TCB CHAIN                     12400010
         BE    LASTIME                  IF EQUAL, DO THE FINAL          12500010
*                                         OPERATIONS                    12600010
SETDEB   EQU   *                                                        12700010
         L     RDEB,DCBDEBAD            RESTORE THE DEB ADDRESS  Y02027 12800010
         LA    RC,SETLCB                SET A BRANCH ADDRESS            12950010
         EJECT                                                          13000010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     13100010
*                                                                 *     13200010
*              PURGE I/O ON ALL THE LINES                         *     13300010
*                                                                 *     13400010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     13500010
PURGELIN EQU   *                                                        13600010
         L     RF,CVTPTR                LOAD ADDRESS OF CVT      Y02027 13700010
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 13750010
         MVC   DEBEXSCL+1(THREE),CVTXAPG+1 MOVE IN THE ADDR OF   Y02027 13800010
*                                         IOS APPENDAGES                13900010
         L     RF,4(RWTGC)              LOAD THE ADDRESS OF THE         14000010
*                                         OPEN WORK AREA                14100010
         ST    RDEB,0(RF)               STORE DEB ADDRESS IN            14200010
*                                         PARAMETER LIST                14300010
         MVI   0(RF),OPTION             MOVE IN THE OPTION BYTE         14400010
         XC    FOUR(EIGHT,RF),FOUR(RF)  CLEAR FOR PURGE                 14500010
         PURGE (1)                      PURGE I/O ON ALL LINES @Z30X8TM 14600010
*                                                                       14700010
         LA    RE,ONE                   LOAD THE WAIT COUNT             14800010
         L     RF,4(RWTGC)              LOAD THE ADDRESS OF THE  Y02027 14830010
*                                       OPEN WORK AREA           Y02027 14860010
         LA    RF,FOUR(RF)              GET ECB ADDRESS                 14900010
         WAIT  ECB=(1)                  WAIT FOR PURGE         @Z30X8TM 15000010
*                                                                       15100010
         BR    RC                       BR ON PRE-SET REGISTER   S22024 15150010
         EJECT                                                          15200010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     15300010
*                                                                 *     15400010
*    DISABLE ALL LINES UNLESS A TYPE III ADAPTER OR 3705         S22024 15500010
*                                                                 *     15600010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     15700010
SETLCB   EQU   *                                                        15750010
         TM    DCBDSORG+ONE,DCB3705     IS THIS A 3705 DCB       S22024 15760010
         BO    OUT                      YES, SKIP DISABLE       OY03305 15770010
         SR    RC,RC                    CLEAR FOR LINE COUNT            15800010
         SR    RF,RF                    CLEAR                  @OY11974 15900010
         IC    RC,DEBNMEXT              NUMBER OF LINES        @OY11974 15910010
SCAN     EQU   *                                               @OY11974 15920010
         L     RUCB,DEBUCBAD(RF)        UCB POINTER            @OY11974 15930010
         LTR   RUCB,RUCB                IS IT DUMMY            @OY11974 15940010
         BNZ   CONT                     BR, NO                 @OY11974 15950010
         LA    RF,FOUR(RF)              INCREMENT INDEX        @OY11974 15960010
         BCT   RC,SCAN                  CHECK NEXT LINE        @OY11974 15970010
         B     OUT                      ALL LINES DUMMY        @OY11974 15980010
CONT     EQU   *                                               @OY11974 15990010
         TM    UCBUNTYP-UCBOB(RUCB),TYPE3 IS THIS AN IBM TERMINALY02027 16000010
*                                       ADAPTER , TYPE III       Y02027 16100010
         BZ    OUT                      YES, BRANCH                     16200010
         L     RCORE,DCBIOBAD           LOAD THE ADDRESS OF THE LCB     16300010
*                                         AREA                          16400010
         LA    RJ,IOBPTR                LOAD THE DISPLACEMENT OF        16500010
*                                         THE IOB                       16600010
         SR    RCORE,RJ                 ACCESS THE BEGINNING OF THE     16700010
*                                         LCB AREA                      16800010
         SR    RUCB,RUCB                CLEAR AN INDEX REGISTER         16850010
         SR    RD,RD                    CLEAR A SIZE REGISTER           16900010
         IC    RD,DCBEIOBX              GET THE SIZE OF AN LCB          17000010
         IC    RC,DEBNMEXT              LOAD THE NUMBER OF LINES        17100010
*                                                                       17200010
LOOP     EQU   *                                                        17300010
         AR    RCORE,RD                 ACCESS THE BEGINNING OF THE     17400010
*                                         FIRST/NEXT LCB                17500010
         MVI   LCBCPA+20,POST           POST LCB FOR DUMMY LINE SA60820 17510010
         L     RJ,DEBUCBAD(RUCB)        LOAD THE UCB ADDRESS            17520010
         LTR   RJ,RJ                    IS THIS A DUMMY LINE            17540010
         BZ    LOOP01                   YES, BRANCH                     17560010
         MVC   LCBCPA(8),DISABLE        SET A DISABLE COMMAND           17600010
*                                         CHANNEL PROGRAM AREA          17700010
         XC    LCBCPA+20(FOUR),LCBCPA+20 CLEAR FOR DISABLE              17800010
         LA    RF,LCBCPA+20             GET ECB ADDRESS FOR IOS         17900010
         ST    RF,LCBECBCC              STORE THE ECB ADDRESS IN        18000010
*                                         THE LCB                       18100010
         LA    RF,LCBCPA                GET ADDRESS OF CHANNEL          18200010
*                                         PROGRAM AREA                  18300010
         ST    RF,LCBSIOCC              STORE IN FIRST CCW POINTER      18400010
         LA    RF,LCBFLAG1              LOAD THE ADDRESS OF THE IOS     18500010
*                                         FLAG BYTES                    18600010
         EXCPVR (1),SUBSYS              DISABLE THE LINE         X01004 18700010
LOOP01   EQU   *                                                        18730010
         LA    RUCB,FOUR(RUCB)          INCREMENT THE INDEX             18760010
         BCT   RC,LOOP                    BRANCH IF THERE ARE MORE      18800010
*                                         LINES TO DISABLE              18900010
         EJECT                                                          19000010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     19100010
*                                                                 *     19200010
*        WAIT FOR THE DISABLE COMMANDS TO COMPLETE                *     19300010
*                                                                 *     19400010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     19500010
         L     RCORE,DCBIOBAD           LOAD THE BEGINNING ADDRESS      19600010
*                                         OF THE LCB AREA               19700010
         LA    RJ,IOBPTR                LOAD THE DISPLACEMENT OF        19800010
*                                         THE IOB                       19900010
         SR    RCORE,RJ                 ACCESS THE BEGINNING OF         20000010
*                                         THE LCB AREA                  20100010
         IC    RC,DEBNMEXT              GET NUMBER OF LINES             20200010
         TIME  BIN                      GET TIME FOR COMPARE       0616 20300010
         L     RJ,FOUR(RWTGC)           LOAD THE ADDRESS OF THE         20320010
*                                         OPEN WORK AREA                20340010
         ST    RTIOT,0(RJ)              SAVE REG3 IN WORK AREA   S22024 20360010
         LR    RTIOT,RE                 SAVE THE ORIGINAL TIME          20380010
WAITLOOP EQU   *                                                        20500010
         AR    RCORE,RD                 ACCESS THE FIRST/NEXT LCB       20600010
TESTPCD  EQU   *                                                   0616 20700010
         TM    LCBCPA+20,X'40'          CHECK ECB FOR COMPLETION   0616 20800010
         BZ    TESTDLAY                 BRANCH IF NOT COMPLETE     0616 20900010
BCT      EQU   *                                                        21000010
         BCT   RC,WAITLOOP              LOOP FOR NEXT WAIT              21100010
         LA    RC,OUT                   SET A BRANCH ADDRESS            21210010
         L     RJ,FOUR(RWTGC)           GET THE ADDRESS OF THE OPEN     21220010
*                                         WORK AREA                     21230010
         USING FORCORE,RJ               OPEN WORK AREA DSECT     Y02027 21233010
         L     RDCB,DXUDCBAD            RESTORE THE DCB ADDRESS  Y02027 21236010
         L     RTIOT,0(RJ)              RESTORE REGISTER 3              21240010
         B     PURGELIN                 PURGE I/O ON ALL LINES          21250010
TESTDLAY EQU   *                                                   0616 21400010
         LTR   RDCB,RDCB                CHECK FOR DELAY DONE       0616 21500010
         BZ    BCT                      BR YES, CHECK NEXT LINE@SA70907 21600010
         TIME  BIN                      GET CURRENT TIME           0616 22700010
         LTR   RTIOT,RTIOT              TEST THE ORIGINAL TIME          22800010
         BNM   COMPUTE                  BRANCH IF NOT NEGATIVE     0616 22900010
         LTR   RE,RE                    CHECK CURRENT TIME         0616 23000010
         BM    COMPUTE                  BRANCH IF MINUS            0616 23100010
         LCR   RTIOT,RTIOT              COMPLIMENT THE ORIGINAL TIME    23120010
         ALR   RE,RTIOT                 ADD THE TIMES                   23140010
         LCR   RTIOT,RTIOT              RESTORE THE ORIGINAL TIME       23160010
         B     COMPARE2                 SKIP SUBTRACT              0617 23500010
COMPUTE  EQU   *                                                   0616 23600010
         SLR   RE,RTIOT                 SUBTRACT THE TIMES IF THEY      23660010
*                                         ARE POSITIVE                  23720010
COMPARE2 EQU   *                                                   0617 23800010
         CH    RE,LIMIT                 CHECK FOR 28 SECOND LIMIT  0616 23900010
         BL    TESTPCD                  BRANCH IF NOT REACHED      0616 24000010
         SR    RDCB,RDCB                CLEAR REG TO INDICATE DELAY0616 24100010
         B     TESTPCD                  CHECK ECB AGAIN            0616 24200010
         EJECT                                                          24300010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     24400010
*                                                                 *     24500010
*        THIS SECTION OF CODE RESETS THE ERROR TAB AND            *     24600010
*        ATTENTION TAB FIELDS IN THE UCBS FOR ALL LINES           *     24700010
*                  IN THIS LINE GROUP                             *     24800010
*                                                                 *     24900010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     25000010
OUT      EQU   *                                                   0616 25100010
         SR    RE,RE                    CLEAR FOR A LINE COUNT          25200010
         IC    RE,DEBNMEXT              GET THE NUMBER OF LINES IN      25300010
*                                         THIS LINE GROUP               25400010
         SR    RD,RD                    CLEAR AN INDEX REGISTER         25500010
GETADDR  EQU   *                                                        25600010
         L     RF,DEBUCBAD(RD)          LOAD THE ADDRESS OF THE         25700010
*                                         FIRST/NEXT UCB                25800010
         LTR   RF,RF                    IS THIS A // DD DUMMY ENTRY     25900010
         BZ    NEXTUCB                  YES, BRANCH                     26000010
         SR    RCORE,RCORE              CLEAR IC REGISTER       SA62357 26110010
         IC    RCORE,DEBNMEXT           NUMBER OF EXTENTS       SA62357 26120010
         SLL   RCORE,TWO                TIMES FOUR              SA62357 26130010
         LA    RCORE,DEBUCBAD(RCORE)    POINT TO ACCESS METHOD  SA62357 26140010
         NI    ONE(RF),XFB              GUARANTEE UCBNALOC BIT  SA64788 26180010
*                                         SET BY TOTE IS OFF    SA64788 26190010
         L     RJ,UCBEXTPT-UCBOB(,RF)   POINT TO UCB EXTENSION   Y02027 26195010
         MVC   UCBETI-UCBCMEXT(ONE,RJ),FOUR(RCORE) RESTORE       Y02027 26200010
*                                       ERRTAB OF REPRESENTATIVE Y02027 26500010
*                                       UCB                      Y02027 26800010
         MVC   UCBATI-UCBCMEXT(ONE,RJ),FIVE(RCORE) RESTORE ATTN  Y02027 27100010
*                                       TAB                      Y02027 27400010
NEXTUCB  EQU   *                                                        28100010
         LA    RD,FOUR(RD)              INCREMENT THE UCB INDEX         28200010
         BCT   RE,GETADDR               RESET THE NEXT LINE             28300010
         EJECT                                                          28400010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     28500010
*                                                                 *     28600010
*        FREEMAIN ALL OF THE LCB'S                                *     28700010
*                                                                 *     28800010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     28900010
TYPEIII  EQU   *                                                        29000010
         L     RCORE,DCBIOBAD           LOAD THE BEGINNING ADDRESS      29100010
*                                         OF THE LCB AREA               29200010
         LA    RJ,IOBPTR                LOAD THE DISPLACEMENT OF        29300010
*                                         THE IOB                       29400010
         SR    RCORE,RJ                 ACCESS THE BEGINNING OF         29500010
*                                         THE LCB AREA                  29600010
         SR    RD,RD                    CLEAR A SIZE REGISTER           29700010
         IC    RD,DCBEIOBX              GET THE SIZE OF AN LCB          29800010
         AR    RCORE,RD                 GET THE ADDRESS OF THE          29900010
*                                         FIRST LCB                     30000010
         LR    RF,RD                    COPY SIZE OF AN LCB      X01004 30050010
         IC    RD,DEBNMEXT              NUMBER OF LINE GROUPS    X01004 30100010
         TM    DCBDSRG2,DCBDSGTR        IS THIS A 3705 LCB      SA65392 30120010
         BO    LCB3705A                 YES,SKIP THRESHOLD CODE SA65392 30140010
         MVC   AVTDOUBL(1),LCBRSKEY     SAVE LINE SCHEDULER'S  @XA03965 30146010
*                                       DISP CODE              @XA03965 30152010
         AH    RF,THRESHL               ADD LENGTH OF          @ZA01133 30160010
*                                         THRESHHOLD VALUES     SA65392 30220010
LCB3705A EQU   *                                                SA65392 30260010
         MR    RE,RD                    GET TOTAL LCB AREA SIZE  X01004 30300010
         LA    RJ,DEBUCBAD              LOAD A POINTER TO THE UCB       30800010
*                                         ADDRESSES                     30900010
GETUCBAD EQU   *                                                        31000010
         L     RC,0(RJ)                 LOAD A UCB ADDRESS              31100010
         LA    RC,0(RC)                 CLEAR THE HIGH ORDER BYTE       31200010
         LTR   RC,RC                    IS THIS A VALID ADDRESS         31300010
         BNZ   DIALTEST                 YES, BRANCH                     31400010
         LA    RJ,FOUR(RJ)              INCREMENT THE UCB POINTER       31500010
         B     GETUCBAD                 GET THE NEXT UCB ADDRESS        31600010
DIALTEST EQU   *                                                        31700010
         TM    UCBDVCLS-UCBOB(RC),GRAPHICS IS THIS A GRAPHICS DEVY02027 31730010
         BO    FREE2260                 YES-BR TO UNFIX 2260 RTN X01004 31760010
         TM    DCBDSORG+ONE,DCB3705     IS THIS A 3705 DCB      OY03895 31770010
         BO    FREE2260                 YES, BRANCH             OY03895 31780010
         TM    UCBTBYT2-UCBOB(RC),DIAL  IS THIS A DIAL LINE      Y02027 31800010
         BZ    COPYSIZE                 NO, BRANCH                      31900010
         LA    RC,EIGHT(RF)             ADD 8 BYTES FOR DIAL-OUT X01004 32000010
*                                        CALL QUEUE              X01004 32020010
         SR    RF,RF                                             X01004 32040010
         IC    RF,AVTSCBSZ              SIZE OF AN SCB           X01004 32060010
         MR    RE,RD                    TOTAL SCB AREA           X01004 32080010
         ST    RF,LCBCPA                SAVE LENGTH OF SCB AREA  Y02027 32100010
         L     RJ,LCBMSGFM              ADDRESS OF SCB'S         Y02027 32110010
         BAL   RD,FREEPG                FREE SCB AREA            Y02027 32120010
         L     RE,LCBCPA                GET LENGTH OF SCB AREA   Y02027 32130010
         L     RF,LCBMSGFM              ADDRESS OF SCB'S         X01004 32140010
         ICM   RE,HI,SP250              SET SUBPOOL FOR FREEMAIN X01004 32160010
         FREEMAIN R,LV=(0),A=(1)                                 X01004 32180010
         LA    RE,EIGHT                                          X01004 32260010
         SR    RCORE,RE                 ADJ STRT OF LCB FOR DIAL X01004 32280010
COPYSIZ1 EQU   *                                                 X01004 32300010
         LR    RF,RC                    COPY LENGTH OF LCB AREA  X01004 32350010
COPYSIZE EQU   *                                                        32500010
         LR    RC,RF                    SAVE LCB LENGTH          Y02027 32550010
         LR    RJ,RCORE                 ADDRESS OF LCB'S         Y02027 32560010
         BAL   RD,FREEPG                FREE LCB AREA            Y02027 32570010
         LR    RE,RC                    LENGTH OF LCB AREA       Y02027 32600010
         ICM   RE,HI,SP250              SET SUBPOOL FOR FREEMAIN X01004 32650010
         LR    RF,RCORE                 COPY THE LCB AREA STARTING      32700010
*                                         ADDRESS                       32800010
*                                         FOR PROBLEM PROGRAM MODE      33000010
*                                                                       33100010
         FREEMAIN  R,LV=(0),A=(1)                                       33200010
         SPACE 2                                                 Y02027 33210010
*        CLEAR THE DCB FIELDS IN THE COPY OF THE DCB.            Y02027 33220010
         DROP  RDCB                     DROP RDCB AS DCB BASE    Y02027 33230010
         USING IHADCB,RF                ADDR OF COPY OF THE DCB  Y02027 33240010
         L     RF,ZERO(RPARC)           POINT TO COPY OF DCB     Y02027 33250010
         STCM  RAVT,AD,DCBIOBAA         RESTORE AVT ADDR IN DCB  Y02027 33300010
         XC    DCBEIOBX(1),DCBEIOBX     CLEAR SIZE OF LCB               33400010
         DROP  RF                       DROP RF AS DCB BASE      Y02027 33405010
         USING IHADCB,RDCB              ADDR THE REAL DCB        Y02027 33410010
         SPACE 2                                                 Y02027 33415010
         EJECT                                                          33500010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     33600010
*                                                                 *     33700010
*        THIS SECTION OF CODE REMOVES AN ENTRY FROM THE           *     33800010
*        CROSS REFERENCE TABLE AND MAKES THE SPACE IT             *     33900010
*        FORMERLY OCCUPIED AVAILABLE TO SUBSEQUENT OPENS          *     34000010
*                                                                 *     34100010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     34200010
         NC    AVTCRSRF(4),AVTCRSRF     DO WE HAVE A CROSS              34300010
*                                         REFERENCE TABLE               34400010
         BZ    ENDLOAD                  NO, BRANCH                      34500010
         SR    RE,RE                    CLEAR FOR A LINE COUNT          34600010
         IC    RE,DEBNMEXT              GET THE NUMBER OF LINES IN      34700010
*                                         THIS LINE GROUP               34800010
         SR    RD,RD                    CLEAR FOR THE UCB INDEX         34900010
CROSSREF EQU   *                                                        35000010
         L     RJ,DEBUCBAD(RD)          LOAD THE ADDRESS OF THE         35100010
*                                         FIRST/NEXT UCB IN THIS        35200010
*                                         LINE GROUP                    35300010
         L     RJ,UCBNAME-ONE-UCBOB(,RJ) LOAD THE UCB NAME       Y02027 35400010
*                                       FROM THE UCB             Y02027 35500010
         L     RF,AVTCRSRF              LOAD THE ADDRESS OF THE         35600010
*                                         CROSS REFERENCE TABLE         35700010
         LA    RC,EIGHT(RF)             LOAD THE ADDRESS OF THE         35800010
*                                         FIRST ENTRY IN THE TABLE      35900010
COMPUCB  EQU   *                                                        36000010
         C     RJ,0(RC)                 ARE THE UCB NAMES THE SAME      36100010
         BNE   CHKNEXT                  NO, BRANCH                      36200010
         XC    0(CRSFSIZE,RC),0(RC)     YES, CLEAR ALL INFORMATION      36300010
*                                         FROM THIS ENTRY               36400010
         MVC   ONE(THREE,RC),ONE(RF)    MOVE THE ADDRESS OF THE         36500010
*                                         NEXT AVAILABLE ENTRY INTO     36600010
*                                         THE ENTRY CHAIN               36700010
         ST    RC,0(RF)                 MAKE THIS ENTRY THE NEXT        36800010
*                                         AVAILABLE ENTRY IN THE        36900010
*                                         CROSS REFERENCE TABLE         37000010
NEXTENTY EQU   *                                                        37100010
         LA    RD,FOUR(RD)              INCREMENT THE UCB POINTER       37200010
         BCT   RE,CROSSREF              DECREMENT THE LINE COUNT        37300010
ENDLOAD  EQU   *                                                 X01004 37400010
         SR    RCORE,RCORE                                       X01004 37403010
         IC    RCORE,DCBILCT            NUM OF INVITATION LISTS  X01004 37406010
         LA    RF,DEBPRFIX              LENGTH OF DEB PREFIX     X01004 37409010
         SR    RDEB,RF                  ADJ DEB BASE TO PREFIX   X01004 37412010
         DROP  RDEB                                              X01004 37415010
         USING IEDQDEB,RDEB                                      X01004 37418010
         L     RJ,DEBCEA                ADDRESS OF LINE END APP. X02004 37421010
         TM    DCBDSORG+ONE,DCB3705     3705 DCB                 Y05330 37421610
         BNO   NOT3705                  NO, BRANCH               Y05330 37422210
         SH    RJ,AVTHA4                ADJUST START ADDRESS     Y05330 37422810
NOT3705  EQU   *                        SET TO PAGE FREE APPEND. Y05330 37423410
         BAL   RD,FREEPG3               UNFIX PAGES OCCUPIED BY  X02004 37424010
*                                        LINE END APPENDAGE      X01004 37427010
         TM    DCBDSORG+ONE,DCB3705     3705 DCB                 Y05330 37428010
         BO    FREEDCB                  YES, FREE DCB AND DEB    Y05330 37429010
INVFREE  EQU   *                                                 X01004 37430010
         LR    RD,RCORE                 GET INVITATION LISTS YET X01004 37433010
*                                        TO FREE                 X01004 37436010
         BCTR  RD,ZERO                  SUBTRACT ONE             X01004 37439010
         AR    RD,RD                    CONVERT BYTE INDEX TO    X01004 37442010
         AR    RD,RD                     FOUR BYTE INDEX         X01004 37445010
         L     RUCB,DCBINVLI(RD)        ADDRESS OF INVITATION    X01004 37448010
*                                         LIST                   X01004 37451010
         SR    RC,RC                                             X01004 37454010
         SR    RF,RF                                             X01004 37457010
         IC    RC,0(RUCB)               GET NUMBER OF ENTRIES    X01004 37460010
         IC    RF,TWO(RUCB)             GET LENGTH OF EACH ENTRY X01004 37463010
         MR    RE,RC                    GET LENGTH OF LIST       X01004 37466010
         AR    RC,RC                    MULTIPY NUM OF ENTRIES   X01004 37469010
*                                       BY TWO TO GET SIZE OF           37472010
*                                         INVITATION LIST PREFIX X01004 37475010
         AR    RF,RC                    SET LENGTH TO FIX        X01004 37478010
         LA    RF,INVSIZE(RF)           INCREMENT SIZE TO       OY00530 37478310
*                                       INCLUDE DOUBLE WORD     OY00530 37478610
*                                       CONTROL FIELD AND       OY00530 37478910
*                                       DELIMITER               OY00530 37479210
         TM    STATUS(RUCB),INVEOT      WAS EOT SPECIFIED ON    OY00530 37479510
*                                       INVLIST MACRO           OY00530 37479810
         BZ    INVADDR                  NO, BRANCH              OY00530 37480110
         LA    RF,ONE(RF)               ADD 1 TO SIZE - FOR EOT OY00530 37480410
INVADDR  EQU   *                                                OY00530 37480710
         SR    RUCB,RC                  GET ADDRESS OF PREFIX    X01004 37481010
         LR    RJ,RUCB                  ADDRESS TO FIX           X01004 37484010
         BAL   RD,FREEPG                UNFIX INVITATION LIST    X01004 37487010
         LR    RD,RCORE                 GET NO. OF INVLISTS YET@XA03965 37487110
*                                       TO BE FREED            @XA03965 37487210
         BCTR  RD,ZERO                  SUBTRACT ONE           @XA03965 37487310
         AR    RD,RD                    CONVERT BYTE INDEX TO  @XA03965 37487410
         AR    RD,RD                    FOUR-BYTE INDEX        @XA03965 37487510
         L     RUCB,DCBINVLI(RD)        INVLIST ADDRESS        @XA03965 37487610
         CLI   AVTDOUBL,BUFKEY          BUFF TERM LINE?        @XA03965 37487710
         BE    NOCPUID                  BRANCH IF YES          @XA03965 37487810
         CLI   FIVE(RUCB),ZERO          CPUID ADDRESS HERE     @XA03965 37487910
         BE    NOCPUID                  BRANCH IF NO           @XA03965 37488010
         L     RJ,FOUR(,RUCB)           CPUID ADDRESS          @XA03965 37488110
         SR    RF,RF                    CLEAR FOR INSERT       @XA03965 37488210
         IC    RF,ZERO(,RJ)             NO. OF CHARS IN CPUID  @XA03965 37488310
         LA    RF,ONE(,RF)              ADD ONE FOR PREFIX     @XA03965 37488410
         BAL   RD,FREEPG                UNFIX CPUID            @XA03965 37488510
NOCPUID  EQU   *                                               @XA03965 37488610
         BCT   RCORE,INVFREE            RELEASE NEXT LIST        X01004 37490010
         L     RJ,DEBSIOA               ADDRESS OF START I/O APP X02004 37500010
         BAL   RD,FREEPG3               UNFIX APPENDAGE          X02004 37505010
         ICM   RF,AD,DCBSCTAD           ADDRESS OF SCT           X01004 37510010
         ICM   RF,HI,DEBEOEA+THREE      LENGTH OF SCT            X02004 37515010
         BAL   RD,FREEPG1               UNFIX SCT                X01004 37520010
         TM    DCBPCI,PCI               PCI PRESENT              X01004 37525010
         BO    FREEDCB                  NO, BRANCH              OY03847 37530010
         L     RJ,DEBPCIA               ADDRESS OF PCI           X02004 37535010
         BAL   RD,FREEPG3               UNFIX PCI APPENDAGE      X02004 37540010
FREEDCB  EQU   *                                                 X01004 37570010
         LR    RJ,RDCB                  DCB ADDRESS              X01004 37575010
         SR    RF,RF                    CLEAR REG              @ZA06161 37580010
         IC    RF,DCBILCT               NUMBER OF ELEMENTS IN  @ZA06161 37581010
*                                        INVITATION LIST       @ZA06161 37582010
         SLL   RF,TWO                   INVITATION LIST LENGTH @ZA06161 37583010
         LA    RF,DCBEND(0,RF)          LENGTH OF DCB          @ZA06161 37584010
         BAL   RD,FREEPG                FREE DCB                 X01004 37585010
         LR    RF,RDEB                  COPY DEB ADDRESS         Y01004 37590010
         ICM   RF,HI,DEBLNGTH           DOUBLE WORD LENGTH OF DEBY01004 37600010
         BAL   RD,FREEPG1               PAGE FREE THE DEB        Y01004 37603010
         L     RF,CVTPTR                ADDRESS OF CVT           Y02027 37606010
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 37607010
         TM    CVTTCMFG,LASTDCB         LAST TCAM DCB CLOSED     Y02027 37609010
         BNO   ENDLOAD1                 NO, BRANCH               X01004 37612010
         L     RJ,CVTAQAVT              ADDRESS OF TCX           Y02027 37615010
         USING IEDQTCX,RJ               TCX ADDRESSABILITY       Y02027 37615510
         SR    RCORE,RCORE              CLEAR FOR INSERT         X02004 37624010
         IC    RCORE,TCXTOTE            NUMBER OF TOTE ENTRIES   Y02027 37627010
         LM    RE,RF,TCXBUFA            ADDR AND LENGTH OF I/O   Y02027 37630010
*                                       TRACE, BUFFERS AND CPB'S X01004 37633010
         LR    RJ,RE                    COPY ADDRESS OF BUFFERS OY00541 37638010
         BAL   RD,FREEPG                UNFIX BFRS-TRACE AND CPB X01004 37639010
         L     RUCB,AVTRNMPT            ADDRESS OF TERMINAL NAME X02004 37642010
*                                         TABLE (TNT)            X01004 37645010
         SR    RF,RF                    CLEAR REG FOR INSERT     X01004 37648010
         IC    RF,TNTENLEN              LENGTH OF ENTRY          X01004 37651010
         LA    RE,THREE                                          X01004 37654010
         AR    RF,RE                    BUMP FOR TNT POINTERS    X01004 37657010
         LR    RJ,RF                    SAVE ENTRY LENGTH        X02004 37660010
         MH    RF,TNTLEN                MULTIPLY LENGTH OF ENTRY X01004 37663010
*                                         BY NUMBER OF ENTRIES   X01004 37666010
         LA    RF,TNTOFF(RF)            ADD TO LENGTH THE CORDE  X01004 37669010
*                                         BEFORE THE FIRST ENTRY X01004 37672010
         LR    RD,RCORE                 NUMBER OF TOTE ENTRIES   X02004 37675010
         MR    RD,RD                    ENTRIES TO FIX FOR TOTE  X02004 37700010
         AR    RF,RJ                    ADD TOTE TO TNT LENGTH   X02004 37703010
         LTR   RJ,RJ                    ANY TOTE ENTRIES        OY00512 37703610
         BNZ   TOTEYES                  YES, BRANCH             OY00512 37704210
         LA    RF,ONE(RF)               ADJUST TERM TABLE OFFSETOY00512 37704810
TOTEYES  EQU   *                                                OY00512 37705410
         LR    RJ,RUCB                  COPY TNT START ADDRESS   X02004 37706010
         AR    RF,RE                    ROUND TO WORD BOUNDARY   X01004 37710010
         SRL   RF,2                     SHIFT OUT 2 LO-ORD BITS  X01004 37715010
         SLL   RF,2                     SHIFT BACK               X01004 37720010
         LA    RCORE,0(RF,RJ)                                    X01004 37723010
         ICM   RCORE,ALL,0(RCORE)       GET ADDRESS OF TERMINAL  X01004 37726010
*                                         TABLE                  X01004 37730010
         BAL   RD,FREEPG                UNFIX TNT                X01004 37735010
         L     RF,0(RCORE)              ADDRESS OF END OF THE    X01004 37740010
*                                       TERMINAL TABLE AND QCBS  X01004 37743010
         LR    RUCB,RF                  SAVE ADDRESS OF SCBS     X01004 37746010
         SR    RF,RCORE                 GET LENGTH OF TERM TABLE X01004 37750010
         LR    RJ,RCORE                 ADDR OF TERMINAL TABLE   X01004 37755010
         L     RCORE,FOUR(RCORE)        ADDRESS OF THE NUMBER OF X01004 37760010
*                                         ENTRIES IN DEVICE      X01004 37764010
*                                         CHARACTERISTICS TABLE  X01004 37768010
         BAL   RD,FREEPG                UNFIX TERMINAL TABLE AND X01004 37772010
*                                         QUEUE CONTROL BLOCKS   X01004 37776010
         LH    RF,0(RCORE)              NUMBER OF ENTRIES IN     X01004 37780010
*                                         DEVICE CHARACTERISTICS X01004 37784010
*                                         TABLE                  X01004 37788010
         SLL   RF,TWO                  MULTIPLY BY 4 TO GET      X01004 37792010
*                                         LENGTH OF DCT          X01004 37796010
         LTR   RF,RF                    NO DEV CHAR TABLE      @YA03928 37797010
         BZ    NODEVC                   BRANCH IF YES          @YA03928 37798010
         L     RJ,AVTCSTCS              ADDRESS OF DCT           X01004 37800010
         BAL   RD,FREEPG                UNFIX DCT                X01004 37804010
NODEVC   EQU   *                                               @YA03928 37806010
         LR    RJ,RUCB                  ADDRESS OF SCBS          X01004 37808010
         LH    RF,TWO(RCORE)            SCB LGTH IN DOUBLEWORDS  X01004 37812010
         BAL   RD,FREEPG2               UNFIX SCB'S              X01004 37816010
         TM    AVTSCOPT,AVTCMBUF        COMMON BUFFER USED       X02004 37820010
         BZ    CKTSO                    NO, CHECK FOR TSO      @Z30X8TM 37824010
         L     RUCB,AVTCBQCB            ADDRESS OF MASTER QCB    X02004 37840010
         USING IEDCMB,RUCB                                       X02004 37844010
         L     RCORE,CMBFIRST-ONE       ADDRESS OF FIRST PREFIX  X02004 37848010
         LR    RJ,RUCB                  ADDR. OF QCB, STCB'S AND X02004 37852010
*                                       PREFIXES FOR COMMBUF     X02004 37856010
         L     RF,CMBLAST-ONE           ADDRESS OF LAST PREFIX   X02004 37860010
         LA    RF,PRELNG(,RF)           ADDR. END OF LAST PREFIX X02004 37864010
         SR    RF,RJ                    LENGTH OF QCB'S, ETC.    X02004 37868010
         BAL   RD,FREEPG                FREE COMMBUF CNTRL BLOCKSX02004 37872010
         LH    RTIOT,CMBDAREA           NUMBER OF DATA AREAS     X02004 37876010
         N     RTIOT,AVTCLRHI           FORCE POSITIVE           X02004 37880010
COMLOOP  EQU   *                                                 X02004 37884010
         LA    RE,EIGHT                 CONSTANT TO LOCATE IDA   X02004 37888010
         SR    RJ,RJ                    CLEAR FOR ICM            X02004 37892010
         ICM   RJ,AD,ONE(RCORE)         ADDRESS OF DATA AREA     X02004 37896010
         SR    RJ,RE                    ADJUST TO IDA LIST PTR   X02004 37900010
         L     RF,FOUR(RJ)              TOTAL LENGTH TO FIX      X02004 37904010
         TM    ZERO(RJ),CCWIDA          IDA TO BE USED           X02004 37908010
         BNO   COMLOOP2                 NO, FIX BUFFER           X02004 37912010
         L     RJ,ZERO(RJ)              ADDRESS OF IDA LIST      X02004 37916010
COMLOOP2 EQU   *                                                 X02004 37920010
         BAL   RD,FREEPG                FREE COMMBUF DATA AREA   X02004 37924010
         LA    RCORE,PRELNG(RCORE)      BUMP TO NEXT PREFIX      X02004 37928010
         BCT   RTIOT,COMLOOP            FIX NEXT DATA AREA       X02004 37932010
CKTSO    EQU   *                        CHECK PRESENCE OF TSO    X02004 37936010
         TM    AVTBIT1,AVTTSON          TSO OR MIXED ENVIOR.     X01004 37940010
         BZ    FREEPOOL                 NO, BRANCH             @G36XRTP 37944010
         ICM   RJ,ALL,AVTTSOPT          ADDR. OF TSINPUT QCB     X02004 37948010
         BZ    FREEPOOL                 BRANCH IF IT'S ZERO    @G36XRTP 37952010
         LA    RF,TSILEN                LENGTH TO FREE         @G36XRTP 37956010
         BAL   RD,FREEPG                PAGE FREE TSINPUT QCB    X02004 37960010
         L     RJ,AVTKA02               ADDRESS OF IEDQKA02     OY00451 37964010
         LTR   RF,RJ                    IS KA IN THE SYSTEM     OY00541 37966010
         BZ    NOKA                     NO, SKIP PAGE FREE      OY00541 37967010
         SH    RF,AVTHA4                ADJUST TO LENGTH        OY00451 37968010
         L     RF,ZERO(RF)              LENGTH TO PAGE FREE     OY00451 37970010
         BAL   RD,FREEPG                UNFIX IEDQKA02          OY00451 37972010
NOKA     EQU   *                                                OY00541 37974010
         LA    RF,AYZLNG                LENGTH OF IEDAYZ       @Z30X8TM 37976010
         L     RJ,AVTTSOPT              ADDRESS OF IEDAYZ      @Z30X8TM 37980010
         ICM   RJ,ALL,TSISCHED-IEDQTSI(RJ)  ADDRESS OF IEDAYZ   OY00541 37984010
         BZ    FREEPOOL                 SKIP PAGEFREE IF NO AYZ@G36XRTU 37986010
         BAL   RD,FREEPG                PAGE FREE IEDAYZ         X01004 37988010
         EJECT                                                          37988110
************************************************************** @G36XRTP 37988210
*        FREEMAIN STORAGE FOR POOLED CONTROL BLOCKS            @G36XRTP 37988310
*               ( PLCB, SAT, SIB, RVT, NAT )                   @G36XRTP 37988410
************************************************************** @G36XRTP 37988510
FREEPOOL EQU   *                                               @G36XRTP 37988610
         ICM   RJ,ALL,AVTSAVTP          GET SAVT ADDRESS       @G36XRTP 37988710
         BZ    NOSAVT                   NO SAVT, SKIP FREEMAIN @G36XRTP 37988810
*                                       FOR POOL AND SAVT      @G36XRTP 37988910
         BM    FREEPLCB                 FREE PLCB'S AND SAVT   @G36XRTP 37989010
         LA    RF,SAVTVMSZ              SIZE OF SAVT IF VM     @G36XRTP 37989110
*                                       ONLY                   @G36XRTP 37989210
         B     FREEAVT                  FREE SAVT ONLY         @G36XRTP 37989310
FREEPLCB EQU   *                                               @G36XRTP 37989410
         L     RF,SAVTPOOL-IEDNSVTD(RJ) GET CONTROL BLOCK      @G36XRTP 37989510
*                                       POOL ADDRESS           @G36XRTP 37989610
         LH    RE,SAVTPLSZ-IEDNSVTD(RJ) GET NUMBER OF DOUBLE   @G36XRTP 37989710
*                                       WORDS IN POOL          @G36XRTP 37989810
         N     RE,AVTCLRHI              CLEAR HIGH ORDER       @G36XRTP 37989910
*                                       HALF-WORD              @G36XRTP 37990010
         SLL   RE,THREE                 MULTIPLY BY 8 FOR      @G36XRTP 37990110
*                                       NUMBER OF BYTES        @G36XRTP 37990210
         ICM   RE,HI,SP250              SUBPOOL 250            @G36XRTP 37990310
         FREEMAIN R,LV=(0),A=(1)        FREE CTL BLK POOL      @G36XRTP 37990410
         LA    RF,SAVTSIZE              GET LENGTH OF SAVT     @G36XRTP 37990510
FREEAVT  EQU   *                                                 X01004 37992010
         ICM   RJ,ALL,AVTSAVTP          GET SAVT ADDRESS       @G36XRYP 37992310
         BAL   RD,FREEPG                UNFIX SECONDARY AVT     OY00532 37994410
NOSAVT   EQU   *                                                OY00532 37995010
         LR    RJ,RAVT                  ADDRESS OF AVT           X01004 38030010
         LA    RF,AVTLNG                LENGTH TO UNFIX          X01004 38040010
         BAL   RD,FREEPG                UNFIX AVT                X01004 38050010
         EJECT                                                          38054810
ENDLOAD1 EQU   *                                                 X01004 38060010
         L     RJ,FOUR(RWTGC)           ADDRESS OF NEXT ENTRY    X01004 38070010
         USING FORCORE,RJ               OPEN WORK AREA DSECT     Y02027 38075010
         XC    ZERO(FOUR,RWTGC),ZERO(RWTGC)  CLOSE COMPLETE      X01004 38080010
RELOOP   EQU   *                                                        38100010
         LA    RWTGC,EIGHT(RWTGC)       BUMP   CURRENT WTG POINTER      38200010
         LA    RPARC,FOUR(RPARC)        LOAD THE POINTER TO THE NEXT    38300010
*                                         ENTRY IN THE DCB              38400010
*                                         PARAMETER LIST                38500010
         CLC   0(2,RWTGC),AMIDCNST      IS THIS EXECUTOR REQUIRED       38600010
*                                         AGAIN                         38700010
         BE    RESTART                  YES, BRANCH TO BEGINNING        38800010
         CLC   0(2,RWTGC),CLOSEIDL      THIS CODE IS USED TO            38900010
         BL    RELOOP                   DETERMINE WHICH OF THE          39000010
         CLC   0(2,RWTGC),CLOSEIDH      CLOSE EXECUTORS TO GIVE         39100010
         BH    RELOOP                   CONTROL TO                      39200010
         LR    RPARC,RPAR               INITIALIZE CURRENT DCB REG      39300010
         LA    RWTGC,32(RWTG)             AND WTG REGISTER              39400010
ZCHECK   EQU   *                                                        39500010
         CLI   0(RWTGC),X'00'           IS THIS ENTRY COMPLETED         39600010
         BNE   XCTLRTNE                 NO, THEN BRANCH          S22024 39700010
         LA    RWTGC,EIGHT(RWTGC)       BUMP POINTER TO TEST FOR        39800010
         LA    RPARC,FOUR(RPARC)          COMPLETION OF THE NEXT        39900010
*                                         ENTRY                         40000010
         B     ZCHECK                   TEST THE NEXT ENTRY      S22024 40100010
XCTLRTNE EQU   *                                                  *     40200010
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           Y02027 40230010
         SPACE 2                                                        40260010
         LA    RJ,DXCCW12               LOAD THE ADDRESS OF THE  Y02027 40300010
*                                         LAST DOUBLE WORD IN THE       40400010
*                                         OPEN WORK AREA                40500010
         OI    TWOTWO(RWTG),NORLD       RESET LENGTH INDICATORS  X01004 40530010
         MVC   TWOFIV(TWO,RWTG),TWOSEV(RWTG) FOR NEXT LOAD TO 1K X01004 40560010
         MVC   6(TWO,RWTG),0(RWTGC)     MOVE ID TO NAME FIELD     *     40600010
         MVC   14(THREE,RWTG),TWO(RWTGC) MOVE TTR TO WTG TABLE          40700010
         XCTL  DE=(RWTG),SF=(E,(15))    TRANSFER CONTROL          *     40800010
         EJECT                                                          40900010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     41000010
*                                                                 *     41100010
*        THIS SECTION OF CODE REMOVES THE AVT ADDRESS FROM        *     41200010
*        THE DISPATCHER PREFIX, AND FREEMAINS ANY LINE BUFFERS    *     41300010
*        AND/OR USER REQUESTED CROSS REFERENCE TABLE AFTER        *     41400010
*        DETERMINING THAT THERE ARE NO MORE DCB'S TO BE CLOSED    *     41500010
*                                                                 *     41600010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     41700010
LASTIME  EQU   *                                                        41800010
         L     RF,CVTPTR                GET CVT ADDRESS          Y02027 41820010
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 41826010
         OI    CVTTCMFG,LASTDCB         INDICATE THAT THE TCAM   Y02027 41832010
*                                         POINTER IN THE CVT IS TO      41840010
*                                         BE CLEARED                    41860010
         B     SETDEB                   RETURN                   X01004 42200010
FREE2260 EQU   *                                                 X01004 42400010
         LR    RC,RF                    SAVE LCB SIZE            X01004 42600010
         L     RF,CVTPTR                ADDRESS OF CVT           Y02027 42800010
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 42900010
         L     RF,CVTAQAVT              ADDRESS OF TCX           Y02027 43000010
         USING IEDQTCX,RF               TCX ADDRESSABILITY       Y02027 43100010
         L     RF,TCXATTEN              ADDR OF 2260 ATTEN RTN   Y02027 43200010
         BAL   RD,FREEPG1               UNFIX 2260 ROUTINE       X01004 43400010
         B     COPYSIZ1                 GO FREE LCB              X01004 43600010
FREEPG3  EQU   *                        FREE PAGE ENTRY FOR APP. X02004 43800010
         SH    RJ,AVTHA4                ADJUST TO LOAD START     X02004 44000010
         L     RF,ZERO(RJ)              LENGTH OF MODULE         X02004 44200010
         B     FREEPG                   PAGE FREE MODULE CORE    X02004 44400010
FREEPG1  EQU   *                                                 X01004 44600010
         LR    RJ,RF                    COPY ADDRESS TO UNFIX    X01004 44800010
         SRL   RF,HIGHBYTE              GET NUM OF DOUBLE-WORDS  X01004 45000010
FREEPG2  EQU   *                                                 X01004 45200010
         SLL   RF,THREE                 CONVERT TO BYTE LENGTH   X01004 45400010
FREEPG   EQU   *                                                 X01004 45600010
         LR    RE,RJ                    SAVE START ADDRESS       Y02027 45800010
         LA    RJ,ZERO(RF,RJ)           BUMP TO END ADDR + 1     Y02027 46200010
         LR    RF,RE                    SET START ADDRESS        Y02027 46600010
         PGFREE R,A=(1),EA=(15)         ISSUE PAGE FREE          Y02027 47000010
         BR    RD                       RETURN TO CALLER         X01004 47400010
         EJECT                                                          48900010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     49000010
*                                                                 *     49100010
*        THIS SECTION OF CODE INCREMENTS THE CROSS REFERENCE      *     49200010
*        TABLE ENTRY POINTER AND CHECKS TO SEE IF WE HAVE         *     49300010
*              PASSED THE LAST POSSIBLE ENTRY                     *     49400010
*                                                                 *     49500010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     49600010
*                                                                       49700010
CHKNEXT  EQU   *                                                        49800010
         LA    RC,CRSFSIZE(RC)          INCREMENT THE CROSS             49900010
*                                         REFERENCE POINTER             50000010
         C     RC,FOUR(RF)              HAVE WE PASSED THE LAST         50100010
*                                         ENTRY IN THE TABLE            50200010
         BH    NEXTENTY                 YES, BRANCH                     50300010
         B     COMPUCB                  CHECK THE NEXT ENTRY IN THE     50400010
*                                         TABLE                         50500010
         EJECT                                                          50600010
AVTLNG   EQU   X'500'                   AVT LENGTH TO FREE       X01004 50720010
AYZLNG   EQU   X'AF4'                   LENGTH OF IEDAYZ       @Z30X8TU 50725010
AD       EQU   7                        ICM/STCM MASK            X01004 50730010
HI       EQU   8                        ICM/STCM MASK            X01004 50735010
HIGHBYTE EQU   24                       SHIFT TO HIGH-ORDER BYTE X01004 50740010
SIXTEN   EQU   16                       OFFSET OF 16             X01004 50745010
INVSIZE  EQU   9                        CONTROL WORDS SIZE (8) +OY00530 50745610
*                                       DELIMITER SIZE (1)      OY00530 50746210
STATUS   EQU   3                        OFFSET OF STATUS BYTE INOY00530 50746810
*                                       INVITATION LIST CONTROL OY00530 50747410
*                                       WORD                    OY00530 50748010
INVEOT   EQU   X'80'                    EOT WAS SPECIFIED ON    OY00530 50748610
*                                       INVLIST MACRO           OY00530 50749210
ALL      EQU   15                       ICM/STCM MASK            X01004 50750010
ZERO     EQU   0                        OFFSET OF 0              X01004 50755010
TWOTWO   EQU   22                       OFFSET OF 22             X01004 50760010
NORLD    EQU   1                        NO RLD IN NEXT MOD.      X01004 50765010
TWOFIV   EQU   25                       OFFSET OF 25             X01004 50770010
TWOSEV   EQU   27                       OFFSET OF 27             X01004 50775010
PCI      EQU   X'0C'                    DCB PCI FLAGS            X01004 50780010
LCB3705  EQU   184                      PLCB SIZE                Y05330 50788010
ONE      EQU   1                        VALUE 1                  S22024 50800010
WAIT     EQU   1                        SVC WAIT                        50900010
TWO      EQU   2                        VALUE TWO                S22024 51000010
THREE    EQU   3                        VALUE THREE              S22024 51100010
FOUR     EQU   4                        VALUE FOUR               S22024 51200010
EIGHT    EQU   8                        VALUE EIGHT              S22024 51400010
FIVE     EQU   5                        VALUE 5                 OY03305 51410010
BUFKEY   EQU   X'1A'                    BUFF TERM SCHED CODE   @XA03965 51430010
TYPE3    EQU   X'70'                    IBM TERM ADAPTER 3       Y02027 51450010
CRSFSIZE EQU   16                       CROSS REFERENCE POINTER  S22024 51700010
PURGE    EQU   16                       SVC PURGE                       51800010
IOSUPAPP EQU   21                       IOS APPENDAGE            S22024 52400010
DSORG    EQU   27                       DCB DSORG OFFSET         S22024 52500010
IOBPTR   EQU   32                       OFFSET TO THE IOB               52600010
DEBPRFIX EQU   36                       LENGTH OF THE DEB PREFIX        52700010
OPTION   EQU   160                      OPTION                   S22024 52810010
GRAPHICS EQU   X'10'                    GRAPHICS DEVICE          S22024 52870010
LASTDCB  EQU   X'0F'                    LAST DCB                 S22024 52930010
DISKDCB  EQU   X'20'                    DISK DCB TYPE            S22024 52990010
LINEDCB  EQU   X'40'                    LINE DCB TYPE            S22024 53050010
POST     EQU   X'40'                    POST FLAG FOR LCB POST  SA60820 53150010
DCB3705  EQU   X'04'                    DSORG = TR               S22024 53150110
DIAL     EQU   X'90'                    DIAL DEVICE              S22024 53300010
XFB      EQU   X'FB'                    USED TO TURN OFF UCB BITSA64788 53410010
LIMIT    DC    H'500'                   5 SECOND DELAY         @SA70907 53700010
THRESHL  DC    H'12'                    LEN THRESH ERRMSG AREA @OZ24288 53750010
         DS    0F                                                       53800010
SP250    DC    X'FA'                    SUBPOOL 250              X01004 53900010
CCWIDA   EQU   4                        INDIRECT ADDRESSING FLAG X02004 53930010
PRELNG   EQU   12                       LENGTH OF COMMBUF PREFIX X02004 53960010
DISABLE  DC    X'2F00000020000001'      DISABLE CCW              S21903 54000010
CLOSEIDL DC    C'0B'                    ID OF LAST CLOSE MODULES S21903 54100010
CLOSEIDH DC    C'0G'                    ID OF LAST CLOSE MODULES S21903 54200010
AMIDCNST DC    C'36'                    ID FOR THIS EXECUTOR     Y02027 54220010
         EJECT                                                          54970010
UCB      DSECT                                                          54980010
         IEFUCBOB                                                       54990010
         EJECT                                                          55000010
         DCBD  DSORG=TX                                                 55100010
DCBEND   EQU   DCBINVLI-IHADCB          END OF DCB             @ZA06161 55130010
         TTNTD                                                   X01004 55160010
         EJECT                                                          55200010
         TDEBD                                                          55300010
         EJECT                                                          55400010
         TTCXD                                                   Y02027 55430010
         EJECT                                                          55460010
         TTCBD                                                          55500010
         EJECT                                                          55600010
FORCORE  DSECT                                                          55630010
         IECDSECT                                                       55660010
         TAVTD                                                          55700010
         EJECT                                                          55800010
         TLCBD                                                          55900010
         EJECT                                                          55920010
         TTSID                                                   X01004 55940010
         EJECT                                                   Y02027 55945010
CVTD     DSECT                          CVT DSECT                Y02027 55950010
         CVT                            CVT                      Y02027 55955010
         IEDCMB                                                  X02004 55960010
         END                                                            56000010
