         TITLE ' IEDQOT01 - TCAM RESOURCE TERMINATION MANAGER '         00200000
IEDQOT01 CSECT                                                          00800021
*A-000000-999999                                               @Y02X6B0 00810000
         SPACE 3                                                        00850005
*  CHANGE ACTIVITY AS FOLLOWS                                           00900005
******************** MICROFICHE FLAGS *********************** SUPT CODE 00950005
*A596000,612000                                                 SA51771 01000005
*D548000-572000,576000-596000,597800,600000-612000               Y01004 01000105
*A572000,5984000                                                SA62368 01000205
*C304000                                                        SA62368 01000305
*D308000-316000,598400-599000,614000-668000,676000-692000       SA62368 01000405
*C292000-304000,597200                                           Y05330 01000505
*D060000-068000,232000-236000,244000,268000,7599600-672000,      Y05330 01000605
*D708000-712000,724000-732000                                    Y05330 01000705
*A778100                                                       @Z30AABG 01000800
*C418802                                                       @Z30AABG 01009800
*D761600                                                       @Z30AABG 01020700
*D345676                                                       @ZA02643 01030700
*C344160,344004-344616,345000-345336,345363-345372,345393      @ZA02601 01040700
*D287000,346395,346480-346780                                  @ZA02601 01050700
*A340000,344622,344760-344770,345480,547802,574000             @ZA02601 01100700
*C345417-345423,345503-345676,345710-345750,345860             @ZA02601 01150700
*C346170-346200,346340-346365,346450-346455                    @ZA02601 01200700
*C424802,587000,590000,602000,605000,607112-607126             @ZA02601 01250700
*C607450-607750,618000,626300-626600,628640-628992             @ZA02601 01300700
*A614000,758000,777000,788000,791200                           @ZA02601 01350700
*C637090-670000                                                @ZA02601 01400700
*C345315-345370                                                @ZA03055 01408700
*A346160                                                       @ZA04027 01416700
*C649090                                                       @ZA04027 01424700
*A547802,759500,778200,798000                                  @Z40X9BG 01432700
*C038000,346460,424802,593000                                  @Z40X9BG 01440700
*C346345-346390                                                @Z40X9BG 01450700
*D345427,345432                                                @ZA07067 01457700
*D345365-345367                                                @ZA07078 01464700
*A345370                                                       @ZA07078 01471700
*A345452,345480                                                @ZA07083 01480700
*C607550-607600                                                @OZ08086 01490700
*C670690                                                       @OZ07798 01500700
*A344180                                                       @OZ07816 01510700
*C344780-344820                                                @OZ07816 01517700
*D345048-345056,614300-614600                                  @OZ07816 01524700
*C758500                                                       @OZ09293 01531700
*C345437-345452                                                @OZ08374 01540700
*C346377                                                       @OZ08384 01551100
*A676290                                                       @OZ16542 01556100
*C656290                                                       @OZ17630 01561100
*A651490,652290,655490,656690,778100                           @OZ17630 01571100
*C346680                                                       @G36XRBB 01580100
*A541862                                                       @G36XRBB 01589100
*                                       PEWA DSECT CHG         @OZ27843 01589282
*A554102                                                       @OZ26963 01589382
*C554102-554312                                                @OZ29317 01589482
*A652690                                                       @OZ32424 01589582
         SPACE 3                                                        01600005
************************START OF SPECFICATIONS************************* 01800000
*                                                                     * 02000000
*                                                                     * 02200000
* MODULE NAME = IEDQOT01                                              * 02300000
*                                                                     * 02400000
* DESCRIPTIVE NAME = RESOURCE TERMINATION MANAGER (RTM)               * 02600000
*                                                                     * 02800000
* COPYRIGHT = NONE                                                    * 03000000
*                                                                     * 03200000
* STATUS = LEVEL 9                                             @Z40X9BG 03400000
*                                                                     * 03600000
* FUNCTION = CLEAN UP TCAM RESOURCES                                  * 03800000
*                                                                     * 04000000
* NOTES = SEE BELOW                                                   * 04200000
*                                                                     * 04400000
*    DEPENDENCIES = NONE                                              * 04600000
*                                                                     * 04800000
*    RESTRICTIONS = NONE                                              * 05000000
*                                                                     * 05200000
*    REGISTER CONVENTIONS = R2  BRANCH AND LINK REGISTER              * 05400000
*                           R3  POINTER TO CVT                        * 05600000
*                           R5  POINTER TO RTM WORK AREA              * 06000000
*                           R6  POINTER TO TCX                        * 06200000
*                           R7  ADDRESS SPACE ID REGISTER             * 06300000
*                           R8  POINTER TO RMPL                       * 06400000
*                           R9  BASE REGISTER                         * 06500000
*                           R10 POINTER TO PEB                        * 06600000
*                           R11 POINTER TO AIB                        * 06800000
*                           R12 POINTER TO PEWA                       * 07200000
*                           R13 SAVE AREA POINTER                     * 07400000
*                                                                     * 07600000
*    PATCH LABEL = PATCH                                              * 07800000
*                                                                     * 08000000
* MODULE TYPE = PROCEDURE                                             * 08200000
*                                                                     * 08400000
*    PROCESSOR = ASSEMBLER XF                                         * 08600000
*                                                                     * 08800000
*    ATTRIBUTES = REENTRANT, SUPERVISOR STATE, KEY 0                  * 09000000
*                                                                     * 09200000
* ENTRY POINT = IEDQOT01                                              * 09400000
*                                                                     * 09600000
*    PURPOSE = SEE FUNCTION                                           * 09800000
*                                                                     * 10000000
*    LINKAGE = CONTROL PASSED TO THIS MODULE FROM IGC0001C VIA        * 10200000
*              A CALL MACRO                                           * 10400000
*                                                                     * 10600000
* INPUT = R1  LOADED WITH THE PARAMETER LIST ADDRESS                  * 10800000
*         R13 POINTS TO STANDARD SAVE AREA                            * 11000000
*         R14 CONTAINS RETURN ADDRESS                                 * 11200000
*         R15 CONTAINS ENTRY POINT OF THIS MODULE                     * 11400000
*                                                                     * 11600000
* OUTPUT = NONE                                                       * 11800000
*                                                                     * 12000000
* EXIT-NORMAL = RETURN TO IGC0001C VIA RETURN MACRO WITH R15 = 0      * 12200000
*                                                                     * 12400000
* EXIT-ERROR = NONE                                                   * 12600000
*                                                                     * 12800000
* EXTERNAL REFERENCES = SEE BELOW                                     * 13000000
*                                                                     * 13200000
*    ROUTINES = NONE                                                  * 13400000
*                                                                     * 13600000
*    DATA AREAS = RESOURCE MANAGER WORK AREA ADDRESSED BY             * 13800000
*                 RMPLRMWA.                                           * 14000000
*                                                                     * 14200000
*    CONTROL BLOCKS = AIB (APPLICATION INTERFACE BLOCK)               * 14400000
*                     AVT (TCAM'S ADDRESS VECTOR TABLE)               * 15000000
*                     CVT                                             * 15200000
*                     PEB (PROCESS EXTENSION BLOCK)                   * 15400000
*                     PEWA (PROCESS ENTRY WORK AREA)                  * 15600000
*                     PSA (PREFIXED SAVE AREA)                        * 15800000
*                     RECB (RESOURCE ELEMENT CONTROL BLOCK)           * 16000000
*                     RMPL (RESOURCE MANGER PARAMETER LIST)           * 16200000
*                     TCX (TCAM CVT EXTENSION)                        * 16400000
*                                                                     * 16600000
* TABLES = NONE                                                       * 16800000
*                                                                     * 17200000
* MACROS = CALLRTM                                                    * 17400000
*          FREEMAIN                                                   * 17600000
*          GETMAIN                                                    * 17800000
*          IOSGEN                                                     * 18000000
*          MODESET                                                    * 18200000
*          SETLOCK                                                    * 18400000
*          TCABEND                                                    * 18600000
*                                                                     * 18800000
* CHANGE ACTIVITY = NONE                                              * 19000000
*                                                                     * 19200000
*************************END OF SPECIFICATIONS************************* 19400000
         EJECT                                                          22000021
*        REGISTER USAGE                                                 22400021
*                                                                       22800021
RZERO    EQU   0                        WORK REGISTER            Y02027 22900000
RONE     EQU   1                        WORK REGISTER            Y02027 23100000
RBRANCH  EQU   2                        BRANCH REGISTER          Y02027 23400000
RCVT     EQU   3                        CVT DSECT BASE REGISTER         24000021
RPEBF    EQU   4                        POINTER TO PEB PRECEDING Y02027 24200000
*                                       THE CURRENT PEB          Y02027 24400000
RRTMWA   EQU   5                        POINTER TO RTM WORK AREA Y02027 24860000
RTCX     EQU   6                        THE TCX BASE REGISTER    Y02027 24920000
RASID    EQU   7                        ADDRESS SPACE ID REG     Y02027 24980000
RUCB     EQU   7                        UCB REGISTER             Y02027 25040000
RRMPL    EQU   8                        ADDR OF RESOURCE MANAGER Y02027 25070000
*                                       PARAMETER LIST           Y02027 25100000
RBASE    EQU   9                        IEDQOT01 BASE REGISTER   Y02027 25150000
RPEB     EQU   10                       PROCESS ENTRY BLOCK ADDR Y02027 25170000
RAIB     EQU   11                       AIB BASE REGISTER        Y02027 25200000
RTCB     EQU   11                       TCB BASE REGISTER        Y02027 25600000
RLOOKUP  EQU   11                       UCB LOOKUP TABLE POINTER Y02027 26000000
RUCBEXT  EQU   12                       UCB EXTENSION            Y02027 26100000
RPEWA    EQU   12                       BASE REG FOR PEWA        Y02027 26220000
RSAVE    EQU   13                       SAVE AREA POINTER        Y02027 26300000
RRECB    EQU   14                       RECB BASE REGISTER       Y02027 26600000
R15      EQU   15                       REGISTER 15              Y02027 26800000
         SPACE 3                                                        27000000
*        REGISTER EQUATES USED ONLY FOR CROSS MEMORY POST        Y02027 27200000
         SPACE 1                                                        27230000
RPOST9   EQU   9                        REG SAVE AREA FOR POST   Y02027 27260000
RPOST10  EQU   10                       COMPLETION CODE          Y02027 27290000
RPOST11  EQU   11                       ECB ADDRESS              Y02027 27320000
RPOST12  EQU   12                       ERRET ENTRY POINT        Y02027 27350000
RPOST13  EQU   13                       ASCB ADDRESS             Y02027 27400000
RPOST14  EQU   14                       RETURN ADDRESS           Y02027 27450000
RPOST15  EQU   15                       POST ENTRY POINT         Y02027 27500000
         SPACE 2                                                        27550000
*                                                                       27600021
         USING CVT,RCVT                 CVT DSECT                       28000021
         USING RTMWA,RRTMWA             WORK AREA DSECT          Y02027 28080000
         USING IEDQPEB,RPEB             PROCESS ENTRY BLOCK ADDR Y02027 28160000
         USING RMPL,RRMPL               RECOVERY PARAMETER LIST  Y02027 28240000
         USING IEDQTCX,RTCX             TCX DSECT                Y02027 28320000
         USING IEDQPEWA,RPEWA           PROCESS ENTRY WORK AREA  Y02027 28400000
         USING IEDQAIB,RAIB             AIB DSECT                Y02027 28500000
         EJECT                                                          28600000
***************************************************************  Y02027 28700000
*                                                             *  Y02027 28800000
*        SET UP BASE REGISTER AND PARAMETER LIST              *  Y02027 28850000
*        ADDRESSABILITY                                       *  Y02027 28900000
*                                                             *  Y02027 28950000
***************************************************************  Y02027 29000000
         SAVE  (14,12)                  SAVE THE CALLER'S REGS   Y02027 29050000
         SPACE 2                                                        29100000
         LR    RBASE,R15                SET BASE REGISTER        Y02027 29150000
         USING IEDQOT01,RBASE           ADDRESSABILITY           Y02027 29200000
         SPACE 2                                                        30000000
IEDQOT01 IEDHJN START                   SET DATE                 Y02027 30800000
         SPACE 2                                                        31600000
         L     RRMPL,ZERO(RONE)         LOAD THE PARAMETER LIST  Y02027 32000000
*                                       ADDRESS                  Y02027 32400000
         L     RRTMWA,RMPLRMWA          GET ADDR OF RTM WORK AREAY02027 33200000
         ST    RSAVE,SAVE13             SAVE CALLER'S REG 13 IN  Y02027 33400000
*                                       WORK AREA                Y02027 33600000
         SR    RCVT,RCVT                CLEAR FOR STORE        @ZA02601 33800000
         ST    RCVT,PTRSA               CLEAR SAVE AREA POINTER@ZA02601 34000000
         L     RCVT,CVTPTR              LOAD THE CVT ADDRESS            34400021
         EJECT                                                          34401000
***************************************************************  Y02027 34402000
*                                                             *  Y02027 34404000
*        IF TCAM IS NOT IN THE SYSTEM, THEN SKIP IEDQOT01     *  Y02027 34406000
*                                                             *  Y02027 34408000
***************************************************************  Y02027 34410000
         ICM   RTCX,ADDR,CVTAQAVT+ONE   GET TCX ADDRESS          Y02027 34412000
         BZ    RETURN1                  IF TCX ADDR IS 0, THEN @ZA02601 34414000
*                                       BRANCH                   Y02027 34416000
         BAL   RBRANCH,GETSA            GET SAVE AREA          @OZ07816 34418000
         BAL   RBRANCH,LOCK             GET LOCAL & CMS LOCK   @OZ07816 34418400
         CLM   RTCX,ADDR,CVTAQAVT+ONE   TCX STILL VALID        @OZ07816 34418800
         BNE   RETURN                   NO, RETURN             @OZ07816 34419200
         SPACE 3                                                 Y02027 34419600
***************************************************************  Y02027 34420000
*                                                             *  Y02027 34422000
*        DETERMINE IF THE TERMINATING TASK OR MEMORY IS TCAM  *  Y02027 34424000
*                                                             *  Y02027 34426000
***************************************************************  Y02027 34430000
         TM    RMPLFLG1,RMPLTERM        IS THIS A MEMORY         Y02027 34432000
*                                         TERMINATION            Y02027 34438000
         BO    TASKTEST                 YES, BRANCH              Y02027 34440000
         CLC   RMPLTCBA+ONE(L3),TCXTCB+ONE DOES TCAM'S TCB ADDR  Y02027 34442000
*                                       MATCH THAT OF THE        Y02027 34444000
*                                       TERMINATING TASK         Y02027 34445000
         BNE   PROCTERM                 NO, BRANCH               Y02027 34446000
TASKTEST EQU   *                                                 Y02027 34448000
         CLC   RMPLASCB+ONE(L3),TCXASCB+ONE DOES TCAM'S ASCB ADDRY02027 34450000
*                                       MATCH THAT OF THE        Y02027 34452000
*                                       TERMINATING MEMORY OR    Y02027 34452800
*                                       THE MEMORY OF THE        Y02027 34453600
*                                       TERMINATING TASK         Y02027 34454400
         BNE   PROCTERM                 NO, BRANCH               Y02027 34455200
         SPACE 2                                                        34456000
***************************************************************  Y02027 34458000
*                                                             *  Y02027 34458300
*        CHECK TCXRTM. IF THE FLAG IS SET, THEN IEDQOT01 HAS  *  Y02027 34458400
*        ALREADY BEEN CALLED FOR TCAM MCP TERMINATION  --     *  Y02027 34458600
*        RETURN TO CALLER. IF TCXRTM IS NOT SET, CONTINUE.    *  Y02027 34458900
*                                                             *  Y02027 34459000
***************************************************************  Y02027 34459200
         OI    TCXFLAG1,TCXMCPCD        INDICATE THAT TCAM IS  @ZA02601 34460100
*                                       TERMINATING AND THAT     Y02027 34461000
*                                       RTM HAS BEEN CALLED      Y02027 34461900
         OI    TCXFLAG1,TCXMCPCD        AGAIN FOR MP           @ZA02601 34462200
         EJECT                                                          34462500
***************************************************************  Y02027 34462800
*                                                             *  Y02027 34463200
*        ISSUE TCABEND IF TSO IS ACTIVE                       *  Y02027 34463600
*                                                             *  Y02027 34464000
***************************************************************  Y02027 34468000
         ICM   RONE,ALL,TCXRPT          IS TSO ACTIVE            Y02027 34470000
         BZ    CHKPEB                   NO, BRANCH               Y02027 34472000
         TM    TCXFLAG1,TCXRTM          RECURRSION ON MCP ABEND@ZA02601 34475000
         BO    CHKPEB                   YES, BRANCH            @ZA02601 34476000
         BAL   RBRANCH,UNLOCK           RELEASE LOCKS          @OZ07816 34477000
         TCABEND ,                      ABEND TSO                Y02027 34478000
         BAL   RBRANCH,GETSA            GET SAVE AREA          @OZ07816 34481000
         BAL   RBRANCH,LOCK             GET LOCAL & CMS LOCK   @OZ07816 34484000
         CLM   RTCX,ADDR,CVTAQAVT+ONE   TCX STILL VALID        @OZ07816 34487000
         BNE   RETURN                   NO, RETURN             @OZ07816 34490000
         EJECT                                                          34493000
***************************************************************@ZA02601 34498000
*                                                              @ZA02601 34500000
*        CHECK FOR APPLICATION WAITING ON MCP                  @ZA02601 34500800
*                                                              @ZA02601 34501600
***************************************************************@ZA02601 34502400
CHKPEB   EQU   *                                               @ZA02601 34503200
         LA    RAIB,TCXAIBC             PTR TO AIBS            @ZA02601 34504000
LOOPAIB  EQU   *                                               @ZA02601 34506400
         ICM   RAIB,ADDR,AIBCHAIN       GET AIB                @ZA02601 34507200
         BZ    CHKPEB1                  END OF CHAIN           @ZA02601 34508000
         TM    AIBSTATE-IEDQAIB(RAIB),ABEND AIB IN USE         @ZA02601 34508800
         BNO   LOOPAIB                  NO, SKIP TO NEXT       @ZA02601 34509600
         L     RRECB,AIBECBA-IEDQAIB(RAIB) GET OPEN/CLOSE FLAG @ZA02601 34510400
         CLM   RRECB,ALL,OPEN           OPEN IN PROGRESS       @ZA02601 34511200
         BNE   CLOSEAIB                 NO, CHECK CLOSE        @ZA02601 34512000
         MVI   RCBERR-IEDQRECB+AIBKEY-IEDQAIB(RAIB),NOTCAM     @ZA02601 34512800
*                                       SET TCAM NOT IN SYSTEM @ZA02601 34513600
         B     APPLPOST                 POST APPL OPEN         @ZA02601 34514400
CLOSEAIB EQU   *                                               @ZA02601 34515200
         CLM   RRECB,ALL,CLOS           CLOSE IN PROGRESS      @ZA02601 34516000
         BE    APPLPOST                 YES, POST APPL COMPLETE@ZA02601 34516800
         B     LOOPAIB                  CHECK NEXT AIB         @ZA02601 34517600
CHKPEB1  EQU   *                                               @ZA02601 34518400
         LA    RPEB,TCXPEBC             DUMMY FIRST PEB        @ZA02601 34519200
LOOPPEB  EQU   *                                               @ZA02601 34520000
         LTR   RPEBF,RPEB               COPY PEB ADDRESS       @ZA02601 34520800
         BZ    FREESA                   END OF PEB CHAIN       @ZA02601 34521600
         ICM   RPEB,ALL,PEBLINK         GET NEXT PEB           @ZA02601 34522400
         BZ    FREESA                   END OF PEB CHAIN       @ZA02601 34523200
         CLC   PEBASCB,QOT1             RTM ALREADY TRIED PEB  @ZA02601 34524000
         BNE   CALLRTM                  PEB NOT PROCESSED BY   @ZA02601 34524800
*                                       RTM                    @ZA02601 34525600
RMVPEB   EQU   *                                               @ZA02601 34526400
         BAL   RRECB,DLKPEWA            DELINK PEWA AND PEB    @ZA02601 34527200
         B     LOOPPEB                  CHECK NEXT PEB         @ZA02601 34528000
APPLPOST EQU   *                                               @ZA02601 34528800
         XC    AIBECBA-IEDQAIB(FOUR,RAIB),AIBECBA-IEDQAIB(RAIB) ZA02601 34529600
*                                       CLEAR SPECIAL FLAG     @ZA02601 34530400
***************************************************************  Y02027 34531200
*                                                             *  Y02027 34533900
*        SAVE REGISTERS AND SET UP FOR BRANCH ENTRY INTO      *  Y02027 34534200
*        CROSS MEMORY POST TO POST APPLICATION PROGRAM CLOSE  *  Y02027 34534500
*                                                             *  Y02027 34534800
***************************************************************  Y02027 34535100
         L     RONE,PTRSA               GET POINTER TO SAVE AREA Y02027 34535400
         STM   RZERO,R15,ZERO(RONE)     SAVE ALL REGISTERS       Y02027 34535700
         L     RPOST13,RCBASCB-IEDQRECB+AIBKEY-IEDQAIB(RAIB)   @ZA02601 34536000
*                                       GET ASCB ADDRESS       @ZA02601 34536100
         SR    RPOST10,RPOST10          CLEAR FOR COMP CODE    @ZA02601 34536200
         IC    RPOST10,RCBERR-IEDQRECB+AIBKEY-IEDQAIB(RAIB) SET@ZA02601 34536300
*                                       COMPLETION CODE        @ZA02601 34536400
         L     RPOST11,RCBPECB-IEDQRECB+AIBKEY-IEDQAIB(RAIB)   @ZA07078 34536500
*                                        ECB ADDRESS           @ZA07078 34536600
         ICM   RPOST11,HIGHORDR,HIBIT   SET CROSS MEM POST     @ZA07078 34536700
         LA    RPOST12,CVTBRET          LOAD BR 14 AS ERRET ADDR Y02027 34536800
         L     RPOST15,CVT0PT01         POST ENTRY PT IEA0PT01   Y02027 34536900
         LR    RPOST9,RONE              SAVE AREA ADDR           Y02027 34537000
         BALR  RPOST14,RPOST15          POST ECB                 Y02027 34538100
         SPACE 1                                                        34538200
         LM    RZERO,R15,ZERO(RPOST9)   RESTORE REGISTERS        Y02027 34538400
         B     LOOPAIB                  CHECK NEXT AIB         @ZA02601 34538700
         EJECT                                                          34538800
***************************************************************  Y02027 34539000
*                                                             *  Y02027 34539300
*        ISSUE CALLRTM FOR APPLICATION PROGRAM                *  Y02027 34540200
*                                                             *  Y02027 34540500
***************************************************************  Y02027 34540800
CALLRTM  EQU   *                                                 Y02027 34541100
         ICM   RTCB,ALL,PEBTCB          TCB ADDRESS            @ZA02601 34541400
         BZ    RMVPEB                   BRANCH NO TCB          @ZA02601 34541700
         TM    PEBFLAG,PEBTERM          APPL ALREADY TERMINTED @OZ08374 34542200
         BO    RMVPEB                   YES, DELINK PEB & PEWAS@OZ08374 34542700
         L     RASID,PEBASID            ASID FOR APPL          @OZ08374 34543200
         L     RSAVE,PTRSA              GET SAVE AREA ADDRESS  @OZ08374 34543700
         CLC   PEBASCB+1(L3),PSAAOLD+1-PSA(RZERO) IS A.P. A    @OZ08374 34544000
*                                       SUBTASK OF THE MCP     @OZ08374 34544100
         BNE   DUMP                     BR, NO                 @OZ08374 34544200
         TM    TCBFLGS-IEDQTCB(RTCB),TERM  IS A.P. TERMINATING @OZ08374 34544300
         BNZ   DUMPED                   YES,SET TERMINATING BIT@OZ08374 34544400
DUMP     EQU   *                                               @OZ08374 34544500
         TM    TCXFLAG1,TCXAPDMP        IS APPL DUMP REQUESTED @OZ08374 34544600
         BZ    NODUMP                   NO, DON'T REQUEST DUMP @OZ08374 34544700
         CALLRTM TYPE=ABTERM,COMPCOD=X'046',TCB=(RTCB),ASID=(RASID),   *34544800
               DUMP=YES                                        @ZA07083 34544900
         B     DUMPED                   DUMP REQUESTED         @ZA07083 34545000
NODUMP   EQU   *                                               @ZA07083 34545100
         CALLRTM TYPE=ABTERM,COMPCOD=X'046',TCB=(RTCB),ASID=(RASID),   *34545300
               DUMP=NO                                           Y02027 34546000
DUMPED   EQU   *                                               @ZA07083 34548000
         OI    PEBFLAG,PEBTERM          MARK APPL TERMINATED   @ZA02601 34548600
         B     LOOPPEB                  PROCESS NEXT PEB       @ZA02601 34549200
         EJECT                                                   Y02027 34549600
FREESA   EQU   *                                               @ZA02601 34550000
         TM    TCXFLAG1,TCXRTM          RECURRSION             @ZA02601 34550500
         BO    PEBFREE                  YES, BRANCH            @ZA02601 34551000
         OI    TCXFLAG1,TCXRTM          SET RECURRSION FLAG    @ZA02601 34551700
         TM    RMPLFLG1,RMPLTERM        IS THIS MCP MEMORY     @ZA02601 34552400
*                                       TERMINATION            @ZA02601 34553100
         BO    PEBFREE                  YES, FREE CNTRL BLOCKS @ZA02601 34553800
         ICM   RPEB,ALL,TCXPEBC         FIRST PEB ON CHAIN     @ZA02601 34554500
         BNZ   RETURN                   CHAIN NOT EMPTY        @ZA02601 34554800
PEBFREE  EQU   *                                               @ZA02601 34555200
         L     RPEB,TCXPEBC             FIRST PEB ON CHAIN     @ZA02601 34556600
         SR    RONE,RONE                CLEAR FOR CS           @ZA02601 34557300
PEBFREE1 EQU   *                                               @ZA02601 34558000
         CS    RPEB,RONE,TCXPEBC        REMOVE PEBS FROM CHAIN @ZA02601 34558700
         BNE   PEBFREE1                 RETRY IF FAILED        @ZA02601 34559400
FRPEBS   EQU   *                                               @ZA02601 34560100
         LTR   RPEB,RPEB                END OF CHAIN           @ZA02601 34560800
         BZ    FREEPEWA                 YES, BRANCH            @ZA02601 34561500
         LR    RONE,RPEB                COPY PEB ADDRESS       @ZA02601 34562200
         L     RPEB,PEBLINK             NEXT PEB               @ZA02601 34562900
         LA    RZERO,PEBSIZE            LENGTH OF PEB          @ZA02601 34563600
         BAL   RBRANCH,FREE231          FREE PEB               @ZA02601 34564300
         B     FRPEBS                   FREE NEXT PEB          @ZA02601 34565000
         EJECT                                                          34565700
*********************************************************************** 34566200
*                                                                     * 34566700
*        FREE PROCESS ENTRY WORK AREAS (PEWA'S)                  Y02027 34567200
*                                                                     * 34568000
*********************************************************************** 34568600
FREEPEWA EQU   *                                                 Y02027 34569200
         SR    RONE,RONE                CLEAR FOR CS           @ZA02601 34570000
         L     RPEWA,TCXPEWAC           PEWA CHAIN             @ZA02601 34571000
FRPEWA1  EQU   *                                               @ZA02601 34572000
         CS    RPEWA,RONE,TCXPEWAC      REMOVE PEWAS FOR CHAIN @ZA02601 34573000
         BNE   FRPEWA1                  RETRY IF FAILED        @ZA02601 34574000
FRPEWA   EQU   *                                                 Y02027 34575000
         LTR   RPEWA,RPEWA              IS THERE A PEWA          Y02027 34578000
         BZ    FREEAIBS                 NO, BRANCH               Y02027 34580000
         LR    RONE,RPEWA               LOAD THE PEWA ADDRESS    Y02027 34582000
         ICM   RPEWA,ADDR,PEWALINK+ONE  GET ADDR OF NEXT PEWA    Y02027 34584000
         SR    RBRANCH,RBRANCH          CLEAR REG              @ZA02601 34585000
         IC    RBRANCH,TCXSCBSZ         SCB SIZE               @ZA02601 34586000
         LA    RBRANCH,PEWASIZE(RBRANCH) ADD PEWA SIZE         @ZA02601 34586200
         TM    PEWAOPT2-IEDQPEWA(RONE),PEWAIN  INPUT DCB       @ZA02601 34586400
         BNO   FRPEWAS                  NO, BRANCH             @ZA02601 34586600
         LA    RBRANCH,TRT(RBRANCH)     ADD TRT SIZE           @ZA02601 34586800
FRPEWAS  EQU   *                                               @ZA02601 34587000
         LA    RZERO,LCBCHAIN-IEDQLCB+FOUR ADJUST FOR LCB      @ZA02601 34587200
         SR    RONE,RZERO               SET ADDR FOR FREEMAIN  @ZA02601 34587400
         AR    RZERO,RBRANCH            SET LENGTH FOR FREEMAIN@ZA02601 34587600
         BAL   RBRANCH,FREE231          FREE PEWA IN SUBPOOL 231 Y02027 34587800
         SPACE 1                                                 Y02027 34588000
         B     FRPEWA                   TEST FOR ANOTHER PEWA    Y02027 34590000
         EJECT                                                          34592000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  Y02027 34602000
*                                                             *  Y02027 34604000
*        THIS SECTION OF CODE WILL SEARCH THE TCX APPLICATION    Y02027 34606000
*        INTERFACE BLOCK (AIB) CHAIN AND FREE ANY AIB'S          Y02027 34608000
*        REMAINING ON THE CHAIN.                                 Y02027 34609000
*                                                             *  Y02027 34610000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  Y02027 34612000
FREEAIBS EQU   *                                                 Y02027 34614000
         TM    TCXFLAG1,TCXMCPCD        MCP TERMINATED         @ZA04027 34616000
         BNO   RETURN                   NO EXIT                @ZA04027 34616600
         SR    RONE,RONE                CLEAR FOR CS           @ZA02601 34617000
         L     RAIB,TCXAIBC             CHAIN OF AIBS          @ZA02601 34617500
FRAIBS1  EQU   *                                               @ZA02601 34618000
         CS    RAIB,RONE,TCXAIBC        REMOVE AIBS FROM CHAIN @ZA02601 34619000
         BNE   FRAIBS1                  RETRY IF FAILED        @ZA02601 34620000
FRAIBS   EQU   *                                                 Y02027 34621000
         LTR   RAIB,RAIB                IS THERE AN AIB          Y02027 34622000
         BZ    FREESRBS                 NO, BRANCH             @Z49X9BG 34624000
         LR    RONE,RAIB                COPY THE AIB ADDRESS     Y02027 34626000
         ICM   RAIB,ADDR,AIBCHAIN       GET ADDR OF NEXT AIB     Y02027 34628000
         LH    RZERO,TCXSZAIB           GET AIB SIZE             Y02027 34629000
         BAL   RBRANCH,FREE231          FREE AIB IN SUBPOOL 231  Y02027 34629100
         B     FRAIBS                   TEST FOR ANOTHER AIB   @ZA02601 34629200
         EJECT                                                 @Z40X9BG 34629300
************************************************************** @Z40X9BG 34629400
*                                                            * @Z40X9BG 34629500
*        FREE SRB'S USED FOR POST FUNCTION                   * @Z40X9BG 34629600
*                                                            * @Z40X9BG 34629700
************************************************************** @Z40X9BG 34629800
FREESRBS EQU   *                                               @Z40X9BG 34629900
         SLR   RZERO,RZERO              CLEAR FOR CS           @Z40X9BG 34630000
         L     RONE,TCXSRBS             GET PTR TO SRB'S       @Z40X9BG 34631000
FRSRB1   EQU   *                                               @Z40X9BG 34632000
         LTR   RONE,RONE                ANY SRB'S TO FREE      @Z40X9BG 34633000
         BZ    RESTAB                   NO, BRANCH             @Z40X9BG 34634000
         CS    RONE,RZERO,TCXSRBS       DECHAIN SRB'S          @Z40X9BG 34635000
         BNE   FRSRB1                   BRANCH IF DECHAIN      @Z40X9BG 34636000
*                                       UNSUCESSFUL            @Z40X9BG 34637000
         SPACE 2                                               @Z40X9BG 34638000
************************************************************** @Z40X9BG 34639000
*                                                            * @Z40X9BG 34640000
*        BRANCH ENTER FREEMAIN - ENTRY EXPECTS TCB ADDRESS   * @Z40X9BG 34641000
*        IN REG 4 AND ASCB ADDRESS IN REG 7. EXPANSION       * @Z40X9BG 34642000
*        DESTROYS REGS 3,14 AND 15 AND CODE USES REG 7.      * @Z40X9BG 34643000
*                                                            * @Z40X9BG 34644000
************************************************************** @Z40X9BG 34645000
FREES    EQU   *                                               @Z40X9BG 34646000
         LA    RPEB,SRBBLKSZ-SIZESRB(,RONE) POINT TO LAST      @Z40X9BG 34647000
*                                       SRB IN THE BLOCK       @Z40X9BG 34648000
         ICM   RPEB,ADDR,ONE(RPEB)      SAVE ADDR OF FIRST SRB @Z40X9BG 34649000
*                                       IN NEXT BLOCK          @Z40X9BG 34650000
         L     RSAVE,PTRSA              GET SAVE AREA POINTER  @Z40X9BG 34651000
         STM   RBRANCH,R15,ZERO(RSAVE)  SAVE REGISTERS         @Z40X9BG 34652000
         L     RPEBF,PSATOLD-PSA(,RZERO) SET TCB ADDRESS       @VS41904 34653000
         L     RASID,PSAAOLD-PSA(,RZERO) SET ASCB ADDRESS      @VS41904 34654000
         LA    RZERO,SRBBLKSZ           GET SRB BLOCK SIZE     @OZ08384 34655000
         FREEMAIN RU,LV=(0),A=(1),SP=SQA,KEY=KEY0,BRANCH=YES   @Z40X9BG 34656000
         LM    RBRANCH,R15,ZERO(RSAVE)  RESTORE REGISTERS      @Z40X9BG 34657000
         LTR   RONE,RPEB                POINT TO NEXT SRB BLK  @Z40X9BG 34658000
         BNZ   FREES                    FREE NEXT BLOCK OF SRBS@Z40X9BG 34660000
         EJECT                                                          34661000
RESTAB   EQU   *                                               @ZA02601 34662000
         TM    TCXFLAG1,TCXMCPCD+TCXRTM MCP TERMINATED         @ZA02601 34663000
         BNO   RETURN                   NO EXIT                @ZA02601 34664000
         SPACE 2                                               @Z49X9BG 34665000
***************************************************************  Y02027 34666000
*                                                             *  Y02027 34667000
*        RESTORE ATTENTION TABLE POINTER SAVED BY TCAM OPEN   *  Y02027 34668000
*                                                             *  Y02027 34669000
***************************************************************  Y02027 34670000
         L     RONE,CVTIXAVL            GET POINTER TO IOCOM   @Z49X9BG 34678000
         USING IOCOM,RONE               IOCOM ADDRESSABILITY   @Z49X9BG 34686000
         L     RONE,IOCATTBL            GET ATTN TABLE POINTER   Y02027 34694000
         USING ATB,RONE                 ATTN TABLE ADDRESSABILITYY02027 34702000
         LA    RONE,TCAM(RONE)          INCREMENT ATTN TABLE ADDRY02027 34710000
         MVC   ATBRTN,TCXSATTN          RESTORE INITIAL VALUE OF Y02027 34718000
*                                       ATTN ROUTINE POINTER     Y02027 34726000
*                                       FOR TCAM                 Y02027 34734000
         SR    RBRANCH,RBRANCH          CLEAR FOR STH          @ZA02601 34742000
         STH   RBRANCH,ATBASID          CLEAR ASID VALUE       @ZA02601 34750000
         DROP  RONE                                            @ZA02601 34758000
         SPACE 4                                               @Z40X9BG 34766000
************************************************************** @Z40X9BG 34774000
*                                                            * @Z40X9BG 34782000
*        RESET TCAM'S PURGE ENTRY IN THE VECTOR OF IOS       * @Z40X9BG 34790000
*        DRIVERS (VOID)                                      * @Z40X9BG 34798000
*                                                            * @Z40X9BG 34806000
************************************************************** @Z40X9BG 34814000
         L     RONE,CVTIXAVL            GET POINTER TO IOCM    @Z40X9BG 34822000
         USING IOCOM,RONE               IOCOM ADDRESSABILITY   @Z40X9BG 34830000
         L     RONE,IOCVOID             GET ADDR OF VOID       @Z40X9BG 34838000
         USING VOID,RONE                VOID ADDRESSABILITY    @Z40X9BG 34846000
         LA    RONE,VOIEL*IOSTCMID(,RONE) GET ADDR OF TCAM'S   @G36XRBB 34854000
*                                       SLOT IN THE VOID       @Z40X9BG 34862000
         MVC   VOIPRG,VOIRSTR           RESET PURGE ADDR TO    @Z40X9BG 34870000
*                                       SAME NO-OP ADDRESS     @Z40X9BG 34878000
*                                       USED FOR RESTORE ADDR  @Z40X9BG 34886000
         DROP  RONE                                            @Z40X9BG 34894000
         EJECT                                                   Y02027 34902000
***************************************************************  Y02027 34910000
*                                                             *  Y02027 34918000
*        RESET TABS IN TCAM UCB'S                             *  Y02027 34926000
*                                                             *  Y02027 34934000
***************************************************************  Y02027 34942000
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y02027 34950000
         USING UCBCMEXT,RUCBEXT         UCB EXTENSION            Y02027 34958000
*                                       ADDRESSABILITY           Y02027 34966000
         L     RLOOKUP,CVTILK2          LOAD THE ADDRESS OF THE  Y02027 34980200
*                                       UCB HALFWORD ADDRESS LISTY02027 37080200
*                                       SECTION IN THE UCB       Y02027 37380200
*                                       LOOKUP TABLE             Y02027 37680200
         SR    RUCB,RUCB                CLEAR FOR INSERT         Y02027 37980200
         SPACE 3                                                        38280200
***************************************************************  Y02027 38580200
*                                                             *  Y02027 38880200
*        RESET THE ERROR TAB IN ANY NON-BISC UCB'S MODIFIED   *  Y02027 39180200
*        BY TCAM                                              *  Y02027 39480200
*                                                             *  Y02027 39780200
***************************************************************  Y02027 40080200
GETUCBAD EQU   *                                                 Y02027 40380200
         ICM   RUCB,HALF,ZERO(RLOOKUP)  GET THE ADDR OF THE      Y02027 40680200
*                                       FIRST/NEXT UCB           Y02027 40980200
         BZ    NEXTUCB                  IF ADDR IS 0, BRANCH     Y02027 41280200
         CLM   RUCB,HALF,ENDUCB         IS THIS THE END OF THE @Z30AABG 41580200
*                                       UCB LOOKUP TABLE         Y02027 41880200
         BE    FREEIOSB                 YES, BRANCH            @Z40X9BG 42180200
         L     RUCBEXT,UCBEXTPT         GET UCB EXTENSION ADDR   Y02027 42480200
         CLI   UCBETI,NONBISC           IS THIS A NON-BISC LINE  Y02027 42780200
         BNE   TESTBISC                 NO, BRANCH               Y02027 43080200
         LR    R15,RUCB                 SET UCB ADDR             Y02027 43380200
         IOSGEN TP,VAR=29,UCB=(R15)     RESET THE ERROR TAB      Y02027 43680200
         SPACE 3                                                        44280200
         B     TESTATTN                 GO CHECK ATTN TAB        Y02027 44480200
         EJECT                                                          44680200
***************************************************************  Y02027 44880200
*                                                             *  Y02027 46880200
*        RESET THE ERROR TAB IN ANY BISC UCB'S MODIFIED       *  Y02027 49680200
*        BY TCAM                                              *  Y02027 50280200
*                                                             *  Y02027 50580200
***************************************************************  Y02027 50880200
TESTBISC EQU   *                                                 Y02027 51180200
         CLI   UCBETI,BISC              IS THIS A BISC LINE      Y02027 51480200
         BNE   NEXTUCB                  NO, BRANCH               Y02027 51780200
         LR    R15,RUCB                 SET UCB ADDR             Y02027 52080200
         IOSGEN TP,VAR=2B,UCB=(R15)     RESET BISC ERROR TAB     Y02027 52380200
         EJECT                                                          52980200
***************************************************************  Y02027 53180200
*                                                             *  Y02027 53380200
