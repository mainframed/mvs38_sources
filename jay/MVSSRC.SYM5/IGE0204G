         TITLE 'IGE0204G TCAM CONTROL UNIT NOT OPERATIONAL && START/STOC00600022
               P UNIT EXCEPTION && TIME OUT ERP'                        01200022
IGE0204G CSECT                                                          02000020
*A-000000-999999                                               @Y02X6E0 02020008
*CHANGE ACTIVITY= AS FOLLOWS:                                           02050022
******************** MICROFICHE FLAGS *********************** SUPT CODE 02070005
*A744770-744820,755930-755960,756966-756984                      A48248 02100005
*A300000,431000-435000,490300-492700,580400-581600               S22025 02100105
*A740060-748940,755000-758700                                    S22025 02100205
*C010000,060000-110000,220000                                    S22025 02100305
*C742040,742340,743720,745880,755700,756500,757100-758100        S22025 02100405
*C757990                                                        SA55420 02100505
*C741020,741080,755800                                          SA55958 02100605
*A741080,741110,755850                                          SA55958 02100705
*C055000,060000                                                  S21903 02100805
*D491200,748160,755600                                           S21903 02100905
*A740660,744780,755850                                          SA59006 02101005
*C744780                                                        SA59006 02101105
*D740900-740960                                                 SA59006 02101209
*A212000,213000-213500,252000,307000,315000,434100,482000-484000,Y02027 02101309
*A567000,710300,775000                                           Y02027 02101409
*C150000,180000,212500,218000-220000,240000,246000,310000,450000,Y02027 02101509
*C710000,712000,712700-713000,717800,746096-746104,748520        Y02027 02101609
*C741460                                                        OY00469 02101709
*C070000,580000                                                @Z30AAEE 02101809
*D530000                                                       @Z30AAEE 02101909
*A744900                                                       @SA70884 02102009
*A580000,581600                                                @SA74263 02102109
*D740300                                                       @SA74263 02102209
*C744784                                                       @YA10219 02102309
*C746104                                                       @OZ07810 02102481
*C744784-744790                                                @OY12267 02102591
*C596000                                                       @OY14092 02102691
*A757000                                                       @OZ29402 02102782
*C640000,670000                                                @OZ29402 02102882
         SPACE 3                                                        03900205
*********************************************************************** 04000020
*                                                                     * 05000020
*MODULE-NAME= IGE0204G                                           S21903 05500022
*                                                                S21903 05700022
*DESCRIPTIVE-NAME= START/STOP ERP (THIRD LOAD)                   S21903 05900022
*                                                                S21903 06100022
*COPYRIGHT= 'NONE'                                               S21903 06300022
*                                                                     * 06500022
*  STATUS: CHANGE LEVEL 8                                      @Z30AAEE 07000008
*                                                                     * 07500022
* FUNCTION -- TO ISSUE WTO REFLECTING CONTROL UNIT STATUS.  FOR  S22025 08000022
*   UNIT EXCEPTIONS, TO ATTEMPT TO CLEAR ERROR SITUATION BY      S22025 08500022
*   ISSUING A BREAK COMMAND OR READ SKIP.  THE ACTION TAKEN IS   S22025 09000022
*   DEVICE DEPENDENT.  FOR TIME OUTS, ACTION IS ALSO DEVICE AND  S22025 09500022
*   OPERATION DEPENDENT.  THE FAILING CCW MAY BE RETRIED OR A    S22025 10000022
*   BREAK COMMAND MAY BE ISSUED.                                 S22025 10500022
*                                                                     * 11000022
*ENTRY POINTS -- FIRST EXECUTABLE INSTRUCTION.                        * 12000020
*                                                                     * 13000020
*INPUT --                                                             * 14000020
*   R1 - POINTER TO I/O SUPERVISOR BLOCK                         Y02027 15000006
*   R15 - ENTRY POINT ADDRESS                                         * 16000020
*                                                                     * 17000020
*OUTPUT -- R1 POINTS TO I/O SUPERVISOR BLOCK                     Y02027 18000006
*                                                                     * 19000020
*EXTERNAL ROUTINES - 'WTO' - FOR MESSAGE TO SYSTEM CONSOLE            * 20000020
*                  - IGG019QE (AOS/TCAM SIO APPENDAGE) - TO CONVERT   * 20300006
*   VIRTUAL CCW ADDRESSES TO REAL BEFORE RETRY.                       * 20600006
*                                                                     * 21000020
*EXITS-NORMAL -- R1 POINTS TO I/O SUPERVISOR BLOCK               Y02027 21200006
*        SVC   15   'ERP IN CONTROL (IOSERR)' AND 'EXCEPTIONAL   Y02027 21250006
*                CONDITION(IOSEX)'. RETURN TO IOS TO RETRY THE   Y02027 21300006
*                   ERROR.                                       Y02027 21350006
*                SVC  3                                          S22025 21400022
*                                                                     * 21600022
*        SVC   15   'NO ERROR FLAGS'. RETURN TO LINE END         Y02027 21800006
*                   APPENDAGE. ERROR CLEARED                     Y02027 21900006
*        SVC   3                                                 Y02027 22000006
*   TO SCHEDULE NEXT LOAD OF ERP                                 S22025 22200022
*        L     R13,DECIMAL VALUE OF NEXT LOAD                    S22025 22400022
*        L     R14,X'10'      CVT ADDRESS                        S22025 22600022
*        L     R14,X'2C'(14)  ADDRESS OF XCTL ROUTINE            S22025 22800022
*        BR    R14            EXIT TO XCTL                       S22025 23000022
*EXITS-ERROR -- R1 POINTS TO I/O SUPERVISOR BLOCK                Y02027 24000006
*        SVC   15   'EXCEPTIONAL CONDITION(IOSEX)'. RETURN TO    Y02027 24600006
*                   LINE END APPENDAGE. ERROR PERMANENT.         Y02027 25200006
*        SVC   3                                                      * 26000020
*                                                                     * 27000020
*TABLES/WORK AREAS --                                                 * 28000020
*   TAVTD                                                             * 29000020
*   TLCBD                                                             * 30000020
*   TCCWD                                                        S22025 30200022
*   TTRMD                                                        S22025 30400022
*   TSCBD                                                        S22025 30600022
*   IECDIOSB                                                     Y02027 30700006
*                                                                     * 30800022
*ATTRIBUTES -- SERIALLY REUSABLE, REFRESHABLE, SUPERVISOR KEY,   Y02027 31000006
*              SUPERVISOR MODE, ENABLED                          Y02027 31500006
*                                                                     * 32000020
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A         * 33000020
*   PARTICUALR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER      * 34000020
*   SET.                                                              * 35000020
*                                                                     * 36000020
*   R1 REMAINS TRANSPARENT TO ALL LOADS OF ERP.                       * 37000020
*                                                                     * 38000020
*********************************************************************** 39000020
         EJECT                                                          40000020
         USING *,R15                                                    42000020
         USING IEDQLCB,RLCB                                             43000020
         USING IEDQAVTD,RAVT                                     S22025 43100022
         USING IEDQCCW,RCCW                                      S22025 43200022
         USING IEDQSCB,RSCB                                      S22025 43300022
         USING IHADCB,RDCB                                       S22025 43400022
         USING IOSB,RIOSB                                        Y02027 43410006
         SPACE 2                                                        43420022
*        EQUATES                                                        43440022
         SPACE 1                                                        43460022
         SPACE 2                                                        43500022
R0       EQU   0                        WORK REGISTER            Y02027 44000006
RIOSB    EQU   1                        ADDR OF I/O SUPVR BLOCK  Y02027 45000006
RIOB     EQU   2                        IOB REGISTER - REQUIRED BY      45300006
*                                       SIO APPENDAGE.                  45600006
RUCB     EQU   3                        UCB REGISTER                    46000020
RLCB     EQU   4                        LCB REG.                        47000020
RWKA     EQU   7                        WORK REGISTER                   48000020
RTST     EQU   7                        ADDR OF REQUEST QUEUE    Y02027 48200006
*                                       ELEMENT                  Y02027 48400006
RSIO     EQU   8                        SIO APPENDAGE ADDRESS.          48600006
RWKB     EQU   9                        WORK REGISTER                   49000020
RSAVE    EQU   13                       REGISTER FOR SAVING RQE         49010006
*                                       ADDRESS.                        49020006
RAVT     EQU   2                        AVT BASE REGISTER        S22025 49030022
REG5     EQU   5                        WORK REGISTER            S22025 49060022
RCCW     EQU   6                        POINTER TO FAILING CCW   S22025 49090022
REG8     EQU   8                        WORK REGISTER            S22025 49150022
RSCB     EQU   10                       SCB BASE REGISTER        S22025 49180022
RDCB     EQU   11                       DCB BASE REGISTER        S22025 49210022
RLINK    EQU   13                       WORK REGISTER            S22025 49240022
RXCTL    EQU   14                       REGISTER FOR XCTL ADD    S22025 49270022
         SPACE 7                                                        49300020
R15      EQU   15                       ADDRESSABILITY REGISTER         50000020
EREXCP   EQU   15                       ERROR EXCP                      51000020
RETURN   EQU   3                        ETURN SVC FOR TRANSIENT S       52000020
IOBOFFST EQU   4                        IOB OFFSET IN RQE               54000020
X20      EQU   X'20'                    ERP IN CONTROL                  55000020
EIGHT    EQU   8                   CONSTANT FOR CSW                     55500020
IGE0204G IEDHJN BEGIN                   MODULE ID AND DATE       S22025 56000022
         EJECT                                                          56500020
         L     RTST,IOSUSE              PICKUP ADDR OF RQE       Y02027 56700006
         L     RLCB,IOBOFFST(R0,RTST)   ADDRESS OF IOB                  57000020
         SH    RLCB,LCBBKUP             SET LCB BASE                    57500020
         L     RUCB,IOSUCB              ADDRESS OF UCB         @Z30AAEE 58000008
         L     RSCB,LCBSCBA-1           SET SCB BASE           @SA74263 58020009
         TM    LCBSIOCC,CC3             IS CONTROL UNIT UP       S22025 58040022
         BNO   UNEXUNCK                 BRANCH IF CONT UNIT IS   S22025 58080022
*                                       UP - MUST BE UNIT CHK OR S22025 58120022
*                                       UNIT EXCEPTION           S22025 58160022
         OI    SCBERR4,SCBCTLUN         SET CONTROL UNIT ERROR @SA74263 58180009
         OI    LCBCHAIN,LCBNORTY        SET NO RTRY POSSIBLE            58200020
         L     RWKA,LCBSTART-1          START ADDRESS                   58400020
         LA    RWKA,EIGHT(,RWKA)        BUMP BY 8                       58600020
         ST    RWKA,LCBCSW-1            SET FOR LINEEND                 58800020
         NI    LCBSIOCC,AVTEFF-CC3      TURN OFF CONTROL UNIT    Y02027 58860006
*                                         BUSY FOR LINEEND       Y02027 58920006
         CLI   LCBTPCD,TPOPEN           OPEN OR START LINE              59000020
         BNE   NOTOPEN                  BRANCH IF NO                    59200020
         SPACE                                                          59400020
         NI    LCBSTAT1,LCBOCNI+LCBOCWTN RESET ALL BUT OPCTL   @OY14092 59600091
*                                         FORCE  STOPLINE               59800020
NOTOPEN  EQU   *                                                        60000020
         L     REG5,IOSERP              GET ERP WORK AREA      @OZ29402 64000082
         MVC   32(50,REG5),WTO          MOVE MESSAGE           @OZ29402 64050082
         MVC   50(3,REG5),13(RUCB)      AND DEVICE ADDRESS     @OZ29402 64100082
         LA    REG5,32(,REG5)           POINT TO MESSAGE       @OZ29402 64150082
         LR    RWKA,RIOSB               SAVE IOSB                Y02027 65000006
         LR    RWKB,R15                 SAVE BASE                       66000020
         WTO   MF=(E,(5)),ROUTCDE=(8),DESC=4                   @OZ29402 67000082
         LR    RIOSB,RWKA        N      RESTORE IOSB             Y02027 69000006
         LR    R15,RWKB                 RESTORE BASE                    70000020
         NI    IOSFLA,AVTEFF-IOSERR     POST PERMANENT ERROR     Y02027 71000006
*                                       TO ABNORMAL END APPENDAG Y02027 71030006
*********************************************************************** 71060006
*                                                                     * 71090006
*        THE FOLLOWING CODE HAS BEEN ADDED FOR AOS.                   * 71120006
*                                                                     * 71150006
SVCS     EQU   *                                                        71180006
         CLI   LCBECBCC,HIOCC           IOHALT ISSUED            Y02027 71181006
         BNE   HIOSUB                   BRANCH NO                Y02027 71182006
         SPACE 1                                                 Y02027 71183006
         NI    IOSFLA,X'FF'-(IOSERR+IOSEX) RESET ERP IN CTL      Y02027 71184006
         MVI   LCBINCAM+1,HIOCC         SET FOR LINEEND          Y02027 71185006
HIOSUB   EQU   *                                                 Y02027 71186006
**************************************************************** Y02027 71187006
*        THE FOLLOWING CODE MAPS THE NECESSARY FIELDS FROM THE   Y02027 71188006
*        LINE CONTROL BLOCK TO THE I/O SUPERVISOR BLOCK FOR EXCP Y02027 71189006
*        COMPATABILITY DURING RETRY OPERATIONS FROM ERP          Y02027 71190006
**************************************************************** Y02027 71191006
         MVC   IOSCSW(SEVEN),LCBCSW     MAP CSW FROM LCB TO IOSB Y02027 71192006
         MVC   IOSSNS(TWO),LCBSENS0     MAP SENSE INFO FROM LCB  Y02027 71193006
*                                       INTO IOSB                Y02027 71194006
         MVC   IOSCC(ONE),LCBSIOCC      MAP START I/O CONDITION  Y02027 71195006
*                                       CODE FROM LCB TO IOSB    Y02027 71196006
         TM    IOSFLA,IOSERR+IOSEX      ARE WE DOING A RETRY     Y02027 71210006
         BNO   NOTRETRY                 BRANCH IF NO.            X01004 71240006
         LR    RSAVE,RIOSB              SAVE IOSB ADDRESS        Y02027 71270006
         L     RTST,IOSUSE              PICKUP ADDR OF RQE       Y02027 71300006
         SR    RIOB,RIOB                CLEAR FOR ICM.                  71330006
         ICM   RIOB,7,IOBPTR(RTST)      GET IOB ADDRESS FROM RQE.       71360006
*                                       FOR USE BY SIO APPENDAGE.       71390006
         SR    RSIO,RSIO                CLEAR FOR ICM.                  71420006
         ICM   RSIO,7,DEBPTR(RTST)      GET DEB ADDRESS FROM RQE.       71450006
         LA    R15,DEBNMSUB-IEDQDEB     GET APDG. TABLE SIZE     Y02027 71480006
         SLR   RSIO,R15                 POINT TO APDG. TABLE     Y02027 71510006
         L     RSIO,SIOPTR(ZERO,RSIO)   GET ADDR. OF SIO APPEND- X01004 71540006
*                                       AGE FROM APPENDAGE VECTOR       71570006
*                                       TABLE.                          71600006
         SR    R15,R15                  CLEAR R15 TO TELL SIO AP-       71630006
*                                       PENDAGE IT'S A SUBROUTINE.      71660006
         BAL   RXCTL,SIOENTRY(ZERO,RSIO) LNK TO SIO APPENDAGE AT X01004 71690006
*                                       OFFSET +16 TO CONVERT CCW'S     71720006
*                                       FROM VIRTUAL TO REAL.           71750006
         LR    RIOSB,RSAVE              RESTORE IOSB ADDR        Y02027 71780006
*                                                                     * 71810006
*        END OF CODE ADDED FOR AOS.                                   * 71840006
*                                                                     * 71870006
*********************************************************************** 71900006
NOTRETRY EQU   *                                                 X01004 71930006
         SVC   EREXCP                   CONTROL TO NORMAL LINEEND       72000020
         SPACE                                                          73000020
         SVC   RETURN                   FREE TRANSIENT AREA             74000020
         SPACE 5                                                        74006022
UNEXUNCK EQU   *                                                        74012022
         L     RWKB,LCBSTART-1          ASSUME RESTART FROM      S22025 74018022
*                                       FAILING CCW              S22025 74024022
         L     RCCW,LCBCSW-1            GET FAILING CCW+8        S22025 74036022
         SH    RCCW,H8                  ADJUST TO FAILING CCW    S22025 74042022
         L     RAVT,CVTPTR              GET CVT ADDRESS          S22025 74048022
         L     RAVT,AVTCVTPT(,RAVT)     GET LOAD LIST            S22025 74054022
         L     RAVT,0(,RAVT)            SET UP AVT BASE          S22025 74060022
         SPACE 2                                                        74066022
         MVC   LCBERCCW+7(1),D19(RUCB)  MOVE ADAPTER TYPE        S22025 74068022
         NI    LCBERCCW+7,X'F0'         CLEAR CONT UNIT TYPE     S22025 74070022
         TM    LCBCSW+3,UNITCHK         IS IT TIMEOUT ?                 74072022
         BO    TIMEOUT                  BRANCH = YES, ELSE FALL  S22025 74078022
*                                       THROUGH FOR UNIT EXCPTN  S22025 74084022
         CLI   LCBERCCW+7,TTYTYPE1     TTY TYPE 1 ADAPTER       SA55958 74102000
         BE    BREAK                   BRANCH = YES             SA55958 74105000
         CLI   LCBERCCW+7,TTYTYPE2     TTY TYPE 2 ADAPTER       SA55958 74108000
         BE    BREAK                   BRANCH = YES             SA55958 74111000
         MVC   LCBERCCW+7(1),D19(RUCB)  MOVE ADAPTER TYPE        S22025 74114022
         NI    LCBERCCW+7,X0F           CLEAR ADAPTER TYPE       S22025 74120022
         CLI   LCBERCCW+7,X02           2701 CONTROL UNIT ?      S22025 74126022
         BE    SKIPEXIT                 IF YES, BRANCH TO READ   S22025 74132022
*                                       SKIP                     S22025 74138022
         SPACE 2                                                        74144022
         TM    LCBTSOB,LCBTSBUF         TSO SESSION ?            S22025 74145022
         BO    CHKCOUNT                 YES - CHECK RETRY COUNT  Y00469 74146054
         TM    LCBTSOB,LCB2741N         IS THIS A 2741 TERMINAL  S22025 74147022
         BNO   GORETRY                  BRANCH IF NO             S22025 74148022
         TM    LCBSTAT1,LCBSENDN        WAS LINE SENDING  ?      S22025 74149022
         BNO   BREAK                    BRANCH IF NO             S22025 74150022
         ST    RLCB,LCBERCCW+8          GET ANY VALID ADDRESS    S22025 74151022
         MVI   LCBERCCW+8,CCWBREAK      SET BREAK COMMAND CODE   S22025 74152022
         MVC   LCBERCCW+12(12),UNXFLCNT SET FLAGS AND COUNT FOR  S22025 74153022
*                                       BREAK AND WRITE CIRC D   S22025 74154022
         LA    REG5,LCBERCCW            GET DATA ADD FOR CIRC D  S22025 74155022
         ST    REG5,LCBERCCW+16         MOVE ADDRESS INTO CCW           74156022
         MVI   LCBERCCW+16,CCWWRITE     SET WRITE COMMAND CODE   S22025 74157022
         MVC   LCBERCCW(2),EOASHFT      SET UP EOA AND SHIFT     S22025 74158022
         LA    REG5,LCBERCCW+8          SET UP ADDRESS FOR EXCP  S22025 74159022
         MVI   LCBINCAM+1,BRKRET        RETURN INDEX FOR 504G    S22025 74160022
         B     BREAK3                   GO EXCP                  S22025 74161022
         SPACE 2                                                        74162022
GORETRY  EQU   *                                                 S22025 74168022
         CLI   LCBINCAM,RETRY           RETRY LIMIT REACHED ?    S22025 74174022
         BNE   TRYRETRY                 BRANCH = NO              S22025 74180022
         OI    SCBERR3,SCBXCEPN         TURN ON UNIT EXCPTN BIT  S22025 74186022
         TM    LCBTSOB,LCBTSBUF         IS THIS  TSO ?           S22025 74192022
         BZ    SKIPEXIT                 BRANCH = NO              S22025 74198022
         B     PERMEXIT                 DON'T SET NORETRY FLAG          74204022
         SPACE 2                                                        74210022
NORETRY  EQU   *                                                 S22025 74216022
         OI    LCBCHAIN,LCBNORTY        SET ON NORETRY FLAG      S22025 74222022
PERMEXIT EQU   *                                                 S22025 74228022
         MVI   LCBINCAM+1,PERMRET       SET INDICATOR FOR 504G   S22025 74234022
LOADSDR  EQU   *                                                 S22025 74240022
         LH    RLINK,POSTMOD            POST MODULE              S22025 74246022
         L     RXCTL,CVTPTR             GET CVT POINTER          S22025 74252022
         L     RXCTL,XCTLADD(,RXCTL)    GET XCTL ROUTINE ADDRESS S22025 74258022
         BR    RXCTL                    EXIT TO 504G             S22025 74264022
         SPACE 2                                                        74270022
SKIPEXIT EQU   *                                                        74276022
         MVI   LCBINCAM+1,RDSKIP        SET INDEX CODE FOR 504G  S22025 74282022
         ST    RLCB,LCBERCCW            USE LCB ADDRESS          S22025 74288022
         MVI   LCBERCCW,CCWREAD         SET UP READ CCW          S22025 74294022
         MVC   LCBERCCW+4(4),FLAGCNT    SET UP FLAG AND COUNT    S22025 74300022
         B     COMMON                   ISSUE EXCP               S22025 74306022
         SPACE 2                                                        74312022
TIMEOUT  EQU   *                                                        74318022
         TM    CCWOPCDE,CCWWRITE        WRITE CCW ?              S22025 74324022
         BZ    TOREAD                   BRANCH IF NO             S22025 74330022
         MVC   LCBERCCW+7(1),D19(RUCB)  MOVE ADAPTER TYPE        S22025 74336022
         NI    LCBERCCW+7,X'F0'         CLEAR CONT UNIT TYPE     S22025 74342022
         CLI   LCBERCCW+7,X'80'         TYPE 3 ADAPTER (2260 R)  S22025 74348022
         BNE   SNO                      BRANCH = NO, SHOULD      S22025 74354022
*                                       NOT OCCUR                S22020 74360022
         MVC   LCBERCCW(16),BRK2848     SET 2848 BREAK SEQUENCE  S22025 74366022
         B     BREAK2                   GO EXCP                  S22025 74372022
         SPACE 2                                                        74378022
SNO      EQU   *                                                 S22025 74384022
         OI    SCBERR4,SCBCTLUN         SET CONTROL UNIT ERROR   S22025 74390022
         MVI   LCBINCAM+1,POSNO         SET RETURN CODE FOR 504G S22025 74396022
         B     LOADSDR                  EXIT TO 504G             S22025 74402022
         SPACE 2                                                        74408022
TOREAD   EQU   *                                                        74414022
         CLI   LCBRESTR,TPRDSKIP        TEXT RELATED CCW ?       S22025 74420022
         BNL   TRY2741                  YES, SEE IF TERM IS 2741 S22025 74426022
         CLI   LCBRESTR,TPRDRPEB        TEXT RESPONSE ?          S22025 74432022
         BE    NORETRY                  BRANCH IF YES            S22025 74438022
         CLI   LCBRESTR,TPRDRSPD        READ RESP TO ADDRESSING  S22025 74444022
         BE    CHKCOUNT                 BRANCH =YES, GO CHECK    S22025 74450022
*                                       RETRY AND REDIAL         S22025 74456022
         CLI   LCBRESTR,TPRDRESP        POLLING RESPONSE ?       S22025 74462022
         BNE   TRYRETRY                 BRANCH IF NO             S22025 74468022
         SPACE 1                                                        74474022
         TM    LCBTSOB,LCB2741N         2741 TERMINAL ?          S22025 74475022
         BO    CHK2741                  BRANCH IF YES            S22025 74476022
         CLI   LCBERCCW+7,TYPE1         TYPE 1 ADAPTER           A48248 74477022
         BE    NOTTWX                   BR YES, CANNOT BE TWX   SA59006 74478022
         CLI   LCBERCCW+7,TYPE5         DIAL TWX ADAPTER        SA59006 74478222
         BNE   NOTTWX                   NO,BRANCH              @OY12267 74478491
         TM    LCBTSOB,LCBTSBUF         TSO SESSION            @OY12267 74478691
         BZ    CHKCOUNT                 NO,RETRY               @OY12267 74478891
         B     NORETRY                  ALLOW HANG UP          @OY12267 74479091
NOTTWX   EQU   *                                               @OY12267 74479291
         CLI   D16(RUCB),T2740          2740 TERMINAL          @OY12267 74479491
         BNE   TRYRETRY                 BRANCH IF NOT            A48248 74480022
         TM    D17(RUCB),STATION+TRANSMIT     BASIC 2740         A48248 74481022
         BNZ   TRYRETRY                 BRANCH IF NOT            A48248 74482022
         B     CHKCLS                   PREPARE TO RETURN TO     S22025 74483022
*                                       LINE END APPENDAGE       S22025 74484022
*                                       OR TO RETRY CCW          S22025 74485022
         SPACE 2                                                        74486022
CHK2741  EQU   *                                                 S22025 74487022
         TM    LCBTSOB,LCBTSBUF         TSO SESSION ?            S22025 74488022
         BO    CHKCLS                   BRANCH IF YES            S22025 74490022
         TM    LCBSTAT2,LCBDIAL         IS IT DIAL?            @SA70884 74490661
         BO    NORETRY                  ALLOW TO HANG-UP       @SA70884 74491261
         ST    RCCW,LCBSTART-1          ASSUME RETRY ON FAILING  S22025 74492022
*                                       CCW                      S22025 74498022
         TM    SCBSTATE,SCBLCK1N+SCBMSGLN    IS TERM IN LOCK OR  S22025 74504022
*                                            EXTENDED LOCK MODE? S22025 74510022
         BNZ   SVCS                     BRANCH IF EITHER OR BOTH S22025 74516022
         SPACE 1                                                        74522022
         TM    AVTBIT1,AVTDLAYN+AVTCLOSN  CLOSEDOWN REQUESTED ?  S22025 74528022
         BNZ   BREAK                    IF YES, BRANCH TO BREAK  S22025 74534022
         SPACE 1                                                        74540022
         TM    LCBSTAT1,LCBOCNI         STOPLINE COMPLETE REQ ?  S22025 74546022
         BNZ   BREAK                    IF YES, BRANCH TO BREAK  S22025 74552022
         SPACE 1                                                        74558022
         LA    REG5,LCBSTCBA-1          SET UP TO TEST FOR       S22025 74564022
         L     REG8,LCBSTCBA-1             RECEIVE OR SEND       S22025 74570022
         LA    REG8,0(,REG8)                  SCHEDULER          S22025 74576022
         CR    REG5,REG8                         IN LCB          S22025 74582022
         BNE   ITS2741                  BRANCH IF SEND SCHEDULER S22025 74585022
*                                       IN LCB - GO ISSUE BREAK  S22025 74588022
*                                       TO PREPARE CONTROL UNIT  S22025 74591022
*                                       AND TERMINAL TO RECEIVE  S22025 74594022
*                                       OUTPUT                   S22025 74597022
         B     SVCS                     ISSUE EREXCP             Y01004 74600006
CHKCLS   EQU   *                                                 S22025 74606422
         MVI   LCBCSW+3,NORMAL          SET NORMAL ENDING STATUS S22025 74606822
         TM    AVTBIT1,AVTDLAYN+AVTCLOSN  CLOSEDOWN REQUESTED ?  S22025 74607222
         BNZ   GOODEXIT                 BRANCH IF YES            S22025 74607622
         LR    RWKB,RCCW                RESTART ON READ RESPONSE S22025 74608022
         TM    LCBSTAT1,LCBOCNI         STOPLINE COMPLETE REQ ?  S22025 74608422
         BZ    NOSTOP                   BRANCH IF NO             S22025 74608822
GOODEXIT EQU   *                                                 S22025 74609222
         NI    IOSFLA,AVTEFF-(IOSERR+IOSEX) SET NORMAL ENDING    Y02027 74609606
*                                       STATUS                   Y02027 74610006
         B     SVCS                                            @OZ07810 74610481
         SPACE 2                                                        74610822
         SPACE 2                                                        74612022
TRY2741  EQU   *                                                 S22025 74618022
         TM    LCBTSOB,LCB2741N         2741 TERMINAL ?          S22025 74624022
         BNO   NORETRY                  BRANCH IF NO             S22025 74630022
ITS2741  EQU   *                                                 S22025 74636022
         OI    LCBCHAIN,LCBNORTY        SET NO RETRY FLAG        S22025 74642022
         MVI   LCBINCAM,RTRYMAX         SET MAXIMUM RETRY COUNT  S22025 74648022
         SPACE 2                                                        74654022
BREAK    EQU   *                                                 S22025 74660022
         ST    RLCB,LCBERCCW            USE LCB ADDRESS          S22025 74666022
         MVI   LCBERCCW,CCWBREAK        SET UP BREAK CCW         S22025 74672022
         MVC   LCBERCCW+4(4),FLGCT41    SET UP FLAGS AND COUNT   S22025 74678022
*                                       FOR 2741 BREAK           S22025 74684022
         TM    LCBTSOB,LCB2741N         2741 TERMINAL ?          S22025 74690022
         BO    BREAK2                   BRANCH IF YES            S22025 74696022
         MVC   LCBERCCW+4(4),BRKFLGCT   SET UP FLAGS AND COUNT   S22025 74702022
*                                       FOR TELETYPE BREAK       S22025 74708022
BREAK2   MVI   LCBINCAM+1,BRKRET        RETURN INDEX FOR 504G    S22025 74714022
COMMON   EQU   *                                                 S22025 74720022
         LA    REG5,LCBERCCW            SAVE EXCP START ADDRESS  S22025 74722022
BREAK3   EQU   *                                                 S22025 74724022
         MVC   LCBSNSV,LCBSENS0         SAVE CURRENT SENSE       S22025 74726022
         MVC   LCBCSWSV,LCBCSW          SAVE CURRENT CSW         S22025 74732022
         LR    RWKB,REG5                SET START ADDRESS        S22025 74738022
         B     NOSTOP                   GO EXCP                  S22025 74744022
         SPACE 2                                                        74750022
         SPACE 2                                                        74756022
TRYRETRY EQU   *                                                 S22025 74762022
         CLI   LCBRESTR,TPTWXID         TWX ID ?                 S22025 74768022
         BE    REDIAL                   BRANCH = YES             S22025 74774022
         TM    LCBCPA+16,X'20'          DIAL INITIAL CONTACT     S22025 74780022
         BZ    CHKCOUNT                 BRANCH IF NO             S22025 74786022
         LA    RWKB,LCBCPA+32           SKIP TO WRITE COMMAND    S22025 74792022
CHKCOUNT EQU   *                                                 S22025 74798022
         CLI   LCBINCAM,RETRY           RETRY LIMIT REACHED ?    S22025 74804022
         BNL   PERMEXIT                 BRANCH IF YES            S22025 74810022
         IC    RWKA,LCBINCAM            INSERT RETRY COUNT       S22025 74822022
         LA    RWKA,1(,RWKA)            ADD ONE                  S22025 74828022
         STC   RWKA,LCBINCAM            SAVE COUNT IN LCB        S22025 74834022
NOSTOP   EQU   *                                                 S22025 74840022
         ST    RWKB,LCBSTART-1          SET START ADDRESS        S22025 74846022
         MVI   LCBSENS0,AVTEZERO        CLEAR SENSE FOR RETRY    Y02027 74852006
         B     SVCS                     ISSUE EREXCP             Y01004 74858006
         SPACE 2                                                        74870022
REDIAL   EQU   *                                                 S22025 74876022
         LA    RWKB,LCBCPA+16           SET UP TO REDIAL         S22025 74882022
         B     CHKCOUNT                 GO CHECK RETRY COUNT     S22025 74888022
         SPACE 5                                                        74894022
         EJECT                                                          75000020
LCBBKUP  DC    AL2(LCBFLAG1-IEDQLCB)    TO ADJUST LCB BASE              75500020
BRKRET   EQU   8                        RETURN INDEX FOR 504G    S22025 75510022
RDSKIP   EQU   4                        RETURN INDEX FOR 504G    S22025 75520022
CC3      EQU   X'30'                    FLAG = CONTROL UNIT NOT  S22025 75530022
*                                       UP                       S22025 75540022
UNITCHK  EQU   X'02'                    UNIT CHECK MASK          S22025 75550022
H8       DC    H'8'                     TO ADJUST CCW POINTER           75570022
ONE      EQU   1                                                 Y02027 75572006
TWO      EQU   2                                                 Y02027 75574006
SEVEN    EQU   7                                                 Y02027 75576006
HIOCC    EQU   X'48'                    IOHALT COMPLETION CODE   Y02027 75578006
TTYTYPE1 EQU   X'40'                   TTY TYPE 1 ADAPTER FLAG  SA55958 75580000
TTYTYPE2 EQU   X'50'                   TTY TYPE 2 ADAPTER FLAG  SA55958 75585000
TYPE5    EQU   X'50'                    DIAL TWX ADAPTER        SA59006 75587022
D19      EQU   19                                                       75590022
D16      EQU   16                       UCB INDEX TO TERM TYPE   A48248 75593022
D17      EQU   17                       AND TO TERM FEATURES     A48248 75596022
RTRYMAX  EQU   X'02'                    MAXIMUM RETRY COUNT      S22025 75600022
X0F      EQU   X'0F'                    MASK OFF ADAPTER TYPE    S22025 75610022
X02      EQU   X'02'                    MASK FOR 2701            S22025 75620022
RETRY    EQU   X'02'                    MAXIMUM RETRY COUNT      S22025 75630022
PERMRET  EQU   20                       RETURN INDEX FOR 504G    S22025 75640022
POSTMOD  DC    AL2(5047)                POST MODULE                     75650022
NORMAL   EQU   X'0D'                    NORMAL ENDING STATUS     S22025 75660022
POSNO    EQU   16                       RETURN INDEX FOR 504G    S22025 75670022
CVTPTR   EQU   X'10'                    CVT ADDRESS              S22025 75680022
XCTLADD  EQU   X'2C'                    CVT-XCTL ROUTINE OFFSET  S22025 75690022
EOASHFT  DC    X'169C'                  EOA AND SHIFT CHARACTER  S22025 75693022
*        TO INSURE PROPER CONTROL UNIT AND TERMIANL SETTINGS     S22025 75696022
T2740    EQU   X'54'                    UCB TYPE MASK FOR 2740   A48248 75696622
STATION  EQU   X'08'                    STATION CONTROL          A48248 75697222
TRANSMIT EQU   X'04'                    TRANSMIT CONTROL         A48248 75697822
TYPE1    EQU   X'10'                    TYPE 1 ADAPTER MASK      A48248 75698422
ERPOFF   EQU   X'DB'                    TO RESET ERP FLAG        S22025 75699022
ZERO     EQU   0                                                 X01004 75699106
IOBPTR   EQU   5                        OFFSET OF IOB ADDR. IN RQE.     75699206
DEBPTR   EQU   9                        OFFSET OF DEB ADDR. IN RQE.     75699306
SIOPTR   EQU   4                        OFFSET OF SIO APDG. ADDRESS     75699606
*                                       IN APDG. VECTOR TABLE.          75699706
SIOENTRY EQU   34                       OFFSET OF SUBRTNE. ENTRY Y02027 75699806
*                                       POINT IN SIO APPENDAGE.         75699906
         SPACE 2                                                        75700022
WTO      WTO   'IED064I  LINE     CONTROL UNIT NOT OPERATIONAL',       X75702082
               MF=L,ROUTCDE=(8),DESC=4                                  75704082
         SPACE 5                                                        75706082
***      FLAGS AND COUNT FOR TELETYPE BREAK CCW              *** S22025 75709022
BRKFLGCT DC    AL1(CCWSLI),AL2(0),XL1'30'                        S22025 75718022
***      FLAGS AND COUNT FOR 2741 BREAK CCW IF TIME OUT      *** S22025 75727022
FLGCT41  DC    AL1(CCWSLI),AL2(0),XL1'05'                        S22025 75736022
***      FLAGS AND COUNT FOR 2741 BREAK CCW IF UNIT EXCPTN   *** S22025 75745022
UNXFLCNT DC    AL1(CCWCC+CCWSLI),AL2(0),XL1'05'                  S22025 75754022
         DC    XL1'01',AL3(0),AL1(CCWSLI),AL2(0),XL1'02'         S22025 75763022
***      FLAGS AND COUNT FOR READ SKIP                       *** S22025 75772022
FLAGCNT  DC    AL1(CCWSKIP),XL1'0',X'FFFF'                       S22025 75781022
***      FLAGS AND COUNT FOR 2260 REMOTE BREAK SEQUENCE      *** S22025 75790022
BRK2848  DC    X'42000001',AL1(CCWCC+CCWSLI+CCWSKIP),X'0003C0'  SA55420 75799022
         DC    X'41000001',AL1(CCWSLI),X'0003E8'                 S22025 75808022
         EJECT                                                          75809006
         TDEBD                          DEB DSECT                       75810006
         EJECT                                                          75811006
         SPACE 3                                                        75812022
         TTPD                                                           75816022
         TCCWD                          S22025                          75820022
         TTRMD                                                          75830022
         TTNTD                                                          75840022
         TQCBD                                                          75850022
         TSCBD                                                          75860022
         DCBD  DSORG=TX                                                 75870022
         TAVTD                                                          76000020
         TLCBD                                                          77000020
         IECDIOSB                                                Y02027 77500006
         END                                                            78000020
