./  ADD  SSI=21190861,NAME=IECTATTN
         TITLE '34XX ATTENTION ROUTINE'                                 00050021
**********************************************************************  00100021
*                                                                    *  00150021
* STATUS:                                                            *  00200021
*    CHANGE LEVEL 0                                                  *  00250021
*                                                                    *  00300021
* FUNCTION/OPERATION:                                                *  00350021
*    THIS MODULE IS ENTERED WHENEVER A UNEXPECTED DEVICE END IS      *  00400021
*    RECEIVED FROM A 34XX UNIT. IF THE VOLUME SERIAL IS VALID, THE   *  00450021
*    MOUNT MESSAGE HAS NOT BEEN ISSUED AND IF THE UCB IS READY, THIS *  00500021
*    MODULE WILL CAUSE IOS TO SCHEDULE THE TAPE ERPS.                *  00550021
*                                                                    *  00600021
* ENTRY POINTS:                                                      *  00650021
*         IECTATTN                                                   *  00700021
*                                                                    *  00750021
* INPUT:                                                             *  00800021
*    GR7 CONTAINS A POINTER TO THE UCB                               *  00850021
*                                                                    *  00900021
* OUTPUT: N/A                                                        *  00950021
*                                                                    *  01000021
* EXTERNAL ROUTINES: N/A                                             *  01050021
*                                                                    *  01100021
* EXITS-NORMAL:                                                      *  01150021
*    RETURN TO IOS VIA GR14                                          *  01200021
*                                                                    *  01250021
* EXITS-ERROR: N/A                                                   *  01300021
*                                                                    *  01350021
* ATTRIBUTES:                                                        *  01400021
*    RE-ENTERABLE                                                    *  01450021
*                                                                    *  01500021
* NOTES: N/A                                                         *  01550021
*                                                                    *  01600021
**********************************************************************  01650021
         EJECT                                                          01700021
IECTATTN CSECT                                                          01750021
         SPACE 3                                                        01800021
*           REGISTER EQUATES                                            01850021
UCBREG   EQU   7                        UCB ADDRESS                     01900021
LINKREG2 EQU   14                       RETURN ADDRESS OF IOS           01950021
APBSREG  EQU   15                       BASE REGISTER                   02000021
         SPACE 1                                                        02050021
UCBFL1   EQU   6                        OFFSET OF UCB FLAG 1            02100021
UCBVOLID EQU   28                       OFFSET OF VOL-ID IN TAPE UCB    02150021
SRTEDMCT EQU   35                       OFFSET OF VOLUME MOUNT SWITCH   02200021
UCBVOPT  EQU   48                       OFFSET OF DEVICE END INDICATOR  02250021
ZERO     EQU   0                        ZERO                            02300021
HEX01    EQU   X'01'                    DEV END INDICATOR               02350021
HEX40    EQU   X'40'                    NOT READY INDICATOR             02400021
HEX80    EQU   X'80'                    VOL MOUNT SWITCH                02450021
         SPACE 1                                                        02500021
         USING *,APBSREG                                                02550021
         CLI   UCBVOLID(UCBREG),ZERO    VOLUME-SERIAL = 0 ?             02600021
         BCR   8,LINKREG2               YES, RETURN TO IOS              02650021
         SPACE 1                                                        02700021
         TM    SRTEDMCT(UCBREG),HEX80   MOUNT MESSAGE ISSUED ?          02750021
         BCR   1,LINKREG2               YES, RETURN TO IOS              02800021
         SPACE 1                                                        02850021
         TM    UCBFL1(UCBREG),HEX40     IS UCB READY ?                  02900021
         BCR   1,LINKREG2               NO, RETURN TO IOS               02950021
         SPACE 1                                                        03000021
         OI    UCBVOPT(UCBREG),HEX01    TURN ON BIT TO SCHEDULE ERPS    03050021
         BCR   15,LINKREG2              RETURN TO IOS                   03100021
         SPACE 1                                                        03110021
         END                                                            03150021
./  ADD  SSI=81790444,NAME=IGC0009A
         TITLE 'IGC0009A           LOAD 1              SVC91'           00100000
         MACRO                                                          00150000
         DATEM                                                          00200000
         LCLC  &FILL                                                    00250000
&FILL    SETC  'CL8'.''''.'&SYSDATE'.''''                               00300000
         DC    &FILL                                                    00350000
         MEND                                                           00400000
IGC0009A START X'00'                   SVC 91                           00450000
*********************************************************************** 00500000
* STATUS:                                                             * 00550000
*    VS2/REL4.0                                                       * 00600000
* FUNCTION/OPERATION:                                                 * 00650000
*    THIS TYPE 4 SVC IS CALLED BY CLOSE/EOV, DEALLOCATION,            * 00700000
*    EOD, DDR, AND IEHDASDR FOR DEMOUNTS                              * 00750000
*                                                                     * 00800000
*    IF THE UNIT IS A DISK OR UNIT RECORD IT BRANCHES TO PART 2.      * 00850037
*    IF THE UNIT IS A DIRECT ACCESS TYPE, 3800, 3895, OR 3851,          00860037
*    A TPER RECORD IS BUILT ACCORDING TO THE LOGRECD PORTION OF       * 00900000
*    THE GETMAIN AREA.  THE FORMATTED TPER RECORD IS THEN WRITTEN     * 00950000
*    ONTO SYS1.LOGREC BY SVC 76.                                      * 01000000
*                                                                     * 01050000
*    IF THE UNIT IS A 3400 DEVICE TYPE, IT ALSO OUTPUTS TO            * 01100000
*    SYS1.LOGREC AS A DISMOUNT RECORD & WRITES AN SMF RECORD.         * 01150000
*    AFTER THE RECORDS ARE PROCESSED, THE SVC ZEROS ALL ERROR         * 01200000
*    COUNTERS AND RETURNS TO THE CALLER.                              * 01250000
*    IF A 2400 DEVICE, ONLY SMF RECORDS ARE WRITTEN.                  * 01300000
*                                                                     * 01350000
* ENTRY POINTS:                                                       * 01400000
*         IGC0009A                                                    * 01450000
*                                                                     * 01500000
* INPUT:                                                              * 01550000
*    REG 0 - ADDR OF DCB OR UCB        REG 4 - ADDRESS OF TCB         * 01600000
*    REG 1 - CLOSE/EOV FLAG            REG 5 - ADDRESS OF SVRB        * 01650000
*    REG 3 - ADDRESS OF CVT            REG 14 - RETURN ADDRESS        * 01700000
*    NOTE - REG 0 IS ADDR OF DCB IF SVC 91 CALLED BY CLOSE/EOV OR DDR * 01750000
*    NOTE - REG 0 IS ADDR OF UCB IF SVC 91 IS CALLED BY UNALLOCATION  * 01800000
*                                                                     * 01850000
* OUTPUT:                                                             * 01900000
*    THE DISMOUNT RECORD GOES TO SYS1.LOGREC                          * 01950000
*    THE FORMATTED ESV RECORD GOES TO SYS1.MAN.                       * 02000000
*                                                                     * 02050000
* EXTERNAL ROUTINES:                                                  * 02100000
*         1. TIME MACRO (SVC 11)       5. LOGREC RECORDER (SVC 76)    * 02150037
*         2. SMFWTM MACRO (SVC 83)     6. ABEND MACRO (SVC 13)        * 02180037
*         3. GETMAIN MACRO (SVC 10)    7. TESTAUTH MACRO (SVC 119)    * 02210037
*         4. FREEMAIN MACRO (SVC10                                    * 02240037
*                                                                     * 02300000
* TABLES/WORKAREAS:                                                   * 02350000
*    WORK AREAS ARE USED IN THE EXTENDED SVRB & IN THE GETMAIN AREA   * 02400000
*                                                                     * 02450000
* EXITS - NORMAL:                                                     * 02500000
*         RETURN TO CALLER VIA BRANCH ON REGISTER 14                  * 02550000
*         ABNORMAL: ISSUE ABEND MACRO WHEN UNAUTHORIZED CALLER        * 02600037
*                                                                     * 02610037
* ATTRIBUTES:                                                         * 02620037
*    REENTRANT TRANSIENT TYPE 4 SVC ROUTINE                           * 02630037
* RESTRICTIONS:                                                       * 02640037
*    CALLED BY APF AUTHORIZED PROGRAMS, SUPERVISOR STATE OR           * 02650037
*    KEY 0-7 ROUTINES. UNAUTHORIZED CALLERS WILL BE ABENDED.          * 02660037
*                                                                     * 02750000
* NOTES:                                                              * 02800000
*    THIS MODULE HAS BEEN REVISED AND REWRITTEN TO SUPPORT 3400       * 02850000
*    TAPE UNITS.  SUPPORT CODE S21048.                                * 02900000
*    THIS MODULE FURTHER HAS BEEN REVISED TO HANDLE THE DSM.  @Y30LB11* 02950000
*    THE SUPPORT CODE IS @Y30LB11.                            @Y30LB11* 03000000
*                                                                     * 03050000
*    GENERAL REWRITE OF MODULE, WITH NO FUNCTIONAL CHANGES.    X02975 * 03100000
*    MODULE MADE RE-ENTRANT                                  @YA00072 * 03150000
*    SAVE TIME FOR SMF RECORD IN SVRB EXTENSION              @YM03278 * 03200000
*    RECOGNIZE BIRCH DENSITY SETTING                         @YM07123 * 03250000
*                                                                     * 03300000
*    LOADS 1 AND 2 COMBINED AND REWRITTEN FOR VS2/REL 2        Y02032 * 03350000
*    1600 BIT UCB ADDRESSING                                 @Z30AB01 * 03400000
*    PUT PROPER SYSTEM ID IN THE MDR RECORD                  @ZUP1066 * 03450000
*    INSERT SUPPORT FOR 3800 DEVICE                          @Z40MB01 * 03500000
*    INSERT SUPPORT FOR 3350 DEVICE                          @Z20AB05 * 03550000
*    CHANGE TEST FOR PRIMARY UCB                             @ZA05146 * 03600000
*    APAR OZ09512 SECONDARY ADDRESS USED AS PRIMARY ADDRESS  @ZA09512 * 03650000
*                 IN OBR RECORD                              @ZA09512 * 03700000
*    APAR OZ09525 SUPPORT MICRO CODE CHANGE                  @ZA09525 * 03750000
*    CORRECT READ BUFFERED LOG COMMAND FOR 3800                @ZM03166 03800000
*    TEST READ BUFFERED LOG FAIL                               @ZA11019 03810000
*    PUT CORRECT CHANNEL ID IN OBR RECORD                      @ZA11663 03850000
*    INSERT SUPPORT FOR 3895                                   @G30HB19 03860037
*    PREVENT ENQUEUE WAIT IF BUFF LOG DEV IS OFF LINE          @ZA18278 03870037
*    INCREASE SIZE OF MDR RECORDS C087000,294500,470000        @ZA27122 03880037
*    TAPE,UNIT SERIAL NUMBER A070500,C271000                   @ZA27097 03890037
*    PE08355 RESPECIFY IOBFLAG4,C078500                        @ZA26593 03892037
*    BASE CVTREG ON CVT PREFIX                                 @YA11111 03894037
*D415500-417000,479500-481000  STORE CPU ID        UZ15665     @ZA27554 03896037
*A415001-415002                                                @ZA27554 03898037
*    DEB VALIDITY CHECK  A214000-217008            UZ15400     @ZA25497 03899037
*    CORRECT UCB ADDR. FOR SDR TABLE A138000,                  @ZA30027 03899337
*    A273001,281001                                            @ZA30027 03899637
*    REWORK OF ZA25497                                         @ZA32130 03899837
*********************************************************************** 03900000
         EJECT                                                          03950000
*                                                                       04000000
*                     S  V  R  B    D  S  E  C  T                       04050000
*                                                                       04100000
SVRB     DSECT                                                          04150000
         DS    CL96                    SVRB COMMON SECTION              04200000
LISTA    DS    0CL1                    GETMAIN/XCTL PARM LIST AREA      04250000
RECTOT   DS    CL2                     SMF TOTAL RECORD LENGTH          04300000
RECZERO  DS    CL2                     SMF ZERO FIELD                   04350000
LISTB    DS    0CL1                    GETMAIN/SCTL PARM LIST           04400000
RECRES   DS    CL1                     SMF RESERVED CHARACTER           04450000
RECNUM   DS    CL1                     SMF RECORD TYPE                  04500000
RECTIME  DS    CL2                     TIME OF DAY, 1ST HALF            04550000
LISTC    DS    0CL1                    GETMAIN/XCTL PARM LIST           04600000
         DS    CL2                     TIME OF DAY, 2ND HALF            04650000
RECDATE  DS    CL2                     CURRENT DATE 1ST HALF            04700000
LISTD    DS    0CL1                    GETMAIN/SCTL PARM LIST           04750000
         DS    CL2                     CURRENT DATE, 2ND HALF           04800000
RECCPU   DS    CL2                     CPU PROCLIB ID                   04850000
RECMOD   DS    CL2                     MODEL NUMBER                     04900000
RECLEN   DS    CL2                     DATA LENGTH (PLUS 2)             04950000
RECVOL   DS    CL6                     VOLUME SERIAL NUMBERL            05000000
RECADDR  DS    CL2                     CHANNEL/UNIT ADDRESSL            05050000
RECDEV   DS    CL4                     DEVICE TYPE                      05100000
RECNTRS  DS    CL11                    VOLUME STATISTICS COUNTERS       05150000
RECDEN   DS    CL1                     FLAG DENOTING DENSITY            05200000
RECBLK   DS    CL2                     RECORD BLOCK SIZE                05250000
RECFLGS  DS    CL1                     I/O PROCESSING AND SEQ NUMBER    05300000
RECNULL  DS    CL1                     UNUSED                           05350000
         ORG   SVRB+136                EXTENDED WORK AREA      @Y30LB11 05400000
PLBOP    DS    XL1                     PBL ORDER CODE          @Y30LB10 05450000
         DS    XL1                                             @Y30LB10 05500000
ATTRIB   DS    XL2                     ATTRIBUTE BYTE          @Y30LB10 05550000
SSIDXX   DS    XL2                     SSID BYTE               @Y30LB10 05600000
WORKB    DS    XL2                     WORK AREA               @Y30LB10 05650000
         EJECT                                                          05700000
*                                                                       05750000
*              G E T M A I N   A R E A   D S E C T                      05800000
*                                                                       05850000
MAIN     DSECT                                                          05900000
OBREC    EQU   *                                                        05950000
CLSOURCE DS    CL1                     CLASS/SOURCE                     06000000
SYSREL   DS    CL1                     SYSTEM RELEASE                   06050000
SWITCHES DS    CL2                     SWITCHES                         06100000
         DS    CL4                     N/A                              06150000
DATE     DS    CL4                     DATE                             06200000
TIME     DS    CL4                     TIME                             06250000
NA1      DS    CL1                     N/A                              06300000
CPUSER   DS    CL3                     CPU SERIAL NUMBER                06350000
CPUID    DS    CL2                     CPU ID                           06400000
         DS    CL2                     N/A                              06450000
JOBID    DS    CL8                     JOB IDENTITY              M0900  06500000
         DS    CL8                     FAILING CCW               M0900  06550000
CSW      DS    CL8                     CSW STORED                M0900  06600000
DDCNT    DS    CL1                     DEV DEPENDENT DATA COUNT  M0900  06650000
SECCUA   DS    CL3                     SECONDARY CUA             M0900  06700000
DEVTYPE  DS    CL4                     DEVICE TYPE               M0900  06750000
SDRCNT   DS    CL1                     SDR COUNT                 M0900  06800000
PRICUA   DS    CL3                     PRIMARY CUA               M0900  06850000
IORET    DS    CL2                     N/A                       M0900  06900000
SNSCNT   DS    CL2                     SENSE COUNT               M0900  06950000
VLID     DS    CL6                     VOL ID                           07000000
BLKLTH   DS    CL2                     BLOCK LENGTH                     07050000
HDRSER   DS    CL2                     TAPE UNIT SERIAL NUMBER@ZA27097  07100037
         DS    CL2                     N/A                              07110037
TEMPRD   DS    CL7                     VES DATA                         07150000
MODSET   DS    CL5                     MODESET                          07200000
SDR      DS    CL20                    SDR COUNTERS                     07250000
SNS      DS    CL24                    SENSE BYTES                      07300000
         DS    CL4                     ALIGN ON DOUBLE WORD BNDRY       07350000
WORKA    DS    CL10                    WORK AREA                        07400000
*                                                                       07450000
         ORG   OBREC                   **                               07500000
CTLBLK   EQU   *                       CONTROL BLOCKS - IOB, ECB & DEB  07550000
ECB      DS    F                       ECB FOR EXCP                     07600000
IOB      DS    F                       START OF IOB                     07650000
IOBECBPT DS    F                       ECB POINTER                      07700000
IOBCSW   DS    2F                      CSW POINTER                      07750000
IOBSTART DS    F                       POINTER TO FIRST CCW             07800000
IOBFLAG4 DS    0C                      FLAG BYTE 4            @ZA26593  07850037
IOBDCBPT DS    F                       DCB POINTER                      07880037
IOBRESTR DS    F                       ERP RESTART POINTER              07910037
IOBSEEK  DS    2F                      SEEK ADDRESS                     08000000
*                                                                       08050000
         ORG   ECB                     **                               08100000
DCB      DS    11F                     SPACE                            08150000
DCBDEB   DS    F                       POINTER TO DEB                   08200000
*                                                                       08250000
DEB      DS    6F                      SPACE                            08300000
DEBDCBAD DS    F                       POINTER TO DCB                   08350000
DEBAPPAD DS    F                       POINTER TO APPENDAGE TABLE       08400000
DEBUCBAD DS    F                       POINTER TO UCB                   08450000
DEBFINUM DS    F                       BIN NUMBER OF EXTENTS            08500000
DEBSTRHH DS    F                       FIRST TRACK OF EXTENT            08550000
DEBENDHH DS    F                       LAST TRACK OF EXTENT             08600000
*                                                                       08650000
         ORG   OBREC+336               **                      @ZA27122 08700037
DOUBLE   DS    D                       DOUBLE WRD FOR CVB & STORE CPUID 08750000
         ORG   DOUBLE                  **                               08800000
CCW      DS    D                       READ LOG CCW            @YM01189 08850000
         ORG   CCW+4                   **                      @YM01189 08900000
CCWFLG   DS    3C                      CCW FLAGS               @YM01189 08950000
CCWLNG   DS    C                       LENGTH                  @YM01189 09000000
*                                                                       09050000
         ORG   OBREC+232               **                               09100000
CCW1     DS    D                       PREPARE BUFFERED LOG    @Y30LB11 09150000
         ORG   CCW1+4                  **                      @Y30LB11 09200000
CCWFLG1  DS    3C                      CCW FLAGS               @Y30LB11 09250000
CCWLNG1  DS    C                       LENGTH                  @Y30LB11 09300000
CCW2     DS    D                       READ/RESET BUFFERED LOG @Y30LB11 09350000
         ORG   CCW2+4                  **                      @Y30LB11 09400000
CCWFLG2  DS    3C                      CCW FLAGS               @Y30LB11 09450000
CCWLNG2  DS    C                       LENGTH                  @Y30LB11 09500000
*                                                                       09550000
LOGRECD  DSECT *                                                        09600000
LOGKEY   DS    C                       X'90' KEY                        09650000
RELNO    DS    C                       RELEASE NUMBER IN BINARY         09700000
SWITCH1  DS    C                       INDICATE TIME MACRO USED S99204  09750000
         DS    C                       SPACE                            09800000
RECID    DS    C                       RECORD ID                        09850000
         DS    CL2                     SPACE                            09900000
TPERID   DS    C                       C'T'                             09950000
RDATE    DS    CL4                     DATE FROM TIME MACRO             10000000
RTIME    DS    CL4                     TIME IN BINARY                   10050000
RECSER   DS    CL4                     CPU SER NUMBER                   10100000
RECPUID  DS    CL2                     CPU ID                           10150000
         DS    CL2                     SPACE                            10200000
UNITID   DS    CL2                     CHANNEL AND UNIT                 10250000
VOLID    DS    CL6                     VOLUME SERIAL NUMBER             10300000
*                                      2305 LOG AREA STARTS HERE        10350000
LOG      DS    CL122                   CONTROL UNIT LOG AREA            10400000
*                                      DSM LOG AREA STARTS HERE@Y30LB11 10450000
         ORG   LOG                                             @Y30LB11 10500000
         DS    C                       SPACE                   @Y30LB11 10550000
SSID     DS    XL2                     DSM SSID FIELD          @Y30LB11 10600000
*                                                                       10650000
*      THIS IS THE 3800 RECORD                                          10700000
*                                                                       10750000
         ORG   VOLID                                                    10800000
COUNT    DS    C                        RECORD COUNT           @Z40MB01 10850000
         DS    C                        UNUSED                 @Z40MB01 10900000
ERRREC   DS    CL128                    16-8 BYTE RECORDS      @Z40MB01 10950000
COPYCNT  DS    CL4                      COPY COUNTER           @Z40MB01 11000000
FRMFLCNT DS    CL4                      FORMS FLASH COUNT      @Z40MB01 11050000
*                                                                       11100000
         EJECT                                                          11150000
         ORG   VOLID                                           @G30HB19 11160037
FLG3895  DS    C                        RECORD COUNT           @G30HB19 11170037
         DS    C                        UNUSED                 @G30HB19 11180037
PREDSNS  DS    CL238                    PREDICTOR SENSE        @G30HB19 11190037
*                                                                       11200000
*        E Q U A T E S   -   M I S C E L L A N E O U S                  11250000
*                                                                       11300000
A370     EQU   X'01'                   A370 CPU TYPE                    11350000
A0       EQU   X'00'                   3851 LOOP ATTRIBUTE FLAG@Y30LB11 11400000
A80      EQU   X'80'                   3851 NO-LOOP ATTRIB FLAG@Y30LB11 11450000
BIRCHMS  EQU   X'D3'                   6250 DENSITY MODESET    @YM07123 11500000
COUNT3   EQU   X'03'                   SSID CHAIN CCW FLGS     @Y30LB11 11550000
CHAINFLG EQU   X'40'                   SSID CHAIN CCW FLGS     @Y30LB11 11600000
CHARF    EQU   X'C6'                   CHARACTER F             @ZA09512 11650000
CODE7F   EQU   X'7F'                   GOOD I/O COMP           @Y30LB11 11700000
CPUIDEN  EQU   16                      SYS ID OFFSET                    11800000
CUAMASK  EQU   X'0F'                   CHANNEL ADDR MASK       @YA00070 11850000
VS2MASK  EQU X'80'                     SYSTEM ID FOR MDR REC   @ZUP1066 11900000
DDSM     EQU   X'42'                   3851 DEV TYPE IN UCB    @Y30LB11 11950000
D3895    EQU   X'19'                   3895 DEV TYPE IN UCB    @G30HB19 11960037
HEXC0    EQU   X'C0'                                           @ZA09525 11990037
HEXDF    EQU   X'DF'                                           @ZA09525 12020037
HEXFF    EQU   X'FF'                                           @G30HB19 12050037
IDDSM    EQU   X'0E'                   3851 RECORD             @Y30LB11 12080037
LDSM     EQU   64                      64 BYTE 3851 RECORD     @Y30LB11 12110037
PBLCMD   EQU   X'87'                   PBL CMD FOR 3851        @Y30LB11 12140037
CMNFLAG  EQU   X'00'                   3895 RECORD TYPE        @G30HB19 12170037
AN80     EQU   X'80'                   3895 ERR RECORD TYPE    @G30HB19 12200037
RRBLCMD  EQU   X'A4'                   RRBL CMD FOR 3851       @Y30LB11 12250000
RDLOG3Y  EQU   X'14'                   RRBL CMD FOR 3895       @G30HB19 12260037
PLBORD   EQU   X'26'                   PRBL ORDER CODE         @Y30LB10 12300000
EMULFLG  EQU   X'08'                   3350 EMULATION FLAG     @Z20AB05 12350000
C0       EQU   0                       COUNT OF 0                       12400000
C1       EQU   1                       COUNT OF 1                       12450000
C2       EQU   2                       COUNT OF 2                       12500000
C3       EQU   3                       COUNT OF 3              @Z30AB01 12550000
C4       EQU   4                       COUNT OF 4                       12600000
C5       EQU   5                       COUNT OF 5                       12650000
C6       EQU   6                       COUNT OF 6                       12700000
C7       EQU   7                       COUNT OF 7                       12750000
C8       EQU   8                       COUNT OF 8                       12800000
C10      EQU   10                      COUNT OF 10                      12850000
C12      EQU   12                      COUNT OF 12                      12900000
C16      EQU   16                      COUNT OF 16             @Z40MB01 12950000
C19      EQU   19                      COUNT OF 19                      13000000
C24      EQU   24                      COUNT OF 24                      13050000
C26      EQU   26                      COUNT OF 26                      13100000
C28      EQU   28                      COUNT OF 28             @Z40MB01 13150000
C30      EQU   30                      COUNT OF 30                      13200000
C32      EQU   32                      LENGTH OF 3851 SENSE    @Y30LB11 13250000
C40      EQU   40                      COUNT OF 40             @Z40MB01 13300000
C44      EQU   44                      COUNT OF 44                      13350000
C62      EQU   62                      COUNT OF 62                      13400000
C70      EQU   70                      COUNT OF 70             @G30HB19 13410037
C72      EQU   72                      COUNT OF 72                      13450000
C76      EQU   76                      COUNT OF 76                      13500000
C80      EQU   80                      COUNT OF 80             @G30HB19 13520037
C96      EQU   96                      OFFSET FOR LOG DATA      X04QC11 13550000
C108     EQU   108                     COUNT OF 108              M0900  13600000
C128     EQU   128                     COUNT OF 128                     13650000
C136     EQU   136                     COUNT OF 136            @Z40MB01 13700000
C154     EQU   154                     COUNT OF 154                     13750000
C168     EQU   168                     COUNT OF 168                     13800000
C238     EQU   238                     COUNT OF 238            @G30HB19 13810037
C256     EQU   256                     COUNT OF 256                     13850000
C336     EQU   336                     COUNT OF 336            @G30HB19 13860037
C512     EQU   512                     COUNT OF 512            @ZA30027 13880037
C2304    EQU   2304                    COUNT OF 2304                    13900000
DATALEN  EQU   30                      DATA LENGTH + 2                  13950000
DEBDVMOD EQU   32                      DEVICE MODIFIER           M0900  14000000
DEBFLG   EQU   X'0F'                   DEB INDICATOR                    14050000
DEBOPATB EQU   12                      TYPE OF I/O               M0900  14100000
DEBUCB   EQU   32                      UCB ADDRESS               M0900  14150000
DEN      EQU   X'C3'                   DENSITY MASK                     14200000
DENX     EQU   X'83'                   800 BPI MASK                     14250000
DISMNT   EQU   X'04'                   DISMOUNT RECORD FLAG             14300000
EOD      EQU   51                      EOD INDICATOR             M0877  14350000
EODBIT   EQU   X'80'                   EOD FLAG BIT              M0877  14400000
EXCPMSK  EQU   X'80'                   EXCP MASKBIT                     14450000
FIXREC1  EQU   X'80'                   FIXED LENGTH RECORD MASK         14500000
FIXREC2  EQU   X'40'                   FIXED LENGTH RECORD MASK         14550000
FULL     EQU   X'FF'                   ALL ONES                         14600000
HEX07    EQU   X'07'                   HEX '07'                         14650000
HEXF8    EQU   X'F8'                   HEX 'F8'                         14700000
IOBFLG1  EQU   X'42'                   IOBFLAG BYTE                     14750000
IOBCC3WE EQU   X'40'                   IOS POST '6D' ON CC=3   @ZA18278 14770037
JOBNAME  EQU   0                       JOB LOG NUMBER OFFSET            14800000
NAME     EQU   525                     OFFSET IN UCB TO CHAN   @ZA11663 14850000
KEY      EQU   X'90'                   KEY FOR TPER RECORD              14900000
NOERRTNS EQU   X'0C'                   DON'T USE IOS ERROR RTNS         14950000
NRZI     EQU   X'CB'                   NRZI MODE SET MASK               15000000
RDLOG    EQU   X'24'                   READ BUFFERED LOG OP CODE        15050000
RDLOG3X  EQU   X'A4'                   READ LOG COMMAND FOR 3330        15100000
REC      EQU   96                      REC OFFSET IN SVRB               15150000
SDRCN    EQU   20                      COUNT OF SDR BYTES               15200037
SLI      EQU   X'20'                   SUPPRESS LENGTH BIT              15250037
SNSCT    EQU   4                       COUNT OF SENSE BYTES             15300037
STI      EQU   1                       STAT TABLE INDEX                 15500000
SWCHMASK EQU   X'08'                   TIME MACRO MASK                  15550000
TIMAC    EQU   X'08'                   TIME MACRO USED                  15600000
TIOT     EQU   12                      TASK I/O TABLE OFFSET            15650000
TPR      EQU   C'T'                    T TYPE RECORD                    15700000
UCBX     EQU   X'30'                   UCB EXTENSION ADDRESS            15750000
UNCK     EQU   X'30'                   UNIT CHECK RECORD                15800000
X0F      EQU   X'0F'                   HEX BYTE OF 0F          @Y30LB10 15850000
ZERO     EQU   X'00'                   ZERO                             15900000
DBDCB    EQU   X'18'                   DCB ADDR FROM DEB       @ZA32130 15920037
         EJECT                                                          15950000
*                                                                       16000000
*        E Q U A T E S   -  B U F F E R E D  L O G  D E V I C E S       16050000
*                                                                       16100000
D2305A   EQU   6                       2305A DEVICE                     16150000
D2305B   EQU   7                       2305B DEVICE                     16200000
D3330    EQU   9                       3330 DEVICE                      16250000
D33301   EQU   X'0D'                   3330-1 DEVICE                    16300000
D3340    EQU   X'0A'                   3340 DEVICE                      16350000
D3800    EQU   X'0E'                   3800 DEVICE             @Z40MB01 16400000
D3350    EQU   X'0B'                   3350ID DEVICE IN UCB    @Z20AB05 16450000
ID3350   EQU   X'11'                   3350ID RECORD ID        @Z20AB05 16500000
ID2305   EQU   X'12'                   2305 RECORD             @YA02415 16550000
ID2305A  EQU   X'02'                   2305 TPER RECORD ID     @YA02415 16600000
ID3330   EQU   1                       3330 RECORD                      16650000
ID33301  EQU   X'0A'                   3330-1 RECORD                    16700000
ID3340   EQU   X'09'                   3340 TYPE RECORD                 16750000
ID3800   EQU   X'0C'                   3800 TYPE RECORD        @Z40MB01 16800000
ID3895   EQU   X'0D'                   3895 TYPE RECORD        @G30HB19 16810037
L56      EQU   56                      056-BYTE RECORD - 3330           16850000
L154     EQU   154                     154-BYTE RECORD - 2305           16900000
L164     EQU   164                     164-BYTE RECORD - 3800  @Z40MB01 16950000
L3895    EQU   266                     266-BYTE RECORD - 3895  @G30HB19 16960037
         EJECT                                                          17000000
*                                                                       17050000
*        R E G I S T E R   A S S I G N M E N T S                        17100000
*                                                                       17150000
R0       EQU   0                       REGISTER 0                       17200000
R1       EQU   1                       REGISTER 1                       17250000
WORK     EQU   2                       WORK REGISTER                    17300000
LNKREG   EQU   2                       LINK REGISTER                    17350000
CVTREG   EQU   3                       CVT REGISTER                     17400000
TCBREG   EQU   4                       TCB REGISTER                     17450000
R4       EQU   4                       WORK REGISTER                    17500000
SVRBREG  EQU   5                       SVRB REGISTER                    17550000
UXREG    EQU   6                       UCB EXTENSION ADDR REG           17600000
LOGREG   EQU   7                       RECORD REGISTER                  17650000
ADDR     EQU   8                       ADDRESS REGISTER                 17700000
WORKREG2 EQU   8                       WORK REGISTER           @Z40MB01 17750000
TEST     EQU   9                       GENERAL TEST REGISTER            17800000
WORKREG3 EQU   9                       WORK REGISTER           @Z40MB01 17850000
UCBREG   EQU   10                      UCB REGISTER                     17900000
DEBREG   EQU   11                      DEB REGISTER                     17950000
CORE     EQU   11                      GETMAIN ADDRESS                  18000000
BASREG   EQU   12                      PROGRAM BASE REGISTER            18050000
DCBREG   EQU   13                      DCB REGISTER                     18100000
RETREG   EQU   14                      RETURN REGISTER                  18150000
CODREG   EQU   15                      RETURN CODE REGISTER             18200000
R15      EQU   15                      REGISTER 15                      18250000
         EJECT                                                          18300000
*********************************************************************** 18350000
*                         P A R T   1                                 * 18400000
*********************************************************************** 18450000
IGC0009A CSECT                                                          18500000
* A-000000-999999                                                Y026XZ 18550000
         BALR  BASREG,ZERO             BASE REGISTER                    18600000
START    EQU   *                                                        18650000
         USING *,BASREG                *                                18700000
         USING CVT,CVTREG              CVT DSECT ADDRESS                18750000
         USING IHADCB,DCBREG           DCB DSECT ADDRESS                18800000
         USING SVRB,SVRBREG            SVRB AND RECORD DSECT ADDR       18850000
         USING MAIN,CORE               GETMAIN DSECT ADDRESS            18900000
         USING UCBMT,UXREG             UCB EXTENSION ADDRESS            18950000
         USING UCB,UCBREG              UCB DSECT ADDRESS                19000000
         USING LOGRECD,LOGREG          LOGRECD DSECT ADDRESS            19050000
         SH    CVTREG,BACK8            GET CVT PREFIX          @YA11111 19070037
         B     BEGIN                   BRANCH AROUND DECLARE            19100000
         DC    C'IGC0009A-SVC 91 OZ30027'                               19150037
         DATEM                                                          19200000
*                                                                       19250000
         DS    0F                      ALIGN                            19300000
BEGIN    EQU   *                                                        19350000
         EJECT                                                          19400000
         STC   R1,RECNULL              SAVE INDICATOR FLAG       M0877  19408037
         LR    WORKREG3,R0             SAVE INPUT                       19428037
* ISSUE TESTAUTH TO INSURE CALLER IS APF AUTHORIZED           @ZA32130  19448037
         TESTAUTH  FCTN=1,STATE=YES,KEY=YES                   @ZA32130  19468037
*                                                                       19488037
         LTR   R15,R15                 TEST RETURN CODE       @ZA32130  19508037
         BZ    BEGIN2                  BRANCH IF ZERO         @ZA32130  19528037
         L     R1,ABEND1               GET COMP CODE.         @ZA32130  19548037
* ISSUE ABEND FOR ANY UNAUTHORIZED CALLER                     @ZA32130  19568037
         ABEND (1),,,SYSTEM                                   @ZA32130  19588037
*                                                                       19608037
BEGIN2   MVC   RECNTRS(C8),BLANKS      BLANK JOBNAME FIELD              19628037
         MVC   RECVOL(C6),BLANKS       BLANK VOL I.D. FIELD             19648037
         MVC   RECBLK(C2),ZEROES       ZERO BLOCK COUNT        @YA02144 19668037
         L     ADDR,TIOT(TCBREG)       ADDRESS OF TIOTT                 19688037
         LTR   R0,WORKREG3             IS REGISTER NEGATIVE?            19708037
         BNM   A110                    NO - BRANCH, CONTAINS DCB        19750000
*                                                                       19800000
*  REGISTER 0 CONTAINS ADDRESS OF UCB IN TWOS COMPLEMENT                19850000
*                                                                       19900000
         LPR   UCBREG,R0               MAKE R0 POSITIVE                 19950000
         SH    UCBREG,H512             POINT TO UCB PREFIX              20000000
         TM    UCBID,UCBSTND           IS IT A UCB - ID='FF'?           20050000
         BCR   14,RETREG               NO - RETURN TO CALLER            20100000
*                                                                       20150000
*  TEST UCB FOR TYPE OF DEVICE                                          20200000
*                                                                       20250000
         CLI   UCBTBYT3,UCB3DACC       UCB FOR DISK?                    20300000
         BE    PART2                   YES - GO TO PART 2               20350000
         CLI   UCBTBYT3,UCB3UREC       IS IT UNIT RECORD       @Y30LB10 20400000
         BE    PART2                   BR YES TO PART 2        @Y30LB10 20450000
*                                                                       20500000
*  TEST FOR TAPE UCB                                                    20550000
*  DETERMINE IF CALL WAS FROM EOD.  IF SO, TEST FOR ZERO                20600000
*  SIO COUNT.  IF ZERO, RETURN TO CALLER                                20650000
*                                                                       20700000
A100     EQU   *                                                        20750000
         CLI   UCBTBYT3,UCB3TAPE       UCB FOR TAPE?                    20800000
         BCR   7,RETREG                NO - RETURN TO CALLER            20850000
         L     UXREG,UCBXTN            ADDR OF UCB EXTENSION            20900000
         CLC   UCBSIO,ZEROES           SIO COUNT ZERO?         @YA00073 20950000
         BCR   8,RETREG                YES - RETURN TO CALLER  @YA00073 21000000
         B     A140                    GET REST OF RECORD               21050000
*                                                                       21100000
*  REG 0 CONTAINED A DCB ADDRESS.  THIS ROUTINE GETS CONTROL            21150000
*  BLOCK ADDRESSES, I.E., DEB AND UCB AND VALIDITY CHECKS THE DEB.      21200037
*                                                                       21210037
A110     EQU   *                                                        21220037
         LR    R1,R0                   DCB IN R1 OF DEBCHECK   @ZA25497 21230037
         DEBCHK (1)                    VALIDITY CHECK THE DEB  @ZA25497 21240037
         LR    DEBREG,R1               IF RETURNED, VALID DEB  @ZA32130 21250037
         L     DCBREG,DBDCB(DEBREG)    GET DCB FROM DEB        @ZA32130 21260037
         SR    R1,R1                   CLEAR REG 1             @ZA25497 21270037
         IC    R1,RECNULL              RESTORE INDICATOR FLAG  @ZA25497 21280037
         XR    UCBREG,UCBREG           CLEAR REG              @Z30AB01  21340037
         ICM   UCBREG,C3,DEBUCB+C2(DEBREG) ADDR OF UCB        @Z30AB01  21350037
         SH    UCBREG,H512             POINT TO UCB PREFIX              21360037
         TM    UCBID,UCBSTND           IS IT A UCB-ID='FF'?    @ZA25497 21370037
         BCR   14,RETREG               NO, RETURN TO CALLER    @ZA25497 21380037
*                                                                       21390037
*  TEST UCB FOR TYPE OF DEVICE                                 @ZA25497 21400037
*                                                                       21410037
         CLI   UCBTBYT3,UCB3DACC       UCB FOR DISK?           @ZA25497 21420037
         BE    PART2                   YES, GO TO PART 2       @ZA25497 21430037
         CLI   UCBTBYT3,UCB3UREC       IS IT UNIT RECORD?      @ZA25497 21440037
         BE    PART2                   YES, GO TO PART 2       @ZA25497 21450037
         CLI   UCBTBYT3,UCB3TAPE       UCB FOR TAPE?           @ZA25497 21460037
         BCR   7,RETREG                NO, RETURN TO CALLER    @ZA25497 21470037
         L     UXREG,UCBXTN            ADDR OF UCB EXTENSION            21600037
*                                                                       21700000
*  THIS ROUTINE GETS MODE SET AND BLOCK COUNT FOR                       21750000
*  RECORDS AND SAVES THEM IN THE SVRB EXTENDED WORK AREA                21800000
*                                                                       21850000
A120     EQU   *                                                        21900000
         MVC   UCBMS,DEBDVMOD(DEBREG)  SAVE MODE SET                    21950000
         TM    DCBMACRF,EXCPMSK        PROGRAMMED IN EXCP?              22000000
         BO    A130                    YES - LEAVE BLK COUNT ZERO       22050000
         TM    DCBRECFM,FIXREC1        FIXED RECORD LENGTH?             22100000
         BZ    A130                    NO - LEAVE BLK COUNT ZERO        22150000
         TM    DCBRECFM,FIXREC2        FIXED FOR SURE?                  22200000
         BO    A130                    NO - LEAVE BLK COUNT ZERO        22250000
         MVC   RECBLK(C2),DCBBLKSI     SAVE BLOCK COUNT                 22300000
*                                                                       22350000
*  GET JOBNAME HERE IF TIOT IS AVAILABLE                                22400000
*                                                                       22450000
A130     EQU   *                                                        22500000
         LTR   ADDR,ADDR               TIOT AVAILABLE?                  22550000
         BZ    A140                    NO - JOBNAME NOT AVAILABLE       22600000
         MVC   RECNTRS(C8),JOBNAME(ADDR)   SAVE JOB NAME                22650000
*                                                                       22700000
*  VOLUME SERIAL NUMBER PROCESSING ROUTINE                     @YA00078 22750000
*  IF A LABEL EXISTS IN THE UCB AND IT IS VERIFIED,                     22800000
*  THIS ROUTINE WILL INCLUDE THAT LABEL IN THE RECORD.                  22850000
*                                                                       22900000
A140     EQU   *                                                        22950000
         CLI   UCBVOLI,ZERO            VOL SER AVAILABLE?      @YA00078 23000000
         BE    A150                    NO - CONTINUE REC PROC  @YA00078 23050000
         TM    UCBDMCT,UCBMOUNT        HAS LABEL BEEN VERIFIED @YA00078 23100000
         BO    A150                    NO - LEAVE FIELD BLANK  @YA00078 23150000
         MVC   RECVOL(C6),UCBVOLI      SAVE VOLUME I.D.        @YA00078 23200000
*                                                                       23250000
*  THIS ROUTINE GETS ALL COMMON DATA, I.E., DEVICE TYPE, CONTROL        23300000
*  UNIT ADDRESS, TIME AND DATE.  THIS DATA IS SAVED IN THE SVRB         23350000
*  EXTENDED WORK AREA.                                                  23400000
*                                                                       23450000
A150     EQU   *                                                        23500000
         MVC   RECDEV(C4),UCBTYP       SAVE DEVICE TYPE                 23550000
         MVC   RECADDR(C2),UCBCHA      SAVE CONTROL UNIT ADDRESS        23600000
         NI    RECADDR,CUAMASK         FOR RECORD                       23650000
*                                                                       23700000
         TM    UCBTBYT4,UCB3400        3400 TYPE DEVICE?                23750000
         BNO   A230                    NO - SKIP OBR FOR 2400           23800000
*                                                                       23850000
*  DO GETMAIN TO OBTAIN CORE FOR LOG RECORD                             23900000
*                                                                       23950000
         BAL   LNKREG,GETMAIN          GO ISSUE GETMAIN                 24000000
         LTR   CODREG,CODREG           WAS GETMAIN SUCCESSFUL? @Y30LB11 24050000
         BNZ   A180                    NO - TRY SMF RECORD     @Y30LB11 24100000
         XC    OBREC(C168),OBREC       CLEAR WORK AREA                  24150000
         EJECT                                                          24200000
*********************************************************************** 24250000
*                       0   B   R                                     * 24300000
*********************************************************************** 24350000
*                                                                       24400000
*  THE FOLLOWING CREATES THE OBR (LOGREC) RECORD IN THE GETMAIN AREA.   24450000
*  MOVE IN COMMON DATA FROM SVRB EXTENDED WORK AREA.                    24500000
*                                                                       24550000
OBR      EQU   *                                                        24600000
         TIME  DEC                     GET TIME AND DATE                24650000
         ST    R0,DOUBLE+C4            SAVE TIME INFORMATION   @YA00071 24700000
         ST    R1,DOUBLE               SAVE DATE INFORMATION   @YA00071 24750000
         MVC   DATE(C8),DOUBLE         MOVE TO RECORD AREA     @YA00071 24800000
         MVC   DEVTYPE(C4),RECDEV      GET DEVICE TYPE                  24850000
         MVC   SECCUA+C1(C2),RECADDR   GET CONTROL UNIT ADDR   @ZA09512 24900000
         MVC   PRICUA+C2(C1),RECADDR+C1 GET CU AND DEV ADDR    @ZA09512 24950000
         IC    WORK,NAME(UCBREG)       GET CHANNEL NUMBER      @ZA09512 25000000
         CLI   NAME(UCBREG),CHARF      IS IT ALPHA (A-F)       @ZA09512 25050000
         BH    A155                    NO, ENTER AS IS         @ZA09512 25100000
         AH    WORK,DEC57              ADD HEX 39 TO NUMBER    @ZA09512 25150000
A155     STC   WORK,PRICUA+C1          PUT CHANNEL IN RECORD   @ZA09512 25200000
         NI    PRICUA+C1,CUAMASK       TURN OFF HIGH BITS      @ZA09512 25250000
         MVC   VLID(C6),RECVOL         GET VOLUME ID                    25300000
         MVC   BLKLTH(C2),RECBLK       GET BLOCK SIZE                   25350000
         MVC   JOBID(C8),RECNTRS       GET JOB NAME                     25400000
*                                                                       25450000
*  THE REMAINING ROUTINES OBTAIN ALL NON-COMMON                         25500000
*  DATA FIRST, THE CPU ID AND RELEASE NUMBER                            25550000
*                                                                       25600000
         MVC   CPUID,CVTMDL            CPU ID IN RECORD                 25650037
         PACK  WORKA(C8),CVTRELNO(C2)  GET RELEASE NUMBER               25700037
         CVB   WORK,WORKA              CONVERT TO BINARY                25850000
         STC   WORK,SYSREL             RELEASE NUMBER IN RECORD         25900000
         OI    SYSREL,VS2MASK          VS2 SYS IN MDR REC      @ZUP1066 25950000
         TM    CPUID,FULL              IS THIS A 360?                   26000000
         BZ    A160                    YES - GET NEXT RECORD            26050000
         CLC   CON175(C2),CPUID        IS IT A 175?                     26100000
         BE    A160                    YES - BRANCH AROUND              26150000
         STIDP NA1                     STORE CPUID INSTRUCTION @Y30LB11 26200000
*                                                                       26250000
*  OBTAIN CLASS/SOURCE, SET SWITCHES, INCLUDING EOD SWITCH              26300000
*  IF NECESSARY, DEVICE DEPENDENT DATA COUNT, AND SDR COUNT             26350000
*                                                                       26400000
A160     EQU   *                                                        26450000
         MVI   SDRCNT,SDRCN            SET IN SDR COUNT                 26500000
         MVI   CLSOURCE,UNCK           SET CLASS/SOURCE                 26550000
         MVI   SWITCHES,TIMAC          SET SWITCHES                     26600000
         MVI   SWITCHES+C1,DISMNT      SET SWITCHES                     26650000
         CLI   RECNULL,EOD             CALLED BY EOD?                   26700000
         BNE   A170                    NO - LEAVE EOD BIT OFF           26750000
         MVI   SWITCHES+C1,EODBIT      YES - TURN EOD BIT ON            26800000
         EJECT                                                          26850000
*                                                                       26900000
*  THIS ROUTINE GETS VES COUNTERS                                       26950000
*                                                                       27000000
A170     EQU   *                                                        27050000
         MVC   HDRSER(C16),UCBCTD      MOVE IN VES COUNTERS    @ZA27097 27100037
*                                                                       27150000
*  THIS ROUTINE LOCATES SDR COUNTERS FOR THIS RECORD                    27200000
*                                                                       27250000
A180     EQU   *                                                        27300000
         L     ADDR,CVTSTB             ADDR OF SDR TABLE                27350037
         SR    TEST,TEST               ZERO REGISTER                    27400000
         L     R4,UCBEXTPT             GET ADDR OF UCB COMMON EXTN.     27450000
         LA    R4,0(R4)                GET 3-BYTE ADDRESS               27500000
         IC    TEST,STI(R4)            GET SDR INDEX                    27550000
         LR    WORK,ADDR               SAVE SDR TABLE ADDR              27600000
         LA    UCBREG,C512(UCBREG)     POINT TO UCB BASE       @ZA30027 27620037
A200     EQU   *                                                        27650000
         CLM   UCBREG,C3,0(ADDR)       SDR AREA SECTION?       @Z30AB01 27700000
         BNH   A210                    YES-GET OUT OF LOOP     @Z30AB01 27750000
         LA    ADDR,C2(ADDR)           INCREMENT TO NEXT SECTION        27800000
         LA    TEST,C256(TEST)         STEP INDEX                       27850000
         B     A200                    TEST NEXT SECTION                27900000
*                                                                       27950000
*  FOUND SDR SECTION.  NOW LOCATE ENTRY FOR THIS TABLE                  28000000
*                                                                       28050000
A210     EQU   *                                                        28100000
         SH    UCBREG,H512             POINT TO PREFIX         @ZA30027 28120037
         MH    TEST,X10                INDEX TIMES 10                   28150000
         AR    WORK,TEST               ENTRY FOR THIS TABLE             28200000
         LTR   CORE,CORE               CREATING A RECORD?               28250000
         BZ    A215                    NO - CORE UNAVAILABLE            28300000
         MVC   SDR,0(WORK)             MOVE IN SDR COUNTERS             28350000
A215     EQU   *                                                        28400000
         XC    C1(C19,WORK),C1(WORK)   CLEAR SDR COUNTERS               28450000
         LTR   CORE,CORE               CREATING A RECORD?               28500000
         BZ    A230                    NO - TRY SMF RECORD              28550000
*                                                                       28600000
*  THIS ROUTINE COLLECTS SENSE DATA                                     28650000
*                                                                       28700000
         SR    R1,R1                   ZERO REGISTER 1                  28750000
         IC    R1,SNSCT(R4)            GET NUMBER OF SENSE BYTES        28800000
         STC   R1,SNSCNT+C1            STORE IN SENSE COUNT             28850000
         LA    R0,C108                 RECORD LENGTH LESS SENSE COUNT   28900000
         AR    R0,R1                   ADD TO RECORD LENGTH             28950000
         LNR   R0,R0                   MAKE TWO'S COMPLEMENT            29000000
         LA    R1,OBREC                ADDRESS OF OBR RECORD            29050000
         SVC   76                      GO TO OBR ROUTINE TO RECORD      29100000
         EJECT                                                          29150000
*                                                                       29200000
*  THIS ROUTINE FREES THE GOTTEN CORE                                   29250000
*                                                                       29300000
A220     EQU   *                                                        29350000
         LR    R1,CORE                 ADDRESS OF GOTTEN CORE           29400000
         FREEMAIN  R,LV=344,A=(1),SP=255                       @ZA27122 29450037
         EJECT                                                          29500000
*                                                                       29550000
*  THIS ROUTINE BUILDS THE SMF TYPE 21 RECORDS                          29600000
*  IN THE SVRB EXTENDED WORK AREA                                       29650000
*                                                                       29700000
A230     EQU   *                                                        29750000
         MVC   RECTOT(C6),LENTAP       LENGTH OF REC AND TAPE FLAG      29800000
         TIME  BIN                     GET TIME AND DATE       @YA00071 29850000
         STM   R0,R1,RECNTRS           PUT TIME AND DATE       @YM03278 29900000
         MVC   RECTIME(C8),RECNTRS        IN RECORD            @YM03278 29950000
*                                                                       30000000
         L     ADDR,CVTSMCA            ADDRESS OF SMCA                  30050037
         MVC   RECCPU(C4),CPUIDEN(ADDR)   GET CPU ID & MODEL NUMBER     30100000
*                                                                       30150000
         LA    WORK,DATALEN            DATA LENGTH + 2                  30200000
         STH   WORK,RECLEN               IN RECORD                      30250000
         MVC   RECDEV,UCBTYP           DEV TYPE IN RECORD               30300000
         MVC   RECNTRS(C7),UCBTR       ESV COUNTERS                     30350000
         MVC   RECNTRS+C7(C4),UCBERG     IN RECORD                      30400000
         MVC   RECDEN,UCBMS            TAPE DENSITY IN RECORD           30450000
         CLI   UCBMS,BIRCHMS           6250 MODE SET?          @YM07123 30500000
         BE    A240                    YES, BRANCH AROUND      @YM07123 30550000
         NI    RECDEN,DEN              SAVE DENSITY BITS ONLY           30600000
         CLI   UCBMS,NRZI              NRZI MODE SET?                   30650000
         BNE   A240                    NO - BRANCH AROUND               30700000
         NI    RECDEN,DENX             SET TO 800 BPI                   30750000
*                                                                       30800000
A240     EQU   *                                                        30850000
         LA    R1,REC(SVRBREG)         ADDRESS OF ESV RECORD            30900000
         SMFWTM (1)                    WRITE REC TO SYS1.MAN            30950000
         EJECT                                                          31000000
A250     EQU   *                                                        31050000
         XC    UCBTR(C12),UCBTR        ZERO VES COUNTERS                31100000
         BR    RETREG                  RETURN TO CALLER                 31150000
         EJECT                                                          31200000
*********************************************************************** 31250000
*                           P A R T   2                               * 31300000
*                             D I S K                                 * 31350000
*********************************************************************** 31400000
*        THIS SECTION BUILDS CONTROL BLOCKS WHICH ARE NECESSARY       * 31450000
*        TO ISSUE AN EXCP TO READ THE CONTROL UNIT BUFFERED LOG       * 31500000
*        IN A 3330, 3330-1, 3340, 3851, 2305 ,3800, OR 3895.          * 31550037
*                                                                     * 31600000
*        A TPER RECORD IS THEN BUILT ACCORDING TO THE LOGRECD         * 31650000
*        PORTION OF THE GETMAIN AREA.  THE FORMATTED TPER             * 31700000
*        RECORD IS THEN WRITTEN ONTO SYS1.LOGREC BY SVC 76.           * 31750000
*********************************************************************** 31800000
PART2    EQU   *                                                        31850000
         SR    CODREG,CODREG           SET 0 RETURN CODE                31900000
         CLI   UCBTBYT4,D3330          IS THIS A 3330?                  31950000
         BE    B100                    YES - LOGABLE, BRANCH            32000000
         CLI   UCBTBYT4,D3350          IS THIS A 3350?         @Z20AB05 32050000
         BE    B100                    YES - LOGABLE, BRANCH   @Z20AB05 32100000
         CLI   UCBTBYT4,D33301         IS IT A 3330-1?          XL03145 32150000
         BE    B100                    YES - LOGABLE, BRANCH    XL03145 32200000
         CLI   UCBTBYT4,D3340          IS IT A 3340?            XL03130 32250000
         BE    B110                    YES - LOGABLE, BRANCH    XL03130 32300000
         CLI   UCBTBYT4,D2305A         IS THIS A 2305A?                 32350000
         BE    B110                    YES - LOGABLE, BRANCH            32400000
         CLI   UCBTBYT4,D2305B         IS THIS A 2305B?                 32450000
         BE    B110                    YES - LOGABLE, BRANCH   @Y30LB11 32500000
         CLI   UCBTBYT4,D3800          IS THIS A 3800?         @Z40MB01 32550000
         BE    B110                    YES - LOGABLE, BRANCH   @Z40MB01 32600000
         CLI   UCBTBYT4,D3895          IS THIS A 3895?         @G30HB19 32610037
         BE    B095                    YES - LOGABLE, BRANCH   @G30HB19 32620037
         CLI   UCBTBYT4,DDSM           IS THIS A 3851 COMPONENT@Y30LB11 32640037
         BNE RETURN                    IF NOT RETURN TO CALLER @Y30LB11 32660037
         B     B110                    OTHERWISE BRANCH        @Y30LB11 32680037
B095     EQU   *                                               @G30HB19 32700037
         NI    UCBFL1,HEXFF-UCBNRY     SET THE DEVICE READY    @G30HB19 32720037
         B     B110                    BRANCH TO CONTINUE      @G30HB19 32740037
*                                                                       32800000
*                   L O G A B L E                                       32850000
*                                                                       32900000
B100     EQU   *                                                        32950000
         TM    UCBTBYT2,UCBRVDEV       IS THE DASD VIRTUAL     @Y30LB11 33000000
         BO    RETURN                  BRANCH IF YES           @Y30LB11 33050000
*                                                                       33100000
B110     EQU   *                                                        33150000
         LA    CODREG,C1               SET RETURN CODE TO 1             33200000
         TM    UCBFL1,UCBNRY           IS THE DEVICE READY?             33250000
         BO    RETURN                  NO - RETURN TO CALLER            33300000
         XC    PLBOP(C8),PLBOP         ZERO 3851 DATA AREA     @Y30LB10 33350000
         STH   R1,SSIDXX               STORE SSID              @Y30LB10 33400000
*                                                                       33450000
*  DO GETMAIN TO OBTAIN CORE FOR CONTROL BLOCKS AND LOG RECORD          33500000
*                                                                       33550000
         BAL   LNKREG,GETMAIN          GO ISSUE GETMAIN RECORD          33600000
         LTR   CODREG,CODREG           WAS CORE AVAILABLE?     @Y30LB11 33650000
         BNZ   RETURN                  BRANCH IF NO CORE       @Y30LB11 33700000
*                                                                       33750000
         XC    CTLBLK(C256),CTLBLK     CLEAR WORK AREA         @G30HB19 33800037
         XC    CTLBLK+C256(C80),CTLBLK+256 CLEAR WORK AREA     @G30HB19 33803037
         XC    CCW,CCW                 CLEAR CCW               @G30HB19 33810037
         MVI   CCWFLG,SLI              SUPPRESS LENGTH         @G30HB19 33820037
*                                                                       33850000
*  SET UP CONTROL BLOCKS:  IOB & DEB                                    33900000
*                                                                       33950000
         MVI   IOB,IOBFLG1             SET COMMAND CHAINING BITS        34000000
         LA    WORK,ECB                GET ECB ADDR                     34050000
         ST    WORK,IOBECBPT           PUT IN IOB                       34100000
         LA    WORK,CCW                GET CCW ADDR                     34150000
         ST    WORK,IOBSTART           PUT IN IOB'                      34200000
         LA    WORK,DCB                GET DCB ADDR                     34250000
         ST    WORK,IOBDCBPT           PUT IN IOB                       34300000
         ST    WORK,DEBDCBAD              AND IN DEB                    34350000
         LA    WORK,DEB                GET DEB ADDR                     34400000
         ST    WORK,DCBDEB             PUT IN DEB                       34450000
         AH    UCBREG,H512             POINT TO UCB                     34500000
         ST    UCBREG,DEBUCBAD         PUT UCB ADDR IN DEB              34550000
         SH    UCBREG,H512             POINT BACK TO UCB PREFIX         34600000
*                                                                       34650000
         L     WORK,CVTXAPG            GET DUMMY APPENDAGE TABLE        34700000
         ST    WORK,DEBAPPAD           PUT ADDR IN DEB                  34750000
         MVI   DEBAPPAD,C4             INDICATE DASD DEB                34800000
*                                                                       34850000
         MVI   DEBDCBAD,DEBFLG         INDICATE THIS IS A DEB           34900000
*                                                                       34950000
         CLI   UCBTBYT4,DDSM           IS THE 3851 THE CALLER  @ZM02157 35000000
         BE    B160                    BRANCH IF YES           @ZM02157 35050000
         OI    DCB+C44,NOERRTNS        DON'T USE IOS ERROR RTNS  A47255 35100000
         CLI   UCBTBYT4,D3895          IS THE 3895 THE CALLER  @G30HB19 35110037
         BNE   DA3800                   NO, GO TEST 3800       @G30HB19 35120037
         MVI   CCWLNG,C238              238 BYTE LOG           @G30HB19 35130037
         LA    LOGREG,C70(CORE)         GET RECORD ADDRESS     @G30HB19 35140037
         LA    WORK,PREDSNS             GET RECORD LOCATION    @G30HB19 35142037
         ST    WORK,CCW                 PUT IT IN THE CCW      @G30HB19 35144037
         MVI   CCW,RDLOG3Y              READ LOG COMMAND       @G30HB19 35146037
         B     B200                     GO READ LOG            @G30HB19 35148037
*                                                                       35150000
*                                                                       35300000
DA3800   EQU   *                                                        35350000
         CLI   UCBTBYT4,D3800           IS THIS A 3800         @Z40MB01 35400000
         BNE   B150                     NO, GO TEST DASD       @Z40MB01 35450000
         MVI   CCWLNG,C136              136 BYTE LOG           @Z40MB01 35500000
*TURN ON BIT 1 IN IOBFLAG4 SO THAT IOS WILL POST X'6D' ON CC=3          35510037
         MVI   IOBFLAG4,IOBCC3WE        SET X'40' IN IOBFLAG4  @ZA18278 35520037
         LA    LOGREG,C72(CORE)         GET RECORD ADDRESS     @Z40MB01 35550000
         LA    WORK,ERRREC              GET RECORD LOCATION    @Z40MB01 35600000
         ST    WORK,CCW                 PUT IT IN THE CCW      @Z40MB01 35650000
         MVI   CCW,RDLOG                READ LOG COMMAND       @ZM03166 35700000
         B     B200                     GO READ LOG            @Z40MB01 35750000
*                                                                       35800000
*  SET UP READ LOG COMMAND FOR DIRECT ACCESS DEVICES                    35850000
*                                                                       35900000
B150     EQU   *                                                        35950000
         LA    LOGREG,C72(CORE)        POSITION RECORD IN MAIN          36000000
         LA    WORK,LOG                GET ADDR OF READ-IN AREA         36050000
         ST    WORK,CCW                BUILD READ LOG CCW               36100000
         MVI   CCWLNG,C24              24-BYTE LOG                      36150000
         MVI   CCW,RDLOG3X             USE 3330/X READ LOG CMD   S99204 36200000
         CLI   UCBTBYT4,D3330          IS THIS A 3330?                  36250000
         BE    B200                    YES - GO EXCP                    36300000
         CLI   UCBTBYT4,D33301         IS IT 3330-1?            XL03145 36350000
         BE    B200                    YES - GO EXCP            XL03145 36400000
         CLI   UCBTBYT4,D3340          IS IT A 3340?            XL03145 36450000
         BE    B200                    YES - GO EXCP            XL03145 36500000
         CLI   UCBTBYT4,D3350          IS IT A 3350?           @Z20AB05 36550000
         BE    B200                    YES - GO EXCP           @Z20AB05 36600000
*                                                                       36650000
         LA    WORK,VOLID              2305 LOG AREA STARTS AT VOLID    36700000
         ST    WORK,CCW                READ DATA INTO 2305 BUFFER       36750000
         MVI   CCW,RDLOG               READ LOG COMMAND                 36800000
         MVI   CCWLNG,C128             SET LENGTH OF 128                36850000
         B     B200                    BRANCH TO ISSUE EXCP    @Y30LB11 36900000
*                                                                       36950000
*  SET UP PREPARE BUFFERED LOG AND READ AND RESET BUFFERED LOG COMMANDS 37000000
*                                                                       37050000
B160     EQU   *                                                        37100000
         L     WORK,CVTEXT2             GET ADR OF CVT EXT     @Y30LB11 37150000
         USING CVTXTNT2,WORK                                   @Y30LB11 37200000
         L     WORK,CVTICB              GET ADR OF SSC CTL BLK @Y30LB11 37250000
         DROP WORK                                             @Y30LB11 37300000
         USING ICB2SSCB,WORK                                   @Y30LB11 37350000
         LR    R4,UCBREG               GET UCB ADR IN WORK REG @Y30LB10 37400000
         AH    R4,H512                 CORRECT UCB ADDR        @Y30LB10 37450000
         CLM   R4,C3,ICBPUCB+2         IS IT THE PRIMARY UCB   @ZA05146 37500000
         DROP WORK                                             @Y30LB11 37550000
         BNE   B348                     BRANCH IF NO           @Y30LB11 37600000
         MVI   ATTRIB,A80               INIT 3851 ATTRIB BYTE  @ZM02158 37650000
         CLC   SSIDXX,ZEOD              IS CALL FOR 3851 ZEOD  @Y30LB11 37700000
         BNE   DSMCCW                   BRANCH IF NO           @Y30LB11 37750000
         MVI   ATTRIB,A0                RESPECIFY 3851 ATTRIB  @ZM02158 37800000
DSMCCW   EQU   *                                               @Y30LB11 37850000
         LA    WORK,PLBOP               GET PTR TO SSID & ATTR @Y30LB11 37900000
         ST    WORK,CCW1                LOAD ADDR IN CCW       @Y30LB11 37950000
         MVI   PLBOP,PLBORD            SET IN PBL ORDER        @Y30LB10 38000000
         MVI   CCW1,PBLCMD              INSERT PBL COMMAND     @Y30LB11 38050000
         MVI   CCWFLG1,CHAINFLG         INSERT CHAINED CCW FLAG@Y30LB11 38100000
         MVI   CCWLNG1,C8               INSERT SSID DATA COUNT @Y30LB11 38150000
         XC    CCW2(C8),CCW2           ZERO CCW 2              @Y30LB10 38200000
         LA    WORK,C128(CORE)          LOAD BUF LOG ADDR      @Y30LB11 38250000
         ST    WORK,CCW2                PUT PTR INTO CCW2      @Y30LB11 38300000
         MVI   CCW2,RRBLCMD             ENTER RRBL COMMAND     @Y30LB11 38350000
         MVI   CCWFLG2,SLI              SUPPRESS LENGTH FLAG   @Y30LB11 38400000
         MVI   CCWLNG2,C32              BUFFERED LOG LENGTH    @Y30LB11 38450000
         LA    WORK,CCW1               GET ADDR OF CCW LIST    @Y30LB11 38500000
         ST    WORK,IOBSTART           PUT ADDR IN IOB         @Y30LB11 38550000
         LA    LOGREG,C96(CORE)         INITIALIZE LOGREG ADDR @Y30LB11 38600000
         EJECT                                                          38650000
*********************************************************************** 38700000
*                      E  X  C  P                                     * 38750000
*********************************************************************** 38800000
*                                                                       38850000
B200     EQU   *                                                        38900000
         EXCP  IOB                     READ LOG INTO GETMAIN AREA       38950000
         WAIT  ECB=ECB                                                  39000000
*                                                                       39050000
         CLI   ECB,CODE7F              WAS I/O OK              @ZA11019 39100000
         BE    B210                    BR YES TO CONTINUE      @G30HB19 39150037
         CLI   UCBTBYT4,D3895           IS IT A 3895?          @G30HB19 39157037
         BNE   B348                     NO,BR TO 3800 RECORD   @G30HB19 39164037
         XC    LOGRECD(C28),LOGRECD     CLEAR 28 BYTE HDR      @G30HB19 39169037
         MVI   FLG3895,AN80            3895 TYPE ERROR RCD     @G30HB19 39174037
         B     B205                    GO COMPLETE RECORD      @G30HB19 39179037
*                                                                       39184037
B210     EQU   *                                                        39189037
         CLI   UCBTBYT4,D3895           IS IT A 3895?          @G30HB19 39206037
         BNE   D3800REC                 NO,BR TO 3800 RECORD   @G30HB19 39213037
         XC    LOGRECD(C28),LOGRECD     CLEAR 28 BYTE HDR      @G30HB19 39220037
         MVI   FLG3895,CMNFLAG         3895 TYPE ERROR RCD     @G30HB19 39227037
B205     EQU   *                                                        39234037
         MVI   RECID,ID3895            INDICATE 3895 DEVICE    @G30HB19 39242037
         B     B320                    GO COMPLETE RECORD      @G30HB19 39244037
D3800REC EQU   *                                                        39250000
         CLI   UCBTBYT4,D3800           IS IT A 3800?          @Z40MB01 39300000
         BNE   B300                     NO,BR TO DASD RECORD   @Z40MB01 39350000
         XC    LOGRECD(C28),LOGRECD     CLEAR 28 BYTE HDR      @Z40MB01 39400000
         LA    WORKREG3,ERRREC          GET ADDR OF LOG REC.   @Z40MB01 39450000
         XR    WORK,WORK                CLEAR REG FOR COUNTER  @Z40MB01 39500000
         LA    WORKREG2,C16             PUT MAX REC CNT IN REG @Z40MB01 39550000
B250     EQU   *                                                        39600000
         NC    C0(C8,WORKREG3),C0(WORKREG3) IS RECORD ZERO?    @Z40MB01 39650000
         LA    WORKREG3,C8(WORKREG3)    INDEX TO NEXT RECORD   @Z40MB01 39700000
         BZ    B260                     DON'T COUNT 0 RECORD   @Z40MB01 39750000
         LA    WORK,C1(WORK)            ADD 1 TO RECORD COUNT  @Z40MB01 39800000
B260     EQU   *                                                        39850000
         BCT   WORKREG2,B250            NOT LAST REC, GEN NEXT @Z40MB01 39900000
         STC   WORK,COUNT               PUT REC CNT IN RECORD  @Z40MB01 39950000
         MVI   RECID,ID3800             3800 ID IN RECORD      @Z40MB01 40000000
         B     B320                     GO COMPLETE RECORD     @Z40MB01 40050000
B300     EQU   *                                                        40100000
         XC    LOGRECD(C26),LOGRECD    CLEAR START OF RECORD     A48492 40150000
         MVI   TPERID,TPR              T TYPE RECORD                    40200000
         MVI   RECID,ID2305            INDICATE 2305 DEVICE      A43332 40250000
         CLI   UCBTBYT4,D2305A         IS THIS A 2305A?                 40300000
         BE    B320                    YES - GO GET TIME                40350000
         MVI   RECID,ID2305A           INDICATE 2305 RECORD             40400000
         CLI   UCBTBYT4,D2305B         IS THIS A 2305B?                 40450000
         BE    B320                    YES - GO GET TIME                40500000
         MVI   RECID,ID33301           INDICATE 3330-1 RECORD   XL03145 40550000
         CLI   UCBTBYT4,D33301         IS IT A 3330-1?          XL03145 40600000
         BE    B320                    YES - GET VOLID         @YA00081 40650000
         MVI   RECID,ID3340            INDICATE 3340 RECORD     XL03130 40700000
         CLI   UCBTBYT4,D3340          IS IT A 3340?            XL03130 40750000
         BE    B320                    YES - GET VOLID          XL03130 40800000
         MVI   RECID,ID3350            INDICATE 3350 RECORD    @Z20AB05 40850000
         CLI   UCBTBYT4,D3350          IS IT A 3350?           @Z20AB05 40900000
         BE    B320                    YES - GET VOLID         @Z20AB05 40950000
         MVI   RECID,ID3330            INDICATE 3330 TYPE REC    S99204 41000000
         CLI   UCBTBYT4,D3330          IS IT A 3330?           @Y30LB11 41050000
         BE    B320                    BRANCH IF YES           @Y30LB11 41100000
         MVI   RECID,IDDSM             INDICATE 3851 REC TYPE  @Y30LB11 41150000
         XC    TPERID,TPERID           BLANK 3851 RECRD PORTION@Y30LB11 41200000
*                                                                       41250000
B320     EQU   *                                                        41300000
*                                                                       41350000
         TIME  DEC                                                      41400000
         ST    R0,RTIME                PUT TIME IN RECORD               41450000
         ST    R1,RDATE                PUT DATE IN RECORD               41500000
         STIDP DOUBLE                  STORE CPU ID            @ZA27554 41550037
         MVC   RECSER(C8),DOUBLE       MOVE SER TO RECORD      @ZA27554 41590037
         MVC   WORKB,CVTRELNO          GET RELEASE NUMBER               41750037
         PACK  DOUBLE,WORKB            GET RELEASE NUMBER               41900000
         CVB   WORK,DOUBLE             CONVERT TO BINARY                41950000
         STC   WORK,RELNO              PUT RELEASE NUMBER IN RECORD     42000000
         OI    RELNO,VS2MASK           VS2 SYS IN MDR REC      @ZUP1066 42050000
         XC    WORKB(C2),WORKB         ZERO WORKB              @Y30LB10 42100000
         OI    SWITCH1,SWCHMASK        INDICATE TIME MACRO USED  S99204 42150000
         MVI   LOGKEY,KEY              INDICATE TYPE OF RECORD          42200000
         MVC   UNITID,UCBCHA           RECORD CHANNEL AND UNIT          42250000
         MVN   UNITID(C1),UCBNAME      GET CHANNEL ADDR          A43332 42300000
         CLI   UCBNAME,X'F0'           CHAN ADDR 0-9 OR A-F?     A43332 42350000
         BNL   B376                    CHAN ADDR 0,1,2,...,9     A43332 42400000
         LH    WORK,UNITID             CHAN ADDR A,B,C,...,F     A43332 42450000
         LA    WORK,C2304(WORK)        GET EQUIVALENT A-F VALUE  A43332 42500000
         STH   WORK,UNITID             STORE CHAN ADDR IN LOG    A43332 42550000
         EJECT                                                          42600000
*********************************************************************** 42650000
*                       S V C   7 6                                   * 42700000
*********************************************************************** 42750000
B376     EQU   *                                                        42800000
         CLI   UCBTBYT4,DDSM           IS IT THE 3851          @Y30LB11 42850000
         BE    B345                    BRANCH TO ATTRIB TEST   @Y30LB11 42900000
         LA    R1,LOGRECD              GET RECORD                       42950000
         LA    R0,L164                  SET UP FOR 3800        @Z40MB01 43000000
         CLI   UCBTBYT4,D3800           IS THIS A 3800         @Z40MB01 43050000
         BE    B340                    YES GOT NEGATIVE ADDR   @Z40MB01 43100000
         LA    R0,L3895                 SET UP FOR 3895        @G30HB19 43110037
         CLI   UCBTBYT4,D3895           IS THIS A 3895         @G30HB19 43120037
         BE    B340                    YES GOT NEGATIVE ADDR   @G30HB19 43130037
         LA    R0,L56                  SET UP FOR 3330 - 56-BYTE RCD    43150000
         CLI   UCBTBYT4,D3330          IS THIS A 3330?                  43200000
         BE    B331                    YES-TEST FOR EMULATION  @Z20AB05 43250000
         CLI   UCBTBYT4,D3350          IS THIS A 3350?         @Z20AB05 43300000
         BE    B335                    YES-VOLID               @Z20AB05 43350000
         CLI   UCBTBYT4,D33301         IS IT A 3330-1?          XL03145 43400000
         BE    B331A                   YES-TEST FOR EMULATION  @ZA09525 43450000
         CLI   UCBTBYT4,D3340          IS IT A 3340?            XL03130 43500000
         BE    B330A                   YES-CNVT PHYSICAL ADDR  @ZA09525 43550000
         LA    R0,L154                 GET 2305 RECORD LENGTH - 154     43600000
         B     B340                    GO ISSUE SVC76                   43650000
B331A    EQU   *                                               @ZA09525 43700000
         TM    LOG+C2,EMULFLG          IS DEVICE EMULATED      @Z20AB05 43750000
         BNO   B333                    IF NOT, BRANCH          @Z20AB05 43800000
         B     B335                    ADDR OK                 @ZA09525 43850000
*        FOR 3340 EMULATED                                              43900000
B330A    EQU   *                                                        43950000
         TM    LOG+C2,EMULFLG          IS DEVICE EMULATED?     @ZA09525 44000000
         BNO   B335                    IF NOT ADDR OK          @ZA09525 44050000
         SR    WORK,WORK               ZERO IT                 @ZA09525 44100000
         IC    WORK,LOG+C4             GET ADDR                @ZA09525 44150000
         SLL   CVTREG,C3               SECURE CVT PTR          @ZA09525 44200037
         SRDL  WORK,C3                                         @ZA09525 44240037
         SRL   WORK,C3                                         @ZA09525 44280037
         SLDL  WORK,C3                                         @ZA09525 44320037
         SRL   CVTREG,C3               RESTORE CVT PTR         @ZA09525 44360037
         NI    UNITID+C1,HEXC0                                 @ZA09525 44450000
         LH    R1,UNITID                                       @ZA09525 44500000
         OR    WORK,R1                                         @ZA09525 44550000
         STH   WORK,UNITID                                     @ZA09525 44600000
         LA    R1,LOGRECD                                      @ZA09525 44650000
         B     B335                                            @ZA09525 44700000
*        3330 EMULATED TEST                                             44750000
B331     EQU   *                                               @ZA09525 44800000
         TM    LOG+C2,EMULFLG                                  @ZA09525 44850000
         BNO   B333                                            @ZA09525 44900000
         NI    UNITID+C1,HEXDF                                 @ZA09525 44950000
         B     B335                                            @ZA09525 45000000
B333     EQU   *                                               @YA00081 45050000
         MVC   LOG+C30(C1),LOG+C4      PHYS ADDR FROM SENSE    @YA00081 45100000
B334     EQU   *                       EMULATION ENTRY                  45150000
         NI    LOG+C30,HEX07           CLEAR HIGH ORDER BITS   @YA00081 45200000
         NI    UNITID+C1,HEXF8         CLEAR LOW ORDER BITS    @YA00081 45250000
         OC    UNITID+C1(C1),LOG+C30   MOVE IN PHYS ADDRESS    @YA00081 45300000
*                                                                       45350000
B335     EQU   *                                                        45400000
         MVC   VOLID,UCBVOLI           MOVE VOLID INTO LOG              45450000
B340     EQU   *                                                        45500000
         LNR   R0,R0                                                    45550000
*                                                                       45600000
*                                                                       45650000
         SVC   C76                                                      45700000
*                                                                       45750000
         CLI   UCBTBYT4,DDSM            IS IT THE 3851         @Y30LB11 45800000
         BNE   B348                     BRANCH IF NO           @Y30LB11 45850000
*                                                                       45900000
         TM    ATTRIB,A80               TEST THE ATTRIB FLAG   @Y30LB11 45950000
         BO    B348                     BRANCH IF ON           @ZM02158 46000000
*                                                                       46050000
         EXCP  IOB                      PERFORM I/O            @Y30LB11 46100000
         WAIT  ECB=ECB                  WAIT UNTIL ECB POSTED  @Y30LB11 46150000
         CLI   ECB,CODE7F              WAS SIO OK              @Y30LB10 46200000
         BNE   B348                    BR NO TO EXIT           @Y30LB10 46250000
*                                                                       46300000
B345     EQU   *                                                        46350000
         MVC   SSIDXX,SSID              MOVE IN SSID           @Y30LB11 46400000
         NI    SSIDXX,X0F              MASK OUT HI ORDER       @Y30LB10 46450000
         LA    R1,LOGRECD               GET ADDRESS            @Y30LB11 46500000
         LA    R0,LDSM                  GET RECORD LENGTH      @Y30LB11 46550000
         CLC   SSIDXX,LOOPEND           ARE WE FINISHED        @Y30LB11 46600000
         BNE   B340                     LOOP IF NOT ZERO       @Y30LB11 46650000
*                                                                       46700000
B348     EQU   *                                                        46750000
*********************************************************************** 46800000
*                 F R E E M A I N                                     * 46850000
*********************************************************************** 46900000
         LR    R1,CORE                 ADDR OF MAIN TO BE FREED         46950000
         FREEMAIN  R,LV=344,A=(1),SP=255                      @ZA27122  47000037
*                                                                       47050000
RETURN   EQU   *                                                        47100000
         BR    RETREG                  RETURN TO CALLER                 47150000
         EJECT                                                          47200000
*********************************************************************** 47250000
*                          G E T M A I N                              * 47300000
*********************************************************************** 47350000
GETMAIN  EQU   *                                                        47400000
         MVC   LISTB(C10),LIST         MOVE GETMAIN LIST TO SVRB        47450000
         XC    RECTOT(C4),RECTOT       ZERO ADDR OF GOTTEN CORE         47500000
         LA    R1,RECTOT               ADDRESS OF GOTTEN CORE           47550000
         ST    R1,LISTC                STORE IN LIST                    47600000
         LA    R1,LISTB                ADDRESS OF GETMAIN LIST          47650000
         GETMAIN  EC,MF=(E,(1))        GET MAIN FOR 344 BYTES           47700037
         L     CORE,RECTOT             SAVE ADDRESS OF GOTTEN CORE      47750000
         BR    LNKREG                  RETURN                           47800000
*                                                                       47850000
         EJECT                                                          47900000
*********************************************************************** 48200000
*                      C O N S T A N T S                              * 48250000
*********************************************************************** 48300000
         DS    0F                                                       48350000
ABEND1   DC    X'0000015B'             ABEND COMPLETION CODE  @ZA32130  48370037
CLEAR    DC    X'0000FFFF'             CLEAR LEFT HALF WORD CONSTANT    48400000
BLANKS   DC    CL12'            '      BLANKS                           48450000
H512     DC    H'512'                  HALFWORD OF 512                  48500000
LIST     GETMAIN  EC,LV=344,A=CLEAR,SP=255,MF=L  GET MAIN LIST  M2135   48550037
CON175   DC    X'0175'                 MODEL 175 CONSTANT               48600000
BACK8    DC    H'8'                    COUNT OF 8 FOR CVT PRE @YA11111  48650037
X10      DC    H'10'                   COUNT OF 10                      48700000
DEC57    DC    H'57'                   A-F ADDING VARIABLE     @ZA09512 48750000
LENTAP   DC    X'0030'                 TOTAL LENGTH OF SMF RECORD       48800000
ZEROES   DC    X'000000'               ZEROS                            48850000
         DC    X'15'                   TAPE RECORD INDICATOR            48900000
ZEOD     DC    X'FFFF'                  3851 EOD CONDITION     @Y30LB11 48950000
LOOPEND  DC    X'0FFF'                  3851 LOOP END CONDITION@Y30LB11 49000000
         ORG   IGC0009A+2007                                            49050000
         DC    C'<<   E N D   O F   I G C 0 0 0 9 A   >>'   **          49100000
*                                                                       49150000
*  END OF CONSTANTS                                                     49200000
*                                                                       49250000
         EJECT                                                          49300000
         IEFUCBOB  LIST=YES,PREFIX=YES                                  49350037
         EJECT                                                          49400000
         DCBD      DSORG=PS                                             49450000
         EJECT                                                          49500000
CVT      DSECT                                                          49550000
         CVT       PREFIX=YES                                           49600037
         EJECT                                                          49650037
         IEZSSC                                                         49700037
         END                                                            49750037
./  ADD  SSI=41440298,NAME=IGE0000H
         TITLE 'HOST ERP LOAD 1 (IGE0000H) VS2'                         00100000
IGE0000H START X'00'                                                    00150000
*                                                                       00200000
*********************************************************************   00250000
*                                                                       00300000
*01 MODULE-NAME = IGE0000H                                              00350000
*                                                                       00400000
*01 DESCRIPTIVE NAME = HOST 3851 ERROR RECOVERY PROCEDURES              00450000
*                                                                       00500000
*01 COPYRIGHT = NONE                                                    00550000
*                                                                       00600000
*01 STATUS = VS2 REL 3.0 VERSION 1.                                     00650000
*                                                                       00700000
*01 FUNCTION = ?????????????????                                        00750000
*                                                                       00800000
*01 NOTES                                                               00850000
*                                                                       00900000
*02    DEPENDENCIES = NONE                                              00950000
*                                                                       01000000
*02    RESTRICTIONS = IF A COMND IS INADVERTENTLY ISSUED TO THE DEVICE  01050000
*      WITH A OP CODE OF X'FF', THE SWAP FUNCTION WILL BE ATTEMPTED.    01100000
*                                                                       01150000
*02    REGISTER CONVENTIONS =                                           01200000
*      REG0      0    WORK REG                                          01250000
*      IOSBPTR   1    IOSB POINTER                                      01300000
*      REG2      2    WORK REG                                          01350000
*      REG3      3    WORK REG                                          01400000
*      CVTXTN    4    CVT EXTENTION POINTER                             01450000
*      CVTREG    5    CVT POINTER                                       01500000
*      EWAPTR    6    EWA POINTER                                       01550000
*      PRIUCB    7    ADDRESS OF PRIMARY UCB                            01600000
*      ALTUCB    8    ADDRESS OF ALTERNATE UCB                          01650000
*      CCWPTR    9    ADDRESS OF CCW IN ERROR                           01700000
*      CTLPTR    10   SSC CONTROL BLOCK POINTER                         01750000
*      BASEREG   11   BASE REG                                          01800000
*      REGC      12   WORK REG                                          01850000
*      REGD      13   WORK REG                                          01900000
*      BALRREG   14   BRANCH REG                                        01950000
*      REGF      15   WORK REG                                          01960000
*                                                                       02050000
*02    PATCH LABEL = ERPMAINT                                           02100000
*                                                                       02150000
*01 MODULE TYPE = LOAD MODULE                                           02200000
*                                                                       02250000
*02    PROCESSER = ASSEMBLER XF                                         02300000
*                                                                       02350000
*02    MODULE SIZE = 4096 BYTES                                         02400000
*                                                                       02450000
*02    ATTRIBUTES = RE-ENTRANT, DISABLED, PRIVILEGED                    02500000
*                                                                       02550000
*01 ENTRY POINT = IGE0000H                                              02600000
*                                                                       02650000
*02    PURPOSE =                                                        02700000
*      1. INITIAL CALL OF THE ERP FOR A ERROR CONDITION.                02750000
*      2. RETURN FROM A ERP RETRY SIO.                                  02800000
*                                                                       02850000
*02    LINKAGE = IOS WILL CALL THE ERP WITH REG 1 = POINTER TO IOSB AND 02900000
*      REG 15 = BASE ADDRESS OF THE MODULE.                             02950000
*                                                                       03000000
*01 INPUT = CONTROL BLOCKS 'IOSB', 'EWA' AND THE 'UCB' WILL BE          03050000
*   INITIALIZED BY IOS PRIOR TO ENTRY.                                  03100000
*                                                                       03150000
*01 OUTPUT = NONE                                                       03200000
*                                                                       03250000
*01 EXIT NORMAL = IOSB FLAGS 'ERR' AND 'EX' WILL BE SET TO;             03300000
*   1. 'ERR' = 1, 'EX' = 1 TO DO A ERP RETRY SIO.                       03350000
*   2. 'ERR' = 0, 'EX' = 1 TO EXIT PERMANENT ERROR.                     03400000
*   3. 'ERR' = 0, 'EX' = 0 TO EXIT RECOVERED ERROR.                     03450000
*                                                                       03500000
*01 EXIT ERROR = NONE                                                   03550000
*                                                                       03600000
*01 EXTERNAL REFERENCES =                                               03650000
*                                                                       03700000
*02    ROUTINES = SVC 35 (WRITE TO OPERATOR SVC), IGE0025C (SYSTEM WTO  03750000
*   ROUTINE) AND IGE0025F (OBR ROUTINE).                                03800000
*                                                                       03850000
*02    DATA AREAS = NONE                                                03900000
*                                                                       03950000
*02    CONTROL BLOCKS = CVT, UCB, IOSB, EWA AND IEZSSC.                 04000000
*                                                                       04050000
*01 TABLES = NONE                                                       04100000
*                                                                       04150000
*01 MACROS = WTO AND TIME.                                              04200000
*                                                                       04250000
*01 CHANGE ACTIVITY = ???????????                                       04300000
*                                                                       04350000
*********************************************************************   04400000
         EJECT                                                          04450000
*                                                                       04460000
*              GENERAL REGISTER EQUATES                                 04470000
*                                                                       04480000
REG0     EQU   0                                                        04500000
IOSBPTR  EQU   1                                                        04550000
REG2     EQU   2                                                        04600000
REG3     EQU   3                                                        04650000
CVTXTN   EQU   4                                                        04700000
CVTREG   EQU   5                                                        04750000
EWAPTR   EQU   6                                                        04800000
PRIUCB   EQU   7                                                        04850000
ALTUCB   EQU   8                                                        04900000
CCWPTR   EQU   9                                                        04950000
CTLPTR   EQU   10                                                       05000000
BASEREG  EQU   11                                                       05050000
REGC     EQU   12                                                       05100000
REGD     EQU   13                                                       05150000
BALRREG  EQU   14                                                       05200000
REGF     EQU   15                      WORK REG                         05210000
*                                                                       05260000
         EJECT                                                          05262000
*        IOSB FLAG C BIT MEANINGS                                       05272000
FLCLOOP  EQU   X'10'                                                    05282000
*        EWA   EWAFLAG3 3851 FLAG BIT MEANINGS                          05312000
EWA3SAVE EQU   X'80'                                                    05400000
EWA3SWAP EQU   X'40'                                                    05450000
EWA3OPER EQU   X'20'                                                    05500000
EWA3SUS  EQU   X'08'                                                    05600000
EWA3CCH  EQU   X'04'                                                    05650000
*                                                                       05700000
*        ALTERNATE UCB OFFSETS                                          05702000
ALTSTAT  EQU   3                                                        05710000
ALTFLA   EQU   6                                                        05720000
ALTCHAN  EQU   4                                                        05730000
ALTNAME  EQU   13                                                       05740000
*                                                                       05742000
*        GENERAL PROGRAM EQUATES                                        05744000
C0       EQU   0                                                        05750000
C1       EQU   1                                                        05800000
C2       EQU   2                                                        05850000
C3       EQU   3                                                        05900000
C4       EQU   4                                                        05950000
C7       EQU   7                                                        06000000
C8       EQU   8                                                        06050000
C10      EQU   10                      COUNT OF 10                      06060000
C16      EQU   16                                                       06100000
C24      EQU   24                      COUNT OF 24                      06150000
C32      EQU   32                                                       06200000
C33      EQU   33                                                       06210000
C37      EQU   37                                                       06250000
C43      EQU   43                                                       06260000
C47      EQU   47                                                       06270000
CCC      EQU   X'04'                   CHANNEL CONTROL CHK              06280000
CDC      EQU   X'08'                   CHANNEL DATA CHK                 06290000
CHN      EQU   X'01'                   CHAINING CHECK                   06290400
CMDCHN   EQU   X'40'                   COMMAND CHAIN FLAG               06292000
COD41    EQU   X'41'                   COMPLETION CODE 41               06294000
CUBZY    EQU   X'50'                   STS MOD AND BUSY BITS            06296000
EOT      EQU   X'FF'                   END OF TABLE INDICATOR           06296400
EXEC     EQU   X'87'                   EXECUTE COMND OP CODE            06296800
FIFTEEN  EQU   15                      SVC 15 CODE                      06297200
FIVE     EQU   X'05'                   COUNT OF 5                       06298000
ICC      EQU   X'02'                   INTERFACE CONTROL CHK            06298400
ILI      EQU   X'40'                   INCORRECT LENGTH                 06298800
INTCOD44 EQU   X'44'                   INTERCEPT CODE 44                06299200
INTCOD7E EQU   X'7E'                   INTERCEPT CODE 7E                06299600
LOC10    EQU   16                      ADDR OF CVT                      06300000
NOP      EQU   X'03'                   NOP OP CODE                      06310000
OBRRTN   EQU   256                     OBR RTN CALL CODE                06320000
OF       EQU   X'0F'                   MASK OF  ZERO-FOX                06350000
OPERSWAP EQU   X'FF'                   OP CODE OF X'FF'                 06352000
PGM      EQU   X'20'                   PROGRAM CHK                      06360000
PROT     EQU   X'10'                   PROTECTION CHK                   06370000
SNSOP    EQU   X'04'                   OP CODE FOR SENSE                06372000
SUSPEND  EQU   X'06'                   DEV END + UNIT CHK               06380000
THREE    EQU   3                       SVC 3 CODE                       06380400
TIC      EQU   X'08'                   OP CODE OF TIC COMND             06382000
UNCK     EQU   X'02'                   UNIT CHK                         06390000
WTORTN   EQU   253                     WTO RTN CALL CODE                06392000
ZERO     EQU   X'00'                                                    06400000
*                                                                       07300000
         EJECT                                                          07350000
         USING IOSB,IOSBPTR                                             07400000
         USING EWA,EWAPTR                                               07450000
         USING UCB,PRIUCB                                               07500000
         USING CVTMAP,CVTREG                                            07550000
         USING CVTXTNT2,CVTXTN                                          07600000
         USING ICB2SSCB,CTLPTR                                          07650000
         USING *,BASEREG                                                07700000
*******************                                                     07750000
*        SET UP REGS FOR BASE AND CONTROL BLOCK POINTERS.               07800000
*        GET CCW IN ERROR ADDRESS.                                      07850000
*******************                                                     07900000
ERR000   EQU   *                                                        07950000
         LR    BASEREG,REGF            GET BASE REG                     07960000
         B     ERR001                                                   08050000
         DC    C'IGE0000H 05/22/4'                                      08100000
ERR001   EQU   *                                                        08150000
         L     PRIUCB,IOSUCB           GET UCB ADDR                     08200000
         SH    PRIUCB,H512             POINT TO PREFIX                  08250000
         L     EWAPTR,IOSERP           GET EWA ADDR                     08300000
         L     CCWPTR,IOSCC            GET ERROR CCW ADDR               08350000
         LA    CCWPTR,C0(CCWPTR)       ZERO HI ORDER BYTE               08400000
         SH    CCWPTR,H8               POINT TO ERROR CCW               08450000
         L     CVTREG,LOC10            GET ADR OF CVT                   08500000
         L     CVTXTN,CVTEXT2          GET ADDR OF CVT EXT              08550000
         L     CTLPTR,CVTICB           GET ADDR OF SSC CTL BLOCK        08600000
         L     ALTUCB,ICBAUCB          GET ADDR OF ALT UCB              08810000
         EJECT                                                          09100000
*******************                                                     09150000
*        INSURE THAT MSG AND LOG ARE ZEROED                             09200000
*******************                                                     09250000
         NI    IOSFLB,X'FF'-IOSMSG-IOSLOG  ZERO LOG AND MSG             09300000
         OI    IOSFLA,IOSEX            SET EXCEPTION FLAG ON            09302000
         SPACE 1                                                        09310000
*******************                                                     09350000
*        IS THIS THE FIRST ENTRY TO THE ERP                             09400000
*        IF YES CLEAR ALL ERP FLAGS EXCEPT LOOP. RESET THE ERROR        09450000
*        COUNTERS AND SET THE ERP IN CONTROL.                           09500000
*******************                                                     09550000
         TM    IOSFLA,IOSERR           1ST ENTRY TO ERP                 09600000
         BO    ERR020                  BR NO                            09650000
*********                                                               09700000
         MVI   EWAFLG3,ZERO           CLR ALL                           09750000
         MVI   EWACNTR2,ZERO           CLR ERR CNTR                     09800000
         OI    IOSFLA,IOSERR+IOSEX     SET ERP IN CONTROL               09850000
         SPACE 1                                                        09860000
*******************                                                     09900000
*        IS UNIT CHECK ON. IF YES, WE HAVE SENSE AND A ERROR CONDITION. 09950000
*******************                                                     10000000
ERR020   EQU   *                                                        10050000
         TM    IOSTSA,UNCK             IS UNIT CHK ON                   10100000
         BO    ERR060                  BR YES                           10150000
         SPACE 1                                                        10160000
*******************                                                     10200000
*        IF UNIT CHECK IS NOT ON, DO WE HAVE A CONTROL UNIT BUSY COND.  10250000
*        IF YES GO TO REISSUE THE OPERATION.                            10300000
*******************                                                     10350000
         TM    IOSTSA,CUBZY            IS IT CU BUSY                    10400000
         BO    ERR2000                 BR YES TO EXIT                   10450000
         SPACE 1                                                        10460000
*******************                                                     10500000
*        WE DONT HAVE UNIT CHECK OR A CU BUSY SO ZERO THE SENSE AREA.   10550000
*******************                                                     10600000
ERR040   EQU   *                                                        10650000
         XC    EWASNS(C32),EWASNS      ZERO SENSE AREA                  10700000
         SPACE 1                                                        10710000
*******************                                                     10750000
*        DID WE SAVE THE USER CCW ADDRESS. IF YES, RESTORE THE IOSB     10800000
*        WITH THAT ADDRESS.                                             10850000
*******************                                                     10950000
ERR060   EQU   *                                                        11000000
         TM    EWAFLG3,EWA3SAVE        DID WE SAVE THE USER CCW         11050000
         BZ    ERR070                  BR NO                            11100000
         L     REG2,UCBDEV+C4          GET SAVED CCW ADDR               11150000
         ST    REG2,IOSVST             STORE VIRT ADDR                  11200000
         LRA   REG2,C0(REG2)           CONVERT TO REAL                  11250000
         ST    REG2,IOSRST             STORE REAL ADDR                  11300000
         SPACE 1                                                        11302000
*******************                                                     11310000
*        IS SWAP LOOP ON. IF YES WE ARE RE-ENTERING THE ERP AFTER       11320000
*        PRINTING A MSG AND RECORDING ON LOGREC FOR A SWAP .            11330000
*        WE WILL GO TO HANDLE THE SWAP FUNCTION.                        11340000
*******************                                                     11342000
ERR070   EQU   *                                                        11350000
         TM    EWAFLG3,EWA3SWAP        IS SWAP  ON                      11360000
         BO    ERR497                  BR IF ON                         11370000
         TM    IOSFLC,FLCLOOP          IS LOOP ON                       11420000
         BO    ERR496                  BR YES                           11470000
         EJECT                                                          11480000
*******************                                                     11500000
*        IS IT COND CODE 3. IF YES, GO TO HANDLE THE SWAP.              11550000
*******************                                                     11600000
         TM    IOSCC,IOSCC3            IS IT COND CODE 3                11650000
         BO    ERR440                  BR YES                           11700000
         SPACE 1                                                        11710000
********************                                                    11720000
*        IS IT A INTERCEPT CONDITION. IF YES GO TO PERM ERR             11722000
********************                                                    11730000
         CLI   IOSCOD,INTCOD7E         IS IT A INTERCEPT                11740000
         BNE   ERR072                  BR NO                            11742000
         MVI   IOSCOD,INTCOD44         SET COMP CODE TO X'44'           11744000
         B     ERR412                  GO TO OBR -PERM ERR EXIT         11746000
         SPACE 1                                                        11748000
*******************                                                     11750000
*        WAS THE CSW ADDRESS ZERO. IF YES, GO TO PERMANENT ERROR.       11800000
*******************                                                     11850000
ERR072   EQU   *                                                        11860000
         LTR   CCWPTR,CCWPTR           IS CCW ADDR ZERO                 11900000
         BM    ERR460                  BR YES                           11950000
         SPACE 1                                                        11952000
*******************                                                     11960000
*        IF COMMAND CHAINING, DID THE CCW STRING BREAK IN A             11970000
*        DIFFERENT SPOT. IF YES, RESET THE ERROR COUNTERS AND SAVE      11980000
*        THE NEW CCW IN ERROR ADDRESS.                                  11990000
*******************                                                     11992000
         C     CCWPTR,IOSVST           DID CMD CHAIN BREAK IN NEW SPOT  11994000
         BE    ERR075                  BR NO                            11996000
         NI    EWAFLG3,X'FF'-EWA3CCH  CLR CCH CNTR                      11998000
         MVI   EWACNTR2,ZERO           CLR ERR CNTR                     11998400
         ST    CCWPTR,IOSVST           STORE NEW ADDR IN VIRT           11998800
         LRA   REG2,C0(CCWPTR)         GET REAL ADDR                    11999200
         ST    REG2,IOSRST             STORE IN REAL                    11999600
         SPACE 1                                                        11999700
*******************                                                     12000000
*        IS IT A COMMAND REJECT. IF YES, IS THE CCW OP CODE A X'FF'     12050000
*        FOR A OPERATOR SWAP. IF ITS A OPERATOR SWAP GO TO LOAD 7.      12100000
*        IF NOT, GO TO PERMANENT ERROR.                                 12150000
*******************                                                     12200000
ERR075   EQU   *                                                        12210000
         TM    EWOSNS0,EWOCREJ         IS IT COMND REJ                  12250000
         BZ    ERR080                  BR NO                            12300000
         CLI   C0(CCWPTR),OPERSWAP     IS OP CODE X'FF' OPER SWAP       12350000
         BE    ERR494                  BR YES                           12400000
         B     ERR460                  BR NO                            12450000
         SPACE 1                                                        12460000
*******************                                                     12500000
*        IS IT INTERVENTION REQUIRED AND FORMAT 1. IF YES, GO TO        12550000
*        PERMANENT ERROR.                                               12600000
*******************                                                     12650000
ERR080   EQU   *                                                        12700000
         TM    EWOSNS0,EWOINT          IS IT INT REQ                    12750000
         BZ    ERR090                  BR NO                            12800000
         TM    EWOSNS3,EWOFOR1         IS IT FORMAT 1                   12850000
         BO    ERR470                  BR YES                           12900000
         SPACE 1                                                        12910000
*******************                                                     12920000
*        IS IT A SENSE FAILURE. IF YES CALL THE EQ CHK A PERM ERR.      12930000
*******************                                                     12940000
ERR090   EQU   *                                                        12942000
         TM    EWOSNS0,EWOEQU          IS IT EQ CHK                     12944000
         BZ    ERR100                  BR NO                            12946000
         CLI   C0(CCWPTR),SNSOP        IS IT A SNS OP CODE              12948000
         BE    ERR460                  BR YES TO PERM ERR               12948400
         SPACE 1                                                        12948800
*******************                                                     12950000
*        IS IT EQUIPMENT CHECK AND PERMANENT ERROR. IF YES, GO          13000000
*        TO SWAP.                                                       13050000
*******************                                                     13100000
ERR100   EQU   *                                                        13150000
         TM    EWOSNS0,EWOEQU+EWOPERR  IS IT EQ CHK AND PERM ERR        13200000
         BO    ERR430                  BR YES                           13250000
         SPACE 1                                                        13260000
*******************                                                     13270000
*        IS IT HOST RETRY. IF YES RETRY THE OPERATION.                  13280000
*******************                                                     13290000
         TM    EWOSNS0,EWOHRET         IS IT HOST RETRY                 13292000
         BO    ERR2000                 BR YES TO RETRY                  13294000
         SPACE 1                                                        13296000
*******************                                                     13300000
*        IS IT A CCH (ICC/CCC) ERROR. IF YES, GO TO CCH CODE.           13350000
*******************                                                     13400000
         TM    IOSTSB,ICC+CCC          IS IT CCH ERR                    13450000
         BNZ   ERR300                  BR YES TO CCH CODE               13500000
         SPACE 1                                                        13550000
*******************                                                     14200000
*        IS IT INTERVENTION REQUIRED OR ENVIROMENTAL DATA. IF YES,      14250000
*        GO SEE IF IT IS A SUSPEND CONDITION.                           14300000
*******************                                                     14350000
ERR120   EQU   *                                                        14400000
         TM    EWOSNS0,EWOINT+EWOENV   INT REQ OR ENV DATA              14450000
         BNZ   ERR200                  BR IF EITHER ON                  14500000
         SPACE 1                                                        14510000
*******************                                                     14550000
*        IS IT EQUIPMENT CHECK OR BUS OUT. IF YES, GO ATTEMPT A         14600000
*        RETRY.                                                         14650000
*******************                                                     14700000
         TM    EWOSNS0,EWOEQU+EWOBUSO  EQ CHK OR BUS OUT                14750000
         BNZ   ERR400                  BR IF EITHER ON                  14800000
         SPACE 1                                                        14810000
*******************                                                     14850000
*        IS IT CHANNEL DATA CHECK OR CHAINING CHECK. IF YES, GO         14900000
*        RETRY.                                                         14950000
*******************                                                     15000000
         TM    IOSTSB,CDC+CHN          CHAN DATA CK OR CHAIN CK         15050000
         BNZ   ERR400                  BR IF EITHER ON                  15100000
         SPACE 1                                                        15110000
*******************                                                     15150000
*        IS IT PROGRAM CHECK, PROTECTION CHECK OR INCORRECT LENGTH.     15200000
*        IS YES, GO TO PERMANENT ERROR.                                 15250000
*******************                                                     15300000
         TM    IOSTSB,PGM+PROT+ILI     PGM CK, PROT CK OR ILI           15350000
         BNZ   ERR460                  BR IF ANY BIT ON                 15400000
         SPACE 1                                                        15410000
*******************                                                     15420000
*        NO ERRORS HAVE BEEN FOUND. IF UNIT CHK IS ON,                  15430000
*        GO TO PERM ERROR.                                              15440000
*******************                                                     15442000
         TM    IOSTSA,UNCK             IS UNIT CHK ON                   15444000
         BO    ERR460                  BR YES TO PERM ERR               15446000
         SPACE 1                                                        15448000
*******************                                                     15450000
*        NO STATUS OR SENSE ERRORS HAVE BEEN FOUND. CALL THE            15500000
*        ERROR RECOVERED AND EXIT THE ERP.                              15550000
*******************                                                     15600000
ERR130   EQU   *                                                        15610000
         MVI   EWAFLG3,ZERO           CLR ERP FLAGS                     15650000
         MVI   EWACNTR2,ZERO           CLR ERP ERR CNTR                 15700000
         NI    IOSFLA,X'FF'-IOSERR-IOSEX  SET ERR RECOVERED             15750000
         B     ERR2000                 BR TO EXIT                       15800000
         EJECT                                                          15850000
*******************                                                     15900000
*        IS IT A SUSPEND CONDITION (DEV END + UNIT CHK ONLY).           15950000
*        IF NO, GO CHECK FURTHER. IF YES, BUILD THE SUSPEND CCW.        16000000
*        IF THE COMMAND WAS CHAINED, TIC TO THE NEXT USER CCW.          16050000
*        IF NO CHAINING CHAIN THE SUSPEND CCW TO A NOP.                 16100000
*******************                                                     16150000
ERR200   EQU   *                                                        16200000
         CLI   IOSTSA,SUSPEND          IS IT A SUSPEND CONDITION        16250000
         BNE   ERR240                  BR NO                            16300000
         OI    EWAFLG3,EWA3SUS+EWA3SAVE    SET SUSPEND BIT ON           16350000
         MVC   EWOCCW1(C16),CCWSUS     MOVE SUSPEND CCWS TO EWA         16400000
         MVC   UCBDEV+C4(C4),IOSVST    SAVE USER CCW ADR                16450000
         LA    REG2,EWOCCW1            GET VIRT ADR OF CCWS             16500000
         ST    REG2,IOSVST             PUT IN IOSB                      16550000
         LRA   REG2,EWOCCW1            GET REAL CCW ADDR                16600000
         ST    REG2,IOSRST             SET IN IOSB START FIELD          16650000
         LRA   REG2,C8(CCWPTR)         GET ADR OF ERR CCW+8             16700000
         CLI   C8(CCWPTR),TIC          IS CCW+8 A TIC                   16710000
         BNE   ERR220                  BR NO                            16800000
         L     REG2,C8(CCWPTR)         GET THE TIC TO ADR               16850000
         LA    REG2,C0(REG2)           ZERO HI ORDER BYTE               16900000
ERR220   EQU   *                                                        16910000
         ST    REG2,EWOCCW2            SET TIC TO ADR IN SUSPEND TIC    16950000
         MVI   EWOCCW2,TIC             SET TIC OP CODE BACK IN CCW      17000000
*        MORE DETAIL  ???????????                                       17050000
         TM    C4(CCWPTR),CMDCHN       IS ERR CCW CHAINED               17150000
         BO    ERR240                  BR YES                           17200000
         MVI   EWOCCW2,NOP             SET 2ND CCW TO A NOP             17250000
         SPACE 1                                                        17260000
*******************                                                     17300000
*        IS IT INTERVENTION REQUIRED. IF YES, GO TO PRINT MSG           17350000
*        AND RETRY. IF NO, ITS ENVIROMENTAL DATA, GO RECORD             17400000
*        AND RETRY.                                                     17450000
*******************                                                     17500000
ERR240   EQU   *                                                        17550000
         TM    EWOSNS0,EWOINT          IS IT INT REQ                    17600000
         BO    ERR480                  BR YES                           17650000
         B     ERR405                  BR NO                            17700000
         EJECT                                                          17750000
*******************                                                     17800000
*        CCH CODE.                                                      17850000
*        IS THIS THE SECOND TIME FOR THIS ERROR. IF YES, GO TO          17900000
*        PERMANENT ERROR.                                               17950000
*******************                                                     18000000
ERR300   EQU   *                                                        18050000
         TM    EWAFLG3,EWA3CCH        2ND TIME FOR THIS ERR             18100000
         BO    ERR380                  BR YES                           18150000
         SPACE 1                                                        18160000
*******************                                                     18200000
*        WAS ERROR ON A TIO, HIO OR IS THE NO RETRY BIT ON IN ERPIB.    18250000
*        IF ANY, GO TO PERMANENT ERROR.                                 18300000
*******************                                                     18350000
         TM    EWARGFG1,EWACTIO+EWACHIO+EWANORTY  ERR ON HIO,TIO OR?    18400000
         BNZ   ERR380                  BR IF ANY BITS ON                18450000
         SPACE 1                                                        18460000
*******************                                                     18500000
*        WAS THE ERROR ON A INTERRUPT OR A COND CODE 1. IF NEITHER      18550000
*        OR BOTH, GO TO PERMANENT ERROR.                                18600000
*******************                                                     18650000
         TM    EWARGFG1,EWACSIO+EWACINT  ERR ON SIO OR INTERRUPT        18700000
         BO    ERR380                  BR BOTH ON                       18750000
         BZ    ERR380                  BR NEITHER ON                    18800000
         SPACE 1                                                        18810000
*******************                                                     18850000
*        IS IT A COND CODE 1. IF YES, THE CCW CAN BE RESTARTED SO       18900000
*        BYPASS SOME ERROR TESTING.                                     18950000
*******************                                                     19000000
         TM    IOSCC,IOSCC1            IS IT COND CODE 1                19050000
         BO    ERR330                  BR YES                           19100000
         SPACE 1                                                        19110000
*******************                                                     19150000
*        ARE VALIDITY BITS ALL ON. IF ANY OFF, GO TO PERM ERROR.        19200000
*******************                                                     19250000
         TM    EWAXCSW1,EWACSQV+EWACUNS+EWACCMD  SEQ, STATUS,CMD OK     19300000
         BNO   ERR380                  BR IF ANY OFF                    19350000
         SPACE 1                                                        19360000
*******************                                                     19400000
*        ONLY TERM CODES OF 0 OR 1 ARE RETRIABLE. IF TERM CODE IS       19950000
*        2 OR 3 GO TO PERM ERROR.                                       20000000
*******************                                                     20050000
*        SET UP RESTART STUFF  ????????????????                         20100000
ERR330   EQU   *                                                        20150000
         TM    EWAXCSW2,EWATER3        IS TERM CODE 3                   20250000
         BO    ERR380                   BR YES                          20300000
         TM    EWAXCSW2,EWATER2        IS TERM CODE 2                   20350000
         BO    ERR380                  BR YES                           20400000
         SPACE 1                                                        20410000
*******************                                                     20450000
*        ONLY  SEQ CODE OF 1,2 OR 3 ARE RETRIABLE. IF IT IS SEQ         20500000
*        CODE 0,4,5,6 OR 7 GO TO PERM ERROR.                            20550000
*******************                                                     20600000
         TM    EWAXCSW2,EWASEQ4        IS SEQ CODE 4,5,6,7              20650000
         BO    ERR380                  BR YES                           20700000
         TM    EWAXCSW2,EWASEQ7        IS SEQ CODE 0                    20750000
         BZ    ERR380                  BR YES                           20800000
         SPACE 1                                                        20810000
*******************                                                     20850000
*        ZERO THE ERPIB, SET THE CCH COUNTER BIT ON AND GO TO           20900000
*        RETRY THE OPERATION.                                           20950000
*******************                                                     21000000
ERR360   EQU   *                                                        21050000
         XC    EWAERPIB(C8),EWAERPIB   ZERO ERPIB                       21100000
         OI    EWAFLG3,EWA3CCH        SET CCH CNTR ON                   21150000
         B     ERR2000                 BR                               21200000
         SPACE 1                                                        21210000
*******************                                                     21250000
*        ZERO THE ERPIB AND GO TO PERM ERROR.                           21300000
*******************                                                     21350000
ERR380   EQU   *                                                        21400000
         XC    EWAERPIB(C8),EWAERPIB   ZERO ERPIB                       21450000
         B     ERR460                  BR                               21500000
         EJECT                                                          21550000
*******************                                                     21600000
*        IS THE ERROR COUNTER = 5. IF NO, GO ATTEMPT A RETRY. IF YES,   21650000
*        SEE IF A SWAP IS REQUIRED.                                     21700000
*******************                                                     21750000
ERR400   EQU   *                                                        21800000
         CLI   EWACNTR2,FIVE           IS ERR EQUAL TO FIVE             21850000
         BE    ERR430                  BR YES                           21900000
         SPACE 1                                                        21910000
*******************                                                     21950000
*        STEP THE ERROR COUNTER BY ONE.                                 22000000
*******************                                                     22050000
         IC    REG2,EWACNTR2           GET ERR CNTR                     22100000
         LA    REG2,C1(REG2)           STEP BY ONE                      22150000
         STC   REG2,EWACNTR2           PUT BACK                         22200000
         SPACE 1                                                        22210000
*******************                                                     22250000
*        IS IT EQ CHK OR ENVIROMENTAL DATA. IF NEITHER GO RETRY.        22260000
*        IF EITHER GO CHECK FOR CEM AND SUU.                            22270000
*******************                                                     22400000
ERR405   EQU   *                                                        22450000
         TM    EWOSNS0,EWOEQU          IS IT EQ CHK                     22500000
         BO    ERR407                  BR YES                           22550000
         TM    EWOSNS0,EWOENV          IS IT ENVIROMENTAL DATA          22552000
         BZ    ERR2000                 BR NO TO EXIT SVC 15 RETRY       22554000
         SPACE 1                                                        22560000
*******************                                                     22600000
*        IS IT CEM AND/OR SUU. IF BOTH ERP WILL PRINT SUU AND WTO WILL  22610000
*        PRINT THE OTHER. IF ONLY ONE WTO WILL PRINT IT. THEN GO RETRY. 22620000
*******************                                                     22750000
         TM    EWOSNS1,EWOCEM+EWOSUU   IS IT CE MSG AND SUU             22800000
         BZ    ERR412                  BR IF BOTH NOT ON TO RETRY       22850000
         BNO   ERR475                  BR ONE ON, GO TO WTO TO PRINT    22852000
         BAL   REG3,ERRSUU             GO PRT SUU MSG                   22860000
         B     ERR475                  BR                               22950000
         SPACE 1                                                        22960000
*******************                                                     23000000
*        IF NEITHER CEM AND/OR SUU GO TO RETRY. IF EITHER OR BOTH THE   23010000
*        ERP WILL PRINT THE MESSAGE(S). THEN GO RETRY.                  23020000
*******************                                                     23100000
ERR407   EQU   *                                                        23150000
         TM    EWOSNS1,EWOCEM+EWOSUU   IS CE MSG OR SUU ON              23200000
         BZ    ERR2000                 BR IF NEITHER ON                 23250000
         TM    EWOSNS1,EWOSUU          IS IT SUU MESSAGE                23252000
         BZ    ERR410                  BR NO                            23254000
         BAL   REG3,ERRSUU             GO PRT SUU MSG                   23256000
ERR410   EQU   *                                                        23258000
         TM    EWOSNS1,EWOCEM          IS IT CEM MESSAGE                23258400
         BZ    ERR475                  GO TO WTO TO PRT EQ CK MSG       23258800
         BAL   REG3,ERRCEM             GO PRT CEM MSG                   23259200
         B     ERR475                  GO TO WTO TO PRT EQ CK MSG       23259600
         SPACE 1                                                        23260000
*******************                                                     23900000
*        SET LOG ON AND EXIT TO OBR.                                    23950000
*******************                                                     24000000
ERR412   EQU   *                                                        24050000
         OI    IOSFLB,IOSLOG           SET LOG ON                       24100000
         LA    REGD,OBRRTN             GET XCTL CODE FOR OBR            24150000
         B     ERR1000                 BR                               24200000
         SPACE 1                                                        24510000
*******************                                                     24550000
*        IS IT EQUIPMENT CHECK OR BUS OUT. IF EITHER, SET UP TO         24600000
*        GO TO THE SWAP CODE. IF NEITHER  EXIT PERM ERROR.              24650000
*******************                                                     24700000
ERR430   EQU   *                                                        24750000
         TM    EWOSNS0,EWOEQU+EWOBUSO  EQ CHK OR BUS OUT                24800000
         BZ    ERR460                  BR IF NEITHER ON                 24850000
         SPACE 1                                                        24860000
*******************                                                     24900000
*        SET MSG ON. IF CEM ON GO PRINT CEM MESSAGE.                    24950000
*******************                                                     25000000
         OI    IOSFLB,IOSMSG           SET MSG ON                       25050000
         TM    EWOSNS1,EWOCEM          IS CE MSG ON                     25100000
         BZ    ERR434                  BR NO                            25150000
         BAL   REG3,ERRCEM             GO PRT CEM MSG                   25160000
         SPACE 1                                                        25210000
*******************                                                     25250000
*        IF SUU ON GO PRINT SUU MESSAGE.                                25300000
*******************                                                     25350000
ERR434   EQU   *                                                        25400000
         TM    EWOSNS1,EWOSUU          IS SUU ON                        25450000
         BZ    ERR436                  BR NO                            25500000
         BAL   REG3,ERRSUU             GO PRT SUU MSG                   25510000
         SPACE 1                                                        25560000
********************                                                    25600000
*        IF IT IS EQ CHK AND PERM ERR BIT, WE ONLY WANT TO SWAP IF      25650000
*        IT IS FORMAT 1 OR FORMAT 2 IN BYTE 3 OF SENSE. OTHERWISE       25700000
*        CALL IT A PERM ERROR ONLY.                                     25750000
*******************                                                     25800000
ERR436   EQU   *                                                        25810000
         TM    EWOSNS0,EWOEQU+EWOPERR  IS IT EQ CK AND PERM ERR         25850000
         BNO   ERR440                  BR IF BOTH NOT ON                25900000
         TM    EWOSNS3,EWOFOR1+EWOFOR2 IS IT FORMAT 1 OR 2              25950000
         BZ    ERR470                  BR IF NEITHER TO PERM ERR        26000000
         SPACE 1                                                        26050000
*******************                                                     26100000
*        WE MUST SWAP SO WE WILL INSURE THAT THE MSG AND LOGGING        26150000
*        REQUIRED IS DONE BEFOR THE UCBS ARE SWAPPED.                   26200000
*        SET SWAP LOOP ON, SET THE PERM BIT ON IN SENSE FOR EREP        26250000
*        AND EXIT.                                                      26300000
*        WE WILL EXIT THRU OBR/WTO AND IOS WILL CALL US BACK BECAUSE    26350000
*        THE ERP IS STILL IN CONTROL. THE ERP WILL                      26400000
*        LOOK FOR THE LOOP BIT ON WHEN IT IS CALLED AND GO              26450000
*        TO DO THE SWAP.                                                26500000
*******************                                                     26550000
ERR440   EQU   *                                                        26600000
         OI    IOSFLC,FLCLOOP          SET LOOP ON                      26660000
         OI    EWOSNS0,EWOPERR         SET PERM ERR BIT ON IN SNS       26750000
         SPACE 3                                                        26760000
         B     ERR480                  BR                               26800000
         SPACE 1                                                        26810000
*******************                                                     26850000
*        SET MSG ON.                                                    26900000
*******************                                                     26950000
ERR460   EQU   *                                                        27000000
         OI    IOSFLB,IOSMSG           SET MSG ON                       27050000
         SPACE 1                                                        27060000
*******************                                                     27100000
*        SET ERP TO PERMANENT ERROR.                                    27150000
*******************                                                     27200000
ERR470   EQU   *                                                        27250000
         NI    IOSFLA,X'FF'-IOSERR SET ERR TO PERMANENT                 27300000
         B     ERR480                  BR                               27350000
         SPACE 1                                                        27360000
*******************                                                     27400000
*        SET MSG ON.                                                    27450000
*******************                                                     27500000
ERR475   EQU   *                                                        27550000
         OI    IOSFLB,IOSMSG           SET MSG ON                       27600000
         SPACE 1                                                        27610000
*******************                                                     27650000
*        SET LOG ON.                                                    27700000
*******************                                                     27750000
ERR480   EQU   *                                                        27800000
         OI    IOSFLB,IOSLOG           SET LOG ON                       27850000
         SPACE 1                                                        27860000
*******************                                                     27900000
*        SET UP XCTL FOR WTO ROUTINE.                                   27950000
*******************                                                     28000000
ERR490   EQU   *                                                        28050000
         LA    REGD,WTORTN             GET XCTL CODE FOR WTO            28100000
         B     ERR1000                 BR                               28150000
         SPACE 1                                                        28160000
*******************                                                     28200000
*        SET OPERATOR SWAP ON.                                          28250000
*******************                                                     28300000
ERR494   EQU   *                                                        28350000
         OI    EWAFLG3,EWA3OPER       SET OPER SWAP ON                  28400000
         B     ERR497                  BR ON                            28410000
ERR496   EQU   *                                                        28410400
         TM    IOSCC,IOSCC3            IS IT COND CODE 3                28410800
         BO    ERR497                  BR YES                           28411200
         CLC   IOSTSA(C2),STATOK       IS CSW CHAN-DEV END ONLY         28411600
         BE    ERR130                  BR YES TO EXIT OK                28411700
ERR497   EQU   *                                                        28411800
         B     ERR500                  BR TO SWAP CODE                  28412000
*********************                                                   28990000
         EJECT                                                          29000000
*******************                                                     29050000
*        SET UP PART OF CEM MESSAGE.                                    29100000
*******************                                                     29150000
ERRCEM   EQU   *                                                        29200000
         MVC   EWOMSG(C37),WTOMSG      MOVE MSG TO EWA                  29250000
         MVC   EWOWTOB(C3),MSGFRU      MOVE FRU TO MSG                  29300000
         B     MSG100                  BR                               29350000
         SPACE 1                                                        29360000
*******************                                                     29400000
*        SET UP PART OF SUU MESSAGE.                                    29450000
*******************                                                     29500000
ERRSUU   EQU   *                                                        29550000
         MVC   EWOMSG(C37),WTOMSG      MOVE MSG TO EWA                  29600000
         MVC   EWOWTOB(C3),MSGSUU      MOVE SUU TO MSG                  29650000
         SPACE 1                                                        29660000
*******************                                                     29700000
*        COMPLETE THE ERROR MESSAGE. AND DO A WTO.                      29750000
*******************                                                     29800000
MSG100   EQU   *                                                        29850000
         MVC   EWOWTOA(C3),UCBNAME     MOVE DEV ADR TO MSG              29900000
         LR    REG2,IOSBPTR            SAVE IOSB REG                    29950000
         TIME  DEC                                                      30000000
         LR    IOSBPTR,REG2            RESTORE REG 1                    30050000
         ST    REG0,EWOWORK1           STORE TIME IN EWA                30100000
         OI    EWOWORK1+C3,OF          SET IN SIGN                      30150000
         UNPK  EWOWORK1(C7),EWOWORK1(C4)  UNPACK TO PRTABLE HEX         30200000
         MVC   EWOWTOD(C2),EWOWORK1    MOVE IN HOUR                     30250000
         MVC   EWOWTOF(C2),EWOWORK1+C2  MOVE MINS TO MSG                30300000
         MVC   EWOWTOG(C2),EWOWORK1+C4  MOVE SECS TO MSG                30350000
*        GET TIME AND PUT IN MSG                                        30400000
         LR    REG2,IOSBPTR            SAVE REG 1                       30450000
         LA    IOSBPTR,EWOMSG          GET ADR OF MSG                   30500000
         WTO   MF=(E,(1))                                               30550000
         LR    IOSBPTR,REG2            RESTORE REG 1                    30600000
         BR    REG3                    RETURN TO CALLER                 30650000
         EJECT                                                          30700000
*        CONTROL UNIT SWAP CODE                                         30750000
*                                                                       30800000
ERR500   EQU   *                                                        30810000
********************                                                    30919700
*        SET SWAP LOOP FLAG OFF                                         30920100
********************                                                    30920500
         NI    IOSFLC,X'FF'-FLCLOOP     SET SWAP LOOP FLAG OFF          30920900
         SPACE 1                                                        30921400
********************                                                    30923400
*        ARE WE ALREADY IN A CONTROL UNIT SWAP                          30923900
*        BRANCH YES, TO SEE IF IT WAS COMPLETED OK.                     30924400
********************                                                    30924900
         TM    EWAFLG3,EWA3SWAP       ARE WE IN A SWAP NOW              30925400
         BO    ERR700                  BR YES , TEST FOR ERRS           30925900
         SPACE 1                                                        30926300
********************                                                    30926500
*        IS THE ALERNATE CONTROL UNIT 'GENED', 'ONLINE' AND 'READY'.    30926900
*        BRANCH IF NOT TO PRINT 'SWAP IMPOSSIBLE'.                      30927400
********************                                                    30927900
ERR520   EQU   *                                                        30928400
         LTR   ALTUCB,ALTUCB           IS ALT UCB GENED                 30928900
         BZ    ERR850                  BR NO                            30929400
         TM    ALTSTAT(ALTUCB),UCBONLI  IS ALT UCB ONLINE               30929900
         BZ    ERR850                  BR NO TO PRT MSG                 30930400
         TM    ALTFLA(ALTUCB),UCBNRY    IS ALT UCB READY                30930900
         BO    ERR850                  BR NO TO PRT MSG                 30931400
         SPACE 1                                                        30931800
********************                                                    30931900
*        SET 'SWAP IN PROCESS' ON.                                      30932400
********************                                                    30932900
         OI    EWAFLG3,EWA3SWAP SET SWAP IN PROCESS ON                  30933400
         SPACE 1                                                        30933800
********************                                                    30933900
*        FIND THE ALTERNATE AND PRIMARY UCB SLOTS IN THE UCB LOOKUP     30934400
*        TABLE. SWAP THE CONTENTS OF THESE SLOTS.                       30934900
********************                                                    30935400
         L     REG2,CVTILK2            GET ADDR OF UCB LOOKUP TABLE     30935900
         LR    REGC,REG2                 IN REG 2 AND 12                30936400
         LR    REGD,PRIUCB             GET PRIMARY UCB ADDR             30936500
         AH    REGD,H512               ADD HEX 200 TO RESTORE UCB ADDR  30936600
         SPACE 1                                                        30936800
********************                                                    30936900
*        FIND UCB LOOKUP SLOT FOR ALTERNATE FIRST                       30937400
*        IF CANT FIND BY END OF TABLE GO TO ERROR CODE                  30937900
********************                                                    30938400
ERR540   EQU   *                                                        30938900
         CLM   ALTUCB,C3,C0(REG2)      'TO' UCB LOOKUP SLOT             30939400
         BE    ERR545                  BR YES TO CHECK 'FROM' UCB       30939900
         LA    REG2,C2(REG2)           STEP TO NEXT SLOT                30940400
         TM    C1(REG2),EOT            IS IT END OF TABLE               30940900
         BO    ERR850                  BR YES TO ERR CODE               30941400
         B     ERR540                  BR TO TEST NEXT SLOT             30941900
         SPACE 1                                                        30942300
********************                                                    30942400
*        FIND UCB LOOKUP SLOT FOR PRIMARY NOW                           30942900
*        IF CANT FIND BY END OF TABLE GO TO ERROR CODE                  30943400
********************                                                    30943900
ERR545   EQU   *                                                        30944400
         CLM   REGD,C3,C0(REGC)       'FROM' UCB LOOKUP SLOT            30944900
         BE    ERR550                  BR YES TO CK END                 30945400
         LA    REGC,C2(REGC)           STEP TO NEXT SLOT                30945900
         TM    C1(REGC),EOT            IS IT END OF TABLE               30946400
         BO    ERR850                  BR YES TO ERR CODE               30946900
         B     ERR545                  BR TO TEST NEXT SLOT             30947400
         SPACE 1                                                        30947800
********************                                                    30947900
*        HAVE FOUND BOTH SLOTS. SWAP THEM IN THE TABLE.                 30948400
********************                                                    30948900
ERR550   EQU   *                                                        30949400
         STH   REGD,C0(REG2)           STORE PRI IN ALT SLOT            30949900
         STH   ALTUCB,C0(REGC)         STORE ALT IN PRI SLOT            30950400
         SPACE 1                                                        30950800
********************                                                    30950900
*        SWAP THE FOLLOWING CONTENTS OF THE PRIMARY AND ALTERNATE UCBS. 30951400
*        'UCBNAME' (DEVICE ADDR IN BCD) AND 'UCBCHAN' (DEVICE ADDR IN   30951900
*        HEX).                                                          30952400
********************                                                    30952900
ERR555   EQU   *                                                        30953400
         LH    REGC,UCBCHAN           GET HEX CUU OF PRIMARY            30953900
         LH    REGD,ALTCHAN(ALTUCB)  GET HEX CUU OF ALTERNATE           30954400
         STH   REGC,ALTCHAN(ALTUCB)  SWAP PRIMARY AND ALTERNATE         30954900
         STH   REGD,UCBCHAN            UCB HEX CUU ADDRS                30955400
         MVC   EWOWORK1(C3),UCBNAME    SAVE PRIMARY UCB BCD CUU         30955900
         MVC   UCBNAME(C3),ALTNAME(ALTUCB)  ALT BCD CUU TO              30956400
         MVC   ALTNAME(C3,ALTUCB),EWOWORK1                              30956900
         NI    ALTSTAT(ALTUCB),X'FF'-UCBONLI  SET NEW ALT UCB OFFLINE   30957000
         SPACE 1                                                        30957300
********************                                                    30957400
*        PRINT MESSAGE;                                                 30957900
*        'SWAP TO ZZZ STARTED,XXX OFFLINE'                              30958400
*        XXX IS THE 'NEW' PRIMARY DEVICE                                30958900
*        ZZZ IS THE 'NEW' ALTERNATE DEVICE.                             30959400
********************                                                    30959900
         MVC   EWOMSG(C47),WTOMSGD     MOVE MSG TO EWA                  30960400
         MVC   EWOWTOC(C3),UCBNAME          MOVE PRI UCB CUU TO MSG     30960900
         MVC   EWOWTOH(C3),ALTNAME(ALTUCB)  MOVE ALT UCB CUU TO MSG     30961400
         LR    REG2,IOSBPTR            SAVE REG 1                       30961900
         LA    IOSBPTR,EWOMSG          GET ADDR OF MSG                  30962400
         WTO   MF=(E,(1))                                               30962900
         LR    IOSBPTR,REG2            RESTORE REG 1                    30963400
         SPACE 1                                                        30963800
********************                                                    30965400
*        MOVE THE FOUR 'SWAP' CCWS TO THE EWA AND SET UP TO SIO TO      30965900
*        THEM. THE CCWS ARE CHAINED 'SWITCH', INITIALIZE', 'HOST        30966400
*        READY FOR MESSAGES' .                                          30966900
********************                                                    30967400
ERR600   EQU   *                                                        30967900
         OI    EWAFLG3,EWA3SAVE       SET CCW SAVE BIT ON               30968400
         MVC   UCBDEV+C4(C4),IOSVST    SAVE USER VIRT ADR               30968900
         MVC   EWOCCW1(C24),CCWSW      MOVE SWAP CCWS TO EWA            30969400
         MVC   EWOINIT(C4),INIT        MOVE INIT DATA TO EWA            30969900
         MVC   EWOHRM(C4),HRM          MOVE HRM DATA TO EWA             30970400
         LRA   REG2,EWOINIT            GET REAL ADDR OF INIT DATA       30970900
         ST    REG2,EWOCCW2            STORE ADDR IN CCW                30971400
         MVI   EWOCCW2,EXEC            RESTORE CCW OP CODE              30971900
         LRA   REG2,EWOHRM             GET REAL ADDR OF HRM DATA        30972400
         ST    REG2,EWOCCW3            STORE ADDR IN CCW                30972900
         MVI   EWOCCW3,EXEC            RESTORE CCW OP CODE              30973400
         LA    REG2,EWOCCW1            GET ADR OF 1ST SWAP CCW          30973900
         ST    REG2,IOSVST             STORE VIRT CCW ADR IN IOSB       30974400
         LRA   REG2,C0(REG2)           GET REAL ADR                     30974900
         ST    REG2,IOSRST             STORE REAL CCW ADR IN IOSB       30975400
         SPACE 1                                                        30975800
********************                                                    30975900
*        DO A ERP SIO 'SVC 15' AND 'SVC 3'.                             30976400
********************                                                    30976900
ERR620   EQU   *                                                        30977400
         B     ERR2000                 BR TO EXIT                       30977900
         EJECT                                                          30979400
********************                                                    30979900
*        HAVE WE COMPLETED THE SWAP WITHOUT ERROR.                      30980400
*        IS IT CONDITION CODE 3 OR UNIT CHECK.                          30980900
*        BRANCH YES, TO HANDLE SWAP FAILURE.                            30981400
********************                                                    30981900
ERR700   EQU   *                                                        30982400
         TM    IOSCC,IOSCC3            IS IT COND CODE 3                30982900
         BO    ERR785                   BR YES TO ERR CHECK             30983400
ERR720   EQU   *                                                        30983900
         CLC   IOSTSA(C2),STATOK       IS CSW STATUS CHAN-DEV END       30984300
         BNE   ERR790                  BR NOT OK TO ERR CHK             30984600
         SPACE 1                                                        30986700
********************                                                    30987000
*        PRINT MESSAGE;                                                 30987300
*        'SWAP TO ZZZ ENDED'                                            30987600
*        ZZZ IS THE 'NEW' PRIMARY DEVICE.                               30987900
********************                                                    30988200
         MVC   EWOMSG(C33),WTOMSGA     MOVE MSG TO EWA                  30988500
         MVC   EWOWTOC(C3),UCBNAME  MOVE PRIMARY CUU TO MSG             30988800
         LR    REG2,IOSBPTR            SAVE REG 1                       30989100
         LA    IOSBPTR,EWOMSG          GET ADDR OF MSG                  30989400
         WTO   MF=(E,(1))                                               30989900
         LR    IOSBPTR,REG2            RESTORE REG 1                    30990400
         SPACE 1                                                        30990800
********************                                                    30990900
*        WAS THIS A OPERATOR SWAP                                       30991400
*        BRANCH NO, TO REISSUE THE USER CCW(S).                         30991900
********************                                                    30992400
         TM    EWAFLG3,EWA3OPER       IS OPER SWAP ON                   30992900
         BZ    ERR780                  BR NO                            30993400
         SPACE 1                                                        30993800
********************                                                    30993900
*        SET RECOVERED ERROR INDICATION AND GO TO EXIT ERP.             30994400
********************                                                    30994900
ERR750   EQU   *                                                        30995400
         NI    IOSFLA,X'FF'-IOSERR-IOSEX  SET TO RECOVERED              30995900
         SPACE 1                                                        30996300
********************                                                    30996400
*        GO TO DO A SVC 15, SVC 3.                                      30996900
********************                                                    30997400
ERR780   EQU   *                                                        30997900
         MVI   EWACNTR2,C1            SET ERR CNTR TO 1                 30998400
         NI    EWAFLG3,X'FF'-EWA3SWAP-EWA3OPER  ZERO FLAGS              30998900
         B     ERR2000                 BR TO EXIT                       30999400
         EJECT                                                          30999900
ERR785   EQU   *                                                        31000300
         MVI   IOSCOD,COD41            SET COMPLETION CODE TO 41        31000500
         B     ERR795                  BR ON                            31000900
         SPACE 1                                                        31001000
*************************                                               31001100
*        SET MESSAGE BIT ON                                             31001300
*************************                                               31001500
ERR790   EQU   *                                                        31001900
         OI    IOSFLB,IOSMSG           SET MSG ON                       31002400
         SPACE 1                                                        31002800
*************************                                               31002900
*        SET LOG BIT ON                                                 31003400
*************************                                               31003900
ERR795   EQU   *                                                        31004400
         OI    IOSFLB,IOSLOG           SET LOG ON                       31004900
         SPACE 1                                                        31005300
********************                                                    31005400
*        PRINT MESSAGE;                                                 31005900
*        'SWAP TO ZZZ FAILED, ZZZ OFFLINE'                              31006400
*        ZZZ IS THE NEW PRIMARY DEVICE.                                 31006900
********************                                                    31007400
ERR800   EQU   *                                                        31007900
         MVC   EWOMSG(C47),WTOMSGC     MOVE MSG TO EWA                  31008400
         MVC   EWOWTOC(C3),UCBNAME     MOVE DEV ADDR TO MSG             31008900
         MVC   EWOWTOH(C3),UCBNAME     MOVE DEV ADR TO MSG              31009400
         LR    REG2,IOSBPTR            SAVE REG 1                       31009900
         LA    IOSBPTR,EWOMSG          GET ADDR OF MESSAGE              31010400
         WTO   MF=(E,(1))                                               31010900
         LR    IOSBPTR,REG2            RESTORE REG 1                    31011400
*                                                                       31011800
         NI    IOSFLA,X'FF'-IOSERR     SET TO PERM ERR                  31012100
         NI    UCBSTAT,X'FF'-UCBONLI   SET PRIMARY UCB OFFLINE          31012500
         LA    REGD,WTORTN             GET ADDR OF WTO RTN              31012600
         B     ERR1000                 GO XCTL TO WTO                   31012700
         SPACE 1                                                        31013000
*******************                                                     31013300
*        THE ALTERNATE DEVICE IS 'NOT GENED', 'NOT ONLINE', 'NOT READY' 31013600
*        OR THE UCB LOOK UP SLOT COUND NOT BE FOUND.                    31013900
*******************                                                     31014200
ERR850   EQU   *                                                        31014400
*******************                                                     31014900
*        PRINT MESSAGE;                                                 31015400
*        'XXX UNUSABLE, ZZZ NOT AVAIL'                                  31015900
*        IF THE ALTERNATE IS NOT GENED THE ZZZ WILL BE 'ALT'            31016400
*******************                                                     31016900
         MVC   EWOMSG(C43),WTOMSGB     MOVE MSG TO EWA                  31017400
         MVC   EWOWTOA(C3),UCBNAME     MOVE PRI ADR TO MSG              31017900
         MVC   EWOWTOB(C10),MSGUNU     SET IN MSG 'UNUSABLE, '          31018400
         TM    EWAFLG3,EWA3OPER        IS IT A OPER SWAP                31018900
         BZ    ERR860                  BR NO                            31019400
         MVC   EWOWTOB(C10),MSGOPER    SET IN MSG 'OPER SWAP-'          31019900
ERR860   EQU   *                                                        31020400
         MVC   EWOWTOE(C3),MSGALT      MOVE 'ALT' TO MSG                31020900
         LTR   ALTUCB,ALTUCB           IS ALT UCB AVALI                 31021400
         BZ    ERR865                  BR IF NOT GENED                  31021900
         MVC   EWOWTOE(C3),ALTNAME(ALTUCB)   MOVE IN ALT DEV ADDR       31022400
ERR865   EQU   *                                                        31022900
         LR    REG2,IOSBPTR            SAVE REG 1                       31023400
         LA    IOSBPTR,EWOMSG          GET ADDR OF MSG                  31023900
         WTO   MF=(E,(1))                                               31024400
         LR    IOSBPTR,REG2            RESTORE REG 1                    31024900
         SPACE 1                                                        31025300
*******************                                                     31025400
*        SET PRIMARY UCB 'OFFLINE'                                      31025900
*        SET 'PERMANENT ERROR' IN IOSB                                  31026400
*        SET 'MSG' AND 'LOG' ON AND EXIT TO WTO FOR A MESSAGE AND TO    31026900
*        RECORD ON LOGREC.                                              31027400
*******************                                                     31027900
ERR870   EQU   *                                                        31028400
         TM    EWAFLG3,EWA3OPER        IS IT OPER SWAP                  31028900
         BO    ERR875                  BR YES                           31029400
         NI    UCBSTAT,X'FF'-UCBONLI   SET PRI UCB OFFLINE              31029900
ERR875   EQU   *                                                        31030400
         NI    IOSFLA,X'FF'-IOSERR     SET TO PERM ERR                  31030900
         B     ERR2000                 BR NO TO SVC 15 EXIT             31031900
*                                                                       31033700
         EJECT                                                          31035700
*******************                                                     31037700
*        EXIT FROM ERP VIA XCTL.                                        31038100
*******************                                                     31038500
ERR1000  EQU   *                                                        31038600
         L     BALRREG,CVTXTLER        GET XCTL RTN ADDR                31038700
         BR    BALRREG                 XCTL TO NEXT RTN                 31038800
         SPACE 4                                                        31041000
*******************                                                     31043000
*        EXIT SVC-15  SVC-3                                             31043400
*******************                                                     31043800
ERR2000  EQU   *                                                        31044200
         SVC   FIFTEEN                                                  31044300
         SVC   THREE                                                    31044600
         EJECT                                                          31045400
         DS    0F                                                       31046600
CCWSW    CCW   X'44',0,X'60',1                                          31048800
CCWINIT  CCW   X'87',INIT,X'60',4                                       31051000
CCWHRM   CCW   X'87',HRM,X'20',4                                        31053200
INIT     DC    X'1000C000'                                              31055400
HRM      DC    X'20000000'                                              31057600
*                                                                       31059800
CCWSUS   CCW   X'A3',0,X'60',1                                          31062000
CCWTIC   CCW   X'08',0,X'00',1                                          31064200
*                                                                       31066400
         DS    0F                                                       31068600
H2       DC    H'2'                                                     31070800
H8       DC    H'8'                                                     31073000
H512     DC    H'512'                                                   31075200
STATOK   DC    X'0C00'                                                  31075600
*--------------------------------------------------------------------   31077200
         DS    0F                                                       31077400
WTOMSGA  DS    0F                                                       31079600
         DC    AL2(MSGENDA-MSGNOA)                                      31081800
         DC    X'8000'                                                  31084000
MSGNOA   DC    C'IEA000I SWAP TO ZZZ ENDED'                             31086200
         DC    X'10002040'                                              31088400
MSGENDA  EQU   *                                                        31090600
*--------------------------------------------------------------------   31092600
*                                                                       31092800
WTOMSGB  DS    0F                                                       31095000
         DC    AL2(MSGENDB-MSGNOB)                                      31097200
         DC    X'8000'                                                  31099400
MSGNOB   DC    C'IEA000I XXX UNUSABLE, ZZZ NOT AVAIL'                   31101600
         DC    X'10002040'                                              31103800
MSGENDB  EQU   *                                                        31106000
*--------------------------------------------------------------------   31108000
*                                                                       31108200
WTOMSGC  DS    0F                                                       31110400
         DC    AL2(MSGENDC-MSGNOC)                                      31112600
         DC    X'8000'                                                  31114800
MSGNOC   DC    C'IEA000I SWAP TO ZZZ FAILED, ZZZ OFFLINE'               31117000
         DC    X'10002040'                                              31119200
MSGENDC  EQU   *                                                        31121400
*--------------------------------------------------------------------   31123400
*                                                                       31123600
WTOMSGD  DS    0F                                                       31125800
         DC    AL2(MSGENDD-MSGNOD)                                      31128000
         DC    X'8000'                                                  31130200
MSGNOD   DC    C'IEA000I SWAP TO ZZZ STARTED,XXX OFFLINE'               31132400
         DC    X'10002040'                                              31134600
MSGENDD  EQU   *                                                        31136800
*--------------------------------------------------------------------   31138800
*                                                                       31139000
WTOMSG   DS    0F                                                       31145600
         DC    AL2(MSGEND-MSGNO)                                        31147800
         DC    X'8000'                                                  31150000
MSGNO    DC    C'IEA000I '                                              31200000
MSGTXTA  DC    C'XXX ZZZ'                                               31250000
MSGTXTB  DC    C',,,,,,'                                                31300000
MSGTXTC  DC    C'XX.XX.XX'                                              31350000
ROUTE    DC    X'10002040'                                              31400000
MSGEND   EQU   *                                                        31450000
*--------------------------------------------------------------------   31460000
MSGALT   DC    C'ALT '                                                  31470000
MSGSUU   DC    C'SUU '                                                  31500000
MSGFRU   DC    C'CEM '                                                  31550000
MSGUNU   DC    C'UNUSABLE, '                                            31552000
MSGOPER  DC    C'OPER SWAP-'                                            31554000
ERPMAINT EQU   *                                                        31560000
         DC    AL2(MAINTEND-ERPMAINT)                                   31610000
         ORG   ERR000+4080                                              31620000
         DC    C'IGE0000H //END//'                                      31630000
MAINTEND EQU   *                                                        31640000
         EJECT                                                          31650000
         IECDIOSB                                                       31700000
         EJECT                                                          31750000
         IECDERWA                                                       31800000
         SPACE 3                                                        31850000
*////////////////////////////////////////////////////////////////////   31900000
*                                                                       31950000
*////////////////////////////////////////////////////////////////////   32000000
         ORG   EWAIERP                                                  32050000
EWOSNS   DS    XL32                                                     32100000
         ORG   EWOSNS                                                   32150000
EWOSNS0  DS    XL1                                                      32200000
EWOCREJ  EQU   X'80'                   COMMAND REJECT                   32250000
EWOINT   EQU   X'40'                   INTERVENTION REQUIRED            32300000
EWOBUSO  EQU   X'20'                   BUS OUT CHECK                    32350000
EWOEQU   EQU   X'10'                   EQUIPMENT CHECK                  32400000
EWO4     EQU   X'08'                                                    32450000
EWOHRET  EQU   X'04'                   HOST RETRY                       32460000
EWOPERR  EQU   X'02'                   PERMANENT ERROR                  32550000
EWOENV   EQU   X'01'                   ENVIROMENTAL DATA                32600000
EWOSNS1  DS    XL1                                                      32650000
EWOCEM   EQU   X'80'                   CE MESSAGE                       32700000
EWOSUU   EQU   X'40'                   SUBSYSTEM UNIT UNUSABLE          32750000
EWOSNS2  DS    XL1                                                      32800000
EWOSNS3  DS    XL1                                                      32850000
EWOFOR1  EQU   X'40'                   FORMAT 1                         32900000
EWOFOR2  EQU   X'20'                   FORMAT 2                         32950000
EWOSNS4  DS    XL1                                                      33000000
EWOSNS5  DS    XL1                                                      33050000
EWOSNS6  DS    XL1                                                      33100000
EWOSNS7  DS    XL1                                                      33150000
EWOSNS8  DS    XL1                                                      33200000
EWOSNS9  DS    XL1                                                      33250000
EWOSNS10 DS    XL1                                                      33300000
EWOSNS11 DS    XL1                                                      33350000
EWOSNS12 DS    XL1                                                      33400000
EWOSNS13 DS    XL1                                                      33450000
EWOSNS14 DS    XL1                                                      33500000
EWOSNS15 DS    XL1                                                      33550000
EWOSNS16 DS    XL1                                                      33600000
EWOSNS17 DS    XL1                                                      33650000
EWOSNS18 DS    XL1                                                      33700000
EWOSNS19 DS    XL1                                                      33750000
EWOSNS20 DS    XL1                                                      33800000
EWOSNS21 DS    XL1                                                      33850000
EWOSNS22 DS    XL1                                                      33900000
EWOSNS23 DS    XL1                                                      33950000
EWOSNS24 DS    XL1                                                      34000000
EWOSNS25 DS    XL1                                                      34050000
EWOSNS26 DS    XL1                                                      34100000
EWOSNS27 DS    XL1                                                      34150000
EWOSNS28 DS    XL1                                                      34200000
EWOSNS29 DS    XL1                                                      34250000
EWOSNS30 DS    XL1                                                      34300000
EWOSNS31 DS    XL1                                                      34350000
*                                                                       34400000
EWOCCWS  DS    XL24                                                     34450000
         ORG   EWOCCWS                                                  34500000
EWOCCW1  DS    XL8                                                      34550000
EWOCCW2  DS    XL8                                                      34600000
EWOCCW3  DS    XL8                                                      34650000
EWOWORK1 DS    XL4                                                      34750000
EWOWORK2 DS    XL4                                                      34800000
         ORG   EWOWORK1                                                 34850000
EWOINIT  DS    XL4                                                      34900000
EWOHRM   DS    XL4                                                      34950000
EWOMSG   DS    XL47                                                     35000000
         ORG   EWOMSG                                                   35050000
EWOWTO   DS    XL12                                                     35100000
EWOWTOA  DS    XL4                                                      35150000
EWOWTOB  DS    XL4                                                      35200000
EWOWTOC  DS    XL5                                                      35250000
EWOWTOD  DS    XL1                                                      35300000
EWOWTOE  DS    XL2                                                      35350000
EWOWTOF  DS    XL3                                                      35400000
EWOWTOG  DS    XL1                                                      35450000
EWOWTOH  DS    XL11                                                     35500000
EWOWTORT DS    XL4                                                      35550000
*                                                                       35600000
EWOSPARE DS    XL17                                                     35650000
EWOEND   EQU   *                                                        35700000
         EJECT                                                          35750000
         IEFUCBOB                      LIST=YES,PREFIX=YES              35800000
         EJECT                                                          35850000
         CVT   DSECT=YES,LIST=NO                                        35900000
         EJECT                                                          35950000
         IEZSSC                                                         36000000
         END                                                            36050000
./  ADD  SSI=81390017,NAME=IGE0000I
        TITLE 'IGE0000I     LOAD 1     1/2 INCH MAGNETIC TAPE ERPS'     00050003
IGE0000I START X'00'                   LOAD 1                           00100003
*                                                                       00150003
*********************************************************************** 00200003
*                                                                     * 00250003
* STATUS:                                                             * 00300003
*    CHANGE LEVEL:  VS2/REL3                                          * 00350003
*                                                                     * 00400003
* FUNCTION/OPERATION:                                                 * 00450003
*    THIS LOAD IS ENTERED EACH TIME ERP'S ARE CALLED                  * 00500003
*    1.  XCTL TO LOAD 2, PART 9, IF ICC/CCC CHANNEL ERROR             * 00550003
*    2.  GO TO PART 5 TO DO STAT UPDATE IF FIRST ENTRY FOR AN ERROR   * 00600003
*    3.  GO TO PART 3 IF ROR IN PROGRESS                              * 00650003
*    4.  XCTL TO LOAD 2, PART 1, IF:                                  * 00700003
*        A.  ERROR ON REPOSITIONING                                   * 00750003
*        B.  IOB INTERCEPT                                            * 00800003
*        C.  UNSOLICITED DEVICE END FROM A NEW DEVICE TYPE            * 00850003
*        D.  NOISE BLOCK FOUND ON READ (<12 BYTES)                    * 00900003
*    5.  SET CCW START ADDRESS DEPENDING ON CCW CHAINING FLAGS        * 00950003
*    6.  SET REPOSITIONING COMMAND OP CODE FOR READ/WRITE ERRORS      * 01000003
*    7.  HANDLE FIRST 40 READ RETRIES WITH REPOSITIONING AND          * 01050003
*        CLEANER ACTIONS.  GO TO PART 3 IF ROR NEEDED.                * 01100003
*    8.  HANDLE WRITE-TYPE RETRIES WITH REPOSITIONING,                * 01150003
*        XCTL TO WTO IF A PERMANENT ERROR.                            * 01200003
*    9.  XCTL TO LOAD 2, PART 4, IF ERROR OTHER THAN DATA CHECK       * 01250003
*        ON READ OR WRITE TYPE COMMANDS.                              * 01300003
*    10. GO TO PART 4 IF NO ERROR IS APPARENT OR ERROR IS RECOVERED   * 01350003
*    11. IF IDAL BIT IS ON IN ERROR CCW, GO TO PART 6 TO CREATE       * 01400003
*        ERP IDAL LIST FOR ROR.                                       * 01450003
* ENTRY POINTS:                                                       * 01500003
*         ER2401A - CALLED BY I/O SUPERVISOR                          * 01550003
*         IGE0100I LOAD 2                                             * 01600003
*                                                                     * 01650003
* INPUT:                                                              * 01700003
*    REGISTER 1 CONTAINS A POINTER TO THE IOSB                        * 01750003
*                                                                     * 01800003
* OUTPUT:  N/A                                                        * 01850003
*                                                                     * 01900003
* EXTERNAL ROUTINES:                                                  * 01950003
*         INTERPRETER ROUTINE - CHECKS SENSE AND STATUS BYTES         * 02000003
*                                                                     * 02050003
* EXITS - NORMAL:                                                     * 02100003
*         1.  SVC 15/3 EXIT TO IOS TO REPOSITION TAPE & REEXECUTE     * 02150003
*         2.  XCTL TO IGE0100I (LOAD 2)                               * 02200003
*         3.  XCTL TO IGE0025C (WTO ROUTINE)                          * 02250003
*         4.  XCTL TO IGE0025F (OBR ROUTINE)                          * 02300003
*                                                                     * 02350003
* EXITS - ERROR:  N/A                                                 * 02400003
*                                                                     * 02450003
* ATTRIBUTES:                                                         * 02500003
*    REENTRANT                                                        * 02550003
*                                                                     * 02600003
* NOTES:                                                              * 02650003
*    VS2/REL2 - LOADS 1, 3, 4 AND 5 OF PREVIOUS RELEASES HAVE BEEN    * 02700003
*    COMBINED TO CREATE LOAD 1 OF THIS RELEASE.  PART 6 WAS ADDED     * 02750003
*    IN ORDER TO CREATE AN ERP IDAL LIST FOR ROR.                     * 02800003
*    THIS LOAD INCLUDES:                                              * 02850003
*        1.  ERROR HANDLING FOR OTHER THAN ERP-ORIGINATED ERRORS      * 02900003
*        2.  READ OPPOSITE RECOVERY                                   * 02950003
*        3.  STATISTICS UPDATE                                        * 03000003
*                                                                     * 03050003
*    PTM YM6412  REPOSITION BIT NOT TURNED OFF ON PERM ERR EXIT       * 03100003
*                                                                     * 03150003
*    PTM 7116 SENSE DATA OVERLAYS I/O COMMAND DURING RECOVERY         * 03200003
*                                                                     * 03250003
*    CODE CHANGES FOR 16 BIT UCB ADDRESSING                  @Z30AB01 * 03300003
*                                                                     * 03350003
*    APAR FIX TO ZERO & THES BOTH BYTES ON WLI               @ZA00656 * 03360003
*    CHANGE TO NOT OVERLAY FIRST 4 BYTES PAST EWA            @ZA05117 * 03362003
*    MOVE TIE BYTE TO IOSB                                   @ZA08849 * 03364003
*    SET UP IOSB FOR 7 TRACK PARITY SWITCH                   @ZA05130 * 03368003
*    GET FAILING CCW ADDR INSTEAD OF FIRST CCW ADDR.         @ZA08853 * 03368403
*    APAR OZ08856 MOVE CORRECT BYTES FOR BLKCNT TO EWA       @ZA08856 * 03368803
*    REMOVE FIX FOR OX08853 TO PREVENT BAD IDAL              @ZA14734 * 03370003
*    FIX FOR LOW CORE OVERLAY PROBLEM                        @ZA14748 * 03380003
*    FIX FOR E00-0C4 ABEND PROBLEM                           @ZA14752 * 03385037
*    PREVENT OVERLAYING SQA FOR CCW COUNT > X'7FFF'          @ZA17538 * 03387037
*    PREVENT LOSING BLOCKS WITH CHAIN SCHEDULING & DDR       @ZA16828 * 03388037
*    ZERO SDR OVERFLOW COUNTER (A244000)                     @ZA27822 * 03388437
*    SDR RECORD FOR DATA CHAINING (A752040-752050            @ZA30317 * 03388837
*    LOADPOINT ON PE REPOSITIONING (A269000-269500)          @ZA30781 * 03389237
*    TURN ON EWADDMSG FOR WTO                                @ZA31011 * 03390037
*    DELETE OZ30781 CODE                                     @ZA32492 * 03395037
*********************************************************************** 03400003
*                                                                       03450003
         EJECT                                                          03500003
*                                                                       03550003
*           R E G I S T E R   A S S I G N M E N T S                     03600003
*                                                                       03650003
R0       EQU   0                       WORK REG                         03700003
IOSREG   EQU   1                       IOSB ADDRESS                     03750003
R1       EQU   1                       WORK REG                         03800003
ERPREG   EQU   2                       ERP IDAL ADDRESS                 03850003
UXREG    EQU   2                       UCB EXTENSION ADDRESS            03900003
R3       EQU   3                       WORK REG                         03950003
CCWREG   EQU   3                       CCW ADDRESS                      04000003
R4       EQU   4                       WORK REG                         04050003
R5       EQU   5                       WORK REG                         04100003
EXITREG  EQU   5                       EXIT REG - SVC 15/3              04150003
SDRREG   EQU   6                       SDR TABLE ADDRESS                04200003
UCBREG   EQU   7                       UCB ADDRESS                      04250003
R8       EQU   8                       WORK REG (STAT UPDATE)           04300003
BALREG   EQU   8                       BALR RETURN REG                  04350003
R9       EQU   9                       WORK REG                         04400003
SAVREG   EQU   9                       SAVE REG                         04450003
EWAREG   EQU   10                      EXTENDED WORK AREA ADDR          04500003
RETREG   EQU   11                      BALR RETURN REG                  04550003
USEREG   EQU   11                      USER IDAL ADDR                   04600003
R12      EQU   12                      WORK REGISTER                    04650003
R13      EQU   13                      WORK REG                         04700003
TABREG   EQU   13                      SDR TABLE ADDRESS                04750003
LNKREG   EQU   14                      LINK REG                         04800003
XCTLREG  EQU   14                      XCTL ROUTINE ADDRESS             04850003
SDRR14   EQU   14                      WORK REG FOR SDR ADDRESS         04900003
BASREG   EQU   15                      BASE REG                         04950003
         EJECT                                                          05000003
*                                                                       05050003
*                U S E R   C C W   D S E C T                            05100003
*                                                                       05150003
CCW      DSECT                         ERROR CCW IN USER'S CHAIN        05200003
CCWOP    DS    CL1                     CCW COMMAND CODE                 05250003
         ORG   CCWOP                   **                               05300003
CCWADR   DS    CL4                     CCW DATA ADDRESS                 05350003
CCWFLS   DS    CL2                     CCW FLAGS                        05400003
CCWCNT   DS    CL2                     CCW BYTE COUNT                   05450003
*                                                                       05500003
*   CCW REFERENCES                                                      05550003
*                                                                       05600003
CCWIDAL  EQU   X'04'                   IDAL LIST BEING USED             05650003
CCWSILI  EQU   X'20'                   SUPPRESS INCORRECT LENGTH BIT    05700003
*                                                                       05750003
*                U S E R   I D A L   D S E C T                          05800003
*                                                                       05850003
USERIDAL DSECT                         USER IDAL LIST                   05900003
UIDAL    DS    9F                      IDAL ENTRIES                     05950003
*                                                                       06000003
*                 E R P   I D A L   D S E C T                           06050003
*                                                                       06100003
ERPIDAL  DSECT                         ERP IDAL LIST                    06150003
EIDAL    DS    9F                      IDAL ENTRIES                     06200003
         EJECT                                                          06250003
IGE0000I CSECT                                                          06300003
*                                                                       06400003
*                 E   Q   U   A   T   E   S                             06450003
*                                                                       06500003
*   EWACNTR1 - ERROR COUNT 1 REFERENCES                                 06550003
*                                                                       06600003
CLNCNT0  EQU   X'07'                   CLEANER CONTROL COUNT ZERO       06650003
CLNCNT3  EQU   X'03'                   NO. BSRS FOR RB CLEANER          06700003
CLNCNT4  EQU   X'04'                   NO. BSRS FOR RF CLEANER          06750003
OVRCNT5  EQU   X'50'                   OVERRUN COUNT MAXIMUM VALUE      06800003
HEXF8    EQU   X'F8'                   SET CLEANER COUNT TO 0           06850003
HEX88    EQU   X'88'                   SET CLEANER & BUS OUT TO 0       06900003
*                                                                       06950003
*   EWACNTR2 - ERROR COUNT 2 REFERENCES                                 07000003
*                                                                       07050003
X1       EQU   X'01'                   ONE READ ERROR                   07100003
X4       EQU   X'04'                   MULTIPLE OF 4                    07150003
ERGCNT   EQU   X'70'                   ERASE GAP COUNT                  07200003
NUMB15   EQU   X'0F'                   15 RETRIES                       07250003
NUMB40   EQU   X'94'                   40 RETRIES                       07300003
*                                                                       07350003
*   EWACNTR3 - ERROR COUNT 3 REFERENCES (FLAG BITS)                     07400003
*                                                                       07450003
EWTUEX   EQU   X'80'                   UNIT EXCEPTION FLAG              07500003
EWTNB    EQU   X'40'                   NOISE BIT                        07550003
EWTRST   EQU   X'20'                   START FLAG                       07600003
EWTROC   EQU   X'10'                   USE ROR CCW                      07650003
EWTBIT   EQU   X'08'                   COUNTER INCREMENT BIT            07700003
EWTLWR   EQU   X'04'                   LOOP WRITE TO READ FLAG          07750003
EWTEXIT  EQU   X'02'                   TEMPORARY ERROR EXIT FLAG        07800003
EWTDEP   EQU   X'01'                   DEVICE END POST BIT              07850003
*                                                                       07900003
*   EWAFLG3 - FLAG 3 REFERENCES                                         07950003
*                                                                       08000003
EWTROR   EQU   X'80'                   READ OPPOSITE IN PROGRESS        08050003
EWTRTN2  EQU   X'40'                   RETURN FROM LOAD 2               08100003
EWTTPC   EQU   X'20'                   TAPE CLEANING BIT                08150003
EWTBKS   EQU   X'10'                   BACKSPACE ERASE CLEANING FLAG    08200003
EWTOVER  EQU   X'08'                   SDR OVERFLOW                     08250003
EWTPT4A  EQU   X'04'                   ENTRY FOR LOAD 2, PART 4A        08300003
EWTPT4B  EQU   X'02'                   ENTRY FOR LOAD 2, PART 4B        08350003
EWTRBLD  EQU   X'01'                   REBUILD IDAL LIST                08400003
*                                                                       08450003
*   EWA SENSE REFERENCES                                                08500003
*                                                                       08550003
BIRCH    EQU   X'08'                   BYTE 6 & 9 BIRCH TEST   @YL02128 08600003
INVAL    EQU   X'03'                   INVALID CODE                     08650003
NRZIMODE EQU   X'10'                   BYTE 6 NRZI TEST BIT    @YL02128 08700003
SNSTST   EQU   X'F4'                   TEST FOR:  CR,IR,BO,EQ,OR        08750003
TIE      EQU   X'FF'                   TEST FOR TIE BYTE NOT ZERO       08800003
*                                                                       08850003
*   DEB REFERENCES                                                      08900003
*                                                                       08950003
DEBDCB   EQU   24                      DCB POINTER                      09000003
DEBEMU   EQU   4                       EMULATOR BIT                     09050003
DEBMOD   EQU   32                      MODE SET MODIFIER                09100003
DEBOFL   EQU   8                       DEBOFLGS                         09150003
DEBPAR   EQU   16                      PARITY FLIP MASK                 09200003
DEBRER   EQU   X'01'                   REDUCED ERROR RECOVERY BIT       09250003
*                                                                       09300003
*   DCB REFERENCES                                                      09350003
*                                                                       09400003
DCBMOD   EQU   16                      RECORDING TECHNIQUE              09450003
DCBDCF   EQU   X'13'                   DATA CONVERTER FEATURE           09500003
*                                                                       09550003
*   ROR CCW REFERENCES                                                  09600003
*                                                                       09650003
RORSDT   EQU   X'10'                   SUPPRESS DATA TRANSFER BIT       09700003
RORSDT1  EQU   X'14'                   SDT AND IDAL BITS                09750003
RORSILI  EQU   X'20'                   SUPPRESS INCORRECT LENGTH BIT    09800003
ROR0F    EQU   X'0F'                   TURN OFF FLAG BITS               09850003
*                                                                       09900003
*   COMMANDS                                                            09950003
*                                                                       10000003
CMDERG   EQU   X'17'                   ERASE GAP                        10050003
CMDBSR   EQU   X'27'                   BACK SPACE RECORD                10100003
CMDFSR   EQU   X'37'                   FORWARD SPACE RECORD             10150003
CMDRDB   EQU   X'0C'                   READ BACKWARDS                   10200003
CMDSNS   EQU   X'04'                   SENSE COMMAND           @YM07116 10250003
CMDWRT   EQU   X'01'                   WRITE                            10300003
CMDCTL   EQU   X'03'                   CONTROL                          10350003
CMDREW   EQU   X'07'                   REWIND                           10400003
CMDWTM   EQU   X'1F'                   WRITE TAPE MARK                  10450003
CMDRED   EQU   X'02'                   READ                             10500003
CMDTIC   EQU   X'08'                   TIC                              10550003
CMDLWR   EQU   X'8B'                   LOOP WRITE TO READ               10600003
CMDRDF   EQU   X'02'                   READ FORWARD                     10650003
*                                                                       10700003
*   STATUS INDICATORS                                                   10750003
*                                                                       10800003
CSWUCK   EQU   X'02'                   UNIT CHECK                       10850003
CSWCCC   EQU   X'04'                   CHANNEL CONTROL CHECK            10900003
CSWICC   EQU   X'02'                   INTERFACE CONTROL CHECK          10950003
CSWCDC   EQU   X'08'                   CHANNEL DATA CHECK               11000003
CSWCUB   EQU   X'50'                   CU BUSY                          11050003
CSWICL   EQU   X'40'                   INCORRECT LENGTH                 11100003
CSWDVE   EQU   X'04'                   DEVICE END                       11150003
CSWUEX   EQU   X'01'                   UNIT EXCEPTION                   11200003
CSWSTB   EQU   X'39'                   CDC, CHC, PGC, PTC               11250003
         EJECT                                                          11300003
*                                                                       11350003
*   MISCELLANEOUS REFERENCES                                            11400003
*                                                                       11450003
BLKCNT   EQU   12                      BLK COUNT OFFSET FROM DCB        11500003
CDCNT    EQU   7                       CHANNEL DATA CHECK               11550003
CDFULL   EQU   X'0F'                   CHANNEL DATA COUNT FULL          11600003
CHDAT    EQU   X'08'                   CHANNEL DATA CHECK               11650003
CHEND    EQU   X'08'                   CHANNEL END                      11700003
CNTEND   EQU   X'FF'                   END OF COUNTER FLAG              11750003
CNT0     EQU   X'F0'                   RESET CLEANER COUNT TO 0         11800003
CTROK    EQU   X'80'                   FAKE COUNTER INDICATOR           11850003
CVTPTRV  EQU   288                     CVT OFFSET FOR TRANSLATE RTN     11900003
C1       EQU   1                       COUNT OF 1                       11950003
C2       EQU   2                       COUNT OF 2                       12000003
C3       EQU   3                       COUNT OF 3              @Z30AB01 12050003
C4       EQU   4                       COUNT OF 4                       12100003
C5       EQU   5                       COUNT OF 5                       12150003
C6       EQU   6                       COUNT OF 6                       12200003
C7       EQU   7                       COUNT OF 7              @YM07116 12250003
C8       EQU   8                       COUNT OF 8                       12300003
C11      EQU   11                      COUNT OF 11             @YM07116 12350003
C13      EQU   13                      COUNT OF 13                      12400003
C16      EQU   16                      COUNT OF 16                      12450003
C20      EQU   20                      COUNT OF 20                      12500003
C36      EQU   36                      COUNT OF 36                      12550003
C56      EQU   56                      COUNT OF 56                      12600003
C68      EQU   68                      COUNT OF 68                      12650003
C104     EQU   104                     COUNT OF 104                     12700003
C256     EQU   256                     COUNT OF 256                     12750003
C512     EQU   512                     COUNT OF 512                     12800003
ELEVEN   EQU   11                      COUNT OF 11                      12850003
EXCPER   EQU   15                      ERROR EXCP                       12900003
FULL     EQU   X'FF'                   FULL COUNT                       12950003
HEX24    EQU   X'18'                   COUNT OF 24                      13000003
HIBIT    EQU   128                     SET HI-ORDER BIT IN A BYTE       13050003
IOSREP   EQU   X'10'                   REPOSITION TAPE FLAG             13100003
IOSCRC   EQU   X'08'                   CRC FLAG                         13150003
LOAD2    EQU   1009                    LOAD 2 ADDRESS                   13200003
LOC16    EQU   16                      COMMUNICATION TABLE ADDRESS      13250003
ON       EQU   X'80'                   SET HI-ORDER BIT ON              13300003
PARON    EQU   X'01'                   TIE COUNTER PARITY BIT           13350003
RDFULL   EQU   X'F0'                   READ COUNT FULL                  13400003
RETURN   EQU   3                       RETURN - SVC 3                   13450003
ROR      EQU   7                       ROR OFFSET                       13500003
SDRPI    EQU   8                       PE ID BURST SDR COUNT            13550003
SDR20    EQU   X'01'                   20-BYTE SDR FLAG                 13600003
SERLOG   EQU   256                     ADDRESS OF OBR                   13650003
SNSCT    EQU   4                       COUNT OF SENSE BYTES             13700003
STATAB   EQU   112                     STATISTICS TABLE ADDRESS         13750003
STI      EQU   1                       STAT TABLE INDEX                 13800003
VECTXL   EQU   44                      VECTOR TO XCTL ROUTINE           13850003
WORD     EQU   32                      NUMBER OF BITS IN WORD           13900003
WRFULL   EQU   X'0F'                   WRITE COUNT FULL                 13950003
WTORTN   EQU   253                     LOAD NAME TO WTO ROUTINE         14000003
ZERO     EQU   X'00'                   ZERO                             14050003
*                                                                       14100003
*                                                                       14150003
         EJECT                                                          14200003
         USING *,BASREG                                                 14250003
ERP1     B     ER2401A                 BRANCH AROUND DECLARES           14300003
         DC    C'** IGE0000I-TAPE ERP 08-21-74 **'    **                14350003
*                                                                       14400003
*********************************************************************** 14450003
*                        C O N S T A N T S                            * 14500003
*********************************************************************** 14550003
*                                                                       14600003
         DS    0F                      ALIGN                            14650003
MASK     DC    X'0000FFFF'             COMPARE MASK                     14700003
MASK1    DC    X'0000001F'             SDR COUNTER LENGTH MASK          14750003
MASK2    DC    X'0000003F'             SENSE BYTE NUMBER MASK           14800003
SDRCON   DC    X'00000239'             MASK TO CHECK STATUS BITS        14850003
ONE      DC    X'00000001'             COUNT OF 1                       14900003
FOUR     DC    X'00000004'             COUNT OF 4                       14950003
FZERO    DC    X'00000000'             COUNT OF 0                       15000003
F2047    DC    X'000007FF'             COUNT OF 2047                    15050003
ONEPAGE  DC    X'00000800'             COUNT OF 2048                    15100003
EIGHT    DC    AL2(8)                  HALFWORD OF 8                    15150003
TEN      DC    AL2(10)                 HALFWORD OF 10                   15200003
TWELVE   DC    AL2(12)                 HALFWORD OF 12                   15250003
H512     DC    H'512'                  HALFWORD OF 512                  15300003
         EJECT                                                          15350003
*                                                                       15400003
*   STAT UPDATE TABLE                                                   15450003
*                                                                       15500003
         DS    0F                      ALIGN                            15550003
TAB2400  EQU   *                                                        15600003
         DC    X'0480'                 TEMP READS                       15650003
         DC    X'0480'                 TEMP WRITES                      15700003
         DC    X'2400'                 INTERVENTION REQUIRED            15750003
         DC    X'4400'                 BUS OUT                          15800003
         DC    X'6400'                 EQUIPMENT CHECK                  15850003
         DC    X'A400'                 OVERRUN                          15900003
         DC    X'C400'                 WORD COUNT ZERO                  15950003
         DC    X'E400'                 DATA CONVERTER CHECK             16000003
         DC    X'0403'                 R/W VRC                          16050003
         DC    X'2403'                 LRCR                             16100003
         DC    X'4403'                 SKEW                             16150003
         DC    X'6403'                 CRC                              16200003
         DC    X'8403'                 SKEW REG VRC                     16250003
         DC    X'0401'                 NOISE                            16300003
         DC    X'0480'                 ROR                              16350003
         DC    X'0480'                 CHANNEL DATA CHECK               16400003
         DC    X'00FF'                 END                              16450003
*                                                                       16500003
TAB3420  EQU   *                                                        16550003
         DC    X'0880'                 SDR COUNTER FLAG BYTE            16600003
         DC    X'0801'                 NOISE                            16650003
         DC    X'0803'                 R/W VRC                          16700003
         DC    X'2803'                 MTE/LRCR                         16750003
         DC    X'6803'                 EDC/CRC                          16800003
         DC    X'8803'                 ENV CK/VRC                       16850003
         DC    X'A400'                 OVERRUN                          16900003
         DC    X'4403'                 SKEW                             16950003
         DC    X'E403'                 C COMPARE                        17000003
         DC    X'6404'                 WRT TRIG VRC                     17050003
         DC    X'1080'                 PE ID BURST / TIE MASK           17100003
         DC    X'4405'                 WTM CK                           17150003
         DC    X'8405'                 START RD CK                      17200003
         DC    X'A405'                 PARTIAL REC                      17250003
         DC    X'C405'                 EXCESS POSTAMBLE                 17300003
         DC    X'0408'                 IBG DROP IN WRT                  17350003
         DC    X'2408'                 FEED THRU CK                     17400003
         DC    X'4408'                 SPARE                            17450003
         DC    X'6408'                 EARLY BEGIN RD CK                17500003
         DC    X'8408'                 EARLY END RD CK                  17550003
         DC    X'A408'                 SLOW BEGIN RD CK                 17600003
         DC    X'C408'                 SLOW END RD CK                   17650003
         DC    X'E408'                 VELOCITY RETRY                   17700003
         DC    X'0409'                 SPARE                            17750003
         DC    X'2409'                 VELOCITY CHANGE DURING WR        17800003
         DC    X'4409'                 SPARE                            17850003
         DC    X'6409'                 SPARE                            17900003
         DC    X'C803'                 BACKWARD                         17950003
         DC    X'4400'                 BUS OUT CHECK                    18000003
         DC    X'0404'                 ALU HARDWARE ERROR               18050003
         DC    X'00FF'                 END                              18100003
         DS    0F                      ALIGN                            18150003
         EJECT                                                          18200003
*********************************************************************** 18250003
*                          P A R T   1                                * 18300003
*********************************************************************** 18350003
*                                                                     * 18400003
*    THIS IS ENTRY TO THE 2400/3400 SERIES MAG TAPE ERROR ROUTINE     * 18450003
*                                                                     * 18500003
*********************************************************************** 18550003
*                                                                     * 18600003
*    WHEN ENTERED, THE IOSEX AND THE IOSERR FLAGS WILL BE SET TO 1    * 18650003
*    BY THE ERROR ROUTINE.                                            * 18700003
*                                                                     * 18750003
*    ON RETURN, THESE TWO FLAGS SHOULD BE INTERPRETED AS FOLLOWS:     * 18800003
*        IOSEX ON AND IOSERR ON  - ERP IN CONTROL                     * 18850003
*        IOSEX ON AND IOSERR OFF - PERMANENT ERROR                    * 18900003
*        IOSEX OFF AND IOSERR OFF - ERROR CORRECTED                   * 18950003
*                                                                     * 19000003
*********************************************************************** 19050003
*                                                                       19100003
         USING IOSB,IOSREG                                       Y02032 19150003
         USING UCB,UCBREG                                               19200003
         USING EWA,EWAREG                                        Y02032 19250003
         USING CCW,CCWREG                                        Y02032 19300003
         USING UCBMT,UXREG                                       Y02032 19350003
ER2401A  EQU   *                                                        19400003
         L     UCBREG,IOSUCB           GET UCB ADR FROM IOSB     Y02032 19450003
         SH    UCBREG,H512             POINT TO UCB PREFIX       Y02032 19500003
         L     EWAREG,IOSERP           GET EWA ADDR FROM IOSB    Y02032 19550003
         OI    IOSFLA,IOSEX            TURN ON EXCEPTION FLAG    Y02032 19600003
         TM    EWAFLG1,EWABDSNS        TEST FOR SENSE FAILURE  @YM07116 19650003
         BO    A003                    BRANCH ON SENSE FAILURE @YM07116 19700003
*                                                                       19708037
*   TEST FOR ICC OR CCC.  IF ON, GO TO LOAD 2, PART 9          @ZA14752 19716037
*                                                                       19724037
         TM    IOSTSB,CSWCCC+CSWICC    IS ICC OR CCC ON?       @ZA14752 19732037
         BNZ   A2020                   YES - GO TO LOAD 2, PART 9       19740037
         L     CCWREG,IOSCSW-C1        GET CCW ADDRESS         @YM07116 19750003
         LA    CCWREG,0(CCWREG)        ZERO HI-ORDER BYTE      @YM07116 19800003
         SH    CCWREG,EIGHT            POINT TO FAILING CCW    @YM07116 19850003
         LTR   CCWREG,CCWREG           IS ADDRESS MINUS?       @YM07116 19900003
         BM    A003                    BRANCH YES              @YM07116 19950003
         CLI   0(CCWREG),CMDSNS        IS FAILING CCW A SNS    @YM07116 20000003
         BNE   A003                    BRANCH NO               @YM07116 20050003
         TM    IOSCC,IOSCC3            IS COND CODE 3          @YM07116 20100003
         BO    A003                    BRANCH YES              @YM07116 20150003
         TM    IOSCC,IOSCC1            IS COND CODE 1          @YM07116 20200003
         BZ    A001                    BRANCH NO               @YM07116 20250003
         MVC   0(C1,CCWREG),IOSFMSK    MOVE MODE SET TO CCW OP @YM07116 20300003
A001     EQU   *                                                        20350003
         TM    IOSFLA,IOSREP           IS IT ERP REPOSITION?   @YM07116 20400003
         BZ    A002                    BRANCH NO               @YM07116 20450003
         MVC   0(C1,CCWREG),IOSMDB     MOVE REPO OP TO CCW OP  @YM07116 20500003
A002     EQU   *                                                        20550003
         XC    C1(C7,CCWREG),C1(CCWREG) ZERO REST OF CCW       @YM07116 20600003
         MVC   IOSMDM(1),EWTSNS2       MOVE TIE BYTE TO IOSB   @ZA08849 20620003
A003     EQU   *                                                        20650003
         TM    UCBTBYT4,UCB3400        3400 TYPE DEVICE        @YM07116 20700003
         BNO   A004                    NO, BRANCH              @YM07116 20750003
         L     R8,UCBXTN               GET ADDR OF VES COUNTER @YM07116 20800003
         LA    R8,C11(R8)              STEP TO MODE SET BYTE   @YM07116 20850003
         MVC   0(C1,R8),IOSFMSK        MOVE IN MODE SET        @YM07116 20900003
*                                                                       20950003
*   CHECK FOR UNSOLICITED DEVICE END OR IOB INTERCEPT                   21000003
*                                                                       21050003
A004     EQU   *                                                        21100003
         TM    IOSFLC,IOSVERIF         UNSOLICITED DEVICE END    Y02032 21150003
         BO    A2020                   YES - XCTL TO LOAD 2             21200003
         CLI   IOSCOD,IOSFINTC         IOB INTERCEPT?            Y02032 21250003
         BE    A2020                   YES - XCTL TO LOAD 2             21300003
*                                                                       21350003
*   GET SDR TABLE ADDRESS                                               21400003
*                                                                       21450003
BEGIN    EQU   *                                                        21500003
         LA    R13,C512(UCBREG)        POINT TO UCB BASE                21550003
         L     R8,LOC16                GET ADDRESS OF CVT               21600003
         L     R8,STATAB(R8)           ADDRESS OF SDR TABLE             21650003
         SR    R9,R9                   ZERO WORK REG                    21700003
         L     R4,UCBEXTPT             GET ADDR OF UCB COMMON EXTN.     21750003
         LA    R4,0(R4)                GET 3-BYTE ADDRESS               21800003
         IC    R9,STI(R4)              GET INDEX                        21850003
         LR    SDRREG,R8               SAVE SDR TABLE ADDRESS           21900003
A005     EQU   *                                                        21950003
         CLM   R13,C3,0(R8)            SDR AREA SECTION?       @Z30AB01 22000003
         BNH   A010                    YES-GET OUT OF LOOP     @Z30AB01 22050003
         LA    R8,C2(R8)               INCREMENT TO NEXT SECTION        22100003
         LA    R9,C256(R9)             STEP INDEX                       22150003
         B     A005                    NOT FOUND - LOOP AGAIN           22200003
A010     EQU   *                                                        22250003
         MH    R9,TEN                  TIMES 10                         22300003
         AR    SDRREG,R9               ENTRY FOR THIS UNIT              22350003
         EJECT                                                          22400003
*                                                                       22450003
*   SET UP REMAINING ADDRESSES                                          22500003
*                                                                       22550003
*   IF THIS IS AN EXCP REQUEST, WE GET THE DEB ADDRESS FROM THE         22600003
*   RQE AND THE DCB ADDRESS FROM THE DEB, OTHERWISE THEY ARE ZERO       22650003
*                                                                       22700003
         CLI   IOSDVRID,IOSXCPID       WAS THIS AN EXCP REQUEST? Y02032 22750003
         BNE   A015                    NO-GO ZERO ADDRESS FIELDS Y02032 22800003
         L     R13,IOSUSE              YES-GET RQE ADR FROM IOSB Y02032 22850003
         L     R13,C8(R13)             GET DEB ADR FROM RQE      Y02032 22900003
         ST    R13,EWTDEB              SAVE DEB ADR IN EWA       Y02032 22950003
         L     R13,DEBDCB(R13)         GET DCB ADR FROM DEB      Y02032 23000003
         ST    R13,EWTDCB              STORE IN EWA SAVE AREA    Y02032 23050003
         B     A020                    GO GET REMAINING ADDR.    Y02032 23100003
A015     EQU   *                                                        23150003
         SR    R13,R13                 ZERO WORK REG             Y02032 23200003
         ST    R13,EWTDEB              ZERO DEB ADDRESS          Y02032 23250003
         ST    R13,EWTDCB              ZERO DCB ADDRESS          Y02032 23300003
*                                                                       23350003
A020     EQU   *                                                        23400003
         L     UXREG,UCBXTN            GET ADR OF UCB EXTENSION  Y02032 23450003
         LA    UXREG,0(UXREG)          GET 3-BYTE ADDRESS               23500003
         LA    EXITREG,RETN            GET ERROR EXCP ADDR - SVC 15/3   23550003
*                                                                       23600003
         L     CCWREG,IOSCSW-C1        GET CCW ADDR FROM STATUS         23650003
         LA    CCWREG,0(CCWREG)        GET 3-BYTE ADDRESS               23700003
         SH    CCWREG,EIGHT            SUBTRACT 8                       23750003
         LTR   CCWREG,CCWREG           NEGATIVE ADDRESS?                23800003
         BM    A1000                   YES - SET X'4B' & GO TO LOAD 2   23850003
*                                                                       23900003
         TM    EWACNTR3,EWTEXIT        IS TEMP EXIT BIT ON?             23950003
         BO    D130                    YES - GO UPDATE COUNTERS         24000003
*                                                                       24050003
*   TEST FOR FIRST ENTRY INTO LOAD 1                                    24100003
*   DO STAT UPDATE IF FIRST ENTRY                                       24150003
*                                                                       24200003
A100     EQU   *                                                        24250003
         TM    IOSFLA,IOSERR           FIRST ENTRY TO ERP        S21048 24300003
         BO    A120                    NO - DON'T DO STAT UPDATE S21048 24350003
*                                                                       24400003
         NI    EWAFLG3,X'FF'-EWTOVER   ZERO SDR OVERFLOW       @ZA27822 24420037
         XC    EWTIDAL(C68),EWTIDAL    SET EWT WORK AREA TO 0    Y02032 24450003
         XC    EWTRRCCW(C8),EWTRRCCW   SET EWT WORK AREA TO 0    Y02032 24500003
         XC    EWTRES(C16),EWTRES      SET EWT WORK AREA TO 0  @ZA05117 24550003
*                                                                       24600003
         OI    IOSFLA,IOSEX+IOSERR     SET ERP IN CONTROL               24650003
         TM    IOSOPT,IOSDEP           DEVICE END POST BIT ON?   Y02032 24700003
         BZ    A105                    NO - LEAVE DEP SAVE BIT OFF      24750003
         OI    EWACNTR3,EWTDEP         YES - TURN ON DEP SAVE BIT       24800003
*                                                                       24850003
*   GO TO PART 5 TO DO STAT UPDATE IF ANY OF THE FOLLOWING ARE ON:      24900003
*        UNIT CHECK                                                     24950003
*        PROGRAM CHECK                                                  25000003
*        PROTECTION CHECK                                               25050003
*        CHANNEL DATA CHECK                                             25100003
*        CHAINING CHECK                                                 25150003
*                                                                       25200003
A105     EQU   *                                                        25250003
         LH    R0,IOSTATUS             GET STATUS                       25300003
         N     R0,SDRCON               ANY BITS ON?              S21048 25350003
         BNZ   PART5                   YES - GO TO STAT UPDATE   S21048 25400003
*                                                                       25450003
*                                                                       25500037
A120     EQU   *                                                        25600037
*                                                                       25750003
         TM    EWAFLG3,EWTROR          TEST FOR READ OPPOSITE    Y02032 25800003
         BO    PART3                   YES - BRANCH TO PART 3, ROR      25850003
*                                                                       25900003
         TM    EWACNTR3,EWTLWR         WAS LOOP WRITE TO READ DONE?     25950003
         BNO   A130                    NO - GO CHECK REPOSITION         26000003
*                                                                       26050003
         NI    EWACNTR3,X'FF'-EWTLWR   RESET LWR FLAG                   26100003
         L     R13,EWTVIRT             GET ADDR OF USER CCW      Y02032 26150003
         ST    R13,IOSVST              RESTORE START ADR (VIRT)  Y02032 26200003
         LRA   R13,0(R13)              GET REAL ADDRESS          Y02032 26250003
         ST    R13,IOSRST              RESTORE START ADR (REAL)  Y02032 26300003
         B     A600                    GO BACKSPACE/ERASE GAP    Y02032 26350003
*                                                                       26400003
A130     EQU   *                                                        26450003
         TM    IOSFLA,IOSREP           WAS TAPE BEING REPOSITIONED?     26500003
         BZ    A170                    NO - GO CONTINUE CHECKS          26550003
         EJECT                                                          26600003
*                                                                       26650003
*   R E P O S I T I O N I N G                                           26700003
*                                                                       26750003
A145     EQU   *                                                        26800003
         TM    IOSTSA,CSWUCK           TEST FOR ERROR ON REPOSITION     26850003
         BZ    A150                    NO - BR AROUND LOAD 2 TEST       26900003
*                                                                       26950003
*                                                                       27070037
*   ERROR ON REPOSITIONING - TEST FOR RETURN FROM LOAD 2                27080037
*                                                                       27090037
A145A    TM    EWAFLG3,EWTRTN2         RETURN FROM LOAD 2?       Y02032 27100037
         BO    A160                    YES - GO CHK FOR CLEAN OR ERASE  27150003
         B     A2020                   NO  - XCTL TO LOAD 2             27200003
*                                                                       27250003
A150     EQU   *                                                        27300003
         TM    IOSTSA,CSWCUB           CONTROL UNIT BUSY?               27350003
         BCR   1,EXITREG               YES - RESTART, SVC 15/3          27400003
*                                                                       27450003
A160     NI    EWAFLG3,X'FF'-EWTRTN2   RESET LOAD 2 SWITCH       Y02032 27500003
*                                                                       27550003
*   TEST FOR TAPE CLEAN OR TAPE ERASE                                   27600003
*                                                                       27650003
         TM    EWAFLG3,EWTTPC+EWTBKS   IS THIS CLEANING OR ERASE?       27700003
         BC    5,A400                  YES - BRANCH                     27750003
         TM    EWACNTR1,CLNCNT0        IS CLEANER CONTROL COUNT ZERO?   27800003
         BC    5,C485                  NO - SVC 15/3                    27850003
*                                                                       27900003
A165     EQU   *                                                        27950003
         NI    IOSFLA,X'FF'-IOSREP     SET TAPE REPOSITION BIT OFF      28000003
*                                                                       28050003
*   RESTORE DEVICE END POST BIT                                         28100003
*                                                                       28150003
A166     TM    EWACNTR3,EWTDEP         WAS ORIGINAL DEV END POST ON?    28200003
         BO    A168                    YES - LEAVE IT ON                28250003
         NI    IOSOPT,X'FF'-IOSDEP     NO - TURN IT OFF                 28300003
A168     EQU   *                                                        28350003
         BR    EXITREG                 GO RETRY - SVC 15/3              28400003
         EJECT                                                          28450003
*                                                                       28500003
*   N O T   R E P O S I T I O N I N G                                   28550003
*                                                                       28600003
A170     EQU   *                                                        28650003
         NI    IOSFLA,X'FF'-IOSCRC     TURN OFF CRC                     28700003
*                                                                       28750003
*   TEST FOR INITIAL SELECTION                                          28800003
*                                                                       28850003
         TM    IOSCC,IOSCC3            SIO CONDITION CODE = 3?          28900003
         BO    A570                    YES - GO XCTL TO WTO             28950003
         BM    A210                    BR IF COND CODE = 1 (INIT SEL)   29000003
*                                                                       29050003
*   TEST FOR CHAINING                                                   29100003
*                                                                       29150003
         TM    IOSFLA,IOSACHN          DATA OR COMMAND CHAINING?        29200003
         BZ    A200                    NEITHER - GO SET REP DIRECTION   29250003
         BO    A525                    BOTH - GO EXIT ERP               29300003
*                                                                       29350003
*   DATA CHAINING OR COMMAND CHAINING                                   29400003
*                                                                       29450003
         TM    IOSFLA,IOSCCHN          COMMAND CHAINING?                29500003
         BO    A180                    YES - BR AROUND DATA CHAINING    29550003
*                                                                       29600003
*   DATA CHAINING ONLY - START AT TOP OF CHANNEL PROGRAM                29650003
*                                                                       29700003
         L     CCWREG,IOSVST           GET START ADDRESS (VIRTUAL)      29750003
         B     A200                    GO SET DIRECTION                 29800003
*                                                                       29850003
*   COMMAND CHAINING                                                    29900003
*                                                                       29950003
A180     TM    EWACNTR3,EWTRST         FIRST ENTRY (START FLAG OFF)?    30000003
* *                                                                     30050037
*   SAVE ORIGINAL FAILING CCW ADDRESS IN CASE OF MULTIPLE               30070037
*   FAILURES IN THE SAME CCW CHAIN.                                     30090037
**                                                                      30110037
         BNE   A181                    NO, BRANCH AROUND      @ZA16828  30130037
         ST    CCWREG,EWADCNT          SAVE CCW ORIGINAL CCW  @ZA16828  30150037
         B     A190                    GO SET RESTART         @ZA16828  30170037
*                                                                       30190037
*   NOT FIRST ENTRY                                                     30210037
*                                                                       30230037
A181     NI    IOSMDB,ZERO             CLEAR MOD BYTE                   30250037
         LR    R13,CCWREG              SET WORK REG TO CCW ADDRESS      30300003
         S     R13,IOSVST              COMPARE TO RESTART ADDRESS       30350003
         BZ    A200                    EQUAL - BRANCH TO SET DIRECTION  30400003
*                                                                       30450003
*   COMMAND CHAINING AND CHAIN BROKE IN DIFFERENT PLACE                 30500003
*                                                                       30550003
         XC    EWACNTR1(C2),EWACNTR1   CLEAR ERROR COUNTS        Y02032 30600003
A190     EQU   *                                                        30650003
         OI    EWACNTR3,EWTRST         SET RESTART FLAG          Y02032 30700003
         ST    CCWREG,IOSVST           SET ADDRESS TO RESTART           30750003
         LRA   R13,CCW                 TRANSLATE VIRT START ADDR Y02032 30800003
         ST    R13,IOSRST              STORE IN REAL START ADDR  Y02032 30850003
*                                                                       30900003
*   SET REPOSITION DIRECTION FOR ALL READ/WRITE ERRORS                  30950003
*                                                                       31000003
A200     EQU   *                                                        31050003
         LTR   CCWREG,CCWREG           NEGATIVE ADDRESS?         A29974 31100003
         BM    A1000                   YES - SET X'4B' & GO TO LOAD 2   31150003
         MVI   IOSMDB,CMDBSR           SET TO BACKSPACE          A29974 31200003
         CLI   CCWOP,CMDRDB            IS IT READ BACK?                 31250003
         BNE   A210                    NO - LEAVE BSR                   31300003
         MVI   IOSMDB,CMDFSR           SET TO FORWARD SPACE             31350003
*                                                                       31400003
*   TEST FOR UNIT CHECK                                                 31450003
*                                                                       31500003
A210     EQU   *                                                        31550003
         TM    IOSTSA,CSWUCK           UNIT CHECK?                      31600003
         BO    A220                    YES - GO TEST SENSE              31650003
         CLI   IOSTSA,CSWCUB           IS CONTROL UNIT BUSY?            31700003
         BNE   PART4                   NO - GO TEST CSW, PART 4         31750003
         BR    EXITREG                 ERROR EXCP - SVC 15/3            31800003
         EJECT                                                          31850003
*                                                                       31900003
*                        U N I T   C H E C K                            31950003
*                                                                       32000003
*   TEST SENSE BITS ACCORDING TO PRIORITY                               32050003
*                                                                       32100003
A220     EQU   *                                                        32150003
         TM    EWTSNS0,SNSTST          PRIORITY TEST OF SENSE    Y02032 32200003
*                                      CR, IR, BO, EQ, OR               32250003
         BC    5,A2010                 ANY OR ALL TO LOAD 2, PART 4     32300003
         TM    EWTSNS1,EWTLP           BACKED INTO LOAD POINT ON READ?  32350003
         BO    A2010                   YES - BRANCH TO LOAD 2, PART 4   32400003
         TM    EWTSNS0,EWTDATA         DATA CHECK?               Y02032 32450003
         BO    A230                    YES - BR AROUND CHANNEL DATA CK  32500003
*                                                                       32550003
*   TEST FOR CHANNEL DATA CHECK                                         32600003
*                                                                       32650003
         TM    IOSTSB,CSWCDC           CHANNEL DATA CHECK?              32700003
         BO    A2000                   YES - BR TO LOAD 2, PART 4B      32750003
         TM    EWTSNS5,EWTPEID         IS IT PE ID CHECK         Y02032 32800003
         BNO   A2010                   NO - BR TO LOAD 2, PART 4        32850003
*                                                                       32900003
*                         D A T A   C H E C K                           32950003
*                                                                       33000003
A230     EQU   *                                                        33050003
         TM    CCWOP,CMDWRT            WRITE OR CONTROL?         A29974 33100003
         BO    A580                    YES - GO CHECK 15 RETRIES        33150003
*                                                                       33200003
*   TEST NOISE BIT                                                      33250003
*   ALWAYS ON FOR PE, INDICATING THAT IT IS NOT A NOISE BLOCK           33300003
*                                                                       33350003
         TM    EWTSNS1,EWTNOISE        NOISE BIT ON?             Y02032 33400003
         BO    A260                    YES - CHECK FOR RETRIES          33450003
*                                                                       33500003
*   CHECK BLOCK LENGTH FOR SHORT BLOCK                                  33550003
*                                                                       33600003
         TM    IOSFLA,IOSDCHN          DATA CHAINING?                   33650003
         BZ    A250                    NO - GO CHECK RESIDUAL           33700003
*                                                                       33750003
*   TEST FOR NOISE WHEN DATA CHAINING.  CCWREG IS START ADDRESS         33800003
*                                                                       33850003
         LA    CCWREG,CCWADR           GET ADDRESS ONLY (START)         33900003
         L     R13,IOSCSW-C1           GET INTERRUPT + 8                33950003
         LA    R13,0(R13)              GET ADDRESS ONLY                 34000003
         SH    R13,EIGHT               SUBTRACT 8                       34050003
         CR    CCWREG,R13              ERROR ON FIRST CCW?              34100003
         BL    A260                    NO - BR AROUND NOISE TEST        34150003
         CLC   CCWCNT,TWELVE           1ST CCW COUNT GREATER THAN 11?   34200003
         BL    A2020                   NO - NOISE BLOCK, BR TO LOAD 2   34250003
*                                                                       34300003
*   TEST COUNT - RESIDUAL FOR NOISE BLOCK                               34350003
*                                                                       34400003
A250     EQU   *                                                        34450003
         LH    R13,CCWCNT              GET CCW COUNT                    34500003
         SH    R13,IOSCSWRC            LESS RESIDUE IN CSW              34550003
         N     R13,MASK                ZERO HIGH ORDER BITS             34600003
         SH    R13,TWELVE              SUBTRACT MINIMUM SIZE            34650003
         BM    A2020                   SHORT BLOCK - GO TO LOAD 2       34700003
*                                                                       34750003
*   TEST IF TAPE CLEANING TO BE USED                                    34800003
*                                                                       34850003
A260     EQU   *                                                        34900003
         L     R13,EWTDEB              GET DEB ADDR              Y02032 34950003
         CL    R13,FZERO               VALID DEB ADDR?           Y02032 35000003
         BE    A270                    NO - SKIP EMULATOR        Y02032 35050003
         TM    DEBOFL(R13),DEBEMU      IS EMULATOR BIT ON?              35100003
         BZ    A270                    NO - BR AROUND PARITY FLIP       35150003
         XI    DEBMOD(R13),DEBPAR      YES - FLIP PARITY                35200003
         MVC   IOSFMSK(1),DEBMOD(R13)  PUT MODESET TO IOSB     @ZA05130 35210003
A270     EQU   *                                                        35250003
         TM    EWACNTR2,X4             IS THIS A MULTIPLE OF 4?  Y02032 35300003
         BZ    A300                    NO - CONTINUE                    35350003
*                                                                       35400003
*   IS REDUCED ERROR RECOVERY SPECIFIED?                                35450003
*                                                                       35500003
         CL    R13,FZERO               VALID DEB ADDR?           Y02032 35550003
         BE    A280                    NO - SKIP RER             Y02032 35600003
         TM    DEBOFL(R13),DEBRER      IS RER BIT ON?                   35650003
         BZ    A280                    NO - CONTINUE                    35700003
         BAL   RETREG,A575             YES-GO UPDATE PR VES COUNTER     35750003
*                                                                       35800003
*   PERMANENT ERROR EXIT                                                35850003
*                                                                       35900003
A275     EQU   *                                                        35950003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA SET PERM ERR EXIT   @YM06412 36000003
         BR    EXITREG                 EXIT VIA SVC 15/3                36050003
         EJECT                                                          36100003
*                                                                       36150003
*                       C L E A N I N G                                 36200003
*                                                                       36250003
*   NOT REDUCED ERROR RECOVERY - TEST FOR LAST READ RETRY               36300003
*                                                                       36350003
A280     EQU   *                                                        36400003
         TM    EWACNTR2,NUMB40         40TH RETRY?                      36450003
         BO    PART3                   YES - BRANCH TO PART 3, ROR      36500003
*                                                                       36550003
*   THIS SECTION IS ENTERED EVERY 4TH RETRY ON A READ ERROR TO          36600003
*   PERFORM A CARRY OPERATION AND INITIATE TAPE CLEANING                36650003
*                                                                       36700003
         LH    R13,UCBCLN              GET ESV CLEANER COUNT            36750003
         CH    R13,MASK+C2             IS COUNTER FULL?                 36800003
         BE    A290                    YES - BR AROUND INCREMENT        36850003
         LA    R13,C1(R13)             ADD ONE TO COUNT                 36900003
         STH   R13,UCBCLN              STORE UPDATED COUNT              36950003
*                                                                       37000003
*   INCREMENT READ DATA CHECK COUNT                                     37050003
*                                                                       37100003
A290     EQU   *                                                        37150003
         SR    R13,R13                 ZERO REGISTER                    37200003
         IC    R13,EWACNTR2            GET ERROR COUNT                  37250003
         LA    R13,C13(R13)            PERFORM CARRY                    37300003
         STC   R13,EWACNTR2            STORE UPDATED COUNT       Y02032 37350003
         OI    EWAFLG3,EWTTPC          SET TAPE CLEAN BIT        Y02032 37400003
         OI    IOSFLA,IOSREP+IOSCRC    SET REPOSITION AND CRC FLAGS     37450003
         OI    IOSOPT,IOSDEP           SET DEVICE END POST BIT   Y02032 37500003
*                                                                       37550003
*   SET UP FOR BACK SPACES (4 IF RDF, 3 IF RDB)                         37600003
*                                                                       37650003
         OI    EWACNTR1,CLNCNT4        ASSUME READ FORWARD       Y02032 37700003
         CLI   CCWOP,CMDRDB            READ BACKWARDS?                  37750003
         BCR   7,EXITREG               NO - SVC 15/3                    37800003
         NI    EWACNTR1,CNT0           SET COUNT TO ZERO         Y02032 37850003
         OI    EWACNTR1,CLNCNT3        SET COUNT TO 3            Y02032 37900003
         OI    EWAFLG3,EWTBKS          SET BACKSPACE ERASE FLAG  Y02032 37950003
         MVI   IOSMDB,CMDBSR           SET BSR COMMAND                  38000003
         BR    EXITREG                 EXIT - SVC 15/3                  38050003
*                                                                       38100003
*   N O   C L E A N I N G                                               38150003
*                                                                       38200003
A300     EQU   *                                                        38250003
         MVI   EWTRRCMD,ZERO           ZERO ROR COMMAND                 38300003
         OI    IOSFLA,IOSREP+IOSCRC    SET TAPE REPOSITION & CRC        38350003
         OI    IOSOPT,IOSDEP           SET DEVICE END POST BIT   Y02032 38400003
         IC    R13,EWACNTR2            GET CURRENT COUNT         Y02032 38450003
         LA    R13,C1(R13)             ADD ONE TO COUNT                 38500003
         STC   R13,EWACNTR2            STORE UPDATED COUNT       Y02032 38550003
         BR    EXITREG                 GO REPOSITION - SVC 15/3         38600003
*                                                                       38650003
*   NOT DATA CHECK ON READ - CHECK SENSE                                38700003
*                                                                       38750003
A400     EQU   *                                                        38800003
         TM    EWAFLG3,EWTTPC          IS TAPE CLEANING USED?    Y02032 38850003
         BO    A510                    YES - GO TEST FOR END OF CLEANER 38900003
         NI    EWAFLG3,X'FF'-EWTBKS    SET BKS ERASE FLAG OFF    Y02032 38950003
         MVI   IOSMDB,CMDERG           SET CONTROL COMMAND TO ERASE     39000003
         BR    EXITREG                 TO ERROR EXCP - SVC 15/3         39050003
*                                                                       39100003
*   TEST FOR END OF CLEANER BSR (DECREMENT COUNT OR SET FSR)            39150003
*                                                                       39200003
A510     EQU   *                                                        39250003
         TM    EWACNTR1,CLNCNT0        IS CLEANER CTL COUNT ZERO?       39300003
         BC    5,C485                  NO - DECREMENT COUNT, SVC 15/3   39350003
         MVI   IOSMDB,CMDFSR           SET CONTROL COMMAND TO FSR       39400003
         OI    EWACNTR1,CLNCNT3        SET CONTROL COUNT TO 3    Y02032 39450003
         TM    EWAFLG3,EWTBKS          IS BACKSPACE ERASE FLAG ON?      39500003
         BZ    A520                    NO - GO RESET CONTROL FLAGS      39550003
*                                                                       39600003
         NI    EWACNTR1,HEXF8          SET COUNT TO 0            Y02032 39650003
         OI    EWACNTR1,CLNCNT4        SET COUNT TO 4            Y02032 39700003
*                                                                       39750003
A520     EQU   *                                                        39800003
         NI    EWAFLG3,X'FF'-EWTTPC-EWTBKS   CLEAR FLAGS         Y02032 39850003
         BR    EXITREG                 EXIT VIA SVC 15/3                39900003
         EJECT                                                          39950003
*                                                                       40000003
*                L O G O U T                                            40050003
*                                                                       40100003
A525     EQU   *                                                        40150003
         TM    CCWOP,CMDWRT            WRITE OR CONTROL?                40200003
         BO    A530                    YES-GO UPDATE PW VES CNTR        40250003
         BAL   RETREG,A575             NO-GO UPDATE PR VES CONTR        40300003
         B     A560                    GO LOG OUT                       40350003
*                                                                       40400003
*   UPDATE PERMANENT WRITE VES COUNTER                                  40450003
*                                                                       40500003
A530     EQU   *                                                        40550003
         TM    UCBPW,FULL              IS PERM. WRITE COUNT FULL?       40600003
         BO    A560                    YES - SKIP UPDATE                40650003
         IC    R4,UCBPW                NO - GET PERM WRITE COUNT        40700003
         LA    R4,C1(R4)               ADD ONE TO COUNT                 40750003
         STC   R4,UCBPW                STORE BACK                       40800003
*                                                                       40850003
*   SET MESSAGE BIT                                                     40900003
*                                                                       40950003
A560     EQU   *                                                        41000003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA  SET PERM ERR EXIT  @YM06412 41050003
         OI    IOSFLB,IOSMSG+IOSLOG    SET MESSAGE TYPE & LOGOUT        41100003
**                                                                      41103037
*   RESTORE ORIGINAL FAILING CCW ADDRESS                                41106037
**                                                                      41109037
         TM    IOSFLA,IOSCCHN          COMMAND CHAINING ?     @ZA16828  41112037
         BNO   A570                    NO, BRANCH AROUND      @ZA16828  41115037
         L     R13,EWADCNT             GET FIRST FAILING CCW  @ZA16828  41118037
         LTR   R13,R13                 CCW POINTER ZERO ?     @ZA16828  41121037
         BZ    A570                    YES, BRANCH AROUND     @ZA16828  41124037
         LA    R13,0(R13)              ZERO HIGH ORDER BYTES  @ZA16828  41127037
         ST    R13,IOSVST              RESTORE VIRTUAL START  @ZA16828  41130037
         LRA   R13,0(R13)              GET REAL ADDRESS       @ZA16828  41133037
         ST    R13,IOSRST              RESTORE REAL START     @ZA16828  41136037
A570     EQU   *                                                        41150003
         LA    R13,WTORTN              LOAD WTO ADDRESS                 41200003
         B     XCTL1                   XCTL TO WTO                      41250003
*                                                                       41300003
*   UPDATE PERMANENT READ VES COUNTER                                   41350003
*                                                                       41400003
A575     EQU   *                                                        41450003
         TM    UCBPR,FULL              IS READ COUNT FULL?              41500003
         BO    A577                    YES - SKIP UPDATE                41550003
         IC    R4,UCBPR                GET PERM READ COUNT              41600003
         LA    R4,C1(R4)               ADD ONE TO COUNT                 41650003
         STC   R4,UCBPR                STORE BACK                       41700003
A577     BR    RETREG                  RETURN                           41750003
         EJECT                                                          41800003
*                                                                       41850003
*                  D A T A   C H E C K                                  41900003
*                                                                       41950003
*                   WRITE OR CONTROL                                    42000003
*                                                                       42050003
A580     EQU   *                                                        42100003
         TM    EWACNTR2,NUMB15         15 RETRIES?               Y02032 42150003
         BO    A530                    YES - BRANCH TO PERM ERROR       42200003
*                                                                       42250003
         IC    R13,EWACNTR2            GET ERROR COUNT           Y02032 42300003
         LA    R13,C1(R13)             ADD ONE TO COUNT                 42350003
         STC   R13,EWACNTR2            STORE UPDATED COUNT       Y02032 42400003
         TM    EWACNTR2,NUMB15         14 RETRIES?               Y02032 42450003
         BO    A620                    YES - BR TO LOOP WR/RD    S21048 42500003
*                                                                       42550003
         TM    CCWOP,CMDCTL            IS THIS A CONTROL COMMAND?       42600003
         BNO   A585                    NO - GO TEST PE ID BURST         42650003
*                                                                       42700003
         CLI   CCWOP,CMDWTM            IS CTL COMMAND A WTM?            42750003
         BE    A585                    YES - GO TEST PE ID BURST        42800003
*                                                                       42850003
         TM    EWTSNS5,EWTPEID         IS IT PE ID BURST?        Y02032 42900003
         BO    A587                    YES - GO SET TO REWIND           42950003
*                                                                       43000003
*   ERG DATA CHECK - CHECK FOR 4 (3 RETRIES)                            43050003
*                                                                       43100003
         TM    EWACNTR2,CLNCNT4        HAD 3 RETRIES?            Y02032 43150003
         BCR   14,EXITREG              NO - RETRY, SVC 15/3             43200003
         B     A530                    YES - PERM ERROR, GO WRITE MSG   43250003
*                                                                       43300003
A585     EQU   *                                                        43350003
         TM    EWTSNS5,EWTPEID         PE ID BURST CHECK?        Y02032 43400003
         BZ    A600                    NO - GO CHECK FOR REWIND  S21048 43450003
A587     EQU   *                                                        43500003
         MVI   IOSMDB,CMDREW           SET REWIND COMMAND        S21048 43550003
A590     EQU   *                                                        43600003
         OI    IOSFLA,IOSREP           SET REPOSITION BIT               43650003
         OI    IOSOPT,IOSDEP           SET DEVICE END POST BIT   Y02032 43700003
A595     EQU   *                                                        43750003
         BR    EXITREG                 GO REWIND/RETRY - SVC 15/3       43800003
*                                                                       43850003
*   SET FOR ERG AND REPOSITION                                          43900003
*                                                                       43950003
A600     EQU   *                                                        44000003
         CLI   IOSMDB,CMDREW           WAS COMMAND A REWIND?     S21048 44050003
         BE    A610                    YES-BR AROUND ERASE LOGIC S21048 44100003
*                                                                       44150003
         OI    EWAFLG3,EWTBKS          SET BACKSPACE ERASE FLAG  Y02032 44200003
         NI    EWACNTR2,X'FF'-ERGCNT   RESET ERG D.C. COUNT      Y02032 44250003
         LH    R13,UCBERG              GET ERG COUNT                    44300003
         CH    R13,MASK+C2             IS COUNT FULL?                   44350003
         BE    A610                    YES - BR AROUND ERG COUNTER      44400003
*                                                                       44450003
         LA    R13,C1(R13)             ADD ONE TO COUNT                 44500003
         STH   R13,UCBERG              STORE UPDATED COUNT              44550003
A610     EQU   *                                                        44600003
         TM    EWACNTR3,EWTROC         ROR COMMAND IN USE?       Y02032 44650003
         BZ    A590                    NO - GO SET REP, SVC 15/3 S21048 44700003
*                                                                       44750003
         NI    EWACNTR3,X'FF'-EWTROC   RESET USE ROR COMMAND     Y02032 44800003
         TM    IOSTSA,CSWUCK           IS UNIT CHECK ON?         M0907  44850003
         BZ    A590                    NO - GO RETRY             A52064 44900003
*                                                                       44950003
         OI    IOSFLA,IOSREP           SET REPOSITION BIT        Y02032 45000003
         OI    IOSOPT,IOSDEP           SET DEVICE END POST BIT   Y02032 45050003
         OI    EWAFLG3,EWTOVER         SET SDR OVERFLOW FLAG ON  Y02032 45100003
         LA    R13,SERLOG              GET ADDRESS OF OBR        S21048 45150003
         B     XCTL1                   GO TO OBR                        45200003
*                                                                       45250003
A620     EQU   *                                                        45300003
         CLI   CCWOP,CMDWRT            IS COMMAND A WRITE?       S21048 45350003
         BNE   A585                    NO - GO TEST FOR PE ID BURST     45400003
*                                                                       45450003
         TM    UCBTBYT4,UCB3400        3400 TAPE UNIT?           S21048 45500003
         BNO   A585                    NO - GO TEST FOR PE ID BURST     45550003
*                                                                       45600003
*   SET LOOP WRITE TO READ                                              45650003
*                                                                       45700003
         MVC   EWTRRCCW,CCW            MOVE IN USER CCW          S21048 45750003
         MVI   EWTRRCMD,CMDLWR         SET LOOP WRT/RD OP CODE   S21048 45800003
         OI    EWACNTR3,EWTLWR         SET LOOP WRITE TO READ FLAG      45850003
         OI    EWTRRFLS,RORSILI        SUPPRESS INCORRECT LENGTH Y02032 45900003
         NI    EWTRRFLS,X'FF'-IOSACHN  TURN OFF CHAINING FLAGS          45950003
         OI    EWACNTR3,EWTROC         SET USE ROR COMMAND       S21048 46000003
*                                                                       46050003
*   SET UP RORCCW ADDRESS FOR IOS                                       46100003
*                                                                       46150003
         MVC   EWTVIRT,IOSVST          SAVE START ADDR (VIRT)           46200003
         LA    R13,EWTRRCCW            GET ADDR OF RORCCW (VIRT)        46250003
         ST    R13,IOSVST              STORE IOSB VIRT START ADDR       46300003
         LRA   R13,EWTRRCCW            GET ADDR OF RORCCW (REAL)        46350003
         ST    R13,IOSRST              STORE IOSB REAL START ADDR       46400003
*                                                                       46450003
         TM    EWTSNS5,EWTPEID         PE ID BURST CHECK?        S21048 46500003
         BZ    A595                    NO  - GO SVC 15/3                46550003
         MVI   IOSMDB,CMDREW           SET REWIND COMMAND        S21048 46600003
         BR    EXITREG                 GO REWIND - SVC 15/3             46650003
         EJECT                                                          46700003
A1000    EQU   *                                                        46750003
         MVI   IOSCOD,IOSTAPEC         X'4B' IN IOB ECB CODE     A29974 46800003
*                                      INDICATES ERP ERROR              46850003
         B     A2020                   GO TO LOAD 2, PART 1             46900003
*                                                                       46950003
*   TRANSFER CONTROL TO LOAD 2                                          47000003
*                                                                       47050003
A2000    EQU   *                                                        47100003
         OI    EWAFLG3,EWTPT4B         SET UP FOR ENTRY TO PART 4B      47150003
         B     A2020                   GO TO LOAD 2                     47200003
A2010    EQU   *                                                        47250003
         OI    EWAFLG3,EWTPT4A         SET UP FOR ENTRY TO PART 4A      47300003
A2020    EQU   *                                                        47350003
         LA    R13,LOAD2               GET LOAD 2 ADDRESS               47400003
         B     XCTL4                   GO XCTL                          47450003
*                                                                       47500003
XCTL1    EQU   *                       SET UP OBR INFO IN EWA    Y02032 47550003
         L     R5,EWTDCB               GET DCB ADDR              Y02032 47600003
         LA    R4,EWTVOLID             GET ADDR OF OBR AREA      Y02032 47650003
         ST    R4,EWADCNT              STORE ADDR IN EWA         Y02032 47700003
         MVI   EWADCNT,HEX24           MOVE IN #BYTES OF OBR     Y02032 47750003
         MVC   EWTVES,UCBCTD           GET VES INFO              Y02032 47800003
         CL    R5,FZERO                VALID DCB?                Y02032 47850003
         BE    XCTL2                   NO - SKIP BLOCK COUNT     Y02032 47900003
         OI    EWAFLG1,EWADDMSG        SET WTO FLAG ON         @ZA31011 47902037
         CLC   BLKCNT(4,R5),MASK       IS BLKCNT = TO 65K?     @ZA08856 47903037
         BNH   MOVIT                   BR IF BLKCNT IS LESS    @ZA08856 47904037
         MVC   EWTBLK,MASK+2           MOVE FFFF TO RECORD     @ZA08856 47905037
         B     XCTL3                   GO XCTL                 @ZA08856 47908003
MOVIT    EQU   *                                                        47910003
         MVC   EWTBLK,BLKCNT+C2(R5)    YES - GET BLOCK COUNT     Y02032 47950003
         B     XCTL3                   GO XCTL                   Y02032 48000003
*                                                                       48050003
XCTL2    EQU   *                                                        48100003
         MVC   EWTBLK,FZERO            SET BLOCK COUNT TO 0      Y02032 48150003
*                                                                       48200003
XCTL3    EQU   *                                                        48250003
         MVC   EWTVOLID,UCBVOLI        GET VOL SER               Y02032 48300003
XCTL4    EQU   *                                                        48350003
         L     XCTLREG,LOC16           GET ADDRESS OF CVT               48400003
         L     XCTLREG,VECTXL(XCTLREG) GET ADDRESS FOR XCTL ROUTINE     48450003
         BR    XCTLREG                 BRANCH TO XCTL                   48500003
*                                                                       48550003
*   ALL EXITS VIA SVC 15/3 COME HERE                                    48600003
*                                                                       48650003
RETN     EQU   *                                                        48700003
         SVC   EXCPER                  SVC 15 - ERROR EXCP              48750003
         SVC   RETURN                  SVC 3  - EXIT                    48800003
*************   E N D   O F   P A R T   1   *************               48850003
         EJECT                                                          48900003
*********************************************************************** 48950003
*                             P A R T   3                             * 49000003
*                                                                     * 49050003
*                       READ OPPOSITE RECOVERY                        * 49100003
*********************************************************************** 49150003
*                                                                     * 49200003
*        ISSUE A READ COMMAND IN THE OPPOSITE DIRECTION               * 49250003
*        WITH THE SUPPRESS DATA TRANSFER BIT ON.  REPEAT              * 49300003
*        40 TIMES OR UNTIL THE BLOCK IS READ SUCCESSFULLY.            * 49350003
*                                                                     * 49400003
*        AFTER EVERY FOURTH RETRY, GO THROUGH A TAPE                  * 49450003
*        CLEANING SEQUENCE.                                           * 49500003
*                                                                     * 49550003
*        ROR IS NOT POSSIBLE IF:                                      * 49600003
*              1.  DATA CHAINING                                      * 49650003
*              2.  OPERATING IN 7-TRACK DATA CONVERT MODE             * 49700003
*              3.  SUPPRESS DATA TRANSFER BIT IS SET IN FAILING CCW   * 49750003
*********************************************************************** 49800003
PART3    EQU   *                                                        49850003
*                                                                       49900003
*   TEST FOR READ OPPOSITE IN PROGRESS                                  49950003
*                                                                       50000003
         TM    EWAFLG3,EWTROR          ROR BIT ON?               Y02032 50050003
         BO    C160                    YES - GO TEST FOR ERROR          50100003
*                                                                       50150003
*   IF RORCCW IS NOT ZERO, WE HAD A PERMANENT ROR ERROR                 50200003
*                                                                       50250003
         CLI   EWTRRCMD,ZERO           IS COMMAND ZERO?                 50300003
         BNE   C120                    NO - BR TO PERM ERROR            50350003
*                                                                       50400003
*   THIS IS FIRST ENTRY FOR ROR ON A READ OR READ BACK                  50450003
*   DATA CHECK.  TEST FOR CONDITIONS NOT APPLICABLE                     50500003
         TM    EWTSNS1,EWT7TK          IS THIS 7-TRACK?          Y02032 50550003
         BZ    C110                    NO-GO TEST FOR SUPP DATA XFER    50600003
*                                                                       50650003
*   TEST FOR DATA CONVERTER MODE SET                                    50700003
*                                                                       50750003
         L     R13,EWTDCB              GET ADDRESS OF DCB        Y02032 50800003
         CL    R13,FZERO               VALID DCB ADDR?           Y02032 50850003
         BE    C110                    NO - SKIP DATA CON TEST   Y02032 50900003
         CLI   DCBMOD(R13),DCBDCF      DATA CONVERTER BEING USED?       50950003
         BE    C120                    YES-SKIP TEST FOR SUPP DATA TR.  51000003
*                                                                       51050003
*   TEST FOR SUPPRESS DATA TRANSFER IN ORIGINAL CCW                     51100003
*                                                                       51150003
C110     EQU   *                                                        51200003
         TM    CCWFLS,RORSDT           SUPPRESS DATA TRANSFER?   A29974 51250003
         BO    C120                    YES - BRANCH TO PERM ERROR       51300003
*                                                                       51350003
*   TEST FOR CCW COUNT GREATER THAN X'7FFF'                             51358037
*                                                                       51366037
         CLI   CCWCNT,HIBIT            COUNT TOO HIGH          @ZA17538 51374037
         BNL   C120                    YES, PERMANENT ERROR    @ZA17538 51382037
*                                                                       51390037
*   TEST FOR DATA CHAINING                                              51400003
*                                                                       51450003
         TM    IOSFLA,IOSDCHN          DATA CHAINING?                   51500003
         BZ    C140                    NO - GO SET UP RORCCW            51550003
C120     EQU   *                                                        51600003
         BAL   RETREG,A575             GO UPDATE PR VES COUNTER         51650003
C130     EQU   *                                                        51700003
         B     A560                    BRANCH TO PERM ERROR      S21048 51750003
         EJECT                                                          51800003
*                                                                       51850003
*                        F I R S T   E N T R Y                          51900003
*                                                                       51950003
*             SET UP INITIAL RORCCW ON FIRST ENTRY ONLY                 52000003
*                                                                       52050003
C140     EQU   *                                                        52100003
         MVC   EWTRRCCW,CCW            MOVE USER CCW TO RORCCW   Y02032 52150003
         CLC   EWTRRCNT,IOSCSWRC       USER BYTE CNT = RESIDUAL CNT?    52200003
         BE    C120                    YES - PERMANENT ERROR     Y02032 52250003
*                                                                       52300003
*   SET UP IOSB START ADDRESSES (REAL & VIRT) WITH ADDRESS OF           52350003
*   RORCCW TO BE USED DURING ROR                                        52400003
*                                                                       52450003
         MVC   EWTVIRT,IOSVST          SAVE START ADDR (VIRT)    Y02032 52500003
         LA    R13,EWTRRCCW            GET ADDR OF RORCCW (VIRT) Y02032 52550003
         ST    R13,IOSVST              STORE IOSB VIRT START ADR Y02032 52600003
         LRA   R13,EWTRRCCW            GET ADDR OF RORCCW (REAL) Y02032 52650003
         ST    R13,IOSRST              STORE IOSB REAL START ADR Y02032 52700003
*                                                                       52750003
         XC    IOSCSWRC,IOSCSWRC       ZERO RESIDUAL COUNT       Y02032 52800003
         BAL   BALREG,PART6            GO SET UP ADDRESSABILITY         52850003
*                                                                       52900003
*   UPDATE SDR                                                          52950003
*                                                                       53000003
C142     EQU   *                                                        53050003
         TM    UCBTBYT4,UCB3400        3400 TAPE UNIT?                  53100003
         BO    C145                    YES - SKIP ROR COUNT             53150003
*                                                                       53200003
         IC    R4,ROR(SDRREG)          GET ROR COUNT                    53250003
         LA    R4,C16(R4)              ADD ONE TO COUNT                 53300003
         STC   R4,ROR(SDRREG)          STORE BACK                       53350003
         TM    ROR(SDRREG),RDFULL      IS COUNT FULL?                   53400003
         BNO   C145                    NO - SKIP OVERFLOW               53450003
*                                                                       53500003
         OI    EWAFLG3,EWTOVER         YES - SET SDR OVERFLOW    Y02032 53550003
C145     EQU   *                                                        53600003
         XC    EWACNTR1(C2),EWACNTR1   ZERO ERROR COUNTERS       Y02032 53650003
         OI    EWACNTR2,X1             SET READ COUNT TO ONE     Y02032 53700003
         B     C510                    GO READ OPPOSITE                 53750003
         EJECT                                                          53800003
*                                                                       53850003
*                      R O R   I N   P R O G R E S S                    53900003
*                                                                       53950003
*   TEST FOR ERROR ON RETRY OR SPACE                                    54000003
*                                                                       54050003
C160     EQU   *                                                        54100003
         TM    EWAFLG3,EWTRBLD         REBUILD IDAL LIST?        Y02032 54150003
         BNO   C165                    NO  - BRANCH AROUND       Y02032 54200003
         BAL   BALREG,F030             YES - GO TO PART 6        Y02032 54250003
C165     EQU   *                                                        54300003
         TM    IOSTSA,CSWUCK           UNIT CHECK?                      54350003
         BO    C230                    YES - BRANCH                     54400003
*                                                                       54450003
*   TEST FOR CONTROL UNIT BUSY                                          54500003
*                                                                       54550003
         TM    IOSTSA,CSWCUB           CU BUSY?                         54600003
         BCR   1,EXITREG               YES - GO RETRY, SVC 15/3         54650003
*                                                                       54700003
*   TEST FOR RETRY OR SPACE                                             54750003
*                                                                       54800003
         TM    EWACNTR3,EWTROC         IOS USE RORCCW BIT ON?    Y02032 54850003
         BZ    C410                    NO - GO RETRY                    54900003
         NI    EWACNTR3,X'FF'-EWTROC   RESET IOS USE RORCCW      Y02032 54950003
         OI    IOSFLA,IOSREP+IOSCRC    SET REPOSITION BIT & CRC  Y02032 55000003
         OI    IOSOPT,IOSDEP           SET DEVICE END POST BIT   Y02032 55050003
*                                                                       55100003
*   WE HAVE JUST READ OPPOSITE.  IF SUPPRESS DATA TRANSFER              55150003
*   BIT IS OFF, WE HAVE RECOVERED THE UC-DC CONDITION.                  55200003
*                                                                       55250003
         TM    IOSTSB,CSWCDC           CHANNEL DATA CHECK?              55300003
         BO    C285                    YES - GO RESET USE RORCCW BIT    55350003
*                                                                       55400003
         TM    EWTRRFLS,RORSDT         SUPPRESS DATA TRANSFER?          55450003
         BO    C180                    YES - GO BUILD FINAL RORCCW      55500003
*                                                                       55550003
         TM    IOSTSA,CSWUEX           UNIT EXCEPTION?                  55600003
         BZ    C170                    NO - BRANCH                      55650003
         OI    EWACNTR3,EWTUEX         SET UNIT EXCEPTION FLAG   Y02032 55700003
*                                                                       55750003
C170     EQU   *                                                        55800003
         MVI   EWTRRCMD,ZERO           ZERO COMMAND (SWITCH)            55850003
         BR    EXITREG                 GO SPACE OVER RECORD             55900003
         EJECT                                                          55950003
*                                                                       56000003
*            B U I L D   F I N A L   R O R C C W                        56050003
*                                                                       56100003
C180     EQU   *                                                        56150003
         LH    R4,EWTRRCNT             GET ORIGINAL COUNT               56200003
         N     R4,MASK                 RESET HIGH ORDER BITS            56250003
         TM    IOSTSB,CSWICL           INCORRECT LENGTH?                56300003
         BZ    C200                    NO - BRANCH AROUND               56350003
*                                                                       56400003
         CLC   IOSCSWRC,FZERO          IS RESIDUAL COUNT ZERO           56450003
         BNE   C190                    NO - BRANCH AROUND               56500003
*                                                                       56550003
         MVI   EWACNTR2,NUMB40         SET MAXIMUM COUNT TO 40   Y02032 56600003
         B     C380                    BRANCH TO ONE FINAL RETRY        56650003
*                                                                       56700003
*   CCW COUNT IS GREATER THAN OR EQUAL TO THE BLOCK SIZE                56750003
*                                                                       56800003
C190     EQU   *                                                        56850003
         BAL   BALREG,F010             GO SET UP ADDRESSES       Y02032 56900003
*                                                                       56950003
C200     EQU   *                                                        57000003
         NI    EWTRRFLS,X'FF'-RORSDT   ENABLE DATA TRANSFER             57050003
         BR    EXITREG                 GO SPACE - SVC 15/3              57100003
         EJECT                                                          57150003
*                                                                       57200003
*                      U N I T   C H E C K                              57250003
*                                                                       57300003
*   EQUIPMENT CHECK IS A VALID ERROR ONLY WITH DEVICE END               57350003
*                                                                       57400003
C230     EQU   *                       E Q U I P M E N T   C H E C K    57450003
         TM    EWTSNS0,EWTEQU          EQUIPMENT CHECK?          Y02032 57500003
         BZ    C250                    NO - GO CONTINUE TEST            57550003
         TM    IOSTSA,CSWDVE           DEVICE END?                      57600003
         BNO   C250                    NO - GO CONTINUE TEST            57650003
*                                                                       57700003
*   RESTORE START ADDRESSES AND XCTL TO WTO                             57750003
*                                                                       57800003
C240     EQU   *                                                        57850003
         L     R13,EWTVIRT             GET ADDR OF USER CCW      Y02032 57900003
         ST    R13,IOSVST              RESTORE START ADR (VIRT)  Y02032 57950003
         LRA   R13,0(R13)              GET REAL ADDRESS          Y02032 58000003
         ST    R13,IOSRST              RESTORE START ADR (REAL)  Y02032 58050003
         B     A560                    GO XCTL TO WTO                   58100003
*                                                                       58150003
C250     EQU   *                       B U S   O U T   C H E C K        58200003
         TM    EWTSNS0,EWTBUSO         BUS OUT CHECK?            Y02032 58250003
         BNO   C270                    NO - GO CONTINUE TEST            58300003
         TM    EWACNTR1,OVRCNT5        LAST RETRY (5)?           Y02032 58350003
         BO    C260                    YES - SKIP COUNT UPDATE          58400003
*                                                                       58450003
*   UPDATE RETRY COUNT                                                  58500003
*                                                                       58550003
         IC    R13,EWACNTR1            GET RETRY COUNT           Y02032 58600003
         LA    R13,C16(R13)            ADD ONE TO COUNT                 58650003
         STC   R13,EWACNTR1            STORE NEW COUNT           Y02032 58700003
*                                                                       58750003
         CLI   CCWOP,CMDCTL            NOP COMMAND?                     58800003
         BCR   7,EXITREG               NO - GO RETRY                    58850003
         B     C410                    YES - SPACE OK, CONTINUE         58900003
*                                                                       58950003
C260     EQU   *                                                        59000003
         TM    EWACNTR3,EWTROC         USE RORCCW BIT ON?        Y02032 59050003
         BO    C417                    YES - BR TO PERM ERROR           59100003
C265     EQU   *                                                        59150003
         MVI   EWACNTR2,NUMB40         SET MAXIMUM COUNT TO 40   Y02032 59200003
         B     C380                    BRANCH TO ONE MORE READ          59250003
*                                                                       59300003
C270     EQU   *                       I N T E R V E N T I O N   R E Q  59350003
         TM    EWTSNS0,EWTINT          INTERVENTION REQUIRED?           59400003
         BNO   C280                    NO - GO CONTINUE TEST            59450003
         TM    IOSTSA,CSWDVE           DEVICE END?                      59500003
         BZ    A570                    NO - BRANCH TO PRINT MSG         59550003
*                                                                       59600003
C280     EQU   *                       O V E R R U N                    59650003
         TM    EWTSNS0,EWTOVRN         OVERRUN?                  Y02032 59700003
         BNO   C290                    NO - GO CONTINUE TEST            59750003
C285     EQU   *                                                        59800003
         NI    EWACNTR3,X'FF'-EWTROC   RESET USE RORCCW BIT      Y02032 59850003
         OI    IOSFLA,IOSREP           SET REPOSITION BIT        Y02032 59900003
         TM    EWACNTR1,OVRCNT5        LAST RETRY (5)?           Y02032 59950003
         BO    C265                    YES - GO SET TO PERM READ        60000003
*                                                                       60050003
*   UPDATE RETRY COUNT                                                  60100003
*                                                                       60150003
         IC    R13,EWACNTR1            GET RETRY COUNT           Y02032 60200003
         LA    R13,C16(R13)            ADD ONE TO COUNT                 60250003
         STC   R13,EWACNTR1            STORE NEW COUNT           Y02032 60300003
         BR    EXITREG                 GO RETRY OR SPACE                60350003
*                                                                       60400003
C290     EQU   *                       L O A D   P O I N T              60450003
         TM    EWTSNS1,EWTLP           LOAD POINT?               Y02032 60500003
         BO    A2020                   YES - GO TO PART 2 OF LOAD 2     60550003
*                                                                       60600003
*                                      D A T A   C H E C K              60650003
         TM    EWTSNS0,EWTDATA         DATA CHECK?               Y02032 60700003
         BNO   C310                    NO - GO CONTINUE TEST            60750003
         TM    EWTSNS1,EWTNOISE        NOISE BIT ON?             Y02032 60800003
         BO    C300                    YES - SKIP NOISE BLOCK TEST      60850003
*                                                                       60900003
*   TEST FOR NOISE BLOCK                                                60950003
*                                                                       61000003
         LH    R0,EWTRRCNT             GET RORCCW COUNT                 61050003
         N     R0,MASK                 RESET HIGH ORDER BITS            61100003
         SH    R0,IOSCSWRC             LESS RESIDUAL IN CSW             61150003
         SH    R0,TWELVE               SUBTRACT MINIMUM SIZE            61200003
         BC    11,C300                 BRANCH IF OK                     61250003
         B     A2020                   ELSE GO TO PART 2, LOAD 2        61300003
*                                                                       61350003
*   THE BLOCK WAS NOT NOISE                                             61400003
*                                                                       61450003
C300     EQU   *                                                        61500003
         NI    EWACNTR3,X'FF'-EWTROC   RESET USE RORCCW BIT      Y02032 61550003
*                                                                       61600003
*   ARE WE READY FOR A CLEANER?                                         61650003
*                                                                       61700003
         OI    IOSFLA,IOSREP           SET REPOSITION BIT        Y02032 61750003
         OI    IOSOPT,IOSDEP           SET DEVICE END POST BIT   Y02032 61800003
         TM    EWACNTR2,X4             MULTIPLE OF 4?            Y02032 61850003
         BO    C370                    YES - GO SET UP CLEANER          61900003
*                                                                       61950003
         IC    R13,EWACNTR2            GET CURRENT COUNT         Y02032 62000003
         LA    R13,C1(R13)             ADD ONE TO COUNT                 62050003
         STC   R13,EWACNTR2            STORE NEW COUNT           Y02032 62100003
         BR    EXITREG                 GO SPACE                         62150003
*                                                                       62200003
*   TEST FOR CHANNEL DATA CHECK WHEN INT. REQ. IS IGNORED               62250003
*                                                                       62300003
C310     EQU   *                       C H A N N E L   D A T A   C H K  62350003
         TM    IOSTSB,CSWCDC           CHANNEL DATA CHECK?              62400003
         BZ    C240                    NO - GO HANDLE PERM ERROR        62450003
         B     C285                    YES - GO RETRY                   62500003
         EJECT                                                          62550003
*                                                                       62600003
*                    C L E A N E R                                      62650003
*                                                                       62700003
*          SET UP FOR CLEANER UNLESS WE ARE DONE                        62750003
*                                                                       62800003
C370     EQU   *                                                        62850003
         TM    EWACNTR2,NUMB40         LAST RETRY?               Y02032 62900003
         BNO   C390                    NO - GO SET UP CLEANER           62950003
*                                                                       63000003
*   END OF RECOVERY ATTEMPTS - SET UP TO READ ORIGINAL                  63050003
*                                                                       63100003
C380     EQU   *                                                        63150003
         L     R13,EWTVIRT             GET ADDR OF USER CCW      Y02032 63200003
         ST    R13,IOSVST              RESTORE START ADR (VIRT)  Y02032 63250003
         LRA   R13,0(R13)              GET REAL ADDRESS          Y02032 63300003
         ST    R13,IOSRST              RESTORE START ADDR(REAL)  Y02032 63350003
         TM    IOSFLA,IOSCCHN          COMMAND CHAINING?                63400003
         BO    C460                    YES - GO SET RESTART FLAG        63450003
         B     C470                    NO-SET REP & CRC, FINISH CHAIN   63500003
*                                                                       63550003
*   SET UP CLEANER                                                      63600003
*                                                                       63650003
C390     EQU   *                                                        63700003
         IC    R13,EWACNTR2            GET COUNT                 Y02032 63750003
         LA    R13,C13(R13)            CARRY TO TENS POSITION           63800003
         STC   R13,EWACNTR2            STORE UPDATED COUNT       Y02032 63850003
         OI    EWAFLG3,EWTTPC          SET TAPE CLEAN BIT        Y02032 63900003
         LH    R13,UCBCLN              GET ESV CLEANER COUNT            63950003
         CH    R13,MASK+C2             IS COUNT FULL?                   64000003
         BE    C400                    YES - BR AROUND COUNT INCREMENT  64050003
         LA    R13,C1(R13)             ADD ONE TO COUNT                 64100003
         STH   R13,UCBCLN              STORE BACK                       64150003
*                                                                       64200003
*   SET UP NUMBER OF BACK SPACES                                        64250003
*                                                                       64300003
C400     EQU   *                                                        64350003
         OI    EWACNTR1,CLNCNT4        ASSUME RD FWD - SET COUNT TO 4   64400003
         CLI   EWTRRCMD,CMDRED         IS IT READ FORWARD?              64450003
         BCR   8,EXITREG               YES - START CLEANER              64500003
*                                                                       64550003
         MVI   IOSMDB,CMDBSR           NO - SET BACK SPACE              64600003
         NI    EWACNTR1,HEXF8          SET COUNT TO 0            Y02032 64650003
         OI    EWACNTR1,CLNCNT3        SET COUNT TO 3 FOR RD BACK CLEAN 64700003
         OI    EWAFLG3,EWTBKS          SET BKSP ERASE CLEANER    Y02032 64750003
         BR    EXITREG                 START CLEANER                    64800003
*                                                                       64850003
*   END OF CLEANER                                                      64900003
         EJECT                                                          64950003
*                                                                       65000003
*   WE HAVE JUST SPACED OVER THE ERROR BLOCK.                           65050003
*   IF THE RORCCW COMMAND IS ZERO, WE HAVE RECOVERED.                   65100003
*                                                                       65150003
C410     EQU   *                                                        65200003
         CLI   EWTRRCMD,ZERO           IS THE COMMAND ZERO?             65250003
         BNE   C480                    NO - BR TO CONTINUE ROR          65300003
         EJECT                                                          65350003
*                                                                       65400003
*                      R E C O V E R Y                                  65450003
*                                                                       65500003
*        CLEAN UP AFTER RECOVERY IN OPPOSITE DIRECTION                  65550003
*                                                                       65600003
         NI    IOSFLA,X'FF'-IOSREP-IOSCRC     RESET REP & CRC           65650003
*                                                                       65700003
*   RESTORE DEVICE END POST BIT                                         65750003
*                                                                       65800003
         TM    EWACNTR3,EWTDEP         WAS IT ON ORIGINALLY?     Y02032 65850003
         BO    C415                    YES - LEAVE IT ON         Y02032 65900003
         NI    IOSOPT,X'FF'-IOSDEP     NO  - TURN IT OFF         Y02032 65950003
C415     EQU   *                                                        66000003
         NI    EWAFLG3,X'FF'-EWTROR    RESET ROR IN PROGRESS     Y02032 66050003
         TM    IOSTSB,CSWICL           INCORRECT LENGTH?         Y02032 66100003
         BO    C417                    YES - LEAVE CNTR SET      Y02032 66150003
         NI    EWACNTR1,HEX88          SET BUS OUT & CLNR CNT TO 0      66200003
*                                                                       66250003
C417     EQU   *                                                        66300003
         L     R13,EWTVIRT             GET ADDR OF USER CCW      Y02032 66350003
         ST    R13,IOSVST              RESTORE START ADR (VIRT)  Y02032 66400003
         LRA   R13,0(R13)              GET REAL ADDRESS          Y02032 66450003
         ST    R13,IOSRST              RESTORE START ADR (REAL)  Y02032 66500003
*                                                                       66550003
*   PERMANENT BUS OUT ON RORCCW COMES HERE                              66600003
*                                                                       66650003
C420     EQU   *                                                        66700003
         L     CCWREG,IOSVST           GET START ADDRESS                66750003
         LA    R13,C8(CCWREG)          GET ERR CCW ADDRESS + 8          66800003
         IC    R4,IOSCSW-C1            GET IOSCC                        66850003
         ST    R13,IOSCSW-C1           STORE ERR CCW ADDRESS + 8        66900003
         STC   R4,IOSCSW-C1            RESTORE IOSCC                    66950003
*                                                                       67000003
*   TEST FOR PERMANENT BUS OUT                                          67050003
*                                                                       67100003
         TM    EWACNTR1,OVRCNT5        PERMANENT BUS OUT (5 RETRIES)?   67150003
         BO    C240                    YES - BR TO PERMANENT ERROR      67200003
*                                                                       67250003
*   CONTINUE CLEANUP                                                    67300003
*                                                                       67350003
         LH    R0,CCWCNT               GET ORIGINAL COUNT               67400003
         N     R0,MASK                 ZERO HIGH ORDER BITS             67450003
         SH    R0,EWTRRCNT             SUBTRACT RORCCW COUNT            67500003
         STH   R0,IOSCSWRC             SET RESIDUAL COUNT               67550003
         BZ    C440                    BRANCH IF RESIDUAL IS ZERO       67600003
*                                                                       67650003
         TM    CCWFLS,CCWSILI          SILI BIT ON?                     67700003
         BO    C440                    YES - BR AROUND INCORRECT LENGTH 67750003
         OI    IOSTSB,CSWICL           NO - SET INCORRECT LENGTH        67800003
*                                                                       67850003
C440     EQU   *                                                        67900003
         TM    EWACNTR3,EWTUEX         UNIT EXCEPTION FLAG ON?   Y02032 67950003
         BO    PART4                   YES - GO TO PART 4               68000003
*                                                                       68050003
         TM    IOSTSB,CSWICL           INCORRECT LENGTH?                68100003
         BO    PART4                   YES - GO TO PART 4               68150003
*                                                                       68200003
         TM    IOSFLA,IOSCCHN          COMMAND CHAINING?                68250003
         BZ    PART4                   NO - GO TO PART 4                68300003
*                                                                       68350003
         TM    CCWFLS,IOSCCHN          CCW CHAINED?                     68400003
         BZ    PART4                   NO - GO TO PART 4                68450003
*                                                                       68500003
*   SET UP TO FINISH CHAIN                                              68550003
*                                                                       68600003
         LA    CCWREG,C8(CCWREG)       GET NEXT CCW ADDR                68650003
         CLI   CCWOP,CMDTIC            NEXT COMMAND A TIC?              68700003
         BNE   C450                    NO - BRANCH AROUND TIC           68750003
*                                                                       68800003
*   TRANSLATE REAL ADDRESS IN TIC TO VIRTUAL                            68850003
*                                                                       68900003
         LR    R4,IOSREG               SAVE IOSB ADDRESS                68950003
         L     R1,CCWADR               GET ADDRESS FROM TIC             69000003
         LA    R1,0(R1)                ZERO HI-ORDER BYTE               69050003
         LR    R8,BASREG               SAVE BASE ADDRESS                69100003
         L     BASREG,LOC16            GET ADDRESS OF CVT               69150003
         L     BASREG,CVTPTRV(BASREG)  GET ADDR OF TRANSLATE RTN.       69200003
         BALR  LNKREG,BASREG           LINK TO TRANSLATE ROUTINE        69250003
         LR    CCWREG,R1               GET VIRTUAL CCW ADDRESS          69300003
         LR    BASREG,R8               RESTORE BASE REGISTER            69350003
         LR    IOSREG,R4               RESTORE IOSB REGISTER            69400003
*                                                                       69450003
C450     EQU   *                                                        69500003
         ST    CCWREG,IOSVST           SET CONTINUE CCW ADDRESS         69550003
         LRA   R13,CCW                 TRANSLATE VIRT START ADR  Y02032 69600003
         ST    R13,IOSRST              STORE IN REAL START ADR   Y02032 69650003
         NI    EWAFLG3,EWTOVER         RESET ALL BUT SDR OVERFLOW       69700003
         XC    EWACNTR1,EWACNTR1       RESET ERROR COUNTERS      Y02032 69750003
*                                                                       69800003
C460     OI    EWACNTR3,EWTRST         SET RESTART FLAG ON       Y02032 69850003
*                                                                       69900003
C470     EQU   *                                                        69950003
         NI    IOSFLA,X'FF'-IOSREP-IOSCRC     RESET REP & CRC           70000003
         NI    EWAFLG3,X'FF'-EWTROR    RESET ROR IN PROGRESS     Y02032 70050003
         B     A166                    GO FINISH CHAIN - SVC 15/3       70100003
*                                                                       70150003
*   END OF RECOVERY                                                     70200003
         EJECT                                                          70250003
*                                                                       70300003
*   WE HAVE JUST SPACED.  CHECK FOR CLEANER IN PROGRESS                 70350003
*                                                                       70400003
C480     EQU   *                                                        70450003
         TM    EWACNTR1,CLNCNT0        IS CLEANER CONTROL COUNT ZERO?   70500003
         BZ    C490                    YES - BR AROUND COUNT UPDATE     70550003
*                                                                       70600003
*   DECREMENT CLEANER CONTROL COUNT                                     70650003
*                                                                       70700003
C485     EQU   *                                                        70750003
         IC    R0,EWACNTR1             GET CONTROL COUNT         Y02032 70800003
         BCTR  R0,R0                   DECREMENT                        70850003
         STC   R0,EWACNTR1             STORE NEW COUNT           Y02032 70900003
         BR    EXITREG                 CONTINUE - SVC 15/3              70950003
*                                                                       71000003
*   TEST FOR END OF CLEANER BSRS                                        71050003
*                                                                       71100003
C490     EQU   *                                                        71150003
         TM    EWAFLG3,EWTTPC          CLEANER BIT ON?           Y02032 71200003
         BZ    C510                    NO - GO SET UP TO READ OPPOSITE  71250003
*                                                                       71300003
*   CHANGE CLEANER DIRECTION                                            71350003
*                                                                       71400003
         MVI   IOSMDB,CMDFSR           SET FORWARD SPACE                71450003
         OI    EWACNTR1,CLNCNT4        SET COUNT TO 4            Y02032 71500003
         TM    EWAFLG3,EWTBKS          READ BACK CLEANER?        Y02032 71550003
         BO    C500                    YES - BRANCH AROUND              71600003
*                                                                       71650003
         NI    EWACNTR1,HEXF8          SET COUNT TO 0            Y02032 71700003
         OI    EWACNTR1,CLNCNT3        SET COUNT TO 3 - RD BK    Y02032 71750003
*                                                                       71800003
C500     EQU   *                                                        71850003
         NI    EWAFLG3,X'FF'-EWTTPC-EWTBKS      CLEAR FLAGS      Y02032 71900003
         BR    EXITREG                 EXIT VIA SVC 15/3                71950003
*                                                                       72000003
*   SET SPACE DIRECTION AND SET UP TO READ OPPOSITE                     72050003
*   RESTORE DEVICE END POST BIT                                         72100003
*                                                                       72150003
C510     EQU   *                                                        72200003
         OI    EWACNTR3,EWTROC         SET USE RORCCW BIT        Y02032 72250003
         OI    IOSFLA,IOSCRC           SET CRC                          72300003
         NI    IOSFLA,X'FF'-IOSREP     RESET REPOSITION                 72350003
*                                                                       72400003
         TM    EWACNTR3,EWTDEP         WAS DEP BIT ON ORIGINALLY?       72450003
         BO    C520                    YES - LEAVE IT ON         Y02032 72500003
         NI    IOSOPT,X'FF'-IOSDEP     NO  - TURN IT OFF         Y02032 72550003
*                                                                       72600003
C520     EQU   *                                                        72650003
         MVI   IOSMDB,CMDFSR           SET FORWARD SPACE                72700003
         CLI   EWTRRCMD,CMDRDB         RORCCW READ BACK?                72750003
         BE    RETN                    YES - EXIT VIA SVC 15/3          72800003
         MVI   IOSMDB,CMDBSR           NO - SET BACK SPACE              72850003
         BR    EXITREG                 SVC 15/3                         72900003
*************    E N D   O F   P A R T    3    *************            72950003
         EJECT                                                          73000003
*********************************************************************** 73050003
*                          P A R T   4                                * 73100003
*                                                                     * 73150003
*                       TEMPORARY ERRORS                              * 73200003
*********************************************************************** 73250003
*        THIS SECTION HANDLES THE FOLLOWING CONDITIONS                * 73300003
*              1.  UNIT EXCEPTION (NO ERROR)                          * 73350003
*              2.  INCORRECT LENGTH (NO ERROR)                        * 73400003
*              3.  TEMPORARY ERRORS - RECOVERED                       * 73450003
*        BY UPDATING SDR COUNTERS AND VES COUNTERS, THEN              * 73500003
*        EXITING THE ERP VIA OBR, WTO OR SVC 15/3.                    * 73550003
*********************************************************************** 73600003
*                                                                       73650003
*   TEST STATUS INFORMATION                                             73700003
*                                                                       73750003
PART4    EQU   *                                                        73800003
         TM    IOSTSB,CSWSTB           CDC, CHC, PGC, OR PTC?           73850003
         BC    5,A2000                 YES - GO TO LOAD 2, PART 4B      73900003
*                                                                       73950003
         TM    IOSTSA,CSWUEX           UNIT EXCEPTION?                  74000003
         BO    D260                    YES - GO CHECK IF 1ST ENTRY ERR  74050003
*                                                                       74100003
         TM    IOSTSB,CSWICL           INCORRECT LENGTH?                74150003
         BO    D260                    YES - GO CHECK IF 1ST ENTRY ERR  74200003
*                                                                       74250003
*   END OF TEST - RECOVERED                                             74300003
*                                                                       74350003
D130     EQU   *                                                        74400003
*                                                                       74402003
*              ZERO ERROR COUNTERS (2 BYTES)                   @ZA00656 74410003
*                                                                       74412003
         XC  EWACNTR1(2),EWACNTR1                              @ZA00656 74420003
         NI    EWACNTR3,X'FF'-EWTRST   RESET RESTART BIT         S21048 74500003
         NI    IOSFLA,X'FF'-IOSERR-IOSEX   SET FOR TEMP ERROR EXIT      74550003
*                                                                       74600003
*                                                                       74900003
         CLI   CCWOP,X'17'             ERG?                      S21048 74950003
         BE    D240                    YES-GO UPDTE SDR CNTRS    S21048 75000003
*                                                                       75050003
         TM    EWTSNS1,EWTWRT          WAS IT A WRITE TYPE CMD?  S21048 75100003
         BO    D240                    YES-GO UPDTE SDR CNTRS    S21048 75150003
*                                                                       75200003
         TM    IOSFLA,IOSDCHN          DATA CHAINING?          @ZA30317 75210037
         BO    D200                    YES-GO UPDTE SDR CNTRS  @ZA30317 75220037
         CLI   CCWOP,CMDRDF            IS IT RDF OR CHAINED READ?       75250003
         BC    12,D200                 YES-GO UPDTE SDR CNTRS    S21048 75300003
*                                                                       75350003
         CLI   CCWOP,CMDRDB            IS IT A RDB?                     75400003
         BNE   D300                    NO - GO EXIT ERP                 75450003
*                                                                       75500003
*   TEMPORARY READ EXIT ROUTINE                                         75550003
*                                                                       75600003
D200     EQU   *                                                        75650003
         TM    UCBTBYT4,UCB3400        3400 TAPE UNIT?                  75700003
         BO    D210                    YES - GO UPDATE VES COUNTERS     75750003
*                                                                       75800003
         IC    R4,0(SDRREG)            GET TEMP RD/WT COUNT      S21048 75850003
         LA    R4,C16(R4)              STEP READ COUNT           S21048 75900003
         STC   R4,0(SDRREG)            STORE BACK                S21048 75950003
         TM    0(SDRREG),RDFULL        IS COUNT FULL?            S21048 76000003
         BM    D210                    NO - SKIP OVERFLOW        S21048 76050003
         OI    EWAFLG3,EWTOVER         YES - SET SDR OVERFLOW    S21048 76100003
*                                                                       76150003
D210     EQU   *                                                        76200003
         TM    UCBTR,FULL              IS TEMP READ COUNT FULL?  S21048 76250003
         BO    D300                    YES - GO EXIT ERP         S21048 76300003
*                                                                       76350003
         IC    R4,UCBTR                GET TEMP READ COUNT       S21048 76400003
         LA    R4,C1(R4)               ADD ONE TO COUNT          S21048 76450003
         STC   R4,UCBTR                STORE BACK                S21048 76500003
         B     D300                    GO EXIT ERP                      76550003
*                                                                       76600003
*   TEMPORARY WRITE EXIT ROUTINE                                        76650003
*                                                                       76700003
D240     EQU   *                                                        76750003
         TM    UCBTBYT4,UCB3400        3400 TAPE UNIT?           S21048 76800003
         BO    D250                    YES - GO UPDATE VES COUNTERS     76850003
*                                                                       76900003
         IC    R4,0(SDRREG)            GET TEMP RD/WT COUNT      S21048 76950003
         LA    R4,C1(R4)               STEP WRITE COUNT          S21048 77000003
         STC   R4,0(SDRREG)            STORE BACK                S21048 77050003
         TM    0(SDRREG),WRFULL        IS COUNT FULL?            S21048 77100003
         BM    D250                    NO - SKIP OVERFLOW        S21048 77150003
         OI    EWAFLG3,EWTOVER         YES - SET SDR OVERFLOW    S21048 77200003
*                                                                       77250003
D250     EQU   *                                                        77300003
         TM    UCBTW,FULL              IS COUNT FULL?            S21048 77350003
         BO    D300                    YES - GO EXIT ERP         S21048 77400003
*                                                                       77450003
         IC    R4,UCBTW                GET WRITE COUNT           S21048 77500003
         LA    R4,C1(R4)               ADD ONE TO COUNT          S21048 77550003
         STC   R4,UCBTW                STORE BACK                S21048 77600003
         B     D300                    GO EXIT ERP                      77650003
*                                                                       77700003
*   UNIT EXCEPTION OR INCORRECT LENGTH -                                77750003
*   IF EWACNTR1 IS ZERO, THIS IS A FIRST ENTRY ERROR                    77800003
*                                                                       77850003
D260     EQU   *                                                        77900003
*                                                                       77910003
*              TEST ERROR COUNTERS (2 BYTES) FOR ZERO          @ZA00656 77920003
*                                                                       77930003
         NC    EWACNTR1(2),EWACNTR1                            @ZA00656 77940003
         BNZ   D130                    NO - CONTINUE                    78000003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA SET PERM ERR EXIT   @YM06412 78050003
         MVI   EWAFLG3,ZERO            CLEAR ERROR FLAGS         Y02032 78100003
         EJECT                                                          78150003
*                             E X I T                                   78200003
*                    TEMPORARY READS AND WRITES                         78250003
*                                                                       78300003
D300     EQU   *                                                        78350003
         TM    IOSFLB,IOSLOG           LOG ON?                   S21048 78400003
         BO    D310                    YES - EXIT VIA OBR               78450003
         TM    EWAFLG3,EWTOVER         SDR OVERFLOW ON?          Y02032 78500003
         BZ    RETN                    NO - EXIT VIA SVC 15/3           78550003
D310     EQU   *                                                        78600003
         LA    R13,SERLOG              GET ADDRESS OF OBR        S21048 78650003
         B     XCTL1                   XCTL TO OBR               S21048 78700003
         EJECT                                                          78750003
*********************************************************************** 78800003
*                            P A R T   5                              * 78850003
*                                                                     * 78900003
*                         STATISTICS UPDATE                           * 78950003
*********************************************************************** 79000003
*                                                                     * 79050003
*        UPDATE SDR COUNTERS AND SET AN OVERFLOW FLAG IF ANY          * 79100003
*        COUNTER IS STEPPED FULL.  A RECORDING WILL BE MADE           * 79150003
*        AT ERP EXIT TIME IF OVERFLOW IS ON.                          * 79200003
*********************************************************************** 79250003
PART5    EQU   *                                                        79300003
         TM    IOSTSA,CHEND+CSWUCK     CHANNEL END & UNIT CHECK?        79350003
         BNO   E110                    NO - GO FIND SDR COUNTER ADDR    79400003
*                                                                       79450003
         LH    R4,UCBSIO               YES - GET SIO COUNT              79500003
         LA    R4,C1(R4)               ADD ONE                          79550003
         STH   R4,UCBSIO               STORE BACK                       79600003
*                                                                       79650003
*   TEST FOR NEW DEVICES AND GET CORRECT                                79700003
*   SDR COUNTER TABLE FOR THE DEVICE                                    79750003
*                                                                       79800003
E110     EQU   *                                                        79850003
         TM    UCBTBYT4,UCB3400        3400 TAPE UNIT?                  79900003
         BO    E160                    YES - BR TO 3420 UPDATE          79950003
*                                                                       80000003
*   DO UPDATE FOR 2400 SDR COUNTERS                                     80050003
*                                                                       80100003
         TM    IOSTSA,CSWUCK           IS UNIT CHECK ON?                80150003
         BZ    E150                    NO - BR AROUND STAT UPDATE       80200003
         LA    TABREG,TAB2400          ADDR OF 2400 SDR DATA TABLE      80250003
         BAL   RETREG,STATUPD          GO UPDATE SDR                    80300003
*                                                                       80350003
*   DO AN UPDATE TO THE CHANNEL DATA CHECK SDR COUNTER                  80400003
*   IF THE CHANNEL DATA CHECK BIT IS ON IN STATUS                       80450003
*                                                                       80500003
E150     EQU   *                                                        80550003
         TM    IOSTSB,CHDAT            CHANNEL DATA CK ON IN STATUS?    80600003
         BZ    BEGIN                   NO - GO TO BEGINNING OF LOAD 1   80650003
*                                                                       80700003
         SR    R13,R13                 ZERO WORK REG                    80750003
         IC    R13,CDCNT(SDRREG)       GET SDR COUNTER FOR CDC          80800003
         LA    R13,C1(R13)             ADD ONE                          80850003
         STC   R13,CDCNT(SDRREG)       STORE BACK                       80900003
         TM    CDCNT(SDRREG),CDFULL    IS COUNT FULL?                   80950003
         BNO   BEGIN                   NO - GO TO BEGINNING OF LOAD 1   81000003
*                                                                       81050003
         OI    EWAFLG3,EWTOVER         SET SDR OVERFLOW BIT ON   Y02032 81100003
         B     BEGIN                   GO TO BEGINNING OF LOAD 1        81150003
         EJECT                                                          81200003
*                                                                       81250003
*   DO UPDATE TO SDR COUNTERS FOR NEW DEVICES (3420)                    81300003
*                                                                       81350003
E160     EQU   *                                                        81400003
         OI    0(SDRREG),SDR20         SET 20-BYTE SDR FLAG             81450003
         TM    IOSTSA,CSWUCK           UNIT CHECK?                      81500003
         BZ    BEGIN                   NO - GO TO BEGINNING OF LOAD 1   81550003
         CLI   EWTSNS0,EWTINT          INTERVENTION REQUIRED?  @YL02128 81600003
         BE    BEGIN                   YES, NO SDR RECORDING   @YL02128 81650003
         LA    TABREG,TAB3420          ADDR OF 3420 SDR DATA TABLE      81700003
         BAL   RETREG,STATUPD          GO UPDATE SDR                    81750003
*                                                                       81800003
*   DO UPDATE TO SDR COUNTERS FOR PE ID BURST CHECK                     81850003
*                                                                       81900003
         TM    EWTSNS5,EWTPEID         PE ID BURST CHECK ON?     Y02032 81950003
         BZ    E170                    NO - BR AROUND SDR COUNT         82000003
         OI    SDRPI(SDRREG),ON        SET SDR COUNT                    82050003
*                                                                       82100003
*   DO UPDATE TO SDR COUNTERS FOR TRACK IN ERROR BYTE                   82150003
*                                                                       82200003
E170     EQU   *                                                        82250003
         TM    EWTSNS2,TIE             TIE BYTE BIT TEST                82300003
         BO    BEGIN                   BR ON BYTE FULL                  82350003
         BNZ   E171                    NOT '00' OR 'FF'                 82400003
         OI    SDRPI(SDRREG),PARON     SET PARITY BIT                   82450003
         B     E180                    SET REST OF RECORD               82500003
E171     CLI   EWTSNS2,INVAL           IS TIE BYTE INVALID?    @YA00088 82550003
         BNE   E180                    BR VALID TO RECORD      @YA00088 82600003
         TM    EWTSNS9,BIRCH           3803-II CONTROL UNIT?   @YL02128 82650003
         BZ    BEGIN                   NO, DO NOT RECORD       @YL02128 82700003
         TM    EWTSNS6,BIRCH           BIRCH DRIVE?            @YL02128 82750003
         BZ    BEGIN                   NO, DO NOT RECORD       @YL02128 82800003
         TM    EWTSNS6,NRZIMODE        IS IT NRZI MODE?        @YL02128 82850003
         BO    BEGIN                   YES, DO NOT RECORD      @YL02128 82900003
*                                                                       82950003
E180     EQU   *                                                        83000003
         OC    SDRPI+C1(C1,SDRREG),EWTSNS2    PUT IN SDR COUNTER        83050003
         B     BEGIN                   GO TO PART 1                     83100003
         EJECT                                                          83150003
*********************************************************************** 83200003
*             S T A T   U P D A T E   R O U T I N E                   * 83250003
*                                                                     * 83300003
*        EACH DEVICE TYPE HAS ITS OWN TABLE CONTAINED IN THIS ERP     * 83350003
*        LOAD TO DEFINE ITS OWN SDR TABLE.  YOU LINK TO THE STAT      * 83400003
*        UPDATE ROUTINE VIA REG. 12 AND WITH THE DEFINE TABLE         * 83450003
*        ADDRESS CONTAINED IN REG 13.                                 * 83500003
*                                                                     * 83550003
*        AS EACH COUNT IS ADDED, THE COUNTER IS CHECKED FOR           * 83600003
*        OVERFLOW.  A RECORDING WILL BE MADE AT ERP EXIT TIME         * 83650003
*        IF OVERFLOW IS ON.                                           * 83700003
*                                                                     * 83750003
*        EACH COUNTER IN AN SDR TABLE IS DEFINED BY 2 BYTES IN        * 83800003
*        A DEVICE-DEPENDENT TABLE.                                    * 83850003
*                                                                     * 83900003
*              BYTE A  0-2 = SENSE BIT POSITION                       * 83950003
*                      3-7 = SDR COUNTER LENGTH                       * 84000003
*                                                                     * 84050003
*              BYTE B  0   = IF ON, SKIP - AN UNUSED COUNTER          * 84100003
*                      1   = N/A                                      * 84150003
*                      2-7 = SENSE BYTE POSITION                      * 84200003
*                      0-7 = IF FULL BYTE=FF, END OF COUNTERS         * 84250003
*********************************************************************** 84300003
*                                                                       84350003
STATUPD  EQU   *                                                        84400003
         LR    SDRR14,SDRREG           MOVE SDR ADDR INTO WORK REG      84450003
         XC    EWTTST,EWTTST           INITIALIZE TO ZERO        Y02032 84500003
*                                                                       84550003
*   INITIALIZE FOR START OF UPDATE TO COUNTERS                          84600003
*                                                                       84650003
         LA    R3,WORD                 NUMB OF BITS PER FULL WORD       84700003
         SR    R4,R4                   ZERO SHIFT WORK REG              84750003
         MVC   EWTWORD(C4),0(SDRR14)   MOVE WORD TO BOUNDARY     Y02032 84800003
         L     R5,EWTWORD              GET FIRST WORD OF COUNTERS       84850003
*                                                                       84900003
*   DO SDR UPDATE                                                       84950003
*                                                                       85000003
STAT130  EQU   *                                                        85050003
         L     R12,UCBEXTPT            GET ADDR OF UCB COMMON EXTN.     85100003
         LA    R12,0(R12)              GET 3-BYTE ADDRESS               85150003
         IC    R8,SNSCT(R12)           GET SENSE COUNT                  85200003
         BCTR  R8,R0                   REDUCE SENSE COUNT BY 1          85250003
         LA    R0,HIBIT                R0 = 00 00 00 80 (1000 0000)     85300003
         SR    R9,R9                   ZERO REG                         85350003
         IC    R9,0(TABREG)            GET SENSE BIT POSITION           85400003
         SRL   R9,C5                   RIGHT JUSTIFY BITS               85450003
         LTR   R9,R9                   IS IT ZERO?                      85500003
         BZ    STAT150                 BR IF ZERO - SNS BIT 0           85550003
*                                                                       85600003
STAT140  EQU   *                                                        85650003
         SRL   R0,C1                   SHIFT 1000 0000 RIGHT 1 TIME     85700003
         BCT   R9,STAT140              BRANCH TILL DONE                 85750003
*                                                                       85800003
STAT150  EQU   *                                                        85850003
         STC   R0,EWTTST               SAVE R0 (SNS BIT POS POINTER)    85900003
         TM    C1(TABREG),CNTEND       IS THIS END OF COUNTERS?         85950003
         BCR   1,RETREG                YES - BRANCH BACK TO BALR        86000003
*                                                                       86050003
         NI    EWACNTR3,X'FF'-EWTBIT   ZERO 'BIT ON' FLAG        Y02032 86100003
         TM    C1(TABREG),CTROK        IS THIS COUNTER FOR REAL?        86150003
         BO    STAT160                 NO - BR, IT'S A FULL WORD FILLER 86200003
         SR    R9,R9                   ZERO REG                         86250003
         IC    R9,C1(TABREG)           GET SENSE BYTE NUMBER            86300003
         N     R9,MASK2                MASK2 = 00 00 00 3F              86350003
         CR    R9,R8                   IS SENSE BYTE COUNT VALID?       86400003
         BH    STAT160                 NO - BRANCH AROUND SENSE         86450003
         LA    R0,EWTSNS               GET SENSE ADDRESS         Y02032 86500003
         AR    R9,R0                   ADD TO SENSE ADDRESS             86550003
         NC    EWTTST(C1),0(R9)        WAS SENSE BIT ON?                86600003
         BZ    STAT160                 NO - BR AROUND BIT ON FLAG       86650003
         OI    EWACNTR3,EWTBIT         SET 'BIT ON' FLAG ON      Y02032 86700003
*                                                                       86750003
STAT160  EQU   *                                                        86800003
         SR    R9,R9                   ZERO REG                         86850003
         IC    R9,0(TABREG)            GET COUNTER LENGTH               86900003
         N     R9,MASK1                MASK1 = 00 00 00 1F              86950003
         SR    R8,R8                   ZERO REG                         87000003
*                                                                       87050003
STAT170  EQU   *                                                        87100003
         SLL   R8,C1                   SHIFT REG ONE TIME               87150003
         SLDL  R4,C1                   SHIFT COUNTER R5 TO R4 LO-ORDER  87200003
         LA    R8,C1(R8)               AND GENERATE MASK IN R8          87250003
         BCTR  R3,ZERO                 REDUCE FULL WORD BIT COUNTER     87300003
         BCT   R9,STAT170              SHIFT UNTIL WHOLE COUNTER        87350003
*                                                                       87400003
         TM    EWACNTR3,EWTBIT         DO WE ADD TO COUNTER      Y02032 87450003
         BZ    STAT180                 NO - BR AROUND COUNTER INCREMENT 87500003
         A     R4,ONE                  ADD 1 TO COUNTER                 87550003
         ST    R8,EWTMASK              SAVE COUNTER MASK         Y02032 87600003
         NR    R8,R4                   SAVE ONLY COUNTER IN 48          87650003
         C     R8,EWTMASK              IS COUNTER FULL?          Y02032 87700003
         BNE   STAT180                 NO - BR AROUND OVERFLOW FLAG     87750003
         OI    EWAFLG3,EWTOVER         YES - SET SDR OVERFLOW FLAG      87800003
*                                                                       87850003
STAT180  EQU   *                                                        87900003
         LTR   R3,R3                   IS FULL WORD DONE?               87950003
         BNZ   STAT190                 NO - BR AROUND RESET FULL WORD   88000003
         ST    R4,EWTWORD              STORE UPDATED COUNTERS BACK      88050003
         MVC   0(C4,SDRR14),EWTWORD    MOVE WORD BACK            Y02032 88100003
         LA    SDRR14,C4(SDRR14)       STEP TO NEXT FULL WORD           88150003
         LA    R3,WORD                 NUMBER OF BITS PER FULL WORD     88200003
         SR    R4,R4                   ZERO SHIFT WORK REGISTER         88250003
         MVC   EWTWORD(C4),0(SDRR14)   MOVE WORD TO BOUNDARY     Y02032 88300003
         L     R5,EWTWORD              PUT WORD IN WORK REG      Y02032 88350003
*                                                                       88400003
STAT190  EQU   *                                                        88450003
         LA    TABREG,C2(TABREG)       STEP TABLE TO NEXT COUNTER       88500003
         B     STAT130                 BRANCH TO NEXT COUNTER           88550003
         EJECT                                                          88600003
*********************************************************************** 88650003
*                            P A R T   6                              * 88700003
*                                                                     * 88750003
*                           ADDRESSABILITY                            * 88800003
*                        CREATE ERP IDAL LIST                         * 88850003
*********************************************************************** 88900003
*                                                                     * 88950003
*        THIS SECTION IS ENTERED TO SET UP ADDRESSABILITY.            * 89000003
*        IF BIT 37 OF THE CCW IS ON, THIS INDICATES THAT AN           * 89050003
*        IDAL LIST IS BEING USED & AN ERP IDAL LIST MUST BE           * 89100003
*        CREATED FOR ROR.                                             * 89150003
*********************************************************************** 89200003
PART6    EQU   *                                                        89250003
         NI    EWTRRFLS,ROR0F          TURN OFF FLAG BITS        Y02032 89300003
         OI    EWTRRFLS,RORSDT         SET FLAG TO SKIP DATA XFER       89350003
         MVI   EWTRRCCW,CMDRDB         SET READ BACKWARD         Y02032 89400003
*                                                                       89450003
*   TEST ORIGINAL DIRECTION                                             89500003
*                                                                       89550003
         CLI   CCWOP,CMDRED            IS IT READ?                      89600003
         BE    F005                    YES - BRANCH AROUND              89650003
         MVI   EWTRRCMD,CMDRED         NO - SET READ IN ROR CCW         89700003
F005     EQU   *                                                        89750003
         OI    EWAFLG3,EWTROR          SET READ OPPOSITE REC.    Y02032 89800003
F010     EQU   *                                                        89850003
         L     R13,EWTVIRT             GET ADDR OF FAILING CCW @ZA14734 89910003
         TM    C4(R13),CCWIDAL         IS IDAL BIT ON IN CCW?    Y02032 89950003
         BO    F030                    YES - GO SET UP IDALS     Y02032 90000003
*                                                                       90050003
         LH    R4,EWTRRCNT             GET ORIGINAL COUNT               90100003
         N     R4,MASK                 RESET HIGH ORDER BITS            90150003
         SH    R4,IOSCSWRC             SUBTRACT RESIDUAL                90200003
         STH   R4,EWTRRCNT             STORE ACTUAL COUNT               90250003
*                                                                       90300003
         IC    R0,EWTRRCMD             SAVE COMMAND              Y02032 90350003
         L     R13,EWTVIRT             GET ADDR OF FAILING CCW @ZA14734 90400003
         L     R13,0(R13)              GET DATA ADDR FROM CCW    Y02032 90450003
         LA    R13,0(R13)              ZERO HI-ORDER BYTE        Y02032 90500003
         BCTR  R4,R0                   REDUCE COUNT BY 1         Y02032 90550003
*                                                                       90600003
         CLI   EWTRRCMD,CMDRED         READ FORWARD?                    90650003
         BNE   F012                    NO - GO BUILD READ BKWD ADDR     90700003
*                                                                       90750003
*   BUILD READ FORWARD ADDRESS (ADDRESS-COUNT+1)                        90800003
*                                                                       90850003
         SR    R13,R4                  ADDRESS - (COUNT-1)              90900003
         B     F014                    GO SPACE                         90950003
*                                                                       91000003
*   BUILD READ BACKWARD ADDRESS  (ADDRESS+COUNT-1)                      91050003
*                                                                       91100003
F012     EQU   *                                                        91150003
         AR    R13,R4                  ADDRESS + (COUNT-1)              91200003
F014     EQU   *                                                        91250003
         ST    R13,EWTRRADR            STORE ADDRESS                    91300003
         STC   R0,EWTRRCMD             RESTORE COMMAND                  91350003
         BR    BALREG                  RETURN                           91400003
*                                                                       91450003
*   CALCULATE CSW RESIDUAL COUNT WHEN REBUILDING                        91500003
*   IDAL AFTER ISSUING SVC 35 (WTO WIPES OUT IDAL)                      91550003
*                                                                       91600003
F020     EQU   *                                                        91650003
         L     R13,EWTVIRT             GET ADDR OF FAILING CCW @ZA14734 91700003
         LH    R4,C6(R13)              GET USER CCW BYTE COUNT   Y02032 91750003
         SH    R4,EWTRRCNT             SUBTRACT ROR BYTE COUNT   Y02032 91800003
         STH   R4,IOSCSWRC             STORE NEW RESIDUAL IN CSW Y02032 91850003
*                                                                       91900003
*   INITIALIZE REGISTERS AND WORK AREAS                                 91950003
*                                                                       92000003
F030     EQU   *                                                        92050003
         USING USERIDAL,USEREG                                          92100003
         USING ERPIDAL,ERPREG                                           92150003
         LA    ERPREG,EWTIDAL          GET ERP IDAL ADDR (VIRT)  Y02032 92200003
         LRA   R5,EWTIDAL              GET ERP IDAL ADDR (REAL)  Y02032 92250003
         IC    R4,EWTRRCMD             SAVE ROR COMMAND          Y02032 92300003
         ST    R5,EWTRRADR             STORE REAL ADDR IN RORCCW Y02032 92350003
         STC   R4,EWTRRCMD             RESTORE COMMAND           Y02032 92400003
*                                                                       92450003
*   TRANSLATE USER IDAL ADDRESS TO VIRTUAL                              92500003
*                                                                       92550003
         LR    R4,IOSREG               SAVE IOSB ADDRESS         Y02032 92600003
         L     R1,EWTVIRT              GET ADDR OF ORIG CCW      Y02032 92650003
         L     R1,0(R1)                GET USER IDAL ADDR (REAL) Y02032 92700003
         LA    R1,0(R1)                ZERO HI-ORDER BYTE        Y02032 92750003
         LR    R5,BASREG               SAVE BASE ADDRESS (R15)   Y02032 92800003
         L     BASREG,LOC16            GET ADDRESS OF CVT        Y02032 92850003
         L     BASREG,CVTPTRV(BASREG)  GET ADDR OF TRANS RTN     Y02032 92900003
         BALR  LNKREG,BASREG           LINK TO TRANS RTN         Y02032 92950003
         LR    USEREG,R1               GET USER IDAL ADDR (VIRT) Y02032 93000003
         LR    BASREG,R5               RESTORE BASE REGISTER     Y02032 93050003
         LR    IOSREG,R4               RESTORE IOSB REGISTER     Y02032 93100003
*                                                                       93150003
*   CALCULATE NUMBER OF BYTES TRANSFERRED                               93200003
*                                                                       93250003
         L     R13,EWTVIRT             GET ADDR OF FAILING CCW @ZA14734 93300003
         LH    R4,C6(R13)              GET CCW BYTE COUNT        Y02032 93350003
         SH    R4,IOSCSWRC             SUBTRACT RESIDUAL FROM BYTE CNT  93450003
         STH   R4,EWTRRCNT             PUT # BYTES XFERRED IN ROR CCW   93500003
*                                                                       93550003
*   WAS USER DOING A FORWARD OR BACKWARD READ?                          93600003
*                                                                       93650003
         L     R5,UIDAL                GET 1ST ENTRY IN USER IDAL LIST  93700003
         CLI   EWTRRCMD,CMDRDB         READ BACKWARD?            Y02032 93750003
         BNE   F100                    YES - GO CONTINUE SETUP   Y02032 93800003
         A     R5,ONEPAGE              NO - ADD 2048 TO FIRST ENTRY     93850003
*                                                                       93900003
*   FIND NUMBER OF BYTES IN USER FIRST PAGE                             93950003
*                                                                       94000003
F100     EQU   *                                                        94050003
         SRA   R5,ELEVEN               ROUND OFF TO PAGE BY SHIFTING    94100003
         SLA   R5,ELEVEN               OFF BITS 20 - 31          Y02032 94150003
         S     R5,UIDAL                SUBTRACT FIRST ENTRY      Y02032 94200003
         LPR   R5,R5                   GET ABSOLUTE VALUE        Y02032 94250003
*                                                                       94300003
         CLI   EWTRRCMD,CMDRDB         WAS USER CMD READ BKWD?   Y02032 94350003
         BE    F200                    NO - NOBIFP VALID, BRANCH        94400003
         A     R5,ONE                  YES - ADD 1 TO NOBIFP     Y02032 94450003
*                                                                       94500003
F200     EQU   *                                                        94550003
         ST    R5,EWTNBFP              SAVE # BYTES IN 1ST PAGE  Y02032 94600003
*                                                                       94650003
*   FIND NUMBER OF USER IDAL ENTRIES IN THE LIST                        94700003
*   R4 CONTAINS NUMBER OF BYTES TRANSFERRED                             94750003
*                                                                       94800003
         CL    R4,EWTNBFP              ONLY ONE ENTRY REQUIRED          94850003
         BH    F250                    NO - CONTINUE CALC IDAL          94900003
         ST    R4,EWTNBFP              SAVE BYTES FOR ONE IDAL          94950003
         MVC   EWTRES,FZERO            SET RESIDUAL CNT TO ZERO         95000003
         L     R4,FZERO                SET INDEX TO ZERO                95050003
         B     F400                    GET OUT OF LOOP                  95100003
*                                                                       95150003
F250     EQU    *                                                       95200003
         S     R4,EWTNBFP              CALCULATE RESIDUAL COUNT  Y02032 95250003
         ST    R4,EWTRES               SAVE RESIDUAL COUNT       Y02032 95300003
         L     R4,FZERO                SET INDEX TO 0            Y02032 95350003
*                                                                       95400003
F300     EQU   *                                                        95450003
         A     R4,FOUR                 ADD FOUR TO USER INDEX    Y02032 95500003
         CLC   EWTRES,ONEPAGE          RESIDUAL <= 2048?         Y02032 95550003
*                                      (MEANS ALL ENTRIES FOUND) Y02032 95600003
         BNH   F400                    YES - GET OUT OF LOOP     Y02032 95650003
*                                                                       95700003
         L     R13,EWTRES              NO - GET RESIDUAL COUNT   Y02032 95750003
         S     R13,ONEPAGE             SUBTRACT 2048             Y02032 95800003
         ST    R13,EWTRES              SAVE RESIDUAL COUNT       Y02032 95850003
         B     F300                    LOOP BACK                 Y02032 95900003
         EJECT                                                          95950003
*                                                                       96000003
*                   C R E A T E   E R P   I D A L                       96050003
*                                                                       96100003
F400     EQU   *                                                        96150003
         CLI   EWTRRCMD,CMDRDB         WAS COMMAND READ BACK?    Y02032 96200003
         BE    F410                    NO - VALUES VALID, BR     Y02032 96250003
*                                                                       96300003
         L     R13,EWTRES              YES - GET RESIDUAL CNT    Y02032 96350003
         LCR   R13,R13                 SET TO NEGATIVE FOR RDB   Y02032 96400003
         ST    R13,EWTRES              SAVE                      Y02032 96450003
*                                                                       96500003
         L     R13,EWTNBFP             GET # BYTES IN 1ST PAGE   Y02032 96550003
         LCR   R13,R13                 SET TO NEGATIVE FOR RDB   Y02032 96600003
         ST    R13,EWTNBFP             SAVE                      Y02032 96650003
*                                                                       96700003
         L     R13,ONE                 GET VALUE - 1             Y02032 96750003
         LCR   R13,R13                 SET TO NEGATIVE FOR RDB   Y02032 96800003
         ST    R13,EWTC1               SAVE                      Y02032 96850003
*                                                                       96900003
         L     R13,F2047               GET VALUE - 2047          Y02032 96950003
         LCR   R13,R13                 SET TO NEGATIVE FOR RDB   Y02032 97000003
         ST    R13,EWTC7FF             SAVE                      Y02032 97050003
         B     F500                    CONTINUE TO SETUP IDAL           97100003
*                                                                       97150003
F410     EQU   *                                                        97200003
         MVC   EWTC1,ONE               SET CONSTANT TO ONE              97250003
         MVC   EWTC7FF,F2047           SET CONSTANT TO 2047             97300003
*                                                                       97350003
*   SUBTRACT VALUE FROM RESIDUAL COUNT TO GET FINAL COUNT               97400003
*   SUBTRACT VALUE FROM NOBIFP TO GET COUNT FOR FINAL ERP IDAL ENTRY    97450003
*                                                                       97500003
F500     EQU   *                                                        97550003
         L     R13,EWTRES              GET RESIDUAL COUNT        Y02032 97600003
         S     R13,EWTC1               SUBTRACT NEG OR POS 1     Y02032 97650003
         ST    R13,EWTRES              SAVE                      Y02032 97700003
*                                                                       97750003
         L     R13,EWTNBFP             GET # BYTES IN 1ST PAGE   Y02032 97800003
         S     R13,EWTC1               SUBTRACT NEG OR POS 1     Y02032 97850003
         ST    R13,EWTNBFP             SAVE                      Y02032 97900003
*                                                                       97950003
         CL    R4,FZERO                IS THIS THE LAST ENTRY?   Y02032 98000003
         BE    F700                    YES - GO CALC LAST ERP ENTRY     98050003
*                                                                       98100003
*   CALCULATE ENTRY FOR ERP IDAL LIST                                   98150003
*                                                                       98200003
         L     R13,UIDAL(R4)           GET LAST ENTRY FROM USER IDAL    98250003
         A     R13,EWTRES              ADD RESIDUAL COUNT        Y02032 98300003
*                                                                       98350003
F600     EQU   *                                                        98400003
         ST    R13,EIDAL               MOVE IN CALC. ERP ENTRY   Y02032 98450003
         S     R4,FOUR                 SUB. FOUR FROM USER INDEX Y02032 98500003
         LA    ERPREG,C4(ERPREG)       INCR TO NEXT ERP ENTRY    Y02032 98550003
*                                                                       98600003
*   IS THIS THE LAST ERP IDAL ENTRY TO BE CREATED?                      98650003
*                                                                       98700003
         CL    R4,FZERO                IS THIS THE LAST ENTRY?   Y02032 98750003
         BE    F700                    YES - GO CALC LAST ERP ENTRY     98800003
*                                                                       98850003
*   CALCULATE NEXT ERP IDAL ENTRY                                       98900003
*                                                                       98950003
         L     R13,UIDAL(R4)           GET NEXT USER ENTRY       Y02032 99000003
         A     R13,EWTC7FF             ADD 2047                  Y02032 99050003
         B     F600                    BRANCH BACK THRU LOOP     Y02032 99100003
*                                                                       99150003
*   CALCULATE LAST ERP IDAL ENTRY                                       99200003
*                                                                       99250003
F700     EQU   *                                                        99300003
         L     R13,UIDAL(R4)           GET LAST USER ENTRY       Y02032 99350003
         A     R13,EWTNBFP             ADD # BYTES IN 1ST PAGE   Y02032 99400003
         ST    R13,EIDAL               PUT IN LAST ERP IDAL ENTRY       99450003
         L     UXREG,UCBXTN            RESET REG TO UCB EXT.     Y02032 99500003
         LA    UXREG,0(UXREG)          GET 3-BYTE ADDRESS        Y02032 99550003
         NI    EWAFLG3,X'FF'-EWTRBLD   RESET REBUILD IDAL BIT    Y02032 99600003
         LA    EXITREG,RETN            RESTORE SVC 15/3 ADDR     Y02032 99650003
         BR    BALREG                  RETURN                    Y02032 99700003
*************    E N D   O F   P A R T   6    *************             99750003
PATCH    DC    (4096-(PATCH-ERP1))X'00'                                 99800037
         EJECT                                                          99900003
         IECDERWA  EWT                                                  99950003
         EJECT                                                          99960003
         IECDIOSB                                                       99970003
         EJECT                                                          99980003
         IEFUCBOB  PREFIX=YES                                           99990003
         END                                                            99992003
./  ADD  SSI=81390019,NAME=IGE0100I
         TITLE 'IGE0100I       LOAD 2       1/2 INCH MAG TAPE ERP''S'   00050003
         MACRO                                                          00060003
         DATEM                                                          00070003
         LCLC  &FILL                                                    00080003
&FILL    SETC  'CL8'.''''.'&SYSDATE'.''''                               00090003
         DC    &FILL                                                    00092003
         MEND                                                           00094003
IGE0100I START X'00'                   LOAD 2                           00100003
*                                                                       00150003
*********************************************************************** 00200003
*                                                                     * 00250003
* STATUS:                                                             * 00300003
*    CHANGE LEVEL:  VS2/REL3                                          * 00350003
*                                                                     * 00400003
* FUNCTION/OPERATION:                                                 * 00450003
*    PART 1 - ERP ERRORS                                              * 00500003
*        1.  PRINT A MESSAGE AND REISSUE SIO IF ERG.  CONTINUE IF     * 00550003
*            NOISE ON USER READ OR NOISE ON ERP READ.                 * 00600003
*        2.  PRINT A MESSAGE AND REISSUE SIO IF AN UNSOLICITED        * 00650003
*            DEVICE END FROM A NEW DEVICE TYPE.                       * 00700003
*        3.  PRINT A MESSAGE AND EXIT WITH PERMANENT ERROR IF AN      * 00750003
*            IOB INTERCEPT ON DATA SECURITY ERASE ON A NEW            * 00800003
*            DEVICE TYPE.                                             * 00850003
*        4.  EXIT WITH PERMANENT ERROR IF OTHER IOB INTERCEPT         * 00900003
*            CONDITION                                                * 00950003
*        5.  HANDLE UNIT CHECK DURING REPOSITIONING                   * 01000003
*    PART 4 - TAPE ERRORS                                             * 01050003
*        1.  HANDLE ERRORS OTHER THAN NORMAL DATA CHECK ON READ       * 01100003
*            OR WRITE TYPE COMMANDS AND REPOSITIONING ERRORS.         * 01150003
*        2.  ENTERED FROM LOAD 1 FOR:                                 * 01200003
*            A.  UNIT CHECK AND NO SENSE DATA                         * 01250003
*            B.  UNIT CHECK AND SENSE - CR, IR, BO, EQ, OR            * 01300003
*            C.  LOAD POINT ON READ                                   * 01350003
*            D.  CHANNEL DATA CHECK                                   * 01400003
*    PART 9 - ICC AND CCC                                             * 01450003
*        1.  ANALYZE THE ERROR RECOVERY INTERFACE BLOCK (ERPIB)       * 01500003
*            TO DETERMINE WHETHER OR NOT A CHANNEL ERROR CONDITION    * 01550003
*            CAN BE RETRIED.                                          * 01600003
*        2.  IF SO, THE CHANNEL PROGRAM IS RETRIED ONLY ONCE.         * 01650003
*        3.  IF THE ERROR IS NOT RECOVERED ON RETRY OR IS A NON-      * 01700003
*            RETRIABLE TYPE, THEN IT IS TO BE CONSIDERED A            * 01750003
*            PERMANENT ERROR.  THE LOGOUT BIT IS SET AND CONTROL      * 01800003
*            IS TRANSFERRED TO THE WRITE-TO-OPERATOR ROUTINE.         * 01850003
*                                                                     * 01900003
* ENTRY POINTS:                                                       * 01950003
*        ER2402 IS CALLED BY IGE0000I (LOAD 1) VIA XCTL               * 02000003
*                                                                     * 02050003
* INPUT:                                                              * 02100003
*    REGISTER 1 CONTAINS A POINTER TO THE IOSB                        * 02150003
*                                                                     * 02200003
* OUTPUT:                                                             * 02250003
*    SEVEN SPECIAL CONSOLE MESSAGES - VIA SVC 35                      * 02300003
*        ERRMSG1   'ERROR ON ERG'                                     * 02350003
*        ERRMSG2   'NOISE - USER'                                     * 02400003
*        ERRMSG3   'NOISE - ERP '                                     * 02450003
*        ERRMSG4   'UNEX INTRPT '                                     * 02500003
*        ERRMSG5   'DSE FAILED  '                                     * 02550003
*        ERRMSG6   'CTRL BLK ERR'                                     * 02600003
*        ERRMSG7   'UNEX LOAD PT'                                     * 02650003
*                                                                     * 02700003
* EXTERNAL ROUTINES:                                                  * 02750003
*    INTERPRETER ROUTINE - CHECKS SENSE & STATUS BITS                 * 02800003
*                                                                     * 02850003
* EXITS - NORMAL:                                                     * 02900003
*         1.  SVC 15/3 EXIT TO IOS TO REPOSITION TAPE AND TO          * 02950003
*             REEXECUTE THE CHANNEL PROGRAM.                          * 03000003
*         2.  XCTL TO IGE0000I (LOAD 1)                               * 03050003
*         3.  XCTL TO IGE0025C (WTO ROUTINE)                          * 03100003
*         4.  XCTL TO IGE0025F (OBR ROUTINE)                          * 03150003
*                                                                     * 03200003
* EXITS - ERROR:  N/A                                                 * 03250003
*                                                                     * 03300003
* TABLES/WORK AREAS:                                                  * 03350003
*    THE ERPIB TABLE IS ANALYZED TO DETERMINE IF THE ERROR            * 03400003
*    CONDITION CAN BE RETRIED.                                        * 03450003
*                                                                     * 03500003
* ATTRIBUTES:                                                         * 03550003
*    REENTRANT                                                        * 03600003
*                                                                     * 03650003
* NOTES:                                                              * 03700003
*    VS2/REL2 - LOADS 2, 4, 8 & 9 OF PREVIOUS RELEASES HAVE           * 03750003
*    BEEN COMBINED TO CREATE LOAD 2 OF THIS RELEASE.                  * 03800003
*    THIS LOAD INCLUDES:                                              * 03850003
*        1.  HANDLING ALL ERP-GENERATED ERRORS                        * 03900003
*        2.  HANDLING TAPE ERRORS OTHER THAN NORMAL DATA CHECK        * 03950003
*            ON READ OR WRITE.                                        * 04000003
*        3.  INTERFACE CONTROL CHECK                                  * 04050003
*        4.  CHANNEL CONTROL CHECK                                    * 04100003
*                                                                     * 04150003
*    PTM YM6412  REPOSITION BIT NOT TURNED OFF ON PERM ERR EXIT       * 04200003
*    APAR FIX TO IOSGEN MACRO USAGE                          @OZ00664 * 04210003
*    APAR FIX TO IOSGEN MACRO USAGE                          @ZA05134 * 04220003
*    FIX FOR LOW CORE OVERLAY PROBLEM                        @ZA14748 * 04230003
*    ROUTE AND DESCRIPTOR CODES                              @ZA30415 * 04240037
*    TURN ON EWADDMSG FOR WTO                                @ZA31011 * 04245037
*********************************************************************** 04250003
         EJECT                                                          04300003
*              R E G I S T E R   A S S I G N M E N T S                  04350003
*                                                                       04400003
R0       EQU   0                       WORK REG                         04450003
R1       EQU   1                       WORK REG                         04500003
IOSREG   EQU   1                       IOSB REG                         04550003
MSGREG   EQU   2                       MESSAGE REGISTER                 04600003
CCWREG   EQU   3                       CCW ADDRESS REG                  04650003
R4       EQU   4                       WORK REGISTER                    04700003
R5       EQU   5                       WORK REGISTER                    04750003
UCBREG   EQU   7                       UCB ADDRESS REGISTER             04800003
UXREG    EQU   8                       UCB EXTENSION ADDRESS            04850003
SAVREG   EQU   9                       SAVE REGISTER                    04900003
EWAREG   EQU   10                      EXTENDED WORK AREA               04950003
R11      EQU   11                      WORK REGISTER                    05000003
R13      EQU   13                      WORK REGISTER                    05050003
LNKREG   EQU   14                      LINK REGISTER                    05100003
XCTLREG  EQU   14                      RETURN REGISTER FOR XCTL         05150003
BASREG   EQU   15                      BASE REGISTER                    05200003
         EJECT                                                          05250003
*                                                                       05300003
*                U S E R   C C W   D S E C T                            05350003
*                                                                       05400003
CCW      DSECT                         ERROR CCW IN USER'S CHAIN        05450003
CCWOP    DS    CL1                     CCW COMMAND CODE                 05500003
         ORG   CCWOP                   **                               05550003
CCWADR   DS    CL4                     CCW DATA ADDRESS                 05600003
CCWFLS   DS    CL2                     CCW FLAGS                        05650003
CCWCNT   DS    CL2                     CCW BYTE COUNT                   05700003
         EJECT                                                          05750003
*                                                                       05800003
*   EWACNT1 - ERROR COUNT 1 REFERENCES                                  05850003
*                                                                       05900003
OVRCNT5  EQU   X'50'                   OVERRUN COUNT MAX. VALUE         05950003
WRTIND   EQU   X'80'                   INDICATOR TO STAT ROUTINE        06000003
ERPCTL   EQU   X'08'                   ERP CONTROL FLAG                 06050003
ICCFLG   EQU   X'80'                   ICC/CCC FLAG                     06100003
*                                                                       06150003
*                                                                       06160003
*   EWAFLG3 - EWA FLAG 3 REFERENCES                                     06200003
*                                                                       06250003
EWTROR   EQU   X'80'                   READ OPPOSITE IN PROGRESS        06300003
EWTRTN2  EQU   X'40'                   RETURN FROM LOAD 2               06350003
EWTTPC   EQU   X'20'                   TAPE CLEANING BIT                06400003
EWTBKS   EQU   X'10'                   BACKSPACE ERASE CLEANING FLAG    06450003
EWTOVER  EQU   X'08'                   SDR OVERFLOW                     06500003
EWTPT4A  EQU   X'04'                   ENTRY FOR LOAD 2, PART 4A        06550003
EWTPT4B  EQU   X'02'                   ENTRY FOR LOAD 2, PART 4B        06600003
EWTRBLD  EQU   X'01'                   REBUILD IDAL LIST                06650003
*                                                                       06700003
*   EWACNTR3 - EWA COUNTER 3 REFERENCES                                 06750003
*                                                                       06800003
EWTUEX   EQU   X'80'                   UNIT EXCEPTION FLAG              06850003
EWTNB    EQU   X'40'                   NOISE BIT                        06900003
EWTRST   EQU   X'20'                   RESTART FLAG                     06950003
EWTROC   EQU   X'10'                   USE ROR CCW                      07000003
EWTEXIT  EQU   X'02'                   TEMPORARY ERROR EXIT FLAG        07050003
EWTDEP   EQU   X'01'                   DEVICE END POST BIT              07100003
*                                                                       07150003
*   DEB REFERENCES                                                      07200003
*                                                                       07250003
DEBOFL   EQU   8                       DEBOFLGS                         07300003
*                                                                       07350003
*   DCB REFERENCES                                                      07400003
*                                                                       07450003
DCBBLK   EQU   12                      DCB BLOCK COUNT                  07500003
*                                                                       07550003
*   COMMANDS                                                            07600003
*                                                                       07650003
CMDCTL   EQU   X'03'                   CONTROL                          07700003
CMDERG   EQU   X'17'                   ERASE GAP                        07750003
CMDBSR   EQU   X'27'                   BACK SPACE RECORD                07800003
CMDRDB   EQU   X'0C'                   READ BACKWARDS                   07850003
CMDRWU   EQU   X'0F'                   REWIND UNLOAD                    07900003
CMDWRT   EQU   X'01'                   WRITE                            07950003
CMDTIC   EQU   X'08'                   TIC                              08000003
CMDTIE   EQU   X'1B'                   TIE                              08050003
CMDREW   EQU   X'07'                   REWIND                           08100003
CMDRED   EQU   X'02'                   READ COMMAND                     08150003
CMDWTM   EQU   X'1F'                   WRITE TAPE MARK                  08200003
CMDBSF   EQU   X'2F'                   BACKSPACE FILE                   08250003
CMDFSR   EQU   X'37'                   FORWARD SPACE RECORD             08300003
CMDFSF   EQU   X'3F'                   FORWARD SPACE FILE               08350003
CMDNOP   EQU   X'03'                   NOP                              08400003
CMDMD1   EQU   X'03'                   MODE SETS (LO-ORDER 4 BITS)      08450003
CMDBIT4  EQU   X'08'                   MODE SET (BIT 4)                 08500003
CMDBIT5  EQU   X'04'                   MODE SET (BIT 5)                 08550003
CMDSNS   EQU   X'04'                   SENSE                            08600003
*                                                                       08650003
*   STATUS INDICATORS                                                   08700003
*                                                                       08750003
CSWDVE   EQU   X'04'                   DEVICE END                       08800003
CSWUCK   EQU   X'02'                   UNIT CHECK                       08850003
CSWUEX   EQU   X'01'                   UNIT EXCEPTION                   08900003
CSWCDC   EQU   X'08'                   CHANNEL DATA CHECK               08950003
CSWCCC   EQU   X'04'                   CHANNEL CONTROL CHECK            09000003
CSWICC   EQU   X'02'                   INTERFACE CONTROL CHECK          09050003
         EJECT                                                          09100003
*                                                                       09150003
*                  M I S C E L L A N E O U S                            09200003
*                                                                       09250003
APPEND   EQU   X'01'                   APPENDAGE BIT                    09300003
BLANK    EQU   X'40'                   EBCDIC BLANK                     09350003
BLKCNT   EQU   12                      BLK COUNT OFFSET FROM DCB        09400003
CNT3     EQU   X'40'                   3 RETRIES                        09450003
C1       EQU   1                       COUNT OF 1                       09500003
C2       EQU   2                       COUNT OF 2                       09550003
C3       EQU   3                       COUNT OF 3                       09600003
C4       EQU   4                       COUNT OF 4                       09650003
C5       EQU   5                       COUNT OF 5                       09700003
C6       EQU   6                       COUNT OF 6                       09750003
C8       EQU   8                       COUNT OF 8                       09800003
C16      EQU   16                      COUNT OF 16                      09850003
C61      EQU   61                      COUNT OF 61                      09900003
C288     EQU   288                     COUNT OF 288                     09950003
EMUL     EQU   X'10'                   EMULATOR BIT                     10000003
EXCPER   EQU   15                      ERROR EXCP                       10050003
FULL     EQU   X'FF'                   COUNTER FULL                     10100003
HEXC7    EQU   X'C7'                   HEX 'C7'                         10150003
HEX24    EQU   X'18'                   COUNT OF 24                      10200003
HEX80    EQU   X'80'                   HEX '80'                         10250003
HEXF9    EQU   X'F9'                   HEX 'F9'                         10300003
IOSCRC   EQU   X'08'                   CRC FLAG                         10350003
IOSREP   EQU   X'10'                   REPOSITION FLAG                  10400003
LOAD1    EQU   9                       LOAD NAME FOR LOAD 1             10450003
LOC16    EQU   16                      COMMUNICATION VECTOR TABLE       10500003
MASK     DC    X'0000FFFF'             COMPARE MASK                     10510003
PROG     EQU   X'FF'                   ERP IN PROGRESS                  10550003
RETURN   EQU   3                       EXIT SVC                         10600003
SERLOG   EQU   256                     LOAD NAME TO OBR                 10650003
TRCOMMA  EQU   X'EE'                   WILL TRANSLATE TO ','            10700003
VECTXL   EQU   44                      VECTOR TO XCTL ROUTINE           10750003
VECT68   EQU   68                      INTERPRETER ROUTINE              10800003
WTORTN   EQU   253                     LOAD NAME TO WTO ROUTINE         10850003
ZERO     EQU   X'00'                   ZERO                             10900003
*                                                                       10950003
*                                                                       11000003
         EJECT                                                          11050003
*                                                                       11100003
*           MISCELLANEOUS - FOR PART 9                                  11150003
*                                                                       11200003
*   ERPIB BYTE 4 REFERENCES                                             11250003
*                                                                       11300003
IBUNR1   EQU   X'31'                   UNR OR TIO OR HIO                11350003
IBSIB1   EQU   X'C0'                   SIO OR I/O RUPT BITS             11400003
IBSIO1   EQU   X'80'                   SIO BIT                          11450003
IBSNS1   EQU   X'04'                   VALID SENSE                      11500003
*                                                                       11550003
*   ERPIB BYTE 6 REFERENCES                                             11600003
*                                                                       11650003
IBALL2   EQU   X'1C'                   VALIDITY BITS                    11700003
*                                                                       11750003
*   ERPIB BYTE 7 REFERENCES                                             11800003
*                                                                       11850003
IB3001   EQU   X'01'                   00 001                           11900003
IB3002   EQU   X'02'                   00 010                           11950003
IB3003   EQU   X'03'                   00 011                           12000003
IB3004   EQU   X'04'                   00 100                           12050003
IB3005   EQU   X'05'                   00 101                           12100003
IB3041   EQU   X'41'                   01 001                           12150003
IB3042   EQU   X'42'                   01 010                           12200003
IB3043   EQU   X'43'                   01 011                           12250003
IB3045   EQU   X'45'                   01 101                           12300003
IB3081   EQU   X'81'                   10 001                           12350003
IB3082   EQU   X'82'                   10 010                           12400003
IB30C0   EQU   X'C0'                   11 000                           12450003
IGE0100I CSECT                                                          12500003
* A-000000-999999                                                Y026XZ 12550003
         EJECT                                                          12600003
*********************************************************************** 12650003
*                             P A R T   1                             * 12700003
*                                                                     * 12750003
*                             ERP  ERRORS                             * 12800003
*********************************************************************** 12850003
         USING *,BASREG                                                 12900003
         USING IOSB,IOSREG                                              12950003
         USING EWA,EWAREG                                               13000003
         USING UCB,UCBREG                                               13050003
         USING UCBMT,UXREG                                              13100003
         USING CCW,CCWREG                                               13150003
ERP2     B     ER2402                  BRANCH AROUND DECLARE            13200003
         DC    C'** IGE0100I-TAPE ERP 08-21-74 **'       **             13250003
         DS    0F                      ALIGN                            13300003
ER2402   EQU   *                                                        13350003
         L     UCBREG,IOSUCB           GET UCB ADDRESS FROM IOSB        13400003
         SH    UCBREG,H512             POINT TO UCB PREFIX       Y02032 13450003
         L     UXREG,UCBXTN            GET ADDR OF UCB EXTENSION        13500003
*                                                                       13550003
         L     EWAREG,IOSERP           GET EWA ADDR FROM IOSB    Y02032 13600003
         L     CCWREG,IOSCSW-C1        GET ADDRESS TO CCW               13650003
         LA    CCWREG,0(CCWREG)        CLEAR HIGH ORDER BYTE     A29974 13700003
         SH    CCWREG,EIGHT            POINT TO FAILING COMMAND         13750003
*                                                                       13800003
         TM    IOSTSB,CSWCCC+CSWICC    IS ICC OR CCC ON?                13850003
         BC    7,PART9                 YES - GO TO PART 9               13900003
*                                                                       13950003
         TM    EWAFLG3,EWTPT4A         ENTRY TO PART 4A?         Y02032 14000003
         BO    PART4A                  YES - GO TO PART 4               14050003
*                                                                       14100003
         TM    EWAFLG3,EWTPT4B         ENTRY TO PART 4B?         Y02032 14150003
         BO    PART4B                  YES - GO TO PART 4B              14200003
*                                                                       14250003
         CLI   IOSCOD,IOSTAPEC         X'4B' IN COMPLETION CODE? A29974 14300003
         BE    B223                    YES - GO TO PERM ERROR    A29974 14350003
         LA    MSGREG,ERRMSG4          GET ERROR MSG ADDR        S21048 14400003
*                                                                       14450003
         TM    IOSFLC,IOSVERIF         UNSOLICITED DEVICE END?   S21048 14500003
         BO    B325                    YES-GO SET UP WTO MACRO   S21048 14550003
*                                                                       14600003
         CLI   IOSCOD,IOSFINTC         IOB INTERCEPT                    14650003
         BNE   B200                    NO - CONTINUE                    14700003
*                                                                       14750003
*   I O B   I N T E R C E P T                                           14800003
*                                                                       14850003
         TM    UCBTBYT4,UCB3400        3400 TAPE UNIT?                  14900003
         BNO   B100                    NO - BRANCH AROUND DSE    S21048 14950003
         LA    MSGREG,ERRMSG5          SET FOR DSE FAIL MSG      S21048 15000003
         TM    EWTSNS7,EWTDSE          DSE ERR BIT ON IN SENSE?  S21048 15050003
         BO    B325                    YES-GO SET UP WTO MACRO   S21048 15100003
*                                                                       15150003
B100     EQU   *                                                        15200003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA   RESET ERP FLAGS   @YM06412 15250003
         MVI   IOSCOD,IOSINTC          SET INTERCEPT CODE TO X'44'      15300003
         B     B370                    EXIT ERP VIA SVC 15/3 OR OBR     15350003
         EJECT                                                          15400003
*                                                                       15450003
*                        U N I T   C H E C K                            15500003
*                                                                       15550003
*        HAVE UNIT CHECK - CHECK SENSE IN SEQUENCE                      15600003
*        1.  DATA CHECK, NOT REPOSITIONING, IS NOISE RECORD             15650003
*        2.  ALL OTHER CONDITIONS ARE UNIT CHECK DURING REPOSITIONING   15700003
*              BUS OUT                 POSSIBLE ANYTIME                 15750003
*              INTERVENTION REQUIRED   POSSIBLE ANYTIME                 15800003
*              LOAD POINT              BSR ONLY                         15850003
*              DATA CHECK              ERG ONLY                         15900003
*              OVERRUN ERG                                              15950003
*              ANY OTHER SENSE         LOGOUT                           16000003
*        3.  EQUIPMENT CHECK IS VALID ERROR ONLY WITH DEVICE END        16050003
*                                                                       16100003
*        REGS 0,9,11,12,14,15 ARE AFFECTED BY INTERPRETER               16150003
*                                                                       16200003
B200     EQU   *                                                        16250003
         TM    EWTSNS0,EWTEQU          EQUIPMENT CHECK?          Y02032 16300003
         BZ    B205                    NO - CONTINUE TEST        Y02032 16350003
         TM    IOSTSA,CSWDVE           DEVICE END?               Y02032 16400003
         BO    D840                    YES - XCTL TO WTO         Y02032 16450003
*                                                                       16500003
B205     EQU   *                                                        16550003
         LR    SAVREG,BASREG           SAVE REG 15                      16600003
         L     BASREG,LOC16            GET ADDR OF CVT                  16650003
         L     BASREG,VECT68(BASREG)   GET INTERPRETER ADDRESS          16700003
B210     EQU   *                                                        16750003
         BALR  LNKREG,BASREG           LINK TO INTERPRETER RTN          16800003
*                                                                       16850003
         DC    X'02'                   BUS OUT CHECK                    16900003
         DC    AL1(B220-B210-2)        *                                16950003
         DC    X'01'                   INTERVENTION REQUIRED            17000003
         DC    AL1(B240-B210-4)        *                                17050003
         DC    X'00'                   COMMAND REJECT                   17100003
         DC    AL1(B250-B210-6)        *                                17150003
         DC    X'05'                   OVERRUN                          17200003
         DC    AL1(B220-B210-8)        *                                17250003
         DC    X'0C'                   LOAD POINT                       17300003
         DC    AL1(B260-B210-10)       *                                17350003
         DC    X'04'                   DATA CHECK                       17400003
         DC    AL1(B270-B210-12)       *                                17450003
         DC    X'2F'                   END OF TEST                      17500003
         DC    AL1(B250-B210-14)       *                                17550003
*                                                                       17600003
*   B U S   O U T   C H E C K ,   O V E R R U N                         17650003
*                                                                       17700003
B220     EQU   *                                                        17750003
         TM    EWACNTR1,OVRCNT5        5 BUS OUTS?               Y02032 17800003
         BO    D840                    YES - XCTL TO WTO                17850003
*                                                                       17900003
         IC    R13,EWACNTR1            GET COUNT                 Y02032 17950003
         LA    R13,C16(R13)            ADD ONE TO COUNT                 18000003
         STC   R13,EWACNTR1            STORE COUNT               Y02032 18050003
*                                                                       18100003
         LTR   CCWREG,CCWREG           NEGATIVE ADDRESS?         A29974 18150003
         BNM   B225                    NO - CONTINUE             A29974 18200003
B222     EQU   *                                                        18250003
         MVI   IOSCOD,IOSTAPEC         PUT X'4B' IN IOSB CODE    A29974 18300003
B223     EQU   *                                                        18350003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA  MARK AS PERM ERROR @YM06412 18400003
         LA    MSGREG,ERRMSG6          SET FOR CONTROL BLK MSG   A29974 18450003
         B     B327                    GO SET UP MSG FOR WTO     A29974 18500003
*                                                                       18550003
B225     EQU   *                                                        18600003
         CLI   CCWOP,CMDCTL            BUS OUT ON NOP?           A29974 18650003
         BNE   B405                    NO - BSR DONE - SVC 15/3         18700003
*                                                                       18750003
*   HAD BUS OUT ON NOP COMMAND FETCH.                                   18800003
*   GO TO LOAD 1 - IGNORE BUS OUT.                                      18850003
*                                                                       18900003
         OI    EWAFLG3,EWTRTN2         SET LOAD 2 RETURN BIT     Y02032 18950003
         LA    R13,LOAD1               GET LOAD 1 ADDRESS               19000003
         B     XCTL3                   XCTL TO LOAD 1                   19050003
*                                                                       19100003
*   I N T E R V E N T I O N   R E Q U I R E D                           19150003
*                                                                       19200003
B240     EQU   *                                                        19250003
         TM    IOSTSA,CSWDVE           DEVICE END?                      19300003
         BO    B245                    YES - SET UP MESSAGE      Y02032 19350003
*                                                                       19400003
         TM    EWTSNS1,EWTSTA+EWTSTB   NON-EXISTENT UNIT?        Y02032 19450003
         BZ    D840                    YES - PERM ERROR, XCTL TO WTO    19500003
         B     D870                    NO - XCTL TO WTO          Y02032 19550003
*                                                                       19600003
B245     EQU   *                                                        19650003
         LA    MSGREG,ERRMSG1          SET FOR 'ERASE GAP' MSG          19700003
         TM    IOSSNS,EWTDATA          IS IT DATA CHECK?         Y02032 19750003
         BO    B270                    YES - MUST BE ERG                19800003
*                                                                       19850003
*   E Q U I P   C H E C K,    D A T A   C H E C K,                      19900003
*   C O M M A N D   R E J E C T   OR NONE                               19950003
*                                                                       20000003
B250     EQU   *                                                        20050003
         B     D840                    XCTL TO WTO                      20100003
*                                                                       20150003
*   L O A D   P O I N T                                                 20200003
*                                                                       20250003
B260     EQU   *                                                        20300003
         TM    EWAFLG3,EWTTPC          TAPE CLEANER ACTION       Y02032 20350003
         BO    B380                    YES - GO SET UP TO REPOSITION    20400003
*                                                                       20450003
         MVI   IOSCOD,IOSTAPEC         PUT X'4B' IN IOSB CODE    A29972 20500003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA  MARK PERM ERROR    @YM06412 20550003
         LA    MSGREG,ERRMSG7          SET FOR LOAD POINT MSG    A29972 20600003
         B     B330                    GO SET UP MESSAGE         A29972 20650003
*                                                                       20700003
B270     EQU   *                                                        20750003
         TM    EWAFLG3,EWTROR          ROR IN PROGRESS?          Y02032 20800003
         BO    B280                    YES - CONTINUE                   20850003
         TM    IOSFLA,IOSREP           REPOSITIONING?                   20900003
         BO    B310                    YES - GO UPDATE ERG COUNT        20950003
*                                                                       21000003
B280     EQU   *                                                        21050003
         TM    UCBNB,FULL              IS NOISE COUNT FULL?             21100003
         BO    B290                    YES - BRANCH AROUND COUNT        21150003
         IC    R13,UCBNB               GET NOISE COUNT                  21200003
         LA    R13,C1(R13)             ADD ONE TO COUNT                 21250003
         STC   R13,UCBNB               STORE BACK                       21300003
*                                                                       21350003
B290     EQU   *                                                        21400003
         L     R13,EWTDEB              GET DEB ADDRESS           Y02032 21450003
         CL    R13,FZERO               VALID DEB ADDR            Y02032 21500003
         BE    B300                    NO - SKIP EMULATOR        Y02032 21550003
         TM    DEBOFL(R13),EMUL        IS EMULATOR BIT ON?              21600003
         BZ    B300                    NO - SKIP PERMANENT ERROR BIT    21650003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA  PERMANENT ERROR    @YM06412 21700003
*                                                                       21750003
*   TEST FOR PREVIOUS MESSAGE                                           21800003
*                                                                       21850003
B300     EQU   *                                                        21900003
         TM    EWACNTR3,EWTNB          PREVIOUS MESSAGE?         Y02032 21950003
         BO    B370                    YES - DON'T WRITE MESSAGE        22000003
         OI    EWACNTR3,EWTNB          NO - SET MESSAGE SWITCH   Y02032 22050003
         LA    MSGREG,ERRMSG2          SET FOR USER MESSAGE             22100003
         TM    EWACNTR2,PROG           IS ERP IN PROGRESS?       Y02032 22150003
         BZ    B330                    NO - BRANCH TO WRITE MESSAGE     22200003
         LA    MSGREG,ERRMSG3          YES - SET FOR ERP MESSAGE        22250003
         B     B330                    BRANCH TO WRITE MESSAGE          22300003
*                                                                       22350003
*   UPDATE ERG DATA CHECK COUNT                                         22400003
*                                                                       22450003
B310     EQU   *                                                        22500003
         IC    R13,EWACNTR2            GET ERG COUNTER           Y02032 22550003
         LA    R13,C16(R13)            ADD ONE TO COUNT                 22600003
         STC   R13,EWACNTR2            STORE UPDATED COUNT       Y02032 22650003
         LH    R13,UCBERG              GET ERG COUNT                    22700003
         CH    R13,ALLF                IS COUNT FULL?                   22750003
         BE    B320                    YES - BRANCH AROUND COUNT        22800003
         LA    R13,C1(R13)             ADD ONE TO COUNT                 22850003
         STH   R13,UCBERG              STORE UPDATED COUNT              22900003
*                                                                       22950003
B320     EQU   *                                                        23000003
         LA    MSGREG,ERRMSG1          SET FOR ERG - CONT MESSAGE       23050003
         TM    EWACNTR2,CNT3           THREE RETRIES?            Y02032 23100003
         BO    D840                    YES - XCTL TO WTO                23150003
         B     B330                    NO - SET UP FOR WTO MACRO        23200003
         EJECT                                                          23250003
*                                                                       23300003
*   BUILD OPERATOR MESSAGES AND ISSUE WTO                               23350003
*                                                                       23400003
B325     EQU   *                                                        23450003
         OI    IOSFLA,IOSEX+IOSERR     SET ERP IN CONTROL        S21048 23500003
*                                                                       23550003
B327     EQU   *                                                        23600003
         MVC   EWTWTO(C61),WTOMSG      MOVE MSG AREA TO EWA      Y02032 23650003
         MVC   EWTOPCDE(C2),NULLOP     PUT '***' IN OPCODE       S21048 23700003
         B     B340                    BR - SET UP MESSAGE       S21048 23750003
*                                                                       23800003
B330     EQU   *                                                        23850003
         LTR   CCWREG,CCWREG           NEGATIVE ADDRESS?         A29974 23900003
         BM    B222                    YES - GO SET X'4B'        A29974 23950003
         MVC   EWTWTO(C61),WTOMSG      MOVE MSG AREA TO EWA      Y02032 24000003
         UNPK  EWTOPCDE,CCWOP(C2)      UNPACK OPCODE AND 1 BYTE  Y02032 24050003
*                                                                       24100003
B340     EQU   *                                                        24150003
         OI    EWACNTR2,APPEND         SET SWITCH FOR APPENDAGE  Y02032 24200003
         MVC   EWTUNID(C3),UCBNAME     MOVE TO MESSAGE AREA      Y02032 24250003
*                                                                       24300003
*   MOVE IN MESSAGE TEXT AS POINTED TO BY MSGREG                        24350003
*                                                                       24400003
         MVC   EWTTEXT,0(MSGREG)       MOVE IN MESSAGE           Y02032 24450003
*                                                                       24500003
*   TRANSLATE ALL FIELDS TO PRINTABLE FORM                              24550003
*                                                                       24600003
         MVI   EWTOPCDE+C2,TRCOMMA     TRANSLATE CODE FOR COMMA  Y02032 24650003
*                                                                       24700003
         UNPK  EWTSTAT,IOSTATUS(C3)    UNPACK STATUS + 1 BYTE    Y02032 24750003
         MVI   EWTSTAT+C4,TRCOMMA      TRANSLATE CODE FOR COMMA  Y02032 24800003
*                                                                       24850003
         UNPK  EWTSENSE,IOSSNS(C3)     UNPACK SENSE AND 1 BYTE   Y02032 24900003
         MVI   EWTSENSE+C4,TRCOMMA     TRANSLATE CODE FOR COMMA  Y02032 24950003
*                                                                       25000003
         L     R13,EWTDCB              GET DCB ADDR FROM EWA     Y02032 25050003
         CL    R13,FZERO               VALID DCB ADDR?           Y02032 25100003
         BE    B350                    NO - SKIP BLK COUNT       Y02032 25150003
         UNPK  EWTLOC,DCBBLK(C5,R13)   UNPACK DCB BLOCK COUNT    Y02032 25200003
B350     EQU   *                                                        25250003
         MVI   EWTLOC+C8,TRCOMMA       TRANSLATE CODE FOR COMMA  Y02032 25300003
*                                                                       25350003
         TR    EWTOPCDE(L'EWTOPCDE+L'EWTSTAT+L'EWTSENSE+L'EWTLOC),TRANS 25400003
*                                                                       25450003
*   MOVE IN VOLUME SERIAL NUMBER IF AVAILABLE                           25500003
*                                                                       25550003
         MVC   EWTVOL(C6),UCBVOLI      MOVE IT TO MESSAGE AREA   Y02032 25600003
         CLI   UCBVOLI,ZERO            IS IT A VALID VOL SER?           25650003
         BNE   B360                    YES - BRANCH TO CONTINUE         25700003
*                                                                       25750003
         MVI   EWTVOL,BLANK            NO - MOVE IN BLANKS       Y02032 25800003
         MVC   EWTVOL+C1(C5),EWTVOL    MOVE BLANKS               Y02032 25850003
*                                                                       25900003
*   WRITE THE MESSAGE TO THE OPERATOR AND CONTINUE                      25950003
*                                                                       26000003
B360     EQU   *                                                        26050003
         LR    R11,BASREG              SAVE REG 15                      26100003
         LR    R4,IOSREG               SAVE REG 1                A40906 26150003
         LA    IOSREG,EWTWTO           POINT AT THE MESSAGE      Y02032 26200003
         WTO   MF=(E,(1))              WRITE ON CONSOLE                 26250003
         OI    EWAFLG3,EWTRBLD         FLAG TO REBUILD IDAL LIST S21048 26300003
*                                                                       26350003
         LR    BASREG,R11              RESTORE REG 15                   26400003
         LR    IOSREG,R4               RESTORE REG 1                    26450003
         CLI   IOSCOD,IOSTAPEC         X'4B' COMPLETION CODE?    A29974 26500003
         BE    B370                    YES - SVC 15/3            A29974 26550003
*                                                                       26600003
         CLI   IOSCOD,IOSFINTC         WAS IT AN INTERCEPT?      S21048 26650003
         BNE   B370                    NO - EXIT VIA SVC 15/3    S21048 26700003
*                                                                       26750003
         OI    IOSFLB,IOSLOG           SET LOGOUT                S21048 26800003
         MVI   IOSCOD,IOSINTC          SET INTERCEPT CODE - 44   S21048 26850003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA  SET ERP PERM ERR   @YM06412 26900003
*                                                                       26950003
B370     EQU   *                                                        27000003
         TM    IOSFLC,IOSVERIF         UNSOLICITED DEVICE END?   S21048 27050003
         BZ    B375                    NO - BR AROUND RESET      S21048 27100003
*                                                                       27150003
         LR    R4,UCBREG               SET UP POINTER TO UCB-24  Y02032 27200003
         L     R13,F24                 TO RESET UNSOL. DEV. END  Y02032 27250003
         SR    R4,R13                  SUBTRACT 24               Y02032 27300003
         NI    0(R4),X'FF'-UCBUDE      RESET UNSOL. DEVICE END IN UCB   27350003
         NI    IOSFLC,X'FF'-IOSVERIF   RESET UNSOL. DEVICE END IN IOSB  27400003
*                                                                       27450003
B375     EQU   *                                                        27500003
         TM    EWAFLG3,EWTOVER         IS OVERFLOW ON?           S21048 27550003
         BO    D2040                   YES - XCTL TO OBR         S21048 27600003
         B     B405                    NO - EXIT VIA SVC 15/3           27650003
*                                                                       27700003
*   SET UP TO REPOSITION OFF LOAD POINT                                 27750003
*                                                                       27800003
B380     EQU   *                                                        27850003
         SR    R4,R4                   CLEAR REGISTER                   27900003
         IC    R4,EWACNTR1             GET POSITIONING COUNT     Y02032 27950003
         LA    R13,C3                  MAX COUNT (RF ALWAYS DECR 1)     28000003
         SR    R13,R4                  NUMBER OF BACK SPACES            28050003
         BZ    B410                    ZERO - DONE, EXIT                28100003
*                                                                       28150003
         TM    EWAFLG3,EWTBKS          RD BK TAPE CLEANING?      Y02032 28200003
         BO    B390                    YES - SKIP                       28250003
         BCTR  R13,R0                  READ FWD - ONE LESS RECORD       28300003
*                                                                       28350003
B390     MVI   IOSMDB,CMDFSR           REVERSE DIRECTION                28400003
B400     STC   R13,EWACNTR1            RESTORE POSITIONING COUNT        28450003
         NI    EWAFLG3,X'FF'-EWTTPC-EWTBKS  RESET CLEAN & BKS CLEAN     28500003
*                                                                       28550003
B405     EQU   *                                                        28600003
         SVC   EXCPER                  SVC 15                           28650003
         SVC   RETURN                  SVC 3                            28700003
*                                                                       28750003
B410     EQU   *                                                        28800003
         TM    EWAFLG3,EWTBKS          READ BACK TAPE CLEANING?  Y02032 28850003
         BO    B390                    YES - ONE MORE RECORD TO GO      28900003
         NI    IOSFLA,X'FF'-IOSREP     NO - DONE, NO MORE POSITIONING   28950003
*                                                                       29000003
*   RESTORE DEVICE END POST BIT                                         29050003
*                                                                       29100003
         TM    EWACNTR3,EWTDEP         WAS IT ON ORIGINALLY?     Y02032 29150003
         BO    B415                    YES - LEAVE IT ON         Y02032 29200003
         NI    IOSOPT,X'FF'-IOSDEP     NO  - TURN IT OFF         Y02032 29250003
B415     EQU   *                                                        29300003
         TM    EWAFLG3,EWTROR          ROR IN PROGRESS?          Y02032 29350003
         BNO   B390                    NO - GO REVERSE DIRECTION        29400003
*                                                                       29450003
         OI    EWACNTR3,EWTROC         SET IOS USE RORCCW        Y02032 29500003
         B     B400                    GO READ OFF LOAD POINT           29550003
*************   E N D   O F   P A R T   1   *************               29600003
         EJECT                                                          29650003
*********************************************************************** 29700003
*                            P A R T   4                              * 29750003
*                                                                     * 29800003
*                          ERROR HANDLING                             * 29850003
*********************************************************************** 29900003
*        THIS PART HANDLES ERRORS OTHER THAN NORMAL DATA CHECK        * 29950003
*        ON READ OR WRITE TYPE COMMANDS AND REPOSITIONING ERRORS.     * 30000003
*********************************************************************** 30050003
*                                                                       30100003
*   NOT REPOSITIONING                                                   30150003
*   TEST SENSE INFORMATION                                              30200003
*   REGS 0,9,11,12,14,15 ARE AFFECTED BY INTERPRETER ROUTINE            30250003
*   EQUIPMENT CHECK IS A VALID ERROR ONLY WITH DEVICE END               30300003
*                                                                       30350003
PART4A   EQU   *                                                        30400003
         NI    EWAFLG3,X'FF'-EWTPT4A   TURN OFF ENTRY BIT        Y02032 30450003
         TM    EWTSNS0,EWTEQU          EQUIPMENT CHECK?          Y02032 30500003
         BZ    D100                    NO - CONTINUE TEST        Y02032 30550003
         TM    IOSTSA,CSWDVE           DEVICE END?               Y02032 30600003
         BO    D840                    YES - XCTL TO WTO         Y02032 30650003
D100     EQU   *                                                        30700003
         LR    SAVREG,BASREG           SAVE BASE REG                    30750003
         L     BASREG,LOC16            GET ADDR OF CVT                  30800003
         L     BASREG,VECT68(BASREG)   GET ADDR TO INTERPRETER ROUTINE  30850003
*                                                                       30900003
D120     EQU   *                                                        30950003
         BALR  LNKREG,BASREG           LINK TO INTERPRETER RTN          31000003
*                                                                       31050003
         DC    X'02'                   BUS OUT CHECK                    31100003
         DC    AL1(D700-D120-2)        *                                31150003
         DC    X'01'                   INTERVENTION REQUIRED            31200003
         DC    AL1(D190-D120-4)        *                                31250003
         DC    X'00'                   COMMAND REJECT                   31300003
         DC    AL1(D170-D120-6)        *                                31350003
         DC    X'05'                   OVERRUN                          31400003
         DC    AL1(D700-D120-8)        *                                31450003
         DC    X'0C'                   TAPE LOAD POINT                  31500003
         DC    AL1(D220-D120-10)       *                                31550003
         DC    X'07'                   DATA CONVERTER CHECK             31600003
         DC    AL1(D160-D120-12)       *                                31650003
         DC    X'0F'                   NOT CAPABLE                      31700003
         DC    AL1(D170-D120-14)       *                                31750003
         DC    X'2F'                   END OF TEST                      31800003
         DC    AL1(D150-D120-16)       *                                31850003
*                                                                       31900003
*   TEST REMAINING SENSE WHEN INTERVENTION REQUIRED IS IGNORED          31950003
*   REGS 0,9,11,12,14,15 ARE AFFECTED BY INTERPRETER ROUTINE            32000003
*                                                                       32050003
D130     EQU   *                                                        32100003
         LR    SAVREG,BASREG           SAVE BASE REG                    32150003
         L     BASREG,LOC16            GET ADDR OF CVT                  32200003
         L     BASREG,VECT68(BASREG)   GET ADDR TO INTERPRETER ROUTINE  32250003
D140     EQU   *                                                        32300003
         BALR  LNKREG,BASREG           LINK TO INTERPRETER RTN          32350003
*                                                                       32400003
         DC    X'05'                   OVERRUN                          32450003
         DC    AL1(D700-D140-2)        *                                32500003
         DC    X'07'                   DATA CONVERTER CHECK             32550003
         DC    AL1(D160-D140-4)        *                                32600003
         DC    X'0F'                   NOT CAPABLE                      32650003
         DC    AL1(D170-D140-6)        *                                32700003
         DC    X'2F'                   END OF TEST                      32750003
         DC    AL1(D150-D140-8)        *                                32800003
         EJECT                                                          32850003
*                                                                       32900003
*   ENTER HERE FOR LOGOUT                                               32950003
*                                                                       33000003
D150     EQU   *                                                        33050003
         B     D840                    BRANCH TO SET LOGOUT             33100003
*                                                                       33150003
*   DATA CONVERTER CHECK                                                33200003
*                                                                       33250003
D160     EQU   *                                                        33300003
         B     D860                    GO XCTL TO WTO                   33350003
*                                                                       33400003
*   COMMAND REJECT AND NOT CAPABLE                                      33450003
*                                                                       33500003
D170     EQU   *                                                        33550003
         B     D860                    BRANCH TO SET MESSAGE TYPE       33600003
*                                                                       33650003
*   I N T E R V E N T I O N   R E Q U I R E D                           33700003
*        NON EXISTENT    -  I/O ERR     -  LOGOUT                       33750003
*        NO DEVICE END   -  MESSAGE     -  WTO AND REISSUE              33800003
*        INTERCEPTED 7E  -  NO MESSAGE  -  UCB NOT READY, 7F, RETURN    33850003
*        REWIND UNLOAD   -  NO MESSAGE  -  UCB NOT READY, 7F, UC OFF    33900003
*                                       -  RESTRT FLAG OFF, IOSB NO ERR 33950003
*        IGNORE INT REQ  -  NO MESSAGE  -  FINISH SENSE CHECK           34000003
*                                                                       34050003
D190     EQU   *                                                        34100003
         OI    EWACNTR1,ERPCTL         SET ERP CONTROL FLAG      Y02032 34150003
         TM    IOSCC,IOSCC3            NON-EXISTENT CONTROL UNIT?       34200003
         BO    D870                    YES - BRANCH TO WTO              34250003
*                                                                       34300003
         TM    EWTSNS1,EWTSTA+EWTSTB   STATUS A & B BOTH OFF?    Y02032 34350003
         BZ    D840                    YES - BR, ERROR, NO DRIVE        34400003
*                                                                       34450003
         TM    IOSTSA,CSWDVE           DEVICE END?                      34500003
         BZ    D870                    NO - BRANCH TO WTO & REISSUE     34550003
*                                                                       34600003
         LTR   CCWREG,CCWREG           NEGATIVE ADDRESS?         A29974 34650003
         BM    B222                    YES - GO SET X'4B'        A29974 34700003
         CLI   CCWOP,CMDRWU            REWIND UNLOAD?                   34750003
         BE    D200                    YES - GO SET IOSB TO NO ERROR    34800003
*                                                                       34850003
         TM    EWTSNS0,EWTCREJ         COMMAND REJECT?           Y02032 34900003
         BO    D860                    YES - GO SET MESSAGE TYPE        34950003
*                                                                       35000003
         TM    IOSTSB,CSWCDC           CHANNEL DATA CHECK?              35050003
         BO    D700                    YES - GO CHECK STATUS            35100003
         NI    EWTSNS0,X'FF'-EWTINT    TURN OFF INT REQ IN EWA   Y02032 35150003
         NI    IOSSNS,X'FF'-EWTINT     TURN OFF INT.REQ. IN IOSB Y02032 35200003
         LA    R13,LOAD1               GET LOAD 1 ADDRESS        Y02032 35250003
         B     XCTL3                   XCTL TO LOAD 1            Y02032 35300003
*                                                                       35350003
*   REWIND UNLOAD - NO ERROR                                            35400003
*                                                                       35450003
D200     EQU   *                                                        35500003
         NI    IOSFLA,X'FF'-IOSEX-IOSERR    SET IOSB TO NO ERROR        35550003
         NI    IOSTSA,X'FF'-CSWUCK     SET UNIT CHECK OFF               35600003
*                                                                       35650003
         MVI   IOSCOD,IOSNRMC          SET NORMAL COMPLETION CODE (7F)  35700003
*                                                                       35750003
*   SET UCB NOT READY FLAG, USING IOSGEN                                35800003
*                                                                       35850003
         LA    R13,EWTIDAL             POINT TO WORK AREA FOR IOSGEN    35900003
         AH    UCBREG,H512             POINT TO UCB PROPER     @OZ00664 35910003
         IOSGEN UCBFLG,UCB=(UCBREG),VAR=ON,TABLE=UCBNRY,REG=UNCOND      35950003
         SH    UCBREG,H512             POINT TO UCB PREFIX     @ZA05134 35960003
         B     D2025                   EXIT VIA SVC 15/3                36000003
*                                                                       36050003
*   LOAD POINT                                                          36100003
*                                                                       36150003
D220     EQU   *                                                        36200003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA  SET IOSB PERM ERR  @YM06412 36250003
         B     D2025                   EXIT VIA SVC 15/3                36300003
         EJECT                                                          36350003
*********************************************************************** 36400003
*                          P A R T   4 B                              * 36450003
*********************************************************************** 36500003
PART4B   EQU   *                                                        36550003
         NI    EWAFLG3,X'FF'-EWTPT4B   TURN OFF ENTRY BIT        Y02032 36600003
*                                                                       36650003
*   TEST STATUS INFORMATION                                             36700003
*   REGS 0,9,11,12,14,15 ARE USED BY INTERPRETER ROUTINE                36750003
*                                                                       36800003
D700     EQU   *                                                        36850003
*                                                                       36900003
         LR    SAVREG,BASREG           SAVE REG 15                      36950003
         L     BASREG,LOC16            GET ADDR OF CVT                  37000003
         L     BASREG,VECT68(BASREG)   GET ADDR OF INTERPRETER ROUTINE  37050003
D710     EQU   *                                                        37100003
         BALR  LNKREG,BASREG           LINK TO INTERPRETER RTN          37150003
*                                                                       37200003
         DC    X'16'                   UNIT CHECK                       37250003
         DC    AL1(D780-D710-2)        *                                37300003
         DC    X'1C'                   CHANNEL DATA CHECK               37350003
         DC    AL1(D770-D710-4)        *                                37400003
         DC    X'1F'                   CHAINING CHECK                   37450003
         DC    AL1(D770-D710-6)        *                                37500003
         DC    X'1A'                   PROGRAM CHECK                    37550003
         DC    AL1(D760-D710-8)        *                                37600003
         DC    X'1B'                   PROTECTION CHECK                 37650003
         DC    AL1(D760-D710-10)       *                                37700003
         DC    X'2F'                   END OF TEST - RECOVERED          37750003
         DC    AL1(D720-D710-12)       *                                37800003
*                                                                       37850003
*   RECOVERED                                                           37900003
*                                                                       37950003
D720     EQU   *                                                        38000003
         XC    EWACNTR1(C2),EWACNTR1   ZERO ERROR COUNTS                38050003
         NI    EWACNTR3,X'FF'-EWTRST   RESET RESTART BIT                38100003
         NI    IOSFLA,X'FF'-IOSEX-IOSERR   SET FOR TEMP ERROR EXIT      38150003
         OI    EWACNTR3,EWTEXIT        SET TEMP EXIT BIT ON             38200003
*                                                                       38250003
         LTR   CCWREG,CCWREG           NEGATIVE ADDRESS?                38300003
         BM    B222                    YES-SET '4B' & EXIT, PERM ERR    38350003
*                                                                       38400003
         LA    R13,LOAD1               GET LOAD 1 ADDRESS               38450003
         B     XCTL3                   XCTL TO LOAD 1                   38500003
*                                                                       38550003
*   PROGRAM CHECK OR PROTECTION CHECK                                   38600003
*                                                                       38650003
D760     EQU   *                                                        38700003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA RESET ERP CTL FLAGS @YM06412 38750003
         MVI   EWAFLG3,ZERO            CLEAR ERROR FLAGS                38800003
         B     D2025                   EXIT VIA SVC 15/3                38850003
*                                                                       38900003
*   CHAINING CHECK OR CHANNEL DATA CHECK                                38950003
*                                                                       39000003
D770     EQU   *                                                        39050003
         MVI   IOSSNS,ZERO             ZERO SENSE                       39100003
*                                                                       39150003
*   UNIT CHECK (BUS OUT OR OVERRUN)                                     39200003
*                                                                       39250003
D780     EQU   *                                                        39300003
         TM    EWACNTR1,OVRCNT5        IS OVERRUN COUNT 5?       Y02032 39350003
         BO    D840                    YES - SET LOGOUT & EXIT          39400003
         IC    R13,EWACNTR1            GET OVERRUN COUNT         Y02032 39450003
         LA    R13,C16(R13)            ADD ONE TO COUNT                 39500003
         STC   R13,EWACNTR1            STORE COUNT BACK          Y02032 39550003
*                                                                       39600003
         LTR   CCWREG,CCWREG           NEGATIVE ADDRESS?         A29974 39650003
         BM    B222                    YES - SET X'4B' & GO TO PART 1   39700003
*                                                                       39750003
         TM    IOSSNS,EWTBUSO          BUS OUT?                  Y02032 39800003
         BZ    D800                    NO - GO CHECK FOR OVERRUN        39850003
*                                                                       39900003
*   BUS OUT                                                             39950003
*                                                                       40000003
         TM    IOSTSA,CSWDVE           DEVICE END?                      40050003
         BZ    D790                    NO - GO CHECK TRACK IN ERROR     40100003
*                                                                       40150003
         CLI   CCWOP,CMDWRT            WRITE COMMAND?                   40200003
         BE    D810                    YES - GO REPOSITION              40250003
*                                                                       40300003
D790     EQU   *                                                        40350003
         CLI   CCWOP,CMDTIE            TRACK IN ERROR?                  40400003
         BNE   B405                    NO - GO RETRY                    40450003
         B     D820                    YES - GO TEST CHAINING           40500003
*                                                                       40550003
*   OVERRUN                                                             40600003
*                                                                       40650003
D800     EQU   *                                                        40700003
         CLI   CCWOP,CMDTIE            TRACK IN ERROR?                  40750003
         BE    D820                    YES - GO TEST CHAINING           40800003
*                                                                       40850003
D810     EQU   *                                                        40900003
         OI    IOSFLA,IOSREP           SET REPOSITION                   40950003
         OI    IOSOPT,IOSDEP           SET DEVICE END POST BIT   Y02032 41000003
         B     B405                    GO REPOSITION                    41050003
*                                                                       41100003
D820     EQU   *                                                        41150003
         TM    CCWFLS,IOSCCHN          COMMAND CHAINING?                41200003
         BO    D840                    YES - SET LOGOUT & XCTL TO WTO   41250003
         B     B405                    GO RETRY - SVC 15/3              41300003
         EJECT                                                          41350003
*                                                                       41400003
*   G E N E R A L   E X I T   A R E A                                   41450003
*                                                                       41500003
D840     EQU   *                                                        41550003
         OI    IOSFLB,IOSLOG           SET LOGOUT                       41600003
D860     EQU   *                                                        41650003
         OI    IOSFLB,IOSMSG           SET MESSAGE TYPE                 41700003
         NI    IOSFLA,X'FF'-IOSERR-IOSSMDA SET PERM ERROR EXIT @YM06412 41750003
D870     EQU   *                                                        41800003
         LA    R13,WTORTN              LOAD NAME FOR WTO                41850003
         B     XCTL1                   GO TO XCTL ROUTINE               41900003
*                                                                       41950003
D2025    EQU   *                                                        42000003
         TM    IOSFLB,IOSLOG           LOG OR OVERFLOW ON?              42050003
         BO    D2040                   YES - EXIT VIA OBR               42100003
         TM    EWAFLG3,EWTOVER         SDR OVERFLOW ON?          Y02032 42150003
         BZ    B405                    NO - EXIT VIA SVC 15/3           42200003
*                                                                       42250003
D2040    EQU   *                                                        42300003
         LA    R13,SERLOG              GET ADDRESS OF OBR               42350003
XCTL1    EQU   *                       SET UP OBR INFO IN EWA    Y02032 42400003
         L     R5,EWTDCB               GET DCB ADDR              Y02032 42450003
         LA    R4,EWTVOLID             GET ADDR OF OBR AREA      Y02032 42500003
         ST    R4,EWADCNT              STORE ADDR IN EWA         Y02032 42550003
         MVI   EWADCNT,HEX24           MOVE IN #BYTES OF OBR     Y02032 42600003
         MVC   EWTVES,UCBCTD           GET VES INFO              Y02032 42650003
         CL    R5,FZERO                VALID DCB?                Y02032 42700003
         BE    XCTL2                   NO - SKIP BLOCK COUNT     Y02032 42750003
         OI    EWAFLG1,EWADDMSG        SET WTO FLAG ON         @ZA31011 42760037
         CLC   BLKCNT(4,R5),MASK       IS BLKCNT = TO 65K?     @ZA08856 42766037
         BNH   MOVIT                   BR IF BLKCNT IS LESS    @ZA08856 42772037
         MVC   EWTBLK,MASK+2           MOVE FFFF TO RECORD     @ZA08856 42778037
         B     XCTL3                   GO XCTL                 @ZA08856 42792003
MOVIT    EQU   *                                                        42794003
         MVC   EWTBLK,BLKCNT+C2(R5)    YES - GET BLOCK COUNT   @ZA08856 42800003
         B     XCTL3                   GO XCTL                   Y02032 42850003
XCTL2    EQU   *                                                        42900003
         MVC   EWTBLK,FZERO            SET BLOCK COUNT TO 0      Y02032 42950003
XCTL3    EQU   *                                                        43000003
         MVC   EWTVOLID,UCBVOLI        GET VOL SER               Y02032 43050003
         L     XCTLREG,LOC16           GET ADDR OF CVT                  43100003
         L     XCTLREG,VECTXL(XCTLREG) GET ADDR FOR XCTL ROUTINE        43150003
         BR    XCTLREG                 BR TO XCTL                       43200003
         EJECT                                                          43250003
*********************************************************************** 43300003
*                            P A R T   9                              * 43350003
*                                                                     * 43400003
*                            ICC  &  CCC                              * 43450003
*********************************************************************** 43500003
*        ANALYZE THE ERROR RECOVERY INTERFACE BLOCK (ERPIB) TO        * 43550003
*        DETERMINE WHETHER OR NOT A CHANNEL ERROR CONDITION CAN       * 43600003
*        BE RETRIED.  IF SO, THE CHANNEL PROGRAM IS RETRIED ONLY      * 43650003
*        ONCE.  IF THE ERROR IS NOT RECOVERED ON RETRY OR IS OF       * 43700003
*        A TYPE THAT CANNOT BE RETRIED, THEN IT IS TO BE CONSIDERED   * 43750003
*        A PERMANENT ERROR, THE LOGOUT BIT IS SET, AND CONTROL        * 43800003
*        IS TRANSFERRED TO THE WRITE-TO-OPERATOR ROUTINE (IGE0025C)   * 43850003
*********************************************************************** 43900003
*                                                                       43950003
PART9    EQU   *                                                        44000003
*                                                                       44050003
*   CHECK ICC/CCC FLAG.  IF RETRY OF ICC/CCC CAUSED                     44100003
*   ICC OR CCC, WE WILL NOT RETRY AGAIN.                                44150003
*                                                                       44200003
         TM    EWACNTR1,ICCFLG         ICC/CCC FLAG ON?          Y02032 44250003
         BO    F390                    YES - BRANCH TO PERM ERROR       44300003
*                                                                       44350003
*   IS IOB INTERCEPTED?                                                 44400003
*                                                                       44450003
         CLI   IOSCOD,IOSFINTC         INTERCEPTED - 7E?                44500003
         BE    F380                    YES - GO SET CODE, PERM ERROR    44550003
*                                                                       44600003
*   TEST OF ERPIB NO-RETRY BITS                                         44650003
*                                                                       44700003
         TM    EWARGFG1,IBUNR1         ANY NO-RETRY BIT ON?      Y02032 44750003
         BC    7,F390                  YES - BRANCH TO PERM ERROR       44800003
*                                                                       44850003
*   EITHER SIO OR I/O INTERRUPT STORED A CSW, NOT BOTH?                 44900003
*                                                                       44950003
         TM    EWARGFG1,IBSIB1         SIO OR I/O INTERRUPT BIT?        45000003
         BC    9,F390                  BRANCH BOTH ON OR BOTH OFF       45050003
*                                      PERMANENT ERROR                  45100003
*                                                                       45150003
*   DID SIO INSTRUCTION STORE A CSW?                                    45200003
*                                                                       45250003
         TM    EWARGFG1,IBSIO1         SIO FAIL?                 Y02032 45300003
         BO    F370                    YES - BRANCH TO RETRY            45350003
*                                                                       45400003
*   TEST FOR ANY VALIDITY INDICATOR OFF                                 45450003
*                                                                       45500003
         TM    EWAXCSW1,IBALL2         ANY OFF?                  Y02032 45550003
         BC    12,F390                 YES - BRANCH TO PERM ERROR       45600003
*                                                                       45650003
*   TEST FOR ERROR ON NORMAL ERP REPOSITIONING                          45700003
*                                                                       45750003
         TM    IOSFLA,IOSREP           REPOSITIONING?                   45800003
         BO    F390                    YES - BRANCH TO PERM ERROR       45850003
*                                                                       45900003
*   TEST FOR UNIT CHECK                                                 45950003
*                                                                       46000003
         TM    IOSTSA,CSWUCK           UNIT CHECK?                      46050003
         BZ    F310                    NO - GO RESET CRC BIT            46100003
*                                                                       46150003
*   TEST FOR EQUIPMENT CHECK                                            46200003
*   OTHER SENSE BITS IGNORED                                            46250003
*                                                                       46300003
         TM    IOSSNS,EWTEQU           EQUIPMENT CHECK?          Y02032 46350003
         BO    F390                    YES - BRANCH TO PERM ERROR       46400003
*                                                                       46450003
*   RESET CRC BIT                                                       46500003
*                                                                       46550003
F310     EQU   *                                                        46600003
         NI    IOSFLA,X'FF'-IOSCRC     RESET CRC BIT                    46650003
*                                                                       46700003
*   TEST FOR CHAIN BITS - COMMAND AND/OR DATA CHAINING?                 46750003
*                                                                       46800003
         TM    IOSFLA,IOSACHN          DC OR CC?                        46850003
         BZ    F314                    NEITHER - GO SET DIRECTION       46900003
         BO    F390                    BOTH - BRANCH TO PERM ERROR      46950003
*                                                                       47000003
*   TEST FOR COMMAND CHAINING                                           47050003
*                                                                       47100003
         TM    IOSFLA,IOSCCHN          COMMAND CHAINING?                47150003
         BO    F312                    YES - BR AROUND DATA CHAINING    47200003
*                                                                       47250003
*   DATA CHAINING ONLY - START AT TOP OF CHANNEL PROGRAM                47300003
*                                                                       47350003
         L     CCWREG,IOSVST           GET START ADDRESS (VIRTUAL)      47400003
         B     F314                    GO SET DIRECTION                 47450003
*                                                                       47500003
*   COMMAND CHAINING                                                    47550003
*                                                                       47600003
F312     EQU   *                                                        47650003
         TM    EWACNTR3,EWTRST         1ST ENTRY (RESTART FLAG OFF)?    47700003
         BZ    F313                    YES - GO SET RESTART             47750003
*                                                                       47800003
*   NOT FIRST ENTRY                                                     47850003
*                                                                       47900003
         NI    IOSMDB,ZERO             CLEAR MOD BYTE                   47950003
         LR    R13,CCWREG              SET WORK REG TO CCW ADDRESS      48000003
         S     R13,IOSVST              COMPARE TO RESTART ADDRESS       48050003
         BZ    F314                    EQUAL - GO SET DIRECTION         48100003
*                                                                       48150003
*   COMMAND CHAINING AND CHAIN BROKE IN DIFFERENT PLACE                 48200003
*                                                                       48250003
         XC    EWACNTR1(C2),EWACNTR1   CLEAR ERROR COUNTS        Y02032 48300003
F313     EQU   *                                                        48350003
         OI    EWACNTR3,EWTRST         SET RESTART FLAG          Y02032 48400003
         ST    CCWREG,IOSVST           SET ADDRESS TO RESTART           48450003
         LRA   R13,CCW                 TRANSLATE VIRTUAL RESTART ADDR   48500003
         ST    R13,IOSRST              STORE IN REAL RESTART ADDRESS    48550003
*                                                                       48600003
F314     EQU   *                                                        48650003
         NI    EWAXCSW2,HEXC7          ZERO UNUSED BITS          Y02032 48700003
         TM    EWAXCSW2,IB30C0         TERM CODE = '11'?         Y02032 48750003
         BO    F390                    YES - BRANCH TO PERM ERROR       48800003
*                                                                       48850003
         CLI   CCWOP,CMDRED            IS COMMAND A READ?               48900003
         BE    G200                    YES - GO CHECK TERM & SEQ CODES  48950003
*                                                                       49000003
         CLI   CCWOP,CMDRDB            READ BACKWARDS?                  49050003
         BE    G200                    YES - GO CHECK CODES             49100003
*                                                                       49150003
         CLI   CCWOP,CMDWRT            WRITE?                           49200003
         BE    G200                    YES - GO CHECK CODES             49250003
*                                                                       49300003
         CLI   CCWOP,CMDERG            ERASE GAP?                       49350003
         BE    G200                    YES - GO CHECK CODES             49400003
*                                                                       49450003
         CLI   CCWOP,CMDWTM            WRITE TAPE MARK?                 49500003
         BE    G200                    YES - GO CHECK CODES             49550003
*                                                                       49600003
         CLI   CCWOP,CMDBSR            BACK SPACE RECORD?               49650003
         BE    G200                    YES - GO CHECK CODES             49700003
*                                                                       49750003
         CLI   CCWOP,CMDBSF            BACK SPACE FILE?                 49800003
         BE    G200                    YES - GO CHECK CODES             49850003
*                                                                       49900003
         CLI   CCWOP,CMDSNS            SENSE?                           49950003
         BE    G000                    YES - GO CHECK CODES             50000003
*                                                                       50050003
         CLI   CCWOP,CMDTIC            TRANSFER IN CHANNEL?             50100003
         BE    F390                    YES - BRANCH TO PERM ERROR       50150003
*                                                                       50200003
         CLI   CCWOP,CMDFSR            FORWARD SPACE RECORD?            50250003
         BE    G200                    YES - GO CHECK CODES             50300003
*                                                                       50350003
         CLI   CCWOP,CMDFSF            FORWARD SPACE FILE?              50400003
         BE    G200                    YES - GO CHECK CODES             50450003
*                                                                       50500003
         CLI   CCWOP,CMDREW            REWIND?                          50550003
         BE    G100                    YES - GO CHECK CODES             50600003
*                                                                       50650003
         CLI   CCWOP,CMDRWU            REWIND UNLOAD?                   50700003
         BE    G100                    YES - GO CHECK CODES             50750003
*                                                                       50800003
         CLI   CCWOP,CMDNOP            NO-OP?                           50850003
         BE    G100                    YES - GO CHECK CODES             50900003
*                                                                       50950003
         TM    CCWOP,CMDMD1            MODE SET, TIE OR LWR?            51000003
         BNO   F390                    NO - BRANCH AROUND               51050003
         TM    CCWOP,CMDBIT4           TEST FOR LO-ORDER = 'X3'         51100003
         BO    F315                    NO - GO CHECK FOR 'XB'           51150003
         TM    CCWOP,CMDBIT5           2ND TEST FOR 'X3'                51200003
         BZ    G100                    'X3' - GO CHECK CODES            51250003
         B     F390                    NOT 'X3' OR 'XB' - BR AROUND     51300003
F315     EQU   *                                                        51350003
         TM    CCWOP,CMDBIT5           TEST FOR LO-ORDER = 'XB'         51400003
         BZ    G100                    YES - GO CHECK CODES             51450003
         B     F390                    NO - BRANCH TO PERM ERROR        51500003
         EJECT                                                          51550003
*********************************************************************** 51600003
*                               2 4 0 0                               * 51650003
*        THIS SECTION HANDLES ICC AND CCC FOR 2400 DEVICE TYPE        * 51700003
*********************************************************************** 51750003
*                                                                     * 51800003
*        DETERMINE IF RETRY IS POSSIBLE BASED UPON                    * 51850003
*        SEQUENCE CODE AND TERMINATION CODE.                          * 51900003
*                                                                     * 51950003
*        BITS 2, 3 AND 4 OF ERPIB BYTE ARE UNUSED.                    * 52000003
*                                                                     * 52050003
*        THE FOLLOWING COMMANDS ARE CONSIDERED FOR                    * 52100003
*        FURTHER RECOVERY:                                            * 52150003
*              01, 02, 0C, 03, 07, 0F, 17, 1F, 27, 37 AND 3F          * 52200003
*********************************************************************** 52250003
F316     EQU   *                                                        52300003
*                                                                       52350003
*   SET REPOSITION DIRECTION FOR ALL READ/WRITE ERRORS                  52400003
*                                                                       52450003
         MVI   IOSMDB,CMDBSR           SET TO BACKSPACE                 52500003
         CLI   CCWOP,CMDRDB            IS IT READ BACK?                 52550003
         BNE   F316A                   NO - BR AROUND FORWARD SPACE     52600003
         MVI   IOSMDB,CMDFSR           SET TO FORWARD SPACE             52650003
F316A    EQU   *                                                        52700003
         CLI   EWAXCSW2,IB3001         T CODE=00 & R CODE=001?   Y02032 52750003
         BE    F370                    YES - GO SET BUS OUT             52800003
*                                                                       52850003
         CLI   EWAXCSW2,IB3002         T CODE=00 & R CODE=010?   Y02032 52900003
         BE    F325                    YES - GO CHECK TYPE OF COMMAND   52950003
*                                                                       53000003
         CLI   EWAXCSW2,IB3003         T CODE=00 & R CODE=011?   Y02032 53050003
         BE    F330                    YES - GO CHECK TYPE OF COMMAND   53100003
*                                                                       53150003
         CLI   EWAXCSW2,IB3004         T CODE=00 & R CODE=100?   Y02032 53200003
         BE    F370                    YES - GO SET BUS OUT             53250003
*                                                                       53300003
         CLI   EWAXCSW2,IB3005         T CODE=00 & R CODE=101?   Y02032 53350003
         BE    F330                    YES - GO CHECK TYPE OF COMMAND   53400003
*                                                                       53450003
         CLI   EWAXCSW2,IB3043         T CODE=01 & R CODE=011?   Y02032 53500003
         BE    F330                    YES - GO CHECK TYPE OF COMMAND   53550003
*                                                                       53600003
         CLI   EWAXCSW2,IB3045         T CODE=01 & R CODE=101?   Y02032 53650003
         BE    F330                    YES - GO CHECK TYPE OF COMMAND   53700003
*                                                                       53750003
         CLI   EWAXCSW2,IB3082         T CODE=10 & R CODE=010?   Y02032 53800003
         BE    F335                    YES - GO CHECK TYPE OF COMMAND   53850003
*                                                                       53900003
*   BRANCH TO PERMANENT ERROR.  ALL OTHER TERMINATION CODE              53950003
*   AND RETRY CODE COMBINATIONS ARE NOT RECOVERABLE.                    54000003
*                                                                       54050003
         B     F390                    BRANCH TO PERMANENT ERROR        54100003
F325     EQU   *                                                        54150003
         CLI   CCWOP,CMDWRT            WRITE COMMAND?                   54200003
         BE    F370                    YES - GO SET BUS OUT             54250003
*                                                                       54300003
         TM    CCWOP,CMDCTL            CONTROL COMMAND?                 54350003
         BNO   F345                    NO - BRANCH TO REPOSITION        54400003
*                                                                       54450003
*   IF THIS ONE CHAINED, CONTINUE WITH NEXT                             54500003
*                                                                       54550003
F327     EQU   *                                                        54600003
         TM    CCWFLS,IOSCCHN          COMMAND CHAINED?                 54650003
         BZ    F350                    NO - DONE, NO ERROR, BRANCH      54700003
*                                                                       54750003
         LA    CCWREG,C8(CCWREG)       POINT TO NEXT COMMAND            54800003
         CLI   CCWOP,CMDTIC            NEXT COMMAND A TIC?              54850003
         BNE   F328                    NO - USE THIS ADDRESS            54900003
*                                      YES - TRANSLATE 'TIC TO' ADDR    54950003
         MVC   IOSRST,CCWADR           STORE REAL START ADDR     Y02032 55000003
         LR    R4,IOSREG               SAVE IOSB ADDRESS         Y02032 55050003
         L     R1,CCWADR               GET 'TIC TO' ADDRESS      Y02032 55100003
         LA    R1,0(R1)                GET 3-BYTE ADDRESS        Y02032 55150003
         LR    R11,BASREG              SAVE BASE ADDR (R15)      Y02032 55200003
         L     BASREG,LOC16            GET ADDRESS OF CVT        Y02032 55250003
         L     BASREG,C288(BASREG)     GET ADDR OF TRANSLATE RTN Y02032 55300003
         BALR  LNKREG,BASREG           LINK TO TRANSLATE RTN     Y02032 55350003
         LR    CCWREG,R1               GET CCW ADDRESS (VIRT)    Y02032 55400003
         LR    BASREG,R11              RESTORE BASE REG          Y02032 55450003
         LR    IOSREG,R4               RESTORE IOSB REG          Y02032 55500003
*                                                                       55550003
F328     EQU   *                                                        55600003
         ST    CCWREG,IOSVST           SET AS RESTART (NO REPOS)        55650003
         LRA   R13,CCW                 GET REAL RESTART ADDRESS         55700003
         ST    R13,IOSRST              STORE IN IOSB                    55750003
         B     F370                    GO SET BUS OUT                   55800003
*                                                                       55850003
F330     EQU   *                                                        55900003
         TM    CCWOP,CMDCTL            CONTROL COMMAND?                 55950003
         BO    F327                    YES - GO CHECK FOR CMD CHAINING  56000003
         B     F345                    NO  - BRANCH TO REPOSITION       56050003
*                                                                       56100003
F335     EQU   *                                                        56150003
         CLI   CCWOP,CMDWRT            WRITE COMMAND?                   56200003
         BE    F370                    YES - GO SET ICC/CCC             56250003
         B     F390                    NO  - BRANCH TO PERM ERROR       56300003
*                                                                       56350003
*   REPOSITIONING REQUIRED                                              56400003
*                                                                       56450003
F345     EQU   *                                                        56500003
         CLI   CCWOP,CMDWRT            WRITE COMMAND?                   56550003
         BNE   F348                    NO - GO SET ICC/CCC & REPOSIT.   56600003
*                                                                       56650003
         OI    EWACNTR2,WRTIND         SET WRITE INDICATOR       Y02032 56700003
         TM    IOSTSA,CSWUEX           TEST FOR UNIT EXCEPTION          56750003
         BZ    F348                    NO - GO SET BUS OUT & REPOSIT.   56800003
         OI    EWACNTR3,EWTUEX         YES - SET UNIT EXCEPTION  Y02032 56850003
*                                                                       56900003
F348     EQU   *                                                        56950003
         OI    EWACNTR1,ICCFLG         SET ICC/CCC FLAG          Y02032 57000003
         OI    IOSFLA,IOSREP           SET REPOSITION                   57050003
         OI    IOSOPT,IOSDEP           SET DEVICE END POST BIT   Y02032 57100003
         B     F370                    GO RETRY                         57150003
*                                                                       57200003
*   OPERATION COMPLETE - NO ERROR - IGNORE ICC OR CCC                   57250003
*                                                                       57300003
F350     EQU   *                                                        57350003
         NI    EWACNTR2,HEX80          CLEAR ERROR COUNT         Y02032 57400003
         NI    EWACNTR1,ZERO           CLEAR ERROR COUNT         Y02032 57450003
*                                                                       57500003
*   TEST FOR END OF TAPE BEFORE BSR                                     57550003
*                                                                       57600003
         TM    EWACNTR3,EWTUEX         HAD UNIT EXCEPTION?       Y02032 57650003
         BZ    F352                    NO - BRANCH AROUND               57700003
         OI    IOSTSA,CSWUEX           YES - SET UNIT EXCEPTION IN CSW  57750003
         NI    EWACNTR3,X'FF'-EWTUEX   RESET UNIT EXCEPTION FLAG Y02032 57800003
*                                                                       57850003
F352     EQU   *                                                        57900003
         NI    IOSFLA,X'FF'-IOSERR-IOSEX    SET FLAGS FOR TEMP ERROR    57950003
         NI    EWACNTR3,X'FF'-EWTRST   RESET RESTART FLAG        Y02032 58000003
         XC    EWAERPIB,EWAERPIB       ZERO ERPIB                Y02032 58050003
*                                                                       58100003
*   TURN OFF ICC AND CCC                                                58150003
         NI    IOSTSB,HEXF9            TURN OFF ICC AND CCC             58200003
*                                                                       58250003
*   TEST FOR REWIND UNLOAD                                              58300003
*                                                                       58350003
         CLI   CCWOP,CMDRWU            RUN COMMAND?                     58400003
         BE    F356                    YES - BR AROUND ERROR FLAGS      58450003
*                                                                       58500003
         MVI   EWAFLG3,ZERO            CLEAR ERROR FLAGS         Y02032 58550003
         B     B405                    EXIT VIA SVC 15/3                58600003
*                                                                       58650003
F356     EQU   *                                                        58700003
         NI    IOSTSA,X'FF'-CSWUCK     TURN OFF UNIT CHECK              58750003
         MVI   IOSCOD,IOSNRMC          SET NORMAL COMPLETION CODE - 7F  58800003
*                                                                       58850003
*   SET UCB NOT READY FLAG                                              58900003
*                                                                       58950003
         LA    R13,EWTIDAL             POINT TO WORK AREA FOR IOSGEN    58960003
         AH    UCBREG,H512             POINT TO UCB PROPER     @ZA05134 59010003
         IOSGEN UCBFLG,UCB=(UCBREG),VAR=ON,TABLE=UCBNRY,REG=UNCOND      59050003
         B     B405                    EXIT VIA SVC 15/3                59100003
         EJECT                                                          59150003
*                                                                       59200003
*                         R E T R Y                                     59250003
*                                                                       59300003
F370     EQU   *                                                        59350003
         OI    EWACNTR1,ICCFLG         SET ICC/CCC FLAG          Y02032 59400003
         XC    EWAERPIB,EWAERPIB       ZERO ERPIB                       59450003
         B     B405                    GO TO SVC 15/3                   59500003
*                                                                       59550003
*              P E R M A N E N T   E R R O R                            59600003
*                                                                       59650003
F380     MVI   IOSCOD,IOSINTC          SET INTERCEPT CODE - X'44'       59700003
*                                                                       59750003
F390     XC    EWAERPIB,EWAERPIB       ZERO ERPIB                       59800003
         B     D840                    EXIT VIA XCTL TO WTO             59850003
         EJECT                                                          59900003
*********************************************************************** 59950003
*                              3 4 0 0                                * 60000003
*        THIS SECTION HANDLES ICC AND CCC FOR NEW DEVICE TYPE         * 60050003
*********************************************************************** 60100003
*                                                                     * 60150003
*        DETERMINE IF RETRY IS POSSIBLE BASED UPON                    * 60200003
*        SEQUENCE CODE AND TERMINATION CODE.                          * 60250003
*                                                                     * 60300003
*        BITS 2, 3 AND 4 OF ERPIB BYTE ARE UNUSED.                    * 60350003
*                                                                     * 60400003
*        THE FOLLOWING COMMANDS ARE CONSIDERED FOR                    * 60450003
*        FURTHER RECOVERY:                                            * 60500003
*              01, 02, 0C, 03, 07, 0F, 17, 1F, 27, 37, 3F, 04         * 60550003
*                                                                     * 60600003
*********************************************************************** 60650003
*                                                                       60700003
*   SENSE COMMAND                                                       60750003
*   THE FOLLOWING COMBINATIONS OF TERMINATION                           60800003
*   CODE AND SEQUENCE CODE CAN BE RETRIED:                              60850003
*              00-001   00-010   00-011   00-101                        60900003
*              01-001   01-010   01-011   01-101                        60950003
*                                                                       61000003
G000     EQU   *                                                        61050003
         CLI   UCBTBYT4,UCB2400        2400 DEVICE?                     61100003
         BE    F390                    YES - BRANCH TO PERM ERROR       61150003
*                                                                       61200003
         CLI   EWAXCSW2,IB3001         CODE = 00-001?            Y02032 61250003
         BE    F370                    YES - GO RETRY                   61300003
*                                                                       61350003
         CLI   EWAXCSW2,IB3002         CODE = 00-010?            Y02032 61400003
         BE    F370                    YES - GO RETRY                   61450003
*                                                                       61500003
         CLI   EWAXCSW2,IB3003         CODE = 00-011?            Y02032 61550003
         BE    F370                    YES - GO RETRY                   61600003
*                                                                       61650003
         CLI   EWAXCSW2,IB3005         CODE = 00-101?            Y02032 61700003
         BE    F370                    YES - GO RETRY                   61750003
*                                                                       61800003
         CLI   EWAXCSW2,IB3041         CODE = 01-001?            Y02032 61850003
         BE    F370                    YES - GO RETRY                   61900003
*                                                                       61950003
         CLI   EWAXCSW2,IB3042         CODE = 01-010?            Y02032 62000003
         BE    F370                    YES - GO RETRY                   62050003
*                                                                       62100003
         CLI   EWAXCSW2,IB3043         CODE = 01-011?            Y02032 62150003
         BE    F370                    YES - GO RETRY                   62200003
*                                                                       62250003
         CLI   EWAXCSW2,IB3045         CODE = 01-101?            Y02032 62300003
         BE    F370                    YES - GO RETRY                   62350003
         B     F390                    NO - BRANCH TO PERM ERROR        62400003
*                                                                       62450003
*   COMMAND - REW, RUN, NOP, TIE, LWR, MODE SETS                        62500003
*   THE FOLLOWING COMBINATIONS OF TERMINATION                           62550003
*   CODE AND SEQUENCE CODE CAN BE RETRIED:                              62600003
*              00-001   00-010                                          62650003
*              01-001   01-010                                          62700003
*              10-001   10-010                                          62750003
*                                                                       62800003
G100     EQU   *                                                        62850003
         CLI   UCBTBYT4,UCB2400        2400 DEVICE?                     62900003
         BE    F316                    YES - GO CHECK 2400 CODES        62950003
*                                                                       63000003
         CLI   EWAXCSW2,IB3002         CODE = 00-010?            Y02032 63050003
         BE    F370                    YES - GO RETRY                   63100003
*                                                                       63150003
         CLI   EWAXCSW2,IB3042         CODE = 01-010?            Y02032 63200003
         BE    F370                    YES - GO RETRY                   63250003
*                                                                       63300003
         CLI   EWAXCSW2,IB3082         CODE = 10-010?            Y02032 63350003
         BE    F370                    YES - GO RETRY                   63400003
*                                                                       63450003
*   COMMAND - RD, RDB, WRT, ERG, WTM, BSR, BSF, FSR, FSF                63500003
*   THE FOLLOWING COMBINATIONS OF TERMINATION                           63550003
*   CODE AND SEQUENCE CODE CAN BE RETRIED:                              63600003
*              00-001                                                   63650003
*              01-001                                                   63700003
*              10-001                                                   63750003
*                                                                       63800003
G200     EQU   *                                                        63850003
         CLI   UCBTBYT4,UCB2400        2400 DEVICE?                     63900003
         BE    F316                    YES - GO CHECK 2400 CODES        63950003
*                                                                       64000003
         CLI   EWAXCSW2,IB3001         CODE = 00-001?            Y02032 64050003
         BE    F370                    YES - GO RETRY                   64100003
*                                                                       64150003
         CLI   EWAXCSW2,IB3041         CODE = 01-001?            Y02032 64200003
         BE    F370                    YES - GO RETRY                   64250003
*                                                                       64300003
         CLI   EWAXCSW2,IB3081         CODE = 10-001?            Y02032 64350003
         BE    F370                    YES - GO RETRY                   64400003
         B     F390                    NO - BRANCH TO PERM ERROR        64450003
         EJECT                                                          64500003
*********************************************************************** 64550003
*                 WRITE TO OPERATOR MESSAGE                           * 64600003
*********************************************************************** 64650003
WTOMSG   DS    0F                      OUTPUT MESSAGE                   64700003
LENGTH   DC    AL2(MSGEND-MSGNO)       MESSAGE LENGTH                   64750003
         DC    X'8000'                 MCS FLAGS                 A43378 64800003
MSGNO    DC    CL8'IEA000I '           MESSAGE ID                       64850003
UNITID   DC    CL4'XXX,'               UNIT ADDRESS                     64900003
MSGTEXT  DC    CL13'            ,'     MESSAGE TEXT                     64950003
OPCODE   DC    CL3'XX,'                CCW OP CODE                      65000003
STATUS   DC    CL5'XXXX,'              CCW STATUS                       65050003
SENSE    DC    CL5'XXXX,'              SENSE DATA                       65100003
LOC      DC    CL9'XXXXXXXX,'          DCB BLOCK COUNT, INDICATES       65150003
*                                      APPROXIMATE POSITION ON TAPE.    65200003
VOLSER   DC    CL6'XXXXXX'             VOLUME SERIAL NUMBER      A40906 65250003
ROUTE    DC    X'20001040'             DESCRIPTOR AND ROUTING @ZA30415  65300037
MSGEND   EQU   *                                                        65350003
ERRMSG1  DC    CL13'ERROR ON ERG,'     MESSAGE 1                 A40267 65400003
ERRMSG2  DC    CL13'NOISE - USER,'     MESSAGE 2                 A40267 65450003
ERRMSG3  DC    CL13'NOISE - ERP ,'     MESSAGE 3                 A40267 65500003
ERRMSG4  DC    CL13'UNEX INTRPT ,'     MESSAGE 4                 S21048 65550003
ERRMSG5  DC    CL13'DSE FAILED  ,'     MESSAGE 5                 S21048 65600003
ERRMSG6  DC    CL13'CTRL BLK ERR,'     MESSAGE 6                 A29974 65650003
ERRMSG7  DC    CL13'UNEX LOAD PT,'     MESSAGE 7                 A29972 65700003
*                                                                       65750003
*   TRANSLATE TABLE                                                     65800003
*                                                                       65850003
TRANS    EQU   *-X'ED'                 STARTING ADDR OF TRANS TABLE     65900003
TABLE    DC    C'*, 0123456789ABCDEF'  TRANSLATE TABLE                  65950003
NULLOP   DC    X'EDED'                 WILL TRANSLATE TO '**'           66000003
*                                                                       66050003
*                                                                       66100003
         DS    0H                      ALIGN                            66150003
EIGHT    DC    AL2(8)                  HALFWORD OF 8                    66200003
ALLF     DC    X'FFFF'                 COMPARE MASK                     66250003
F24      DC    F'24'                   FULLWORD OF 24            Y02032 66300003
FZERO    DC    X'00000000'             FULLWORD OF 0                    66350003
H512     DC    H'512'                  HALFWORD OF 512           Y02032 66400003
         ORG   ERP2+4067               **                               66450003
         DC    C'**   E N D   L O A D   2   **'     **                  66500003
         IECDERWA  EWT                                           Y02032 66550003
         EJECT                                                          66600003
         IECDIOSB                                                Y02032 66650003
         EJECT                                                          66700003
         IEFUCBOB  PREFIX=YES                                    Y02032 66750003
         EJECT                                                          66800003
CVT      DSECT                                                          66850003
         CVT                                                            66900003
         EJECT                                                          66950003
         IECDIOCM                                                       67000003
         END                                                            67050003
