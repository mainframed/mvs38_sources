./  ADD  SSI=53290717,NAME=IEHATLAS
         TITLE 'IEHATLAS - UTILITY'                              S20201 00080020
         COPY  LCGASMSW                                                 00160003
IEHATLAS CSECT                                                          00210003
*                                                                       00212030
*D 731200                           @SA73430=@YA08015=@XA08848=@ZA01742 00220030
*C 732000                           @SA73430=@YA08015=@XA08848=@ZA01742 00230030
*A 732500                           @SA73430=@YA08015=@XA08848=@ZA01742 00232030
*                                                                       00240020
*                                                                       00320020
*          RELEASE 22 DELETIONS/CHANGES                                 00400020
*          RELEASE 21 DELETIONS/CHANGES                                 00480020
*C155600,650000                                                @ZA01660 00490002
*485300,941300                                                OX02345   00530003
*          RELEASE 20 DELETIONS/CHANGES                                 00560020
*0700000800-001600,590400                                        S20201 00600020
*                                                                       00640020
*STATUS CHANGE LEVEL 002                                                00720020
*                                                                       00800020
*        TITLE 'IEHATLAS-UTILITY'                                       00880020
*FUNCTION/OPERATION                                                   * 00960020
*    THIS MODULE IS THE UTILITY PORTION OF THE PROGRAM IEHATLAS, THE  * 01040020
*SYSTEM UTILITY THAT ATTEMPTS RECOVERY FROM HARD READ/WRITE ERRORS.   * 01120020
*UPON ENTRY IT ESTABLISHES ITS OWN ADDRESSABILITY AND THAT OF THE     * 01200020
*WORK AREA WHICH IT GETS.  ITS MAIN FUNCTIONS ARE THE FOLLOWING-      * 01280020
*                                                                     * 01360020
*    1.  TO GET DDNAMES AND PAGE NUMBER PARAMETERS IF THE             * 01440020
*        UTILITY IS INVOKED.                                          * 01520020
*    2.  TO CHECK DCB PARAMETERS OF SYSIN AND SYSPRINT FOR            * 01600020
*        BLOCKSIZE A MULTIPLE OF LRECL                                * 01680020
*    3.  TO GET A CONTROL CARD AND CHECK FOR VALIDITY                 * 01760020
*    4.  TO GET CORE FOR THE INPUT RECORD, GET THE RECORD, AND        * 01840020
*        PRINT IT ON THE MESSAGE DATA SET                             * 01920020
*    5.  TO EXECUTE THE CHANNEL PROGRAM WHICH IT BUILDS IN AN         * 02000020
*        ATTEMPT TO WRITE THE RECORD WHERE THE ERROR OCCURRED         * 02080020
*    6.  TO INSURE AN ERROR ACTUALLY EXISTS IF THE INPUT RECORD       * 02160020
*        IS THE VTOC BY ATTEMPTING TO READ THE ERROR RECORD           * 02240020
*    7.  TO GIVE CONTROL TO THE SVC IF AN ALTERNATE TRACK             * 02320020
*        MUST BE ASSIGNED                                             * 02400020
*    8,  TO PRINT DIAGNOSTIC MESSAGES INDICATING RESULTS OF           * 02480020
*        EXECUTION                                                    * 02560020
*                                                                     * 02640020
*ENTRY POINTS                                                         * 02720020
*    IEHATLAS - ATTEMPTS RECOVERY FROM A HARD READ/WRITE ERROR.       * 02800020
*                                                                     * 02880020
*INPUT                                                                * 02960020
*    CONSISTS OF THE FOLLOWING-                                       * 03040020
*                                                                     * 03120020
*    1.  A PARAMETER LIST INCLUDING DDNAME-OVERRIDES AND PAGE         * 03200020
*        NUMBER (REGISTER 1 CONTAINS A POINTER TO THE ADDRESSES       * 03280020
*        OF THE PARAMETERS)                                           * 03360020
*    2.  CONTROL INFORMATION SPECIFYING TYPE OF RECORD TO BE          * 03440020
*        REPLACED (VTOC OR TRACK), THE LOCATION OF THE RECORD         * 03520020
*        ON THE DEIVCE, THE LENGTH OF THE RECORD, AND AN              * 03600020
*        INDICATION IF WRITE SPECIAL IS REQUIRED                      * 03680020
*    3.  THE RECORD IN HEXADECIMAL                                    * 03760020
*    4.  RETURN CODES FROM THE SVC --                                 * 03840020
*          0 - SUCCESS                                                * 03920020
*          4 - WRONG DEVICE TYPES                                     * 04000020
*          8 - NO MORE ALTERNATES                                     * 04080020
*         12 - CORE NOT AVAILABLE                                     * 04160020
*         16 - I/O ERROR IN ALTERNATE TRACK ASSIGNMENT                * 04240020
*         20 - INVALID I/O SENSE INDICATION                           * 04320020
*         24 - FORMAT 4 IN ERROR                                      * 04400020
*         28 - USER'S RECORD IS FORMAT 4                              * 04480020
*         32 - ERROR IN COUNT FIELD OF LAST RECORD ON TRACK           * 04560020
*         36 - R0-HOME ADDRESS ERRORS                                 * 04640020
*         40 - -ERROR/ERRORS ENCOUNTERED BUT AN ALTERNATE HAS         * 04720020
*              BEEN ASSIGNED                                          * 04800020
*         44 - ERROR/ERRORS ENCOUNTERED  NO ALTERNATE ASSIGNED        * 04880020
*         48 - NO ERRORS FOUND, NO ALTERNATE ASSIGNED                 * 04960020
*         52 - CAN NOT RE-EXECUTE CALLER'S CHANNEL PROGRAM            * 05040020
*         56 - SYSTEM DOES NOT SUPPORT TRACK OVERFLOW                 * 05120020
*         60 - TRACK ADDRESS PROVIDED DOES NOT BELONG TO DATASET      * 05200020
*        64 - VIRTUAL DEVICES NOT SUPPORTED                     YL02912 05240002
*                                                                     * 05280020
*OUTPUT                                                               * 05360020
*    CONSISTS OF THE FOLLOWING-                                       * 05440020
*                                                                     * 05520020
*    1.  A MESSAGE DATA SET INCLUDING THE CONTROL INFORMATION         * 05600020
*        SUPPLIED BY THE USER, THE INPUT RECORD, AND DIAGNOSTICS      * 05680020
*    2.  UPDATED PAGE NUMBER                                          * 05760020
*    3.  CORRECT FORM OF RECORD IN ERROR EITHER ON THE ORIGINAL       * 05840020
*        TRACK OR ON AN ALTERNATE TRACK                               * 05920020
*                                                                     * 06000020
*EXTERNAL ROUTINES                                                    * 06080020
*    SVC 86 ASSIGNS AN ALTERNATE TRACK, TRANSFERS DATA FROM THE BAD   * 06160020
*TRACK, RE-EXECUTES THE CHANNEL PROGRAM TO WRITE THE CORRECTED RECORD,* 06240020
*AND UPDATES THE FORMAT4 DSCB.  A TWO-WORD PARAMETER LIST INCLUDING   * 06320020
*THE ADDRESSES OF THE IOB AND THE COUNT ARE POINTED TO BY REGISTER 1  * 06400020
*WHEN THE SVC IS INVOKED  A ONE WORD PARAMETER LIST IS RETURNED WHICH * 06480020
*INDICATES THE RECORD NUMBERS OF A MAXIMUM OF THREE ERROR RECORDS IF  * 06560020
*AN UNRECOVERABLE CONDITION OCCURS IN ASSIGNING AN ALTERNATE          * 06640020
*                                                                     * 06720020
*EXITS                                                                * 06800020
*    RETURNS CONTROL TO THE CALLING PROGRAM                           * 06880020
*                                                                     * 06960020
*TABLES/WORK AREAS                                                    * 07040020
*    A GETMAIN IS ISSUED FOR THE SIZE OF THE INPUT RECORD AND ANOTHER * 07120020
*FOR A WORK AREA OF 1300 BYTES.  THE WORK AREA PROVIDES SPACE FOR     * 07200020
*BUILDING THE CHANNEL PROGRAM, MESSAGES, COUNT FIELDS, DCB'S, AND     * 07280020
*LIST FORMS OF THE MACROS.                                            * 07360020
*                                                                     * 07440020
*ATTRIBUTES                                                           * 07520020
*    REENTRANT, REFRESHABLE                                           * 07600020
*********************************************************************** 07680020
*        EQUATES                                                     *  07760020
*********************************************************************** 07840020
TBIT1    EQU   X'40'                    *                               07920020
TBIT2    EQU   X'20'                    *                               08000020
TBIT3    EQU   X'10'                    *                               08080020
TBIT5    EQU   X'04'                    *                               08160020
TBIT6    EQU   X'02'                    *                               08240020
TBIT7    EQU   X'01'                    *                               08320020
BITS67   EQU   X'03'                    *                               08400020
ALLBITS  EQU   X'FF'                    *                               08480020
ATLASSVC EQU   86                       ATLAS SVC NUMBER         S20201 08520020
*********************************************************************** 08560020
*        CONSTANTS                                                   *  08640020
*********************************************************************** 08720020
C00      EQU   X'00'                    *                               08800020
C03      EQU   X'03'                    *                               08880020
C0D      EQU   X'0D'                    *                               08960020
C16      EQU   X'10'                    *                               09040020
C28      EQU   X'28'                    *                               09120020
C30      EQU   X'30'                    *                               09200020
C40      EQU   X'40'                    *                               09280020
C41      EQU   X'41'                    *                               09360020
C42      EQU   X'42'                    *                               09440020
C80      EQU   X'80'                    *                               09520020
DBLZERO  EQU   X'00'                    *                               09600020
DUMMY    EQU   X'10'                    *                               09680020
OHFOUR   EQU   X'04'                    *                               09760020
ZEROFOX  EQU   X'0F'                    *                               09840020
ELEVEN   EQU   X'11'                    *                               09920020
TWENTY   EQU   X'20'                    *                               10000020
EIGHTY   EQU   X'80'                    *                               10080020
EIGHTY7  EQU   X'87'                    *                               10160020
FOXZERO  EQU   X'F0'                    *                               10240020
SKIPAGE  EQU   X'F1'                    *                               10320020
BLANK    EQU   C' '                     *                               10400020
PRINTERR EQU   C'R'                     *                               10480020
SPECIALW EQU   C'S'                     *                               10560020
EQUALS   EQU   C'='                     *                               10640020
SLASH    EQU   C'/'                     *                               10720020
X0       EQU   0                        *                               10800020
*********************************************************************** 10880020
*        CONDITION CODE EQUATES                                       * 10960020
*********************************************************************** 11040020
CC00     EQU   X'00'                    *                               11120020
CC16     EQU   X'10'                    *                               11200020
*********************************************************************** 11280020
*        DISPLACEMENT CONSTANTS                                      *  11360020
*********************************************************************** 11440020
D0       EQU   0                        *                               11520020
D1       EQU   1                        *                               11600020
D2       EQU   2                        *                               11680020
D3       EQU   3                        *                               11760020
D4       EQU   4                        *                               11840020
D6       EQU   6                        *                               11920020
D7       EQU   7                        *                               12000020
D8       EQU   8                        *                               12080020
D12      EQU   12                       *                               12160020
D14      EQU   14                       *                               12240020
D26      EQU   26                       *                               12320020
D27      EQU   27                       *                       YL02912 12360002
D34      EQU   34                       *                               12400020
D42      EQU   42                       *                               12480020
D49      EQU   49                       *                               12560020
D58      EQU   58                       *                               12640020
D75      EQU   75                       *                               12720020
*********************************************************************** 12800020
*        FULLWORD AND HALFWORD EQUATES                                * 12880020
*********************************************************************** 12960020
FW1      EQU   1                        *                               13040020
FW2      EQU   2                        *                               13120020
FW3      EQU   3                        *                               13200020
FW10     EQU   10                       *                               13280020
FW18     EQU   18                       *                               13360020
FW19     EQU   19                       *                               13440020
FW29     EQU   29                       *                               13520020
FW59     EQU   59                       *                               13600020
*********************************************************************** 13680020
*        LENGTH CONSTANTS                                            *  13760020
*********************************************************************** 13840020
L1       EQU   1                        *                               13920020
L2       EQU   2                        *                               14000020
L3       EQU   3                        *                               14080020
L4       EQU   4                        *                               14160020
L5       EQU   5                        *                               14240020
L6       EQU   6                        *                               14320020
L7       EQU   7                        *                               14400020
L8       EQU   8                        *                               14480020
L9       EQU   9                        *                               14560020
L12      EQU   12                       *                               14640020
L13      EQU   13                       *                               14720020
L16      EQU   16                       *                               14800020
L20      EQU   20                       *                               14880020
L24      EQU   24                       *                               14960020
L26      EQU   26                       *                               15040020
L36      EQU   36                       *                               15120020
L40      EQU   40                       *                               15200020
L43      EQU   43                       *                               15280020
L44      EQU   44                       *                               15360020
L48      EQU   48                       *                               15440020
L53      EQU   53                       *                               15520020
L60      EQU   60                       *                      @ZA01660 15560002
L76      EQU   76                       *                               15600020
L79      EQU   79                       *                               15680020
L80      EQU   80                       *                               15760020
L117     EQU   117                      *                               15840020
L118     EQU   118                      *                               15920020
L119     EQU   119                      *                               16000020
L120     EQU   120                      *                               16080020
L255     EQU   255                      *                               16160020
*********************************************************************** 16240020
*        MESSAGE CODES                                               *  16320020
*********************************************************************** 16400020
MC00     EQU   X'00'                    *                               16480020
MC01     EQU   X'01'                    *                               16560020
MC02     EQU   X'02'                    *                               16640020
MC03     EQU   X'03'                    *                               16720020
MC04     EQU   X'04'                    *                               16800020
MC05     EQU   X'05'                    *                               16880020
MC06     EQU   X'06'                    *                               16960020
MC07     EQU   X'07'                    *                               17040020
MC08     EQU   X'08'                    *                               17120020
MC09     EQU   X'09'                    *                               17200020
MC0A     EQU   X'0A'                    *                               17280020
MC0B     EQU   X'0B'                    *                               17360020
MC0C     EQU   X'0C'                    *                               17440020
MC0D     EQU   X'0D'                    *                               17520020
MC0E     EQU   X'0E'                    *                               17600020
MC0F     EQU   X'0F'                    *                               17680020
MC10     EQU   X'10'                    *                               17760020
MC11     EQU   X'11'                    *                               17840020
MC12     EQU   X'12'                    *                               17920020
MC13     EQU   X'13'                    *                               18000020
MC14     EQU   X'14'                    *                               18080020
MC15     EQU   X'15'                    *                               18160020
MC16     EQU   X'16'                    *                               18240020
MC17     EQU   X'17'                    *                               18320020
MC18     EQU   X'18'                    *                       YL02912 18360002
*********************************************************************** 18400020
*        SWITCH EQUATES                                               * 18480020
*********************************************************************** 18560020
SW3      EQU   X'10'                    *                               18640020
SW4      EQU   X'08'                    *                               18720020
SW7      EQU   X'01'                    *                               18800020
*                                                                     * 18880020
*REGISTER ASSIGNMENTS                                                   18960020
PARMA    EQU   0                        PARAMETER REGISTER ZERO         19040020
PARMB    EQU   1                        PARAMETER REGISTER ONE          19120020
WORKE    EQU   2                        EVEN WORK REGISTER              19200020
WORKO    EQU   3                        ODD WORK REGISTER               19280020
FOUR     EQU   4                        WORK REGISTERS                  19360020
FIVE     EQU   5                        *                               19440020
SIX      EQU   6                        *                               19520020
SEVEN    EQU   7                        *                               19600020
EIGHT    EQU   8                        *                               19680020
NINE     EQU   9                        *                               19760020
TEN      EQU   10                       *                               19840020
AREAREG  EQU   11                       WORKAREA POINTER                19920020
BASEREG  EQU   12                       BASE REGISTER                   20000020
SAVEREG  EQU   13                       SAVE AREA POINTER               20080020
RETREG   EQU   14                       RETURN REGISTER                 20160020
ADDREG   EQU   15                       ADDRESSABILITY REGISTER AND     20240020
*                                          RETURN CODE REGISTER         20320020
         EJECT                                                          20400020
*STANDARD LINKAGE CONVENTION                                            20480020
         SAVE  (14,12),T,--A-68-V1      SAVE CALLING PROGRAM'S REG'S    20560020
         USING IEHATLAS,BASEREG         ESTABLISH ADDRESSABILITY        20640020
         LR    BASEREG,ADDREG                                           20720020
         EXTRN MESSTBL                                                  20800020
*********************************************************************** 20840002
* PRIMARY WORK AREA WILL CONTAIN DCB'S,IOB,ECB,CHANNEL PROGRAM,         20880020
* MESSAGE AREA AND SWITCHES                                             20960020
*********************************************************************** 21000002
         LR    FOUR,PARMB                                               21040020
         GETMAIN R,LV=1300                                              21120020
*********************************************************************** 21160002
* CLEAR THE ENTIRE WORKAREA TO ZEROS                                    21200020
*********************************************************************** 21240002
         LR    AREAREG,PARMB            SET UP ADDRESSABILITY TO THE    21280020
         USING IEHWORK,AREAREG             WORK AREA                    21360020
         MVI   SAVE1,DBLZERO            ZERO PROPAGATION OF SAVE AREA   21440020
         MVC   SAVE110(L255),SAVE10     *                               21520020
         MVC   SAVE111(L255),SAVE11     *                               21600020
         MVC   SAVE112(L255),SAVE12     *                               21680020
         MVC   SAVE113(L255),SAVE13     *                               21760020
         MVC   SAVE114(L255),SAVE14     *                               21840020
         MVC   SAVE115(L24),SAVE15      *                               21920020
         ST    SAVEREG,SAVE1BK          CHAIN SAVE AREA TO NEW SAVE     22000020
         LR    SAVEREG,AREAREG             AREA                         22080020
         MVI   HEADER,BLANK             CLEAR HEADING TO BLANKS         22160020
         MVC   HEADER1(L119),HEADER                                     22240020
         MVI   MESSAGE,BLANK            SET MESSAGE AREA TO BLANKS      22320020
         MVC   MESSAGE1(L119),MESSAGE                                   22400020
* INVOCATION                                                            22480020
         CLI   D0(FOUR),C80             WAS UTILITY INVOKED BY PROBLEM  22560020
*                                          PROGRAM                      22640020
         BE    SETDCBS                  NO, PREPARE DCB'S               22720020
*********************************************************************** 22760002
* PICK UP DDNAMES IF USER SUPPLIES THEM                                 22800020
*********************************************************************** 22840002
         L     FIVE,D4(X0,FOUR)         LOAD SECOND PARAMETER           22880020
         CLI   D0(FIVE),C00             IS DDNAME LIST LONG ENOUGH TO   22960020
*                                          INCLUDE SYSUT1 DDNAME        23040020
         BNE   CHKALL                   YES, CHECK FOR NAMES            23120020
         CLI   D1(FIVE),C40             LIST LONG ENOUGH TO INCLUDE     23200020
*                                          SYSUT1 DDNAME                23280020
         BL    CHK2                     NO, TEST FOR OTHERS             23360020
         SPACE                                                          23440020
CHKALL   OC    D58(L8,FIVE),D58(FIVE)   IS SYSUT1 DDNAME GIVEN          23520020
         BZ    CHKPRT                   NO                              23600020
         MVC   SYSUT1DD(L8),D58(FIVE)   YES, SAVE IN WORK AREA          23680020
         SPACE                                                          23760020
CHKPRT   OC    D42(L8,FIVE),D42(FIVE)   IS SYSPRINT DDNAME GIVEN        23840020
         BZ    CHKIN                    NO                              23920020
         MVC   PRINTDD(L8),D42(FIVE)    YES,SAVE IN WORK AREA           24000020
         SPACE                                                          24080020
CHKIN    OC    D34(L8,FIVE),D34(FIVE)   IS SYSIN DDNAME GIVEN           24160020
         BZ    CHKFLG                   NO                              24240020
         MVC   SYSINDD(L8),D34(FIVE)    YES, SAVE IN WORK AREA          24320020
         SPACE                                                          24400020
CHKFLG   CLI   D4(FOUR),C80             WAS DDNAME THE LAST PARAMETER   24480020
         BE    SETDCBS                  YES, PREPARE DCB'S              24560020
         B     GETPG                    CHECK PAGE PARAMETER            24640020
         SPACE                                                          24720020
CHK2     CLI   D1(FIVE),C30             IS LIST LONG ENOUGH TO INCLUDE  24800020
*                                          SYSPRINT                     24880020
         BNL   CHKPRT                   YES                             24960020
         CLI   D1(FIVE),C28             IS LIST LONG ENOUGH TO INCLUDE  25040020
*                                          SYSIN                        25120020
         BNL   CHKIN                    YES                             25200020
         B     CHKFLG                   CHECK FOR PAGE PARAMETER        25280020
*********************************************************************** 25320002
         SPACE                                                          25360020
* DETERMINE PAGE NUMBER                                                 25440020
*********************************************************************** 25480002
GETPG    L     FIVE,D8(X0,FOUR)         LOAD PAGE NUMBER ADDRESS        25520020
         ST    FIVE,SAVEPAR             SAVE ADDRESS                    25600020
         OC    D0(L2,FIVE),D0(FIVE)     IS PAGE NUMBER GIVEN            25680020
         BZ    SETDCBS                  NO,PREPARE DCB'S                25760020
*********************************************************************** 25800002
         SPACE                                                          25840020
* THIS SECTION MOVES THE PAGE NUMBER TO THE WORK AREA AND CONVERTS      25920020
* IT TO HEXADECIMAL                                                     26000020
*********************************************************************** 26040002
         XC    DOUBLE(L8),DOUBLE        CLEAR WORK AREA                 26080020
         MVC   CONVERT(L4),D2(FIVE)     MOVE PAGE NO TO WORK AREA       26160020
         PACK  DOUBLE5(L3),CONVERT(L4)  CONVERT PAGE NO TO BINARY       26240020
         SR    SIX,SIX                                                  26320020
         CVB   SIX,DOUBLE                                               26400020
         BCTR  SIX,X0                   DECREMENT BY ONE                26480020
         ST    SIX,PAGENO               STORE CONVERTED PAGE NUMBER     26560020
*********************************************************************** 26600002
         SPACE                                                          26640020
* PREPARE DCB'S AND OPEN MACRO                                          26720020
*********************************************************************** 26760002
SETDCBS  MVC   REENTAR(CLOSELS-OPENLS),OPENLS   MOVE L FORM TO WORKAREA 26800020
         MVC   DCBSYP(DCBXLST-DCBPRINT),DCBPRINT  MOVE DCB TO WKAREA    26880020
         LA    EIGHT,DCBSYP             ESTABLISH DCB ADDRESSABILITY    26960020
         USING IHADCB,EIGHT                                             27040020
         OC    PRINTDD(L8),PRINTDD      WAS SYSPRINT DDNAME             27120020
*                                          USER SUPPLIED                27200020
         BZ    OPENPRNT                 *                               27280020
         MVC   DCBDDNAM(L8),PRINTDD     MOVE DDNAME TO DCB              27360020
OPENPRNT OPEN  ((8),OUTPUT),MF=(E,REENTAR)                              27440020
         TM    DCBOFLGS,TBIT3           WAS OPEN SUCCESSFUL FOR         27520020
*                                          SYSPRINT                     27600020
         BO    TESTUT1                  YES, SUCCESSFUL OPEN            27680020
         MVI   COMPCODE,CC16            SET COMPLETION CODE TO 16       27760020
         B     ENDEXIT                  BRANCH TO EXIT ROUTINE          27840020
TESTUT1  TM    COMPCODE,ALLBITS         CHECK FOR ERROR IN DCB EXIT     27920020
         BM    WRAPUP                   YES, ERROR FOUND                28000020
*********************************************************************** 28040002
         SPACE                                                          28080020
*THIS SECTION PUTS OUT A HEADING WITH UTILITY NAME, DATE, AND PAGE      28160020
*NUMBER                                                                 28240020
*********************************************************************** 28280002
         MVI   HEADERC,SKIPAGE          SET TO SKIP TO A NEW PAGE       28320020
         MVC   HEADER(L8),UTNAME        MOVE IN UTILITY NAME            28400020
         MVC   HEADR105(L4),PAGEEQ      MOVE IN PAGE NUMBER             28480020
DA000    TIME                                                           28560020
         LR    PARMA,PARMB              PICK UP DATE                    28640020
         SRDL  PARMA,L16                SEPARATE YEARS AND DAYS         28720020
         SRL   PARMB,L16                PUT DAYS LOW ORDER              28800020
         LR    FOUR,PARMA               SAVE YEAR                       28880020
         SR    PARMA,PARMA              CLEAR REGISTER                  28960020
         LA    WORKO,FW19               DOES YEAR(IN DECIMAL) HAVE AN   29040020
         NR    WORKO,FOUR                  EVEN FIRST DIGIT AND A       29120020
*                                          SECOND DIGIT OF 0, 4, OR 8   29200020
         BZ    DA010                    YES, LEAP YEAR                  29280020
         LA    WORKE,FW18               DOES YEAR(IN DECIMAL) HAVE AN   29360020
         XR    WORKO,WORKE                 ODD FIRST DIGIT AND A SECOND 29440020
*                                          DIGIT OF 2, OR 6             29520020
         BZ    DA010                    YES, LEAP YEAR                  29600020
         LA    WORKO,FW1                SET SWITCH TO INDICATE THAT     29680020
*                                          THIS IS NOT A LEAP YEAR      29760020
*                                                                       29840020
DA010    STM   PARMA,PARMB,DOUBLE                                       29920020
         CVB   WORKE,DOUBLE             CONVERT DAYS TO BINARY          30000020
         SR    PARMB,PARMB                                              30080020
         LR    FIVE,PARMB                                               30160020
*                                                                       30240020
DA020    LA    PARMB,D1(X0,PARMB)       INCREMENT MONTH                 30320020
         IC    FIVE,XTMN-D1(PARMB)      DAYS MONTH                      30400020
         SR    WORKE,FIVE               SUBTRACT FROM DAYS LEFT         30480020
         LA    SIX,FW3                  CONSTANT FOR THIRD MONTH        30560020
         CLR   SIX,PARMB                IS THIS MARCH                   30640020
         BNE   DA030                    NO                              30720020
         LTR   WORKO,WORKO              YES, IS IT LEAP YEAR            30800020
         BP    DA030                    NO                              30880020
         BCTR  WORKE,X0                 YES, REDUCE DAYS BY ONE         30960020
*                                                                       31040020
DA030    LTR   WORKE,WORKE              ARE DAYS COUNTED DOWN TO ZERO   31120020
         BP    DA020                    NO, REPEAT LOOP                 31200020
         AR    WORKE,FIVE               YES,RESTORE SUBTRACTED VALUE    31280020
         LTR   WORKE,WORKE              TEST FOR ZERO.(FEBRUARY 29TH)   31360020
         BNZ   DA040                    NO                              31440020
         LA    WORKE,FW29               YES, SET FOR DAY 29             31520020
         BCTR  PARMB,X0                 DECREMENT TO FEBRUARY           31600020
*                                                                       31680020
DA040    LA    WORKO,FW2                LOOP COUNT                      31760020
DA050    CVD   PARMB,DOUBLE             CHANGE MONTH TO DECIMAL         31840020
         L     FIVE,DOUBLE4             MONTH TO LOWER HALF             31920020
         SLL   FIVE,L20                                                 32000020
         SLDL  FOUR,L8                  SHIFT UP TO YEAR OR MONTH       32080020
         LR    PARMB,WORKE                                              32160020
         BCT   WORKO,DA050              REPEAT UNTIL DONE               32240020
         SLL   FOUR,L8                  POSITION DATE FOR STORING       32320020
         ST    FOUR,DOUBLE              CONVERT FOR PRINTING            32400020
         UNPK  CONVERT(L7),DOUBLE(L4)   POSITION DATE FOR STORING       32480020
         MVC   HEADER90(L2),CONVERT2    MOVE IN MONTH OF YEAR           32560020
         MVI   HEADER92,SLASH                                           32640020
         MVC   HEADER93(L2),CONVERT4    MOVE IN DAY OF MONTH            32720020
         MVI   HEADER95,SLASH                                           32800020
         MVC   HEADER96(L2),CONVERT     MOVE IN YEAR                    32880020
*********************************************************************** 32900002
*        OPEN  SYSIN / SYSUT1                                   YL02912 32920002
*********************************************************************** 32940002
         EJECT                                                          32960020
         MVC   DCBSYSIN(DCBPRINT-DCBIN),DCBIN  MOVE SYSIN DCB TO        33040020
*                                              WORKAREA                 33120020
         MVC   DCBSYS1(DCBIN-DCBDATA),DCBDATA  MOVE SYSUT1 DCB TO       33200020
*                                              WORKAREA                 33280020
         MVC   REENTAR(CLOSEL-OPENL1),OPENL1   MOVE L FORM TO           33360020
*                                              WORKAREA                 33440020
         LA    NINE,DCBSYS1             PICK UP ADDRESSES OF THE DCB'S  33520020
         LA    TEN,DCBSYSIN                                             33600020
         DROP  EIGHT                                                    33680020
         USING IHADCB,TEN                                               33760020
         OC    SYSINDD(L8),SYSINDD      WAS SYSIN DDNAME USER-SUPPLIED  33840020
         BZ    OPENDCB                  NO, OPEN SYSIN DCB              33920020
*********************************************************************** 33940002
*        OPEN  SYSIN                                            YL02912 33960002
*********************************************************************** 33980002
         MVC   DCBDDNAM,SYSINDD         MOVE DDNAME TO DCB              34000020
OPENDCB  OPEN  ((10),INPUT),MF=(E,REENTAR)                              34080020
         TM    DCBOFLGS,TBIT3           WAS OPEN SUCCESSFUL FOR SYSIN   34160020
         BZ    SETNO                    NO, OPEN NOT SUCCESSFUL         34240020
READSYS  MVC   REENTAR(OPENLS-READJL),READJL   MOVE L FORM TO           34320020
*                                              WORKAREA                 34400020
         LA    WORKE,JFCBADR            LOAD POINTER TO JFCB AREA       34480020
         ST    WORKE,CONVERT                                            34560020
         MVC   SECONDX1(L3),CONVERT1    SET UP DCB EXIT                 34640020
         MVI   SECONDEX,EIGHTY7         FLAG FOR JFCB EXIT              34720020
         LA    WORKE,SECONDEX           PICK UP READJ DCB EXIT LIST     34800020
*                                          ADDRESS                      34880020
         ST    WORKE,CONVERT                                            34960020
         DROP  TEN                                                      35040020
         USING IHADCB,NINE                                              35120020
         OC    SYSUT1DD(L8),SYSUT1DD    WAS SYSUT1 DDNAME USER-SUPPLIED 35200020
         BZ    MOVEEXIT                 NO, BRANCH AROUND               35280020
*********************************************************************** 35300002
*        OPEN  SYSUT1                                           YL02912 35320002
*********************************************************************** 35340002
         MVC   DCBDDNAM(L8),SYSUT1DD    MOVE IN SYSUT1 DDNAME           35360020
MOVEEXIT MVC   DCBEXLST+D1(L3),CONVERT1 MOVE EXIT ADDRESS INTO DCB      35440020
         RDJFCB (DCBSYS1),MF=(E,REENTAR)  READ JFCB FOR SYSUT1          35520020
         MVC   NAMESLOT(L44),JFCBADR    SAVE DSNAME FROM SYSUT1 JFCB    35600020
*********************************************************************** 35620002
*        COMPLETE HEADING W/PAGE NUMBER                         YL02912 35640002
*********************************************************************** 35660002
PAGEING  L     FOUR,PAGENO              UPDATE PAGE NUMBER              35680020
         LA    FOUR,D1(X0,FOUR)                                         35760020
         ST    FOUR,PAGENO              RETURN UPDATED PAGE NUMBER      35840020
         CVD   FOUR,DOUBLE              CONVERT PAGE NUMBER FOR         35920020
         UNPK  DOUBLE8(L3),DOUBLE6(L2)     PRINTING                     36000020
         OI    DOUBLE10,FOXZERO                                         36080020
         MVC   HEADR110(L3),DOUBLE8     MOVE IN PAGE NUMBER             36160020
         LA    FOUR,FW59                ESTABLISH LINE COUNT            36240020
         STH   FOUR,LINECT                                              36320020
         PUT   DCBSYP,HEADERC           WRITE OUT MESSAGE DATA SET      36400020
*                                          HEADER                       36480020
         TM    MESSCODE,BITS67          CHECK FOR MISSING DD            36560020
         BO    WRITEMES                 YES, WRITE APPROPRIATE MESSAGE  36640020
         TM    COMPCODE,ALLBITS         CHECK FOR AN ERROR DURING OPEN  36720020
*                                          EXIT                         36800020
*********************************************************************** 36820002
*        GET CONTROL CARDS                                      YL02912 36840002
*********************************************************************** 36860002
         BM    ERRIN                    YES, GO TO CLOSE                36880020
         EJECT                                                          36960020
ANOTHER  GET   DCBSYSIN                 GET ANOTHER CONTROL RECORD      37040020
         DROP  NINE                                                     37120020
         USING IHADCB,TEN                                               37200020
         LA    FOUR,EODAD               CHANGE EODAD                    37280020
         ST    FOUR,DCBEODAD               FOR DATA CARDS               37360020
         DROP  TEN                                                      37440020
         USING IHADCB,NINE                                              37520020
         MVC   MESSAGE(L80),D0(PARMB)   MOVE CONTROL CARD TO WORKAREA   37600020
         BAL   RETREG,WRITECD           GO TO PRINT CONTROL CARD        37680020
*********************************************************************** 37700002
*        VALIDATE CONTROL CARD                                  YL02912 37720002
*********************************************************************** 37740002
         CLI   MESSAGE,BLANK            CHECK FOR BLANK IN COLUMN ONE   37760020
         BNE   INVALID                  NO, INVALID CONTROL CARD        37840020
         LA    FOUR,MESSAGE1            SET UP SCAN FOR TRACK OR VTOC   37920020
         LA    FIVE,MESSAG61               KEYWORDS                     38000020
CHECKKEY CLI   D0(FOUR),BLANK           START OF CONTROL CARD           38080020
         BE    GOON                     NO                              38160020
         CLC   D0(L6,FOUR),TRACK        CHECK FOR TRACK KEYWORD         38240020
         BE    PICKCNT                  YES, FOUND KEYWORD              38320020
         CLC   D0(L5,FOUR),VTOC         CHECK FOR VTOC KEYWORD          38400020
         BE    VTOCFND                  YES, VTOC FOUND                 38480020
         B     INVALID                  INVALID CONTROL CARD            38560020
GOON     CR    FOUR,FIVE                AT END OF CONTROL CARD          38640020
         BNL   INVALID                  YES, AT END OF CONTROL CARD     38720020
         LA    FOUR,D1(X0,FOUR)         BUMP POINTER                    38800020
         B     CHECKKEY                 RETURN TO LOOP                  38880020
INVALID  MVI   COMPCODE,CC16            SET COMPLETION CODE=16          38960020
         MVI   MESSCODE,MC05            SET MESSAGE CODE TO INDICATE    39040020
*                                          MISSING OR INVALID CONTROL   39120020
*                                          CARD KEYWORD                 39200020
         B     FLUSH                    GO TO FLUSH INPUT               39280020
VTOCFND  BCTR  FOUR,X0                  DECREMENT POINTER               39360020
         OI    TRKOVFL,SW7              SET FOR VTOC                    39440020
PICKCNT  LA    FIVE,FW10                SET COUNTER FOR 20              39520020
         TR    D6(L20,FOUR),TABLE       CONVERT TO 20 BYTES             39600020
CHECK    CLI   D6(FOUR),C16             CHECK FOR INVALID CHARACTER     39680020
         BE    WRONG                    YES,INVALID CHARACTER           39760020
         CLI   D7(FOUR),C16             CHECK FOR INVALID CHARACTER     39840020
         BE    WRONG                    YES,INVALID CHARACTER           39920020
         LA    FOUR,D2(X0,FOUR)         BUMP POINTER                    40000020
         BCT   FIVE,CHECK               CHECK FOR ALL BYTES CONVERTED   40080020
         SH    FOUR,HW20                ADJUST POINTER TO BEGINNING     40160020
*                                          OF COUNT                     40240020
*********************************************************************** 40260002
*        SET CYLINDER AND TRACK DATA                            YL02912 40280002
*********************************************************************** 40300002
         MVC   DOUBLE(L8),D6(FOUR)      MOVE BBBBCCCC TO WORK AREA      40320020
         PACK  DOUBLE4(L5),DOUBLE(L9)   REMOVE EXTRA ZONE BYTES         40400020
         MVC   TRACKAD2(L4),DOUBLE4     MOVE BBCC TO SEEK ADDRESS       40480020
         MVC   COUNT(L2),DOUBLE6        MOVE CC TO COUNT FIELD          40560020
         MVC   DOUBLE(L12),D14(FOUR)    MOVE HHHHRRKKDDDD TO WORK AREA  40640020
         PACK  DOUBLE6(L7),DOUBLE(L13)  REMOVE EXTRA ZONE BYTES         40720020
         MVC   TRACKAD6(L2),DOUBLE6     MOVE HH TO SEEK ADDRESS         40800020
         MVC   COUNT2(L6),DOUBLE6       MOVE HHRKDD TO COUNT FIELD      40880020
         SR    FIVE,FIVE                                                40960020
         IC    FIVE,COUNT5              PICK UP KEY LENGTH              41040020
         STH   FIVE,KEYSIZE             SAVE THIS KEY LENGTH            41120020
         AH    FIVE,COUNT6              ADD THE DATA FIELD LENGTH       41200020
         STH   FIVE,KEYDATA             SAVE THIS KEY-DATA LENGTH       41280020
         LA    FIVE,D8(X0,FIVE)         ADD COUNT FIELD LENGTH OF 8     41360020
         STH   FIVE,CCWCOUNT            SAVE COUNT+KEY+DATA LENGTH      41440020
         MVC   TESTDS(L12),D27(FOUR)    /TEST/    /SNAP         YL02912 41442002
         XC    PNTSNAP,PNTSNAP          CLEAR SNAP LIST POINTER YL02912 41444002
         CLC   TESTDC,TESTDS            TEST MODE               YL02912 41446002
         BNE   CHEKSPEC                 NOT TESTING             YL02912 41448002
         LA    PARMB,DCBSYS1            SYSUT1 DCBDATA AREA     YL02912 41450002
         USING IHADCB,PARMB             ADDRESSING              YL02912 41452002
         MVI   DCBMACR1,FOXZERO         APPENDAGES REQUIRED     YL02912 41454002
         DROP  PARMB                    DROP REG                YL02912 41456002
         CLC   SNAPDC,SNAPDS            SNAP NEEDED             YL02912 41458002
         BNE   CHEKSPEC                 NOT SNAPPING            YL02912 41460002
         OPEN  (DUMP1,(OUTPUT))         OPEN SNAP AREA          YL02912 41462002
         LA    PARMB,SNAPIT             GET LIST ADDRESS        YL02912 41464002
         ST    PARMB,PNTSNAP            SAVE LIST ADDRESS       YL02912 41466002
CHEKSPEC CLI   D26(FOUR),SPECIALW       CHECK FOR WRITE SPECIAL         41520020
*                                          COMMAND REQUIRED             41600020
         BNE   GETBUFF                  NO, GO GET RECORD BUFFER        41680020
*********************************************************************** 41700002
*        GET DEVICE CONFIGURATION                               YL02912 41720002
*********************************************************************** 41740002
         DEVTYPE  DCBDDNAM,DEVFEAT      GET DEVICE CHARACTERISTICS      41760020
         TM    DEVFEAT1,TBIT1           DOES THE SYSTEM SUPPORT TRACK   41840020
*                                          OVERFLOW                     41920020
         BO    SETSW                    YES, TRACK OVERFLOW IS          42000020
*                                          SUPPORTED                    42080020
         MVI   MESSCODE,MC14            THE SYSTEM DOES NOT SUPPORT     42160020
*                                          TRACK OVERFLOW               42240020
         B     COMPSET                  SET COMPLETION CODE             42320020
SETSW    OI    TRKOVFL,SW3              SET FOR WRITE SPECIAL           42400020
*********************************************************************** 42420002
*        GET CORE FOR RECORD                                    YL02912 42440002
*********************************************************************** 42460002
GETBUFF  MVC   GETLS(L16),GETL          MOVE LIST FORM TO WORK AREA     42480020
         ST    FIVE,GETLS               PUT NUMBER BYTES REQUIRED       42560020
         LA    PARMB,GETLS              GET ADDRESS OF WHERE AREA       42640020
         ST    PARMB,GETLS4                ADDRESS IS TO BE RETURNED    42720020
         GETMAIN EC,MF=(E,(1))          GETMAIN FOR RECORD SIZE         42800020
         LTR   ADDREG,ADDREG            CHECK FOR GOTTEN CORE           42880020
         BNZ   NOCORE                   CORE NOT AVAILABLE              42960020
         L     PARMB,GETLS              PICK UP ADDRESS OF GOTTEN CORE  43040020
         ST    PARMB,GOTCORE            SAVE POINTER TO GOTTEN CORE     43120020
         LR    FOUR,PARMB               PICK UP POINTER TO GOTTON CORE  43200020
         LA    SIX,D8(X0,FOUR)          ADJUST MOVING POINTER BEYOND    43280020
*                                          COUNT                        43360020
         MVC   D0(L8,FOUR),COUNT        MOVE IN COUNT                   43440020
         S     FIVE,FW8                 ACCOUNT FOR COUNT FIELD LENGTH  43520020
         LTR   FIVE,FIVE                IS DATA + KEY LENGTH=0          43600020
         BZ    GOGETUM                  YES, MAKE SURE NO MORE CONTROL  43680020
*                                          CARDS ARE IN INPUT STREAM    43760020
*********************************************************************** 43780002
*        GET USERS DATA                                         YL02912 43800002
*********************************************************************** 43820002
GETSYS   GET   DCBSYSIN                                                 43840020
         MVC   MESSAGE(L80),D0(PARMB)   MOVE IN USER'S DATA INTO OUTPUT 43920020
*                                          AREA TO PRINT                44000020
         LR    WORKE,PARMB                                              44080020
         BAL   RETREG,WRITECD           GO TO WRITE DATA CARD           44160020
         C     FIVE,FW40                MORE THAN 40 BYTES LEFT         44240020
         BH    MOVE40                   YES, MORE THAN 40               44320020
         LR    SEVEN,FIVE               SET UP BYTE COUNTER             44400020
         SR    FIVE,FIVE                                                44480020
         B     TRANSLAT                 TRANSLATE PROPER NUMBER         44560020
*                                          OF BYTES                     44640020
*********************************************************************** 44660002
*        VALIDATE USERS RECORD                                  YL02912 44680002
*********************************************************************** 44700002
MOVE40   LA    SEVEN,L40                SET COUNTER FOR 40              44720020
         S     FIVE,FW40                SUBTRACT 40 FOR OUTPUT          44800020
TRANSLAT TR    D0(L80,WORKE),TABLE      CONVERT TO 80 BYTES             44880020
VALIDCK  CLI   D0(WORKE),C16            CHECK FOR INVALID CHARACTER     44960020
         BE    WRONG                    YES, INVALID CHARACTER          45040020
         CLI   D1(WORKE),C16            CHECK FOR INVALID CHARACTER     45120020
         BE    WRONG                    YES, INVALID CHARACTER          45200020
         IC    EIGHT,D0(WORKE)          PICK UP FIRST BYTE OF 2 BYTE    45280020
*                                          CHARACTER                    45360020
         SLL   EIGHT,L4                 SHIFT OUT HIGH ORDER DIGIT      45440020
         STC   EIGHT,D0(SIX)            STORE FIRST HALF OF DIGIT       45520020
         OC    D0(L1,SIX),D1(WORKE)     OR THE FIRST AND SECOND DIGITS  45600020
         LA    SIX,D1(X0,SIX)           BUMP OUTPUT POINTER             45680020
         LA    WORKE,D2(X0,WORKE)       BUMP INPUT POINTER              45760020
         BCT   SEVEN,VALIDCK            CHECK FOR ALL BYTES ON THIS     45840020
*                                          CARD CONVERTED               45920020
         LTR   FIVE,FIVE                CHECK FOR ALL BYTES IN RECORD   46000020
*                                       CONVERTED                       46080020
         BNZ   GETSYS                   NO, ALL BYTES NOT CONVERTED     46160020
*********************************************************************** 46200002
* GET AGAIN FROM SYSIN TO FORCE EODAD                                   46240020
*********************************************************************** 46280002
GOGETUM  GET   DCBSYSIN                                                 46320020
         B     TOOFEW                   SHOULD NOT BE HERE UNLESS SYSIN 46400020
*                                          CONTAINS MORE CONTROL OR     46480020
*                                          DATA CARDS THAN REQUIRED     46560020
*********************************************************************** 46580002
*        ESTABLISH CCW'S                                        YL02912 46600002
*********************************************************************** 46620002
         EJECT                                                          46640020
EODAD    LTR   FIVE,FIVE                TEST FOR CORRECT NUMBER OF      46720020
*                                          BYTES FOR OUTPUT             46800020
         BNZ   TOOFEW                   CHARACTERS RECEIVED IS LESS     46880020
*                                          THAN COUNT SPECIFIED         46960020
         MVC   CCWAR1(L48),CCW1         MOVE CCWS TO WORK AREA          47040020
         L     FOUR,GOTCORE             RESTORE WORK AREA POINTER       47120020
         ST    FOUR,CONVERT                                             47200020
         MVC   CCWAR11(L3),CONVERT1     ESTABLISH POINTER TO COUNT FOR  47280020
*                                          SEARCH EQUAL ID              47360020
         MVC   CCWAR41(L3),CONVERT1                                     47440020
         LA    FIVE,CCWAR1              ESTABLISH ADDRESS OF FIRST CCW  47520020
         ST    FIVE,CONVERT                FOR TIC                      47600020
         MVC   CCWAR21(L3),CONVERT1                                     47680020
         LA    FIVE,CCWAR4              ESTABLISH ADDRESS OF FOURTH CCW 47760020
         ST    FIVE,CONVERT                FOR TIC                      47840020
         MVC   CCWAR51(L3),CONVERT1                                     47920020
         MVC   CCWAR3A2(L2),KEYDATA     INSERT LENGTH OF KEY AND DATA   48000020
         LA    FIVE,D8(X0,FOUR)         PICK UP POINTER TO RECORD       48080020
         ST    FIVE,CONVERT                                             48160020
         MVC   CCWAR31(L3),CONVERT1     ESTABLISH ADDRESS FROM WHICH    48240020
*                                          DATA IS TO BE WRITTEN        48320020
         MVC   CCWAR61(L3),CONVERT1     ESTABLISH ADDRESS INTO WHICH    48400020
*                                       DATA IS TO BE READ              48480020
*********************************************************************** 48520002
         MVC   CCWAR6A2(L2),KEYDATA     MOVE LENGTH OF KEY/DATA OX02345 48530003
         SPACE                                                          48560020
* INSERT TEST HERE TO CHANGE WRITE KEY DATA TO WRITE(SPECIAL) COUNT,KEY 48640020
* DATA                                                                  48720020
*********************************************************************** 48760002
         TM    TRKOVFL,TBIT3              WRITE SPECIAL REQUIRED        48800020
         BZ    BUILDECB                 NO, WRITE SPECIAL NOT REQUIRED  48880020
         MVI   CCWAR3,SW7               SET WRITE FOR TRACK OVERFLOW    48960020
         MVC   CCWAR31(L3),CCWAR11      MOVE ADDRESS OF COUNT IN FOR    49040020
*                                          WRITE(SPECIAL) COUNT, KEY,   49120020
*                                          DATA                         49200020
         MVC   CCWAR3A2(L2),CCWCOUNT    INSERT LENGTH OF KEY+DATA+COUNT 49280020
         L     FIVE,CCWAR1              LOAD POINTER TO COUNT FIELD     49360020
*                                          FOR SEARCH ID EQUAL CCW      49440020
         MVC   ID(L4),D0(FIVE)          MOVE INTO NEW COUNT FIELD       49520020
         XR    FOUR,FOUR                                                49600020
         IC    FOUR,D4(FIVE)            LOAD OLD SEARCH RECORD NUMBER   49680020
         BCTR  FOUR,X0                  DECREMENT BY 1                  49760020
         STC   FOUR,ID4                 STORE R IN NEW COUNT FIELD      49840020
         LA    FOUR,ID                  OBTAIN POINTER TO NEW COUNT     49920020
*                                          FIELD                        50000020
         ST    FOUR,TEMP                                                50080020
         MVC   CCWAR11(L3),TEMP1        MOVE POINTER INTO SEARCH CCW    50160020
*********************************************************************** 50200002
         EJECT                                                          50240020
* THIS SECTION BUILDS THE REQUIRED ECB AND IOB AND ATTEMPTS TO WRITE    50320020
* THE REPLACEMENT RECORD                                                50400020
*********************************************************************** 50440002
BUILDECB LA    FIVE,ECB                 PUT ECB ADDRESS INTO IOB        50480020
         ST    FIVE,IOBECB                                              50560020
         OC    KEYDATA(L2),KEYDATA      KEY/DATA LENGTH = ZERO.         50640020
         BNZ   NONZERO                  NO, GO ON                       50720020
         LA    FIVE,CCWAR4              PUT ADDRESS OF FOURTH CCW INTO  50800020
*                                          IOB                          50880020
         B     MARCHON                  CONTINUE                        50960020
NONZERO  LA    FIVE,CCWAR1              PUT ADDRESS OF FIRST CCW AND    51040020
MARCHON  LA    SIX,DCBSYS1                 DCB ADDRESS INTO IOB         51120020
         STM   FIVE,SIX,IOBSTART                                        51200020
         MVC   SEEK1(L6),TRACKAD2       MOVE IN SEEK ADDRESS            51280020
         LA    NINE,DCBSYS1                                             51360020
PREPDCB  MVC   REENTAR(OPENL1-OPENL2),OPENL2   MOVE L FORM TO WORKAREA  51440020
         XC    DCBEXLST+D1(L3),DCBEXLST+D1 CLEAR DCBEXIT                51520020
         TM    TRKOVFL,TBIT7            CHECK FOR VTOC                  51600020
         BZ    REGOPEN                  NO, NOT VTOC                    51680020
         MVI   JFCBADR,OHFOUR           SET 44 BYTES TO X'04'           51760020
         MVC   JFCBADR1(L43),JFCBADR                                    51840020
         LA    FIVE,DOUBLE                                              51920020
         ST    FIVE,DCBEXLST            STORE POINTER TO DCB EXIT LIST  52000020
         LA    FIVE,JFCBADR             SET UP POINTER TO JFCB TO BE    52080020
         ST    FIVE,DOUBLE                 USED                         52160020
         MVI   DOUBLE,EIGHTY7           SET FOR JFCB BEING USED         52240020
         OI    JFCBTSDM,SW4             TURN ON FLAG SO JFCB WILL       52320020
*                                          NOT BE WRITTEN BACK          52400020
*********************************************************************** 52420002
*        OPEN SYSUT1                                            YL02912 52440002
*********************************************************************** 52460002
         OPEN  ((9),INOUT),TYPE=J,MF=(E,REENTAR)  OPEN SYSUT1 FOR VTOC  52480020
         B     HERE                     GO ON                           52560020
REGOPEN  OPEN  ((9),INOUT),MF=(E,REENTAR)         OPEN SYSUT1           52640020
HERE     TM    DCBOFLGS,TBIT3           CHECK FOR SUCCESSFUL OPEN       52720020
         BZ    SETNOS                   NO, MISSING DD CARD             52800020
*********************************************************************** 52840002
         EJECT                                                          52880020
* THIS SECTION DETERMINES WHICH EXTENT OF THE SYSUT1 DATA SET INCLUDES  52960020
* THE GIVEN BAD TRACK                                                   53040020
*********************************************************************** 53080002
         L     SEVEN,DCBDEBAD           LOAD PTR TO DEB                 53120020
         XR    FIVE,FIVE                ZERO REGISTER                   53200020
         LR    SIX,FIVE                 SET M=0                         53280020
         IC    FIVE,DEBNMEXT(SEVEN)     LOAD NUMBER OF EXTENTS          53360020
         TM    DEBOFLGS(SEVEN),TBIT5    CHECK FOR SPLIT CYL             53440020
         BNO   NOSPLIT                  BRANCH AROUND IF NOT SPLIT      53520020
         MVI   SPLIT,ALLBITS            SET SPLIT SWITCH                53600020
NOSPLIT  LA    SEVEN,DEBDASD(SEVEN)     BUMP PTR TO FIRST EXTENT        53680020
*                                          DESCRIPTION                  53760020
STARTEST CLC   TRACKAD4(L4),DEBSTRCC(SEVEN) IS GIVEN BAD TRACK LOWER    53840020
*                                       THAN START OF EXTENT            53920020
         BL    DECREMNT                 YES, CONTINUE TESTING           54000020
         CLC   TRACKAD4(L4),DEBENDCC(SEVEN) IS GIVEN BAD TRACK HIGHER   54080020
*                                          THAN END OF EXTENT           54160020
         BH    DECREMNT                 YES, CONTINUE TESTING           54240020
         CLI   SPLIT,ALLBITS            SPLIT SWITCH ON                 54320020
         BNE   STOREM                   NO, STORE M                     54400020
         CLC   TRACKAD6(L2),DEBSTRHH(SEVEN) IS GIVEN BAD TRACK HH       54480020
*                                       LOWER THAN EXTENT               54560020
         BL    DECREMNT                 YES, CONTINUE TESTING           54640020
         CLC   TRACKAD6(L2),DEBENDHH(SEVEN) IS GIVEN BAD TRACK HH       54720020
*                                          HIGHER THAN EXTENT           54800020
         BH    DECREMNT                 YES,CONTINUE TESTING            54880020
         B     STOREM                   STORE M                         54960020
DECREMNT BCT   FIVE,INCREMNT            DECREMENT NUMBER OF EXTENTS AND 55040020
*                                          CONTINUE                     55120020
         B     INVALIDS                 OUT OF EXTENT                   55200020
INCREMNT LA    SIX,D1(SIX)              INCREMENT M                     55280020
         LA    SEVEN,NEXTEXT(SEVEN)     BUMP POINTER TO NEXT DEB EXTENT 55360020
         B     STARTEST                 CHECK NEXT EXTENT               55440020
STOREM   STC   SIX,SEEK                 STORE M INTO IOB SEEK ADDRESS   55520020
         L     SIX,D0(SEVEN)            GET POINTER TO UCB      YL02912 55540002
         TM    D0(SIX),EIGHTY           IS IT VIRTUAL           YL02912 55560002
         BO    ISVERT                   YES - DON'T SUPPORT     YL02912 55580002
         USING UCB,SIX                                         @Y30LSFY 55582003
         TM    UCBTBYT2,UCB2OPT4        VIRTUAL UCB ?          @Y30LSFY 55590003
         BO    ISVERT                   YES - DON'T SUPPORT    @Y30LSFY 55592003
         DROP  SIX                                             @Y30LSFY 55594003
         EJECT                                                          55600020
         TM    TRKOVFL,TBIT7            CHECK FOR VTOC                  55680020
         BO    TESTVTOC                 YES, VTOC, TRY TO READ RECORD   55760020
*********************************************************************** 55780002
*        ATTEMP TO WRITE RECORD                                 YL02912 55800002
*********************************************************************** 55820002
GOODSEEK EQU   *                                                        55840020
         XC    ECB(L4),ECB              CLEAR ECB                       55920020
         EXCP  IOB                      ATTEMPT TO WRITE RECORD         56000020
         WAIT  1,ECB=ECB                WAIT FOR I/O TO COMPLETE        56080020
         TM    ECB,TBIT2                CHECK FOR I/O SUCCESSFUL        56160020
         BO    NOALT                    YES, I/O SUCCESSFUL             56240020
         CLI   ECB,C42                  OUT OF EXTENT                   56320020
         BE    INVALIDS                 YES, WRITE ERROR MESSAGE        56400020
         CLI   ECB,C41                  ARE CSW CONTENTS VALID          56480020
         BNE   WRONGERR                 NO, CAN'T HANDLE ERROR          56560020
         CLI   IOBCSWST,C0D             END OF FILE                     56640020
         BE    NOALT                    YES, KEYDATA LENGTH =0          56720020
         TM    IOBCSWST,TBIT6           DID USER CHECK OCCUR            56800020
         BNO   WRONGERR                 NO, CAN'T HANDLE ERROR          56880020
         B     GETSET                   SET UP PARAMETER LIST           56960020
*********************************************************************** 56980002
*        READ VTOC                                              YL02912 57000002
*********************************************************************** 57020002
TESTVTOC LA    SIX,CCWAR4               GET NEW ADDRESS TO READ RECORD  57040020
         ST    SIX,IOBSTART             STORE IN IOBSTART               57120020
         EXCP  IOB                      ATTEMPT TO READ                 57200020
         WAIT  1,ECB=ECB                WAIT FOR I/O TO COMPLETE        57280020
         TM    ECB,TBIT2                I/O SUCCESSFUL                  57360020
         BO    PREPMESS                 YES, CAN'T HANDLE REQUEST       57440020
         LA    SIX,CCWAR1               RESTORE IOBSTART FIELD WITH     57520020
         ST    SIX,IOBSTART                ADDRESS OF WRITE PROGRAM     57600020
         MVI   DCBIFLGS,DBLZERO         RESET ERROR FLAGS               57680020
         B     GOODSEEK                 EXECUTE WRITE CHANNEL PROG      57760020
*********************************************************************** 57780002
*        PREPARE FOR ATLAS SVC                                  YL02912 57800002
*********************************************************************** 57820002
GETSET   MVI   DCBIFLGS,DBLZERO         RESET ERROR FLAGS               57840020
         DROP  NINE                                                     57920020
         EJECT                                                          58000020
         LA    PARMB,IOB                SET UP POINTER TO IOB           58080020
         ST    PARMB,PARMLIST                                           58160020
         LA    PARMB,COUNT              SET UP POINTER TO COUNT         58240020
         ST    PARMB,PARMLIS4                                           58320020
         MVI   PARMLIS4,EIGHTY          TURN ON UTILITY FLAG FOR SVC    58400020
         TM    TRKOVFL,TBIT3            WAS USER RECORD AN OVERFLOW     58480020
*                                          SEGMENT                      58560020
         BZ    NOVFL                    NO,WRITE SPECIAL NOT REQUIRED   58640020
         OI    PARMLIS4,TWENTY          YES, TURN ON WRITE SPECIAL FOR  58720020
*                                          SVC                          58800020
NOVFL    LA    PARMB,PARMLIST           SET UP PARAMETER REGISTER TO    58880020
*                                          POINT TO PARAMETER LIST      58960020
         SVC   ATLASSVC                 ISSUE SVC 86             S20201 59040020
*********************************************************************** 59080002
         SPACE                                                          59120020
* BRANCH TABLE BASED ON SVC RETURN CODES. GO TO APPROPRIATE ROUTINE TO  59200020
* SET COMPLETION AND MESSAGE CODES.                                     59280020
*********************************************************************** 59320002
         B     BRANCH(ADDREG)           B                               59360020
BRANCH   B     SUCCESS                   R                              59440020
         B     WRONGDEV                   A                             59520020
         B     NOMORE                   F  N                            59600020
         B     NOCORE                    O  C                           59680020
         B     IOERROR                    R  H                          59760020
         B     WRONGERR                    -                            59840020
         B     F4NOT                        E  T                        59920020
         B     USERF4                        R  A                       60000020
         B     LASTCNT                        R  B                      60080020
         B     R0HA                            O  L                     60160020
         B     DATAERR                          R  E                    60240020
         B     USERSREC                          -                      60320020
         B     NOERR                              M                     60400020
         B     NOREEX                              S                    60480020
         B     NOTRKOVF                             G                   60560020
         B     TRKOUT                                S                  60640020
         B     ISVERT                   *                       YL02912 60680002
*                                                                       60720020
SUCCESS  MVI   MESSCODE,MC00            MESSAGE FOR SUCCESS             60800020
         B     WRITEMES                 WRITE SUCCESSFUL MESSAGE        60880020
WRONGDEV MVI   MESSCODE,MC07            WRONG DEVICE TYPES              60960020
         B     COMPSET                  SET COMPLETION CODE             61040020
NOMORE   MVI   MESSCODE,MC08            NO MORE ALTERNATES              61120020
         B     COMPSET                  SET COMPLETION CODE             61200020
NOCORE   MVI   MESSCODE,MC09            CORE NOT AVAILABLE              61280020
         B     COMPSET                  SET COMPLETION CODE             61360020
IOERROR  MVI   MESSCODE,MC02            I/O ERROR                       61440020
         B     COMPSET                  SET COMPLETION CODE             61520020
WRONGERR MVI   MESSCODE,MC0D            NO DATA CHECK OR MISSING        61600020
*                                          ADDRESS MARKER               61680020
         B     COMPSET                  SET COMPLETION CODE             61760020
F4NOT    MVI   MESSCODE,MC0E            FORMAT 4 DSCB COULD NOT BE READ 61840020
         B     COMPSET                  SET COMPLETION CODE             61920020
USERF4   MVI   MESSCODE,MC0F            ERROR ON LAST COUNT FIELD       62000020
*                                          RECORD                       62080020
         B     COMPSET                  SET COMPLETION CODE             62160020
LASTCNT  MVI   MESSCODE,MC10            ERROR ON LAST COUNT FIELD       62240020
         B     COMPSET                  SET COMPLETION CODE             62320020
R0HA     MVI   MESSCODE,MC11            R0 AND HA ERRORS                62400020
         B     COMPSET                  SET COMPLETION CODE             62480020
DATAERR  MVI   MESSCODE,MC12            ERROR/ERRORS ENCOUNTERED        62560020
*                                          AN ALTERNATE HAS BEEN        62640020
*                                          ASSIGNED                     62720020
         B     COMPSET                  SET COMPLETION CODE             62800020
NOERR    MVI   MESSCODE,MC17            NO ERRORS FOUND ON TRACK        62880020
*                                          NO ALTERNATE ASSIGNED        62960020
         B     COMPSET                  SET COMPLETION CODE             63040020
NOREEX   MVI   MESSCODE,MC13            CHANNEL PROGRAM NOT RE-         63120020
*                                          EXECUTABLE                   63200020
         B     COMPSET                  SET COMPLETION CODE             63280020
NOTRKOVF MVI   MESSCODE,MC14            MESSAGE FOR SYSTEM DOES NOT     63360020
*                                          SUPPORT TRACK OVERFLOW       63440020
         B     COMPSET                  SET COMPLETION CODE             63520020
TRKOUT   MVI   MESSCODE,MC0B            TRACK IS OUT OF EXTENTS         63600020
         B     COMPSET                  SET COMPLETION CODE             63680020
ISVERT   EQU   *                        YL02912                         63700002
         MVI   MESSCODE,MC18            NO VIRTUAL UCB SUPPORT          63720002
         B     COMPSET                  SET COMPLETION CODE             63740002
USERSREC MVI   MESSCODE,MC16            CAN'T HANDLE ERROR              63760020
*                                          NO ALTERNATE ASSIGNED        63840020
COMPSET  MVI   COMPCODE,CC16            SET COMPLETION CODE TO 16       63920020
         ST    PARMA,RETPARM            SAVE ERROR RECORD NUMBERS       64000020
*********************************************************************** 64040002
* THIS ROUTINE WRITES OUT ALL MESSAGES                                  64080020
*********************************************************************** 64120002
WRITEMES EQU   *                                                        64160020
         SR    WORKO,WORKO                                              64240020
         IC    WORKO,MESSCODE           PICK UP MESSAGE NUMBER          64320020
         CH    WORKO,HW10               CHECK FOR SYNAD ENTERED FOR     64400020
*                                          SYSIN                        64480020
         BE    SPECIAL                  YES, SYNAD ENTERED FOR SYSIN    64560020
CONTWRT  SLL   WORKO,L6                 MULTIPLY MESSAGE X 64   YL02912 64640002
         L     FOUR,MESSTBLA            MESSAGE MASK ADDRESS    YL02912 64700002
         MVC   MESSAGE(L120),D0(FOUR)   SET IN MASK             YL02912 64760002
         LA    WORKO,L120(WORKO,FOUR)   INCREMENT TO MESSAGE    YL02912 64820002
         MVC   MESSAGE4(L2),D0(WORKO)   SET IN IEH9XXI CODE     YL02912 64880002
         MVC   MESS112(L2),D2(WORKO)    SET IN COMPLETION CODE  YL02912 64940002
         MVC   MESSAGE8(L60),D4(WORKO)  SET IN MESSAGE         @ZA01660 65000002
         LA    FIVE,CHKMESS             LOAD RETURN ADDRESS             65120020
PUTOUT   PUT   DCBSYP,MESSAGEC          PUT OUT MESSAGE                 65200020
         BR    FIVE                     GO TO NEXT ROUTINE              65280020
*********************************************************************** 65300002
*        CHECK MESSAGE CODE                                     YL02912 65320002
*********************************************************************** 65340002
CHKMESS  CLI   MESSCODE,C03             IS MESSAGE CODE FOR MISSING DD  65360020
         BNE   NEXTEST                  NO, GO ON TO NEXT TEST          65440020
         USING IHADCB,TEN                                               65520020
         TM    DCBOFLGS,TBIT3           IS SYSIN DCB OPEN               65600020
         BO    ENDCARD                  YES, IT IS OPEN                 65680020
         B     WRAPUP                   BRANCH TO EXIT ROUTINE          65760020
         DROP  TEN                                                      65840020
NEXTEST  EQU   *                                                        65920020
         CLI   MESSCODE,C00             WAS MESSAGE FOR SUCCESSFUL      66000020
*                                          COMPLETION                   66080020
         BE    ORCORE                   YES,NO NEED TO PRINT ERROR      66160020
*                                          RECORD NUMBERS               66240020
         CLI   RETPARM,C00              ARE THERE ANY ERROR RECORDS TO  66320020
*                                          BE PRINTED OUT               66400020
         BE    ORCORE                   NO,GO TO WRAP UP                66480020
         XR    WORKE,WORKE              CLEAR REGISTER                  66560020
         LA    FOUR,MESSAGE                                             66640020
         MVI   MESSAGE,PRINTERR         SET UP PRINTOUT FOR ERROR       66720020
         MVI   MESSAGE1,EQUALS             RECORDS                      66800020
         MVI   MESSAGE2,ELEVEN          MOVE IN DUMMY CODE FOR BLANKS   66880020
         MVC   MESSAGE3(L117),MESSAGE2  PROPAGATE THRU MESSAGE AREA     66960020
         LA    WORKO,RETPARM                                            67040020
         XR    SIX,SIX                                                  67120020
*********************************************************************** 67140002
*        SET IN ERROR RECORD NUMBERS                            YL02912 67160002
*********************************************************************** 67180002
         IC    SIX,RETPARM              PICK UP NUMBER OF ERROR RECORDS 67200020
MOVIT    IC    WORKE,D1(X0,WORKO)       PICK UP ERROR RECORD NUMBER     67280020
         SRL   WORKE,L4                 SHIFT OUT RIGHT DIGIT           67360020
         STC   WORKE,D2(X0,FOUR)        PLACE LEFT DIGIT IN ONE BYTE    67440020
*                                          OF MESSAGE AREA              67520020
         MVC   D3(L1,FOUR),D1(WORKO)    MOVE SAME RECORD NUMBER TO      67600020
*                                          NEXT BYTE IN MESSAGE AREA    67680020
         NI    D3(FOUR),ZEROFOX         SET LEFT HALF OF BYTE TO ZERO   67760020
         MVI   D4(FOUR),DUMMY           MOVE IN DUMMY COMMA             67840020
         LA    FOUR,D3(FOUR)            INCREMENT MESSAGE AREA          67920020
*                                          POINTER                      68000020
         LA    WORKO,D1(WORKO)          INCREMENT PARAMETER LIST        68080020
*                                          POINTER                      68160020
         BCT   SIX,MOVIT                REDUCE NUMBER OF ERROR RECORDS  68240020
*                                          BY ONE AND TEST FOR ZERO     68320020
         TR    MESSAGE2(L118),TRANSTB   IF ALL RECORD NUMBERS MOVED TO  68400020
*                                          MESSAGE AREA-TRANSLATE FOR   68480020
*                                          PRINTOUT                     68560020
         LA    FIVE,ORCORE              LOAD RETURN ADDRESS             68640020
         B     PUTOUT                   BRANCH TO PUT ROUTINE           68720020
*********************************************************************** 68740002
*        FREE WORK AREA                                         YL02912 68760002
*********************************************************************** 68780002
ORCORE   OC    GOTCORE(L4),GOTCORE      HAS CORE BEEN GOTTEN FOR THE    68800020
*                                          RECORD                       68880020
         BZ    ENDCARD                  NO, CLOSE DCB'S                 68960020
FREE     LH    FIVE,CCWCOUNT                                            69040020
         L     FOUR,GOTCORE             RESTORE WORK AREA POINTER       69120020
         FREEMAIN R,LV=(5),A=(4)        FREE BUFFER                     69200020
         B     ENDCARD                  CLOSE OUT DCB'S                 69280020
SPECIAL  MVC   MESSAGE(L8),IONUMBER     MOVE IN SPECIAL MESSAGE NUMBER  69360020
         MVC   MESSAG96(L24),COMPMESS   MOVE COMPLETION CODE TO MESSAGE 69440020
         PUT   DCBSYP,MESSAGEC                                          69520020
         B     CONTWRT                  PUT OUT ANOTHER MESSAGE         69600020
*********************************************************************** 69620002
*        NO ALTERNATES                                          YL02912 69640002
*********************************************************************** 69660002
NOALT    MVI   COMPCODE,CC00            SET COMPLETION CODE TO ZERO     69680020
         MVI   MESSCODE,MC01            SET MESSAGE CODE TO ONE         69760020
         B     WRITEMES                 WRITE SUCCESSFUL MESSAGE        69840020
*********************************************************************** 69860002
*        WRITE CONTROL CARD                                     YL02912 69880002
*********************************************************************** 69900002
WRITECD  LR    FOUR,RETREG              SAVE RETURN POINTER             69920020
         PUT   DCBSYP,MESSAGEC          WRITE CONTROL CARD              70000020
         LH    EIGHT,LINECT                                             70080020
         BCT   EIGHT,SUBTRACT           CHECK LINE COUNT                70160020
         L     EIGHT,PAGENO             NEED NEW PAGE                   70240020
         LA    EIGHT,D1(X0,EIGHT)       UPDATE PAGE NUMBER              70320020
         ST    EIGHT,PAGENO                                             70400020
         CVD   EIGHT,DOUBLE             CONVERT PAGE NUMBER FOR         70480020
         UNPK  DOUBLE8(L3),DOUBLE6(L2)     PRINTING                     70560020
         OI    DOUBLE10,FOXZERO                                         70640020
         MVC   HEADR110(L3),DOUBLE8     MOVE IN PAGE NUMBER             70720020
         PUT   DCBSYP,HEADERC           WRITE OUT HEADER ON MESSAGE     70800020
*                                          DATA SET                     70880020
         LA    EIGHT,FW59                                               70960020
         STH   EIGHT,LINECT             RE-ESTABLISH LINE COUNT         71040020
         LR    RETREG,FOUR              RESTORE RETURN POINTER          71120020
         BR    RETREG                   RETURN TO CALLER                71200020
SUBTRACT STH   EIGHT,LINECT             RETURN UPDATED LINE COUNT       71280020
         LR    RETREG,FOUR              RESTORE RETURN POINTER          71360020
         BR    RETREG                   RETURN TO CALLER                71440020
*********************************************************************** 71460002
*        NO MORE INPUT CARDS                                    YL02912 71480002
*********************************************************************** 71500002
         EJECT                                                          71520020
ENDCARD  MVC   REENTAR(DCBDATA-CLOSEL),CLOSEL  MOVE L FORM TO WORKAREA  71600020
         USING IHADCB,NINE                                              71680020
         XC    DCBDSORG(L2),DCBDSORG    ZERO OUT DSORG IN SYSUT1 DCB    71760020
         DROP  NINE                                                     71840020
         CLOSE ((9),,(10)),MF=(E,REENTAR)      CLOSE SYSIN & SYSUT1     71920020
         FREEPOOL DCBSYSIN              FREE BUFFER FOR SYSIN           72000020
*********************************************************************** 72020002
*        WRAP UP ROUTINES                                       YL02912 72040002
*********************************************************************** 72060002
WRAPUP   MVC   REENTAR(OPENL2-CLOSELS),CLOSELS  MOVE L FORM TO WORKAREA 72080020
         LA    EIGHT,DCBSYP             RESTORE DCB POINTER             72160020
         CLOSE ((8)),MF=(E,REENTAR)                                     72240020
         FREEPOOL DCBSYP                FREE BUFFERS FOR SYSPRINT       72320020
         CLC   SNAPDC,SNAPDS                                    YL02912 72340002
         BNE   ENDEXIT                                          YL02912 72360002
         CLOSE DUMP1                    CLOSE SNAP DUMP         YL02912 72380002
ENDEXIT  L     SAVEREG,D4(SAVEREG)      RESTORE SAVE AREA POINTER       72400020
         SR    FOUR,FOUR                                                72480020
         OC    SAVEPAR(L4),SAVEPAR      WAS PAGE PARAMETER GIVEN        72560020
         BZ    FREECORE                 NO, ISSUE FREEMAIN              72640020
         L     FIVE,SAVEPAR             LOAD ADDRESS OF PARAMETER       72720020
         L     SIX,PAGENO                                               72800020
         CVD   SIX,DOUBLE               CONVERT PAGE NUMBER TO DECIMAL  72880020
         UNPK  CONVERT(L4),DOUBLE5(L3)                                  72960020
         MVC   D2(L4,FIVE),CONVERT      RESTORE PAGE NUMBER PARAMETER   73040020
FREECORE IC    FOUR,COMPCODE            INSERT COMPLETION CODE @ZA01742 73200030
         FREEMAIN R,LV=1300,A=(11)      FREE MAIN WORK AREA    @ZA01742 73250030
         LR    ADDREG,FOUR                                              73280020
         L     RETREG,D12(X0,SAVEREG)   RESTORE RETURN ADDRESS          73360020
         RETURN (2,12),T                                                73440020
*********************************************************************** 73480002
         EJECT                                                          73520020
*THIS IS THE SYNAD ROUTINE FOR SYSIN.  THE SYNADAF & SYNADRLS MACROS    73600020
*ARE USED.  THE COMPLETION CODE AND MESSAGE NUMBERS ARE SET.            73680020
SYSINSYN SYNADAF ACSMETH=QSAM,PARM1=DCBSYSIN,PARM2=(0)                  73760020
*********************************************************************** 73800002
         MVC   MESSAGE8(L79),D49(PARMB) MOVE IN PRINTABLE DATA FROM     73840020
*                                          BUFFER FOR MESSAGE           73920020
         MVI   COMPCODE,CC16            SET COMPLETION CODE FOR 16      74000020
         MVI   MESSCODE,MC0A            SET MESSAGE CODE FOR 10         74080020
         SYNADRLS                                                       74160020
         B     WRITEMES                 PUT OUT MESSAGE                 74240020
*********************************************************************** 74280002
         SPACE                                                          74320020
* THIS SECTION SETS MESSAGE AND COMPLETION CODES FOR MISSING DD         74400020
*********************************************************************** 74440002
SETNO    MVI   COMPCODE,CC16            SET COMPLETION CODE TO SIXTEEN  74480020
         MVI   MESSCODE,MC03            SET MESSAGE CODE TO THREE       74560020
         B     READSYS                  GO BACK TO READJ FOR SYSUT1     74640020
SETNOS   MVI   MESSCODE,MC03            SET MESSAGE CODE TO THREE       74720020
         MVI   COMPCODE,CC16            SET COMPLETION CODE TO 16       74800020
         B     WRITEMES                 WRITE ERROR MESSAGE             74880020
*********************************************************************** 74920002
         SPACE                                                          74960020
* THIS IS THE SYSIN DCB EXIT FOR DCB PARAMETER VALIDATION               75040020
*********************************************************************** 75080002
         USING IHADCB,TEN                                               75120020
DCBEXIT  OC    DCBBLKSI(L2),DCBBLKSI    CHECK FOR NO BLKSIZE            75200020
         BNZ   CHECKM                   YES, BLOCKSIZE PRESENT          75280020
         MVC   DCBBLKSI(L2),DCBLRECL    SET UP BLOCKSIZE                75360020
CHECKM   LH    WORKO,DCBBLKSI           PICK UP BLOCKSIZE               75440020
         LH    FOUR,DCBLRECL            PICK UP LOGICAL RECORD SIZE     75520020
         SR    WORKE,WORKE                                              75600020
         DR    WORKE,FOUR               DIVIDE BLOCKSIZE BY LRECL       75680020
         LTR   WORKE,WORKE              CHECK FOR NO REMAINDER          75760020
         BNE   DCBERR                   NO, SET FOR ERROR IN DCB        75840020
         RETURN                                                         75920020
*********************************************************************** 75940002
*        SYSIN DCB ERROR                                        YL02912 75960002
*********************************************************************** 75980002
DCBERR   MVI   MESSCODE,MC04            SET MESSAGE NUMBER TO FOUR      76000020
         MVI   COMPCODE,CC16            SET COMPLETION CODE TO 16       76080020
         MVC   DCBBLKSI(L2),DCBLRECL    CHANGE BLOCKSIZE                76160020
         RETURN                                                         76240020
*********************************************************************** 76280002
WRONG    MVI   MESSCODE,MC06            SET MESSAGE CODE FOR INVALID    76320020
*                                          CHARACTER IN THE USER'S      76400020
*                                          RECORD                       76480020
         MVI   COMPCODE,CC16            SET COMPLETION CODE TO 16       76560020
FLUSH    LA    EIGHT,WRITEMES           CHANGE SYSIN EODAD ADDRESS      76640020
         ST    EIGHT,CONVERT                                            76720020
         MVC   DCBEODAD+D1(L3),CONVERT1 MOVE IN NEW EODAD ADDRESS       76800020
FLUSHGET GET   DCBSYSIN                                                 76880020
         B     FLUSHGET                 FLUSH REMAINING CARDS           76960020
         DROP  TEN                                                      77040020
*********************************************************************** 77080002
         USING IHADCB,EIGHT                                             77120020
PRINTCK  OC    DCBBLKSI(L2),DCBBLKSI    CHECK FOR NO BLKSIZE            77200020
         BNZ   CHECKPM                  YES, BLOCKSIZE PRESENT          77280020
         MVC   DCBBLKSI(L2),DCBLRECL    SET UP BLOCKSIZE                77360020
CHECKPM  LH    WORKO,DCBBLKSI           PICK UP BLOCKSIZE               77440020
         LH    FOUR,DCBLRECL            PICK UP LOGICAL RECORD SIZE     77520020
         SR    WORKE,WORKE                                              77600020
         DR    WORKE,FOUR               DIVIDE BLOCKSIZE BY LRECL       77680020
         LTR   WORKE,WORKE              CHECK FOR NO REMAINDER          77760020
         BNE   ERRDCB                   NO, SET FOR ERROR IN DCB        77840020
         RETURN                                                         77920020
*********************************************************************** 77960002
ERRDCB   MVI   COMPCODE,CC16            SET COMPLETION CODE TO 16       78000020
         MVC   DCBBLKSI(L2),DCBLRECL    MOVE LRECL TO BLKSIZE           78080020
         RETURN                                                         78160020
*********************************************************************** 78200002
ERRIN    MVI   COMPCODE,CC16            SET COMPLETION CODE TO 16       78240020
         MVI   MESSCODE,MC04            SET MESSAGE CODE FOR INVALID    78320020
*                                          DCB PARAMETERS FOR SYSIN     78400020
         B     WRITEMES                 GO TO WRITE MESSAGE             78480020
*********************************************************************** 78520002
NOCARD   MVI   COMPCODE,CC16            SET COMPLETION CODE TO 16       78560020
         MVI   MESSCODE,MC05            SET MESSAGE CODE TO INDICATE    78640020
*                                          MISSING CONTROL CARD         78720020
         B     WRITEMES                 GO TO WRITE MESSAGE             78800020
*********************************************************************** 78840002
         SPACE                                                          78880020
* THIS SECTION ISSUES A SYNADAF MACRO FOR AN I/O ERROR ON SYSPRINT      78960020
*********************************************************************** 79000002
SYSSYNAD MVC   WTOLIST(L76),WTOLS       MOVE LIST FORM TO WORK AREA     79040020
         LR    FOUR,PARMA               SAVE REGISTER                   79120020
         LA    PARMB,WTOLIST            PREPARE TO ISSUE MACRO          79200020
         WTO   MF=(E,(1))                                               79280020
         LR    PARMA,FOUR               RESTORE REGISTER                79360020
         SYNADAF   ACSMETH=QSAM,PARM1=DCBSYP,PARM2=(0)                  79440020
         MVC   WTOLIS12(L26),D49(PARMB) MOVE IN FIRST PART OF MESSAGE   79520020
         MVC   MSGWTO(L53),D75(PARMB)   SAVE LAST PART OF MESSAGE       79600020
         MVI   WTOLIS38,BLANK           CLEAR REST OF MESSAGE AREA      79680020
         MVC   WTOLIS39(L36),WTOLIS38                                   79760020
         MVI   COMPCODE,CC16            SET COMPLETION CODE TO 16       79840020
         SYNADRLS                                                       79920020
         LA    PARMB,WTOLIST            PREPARE TO ISSUE MACRO          80000020
         WTO   MF=(E,(1))                                               80080020
         MVC   WTOLIS12(L53),MSGWTO     MOVE IN SECOND PART OF MESSAGE  80160020
         MVI   WTOLIS65,BLANK           CLEAR REST OF MESSAGE AREA      80240020
         MVC   WTOLIS66(L9),WTOLIS65                                    80320020
         LA    PARMB,WTOLIST            PREPARE TO ISSUE MACRO          80400020
         WTO   MF=(E,(1))                                               80480020
         B     ENDCARD                  GO TO CLOSE OUT                 80560020
*********************************************************************** 80600002
INVALIDS MVI   COMPCODE,CC16            SET COMPLETION AND MESSAGE CODE 80640020
         MVI   MESSCODE,MC0B               FOR INVALID DEB EXTENTS      80720020
         B     WRITEMES                 WRITE ERROR MESSAGE             80800020
*********************************************************************** 80840002
PREPMESS MVI   COMPCODE,CC00            SET COMPLETION CODE TO 00 -     80880020
*                                          THERE IS NO ERROR            80960020
         MVI   MESSCODE,MC15            RECORD NOT IN ERROR             81040020
         B     WRITEMES                 WRITE MESSAGE                   81120020
*********************************************************************** 81160002
TOOFEW   MVI   COMPCODE,CC16            SET MESSAGE COMPLETION CODES    81200020
         MVI   MESSCODE,MC0C            FOR TO FEW CHARACTERS           81280020
         B     WRITEMES                 WRITE ERROR MESSAGE             81360020
*********************************************************************** 81380002
*        LIST FORM FOR OPEN AND CLOSE                           YL02912 81400002
*********************************************************************** 81420002
READJL   RDJFCB (,),MF=L                READJ FOR SYSUT1                81440020
OPENLS   OPEN  (,OUTPUT),MF=L           OPEN FOR SYSPRINT               81520020
CLOSELS  CLOSE (,),MF=L                 CLOSE FOR SYSPRINT              81600020
OPENL2   OPEN  (,INOUT),MF=L            OPEN FOR SYSUT1                 81680020
OPENL1   OPEN  (,INPUT),MF=L            OPEN FOR SYSIN                  81760020
CLOSEL   CLOSE (,,,),MF=L               CLOSE FOR SYSIN, SYSUT1         81840020
GETL     GETMAIN  EC,MF=L               LIST FORM FOR GETMAIN           81920020
WTOLS    WTO   'IEH924I    MESSAGE TEXT PROVIDED BY SYNADAF MACRO  COMP*82000020
               LETION CODE = 16',MF=L,ROUTCDE=(11),DESC=(7)             82080020
*********************************************************************** 82120002
DCBDATA  DCB   DSORG=PS,MACRF=(E),DDNAME=SYSUT1                         82160020
         DC    XL8'0'                   EXCP APPENDAGE LIST THISYL02912 82161002
         DC    CL12'WY0 0 WZWX0 '       MUST FOLLOW DCBDATA     YL02912 82162002
DCBIN    DCB   DSORG=PS,MACRF=GL,DDNAME=SYSIN,EODAD=NOCARD,            *82240020
               EXLST=DCBXLST,SYNAD=SYSINSYN,RECFM=FB,LRECL=80           82320020
*********************************************************************** 82360002
DCBPRINT DCB   DSORG=PS,MACRF=PM,DDNAME=SYSPRINT,EXLST=DCBEX2,         *82400020
               SYNAD=SYSSYNAD,RECFM=FBA,LRECL=121                       82480020
*********************************************************************** 82520002
DCBXLST  DS    0F                       SYSIN DCB                       82560020
         DC    X'85'                       EXIT                         82640020
         DC    AL3(DCBEXIT)                LIST                         82720020
DCBEX2   DS    0F                       SYSPRINT DCB                    82800020
         DC    X'85'                       EXIT                         82880020
         DC    AL3(PRINTCK)                LIST                         82960020
MESSTBLA DC    A(MESSTBL)               ADCON FOR MESSAGE CSECT         83040020
IONUMBER DC    CL8'IEH910I'             MESSAGE NUMBER FOR I/O ERROR    83120020
SNAPIT   SNAP  DCB=DUMP1,ID=1,PDATA=ALL,MF=L                    YL02912 83140002
DUMP1    DCB   DSORG=PS,RECFM=VBA,MACRF=W,BLKSIZE=882,          YL02912*83160002
               LRECL=125,DDNAME=SNAP1                           YL02912 83180002
COMPMESS DC    CL24'COMPLETION CODE=16     ' SPECIAL MESSAGE            83200020
XTMN     DC    X'1F1C1F1E1F1E1F1F1E1F1E1F'   DAYS IN MONTH              83280020
ZONEMASK DC    8XL2'2020'               E ZONE TO C ZONE CONVERT        83360020
PAGEEQ   DC    CL4'PAGE'                HEADING                         83440020
UTNAME   DC    CL8'IEHATLAS'               CONSTANTS                    83520020
VTOC     DC    CL5'VTOC='               CONTROL CARD                    83600020
TRACK    DC    CL6'TRACK='                 KEYWORDS                     83680020
TRANSTB  DC    C'0123456789ABCDEF, '    TRANSLATE TABLE FOR CONVERSION  83760020
*                                          OF HEX TO PRINTABLE CHAR     83840020
*********************************************************************** 83860002
*        CCW  STRINGS                                           YL02912 83880002
*********************************************************************** 83900002
         DS    0D                                                       83920020
CCW1     CCW   X'31',COUNT-SAVE1,X'40',5  SEARCH EQUAL ID               84000020
CCW2     CCW   X'08',CCWAR1-SAVE1,0,0    TIC BACK TO SEARCH             84080020
CCW3     CCW   X'0D',0,X'40',0          WRITE KEY DATA                  84160020
CCW4     CCW   X'31',COUNT-SAVE1,X'40',5  SEARCH EQUAL ID               84240020
CCW5     CCW   X'08',CCWAR4-SAVE1,0,0   TIC BACK TO SEARCH              84320020
CCW6     CCW   X'0E',0,X'30',1          READ KEY DATA                   84400020
*********************************************************************** 84440002
TABLE    DC    193X'10'                 TABLE                           84480020
         DC    X'0A0B0C0D0E0F'             TO                           84560020
         DC    41X'10'                        CONVERT                   84640020
         DC    X'00010203040506070809'           TO                     84720020
         DC    6X'10'                               HEX                 84800020
DEBNMEXT EQU   16                       *                               84880020
DEBDASD  EQU   32                       *                               84960020
DEBSTRCC EQU   6                        *                               85040020
DEBENDCC EQU   10                       *                               85120020
DEBSTRHH EQU   8                        *                               85200020
DEBENDHH EQU   12                       *                               85280020
DEBOFLGS EQU   8                        *                               85360020
NEXTEXT  EQU   16                       *                               85440020
FW8      DC    F'8'                     *                               85520020
FW40     DC    F'40'                    *                               85600020
HW20     DC    H'20'                    *                               85680020
HW10     DC    H'10'                    *                               85760020
TESTDC   DC    CL4'TEST'                TEST MODE               YL02912 85770002
SNAPDC   DC    CL4'SNAP'                SNAP MODE               YL02912 85780002
MAINT    DC    8CL25'IEHATLAS MAINTENANCE AREA'                 YL02912 85800002
*********************************************************************** 85810002
*        IEHWORK DSECT                                          YL02912 85820002
*********************************************************************** 85830002
IEHWORK  DSECT                                                          85840020
SAVE1    DS    1F                       PL/1                            85920020
SAVE10   EQU   SAVE1+0*255              *                               86000020
SAVE11   EQU   SAVE1+1*255              *                               86080020
SAVE12   EQU   SAVE1+2*255              *                               86160020
SAVE13   EQU   SAVE1+3*255              *                               86240020
SAVE14   EQU   SAVE1+4*255              *                               86320020
SAVE15   EQU   SAVE1+5*255              *                               86400020
SAVE110  EQU   SAVE1+1+0*255            *                               86480020
SAVE111  EQU   SAVE1+1+1*255            *                               86560020
SAVE112  EQU   SAVE1+1+2*255            *                               86640020
SAVE113  EQU   SAVE1+1+3*255            *                               86720020
SAVE114  EQU   SAVE1+1+4*255            *                               86800020
SAVE115  EQU   SAVE1+1+5*255            *                               86880020
SAVE1BK  DS    1F                       BACK CHAIN POINTER              86960020
SAVE1FD  DS    1F                       FORWARD CHAIN POINTER           87040020
         DS    15F                      REGISTER SAVE AREA              87120020
TRACKADR DS    1D                       TRACK ADDRESS OF BAD RECORD     87200020
TRACKAD2 EQU   TRACKADR+2               *                               87280020
TRACKAD4 EQU   TRACKADR+4               *                               87360020
TRACKAD6 EQU   TRACKADR+6               *                               87440020
COUNT    DS    1D                       COUNT OF BAD RECORD             87520020
COUNT2   EQU   COUNT+2                  *                               87600020
COUNT5   EQU   COUNT+5                  *                               87680020
COUNT6   EQU   COUNT+6                  *                               87760020
GETLS    DS    2D                       FOR GETMAIN                     87840020
GETLS4   EQU   GETLS+4                  *                               87920020
DCBSYS1  DS    25F                      SYSUT1 DCB                      88000020
DCBSYSIN DS    25F                      SYSIN DCB                       88080020
DCBSYP   DS    25F                      SYSPRINT DCB                    88160020
REENTAR  DS    9F                       WORK AREA                       88240020
GOTCORE  DS    1F                       SAVE GOTTEN CORE POINTER        88320020
*********************************************************************** 88340002
*        MESSAGE AREA                                           YL02912 88360002
*********************************************************************** 88380002
MESSAGEC DS    CL1                      MESSAGE CONTROL CHARACTER       88400020
MESSAGE  DS    CL120                    MESSAGE AREA                    88480020
MESSAGE1 EQU   MESSAGE+1                *                               88560020
MESSAGE2 EQU   MESSAGE+2                *                               88640020
MESSAGE3 EQU   MESSAGE+3                *                               88720020
MESSAGE4 EQU   MESSAGE+4                IEH9XXI CODE            YL02912 88760002
MESSAGE8 EQU   MESSAGE+8                *                               88800020
MESSAG61 EQU   MESSAGE+61               *                               88880020
MESSAG96 EQU   MESSAGE+96               *                               88960020
MESS112  EQU   MESSAGE+112              COMPLETION CODE         YL02912 89000002
HEADERC  DS    CL1                      HEADER CONTROL CHARACTER        89040020
HEADER   DS    CL30                     HEADER AREA                     89120020
HEADER1  EQU   HEADER+1                 *                               89200020
HEADER90 EQU   HEADER+90                *                               89280020
HEADER92 EQU   HEADER+92                *                               89360020
HEADER93 EQU   HEADER+93                *                               89440020
HEADER95 EQU   HEADER+95                *                               89520020
HEADER96 EQU   HEADER+96                *                               89600020
HEADR105 EQU   HEADER+105               *                               89680020
HEADR110 EQU   HEADER+110               *                               89760020
*********************************************************************** 89800002
NAMESLOT DS    CL90                     DSNAME AREA FROM SYSUT1         89840020
TARGET   DS    1D                       DATE HOLDER                     89920020
CONVERT  DS    1D                       WORK AREA                       90000020
CONVERT1 EQU   CONVERT+1                *                               90080020
CONVERT2 EQU   CONVERT+2                *                               90160020
CONVERT4 EQU   CONVERT+4                *                               90240020
DOUBLE   DS    1D                       *                               90320020
DOUBLE4  EQU   DOUBLE+4                 *                               90400020
DOUBLE5  EQU   DOUBLE+5                 *                               90480020
DOUBLE6  EQU   DOUBLE+6                 *                               90560020
DOUBLE8  EQU   DOUBLE+8                 *                               90640020
DOUBLE10 EQU   DOUBLE+10                *                               90720020
SECONDEX DS    0F                       *                               90800020
         DS    1D                       *                               90880020
SECONDX1 EQU   SECONDEX+1               *                               90960020
JFCBADR  DS    CL176                    JFCB FOR SYSUT1                 91040020
JFCBADR1 EQU   JFCBADR+1                *                               91120020
JFCBTSDM EQU   JFCBADR+52               *                               91200020
ECB      DS    1F                       ECB FOR UTILITY                 91280020
IOB      DS    8F                       IOB FOR UTILITY                 91360020
IOBECB   EQU   IOB+4                    ADDRESS OF ECB                  91440020
IOBSTART EQU   IOB+16                   CHANNEL PROGRAM START ADDRESS   91520020
IOBSENS1 EQU   IOB+3                    *                               91600020
IOBCSWST EQU   IOB+12                   *                               91680020
SEEK     DS    2F                       SEEK ADDRESS FOR REPLACEMENT    91760020
*                                          RECORD                       91840020
SEEK1    EQU   SEEK+1                   *                               91920020
WTOLIST  DS    19F                      LIST FORM FOR WTO               92000020
WTOLIS12 EQU   WTOLIST+12               *                               92080020
WTOLIS38 EQU   WTOLIST+38               *                               92160020
WTOLIS39 EQU   WTOLIST+39               *                               92240020
WTOLIS65 EQU   WTOLIST+65                                               92320020
WTOLIS66 EQU   WTOLIST+66                                               92400020
MSGWTO   DS    14F                      MESSAGE AREA FOR WTO            92480020
*********************************************************************** 92500002
*        CCW WORK AREA                                          YL02912 92520002
*********************************************************************** 92540002
         DS    0D                                                       92560020
CCWAR1   DS    1F                       SEARCH EQUAL ID                 92640020
CCWAR11  EQU   CCWAR1+1                                                 92720020
CCWAR1AD DS    1F                       *                               92800020
CCWAR2   DS    1F                       TIC TO SEARCH                   92880020
CCWAR21  EQU   CCWAR2+1                                                 92960020
CCWAR2AD DS    1F                       *                               93040020
CCWAR3   DS    1F                       WRITE                           93120020
CCWAR31  EQU   CCWAR3+1                                                 93200020
CCWAR3AD DS    1F                       *                               93280020
CCWAR3A2 EQU   CCWAR3AD+2                                               93360020
CCWAR4   DS    1F                       SEARCH EQUAL ID                 93440020
CCWAR41  EQU   CCWAR4+1                                                 93520020
CCWAR4AD DS    1F                       *                               93600020
CCWAR5   DS    1F                       TIC TO SEARCH                   93680020
CCWAR51  EQU   CCWAR5+1                                                 93760020
CCWAR5AD DS    1F                       *                               93840020
CCWAR6   DS    1F                       READ                            93920020
CCWAR61  EQU   CCWAR6+1                                                 94000020
CCWAR6AD DS    1F                       *                               94080020
*********************************************************************** 94120002
CCWAR6A2 EQU   CCWAR6AD+2              LENGTH OF READ         OX02345   94130003
RECSIZE  DS    1F                       SIZE OF RECORD BEING REPLACED-  94160020
*                                          USED BY GET & FREEMAIN       94240020
KEYSIZE  DS    1H                       KEY SIZE AREA                   94320020
KEYDATA  DS    1H                       KEY + DATA SIZE AREA            94400020
CCWCOUNT DS    1H                       TOTAL SIZE-COUNT+KEY+DATA       94480020
COMPCODE DS    CL1                      COMPLETION CODE AREA            94560020
MESSCODE DS    CL1                      MESSAGE CODE                    94640020
TRKOVFL  DS    CL1                      TRACK OVERFLOW SWITCH           94720020
PAGENO   DS    1F                       PAGE NUMBER HOLD AREA           94800020
LINECT   DS    1H                       LINE COUNT HOLD AREA            94880020
PARMLIST DS    2F                       LIST FOR PARAMETERS FOR SVC     94960020
PARMLIS4 EQU   PARMLIST+4                                               95040020
TESTDS   DS    1F                       CONTROL CARD 'TEST'     YL02912 95060002
PNTSNAP  DS    1F                       POINTER TO SNAP LIST    YL02912 95080002
SNAPDS   DS    1F                       CONTROL CARD 'SNAP'     YL02912 95100002
SYSINDD  DS    1D                       USER-SUPPLIED SYSIN DDNAME      95120020
PRINTDD  DS    1D                       USER-SUPPLIED SYSPRINT DDNAME   95200020
SYSUT1DD DS    1D                       USER-SUPPLIED SYSUT1 DDNAME     95280020
SAVEPAR  DS    1F                       PAGENO PARAMETER ADDRESS        95360020
DEVFEAT  DS    2F                       DEVICE CHARACTERISTICS          95440020
DEVFEAT1 EQU   DEVFEAT+1                                                95520020
TEMP     DS    1F                       TEMPORARY STORAGE               95600020
TEMP1    EQU   TEMP+1                                                   95680020
RETPARM  DS    1F                       RETURN PARAMETER FORM SVC       95760020
ID       DS    5C                       SEARCH ID FIELD IF TRACK OVER-  95840020
ID4      EQU   ID+4                                                     95920020
*                                          FLOW IS USED                 96000020
SPLIT    DS    1C                       SPLIT CYLINDER SWITCH           96080020
         DCBD  DSORG=(PS)                                               96160020
         EJECT                                                 @Y30LSFY 96210003
UCB      DSECT                                                 @Y30LSFY 96220003
         IEFUCBOB                                              @Y30LSFY 96230003
         END   IEHATLAS                                                 96240020
./  ADD  SSI=53030128,NAME=IEHMESS
         TITLE 'IEHMESS - MESSAGE CSECT FOR IEHATLAS'                   00080019
         COPY  LCGASMSW                                                 00130000
IEHMESS  CSECT                                                          00160019
*          RELEASE 22 DELETIONS/CHANGES                               * 00240019
*                                                                     * 00320019
*          RELEASE 21 DELETIONS/CHANGES                               * 00400019
*                                                                     * 00480019
*          RELEASE 20 DELETIONS/CHANGES                               * 00560019
*                                                                     * 00640019
* 775000-785000                                                  M3223  00720019
*STATUS CHANGE LEVEL 000                                              * 00800019
*                                                                     * 00880019
*FUNCTION/OPERATION                                                   * 01000019
*   THIS MODULE IS THE MESSAGE CSECT FOR THE UTILITY PROGRAM IEHATLAS,* 01500019
*THE SYSTEM UTILITY THAT ATTEMPTS RECOVERY FROM HARD READ/WRITE ERRORS* 02000019
*                                                                     * 02500019
*ENTRY POINTS                                                         * 03000019
*  MESSTBL                                                            * 03500019
*                                                                     * 04000019
*INPUT                                                                * 04500019
*  NOT APPLICABLE                                                     * 05000019
*                                                                     * 05500019
*OUTPUT                                                               * 06000019
*  NOT APPLICABLE                                                     * 06500019
*                                                                     * 07000019
*EXTERNAL ROUTINES                                                    * 07500019
*  NOT APPLICABLE                                                     * 08000019
*                                                                     * 08500019
*EXITS                                                                * 09000019
*  NOT APPLICABLE                                                     * 09500019
*                                                                     * 10000019
*TABLES/WORKAREAS                                                     * 10500019
*  NOT APPLICABLE                                                     * 11000019
*                                                                     * 11500019
*ATTRIBUTES                                                           * 12000019
*  REENTRANT,REFRESHABLE                                              * 12500019
         EJECT                                                          13000019
         PRINT NOGEN                                                    13050000
         ENTRY MESSTBL                                                  14000019
MESSTBL  DS    0F                                                       14500019
         DC    CL32'IEH9  I                         '           YL02912 15000002
         DC    CL32'                                '           YL02912 16000002
         DC    CL32'                                '           YL02912 17000002
         DC    CL24'COMPLETION CODE=  '                         YL02912 18000002
         DC    CL32'0000SUCCESSFUL COMPLETION AN ALT'           YL02912 19000002
         DC    CL32'ERNATE TRACK HAS BEEN ASSIGNED  '           YL02912 20000002
         DC    CL32'0100SUCCESSFUL COMPLETION NO ALT'           YL02912 21000002
         DC    CL32'ERNATE TRACK HAS BEEN ASSIGNED  '           YL02912 22000002
         DC    CL32'0216 I/O ERROR IN ALTERNATE TRAC'           YL02912 23000002
         DC    CL32'K ASSIGNEMNT                    '           YL02912 24000002
         DC    CL32'0316REQUIRED DD CARD MISSING    '           YL02912 25000002
         DC    CL32'                                '           YL02912 26000002
         DC    CL32'0416INVALID DCB PARAMETERS FOR S'           YL02912 27000002
         DC    CL32'YSIN                            '           YL02912 28000002
         DC    CL32'0516INVALID OR MISSING CONTROL C'           YL02912 29000002
         DC    CL32'ARD KEYWORD                     '           YL02912 30000002
         DC    CL32'0616INVALID CHARACTER IN USER-IN'           YL02912 31000002
         DC    CL32'PUT RECORD                      '           YL02912 32000002
         DC    CL32'0716DEVICE DOES NOT HAVE SOFTWAR'           YL02912 33000002
         DC    CL32'E ASSIGNABLE ALTERNATES         '           YL02912 34000002
         DC    CL32'0816ALL ALTERNATES FOR THIS DEVI'           YL02912 35000002
         DC    CL32'CE HAVE BEEN ASSIGNED           '           YL02912 36000002
         DC    CL32'0916REQUESTED STORAGE IS NOT AVA'           YL02912 37000002
         DC    CL32'ILABLE                          '           YL02912 38000002
         DC    CL32'1016MESSAGE TEXT PROVIDED BY SYN'           YL02912 39000002
         DC    CL32'ADAF MACRO - I/O ERROR          '           YL02912 40000002
         DC    CL32'1116TRACK ADDRESS PROVIDED DOES '           YL02912 41000002
         DC    CL32'NOT BELONG TO DATA SET          '           YL02912 42000002
         DC    CL32'1216INCORRECT NUMBER OF CHARACTE'           YL02912 43000002
         DC    CL32'RS IN USER-INPUT RECORD         '           YL02912 44000002
         DC    CL32'1316CONDITION OTHER THAN DATA CH'           YL02912 45000002
         DC    CL32'ECK OR MISSING ADDRESS MARKER   '           YL02912 46000002
         DC    CL32'1416FORMAT 4 DSCB CAN NOT BE REA'           YL02912 47000002
         DC    CL32'D                               '           YL02912 48000002
         DC    CL32'1516RECORD IN ERROR IS FORMAT 4 '           YL02912 49000002
         DC    CL32'DSCB                            '           YL02912 50000002
         DC    CL32'1616ERROR FOUND IN COUNT FIELD O'           YL02912 51000002
         DC    CL32'F LAST RECORD ON TRACK          '           YL02912 52000002
         DC    CL32'1716HA OR R0 RECORDS            '           YL02912 53000002
         DC    CL32'                                '           YL02912 54000002
         DC    CL32'1816ERROR/ERRORS ENCOUNTERED ALT'           YL02912 55000002
         DC    CL32'ERNATE TRACK ASSIGNED           '           YL02912 56000002
         DC    CL32'1916ALTERNATE ASSIGNED I/O ERR R'           YL02912 57000002
         DC    CL32'E-EXECUTING USER CHANNEL PROGRAM'           YL02912 58000002
         DC    CL32'2016THE SYSTEM DOES NOT SUPPORT '           YL02912 59000002
         DC    CL32'TRACK OVERFLOW                  '           YL02912 60000002
         DC    CL32'2100NO ERROR IN SPECIFIED VTOC R'           YL02912 61000002
         DC    CL32'ECORD                           '           YL02912 62000002
         DC    CL32'2216ERROR(S) ENCOUNTERED CAN''T B'          YL02912 63000002
         DC    CL32'E HANDLED NO ALTERNATE ASSIGNED '           YL02912 64000002
         DC    CL32'2316NO ERRORS FOUND ON TRACK NO '           YL02912 65000002
         DC    CL32'ALTERNATE ASSIGNED              '           YL02912 66000002
         DC    CL32'2416VIRTUAL DEVICES ARE NOT SUPP'           YL02912 67000002
         DC    CL32'ORTED                           '           YL02912 68000002
         END                                                            87500019
./  ADD  SSI=53040025,NAME=IGC0008F
         TITLE 'IGC0008F - FIRST LOAD MODULE FOR SVC 86'         S20201 00100020
         COPY  LCGASMSW                                                 00150003
IGC0008F CSECT                                                          00200020
*                                                               YM7385  00300002
*A                                                             PTMFIX   00310030
*                                                               YM3004  00350002
*                                                                       00400020
*          RELEASE 22 DELETIONS/CHANGES                                 00500020
*          RELEASE 21 DELETIONS/CHANGES                                 00600020
*          RELEASE 20 DELETIONS/CHANGES                                 00700020
*0791001000-002000,260000,282000-290000                          S20201 00750020
*                                                                       00800020
*STATUS CHANGE LEVEL 002                                                00900020
*                                                                       01000020
*TITLE 'IGC0008F' - FIRST LOAD MODULE OF SVC 86                       * 01100020
*                                                                     * 01200020
*FUNCTION/OPERATION                                                   * 01300020
*   IGC0008F ESTABLISHES ITS OWN ADDRESSABILITY AND THAT OF ITS       * 01400020
*688 -BYTE WORK AREA WHICH IT GETS.  BEING THE FIRST LOAD MODULE OF   * 01500020
*SVC 86, THIS MODULE HAS FOUR MAJOR FUNCTIONS -                         01600020
*                                                                     * 01700020
*        1.  TEST FOR USER'S CHANNEL PROGRAM BEING RE-EXECUTABLE      * 01800020
*        2.  CHECK IOB FOR VALID ERROR INDICATIONS - DATA CHECK       * 01900020
*            OR MISSING ADDRESS MARKER                                * 02000020
*        3.  PICK UP DEVICE TYPE FROM THE UCB AND ASSOCIATE WITH      * 02100020
*            IT 10 PER CENT OF THE ASSIGNABLE ALTERNATES AND THE      * 02200020
*            MAXIMUM NUMBER OF COUNT FIELDS PER TRACK                 * 02300020
*        4.  BUILD A DEB,DCB,IOB AND ECB                              * 02400020
*                                                                     * 02500020
*ENTRY/POINTS                                                         * 02600020
*   IGC0008F GETS THE DEVICE TYPE, TYPE OF ERROR AND INFORMATION AS   * 02700020
*TO THE NUMBER OF ALTERNATE TRACKS AVAILABLE AND THE MAXIMUM NUMBER   * 02800020
*OF COUNT FIELDS PER TRACK                                            * 02900020
*                                                                     * 03000020
*INPUT                                                                * 03100020
*   FROM THE USER INPUT IS THE ADDRESS (VIA REGISTER 1) OF A TWO-     * 03200020
*WORD PARAMETER LIST INCLUDING A POINTER TO THE IOB AND A POINTER     * 03300020
*TO THE COUNT.  WHEN IGC0008F RECEIVES CONTROL REGISTER 5 POINTS TO   * 03400020
*THE SVRB.                                                            * 03500020
*                                                                     * 03600020
*OUTPUT                                                               * 03700020
*   CONSISTS OF THE WORK AREA AND THE FOLLOWING RETURN CODES          * 03800020
*                                                                     * 03900020
*         4 - WRONG DEVICE TYPES                                      * 04000020
*         8 - NO MORE ALTERNATES                                      * 04100020
*        12 - CORE NOT AVAILABLE                                      * 04200020
*        20 - INVALID I/O SENSE INDICATION                            * 04300020
*        56 - SYSTEM DOES NOT SUPPORT TRACK OVERFLOW                  * 04400020
*        60 - TRACK SPECIFIED BY USER IS OUT OF DEB EXTENTS           * 04500020
*        64 - VIRTUAL DEVICES NOT SUPPORTED                     YL02912 04550002
*                                                                     * 04600020
*EXTERNAL ROUTINES                                                    * 04700020
*   THE TTR CONVERSION ROUTINE IS USED TO GET THE ABSOLUTE ADDRESS    * 04800020
*OF THE VTOC.  THE ADDRESS OF THE CONVERSION ROUTINE IS PICKED UP     * 04900020
*FROM THE CVT.                                                        * 05000020
*                                                                     * 05100020
*EXITS                                                                * 05200020
*   ERROR - XCTL TO IGG086AE                                          * 05300020
*   NORMAL - XCTL TO IGG0860A                                         * 05400020
*                                                                     * 05500020
*TABLES/WORK AREAS                                                    * 05600020
*   A 688-BYTE WORK AREA IS ACQUIRED BY THIS MODULE.  INFORMATION     * 05700020
*PLACED IN THIS AREA INCLUDES-     THE MAXIMUM NUMBER OF              * 05800020
*COUNT FIELDS PER TRACK, A POINTER TO THE USER'S PARAMETER LIST, AND  * 05900020
*THE ECB, IOB, AND DCB CONSTRUCTED BY THIS MODULE.                    * 06000020
*   TABDEV TABLE - IS USED TO ASSOCIATE 10% OF ALTERNATES       XL03291 06050003
*AVAILABLE, THE MAXIMUM NUMBER OF COUNT FIELDS AND THE          XL03291 06060003
*ADDRESS TO GO TO BASED ON THE DEVICE CODE.                     XL03291 06070003
*                                                                     * 06100020
*ATTRIBUTES                                                           * 06200020
*                                                                     * 06300020
*   REENTRANT, REFRESHABLE                                            * 06400020
*                                                                     * 06500020
*                                                                       06600020
*********************************************************************** 06700020
*                                                                     * 06800020
*                               EQUATES                               * 06900020
*                                                                     * 07000020
*********************************************************************** 07100020
BIT0     EQU   X'80'                                                    07150003
BIT1     EQU   X'40'                                                    07200020
BIT2     EQU   X'20'                                                    07300020
BIT4     EQU   X'08'                                                    07400020
BIT5     EQU   X'04'                                                    07500020
BIT6     EQU   X'02'                                                    07600020
BIT7     EQU   X'01'                                                    07700020
*********************************************************************** 07800020
*          COMPLETION CODES                                           * 07900020
*********************************************************************** 08000020
CC4      EQU   4                        DEVICE TYPE NOT SUPPORTED       08100020
CC12     EQU   12                       CORE NOT AVAILABLE              08200020
CC20     EQU   20                       NOT VALID ERROR CONDITION       08300020
CC56     EQU   56                       TRACK OVERFLOW NOT LEGAL        08400020
CC60     EQU   60                       TRACK ADDRESS OUT OF EXTENTS    08500020
CC64     EQU   64                       NO VIRTUAL DEVICE SUPP  YL02912 08550002
*********************************************************************** 08600020
*          DISPLACEMENT CONSTANTS                                     * 08700020
*********************************************************************** 08800020
D0       EQU   0                                                        08900020
D1       EQU   1                                                        09000020
D2       EQU   2                                                        09100020
D3       EQU   3                                                        09200020
D4       EQU   4                                                        09300020
D6       EQU   6                                                        09400020
D8       EQU   8                                                        09450003
D12      EQU   12                                                       09460003
D16      EQU   16                       DISPLACEMENT OF 16      YL02912 09461002
D28      EQU   28                       DISPLACEMENT OF 28      YL02912 09462002
D17      EQU   17                       DISPLACEMENT OF 17      YL02912 09472002
D32      EQU   32                       *                               09500020
D33      EQU   33                                                       09600020
D34      EQU   34                                                       09700020
D40      EQU   40                                                       09750003
D56      EQU   56                                                       09800020
D96      EQU   96                                                       09900020
D100     EQU   100                                                      10000020
*********************************************************************** 10100020
*          LENGTH CONSTANTS                                           * 10200020
*********************************************************************** 10300020
L1       EQU   1                        LENGTH 1                YL02912 10350002
L2       EQU   2                                                        10400020
L3       EQU   3                                                        10500020
L4       EQU   4                                                        10600020
L5       EQU   5                                                        10700020
L6       EQU   6                                                        10800020
L7       EQU   7                                                        10900020
L8       EQU   8                                                        10950003
L16      EQU   16                                                       11000020
L177     EQU   177                                                      11100020
L255     EQU   255                                                      11200020
*********************************************************************** 11300020
*********************************************************************** 11400020
*                                                                       11500020
*********************************************************************** 11600020
BITS4    EQU   4                                                        11700020
BITS8    EQU   8                                                        11800020
BITS16   EQU   16                                                       11900020
DA       EQU   X'04'                                                    12000020
DEBID    EQU   X'0F'                    DEB ID FLAG                     12100020
DEVFM    EQU   X'C0'                                                    12200020
DOG8     EQU   X'D8'                                                    12300020
D2314    EQU   X'08'                    DEVICE TYPES                    12400020
D2321    EQU   X'05'                        *                           12500020
D2311    EQU   X'01'                        *                           12600020
D2302    EQU   X'04'                        *                           12700020
D23051   EQU   X'06'                        *                    S20201 12720020
D23052   EQU   X'07'                        *                    S20201 12740020
D3330    EQU   X'09'                        *                    S20201 12760020
         AIF   ('&LIB' EQ 'LIB1').X225600                       XL03130 12762003
D3340    EQU   X'0A'                   DEVICE TYPE 3340         XL03130 12770003
D3330C   EQU   X'0D'                   DEVICE TYPE 3330C        XL03145 12780003
.X225600 ANOP                                                   XL03130 12792003
FFSW     EQU   X'FF'                                                    12800020
FLAG1    EQU   X'42'                                                    12900020
NOREEX   EQU   X'80'                                                    13000020
ONEXT    EQU   X'01'                    ONE EXTENT                      13100020
OVFLW    EQU   X'20'                    RECORD OVERFLOW                 13200020
TWO55    EQU   255                                                      13300020
X0       EQU   0                                                        13400020
DBLZERO  EQU   X'00'                                                    13500020
*                                                                       13600020
*                                                                       13700020
         EJECT                                                          13800020
* REGISTER ASSIGNMENTS                                                  13900020
PARMA    EQU   0                        PARAMETER REGISTER              14000020
PARMB    EQU   1                        PARAMETER REGISTER              14100020
WORKE    EQU   2                        EVEN WORK REGISTER              14200020
WORKO    EQU   3                        ODD WORK REGISTER               14300020
FOUR     EQU   4                        RETURN CODE REGISTER            14400020
FIVE     EQU   5                        WORK REGISTER                   14500020
SIX      EQU   6                        *                               14600020
SEVEN    EQU   7                        *                               14700020
EIGHT    EQU   8                        *                               14800020
NINE     EQU   9                        *                               14900020
TEN      EQU   10                       *                               15000020
AREAREG  EQU   11                       MAIN WORK AREA REGISTER         15100020
BASEREG  EQU   12                       BASE REGISTER                   15200020
SAVEREG  EQU   13                       WORK REGISTER                   15300020
RETREG   EQU   14                       WORK REGISTER                   15400020
ADDREG   EQU   15                       COMPLETION CODE REGISTER        15500020
*********************************************************************** 15520002
*        START OF SVC                                           YL02912 15540002
*********************************************************************** 15560002
         BALR  BASEREG,X0               ESTABLISH OWN                   15600020
         USING BEGIN,BASEREG            ADDRESSABILITY                  15700020
BEGIN    LR    FOUR,PARMB                                               15800020
         L     PARMB,D28(FIVE)          POINT TO PREVIOUS RB    YL02912 15820002
         IC    WORKE,D17(PARMB)         GET KEY FROM PSW        YL02912 15840002
         LR    SIX,RETREG               SAVE RETURN             YL02912 15842002
*********************************************************************** 16310002
*        KEY 5                                                  YL02912 16320002
*********************************************************************** 16330002
         MODESET EXTKEY=DATAMGT         KEY 5                   YL02912 16350002
*********************************************************************** 16360002
*        GET WORK AREA FOR DSECT                                YL02912 16370002
*********************************************************************** 16380002
         GETMAIN R,LV=688,SP=229        WORK AREA               YM3004  16400002
         LTR   ADDREG,ADDREG            CHECK FOR GOTTEN CORE           16500020
         BZ    GOTCORE                  YES, CORE GOTTEN FOR WORK AREA  16600020
         LA    ADDREG,CC12              SET RETURN CODE TO 12 TO INDI-  16700020
*                                          CATE CORE NOT AVAILABLE      16800020
         LR    RETREG,SIX               RESTORE RETURN REG      YL02912 16850002
         BR    RETREG                   RETURN                  YL02912 16900002
GOTCORE  EQU   *                                                YM3004  16902002
*********************************************************************** 16910002
*        SUPERVISOR KEY                                         YM3004  16912002
*********************************************************************** 16914002
         MODESET EXTKEY=SUPR            KEY 0                   YM3004  16916002
         ST    PARMB,D100(FIVE)         STORE ADDRESS OF AREA           16918002
*********************************************************************** 16918402
*        KEY 5                                                  YM3004  16918802
*********************************************************************** 16919202
         MODESET EXTKEY=DATAMGT         KEY 5                   YM3004  16919602
*********************************************************************** 16920002
*        ZERO OUT WORK AREA                                     YL02912 16940002
*********************************************************************** 16960002
         LR    AREAREG,PARMB            ESTAB. ADDRESSABILITY TO YM3004 17000002
*                                          WORK AREA                    17100020
         USING WORKDSCT,AREAREG                                         17200020
         MVI   SVRBEX,DBLZERO           CLEAR WORK AREA TO ZEROS        17300020
         MVC   SVRBEX+D1+D0*TWO55(L255),SVRBEX+D0*TWO55                 17400020
         MVC   SVRBEX+D1+D1*TWO55(L255),SVRBEX+D1*TWO55                 17500020
         MVC   SVRBEX+D1+D2*TWO55(L177),SVRBEX+D2*TWO55                 17600020
*********************************************************************** 17620002
*        SET UP POINTERS                                        YL02912 17640002
*********************************************************************** 17660002
         LA    FIVE,D96(X0,FIVE)                                        17700020
         ST    FIVE,SVRBEX              SAVE EXTENDED SVRB POINTER      17800020
         LA    FIVE,XCTLAREA            GET POINTER TO XCTL LIST        17900020
         ST    FIVE,XCTLPTR             STORE POINTER                   18000020
         MVC   XCTLID(L2),ATLAS02       MOVE NEXT LOAD NAME IN          18100020
         MVC   TTR(L3),TTR2             MOVE NEXT LOAD TTR IN           18200020
         ST    SIX,REGHOLD              SAVE RETURN             YL02912 18250002
         ST    FOUR,PARMUSER            SAVE USER PARM POINTER  YL02912 18300002
         STC   WORKE,HOLDKEY            SAVE USER KEY           YL02912 18400002
*********************************************************************** 18401002
*        USER KEY                                               YL02912 18402002
*********************************************************************** 18403002
         MODESET KEYADDR=(2)            GET INTO USER'S KEY     YL02912 18404002
         LM    FIVE,SIX,D0(FOUR)        IOB/USER COUNT POINTERS YL02912 18405002
         LM    WORKE,WORKO,D8(FOUR)     TEST/SNAP               YL02912 18405502
         L     EIGHT,USDCBPT(FIVE)      DCB POINTER FROM IOB    YL02912 18406002
         LM    NINE,TEN,D40(EIGHT)      TIOT OFFSET DEB POINTER YL02912 18407002
         IC    NINE,DCBRECFM(EIGHT)     TRACK OVERFLO CODE      YL02912 18408002
         LM    SEVEN,EIGHT,D0(SIX)      USER COUNT FIELD        YL02912 18409002
         LH    FOUR,USSENS0(FIVE)       USER IOB SENSE BYTES    YL02912 18410002
         SLL   FOUR,D16                 SHIFT SENSE BYTES       YL02912 18411002
         IC    FOUR,USSEEK(FIVE)        GET M OF IOB ADDRESS    YL02912 18412002
*********************************************************************** 18413002
*        KEY 5                                                  YL02912 18414002
*********************************************************************** 18415002
         MODESET EXTKEY=DATAMGT         KEY 5                   YL02912 18416002
         STM   WORKE,TEN,PNTEST         TEST/SNAP               YL02912 18417002
*                                       SENSE BYTE/M-IOB/IOB/   YL02912 18417502
*                                       COUNT/COUNTS/TIOTOFLO/D YL02912 18418002
         LA    SEVEN,PARMCNT            NEW COUNT FIELD POINTER YL02912 18419002
         IC    SIX,PNTCNT               GET PREVIOUS CODE       YL02912 18420002
         ST    SEVEN,PNTCNT             SET NEW POINTER         YL02912 18421002
         STC   SIX,PNTCNT               RESET PREVIOUS CODE     YL02912 18422002
         LA    SIX,PNTIOB               POINT TO NEW LIST       YL02912 18423002
         ST    SIX,USERPARM             SET NEW LIST POINTER    YL02912 18424002
         LA    TEN,D0(TEN)              CLEAR HO BYTE           YL02912 18425002
         MVC   HOLDKEY+D1(L3),29(TEN)   SAVE TO APVT ADDR       YL02912 18426002
*********************************************************************** 18427002
*        CHECK USERS SENSE BYTES                                YL02912 18428002
*********************************************************************** 18429002
REEX     LTR   FIVE,FIVE                CHECK FOR CHANNEL PROGRAM       18500020
         LA    FIVE,PNTSNS-D2           POINT TO NEW SENSE BYTE YL02912 18550002
*                                          BEING RE-EXECUTABLE          18600020
         BP    LEAVESW                  YES, CHANNEL PROGRAM IS RE-EXE- 18700020
*                                          CUTABLE                      18800020
         OI    SWITCH,NOREEX            SET SWITCH FOR CHANNEL PROGRAM  18900020
*                                          NOT RE-EXECUTABLE            19000020
LEAVESW  TM    USSENS0(FIVE),BIT4       CHECK USER'S IOB SENSE BYTE 0   19100020
         BO    DATACK                   YES, DATA CHECK                 19200020
         TM    USSENS1(FIVE),BIT6       CHECK FOR MISSING ADDRESS       19300020
*                                          MARKER                       19400020
         BZ    SETERCD                  NO, GO SET ERROR CODE           19500020
         TM    USSENS1(FIVE),BIT4       CHECK FOR NOT REGULAR MISSING   19600020
*                                          ADDRESS MARKER               19700020
         BO    SETERCD                  YES, NOT NORMAL MISSING ADDRESS 19800020
*                                          MARKER                       19900020
         TM    USSENS0(FIVE),BIT7       CHECK FOR BALLAST CELL FOUND    20000020
         BZ    DATACK                   SITUATION UNDER CONTROL         20100020
*********************************************************************** 20120002
*        FREEWORK AREA AND GET OUT                              YL02912 20140002
*********************************************************************** 20160002
SETERCD  LA    FOUR,CC20                SET COMPLETION CODE TO REFLECT  20200020
*                                          NOT A VALID IOB SENSE INDI-  20300020
*                                          CATION                       20400020
FREEWORK MVC   XCTLID(L2),ATLAS06       MOVE ERROR LOAD NAME IN         20500020
         MVC   TTR(L3),TTR6             MOVE ERROR LOAD TTR IN          20600020
*********************************************************************** 20650002
         SPACE                                                          20700020
*SET UP COMMON XCTL FIELDS                                              20800020
*********************************************************************** 20850002
         SPACE                                                          20900020
XCTL     MVC   XCTLAREA(L6),ATLASNM     MOVE IN COMMON NAME BYTES       21000020
         MVC   TTRATTB(L7),TTRCON       MOVE IN ATTRIBUTES OF ALL LOADS 21100020
         L     PARMB,PNTSNAP            GET SNAP LIST POINTER   YL02912 21110002
         LTR   PARMB,PARMB              SNAP WANTED             YL02912 21120002
         BZ    XCTL1                                            YL02912 21130002
         SNAP  ID=2,MF=(E,(1))          SNAP PROBLEM PROGRAM    YL02912 21140002
XCTL1    EQU   *                                                YL02912 21150002
         XCTL  ,MF=(E,(1)),SF=(E,XCTLPTR)                               21200020
*                                                                       21300020
*********************************************************************** 21400002
*        CHECK EXTENTS                                          YL02912 21450002
*********************************************************************** 21500002
DATACK   LA    NINE,PARMCNT             POINT TO CCHH           YL02912 21550002
         XR    SIX,SIX                                                  21600020
         L     EIGHT,PNTDEB             POINT TO DEB            YL02912 21700002
         IC    SIX,DEBNOEXT(EIGHT)      LOAD NUMBER OF EXTENTS          21900020
         TM    DEBOFLGS(EIGHT),BIT5     CHECK FOR SPLIT CYLINDER        22000020
         BNO   NOTSPLIT                 BRANCH IF NOT SPLIT             22100020
         MVI   SPLIT,FFSW               SET SPLIT SWITCH                22200020
NOTSPLIT LA    EIGHT,DEBDASD(EIGHT)     BUMP POINTER TO FIRST EXTENT    22300020
*                                          DESCRIPTION                  22400020
STARTEST CLC   D0(L4,NINE),DEBSTRCC(EIGHT) IS GIVEN BAD TRCK LOWR THAN  22500020
*                                          START OF EXTENT              22600020
         BL    DECREMNT                 YES,TEST NEXT EXTENT            22700020
         CLC   D0(L4,NINE),DEBENDCC(EIGHT) IS GIVN BAD TRK HIGHER THAN  22800020
*                                          END OF EXTENT                22900020
         BH    DECREMNT                 YES,TEST NEXT EXTENT            23000020
         CLI   SPLIT,FFSW               SPLIT SWITCH ON                 23100020
         BNE   EXTOK                    BRANCH,TRACK IS WITHIN EXTENT   23200020
         CLC   D2(L2,NINE),DEBSTRHH(EIGHT) IS GIVEN BAD TRACK HH LOWER  23300020
*                                          THAN EXTENT                  23400020
         BL    DECREMNT                 YES,CONTINUE TESTING            23500020
         CLC   D2(L2,NINE),DEBENDHH(EIGHT) IS GIVEN BAD TRCK HIGHR THEN 23600020
*                                          HH EXTENT                    23700020
         BH    DECREMNT                 YES,TEST NEXT EXTENT            23800020
         B     EXTOK                    BRANCH,TRACK IS WITHIN EXTENT   23900020
DECREMNT BCT   SIX,INCREMNT             DECREMENT NUMBER OF EXTENTS     24000020
         LA    FOUR,CC60                SET COMPLETION CODE TO REFLECT  24100020
*                                          TRACK ADDRESS IS OUT OF      24200020
*                                          EXTENTS                      24300020
         B     FREEWORK                 BRANCH TO ERROR LOAD            24400020
INCREMNT LA    EIGHT,NEXTEXT(EIGHT)     BUMP POINTER TO NEXT DEB EXTENT 24500020
         B     STARTEST                 CONTINUE TESTING                24600020
EXTOK    XR    SIX,SIX                                                  24700020
         IC    SIX,PNTMIOB              PICK UP M OF IOB        YL02912 24800002
         L     EIGHT,PNTDEB             GET DEB POINTER         YL02912 24900002
DIRECT   SLL   SIX,BITS4                MULTIPLY M OF SEEK ADDRESS BY   25100020
*                                          16                           25200020
         LA    NINE,D32(X0,EIGHT)       GET ADDRESS OF END OF BASIC     25300020
*                                          DEB                          25400020
         AR    NINE,SIX                 INDEX INTO APPROPRIATE DEVICE   25500020
*                                          DEPENDENT EXTENT IN DEB      25600020
         L     SIX,D0(X0,NINE)          PICK UP ADDRESS OF UCB FOR THIS 25700020
*                                          EXTENT                       25800020
         USING UCB,SIX                                         @Y30LSFY 25802003
         TM    UCBTBYT2,UCB2OPT4        VIRTUAL UCB ?          @Y30LSFY 25804003
         BO    RC64                     YES-NO SUPPORT         @Y30LSFY 25804803
         TM    D0(SIX),BIT0             VIRTUAL UCB ?           YL02912 25805002
         BNO   NOTVIRT                  NO - CONTINUE           YL02912 25810002
RC64     EQU   *                                               @Y30LSFY 25812003
         LA    FOUR,CC64                NO VIRTUAL UCB SUPPORT  YL02912 25815002
         B     FREEWORK                 TO ERROR LOAD           YL02912 25820002
         USING UCB,SIX                                         YM3004   25820402
*********************************************************************** 25821002
*        GET DEVICE INFO FROM DEVICE TABLE                      YL02912 25822002
*********************************************************************** 25823002
NOTVIRT  EQU   *                        NOT VIRTUAL UCB         YL02912 25825002
         MVC   DEVTAB(L4),UCBTBYT1       SAVE DEVICE TYPE       YM3004  25850002
         DROP  SIX                                              YM3004  25860002
         LA    WORKE,TABDEV            GET DEVICE TABLE ADDRESS XL03291 25880003
         USING TABDEV,WORKE  ADDRESSABILITY TO THE TABLE        XL03291 25882003
DEVLOOK  CLC   TABDEV1,DEVTAB+D3       CHECK DEVICE TYPE        XL03291 25890003
         BE    GOTDEV                  DEVICE TYPE FOUND        XL03291 25892003
         LA    WORKE,D8(WORKE)         INCREMENT THRU TABLE     XL03291 25894003
         CLI   TABDEV2,TWO55           TEST FOR DELIMITOR       XL03291 25896003
         BNE   DEVLOOK                 CONTINUE LOOKING         XL03291 25898003
GOTDEV   MVC   NUMALT(L4),TABDEV1      SET NUMALT AND MAXCOUNT  XL03291 25898403
         MVI   NUMALT,X0               CLEAN UP HIGH ORDER      XL03291 25898803
         B     TABDEV4                 GO TO BRANCH INSTRUCTION XL03291 25899203
         DROP  WORKE                   RELEASE REGISTER         XL03291 25899603
*                                                               XL03291 25899703
A3330    TM    USSENS1(FIVE),BIT6      MISSING ADDRESS MARKER?  XL03291 25899803
         BO    SETERCD                 YES, INVALID IOB SENSE   XL03291 25899903
         B     DISLIKE                 CONTINUE                 XL03291 25902203
NONSUP   LA    FOUR,CC4                NONSUPPORTED DEVICE      XL03291 25904203
         B     FREEWORK                RETURN                   XL03291 25906203
         AIF   ('&LIB' EQ 'LIB1').X225601                       XL03130 25906303
A3340    EQU   *                                                XL03130 25906403
         TM    USSENS1(FIVE),BIT6      MISSING ADDRESS MARKER   XL03130 25906503
         BO    SETERCD                 YES,INVALID SENSE BYTE   XL03130 25906603
         LH    WORKE,PNTIOT             OFFSET TO DDENTRY TIOT  YL02912 25906702
         USING CVT,WORKO                                        XL03130 25906803
         L     WORKO,CVTPTR            GET CVT POINTER          XL03130 25906903
         L     WORKO,CVTTCBP           GET TCB POINTER          XL03130 25907003
         DROP  WORKO                   RELEASE REGISTER         XL03130 25909203
         L     WORKO,D4(WORKO)         GET CURRENT TCB          XL03130 25911203
         L     WORKO,D12(WORKO)        GET POINTER TO TIOT      XL03130 25913203
         LA    WORKO,D4(WORKE,WORKO)   POINT TO DDNAME IN TIOT  XL03130 25913603
         MVC   DDNAME(L8),D0(WORKO)    SAVE DDNAME              XL03130 25913703
         DEVTYPE   DDNAME,DEVINFO,DEVTAB     GET DEVICE INFO    XL03130 25913803
         CLC   WINCYL(L2),CYL696       IS THIS A 72 MEG         XL03130 25913903
         BE    DISLIKE                 CONTINUE                 XL03130 25916203
         MVI   NUMALT+D1,CC12          CHANGE NO. ALTS TO 1     YM7385  25918202
.X225601 ANOP                                                   XL03130 25920203
*********************************************************************** 25920402
*        CHECK VTOC ETC                                         YL02912 25920602
*********************************************************************** 25920802
         USING UCB,SIX                                         YM3004   25920902
DISLIKE  EQU   *                                                XL03291 25921003
         L     PARMA,UCBVTOC           PICK UP VTOC ADDRESS IN   YM3004 29500002
*                                          TTR0 TRIED            YM3004 29600002
         DROP  SIX                                             YM3004   29650002
         TM    PNTOFLO,BIT2             TRACK OVERFLO DATA SET  YL02912 29700002
         BNO   DEBBUILD                 NO, NOT AN OVERFLOW DATA SET    29900020
         OI    SWITCH,OVFLW             DATA SET IS TRACK OVERFLOW      30000020
         TM    DEVTAB+D1,BIT1           DOES SYSTEM SUPPORT TRACK       30100020
*                                          OVERFLOW                     30200020
         BO    DEBBUILD                 YES, OK                         30300020
         LA    FOUR,CC56                SET COMPLETION CODE TO REFLECT  30400020
*                                          TRACK OVERFLOW DATA SET WITH 30500020
*                                          NO SYSTEM SUPPORT            30600020
         B     FREEWORK                 ERROR, GET OUT                  30700020
         EJECT                                                          30800020
*********************************************************************** 30850002
* THIS SECTION BUILDS A DEB                                             30900020
*********************************************************************** 30950002
DEBBUILD MVI   DEBNMEXT,ONEXT           SET NUMBER OF EXTENTS TO ONE    31000020
         LA    PARMB,DCB                LOAD POINTER TO DCB             31100020
         USING CVT,ADDREG                                               31200020
         L     ADDREG,CVTPTR            LOAD COMM VECT TABLE BASE       31300020
         L     WORKE,CVTXAPG            GET IOS APPENDAGE TABLE ADDR.   31400020
         LR    WORKO,SIX                LOAD UCB POINTER                31500020
         USING UCB,SIX                                                  31600020
         MVC   MIELNAME(L6),SRTEVOLI    MOVE VOL SER FOR ENQ            31700020
         SR    FOUR,FOUR                LOAD BB AND START CC            31800020
         AIF   ('&LIB' NE 'LIB1').X225604                       YL02912 31850002
         CLI   DEVTAB+D3,D2321          CHECK FOR A 2321                31900020
         BNE   MAINUCB                  NO, OTHER THAN 2321             32000020
         IC    FOUR,D33(X0,FIVE)        PICK UP SECOND BYTE OUT OF SEEK 32100020
         SLL   FOUR,BITS8                                               32200020
         IC    FOUR,D34(X0,FIVE)        PICK UP THIRD BYTE OF SEEK      32300020
         LR    FIVE,FOUR                                                32400020
         SLL   FOUR,BITS16              POSITION BB                     32500020
         SLL   FIVE,BITS4               INDEX FOR SUB-UCB               32600020
         LA    FIVE,D56(FIVE,SIX)       CALCULATE SUB-UCB ADDRESS       32700020
         DROP  SIX                                                      32800020
         USING DATACELL,FIVE                                            32900020
         MVC   MIELNAME(D6),DCELVOLI    MOVE VOL SER FOR ENQ            33000020
         L     PARMA,DCELVTOC           LOAD TTR OF VTOC START          33100020
         DROP  FIVE                                                     33200020
.X225604 ANOP                                                   YL02912 33250002
         DROP  SIX                                              YL02912 33260002
MAINUCB  LM    FIVE,SIX,EXTCON1         LOAD START HH,END CCHH AND TRKS 33300020
         STM   PARMB,SIX,DEBPROTG       STORE IN DEB                    33400020
         L     PARMB,PNTDEB             POINT TO DEB            YL02912 33430002
         CLC   PNTEST,TESTDC            TEST MODE               YL02912 33460002
         BNE   MAINUC1                  NO                      YL02912 33470002
         MVC   DEBEXSCL+D1(L3),HOLDKEY+1  SET APVT POINTER      YL02912 33480002
MAINUC1  EQU   *                                                YL02912 33490002
         MVI   DEBPROTG,DEBID           INSERT DEB ID                   33500020
         MVI   DEBEXSCL,DA              INSERT EXTENT SCALE             33600020
         MVI   DEBDVMOD,DEVFM           INSERT DEVICE MODE              33700020
*                                                                       33800020
*********************************************************************** 33850002
* THIS SECTION BUILDS DCB,IOB,ECB                                       33900020
*********************************************************************** 33950002
*                                                                       34000020
         MVI   IOB,FLAG1                SET FLAG BYTE FOR COMMAND       34100020
*                                          CHAINING AND UNRELATED       34200020
         LA    PARMB,DEB                PUT IN DEB POINTER              34300020
         ST    PARMB,DEBPTR                                             34400020
         LA    WORKE,ECB                PUT IN ECB POINTER              34500020
         ST    WORKE,IOBECBCC                                           34600020
         LA    WORKE,CCW1               PUT IN CHAN PROG POINTER        34700020
         LA    WORKO,DCB                PUT IN DCB POINTER              34800020
         STM   WORKE,WORKO,IOBSTART                                     34900020
         L     ADDREG,CVTPCNVT          LOAD CONVERSION ROUTINE ADDR    35000020
         DROP  ADDREG                                                   35100020
         IC    PARMA,ZEROS              CLEAR LOW ORDER BYTE OF TTR     35200020
         LA    PARMB,DEB                SET UP DEB POINTER              35300020
         LA    WORKE,SEEK               LOAD POINTER TO 8 BYTE AREA FOR 35400020
*                                          CONVERT ROUTINE TO RETURN    35500020
*                                          ABSOLUTE ADDRESS OF VTOC IN  35600020
         LR    WORKO,AREAREG            SAVE WORK AREA POINTER          35700020
         STM   NINE,SAVEREG,REGSAVE     SAVE REGISTERS                  35800020
         BALR  RETREG,ADDREG            GO TO CONVERT ROUTINE           35900020
         LM    NINE,SAVEREG,REGSAVE-SVRBEX(WORKO)  RESTORE REGISTERS    36000020
         MVC   VTOCADR(L5),SEEK+D3      SAVE VTOC ADDRESS               36100020
*********************************************************************** 36150002
* THIS SECTION RELOCATES THE CHANNEL PROGRAM TO THE WORK AREA           36200020
*********************************************************************** 36250002
         LM    PARMA,FIVE,CCWP1         LOAD THREE CCW'S                36300020
         ALR   PARMA,AREAREG                                            36400020
         ALR   WORKE,AREAREG                                            36500020
         ALR   FOUR,AREAREG                                             36600020
         STM   PARMA,FIVE,CCW1          STORE THREE CCW'S               36700020
         B     XCTL                    TRANSFER CONTROL TO SECOND LOAD  36800020
*                                          MODULE                       36900020
         EJECT                                                          37000020
*********************************************************************** 37050002
GETL     GETMAIN EC,LV=1024,MF=L        FOR MAIN WORK AREA              37100020
*********************************************************************** 37102002
*        DEVICE TABLE                                           YL02912 37104002
*********************************************************************** 37106002
*                                                               XL03921 37110003
* THE PARAMETERS OF THE TABLE IS AS FOLLOWS                     XL03921 37150003
*  TABDEV1 - DEVICE TYPE                                        XL03921 37200003
*  TABDEV2 - 10% OF ALTERNATES ORIGINALLY AVAILABLE             XL03921 37250003
*            100% IF A 2305                                     XL03921 37300003
*  TABDEV3 - MAXIMUM NUMBER OF COUNT FIELDS PER TRACK + 1       XL03921 37350003
*            NOT +1 IF A 2305                                   XL03921 37400003
*  TABDEV4 - WHERE TO GO IF DEVICE IS EQUAL                     XL03921 37450003
*                                                               XL03921 37500003
TABDEV   DS    0F                      TABLE BEGINNING          XL03921 37550003
TABDEV1  DC    X'08'                   2314                     XL03921 37600003
TABDEV2  DC    X'06'                                            XL03921 37650003
TABDEV3  DC    H'73'                                            XL03921 37700003
TABDEV4  B     DISLIKE                                          XL03921 37750003
         DC    X'09'                   3330                     XL03921 37800003
         DC    X'13'                                            XL03921 37850003
         DC    H'98'                                            XL03921 37900003
         B     A3330                                            XL03921 37950003
         DC    X'0B'                   3350                    PTMFIX   37960030
         DC    X'15'                                           PTMFIX   37970030
         DC    H'105'                                          PTMFIX   37980030
         B     A3330                                           PTMFIX   37990030
         DC    X'06'                   2305-1                   XL03921 38000003
         DC    X'01'                                            XL03921 38050003
         DC    H'34'                                            XL03921 38100003
         B     DISLIKE                                          XL03921 38150003
         DC    X'07'                   2305-2                   XL03921 38200003
         DC    X'01'                                            XL03921 38250003
         DC    H'75'                                            XL03921 38300003
         B     DISLIKE                                          XL03921 38350003
         AIF  ('&LIB' NE 'LIB1').X225603                                38360003
         DC    X'01'                   2311                     XL03921 38400003
         DC    X'03'                                            XL03921 38450003
         DC    H'60'                                            XL03921 38500003
         B     DISLIKE                                          XL03921 38550003
         DC    X'04'                   2302                     XL03921 38600003
         DC    X'18'                                            XL03291 38650003
         DC    H'81'                                            XL03291 38700003
         B     DISLIKE                                          XL03291 38750003
         DC    X'05'                   2321                     XL03291 38760003
         DC    X'40'                                            XL03921 38770003
         DC    H'65'                                            XL03921 38780003
         B     DISLIKE                                          XL03291 38790003
.X225603 ANOP                                                           38790103
         AIF   ('&LIB' EQ 'LIB1').X225602                       XL03291 38790403
         DC    X'0D'                   3330C                    XL03145 38792003
         DC    X'13'                                            XL03145 38794003
         DC    H'98'                                            XL03145 38796003
         B     A3330                                            XL03145 38798003
         DC    X'0A'                   3340                     XL03130 38798403
         DC    X'18'                   ALTERNATE VALUE MAY BE   YM7385  38798802
*                                      CHANGED BY PROGRAM LOGIC XL03130 38799203
         DC    H'52'                                            XL03130 38799603
         B     A3340                                            XL03130 38799703
.X225602 ANOP                                                   XL03291 38799803
* END OF TABLE WITH DELIMITOR                                   XL03291 38799903
         DC    X'FF'                                            XL03291 38800003
         DC    X'FF'                   DELIMITOR                XL03291 38833203
         DC    X'FFFF'                                          XL03291 38843203
         B     NONSUP                                           XL03291 38853203
* END OF TABDEV TABLE                                           XL03291 38863203
*********************************************************************** 38864202
*                                                               XL03291 38865203
         DS    0F                                               XL03291 38866703
EXTCON1  DC    X'0000'                  CONSTANT FOR END CCHH           38900020
         DC    X'FFFFFFFF7FFF'          OF DEB                          39000020
VTOCNAME DC    CL8'SYSVTOC'             MAJOR QUE ELEMENT NAME          39100020
TESTDC   DC    CL4'TEST'                TEST MODE               YL02912 39150002
CCWP1    CCW   X'1A',DEQAREA-SVRBEX,X'40',5  READ HOME ADDRESS          39200020
CCWP2    CCW   X'12',IECSDSF4-SVRBEX,X'40',8  READ COUNT FIELD          39300020
CCWP3    CCW   X'06',IECSDSF4-SVRBEX,X'00',96  READ DATA FOR F4 DSCB    39400020
ENABLE   DC    X'FF'                    ENABLE CONSTANT                 39500020
TTRCON   DC    X'C378'                  MODULE ATTRIBUTES               39600020
         DC    X'000400'                CORE REQUIREMENTS IN BYTES      39700020
         DC    X'0400'                  MODULE LENGTH IN BYTES          39800020
ATLASNM  DC    CL6'IGG086'              COMMON NAME                     39900020
CYL696   DC    H'696'                  NO. CYL 72 MEGABYTE WIN. YM7385  39910002
MAINT    DC    2CL25'IGC0008F MAINTENANCE AREA'                 YL02912 39950002
*********************************************************************** 39970002
         SPACE                                                          40000020
*XCTL BY TTR TABLE                                                      40100020
*********************************************************************** 40150002
         SPACE                                                          40200020
         ORG   IGC0008F+1000            FIRST ORG                       40300020
TTRTABLE EQU   *                                                        40400020
ATLAS02  DC    C'0A'                    ID OF NEXT ATLAS LOAD           40500020
TTR2     DC    X'00000000'              TTR OF NEXT ATLAS LOAD          40600020
ATLAS06  DC    C'AE'                    ID OF ERROR ATLAS LOAD          40700020
TTR6     DC    X'00000000'              TTR OF ERROR ATLAS LOAD         40800020
         DC    X'0000'                  LAST TABLE ENTRY CODE           40900020
         ORG   IGC0008F+1020            SECOND ORG                      41000020
         DC    C'086'                   ATLAS SVC CODE                  41100020
         DC    X'7D'                    RELATIVE TABLE START ADDRESS    41200020
*                                          IN DOUBLE WORDS              41300020
*********************************************************************** 41350002
ZEROS    EQU   EXTCON1                                                  41400020
EXIT     EQU   3                        RETURN SVC                      41500020
USSENS0  EQU   2                        SENSE BYTE ZERO-IOB             41600020
USSENS1  EQU   3                        SENSE BYTE ONE -IOB             41700020
USCSW    EQU   12                       ADDRESS OF LAST EXECUTED CCW+8  41800020
*                                         AS PRESENTED IN USER'S IOB    41900020
USSEEK   EQU   32                       SEEK ADDRESS   -IOB             42000020
USDCBPT  EQU   20                       POINTER TO DCB - IOB            42100020
USDEBAD  EQU   44                       POINTER TO DEB -DCB             42200020
USEXSCL  EQU   28                       EXTENT SCALE   -DEB             42300020
DEBOFLGS EQU   8                                                        42600020
DEBDASD  EQU   32                                                       42700020
DEBSTRCC EQU   6                                                        42800020
DEBSTRHH EQU   8                                                        42900020
DEBENDCC EQU   10                                                       43000020
DEBENDHH EQU   12                                                       43100020
DEBNOEXT EQU   16                                                       43200020
NEXTEXT  EQU   16                                                       43300020
         EJECT                                                          43400020
*********************************************************************** 43450002
WORKDSCT DSECT                                                          43500020
SVRBEX   DS    1F                       SAVE AREA FOR SVRB EXTENSION    43600020
*                                          POINTER                      43700020
DEVTAB   DS    1F                       DEVICE TYPE INDICATOR FROM UCB  43800020
SWITCH   DS    CL1                      LOGIC SWITCH                    43900020
*                                       0 BIT INDICATES CHANNEL         44000020
*                                          PROGRAM NOT RE-EXECUTABLE    44100020
*                                       1 BIT INDICATES WRITE SPECIAL   44200020
*                                          REQUIRED                     44300020
*                                       2 BIT INDICATES TRACK OVERFLOW  44400020
*                                          DATA SET                     44500020
*                                       4 BIT INDICATES NO ALTERNATES   44600020
*                                          AVAILABLE                    44700020
*                                       6 BIT INDICATES AN ERROR ON     44800020
*                                          OTHER THAN THE ORIGINAL      44900020
*                                          ERROR RECORD                 45000020
*                                       7 BIT INDICATES VTOC HAS BEEN   45100020
*                                          ENQUEUED UPON                45200020
NUMBERR  DS    CL2                      NUMBER OF ERROR RECORDS         45300020
VTOCADR  DS    CL5                      VTOC ADDRESS CCHHR              45400020
SPLIT    DS    X'00'                    SPLIT CYLINDER SWITCH           45500020
RETPT    DS    1F                       POINTER TO NEXT ROUTINE         45600020
*********************************************************************** 45650002
         DS    0F                                                       45700020
         IECSDSL1 (4)                                                   45800020
*********************************************************************** 45850002
TICADDR  DS    1F                       ADDRESS OF TIC CCW IN NEW       45900020
*                                          CHANNEL PROGRAM              46000020
SAVEADDR DS    1F                       ADDRESS OF FIRST COUNT FIELD    46100020
CNTCORE  DS    1F                       NUMBER OF BYTES IN COUNT FIELD  46200020
*                                          WORK AREA                    46300020
COREADDR DS    1F                       ADDRESS OF COUNT FIELD          46400020
*                                          WORK AREA                    46500020
RECADDR  DS    1F                       ADDRESS OF CORE GOTTEN FOR      46600020
*                                          LONGEST RECORD SIZE          46700020
RECCORE  DS    1F                       NUMBER OF BYTES IN THIS AREA    46800020
DDNAME   DS    1D                      SAVE DDNAME              XL03130 46850003
DEVINFO  DS    5F                      DEVICE INFO              XL03130 46860003
WINCYL   EQU   DEVINFO+D8               NUMBER OF CYLINDERS     XL03130 46870002
PARMUSER DS    1F                       POINT TO USER PARM LIST YL02912 46870502
PNTEST   DS    1F                       TEST MODE               YL02912 46871002
PNTSNAP  DS    1F                       SNAP LIST               YL02912 46871502
PNTSNS   DS    CL2                      SENSE BYTE - USER       YL02912 46872202
         DS    CL1                      FILLER                  YL02912 46872402
PNTMIOB  DS    CL1                      M OF IOB                YL02912 46872602
PNTIOB   DS    1F                       POINT TO IOB            YL02912 46874002
PNTCNT   DS    1F                       POINT TO COUNTS         YL02912 46876002
PARMCNT  DS    2F                       COUNTS                  YL02912 46878002
PNTIOT   DS    CL2                      TIOT OFFSET             YL02912 46878202
         DS    CL1                      FILLER                  YL02912 46878402
PNTOFLO  DS    CL1                      TRACK OVERFLO           YL02912 46878602
PNTDEB   DS    1F                       DEB POINTER             YL02912 46878802
HOLDKEY  DS    1F                       USER KEY                YL02912 46880002
REGHOLD  DS    1F                       TEMP REG SAVE           YL02912 46882002
CNTADDR  DS    1F                       ADDRESS OF COUNT FIELD FOR      46900020
*                                          CCW IN ERROR                 47000020
ERRTYPE  DS    CL1                      TYPE OF ORIGINAL ERROR          47100020
RECNUMB  DS    1F                       R OF ERROR RECORDS              47200020
REGSAVE  DS    5F                       SAVE AREA FOR REGISTERS         47300020
*********************************************************************** 47350002
ECB      DS    1F                       ECB                             47400020
IOB      DS    8F                       IOB                             47500020
IOBECBCC EQU   IOB+4                                                    47600020
IOBSTART EQU   IOB+16                                                   47700020
SEEK     DS    2F                       SEEK ADDRESS                    47800020
DEB      DS    12F                      DEB                             47900020
DEBNMEXT EQU   DEB+16                                                   48000020
DEBPROTG EQU   DEB+24                                                   48100020
DEBEXSCL EQU   DEB+28                                                   48200020
DEBDVMOD EQU   DEB+32                                                   48300020
DEBNMTRK EQU   DEB+46                                                   48400020
DEBPTR   DS    F                        DCB SLOT                        48500020
MIELNAME DS    CL6                      VOLUME SERIAL SLOT              48600020
DCB      EQU   DEBPTR-44                                                48700020
R0AREA   DS    2D                       AREA FOR R0                     48800020
DEQAREA  DS    2D                       DEQ TABLE AREA                  48900020
MJELNAME DS    2F                       MAJOR QUEUE NAME AREA           49000020
ENQAREA  DS    2D                       ENQ TABLE AREA                  49100020
USERPARM DS    1F                       POINTER TO USER'S PARM LIST     49200020
NUMALT   DS    1H                       NUMBER OF ALTERNATES TO BE      49300020
*                                          TRIED                        49400020
MAXCOUNT DS    1H                       MAXIMUM NUMBER OF COUNT FIELDS  49500020
*                                          PER TRACK+1                  49600020
XCTLPTR  DS    2F                       PTR TO XCTL WORK AREA TABLE     49700020
XCTLAREA DS    0CL32                                                    49800020
XCTLNM   DS    CL6                      COMMON BYTES OF ATLAS NAME      49900020
XCTLID   DS    CL2                      ID OF ATLAS MODULE              50000020
         DS    CL6                      *                               50100020
TTR      DS    CL3                      TTR OF ATLAS MODULE             50200020
         DS    CL5                      *                               50300020
TTRATTB  DS    CL2                      ATTRIBUTES OF ATLAS - ALL LOADS 50400020
TTRCREQ  DS    CL3                      CORE REQUIREMENT OF ATLAS LOAD  50500020
TTRLNGTH DS    CL2                      LENGTH OF ATLAS LOAD            50600020
         DS    CL3                      *                               50700020
INCRMNT  DS    1F                       INCREMENT FOR READ COUNTS       50800020
PROGADDR DS    1F                       ADDRESS OF NEW CHANNEL PROGRAM  50900020
ALTHA    DS    2F                       ALTERNATE TRACK HOME ADDRESS    51000020
ALTR0    DS    4F                       ALTERNATE TRACK R0              51100020
*********************************************************************** 51150002
CCW1     DS    1D                       CCW AREA                        51200020
CCW2     DS    1D                       *                               51300020
CCW3     DS    1D                       *                               51400020
CCW44    DS    1D                       *                               51500020
CCW45    DS    1D                       *                               51600020
CCW56    DS    1D                       *                               51700020
CCW57    DS    1D                       *                               51800020
CCW31    DS    1D                       *                               51900020
CCW32    DS    1D                       *                               52000020
CCW33    DS    1D                       *                               52100020
CCW34    DS    1D                       *                               52200020
CCW35    DS    1D                       *                               52300020
CCW36    DS    1D                       *                               52400020
CCW37    DS    1D                       *                               52500020
CCW38    DS    1D                       *                               52600020
CCW39    DS    1D                       *                               52700020
CHECKHA  DS    2F                       AREA FOR HOME ADDRESS OF        52800020
DCBRECFM EQU   36                                                       52900020
*                                       ALTERNATE                       53000020
*********************************************************************** 53050002
CVT      DSECT                                                          53100020
         CVT   SYS=MIN                                                  53200020
*********************************************************************** 53250002
UCB      DSECT                                                          53300020
         IEFUCBOB                                                       53400020
         END                                                            53500020
./  ADD  SSI=53240907,NAME=IGG086AE
         TITLE 'IGG086AE - SIXTH LOAD MODULE FOR SVC 86'         S20201 00100020
         COPY  LCGASMSW                                                 00150003
IGG086AE CSECT                                                          00200020
* FIX WHA CMD FOR 3350.                                        @ZM41672 00300030
*                                                               XM4406  00350003
*                                                                       00400020
*        VS1 RELEASE 5.0 DELETIONS/CHANGES                     @Z30RSAG 00500030
* 3350 DEVICE SUPPORT.                                         @Z30RSAG 00550030
* FIX BAD HA/R0 MSG.                                           @ZM40498 00560030
*          RELEASE 21 DELETIONS/CHANGES                                 00600020
*3650179000-180000,187000-188000,190000-195000,333000-334000,    S21040 00630021
*3650382000,384000                                               S21040 00660021
*          RELEASE 20 DELETIONS/CHANGES                                 00700020
*0792001000-002000,320000,329000                                 S20201 00750020
*                                                                       00800020
*STATUS CHANGE LEVEL 003                                                00900021
*                                                                     * 01000020
*TITLE 'IGG086AE' - SIXTH LOAD MODULE OF SVC 86                       * 01100020
*                                                                     * 01200020
*FUNCTION/OPERATION                                                   * 01300020
*    IGG086AE HAS TWO MAJOR FUNCTIONS.  FIRST, IT UPDATES THE FORMAT  * 01400020
*4 DSCB TO REFLECT THE CURRENT NUMBER OF ALTERNATE TRACKS AVAILABLE   * 01500020
*AND THE ADDRESS OF THE NEXT AVAILABLE ALTERNATE.  IT THEN WRITES     * 01600020
*HOME ADDRESS AND RECORD ZERO ON THE BAD TRACK.  IF THE USER'S CHANNEL* 01700020
*PROGRAM IS RE-EXECUTABLE IT WILL ATTEMPT TO EXECUTE THE PROGRAM.     * 01800020
*SECOND, IT DEQUEUES THE VTOC, FREES GOTTEN CORE, AND EXITS.          * 01900020
*                                                                     * 02000020
*ENTRY POINT                                                          * 02100020
*    IGG086AE TESTS REGISTER FOUR FOR AN INDICATION OF WHETHER THE    * 02200020
*MODULE WERE ENTERED DUE TO AN ERROR CONDITION OR FOR NORMAL          * 02300020
*PROCESSING.                                                          * 02400020
*                                                                     * 02500020
*INPUT                                                                * 02600020
*    CONSISTS OF THE 688-BYTE WORK AREA POINTED TO BY REGISTER 11,    * 02700020
*A WORK AREA FOR COUNT FIELDS AND TRACK DESCRIPTION CHANNEL PROGRAM   * 02800020
*POINTED TO BY REGISTER 10, AND A CONDITION CODE IN REGISTER FOUR.    * 02900020
*                                                                     * 03000020
*OUTPUT                                                               * 03100020
*    RETURN CODE IN REGISTER FIFTEEN INDICATING THE STATUS OF         * 03200020
*COMPLETION OF THE JOB AND THE UPDATED FORMAT FOUR DSCB.  A RETURN    * 03300020
*PARAMETER LIST IS LOADED INTO REGISTER ZERO.  THE FIRST BYTE SHOWS   * 03400020
*THE NUMBER OF RECORD NUMBERS RETURN IN THE REMAINING THREE BYTES OF  * 03500020
*THE REGISTER.  THE RECORD NUMBERS OF A MAXIMUM OF THREE ERROR        * 03600020
*RECORDS ARE GIVEN TO IDENTIFY THOSE RECORDS WHICH COULD NOT BE READ  * 03700020
**OR WRITTEN WITHOUT ERROR.                                           * 03800020
*                                                                     * 03900020
*EXTERNAL ROUTINES                                                    * 04000020
*   NONE                                                              * 04100020
*                                                                     * 04200020
*EXITS                                                                * 04300020
*    ERROR - BRANCHES TO BEGIN, THAT PORTION OF THE PROGRAM WHICH     * 04400020
*            DEQUEUES THE VTOC, FREES GOTTEN CORE, AND EXITS          * 04500020
*    NORMAL - SVC 3 EXIT                                              * 04600020
*                                                                     * 04700020
*TABLES/WORK AREAS                                                    * 04800020
*    MAIN WORK AREA CONTAINING THE FORMAT 4 DSCB, MAXIMUM NUMBER OF   * 04900020
*COUNT FIELDS PER TRACK, A POINTER TO USER'S PARAMETER LIST, ECB,     * 05000020
*IOB, DEB, AND DCB.                                                   * 05100020
*                                                                     * 05200020
*ATTRIBUTES                                                           * 05300020
*    REENTRANT, REFRESHABLE                                           * 05400020
*                                                                     * 05500020
*                                                                       05600020
*                                                                       05700020
*********************************************************************** 05800020
*                                                                     * 05900020
*                               EQUATES                               * 06000020
*                                                                     * 06100020
*********************************************************************** 06200020
*********************************************************************** 06300020
*          COMPLETION CODES                                           * 06400020
*********************************************************************** 06500020
CC24     EQU   24                       ERROR READING FORMAT4 DSCB      06600020
CC36     EQU   36                       HA OR R0 ERRORS                 06700020
CC52     EQU   52                       ERROR RE-EXECUTING USER PROGRAM 06800020
*********************************************************************** 06900020
*********************************************************************** 07000020
*          DISPLACEMENT CONSTANTS                                     * 07100020
*********************************************************************** 07200020
D0       EQU   0                                                        07300020
D1       EQU   1                                                        07400020
D2       EQU   2                                                        07500020
D3       EQU   3                                                        07600020
D4       EQU   4                                                        07700020
D5       EQU   5                                                        07800020
D6       EQU   6                                                        07900020
D7       EQU   7                        *                        S21040 07950021
D11      EQU   11                      3350 HA LENGTH          @X50RSPC 07952030
MADHA    EQU   124                     3350 HA SKIP DISP       @Z30RSAG 07954030
MADR0C   EQU   218                     3350 R0 CNT SKIP DISP   @Z30RSAG 07956030
MADR0D   EQU   310                     3350 R0 DATA SKIP DISP  @Z30RSAG 07958030
D22      EQU   22                                               REFIX   07960003
*********************************************************************** 08000020
*          LENGTH CONSTANTS                                           * 08100020
*********************************************************************** 08200020
L1       EQU   1                                                        08300020
L2       EQU   2                                                        08400020
L3       EQU   3                                                        08500020
L4       EQU   4                                                        08600020
L5       EQU   5                                                        08700020
L6       EQU   6                                                REFIX   08750003
L7       EQU   7                                                        08800020
L11      EQU   11                       *                        S21040 08810021
L24      EQU   24                                               REFIX   08812403
SILI     EQU   X'20'                    CCW FLAG                REFIX   08814003
**********************************************************************  08820020
*        DEVICE EQUATES                                              *  08840020
**********************************************************************  08860020
D3330    EQU   X'09'                    3330 DEVICE TYPE         S20201 08880020
D3350    EQU   X'0B'                   3350 DEVICE TYPE        @Z30RSAG 08890030
*********************************************************************** 08900020
*                                                                     * 09000020
*********************************************************************** 09100020
BADTRK   EQU   X'02'                                                    09200020
D2314    EQU   X'08'                    DEVICE TYPES                    09300020
D2321    EQU   X'05'                        *                           09400020
         AIF   ('&LIB' EQ 'LIB1').X225603                       XL03130 09410003
SENSE    EQU   X'04'                    SENSE CCW OP CODE       XM4406  09410403
NE       EQU   7                        NOT EQUAL CONDITION CODE XM4406 09412003
GOOD     EQU   X'7F'                    GOOD ECB COND CODE      XM4406  09414003
D3330C   EQU   X'0D'         3330C                              XL03145 09420003
D3340    EQU   X'0A'                             3340           XL03130 09450003
RHA      EQU   X'1A'                   READ HOME ADDRESS        XL03130 09460003
SDHA     EQU   X'6E'                   HA SKIP VALUE            XL03130 09470003
SDROC    EQU   X'C8'                   R0 COUNT SKIP VAL        XL03130 09480003
SDROD    EQU   X'11D'                  R0 DATA SKIP VAL         XL03130 09490003
.X225603 ANOP                                                   XL03130 09492003
ENQSW    EQU   X'01'                    ENQUEUE SWITCH                  09500020
EOF      EQU   X'0D'                    END OF FILE                     09600020
FFSW     EQU   X'FF'                                                    09700020
FLAG1    EQU   X'42'                                                    09800020
IOEROR   EQU   X'20'                                                    09900020
NOREEX   EQU   X'80'                                                    10000020
R0DD8    EQU   X'08'                    RECORD ZERO DATA LENGTH  S21040 10050021
RR0      EQU   X'16'                    READ RECORD 0                   10100020
X0       EQU   0                                                        10200020
*                                                                       10300020
*                                                                       10400020
         EJECT                                                          10500020
*********************************************************************** 10550002
*REGISTER ASSIGNMENTS                                                   10600020
*********************************************************************** 10650002
PARMA    EQU   0                        PARAMETER REGISTER              10700020
PARMB    EQU   1                        PARAMETER REGISTER              10800020
WORKE    EQU   2                        WORK REGISTER                   10900020
WORKO    EQU   3                        WORK REGISTER                   11000020
FOUR     EQU   4                        WORK REGISTER - RETURN CODE     11100020
FIVE     EQU   5                        WORK REGISTER                   11200020
SIX      EQU   6                        WORK REGISTER                   11300020
SEVEN    EQU   7                        WORK REGISTER                   11400020
EIGHT    EQU   8                        WORK REGISTER                   11500020
NINE     EQU   9                        WORK REGISTER                   11600020
TEN      EQU   10                       ADDRESS OF COUNT WORK AREA      11700020
AREAREG  EQU   11                       ADDRESS OF WORK AREA            11800020
BASEREG  EQU   12                       ADDRESS OF MODULE               11900020
SAVEREG  EQU   13                       WORK REGISTER                   12000020
RETREG   EQU   14                       WORK REGISTER                   12100020
ADDREG   EQU   15                       COMPLETION CODE REGISTER        12200020
*********************************************************************** 12220002
*        START OF MODULE                                                12240002
*********************************************************************** 12260002
         SPACE                                                          12300020
         BALR  BASEREG,X0               ESTABLISH                       12400020
         USING FIRST,BASEREG               OWN ADDRESSABILITY           12500020
         USING WORKDSCT,AREAREG         ESTABLISH ADDRESSABILITY OF     12600020
*                                          WORK AREA                    12700020
         USING CNTAREA,TEN              ESTABLISH ADDRESSABILITY OF     12800020
*                                          COUNT FIELD WORK AREA        12900020
*********************************************************************** 12950002
         SPACE                                                          13000020
*THIS SECTION BUILDS A CHANNEL PROGRAM TO WRITE AND READ BACK CHECK     13100020
*HOME ADDRESS AND RECORD ZERO ON THE BAD TRACK                          13200020
*********************************************************************** 13250002
         SPACE                                                          13300020
FIRST    LTR   FOUR,FOUR                WAS THIS MODULE ENTERED         13400020
*                                          BECAUSE OF ERRORS            13500020
         LA    EIGHT,NORMAL                                             13600020
         ST    EIGHT,RETPT                                              13700020
         BZ    UPDATE                   NO.UPDATE VTOC                  13800020
         CH    FOUR,HALF48              DOES RETURN CODE INDICATE NO    13900020
         BE    BEGIN                       ERRORS FOUND ON TRACK        14000020
         CH    FOUR,HALF16              DOES CODE INDICATE ERROR IN     14100020
*                                          ASSIGNING ALTERNATE          14200020
         BNE   TEST3                    NO, MAKE ANOTHER TEST           14300020
         LA    EIGHT,BEGIN              ADDRESS OF EXIT ROUTINE         14400020
         ST    EIGHT,RETPT                                              14500020
         B     UPDATE                   BRANCH TO UPDATE THE VTOC       14600020
TEST3    CH    FOUR,HALF40              DOES CODE INDICATE ERR IN OTHER 14700020
*                                          THAN ORIGINAL ERROR RECORD   14800020
         BNE   BEGIN                    PREPARE FOR EXIT                14900020
         LA    EIGHT,NORMAL             ADDRESS OF CHANNEL PROGRAM      15000020
         ST    EIGHT,RETPT                                              15100020
         B     UPDATE                   BRANCH TO UPDATE VTOC           15200020
NORMAL   L     PARMB,USERPARM           PICK UP ADDRESS OF USER'S       15300020
*                                          PARAMETER LIST               15400020
         L     WORKO,D4(X0,PARMB)       GET ADDRESS OF USER'S CCHH      15500020
         LM    FIVE,EIGHT,CCWONE        LOAD FIRST TWO CCW'S            15600020
         LA    NINE,HOMEAD              PICK UP ADDRESS OF HOME ADDRESS 15700020
         CLI   DEVTAB+D3,D3350         IS IT A 3350 ?          @ZM41672 15750030
         BNE   NOTMAD                  NO                      @ZM41672 15760030
         LA    NINE,MADSD              GET 3350 HA ADDR        @ZM41672 15770030
NOTMAD   ALR   FIVE,NINE                   TO BE WRITTEN       @ZM41672 15800030
         LA    NINE,R0                  PICK UP ADDRESS OF RECORD ZERO  15900020
         ALR   SEVEN,NINE                  TO BE WRITTEN                16000020
         STM   FIVE,EIGHT,CCW1          STORE TWO CCW'S IN WORK AREA    16100020
         LM    FIVE,EIGHT,CCWTHREE      LOAD LAST TWO CCW'S             16200020
         LA    NINE,HOMEAD              PICK UP ADDRESS TO READ BACK    16300020
         ALR   FIVE,NINE                   CHECK HOME ADDRESS           16400020
         LA    NINE,R0                  PICK UP ADDRESS TO READ BACK    16500020
         ALR   SEVEN,NINE                  CHECK RECORD ZERO            16600020
         STM   FIVE,EIGHT,CCW3          STORE LAST 2 CCW'S IN WORK AREA 16700020
         MVC   SEEK+D3(L5),D0(WORKO)    SET SEEK ADDRESS TO BAD TRACK   16800020
         MVC   DEBSTRCC(L4),D0(WORKO)   SET DEB FOR SINGLE TRACK FXTENT 16900020
         MVC   DEBENDCC(L4),D0(WORKO)      USING BAD TRACK              17000020
         BAL   EIGHT,SETBLKS            BRANCH TO RESET CONTROL BLOCKS  17100020
         LA    EIGHT,CCW1               PUT ADDRESS OF CHANNEL PROGRAM  17200020
         ST    EIGHT,IOBSTART              INTO IOB                     17300020
         AIF   ('&LIB' EQ 'LIB1').X225600                       XL03130 17310003
         CLI   DEVTAB+D3,D3350         IS IT A 3350 ?          @Z30RSAG 17320130
         BNE   NOMAD                   NO                      @Z30RSAG 17330130
         MVI   CCW1+D7,D11             SET 3350 HA LNGTH       @X50RSPC 17340030
         B     FIXCCW                                          @Z30RSAG 17342030
NOMAD    EQU   *                                               @Z30RSAG 17344030
*********************************************************************** 17346030
*        CHECK FOR 3340                                                 17348030
*********************************************************************** 17348430
         CLI   DEVTAB+D3,D3340                   IS IT A 3340   XL03130 17350003
         BNE   NOTWIN                  NO,MUST BE A 5 BYTE HA   XL03130 17360003
         MVI   CCW1+D7,D7              SET BYTE COUNT TO 7 WHA  XL03130 17370003
FIXCCW   EQU   *                                               @Z30RSAG 17372030
         MVC   HOMEAD+D3(L4),D0(WORKO) SET UP HA                XL03130 17380003
         MVI   HOMEAD+D2,BADTRK        INDICATE DEFECTIVE TRACK XL03130 17390003
         XC    HOMEAD(L2),HOMEAD       CLEAR 1ST 2 BYTES        XL03130 17394003
         BAL   NINE,GETSD               GET SD BYTES            XM4406  17394403
         B     ISWIN                   BYPASS 5 BYTE CODE       XL03130 17396003
         EJECT                                                          17396403
*        THE FOLLOWING WILL RETREIVE THE 3340 SKIP-DISPLACEMENT (SD)    17398803
*********************************************************************** 17398902
*        SET UP HOME ADDRESS                                            17399202
*********************************************************************** 17399602
*        BYTES.                                                         17400803
GETSD    EQU   *                                                XM4406  17401503
         LA    WORKE,SDARSZ             LOAD WORK AREA SIZE     REFIX   17403503
         GETMAIN R,LV=(WORKE),SP=229                           @ZA06533 17403600
         USING SDAREA,PARMB                                             17403703
         STM   WORKE,EIGHT,REGSAV       SAVE WORK REG           REFIX   17403803
         LR    WORKO,PARMB               LOAD BASE REG           REFIX  17403903
         USING SDAREA,WORKO                                             17406603
         LM    FIVE,EIGHT,CCWTHREE      GET CCW MASK            XM4406  17410303
         LA    WORKE,HOMEAD             GET ADDR OF CURRENT HA  XM4406  17413103
         ALR   FIVE,WORKE               PUT HA IN RDHA          XM4406  17415903
         LA    WORKE,SENSA              ADDR OF SENSE AREA      XM4406  17418703
         ALR   SEVEN,WORKE              GET SENSE AREA ADDR     XM4406  17421503
         STM   FIVE,EIGHT,SDCCW1        STORE CCWS IN W.A.      XM4406  17424303
         MVI   SDCCW2,SENSE              RESET OPCODE TO SENSE   XM4406 17427103
         MVI   SDCCW2+L4,SILI            RESET FLAG BYTE         XM4406 17429903
         MVI   SDCCW2+L7,L24             RESET LENGTH BYTE       XM4406 17432703
         L     FOUR,IOBSTART            GET CURRENT CCW ADDR    XM4406  17435503
         LA    SEVEN,SDCCW1             LOAD NEW CCW ADDR       XM4406  17438303
         ST    SEVEN,IOBSTART           RESET IOB CCW ADDR      XM4406  17438703
         EXCP  IOB                                                      17445503
         WAIT  ECB=ECB                                                  17447503
         ST    FOUR,IOBSTART            RESTORE IOB CCW ADDR    XM4406  17449503
         CLI   ECB,GOOD                 SENSE RETURNED OK ?     XM4406  17451503
         BNE   BRNINE                 NO, EXIT                XM4406    17451903
         MVC   HOMEAD(L2),SDBYTES      MOVE SD BYTES TO HA     XM4406   17452303
         CLI   DEVTAB+D3,D3350         IS IT 3350 ?            @Z30RSAG 17452430
         BNE   BRNINE                  NO                      @Z30RSAG 17452530
         MVC   MADSD(L4),MADSDB        GET FIRST 4 BYTES       @X50RSPC 17452630
BRNINE   EQU   *                                                REFIX   17452703
         LA    PARMA,SDARSZ             LOAD WORK AREA SIZE     REFIX   17453503
         LR    PARMB,WORKO              LOAD W.A. PTR           REFIX   17453903
         LM    WORKE,EIGHT,REGSAV       RESTORE REG             REFIX   17454303
         FREEMAIN   R,LV=(PARMA),A=(PARMB),SP=229              @ZA06533 17456300
         BR    NINE                     EXIT                    XM4406  17459103
         EJECT                                                          17461103
NOTWIN   EQU   *                       NOT A 3340               XL03130 17466003
.X225600 ANOP                                                   XL03130 17472803
         MVC   HOMEAD+D1(L4),D0(WORKO)  SET UP HOME ADDRESS             17479603
         MVI   HOMEAD,BADTRK            INDICATE DEFECTIVE TRACK        17500020
         XC    HOMEAD+D5(L3),HOMEAD+D5  CLEAR REMAINING BYTES           17600020
ISWIN    EQU   *                                                XL03130 17650003
         MVC   R0(L4),ALTHA+D1          POINT DEFECTIVE PRIMARY TRACK   17700020
*                                          TO ALTERNATE                 17800020
         XC    R0+D5(L11),R0+D5         SET KDD AND DATA FIELD   S21040 17870021
*                                       TO 0                     S21040 17940021
         MVI   R0+D7,R0DD8              SET DATA LENGTH TO 8     S21040 18010021
*********************************************************************** 18050002
         SPACE                                                          18100020
*THIS SECTION WRITES HOME ADDRESS AND R0 ON THE BAD TRACK AND READS     18200020
*BACK CHECK                                                             18300020
*********************************************************************** 18350002
         SPACE                                                          18400020
CHPROG   EXCP  IOB                      FLAG BAD TRACK                  18500020
         WAIT  1,ECB=ECB                TEST FOR I/O COMPLETE           18600020
         TM    ECB,IOEROR               CHECK FOR SUCCESSFUL I/O S21040 18700021
         BNO   CHEKDEV                  NO, CHECK DEVICE TYPE    S21040 18800021
*********************************************************************** 18850002
         SPACE                                                          18900020
         SPACE                                                          19600020
*THIS SECTION RE-EXECUTES THE USER'S CHANNEL PROGRAM IF POSSIBLE        19700020
*********************************************************************** 19750002
         SPACE                                                          19800020
REEX     TM    SWITCH,NOREEX            IS USER'S CHANNEL PROGRAM       19900020
*                                          RE-EXECUTABLE                20000020
         BO    BEGIN                    NO,GO TO EXIT ROUTINE           20100020
         L     PARMB,PARMUSER           GET USERS PARAM         YL02912 20200002
*********************************************************************** 20220002
         MODESET KEYADDR=HOLDKEY,WORKREG=2   GET USER KEY       YL02912 20240002
*********************************************************************** 20260002
         L     PARMB,D0(X0,PARMB)       PICK UP POINTER TO IOB          20300020
         LR    EIGHT,PARMB                                              20400020
         L     WORKE,D4(X0,PARMB)       PICK UP POINTER TO ECB          20500020
         EXCP  (1)                      RE-EXECUTE USER'S CHANNEL       20600020
*                                          PROGRAM                      20700020
         LR    PARMB,WORKE              SET ECB POINTER                 20800020
         WAIT  1,ECB=(1)                WAIT FOR I/O COMPLETE           20900020
         TM    D0(WORKE),IOEROR         CHECK FOR SUCCESSFUL COMPLETION 21000020
         BO    REEX1                    YES,SUCCESSFUL COMPLETE YL02912 21100002
         CLI   CSW(EIGHT),EOF           WAS CONDITION END OF FILE       21200020
         BO    REEX1                    YES, EXIT               YL02912 21300002
         LA    FOUR,CC52                SET COMPLETION CODE FOR USER'S  21400020
*                                          CHANNEL PROGRAM RE-EXECUTED  21500020
*                                          WITH AN I/O ERROR            21600020
REEX1    EQU   *                                                YL02912 21620002
*********************************************************************** 21630002
         MODESET EXTKEY=DATAMGT         KEY 5                   YL02912 21640002
*********************************************************************** 21670002
         B     BEGIN                    GO TO EXIT ROUTINE              21700020
*********************************************************************** 21750002
         SPACE                                                          21800020
*THIS SECTION  SETS UP AND EXECUTES A CHANNEL PROGRAM TO WRITE AND      21900020
*READ BACK CHECK THE FORMAT 4 DSCB                                      22000020
*********************************************************************** 22050002
         SPACE                                                          22100020
UPDATE   BAL   EIGHT,SETBLKS            RESET CONTROL BLOCKS            22200020
         AIF   ('&LIB' NE 'LIB1').X225605                       YL02912 22250002
.X225605 ANOP                                                   YL02912 25150002
NOT2321  LH    EIGHT,DS4HCCHH+D2        PICK UP HH OF NEXT ASSIGNABLE   25300020
*                                          ALTERNATE                    25400020
         LA    EIGHT,D1(X0,EIGHT)       INCREMENT BY ONE                25500020
         CH    EIGHT,DS4DEVSZ+D2        CHECK FOR NEED TO RESET TRACK   25600020
*                                          NUMBER TO ZERO               25700020
         BL    NOUP                     NO, TRACK NUMBER IS VALID       25800020
         XC    DS4HCCHH+D2(L2),DS4HCCHH+D2  SET TRACK NUMBER TO ZERO    25900020
         LH    EIGHT,DS4HCCHH           PICK UP CC OF NEXT ASSIGNABLE   26000020
*                                          ALTERNATE                    26100020
         LA    EIGHT,D1(X0,EIGHT)       INCREMENT BY ONE                26200020
         STH   EIGHT,DS4HCCHH                                           26300020
         SPACE                                                          26400020
REDUCE   LH    EIGHT,DS4NOATK           REDUCE NUMBER OF AVAILABLE      26500020
         BCTR  EIGHT,X0                    ALTERNATES BY ONE            26600020
         STH   EIGHT,DS4NOATK                                           26700020
         B     LOADCCW                  RELOCATE F4 CHANNEL PROGRAM     26800020
NOUP     STH   EIGHT,DS4HCCHH+D2        STORE NEW TRACK NUMBER          26900020
         B     REDUCE                   REDUCE NUMBER OF AVAILABLE      27000020
*                                          ALTERNATES                   27100020
*********************************************************************** 27110002
*        SET UP CCWS FOR WRITING FORMAT 4                               27120002
*********************************************************************** 27130002
         AIF   ('&LIB' NE 'LIB1').X225604                       YL02912 27150002
STORE1   MVC   DS4HCCHH+D3(L1),SEEK+D6  MOVE IN NEW TRACK ADDRESS       27200020
         B     REDUCE                   REDUCE NUMBER OF AVAILABLE      27300020
*                                          ALTERNATES                   27400020
STORE2   MVC   DS4HCCHH+D2(L1),SEEK+D5  MOVE IN NEW CYLINDER ADDRESS    27500020
         B     REDUCE                   REDUCE NUMBER OF AVAILABLE      27600020
*                                          ALTERNATES                   27700020
STORE3   MVC   DS4HCCHH+D1(L1),SEEK+D4  MOVE IN NEW STRIP ADDRESS       27800020
         B     REDUCE                   REDUCE NUMBER OF AVAILABLE      27900020
*                                          ALTERNATES                   28000020
.X225604 ANOP                                                   YL02912 28050002
LOADCCW  LM    FIVE,EIGHT,CCWFIVE                                       28100020
         LA    NINE,SEEK+D3             PICK UP ADDRESS OF CCHH FOR     28200020
*                                          SEARCH                       28300020
         ALR   FIVE,NINE                INSERT IN SEARCH CCW            28400020
         LA    NINE,CCW1                SET ADDRESS OF COMMAND FOR TIC  28500020
         ALR   SEVEN,NINE                                               28600020
         STM   FIVE,EIGHT,CCW1          RELOCATE FIRST TWO CCW'S        28700020
         LM    FIVE,SIX,CCWSEVEN        LOAD WRITE CCW                  28800020
         LA    NINE,IECSDSF4            GET POINTER TO WRITE            28900020
         ALR   FIVE,NINE                   FORMAT 4 DSCB                29000020
         LM    SEVEN,EIGHT,CCWFIVE      LOAD SID CCW                    29100020
         LA    NINE,SEEK+D3             PICK UP ADDRESS OF CCHH FOR     29200020
*                                          SEARCH                       29300020
         ALR   SEVEN,NINE                                               29400020
         STM   FIVE,EIGHT,CCW3          RELOCATE SECOND TWO CCW'S       29500020
         LM    FIVE,SIX,CCWSIX          LOAD TIC CCW                    29600020
         LA    NINE,CCW44               LOAD ADDRESS FOR TIC            29700020
         ALR   FIVE,NINE                                                29800020
         LM    SEVEN,EIGHT,CCWEIGHT     LOAD READ BACK CHECK CCW        29900020
         LA    NINE,IECSDSF4            GET POINTER TO READ BACK CHECK  30000020
         ALR   SEVEN,NINE                  FORMAT 4 DSCB                30100020
         STM   FIVE,EIGHT,CCW45         STORE LAST TWO CCW'S            30200020
         LA    NINE,CCW1                PUT ADDRESS OF CHANNEL PROGRAM  30300020
         ST    NINE,IOBSTART               INTO IOB                     30400020
         MVC   SEEK+D3(L5),VTOCADR      SET SEEK ADDRESS TO F4 DSCB     30500020
         MVC   DEBSTRCC(L4),VTOCADR     SET DEB FOR SINGLE TRACK EXTENT 30600020
         MVC   DEBENDCC(L4),VTOCADR        USING F4 DSCB                30700020
*********************************************************************** 30720002
*        REWIRE FORMAT 4 DSCB                                           30740002
*********************************************************************** 30760002
         EXCP  IOB                      REWRITE F4 DSCB                 30800020
         WAIT  1,ECB=ECB                WAIT FOR I/O COMPLETE           30900020
         TM    ECB,IOEROR               CHECK FOR PERMANENT I/O ERROR   31000020
         BZ    SETERR                   BRANCH TO SET ERROR CODE        31100020
         L     EIGHT,RETPT                                              31200020
         BR    EIGHT                    BRANCH TO NEXT ROUTINE          31300020
         SPACE                                                          31400020
SETERR   LA    FOUR,CC24                SET COMPLETION CODE TO 24 FOR   31500020
*                                          F4 DSCB CANNOT BE READ       31600020
         B     BEGIN                    WRAP UP                         31700020
*********************************************************************** 31750002
         SPACE                                                          31800020
*THIS SECTION CHECKS DEVICE TYPE AND SETS FLAG TO MOVE HOME ADDRESS     31900020
*OVER 705 BYTES IF DEVICE IS 2314 OR 2321, AND 2370 BYTES FOR 3330      32000020
*********************************************************************** 32050002
         SPACE                                                          32100020
CHEKDEV  EQU   *                       CHECK DEVICE TYPE        XL03291 32150003
         AIF   ('&LIB' EQ 'LIB1').X225601                       XL03291 32152003
         CLI   DEVTAB+D3,D3340                   IS IT A 3340   XL03130 32160003
         BE    CHKSKIP                 ANALYZE SKIP             XL03130 32170003
         CLI   DEVTAB+D3,D3350         IS IT 3350 ?            @Z30RSAG 32172030
         BE    CHKSKIP                 YES                     @Z30RSAG 32174030
.X225601 ANOP                                                   XL03291 32192003
         CLI   DEVTAB+D3,D2314          CHECK FOR 2314                  32200003
         BNL   SETBIT                  YES, SET FLAG           @Z30RSAG 32300030
         CLI   DEVTAB+D3,D2321          CHECK FOR 2321                  32400020
         BNE   ERRCOND                  NO, NOT A 2321                  32500020
         SPACE                                                          32600020
SETBIT   MVI   HOMEAD,FLAG1             SET FLAG TO INDICATE DEFECTIVE  32700020
*                                          TRACK AND TO MOVE HOME       32800020
*                                          ADDRESS OVER 705 BYTES       32850020
*                                          FOR 2314 OR 2321 AND         32900020
*                                          2370 BYTES FOR 3330          32950020
*********************************************************************** 32952002
*        SKIP DISPLACEMENT ON 3340                                      32954002
*********************************************************************** 32956002
WIN1234  EQU   *                       IMPLEMENT SKIP DISPL     XL03291 32960003
         BAL   EIGHT,SETBLKS            RESET CONTROL BLOCKS            33000020
         EXCP  IOB                      RETRY HA AND R0 WRITE           33100020
         WAIT  1,ECB=ECB                WAIT FOR I/O COMPLETE           33200020
         TM    ECB,IOEROR               CHECK FOR SUCCESSFUL I/O S21040 33270021
         BO    REEX                     YES, TO TRY TO REEXECUTE S21040 33340021
*                                          USERS CHANNEL PROGRAM        33410021
*********************************************************************** 33450002
         SPACE                                                          33500020
ERRCOND  LA    FOUR,CC36                SET RETURN CODE TO 36 - COULD   33600020
*                                          NOT FLAG BAD TRACK, HOME     33700020
*                                          ADDRESS OR R0 ERROR          33800020
         B     BEGIN                    WRAP UP                         33900020
*********************************************************************** 33920002
*        CHECK SKIP DISPLACEMENT                                        33940002
*********************************************************************** 33960002
         SPACE                                                          34000020
         AIF   ('&LIB' EQ 'LIB1').X225602                       XL03130 34010003
CHKSKIP  EQU   *                       ANAL. ERR & SET SKIP     XL03130 34050003
         LA    EIGHT,EIGHT             SET VALUE OF 8           XL03130 34060003
         L     NINE,IOBFLAG3           GET POINTER FROM IOBCSW  XL03130 34070003
         LA    NINE,D0(NINE)           CLEAR HIGH ORDER BYTE    XL03130 34080003
         SR    NINE,EIGHT              POINT TO LAST CCW        XL03130 34090003
         CLI   DEVTAB+D3,D3350         IS IT 3350 ?            @Z30RSAG 34090430
         BE    SETMAD                  YES                     @Z30RSAG 34090830
         LA    EIGHT,SDHA              SET SKIP DISPLACE FOR HA XL03130 34092003
         CLI   D0(NINE),RHA            READ HOME ADDRESS ?      XL03130 34094003
         BE    SETSKIP                 SET VALUE                XL03130 34096003
         LA    EIGHT,SDROC             SET R0 SKIP DISPLACE     XL03130 34098003
         CLI   IOBCSWST+D3,R0DD8         RESIDUAL COUNT 8 ?     XL03130 34098403
         BE    SETSKIP                 SET VALUE                XL03130 34098803
         LA    EIGHT,SDROD             SET R0 DATA SKIP DISPL   XL03130 34099203
SETSKIP  STH   EIGHT,HOMEAD            SET SKIP DISPLACE VALUE  XL03130 34099603
         B     WIN1234                 CONTINUE                 XL03130 34099703
*********************************************************************** 34099902
SETMAD   EQU   *                                               @Z30RSAG 34124730
         LA    EIGHT,MADHA             SET SKIP DISP FOR HA    @Z30RSAG 34134730
         CLI   D0(NINE),RHA            READ HOME ADDRESS ?     @Z30RSAG 34144730
         BE    SETSKIP                 YES, SET VALUE          @Z30RSAG 34146730
         LA    EIGHT,MADR0C            SET R0 CNT SKIP DISP    @Z30RSAG 34148730
         CLI   IOBCSWST+D3,R0DD8       RESIDUAL COUNT = 8 ?    @Z30RSAG 34149130
         BE    SETSKIP                 YES, SET VALUE          @Z30RSAG 34149530
         LA    EIGHT,MADR0D            SET R0 DATA SKIP DISP   @Z30RSAG 34149930
         B     SETSKIP                 GO SET VALUE            @Z30RSAG 34158230
.X225602 ANOP                                                   XL03130 34166730
         SPACE                                                          34175030
SETBLKS  XC    ECB(L4),ECB              ZERO ECB                        34200020
         XC    IOBSENS0(L2),IOBSENS0    ZERO SENSE BYTES                34300020
         XC    IOBCSW(L7),IOBCSW        ZERO LOW ORDER BYTES OF IOB CSW 34400020
         BR    EIGHT                    RETURN                          34500020
BEGIN    MVC   RECNUMB(L1),NUMBERR+D1   MOVE IN NUMBER OF ERROR RECORDS 34600020
         L     PARMB,PNTSNAP            GET SNAP LIST POINTER   YL02912 34610002
         LTR   PARMB,PARMB              SNAP MODE               YL02912 34620002
         BZ    NOSNAP                   NO - DONT SNAP          YL02912 34630002
         SNAP  ID=7,MF=(E,(1))          SNAP                    YL02912 34640002
NOSNAP   EQU   *                        *                       YL02912 34650002
         TM    SWITCH,ENQSW             HAS ENQUEUE BEEN ISSUED         34700020
         BZ    NODEQ                    NO. DEQUEUE NOT REQUIRED        34800020
*********************************************************************** 34850002
         SPACE                                                          34900020
* THIS SECTION DEQUES FROM THE VTOC                                     35000020
*********************************************************************** 35050002
DEEQ     EQU   *                                                        35100020
         MVI   DEQAREA,FFSW             SET LAST ENTRY CODE             35200020
         SR    PARMB,PARMB              CLEAR OPTION                    35300020
         STH   PARMB,DEQAREA+D2                                         35400020
REGDEQ   DEQ   (MJELNAME,MIELNAME,6,SYSTEMS),MF=(E,DEQAREA)             35500020
*********************************************************************** 35520002
*        FREE CORE FOR LARGEST RECORD                                   35540002
*********************************************************************** 35560002
NODEQ    OC    RECADDR(L4),RECADDR      DOES CORE FOR LARGEST RECORD    35600020
*                                          HAVE TO BE FREED             35700020
         BZ    NEXTCORE                 NO, CORE HAS BEEN FREED         35800020
         L     WORKE,RECCORE            NUMBER OF BYTES TO BE   YL02912 35900002
*                                          FREED                        36000020
         L     PARMB,RECADDR            LOAD POINTER TO CORE TO BE      36100020
*                                          FREED                        36200020
         FREEMAIN R,LV=(2),A=(1),SP=229                         YL02912 36300002
*********************************************************************** 36320002
*        FREE CORE FOR COUNT FIELDS                                     36340002
*********************************************************************** 36360002
NEXTCORE OC    COREADDR(L4),COREADDR    DOES CORE FOR COUNT FIELDS HAVE 36400020
*                                          TO BE FREED                  36500020
         BZ    FREEMAIN                 NO, CORE HAS BEEN FREED         36600020
         L     WORKE,CNTCORE            NUMBER OF BYTES TO BE   YL02912 36700002
*                                          FREED                        36800020
         L     PARMB,COREADDR           LOAD POINTER TO CORE TO BE      36900020
*                                          FREED                        37000020
         FREEMAIN R,LV=(2),A=(1),SP=229                         YL02912 37100002
*********************************************************************** 37120002
*        FREE MAIN WORK AREA                                            37140002
*********************************************************************** 37160002
FREEMAIN LR    PARMB,AREAREG            LOAD POINTER TO CORE TO BE      37200020
*                                          FREED                        37300020
         L     RETREG,REGHOLD           SET RETURN              YM3004  37350002
         L     FIVE,RECNUMB             LOAD RETURN PARAMETER LIST      37400020
         FREEMAIN R,LV=688,A=(1),SP=229                         YL02912 37500002
*                                          NUMBERS                      37600020
         LR    PARMA,FIVE               RETURN PARAMETER LIST IN R0     37700020
         LR    ADDREG,FOUR              SET FINAL COMPLETION CODE       37800020
         MODESET  EXTKEY=SUPR           KEY 0                   YL02912 37850002
         BR    RETREG                   RETURN                  YL02912 38000002
*********************************************************************** 38050002
CCWONE   CCW   X'19',0,X'40',5          WRITE HOME ADDRESS              38100020
CCWTWO   CCW   X'15',0,X'40',16         WRITE RECORD ZERO        S21040 38200021
CCWTHREE CCW   X'1A',0,X'50',5          READ HOME ADDRESS               38300020
CCWFOUR  CCW   X'16',0,X'10',16         READ RECORD ZERO         S21040 38400021
CCWFIVE  CCW   X'31',0,X'40',5          SID - FORMAT 4 DSCB             38500020
CCWSIX   CCW   X'08',0,X'40',0          TIC                             38600020
CCWSEVEN CCW   X'05',0,X'40',96         WRITE DATA OF F4 DSCB           38700020
CCWEIGHT CCW   X'06',0,X'10',96         READ DATA OF F4 DSCB            38800020
*********************************************************************** 38850002
VTOCNAME DC    CL8'SYSVTOC'             VTOC NAME FOR ENQUEUE AND       38900020
*                                          DEQUEUE                      39000020
CYLNO    DC    X'05'                    NUMBER OF CYLINDERS PER TRACK   39100020
*                                          FOR A 2321                   39200020
STRIPNO  DC    X'0A'                    NUMBER OF STRIPS PER SUBCELL    39300020
*                                          FOR A 2321                   39400020
FULL8    DC    F'8'                     *                               39500020
HALF48   DC    H'48'                    *                               39600020
HALF16   DC    H'16'                    *                               39700020
HALF40   DC    H'40'                    *                               39800020
MAINT    DC    2CL25'IGG086AE MAINTENANCE AREA'                 YL02912 39850002
         ORG   IGG086AE+1021            FIRST AND ONLY ORG              39900020
END      DS    CL3'END'                 THE END                         40000020
*********************************************************************** 40050002
WORKDSCT DSECT                                                          40100020
SVRBEX   DS    1F                       SAVE AREA FOR SVRB EXTENSION    40200020
*                                          POINTER                      40300020
DEVTAB   DS    1F                       DEVICE TYPE INDICATOR FROM UCB  40400020
SWITCH   DS    CL1                      LOGIC SWITCH                    40500020
*                                       0 BIT INDICATES CHANNEL         40600020
*                                          PROGRAM NOT RE-EXECUTABLE    40700020
*                                       1 BIT INDICATES WRITE SPECIAL   40800020
*                                          REQUIRED                     40900020
*                                       2 BIT INDICATES TRACK OVERFLOW  41000020
*                                          DATA SET                     41100020
*                                       3 BIT INDICATES ENQUEUE WAS     41200020
*                                          WITH STEP MUST COMPLETE      41300020
*                                       4 BIT INDICATES NO ALTERNATES   41400020
*                                          AVAILABLE                    41500020
*                                       6 BIT INDICATES AN ERROR ON     41600020
*                                          OTHER THAN THE ORIGINAL      41700020
*                                          ERROR RECORD                 41800020
*                                       7 BIT INDICATES VTOC HAS BEEN   41900020
*                                          ENQUEUED UPON                42000020
NUMBERR  DS    CL2                      NUMBER OF ERROR RECORDS         42100020
VTOCADR  DS    CL5                      VTOC ADDRESS CCHHR              42200020
SPLIT    DS    X'00'                    SPLIT CYLINDER SWITCH           42300020
RETPT    DS    1F                       POINTER TO NEXT ROUTINE         42400020
*********************************************************************** 42450002
         DS    0F                                                       42500020
         IECSDSL1 (4)                                                   42600020
*********************************************************************** 42650002
TICADDR  DS    1F                       ADDRESS OF TIC CCW IN NEW       42700020
*                                          CHANNEL PROGRAM              42800020
SAVEADDR DS    1F                       ADDRESS OF FIRST COUNT FIELD    42900020
CNTCORE  DS    1F                       NUMBER OF BYTES IN COUNT FIELD  43000020
*                                          WORK AREA                    43100020
COREADDR DS    1F                       ADDRESS OF COUNT FIELD          43200020
*                                          WORK AREA                    43300020
RECADDR  DS    1F                       ADDRESS OF CORE GOTTEN FOR      43400020
*                                          LONGEST RECORD SIZE          43500020
RECCORE  DS    1F                       NUMBER OF BYTES IN THIS AREA    43600020
DDNAME   DS    1D                       DDNAME SAVE AREA        XL03130 43650003
DEVINFO  DS    5F                      DEVICE INFO              XL03130 43660003
PARMUSER DS    1F                       POINTER USER PARM LIST  YL02912 43665002
PNTEST   DS    1F                       TEST MODE               YL02912 43665302
PNTSNAP  DS    1F                       SNAP MODE               YL02912 43665602
PNTSNS   DS    CL2                      SENSE BYTE - USER       YL02912 43666002
         DS    CL1                      FILLER                  YL02912 43667002
PNTMIOB  DS    CL1                      M OF IOB                YL02912 43668002
PNTIOB   DS    1F                       IOB POINTER             YL02912 43670002
PNTCNT   DS    1F                       COUNT POINTER           YL02912 43675002
PARMCNT  DS    2F                       COUNTS                  YL02912 43680002
PNTIOT   DS    CL2                      TIOT OFFSET             YL02912 43681002
         DS    CL1                      FILLER                  YL02912 43682002
PNTOFLO  DS    CL1                      TRACK OVERFLO           YL02912 43683002
PNTDEB   DS    1F                       DEB POINTER             YL02912 43684002
HOLDKEY  DS    1F                       USER KEY                YL02912 43685002
REGHOLD  DS    1F                       TEMP REG SAVE           YL02912 43690002
CNTADDR  DS    1F                       ADDRESS OF COUNT FIELD FOR      43700020
*                                          CCW IN ERROR                 43800020
ERRTYPE  DS    CL1                      TYPE OF ORIGINAL ERROR          43900020
RECNUMB  DS    1F                       R OF ERROR RECORDS              44000020
REGSAVE  DS    5F                       SAVE AREA FOR REGISTERS         44100020
*********************************************************************** 44150002
ECB      DS    1F                       ECB                             44200020
IOB      DS    8F                       IOB                             44300020
CSW      EQU   12                                                       44400020
IOBSENS0 EQU   IOB+2                                                    44500020
IOBFLAG3 EQU   IOB+8                                                    44600020
IOBCSW   EQU   IOB+9                                                    44700020
IOBCSWST EQU   IOB+12                                                   44800020
IOBSTART EQU   IOB+16                                                   44900020
SEEK     DS    2F                       SEEK ADDRESS                    45000020
DEB      DS    12F                      DEB                             45100020
DEBSTRCC EQU   DEB+38                                                   45200020
DEBENDCC EQU   DEB+42                                                   45300020
DEBPTR   DS    F                        DCB SLOT                        45400020
MIELNAME DS    CL6                      VOLUME SERIAL SLOT              45500020
DCB      EQU   DEBPTR-44                                                45600020
R0AREA   DS    2D                       AREA FOR R0                     45700020
DEQAREA  DS    2D                       DEQ TABLE AREA                  45800020
MJELNAME DS    2F                       MAJOR QUEUE NAME AREA           45900020
ENQAREA  DS    2D                       ENQ TABLE AREA                  46000020
USERPARM DS    1F                       POINTER TO USER'S PARM LIST     46100020
NUMALT   DS    1H                       NUMBER OF ALTERNATES TO BE      46200020
*                                          TRIED                        46300020
MAXCOUNT DS    1H                       MAXIMUM NUMBER OF COUNT FIELDS  46400020
*                                          PER TRACK+1                  46500020
XCTLPTR  DS    2F                       PTR TO XCTL WORK AREA TABLE     46600020
XCTLAREA DS    0CL32                                                    46700020
XCTLNM   DS    CL6                      COMMON BYTES OF ATLAS NAME      46800020
XCTLID   DS    CL2                      ID OF ATLAS MODULE              46900020
         DS    CL6                      *                               47000020
TTR      DS    CL3                      TTR OF ATLAS MODULE             47100020
         DS    CL5                      *                               47200020
TTRATTB  DS    CL2                      ATTRIBUTES OF ATLAS - ALL LOADS 47300020
TTRCREQ  DS    CL3                      CORE REQUIREMENT OF ATLAS LOAD  47400020
TTRLNGTH DS    CL2                      LENGTH OF ATLAS LOAD            47500020
         DS    CL3                      *                               47600020
INCRMNT  DS    1F                       INCREMENT FOR READ COUNTS       47700020
PROGADDR DS    1F                       ADDRESS OF NEW CHANNEL PROGRAM  47800020
ALTHA    DS    2F                       ALTERNATE TRACK HOME ADDRESS    47900020
ALTR0    DS    4F                       ALTERNATE TRACK R0              48000020
*********************************************************************** 48050002
CCW1     DS    1D                       CCW AREA                        48100020
CCW2     DS    1D                       *                               48200020
CCW3     DS    1D                       *                               48300020
CCW44    DS    1D                       *                               48400020
CCW45    DS    1D                       *                               48500020
CCW56    DS    1D                       *                               48600020
CCW57    DS    1D                       *                               48700020
CCW31    DS    1D                       *                               48800020
CCW32    DS    1D                       *                               48900020
CCW33    DS    1D                       *                               49000020
CCW34    DS    1D                       *                               49100020
CCW35    DS    1D                       *                               49200020
CCW36    DS    1D                       *                               49300020
CCW37    DS    1D                       *                               49400020
CCW38    DS    1D                       *                               49500020
CCW39    DS    1D                       *                               49600020
CHECKHA  DS    2F                       AREA FOR HOME ADDRESS OF        49700020
*                                       ALTERNATE                       49800020
*                                                                       49900020
*********************************************************************** 49930002
*********************************************************************** 49960002
CVT      DSECT                                                          50000020
*********************************************************************** 50050002
UCB      DSECT                                                          50100020
SDAREA   DSECT                                                          50150003
*********************************************************************** 50150102
REGSAV   DS    7F                       REGISTER SAVE AREA      REFIX   50160003
SDCCW1   DS    D                        READ HA                 REFIX   50170003
SDCCW2   DS    D                        SENSE CCW               REFIX   50180003
SENSA    DS    3D                       AREA FOR SENSE          REFIX   50190003
MADSDB   EQU   SENSA+18                3350 SIX SD BYTES       @Z30RSAG 50190430
SDBYTES  EQU   SENSA+D22                SKIP DISPL BYTES        REFIX   50192003
SDEND    DS    0F                       END                     REFIX   50194003
SDARSZ   EQU   SDEND-SDAREA             SIZE OF AREA            REFIX   50196003
CNTAREA  DSECT                                                          50200020
         DS    F                       FOR DBL WD ALGNMT.      @ZM40498 50210030
MADSD    DS    CL4                     FIRST TWO 3350 SD BYTES @Z30RSAG 50250030
HOMEAD   DS    2F                       CCW AREA                        50300020
R0       DS    4F                       *                               50400020
CCW21    DS    2F                       *                               50500020
CCW22    DS    2F                       *                               50600020
CCW23    DS    2F                       *                               50700020
         END                                                            50800020
./  ADD  SSI=53280940,NAME=IGG0860A
         TITLE 'IGG0860A - SECOND LOAD MODULE FOR SVC 86'        S20201 00200020
         COPY  LCGASMSW                                                 00250003
IGG0860A CSECT                                                          00400020
*                                                               YM3064  00600002
*A 467000                              FIX MVS 0C4.            @ZM42073 00610030
*                                                               YM3004  00650002
* FIX BAD HA/R0 MSG.                                           @ZM40498 00700030
*                                                                       00800020
*          RELEASE 22 DELETIONS/CHANGES                                 01000020
*          RELEASE 21 DELETIONS/CHANGES                                 01200020
*          RELEASE 20 DELETIONS/CHANGES                                 01400020
*0791002000-004000                                               S20201 01500020
*                                                                       01600020
*STATUS CHANGE LEVEL 002                                                01800020
*                                                                       02000020
*TITLE 'IGG0860A' - SECOND LOAD MODULE OF SVC 86                      * 02200020
*                                                                     * 02400020
*FUNCTION/OPERATION                                                     02600020
*   IGG0860A, THE SECOND LOAD MODULE OF SVC 86 ESTABLISHES ITS OWN    * 02800020
*ADDRESSABILITY, THAT OF THE 688-BYTE WORK AREA GOTTEN BY IGC0008F,   * 03000020
*AND THAT OF A WORK AREA WHICH IT GETS.  ITS FIRST FUNCTION IS TO     * 03200020
*EXECUTE A CHANNEL PROGRAM TO READ THE FORMAT 4 DSCB AND PICK UP THE  * 03400020
*NUMBER OF ALTERNATES AVAILABLE.  IN ADDITION THIS MODULE ALSO WILL   * 03600020
*COMPUTE THE AMOUNT OF CORE NEEDED TO BUILD A CHANNEL PROGRAM TO READ * 03800020
*HOME ADDRESS, R0, AND THE MAXIMUM NUMBER OF COUNT FIELDS PER TRACK   * 04000020
*+1.  IT GETS ADDITIONAL CORE TO CONTAIN HOME ADDRESS, R0, AND THE    * 04200020
*COUNT FIELDS.  SECOND, IT GENERATES THE CHANNEL PROGRAM.             * 04400020
*                                                                     * 04600020
*ENTRY POINT                                                          * 04800020
*   IGG0860A PICKS UP THE MAXIMUM NUMBER OF COUNT FIELDS PER TRACK    * 05000020
*FROM INFORMATION OBTAINED BY IGC0008F.                               * 05200020
*                                                                     * 05400020
*INPUT                                                                * 05600020
*   CONSISTS OF THE 688-BYTE WORK AREA SET UP BY IGC0008F.            * 05800020
*                                                                     * 06000020
*OUTPUT                                                               * 06200020
*     CONSISTS OF THE WORK AREA AND THE FOLLOWING RETURN CODES        * 06400020
*                                                                       06600020
*                                                                     * 06800020
*         8 - ALL ALTERNATES ASSIGNED                                 * 07000020
*        12 - CORE NOT AVAILABLE                                      * 07200020
*        24 - FORMAT 4 IN ERROR                                       * 07400020
*        28 - USER'S RECORD IS FORMAT4                                * 07600020
*                                                                     * 07800020
*EXTERNAL ROUTINES                                                    * 08000020
*    NONE                                                             * 08200020
*                                                                     * 08400020
*EXITS                                                                * 08600020
*   ERROR - TRANSFERS CONTROL VIA XCTL TO IGG086AE WITH A RETURN      * 08800020
*           CODE IN REGISTER 4.                                       * 09000020
*   NORMAL - TRANSFERS CONTROL VIA XCTL TO IGG0860B                   * 09200020
*                                                                     * 09400020
*TABLES/WORK AREAS                                                    * 09600020
*   THERE ARE TWO WORK AREAS AS FOLLOW                                * 09800020
*                                                                     * 10000020
*        1.  A 688-BYTE WORK AREA INCLUDING THE FORMAT 4 DSCB,        * 10200020
*            MAXIMUM NUMBER OF COUNT FIELDS PER TRACK + 1, A POINTER  * 10400020
*            TO THE USER'S PARAMETER LIST, THE ECB, IOB, DEB, AND     * 10600020
*            DCB CONSTRUCTED BY IGC0008F, A POINTER TO THE COUNT      * 10800020
*            FIELD WORK AREA, AND AN INDICATION OF THE ORIGINAL       * 11000020
*            ERROR TYPE.                                              * 11200020
*        2.  A CHANNEL PROGRAM TO READ HOME ADDRESS AND/OR RECORD     * 11400020
*            ZERO AND COUNTS.  IT ALSO INCLUDES THE SPACE INTO WHICH  * 11600020
*            THE INFORMATION WILL BE READ.                            * 11800020
*                                                                     * 12000020
*ATTRIBUTES                                                           * 12200020
*   REENTRANT, REFRESHABLE                                            * 12400020
*                                                                     * 12600020
*                                                                       12800020
*                                                                       13000020
*********************************************************************** 13200020
*                                                                     * 13400020
*                               EQUATES                               * 13600020
*                                                                     * 13800020
*********************************************************************** 14000020
BIT1     EQU   X'40'                                                    14200020
*********************************************************************** 14400020
*          COMPLETION CODES                                           * 14600020
*********************************************************************** 14800020
CC8      EQU   8                        NO ALTERNATES AVAILABLE         15000020
CC12     EQU   12                       CORE NOT AVAILABLE              15200020
CC24     EQU   24                       ERROR READING FORMAT4 DSCB      15400020
CC28     EQU   28                       FORMAT4 DSCB IN ERROR           15600020
*********************************************************************** 15800020
*          DISPLACEMENT CONSTANTS                                     * 16000020
*********************************************************************** 16200020
D0       EQU   0                                                        16400020
D1       EQU   1                                                        16600020
D2       EQU   2                                                        16800020
D3       EQU   3                                                        17000020
D4       EQU   4                                                        17200020
D7       EQU   7                                                        17400020
D8       EQU   8                                                        17600020
D48      EQU   48                                                       17800020
D255     EQU   255                                                      18000020
*********************************************************************** 18200020
*          LENGTH CONSTANTS                                           * 18400020
*********************************************************************** 18600020
L2       EQU   2                                                        18800020
L3       EQU   3                                                        19000020
L4       EQU   4                                                        19200020
L5       EQU   5                                                        19400020
L8       EQU   8                                                        19600020
L16      EQU   16                                                       19800020
*********************************************************************** 20000020
*                                                                     * 20200020
*********************************************************************** 20400020
BITS3    EQU   3                                                        20600020
BITS4    EQU   4                                                        20800020
CCOFF    EQU   X'00'                    COMMAND CHAIN OFF               21000020
DOG8     EQU   X'D8'                                                    21200020
ENQSW    EQU   X'01'                    ENQUEUE SWITCH                  21400020
FFSW     EQU   X'FF'                                                    21600020
IOEROR   EQU   X'20'                                                    21800020
ONEXT    EQU   X'01'                    ONE EXTENT                      22000020
R0ERR    EQU   X'01'                    R0 ERROR SWITCH                 22200020
TWO55    EQU   255                                                      22400020
X0       EQU   0                                                        22600020
ZEROS    EQU   X'00'                                                    22800020
*                                                                       23000020
*                                                                       23200020
         EJECT                                                          23400020
*********************************************************************** 23500002
* REGISTER ASSIGNMENTS                                                  23600020
*********************************************************************** 23700002
PARMA    EQU   0                        PARAMETER REGISTER              23800020
PARMB    EQU   1                        PARAMETER REGISTER              24000020
WORKE    EQU   2                        EVEN WORK REGISTER              24200020
WORKO    EQU   3                        ODD WORK REGISTER               24400020
FOUR     EQU   4                        RETURN CODE REGISTER            24600020
FIVE     EQU   5                        WORK REGISTER                   24800020
SIX      EQU   6                        *                               25000020
SEVEN    EQU   7                        *                               25200020
EIGHT    EQU   8                        *                               25400020
NINE     EQU   9                        *                               25600020
TEN      EQU   10                       *                               25800020
AREAREG  EQU   11                       MAIN WORK AREA REGISTER         26000020
BASEREG  EQU   12                       BASE REGISTER                   26200020
SAVEREG  EQU   13                       WORK REGISTER                   26400020
RETREG   EQU   14                       WORK REGISTER                   26600020
ADDREG   EQU   15                       COMPLETION CODE REGISTER        26800020
*********************************************************************** 26900002
         SPACE                                                          27000020
         BALR  BASEREG,X0               ESTABLISH OWN                   27200020
         USING BEGIN,BASEREG               ADDRESSABILITY               27400020
         USING WORKDSCT,AREAREG         ESTABLISH ADDRESSABILITY FOR    27600020
*                                       WORK AREA                       27800020
*                                                                       28000020
*********************************************************************** 28100002
* ROUTINE TO ENQUEUE THE VTOC ON THIS VOLUME                            28200020
*********************************************************************** 28300002
*                                                                       28400020
BEGIN    MVC   MJELNAME(L8),VTOCNAME    MOVE MAJOR QUE NAME TO WORKAREA 28600020
         MVI   ENQAREA,FFSW             SET LAST ENTRY CODE             28800020
         L     SIX,DEBDVMOD             RELOAD                          29000020
         SR    PARMB,PARMB              CLEAR CODE AND RETURN FIELDS    29200020
         STH   PARMB,ENQAREA+D2                                         29400020
*                                                                       29600020
         RESERVE (MJELNAME,MIELNAME,E,6,SYSTEMS),RET=HAVE,             *29800020
               MF=(E,ENQAREA),UCB=DEB+32                                30000020
         OI    SWITCH,ENQSW             ENQUEUE HAS BEEN EXECUTED       30200020
         EJECT                                                          30400020
*                                                                       30600020
*                                                                       30800020
*********************************************************************** 30900002
* THIS SECTION READS IN THE DATA PORTION OF THE FORMAT 4 DSCB.          31000020
*********************************************************************** 31100002
*                                                                       31200020
         EXCP  IOB                      READ FORMAT 4 DSCB              31400020
         WAIT  1,ECB=ECB                WAIT FOR I/O COMPLETE           31600020
         TM    ECB,IOEROR               CHECK FOR PERMANENT I/OERROR    31800020
         BO    CKALT                    NO, SUCCESSFUL COMPLETION       32000020
*                                                                       32200020
*********************************************************************** 32300002
* THIS SECTION ANALYZES THE ERROR IN THE FORMAT4 DSCB READ CHANNEL      32400020
* PROGRAM                                                               32600020
*********************************************************************** 32700002
         L     FOUR,USERPARM                                            32800020
         TM    D4(FOUR),BIT1            WAS FULL COUNT SPECIFIED        33000020
         BO    ERR24                    NO,SET RETURN CODE              33200020
         L     FOUR,D4(X0,FOUR)         GET POINTER TO COUNT FIELD      33400020
         CLC   VTOCADR(L5),D0(FOUR)     CHECK FOR USER'S RFCORD IN      33600020
*                                          ERROR BEING FORMAT 4         33800020
         BE    SETCODE                  YES, FORMAT 4 IS USER'S         34000020
*                                          RECORD                       34200020
*********************************************************************** 34300002
ERR24    EQU   *                                                        34400020
         LA    FOUR,CC24                SET RETURN CODF - FORMAT 4 IN   34600020
         B     BADCASE                     ERROR                        34800020
SETCODE  LA    FOUR,CC28                SET RETURN CODE FOR RECORD IN   35000020
*                                          ERROR BEING FORMAT 4         35200020
         B     BADCASE                  GO TO ERROR LOAD                35400020
*********************************************************************** 35500002
* THIS SECTION CHECKS FOR AVAILABLE ALTERNATES AND PICKS UP THE NUMBER  35600020
* OF AVAILABLE ALTERNATES AND THE ADDRESS OF THE NEXT AVAILABLE ONE     35800020
*********************************************************************** 35900002
CKALT    MVI   DEBNMTRK,ZEROS           SET NUMBER OF TRACKS IN DEB     36000020
         MVI   DEBNMTRK+D1,ONEXT           EXTENT TO ONE                36200020
         MVI   DEBDVMOD,DOG8            SET DEB MASK TO ALLOW ALL       36400020
*                                          WRITES BUT INHIBIT ALL SEEKS 36600020
         OC    DS4NOATK(L2),DS4NOATK    CHECK FOR ANY ALTERNATES        36800020
         BNZ   PICKLESS                 YES ALTERNATE TRACKS AVAILABLE  37000020
         LA    FOUR,CC8                 SET COMPLETION CODE FOR NO      37200020
*                                          ALTERNATE TRACKS AVAILABLE   37400020
         B     BADCASE                  GO TO ERROR LOAD                37600020
PICKLESS CLC   DS4NOATK(L2),NUMALT      LESS ALTERNATES THAN 10         37800020
*                                          PER CENT                     38000020
         BNL   FIRST                    NO,MORE ALTERNATES THAN 10      38200020
*                                          PER CENT                     38400020
         MVC   NUMALT(L2),DS4NOATK      USE NUMBER AVAILABLE            38600020
*********************************************************************** 38700002
* THIS SECTION CALCULATES CORE REQUIREMENTS FOR A CHANNEL PROGRAM TO    38800020
* READ COUNT FIELDS AND THEN ISSUES A CONDITIONAL GETMAIN               39000020
*********************************************************************** 39100002
*                                                                       39200020
FIRST    EQU   *                                                YM3004  39400002
         LH    WORKO,MAXCOUNT           PICK UP MAXIMUM NUMBER OF       39600020
*                                          COUNT FIELDS PER TRACK+1     39800020
         SLL   WORKO,BITS4              MULTIPLY BY 16                  40000020
         LA    WORKO,CNTSIZE(X0,WORKO)  ADD FOR READING        @X50RSAG 40200030
*                                          HOME ADDRESS AND R0 AND A    40400020
*                                          FLAG FIELD                   40600020
*********************************************************************** 41650002
         MODESET EXTKEY=DATAMGT         KEY 5                   YL02912 41700002
*********************************************************************** 41750002
         GETMAIN R,LV=(WORKO),SP=229                            YM3004  42000002
         LTR   ADDREG,ADDREG            CHECK FOR GOTTEN CORE           42100002
         BZ    GOTCORE                  YES, CORE GOTTEN                42600020
*********************************************************************** 42650002
*        GET OUT                                                YL02912 42700002
*********************************************************************** 42750002
         LA    FOUR,CC12                SET RETURN CODE TO 12 FOR       42800020
*                                          CORE NOT AVAILABLE           43000020
BADCASE  MVC   XCTLID(L2),ATLAS06       MOVE ERROR LOAD NAME IN         43200020
         MVC   TTR(L3),TTR6             MOVE ERROR LOAD TTR IN          43400020
         SPACE                                                          43600020
GETOUT   XC    XCTLPTR+D4(L4),XCTLPTR+D4   CLEAR SECOND WORD OF POINTER 43800020
         L     PARMB,PNTSNAP            GET SNAP LIST POINTER   YL02912 43830002
         LTR   PARMB,PARMB              SNAP MODE               YL02912 43860002
         BZ    NOSNAP                   NO - DONT SNAP          YL02912 43890002
         SNAP  ID=3,MF=(E,(1))          SNAP                    YL02912 43920002
NOSNAP   EQU   *                        *                       YL02912 43950002
         XCTL  ,MF=(E,(1)),SF=(E,XCTLPTR)                               44000020
*********************************************************************** 44100002
         SPACE                                                          44200020
GOTCORE  EQU   *                                                YM3004  44260002
*********************************************************************** 44270002
         MODESET EXTKEY=SUPR            KEY 0                   YM3004  44300002
*********************************************************************** 44350002
         ST    PARMB,SVRBEX             STORE WORK AREA ADDR    YM3004  44360002
*********************************************************************** 44370002
         MODESET EXTKEY=DATAMGT         KEY 5                   YM3004  44380002
*********************************************************************** 44390002
         LR    TEN,PARMB                LOAD ADDR OF WORK AREA  YM3004  44400002
         USING CNTAREA,TEN              ESTABLISH ADDRESSABILITY TO     44600020
*                                          COUNT FIELD WORK AREA        44800020
         ST    WORKO,CNTCORE            SAVE NUMBER BYTES IN COUNT      45000020
*                                          FIELD WORK AREA              45200020
         ST    TEN,COREADDR             SAVE ADDRESS OF THIS AREA       45400020
         LR    FIVE,WORKO                                               45600020
*********************************************************************** 45700002
         SPACE                                                          45800020
* THIS SECTION CLEARS THE COUNT FIELD WORK AREA TO ZEROES               46000020
*********************************************************************** 46100002
         L     PARMB,USERPARM           PICK UP ADDRESS OF USER'S       46200020
*                                          PARAMETER LIST               46400020
         LR    SEVEN,TEN                                                46600020
         MVI   D0(SEVEN),FFSW           MOVE HEX FF TO BUFFER   YM3064  46650002
         BCTR  WORKO,X0                DECRE FOR INIT BYTE     @ZM42073 46700030
CLRCORE  LA    SIX,TWO55                                                46800020
         CR    SIX,WORKO                ARE THERE MORE THAN 255 BYTES   47000020
         BH    LESS255                  NO, BRANCH TO ZERO REMAINING    47200020
*                                          BYTES                        47400020
         BCTR  SIX,X0                   DECREMENT LENGTH BY 1 FOR       47600020
*                                          EXECUTE INSTRUCTION          47800020
         EX    SIX,CLEARS               EXECUTE INSTRUCTION TO CLEAR    48000020
*                                          255 BYTES OF WORK AREA       48200020
         S     WORKO,FULL255            SUBTRACT 255 TO GET REMAINING   48400020
*                                          NUMBER BYTES                 48600020
         LA    SEVEN,D255(X0,SEVEN)     UPDATE POINTER TO AREA          48800020
         B     CLRCORE                  RETURN TO CLEAR CORE            49000020
CLEARS   MVC   D1(X0,SEVEN),D0(SEVEN)                            YM3064 49200002
LESS255  LTR   WORKO,WORKO              DO ANY UNCLEARED BYTES REMAIN   49400020
         BZ    GETRK                    NO, GET ADDR OF TRACK IN ERROR  49600020
         BCTR  WORKO,X0                 DECREMENT LENGTH BY 1 FOR       49800020
*                                          EXECUTE INSTRUCTION          50000020
         EX    WORKO,CLEARS             CLEAR REMAINING BYTES           50200020
*********************************************************************** 50250002
*        GET TRACK INFORMATION                                  YL02912 50300002
*********************************************************************** 50350002
         SPACE                                                          50400020
GETRK    S     FIVE,FULL8               COMPUTE POINTER TO LAST COUNT   50600020
         ALR   FIVE,TEN                    FIELD                        50800020
         MVI   D0(FIVE),FFSW            SET FLAG FOR END OF COUNTS      51000020
         L     FIVE,D4(X0,PARMB)        PICK UP ADDRESS OF USER'S CCHH  51200020
         MVC   DEBSTRCC(L4),D0(FIVE)    INSERT CYLINDER AND TRACK       51400020
         MVC   DEBENDCC(L4),D0(FIVE)       ADDRESS FOR SINGLE TRACK     51600020
*                                          EXTENT                       51800020
         TM    D4(PARMB),BIT1           WAS ONLY CCHH SPECIFIED         52000020
         BZ    SEEKMV                   NO,MOVE IN FULL COUNT           52200020
         MVC   SEEK+D3(L4),D0(FIVE)     MOVE CCHH TO SEEK ADDRESS       52400020
         B     GENCOM                   GENERATE READ HA AND READ R0    52600020
*********************************************************************** 52700002
SEEKMV   MVC   SEEK+D3(L5),D0(FIVE)     MOVE CCHHR TO SEEK ADDRESS      52800020
*                                          COUNT                        53000020
         CLI   SEEK+D7,ZEROS            IS ERROR RECORD R0              53200020
         BNE   GENCOM                   NO, GENERATE READ HA AND        53400020
*                                          READ R0                      53600020
         LTR   FIVE,FIVE                WAS THE UTILITY THE CALLER      53800020
         BP    GENCOM                   NO,GENERATE READ HA AND READ R0 54000020
         MVI   ERRTYPE,R0ERR            SET SWITCH TO INDICATE ERROR    54200020
*                                          RECORD IS R0 AND THE UTILITY 54400020
*                                          IS THE CALLER                54600020
*********************************************************************** 54700002
         SPACE                                                          54800020
* THIS SECTION RELOCATES THE READ HOME ADDRESS AND READ RECORD ZERO     55000020
* COMMANDS IN THE WORK AREA                                             55200020
*********************************************************************** 55300002
GENCOM   LM    SIX,NINE,CCWRHA          LOAD READ HOME ADDRESS AND      55400020
         ALR   SIX,TEN                     READ R0 CCW'S                55600020
         ALR   EIGHT,TEN                                                55800020
         STM   SIX,NINE,CCW21           STORE IN WORK AREA              56000020
         LA    SIX,CCW21                PUT CHANNEL PROGRAM POINTER     56200020
         ST    SIX,IOBSTART                INTO IOB                     56400020
*********************************************************************** 56500002
         SPACE                                                          56600020
* THIS SECTION GENERATES READ COUNT COMMANDS FOR THE MAXIMUM NUMBER OF  56800020
* COUNT FIELDS ON A TRACK                                               57000020
*********************************************************************** 57100002
GENCOUNT LH    NINE,MAXCOUNT            PICK UP MAXIMUM NUMBER COUNT    57200020
*                                          FIELDS                       57400020
         LR    FIVE,NINE                SET UP COUNTER                  57600020
         LA    SIX,CCW23                PICK UP ADDRESS OF FIRST READ   57800020
*                                          COUNT CCW                    58000020
         SLL   NINE,BITS3               MULTIPLY NUMBER FIELDS BY 8     58200020
         ALR   NINE,SIX                 GET ADDRESS OF FIRST SLOT FOR   58400020
*                                          COUNT                        58600020
         ST    NINE,SAVEADDR            SAVE COUNT FIELD ADDRESS        58800020
         LM    SEVEN,EIGHT,CCWRC        LOAD READ COUNT CCW             59000020
         ALR   SEVEN,NINE               INSERT DATA ADDRESS             59200020
GENPROG  STM   SEVEN,EIGHT,D0(SIX)      STORE CCW IN WORK AREA          59400020
         LA    SIX,D8(X0,SIX)           UPDATE ADDRESS FOR CCW          59600020
         A     SEVEN,FULL8              UPDATE DATA ADDRESS             59800020
         BCT   FIVE,GENPROG             IF COUNTER DOES NOT EQUAL ZERO  60000020
*                                          GENERATE ANOTHER READ COUNT  60200020
         S     SIX,FULL4                                                60400020
         MVI   D0(SIX),CCOFF            TURN OFF CHAIN COMMAND FLAG     60600020
         SPACE                                                          60800020
         MVC   XCTLID(L2),ATLAS03       MOVE NEXT LOAD NAME IN          61000020
         MVC   TTR(L3),TTR3             MOVE NEXT LOAD TTR IN           61200020
         B     GETOUT                   XCTL TO NEXT LOAD               61400020
*********************************************************************** 61500002
         SPACE                                                          61600020
GETL     GETMAIN  EC,MF=L               L FORM FOR COUNTS AND TRACK     61800020
VTOCNAME DC    CL8'SYSVTOC'             MAJOR QUE ELEMENT NAME          62000020
*                                          DESCRIPTOR CHANNEL PROGRAM   62200020
*********************************************************************** 62300002
CCWRHA   CCW   X'1A',HOMEAD-CNTAREA,X'40',5  READ HOME ADDRESS          62400020
CCWRR0   CCW   X'16',R0-CNTAREA,X'40',16  READ RECORD ZERO              62600020
CCWRC    CCW   X'92',0,X'40',8          READ COUNT                      62800020
*********************************************************************** 62900002
FULL255  DC    F'255'                   *                               63000020
FULL8    DC    F'8'                     *                               63200020
FULL4    DC    F'4'                     *                               63400020
MAINT    DC    1CL25'IGG0860A MAINTENANCE AREA'                 YL02912 63500002
*********************************************************************** 63550002
         SPACE                                                          63600020
*XCTL BY TTR TABLE                                                      63800020
*********************************************************************** 63900002
         SPACE                                                          64000020
         ORG   IGG0860A+1000            FIRST ORG                       64200020
         SPACE                                                          64400020
TTRTABLE EQU   *                                                        64600020
         SPACE                                                          64800020
ATLAS03  DC    C'0B'                    ID OF NEXT ATLAS LOAD           65000020
TTR3     DC    X'00000000'              TTR OF NEXT ATLAS LOAD          65200020
ATLAS06  DC    C'AE'                    ID OF ERROR LOAD                65400020
TTR6     DC    X'00000000'              TTR OF ERROR LOAD               65600020
         DC    X'0000'                  LAST TABLE ENTRY CODE           65800020
         ORG   IGG0860A+1020            SECOND ORG                      66000020
         DC    C'086'                   ATLAS SVC CODE                  66200020
         DC    X'7D'                    RELATIVE TABLE START ADDRESS    66400020
*                                          IN DOUBLE WORDS              66600020
*********************************************************************** 66700002
         SPACE                                                          66800020
         EJECT                                                          67000020
WORKDSCT DSECT                                                          67200020
SVRBEX   DS    1F                       SAVE AREA FOR SVRB EXTENSION    67400020
*                                          POINTER                      67600020
DEVTAB   DS    1F                       DEVICE TYPE INDICATOR FROM UCB  67800020
SWITCH   DS    CL1                      LOGIC SWITCH                    68000020
*                                       0 BIT INDICATES CHANNEL         68200020
*                                          PROGRAM NOT RE-EXECUTABLE    68400020
*                                       1 BIT INDICATES WRITE SPECIAL   68600020
*                                          REQUIRED                     68800020
*                                       2 BIT INDICATES TRACK OVERFLOW  69000020
*                                          DATA SET                     69200020
*                                       4 BIT INDICATES NO ALTERNATES   69400020
*                                          AVAILABLE                    69600020
*                                       6 BIT INDICATES AN ERROR ON     69800020
*                                          OTHER THAN THE ORIGINAL      70000020
*                                          ERROR RECORD                 70200020
*                                       7 BIT INDICATES VTOC HAS BEEN   70400020
*                                          ENQUEUED UPON                70600020
NUMBERR  DS    CL2                      NUMBER OF ERROR RECORDS         70800020
VTOCADR  DS    CL5                      VTOC ADDRESS CCHHR              71000020
SPLIT    DS    X'00'                    SPLIT CYLINDER SWITCH           71200020
RETPT    DS    1F                       POINTER TO NEXT ROUTINE         71400020
         DS    0F                                                       71600020
*********************************************************************** 71700002
         IECSDSL1 (4)                                                   71800020
*********************************************************************** 71900002
TICADDR  DS    1F                       ADDRESS OF TIC CCW IN NEW       72000020
*                                          CHANNEL PROGRAM              72200020
SAVEADDR DS    1F                       ADDRESS OF FIRST COUNT FIELD    72400020
CNTCORE  DS    1F                       NUMBER OF BYTES IN COUNT FIELD  72600020
*                                          WORK AREA                    72800020
COREADDR DS    1F                       ADDRESS OF COUNT FIELD          73000020
*                                          WORK AREA                    73200020
RECADDR  DS    1F                       ADDRESS OF CORE GOTTEN FOR      73400020
*                                          LONGEST RECORD SIZE          73600020
RECCORE  DS    1F                       NUMBER OF BYTES IN THIS AREA    73800020
DDNAME   DS    1D                      DDNAME SAVE AREA         XL03130 73850003
DEVINFO  DS    5F                      DEVICE INFO              XL03130 73900003
PARMUSER DS    1F                       POINTER USER PARM LIST  YL02912 73910002
PNTEST   DS    1F                       TEST MODE               YL02912 73910302
PNTSNAP  DS    1F                       SNAP MODE               YL02912 73910602
PNTSNS   DS    CL2                      SENSE BYTE - USER       YL02912 73911002
         DS    CL1                      FILLER                  YL02912 73912002
PNTMIOB  DS    CL1                      M OF IOB                YL02912 73913002
PNTIOB   DS    1F                       IOB POINTER             YL02912 73920002
PNTCNT   DS    1F                       COUNT POINTER           YL02912 73930002
PARMCNT  DS    2F                       COUNTS                  YL02912 73940002
PNTIOT   DS    CL2                      TIOT OFFSET             YL02912 73941002
         DS    CL1                      FILLER                  YL02912 73942002
PNTOFLO  DS    CL1                      TRACK OVERFLO           YL02912 73943002
PNTDEB   DS    1F                       DEB POINTER             YL02912 73944002
HOLDKEY  DS    1F                       USER KEY                YL02912 73950002
REGHOLD  DS    1F                       TEMP REG SAVE           YL02912 73960002
CNTADDR  DS    1F                       ADDRESS OF COUNT FIELD FOR      74000020
*                                          CCW IN ERROR                 74200020
ERRTYPE  DS    CL1                      TYPE OF ORIGINAL ERROR          74400020
RECNUMB  DS    1F                       R OF ERROR RECORDS              74600020
REGSAVE  DS    5F                       SAVE AREA FOR REGISTERS         74800020
*********************************************************************** 74900002
ECB      DS    1F                       ECB                             75000020
IOB      DS    8F                       IOB                             75200020
IOBSTART EQU   IOB+16                   ADDRESS OF CHANNEL PROGRAM      75400020
SEEK     DS    2F                       SEEK ADDRESS                    75600020
DEB      DS    12F                      DEB                             75800020
DEBSTRCC EQU   DEB+38                                                   76000020
DEBENDCC EQU   DEB+42                                                   76200020
DEBNMTRK EQU   DEB+46                                                   76400020
DEBDVMOD EQU   DEB+32                                                   76600020
DEBPTR   DS    F                        DCB SLOT                        76800020
MIELNAME DS    CL6                      VOLUME SERIAL SLOT              77000020
DCB      EQU   DEBPTR-44                                                77200020
R0AREA   DS    2D                       AREA FOR R0                     77400020
DEQAREA  DS    2D                       DEQ TABLE AREA                  77600020
MJELNAME DS    2F                       MAJOR QUEUE NAME AREA           77800020
ENQAREA  DS    2D                       ENQ TABLE AREA                  78000020
USERPARM DS    1F                       POINTER TO USER'S PARM LIST     78200020
NUMALT   DS    1H                       NUMBER OF ALTERNATES TO BE      78400020
*                                          TRIED                        78600020
MAXCOUNT DS    1H                       MAXIMUM NUMBER OF COUNT FIELDS  78800020
*                                          PER TRACK+1                  79000020
XCTLPTR  DS    2F                       PTR TO XCTL WORK AREA TABLE     79200020
XCTLAREA DS    0CL32                                                    79400020
XCTLNM   DS    CL6                      COMMON BYTES OF ATLAS NAME      79600020
XCTLID   DS    CL2                      ID OF ATLAS MODULE              79800020
         DS    CL6                      *                               80000020
TTR      DS    CL3                      TTR OF ATLAS MODULE             80200020
         DS    CL5                      *                               80400020
TTRATTB  DS    CL2                      ATTRIBUTES OF ATLAS - ALL LOADS 80600020
TTRCREQ  DS    CL3                      CORE REQUIREMENT OF ATLAS LOAD  80800020
TTRLNGTH DS    CL2                      LENGTH OF ATLAS LOAD            81000020
         DS    CL3                      *                               81200020
INCRMNT  DS    1F                       INCREMENT FOR READ COUNTS       81400020
PROGADDR DS    1F                       ADDRESS OF NEW CHANNEL PROGRAM  81600020
ALTHA    DS    2F                       ALTERNATE TRACK HOME ADDRESS    81800020
ALTR0    DS    4F                       ALTERNATE TRACK R0              82000020
*********************************************************************** 82100002
CCW1     DS    1D                       CCW AREA                        82200020
CCW2     DS    1D                       *                               82400020
CCW3     DS    1D                       *                               82600020
CCW44    DS    1D                       *                               82800020
CCW45    DS    1D                       *                               83000020
CCW56    DS    1D                       *                               83200020
CCW57    DS    1D                       *                               83400020
CCW31    DS    1D                       *                               83600020
CCW32    DS    1D                       *                               83800020
CCW33    DS    1D                       *                               84000020
CCW34    DS    1D                       *                               84200020
CCW35    DS    1D                       *                               84400020
CCW36    DS    1D                       *                               84600020
CCW37    DS    1D                       *                               84800020
CCW38    DS    1D                       *                               85000020
CCW39    DS    1D                       *                               85200020
CHECKHA  DS    2F                       AREA FOR HOME ADDRESS OF        85400020
*                                       ALTERNATE                       85600020
*                                                                       85800020
*********************************************************************** 85900002
CVT      DSECT                                                          86000020
*********************************************************************** 86100002
UCB      DSECT                                                          86200020
CNTAREA  DSECT                                                          86400020
         DS    F                       RESRV FOR DBL WD ALGNMT @ZM40498 86410030
MADSD    DS    CL4                     1ST FOUR 3350 SD BYTES  @X50RSPC 86450030
*********************************************************************** 86500002
HOMEAD   DS    2F                       CCW AREA                        86600020
R0       DS    4F                       *                               86800020
CCW21    DS    2F                       *                               87000020
CCW22    DS    2F                       *                               87200020
CCW23    DS    2F                       *                               87400020
ENDCA    DS    0F                                              @X50RSAG 87450030
CNTSIZE  EQU   ENDCA-CNTAREA           SIZE OF AREA            @X50RSAG 87500030
         END                                                            87600020
./  ADD  SSI=53040034,NAME=IGG0860B
         TITLE 'IGG0860B - THIRD LOAD MODULE FOR SVC 86'         S20201 00100020
         COPY  LCGASMSW                                                 00150003
IGG0860B CSECT                                                          00200020
*                                           SA66582 = OY02760 = OX03068 00300003
*                                                                       00400020
*        VS1 RELEASE 5.0 DELETIONS/CHANGES                     @X50RSAG 00450030
*A 520500                                                      @X50RSAG 00500030
*C 209600                                                      @X50RSAG 00550030
*D 209620-209900                                               @X50RSAG 00560030
* FIX BAD HA/R0 MSG.                                           @ZM40498 00570030
*          RELEASE 21 DELETIONS/CHANGES                                 00600020
*          RELEASE 20 DELETIONS/CHANGES                                 00700020
*0792001000-002000                                               S20201 00750020
* 181000-182000,186000,189000-194000                             M4693  00770020
*                                                                       00800020
*STATUS CHANGE LEVEL 002                                                00900020
*                                                                       01000020
*TITLE IGG0860B - THIRD LOAD MODULE OF SVC 86                         * 01100020
*                                                                     * 01200020
*FUNCTION/OPERATION                                                   * 01300020
*   IGG0860B ESTABLISHES ITS OWN ADDRESSABILITY, THAT OF THE 688-     * 01400020
*BYTE WORK AREA GOTTEN BY IGC0008F, AND THAT OF THE COUNT FIELD WORK  * 01500020
*AREA GOTTEN BY IGG0860A.  IT EXECUTES A CHANNEL PROGRAM TO READ HOME * 01600020
*ADDRESS, RECORD ZERO, AND COUNT FIELDS OF THE TRACK IN ERROR IN      * 01700020
*ORDER TO GET A COMPLETE DESCRIPTION OF THE TRACK.  SHOULD AN ERROR   * 01800020
*BE ENCOUNTERED IN READING A COUNT, NEW CHANNEL PROGRAMS MUST BE      * 01900020
*EXECUTED TO ASSIST IN CALCULATING KEY AND DATA LENGTHS FOR THE       * 02000020
*COUNT.                                                               * 02100020
*                                                                     * 02200020
*ENTRY POINTS                                                         * 02300020
*   IGG0860B GETS A DESCRIPTION OF THE TRACK CONTAINING THE RECORD    * 02400020
*IN ERROR.                                                            * 02500020
*                                                                     * 02600020
*INPUT                                                                * 02700020
*   CONSISTS OF THE WORK AREAS AS COMPLETED BY IGG0860A.              * 02800020
*                                                                     * 02900020
*OUTPUT                                                               * 03000020
*   CONSISTS OF THE WORK AREAS AND THE FOLLOWING RETURN CODES-        * 03100020
*                                                                     * 03200020
*        20 - INVALID I/O SENSE INDICATION                            * 03300020
*        36 - R0-HOME ADDRESS ERRORS ON BAD TRACK                     * 03400020
*        44 - UNRECOVERABLE HARD I/O ERROR IN A COUNT FIELD           * 03500020
*                                                                     * 03600020
*EXTERNAL ROUTINES                                                    * 03700020
*   NONE                                                              * 03800020
*                                                                     * 03900020
*EXITS                                                                * 04000020
*   ERROR - TRANSFERS CONTROL VIA XCTL TO IGG086AE WITH A RETURN      * 04100020
*           CODE IN REGISTER 4                                        * 04200020
*   NORMAL - TRANSFERS CONTROL VIA XCTL TO IGG0860C                   * 04300020
*                                                                     * 04400020
*TABLES/WORK AREAS                                                    * 04500020
*   THERE ARE TWO WORK AREAS AS FOLLOW-                               * 04600020
*                                                                     * 04700020
*        1.  A 688-BYTE WORK AREA INCLUDING THE FORMAT 4 DSCB,        * 04800020
*            MAXIMUM NUMBER OF COUNT FIELDS PER TRACK, A POINTER      * 04900020
*            TO THE USER'S PARAMETER LIST, THE ECB, IOB, DEB, AND     * 05000020
*            DCB CONSTRUCTED BY IGC0008F, A POINTER TO THE COUNT      * 05100020
*            FIELD WORK AREA, AN INDICATION OF THE ORIGINAL ERROR     * 05200020
*            TYPE, XCTL AREA, ADDRESS OF THE FIRST COUNT FIELD,       * 05300020
*            ADDRESS OF FIRST CCW IN NEW PORTION OF THE CHANNEL       * 05400020
*            PROGRAM, AND THE ADDRESS OF THE COUNT FIELD FOR THE      * 05500020
*            CCW IN ERROR.                                            * 05600020
*                                                                     * 05700020
*        2.  A CHANNEL PROGRAM TO READ HOME ADDRESS AND/OR RECORD     * 05800020
*            ZERO AND COUNTS.  IT ALSO INCLUDES THE AREA CONTAINING   * 05900020
*            THIS INFORMATION.                                        * 06000020
*                                                                     * 06100020
*ATTRIBUTES                                                           * 06200020
*   REENTRANT, REFRESHABLE                                            * 06300020
*                                                                     * 06400020
*                                                                       06500020
*                                                                       06600020
*********************************************************************** 06700020
*                                                                     * 06800020
*                               EQUATES                               * 06900020
*                                                                     * 07000020
*********************************************************************** 07100020
OFFSET   EQU   24                       USED TO EQUALIZE IOB-CCW OX3068 07150003
*                                       AND IOB-CSW CCW PTRS     OX3068 07160003
BIT1     EQU   X'40'                                                    07200020
BIT4     EQU   X'08'                                                    07300020
BIT6     EQU   X'02'                                                    07400020
BIT7     EQU   X'01'                                                    07500020
*********************************************************************** 07600020
*          COMPLETION CODES                                           * 07700020
*********************************************************************** 07800020
CC20     EQU   20                       NOT VALID ERROR CONDITION       07900020
CC36     EQU   36                       HA OR R0 ERRORS                 08000020
CC44     EQU   44                       NO ALTERNATE ASSIGNED           08100020
*********************************************************************** 08200020
*          DISPLACEMENT CONSTANTS                                     * 08300020
*********************************************************************** 08400020
D0       EQU   0                                                        08500020
D1       EQU   1                                                        08600020
D2       EQU   2                                                        08700020
D3       EQU   3                                                        08800020
D4       EQU   4                                                        08900020
D6       EQU   6                                                        09000020
D8       EQU   8                                                        09100020
D14      EQU   14                                                       09200020
D16      EQU   16                                                       09300020
D24      EQU   24                                                       09400020
*********************************************************************** 09500020
*          LENGTH CONSTANTS                                           * 09600020
*********************************************************************** 09700020
L1       EQU   1                                                        09800020
L2       EQU   2                                                        09900020
L3       EQU   3                                                        10000020
L4       EQU   4                                                        10100020
L5       EQU   5                                                        10200020
L7       EQU   7                                                        10300020
L8       EQU   8                                                        10400020
L20      EQU   20                                                       10500020
**********************************************************************  10510020
*        DEVICE EQUATES                                              *  10520020
**********************************************************************  10530020
D23051   EQU   X'06'                    2305-1 DEVICE TYPE       S20201 10540020
D23052   EQU   X'07'                    2305-2 DEVICE TYPE       S20201 10550020
D3330    EQU   X'09'                    3330   DEVICE TYPE       S20201 10560020
         AIF   ('&LIB' EQ 'LIB1').X225600                       XL03145 10562003
D3330C   EQU   X'0D'                   3330 C DEVICE            XL03145 10570003
D3340    EQU   X'0A'                   3340 DEVICE              XL03130 10572003
.X225600 ANOP                                                   XL03145 10580003
*********************************************************************** 10600020
*                                                                     * 10700020
*********************************************************************** 10800020
BADTRK   EQU   X'02'                                                    10900020
CSWOK    EQU   X'41'                                                    11000020
EOF      EQU   X'0D'                    END OF FILE                     11100020
ERRS2    EQU   X'02'                                                    11200020
ERRS3    EQU   X'03'                                                    11300020
IOEROR   EQU   X'20'                                                    11400020
OUTEXTNT EQU   X'42'                    OUT OF EXTENT                   11500020
RC1      EQU   X'01'                                                    11600020
RHA      EQU   X'1A'                    READ HOME ADDRESS               11700020
R0ERR    EQU   X'01'                    R0 ERROR SWITCH                 11800020
RR0      EQU   X'16'                    READ RECORD 0                   11900020
SPCT     EQU   X'0F'                    SPACE COUNT                     12000020
TIC      EQU   X'08'                                                    12100020
X0       EQU   0                                                        12200020
ZEROS    EQU   X'00'                                                    12300020
*                                                                       12400020
*                                                                       12500020
         EJECT                                                          12600020
* REGISTER ASSIGNMENTS                                                  12700020
PARMA    EQU   0                        PARAMETER REGISTER              12800020
PARMB    EQU   1                        PARAMETER REGISTER              12900020
WORKE    EQU   2                        EVEN WORK REGISTER              13000020
WORKO    EQU   3                        ODD WORK REGISTER               13100020
FOUR     EQU   4                        RETURN CODE REGISTER            13200020
FIVE     EQU   5                        WORK REGISTER                   13300020
SIX      EQU   6                        *                               13400020
SEVEN    EQU   7                        *                               13500020
EIGHT    EQU   8                        *                               13600020
NINE     EQU   9                        *                               13700020
TEN      EQU   10                       *                               13800020
AREAREG  EQU   11                       MAIN WORK AREA REGISTER         13900020
BASEREG  EQU   12                       BASE REGISTER                   14000020
SAVEREG  EQU   13                       WORK REGISTER                   14100020
RETREG   EQU   14                       WORK REGISTER                   14200020
ADDREG   EQU   15                       COMPLETION CODE REGISTER        14300020
         BALR  BASEREG,X0               ESTABLISH                       14400020
         USING EXPROG,BASEREG              OWN ADDRESSABILITY           14500020
         USING WORKDSCT,AREAREG         ESTABLISH ADDRESSABILITY FOR    14600020
*                                          WORK AREA                    14700020
         USING CNTAREA,TEN              ESTABLISH ADDRESSABILITY FOR    14800020
*                                          COUNT FIELD WORK AREA        14900020
* THIS SECTION EXECUTES THE CHANNEL PROGRAM                             15000020
EXPROG   BAL   EIGHT,SETBLKS            CLEAR ECB AND IOB               15100020
         EXCP  IOB                      READ COUNTS                     15200020
         WAIT  1,ECB=ECB                WAIT FOR I/O TO COMPLETE        15300020
         TM    HOMEAD,BADTRK            CHECK FOR FLAGGED        M4693  15320020
*                                       PRIMARY                  M4693  15340020
         BO    ISALT                    YES, PRIMARY TRACK IS    M4693  15360020
*                                       BAD                      M4693  15380020
MAKECHK  CLI   ECB,OUTEXTNT             IS TERMINATION DUE TO OUT OF    15400020
*                                          EXTENT                       15500020
         BE    OUTEXT                   YES                             15600020
         CLI   ECB,CSWOK                ARE CSW CONTENTS USEFUL         15700020
         BNE   SETCODE                  NO, SET ERROR CODE              15800020
         LA    SIX,IOB                  PICK UP ADDRESS OF IOB          15900020
         L     FIVE,IOBFLAG3            GET A(CCW) IN ERROR             16000020
         LA    FIVE,D0(X0,FIVE)         CLEAR HIGH ORDER BYTE           16100020
         S     FIVE,FULL8                                               16200020
         SPACE                                                          16300020
*A TEST IS MADE TO SEE IF THE ERROR OCCURED IN ATLAS' CHANNEL PROGRAM.  16400020
*IF IT DID NOT HOME ADDRESS OR R0 IS IN ERROR.                          16500020
         L     SEVEN,IOBSTART           GET START ADDRESS OF CHANNEL    16600020
*                                          PROGRAM                      16700020
         LA    SEVEN,D0(X0,SEVEN)       CLEAR HOGH ORDER BYTE           16800020
         CLR   FIVE,SEVEN               IS CCW ADDR GREATER THAN IOB    16900020
*                                          START ADDRESS                17000020
         BNL   CHECKHI                  YES, CHECK HIGH LIMIT           17100020
TESTADDR LA    SEVEN,CCW31              GET BEGINNING ADDR OF POSSIBLE  17200020
*                                          NEW CHANNEL PROGRAM          17300020
         CLR   FIVE,SEVEN                                               17400020
         BL    ERRCODE                  ERROR NOT IN ATLAS' CHANNEL     17500020
*                                          PROGRAM                      17600020
         LA    SEVEN,CHECKHA            CHECK HIGH LIMIT                17700020
         CLR   FIVE,SEVEN                                               17800020
         BNL   ERRCODE                  ERROR NOT IN ATLAS' CHANNEL     17900020
*                                          PROGRAM                      18000020
         B     TESTERR                  ERROR IN ATLAS CHANNEL   M4693  18100020
*                                       PROGRAM                  M4693  18200020
CHECKHI  L     SEVEN,SAVEADDR           LOAD ADDRESS OF FIRST COUNT     18300020
*                                          FIELD                        18400020
         CLR   FIVE,SEVEN               CHECK HIGH LIMIT                18500020
         BL    TESTERR                  CHECK IF ERROR IS IN NEW M4693  18560020
*                                       CHANNEL PROGRAM                 18620020
         B     TESTADDR                 WAS ERROR IN NEW CHANNEL PROG   18700020
         SPACE                                                          18800020
ISALT    EQU   *                        GET DESCRITPTION OF      M4693  19000020
*                                       ALTERNATE                M4693  19200020
         L     SEVEN,IOBSTART           START OF CCWS           OX03068 19250003
         L     FIVE,IOBFLAG3            CSW CCW PTR             OX03068 19300003
         LA    FIVE,0(FIVE)             ZERO HIGH BYTE          OX3068  19350003
         LA    SEVEN,OFFSET(SEVEN)      EQUALIZE PTRS           OX3068  19400003
         CLR   FIVE,SEVEN               COMPARE PTRS            OX3068  19450003
         BL    ERRCODE                  BRCH IF HA OR R0 ERR    OX3068  19460003
         MVC   SEEK+D3(L5),R0           MOVE ADDRESS OF ALTERNATE TO    19500020
*                                          SEEK ADDRESS                 19600020
         MVC   DEBSTRCC(L4),R0          SET UP DEB EXTENTS              19700020
         MVC   DEBENDCC(L4),R0                                          19800020
         B     EXPROG                   EXECUTE CHANNEL PROGRAM TO GET  19900020
*                                          DESCRIPTION OF ALTERNATE     20000020
         SPACE                                                          20100020
TESTERR  TM    IOBCSWST,BIT6            DID UNIT CHECK OCCUR            20200020
         BNO   SETCODE                  NO, SET ERROR CODE              20300020
         TM    SENSE0(SIX),BIT4         CHECK IOB SENSE BYTE0 FOR A     20400020
*                                          DATA CHECK                   20500020
         BO    TESTCCW                  YES, DATA CHECK                 20600020
         TM    SENSE1(SIX),BIT6         CHECK FOR MISSING ADDRESS       20700020
*                                          MARKER                       20800020
         BZ    SETCODE                  NOT MISSING, SET ERROR CODE     20900020
         CLI   DEVTAB+D3,D3330          CHECK FOR 3330           S20201 20930020
         BNL   SETCODE                 YES, INVALID IOB SENSE  @X50RSAG 20960030
         TM    SENSE1(SIX),BIT4         CHECK FOR NOT REGULAR MISSING   21000020
*                                          ADDRESS MARKER               21100020
         BO    SETCODE                  YES, NOT NORMAL, SET ERROR CODE 21200020
         TM    SENSE0(SIX),BIT7         CHECK FOR BALLAST CELL FOUND    21300020
         BZ    TESTCCW                  SITUATION UNDER CONTROL         21400020
SETCODE  LA    FOUR,CC20                SET COMPLETION CODE TO REFLECT  21500020
*                                          NOT VALID IOB SENSE          21600020
*                                          INDICATION                   21700020
BADCASE  MVC   XCTLID(L2),ATLAS06       MOVE ERROR LOAD NAME IN         21800020
         MVC   TTR(L3),TTR6             MOVE ERROR LOAD TTR IN          21900020
         SPACE                                                          22000020
GETOUT   XC    XCTLPTR+D4(L4),XCTLPTR+D4 CLEAR SECOND WORD OF POINTER   22100020
         L     PARMB,PNTSNAP            GET SNAP LIST POINTER   YL02912 22110002
         LTR   PARMB,PARMB              SNAP MODE               YL02912 22120002
         BZ    NOSNAP                   NO - DONT SNAP          YL02912 22130002
         SNAP  ID=4,MF=(E,(1))          SNAP                    YL02912 22140002
NOSNAP   EQU   *                        *                       YL02912 22150002
         XCTL  ,MF=(E,(1)),SF=(E,XCTLPTR)                               22200020
         SPACE                                                          22300020
TESTCCW  CLI   D0(FIVE),RHA             IS COMMAND A SINGLE TRACK READ  22400020
*                                         HA                            22500020
         BE    ERRCODE                  YES, HOME ADDRESS ERROR         22600020
         CLI   D0(FIVE),RR0             IS COMMAND A SINGLE TRACK       22700020
*                                         READ R0                       22800020
         LA    SEVEN,PICKUP             LOAD NEXT BRANCH ADDRESS        22900020
         BNE   CHKNUMB                  CHECK FOR THREE ERROR           23000020
*                                          RECORDS                      23100020
         BAL   SEVEN,SETCNT             UPDATE COUNT OF ERRORS          23200020
         MVI   RECNUMB+D1,ZEROS         SAVE ERROR RECORD NUMBER        23300020
         CLI   ERRTYPE,R0ERR            DID UTILITY PASS R0             23400020
         BNE   ERRCODE                  NO,ERROR IN R0                  23500020
*                                       THE SVC HAS INSUFFICIENT        23600020
*                                          DATA TO HANDLE R0 ERROR      23700020
         LM    SIX,SEVEN,CCWRHA         LOAD READ HOME ADDRESS CCW      23800020
         ALR   SIX,TEN                                                  23900020
         STM   SIX,SEVEN,CCW22          STORE IN SECOND CCW SLOT        24000020
         LA    SIX,CCW22                PUT POINTER TO CHANNEL PROGRAM  24100020
         ST    SIX,IOBSTART                INTO IOB                     24200020
         B     EXPROG                   BRANCH TO GENERATE READ COUNTS  24300020
CHKNUMB  CLI   NUMBERR+D1,ERRS3         HAVE THERE BEEN THREE           24400020
*                                          ERROR RECORDS                24500020
         BNE   SETCNT                   NO, UPDATE COUNT OF ERRORS      24600020
         B     INVALID                  SET RETURN CODE TO 44 FOR MORE  24700020
*                                          THAN THREE ERROR RECORDS     24800020
*                                          ENCOUNTERED                  24900020
SETCNT   IC    NINE,NUMBERR+D1          PICK UP NUMBER ERROR RECORDS    25000020
*                                          ENCOUNTERED                  25100020
         A     NINE,FULL1               INCREMENT BY ONE                25200020
         STC   NINE,NUMBERR+D1                                          25300020
         BR    SEVEN                    CONTINUE PROCESSING             25400020
         SPACE                                                          25500020
PICKUP   L     SEVEN,D0(X0,FIVE)        PICK UP ADDRESS OF COUNT FIELD  25600020
*                                          FOR CCW IN ERROR             25700020
         ST    SEVEN,CNTADDR            SAVE ADDRESS OF LAST COUNT      25800020
*                                          FIELD                        25900020
         L     PARMB,USERPARM           PICK UP POINTER TO USER'S       26000020
*                                          PARAMETER LIST               26100020
         LR    WORKE,PARMB              SAVE POINTER TO LIST            26200020
         L     PARMB,D4(X0,PARMB)       PICK UP POINTER TO USER'S       26300020
*                                          COUNT                        26400020
         MVC   D0(L4,SEVEN),D0(PARMB)   MOVE USER'S COUNT TO COUNT      26500020
*                                          FIELD AREA                   26600020
         LR    SIX,FIVE                                                 26700020
         S     SIX,FULL8                PICK UP ADDRESS OF PREVIOUS CCW 26800020
         CLI   D0(SIX),RR0              WAS PREVIOUS COMMAND READ R0    26900020
         BE    SETONE                   YES INSERT RECORD NUMBER        27000020
         CLI   D0(SIX),RHA              WAS PREVIOUS COMMAND A RD HA    27100020
         BNE   GETNUMB                  NO,GET RECORD NUMBER            27200020
SETONE   MVI   D4(SEVEN),RC1            INSERT RECORD NUMBER = 1        27300020
         CLI   NUMBERR+D1,ERRS2         WAS RO IN ERROR                 27400020
         BNE   FIRSTERR                 NO,R1 IS THE FIRST ERROR        27500020
         MVI   RECNUMB+D2,RC1           STORE RECORD NUMBER             27600020
         B     ISITEOF                  TEST FOR ZERO DATA LENGTH       27700020
FIRSTERR MVI   RECNUMB+D1,RC1           SAVE RECORD NUMBER              27800020
         B     ISITEOF                  TEST FOR END OF FILE            27900020
GETNUMB  SR    SIX,SIX                  CLEAR REGISTER                  28000020
         LR    NINE,SEVEN               GET ADDRESS OF RECORD NUMBER    28100020
         S     NINE,FULL4                  FIELD IN PREVIOUS COUNT      28200020
         IC    SIX,D0(X0,NINE)          PICK UP NUMBER                  28300020
         LA    SIX,D1(X0,SIX)           INCREMENT BY ONE TO GET NUMBER  28400020
         STC   SIX,D4(X0,SEVEN)            OF RECORD IN ERROR           28500020
         XR    FOUR,FOUR                CLEAR REGISTER                  28600020
         IC    FOUR,NUMBERR+D1          PICK UP NUMBER OF ERRORS        28700020
         LA    NINE,RECNUMB             DETERMINE DISPLACEMENT INTO     28800020
         ALR   FOUR,NINE                   ERROR RECORD SAVE AREA       28900020
         STC   SIX,D0(FOUR)             SAVE NUMBER OF ERROR RECORD     29000020
ISITEOF  SR    SIX,SIX                  CLEAR REGISTER                  29100020
         CH    SIX,D6(X0,SEVEN)         IS DATA LENGTH EQUAL TO ZERO    29200020
         LA    FOUR,SETREAD             REGULAR PROCESS                 29300020
         BNE   SETUP                    NO, REGULAR COUNT ERROR         29400020
         TM    D4(WORKE),BIT1           WAS A FULL COUNT FIELD GIVEN    29500020
         BO    INVALID                  NO, MAY BE EOF ERROR            29600020
         XR    FOUR,FOUR                CLEAR REGISTER                  29700020
         IC    FOUR,NUMBERR+D1          PICK UP NUMBER OF ERROR RECORDS 29800020
         LA    NINE,RECNUMB                                             29900020
         ALR   FOUR,NINE                GET POINTER TO LAST ERROR       30000020
*                                          RECORD NUMBER                30100020
         CLC   D4(L1,PARMB),D0(FOUR)    IS THIS USER'S ERROR RECORD     30200020
         BNE   INVALID                  NO, CAN'T HANDLE EOF            30300020
         LA    FOUR,SETEOF              ADDRESS FOR ROUTINE TO SET EOF  30400020
SETUP    BAL   EIGHT,SETBLKS            BRANCH TO CLEAR CONTROL BLOCKS  30500020
         LM    SIX,SEVEN,CCWTIC         REPLACE READ COUNT COMMAND WITH 30600020
         ALR   SIX,AREAREG                 A TIC TO NEW CHANNEL PROGRAM 30700020
         L     EIGHT,INCRMNT            GET POINTER TO NEW CHANNEL      30800020
         ALR   SIX,EIGHT                   PROGRAM                      30900020
         ST    SIX,PROGADDR             SAVE ADDRESS OF NEW CHANNEL     31000020
*                                          PROGRAM                      31100020
         MVC   D4(L20,SIX),CCWSPACE+D4  MOVE NEW CHANNEL PROGRAM        31200020
*                                          TO WORK AREA                 31300020
         L     WORKO,TICADDR            GET ADDR OF PREVIOUS            31400020
*                                          LAST TIC                     31500020
         LR    NINE,FIVE                                                31600020
         LA    FIVE,D8(X0,FIVE)         PUT ADDRESS OF CCW FOLLOWING    31700020
         ST    FIVE,D16(X0,SIX)            ERROR CCW IN RETURN TIC      31800020
         LA    FIVE,D16(X0,SIX)         GET ADDRESS OF LAST TIC         31900020
         MVI   D0(FIVE),TIC             INSERT COMMAND CODE IN TIC CCW  32000020
         ST    FIVE,TICADDR             SAVE ADDRESS OF LAST TIC CCW    32100020
         LA    EIGHT,D24(X0,EIGHT)      UPDATE THE INCREMENT            32200020
         ST    EIGHT,INCRMNT                                            32300020
         STM   SIX,SEVEN,D0(NINE)       REPLACE READ COUNT CCW WITH     32400020
*                                          TIC TO NEW CHANNEL PROGRAM   32500020
         S     NINE,FULL8               GET POINTER TO CCW              32600020
*                                          PREVIOUS TO ERROR CCW        32700020
         CLI   D0(NINE),TIC             IS CCW PREVIOUS TO ERROR        32800020
*                                          CCW A TIC COMMAND            32900020
         BNE   NOTIC                    NO,NOT A DOUBLE TIC             33000020
         S     WORKO,FULL8                                              33100020
         MVC   D0(L4,WORKO),D8(NINE)    TIC TO SPACE COUNT CCW          33200020
NOTIC    L     SEVEN,CNTADDR            PICK UP ADDRESS OF ERROR COUNT  33300020
*                                           FIELD                       33400020
         A     SEVEN,FULL5              GET ADDRESS OF KEY AND DATA     33500020
*                                          LENGTH FIELDS                33600020
         ST    SEVEN,D0(X0,SIX)         COMPLETE SPACE COUNT COMMAND    33700020
         MVI   D0(SIX),SPCT             INSERT COMMAND CODE             33800020
         BR    FOUR                     BRANCH TO NEXT ROUTINE          33900020
SETREAD  SR    WORKE,WORKE              CLEAR WORK REGISTER             34000020
         IC    WORKE,D0(X0,SEVEN)       PICK UP KEY LENGTH              34100020
         LA    SEVEN,D1(X0,SEVEN)       GET ADDRESS OF DATA LENGTH      34200020
         LH    WORKO,D0(X0,SEVEN)       PICK UP DATA LENGTH             34300020
         AR    WORKE,WORKO              GET KEY + DATA LENGTH           34400020
         STH   WORKE,D14(X0,SIX)        INSERT BYTE COUNT INTO READ     34500020
*                                           KEY DATA CCW                34600020
         EXCP  IOB                      READ COUNT WITH READ KD         34700020
         WAIT  1,ECB=ECB                WAIT FOR I/O TO COMPLETE        34800020
         B     TESTECB                  CHECK CONDITION OF ECB          34900020
SETEOF   S     SEVEN,FULL5              GET ADDRESS OF ERROR COUNT      35000020
         MVC   D0(L8,SEVEN),D0(PARMB)   MOVE IN USER'S COUNT            35100020
         B     REPLCCW                  CHANGE READ KEY/DATA TO TIC     35200020
SETBLKS  XC    ECB(L4),ECB              ZERO ECB                        35300020
         XC    IOBSENS0(L2),IOBSENS0    ZERO SENSE BYTES                35400020
         XC    IOBCSW(L7),IOBCSW        ZERO LOW ORDER BYTES OF IOB CSW 35500020
         BR    EIGHT                    RETURN                          35600020
         SPACE                                                          35700020
TESTECB  TM    ECB,IOEROR               TEST FOR PERMANENT I/O ERROR    35800020
         BZ    CHKLAST                  YES, PERMANENT I/O ERROR        35900020
         SPACE                                                          36000020
REPLCCW  MVC   D8(L8,SIX),D0(FIVE)      REPLACE READ KEY/DATA           36100020
*                                          WITH TIC                     36200020
         B     EXPROG                   GO TO ORIGINAL EXCP             36300020
         SPACE                                                          36400020
CHKLAST  EQU   *                                                        36500020
         CLC   IOBCSW(L3),TICADDR+D1    COMPARE ADDRESS OF LAST CCW     36600020
*                                          WITH ADDRESS OF LAST TIC CCW 36700020
         BNE   INVALID                  IF NOT EQUAL, SET ERROR CODE    36800020
CHKREC   L     PARMB,USERPARM                                           36900020
         TM    D4(PARMB),BIT1           WAS A FULL COUNT FIELD GIVEN    37000020
         BO    INVALID                  UNRECOVERABLE ERROR IN KDD OF   37100020
*                                          COUNT FIELD                  37200020
         L     FOUR,D4(X0,PARMB)        PICK UP ADDRESS OF CCHH         37300020
*                                           PARAMETER                   37400020
         XR    SEVEN,SEVEN              CLEAR REGISTER                  37500020
         LA    EIGHT,RECNUMB            GET POINTER TO R OF LAST        37600020
         IC    SEVEN,NUMBERR+D1            ERROR RECORD                 37700020
         ALR   SEVEN,EIGHT                                              37800020
         CLC   D4(L1,FOUR),D0(SEVEN)    WAS THE LAST ERROR RECORD THE   37900020
*                                          ORIGINAL RECORD IN ERR       38000020
         BNE   INVALID                  NO, SET ERROR CODE              38100020
         L     SEVEN,CNTADDR            LOAD ADDR OF COUNT FIELD        38200020
         MVC   D0(L8,SEVEN),D0(FOUR)    MOVE IN USER'S COUNT            38300020
         B     REPLCCW                  BRANCH TO REPLACE READ KEY/DATA 38400020
*                                          CCW WITH TIC                 38500020
         SPACE                                                          38600020
ERRCODE  LA    FOUR,CC36                SET COMPLETION CODE TO 36 FOR   38700020
*                                          HOME ADDRESS OR R0 ERROR     38800020
         B     BADCASE                  GO TO ERROR LOAD                38900020
INVALID  LA    FOUR,CC44                SET COMPLETION CODE FOR ERROR   39000020
*                                          IN EOF RECORD OR KDD OF      39100020
*                                          COUNT FIELD                  39200020
         B     BADCASE                  EXIT TO ERROR LOAD              39300020
OUTEXT   MVC   XCTLID(L2),ATLAS04       MOVE NEXT LOAD NAME IN          39400020
         MVC   TTR(L3),TTR4             MOVE NEXT LOAD TTR IN           39500020
         SR    FOUR,FOUR                SET COMPLETION CODE TO ZERO     39600020
         B     GETOUT                   EXIT TO NEXT LOAD               39700020
SENSE0   EQU   2                                                        39800020
SENSE1   EQU   3                                                        39900020
STATUS0  EQU   12                       FIRST CSW STATUS BYTE           40000020
CCWSPACE CCW   X'0F',0,X'40',3          SPACE COUNT                     40100020
CCWRKD   CCW   X'0E',CCW31-SVRBEX,X'10',0  READ KEY/DATA                40200020
CCWTIC   CCW   X'08',CCW31-SVRBEX,X'40',0  TIC                          40300020
CCWRHA   CCW   X'1A',HOMEAD-CNTAREA,X'40',5  READ HOME ADDRESS          40400020
CCWRR0   CCW   X'16',R0-CNTAREA,X'40',16  READ RECORD ZERO              40500020
CCWRC    CCW   X'92',0,X'40',8          READ COUNT                      40600020
FULL8    DC    F'8'                     *                               40700020
FULL1    DC    F'1'                     *                               40800020
FULL4    DC    F'4'                     *                               40900020
FULL5    DC    F'5'                     *                               41000020
MAINT    DC    2CL25'IGG0860B MAINTENANCE AREA'                 YL02912 41050002
         SPACE                                                          41100020
*XCTL BY TTR TABLE                                                      41200020
         SPACE                                                          41300020
         ORG   IGG0860B+1000            FIRST ORG                       41400020
         SPACE                                                          41500020
TTRTABLE EQU   *                                                        41600020
ATLAS04  DC    C'0C'                    ID OF NEXT ATLAS LOAD           41700020
TTR4     DC    X'00000000'              TTR OF NEXT ATLAS LOAD          41800020
ATLAS06  DC    C'AE'                    ID OF ERROR LOAD                41900020
TTR6     DC    X'00000000'              TTR OF ERROR LOAD               42000020
         DC    X'0000'                  LAST TABLE ENTRY CODE           42100020
         ORG   IGG0860B+1020            SECOND ORG                      42200020
         DC    C'086'                   ATLAS SVC CODE                  42300020
         DC    X'7D'                    RELATIVE TABLE START ADDRESS    42400020
*                                          IN DOUBLE WORDS              42500020
WORKDSCT DSECT                                                          42600020
SVRBEX   DS    1F                       SAVE AREA FOR SVRB EXTENSION    42700020
*                                       POINTER                         42800020
DEVTAB   DS    1F                       DEVICE TYPE INDICATOR FROM UCB  42900020
SWITCH   DS    CL1                      LOGIC SWITCH                    43000020
*                                       0 BIT INDICATES CHANNEL         43100020
*                                          PROGRAM NOT RE-EXECUTABLE    43200020
*                                       1 BIT INDICATES WRITE SPECIAL   43300020
*                                          REQUIRED                     43400020
*                                       2 BIT INDICATES TRACK OVERFLOW  43500020
*                                          DATA SET                     43600020
*                                       7 BIT INDICATES VTOC HAS BEEN   43700020
*                                       ENQUEUED UPON                   43800020
NUMBERR  DS    CL2                      NUMBER OF ERROR RECORDS         43900020
VTOCADR  DS    CL5                      VTOC ADDRESS CCHHR              44000020
SPLIT    DS    X'00'                    SPLIT CYLINDER SWITCH           44100020
RETPT    DS    1F                       POINTER TO NEXT ROUTINE         44200020
         DS    0F                                                       44300020
         IECSDSL1 (4)                                                   44400020
TICADDR  DS    1F                       ADDRESS OF TIC CCW IN NEW       44500020
*                                          CHANNEL PROGRAM              44600020
SAVEADDR DS    1F                       ADDRESS OF FIRST COUNT FIELD    44700020
CNTCORE  DS    1F                       NUMBER BYTES IN COUNT FIELD     44800020
*                                          WORK AREA                    44900020
COREADDR DS    1F                       ADDRESS OF COUNT FIELD          45000020
*                                          WORK AREA                    45100020
RECADDR  DS    1F                       ADDRESS OF CORE GOTTEN FOR      45200020
*                                          LONGEST RECORD SIZE          45300020
RECCORE  DS    1F                       NUMBER OF BYTES IN THIS AREA    45400020
DDNAME   DS    1D                      DDNAME SAVE AREA         XL03130 45450003
DEVINFO  DS    5F                      DEVICE INFO              XL03130 45460003
PARMUSER DS    1F                       POINTER USER PARM LIST  YL02912 45465002
PNTEST   DS    1F                       TEST MODE               YL02912 45466002
PNTSNAP  DS    1F                       SNAP MODE               YL02912 45467002
PNTSNS   DS    CL2                      SENSE BYTE - USER       YL02912 45467202
         DS    CL1                      FILLER                  YL02912 45467402
PNTMIOB  DS    CL1                      M OF IOB                YL02912 45467602
PNTIOB   DS    1F                       IOB POINTER             YL02912 45470002
PNTCNT   DS    1F                       COUNT POINTER           YL02912 45475002
PARMCNT  DS    2F                       COUNTS                  YL02912 45480002
PNTIOT   DS    CL2                      TIOT OFFSET             YL02912 45480202
         DS    CL1                      FILLER                  YL02912 45480402
PNTOFLO  DS    CL1                      TRACK OVERFLO           YL02912 45480602
PNTDEB   DS    1F                       DEB POINTER             YL02912 45480802
HOLDKEY  DS    1F                       USER KEY                YL02912 45485002
REGHOLD  DS    1F                       TEMP REG SAVE           YL02912 45490002
CNTADDR  DS    1F                       ADDRESS OF COUNT FIELD FOR      45500020
*                                          CCW IN ERROR                 45600020
ERRTYPE  DS    CL1                      TYPE OF ORIGINAL ERROR          45700020
RECNUMB  DS    1F                       R OF ERROR RECORDS              45800020
REGSAVE  DS    5F                       SAVE AREA FOR REGISTERS         45900020
ECB      DS    1F                       ECB                             46000020
IOB      DS    8F                       IOB                             46100020
IOBSENS0 EQU   IOB+2                                                    46200020
IOBFLAG3 EQU   IOB+8                                                    46300020
IOBCSW   EQU   IOB+9                                                    46400020
IOBCSWST EQU   IOB+12                                                   46500020
IOBSTART EQU   IOB+16                                                   46600020
SEEK     DS    2F                       SEEK ADDRESS                    46700020
DEB      DS    12F                      DEB                             46800020
DEBSTRCC EQU   DEB+38                                                   46900020
DEBENDCC EQU   DEB+42                                                   47000020
DEBPTR   DS    F                        DCB SLOT                        47100020
MIELNAME DS    CL6                      VOLUME SERIAL SLOT              47200020
DCB      EQU   DEBPTR-44                                                47300020
R0AREA   DS    2D                       AREA FOR R0                     47400020
DEQAREA  DS    2D                       DEQ TABLE AREA                  47500020
MJELNAME DS    2F                       MAJOR QUEUE NAME AREA           47600020
ENQAREA  DS    2D                       ENQ TABLE AREA                  47700020
USERPARM DS    1F                       POINTER TO USER'S PARM LIST     47800020
NUMALT   DS    1H                       NUMBER OF ALTERNATES TO BE      47900020
*                                         TRIED                         48000020
MAXCOUNT DS    1H                       MAXIMUM NUMBER OF COUNT FIELDS  48100020
*                                          PER TRACK+1                  48200020
XCTLPTR  DS    2F                       PTR TO XCTL WORK AREA TABLE     48300020
XCTLAREA DS    0CL32                                                    48400020
XCTLNM   DS    CL6                      COMMON BYTES OF ATLAS NAME      48500020
XCTLID   DS    CL2                      ID OF ATLAS MODULE              48600020
         DS    CL6                      *                               48700020
TTR      DS    CL3                      TTR OF ATLAS MODULE             48800020
         DS    CL5                      *                               48900020
TTRATTB  DS    CL2                      ATTRIBUTES OF ATLAS - ALL LOADS 49000020
TTRCREQ  DS    CL3                      CORE REQUIREMENT OF ATLAS LOAD  49100020
TTRLNGTH DS    CL2                      LENGTH OF ATLAS LOAD            49200020
         DS    CL3                      *                               49300020
INCRMNT  DS    1F                       CCW POINTER                     49400020
PROGADDR DS    1F                       ADDRESS OF NEW CHANNEL PROGRAM  49500020
ALTHA    DS    2F                       ALTERNATE TRACK HOME ADDRESS    49600020
ALTR0    DS    4F                       ALTERNATE TRACK R0              49700020
CCW1     DS    1D                       CCW AREA                        49800020
CCW2     DS    1D                       *                               49900020
CCW3     DS    1D                       *                               50000020
CCW44    DS    1D                       *                               50100020
CCW45    DS    1D                       *                               50200020
CCW56    DS    1D                       *                               50300020
CCW57    DS    1D                       *                               50400020
CCW31    DS    1D                       *                               50500020
CCW32    DS    1D                       *                               50600020
CCW33    DS    1D                       *                               50700020
CCW34    DS    1D                       *                               50800020
CCW35    DS    1D                       *                               50900020
CCW36    DS    1D                       *                               51000020
CCW37    DS    1D                       *                               51100020
CCW38    DS    1D                       *                               51200020
CCW39    DS    1D                       *                               51300020
CHECKHA  DS    2F                       AREA FOR HOME ADDRESS OF        51400020
*                                       ALTERNATE                       51500020
FLAG     DS    1F                       TO BE REMOVED                   51600020
*                                                                       51700020
CVT      DSECT                                                          51800020
UCB      DSECT                                                          51900020
CNTAREA  DSECT                                                          52000020
         DS    F                        FOR DBL WD ALGNMT      @ZM40498 52010030
MADSD    DS    CL4                      3350 SKIP DISP         @X50RSPC 52050030
HOMEAD   DS    2F                       CCW AREA                        52100020
R0       DS    4F                       *                               52200020
CCW21    DS    2F                       *                               52300020
CCW22    DS    2F                       *                               52400020
CCW23    DS    2F                       *                               52500020
         END                                                            52600020
./  ADD  SSI=81560152,NAME=IGG0860C
         TITLE 'IGG0860C - FOURTH LOAD MODULE FOR SVC 86'        S20201 00200020
         COPY  LCGASMSW                                                 00250003
IGG0860C CSECT                                                          00400020
*********************************************************************** 00420099
*                 CHANGES THIS MODULE                                   00440099
*                 LATEST FIRST.                                         00460099
*********************************************************************** 00480099
*                                                                       00500099
* CHANGE ONLY         NONRELEVANT BITS ARE   @ZA32949=@XA22017=@YA20974 00520099
*                     TESTED IN FLAG BYTE.   @ZA32949=@XA22017=@YA20974 00540099
*                                                                       00600020
*                                                               YM3004  00800002
*                                                                       01000020
*      VS1 RELEASE  5 DELETIONS/CHANGES                        @X50RSAG 01200003
*A 214500,482100,516100,517000,602000,966000                   @X50RSAG 01250003
*D 604000-660000                                               @X50RSAG 01350003
*                                                                       01355099
* FIX BAD HA/R0 MSG.                                           @ZM40498 01360003
*          RELEASE 21 DELETIONS/CHANGES                                 01400020
*          RELEASE 20 DELETIONS/CHANGES                                 01600020
*0791002000-004000                                               S20201 01700020
*                                                                       01800020
*STATUS CHANGE LEVEL 002                                                02000020
*                                                                       02200020
*********************************************************************** 02250099
        EJECT                                                           02300099
*TITLE 'IGG0860C' - FOURTH LOAD MODULE OF SVC 86                      * 02400020
*FUNCTION/OPERATION                                                   * 02600020
*   IGG0860C - ESTABLISHES ITS OWN ADDRESSABILITY, THAT OF THE 688-   * 02800020
*BYTE WORK AREA, AND THAT OF THE WORK AREA FOR COUNT FIELDS.  BEING   * 03000020
*THE FOURTH LOAD MODULE OF SVC 86, THIS MODULE HAS THREE MAJOR        * 03200020
*FUNCTIONS -                                                          * 03400020
*                                                                     * 03600020
*        1.  CHECKS FOR A COUNT FIELD ERROR ON THE LAST RECORD        * 03800020
*            ON A TRACK                                               * 04000020
*        2.  COMPUTES SIZE OF LARGEST RECORD ON THE BAD TRACK         * 04200020
*            AND ISSUES A CONDITIONAL GETMAIN FOR THE LARGEST         * 04400020
*            RECORD                                                   * 04600020
*        3.  WRITES HA AND R0 ON THE CHOSEN ALTERNATE                 * 04800020
*                                                                     * 05000020
*ENTRY POINTS                                                         * 05200020
*   IGG0860C - CHECKS FOR ENTRANCE DUE TO NORMAL PROCESSING OR RETURN * 05400020
*FROM IGG0860D.                                                       * 05600020
*                                                                     * 05800020
*INPUT                                                                * 06000020
*   INCLUDED IN THE INPUT ARE A 688-BYTE MAIN WORK AREA AND A WORK    * 06200020
*AREA FOR CHANNEL PROGRAMS AND COUNT FIELDS FOR THE BAD TRACK         * 06400020
*                                                                     * 06600020
*OUTPUT                                                               * 06800020
*   THE OUTPUT CONSISTS OF THE 688-BYTE MAIN WORK AREA, A WORK AREA   * 07000020
*FOR CHANNEL PROGRAMS AND COUNT FIELDS FOR THE BAD TRACK AND A WORK   * 07200020
*AREA FOR THE LARGEST RECORD ON THE BAD TRACK.  IN AN ERROR SITUATION * 07400020
*ONE OF THE FOLLOWING RETURN CODES WILL BE SET                        * 07600020
*        12 - CORE NOT AVAILABLE                                      * 07800020
*        16 - I/O ERROR ON ALTERNATE AFTER N TRIES                    * 08000020
*        32 - ERROR IN COUNT FIELD OF LAST RECORD ON THE TRACK        * 08200020
*        36 - SEARCH HA ERROR ON ALTERNATE                            * 08400020
*                                                                     * 08600020
*EXTERNAL ROUTINES                                                    * 08800020
*   NONE                                                              * 09000020
*                                                                     * 09200020
*EXITS                                                                * 09400020
*   NORMAL - XCTL TO MODULE IGG0860D                                  * 09600020
*   ERROR - XCTL TO MODULE IGG086AE - RETURN CODE IN REGISTER FOUR    * 09800020
*                                                                     * 10000020
*TABLES/WORK AREAS                                                    * 10200020
*   A 688-BYTE WORK AREA CONTAINING THE FORMAT 4 DSCB, MAXIMUM        * 10400020
*NUMBER OF COUNT FIELDS PER TRACK, A POINTER TO USER'S PARAMETER LIST,* 10600020
*ECB, IOB, DEB, AND DCB.                                              * 10800020
*                                                                     * 11000020
*ATTRIBUTES                                                           * 11200020
*   REENTRANT, REFRESHABLE                                            * 11400020
*                                                                     * 11600020
*                                                                     * 11800020
*                                                                     * 12000020
*                                                                     * 12200020
*                                                                     * 12400020
*********************************************************************** 12600020
*                                                                     * 12800020
*                               EQUATES                               * 13000020
*                                                                     * 13200020
*********************************************************************** 13400020
BIT1     EQU   X'40'                                                    13600020
BIT2     EQU   X'20'                                                    13800020
BIT3     EQU   X'10'                                                    14000020
BIT4     EQU   X'08'                                                    14200020
*********************************************************************** 14400020
*          COMPLETION CODES                                           * 14600020
*********************************************************************** 14800020
CC12     EQU   12                       CORE NOT AVAILABLE              15000020
CC16     EQU   16                       ERROR IN ALTERNATE ASSIGNMENT   15200020
CC32     EQU   32                       LAST RECORD COUNT ERROR         15400020
CC36     EQU   36                       HA OR R0 ERRORS                 15600020
*********************************************************************** 15800020
*          DISPLACEMENT CONSTANTS                                     * 16000020
*********************************************************************** 16200020
D0       EQU   0                                                        16400020
D1       EQU   1                                                        16600020
D2       EQU   2                                                        16800020
D3       EQU   3                                                        17000020
D4       EQU   4                                                        17200020
D5       EQU   5                                                        17400020
D6       EQU   6                                                        17600020
D8       EQU   8                                                        17800020
D9       EQU   9                                                        18000020
*********************************************************************** 18200020
*          LENGTH CONSTANTS                                           * 18400020
*********************************************************************** 18600020
L1       EQU   1                                                        18800020
L2       EQU   2                                                        19000020
L3       EQU   3                                                        19200020
L4       EQU   4                                                        19400020
L7       EQU   7                                                        19600020
L8       EQU   8                                                        19800020
L16      EQU   16                                                       20000020
*********************************************************************** 20200020
*                                                                     * 20400020
*********************************************************************** 20600020
BADALT   EQU   X'03'                    TRACK STATUS FLAG BYTE          20800020
BITS8    EQU   8                                                        21000020
CCB      EQU   X'40'                    COMMAND CHAINING BIT            21200020
D2321    EQU   X'05'                        *                           21400020
         AIF   ('&LIB' EQ 'LIB1').X225600                       XL03130 21410003
D3340    EQU   X'0A'                   3340 DEVICE              XL03130 21450003
D3350    EQU   X'0B'                   3350 DEVICE             @X50RSAG 21460003
.X225600 ANOP                                                   XL03130 21500003
FFSW     EQU   X'FF'                                                    21600020
GDTRK    EQU   X'01'                    TRACK STATUS FLAG               21800020
IOEROR   EQU   X'20'                                                    22000020
OVFLW    EQU   X'20'                    RECORD OVERFLOW                 22200020
RCNT     EQU   X'92'                    READ COUNT                      22400020
R0ERR    EQU   X'01'                    R0 ERROR SWITCH                 22600020
SHA      EQU   X'39'                    SEARCH HOME ADDRESS             22800020
X0       EQU   0                                                        23000020
ZEROS    EQU   X'00'                                                    23200020
*                                                                       23400020
*                                                                       23600020
*********************************************************************** 23700002
         EJECT                                                          23800020
* REGISTER ASSIGNMENTS                                                  24000020
*********************************************************************** 24100002
PARMA    EQU   0                        PARAMETER REGISTER              24200020
PARMB    EQU   1                        PARAMETER REGISTER              24400020
WORKE    EQU   2                        WORK EVEN REGISTER              24600020
WORKO    EQU   3                        ODD WORK REGISTER               24800020
FOUR     EQU   4                        RETURN CODE REGISTER            25000020
FIVE     EQU   5                        WORK REGISTER                   25200020
SIX      EQU   6                        WORK REGISTER                   25400020
SEVEN    EQU   7                        WORK REGISTER                   25600020
EIGHT    EQU   8                        WORK REGISTER                   25800020
NINE     EQU   9                        RECORD BUFFER REGISTER          26000020
TEN      EQU   10                       TRACK DESCRIPTOR CHANNEL        26200020
*                                          PROGRAM AREA                 26400020
AREAREG  EQU   11                       MAIN WORK AREA REGISTER         26600020
BASEREG  EQU   12                       BASE REGISTER                   26800020
SAVEREG  EQU   13                       WORK REGISTER                   27000020
RETREG   EQU   14                       WORK REGISTER                   27200020
ADDREG   EQU   15                       WORK REGISTER                   27400020
*********************************************************************** 27500002
         BALR  BASEREG,X0               ESTABLISH                       27600020
         USING OUTEXT,BASEREG              OWN ADDRESSABILITY           27800020
         USING WORKDSCT,AREAREG         ESTABLISH ADDRESSABILITY FOR    28000020
*                                          WORK AREA                    28200020
         USING CNTAREA,TEN              ESTABLISH ADDRESSABILITY FOR    28400020
*                                          COUNT FIELD WORK AREA        28600020
         B     APARNO                   BRANCH AROUND APARNO   @ZA32949 28610099
         DC    C'IGG0860C ZA32949'      LAST APAR FIXED IN MOD @ZA32949 28620099
APARNO   EQU   *                                               @ZA32949 28630099
*********************************************************************** 28650002
*        CHECK IF MODULE REQUESTED BY 0B OR 0D                  YL02912 28700002
*********************************************************************** 28750002
OUTEXT   LTR   FOUR,FOUR                CHECK FOR ENTRY FROM IGG0860D   28800020
         BNZ   SECONDEN                 YES, ENTRY FROM IGG0860D        29000020
         L     SIX,IOBFLAG3             LOAD ADDRESS OF LAST CCW        29200020
         S     SIX,FULL16               GET ADDRESS OF LAST VALID CCW   29400020
         CLI   D0(SIX),RCNT             WAS THERE AN ERROR ON LAST      29600020
*                                          COUNT RECORD                 29800020
         BNE   CHEKSPEC                 YES, THERE WAS A COUNT ERROR    30000020
         L     SIX,D0(X0,SIX)           PICK UP ADDRESS OF LAST COUNT   30200020
*                                          FIELD                        30400020
         A     SIX,FULL8                GET ADDRESS OF BYTE FOLLOWING   30600020
         MVI   D0(SIX),FFSW             SET FLAG TO INDICATE END OF     30800020
*                                          COUNTS                       31000020
*********************************************************************** 31100002
         SPACE                                                          31200020
* THIS SECTION COMPUTES THE SIZE OF THE LARGEST RECORD ON THE TRACK     31400020
*********************************************************************** 31500002
FINDSIZE SR    EIGHT,EIGHT              CLEAR WORK REGISTERS            31600020
         L     FIVE,SAVEADDR            PICK UP ADDRESS OF FIRST COUNT  31800020
*                                          FIELD                        32000020
FINDMAX  CLI   D0(FIVE),FFSW            DOES IT CONTAIN A COUNT         32200020
         BE    MORECORE                 NO, LAST COUNT                  32400020
         SR    SIX,SIX                                                  32600020
         IC    SIX,D5(X0,FIVE)          PICK UP KEY LENGTH              32800020
         AH    SIX,D6(X0,FIVE)             AND ADD DATA LENGTH          33000020
         LA    FIVE,D8(X0,FIVE)         ADDRESS OF NEXT COUNT FIELD     33200020
         CLR   SIX,EIGHT                IS THE NEW TOTAL THE GREATEST   33400020
         BNH   FINDMAX                  NO, GET NEXT TOTAL              33600020
         LR    EIGHT,SIX                PUT NEW HIGH IN COMPARE REG     33800020
         B     FINDMAX                  COMPLETE LOOP                   34000020
*********************************************************************** 34050002
*        GET CORE FOR LARGEST RECORD ON TRACK                   YL02912 34100002
*********************************************************************** 34150002
         SPACE                                                          34200020
MORECORE EQU   *                                                YM3004  34400002
         LA    EIGHT,D8(X0,EIGHT)       ADD 8 FOR COUNT                 35400020
*********************************************************************** 35650002
         MODESET EXTKEY=DATAMGT         KEY 5                   YL02912 35700002
*********************************************************************** 35750002
         GETMAIN R,LV=(8),SP=229        LARGEST RECORRD         YM3004  36000002
*                                          PLUS EIGHT                   36200020
         LTR   ADDREG,ADDREG            CHECK FOR GOTTEN CORE           36400020
         BZ    SAVE                     YES, CORE GOTTEN                36600020
         LA    FOUR,CC12                SET RETURN CODE FOR CORE NOT    36800020
*                                          AVAILABE                     37000020
         B     FREECORE                 EXIT TO ERROR LOAD              37200020
*********************************************************************** 37250002
*        CHECK IF OVERFLOW SPECIFIED                            YL02912 37300002
*********************************************************************** 37350002
CHEKSPEC TM    SWITCH,OVFLW             DID USER'S DCB SPECIFY TRACK    37400020
*                                          OVERFLOW                     37600020
         BNO   GOBACK                   NO, CONTINUE PROCESSING         37800020
         L     PARMB,USERPARM           PICK UP ADDRESS OF USER'S       38000020
*                                          PARAMETER LIST               38200020
         TM    D4(PARMB),BIT2           WAS WRITE SPECIAL INDICATED     38400020
         BO    SETSW                    YES, SET SWITCH                 38600020
         TM    D4(PARMB),BIT3           WAS 'NOT WRITE SPECIAL'         38800020
*                                          SPECIFIED                    39000020
         BNO   CNTERR                   NO, CAN'T HANDLE ERROR          39200020
*********************************************************************** 39250002
*        SPACE COUNT INFO                                       YL02912 39300002
*********************************************************************** 39350002
GOBACK   L     SIX,D0(X0,SIX)           PICK UP ADDRESS OF SPACE COUNT  39400020
         L     SIX,D0(X0,SIX)           PICK UP ADDRESS OF KEY LENGTH   39600020
*                                          IN COUNT TO BE SKIPPED       39800020
         A     SIX,FULL3                GET ADDRESS FO FLAG BYTE        40000020
         MVI   D0(SIX),FFSW             SET FLAG TO INDICATE END OF     40200020
*                                          COUNTS                       40400020
         B     FINDSIZE                 BRANCH TO GET MAXIMUM RECORD    40600020
*                                          SIZE                         40800020
SETSW    OI    SWITCH,BIT1              SET SWITCH TO INDICATE WRITE    41000020
*                                          SPECIAL IS REQUIRED          41200020
         B     GOBACK                   CONTINUE PROCESSING             41400020
*********************************************************************** 41500002
CNTERR   LA    FOUR,CC32                SET COMPLETION CODE FOR ERROR   41600020
*                                          IN COUNT FIELD OF LAST       41800020
*                                          RECORD ON THE TRACK          42000020
         B     FREECORE                 EXIT TO ERROR LOAD              42200020
SAVE     EQU   *                                                YM3004  42202002
*********************************************************************** 42210002
         MODESET EXTKEY=SUPR            KEY 0                   YL02912 42220002
*********************************************************************** 42230002
         ST    PARMB,SVRBEX             STORE ADDR OF CORE      YM3004  42240002
*********************************************************************** 42242002
         MODESET EXTKEY=DATAMGT         KEY 5                   YM3004  42244002
*********************************************************************** 42246002
         LR    NINE,PARMB               LOAD ADDR OF CORE       YM3004  42400002
         ST    NINE,RECADDR             SAVE THIS ADDRESS IN WORK AREA  42600020
         ST    EIGHT,RECCORE            SAVE NUMBER BYTES GOTTEN        42800020
*********************************************************************** 42900002
* THIS SECTION OF CODE DOES A PRELIMINARY READ HA OF THE ALTERNATE      43000020
* TRACK AND TESTS THE FLAG BYTE FOR A DEFECTIVE ALTERNATE INDICATION    43200020
* IF THE ALTERNATE IS NOT FLAGGED DEFECTIVE THEN CCWS ARE BUILT TO      43400020
* WRITE HOME ADDRESS AND R0 ON THE ALTERNATE. . A DEFECTIVE INDICATION  43600020
* CAUSES THE FORMAT 4 TO BE UPDATED TO DETERMINE THE NEXT AVAILABLE     43800020
* ALTERNATE TRACK                                                       44000020
*********************************************************************** 44100002
A        MVC   SEEK+D3(L4),DS4HCCHH     SET SEEK ADDRESS AND DEB EXTENT 44200020
         MVC   DEBSTRCC(L4),DS4HCCHH       TO REFLECT ADDRESS OF ALTER- 44400020
         MVC   DEBENDCC(L4),DS4HCCHH       NATE                         44600020
         XC    ECB(L4),ECB              CLEAR ECB                       44800020
         LA    FOUR,CCW1                                                45000020
         ST    FOUR,IOBSTART            STORE ADDRESS OF CHANNEL        45200020
*                                          PROGRAM INTO IOB START FIELD 45400020
         XC    IOBFLAG3(L8),IOBFLAG3    CLEAR CSW AND ERROR FLAGS       45600020
         LM    WORKE,SEVEN,CCWONE                                       45800020
         SR    EIGHT,EIGHT                                              46000020
         LA    EIGHT,SEEK+D3            PICK UP ADDRESS OF CCHH OF      46200020
*                                          ALTERNATE                    46400020
         ALR   WORKE,EIGHT                                              46600020
         LA    EIGHT,CHECKHA            PICK UP ADDRESS OF HOME ADDRESS 46800020
*                                         AREA                          47000020
         ALR   SIX,EIGHT                                                47200020
         LA    EIGHT,CCW1               PICK UP ADDRESS OF CCW TO TIC   47400020
*                                          TO                           47600020
         ALR   FOUR,EIGHT                                               47800020
         STM   WORKE,SEVEN,CCW1         STORE FIRST 3 CCW'S             48000020
         BAL   NINE,EXECUTE             DO READ HA                      48200020
         LA    NINE,GOODALT             SET BRANCH              XL03130 48202003
         AIF   ('&LIB' EQ 'LIB1').X225601                       XL03130 48210003
         CLI   DEVTAB+D3,D3350         IS IT 3350              @X50RSAG 48220003
         BE    SKIPWHA                 YES, SKIP WHA           @X50RSAG 48230003
         CLI   DEVTAB+D3,D3340         IS IT A 3340             XL03130 48250003
         BE    SKIPWHA                 YES,MUST NOT WRITE HA    XL03130 48300003
*********************************************************************** 48310002
*        SET UP FOR WHA                                         YL02912 48320002
*********************************************************************** 48330002
.X225601 ANOP                                                   XL03130 48350003
         OI    CCW3+D4,CCB              TURN ON COMMAND CHAINING BIT OF 48400020
*                                          READ HA                      48600020
         LM    WORKE,WORKO,CCWTHREE     PICK UP NEXT CCW                49400020
         LA    EIGHT,ALTHA              PICK UP ADDRESS OF HOME ADDRESS 49600020
*                                         TO BE WRITTEN                 49800020
         ALR   WORKE,EIGHT                                              50000020
         STM   WORKE,WORKO,CCW44        STORE NEXT CCW                  50200020
*********************************************************************** 50210002
*        BUILD CCWS                                             YL02912 50220002
*********************************************************************** 50230002
SKIPWHA  EQU   *                                                XL03130 50250003
         LM    WORKE,SEVEN,CCWFOUR      PICK UP LAST CCW'S              50400020
         LA    EIGHT,ALTR0              PICK UP ADDRESS OF R0 TO BE     50600020
*                                          WRITTEN                      50800020
         ALR   WORKE,EIGHT                                              51000020
         ALR   SIX,EIGHT                                                51200020
         LA    EIGHT,ALTHA              PICK UP ADDRESS OF HA           51400020
         ALR   FOUR,EIGHT                                               51600020
         AIF   ('&LIB' EQ 'LIB1').X225602                       XL03130 51610003
         CLI   DEVTAB+D3,D3350         IS IT 3350              @X50RSAG 51620003
         BE    YESMAD                  YES, DO IT TO IT        @X50RSAG 51630003
         CLI   DEVTAB+D3,D3340        IS IT A 3340              XL03130 51650003
         BNE   NOTWIN                  NO, ALL OTHER DEVICES    XL03130 51700003
YESMAD   EQU   *                                               @X50RSAG 51710003
         STM   WORKE,SEVEN,CCW3        STORE LAST 3 CCW'S       XL03130 51750003
         B     ISWIN                   CONTINUE                 XL03130 51760003
NOTWIN   EQU   *                                                XL03130 51770003
.X225602 ANOP                                                   XL03130 51780003
         STM   WORKE,SEVEN,CCW45        STORE NEXT 3 CCW'S              51800020
ISWIN    EQU   *                                                XL03130 51850003
         MVI   ALTHA,GDTRK              INDICATE HOME ADDRESS IS FOR    52000020
         MVC   ALTHA+D1(L4),DS4HCCHH       AN OPERATIVE ALTERNATE TRACK 52200020
         L     FOUR,USERPARM                                            52400020
         L     FOUR,D4(X0,FOUR)         PICK UP POINTER TO USER'S CCHH  52600020
         MVC   ALTR0(L16),R0            MOVE INTO NEW R0 THE ORIGINAL   52800020
*                                          PRIMARY TRACK ADDRESS FROM   53000020
*                                          R0 OF THE PRIMARY TRACK      53200020
         CLI   ERRTYPE,R0ERR            R0 PASSED BY UTILITY IN ERROR   53400020
         BNE   EXECUTE                  NO, R0 NOT PASSED BY UTILITY    53600020
*                                          AND IN ERROR                 53800020
         MVC   ALTR0(L8),D0(FOUR)       MOVE IN CALLER'S COUNT          54000020
*                                          PORTION OF R0                54200020
         MVI   ALTR0+D8,ZEROS           CLEAR DATA PORTION OF R0        54400020
         MVC   ALTR0+D9(L7),ALTR0+D8                                    54600020
*********************************************************************** 54650002
*        TAKE CARE OF HA/R0                                     YL02912 54700002
*********************************************************************** 54750002
EXECUTE  EXCP  IOB                      REWRITE HA & R0 ON ALTERNATE    54800020
         WAIT  1,ECB=ECB                WAIT FOR I/O COMPLETE           55000020
         TM    ECB,IOEROR               CHECK FOR AN I/O ERROR          55200020
         BO    SUCCESS                  NO, NO I/O ERROR                55400020
         LA    EIGHT,BITS8                                              55600020
         L     SEVEN,IOBFLAG3           PICK UP ADDRESS OF CCW IN ERROR 55800020
*                                          +8 FROM CSW IN IOB           56000020
         SR    SEVEN,EIGHT                                              56200020
         CLI   D0(SEVEN),SHA            CHECK FOR SEARCH HOME ADDRESS   56400020
*                                          ERROR                        56600020
         BE    LOWOIL                   YES, A SEARCH HOME ADDRESS      56800020
*                                          ERROR                        57000020
*********************************************************************** 57050002
*        REDUCE NUMBER OF ALTERNATES                            YL02912 57100002
*********************************************************************** 57150002
SECONDEN LH    EIGHT,NUMALT             PICK UP NUMBER OF ALTERNATES TO 57200020
*                                          BE TRIED                     57400020
         BCTR  EIGHT,X0                 REDUCE BY ONE                   57600020
         STH   EIGHT,NUMALT             STORE BACK NUMBER TO BE TRIED   57800020
         LTR   EIGHT,EIGHT              CHECK FOR MORE ALTERNATES       58000020
         BNZ   LOCATE                   YES, MORE ALTERNATES            58200020
         LA    FOUR,CC16                SET COMPLETION CODE TO 16       58400020
         OI    SWITCH,BIT4              SFT SWITCH TO INDICATE NO       58600020
*                                          ALTERNATES AVAILABLE         58800020
*********************************************************************** 58850002
*        EXIT                                                   YL02912 58900002
*********************************************************************** 58950002
FREECORE MVC   XCTLID(L2),ATLAS06       MOVE ERROR LOAD NAME IN         59000020
         MVC   TTR(L3),TTR6             MOVE ERROR LOAD TTR IN          59200020
XCTL     XC    XCTLPTR+D4(L4),XCTLPTR+D4 CLEAR SECOND WORD OF POINTER   59400020
         L     PARMB,PNTSNAP            GET SNAP LIST POINTER   YL02912 59430002
         LTR   PARMB,PARMB              SNAP MODE               YL02912 59460002
         BZ    NOSNAP                   NO - DONT SNAP          YL02912 59490002
         SNAP  ID=5,MF=(E,(1))          SNAP                    YL02912 59520002
NOSNAP   EQU   *                        *                       YL02912 59550002
         XCTL  ,MF=(E,(1)),SF=(E,XCTLPTR)                               59600020
*********************************************************************** 59700002
LOWOIL   LA    FOUR,CC36                SET COMPLETION CODE FOR 36-     59800020
*                                          SEARCH HOME ADDRESS ERROR    60000020
         B     FREECORE                 EXIT TO ERROR LOAD              60200020
LOCATE   LH    EIGHT,DS4HCCHH+D2       GET HH NEXT ASGNABLE    @X50RSAG 60250003
         AIF   ('&LIB' NE 'LIB1').X730510                       YL02912 60700002
.X730510 ANOP                                                   YL02912 65840002
*********************************************************************** 65880002
*        INCREMENT HEAD NUMBER                                  YL02912 65920002
*********************************************************************** 65960002
*                                          ALTERNATE                    66200020
         LA    EIGHT,D1(X0,EIGHT)       ADD ONE                         66400020
         CH    EIGHT,DS4DEVSZ+D2        COMPARE FOR NEED TO RESET       66600020
*                                       TRACK NUMBER TO ZERO            66800020
         BL    NOUP                     NO, TRACK NUMBER IS VALID       67000020
         XC    DS4HCCHH+D2(L2),DS4HCCHH+D2 SET TRACK NUMBER FO ZERO     67200020
         LH    EIGHT,DS4HCCHH                                           67400020
         LA    EIGHT,D1(X0,EIGHT)       INCREMENT CYLINDER NUMBER BY    67600020
         STH   EIGHT,DS4HCCHH              ONE                          67800020
REDUCE   LH    EIGHT,DS4NOATK           REDUCE NUMBER OF AVAILABLE      68000020
         BCTR  EIGHT,X0                    ALTERNATES BY ONE            68200020
         STH   EIGHT,DS4NOATK                                           68400020
         B     A                        TRY ANOTHER ALTERNATE           68600020
NOUP     STH   EIGHT,DS4HCCHH+D2        STORE NEW TRACK NUMBER          68800020
         B     REDUCE                   REDUCE NUMBER OF ALTERNATES     69000020
         AIF   ('&LIB' NE 'LIB1').X730511                       YL02912 69100002
STORE1   MVC   DS4HCCHH+D3(L1),SEEK+D6  MOVE IN NEW TRACK ADDRESS       69200020
         B     REDUCE                   REDUCE NUMBER OF ALTERNATES     69400020
STORE2   MVC   DS4HCCHH+D2(L1),SEEK+D5  MOVE IN NEW CYLINDER ADDRESS    69600020
         B     REDUCE                   REDUCE NUMBER OF ALTERNATES     69800020
STORE3   MVC   DS4HCCHH+D1(L1),SEEK+D4  MOVE IN NEW STRIP ADDRESS       70000020
         B     REDUCE                   REDUCE NUMBER OF ALTERNATES     70200020
.X730511 ANOP                                                   YL02912 70300002
SUCCESS  TM    CHECKHA,BADALT           IS ALTERNATE DEFECTIVE @ZA32949 70400099
         BO    SECONDEN                 YES, ALTERN IS DEFECT  @ZA32949 70450099
         BR    NINE                     BRANCH TO WRITE HA OR BRANCH    70800020
*                                          TO NEXT LOAD                 71000020
*********************************************************************** 71100002
GOODALT  EQU   *                                                        71200020
         MVC   XCTLID(L2),ATLAS05       MOVE NEXT LOAD NAME IN          71400020
         MVC   TTR(L3),TTR5             MOVE NEXT LOAD TTR IN           71600020
         B     XCTL                     EXIT TO NEXT LOAD MOUDLE        71800020
*********************************************************************** 71900002
CCWONE   CCW   X'39',0,X'40',4          SEARCH HOME ADDRESS             72000020
CCWTWO   CCW   X'08',0,X'40',0          TIC TO SEARCH HA                72200020
CCWTOA   CCW   X'1A',0,X'00',5          READ HOME ADDRESS               72400020
CCWTHREE CCW   X'19',0,X'40',5          WRITE HOME ADDRESS              72600020
CCWFOUR  CCW   X'15',0,X'40',16         WRITE R0                        72800020
CCWFIVE  CCW   X'1A',0,X'40',5          READ HOME ADDRESS               73000020
CCWSIX   CCW   X'16',0,X'10',16         READ R0                         73200020
*********************************************************************** 73300002
GETL     GETMAIN EC,MF=L                L FORM FOR BUFFER               73400020
CYLNO    DC    X'05'                    NUMBER OF CYLINDERS PER TRACK   73600020
*                                          FOR A 2321                   73800020
STRIPNO  DC    X'0A'                    NUMBER OF STRIPS PER SUBCELL    74000020
*                                          FOR A 2321                   74200020
FULL16   DC    F'16'                    *                               74400020
FULL8    DC    F'8'                     *                               74600020
FULL3    DC    F'3'                     *                               74800020
MAINT    DC    2CL25'IGG0860C MAINTENANCE AREA'                 YL02912 74900002
*********************************************************************** 74950002
         SPACE                                                          75000020
*XCTL BY TTR TABLE                                                      75200020
         SPACE                                                          75400020
         ORG   IGG0860C+1000            FIRST ORG                       75600020
         SPACE                                                          75800020
TTRTABLE EQU   *                                                        76000020
ATLAS05  DC    C'0D'                    ID OF NEXT LOAD                 76200020
TTR5     DC    X'00000000'              TTR OF NEXT LOAD                76400020
ATLAS06  DC    C'AE'                    ID OF ERROR LOAD                76600020
TTR6     DC    X'00000000'              TTR OF ERROR LOAD               76800020
         DC    X'0000'                  LAST TABLE ENTRY CODE           77000020
         ORG   IGG0860C+1020            SECOND ORG                      77200020
         DC    C'086'                   ATLAS SVC CODE                  77400020
         DC    X'7D'                    RELATIVE TABLE START ADDRESS    77600020
*                                          IN DOUBLE WORDS              77800020
*********************************************************************** 77900002
WORKDSCT DSECT                                                          78000020
SVRBEX   DS    1F                       SAVE AREA FOR SVRB EXTENSION    78200020
*                                          POINTER                      78400020
DEVTAB   DS    1F                       DEVICE TYPE INDICATOR FROM UCB  78600020
SWITCH   DS    CL1                      LOGIC SWITCH                    78800020
*                                       0 BIT INDICATES CHANNEL         79000020
*                                          PROGRAM NOT RE-EXECUTABLE    79200020
*                                       1 BIT INDICATES WRITE SPECIAL   79400020
*                                          REQUIRED                     79600020
*                                       2 BIT INDICATES TRACK OVERFLOW  79800020
*                                          DATA SET                     80000020
*                                       4 BIT INDICATES NO ALTERNATES   80200020
*                                          AVAILABLE                    80400020
*                                       6 BIT INDICATES AN ERROR ON     80600020
*                                          OTHER THAN THE ORIGINAL      80800020
*                                          ERROR RECORD                 81000020
*                                       7 BIT INDICATES VTOC HAS BEEN   81200020
*                                          ENQUEUED UPON                81400020
NUMBERR  DS    CL2                      NUMBER OF ERROR RECORDS         81600020
VTOCADR  DS    CL5                      VTOC ADDRESS CCHHR              81800020
SPLIT    DS    X'00'                    SPLIT CYLINDER SWITCH           82000020
RETPT    DS    1F                       POINTER TO NEXT ROUTINE         82200020
         DS    0F                                                       82400020
*********************************************************************** 82500002
         IECSDSL1 (4)                                                   82600020
*********************************************************************** 82700002
TICADDR  DS    1F                       ADDRESS OF TIC CCW IN NEW       82800020
*                                          CHANNEL PROGRAM              83000020
SAVEADDR DS    1F                       ADDRESS OF FIRST COUNT FIELD    83200020
CNTCORE  DS    1F                       NUMBER OF BYTES IN COUNT FIELD  83400020
*                                          WORK AREA                    83600020
COREADDR DS    1F                       ADDRESS OF COUNT FIELD          83800020
*                                          WORK AREA                    84000020
RECADDR  DS    1F                       ADDRESS OF CORE GOTTEN FOR      84200020
*                                          LONGEST RECORD SIZE          84400020
RECCORE  DS    1F                       NUMBER OF BYTES IN THIS AREA    84600020
DDNAME   DS    1D                      DDNAME SAVE AREA         XL03130 84650003
DEVINFO  DS    5F                      DEVICE INFO              XL03130 84700003
PARMUSER DS    1F                       POINTER USER PARM LIST  YL02912 84710002
PNTEST   DS    1F                       TEST MODE               YL02912 84710302
PNTSNAP  DS    1F                       SNAP MODE               YL02912 84710602
PNTSNS   DS    CL2                      SENSE BYTE - USER       YL02912 84711002
         DS    CL1                      FILLER                  YL02912 84712002
PNTMIOB  DS    CL1                      M OF IOB                YL02912 84713002
PNTIOB   DS    1F                       IOB POINTER             YL02912 84720002
PNTCNT   DS    1F                       COUNT POINTER           YL02912 84730002
PARMCNT  DS    2F                       COUNTS                  YL02912 84740002
PNTIOT   DS    CL2                      TIOT OFFSET             YL02912 84741002
         DS    CL1                      FILLER                  YL02912 84742002
PNTOFLO  DS    CL1                      TRACK OVERFLO           YL02912 84743002
PNTDEB   DS    1F                       DEB POINTER             YL02912 84744002
HOLDKEY  DS    1F                       USER KEY                YL02912 84750002
REGHOLD  DS    1F                       TEMP REG SAVE           YL02912 84760002
CNTADDR  DS    1F                       ADDRESS OF COUNT FIELD FOR      84800020
*                                          CCW IN ERROR                 85000020
ERRTYPE  DS    CL1                      TYPE OF ORIGINAL ERROR          85200020
RECNUMB  DS    1F                       R OF ERROR RECORDS              85400020
REGSAVE  DS    5F                       SAVE AREA FOR REGISTERS         85600020
ECB      DS    1F                       ECB                             85800020
IOB      DS    8F                       IOB                             86000020
IOBFLAG3 EQU   IOB+8                                                    86200020
IOBSTART EQU   IOB+16                                                   86400020
SEEK     DS    2F                       SEEK ADDRESS                    86600020
DEB      DS    12F                      DEB                             86800020
DEBSTRCC EQU   DEB+38                                                   87000020
DEBENDCC EQU   DEB+42                                                   87200020
DEBPTR   DS    F                        DCB SLOT                        87400020
MIELNAME DS    CL6                      VOLUME SERIAL SLOT              87600020
DCB      EQU   DEBPTR-44                                                87800020
R0AREA   DS    2D                       AREA FOR R0                     88000020
DEQAREA  DS    2D                       DEQ TABLE AREA                  88200020
MJELNAME DS    2F                       MAJOR QUEUE NAME AREA           88400020
ENQAREA  DS    2D                       ENQ TABLE AREA                  88600020
USERPARM DS    1F                       POINTER TO USER'S PARM LIST     88800020
NUMALT   DS    1H                       NUMBER OF ALTERNATES TO BE      89000020
*                                          TRIED                        89200020
MAXCOUNT DS    1H                       MAXIMUM NUMBER OF COUNT FIELDS  89400020
*                                          PER TRACK+1                  89600020
XCTLPTR  DS    2F                       PTR TO XCTL WORK AREA TABLE     89800020
XCTLAREA DS    0CL32                                                    90000020
XCTLNM   DS    CL6                      COMMON BYTES OF ATLAS NAME      90200020
XCTLID   DS    CL2                      ID OF ATLAS MODULE              90400020
         DS    CL6                      *                               90600020
TTR      DS    CL3                      TTR OF ATLAS MODULE             90800020
         DS    CL5                      *                               91000020
TTRATTB  DS    CL2                      ATTRIBUTES OF ATLAS - ALL LOADS 91200020
TTRCREQ  DS    CL3                      CORE REQUIREMENT OF ATLAS LOAD  91400020
TTRLNGTH DS    CL2                      LENGTH OF ATLAS LOAD            91600020
         DS    CL3                      *                               91800020
INCRMNT  DS    1F                       INCREMENT FOR READ COUNTS       92000020
PROGADDR DS    1F                       ADDRESS OF NEW CHANNEL PROGRAM  92200020
ALTHA    DS    2F                       ALTERNATE TRACK HOME ADDRESS    92400020
ALTR0    DS    4F                       ALTERNATE TRACK R0              92600020
*********************************************************************** 92700002
CCW1     DS    1D                       CCW AREA                        92800020
CCW2     DS    1D                       *                               93000020
CCW3     DS    1D                       *                               93200020
CCW44    DS    1D                       *                               93400020
CCW45    DS    1D                       *                               93600020
CCW56    DS    1D                       *                               93800020
CCW57    DS    1D                       *                               94000020
CCW31    DS    1D                       *                               94200020
CCW32    DS    1D                       *                               94400020
CCW33    DS    1D                       *                               94600020
CCW34    DS    1D                       *                               94800020
CCW35    DS    1D                       *                               95000020
CCW36    DS    1D                       *                               95200020
CCW37    DS    1D                       *                               95400020
CCW38    DS    1D                       *                               95600020
CCW39    DS    1D                       *                               95800020
CHECKHA  DS    2F                       AREA FOR HOME ADDRESS OF        96000020
*                                       ALTERNATE                       96200020
*                                                                       96400020
*********************************************************************** 96500002
CNTAREA  DSECT                                                          96600020
         DS    F                       FOR DBL WD ALGNMT.      @ZM40498 96610003
MADSD    DS    CL4                     3350 SKIP DISP          @X50RSPC 96650003
HOMEAD   DS    2F                       CCW AREA                        96800020
R0       DS    4F                       *                               97000020
CCW21    DS    2F                       *                               97200020
CCW22    DS    2F                       *                               97400020
CCW23    DS    2F                       *                               97600020
         END                                                            97800020
./  ADD  SSI=53040036,NAME=IGG0860D
         TITLE 'IGG0860D - FIFTH LOAD MODULE FOR SVC 86'         S20201 00100020
         COPY  LCGASMSW                                                 00200003
IGG0860D CSECT                                                          00250003
*                                                                       00300020
*                                                                       00400020
*                                                                       00500020
*          RELEASE 22 DELETIONS/CHANGES                                 00600020
*          RELEASE 21 DELETIONS/CHANGES                                 00700020
*          RELEASE 20 DELETIONS/CHANGES                                 00800020
*0792001000-002000,238000,359000-360000                          S20201 00850020
*                                                                       00900020
*STATUS CHANGE LEVEL 002                                                01000020
*                                                                       01100020
*TITLE 'IGG0860D' - FIFTH LOAD MODULE OF SVC 86                       * 01200020
*FUNCTION/OPERATION                                                   * 01300020
*   IGG0860D ESTABLISHES ITS OWN ADDRESSABILITY AND THAT OF ITS 688-  * 01400020
*BYTE WORK AREA.  BEING THE FIFTH LOAD MODULE OF SVC 86 THIS MODULE   * 01500020
*HAS FOUR MAJOR FUNCTIONS                                             * 01600020
*        1.  READS ALL RECORDS ON DEFECTIVE TRACK EXCEPT HOME         * 01700020
*            ADDRESS AND R0                                           * 01800020
*        2.  WRITES ALL RECORDS ON CHOSEN ALTERNATE TRACK             * 01900020
*        3.  FREES CORE FOR AREA FOR LARGEST RECORD, AREA FOR TRACK   * 02000020
*            DESCRIPTION CHANNEL PROGRAM AND COUNT FIELDS             * 02100020
*                                                                     * 02200020
*ENTRY POINT                                                          * 02300020
*   IGG0860D                                                          * 02400020
*                                                                     * 02500020
*INPUT                                                                * 02600020
*   INPUT CONSISTS OF A MAIN WORK AREA POINTED TO BY REGISTER 11,     * 02700020
*A WORK AREA FOR COUNT FIELDS AND TRACK DESCRIPTION CHANNEL PROGRAM   * 02800020
*POINTED TO BY REGISTER 10, AND A WORK AREA FOR THE LARGEST RECORD ON * 02900020
*THE DEFECTIVE TRACK POINTED TO BY REGISTER 9.                        * 03000020
*                                                                     * 03100020
*OUTPUT                                                               * 03200020
*   OUTPUT CONSISTS OF THE MAIN WORK AREA AND IN AN ERROR SITUATION   * 03300020
*ONE OF THE FOLLOWING RETURN CODES IN REGISTER FOUR                   * 03400020
*        16 - I/O ERROR IN ALTERNATE TRACK ASSIGNMENT                 * 03500020
*        20 - ERROR OTHER THAN DATA CHECK OR MISSING ADDRESS MARKER   * 03600020
*        40 - RECOVERABLE ERRORS ENCOUNTERED                          * 03700020
*        48 - NO ERRORS FOUND ON TRACK                                * 03800020
*                                                                     * 03900020
*EXTERNAL ROUTINES                                                    * 04000020
*   NONE                                                              * 04100020
*                                                                     * 04200020
*EXITS                                                                * 04300020
*   NORMAL - XCTL TO MODULE IGG086AE                                  * 04400020
*   ERROR - XCTL TO MODULE IGG086AE                                   * 04500020
*   ERROR ON ALTERNATE - XCTL TO MODULE IGG0860C                      * 04600020
*                                                                     * 04700020
* TABLES/WORK AREAS                                                   * 04800020
*   MAIN WORK AREA CONTAINING THE FORMAT 4 DSCB, MAXIMUM NUMBER OF    * 04900020
*COUNT FIELDS PER TRACK, A POINTER TO USER'S PARAMTER LIST, ECB, IOB, * 05000020
*DEB, AND DCB.                                                        * 05100020
*                                                                     * 05200020
*ATTRIBUTES                                                           * 05300020
*   REENTRANT, REFRESHABLE                                            * 05400020
*                                                                     * 05500020
*                                                                     * 05600020
*                                                                       05700020
*                                                                       05800020
*********************************************************************** 05900020
*                                                                     * 06000020
*                               EQUATES                               * 06100020
*                                                                     * 06200020
*********************************************************************** 06300020
BIT0     EQU   X'80'                                                    06400020
BIT1     EQU   X'40'                                                    06500020
BIT4     EQU   X'08'                                                    06600020
BIT6     EQU   X'02'                                                    06700020
BIT7     EQU   X'01'                                                    06800020
*********************************************************************** 06900020
*          COMPLETION CODES                                           * 07000020
*********************************************************************** 07100020
CC16     EQU   16                       ERROR IN ALTERNATE ASSIGNMENT   07200020
CC20     EQU   20                       NOT VALID ERROR CONDITION       07300020
CC40     EQU   40                       ALTERNATE ASSIGNED              07400020
CC48     EQU   48                       TRACK NOT FOUND DEFECTIVE       07500020
*********************************************************************** 07600020
*          DISPLACEMENT CONSTANTS                                     * 07700020
*********************************************************************** 07800020
D0       EQU   0                                                        07900020
D1       EQU   1                                                        08000020
D3       EQU   3                                                        08100020
D4       EQU   4                                                        08200020
D5       EQU   5                                                        08300020
D6       EQU   6                                                        08400020
D7       EQU   7                                                        08500020
D8       EQU   8                                                        08600020
*********************************************************************** 08700020
*          LENGTH CONSTANTS                                           * 08800020
*********************************************************************** 08900020
L1       EQU   1                                                        09000020
L2       EQU   2                                                        09100020
L3       EQU   3                                                        09200020
L4       EQU   4                                                        09300020
L5       EQU   5                                                        09400020
L8       EQU   8                                                        09500020
**********************************************************************  09520020
*        DEVICE EQUATES                                              *  09540020
**********************************************************************  09560020
D3330    EQU   X'09'                    3330 DEVICE TYPE         S20201 09580020
         AIF   ('&LIB' EQ 'LIB1').X225600                       XL03145 09582003
D3330C   EQU   X'0D'                   3330 C DEVICE            XL03145 09590003
D3340    EQU   X'0A'                   3340 DEVICE              XL03130 09590403
.X225600 ANOP                                                   XL03145 09592003
*********************************************************************** 09600020
*                                                                     * 09700020
*********************************************************************** 09800020
BITS8    EQU   8                                                        09900020
CCSKIP   EQU   X'50'                    COMMAND CHAIN & SKIP BITS       10000020
CNTLENG  EQU   X'08'                    COUNT LENGTH                    10100020
CSWOK    EQU   X'41'                                                    10200020
EOF      EQU   X'0D'                    END OF FILE                     10300020
ERRS3    EQU   X'03'                                                    10400020
FFSW     EQU   X'FF'                                                    10500020
IOEROR   EQU   X'20'                                                    10600020
OTHEROR  EQU   X'02'                                                    10700020
OUTEXTNT EQU   X'42'                    OUT OF EXTENT                   10800020
RCKD     EQU   X'1E'                    READ COUNT KEY DATA             10900020
RCNT     EQU   X'92'                    READ COUNT                      11000020
RKD      EQU   X'0E'                    READ KEY DATA                   11100020
SLISKP   EQU   X'30'                    SLI & SKIP BITS                 11200020
TIC      EQU   X'08'                                                    11300020
WSCKD    EQU   X'01'                    WRITE SPECIAL COUNT KEY DATA    11400020
X0       EQU   0                                                        11500020
ZEROS    EQU   X'00'                                                    11600020
*                                                                       11700020
*                                                                       11800020
*********************************************************************** 11850002
         EJECT                                                          11900020
* REGISTER ASSIGNMENTS                                                  12000020
*********************************************************************** 12050002
PARMA    EQU   0                        PARAMETER REGISTER              12100020
PARMB    EQU   1                        PARAMETER REGISTER              12200020
WORKE    EQU   2                        EVEN WORK REGISTER              12300020
WORKO    EQU   3                        ODD WORK REGISTER               12400020
FOUR     EQU   4                        RETURN CODE REGISTER            12500020
FIVE     EQU   5                        WORK REGISTER                   12600020
SIX      EQU   6                        *                               12700020
SEVEN    EQU   7                        *                               12800020
EIGHT    EQU   8                        *                               12900020
NINE     EQU   9                        *                               13000020
TEN      EQU   10                       *                               13100020
AREAREG  EQU   11                       MAIN WORK AREA REGISTER         13200020
BASEREG  EQU   12                       BASE REGISTER                   13300020
SAVEREG  EQU   13                       WORK REGISTER                   13400020
RETREG   EQU   14                       WORK REGISTER                   13500020
ADDREG   EQU   15                       COMPLETION CODE REGISTER        13600020
*********************************************************************** 13650002
         BALR  BASEREG,X0               ESTABLISH                       13700020
         USING BEGIN,BASEREG               OWN ADDRESSABILITY           13800020
         USING WORKDSCT,AREAREG         ESTABLISH ADDRESSABILITY FOR    13900020
*                                          WORK AREA                    14000020
         USING CNTAREA,TEN              ESTABLISH ADDRESSABILITY FOR    14100020
*                                          COUNT FIELD WORK AREA        14200020
*********************************************************************** 14220002
*        CHECK FOR ANY RECOVERABLE COUNT FIELD ERRORS                   14240002
*********************************************************************** 14260002
BEGIN    CLI   NUMBERR+D1,ZEROS         DID ANY RECOVERABLE COUNT FIELD 14300020
*                                          ERRORS OCCUR                 14400020
         BE    LD23                     NO,NO NEED TO RESET COUNTER     14500020
         XC    RECNUMB(L4),RECNUMB      CLEAR ERROR RECORD SAVE AREA    14600020
         XC    NUMBERR(L2),NUMBERR      RESET ERROR RECORD COUNTER TO   14700020
*                                          ZERO                         14800020
         OI    NUMBERR,BIT0             SET HIGH ORDER BIT TO INDICATE  14900020
*                                          RECOVERABLE COUNT ERRORS     15000020
LD23     LA    WORKO,CCW23              PICK UP ADDRESS OF FIRST READ   15100020
*                                         COUNT CCW                     15200020
         L     WORKE,SAVEADDR           PICK UP ADDRESS OF FIRST COUNT  15300020
*                                          FIELD                        15400020
         L     NINE,RECADDR             LOAD RECORD BUFFER ADDRESS      15500020
*********************************************************************** 15520002
*        GET LENGTHS                                                    15540002
*********************************************************************** 15560002
PICKLENT SR    SIX,SIX                                                  15600020
         ST    WORKO,CCWPTR             SAVE POINTER TO LAST MODIFIED   15700020
         IC    SIX,D5(WORKE)            PICK UP KEY LENGTH              15800020
*                                          CCW                          15900020
         AH    SIX,D6(X0,WORKE)         ADD DATA LENGTH                 16000020
*                                         KEY AND DATA                  16100020
*                                          COMMAND                      16200020
         LTR   SIX,SIX                  CHECK FOR END OF FILE           16300020
         BZ    WRITEREC                 YES, END OF FILE- SKIP READ OF  16400020
*********************************************************************** 16420002
*        SET UP CCWS                                                    16440002
*********************************************************************** 16460002
RELOCATE LM    FOUR,FIVE,ASCCW51        PICK UP READ COUNT KEY AND DATA 16500020
         ALR   FOUR,NINE                PUT IN BUFFER ADDRESS           16600020
         ALR   FIVE,SIX                 PUT IN RECORD LENGTH            16700020
         CLI   D0(WORKO),TIC            IS CCW A TIC                    16800020
         BNE   STORE                    NO, STORE CCW                   16900020
         L     SEVEN,D0(WORKO)          PICK UP ADDRESS OF SPACE COUNT  17000020
         LA    SEVEN,D8(SEVEN)          GET POINTER TO FOLLOWING TIC    17100020
         MVC   D8(L8,SEVEN),D0(SEVEN)   REPLACE RETURN TIC WITH         17200020
*                                          TIC TO SPACE COUNT           17300020
         S     FIVE,FULL8               SUBTRACT 8 FROM TOTAL LENGTH    17400020
*                                         FOR COUNT FIELD               17500020
         LA    FOUR,D8(X0,FOUR)         ADJUST ADDRESS FOR READ KD      17600020
         STM   FOUR,FIVE,D0(SEVEN)      STORE NEW READ KEY DATA CCW     17700020
         MVI   D0(SEVEN),RKD            SET TO READ KEY DATA ONLY       17800020
         ST    SEVEN,CCWPTR             SAVE POINTER TO LAST MODIFIED   17900020
*                                          CCW                          18000020
         B     PICKUP                   GET ADDRESS OF FIRST CCW        18100020
STORE    STM   FOUR,FIVE,D0(WORKO)      STORE READ COUNT KEY DATA CCW   18200020
         EJECT                                                          18300020
PICKUP   LA    FIVE,CCW21               PICK UP ADDRESS OF FIRST CCW    18400020
*                                          FOR IOB START ADDRESS        18500020
         MVC   SEEK+D3(L4),HOMEAD+D1    MOVE IN SEEK ADDRESS FOR BAD    18600020
*                                          TRACK                        18700020
         BAL   SEVEN,SETUP              EXECUTE CHANNEL PROGRAM         18800020
         CLI   D0(WORKO),TIC            WAS READ COUNT REPLACED         18900020
*                                          BY A TIC                     19000020
         BNE   IOERR                    NO,TEST FOR I/O ERROR           19100020
         L     SEVEN,CCWPTR             POINTER TO READ KD CCW          19200020
         MVC   D0(L8,SEVEN),D8(SEVEN)   REPLACE WITH TIC CCW            19300020
IOERR    TM    ECB,IOEROR               CHECK FOR I/O ERROR             19400020
         BO    WRITEREC                 NO, I/O SUCCESSFUL              19500020
         CLI   ECB,CSWOK                ARE CSW CONTENTS USEFUL         19600020
         BE    ERR41                    YES,CSW CONTENTS ARE VALID      19700020
         CLI   ECB,OUTEXTNT             TEST FOR INDICATION THAT THE    19800020
*********************************************************************** 19850002
* ERROR IS A RESULT OF READING AN OVERFLOW RECORD AND HAVING ONLY A     19900020
* SINGLE TRACK DEB EXTENT.  IF SO, THEN THE CSW CONTENTS CAN BE         20000020
* CONSIDERED RELIABLE                                                   20100020
*********************************************************************** 20150002
         BNE   SETERCD                  ERROR CAN NOT BE HANDLED        20200020
ERR41    EQU   *                                                        20300020
         LA    SEVEN,BITS8                                              20400020
         L     FIVE,IOBFLAG3            PICK UP ADDRESS OF CCW IN       20500020
*                                          ERROR +8 FROM CSW            20600020
         SR    FIVE,SEVEN                                               20700020
         CLI   IOBCSWST,EOF             END OF FILE                     20800020
         BE    EOFSTOP                  YES, END OF FILE                20900020
         CLI   NUMBERR+D1,ERRS3         HAVE THERE BEEN THREE ERROR     21000020
*                                          RECORDS                      21100020
         BE    VALIDCHK                 CONTINUE PROCESSING BUT DO NOT  21200020
*                                          SAVE ERROR RECORD NUMBERS    21300020
         XR    EIGHT,EIGHT              CLEAR REGISTER                  21400020
         IC    EIGHT,NUMBERR+D1         PICK UP NUMBER OF ERROR RECORDS 21500020
         A     EIGHT,FULL1              INCREMENT BY ONE                21600020
         STC   EIGHT,NUMBERR+D1                                         21700020
         LA    SEVEN,RECNUMB            ADDRESS OF ERROR SAVE AREA      21800020
         ALR   EIGHT,SEVEN              GET DISPLACEMENT INTO RECNUMB   21900020
         MVC   D0(L1,EIGHT),D4(WORKE)   MOVE ERROR RECORD NUMBER TO     22000020
*                                          RECNUMB SAVE AREA            22100020
*********************************************************************** 22120002
*        CHECK FOR VALID ERROR                                          22140002
*********************************************************************** 22160002
VALIDCHK TM    IOBCSWST,BIT6            DID UNIT CHECK OCCUR            22200020
         BNO   SETERCD                  NO, UNIT CHECK DID NOT OCCUR    22300020
         TM    IOBSENS0,BIT4            CHECK IOB SENSE BYTE FOR A      22400020
*                                          DATA CHECK                   22500020
         BO    DATACK                   YES, DATA CHECK                 22600020
         TM    IOBSENS1,BIT6            CHECK FOR MISSING ADDRESS       22700020
*                                          MARKER                       22800020
         BO    CHECKM                   YES, MISSING ADDRESS MARKER     22900020
         TM    IOBSENS1,BIT7            CHECK FOR OVERFLOW INCOMPLETE   23000020
         BO    WRITEREC                 YES, TAKE CARE OF SITUATION     23100020
*                                          IN ANOTHER SECTION (LASTREC) 23200020
*********************************************************************** 23220002
*        GET OUT                                                        23240002
*********************************************************************** 23260002
SETERCD  LA    FOUR,CC20                SET COMPLETION CODE             23300020
ERNAME   MVC   XCTLID(L2),ATLAS06       MOVE ERROR LOAD NAME IN         23400020
         MVC   TTR(L3),TTR6             MOVE ERROR LOAD TTR IN          23500020
XCTL     XC    XCTLPTR+D4(L4),XCTLPTR+D4  CLEAR SECOND WORD OF POINTER  23600020
         L     PARMB,PNTSNAP            GET SNAP LIST POINTER   YL02912 23610002
         LTR   PARMB,PARMB              SNAP MODE               YL02912 23620002
         BZ    NOSNAP                   NO - DONT SNAP          YL02912 23630002
         SNAP  ID=6,MF=(E,(1))          SNAP                    YL02912 23640002
NOSNAP   EQU   *                        *                       YL02912 23650002
         XCTL  ,MF=(E,(1)),SF=(E,XCTLPTR)                               23700020
*********************************************************************** 23720002
CHECKM   CLI   DEVTAB+D3,D3330          CHECK FOR 3330           S20201 23740020
         BNL   SETERCD                  BRCH IF 3330,3340,3350 @ZM40498 23780030
         TM    IOBSENS1,BIT4            CHECK FOR NOT REGULAR    S20201 23820020
*                                       MISSING                  S20201 23860020
*                                          ADDRESS MARKER               23900020
         BO    SETERCD                  YES, NOT NORMAL MISSING         24000020
*                                          ADDRESS MARKER               24100020
         TM    IOBSENS0,BIT7            CHECK FOR BALLAST CELL NOT      24200020
*                                          FOUND                        24300020
         BO    SETERCD                  YES, NOT A NORMAL MISSING       24400020
*                                          ADDRESS MARKER               24500020
*********************************************************************** 24520002
*        CHECK FOR READ COUNT KEY DATA OR READ KEY                      24540002
*********************************************************************** 24560002
DATACK   CLI   D0(FIVE),RCKD            CHECK FOR CCW BEING A READ      24600020
*                                          COUNT KEY DATA               24700020
         BNE   USERREC                  NO,CCW IS READ KEY DATA         24800020
         MVI   D0(FIVE),RCNT            CHANGE READ COUNT KEYDATA TO    24900020
*                                       READ COUNT                      25000020
         MVI   D7(FIVE),CNTLENG         SET LENGTH TO 8                 25100020
         MVI   D6(FIVE),ZEROS                                           25200020
USERREC  L     FOUR,USERPARM            LOAD PARAMETER LIST ADDRESS     25300020
         TM    D4(FOUR),BIT1            WAS ONLY CCHH PASSED BY USER    25400020
         BO    WRITEREC                 YES,USER HAS NOT PASSED         25500020
*                                          FULL COUNT                   25600020
         L     FOUR,D4(FOUR)            LOAD ADDRESS OF COUNT FIELD     25700020
         CLC   D0(L5,WORKE),D0(FOUR)    IS THIS THE ERROR RECORD        25800020
*                                          PASSED BY CALLER             25900020
         BE    WRITEREC                 YES,CALLER'S RECORD             26000020
         OI    SWITCH,OTHEROR           SET SWITCH TO INDICATE ERROR    26100020
*                                          ENCOUNTERED IN OTHER THAN    26200020
*                                          RECORD PASSED                26300020
*********************************************************************** 26320002
*        WRITE RECORD                                                   26340002
*********************************************************************** 26360002
WRITEREC MVC   D0(L8,NINE),D0(WORKE)    MOVE IN COUNT FIELD TO BE       26400020
*                                          WRITTEN                      26500020
         LM    FOUR,FIVE,CPCCW1         PICK UP FIRST CCW               26600020
         ALR   FOUR,AREAREG             RE-ADJUST POINTER               26700020
         STM   FOUR,FIVE,CCW1           STORE IN FIRST AND FOURTH SLOTS 26800020
         STM   FOUR,FIVE,CCW44                                          26900020
         LM    FOUR,FIVE,CPCCW2         PICK UP SECOND CCW              27000020
         LA    PARMB,CCW1                                               27100020
         ALR   FOUR,PARMB               RE-ADJUST POINTER               27200020
         STM   FOUR,FIVE,CCW2                                           27300020
         LM    FOUR,FIVE,CPCCW3         PICK UP THIRD CCW               27400020
         ALR   FOUR,NINE                RE-ADJUST POINTER               27500020
         ALR   FIVE,SIX                 ADJUST LENGTH                   27600020
         STM   FOUR,FIVE,CCW3                                           27700020
         LM    FOUR,FIVE,CPCCW2         PICK UP FIFTH CCW               27800020
         LA    PARMB,CCW44                                              27900020
         ALR   FOUR,PARMB               RE-ADJUST POINTER               28000020
         STM   FOUR,FIVE,CCW45                                          28100020
         LM    FOUR,FIVE,CPCCW4         PICK UP SIXTH CCW               28200020
         ALR   FOUR,NINE                                                28300020
         ALR   FIVE,SIX                 RE-ADJUST LENGTH                28400020
         STM   FOUR,FIVE,CCW56                                          28500020
         IC    FOUR,D4(NINE)            PICK UP RECORD NUMBER           28600020
         BCTR  FOUR,X0                  REDUCE RECORD NUMBER BY ONE     28700020
         STC   FOUR,SEARCH+D4           STORE RECORD NUMBER TO BE USED  28800020
*                                          FOR SEARCH                   28900020
         MVC   SEARCH(L4),D0(NINE)      MOVE IN CCHH FOR SEARCH         29000020
NOTSET   LA    FIVE,CCW1                PICK UP ADDRESS OF FIRST CCW    29100020
*                                          FOR IOB START ADDRESS        29200020
         MVC   SEEK+D3(L4),DS4HCCHH     MOVE IN CCHH OF ALTERNATE       29300020
         BAL   SEVEN,SETUP              SET UP CONTROL BLOCKS           29400020
         TM    ECB,IOEROR               CHECK FOR IO ERROR              29500020
         BO    GREAT                    YES, NO I/O ERROR               29600020
         CLI   IOBCSWST,EOF             IS CONDITION END OF FILE        29700020
         BE    GREAT                    YES, END OF FILE (OK)           29800020
*********************************************************************** 29820002
*        EXIT                                                           29840002
*********************************************************************** 29860002
SETBACK  LA    FOUR,CC16                SET CODE IN FOUR AND XCTL TO    29900020
*                                          IGG0860C                     30000020
         MVC   XCTLID(L2),ATLAS04       MOVE PREVIOUS LOAD NAME IN      30100020
         MVC   TTR(L3),TTR4             MOVE PREVIOUS LOAD TTR IN       30200020
         B     XCTL                     EXIT TO APPROPRIATE MODULE      30300020
*********************************************************************** 30350002
GREAT    CLI   D8(WORKE),FFSW           CHECK FOR LAST COUNT FIELD      30400020
         BE    LASTREC                  YES,LAST RECORD                 30500020
         L     SIX,CCWPTR               PICK UP POINTER TO LAST CCW     30600020
*                                          MODIFIED                     30700020
         OI    D4(SIX),CCSKIP           TURN ON COMMAND CHAIN AND SKIP  30800020
*                                          FLAGS IN RKD COMMAND         30900020
         LA    WORKE,D8(X0,WORKE)       BUMP COUNT FIELD POINTER        31000020
         LA    WORKO,D8(X0,WORKO)       BUMP CCW POINTER                31100020
         B     PICKLENT                 PICK UP NEXT RECORD             31200020
*********************************************************************** 31250002
* THIS SECTION RE-READS THE LAST RECORD ON THE 'BAD' TRACK TO SEE IF A  31300020
* WRITE SPECIAL COUNT KEYDATA IS NEEDED, UNLESS IT IS AN EOF RECORD.    31400020
*********************************************************************** 31450002
LASTREC  EQU   *                                                        31500020
         OC    D6(L2,WORKE),D6(WORKE)   DATA LENGTH = ZERO              31600020
         BZ    ENDUP                    YES, EXIT                       31700020
         L     FOUR,CCWPTR              GET POINTER TO LAST READ CCW    31800020
         CLI   D0(FOUR),RCNT            IS LAST CCW A RC                31900020
         BNE   NOTRC                    NO, GO ON                       32000020
         MVI   D0(FOUR),RCKD            REPLACE RC WITH RCKD CCW        32100020
         XR    EIGHT,EIGHT              CLEAR REGISTER                  32200020
         IC    EIGHT,D5(WORKE)          LOAD KEY LENGTH                 32300020
         AH    EIGHT,D6(WORKE)          ADD DATA LENGTH                 32400020
         ST    EIGHT,D4(FOUR)           STORE KEY DATA LENGTH IN CCW    32500020
NOTRC    EQU   *                                                        32600020
         CLI   D0(FOUR),TIC             IS LAST CCW A TIC               32700020
         BNE   NOTIC                    NO, WAS A READ CKD              32800020
         XR    EIGHT,EIGHT              CLEAR REGISTER                  32900020
         IC    EIGHT,D5(WORKE)          LOAD KEY LENGTH                 33000020
         AH    EIGHT,D6(WORKE)          ADD DATA LENGTH                 33100020
         ST    EIGHT,D4(FOUR)           STORE KEY DATA LENGTH IN CCW    33200020
         MVI   D0(FOUR),RKD             REPLACE TIC WITH READ KD        33300020
NOTIC    EQU   *                                                        33400020
         TM    SWITCH,BIT1              IS WRITE SPECIAL REQUIRED       33500020
         BO    WRITSPEC                 YES, SET UP CHANNEL PROGRAM     33600020
         L     EIGHT,D4(FOUR)           LOAD LENGTH PROTION OF CCW      33700020
         LA    EIGHT,D1(EIGHT)          ADD ONE TO FORCE OVERFLOW       33800020
*                                          INCOMPLETE                   33900020
         ST    EIGHT,D4(FOUR)           STORE LENGTH                    34000020
         OI    D4(FOUR),SLISKP          TURN ON SKIP AND SLI BITS       34100020
         LA    FIVE,CCW21               PICK UP ADDRESS OF FIRST CCW    34200020
*                                          FOR IOB START ADDRESS        34300020
         MVC   SEEK+D3(L4),HOMEAD+D1    MOVE IN SEEK ADDRESS FOR BAD    34400020
*                                          TRACK                        34500020
         BAL   SEVEN,SETUP              EXECUTE CHANNEL PROGRAM         34600020
         TM    IOBSENS1,BIT7            CHECK FOR OVERFLOW INCOMPLETE   34700020
         BNO   ENDUP                    NO, BRANCH TO EXIT ROUTINE      34800020
*********************************************************************** 34850002
* THIS SECTION IS ENTERED IF A WRITE SPECIAL IS REQUIRED                34900020
*********************************************************************** 34950002
WRITSPEC MVI   CCW3,WSCKD               CHANGE WRITE COUNT KEY DATA CCW 35000020
*                                          TO A WRITE SPECIAL CCW       35100020
         LA    FIVE,CCW1                LOAD ADDRESS OF FIRST CCW FOR   35200020
*                                          IOB START ADDRESS            35300020
         MVC   SEEK+D3(L4),DS4HCCHH     MOVE IN SEEK ADDRESS OF         35400020
*                                          ALTERNATE                    35500020
         BAL   SEVEN,SETUP              EXECUTE CHANNEL PROGRAM         35600020
         TM    ECB,IOEROR               CHECK FOR I/O ERROR             35700020
         BO    ENDUP                    NO I/O ERROR                    35800020
         TM    IOBSENS1,BIT7            CHECK FOR OVERFLOW       S20201 35870020
*                                       INCOMPLETE               S20201 35940020
         BNO   SETBACK                  NOT OVERFLOW INCOMPLETE  S20201 36010020
*********************************************************************** 36030002
*        FREE CORE                                                      36050002
*********************************************************************** 36070002
ENDUP    L     WORKE,RECCORE            NUMBER OF BYTES TO BE   YL02912 36100002
*                                          FREED                        36200020
         L     PARMB,RECADDR            LOAD POINTER TO CORE TO BE      36300020
*                                          FREED                        36400020
         FREEMAIN R,LV=(2),A=(1),SP=229                         YL02912 36500002
         XC    RECADDR(L8),RECADDR                                      36600020
         SR    FOUR,FOUR                SET REGISTER FOUR TO INDICATE   36700020
*                                         NORMAL ENTRY INTO LAST LOAD   36800020
         L     SIX,USERPARM             ADDRESS OF PARAMETER LIST       36900020
         TM    NUMBERR,BIT0             WERE THERE ANY RECOVERABLE      37000020
*                                          COUNT FIELD ERRORS           37100020
         BO    ISO                      YES,AN ALTERNATE MUST BE        37200020
*                                          ASSIGNED                     37300020
         CLI   NUMBERR+D1,ZEROS         WERE THERE ANY ERRORS IN KEY/   37400020
*                                          DATA FIELDS                  37500020
         BNE   ANYR                     YES,WAS A FULL COUNT SPECIFIED  37600020
         LA    FOUR,CC48                SET RETURN CODE FOR NO ERRORS   37700020
         B     NEXT                        FOUND ON TRACK               37800020
ISO      CLI   NUMBERR+D1,ZEROS         WERE THERE ANY ERRORS IN KEY/   37900020
*                                          DATA FIELDS                  38000020
         BE    NEXT                     NO,RETURN CODE IS SET FOR       38100020
*                                          SUCCESSFUL COMPLETION        38200020
ANYR     TM    D4(SIX),BIT1             WAS ONLY CCHH PASSED            38300020
         BO    OTHERR                   YES,RETURN CODE IS 40           38400020
         TM    SWITCH,OTHEROR           WAS THERE AN ERROR ON OTHER     38500020
*                                          THAN THE USER SPECIFIED      38600020
*                                          RECORD                       38700020
         BZ    NEXT                     NO,RETURN CODE IS ZERO          38800020
OTHERR   LA    FOUR,CC40                SET RETURN CODE FOR ERROR/      38900020
*                                          ERRORS ENCOUNTERED,AN        39000020
*                                          ALTERNATE IS ASSIGNED        39100020
NEXT     MVC   XCTLID(L2),ATLAS06       MOVE NEXT LOAD NAME IN          39200020
         MVC   TTR(L3),TTR6             MOVE NEXT LOAD TTR IN           39300020
         B     XCTL                     EXIT                            39400020
*********************************************************************** 39420002
*        WRITE/READ RECORD                                              39440002
*********************************************************************** 39460002
SETUP    ST    FIVE,IOBSTART            STORE ADDRESS OF FIRST CCW      39500020
         MVC   DEBSTRCC(L4),SEEK+D3     SET UP DEB EXTENTS              39600020
         MVC   DEBENDCC(L4),SEEK+D3                                     39700020
         XC    ECB(L4),ECB              CLEAR ECB                       39800020
         XC    IOBFLAG3(L8),IOBFLAG3    CLEAR SENSE BYTES               39900020
         EXCP  IOB                      WRITE/READ RECORD               40000020
         WAIT  1,ECB=ECB                WAIT FOR I/O COMPLETE           40100020
         BR    SEVEN                    RETURN TO CALLER                40200020
EOFSTOP  EQU   *                                                        40300020
         CLI   D0(FIVE),RCKD            CHECK FOR CCW BEING READ CKD    40400020
         BNE   ISRKD                    NO,CCW IS A RKD                 40500020
         MVI   D0(FIVE),RCNT            CHANGE RCKD TO RC               40600020
         MVI   D7(FIVE),CNTLENG         SET LENGTH TO 8                 40700020
         NI    D6(FIVE),ZEROS                                           40800020
ISRKD    B     WRITEREC                 EVERYTHING OK                   40900020
*********************************************************************** 40950002
CPCCW1   CCW   X'31',SEARCH-SVRBEX,X'40',5  SEARCH ID EQUAL             41000020
CPCCW2   CCW   X'08',0,X'40',0          TIC                             41100020
CPCCW3   CCW   X'1D',0,X'40',8          WRITE COUNT, KEY,DATA           41200020
CPCCW4   CCW   X'1E',0,X'10',8          READ COUNT,KEY,DATA             41300020
ASCCW51  CCW   X'1E',0,X'00',8          READ COUNT KEY DATA             41400020
SPACECT  CCW   X'0F',0,X'40',3          SPACE COUNT                     41500020
CCWNOP   CCW   X'03',CCW31-SVRBEX,X'60',1  NO-OP                        41600020
*********************************************************************** 41630002
*********************************************************************** 41660002
         EJECT                                                          41700020
         SPACE                                                          41800020
FULL8    DC    F'8'                     *                               41900020
FULL1    DC    F'1'                     *                               42000020
MAINT    DC    2CL25'IGG0860D MAINTENANCE AREA'                 YL02912 42050002
*XCTL BY TTR TABLE                                                      42100020
         SPACE                                                          42200020
         ORG   IGG0860D+1000            FIRST ORG                       42300020
         SPACE                                                          42400020
TTRTABLE EQU   *                                                        42500020
ATLAS04  DC    C'0C'                    ID OF PREVIOUS LOAD             42600020
TTR4     DC    X'00000000'              TTR OF PREVIOUS LOAD            42700020
ATLAS06  DC    C'AE'                    ID OF ERROR/NEXT LOAD           42800020
TTR6     DC    X'00000000'              TTR OF ERROR/NEXT LOAD          42900020
         DC    X'0000'                  LAST TABLE ENTRY CODE           43000020
         ORG   IGG0860D+1020            SECOND ORG                      43100020
         DC    C'086'                   ATLAS SVC CODE                  43200020
         DC    X'7D'                    RELATIVE TABLE START ADDRESS    43300020
*                                          IN DOUBLE WORDS              43400020
*********************************************************************** 43450002
WORKDSCT DSECT                                                          43500020
SVRBEX   DS    1F                       SAVE AREA FOR SVRB EXTENSION    43600020
*                                          POINTER                      43700020
DEVTAB   DS    1F                       DEVICE TYPE INDICATOR FROM UCB  43800020
SWITCH   DS    CL1                      LOGIC SWITCH                    43900020
*                                       0 BIT INDICATES CHANNEL         44000020
*                                          PROGRAM NOT RE-EXECUTABLE    44100020
*                                       1 BIT INDICATES WRITE SPECIAL   44200020
*                                          REQUIRED                     44300020
*                                       2 BIT INDICATES TRACK OVERFLOW  44400020
*                                          DATA SET                     44500020
*                                       4 BIT INDICATES NO ALTERNATES   44600020
*                                          AVAILABLE                    44700020
*                                       6 BIT INDICATES AN ERROR ON     44800020
*                                          OTHER THAN THE ORIGINAL      44900020
*                                          ERROR RECORD                 45000020
*                                       7 BIT INDICATES VTOC HAS BEEN   45100020
*                                          ENQUEUED UPON                45200020
NUMBERR  DS    CL2                      NUMBER OF ERROR RECORDS         45300020
VTOCADR  DS    CL5                      VTOC ADDRESS CCHHR              45400020
SPLIT    DS    X'00'                    SPLIT CYLINDER SWITCH           45500020
RETPT    DS    1F                       POINTER TO NEXT ROUTINE         45600020
*********************************************************************** 45650002
         DS    0F                                                       45700020
         IECSDSL1 (4)                                                   45800020
*********************************************************************** 45850002
TICADDR  DS    1F                       ADDRESS OF TIC CCW IN NEW       45900020
*                                          CHANNEL PROGRAM              46000020
SAVEADDR DS    1F                       ADDRESS OF FIRST COUNT FIELD    46100020
CNTCORE  DS    1F                       NUMBER OF BYTES IN COUNT FIELD  46200020
*                                          WORK AREA                    46300020
COREADDR DS    1F                       ADDRESS OF COUNT FIELD          46400020
*                                          WORK AREA                    46500020
RECADDR  DS    1F                       ADDRESS OF CORE GOTTEN FOR      46600020
*                                          LONGEST RECORD SIZE          46700020
RECCORE  DS    1F                       NUMBER OF BYTES IN THIS AREA    46800020
DDNAME   DS    1D                      DDNAME SAVE AREA         XL03130 46850003
DEVINFO  DS    5F                      DEVICE INFO              XL03130 46860003
PARMUSER DS    1F                       POINTER USER PARM LIST  YL02912 46865002
PNTEST   DS    1F                       TEST MODE               YL02912 46865302
PNTSNAP  DS    1F                       SNAP MODE               YL02912 46865602
PNTSNS   DS    CL2                      SENSE BYTE - USER       YL02912 46866002
         DS    CL1                      FILLER                  YL02912 46867002
PNTMIOB  DS    CL1                      M OF IOB                YL02912 46868002
PNTIOB   DS    1F                       IOB POINTER             YL02912 46870002
PNTCNT   DS    1F                       COUNT POINTER           YL02912 46875002
PARMCNT  DS    2F                       COUNTS                  YL02912 46880002
PNTIOT   DS    CL2                      TIOT OFFSET             YL02912 46881002
         DS    CL1                      FILLER                  YL02912 46882002
PNTOFLO  DS    CL1                      TRACK OVERFLO           YL02912 46883002
PNTDEB   DS    1F                       DEB POINTER             YL02912 46884002
HOLDKEY  DS    1F                       USER KEY                YL02912 46885002
REGHOLD  DS    1F                       TEMP REG SAVE           YL02912 46890002
CNTADDR  DS    1F                       ADDRESS OF COUNT FIELD FOR      46900020
*                                          CCW IN ERROR                 47000020
ERRTYPE  DS    CL1                      TYPE OF ORIGINAL ERROR          47100020
RECNUMB  DS    1F                       R OF ERROR RECORDS              47200020
REGSAVE  DS    5F                       SAVE AREA FOR REGISTERS         47300020
*********************************************************************** 47350002
ECB      DS    1F                       ECB                             47400020
IOB      DS    8F                       IOB                             47500020
IOBSENS0 EQU   IOB+2                                                    47600020
IOBSENS1 EQU   IOB+3                                                    47700020
IOBFLAG3 EQU   IOB+8                                                    47800020
IOBCSWST EQU   IOB+12                                                   47900020
IOBSTART EQU   IOB+16                                                   48000020
SEEK     DS    2F                       SEEK ADDRESS                    48100020
DEB      DS    12F                      DEB                             48200020
DEBSTRCC EQU   DEB+38                                                   48300020
DEBENDCC EQU   DEB+42                                                   48400020
DEBPTR   DS    F                        DCB SLOT                        48500020
MIELNAME DS    CL6                      VOLUME SERIAL SLOT              48600020
DCB      EQU   DEBPTR-44                                                48700020
R0AREA   DS    2D                       AREA FOR R0                     48800020
DEQAREA  DS    2D                       DEQ TABLE AREA                  48900020
MJELNAME DS    2F                       MAJOR QUEUE NAME AREA           49000020
ENQAREA  DS    2D                       ENQ TABLE AREA                  49100020
USERPARM DS    1F                       POINTER TO USER'S PARM LIST     49200020
NUMALT   DS    1H                       NUMBER OF ALTERNATES TO BE      49300020
*                                          TRIED                        49400020
MAXCOUNT DS    1H                       MAXIMUM NUMBER OF COUNT FIELDS  49500020
*                                          PER TRACK+1                  49600020
XCTLPTR  DS    2F                       PTR TO XCTL WORK AREA TABLE     49700020
XCTLAREA DS    0CL32                                                    49800020
XCTLNM   DS    CL6                      COMMON BYTES OF ATLAS NAME      49900020
XCTLID   DS    CL2                      ID OF ATLAS MODULE              50000020
         DS    CL6                      *                               50100020
TTR      DS    CL3                      TTR OF ATLAS MODULE             50200020
         DS    CL5                      *                               50300020
TTRATTB  DS    CL2                      ATTRIBUTES OF ATLAS - ALL LOADS 50400020
TTRCREQ  DS    CL3                      CORE REQUIREMENT OF ATLAS LOAD  50500020
TTRLNGTH DS    CL2                      LENGTH OF ATLAS LOAD            50600020
         DS    CL3                      *                               50700020
INCRMNT  DS    1F                       INCREMENT FOR READ COUNTS       50800020
PROGADDR DS    1F                       ADDRESS OF NEW CHANNEL PROGRAM  50900020
ALTHA    DS    2F                       ALTERNATE TRACK HOME ADDRESS    51000020
ALTR0    DS    4F                       ALTERNATE TRACK R0              51100020
*********************************************************************** 51150002
CCW1     DS    1D                       CCW AREA                        51200020
CCW2     DS    1D                       *                               51300020
CCW3     DS    1D                       *                               51400020
CCW44    DS    1D                       *                               51500020
CCW45    DS    1D                       *                               51600020
CCW56    DS    1D                       *                               51700020
CCW57    DS    1D                       *                               51800020
CCW31    DS    1D                       *                               51900020
CCW32    DS    1D                       *                               52000020
CCW33    DS    1D                       *                               52100020
CCW34    DS    1D                       *                               52200020
CCW35    DS    1D                       *                               52300020
CCW36    DS    1D                       *                               52400020
CCW37    DS    1D                       *                               52500020
CCW38    DS    1D                       *                               52600020
CCW39    DS    1D                       *                               52700020
CHECKHA  DS    2F                       AREA FOR HOME ADDRESS OF        52800020
*                                       ALTERNATE                       52900020
SEARCH   DS    1D                       SEARCH RECORD ID                53000020
CCWPTR   DS    1F                       CCW POINTER                     53100020
*                                                                       53200020
*********************************************************************** 53250002
CNTAREA  DSECT                                                          53300020
         DS    F                        FOR DBL WD ALGNMT      @ZM40498 53350030
MADSD    DS    CL4                      1ST 4 3350 SD BYTES    @ZM40498 53360030
HOMEAD   DS    2F                       CCW AREA                        53400020
R0       DS    4F                       *                               53500020
CCW21    DS    2F                       *                               53600020
CCW22    DS    2F                       *                               53700020
CCW23    DS    2F                       *                               53800020
         END                                                            53900020
