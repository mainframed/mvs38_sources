./  ADD  SSI=80660309,NAME=IGC0009H
         TITLE 'IGC0009H SVC 98 (PROTECT) FIRST LOAD - PASSWORD DATA SEX00200000
               T MAINTENANCE/INITIALIZATION'                            00250000
IGC0009H CSECT                                                          00300000
*                                                                       00310037
*        VS2 RELEASE 037 CHANGES                                        00311037
*A074000,074600,075200,089500,094000,095200,116000,118000      @ZA26556 00312037
*A145000,164090-173450,173810,180000,183000,209000-210000      @ZA26556 00312437
*A173540                                                       @ZA25398 00312837
*A210800,392000-393800,436500,469100,469200,578500,579000      @ZA26556 00313237
*A588500,627000,627500                                         @ZA26556 00313637
*C141500,511000,513000                                         @ZA26556 00314037
*                                                                       00315037
*        VS2-3.0 SU                                                     00320037
*                                                                       00330037
*0000007500,140500-141600,145100,469500                        @ZA03174 00340037
*                                                                       00342037
*0000007500,070000,141500,361000,365000,367000,370000-371000   @ZA11617 00344037
*0000373000,383000,419000,423000-425000                        @ZA11617 00346037
*                                                                       00348037
*A 461500                                                      @YL026TA 00350000
*A 461600                                                      @YL026TA 00400000
*A 057500,146500,224500,239500,288500,478500,577500-579441     @YL026TA 00450000
*C 006000,147000,224000,239000,269000,288000,478000            @YL026TA 00500000
*D 145500-145600,437500-437700                                 @YL026TA 00550000
*C 145500                                                        YM2088 00600000
*C 424000                                                      @ZA01374 00610000
*D 333000                                                      @ZA02233 00620000
*C 462000                                                      @Z30RSTA 00621037
*A 462500                                                      @Z30RSTA 00622037
*C 070000,361000,365000,367000,370000-371000,373000-383000     @ZA06424 00627037
*C 419000,423000                                               @ZA06424 00634037
*A 478700-478800,371010-371030,423010-423020                   @ZA06424 00641037
*********************************************************************** 00650000
*                                                                     * 00700000
* STATUS -- OS/VS2 RELEASE 037                                 @ZA26556 00750037
*                                                                     * 00800000
* FUNCTION -- FIRST LOAD OF THE PASSWORD DATA SET MAINTENANCE ROUTINE * 00850000
*    1. INITIALIZE A WORK AREA WITH A DCB, DEB, ECB, IOB, AND CCWS.   * 00900020
*    2. READ THE PASSWORD DATA SET DSCB FROM THE SYSTEM RESIDENCE     * 01000020
*    DEVICE.  THE DATA SET IS FLAGGED AS NEWLY ALLOCATED IF THE DSCB  * 01100020
*    DS1LSTAR FIELD IS ZEROED.  THE PASSWORD DATA SET WILL NOT BE     * 01200020
*    SEARCHED FOR EXISTING ENTRIES IF THIS FIELD IS ZERO.             * 01300020
*    3. VALIDATE PARAMETER LIST PASSED TO SVC 98.                     * 01400020
*                                                                     * 01500020
* ENTRY POINTS --                                                     * 01600020
*         IGC0009H - ENTRY POINT OF FIRST LOAD, ENTERED WHEN SVC 98   * 01700020
*    ISSUED                                                           * 01800020
*                                                                     * 01900020
* INPUT -- REGISTER 1 POINTS TO A PARAMETER LIST WHICH REQUESTS THE   * 02000020
*    DIFFERENT FUNCTIONS OF SVC 98.                                   * 02100020
*                                                                     * 02200020
* OUTPUT --                                                           * 02300020
*    REGISTER RW POINTS TO WORK AREA                                  * 02400020
*    REGISTER RPARM POINTS TO INPUT PARAMETER LIST                    * 02500020
*    REGISTER RA CONTAINS ENTRY CODE FOR IGC0109H (SECOND LOAD SVC 98)* 02600020
*    REGISTER RB PASSES RETURN CODE BETWEEN LOADS OF SVC 98           * 02700020
*                                                                     * 02800020
* EXTERNAL REFERENCES --                                              * 02900020
*         IECPCNVT - BRANCH TO THE RESIDENT DATA MANAGEMENT CONVERT   * 03300020
*    ROUTINE TO CONVERT A RELATIVE DIRECT ACCESS DEVICE ADDRESS (TTR) * 03400020
*    TO AN ACTUAL DIRECT ACCESS DEVICE ADDRESS (MBBCCHHR)             * 03500020
*                                                                     * 03600020
* EXITS, NORMAL -- XCTL TO IGC0109H TO PROCESS PASSWORD DATA SET      * 03700020
*                                                                     * 03800020
* EXITS, ERROR -- XCTL TO IGC0109H WITH NON-ZERO RETURN CODE          * 03900020
*    08  DATA SET NAME/PASSWORD NOT IN PASSWORD DATA SET              * 04000020
*    16  INCOMPLETE OR INCORRECT PARAMETER LIST                       * 04100020
*    44  PASSWORD DATA SET NOT ON THE SYSTEM RESIDENCE VOLUME         * 04300020
*                                                                     * 04500020
* TABLES/WORK AREAS --                                                * 04600020
*    WORKD - A CONTIGUOUS AREA DEFINED BY IECDSECT FOR I/O CONTROL    * 04700020
*    BLOCKS FOLLOWED BY A LOCAL WORK AREA FOR COMMUNICATION AND       * 04800020
*    BUFFER SPACE                                                     * 04900020
*    PARMD - A DSECT TO MAP THE INPUT PARAMETER LIST                  * 05000020
*    WORKSPACE - A DSECT TO MAP THE LOCATE AND OBTAIN WORKAREAS       * 05100020
*                                                                     * 05200020
* ATTRIBUTES -- REENTRANT, READ ONLY, PRIVILEGED, ENABLED             * 05300000
*                                                                     * 05400020
* CHARACTER CODE DEPENDENCY -- CHARACTER CODE INDEPENDENT             * 05500020
*                                                                     * 05600020
* NOTES --                                                            * 05700000
*    DESCRIBED IN DADSM LOGIC MANUAL, SY26-3787.               @YL026TA 05750000
*                                                                     * 05800020
*********************************************************************** 05900020
         EJECT                                                          06000020
*                                                                       06100020
*        EQUATED SYMBOLS                                                06200020
*                                                                       06300020
NOSEEK   EQU   X'18'               FILE MASK-NO SEEKS                   06400020
CLRLL    EQU   X'2B'               TO CLEAR DSNAME BUFFER TO BLANKS     06500020
HLEN     EQU   X'2C'               MAXIMUM DSNAME LENGTH                06600020
NEWMASK  EQU   X'00'               IDENTIFY FIRST TIME INITIALIZATION   06700020
FLAGIOB  EQU   X'42'               IOB FLAG / COMMAND CHAIN-UNRELATED   06800020
DEBID    EQU   X'0F'               IDENTIFY AS A DEB                    06900020
CCWL     EQU   48                  CCW LIST LENGTH             @ZA11617 07000037
DATALL   EQU   X'50'               PASSWORD ENTRY DATA LENGTH           07100020
DSCBLL   EQU   96                  DSCB DATA FIELD LENGTH               07200020
KEYLL    EQU   X'34'               PASSWORD ENTRY KEY LENGTH            07300020
AUTH     EQU   X'80'               INDICATE AUTHORIZED USER    @ZA26556 07400037
MPENQ    EQU   X'80'               MPDS ENQUEUE FLAG                    07430037
HSTR     EQU   X'4D'               MAX STRING LENTH            @ZA26556 07460037
REPASS   EQU   X'40'               MASK INDICATES REPLACE OF PASSWORD   07490037
SECPASS  EQU   X'20'               VALIDITY CHECK SECOND PASS  @ZA26556 07520037
ENQF     EQU   X'20'               TO SET DFLAG1- INDICATE ENQUEUES     07600020
OBTNCORE EQU   X'08'               OBTAIN CORE TO BE FREED              07700020
ADD      EQU   X'01'               ENTRY CODE FOR ADD                   07800020
REPLACE  EQU   X'02'               ENTRY CODE FOR REPLACE               07900020
LIST     EQU   X'04'               ENTRY CODE FOR LIST                  08000020
TTR      EQU   X'05'               ENTRY CODE FOR TTR                   08100020
PCOD0    EQU   X'00'               PROTECTION CODE '00'          A43379 08150021
PCOD3    EQU   X'03'               PROTECTION CODE '03'          A43379 08160021
LO       EQU   4                   TEST FOR LOW COMPARE          A43379 08170021
USERSP   EQU   251                 SUBPOOL UNDER USERS PROTECT KEY      08200020
HI       EQU   2                   TEST FOR HIGH COMPARE                08300020
ZR       EQU   8                   TEST FOR EQUAL COMPARE               08400020
ZERO     EQU   0                   ZERO                                 08500020
N1       EQU   1                   ONE                                  08600020
N2       EQU   2                   TWO                                  08700020
N3       EQU   3                   THREE                                08800020
N4       EQU   4                   FOUR                                 08900020
N5       EQU   5                   FIVE                        @ZA26556 08950037
N6       EQU   6                   SIX                                  09000020
N7       EQU   7                   SEVEN                                09100020
N8       EQU   8                   EIGHT                                09200020
N9       EQU   9                   NINE                                 09300020
N12      EQU   12                  TWELVE                      @ZA26556 09400037
N16      EQU   16                  SIXTEEN                              09430037
N17      EQU   17                  SEVENTEEN                            09460037
N24      EQU   24                  TWENTY-FOUR                          09490037
N28      EQU   28                  TWENTY-EIGHT                @ZA26556 09520037
RNLENGTH EQU   44                  RNAME LENGTH FOR ENQUEUE ON DSCB     09600020
L132     EQU   132                 LENGTH OF KEY AND DATA FIELDS        09700020
BLANK    EQU   C' '                BLANK                                09800020
HFF      EQU   X'FF'               PASSWORD ENTRY DELETION CHARACTER    09900020
*                                                                       10000020
*        RETURN CODES FOR ALL CONDITIONS  (NORMAL OR ERROR)             10100020
*                                                                       10200020
C4       EQU   4                   RETURN CODE  4                       10300020
C8       EQU   8                   RETURN CODE  8                       10400020
C12      EQU   12                  RETURN CODE 12                       10500020
C16      EQU   16                  RETURN CODE 16                       10600020
C20      EQU   20                  RETURN CODE 20                       10700020
C24      EQU   24                  RETURN CODE 24                       10800020
C28      EQU   28                  RETURN CODE 28                       10900020
C32      EQU   32                  RETURN CODE 32                       11000020
C36      EQU   36                  RETURN CODE 36                       11100020
C40      EQU   40                  RETURN CODE 40                       11200020
C44      EQU   44                  RETURN CODE 44                       11300020
C48      EQU   48                  RETURN CODE 48                       11400020
*                                                                       11420020
*        REGISTER EQUATES                                               11440020
*                                                                       11460020
RP0      EQU   0                   PARAMETER REGISTER                   11500020
R0       EQU   0                   WORK REGISTER               @ZA26556 11600037
RP1      EQU   1                   PARAMETER REGISTER                   11650037
RP2      EQU   2                   PARAMETER REGISTER                   11700037
R2       EQU   2                   WORK REGISTER                        11750037
R4       EQU   4                   WORK REGISTER               @ZA26556 11800037
RCVT     EQU   3                   CVT ADDRESS                          11900020
RPARM    EQU   4                   ADDRESS OF CALLERS PARAMETER LIST    12000020
RW       EQU   5                   ADDRESS OF WORK AREA (WORKD)         12100020
RUCB     EQU   6                   UCB ADDRESS                          12200020
RWK6     EQU   6                   WORK REGISTER                        12300020
RWK7     EQU   7                   WORK REGISTER                        12400020
RWK8     EQU   8                   WORK REGISTER                        12500020
RWK9     EQU   9                   WORK REGISTER                        12600020
RA       EQU   10                  WORK REGISTER                        12700020
RB       EQU   11                  WORK REGISTER                        12800020
RBASE    EQU   12                  BASE REGISTER                        12900020
RD       EQU   13                  UNUSED REGISTER                      13100020
RE       EQU   14                  RETURN LINKAGE                       13200020
RF       EQU   15                  LINKAGE/RETURN CODE                  13300020
         EJECT                                                          13400020
         USING WORKD,RW            ESTABLISH ADDRESSABILITY FOR DSECT   13500020
         USING CVTTCBP,RCVT        ESTABLISH ADDRESSABILITY FOR CVT     13700020
         USING SRT,RUCB            ESTABLISH ADDRESSABILITY FOR UCB     13800020
         BALR  RBASE,RP0           GET ADDRESS WHERE LOADED             13900020
         USING *,RBASE             ESTABLISH ADDRESSABILITY FOR PROGRAM 14000020
         B     BRID                BRANCH AROUND ID            @ZA03174 14050037
         DC    C'IGC0009H'         MODULE ID                   @ZA03174 14100037
         DC    X'7339'             DATE  12/05/77              @ZA26556 14150037
BRID     EQU   *                                               @ZA03174 14160037
         LR    RA,RE               SAVE RETURN ADDRESS                  14200020
*        REGISTER 3 CONTAINS CVT ADDRESS AT ENTRY                       14260020
*        REGISTER 4 CONTAINS TCB ADDRESS AT ENTRY                       14320020
         LR    RB,RPARM            SAVE TCB POINTER FOR VALIDATION      14400020
         LR    RWK7,RP1            PARAMETER LIST POINTER      @ZA26556 14500037
INITCOR  LA    RP0,WKSIZE          WORK AREA SIZE                       14530000
*        GET WORK AREA STORAGE                                 @YL026TA 14620000
         GETMAIN R,LV=(0),RELATED=(SP0-2K,IGC0209H(NOOBTAIN))  @YL026TA 14710000
         LR    RW,RP1              BASE FOR WORK AREA WORKD             14800020
         ST    RB,TCBADDR          SAVE TCB ADDRESS FOR MFT ENQUEUE     14850020
         XC    COMMD(DCLEAR),COMMD CLEAR PORTION OF WORK AREA           14900020
         XC    DFOXKEY(L132),DFOXKEY CLEAR BUFFER                       15000020
         L     RUCB,CVTILK2        ADDRESS OF UCB LOOKUP TABLE          15100020
         ST    RUCB,DUCBADDR       SAVE FOR UCB SCAN IN IGC0209H        15200020
         ST    RA,DSAVR            SAVE RETURN ADDRESS IN WORK AREA     15300020
         MVC   JFCBELNM(WTOLL),FULMSG SET UP WTO MESSAGE IN WORK AREA   15400020
*                                                                       15500020
*        VALIDATE PARAMETER LIST PASSED BY REQUESTOR. THE DATA SET      15600000
*        NAME AND PASSWORD ARE MOVED INTO AN I/O BUFFER.                15800000
*                                                                       16100020
         MVI   DKEY,BLANK          BLANK KEY                            16200020
         MVC   DKEY+N1(CLRLL),DKEY CLEAR DSNAME/PASSWORD AREA           16300020
         LA    RA,PRMER010         ERROR ROUTINE ADDRESS                16400037
         STM   R0,RE,REGSAVE       SAVE REGS FOR AUTHORITY CK  @ZA26556 16409037
         TESTAUTH FCTN=1,KEY=YES,STATE=YES,BRANCH=YES          @ZA26556 16418037
         LTR   RF,RF               USER AUTHORIZED?            @ZA26556 16427037
         LM    R0,RE,REGSAVE       RESTORE REGS                @ZA26556 16436037
         BZ    SKIPLOCK            YES,NO NEED TO GET LOCK     @ZA26556 16445037
OBTLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @ZA26556X16454037
               RELATED=(LOCAL,IGC0009H(RLSELOCK))              @ZA26556 16463037
         LM    R0,RE,REGSAVE       RESTORE REGS                @ZA26556 16472037
         B     CONTINUE                                        @ZA26556 16481037
SKIPLOCK EQU   *                                               @ZA26556 16490037
         OI    DFLAG2,AUTH         SET AUTHORIZED FLAG         @ZA26556 16499037
CONTINUE EQU   *                                               @ZA26556 16508037
         CLI   0(RWK7),TTR         IS ENTRY CODE TOO LARGE     @ZA26556 16517037
         BH    PRMER010            ERROR EXIT                  @ZA26556 16526037
         CLI   0(RWK7),ADD         IS ENTRY CODE TO SMALL      @ZA26556 16535037
         BL    PRMER010            ERROR EXIT                  @ZA26556 16544037
         CLI   0(RWK7),N3          ENTRY CODE EQU THREE        @ZA26556 16553037
         BZ    SETLTH5             YES,GO SET PARM LIST LTH    @ZA26556 16562037
         BL    SETLTH7             LOW,SET LTH TO SEVEN WDS    @ZA26556 16571037
         LA    RWK8,N3             SET LTH TO THREE WDS        @ZA26556 16580037
         B     TESTPARM            GO VALCK PARM LIST          @ZA26556 16589037
SETLTH5  EQU   *                                               @ZA26556 16598037
         LA    RWK8,N5             SET LTH TO FIVE WDS         @ZA26556 16607037
         B     TESTPARM            GO VALCK PARM LIST          @ZA26556 16616037
SETLTH7  EQU   *                                               @ZA26556 16625037
         LA    RWK8,N7             SET LTH TO SEVEN WDS        @ZA26556 16634037
TESTPARM EQU   *                                               @ZA26556 16643037
         SLL   RWK8,N2             MULTIPLY BY 4               @ZA26556 16652037
         LR    RWK6,RWK8           SAVE LENGTH OF PARMLIST     @ZA26556 16661037
         AR    RWK8,RWK7           COMPUTE ENDING ADDRESS      @ZA26556 16670037
         BCTR  RWK8,ZERO           REDUCE BY 1 FOR ACTUAL END  @ZA26556 16679037
         TM    DFLAG2,AUTH         IS USER AUTHORIZED?         @ZA26556 16688037
         BO    NOVALCK             SKIP VALIDITY CHECK         @ZA26556 16697037
         BAL   RWK9,VALCKRTN       GO VALIDITY CHECK PARMLIST  @ZA26556 16706037
NOVALCK  EQU   *                                               @ZA26556 16715037
         BCTR  RWK6,ZERO           DECREMENT FOR MOVE          @ZA26556 16724037
         EX    RWK6,MOVEPARM       GO GET PARM LIST            @ZA26556 16733037
         CLI   DSNLL,HLEN          IS DSN LTH VALID?           @ZA26556 16742037
         BH    PRMER010            NO,ERROR EXIT               @ZA26556 16751037
         CLI   DSNLL,ZERO          IS DSN LTH ZERO?            @ZA26556 16760037
         BZ    PRMER010            YES,ERROR                   @ZA26556 16769037
         CLI   ENCODE,N3           IS ENTRY CODE GTR THAN TWO? @ZA26556 16778037
         BNL   TEST2               SKIP PROT CODE CHECK        @ZA26556 16787037
         CLI   PCODE,PCOD3         IS PROT CODE TOO LARGE?     @ZA26556 16796037
         BH    PRMER010            YES,GO TO ERROR EXIT        @ZA26556 16805037
         CLI   STRINGL,HSTR        IS STRING LTH TOO GREAT?    @ZA26556 16814037
         BH    PRMER010            YES,ERROR                   @ZA26556 16823037
TEST2    EQU   *                                               @ZA26556 16832037
         TM    DFLAG2,AUTH         IS USER AUTHORIZED?         @ZA26556 16841037
         BO    COPYDSN             GO MOVE DSNAME AND PASSWORD @ZA26556 16850037
         LA    RB,DBUF             GET ADDRESS FIRST PARM WD   @ZA26556 16859037
         XR    RWK8,RWK8           CLEAR WORK REG              @ZA26556 16868037
         XR    RWK7,RWK7           CLEAR WORK REG              @ZA26556 16877037
         CLI   ENCODE,N4           IS ENTRY CODE LESS THAN FOUR@ZA26556 16886037
         BL    ECLFOUR             YES,BRANCH                  @ZA26556 16895037
         LA    RWK6,N3             SET CNTR                    @ZA26556 16904037
NEXTWORD EQU   *                                               @ZA26556 16913037
         ICM   RWK7,N7,N1(RB)      GET A PARMLIST PTR          @ZA26556 16922037
         LTR   RWK7,RWK7           IS THERE AN ADDRESS?        @ZA26556 16931037
         BZ    PRMER010            NO,ERROR                    @ZA26556 16940037
         BAL   RWK9,VALCKRTN       GO CHECK ADDRESS            @ZA26556 16949037
         LA    RB,N4(,RB)          INCREMENT TO NEXT WD        @ZA26556 16958037
         BCT   RWK6,NEXTWORD       REDUCE CNTR                 @ZA26556 16967037
         B     COPYDSN             GO GET DSNAME AND PASSWORD  @ZA26556 16976037
ECLFOUR  EQU   *                                               @ZA26556 16985037
         LA    RWK6,N4             SET CNTR                    @ZA26556 16994037
NEXTWD   EQU   *                                               @ZA26556 17003037
         LA    RB,N4(,RB)          SET TO SECOND WORD          @ZA26556 17012037
         ICM   RWK7,N7,N1(RB)      GET A PARMLIST ADDRESS      @ZA26556 17021037
         LTR   RWK7,RWK7           IS THERE AN ADDRESS?        @ZA26556 17030037
         BZ    GETNEXT             NO GO TO NEXT WORD          @ZA26556 17039037
         TM    DFLAG2,SECPASS      IS THIS SECOND PASS?        @ZA26556 17048037
         BO    VALCK               YES,GO TO VAL CK            @ZA26556 17057037
         C     RWK6,ONES           IS CNTR EQUAL TO ONE?       @ZA26556 17066037
         BZ    VOLUMECK            GO TEST FOR MULTIPLE VOLS   @ZA26556 17075037
VALCK    EQU   *                                               @ZA26556 17084037
         BAL   RWK9,VALCKRTN       GO CHECK ADDRESS            @ZA26556 17093037
         XR    RWK8,RWK8           CLEAR REG                   @ZA26556 17102037
         XR    RWK7,RWK7           CLEAR REG                   @ZA26556 17111037
GETNEXT  EQU   *                                               @ZA26556 17120037
         BCT   RWK6,NEXTWD         GO PROCESS NEXT ENTRY       @ZA26556 17129037
         CLI   ENCODE,N3           IS ENTRY EQUAL TO THREE?    @ZA26556 17138037
         BZ    COPYDSN             GO GET DSNAME AND PASSWORD  @ZA26556 17147037
         TM    DFLAG2,SECPASS      IS THIS SECOND TIME?        @ZA26556 17156037
         BO    COPYDSN             GO GET DSNAME AND PASSWORD  @ZA26556 17165037
         OI    DFLAG2,SECPASS      SET SECOND PASS SWITCH      @ZA26556 17174037
         LA    RWK6,N2             SET CNTR EQUAL TO TWO       @ZA26556 17183037
         B     NEXTWD              GO PROCESS NEXT ENTRY       @ZA26556 17192037
VOLUMECK EQU   *                                               @ZA26556 17201037
         CLI   VOLNUM,N1           MOVE THAN ONE VOLUME?       @ZA26556 17210037
         BNH   VALCK               NO, GO TEST ADDRESS         @ZA26556 17219037
         IC    RWK8,VOLNUM         GET NUMBER OF VOLUMES       @ZA26556 17228037
         MH    RWK8,SIX            MULTIPLE BY SIX             @ZA26556 17237037
         AR    RWK8,RWK7           COMPUTE ENDING ADDRESS      @ZA26556 17246037
         BCTR  RWK8,ZERO           REDUCE BY 1 FOR ACTUAL END  @ZA26556 17255037
         B     VALCK               GO CK ADDRESS               @ZA26556 17264037
VALCKRTN EQU   *                                               @ZA26556 17273037
         LR    RP1,RWK7            SET PARM REG                @ZA26556 17282037
         LR    RP2,RWK8            SET SECOND PARM REG         @ZA26556 17291037
         L     R4,TCBADDR          GET TCB ADDRESS             @ZA26556 17300037
         L     RF,CVT0VL00         LOAD RESIDENT VALCK ADDRESS @ZA26556 17309037
         BALR  RE,RF               GO CHECK ADDRESSES          @ZA26556 17318037
         BNZ   PRMER010            NOT A VALID ADDRESS,ERROR   @ZA26556 17327037
         BR    RWK9                RETURN TO CALLER            @ZA26556 17336037
COPYDSN  EQU   *                                               @ZA26556 17345037
         L     RWK8,DSN            GET ADDRESS OF DSNAME       @ZA25398 17354037
         SRDA  RWK8,N24            SHIFT OUT ADDRESS TO NEXT REGISTER   17363037
         SRA   RWK9,N8             SET UP ADDRESS IF NOT ZERO           17372037
         BZ    PRMER010            IF ZERO GO TO ERROR EXIT    @ZA26556 17381037
         BCTR  RWK8,ZERO           DECREMENT LENGTH FOR EXECUTE         17400020
         EX    RWK8,MOVDSN         MOVE DSNAME TO BUFFER/SEARCH FIELD   17500020
         L     RWK9,CURRENT        CURRENT PASSWORD                     17600020
         CLI   ENCODE,ADD          IS THIS AN ADD REQUEST               17700020
         BE    CHK001              YES, CURRENT PASSWORD NOT REQUIRED   17800020
         LTR   RWK9,RWK9           IS CURRENT PW ADDR SPECIFIED         17900020
         BZ    PRMER010            GO TO ERROR EXIT            @ZA26556 18000037
CHK001   CLI   ENCODE,REPLACE      REPLACE/ADD SPECIFIED                18050037
         BH    CHK010              GO PROCESS DELETE ENTRY              18100037
         L     RWK8,NEW            GET NEW PASSWORD ADDRESS             18150037
         LA    RWK8,ZERO(RWK8)     CLEAR HIGH ORDER BYTE                18200037
         LTR   RWK8,RWK8           IS NEW PASSWORD ADDRESS SPECIFIED    18250037
         BZ    PRMER010            GO TO ERROR EXIT            @ZA26556 18300037
         CLI   ENCODE,ADD          IS ADD SPECIFIED                     18700020
         BE    CHK005              GO MOVE IN NEW PASSWORD              18800020
         CLC   ZERO(N8,RWK8),ZERO(RWK9) IS A NEW PASSWORD SPECIFIED     18900020
         BE    CHK010              IF NOT, MOVE IN CURRENT NEW PASSWORD 19000020
         OI    DFLAG2,REPASS       SET FLAG FOR SECOND LOAD             19100020
CHK005   LR    RWK9,RWK8           ADDRESS NEW PASSWORD TO REGISTER     19200020
CHK010   MVC   DKEY8(N8),ZERO(RWK9) MOVE PASSWORD TO BUFFER             19300020
         IC    RWK8,ENCODE         SET UP ENTRY CODE FOR BRANCH         19400000
         SLL   RWK8,N2             TABLE IN NEXT LOAD OF THE SVC        20700020
         STC   RWK8,DCODTAB        SAVE FOR ENTRY TO IGC0109H           20800020
         TM    DFLAG2,AUTH         AUTHORIZED USER?            @ZA26556 20900037
         BO    NORLSE              BRANCH,NO LOCK TO RELEASE   @ZA26556 20920037
         STM   R0,RF,REGSAVE       SAVE REGS                   @ZA26556 20940037
RLSELOCK SETLOCK RELEASE,TYPE=LOCAL,                           @ZA26556X20960037
               RELATED=(LOCAL,IGC0009H(OBTLOCK))               @ZA26556 20980037
         LM    R0,RF,REGSAVE        RESTORE REGS               @ZA26556 21000037
*                                                                       21020037
*        INITIALIZE ENQUEUE PARAMETER LIST                              21040037
*                                                                       21060037
NORLSE   EQU   *                                               @ZA26556 21080037
         MVC   DMPDSQN(N17),MPDSQN MOVE NAMES TO ENQUEUE BUFFERS        21200020
         MVC   DMPDS+N9(HLEN-N9),DMPDS+N8 CLEAR RNAME BUFFER            21300020
         MVC   DENQLST(N4),ENQMP   ENQ OPTIONS TO ENQ LIST              21500020
         LA    RWK8,DMPDSQN        QNAME POINTER                        21600020
         ST    RWK8,DENQLST+N4     QNAME ADDRESS TO ENQ LIST            21700020
         LA    RWK8,DKEY           ADDRESS OF KEY                       21800020
         ST    RWK8,DENQLST+N8     RNAME POINTS TO DSN OF REQUEST       21900020
         LA    RP1,DENQLST         POINT TO ENQUEUE LIST                22000020
*                                                                       22100020
*        ENQ ON  MPDS FOR DSN                                           22200020
*                                                                       22300020
CHK020   ENQ   MF=(E,(1)),RELATED=(SYSZPSWD-USERDATA,IGC0109H(RET040)) *22400037
                                                               @YL026TA 22450000
         CLI   ENCODE,ADD          ADD REQUESTED                        22500020
         BNE   TABREC              IF NOT, SKIP SECOND ENQUEUE          22600020
         CLC   ZERO(N9,RWK8),MPDS  IS THE PASSWORD D/S BEING PROTECTED  22700020
         BE    INITEQE             BYPASS SECOND ENQ IF  IT IS          22800020
*                                                                       22900020
*        ENQ ON PASSWORD DATA SET IF AN ADD IS REQUESTED TO PREVENT     23000020
*        ACCESS BY MULTIPLE ADD REQUESTS.                               23100020
*                                                                       23200020
         LA    RWK8,DMPDS          ADDRESS OF PASSWORD DATA SET NAME    23300020
         ST    RWK8,DENQLST+N8     RNAME POINTS TO MPDS DSNAME          23400020
         LA    RP1,DENQLST         POINT TO ENQUEUE LIST                23500020
*                                                                       23600020
*        ENQUEUE ON PASSWORD DATA SET WITH MODIFIED PARAMETER LIST      23700020
*                                                                       23800020
CHK030   ENQ   MF=(E,(1)),RELATED=(SYSZPSWD-PASSWORD,IGC0109H(RET030),I*23900037
               GC0209H(SKIPDQ))                                @YL026TA 23950000
         B     TABREC              GO FIND TRACK CONSTANT               24000020
INITEQE  OI    DFLAG1,MPENQ        SPECIFY ONLY ONE ENQ DONE            24100020
*                                                                       24200020
*                                                                       24300020
*        ROUTINE TO FIND SYSRES DEVICE RECORD CAPACITY CONSTANT         24400020
*        CONSTANT IS BASED ON FIXED LENGTH KEYED RECORDS OF 132 BYTES.  24500020
*                                                                       24600020
TABREC   OI    DFLAG1,ENQF         INDICATE ENQUEUES DONE FOR DEQUEUE   24700020
         L     RUCB,CVTSYSAD       ADDRESS OF SYSRES DEVICE UCB         24800020
         MVC   OBTVOL(N6),SRTEVOLI SYSRES VOLUME SERIAL FOR OBTAIN      24900020
         LA    RWK7,TABR           DETERMINE TYPE AND SAVE              25000020
         LA    RWK9,TABREND        RECORDS PER TRACK CONSTANT           25100020
         LA    RWK8,N2             LENGTH OF EACH TABLE ENTRY           25200020
TABRC1   CLC   ZERO(N1,RWK7),UCBTBYT4 IS UCB TYPE CODE IN THE TABLE     25300020
         BE    TABRC2              TYPE FOUND IN TABLE                  25400020
         BXLE  RWK7,RWK8,TABRC1    CONTINUE SEARCH IF MORE ENTRIES      25500020
         B     PRMER030            RETURN-WITH ERROR                    25600020
TABRC2   MVC   DRECAP(N1),N1(RWK7) SAVE RECORD/TRACK CAPACITY           25700020
*                                                                       25800020
*        BEGIN INITIALIZATION FOR ACCESSING MPDS DSCB                   25900020
*                                                                       26000020
         LA    RP0,WRKSIZE         WORK AREA FOR OBTAIN/LOCATE          26100020
         LA    RP1,USERSP          GETMAIN UNDER USERS PROTECT KEY      26200020
         SLL   RP1,N24             SHIFT TO HIGH ORDER BYTE             26300020
         OR    RP0,RP1             REQUEST SUBPOOL 251                  26400020
*                                                                       26500020
*        GET WORK AREA FOR OBTAIN/LOCATE                                26600020
*        THE AREA WILL HAVE THE USERS PROTECTION KEY                    26700020
*                                                                       26800020
         GETMAIN R,LV=(0),RELATED=(SP251-2K,IGC0209H(FREECORE))         26900000
         OI    DFLAG1,OBTNCORE     INDICATE OBTAIN CORE TO BE FREED     27000020
         LR    R2,RP1              SAVE ADDRESS FOR OBTAIN OF DSCB      27100020
         MVC   OBTPTR(CAMEND-CAMFLAG),CAMFLAG INITIALIZE CAMLIST        27200020
         LA    RA,OBTDSN           ADDRESS OF FULLY QUALIFIED MPDS DSN  27300020
         ST    RA,OBTAIN2          DSNAME POINTER                       27400020
         LA    RA,OBTVOL           VOLUME SER POINTER                   27500020
         ST    RA,OBTAIN3          OBTAIN VOLUME                        27600020
         ST    R2,OBTAIN4          OBTAIN WORK AREA                     27700020
*                                                                       27800020
*        OBTAIN MPDS DSCB FROM SYSRES VTOC                              27900020
*                                                                       28000020
         OBTAIN OBTPTR             DO OBTAIN-DSCB TO DXDSCB AREA        28100020
         LTR   RF,RF               WAS OBTAIN SUCCESSFUL                28200020
         BNZ   PRMER030            GO TO ERROR EXIT- OBTAIN CODE IN RF  28300020
         MVC   DXDSCB(DSCBLL),ZERO(R2) MOVE DSCB TO I/O WORK AREA       28400020
*                                                                       28500020
*        INITIALIZE WORK AREA FOR I/O                                   28600020
*                                                                       28700020
         XC    DXECB(CLRECB),DXECB CLEAR I/O WORK AREA         @YL026TA 28800000
         XC    DXDCB(CLEARIO),DXDCB CLEAR I/O WORK AREA        @YL026TA 28830000
         XC    DXCCW(CLEARIO1),DXCCW CLEAR I/O WORKAREA        @YL026YB 28860000
         LA    RA,DXDEB            DEB ADDRESS                          28900020
         ST    RA,DXDCBDEB         DEB ADDRESS TO DCB                   29000020
         LA    RA,DXDCB            DCB ADDRESS                          29100020
         ST    RA,DXDEBDCB         DCB ADDRESS TO DEB                   29200020
         ST    RA,IOBWGHT          DCB ADDRESS TO IOB                   29300020
         L     RUCB,CVTSYSAD-CVT(RCVT) SYSRES DEVICE UCB ADDRESS        29400020
         ST    RUCB,DXDEBUCB       UCB ADDRESS TO DEB                   29500020
         L     RA,CVTXAPG          IOS APPENDAGE TABLE                  29600020
         ST    RA,DXDEBAPP         APPENDAGE TABLE TO DEB               29700020
         LA    RA,DXECB            ECB ADDRESS                          29800020
         ST    RA,IOBECBPT         ECB ADDRESS TO IOB                   29900020
         MVI   IOBFLAG1,FLAGIOB    SET IOB FLAGS                        30000020
         MVI   DXDEBUSR,N1         NO. OF EXTENTS=1                     30100020
         MVI   DXDEBID,DEBID       MASK TO IDENTIFY AS A DEB            30200020
         MVI   DXDEBMOD,NOSEEK     SET FILE MASK FOR NOSEEK X'18'       30300020
         OC    DXDEBSCC(N8),DSCLOWLM MOVE PASSWORD D/S EXTENTS TO DEB   30400020
         OC    DXDEBNTR(N2),NTRK   MAXIMUM TRACKS FOR DEB               30500020
         MVI   DCKDLL,KEYLL        KEY LENGTH FOR WRT C-K-D             30600020
         MVI   DCKDLL+N2,DATALL    DATA LENGTH FOR WRT C-K-D            30700020
         MVI   DFOXKEY,HFF         SET UP BYTE OF FFS                   30800020
         MVC   DFOXKEY+N1(KEYLL-N1),DFOXKEY SET UP 52 BYTES OF FFS      30900020
*                                                                       31000020
*        TEST FOR FIRST TIME INTO PASSWORD DATA SET                     31100020
*                                                                       31200020
         CLC   DSCLSTAR(N3),DXCCW1 IS TTR FIELD ZEROED                  31300020
         BNE   INITC0              NO- ASSUME PRIOR ACTIVITY IN MPDS    31400020
         MVI   DCODTAB,NEWMASK     FIRST TIME, SET CODE FOR NEW ADD     31500020
         MVC   DMPEND+N3(N4),DSCLOWLM  LIMIT SEARCH TO ONE TRACK        31600020
         CLI   ENCODE,ADD          YES-  IS FIRST REQUEST AN ADD        31700020
         BE    INITC1              GO SET UP CHANNEL PROGRAMS           31800020
         LA    RF,C8               DATA SET CONTAINS NO ENTRIES         31900020
         B     ERETURN             ERROR, RETURN                        32000020
*                                                                       32100020
*        CONVERT TTR TO MBBCCHHR                                        32200020
*        USE TTR (CONVERTED) AS UPPER EXTENT OF MPDS                    32300020
*                                                                       32400020
INITC0   LA    RP1,DXDEB           DEB ADDRESS                          32500020
         OC    DSAVT(N3),DSCLSTAR  TTR TO ZEROED FULL WORD              32600020
         L     RP0,DSAVT           TTRN WITH ZERO (N) FIELD             32700020
         LA    RP2,DMPEND          FOR MBBCCHHR                         32800020
         L     RF,CVTPCNVT-CVT(RCVT) GET ADDRESS OF CONVERT             32900020
         STM   RWK9,RD,DXJBF       SAVE REGISTERS IN WORKD              33000020
         BALR  RE,RF               GO TO CONVERT ROUTINE                33100020
         LM    RWK9,RD,DXJBF       RESTORE REGISTERS                    33200020
*                                                                       33400020
*        INITIALIZE CHANNEL PROGRAMS  ADDRESS FIELDS                    33500020
*        TWO CHANNEL PROGRAMS ARE USED, A SEARCH PROGRAM TO LOCATE      33600020
*        THE CORRECT PASSWORD ENTRY AND READ THE DATA FIELD             33700020
*        AND AN UPDATE CHANNEL PROGRAM TO WRITE AN UPDATED OR           33800020
*        A NEW ENTRY TO THE PASSWORD DATA SET.                          33900020
*                                                                       34000020
*        SEARCH CHANNEL PROGRAM                                         34100020
*                                                                       34200020
*              SEARCH ID EQ                 DXCCW1                      34300020
*              TIC                          DXCCW2                      34400020
*              READ COUNT                   DXCCW3                      34500037
*              SEARCH KEY EQ                DXCCW4                      34600037
*              TIC                          DXCCW5                      34700037
*              READ DATA                    DXCCW6                      34800037
*                                                                       34900037
*        WRITE UPDATE CHANNEL PROGRAM                                   35000037
*                                                                       35100037
*              SEARCH ID EQ                 DXCCW7                      35200037
*              TIC                          DXCCW8                      35300037
*              WRITE CNT-KEY-DATA/KEY-DATA  DXCCW9                      35400037
*              SEARCH ID EQ                 DXCCW10                     35500037
*              TIC                          DXCCW11                     35600037
*              READ DATA (VALIDATE)         DXCCW12                     35700037
*                                                                       35800037
INITC1   LA    RA,DXDAADDR+N3      IOB SEEK ADDRESS                     35900037
         ST    RA,DXCCW1           IOB SEEK ADDRESS TO S-ID (SEARCH)    36000037
         ST    RA,DXCCW7           IOB SEEK TO S-ID (UPDATE)   @ZA11617 36100037
         LA    RA,DXCCW1           ADDRESS OF FIRST CCW                 36200037
         ST    RA,DXCCW2           SEARCH ID ADDRESS TO TIC             36300037
         LA    RA,DXCCW3           ADDRESS OF THIRD CCW                 36400037
         ST    RA,DXCCW5           READ COUNT ADDRESS TO TIC   @ZA11617 36500037
         LA    RA,DATA             ADDRESS OF DATA BUFFER               36600037
         ST    RA,DXCCW6           DATA BUF ADR TO READ CCW    @ZA11617 36700037
         LA    RA,DCNT             ADDRESS OF COUNT BUFFER              36800037
         ST    RA,DXCCW3           CNT BUFFER ADDRESS FOR READ COUNT    36900037
         ST    RA,DXCCW9           CNT BUF ADR TO WRT C-K-D    @ZA11617 37000037
         ST    RA,DXCCW10          CNT BUF ADR TO S-ID         @ZA11617 37100037
         LA    RA,DKEY             ADDRESS OF KEY                       37200037
         ST    RA,DXCCW4           KEY/DATA BUF ADR TO S-K-EQ  @ZA11617 37300037
         ST    RA,DXCCW12          KEY/DATA BUF ADR TO READ    @ZA11617 37400037
         LA    RA,DXCCW7           ADDRESS OF SEVENTH CCW      @ZA11617 37500037
         ST    RA,DXCCW8           SEARCH ID ADDRESS TO TIC    @ZA11617 37600037
         LA    RA,DXCCW10          ADDRESS OF SRCH CCW         @ZA11617 37700037
         ST    RA,DXCCW11          SEARCH KEY ADDRESS TO TIC   @ZA11617 37800037
         OC    DXCCW(CCWL),CCWBASE BASIC SEARCH/READ (6 CCWS)  @ZA11617 37900037
         OC    DXCCW7(N16),CCWSRCH SEARCH ID/TIC KNOWN CCHHR   @ZA11617 38000037
         OC    DXCCW9(N8),CCWWRT   WRITE KEY/DATA              @ZA11617 38100037
         OC    DXCCW10(N16),CCWSRCH SEARCH ID/TIC VALIDATE     @ZA11617 38200037
         OC    DXCCW12(N8),CCWVAL  READ VALIDATE               @ZA11617 38300037
         XR    RF,RF               CLEAR REGISTER FOR EXIT              38400020
         B     ERETURN             GO TO SECOND LOAD VIA XCTL           38500020
         EJECT                                                          38600020
*                                                                       38700020
*        EXIT ROUTINE- AN EXIT IS MADE TO THE NEXT LOAD OF THE          38800020
*        SVC VIA AN XCTL. A NON-ZERO RETURN CODE IS IN REGISTER RB      38900020
*        IF AN ERROR HAS OCCURRED IN THIS LOAD.                         39000020
PRMER010 LA    RF,C16              PARAMETER LIST ERROR                 39100020
         TM    DFLAG2,AUTH         AUTHORIZED USER?            @ZA26556 39200037
         BO    EXITNOW             BRANCH,NO LOCK TO RELEASE   @ZA26556 39230037
         STM   R0,RF,REGSAVE       SAVE REGS                   @ZA26556 39260037
RLSELKER SETLOCK RELEASE,TYPE=LOCAL,                           @ZA26556X39290037
               RELATED=(LOCAL,IGC0009H(OBTLOCK))               @ZA26556 39320037
         LM    R0,RF,REGSAVE        RESTORE REGS               @ZA26556 39350037
EXITNOW  B     ERETURN             ERROR, RETURN               @ZA26556 39380037
PRMER030 LA    RF,C44              PASSWORD DATA SET NOT FOUND          39500020
ERETURN  XR    RA,RA               CLEAR REGISTER                       39600020
         IC    RA,DCODTAB          SET UP FOR ENTRY INTO IGC0109H       39700020
         LR    RB,RF               SAVE THE RETURN CODE                 39800020
*                                                                       39900020
*        SET UP FOR XCTL TO IGC0109H                                    40000020
*        THE WORK AREA (DXJBF) IS USED AS AN XCTL LIST                  40100020
*                                                                       40200020
         LA    R2,DXJBF            XCTL PARAMETER LIST ADDRESS          40300020
         MVC   ZERO(N8,R2),NXLOAD  MOVE IN NAME OF NEXT LOAD            40400020
         LA    RF,N8(R2)           ADDRESS OF LIST POINTER FOR XCTL     40500020
*                                                                       40600020
*        XCTL TO NEXT LOAD OF SVC 98                                    40700020
*                                                                       40800020
         XCTL  EPLOC=(R2),DCB=0,SF=(E,(15)) XCTL                        40900020
*                                                                       41000020
         EJECT                                                          41100020
*                                                                       41200020
*        CONSTANTS                                                      41300020
*                                                                       41400020
         DS    0D                  ALIGN DOUBLE WORD                    41500020
*                                                                       41600020
*        CCW LIST FOR ALL EXCP I/O OPERATIONS                           41700020
*                                                                       41800020
CCWBASE  DS    0CL48               BASIC SEARCH CCWS           @ZA11617 41900037
*                                                                       42000037
CCWSRCH  DC    X'3100000060000005' SEARCH ID EQUAL                      42100037
         DC    X'0800000000000000' TIC                                  42200037
         DC    X'9200000060000008' READ COUNT M/T              @ZA11617 42300037
         DC    X'A900000040000034' SEARCH KEY EQ (DSN+PW)      @ZA11617 42400037
         DC    X'0800000000000000' TIC                         @ZA06424 42500037
*                                                                       42600020
*        READ  FOR 80 BYTE DATA FIELD                                   42700020
CCWRD    DC    X'8600000020000050' READ DATA (CHAIN FROM S-K-EQ)        42800020
*                                                                       42900020
*        WRITE - UPDATE IN PLACE OR ADD ON , WRITE EOF                  43000020
CCWWRT   DC    X'1D0000006000008C' WRITE COUNT-KEY-DATA                 43100020
*                                                                       43200020
*        VALIDATE WRITES                                                43300020
CCWVAL   DC    X'0E00000030000050' READ DATA (VALIDATE)                 43400020
*                                                                       43500020
MOVDSN   MVC   DKEY(ZERO),ZERO(RWK9) MOVE FOR DSNAME                    43600020
MOVEPARM MVC   PARMWDS(ZERO),ZERO(RWK7)  MOVE PARMLIST         @ZA26556 43650037
*                                                                       43700020
*        CAMLST PARAMETER LIST                                          43800020
*                                                                       43900020
CAMFLAG  CAMLST SEARCH,0,0,0                                            44000020
CAMEND   EQU   *                   END OF CAMLIST                       44100020
*                                                                       44200020
*        ENQUEUE/DEQUEUE CONSTANTS                                      44300020
*                                                                       44400020
ENQMP    DC    X'FF2C4000'         ENQUEUE/DEQUEUE CONSTANT             44500020
*        KEEP NEXT TWO FIELDS TOGETHER, MOVED BY ONE INSTRUCTION        44530020
*        NOTE - EXTRA BLANK REQUIRED, USED TO CLEAR BUFFER              44560020
MPDSQN   DC    CL8'SYSZPSWD'       QNAME FOR ALL ENQUEUES               44600037
MPDS     DC    CL9'PASSWORD '      NAME OF PASSWORD DATA SET            44700020
         EJECT                                                          44800020
*                                                                       44900020
*        THIS TABLE CONTAINS A 2 BYTE FIELD FOR EACH SYSTEM RESIDENCE   45000020
*        DEVICE SUPPORTED. THE FIRST BYTE IS THE UCB ID FOR DEVICE      45100020
*        THE SECOND BYTE IS THE NUMBER OF 132 BYTE KEYED RECORDS THAT   45200020
*        WILL FIT ON EACH TRACK (MINUS 1 RECORD).                       45300020
*                                                                       45400020
TABR     EQU   *                   LOOK UP TABLE FOR DEVICE CONSTANT    45500020
         DC    X'0819'             2314    ID/RECORD CAPACITY           45600000
*                                  2319 SAME AS 2314                    45700000
         DC    X'0612'             2305-1  ID/RECORD CAPACITY           45800000
         DC    X'0722'             2305-2  ID/RECORD CAPACITY           45900000
         DC    X'0D27'             3330-1  ID/RECORD CAPACITY  @YL026TA 46000000
         DC    X'0A15'             3340    ID/RECORD CAPACITY  @YL026TA 46100000
         DC    X'0927'             3330    ID/RECORD CAPACITY  @Z30RSTA 46200037
TABREND  DC    X'0B2F'             3350    ID/RECORD CAPACITY  @Z30RSTA 46250037
*                                                                       46300020
*        END OF TABLE LOOKUP TABLE                                      46400020
*                                                                       46500020
FULMSG   WTO   'IEC021I NO SPACE IN PASSWORD DATA SET',MF=L,ROUTCDE=(9)X46560020
               ,DESC=4             WTO                                  46620020
WTOLL    EQU   *-FULMSG            LENGTH OF WTO MESSAGE                46700020
NXLOAD   DC    C'IGC0109H'         SECOND LOAD - SVC 98                 46800020
NTRK     DC    X'7FFF'             MAXIMUM TRACKS FOR DEB               46900020
ONES     DC    A(1)                VALUE OF ONE                @ZA26556 46910037
SIX      DC    X'0006'             CONSTANT FOR VOLSERS        @ZA26556 46920037
PATCH    DC    20X'00'             PATCH AREA                  @ZA03174 46950037
         SPACE 3                                                        47100020
         EJECT                                                          47200020
*        THIS WORK AREA IS USED BY ALL LOADS OF THE PROTECT SVC.        47300020
*        ANY CHANGES TO IT MUST BE MADE TO ALL LOADS.                   47400020
WORKD    DSECT                                                          47500020
*                                                                       47600020
         IECDSECT                                                       47700020
CLEARIO  EQU   DXCCW-DXDCB         LENGTH FOR CLEARING I/O BLOCKS       47800000
CLEARIO1 EQU   *-DXCCW             LENGTH FOR CLEARING I/O BLOCKS       47830000
CLRECB   EQU   DXDCB-DXECB         LENGTH FOR CLEARING I/O BLOCKS       47860000
*                                                                       47900020
COMMD    EQU   *                   CONTINUE DSECT                       48000020
*                                                                       48100020
*        WORK AREA FOR MPDS COMMUNICATION AND BUFFERING                 48200020
*        A CONTINUATION OF DSECT (WORKD)                                48300020
*                                                                       48400020
*                                                                       48500020
DSAVR    DS    F                   SAVE AREA FOR RETURN REGISTER        48600020
DSAVT    DS    F                   MPDS LAST BLOCK SAVE AREA            48700020
DUCBADDR DS    F                   ADDRESS OF UCB LOOKUP TABLE          48800020
DPMODE   DS    CL1                 PROTECTION MODE BYTE SAVE AREA       48900020
DRECAP   DS    CL1                 SYSRES DEVICE-RECORD/TRK CAPACITY    49000020
DCODTAB  DS    CL1                 ENTRY CODE SAVE AREA FOR NEXT LOAD   49100020
*                                                                       49200020
*        DFLAG - COMMUNICATES STATUS OF DSCB UPDATING REQUIREMENTS      49300020
*                                                                       49400020
DFLAG1   DS    BL1                 COMMUNICATION FLAG                   49500020
*        COMMUNICATION FLAG (DFLAG1) IN COMMD WORK AREA                 49600020
*              1 BYTE  (DFLAG1)                                         49700020
*                   BIT  0  =1 MPDS IS ENQ TO ADD OWN P/W PROTECTION    49800020
*                        1  =1 INDICATES I/O ERROR                      49900020
*                        2  =1 INDICATES ENQUEUED IN 1ST - 2ND LOADS    50000020
*                        3  =1 PROTECTED DATA SET-SET BIT 3 IN DSCB     50100020
*                        4  =1 OBTAIN CORE TO BE FREED                  50200020
*                        5  =1 NO PASSWORD TO READ-SET BIT 5 IN DSCB    50300020
*                        6  =1 UPDATE DSCB OF DATA SET WITH PROTECTION  50400020
*                              SPECIFIED IN BITS 3 AND 5                50500020
*                        7  =1 UPDATE MPDS DSCB FROM CORE IMAGE IN      50600020
*                              WORK AREA (WORKD) AND DEQ ON MPDS        50700020
*                                                                       50800020
DFLAG2   DS    BL1                 COMMUNICATION FLAG                   50900020
*              1 BYTE (DFLAG2)                                          51000020
*                   BIT 0  =1 INDICATES AUTHORIZED USER        @ZA26556 51100037
*                   BIT 1  =1 INDICATES NEW PASSWORD WITH REPLACE       51150037
*                   BIT 2  =1 SECOND PASS SWITCH FOR VALCKRTN  @ZA26556 51200037
*                   BIT 3     RESERVED                                  51400020
*                   BIT 4     RESERVED                                  51500020
*                   BIT 5     RESERVED                                  51600020
*                   BIT 6     RESERVED                                  51700020
*                   BIT 7     RESERVED                                  51800020
*                                                                       51900020
         DS    0CL11               COUNT FIELD FOR I/O                  52000020
DMPEND   DS    CL8                 MBBCCHHR OF LAST RECORD WRITTEN      52100020
DCKDLL   DS    CL3                 KEY LENGTH/DATA LENGTH               52200020
*                                                                       52300020
*        EXCP BUFFER  AREA FOR COUNT KEY DATA READ/WRITE                52400020
*                                                                       52500020
         DS    0F                  ALIGN WORD                           52600020
         DS    CL1                 ALIGN FOR MBBCCHHR                   52700020
DMBB     DS    CL3                 MBB FIELD FOR CONVERT ROUTINE        52800020
         DS    0CL8                COUNT FIELD FOR I/O                  52900020
DCNT     DS    CL4                 CCHH PORTION OF COUNT                53000020
DRECNO   DS    CL1                 RECORD NUMBER                        53100020
DKEYLEN  DS    CL1                 KEY LENGTH FOR FOR WRITE             53200020
DDATALEN DS    CL2                 DATA LENGTH FOR WRITE                53300020
DKEY     DS    CL44                EXCP- 44 BYTE KEY (DSN)              53400020
DKEY8    DS    CL8                 EXCP- 8 BYTE EXTENSION (PASSWORD)    53500020
DATA     DS    0CL80               DATA FIELD                           53600020
DUSE     DS    CL2                 USE COUNT                            53700020
DMODE    DS    BL1                 PROTECTION MODE BYTE FIELD           53800020
DAT77    DS    CL77                USER DATA (77 BYTES OPTIONAL DATA)   53900020
DSAVLL   EQU   *-DCNT              COUNT-KEY-DATA FIELD LENGTH          54000020
DCLEAR   EQU   *-COMMD             WORK AREA TO BE CLEARED TO ZERO      54100020
DFOXKEY  DS    52C                 52 BYTE KEY OF FF                    54200020
         DS    80C                 80 BYTE DATA FIELD                   54300020
*                                                                       54400020
*        OBTAIN LIST                                                    54500020
*                                                                       54600020
OBTPTR   CAMLST SEARCH,OBTDSN,OBTVOL,OBTWRK                             54700020
         ORG   OBTPTR              LABEL OBTAIN FIELDS                  54800020
OBTAIN1  DS    F                   OBTAIN CAMLST FIRST FULL WORD        54900020
OBTAIN2  DS    F                   OBTAIN CAMLST SECOND FULL WORD       55000020
OBTAIN3  DS    F                   OBTAIN CAMLST THIRD FULL WORD        55100020
OBTAIN4  DS    F                   OBTAIN CAMLST FOURTH FULL WORD       55200020
         ORG                                                            55300020
*                                                                       55400020
*        ENQUEUE PARAMETER LIST                                         55500020
*                                                                       55600020
DENQLST  ENQ   (DMPDSQN,DMPDS,E,HLEN,SYSTEM),MF=L                       55700020
*        NAME LIST FOR ENQUEUE/DEQUEUE AND OBTAIN                       55800020
DMPDSQN  DS    0CL52               ONE FIELD FOR SETTING UP IN WORKD    55900020
         DS    CL8                 QNAME                                56000020
DMPDS    DS    CL44                RNAME                                56100020
OBTDSN   EQU   DMPDS               DSNAME OF MASTER PASSWORD DATA SET   56200020
OBTVOL   DS    CL6                 VOLUME SERIAL OF MPDS DSCB VOLUME    56300020
DREPSAV  DS    CL140               SAVEAREA FOR PASSWORD ENTRY          56400020
LOCNAME  CAMLST NAME,DKEY,,LOCAREA LOCATE CAMLST MACRO                  56500020
         ORG   LOCNAME             LABEL LOCATE CAMLST FIELDS           56600020
LOCNAME1 DS    F                   1ST WORD LOCATE CAMLST               56700020
LOCNAME2 DS    F                   2ND WORD LOCATE CAMLST               56800020
LOCNAME3 DS    F                   3RD WORD LOCATE CAMLST               56900020
LOCNAME4 DS    F                   4TH WORD LOCATE CAMLST               57000020
         ORG                                                            57100020
USECOUNT DS    F                   SAVE POINTER TO USER COUNT HERE      57200020
*  KEEP ENQ AND DEQ LISTS TOGETHER.                                     57250020
ENQLIST  ENQ   (QNAME,RNAME,E,RNLENGTH,SYSTEM),RET=USE,MF=L ENQUEUE     57300020
DEQLIST  DEQ   (QNAME,RNAME,RNLENGTH,SYSTEM),RET=HAVE,MF=L DEQUEUE      57350020
*  NOTE - MFT ENQUEUE WITH QNAME EQUAL TO SYSDSN REQUIRES TCB           57360020
*         ADDRESS IMMEDIATELY FOLLOWING THE QNAME.                      57370020
QNAME    DS    CL8                 QNAME BUFFER                         57400020
TCBADDR  DS    F                   TCB ADDRESS FOR MFT ENQUEUE          57450020
RNAME    DS    CL44                RNAME BUFFER                         57500020
OLDFLAG  DS    CL1                 OLD PROTECTION STATUS                57600020
NEWFLAG  DS    CL1                 NEW PROTECTION STATUS                57700020
*  WORK AREA NEEDED FOR ALLOCATION                             @YL026TA 57702000
DAPARM   DS    F                   POINTER TO REQUEST BLOCK    @YL026TA 57704000
DARQBLK  DS    0CL20               DYNAMIC ALLOCATION REQUEST          *57706000
                                   BLOCK                       @YL026TA 57708000
DABLKLN  DS    CL1                 LENGTH OF BLOCK             @YL026TA 57710000
DAVERB   DS    CL1                 VERB CODE FOR REQUEST       @YL026TA 57712000
DAFLGS1  DS    CL2                 FLAGS                       @YL026TA 57714000
DAERRCD  DS    CL2                 ERROR RETURN CODE           @YL026TA 57716000
DAINFO   DS    CL2                 INFORMATIONAL RETURN CODE   @YL026TA 57718000
DATXTPT  DS    CL4                 ADDRESS OF TEXT POINTERS    @YL026TA 57720000
         DS    CL4                 RESERVED                    @YL026TA 57722000
DAFLGS2  DS    CL4                 FLAGS                       @YL026TA 57724000
* TEXT POINTERS                                                @YL026TA 57726000
DATP1    DS    F                                               @YL026TA 57728000
DATP2    DS    F                                               @YL026TA 57730000
DATP3    DS    F                                               @YL026TA 57732000
DATP4    DS    F                                               @YL026TA 57734000
DATP5    DS    F                                               @YL026TA 57736000
*  TEXT UNITS FOR ALLOCATION AND UNALLOCATION                  @YL026TA 57738000
DADSNM   DS    0CL50               DSNAME TEXT UNIT            @YL026TA 57740000
         DS    CL2                 KEY                         @YL026TA 57742000
         DS    CL2                 NUMBER                      @YL026TA 57744000
DADSL    DS    CL2                 LENGTH                      @YL026TA 57746000
DADSN    DS    CL44                DATA SET NAME               @YL026TA 57748000
DASTAT   DS    0CL7                STATUS TEXT UNIT            @YL026TA 57750000
         DS    CL2                 KEY                         @YL026TA 57752000
         DS    CL2                 NUMBER                      @YL026TA 57754000
         DS    CL2                 LENGTH                      @YL026TA 57756000
         DS    CL1                 STATUS INDICATOR FIELD      @YL026TA 57758000
DAUNIT   DS    0CL9                UNIT NAME TEXT UNIT         @YL026TA 57760000
         DS    CL2                 KEY                         @YL026TA 57762000
         DS    CL2                 NUMBER                      @YL026TA 57764000
         DS    CL2                 LENGTH                      @YL026TA 57766000
DAUNAM   DS    CL3                 UNIT NAME FIELD             @YL026TA 57768000
DADDNM   DS    0CL14               DDNAME TEXT UNIT            @YL026TA 57770000
         DS    CL2                 KEY                         @YL026TA 57772000
         DS    CL2                 NUMBER                      @YL026TA 57774000
         DS    CL2                 LENGTH                      @YL026TA 57776000
         DS    CL8                 DDNAME FIELD                @YL026TA 57778000
DAVOL    DS    0CL12               VOLUME TEXT UNIT            @YL026TA 57780000
         DS    CL2                 KEY                         @YL026TA 57782000
         DS    CL2                 NUMBER                      @YL026TA 57784000
         DS    CL2                 LENGTH                      @YL026TA 57786000
DAVOLSR  DS    CL6                 VOLUME SERIAL FIELD         @YL026TA 57788000
*                                                                       57800037
REGSAVE  DS    18F                 REGSAVE AREA                @ZA26556 57850037
RCVTSAVE EQU   REGSAVE+N12         CVT SAVEAREA                @ZA26556 57900037
*              PARAMETER LIST FOR ALL REQUESTS                          58400020
*                                                                       58500020
*                                                                       58600020
*              COMMON  SEGMENT FOR ALL REQUESTS                         58700020
*                                                                       58800020
PARMWDS  DS    0FL7                                            @ZA26556 58850037
ENCODE   DS    0BL1                ENTRY CODE                           58900020
DBUF     DS    CL4                 ADDRESS OF BUFFER FOR CODE 04/05     59000020
DSNLL    DS    0CL1                DSN LENGTH                           59100020
DSN      DS    CL4                 ADDRESS OF DATA SET NAME             59200020
CURRENT  DS    CL4                 ADDRESS OF CURRENT PASSWORD          59300020
*                                                                       59400020
*              ADD / REPLACE / DELETE COMMON SEGMENT                    59500020
*                                                                       59600020
CONTROL  DS    CL4                 ADDRESS OF CONTROL PASSWORD          59700020
VOLNUM   DS    0CL1                NUMBER OF VOLUMES SPECIFIED          59800020
VOLIST   DS    CL4                 ADDRESS OF VOLUME LIST               59900020
*                                                                       60000020
*              ADD / REPLACE  COMMON SEGMENT                            60100020
*                                                                       60200020
PCODE    DS    0BL1                PROTECTION CODE                      60300020
NEW      DS    CL4                 ADDRESS OF NEW PASSWORD              60400020
STRINGL  DS    0CL1                STRING LENGTH                        60500020
STRING   DS    CL4                 ADDRESS OF DATA STRING               60600020
*                                                                       60700020
WKSIZE   EQU   *-WORKD             SIZE OF PROGRAM WORKAREA             60720037
*                                                                       60740037
*        END OF MAPPING OF DSECT WORKAREA                               60760037
         EJECT                                                          60800020
*                                                                       60900020
WRKSPACE DSECT                                                          61000020
*                                                                       61100020
*  OBTAIN WORKAREA AND LOCATE WORKAREA                                  61200020
*                                                                       61300020
OBTWRK   DS    CL96                DSCB                                 61400020
OBTCCH   DS    CL5                 CCHHR                                61500020
         DS    CL249               OBTAIN WORK SPACE                    61600020
         DS    0D                  ALIGN LOCATE WORKAREA                61700020
LOCAREA  DS    CL265               LOCATE WORK SPACE (VOLUME LIST)      61800020
WRKSIZE  EQU   *-WRKSPACE          SIZE OF LOCATE AND OBTAIN WORKAREA   61900020
*                                                                       62000020
         EJECT                                                          62100020
SRT      DSECT                                                          62200020
         IEFUCBOB                                                       62300020
         EJECT                                                          62400020
CVT      DSECT                                                          62500020
         CVT                                                            62600020
         EJECT                                                 @ZA26556 62700037
         IHAPSA                                                @ZA26556 62750037
         END                                                            62800037
./  ADD  SSI=80110399,NAME=IGC0109H
         TITLE 'IGC0109H SVC 98 (PROTECT) SECOND LOAD - PASSWORD DATA SX00100020
               ET MAINTENANCE/UPDATE ROUTINE'                           00200000
IGC0109H CSECT                                                          00210000
*        VS2 RELEASE 037 CHANGES                                        00210237
*A109300,109600,141500,163500,204988-204990,204992-204993      @ZA26557 00210437
*A766000-766500,776500,845000-847000                           @ZA26557 00210537
*C184600,631000,636000,699000,701000                           @ZA25557 00210637
*C633000                                                       @ZA17955 00210837
*                                                                       00210937
*        VS2 030 SU                                                     00211037
*                                                                       00212037
*0000390800-390820                                             @ZA04243 00213037
*                                                                       00214037
*0000005500,227000-227500,302000-304000,317000,323000-324000   @ZA11617 00215037
*0000335000,373400,559000-562200,563800-568600,570200-571000   @ZA11617 00216037
*0000588000,633000                                             @ZA11617 00217037
*                                                                       00218037
*A 071500,168500,371500-371600,373500-373600,379500-390500,631500       00220000
*A 636500,765500-767441,814500-814600                          @YL026TA 00230000
*C 006000,371000,373000,378000,574500,576994,604620-604640,631000       00240000
*C 636000                                                      @YL026TA 00250000
*D 574600-576494,658500-658700                                 @YL026TA 00260000
*A 142500,574900-576994,604620-604640                            YM2237 00310000
*C 574700-574800,658600-658700                                   YM2237 00314000
*D 575000-577000,580500-580700                                   YM2237 00318000
*A 117500,574500-574800                                          YM2667 00322000
*C 576000                                                        YM2667 00326000
*D 373500-373600                                                 YM2667 00330000
*C 580500                                                        YM2158 00334000
*A 335500                                                       SA50964 00338000
*C 309000,336000                                                SA50964 00342000
*D 327500-327600                                                SA50964 00346000
*C 384500,390000,604620                                         ZA00657 00347000
*C 373600                                                       ZA00658 00348000
*A 106600-106700,227500,559500,588600-588700                    ZA01374 00350000
*D 432000                                                      @ZA02233 00400000
*A 666300-666600                                               @ZA06424 00450037
*C 227000-227500,302000-304000,317000,323000-324000,570000     @ZA06424 00480037
*C 335000,373400,559000-562000,564000-568000,571500-571600     @ZA06424 00510037
*C 314500  A 318010  D 280500-280700                           @ZA07995 00530037
*********************************************************************** 00550037
* STATUS -- OS/VS2 RELEASE 037                                 @ZA26557 00600037
*                                                                     * 00630037
*                                                                       00710037
* FUNCTION -- SECOND LOAD OF THE PASSWORD DATA SET MAINTENANCE        * 00750000
*    ROUTINE                                                          * 00900020
*    1. PROCESSES ALL VALID REQUESTS TO MODIFY OR TO PROVIDE          * 01000020
*    INFORMATION FROM THE PASSWORD DATA SET.  THE FOLLOWING ARE VALID * 01100020
*    REQUESTS -                                                       * 01200020
*    ADD - ADD A NEW (CONTROL) ENTRY OR ADD A (SECONDARY) ENTRY       * 01300020
*    REPLACE - REPLACE AN EXISTING ENTRY BY REPLACING (1) THE EIGHT   * 01400020
*    BYTE PASSWORD, (2) PROTECTION MODE, (3) USER DATA FIELD, OR ANY  * 01500020
*    COMBINATION OF THESE THREE.                                      * 01600020
*    DELETE - DELETE A SECONDARY ENTRY OR DELETE A CONTROL ENTRY AND  * 01700020
*    ANY EXISTING SECONDARY ENTRIES FOR A DATA SET NAME               * 01800020
*    LIST - PROVIDE THE REQUESTOR WITH THE 80 BYTE DATA FIELD OF A    * 01900020
*    PARTICULAR ENTRY IN THE PASSWORD DATA SET.                       * 02000020
*    TTR - PROVIDE THE REQUESTOR WITH THE RELATIVE LOCATION (TTR) OF  * 02100020
*    A PARTICULAR ENTRY IN THE PASSWORD DATA SET                      * 02200020
*    2. PROVIDE THE PROTECTION MODE FLAG BIT SETTING FOR THE DSCB OF  * 02300020
*    A DATA SET TO THE NEXT LOAD OF SVC 98.                           * 02400020
*                                                                     * 02500020
* ENTRY POINTS --                                                     * 02600020
*         IGC0109H - ENTRY POINT OF SECOND LOAD, ENTERED BY XCTL FROM * 02700020
*    FIRST LOAD (IGC0009H)                                            * 02800020
*                                                                     * 02900020
* INPUT --                                                            * 03000020
*    REGISTER RPARM POINTS TO INPUT PARAMETER LIST                    * 03100020
*    REGISTER RW POINTS TO WORK AREA                                  * 03200020
*    REGISTER RA CONTAINS ENTRY CODE FOR THIS LOAD                    * 03300020
*    REGISTER RB CONTAINS RETURN CODE FROM FIRST LOAD OF SVC 98       * 03400020
*                                                                     * 03500020
* OUTPUT --                                                           * 03600020
*    REGISTER RW POINTS TO WORK AREA                                  * 03700020
*    REGISTER RPARM POINTS TO INPUT PARAMETER LIST                    * 03800020
*    REGISTER RB PASSES RETURN CODE BETWEEN LOADS OF SVC 98           * 03900020
*                                                                     * 04000020
* EXTERNAL REFERENCES --                                              * 04100020
*         IECPCNVT - BRANCH TO THE RESIDENT DATA MANAGEMENT CONVERT   * 04200020
*    ROUTINE TO CONVERT A RELATIVE DIRECT ACCESS DEIVCE ADDRESS (TTR) * 04300020
*    TO AN ACTUAL DIRECT ACCESS DEVICE ADDRESS (MBBCCHHR)             * 04400020
*         IECPRLTV - BRANCH TO THE RESIDENT DATA MANAGEMENT CONVERT   * 04500020
*    ROUTINE TO CONVERT AN ACTUAL DIRECT ACCESS DEVICE ADDRESS        * 04600020
*    (MBBCCHHR) TO A RELATIVE DIRECT ACCESS DEVICE ADDRESS (TTR)      * 04700020
*         IEA0VL00 - BRANCH TO THE RESIDENT VALIDITY CHECK ROUTINE TO * 04730000
*    VERIFY THAT THE USER-SPECIFIED AREA BELONGS TO HIM.              * 04760000
*                                                                     * 04800020
* EXITS, NORMAL -- XCTL TO IGC0209H TO PROCESS PASSWORD DATA SET      * 04900020
*                                                                     * 05000020
* EXITS, ERROR -- XCTL TO IGC0209H WITH NON-ZERO RETURN CODE          * 05100020
*    04  DATA SET NAME/PASSWORD ALREADY IN PASSWORD DATA SET          * 05200020
*    08  DATA SET NAME/PASSWORD NOT IN PASSWORD DATA SET              * 05300020
*    12  CONTROL PASSWORD IS REQUIRED OR IS INCORRECT                 * 05400020
*    16  INCOMPLETE OR INCORRECT PARAMETER LIST                       * 05500020
*    20  I/O ERROR IN PASSWORD DATA SET                               * 05600020
*    24  PASSWORD DATA SET IS FULL                                    * 05700020
*    28  BUFFER ADDRESS IS INVALID                                    * 05800000
*    RETURN CODES 8, 16, AND 44 CAN OCCUR IN FIRST LOAD OF SVC 98     * 05850000
*                                                                     * 05900020
* TABLES/WORK AREAS --                                                * 06000020
*    WORKD - A CONTIGUOUS AREA DEFINED BY IECDSECT FOR I/O CONTROL    * 06100020
*    BLOCKS FOLLOWED BY A LOCAL WORK AREA FOR COMMUNICATION AND       * 06200020
*    BUFFER SPACE                                                     * 06300020
*    PARMD - A DSECT TO MAP THE INPUT PARAMETER LIST                  * 06400020
*    WRKSPACE - A DSECT TO MAP THE LOCATE AND OBTAIN WORKAREAS        * 06500020
*                                                                     * 06600020
* ATTRIBUTES -- REENTRANT, READ ONLY, PRIVILEGED, ENABLED             * 06700000
*                                                                     * 06800020
* CHARACTER CODE DEPENDENCY -- CHARACTER CODE INDEPENDENT             * 06900020
*                                                                     * 07000020
* NOTES --                                                            * 07100000
*    DESCRIBED IN DADSM LOGIC MANUAL, SY26-3787.               @YL026TA 07150000
*                                                                     * 07200020
*                                                                     * 07300020
*    PASSWORD DATA SET - FORMAT OF EACH 132 BYTE ENTRY                * 07400020
*                                                                     * 07500020
*    *                     *                                       *  * 07600020
*    *    52 BYTE KEY      *       80 BYTE DATA AREA               *  * 07700020
*    ***************************************************************  * 07800020
*    *           *         *         *           *                 *  * 07900020
*    * 44 BYTES  * 8 BYTES * 2 BYTES * 1 BYTE    * 77 BYTES        *  * 08000020
*    *           *         *         *           *                 *  * 08100020
*    * FULLY     * PASSWORD* ACCESS  * PROTECTION* USER DATA FIELD *  * 08200020
*    * QUALIFIED *         * COUNTER * MODE      *                 *  * 08300020
*    * DSNAME    *         *         * INDICATOR *                 *  * 08400020
*    ***************************************************************  * 08500020
*                                                                     * 08600020
*    PROTECTION MODE INDICATOR - FORMAT OF 1 BYTE ENTRY               * 08700020
*    BIT 0   =0 INDICATES SECONDARY PASSWORD                          * 08800020
*    BIT 0   =1 INDICATES CONTROL PASSWORD                            * 08900020
*    BIT 1-6    RESERVED                                              * 09000020
*    BIT 7   =0 PROTECTED DATA SET IS READ ONLY                       * 09100020
*    BIT 7   =1 PROTECTED DATA SET CAN BE READ OR WRITTEN             * 09200020
*                                                                     * 09400020
*********************************************************************** 09500020
         EJECT                                                          09600020
*                                                                       09700020
*        EQUATED SYMBOLS                                                09800020
*                                                                       09900020
SRKEY    EQU   X'A9'               SEARCH-KEY-EQ M/T OP-CODE            10000020
SRID     EQU   X'31'               SEARCH ID OP-CODE                    10100020
WTKDAT   EQU   X'0D'               WRITE KEY-DATA OP-CODE               10200020
SUPDAT   EQU   X'10'               SUPPRESS DATA TRANSFER FLAG          10300020
CHAIN    EQU   X'40'               CHAIN DATA FLAG                      10400020
NKEYLL   EQU   X'2C'               DATA SET NAME KEY LENGTH             10500020
KEYLL    EQU   X'34'               PASSWORD ENTRY KEY LENGTH            10600020
SLI      EQU   X'20'               CCW FLAG - INCORRECT LENGTH  ZA01374 10650000
FF       EQU   X'FF'               ALL BITS IN A BYTE           ZA01374 10660000
HLEN     EQU   X'2C'               MAXIMUM DSNAME LENGTH                10700020
HSTR     EQU   X'4D'               DATA FIELD - 77 BYTES                10800020
ENTLEN   EQU   X'84'               LENGTH OF PASSWORD ENTRY (132 BYTES) 10900020
AUTH     EQU   X'80'               AUTHORIZED USER             @ZA26557 10930037
SECPASS  EQU   X'20'               SECOND PASS SW              @ZA26557 10960037
COMMSK   EQU   X'20'               MASK- TEST FOR SUCCESSFUL I/O        11000020
EXTMSK   EQU   X'02'               MASK- TEST FOR END OF EXTENT         11100020
EOFCK1   EQU   X'41'               TO TEST ERROR EXCEPTION              11200020
EOFCK2   EQU   X'0D'               TO TEST FOR EXCEPTION ON WRITE EOD   11300020
NEWMASK  EQU   X'00'               IDENTIFY FIRST TIME INITIALIZATION   11400020
ADD      EQU   X'01'               ADD ENTRY CODE                       11500020
REPLACE  EQU   X'02'               REPLACE ENTRY CODE                   11600020
DELETE   EQU   X'03'               DELETE ENTRY CODE                    11700020
LIST     EQU   X'04'               LIST ENTRY CODE               YM2667 11750000
CTLPW    EQU   X'80'               MASK- CONTROL PROTECTION CODE        11800020
RDWRT    EQU   X'01'               PROTECTION MODE-READ/WRITE           11900020
PCOD0    EQU   X'00'               PROTECTION CODE MASK FOR DEFAULT     12000020
PCOD3    EQU   X'03'               DEFAULT PROTECTION CODE              12100020
MPENQ    EQU   X'80'               MPDS ENQUEUE FLAG                    12200020
REPASS   EQU   X'40'               MASK INDICATES REPLACE OF PASSWORD   12300020
ENQF     EQU   X'20'               TO SET DFLAG1 -INDICATE ENQUEUES     12400020
MPUPDAT  EQU   X'01'               TO SET FLAG UPDATE MPDS DSCB         12500020
DSNUPDAT EQU   X'02'               DSCB UPDATE INDICATOR                12600020
DSCBP3   EQU   X'10'               DSCB PROTECT BIT INDICATOR           12700020
DSCBP5   EQU   X'04'               DSCB PROTECT BIT INDICATOR           12800020
PROTCHCK EQU   X'10'               TEST FOR ADDRESS PROTECTION CHECK    12820000
UNITCHCK EQU   X'02'               TEST FOR UNIT CHECK           A43379 12850021
CYLINDER EQU   X'20'               TEST FOR CYLINDER END         A43379 12860021
GC209    EQU   C'2'                TO MODIFY XCTL LIST TO IGC0209H      12900020
EQ       EQU   8                   TEST FOR EQUAL COMPARE CONDITION     13000020
ZERO     EQU   0                   ZERO                                 13100020
ONE      EQU   1                   ONE                                  13200020
FOUR     EQU   4                   FOUR                                 13300020
NZ       EQU   14                  FOURTEEN (NON-ZERO MASK)             13400020
N1       EQU   1                   ONE                                  13500020
N2       EQU   2                   TWO                                  13600020
N3       EQU   3                   THREE                                13700020
N4       EQU   4                   FOUR                                 13800020
N5       EQU   5                   FIVE                                 13900020
N7       EQU   7                   SEVEN                                14000020
N8       EQU   8                   EIGHT                                14100020
N12      EQU   12                  TWELVE                      @ZA26557 14150037
N16      EQU   16                  SIXTEEN                              14200020
BUFLEN   EQU   80                  LENGTH OF LIST BUFFER         YM2237 14250000
RNLENGTH EQU   44                  RNAME LENGTH FOR ENQUEUE ON DSCB     14300020
BLANK    EQU   C' '                BLANK                                14400020
HFF      EQU   X'FF'               BYTE OF FF                           14500020
*                                                                       14600020
*        RETURN CODES FOR ALL CONDITIONS  (NORMAL OR ERROR)             14700020
*                                                                       14800020
C4       EQU   4                   RETURN CODE  4                       14900020
C8       EQU   8                   RETURN CODE  8                       15000020
C12      EQU   12                  RETURN CODE 12                       15100020
C16      EQU   16                  RETURN CODE 16                       15200020
C20      EQU   20                  RETURN CODE 20                       15300020
C24      EQU   24                  RETURN CODE 24                       15400020
C28      EQU   28                  RETURN CODE 28                       15500020
C32      EQU   32                  RETURN CODE 32                       15600020
C36      EQU   36                  RETURN CODE 36                       15700020
C40      EQU   40                  RETURN CODE 40                       15800020
C44      EQU   44                  RETURN CODE 44                       15900020
C48      EQU   48                  RETURN CODE 48                       16000020
*                                                                       16100020
*        REGISTER EQUATES                                               16200020
*                                                                       16250020
RP0      EQU   0                   PARAMETER REGISTER                   16300020
R0       EQU   0                   WORK REGISTER               @ZA26557 16350037
RP1      EQU   1                   PARAMETER REGISTER                   16400020
RP2      EQU   2                   PARAMETER REGISTER                   16500020
R2       EQU   2                   WORK REGISTER                        16600020
RC       EQU   3                   WORK REGISTER                        16700020
RPARM    EQU   4                   ADDRESS OF CALLERS PARAMETER LIST    16800020
TCBREG   EQU   4                   TCB ADDRESS FOR VALIDITY CHECK       16850000
RW       EQU   5                   ADDRESS OF WORK AREA (WORKD)         16900020
RWK6     EQU   6                   UNUSED REGISTER                      17000020
RWK7     EQU   7                   WORK REGISTER                        17100020
RWK8     EQU   8                   WORK REGISTER                        17200020
RWK9     EQU   9                   WORK REGISTER                        17300020
RA       EQU   10                  WORK REGISTER                        17400020
RB       EQU   11                  WORK REGISTER                        17500020
RBASE    EQU   12                  BASE REGISTER                        17600020
RD       EQU   13                  SAVE REGISTER                        17700020
RE       EQU   14                  RETURN LINKAGE                       17800020
RF       EQU   15                  LINKAGE/RETURN CODE                  17900020
         EJECT                                                          18000020
         USING WORKD,RW            ESTABLISH ADDRESSABILITY FOR DSECT   18100020
         BALR  RBASE,RP0           GET ADDRESS WHERE LOADED             18300020
         USING *,RBASE             ESTABLISH ADDRESSABILITY FOR PROGRAM 18400000
         B     BRARID              BRANCH AROUND ID            @ZA04243 18420037
         DC    C'IGC0109H'         MODULE ID                   @ZA04243 18440037
         DC    X'7339'             DATE 12/05/77               @ZA26557 18460037
BRARID   EQU   *                                               @ZA04243 18480037
*                                                                       18500020
*        TEST  ENTRY CONDITIONS AS SET UP BY INITIALIZATION (IGC0009H)  18600020
*        UPON ENTRY, THE BRANCH TABLE CODE AND ERROR CODE ARE IN        18700020
*        REGISTERS RA AND RB RESPECTIVELY. THE CONTENTS OF RA WILL      18800020
*        BE USED TO LINK TO THE REQUESTED PROCESSING ROUTINE AFTER      18900020
*        REGISTER RB HAS BEEN TESTED FOR  A NON-ZERO CODE.              19000020
*        IF AN ERROR CODE IS PASSED IN RB, THE ERROR EXIT IS TAKEN.     19100020
*                                                                       19200020
         LA    RD,ERETEND          ADDRESS OF ERROR EXIT                19300020
         LTR   RB,RB               HAS AN ERROR CODE BEEN PASSED        19400020
         BCR   N7,RD               GO TO ERROR EXIT                     19500020
         LA    RWK8,SRCH020        SAVE ADDRESS OF SUBROUTINE           19600020
         B     ENT010(RA)          GO TO PROCESS REQUEST                19700020
ENT010   B     COM050              ADD REQUESTED- FIRST ENTRY IN D/S    19800020
         B     ADD010              ADD REQUESTED                        19900020
         B     COM005              REPLACE REQUESTED                    20000020
         B     COM010              DELETE REQUESTED                     20100020
         B     LST010              LIST REQUESTED                       20200020
*  TTR FUNCTION MUST BE HERE                                     A43379 20210021
*  BRANCHED TO DIRECTLY VIA BRANCH TABLE ABOVE.                  A43379 20220021
*                                                                A43379 20250021
*        TTR REQUEST PROCESSING ROUTINE                          A43379 20300021
*        A REQUEST TO PROVIDE THE RELATIVE TRACK ADDRESS (TTR)   A43379 20350021
*        OF A SPECIFIC PASSWORD ENTRY IS SATISFIED BY RETURNING  A43379 20400021
*        A TTR LEFT ADJUSTED, IN A USER PROVIDED BUFFER.         A43379 20450021
*                                                                A43379 20460021
*        SEARCH FOR CORRECT ENTRY AND READ COUNT FIELD           A43379 20470021
TTR010   BALR  RC,RWK8             SEARCH FOR DSN ENTRY          A43379 20480021
*                                                                A43379 20490021
         B     TTR020              SUCCESS, CONVERT ADDRESS      A43379 20492021
         B     ERET020             ERROR, DS ENTRY NOT FOUND     A43379 20494021
TTR020   LA    RWK7,CVTPRLTV-CVT   CVT OFFSET TO CONVERT ROUTINE A43379 20496021
         BAL   RA,CONV010          CONVERT MBBCCHHR TO TTR       A43379 20498021
         L     RWK9,DBUF           ADDRESS OF REQUESTOR'S BUFFER A43379 20498421
         L     TCBREG,TCBADDR      GET TCB ADDRESS             @ZA26554 20498837
         USING TCB,TCBREG          ESTABLISH TCB BASE          @ZA26554 20498937
         MODESET EXTKEY=RBT234,WORKREG=2   SWITCH TO CALLER KEY@ZA26557 20499037
SKIPKEY  ST    RP0,ZERO(RWK9)      STORE TTR IN BUFFER           A43379 20499137
         MODESET EXTKEY=ZERO       RETURN TO ZERO KEY          @ZA26557 20499237
         DROP  TCBREG                                          @ZA26554 20499337
         B     RET010              PREPARE FOR EXIT              A43379 20499437
         EJECT                                                          20500020
*                                                                       20600020
*        ADD/REPLACE/DELETE REQUEST PROCESSING ROUTINE-                 20700020
*        THIS ROUTINE IS ENTERED ON AN ADD,REPLACE OR DELETE REQUEST    20800020
*        TO PERFORM THE MAINLINE PROCESSING.                            20900020
*        THIS ROUTINE LINKS TO SUBROUTINES FOR EXCP I/O FUNCTIONS,      21000020
*        TO BUILD THE PROPER PROTECTION MODE AND DATA FIELDS,           21100020
*        AND TO SET UP THE DEVICE ADDRESS (CCHHR) FOR AN ENTRY          21200020
*        TO BE ADDED TO THE END OF THE PASSWORD DATA SET.               21300020
*        DSN/PASSWORD FIELDS HAVE BEEN INITIALIZED IN THE FIRST LOAD.   21400020
*        RETURN FROM THE I/O SEARCH ROUTINE (EXCP) IS MADE AS FOLLOWS-  21500020
*                        BR    RC -KEY FOUND/ UPDATE SUCCESSFUL         21600020
*                        B   4(RC)-KEY NOT FOUND-ON SEARCH OF EXTENT    21700020
*        ON ANY OTHER ERROR CONDITION, THE ERROR EXIT IS ENTERED        21800020
*        DIRECTLY FROM THE SEARCH ROUTINE.                              21900020
*                                                                       22000020
*        ENTRY IS MADE HERE FOR ALL ADD REQUESTS EXCEPT                 22100020
*        A FIRST ADD INTO THE PASSWORD DATA SET.                        22200020
*                                                                       22300020
*                                                                       22400020
*        A SEARCH IS MADE FOR AN EXISTING ENTRY WITH THIS DSNAME.       22500020
*                                                                       22600020
ADD010   MVI   DXCCW4+N7,NKEYLL    SRCH KEY LENGTH TO 44 BYTES @ZA11617 22700037
         OI    DXCCW4+N4,SLI       IGNORE INCORRECT LENGTH     @ZA11617 22750037
         BAL   RC,SRCH050          SEARCH FOR ENTRY WITH 44 BYTE DSN    22800020
         B     COM010              FOUND- CONTINUE SEARCH               22900020
         B     COM050              PROCESS AS A CONTROL ENTRY ADD       23000020
*        ENTRY IS MADE HERE FOR A REPLACE REQUEST                       23100020
*        IF THE PASSWORD ITSELF IS BEING REPLACED, A SEARCH IS MADE     23200020
*        TO VERIFY THAT THE NEW PASSWORD DOES NOT ALREADY EXIST         23300020
COM005   TM    DFLAG2,REPASS       IS THE PASSWORD BEING REPLACED       23400020
         BNO   COM010              NO, GO SEARCH FOR DSN/CURRENT PW     23500020
         BALR  RC,RWK8             YES, SEARCH FOR DSN/NEW PASSWORD     23600020
         B     ERET010             NEW PASSWORD FOUND, ERROR            23700020
         L     R2,CURRENT          NOT FOUND, SET UP CURRENT PW SEARCH  23800020
         EX    ZERO,MOVPW          MOVE PASSWORD TO SEARCH KEY AREA     23900020
*        ENTRY IS MADE HERE FOR A DELETE/REPLACE REQUEST                24000020
*                                                                       24100020
*        A SEARCH IS MADE FOR THE DATA SET NAME/PASSWORD. FOR           24200020
*        AN ADD THE (NEW) PASSWORD IS USED, FOR DELETE OR               24300020
*        REPLACE THE (CURRENT) PASSWORD IS USED.                        24400020
*                                                                       24500020
COM010   BALR  RC,RWK8             SEARCH FOR 52 BYTE DSN/PASSWORD KEY  24600020
         B     COM015              FOUND- CONTINUE SEARCH               24700020
         CLI   ENCODE,ADD          NOT FOUND- DETERMINE IF AN ADD..-    24800020
         BNE   ERET020             IF REPLACE/DELETE GO TO ERROR EXIT   24900020
         B     COM020              GO SEARCH FOR CONTROL PASSWORD ENTRY 25000020
COM015   CLI   ENCODE,ADD          ADD SPECIFIED                        25100020
         BE    ERET010             IF ADD-GO TO ERROR EXIT              25200020
*                                                                       25300020
*        REPLACE/DELETE IS SPECIFIED- DETERMINE IF ENTRY BEING          25400020
*        REPLACED OR DELETED IS A CONTROL ENTRY.                        25500020
*                                                                       25600020
         TM    DMODE,CTLPW         IS ENTRY A CONTROL ENTRY             25700020
         BO    COM050              IF YES-TEST FOR DELETE               25800020
*                                                                       25900020
*        THIS ROUTINE IS USED TO SEARCH FOR AND VERIFY THE CONTROL P/W  26000020
*                                                                       26100020
COM020   MVC   DREPSAV(DSAVLL),DCNT SAVE ENTIRE ENTRY FOR UPDATE        26200020
         L     R2,CONTROL          GET,ADDRESS OF CONTROL PASSWORD      26300020
         LTR   R2,R2               IS THE CONTROL PASSWORD PROVIDED     26400020
         LA    RB,C12              SET RETURN CODE IN CASE OF ERROR     26500020
         BCR   N8,RD               IF NOT GO TO ERROR EXIT              26600020
         EX    ZERO,MOVPW          MOVE CONTROL PASSWORD TO KEY FIELD   26700020
         BALR  RC,RWK8             SEARCH FOR 52 BYTE DSN/PASSWORD      26800020
*                                                                       26900020
         B     COM030              FOUND-VERIFY THAT IT IS A CONTROL    27000020
         BR    RD                  NOT FOUND-GO TO ERROR EXIT           27100020
COM030   TM    DMODE,CTLPW         IS THIS A CONTROL ENTRY              27200020
         BCR   NZ,RD               IF NOT GO TO ERROR EXIT              27300020
         XI    DMODE,CTLPW         CONTROL. SET INDICATOR OFF           27400020
         IC    RA,DMODE            SAVE MODE IN EVENT OF SECONDARY ADD  27500021
*                                                                       27600020
*        RESTORE THE FIELDS REQUIRED FOR AN ADD/REPLACE/DELETE          27700020
*                                                                       27800020
         MVC   DCNT(DSAVLL),DREPSAV RESTORE COMPLETE ENTRY TO BUFFER    27900020
         B     COM060              GO TO BUILD ENTRY FIELDS             28000020
*                                                                       28100020
*        ENTRY IS MADE HERE FOR PROCESSING OF ADD/REPLACE/DELETE        28200020
*        REQUESTS FOR CONTROL PASSWORDS IN ORDER TO SET THE DSCB        28300020
*        UPDATE INDICATORS AND SET UP THE PROTECTION MODE MASK          28400020
*                                                                       28500020
COM050   OI    DPMODE,CTLPW        SET CONTROL PASSWORD INDICATION      28600020
         OI    DFLAG1,DSNUPDAT     INDICATE DSCB UPDATE REQUIREMENT     28700020
*                                                                       28800020
*        BUILD PROTECTION MODE/DATA FIELDS                              28900020
*                                                                       29000020
COM060   LA    RWK9,DFOXKEY        GET ADDRESS OF 52 BYTE KEY OF FF'S   29100020
         CLI   ENCODE,DELETE       IS THIS A DELETE REQUEST             29200020
         BE    COM070              GO TO THE DELETE ROUTINE             29300020
         BAL   RC,BLDMD010         GO TO PROTECT MODE BUILD             29400020
         BAL   RC,BLDEN010         GO TO DATA FIELD BUILD               29500020
         CLI   DCODTAB,NEWMASK     IS THIS THE FIRST ENTRY IN DATA SET  29600020
         BE    ADDON010            IF YES- BYPASS SEARCH-ADD ENTRY      29700020
*                                  AT THE BEGINNING OF THE DATA SET     29800020
         CLI   ENCODE,REPLACE      IS THIS A REPLACE                    29900020
         BE    COM075              REPLACE- GO TO UPDATE ENTRY          30000020
         XC    DUSE,DUSE           CLEAR USE COUNT FIELD FOR ADDS       30100020
         ST    RWK9,DXCCW4         KEY ADR TO SRCH KEY CCW     @ZA11617 30200037
         MVI   DXCCW4,SRKEY        CCW TO SRCH ON KEY OF FF'S  @ZA11617 30300037
         OI    DXCCW6+N4,SUPDAT    TURN ON SKIP BIT            @ZA11617 30400037
*                                                                       30500020
*        SEARCH MPDS FOR AN EMPTY ENTRY (KEY ALL FF'S)                  30600020
*                                                                       30700020
         BALR  RC,RWK8             SEARCH FOR EMPTY ENTRY FIELD         30800020
         B     COM080              FOUND- GO ADD ENTRY          SA50964 30900000
ADDON010 BAL   RC,ENBLK010         NOT FOUND- SET UP FOR ADD ON         31000020
*                                                                       31100020
*        SEARCH WILL POSITION FOR A WRITE COUNT-KEY-DATA                31200020
*                                                                       31300020
         BAL   RC,SRCH040          SEARCH/UPDATE ON END OF DATA SET     31400020
         B     EODRTN              ZERO KEY FOR EOF   @ZA07995  SA66202 31450037
EODRTN   EQU   *                                                SA66202 31460000
         XC    DKEYLEN(N3),DKEYLEN UPDATE SUCCESSFUL- INDICATE EOD      31500020
         BAL   RC,ENBLK020         FIND ADDRESS TO WRITE EOD RECORD     31600020
         MVI   DXCCW9+N7,N8        WRITE COUNT OF 8            @ZA11617 31700037
         BAL   RC,SRCH040          WRITE END OF DATA RECORD             31800020
         B     RET010              BRANCH FOR RETURN +0 OR +4  @ZA07995 31850037
         B     RET010              UPDATE SUCCESSFUL- GO TO EXIT        31900020
*        THIS ROUTINE IS ENTERED FOR DELETE REQUESTS TO SET UP FOR      32000020
*        WRITING OF A 52 BYTE KEY OF FFS (SIGNIFYING A DELETED ENTRY    32100020
*        TO THE SEARCH ROUTINE ADDING A NEW PASSWORD)                   32200020
COM070   ST    RWK9,DXCCW9         ADR OF FFS KEY TO WRITE CCW @ZA11617 32300037
         MVI   DXCCW9+N7,KEYLL     WRITE 52 BYTE KEY OF FFS    @ZA11617 32400037
         TM    DPMODE,CTLPW        IS A CONTROL ENTRY BEING DELETED     32500020
         BO    DELC010             IF YES, GO DELETE ALL ENTRIES        32600020
         B     COM090              GO TO WRITE UPDATED ENTRY OF (FF'S)  32700020
*                                                                       32800020
*        THIS ROUTINE WRITES AN UPDATED ENTRY (ADD,DELETE,REPLACE)      32900020
*        IN THE LOCATION OF THE EXISTING ENTRY. THE UPDATE IS           33000020
*        DONE VIA A WRITE KEY-DATA OPERATION.                           33100020
COM075   L     R2,NEW              GET ADDRESS OF NEW P/W FOR REPLACE   33200020
         EX    ZERO,MOVPW          MOVE NEW PASSWORD TO KEY FIELD       33300020
COM080   LA    RWK9,DKEY           KEY FIELD                            33400020
         ST    RWK9,DXCCW9         SET FOR WRITE KEY-DATA      @ZA11617 33500037
COM090   EX    ZERO,MOVCNT         SET IOB SEEK FIELD           SA50964 33550000
         BAL   RC,SRCH030          SEARCH/WRITE UPDATE          SA50964 33620000
         B     RET010              UPDATE SUCCESSFUL- GO TO EXIT        33700020
*                                                                       33800020
*        THIS ROUTINE IS ENTERED WHENEVER IT HAS BEEN DETERMINED THAT   33900020
*        A CONTROL PASSWORD IS BEING DELETED. ALL PASSWORD ENTRIES      34000020
*        WITH THE DATA SET NAME SPECIFIED IN THE PARAMETER LIST WILL    34100020
*        BE DELETED. UPON ENTRY TO THIS ROUTINE, THE SEARCH OF THE      34200020
*        PASSWORD DATA SET WILL BE MADE, STARTING AT THE ENTRY          34300020
*        FOLLOWING THE CONTROL ENTRY. ANY EXISTING SECONDARY PASSWORDS  34400020
*        WILL BE DELETED FIRST, LEAVING THE CONTROL ENTRY UNTIL LAST.   34500020
*                                                                       34600020
DELC010  BAL   RC,SRCH025          UPDATE CHANNEL COMMANDS -DELETE ALL  34700020
         MVC   DREPSAV+HLEN(N5),DCNT SAVE CCHHR OF CONTROL ENTRY        34800020
DELC020  EX    ZERO,MOVCNT         SET IOB SEEK TO LAST COUNT FIELD     34900020
         BAL   RC,SRCH055          SEARCH ON KEY/WRITE UPDATE           35000020
         B     DELC020             UPDATE SUCCESSFUL- RESUME SEARCH     35100020
         MVI   DXDAADDR+N7,ZERO    RESET SEARCH ID TO RECORD ZERO       35200020
*                                  SET TO SEARCH FROM                   35300020
*                                  FIRST ENTRY IN THE DATA SET.         35400020
         MVC   DXDAADDR+N3(N4),DSCLOWLM MOVE LOW EXTENT TO IOB FIELD    35500020
*        RESUME SEARCH FOR 44 BYTE DSNKEY,STARTING AT FIRST ENTRY       35600020
DELC030  BAL   RC,SRCH070          SEARCH ON KEY/WRITE UPDATE           35700020
         B     DELC040             UPDATE SUCCESSFUL-                   35800020
         B     ERET040             END OF EXTENT REACHED WITHOUT        35900020
*                                  FINDING CONTROL ENTRY-ERROR          36000020
DELC050  EX    ZERO,MOVCNT         LAST COUNT TO SEEK ADDRESS    A43379 36400021
         B     DELC030             CONTINUE SEARCH                      36500020
         EJECT                                                          36600020
*                                                                       36700020
*        LIST REQUEST PROCESSING ROUTINE                                36800020
*        A REQUEST TO PROVIDE THE SECURITY COUNTER,PROTECTION MODE      36900020
*        AND OPTIONAL DATA FIELD IS SATISFIED. THE 80 BYTES OF          37000020
*        INFORMATION ARE READ INTO SVC 98'S BUFFER. IF SUCCESSFUL,      37100000
*        THE USER'S BUFFER IS VALIDITY CHECKED, AND THE DATA IS         37140000
*        MOVED TO THE USER'S BUFFER.                           @YL026TA 37180000
*                                                                       37220000
LST010   EQU   *                                               @YL026TA 37260000
         LA    RWK9,DATA           BUFFER ADDRESS              @YL026TA 37300000
         STCM  RWK9,N7,DXCCW6+1       TO READ CCW              @ZA11617 37340037
*                                                                       37400000
*        SEARCH FOR CORRECT ENTRY AND READ DATA INTO BUFFER             37450000
*                                                                       37500020
         BALR  RC,RWK8             SEARCH FOR DSN ENTRY                 37600020
*                                                                       37700020
         B     LST020              SUCCESSFUL RETURN           @YL026TA 37800000
         B     ERET020             ERROR, DATA SET ENTRY NOT FOUND      37880000
*                                                              @YL026TA 37960000
*        DATA SUCCESSFULLY READ. VALIDITY CHECK USER'S AREA.   @YL026TA 38040000
*                                                              @YL026TA 38120000
LST020   EQU   *                                               @YL026TA 38200000
*        HOLD LOCAL LOCK UNTIL AREA HAS BEEN CHECKED AND USED. @YL026TA 38600000
LST030   SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(LOCALLOCK,     *38680000
               IGC0109H(LST040,ERET017)),REGS=USE              ZA00657  38760000
         L     RP1,DBUF            BUFFER ADDRESS              @YL026TA 38840000
         LA    RP2,BUFLEN(RP1)     ADDRESS OF END OF BUFFER    @YL026TA 38920000
         LR    RWK9,RPARM          SAVE PARM REG IN UNUSED REG @YL026TA 39000000
         L     TCBREG,TCBADDR      TCB ADDRESS                 @YL026TA 39080000
         L     RB,CVTPTR           CVT ADDRESS                 @ZA04243 39090037
         USING CVT,RB              CVT ADDRESSABILITY          @ZA04243 39100037
         L     RF,CVT0VL00         ADDRESS OF VALIDITY CHECK   @ZA04243 39110037
         DROP  RB                  CVT NO LONGER NEEDED        @ZA04243 39120037
         BALR  RE,RF               GO VALIDITY CHECK           @YL026TA 39160000
         LR    RPARM,RWK9          RESTORE PARM REG            @YL026TA 39240000
         BC    N7,ERET015          VALIDITY CHECK FAILED       @YL026TA 39320000
*        VALIDITY CHECK OK; MOVE DATA, RELEASE LOCAL LOCK      @YL026TA 39400000
         L     RWK9,DBUF           ADDRESS OF USER'S BUFFER    @YL026TA 39480000
         MVC   ZERO(BUFLEN,RWK9),DATA  MOVE DATA FROM MY AREA TO HIS   *39560000
                                                               @YL026TA 39640000
LST040   SETLOCK RELEASE,TYPE=LOCAL,RELATED=(LOCALLOCK,                *39720000
               IGC0109H(LST030)),REGS=USE                       ZA00657 39800000
         B     RET010              SUCCESSFUL--RETURN          @YL026TA 39880000
         EJECT                                                          40000020
*                                                                       40100020
*        ENBLK ROUTINE - PREPARE TO ADD A RECORD AFTER THE LAST BLOCK.  40200020
*        THIS ROUTINE SETS UP THE IOB SEEK FIELD WITH THE CCHHR ADDRESS 40300020
*        OF THE LAST BLOCK WRITTEN TO A TRACK. IF THERE IS NO ROOM TO   40400020
*        WRITE ANOTHER RECORD, THE RESIDENT CONVERT ROUTINE IS USED     40500020
*        TO FIND THE CCHHR OF THE NEXT TRACK.IN THIS EVENT, THE IOB     40600020
*        SEEK FIELD WILL CONTAIN A CCHHR WITH AN R FIELD OF RECORD 0.   40700020
*        THE COUNT FIELD RECORD NUMBER IS UPDATED BY 1 IN PREPARATION   40800020
*        FOR A WRITE CNT-KEY-DATA.                                      40900020
*                                                                       41000020
ENBLK010 MVC   DCNT(N8),DMPEND+N3  LAST BLOCK CCHHR +KL+DL TO COUNT     41100020
         LH    RWK9,DSAVT          GET TRACK (TT) PORTION OF LAST BLOCK 41200020
         XI    DFLAG1,MPUPDAT      INDICATE MPDS DSCB REQUIRES UPDATE   41300020
ENBLK020 CLC   DSCLSTAR+N2(N1),DRECAP WILL ANOTHER RECORD FIT ON TRACK. 41400020
         LA    R2,ENBLK040         ADDRESS OF COMMON ROUTINE            41500020
         BCR   FOUR,R2             YES. GO SET UP SEARCH ID             41600020
         BH    ENBLK030            NO. LAST ONE HAS BEEN WRITTEN. GET   41700020
*                                  ANOTHER TRACK                        41800020
         CLC   DMPEND+N3(N4),DSCUPPLM THERE IS SPACE FOR 1 MORE RECORD  41900020
*                                  IS THIS THE LAST TRACK IN EXTENT.    42000020
         BCR   FOUR,R2             NO. GO SET UP SEARCH ID FOR RECORD.  42100020
         CLI   DKEYLEN,ZERO        YES. IS END OF FILE BEING WRITTEN    42200020
*                                  IF NOT,SPACE REQUESTED FOR NEW ENTRY 42300020
         LA    RB,C24              SET RETURN CODE IN CASE OF ERROR     42400020
         BCR   N7,RD               PASSWORD DATA SET IS FULL            42500020
         BR    R2                  USE COUNT FIELD FROM PREVIOUS WRITE  42600020
ENBLK030 LA    RWK9,ONE(RWK9)      ADD ONE TRACK TO CURRENT TT FIELD    42700020
         LR    RP0,RWK9            REG 0=TTRN  PRIOR TO CONVERTING      42800020
         SLL   RP0,N16             TTRN REFLECTS-RECORD NO. ZERO        42900020
         LA    RWK7,CVTPCNVT-CVT   OFFSET OF CONVERT ROUTINE IN CVT     43000020
         BAL   RA,CONV010          CONVERT TTR TO MBBCCHHR              43100020
ENBLK040 EX    ZERO,MOVCNT         MOVE COUNT TO IOB SEEK FIELD         43400020
         IC    RA,DRECNO           GET CURRENT RECORD NUMBER            43500020
         LA    RA,ONE(RA)          UPDATE RECORD NUMBER BY ONE          43600020
         STC   RA,DRECNO           PUT IN COUNT FIELD FOR WRITE C-K-D   43700020
         STC   RA,DSCLSTAR+N2      SAVE CURRENT RECORD COUNT            43750020
         CLI   DKEYLEN,ZERO        KEY LENGTH ZERO INDICATING EOF       43800020
         BCR   N8,RC               IF YES, DO NOT UPDATE TTR FOR DSCB   43900020
         STH   RWK9,DSAVT          SAVE TT PORTION OF TTR               44000020
         STC   RA,DSAVT+N2         SAVE R PORTION OF TTR                44100020
         BR    RC                  RETURN                               44200020
         EJECT                                                          44300020
*                                                                       44400020
*        PROTECTION MODE ANALYSIS- THIS ROUTINE USES THE PROTECTION     44500020
*        CODE SPECIFIED IN THE INPUT PARAMETER LIST TO CREATE THE       44600020
*        CORRECT PROTECTION MODE BYTE FOR THE PASSWORD BEING ADDED      44700020
*        OR REPLACED. IF THE PASSWORD IS A CONTROL PASSWORD, INDICATORS 44800020
*        ARE SET TO UPDATE THE DSCB WITH REQUESTED PROTECTION.          44900020
*                                                                       45000020
BLDMD010 CLI   PCODE,PCOD0         IS DEFAULT PROTECTION REQUESTED      45100020
         BNE   BLDMD020            IF NOT,CONVERT TO PROTECT MODE       45200020
         CLI   ENCODE,REPLACE      IS THIS A REPLACE WITH DEFAULT MODE  45300020
         BE    BLDMD035            USE EXISTING MODE IF REPLACE         45400020
         CLI   DPMODE,CTLPW        IS THIS A CONTROL PASSWORD ADD       45500020
         BNE   BLDMD050            USE CONTROL P/W MODE AS DEFAULT      45600021
         OI    DPMODE,PCOD3        IF CONTROL BEING ADDED, USE (03)     45700020
         B     BLDMD025            GO TO SET UPDATE FLAGS               45800020
BLDMD020 OC    DPMODE(N1),PCODE    USE CODE TO MASK REQUESTED OPTIONS   45900020
         TM    DPMODE,CTLPW        IS THIS A CONTROL PASSWORD ENTRY     46000020
         BNO   BLDMD030            IF NOT DSCB UPDATE IS NOT REQUIRED   46100020
BLDMD025 OI    DFLAG1,DSCBP3       SET  FOR DSCB UPDATE-PROTECTED       46200020
         TM    DPMODE,PCOD3        IS NOPWREAD/PWWRITE REQUESTED        46300020
         BNO   BLDMD030            IF NOT DO NOT RESET FLAGS            46400020
         OI    DFLAG1,DSCBP5       YES-SET DSCB FLAG-NOPWREAD           46500020
BLDMD030 NI    DPMODE,CTLPW+RDWRT  CONVERT MASK TO PROTECT MODE         46600020
         BR    RC                  RETURN                               46700020
BLDMD035 NI    DFLAG1,HFF-DSNUPDAT TURN OFF DSCB UPDATE INDICATOR       46800020
BLDMD040 IC    RA,DMODE            FOR REPLACE, GET EXISTING MODE       46900021
BLDMD050 STC   RA,DPMODE           SAVE MODE FOR INSERTION IN ENTRY     47000020
*                                  DURING DATA BUILD ROUTINE            47100020
         BR    RC                  RETURN                               47200020
         EJECT                                                          47300020
*                                                                       47400020
*        DATA AREA BUILD ROUTINE                                        47500020
*        THIS ROUTINE CREATES AN 80 BYTE DATA FIELD FOR A PASSWORD      47600020
*        ENTRY. THE FIELD MAY CONSIST OF BLANKS IF A NULL STRING WAS    47700020
*        SPECIFIED OR IF THE ROUTINE IS ENTERED TO BUILD A DELETED      47800020
*        ENTRY.                                                         47900020
*                                                                       48000020
BLDEN010 XR    RA,RA               CLEAR BYTE REGISTER FOR MOVE         48100020
         L     RB,STRING           STRING COUNT AND POINTER             48200020
         SLDA  RA,N8               SET UP STRING LENGTH IN REGISTER RA  48300020
*                                  BY SHIFT OF LENGTH/ADDRESS IN REG RB 48400020
         BNZ   BLDEN020            IF STRING EXISTS,MOVE IT             48500020
         CLI   ENCODE,REPLACE      IS REPLACE SPECIFIED WITHOUT STRING  48600020
         BE    BLDEN030            DEFAULT TO USE OF EXISTING FIELD     48700020
BLDEN020 EQU   *                   ADD OR DELETE IS SPECIFIED           48800020
         MVI   DAT77,BLANK         CLEAR WITH BLANKS                    48900020
         MVC   DAT77+N1(HSTR-N1),DAT77 CLEAR BUFFER FOR ALL ENTRIES     49000020
         SRA   RB,N8               ADJUST STRING POINTER TO ADDRESS     49100020
         BZ    BLDEN030            TEST FOR NULL STRING                 49200020
         LR    R2,RB               SAVE STRING POINTER                  49300020
         LTR   RA,RA               TEST LENGTH                          49400020
         LA    RB,C16              SET RETURN CODE IN CASE OF ERROR     49500020
         BCR   N8,RD               ZERO LENGTH IS AN ERROR              49600020
         BCTR  RA,ZERO             DECREMENT LENGTH FOR EXECUTE         49700020
         EX    RA,MOVSTR           MOVE STRING TO DATA BUFFER           49800020
BLDEN030 IC    RA,DPMODE           PLACE PROTECTION MODE                49900020
         STC   RA,DMODE            IN PROTECTION MODE FIELD             50000020
         BR    RC                  RETURN                               50100020
         EJECT                                                          50200020
*        THIS ROUTINE PROVIDES LINKAGE TO THE RESIDENT DATA             50300020
*        MANAGEMENT CONVERT ROUTINES.                                   50400020
*        CONVERT ROUTINES                                               50500020
*                                                                       50600020
*              MBBCCHHR TO TTR CONVERSION                               50700020
*        INPUT                                                          50800020
*        LOCATION (DMBB) MUST CONTAIN A VALUE-MBBCCHHR                  50900020
*        REGISTER RWK7 MUST CONTAIN OFFSET IN CVT OF CONVERT ROUTINE    51000020
*                                                                       51100020
*        OUTPUT                                                         51200020
*              REGISTER RP0 CONTAINS THE VALUE TTRN                     51300020
*                                                                       51400020
*              TTR TO MBBCCHHR CONVERSION                               51500020
*        INPUT                                                          51600020
*        REGISTER RP0 MUST CONTAIN A VALUE-TTRN                         51700020
*        REGISTER RWK7 MUST CONTAIN OFFSET IN CVT OF CONVERT ROUTINE    51800020
*                                                                       51900020
*        OUTPUT                                                         52000020
*              LOCATION (DMBB) CONTAINS THE CONVERTED VALUE             52100020
*                                                                       52200020
CONV010  L     RF,CVTPTR           CVT OFFSET                           52300020
         L     RF,ZERO(RWK7,RF)    SET UP BASE FOR CONVERT ROUTINE      52400020
         LA    RP1,DXDEB           DEB ADDRESS                          52500020
         LA    RP2,DMBB            FULL MBBCCHHR ADDRESS                52600020
         STM   RWK9,RD,RNAME       SAVE REGISTERS                       52700020
         BALR  RE,RF               GO TO CONVERT                        52800020
         LM    RWK9,RD,RNAME       RESTORE REGISTERS                    52900020
         BR    RA                  RETURN TO CALLER                     53000020
         EJECT                                                   A43379 53050021
*  CYLINDER BOUNDRY REACHED, SEARCH NOT COMPLETE                 A43379 53060021
*  UPDATE CYLINDER-HEAD ADDRESS AND CONTINUE SEARCH              A43379 53070021
CYLEND   MVC   DCNT(N5),DXDAADDR+N3 MOVE CYLINDER-HEAD ADDRESS   A43379 53080021
         LH    RWK7,DCNT           LOAD CYLINDER COUNT           A43379 53090021
         LA    RWK7,ZERO(RWK7)     UP CYLINDER COUNT             A43379 53092021
         SLL   RWK7,N16            ZERO HEAD ADDRESS             A43379 53094021
         ST    RWK7,DCNT           SAVE UPDATED ADDRESS          A43379 53096021
         EX    ZERO,MOVCNT         SET IOB SEEK FIELD            A43379 53098021
         B     SRCH070             REISSUE I/O                   A43379 53098421
         EJECT                                                          53100020
*                                                                       53200020
*        SEARCH ROUTINE- EXECUTE CHANNEL PROGRAMS TO SEARCH MPDS        53300020
*        THE  IOB,DEB AND CCW LISTS ARE MODIFED FOR EACH REQUEST        53400020
*        PRIOR TO THE EXCP BEING ISSUED.                                53500020
*                                                                       53800020
*        MODIFY CCW LIST TO PERFORM A WRITE KEY-DATA OPERATION          53900020
*                                                                       54000020
*        SEARCH CHANNEL PROGRAM                                         54100020
*                                                                       54200020
*              SEARCH ID EQ                 DXCCW1                      54300020
*              TIC                          DXCCW2                      54400020
*              READ COUNT                   DXCCW3                      54500037
*              SEARCH KEY EQ                DXCCW4                      54600037
*              TIC                          DXCCW5                      54700037
*              READ DATA                    DXCCW6                      54800037
*                                                                       54900037
*        WRITE UPDATE CHANNEL PROGRAM                                   55000037
*                                                                       55100037
*              SEARCH ID EQ                 DXCCW7                      55200037
*              TIC                          DXCCW8                      55300037
*              WRITE CNT-KEY-DATA/KEY-DATA  DXCCW9                      55400037
*              SEARCH ID EQ                 DXCCW10                     55500037
*              TIC                          DXCCW11                     55600037
*              READ DATA (VALIDATE)         DXCCW12                     55700037
*                                                                       55800020
SRCH025  MVI   DXCCW4+N7,NKEYLL    SET KEY LENGTH TO 44        @ZA11617 55900037
         OI    DXCCW4+N4,SLI       IGNORE INCORRECT LENGTH     @ZA11617 55980037
         OI    DXCCW6+N4,SUPDAT+CHAIN  ON SKIP AND CHAIN BITS  @ZA11617 56060037
SRCH030  MVI   DXCCW9,WTKDAT       WRITE KEY-DATA TO CCW       @ZA11617 56140037
         MVI   DXCCW9+N7,ENTLEN    SET CCW FOR WRITE KEY-DATA  @ZA11617 56220037
         LA    RWK7,DCNT           ADDRESS OF COUNT FIELD               56300037
         ST    RWK7,DXCCW7         POINT TO THE COUNT FIELD OF @ZA11617 56380037
         ST    RWK7,DXCCW10        RECORD NUMBER TO BE WRITTEN @ZA11617 56460037
         MVI   DXCCW7,SRID         REPLACE OP-CODE CCW         @ZA11617 56540037
         MVI   DXCCW10,SRID        REPLACE OP-CODE CCW         @ZA11617 56620037
         TM    DXCCW6+N4,CHAIN     CCWLIST CONTROL PW DELETE?  @ZA11617 56700037
         BCR   ONE,RC              YES, RETURN                          56780037
SRCH040  LA    RWK7,DXCCW7         ADR OF SRCH-ID/UPDATE LIST  @ZA11617 56860037
         B     SRCH060             GO TO I/O ROUTINE                    56940037
SRCH020  MVI   DXCCW4+N7,KEYLL     SET KEY LENGTH TO 52 BYTES  @ZA11617 57020037
         NI    DXCCW4+N4,FF-SLI    ALLOW LENGTH CHECKING       @ZA11617 57100037
SRCH050  MVC   DXDAADDR+N3(N4),DSCLOWLM MOVE LOW EXTENT TO IOB FIELD    57200020
SRCH055  LA    RWK7,DXCCW          ADDRESS OF BASIC SEARCH CCWLIST      57300020
SRCH060  ST    RWK7,IOBSIOCC       UPDATE IOB POINTER TO CCW LIST       57400020
SRCH070  EQU   *                   ISSUE I/O                   @YL026TA 57500000
         EXCP  DXIOB               ISSUE EXCP                  @YL026TA 57600000
*                                                                       57800020
         WAIT  ECB=DXECB           ISSUE WAIT                           57900020
*                                                                       58000020
         TM    DXECB,COMMSK        DID I/O COMPLETE                     58100000
         BCR   ONE,RC              RETURN TO CALLER - SUCCESSFUL I/O    58170020
         TM    DXECB,EXTMSK        WAS END OF EXTENT REACHED            58240020
         BNO   EXCPCOND            NO, CHECK FOR EXCEPTIONAL CONDITION  58310020
         LA    RC,FOUR(RC)         YES, SET FOR RETURN, POSSIBLE ERROR  58380020
         BR    RC                  RETURN                               58450020
EXCPCOND CLI   DXECB,EOFCK1        IS THERE AN EXCEPTIONAL CONDITION    58520020
         BNE   ERET040             IF NOT, ASSUME PERMANENT ERROR       58590020
         CLI   IOBSTAT0,EOFCK2     ON EXCEPTION, IS IT FOR EOD          58700020
         BCR   EQ,RC               EXPECTED FOR EOD-RETURN     @ZA11617 58800037
         TM    IOBSTAT0,UNITCHCK   UNIT CHECK                    A43379 58850021
         BO    SRCH090             YES, THEN NOT I/O ERROR       A43379 58860000
         CLI   DKEYLEN,X'00'       FILE MARK                    ZA01374 58862000
         BC    EQ,4(RC)            YES, EOD RETURN              ZA01374 58862400
         TM    IOBSTAT1,PROTCHCK   ADDRESS PROTECTION CHECK?            58864000
         BO    ERET015             YES, BUFFER ADDRESS NOT VALID        58868000
         B     ERET040             NO, I/O ERROR                        58872000
SRCH090  TM    IOBSENS1,CYLINDER   CYLINDER END                  A43379 58876000
         BO    CYLEND              YES, CONTINUE                 A43379 58880021
*                                                                       58900020
*        PERMANENT ERROR CONDITION EXISTS                               59000020
*                                                                       59100020
         EJECT                                                          59200020
*                                                                       59300020
*                                                                       59400020
*        ERROR EXIT- ENTERED WHEN AN ERROR CONDITION HAS BEEN DETECTED  59500020
*        IN IGC0009H OR IGC0109H.                                       59600020
*              ERROR CODE IS IN REGISTER RB ON ENTRY TO ERETEND         59700000
*              ADDITIONAL ENTRY POINTS ARE PROVIDED FOR SPECIFIC        59800020
*              ERROR CONDITIONS TO PROVIDE THE ERROR CODE.              59900020
*                                                                       60000020
ERET040  LA    RB,C20              I/O ERROR IN PASSWORD DATA SET       60100020
         BR    RD                  GO TO EXIT                           60200020
ERET010  LA    RB,C4               REQUESTED PASSWORD ALREADY EXISTS    60300020
         BR    RD                  GO TO EXIT                           60400020
ERET015  LA    RB,C28              BUFFER ADDRESS FAILED PROTECTION    *60410000
                                   CHECK                                60420000
ERET017  SETLOCK RELEASE,TYPE=LOCAL,REGS=USE,RELATED=(LOCALLOCK,       *60430000
               IGC0109H(LST030))   RELEASE LOCAL LOCK           ZA00657 60440000
         BR    RD                  GO TO EXIT                           60450000
ERET020  LA    RB,C8               REQUESTED ENTRY NOT FOUND            60500020
ERETEND  NI    DFLAG1,HFF-(MPUPDAT+DSNUPDAT) NO DSCB UPDATE ON ERROR    60600020
         B     RET020              GO DEQUEUE VIA NORMAL EXIT           60700020
DELC040  CLC   DREPSAV+HLEN(N5),DCNT WAS THE LAST DELETE FOR     A43379 60750021
*                                  THE CONTROL ENTRY.            A43379 60760021
         BNE   DELC050             NO, GO SET IOB SEEK FIELD     A43379 60770021
*                                                                       60800020
*        EXIT ROUTINE                                                   60900020
*        ENTERED PRIOR TO XCTL TO IGC0209H OR ON RETURNING UNDER        61000020
*        NORMAL OR ERROR CONDITIONS TO PERFORM DEQUEUES.                61100020
*                                                                       61200020
RET010   XR    RB,RB               CLEAR RETURN CODE TO ZERO            61300020
*        DETERMINE HOW MANY DEQUEUES MUST BE DONE PRIOR TO EXIT.        61400020
RET020   LA    RP1,DENQLST         POINT TO DEQUEUE LIST                61500020
         TM    DFLAG1,ENQF         WERE ANY ENQUEUES DONE IN IGC0009H   61600020
         BNO   RET050              IF NOT INDICATED SKIP DEQUEUES       61700020
         CLI   ENCODE,ADD          ADD SPECIFIED                        61800020
         BNE   RET040              DO SINGLE DEQUEUE ON DSN             61900020
         TM    DFLAG1,MPUPDAT+MPENQ DETERMINE HOW MANY DEQUEUES NEEDED  62000020
         BO    RET050              ENQ WAS DONE TO PROTECT THE MPDS,    62100020
*                                  DO THE DEQUEUE IN THE FINAL LOAD     62200020
         BM    RET040              IF ERROR EXISTS, ENQ IS ON MPDS,     62300020
*                                  IF THIS IS NOT AN ERROR, MPDS DEQ    62400020
*                                  MUST BE DONE IN THE FINAL LOAD AFTER 62500020
*                                  THE DSCB IS UPDATED.                 62600020
*                                  CODE IS ZERO, BOTH DEQUEUES REQUIRED 62700020
*                                                                       62800020
*        DEQUEUE ON PASSWORD DATA SET                                   62900020
*                                                                       63000020
RET030   DEQ   MF=(E,(1)),RELATED=(SYSZPSWD-PASSWORD,IGC0009H(CHK030)) *63100037
                                   DEQUEUE                     @YL026TA 63150000
         LA    RP1,DENQLST         POINT TO DEQUEUE LIST                63200020
RET040   LA    RWK9,DKEY           DS NAME FROM KEY AREA       @ZA17955 63300037
         ST    RWK9,DENQLST+N8     DSNAME TO DEQUEUE LIST               63400020
*        DEQUEUE ON DATA SET ENTRY IN PASSWORD DATA SET                 63500020
         DEQ   MF=(E,(1)),RELATED=(SYSZPSWD-USERDATA,IGC0009H(CHK020)) *63600037
                                   DEQUEUE                     @YL026TA 63650000
*                                                                       63700020
*        EXIT IS MADE TO THE THIRD LOAD (IGC0209H) TO PERFORM           63800020
*        UPDATING OF DSCBS OR TO CLEAN UP AND RETURN TO CALLER.         63900020
*        A NON-ZERO RETURN CODE IS IN REGISTER RB IF AN ERROR           64000020
*        CONDITION EXISTS. ON A NORMAL EXIT TO IGC0209H, FLAGS          64100020
*        ARE SET IN (DFLAG1) TO INDICATE DSCB UPDATING IF REQUIRED.     64200020
*                                                                       64300020
*        NORMAL EXIT IF DSCB UPDATING IS REQUIRED                       64400020
*        THE XCTL PARAMETER LIST ADDRESS IS IN REGISTER RD              64500020
*                                                                       64600020
RET050   LA    RD,DXJBF            XCTL PARAMETER LIST ADDRESS          64700020
         MVI   N4(RD),GC209        MODIFY LIST TO (IGC0209H)            64800020
         LA    RF,N8(RD)           ADDRESS OF LIST POINTER FOR XCTL     64900020
*                                                                       65000020
*        XCTL  TO NEXT LOAD OF SVC 98                                   65100020
*                                                                       65200020
         XCTL  EPLOC=(RD),DCB=0,SF=(E,(15)) XCTL                        65300020
         EJECT                                                          65400020
*        CONSTANTS                                                      65500020
MOVCNT   MVC   DXDAADDR+N3(N5),DCNT MOVE COUNT TO IOB SEEK FIELD        65600020
MOVPW    MVC   DKEY8(N8),ZERO(R2)  MOVE PASSWORD TO KEY FIELD           65700020
MOVSTR   MVC   DAT77(ZERO),ZERO(R2) MOVE DATA STRING TO BUFFER          65800020
         EJECT                                                          65900020
*        THIS WORK AREA IS USED BY ALL LOADS OF THE PROTECT SVC.        66000020
*        ANY CHANGES TO IT MUST BE MADE TO ALL LOADS.                   66100020
*                                                                       66200020
WORKD    DSECT                                                          66300020
*                                                                       66400020
         IECDSECT                                                       66500020
CLEARIO  EQU   *-DXECB             LENGTH FOR CLEARING I/O BLOCKS       66600020
*                                                                       66700020
COMMD    EQU   *                   CONTINUE DSECT                       66800020
*                                                                       66900020
*        WORK AREA FOR MPDS COMMUNICATION AND BUFFERING                 67000020
*        A CONTINUATION OF DSECT (WORKD)                                67100020
*                                                                       67200020
*                                                                       67300020
DSAVR    DS    F                   SAVE AREA FOR RETURN REGISTER        67400020
DSAVT    DS    F                   MPDS LAST BLOCK SAVE AREA            67500020
DUCBADDR DS    F                   ADDRESS OF UCB LOOKUP TABLE          67600020
DPMODE   DS    CL1                 PROTECTION MODE BYTE SAVE AREA       67700020
DRECAP   DS    CL1                 SYSRES DEVICE-RECORD/TRK CAPACITY    67800020
DCODTAB  DS    CL1                 ENTRY CODE SAVE AREA FOR NEXT LOAD   67900020
*                                                                       68000020
*        DFLAG - COMMUNICATES STATUS OF DSCB UPDATING REQUIREMENTS      68100020
*                                                                       68200020
DFLAG1   DS    BL1                 COMMUNICATION FLAG                   68300020
*        COMMUNICATION FLAG (DFLAG1) IN COMMD WORK AREA                 68400020
*              1 BYTE  (DFLAG1)                                         68500020
*                   BIT  0  =1 MPDS IS ENQ TO ADD OWN P/W PROTECTION    68600020
*                        1  =1 INDICATES I/O ERROR                      68700020
*                        2  =1 INDICATES ENQUEUED IN 1ST - 2ND LOADS    68800020
*                        3  =1 PROTECTED DATA SET-SET BIT 3 IN DSCB     68900020
*                        4  =1 OBTAIN WORKAREA TO BE FREED              69000020
*                        5  =1 NO PASSWORD TO READ-SET BIT 5 IN DSCB    69100020
*                        6  =1 UPDATE DSCB OF DATA SET WITH PROTECTION  69200020
*                              SPECIFIED IN BITS 3 AND 5                69300020
*                        7  =1 UPDATE MPDS DSCB FROM CORE IMAGE IN      69400020
*                              WORK AREA (WORKD) AND DEQ ON MPDS        69500020
*                                                                       69600020
DFLAG2   DS    BL1                 COMMUNICATION FLAG                   69700020
*              1 BYTE (DFLAG2)                                          69800020
*                   BIT 0  =1 INDICATES AUTHORIZED USER        @ZA26557 69900037
*                   BIT 1  =1 INDICATES NEW PASSWORD WITH REPLACE       69950037
*                   BIT 2  =1 SECOND PASS SWITCH FOR VALCKRTN  @ZA26557 70000037
*                   BIT 3     RESERVED                                  70200020
*                   BIT 4     RESERVED                                  70300020
*                   BIT 5     RESERVED                                  70400020
*                   BIT 6     RESERVED                                  70500020
*                   BIT 7     RESERVED                                  70600020
*                                                                       70700020
         DS    0CL11               COUNT FIELD FOR I/O                  70800020
DMPEND   DS    CL8                 MBBCCHHR OF LAST RECORD WRITTEN      70900020
DCKDLL   DS    CL3                 KEY LENGTH/DATA LENGTH               71000020
*                                                                       71100020
*        EXCP BUFFER  AREA FOR COUNT KEY DATA READ/WRITE                71200020
*                                                                       71300020
         DS    0F                  ALIGN WORD                           71400020
         DS    CL1                 ALIGN FOR MBBCCHHR                   71500020
DMBB     DS    CL3                 MBB FIELD FOR CONVERT ROUTINE        71600020
         DS    0CL8                COUNT FIELD FOR I/O                  71700020
DCNT     DS    CL4                 CCHH PORTION OF COUNT                71800020
DRECNO   DS    CL1                 RECORD NUMBER                        71900020
DKEYLEN  DS    CL1                 KEY LENGTH FOR FOR WRITE             72000020
DDATALEN DS    CL2                 DATA LENGTH FOR WRITE                72100020
DKEY     DS    CL44                EXCP- 44 BYTE KEY (DSN)              72200020
DKEY8    DS    CL8                 EXCP- 8 BYTE EXTENSION (PASSWORD)    72300020
DATA     DS    0CL80               DATA FIELD                           72400020
DUSE     DS    CL2                 USE COUNT                            72500020
DMODE    DS    BL1                 PROTECTION MODE BYTE FIELD           72600020
DAT77    DS    CL77                USER DATA (77 BYTES OPTIONAL DATA)   72700020
DSAVLL   EQU   *-DCNT              COUNT-KEY-DATA FIELD LENGTH          72800020
DCLEAR   EQU   *-COMMD             WORK AREA TO BE CLEARED TO ZERO      72900020
DFOXKEY  DS    52C                 52 BYTE KEY OF FF                    73000020
         DS    80C                 80 BYTE DATA FIELD                   73100020
*                                                                       73200020
*        OBTAIN LIST                                                    73300020
*                                                                       73400020
OBTPTR   CAMLST SEARCH,OBTDSN,OBTVOL,OBTWRK                             73500020
         ORG   OBTPTR              LABEL OBTAIN FIELDS                  73600020
OBTAIN1  DS    F                   OBTAIN CAMLST FIRST FULL WORD        73700020
OBTAIN2  DS    F                   OBTAIN CAMLST SECOND FULL WORD       73800020
OBTAIN3  DS    F                   OBTAIN CAMLST THIRD FULL WORD        73900020
OBTAIN4  DS    F                   OBTAIN CAMLST FOURTH FULL WORD       74000020
         ORG                                                            74100020
*                                                                       74200020
*        ENQUEUE PARAMETER LIST                                         74300020
*                                                                       74400020
DENQLST  ENQ   (DMPDSQN,DMPDS,E,HLEN,SYSTEM),MF=L                       74500020
*        NAME LIST FOR ENQUEUE/DEQUEUE AND OBTAIN                       74600020
DMPDSQN  DS    0CL52               ONE FIELD FOR SETTING UP IN WORKD    74700020
         DS    CL8                 QNAME                                74800020
DMPDS    DS    CL44                RNAME                                74900020
OBTDSN   EQU   DMPDS               DSNAME OF MASTER PASSWORD DATA SET   75000020
OBTVOL   DS    CL6                 VOLUME SERIAL OF MPDS DSCB VOLUME    75100020
DREPSAV  DS    CL140               SAVEAREA FOR PASSWORD ENTRY          75200020
LOCNAME  CAMLST NAME,DKEY,,LOCAREA LOCATE CAMLST MACRO                  75300020
         ORG   LOCNAME             LABEL LOCATE CAMLST FIELDS           75400020
LOCNAME1 DS    F                   1ST WORD LOCATE CAMLST               75500020
LOCNAME2 DS    F                   2ND WORD LOCATE CAMLST               75600020
LOCNAME3 DS    F                   3RD WORD LOCATE CAMLST               75700020
LOCNAME4 DS    F                   4TH WORD LOCATE CAMLST               75800020
         ORG                                                            75900020
USECOUNT DS    F                   SAVE POINTER TO USER COUNT HERE      76000020
*  KEEP ENQ AND DEQ LISTS TOGETHER.                                     76050020
ENQLIST  ENQ   (QNAME,RNAME,E,RNLENGTH,SYSTEM),RET=USE,MF=L ENQUEUE     76100020
DEQLIST  DEQ   (QNAME,RNAME,RNLENGTH,SYSTEM),RET=HAVE,MF=L DEQUEUE      76150020
*  NOTE - MFT ENQUEUE WITH QNAME EQUAL TO SYSDSN REQUIRES TCB           76160020
*         ADDRESS IMMEDIATELY FOLLOWING QNAME.                          76170020
QNAME    DS    CL8                 QNAME BUFFER                         76200020
TCBADDR  DS    F                   TCB ADDRESS FOR MFT ENQUEUE          76250020
RNAME    DS    CL44                RNAME BUFFER                         76300020
OLDFLAG  DS    CL1                 OLD PROTECTION STATUS                76400020
NEWFLAG  DS    CL1                 NEW PROTECTION STATUS                76500020
*  WORK AREA NEEDED FOR ALLOCATION                             @YL026TA 76502000
DAPARM   DS    F                   POINTER TO REQUEST BLOCK    @YL026TA 76504000
DARQBLK  DS    0CL20               DYNAMIC ALLOCATION REQUEST          *76506000
                                   BLOCK                       @YL026TA 76508000
DABLKLN  DS    CL1                 LENGTH OF BLOCK             @YL026TA 76510000
DAVERB   DS    CL1                 VERB CODE FOR REQUEST       @YL026TA 76512000
DAFLGS1  DS    CL2                 FLAGS                       @YL026TA 76514000
DAERRCD  DS    CL2                 ERROR RETURN CODE           @YL026TA 76516000
DAINFO   DS    CL2                 INFORMATIONAL RETURN CODE   @YL026TA 76518000
DATXTPT  DS    CL4                 ADDRESS OF TEXT POINTERS    @YL026TA 76520000
         DS    CL4                 RESERVED                    @YL026TA 76522000
DAFLGS2  DS    CL4                 FLAGS                       @YL026TA 76524000
* TEXT POINTERS                                                @YL026TA 76526000
DATP1    DS    F                                               @YL026TA 76528000
DATP2    DS    F                                               @YL026TA 76530000
DATP3    DS    F                                               @YL026TA 76532000
DATP4    DS    F                                               @YL026TA 76534000
DATP5    DS    F                                               @YL026TA 76536000
*  TEXT UNITS FOR ALLOCATION AND UNALLOCATION                  @YL026TA 76538000
DADSNM   DS    0CL50               DSNAME TEXT UNIT            @YL026TA 76540000
         DS    CL2                 KEY                         @YL026TA 76542000
         DS    CL2                 NUMBER                      @YL026TA 76544000
DADSL    DS    CL2                 LENGTH                      @YL026TA 76546000
DADSN    DS    CL44                DATA SET NAME               @YL026TA 76548000
DASTAT   DS    0CL7                STATUS TEXT UNIT            @YL026TA 76550000
         DS    CL2                 KEY                         @YL026TA 76552000
         DS    CL2                 NUMBER                      @YL026TA 76554000
         DS    CL2                 LENGTH                      @YL026TA 76556000
         DS    CL1                 STATUS INDICATOR FIELD      @YL026TA 76558000
DAUNIT   DS    0CL9                UNIT NAME TEXT UNIT         @YL026TA 76560000
         DS    CL2                 KEY                         @YL026TA 76562000
         DS    CL2                 NUMBER                      @YL026TA 76564000
         DS    CL2                 LENGTH                      @YL026TA 76566000
DAUNAM   DS    CL3                 UNIT NAME FIELD             @YL026TA 76568000
DADDNM   DS    0CL14               DDNAME TEXT UNIT            @YL026TA 76570000
         DS    CL2                 KEY                         @YL026TA 76572000
         DS    CL2                 NUMBER                      @YL026TA 76574000
         DS    CL2                 LENGTH                      @YL026TA 76576000
         DS    CL8                 DDNAME FIELD                @YL026TA 76578000
DAVOL    DS    0CL12               VOLUME TEXT UNIT            @YL026TA 76580000
         DS    CL2                 KEY                         @YL026TA 76582000
         DS    CL2                 NUMBER                      @YL026TA 76584000
         DS    CL2                 LENGTH                      @YL026TA 76586000
DAVOLSR  DS    CL6                 VOLUME SERIAL FIELD         @YL026TA 76588000
REGSAVE  DS    18F                                             @ZA26557 76600037
RCVTSAVE EQU   REGSAVE+N12                                     @ZA26557 76650037
*                                                                       76700037
*                                                                       77100020
*              PARAMETER LIST FOR ALL REQUESTS                          77200020
*                                                                       77300020
*                                                                       77400020
*              COMMON  SEGMENT FOR ALL REQUESTS                         77500020
*                                                                       77600020
PARMWDS  DS    0FL7                                            @ZA26554 77650037
ENCODE   DS    0BL1                ENTRY CODE                           77700020
DBUF     DS    CL4                 ADDRESS OF BUFFER FOR CODE 04/05     77800020
DSNLL    DS    0CL1                DSN LENGTH                           77900020
DSN      DS    CL4                 ADDRESS OF DATA SET NAME             78000020
CURRENT  DS    CL4                 ADDRESS OF CURRENT PASSWORD          78100020
*                                                                       78200020
*              ADD / REPLACE / DELETE COMMON SEGMENT                    78300020
*                                                                       78400020
CONTROL  DS    CL4                 ADDRESS OF CONTROL PASSWORD          78500020
VOLNUM   DS    0CL1                NUMBER OF VOLUMES SPECIFIED          78600020
VOLIST   DS    CL4                 ADDRESS OF VOLUME LIST               78700020
*                                                                       78800020
*              ADD / REPLACE  COMMON SEGMENT                            78900020
*                                                                       79000020
PCODE    DS    0BL1                PROTECTION CODE                      79100020
NEW      DS    CL4                 ADDRESS OF NEW PASSWORD              79200020
STRINGL  DS    0CL1                STRING LENGTH                        79300020
STRING   DS    CL4                 ADDRESS OF DATA STRING               79400020
*                                                                       79500020
WKSIZE   EQU   *-WORKD             SIZE OF PROGRAM WORKAREA             79520037
*                                                                       79540037
*        END OF MAPPING OF DSECT WORKAREA                               79560037
         EJECT                                                          79600020
*                                                                       79700020
WRKSPACE DSECT                                                          79800020
*                                                                       79900020
*  OBTAIN WORKAREA AND LOCATE WORKAREA                                  80000020
*                                                                       80100020
OBTWRK   DS    CL96                DSCB                                 80200020
OBTCCH   DS    CL5                 CCHHR                                80300020
         DS    CL249               OBTAIN WORK SPACE                    80400020
         DS    0D                  ALIGN LOCATE WORKAREA                80500020
LOCAREA  DS    CL265               LOCATE WORK SPACE (VOLUME LIST)      80600020
WRKSIZE  EQU   *-WRKSPACE          SIZE OF LOCATE AND OBTAIN WORKAREA   80700020
*                                                                       80800020
         EJECT                                                          80900020
SRT      DSECT                                                          81000020
         IEFUCBOB                                                       81100020
         EJECT                                                          81200020
CVT      DSECT                                                          81300020
         CVT                                                            81400020
         EJECT                                                 @YL026TA 81500000
         IKJTCB                                                @ZA26554 84500037
         EJECT                                                 @ZA26554 84550037
         IKJRB                                                 @ZA26554 84600037
         EJECT                                                 @ZA26554 84650037
         IHAPSA                                                @YL026TA 84700037
         END                                                            84750037
./  ADD  SSI=80120162,NAME=IGC0209H
   TITLE 'IGC0209H SVC 98 (PROTECT) THIRD LOAD - DSCB UPDATE ROUTINE'   00100020
IGC0209H CSECT                                                          00300020
*        VS2 037 CHANGES                                                00300237
*A279000,A341000                                               @ZA18970 00300337
*C130900,423000,425000                                         @ZA26554 00300437
*A114000,114400,490000,490500,500500                           @ZA26554 00300537
*                                                                       00300637
*        VS2 030  SU                                                    00300737
*                                                                       00300837
*0000289300,489720                                             @ZA02651 00300937
*                                                                       00301037
*0000005500,304000-307000,309000,312000-316000                 @ZA11617 00301137
*                                                                       00301237
*                                                                       00301337
*        VS/2 RELEASE 3.0 CHANGES                                       00301437
*A166500,167000,369500-370000,131500-131900                     Z30AAWW 00301537
*C168000,369000                                                 Z30AAWW 00301637
*        VS/2 RELEASE 2.0 CHANGES                                       00301737
*A 027500-027600,039600,054500,107400,113500-113700            @YL026TA 00301837
*A 198500-198600,235100,240500,244500,271400-271588            @YL026TA 00302000
*A 275500-275600,276500-286744,287800-289992,358500,361100     @YL026TA 00303000
*A 383100-384925,489500-491441,542500-542800                   @YL026TA 00304000
*C 006000,039500,062000-064000,066000,069000-072000,171000     @YL026TA 00305000
*C 175000,235000,240000,244000,271300,286800,333500,358000     @YL026TA 00306000
*C 361000,371000                                               @YL026TA 00307000
*D 025000,110000,178000-180000,183500-191000,208000-228000     @YL026TA 00308000
*D 277000-286300,288100-289000,334000-339000,372500-373000     @YL026TA 00309000
*C 219500,226500                                                 YM2647 00310000
*A 123500-123700,161500-161700,228500-229900,347500-347600      SA53652 00318000
*A 379100-379200,381800                                         SA53652 00326000
*C 153000,162000                                                SA53652 00334000
*C 183500,190500,333500,338500                                   YM2088 00342000
*A 390300-390600                                               @ZA06424 00344037
*C 304000-307000,309000,312000-316000                          @ZA06424 00346037
*********************************************************************** 00350000
*                                                                     * 00450000
* STATUS --   VS 2  037   CHANGES                              @ZA26554 00550037
*                                                                     * 00650000
* FUNCTION -- THIRD LOAD OF THE PASSWORD DATA SET MAINTENANCE ROUTINE * 00750000
*    1. UPDATE PASSWORD DATA SET DSCB IF NECESSARY                    * 00900020
*    2. UPDATE THE DSCB OF THE DATA SET BEING PROTECTED WHENEVER THE  * 01000020
*    CONTROL PASSWORD PROTECTION STATUS IS CHANGED                    * 01100020
*    3. CLEANUP AND RETURN                                            * 01200020
*                                                                     * 01300020
* ENTRY POINTS --                                                     * 01400020
*         IGC0209H - ENTRY POINT OF THIRD LOAD, ENTERED BY XCTL FROM  * 01500020
*    SECOND LOAD (IGC0109H)                                           * 01600020
*                                                                     * 01700020
* INPUT --                                                            * 01800020
*    REGISTER R5 POINTS TO WORK AREA                                  * 01900020
*    REGISTER R11 CONTAINS RETURN CODE FROM PREVIOUS LOADS OF SVC 98  * 02100020
*                                                                     * 02200020
* OUTPUT --                                                           * 02300020
*    REGISTER R15 PASSES RETURN CODE                                  * 02400020
*    REGISTER R1 CONTAINS LOCATE RETURN CODE WHEN R15 = 32            * 02500000
*    REGISTER R1 CONTAINS OBTAIN RETURN CODE WHEN R15 = 36            * 02570000
*    REGISTER R1 CONTAINS DYNAMIC ALLOCATION ERROR CODE WHEN R15 = 52 * 02640000
*                                                              @YL026TA 02710000
*    WHEN REGISTER R15 = 24 THE FOLLOWING MESSAGE IS SENT TO THE      * 02800020
*    CONSOLE OPERATOR - 'IEC021I NO SPACE IN PASSWORD DATA SET'       * 02900020
*                                                                     * 03000020
* EXTERNAL REFERENCES -- N/A                                          * 03100020
*                                                                     * 03200020
* EXITS, NORMAL -- RETURN TO CALLER                                   * 03300020
*                                                                     * 03400020
* EXITS, ERROR -- RETURN TO CALLER WITH NON-ZERO RETURN CODE          * 03500020
*    32  LOCATE FAILED                                                * 03600020
*    36  OBTAIN FAILED                                                * 03700020
*    40  UNABLE TO UPDATE DSCB                                        * 03800020
*    48  TAPE DATA SET CAN NOT BE PROTECTED                           * 03900020
*    52  UNABLE TO ALLOCATE DATA SET                           @YL026TA 03950000
*    56  DATA SPACE IS VSAM                                    @YL026TA 03970000
*    RETURN CODES 4, 8, 12, 16, 20, 24, AND 44 MAY BE PASSED FROM     * 04000020
*    PREVIOUS LOADS OF SVC 98                                         * 04100020
*                                                                     * 04200020
* TABLES/WORK AREAS --                                                * 04300020
*    WORKD - A CONTIGUOUS AREA DEFINED BY IECDSECT FOR I/O CONTROL    * 04400020
*    BLOCKS FOLLOWED BY A LOCAL WORK AREA FOR COMMUNICATION AND       * 04500020
*    BUFFER SPACE                                                     * 04600020
*    WRKSPACE - A DSECT TO MAP THE LOCATE AND OBTAIN WORKAREAS        * 04800020
*                                                                     * 04900020
* ATTRIBUTES -- REENTRANT, READ ONLY, PRIVILEGED, ENABLED             * 05000000
*                                                                     * 05100020
* CHARACTER CODE DEPENDENCY -- CHARACTER CODE INDEPENDENT             * 05200020
*                                                                     * 05300020
* NOTES --                                                            * 05400000
*    DESCRIBED IN DADSM LOGIC MANUAL, SY26-3787.               @YL026TA 05450000
*                                                                     * 05500020
*********************************************************************** 05600020
         EJECT                                                          05700020
*  REGISTER EQUATES                                                     05800020
R0       EQU   0                   GENERAL REGISTER 0                   05900020
R1       EQU   1                   GENERAL REGISTER 1                   06000020
R2       EQU   2                   GENERAL REGISTER 2 (UNUSED)          06100020
R3       EQU   3                   SUBROUTINE BRANCH REGISTER  @YL026TA 06200000
R4       EQU   4                   PARAMETER LIST              @YL026TA 06300000
R5       EQU   5                   WORKAREA POINTER            @YL026TA 06400000
R6       EQU   6                   GENERAL REGISTER 6                   06500000
R7       EQU   7                   UCB POINTER                 @YL026TA 06600000
R8       EQU   8                   GENERAL REGISTER 8                   06700000
R9       EQU   9                   GENERAL REGISTER 9                   06800000
R10      EQU   10                  VOLUME COUNT                @YL026TA 06900000
R11      EQU   11                  RETURN CODE                 @YL026TA 07000000
R12      EQU   12                  BASE REGISTER FOR PROGRAM   @YL026TA 07100000
R13      EQU   13                  ADDRESS OF OBTAIN WORKAREA  @YL026TA 07200000
R14      EQU   14                  GENERAL REGISTER 14                  07300020
R15      EQU   15                  GENERAL REGISTER 15                  07400020
*  ABSOLUTE EQUATES (OFFSETS AND SHORT LENGTHS)                         07500020
ONE      EQU   1                   ONE                                  07600020
TWO      EQU   2                   TWO                                  07700020
F0       EQU   0                   ZERO                                 07800020
F1       EQU   1                   ONE                                  07900020
F2       EQU   2                   TWO                                  08000020
F3       EQU   3                   THREE                                08100020
F4       EQU   4                   FOUR                                 08200020
F5       EQU   5                   FIVE                                 08300020
F6       EQU   6                   SIX                                  08400020
F7       EQU   7                   SEVEN                                08500020
F8       EQU   8                   EIGHT                                08600020
F10      EQU   10                  TEN                                  08700020
F12      EQU   12                  TWELVE                               08800020
F16      EQU   16                  SIXTEEN                              08900020
F20      EQU   20                  TWENTY                               09000020
F43      EQU   43                  FORTY-THREE                          09100020
F77      EQU   77                  SEVENTY-SEVEN (USER DATA LENGTH)     09200020
F96      EQU   96                  NINETY-SIX                           09300020
L72      EQU   72                  LENGTH OF SAVEAREA                   09400020
*  RETURN CODE EQUATES                                                  09500020
RC4      EQU   4                   RETURN CODE = 4                      09600020
RC8      EQU   8                   RETURN CODE = 8                      09700020
RC12     EQU   12                  RETURN CODE = 12                     09800020
RC16     EQU   16                  RETURN CODE = 16                     09900020
RC20     EQU   20                  RETURN CODE = 20                     10000020
RC24     EQU   24                  RETURN CODE = 24                     10100020
RC28     EQU   28                  RETURN CODE = 28                     10200020
RC32     EQU   32                  RETURN CODE = 32                     10300020
RC36     EQU   36                  RETURN CODE = 36                     10400020
RC40     EQU   40                  RETURN CODE = 40                     10500020
RC44     EQU   44                  RETURN CODE = 44                     10600020
RC48     EQU   48                  RETURN CODE = 48                     10700020
RC52     EQU   52                  RETURN CODE = 52                     10730020
RC56     EQU   56                  RETURN CODE = 56            @YL026TA 10740000
*  OTHER EQUATES                                                        10760020
MPUPDAT  EQU   X'01'               MASK TO TEST FOR MPDS UPDATE         10800020
DSNUPDAT EQU   X'02'               MASK TO TEST FOR PROTECTION UPDATE   10900020
OPREAD   EQU   X'06'               READ DATA OP CODE                    11100020
OPWRITE  EQU   X'05'               WRITE DATA OP CODE                   11200020
OBTNCORE EQU   X'08'               OBTAIN CORE TO BE FREED              11300020
VSAMORG  EQU   X'08'               BIT IN SECOND BYTE OF DSCB FILE-TYPE*11330000
                                   INDICATES VSAM DATA SPACE   @YL026TA 11360000
AUTH     EQU   X'80'               IS USER AUTHORIZED SW       @ZA26554 11400037
CHAIN    EQU   X'40'               CHAIN DATA FLAG                      11420037
SECPASS  EQU   X'20'               SECOND PASS SW              @ZA26554 11440037
GOODIO   EQU   X'20'               MASK TO TEST FOR SUCCESSFUL I/O      11500020
SRCHID   EQU   X'31'               SEARCH ID EQUAL OP CODE              11600020
FLAGOFF  EQU   X'14'               MASK TO TURN OFF ALL BUT BITS 3,5    11700020
NOPROT   EQU   X'EB'               MASK TO TURN OFF BITS 3,5            11800020
NOSEEK   EQU   X'18'               FILE MASK-NOSEEK                     11900020
IOERR    EQU   X'40'               MASK TO SET I/O ERROR INDICATOR      12000020
DSCBP3   EQU   X'10'               MASK TO SET PROTECTION BYTE BIT 3    12100020
DSCBP5   EQU   X'04'               MASK TO SET PROTECTION BYTE BIT 5    12200020
BLANK    EQU   C' '                BLANK                                12300020
SWON     EQU   X'FF'               MASK SWITCH ON               SA53652 12350021
SWOFF    EQU   X'00'               MASK SWITCH OFF              SA53652 12360021
F252     EQU   252                 OFFSET TO TTR                SA53652 12370000
RNLENGTH EQU   8                   LENGTH OF RNAME FOR ENQUEUE ON DSCB  12400020
HLEN     EQU   44                  DSNAME LENGTH FOR ENQUEUE            12500020
DSCBDLL  EQU   96                  DSCB DATA FIELD LENGTH               12600020
         EJECT                                                          12700020
         BALR  R12,R0              GET ADDRESS WHERE LOADED             12800020
         USING *,R12               ESTABLISH ADDRESSABILITY FOR PROGRAM 12900020
         USING WORKD,R5            ESTABLISH ADDRESSABILITY FOR DSECT   13000037
         B     BEGIN               BRANCH AROUND ID             Z30AAWW 13030037
         DC    C'IGC0209H'         MODULE ID                    Z30AAWW 13060037
         DC    C'7339'             DATE 12/05/77               @ZA26554 13090037
BEGIN    EQU   *                                                Z30AAWW 13150000
         L     R13,OBTAIN4         ADDRESS OF OBTAIN WORKAREA           13200020
         USING WRKSPACE,R13        ESTABLISH ADDRESSABILITY WORKAREA    13300020
         LTR   R11,R11             IS RETURN CODE REGISTER = 0          13400020
         BNZ   CHECKRC             NO, GO CHECK RETURN CODE             13500020
         MVC   ENQLIST(ENQLEND-ENQL),ENQL INITIALIZE ENQ AND DEQ LISTS  13600020
         MVC   QNAME(F8),QNME      INITIALIZE QNAME                     13700020
         LA    R1,ENQLIST          POINT TO ENQUEUE PARAMETER LIST      13800020
         LA    R8,DEQLIST          POINT TO DEQUEUE PARAMETER LIST      13850020
         LA    R9,QNAME            ADDRESS OF QNAME                     13900020
         ST    R9,F4(R1)           SECOND WORD ENQUEUE LIST             14000020
         ST    R9,F4(R8)           SECOND WORD DEQUEUE LIST             14050020
         LA    R9,RNAME            ADDRESS OF RNAME                     14100020
         ST    R9,F8(R1)           THIRD WORD ENQUEUE LIST              14200020
         ST    R9,F8(R8)           THIRD WORD DEQUEUE LIST              14250020
         TM    DFLAG1,MPUPDAT      IS UPDATE OF PASSWORD DS REQUIRED    14300020
         BO    UPDATE              YES, GO UPDATE DSCB                  14400020
         B     DSFLAG              GO SEE IF DATA SET IS TO BE FLAGGED  14500020
*  NOW SET PROTECTION STATUS IN DSCB                                    14600020
SETFLAG  L     R8,VOLIST           LOAD ADDRESS OF USER'S VOLUME LIST   14700020
         LTR   R8,R8               DID USER SUPPLY VOLUME LIST          14800020
         BNZ   USERLIST            YES, GO USE USER'S VOLUME LIST       14900020
*  USER DID NOT SUPPLY VOLUME LIST.  USE LOCATE TO GET VOLUME LIST      15000020
         MVC   LOCNAME(ENDLLIST-LOCLIST),LOCLIST INITIALIZE CAMLST      15100020
         LA    R6,DKEY             POINTER TO DATA SET NAME-            15200020
INITLOC  ST    R6,LOCNAME2         -TO LOCATE CAMLST            SA53652 15300021
         LA    R6,LOCAREA          POINTER TO LOCATE WORKAREA-          15400020
         ST    R6,LOCNAME4         -TO LOCATE CAMLST                    15500020
         LOCATE LOCNAME            ISSUE LOCATE MACRO                   15600020
         LTR   R15,R15             TEST LOCATE RETURN CODE              15700020
         BNZ   LOCERROR            NON-ZERO IS ERROR                    15800020
         CLC   TAPECODE(F2),LOCAREA+F4 IS THIS A TAPE DATA SET          15900020
         BE    TAPE                YES, UNABLE TO FLAG TAPES            16000020
         LH    R10,LOCAREA         VOLUME COUNT                         16100020
         MVI   DMODE,SWOFF         INITIALIZE SWITCH OFF        SA53652 16150021
         CH    R10,TWENTY          TEST VOLUME COUNT            SA53652 16160021
         BH    DOTWENTY            GO PROCESS OVER 20 VOLUMES   SA53652 16170000
VOLPOINT LA    R8,LOCAREA+F6       POINT TO FIRST VOLSER        SA53652 16200021
*                                                                       16210000
*   USE UCB LOOKUP TABLE TO FIND SPECIFIED VOLUME.  TABLE CONSISTS OF   16220000
*   HALFWORD POINTERS TO UCB'S, OR ZEROS FOR MISSING UCB'S.  END OF     16230000
*   TABLE INDICATED BY VALUE OF X'FFFF'.  ALL SIXTEEN BITS OF THE       16240000
*   HALFWORD ARE SIGNIFICANT.                                           16250000
*                                                                       16260000
LOOKUP   L     R6,DUCBADDR         ADDRESS OF UCB LOOKUP TABLE          16300020
UCBSRCH  LH    R7,F0(R6)           LOAD UCB ADDRESS                     16400020
         LTR   R7,R7               CHECK UCB TABLE ENTRY                16500020
         BZ    NEXTUCB             IF ZERO, GET NEXT UCB TABLE ENTRY    16600020
         CH    R7,UCBEND           END OF UCB LOOKUP TABLE      Z30AAWW 16800000
         BE    VOLNTMTD            YES, VOL MUST NOT BE MOUNTED Z30AAWW 16830000
         N     R7,UCBMASK          CLEAR HI-ORDER BITS          Z30AAWW 16860000
         USING SRT,R7              ESTABLISH ADDRESSABILITY UCB         16900020
         CLI   UCBTBYT3,UCB3DACC   IS THIS A DIRECT ACCESS DEVICE       17000020
         BE    CHKVOLID            YES, GO CHECK VOLSER        @YL026TA 17100000
         CLI   UCBTBYT3,UCB3TAPE   IS THIS A TAPE DATA SET              17200020
         BNE   NEXTUCB             NO, NOT TAPE, NOT DA, GO CHECK NEXT  17300020
CHKVOLID CLC   SRTEVOLI(F6),F0(R8) DO VOLSER'S MATCH                    17400020
         BE    MATCHID             YES GO GET DSCB             @YL026TA 17500000
NEXTUCB  LA    R6,F2(R6)           POINT TO NEXT ENTRY LOOKUP TABLE     17700000
         B     UCBSRCH             GO CHECK NEXT UCB                    17900000
MATCHID  CLI   UCBTBYT3,UCB3TAPE   IS THIS A TAPE                       18100020
         BE    TAPE                YES, UNABLE TO FLAG, GO SET RC       18200020
         ST    R7,DXDEBUCB         UCB ADDRESS TO DEB                   18300020
*  NOW GET DSCB                                                         19200020
GETDSCB  LA    R9,DKEY             POINTER TO DATA SET NAME-            19300020
         ST    R9,OBTAIN2          -TO OBTAIN CAMLST                    19400020
         MVC   OBTVOL(F6),F0(R8)   VOLSER OF DATA SET                   19500020
         OBTAIN OBTPTR             GET DSCB                             19600020
         LTR   R15,R15             TEST OBTAIN RETURN CODE              19700020
         BNZ   OBTERROR            NON-ZERO IS OBTAIN ERROR             19800020
         DROP  R13                 DROP OLD BASE               @VS07508 19810000
         USING DXDSCB,R13          SET NEW BASE                @VS07508 19820000
         TM    DSCFILTY+F1,VSAMORG IS THIS SPACE VSAM?         @YL026TA 19830000
         BO    VSAMERR             ERROR--CANNOT PROTECT       @YL026TA 19840000
         DROP  R13                 DROP OLD BASE               @VS07508 19850000
         USING WRKSPACE,R13        SET NEW BASE                @VS07508 19860000
         B     FLAGDS              GO CHECK SECURITY FLAGS              19900020
USERLIST SR    R10,R10             ZERO REGISTER                        20000020
         IC    R10,VOLNUM          VOLUME COUNT                         20100020
         LTR   R10,R10             TEST VOLUME COUNT                    20200020
         BZ    IOERROR             ZERO COUNT IS ERROR                  20300020
         LA    R8,F0(R8)           BLANK VOLNUM FROM HIGH ORDER BYTE    20400020
         LTR   R8,R8               CHECK POINTER TO VOLUME LIST         20500020
         BZ    IOERROR             ZERO POINTER IS ERROR                20600020
         B     LOOKUP              GO LOOKUP UCB                        20700020
DOTWENTY LA    R10,F20             USE 20                       SA53652 20800000
         MVI   DMODE,SWON          TURN SWITCH ON               SA53652 21500000
         B     VOLPOINT            GO PROCESS 20 VOLUMES        SA63652 22200000
RELOC    MVC   LOCNAME(ENDBLLOC-LOCBLK),LOCBLK INIT CAMLST      SA53652 22960000
         MVC   DMBB(F3),LOCAREA+F252 SAVE TTR                   SA53652 22970000
         LA    R6,DMBB             POINT TO TTR                 SA53652 22980000
         B     INITLOC             GO INITIALIZE LOCATE         SA53652 22990000
UPDATE   MVC   RNAME(F8),PDSDSN    MOVE PASSWORD DSNAME TO RNAME        23000020
         MVC   DSCLSTAR(F3),DSAVT  MOVE NEW PASSWORD TTR TO DSCB        23200020
*  NOW ENQUEUE ON PASSWORD DATA SET                                     23300020
         LA    R1,ENQLIST          POINT TO ENQUEUE LIST                23400020
UPDT010  ENQ   MF=(E,(1)),RELATED=(SYSDSN-PASSWORD,IGC0209H(UPDT020))  *23500000
                                   ENQUEUE ON DSCB             @YL026TA 23520000
         STH   R15,DSAVT           SAVE ENQUEUE RETURN CODE             23550020
*  NOW GO UPDATE PASSWORD DATA SET DSCB FROM IN CORE IMAGE              23600020
         BAL   R3,WRITDSCB         GO WRITE BACK DSCB                   23700020
*  NOW DEQUEUE FROM PASSWORD DATA SET AND FROM DSCB                     23800020
         CLC   ZERO(F2),DSAVT      WAS ENQUEUE SUCCESSFUL               23830020
         BNE   SKIPDQ              NO, SKIP DEQUEUE                     23860020
         LA    R1,DEQLIST          POINT TO DEQUEUE LIST                23930020
UPDT020  DEQ   MF=(E,(1)),RELATED=(SYSDSN-PASSWORD,IGC0209H(UPDT010))  *24000000
                                   DEQUEUE FROM DSCB           @YL026TA 24050000
SKIPDQ   LA    R1,DENQLST          POINT TO DSNAME ENQUEUE LIST         24100020
         LA    R9,DMPDS            POINT TO PASSWORD DATA SET NAME      24200020
         ST    R9,F8(R1)           RESET DEQUEUE LIST                   24300020
         DEQ   MF=(E,(1)),RELATED=(SYSPSWRD-PASSWORD,IGC0009H(CHK030)) *24400000
                                   DEQUEUE FROM PASSWD DATA SET         24450000
         TM    DFLAG1,IOERR        WAS I/O SUCCESSFUL                   24500020
         BO    IOERROR             GO FREE CORE                         24600020
DSFLAG   TM    DFLAG1,DSNUPDAT     IS UPDATE OF DSCB REQUIRED           24700020
         BO    SETFLAG             YES, GO FLAG DSCB                    24800020
         B     ZERORC              GO CLEANUP AND RETURN                24900020
FLAGDS   MVC   DXDSCB(F96),OBTWRK  MOVE DSCB TO DSCB MAP                25000020
         MVC   OLDFLAG(F1),DSCDSIND SAVE PROTECTION FLAG STATUS         25100020
         NI    OLDFLAG,FLAGOFF     TURN OFF ALL BUT PROTECTION BITS     25300020
*  THE FOLLOWING IS POSSIBLE BECAUSE DFLAG1 PROTECTION REQUEST BITS     25350020
*  CORRESPOND ONE TO ONE WITH DSCB PROTECTION BITS                      25400020
         MVC   NEWFLAG(F1),DFLAG1  SET PROTECTION REQUEST BITS          25450020
         NI    NEWFLAG,FLAGOFF     TURN OFF ALL BUT PROTECTION BITS     25500020
CHCKBYTE CLC   OLDFLAG,NEWFLAG     COMPARE SECURITY FLAGS               25800020
         BE    STATUSOK            FLAGS AGREE, NO UPDATE REQUIRED      25900020
         NI    DSCDSIND,NOPROT     TURN OFF PROTECTION BITS (3,5)       26000020
         OC    DSCDSIND,NEWFLAG    PUT NEW STATUS IN DSCB               26100020
         B     NQ                  GO WRITE BACK DSCB                   26200020
LOCERROR LR    R1,R15              LOCATE RETURN CODE TO REGISTER 1     26700020
         LA    R11,RC32            SET RETURN CODE = 32                 26800020
         B     FREECORE            GO FREE CORE                         26900020
TAPE     LA    R11,RC48            SET RETURN CODE = 48                 27000020
         B     FREECORE            GO FREE CORE                         27100020
INUSE    LA    R11,RC52            ALLOCATION ERROR RETURN CODE         27130000
         SR    R1,R1               CLEAR REGISTER 1            @YL026TA 27133000
         B     ALLOCER(R15)        ACTION DEPENDENT ON RET. CODE        27136000
ALLOCER  B     INFOERR             RC=0 - INFO ONLY            @YL026TA 27139000
         B     ALCERR              RC=4 - ERROR CODE AVAILABLE @YL026TA 27142000
         B     FREECORE            RC=8 - NO ADDITIONAL CODE   @YL026TA 27145000
ALCERR   LH    R1,DAERRCD          RC=12 - PUT ERROR CODE IN R 1        27148000
         B     FREECORE            GO FREE CORE                @YL026TA 27151000
INFOERR  LH    R1,DAINFO           PUT INFORMATIONAL CODE IN R 1        27154000
         B     FREECORE            GO FREE CORE                         27160020
VOLNTMTD LA    R15,RC4             INDICATE VOLUME NOT MOUNTED          27200020
OBTERROR LR    R1,R15              OBTAIN RETURN CODE TO REGISTER 1     27300020
OBTAINRC LA    R11,RC36            SET RETURN CODE = 36                 27400020
         B     FREECORE            GO FREE CORE                         27500020
VSAMERR  LA    R11,RC56            SET RETURN CODE = 56        @YL026TA 27600000
         B     FREECORE            GO FREE CORE                @YL026TA 27620000
IOERROR  LA    R11,RC40            SET RETURN CODE = 40                 27640000
         B     FREECORE            GO FREE CORE                @YL026TA 27660000
*                                                              @YL026TA 27680000
*  ALLOCATE THE DATA SET TO GET EXCLUSIVE CONTROL.             @YL026TA 27700000
*  A NEW ALLOCATION IS REQUESTED SO THAT WHEN DEALLOCATION IS  @YL026TA 27720000
*  DONE, EXISTING ALLOCATIONS ARE NOT DISTURBED.               @YL026TA 27740000
*  THE DDNAME USED IS RETURNED FOR USE IN DEALLOCATING.        @YL026TA 27760000
*                                                              @YL026TA 27780000
NQ       EQU   *                                               @YL026TA 27800000
         USING S99TUNIT,R8                                     @YL026TA 27820000
         XC    DARQBLK(F20),DARQBLK CLEAR PARAMETER BLK        @YL026YB 27840000
         MVC   DARQBLK,REQALC      SET UP REQUEST BLOCK        @YL026TA 27860000
*  BUILD DSNAME TEXT UNIT                                      @YL026TA 27880000
         MVC   DADSNM(L'TXTDSNM),TXTDSNM SET UP DSNAME TEXT UNIT        27900000
         LR    R14,R8              SAVE VOL LIST PTR           @ZA18970 27910037
         LA    R8,DADSNM           ADDRESS OF DSNAME TEXT UNIT @YL026TA 27920000
         SR    R9,R9               CLEAR REGISTER              @YL026TA 27940000
         IC    R9,DSNLL            GET DSNAME LENGTH           @YL026TA 27960000
         STH   R9,S99TULNG         STORE LENGTH IN TEXT UNIT   @YL026TA 27980000
         BCTR  R9,R0               DECREMENT LENGTH FOR EXECUTE         28000000
         L     R6,DSN              ADDRESS OF DSNAME           @YL026TA 28020000
         EX    R9,MOVEPAR          MOVE DSNAME TO TEXT UNIT    @YL026TA 28040000
         ST    R8,DATP1            ADDR OF TEXT UNIT TO TEXT PTR        28060000
         LA    R8,DATP1                                                 28080000
         ST    R8,DATXTPT          ADDRESS OF FIRST TEXT POINTER        28100000
*  BUILD STATUS TEXT UNIT                                      @YL026TA 28120000
         MVC   DASTAT(L'TXTSTAT),TXTSTAT SET UP STATUS TEXT UNIT        28140000
         LA    R8,DASTAT           ADDRESS OF STATUS TEXT UNIT @YL026TA 28160000
         ST    R8,DATP2              TO TEXT POINTER           @YL026TA 28180000
*  BUILD VOLUME TEXT UNIT                                      @YL026TA 28200000
         MVC   DAVOL(L'TXTVOL),TXTVOL SET UP VOLUME TEXT UNIT  @YL026TA 28220000
         LA    R8,DAVOL            ADDRESS OF VOLUME TEXT UNIT @YL026TA 28240000
         MVC   S99TUPAR(L'OBTVOL),OBTVOL VOL SERIAL TO TEXT UNIT        28260000
         ST    R8,DATP3            ADDR OF TEXT UNIT TO TEXT PTR        28280000
*  BUILD UNIT NAME TEXT UNIT                                   @YL026TA 28300000
         MVC   DAUNIT(L'TXTUNIT),TXTUNIT SET UP UNIT NAME TEXT @YL026TA 28320000
         LA    R8,DAUNIT           ADDRESS OF UNIT NAME T. U.  @YL026TA 28340000
         MVC   S99TUPAR(L'UCBNAME),UCBNAME EBCDIC UNIT NAME FROM UCB   *28360000
                                                               @YL026TA 28380000
         ST    R8,DATP4            ADDR OF TEXT UNIT TO TEXT PTR        28400000
*  BUILD DDNAME TEXT UNIT                                      @YL026TA 28420000
         MVC   DADDNM(L'TXTDD),TXTDD  SET UP DDNAME TEXT UNIT  @YL026TA 28440000
         LA    R8,DADDNM           ADDRESS OF DDNAME TEXT UNIT @YL026TA 28460000
         ST    R8,DATP5              TO TEXT POINTER           @YL026TA 28480000
*  FINISH UP PARAMETER LIST FOR ALLOCATION                     @YL026TA 28500000
         OI    DATP5,S99TUPLN      HIGH ORDER BIT ON FOR END   @YL026TA 28520000
         LA    R9,DARQBLK          PUT ADDRESS OF REQUEST BLOCK         28540000
         ST    R9,DAPARM             IN PARAMETER POINTER      @YL026TA 28560000
         OI    DAPARM,S99RBPND     TURN HIGH-ORDER BIT ON      @YL026TA 28580000
         LA    R1,DAPARM           ADDRESS OF PARAMETER POINTER         28600000
         DYNALLOC                  ALLOCATE THE DATA SET       @YL026TA 28620000
         LTR   R15,R15             TEST ALLOCATION RETURN CODE @YL026TA 28640000
         BNZ   INUSE               UNABLE TO ALLOCATE          @YL026TA 28660000
*  NOW REISSUE OBTAIN TO ENSURE AN ACCURATE DSCB                 A42339 28690021
         OBTAIN OBTPTR             GET DSCB                      A42339 28700021
         BAL   R3,WRITDSCB         GO UPDATE DSCB                       28730020
*                                                              @YL026TA 28810000
*  NOW UNALLOCATE THE DATA SET USING THE DDNAME RETURNED BY    @YL026TA 28820000
*  ALLOCATION                                                  @YL026TA 28830000
*                                                              @YL026TA 28840000
DQ       EQU   *                                               @YL026TA 28850000
         MVI   DAVERB,S99VRBUN     VERB CODE TO UNALLOCATE     @YL026TA 28860000
         SR    R9,R9               CLEAR FLAGS                 @YL026TA 28870000
         STH   R9,DAFLGS1                                      @YL026TA 28880000
         STH   R9,DAERRCD          CLEAR FIELD IN PARM BLK              28890000
         STH   R9,DAINFO           CLEAR FIELD IN PARM BLK              28900000
         ST    R9,DRESVE           CLEAR FIELD IN PARM BLK              28910000
         ST    R9,DAFLGS2          CLEAR FIELD IN PARM BLK              28920000
         MVC   DADKEY,DDUNKEY      CHANGE DDNAME TEXT UNIT KEY @ZA02651 28930037
         LA    R8,DADDNM           PUT ADDRESS OF DDNAME T. U. @YL026TA 28940000
         ST    R8,DATP1              IN TEXT POINTER           @YL026TA 28950000
         OI    DATP1,S99TUPLN      MARK END OF LIST            @YL026TA 28960000
         LA    R1,DAPARM           ADDRESS OF PARAMETER POINTER         28970000
         DYNALLOC                  UNALLOCATE THE DATA SET     @YL026TA 28980000
         B     STATUSOK            FLAGS UPDATED                        29000020
*                                                                       29100020
*  CHANNEL PROGRAM FOR DSCB UPDATE                                      29200020
*                                                                       29300020
*        SEARCH-ID-EQUAL           (DXCCW7)                             29400037
*        TIC                       (DXCCW8)                             29500037
*        WRITE-DATA                (DXCCW9)                             29600037
*        SEARCH-ID-EQUAL           (DXCCW10)                            29700037
*        TIC                       (DXCCW11)                            29800037
*        READ-DATA (VERIFICATION)  (DXCCW12)                            29900037
*                                                                       30000020
*  DSCB UPDATE  THE DSCB DATA FIELD IS WRITTEN BACK TO THE VTOC AT      30100020
*  THE LOCATION SPECIFIED BY OBTAIN'S CCHHR                             30200020
WRITDSCB LA    R9,DXDAADDR+F3      ADDRESS OF COUNT FIELD (CCHHR)-      30300020
         ST    R9,DXCCW7           -TO SEARCH CCW              @ZA11617 30400037
         ST    R9,DXCCW10          -TO SEARCH CCW              @ZA11617 30500037
         MVI   DXCCW7,SRCHID       SET SEARCH ID EQUAL OP CODE @ZA11617 30600037
         MVI   DXCCW10,SRCHID      SET SEARCH ID EQUAL OP CODE @ZA11617 30700037
         MVI   DXDEBUCB,NOSEEK     RESET FILE MASK TO INHIBIT SEEKS     30800037
         LA    R9,DXCCW7           ADDRESS OF STARTING CCW     @ZA11617 30900037
         ST    R9,IOBSIOCC         POINT TO STARTING CCW                31000037
         LA    R9,DXDSCB           DSCB ADDRESS (WORK AREA)-            31100037
         ST    R9,DXCCW9           -TO WRITE CCW               @ZA11617 31200037
         MVI   DXCCW9,OPWRITE      SET WRITE OP CODE           @ZA11617 31300037
         MVI   DXCCW9+F7,DSCBDLL   DSCB DATA LENGTH TO CCW     @ZA11617 31400037
         MVI   DXCCW12,OPREAD      SET READ OP CODE            @ZA11617 31500037
         MVI   DXCCW12+F7,DSCBDLL  DSCB DATA LENGTH TO CCW     @ZA11617 31600037
         MVC   DXDAADDR+F3(F5),OBTCCH MOVE DSCB CCHHR TO COUNT FIELD    31700020
         MVC   DXDEBSCC(F4),OBTCCH SET EXTENTS-                         31800020
         MVC   DXDEBECC(F4),OBTCCH -IN DEB FOR SEARCH                   31900020
*  NOW ISSUE EXCP TO UPDATE DSCB                                        32000020
         EXCP  DXIOB               INITIATE I/O                         32100020
         WAIT  ECB=DXECB           WAIT FOR COMPLETION                  32200020
*  WAS I/O SUCCESSFUL                                                   32300020
         TM    DXECB,GOODIO        WAS THERE AN ERROR                   32400020
         BCR   ONE,R3              NO, RETURN                           32500020
         OI    DFLAG1,IOERR        INDICATE I/O ERROR                   32600020
         BR    R3                  RETURN                               32700020
CHECKRC  LA    R9,RC24             REGISTER 9 = 24                      32800020
         CR    R11,R9              IS PASSWORD DATA SET FULL            32900020
         BNE   FREECORE            GO FREE CORE                         33000020
         LA    R1,JFCBELNM         POINT TO WRITE TO OPERATOR MESSAGE   33100020
         WTO   MF=(E,(1))          ISSUE WTO                            33200020
         B     FREECORE            GO CLEANUP AND RETURN                33300020
STATUSOK EQU   *                                               @YL026TA 33400000
         TM    DFLAG1,IOERR        WAS I/O SUCCESSFUL                   34000020
         BO    IOERROR             NO, GO FREE CORE                     34100020
         LR    R8,R14              RESET VOL LIST PTR          @ZA18970 34150037
         CLC   ZERO(F4),VOLIST     DID USER SUPPLY VOLUME LIST          34200020
         BE    LOCLISTS            IF NOT, USE LOCATE LIST              34300020
         LA    R8,F6(R8)           POINT TO NEXT VOLUME                 34400020
         B     MOREVOLS            GO CHECK IF MORE VOLUMES             34500000
LOCLISTS LA    R8,F12(R8)          POINT TO NEXT VOLUME                 34600020
MOREVOLS BCT   R10,LOOKUP          IF MORE VOLUMES, GO PROCESS NEXT VOL 34700020
         CLI   DMODE,SWON          MORE VOLUMES                 SA53652 34750000
         BE    RELOC               YES, GO PROCESS THEM         SA53652 34770000
ZERORC   SR    R11,R11             SET RETURN CODE = 0                  34800020
FREECORE EQU   *                   FREE CORE BEFORE RETURNING           34900020
         LR    R6,R1               SAVE REGISTER 1 DURING FREEMAIN      35000020
         LR    R4,R0               SAVE REGISTER 0 DURING FREEMAIN      35100020
         L     R9,DSAVR            LOAD RETURN ADDRESS                  35200020
         TM    DFLAG1,OBTNCORE     OBTAIN CORE TO BE FREED              35300020
         BZ    NOOBTAIN            NO, SKIP AROUND FREEMAIN             35400020
         LA    R0,WRKSIZE          SIZE OF OBTAIN AND LOCATE WORKAREA   35500020
         O     R0,SPN              SUBPOOL NUMBER IN HIGH ORDER BYTE    35600020
         L     R1,OBTAIN4          ADDRESS OF CORE TO BE FREED          35700020
         FREEMAIN R,LV=(0),A=(1),RELATED=(SP251,IGC0009H(TABRC2))      *35800000
                                   FREE CORE                   @YL026TA 35860000
NOOBTAIN LA    R0,WKSIZE           SIZE OF PROGRAM WORKAREA             35920000
         LR    R1,R5               ADDRESS OF CORE TO BE FREED          35980000
         FREEMAIN R,LV=(0),A=(1),RELATED=(SP0,IGC0009H(INITCOR))       *36040000
                                   FREE CORE                   @YL026TA 36100000
         LR    R1,R6               RESTORE REGISTER 1                   36200020
         LR    R0,R4               RESTORE REGISTER 0                   36300020
         LR    R15,R11             RESTORE REGISTER 15                  36400020
         LR    R14,R9              RETURN ADDRESS TO RETURN REGISTER    36500020
         BR    R14                 RETURN                               36600020
         EJECT                                                          36700020
*  CONSTANTS                                                            36800020
         DS    0F                  ALIGN CONSTANTS                      36900000
UCBMASK  DC    X'0000'             FOR HI-ORDER OF UCB ADDR     Z30AAWW 36960000
UCBEND   DC    X'FFFF'             END OF UCB LOOKUP TABLE INDR Z30AAWW 37020000
MOVEPAR  MVC   S99TUPAR(F0),F0(R6) MOVE PARAMETER TO TEXT UNIT @YL026TA 37100000
TAPECODE DC    X'8001'             COMMON PART OF ALL TAPE DEVICE CODES 37300000
ZERO     DC    F'0'                ZERO WORD FOR COMPARES               37500020
SPN      DC    X'FB'               SUBPOOL NUMBER 251                   37600020
         DC    X'000000'           ZERO REST OF WORD                    37700020
LOCLIST  CAMLST NAME,0,,0          LOCATE CAMLST MACRO                  37800020
ENDLLIST EQU   *                   END OF LOCATE CAMLST MACRO           37900020
LOCBLK   CAMLST BLOCK,1,,3         LOCATE CAMLST (TTR)          SA53652 37910000
ENDBLLOC EQU   *                   END OF CAMLST MACRO          SA53652 37930000
*  KEEP ENQ AND DEQ LISTS TOGETHER.                                     37950020
ENQL     ENQ   (0,0,E,RNLENGTH,SYSTEM),RET=USE,MF=L LIST FORM ENQUEUE   38010020
DEQL     DEQ   (0,0,RNLENGTH,SYSTEM),RET=HAVE,MF=L DEQUEUE              38070020
ENQLEND  EQU   *                   END OF ENQ AND DEQ EXPANSIONS        38130020
TWENTY   DC    H'20'               TWENTY                       SA53652 38160000
QNME     DC    CL8'SYSDSN  '       QNAME FOR ENQUEUE ON DSCB            38200020
PDSDSN   DC    CL8'PASSWORD'       PASSWORD DATA SET DSNAME             38260020
*  CONSTANTS FOR DYNAMIC ALLOCATION                            @YL026TA 38264000
REQALC   DS    0CL20               CONSTANT PART OF REQUEST BLK         38268000
         DC    X'14'               LENGTH OF BLOCK = 20        @YL026TA 38272000
         DC    X'01'               VERB CODE 01 = ALLOCATE     @YL026TA 38276000
         DC    X'6000'             FLAGS1 = USE NEW ALLOCATION,        *38280000
                                   DON'T WAIT FOR VOLUME MOUNT @YL026TA 38284000
         DC    X'00000000'         CLEAR ERROR CODES           @YL026TA 38288000
         DS    CL4                 TEXT POINTER ADDRESS        @YL026TA 38292000
         DC    X'00000000'         RESERVED                    @YL026TA 38296000
         DC    X'00000000'         FLAGS2 = ZEROS              @YL026TA 38300000
* TEXT UNITS -- CONSTANT PARTS                                 @YL026TA 38304000
TXTDSNM  DS    0CL6                DSNAME TEXT UNIT            @YL026TA 38308000
         DC    X'0002'             KEY FOR DSNAME              @YL026TA 38312000
         DC    X'0001'             NUMBER OF DSNAMES           @YL026TA 38316000
         DC    X'0000'             INITIALIZE LENGTH           @YL026TA 38320000
TXTSTAT  DS    0CL7                STATUS TEXT UNIT            @YL026TA 38324000
         DC    X'0004'             KEY FOR STATUS              @YL026TA 38328000
         DC    X'0001'             NUMBER                      @YL026TA 38332000
         DC    X'0001'             LENGTH OF STATUS FIELD      @YL026TA 38336000
         DC    X'01'               STATUS = OLD                @YL026TA 38340000
TXTVOL   DS    0CL6                VOLUME TEXT UNIT            @YL026TA 38344000
         DC    X'0010'             KEY FOR VOLUMES             @YL026TA 38348000
         DC    X'0001'             NUMBER OF VOLUMES (ONE)     @YL026TA 38352000
         DC    X'0006'             LENGTH OF VOLUME FIELD      @YL026TA 38356000
TXTUNIT  DS    0CL6                UNIT NAME TEXT UNIT         @YL026TA 38360000
         DC    X'0015'             KEY FOR UNIT NAME           @YL026TA 38364000
         DC    X'0001'             NUMBER OF UNITS             @YL026TA 38368000
         DC    X'0003'             LENGTH OF UNIT NAME         @YL026TA 38372000
TXTDD    DS    0CL6                DDNAME TEXT UNIT            @YL026TA 38376000
         DC    X'0055'             KEY TO REQUEST DDNAME       @YL026TA 38380000
         DC    X'0001'             NUMBER OF DDNAMES           @YL026TA 38384000
         DC    X'0008'             LENGTH OF DDNAME FIELD      @YL026TA 38388000
*  OTHER CONSTANTS NEEDED FOR ALLOCATION                       @YL026TA 38392000
DDUNKEY  DC    X'0001'             KEY TO UNALLOCATE DDNAME    @YL026TA 38396000
         EJECT                                                          38400020
*        THIS WORK AREA IS USED BY ALL LOADS OF THE PROTECT SVC.        38500020
*        ANY CHANGES TO IT MUST BE MADE TO ALL LOADS.                   38600020
WORKD    DSECT                                                          38700020
*                                                                       38800020
         IECDSECT                                                       38900020
CLEARIO  EQU   *-DXECB             LENGTH FOR CLEARING I/O BLOCKS       39000020
*                                                                       39100020
COMMD    EQU   *                   CONTINUE DSECT                       39200020
*                                                                       39300020
*        WORK AREA FOR MPDS COMMUNICATION AND BUFFERING                 39400020
*        A CONTINUATION OF DSECT (WORKD)                                39500020
*                                                                       39600020
*                                                                       39700020
DSAVR    DS    F                   SAVE AREA FOR RETURN REGISTER        39800020
DSAVT    DS    F                   MPDS LAST BLOCK SAVE AREA            39900020
DUCBADDR DS    F                   ADDRESS OF UCB LOOKUP TABLE          40000020
DPMODE   DS    CL1                 PROTECTION MODE BYTE SAVE AREA       40100020
DRECAP   DS    CL1                 SYSRES DEVICE-RECORD/TRK CAPACITY    40200020
DCODTAB  DS    CL1                 ENTRY CODE SAVE AREA FOR NEXT LOAD   40300020
*                                                                       40400020
*        DFLAG - COMMUNICATES STATUS OF DSCB UPDATING REQUIREMENTS      40500020
*                                                                       40600020
DFLAG1   DS    BL1                 COMMUNICATION FLAG                   40700020
*        COMMUNICATION FLAG (DFLAG1) IN COMMD WORK AREA                 40800020
*              1 BYTE  (DFLAG1)                                         40900020
*                   BIT  0  =1 MPDS IS ENQ TO ADD OWN P/W PROTECTION    41000020
*                        1  =1 INDICATES I/O ERROR                      41100020
*                        2  =1 INDICATES ENQUEUED IN 1ST - 2ND LOADS    41200020
*                        3  =1 PROTECTED DATA SET-SET BIT 3 IN DSCB     41300020
*                        4  =1 OBTAIN WORK AREA TO BE FREED             41400020
*                        5  =1 NO PASSWORD TO READ-SET BIT 5 IN DSCB    41500020
*                        6  =1 UPDATE DSCB OF DATA SET WITH PROTECTION  41600020
*                              SPECIFIED IN BITS 3 AND 5                41700020
*                        7  =1 UPDATE MPDS DSCB FROM CORE IMAGE IN      41800020
*                              WORK AREA (WORKD) AND DEQ ON MPDS        41900020
*                                                                       42000020
DFLAG2   DS    BL1                 COMMUNICATION FLAG                   42100020
*              1 BYTE (DFLAG2)                                          42200020
*                   BIT 0  =1 INDICATES AUTHORIZED USER        @ZA26554 42300037
*                   BIT 1  =1 INDICATES NEW PASSWORD WITH REPLACE       42350037
*                   BIT 2  =1 SECOND PASS SWITCH FOR VALCKRTN  @ZA26554 42400037
*                   BIT 3     RESERVED                                  42600020
*                   BIT 4     RESERVED                                  42700020
*                   BIT 5     RESERVED                                  42800020
*                   BIT 6     RESERVED                                  42900020
*                   BIT 7     RESERVED                                  43000020
*                                                                       43100020
         DS    0CL11               COUNT FIELD FOR I/O                  43200020
DMPEND   DS    CL8                 MBBCCHHR OF LAST RECORD WRITTEN      43300020
DCKDLL   DS    CL3                 KEY LENGTH/DATA LENGTH               43400020
*                                                                       43500020
*        EXCP BUFFER  AREA FOR COUNT KEY DATA READ/WRITE                43600020
*                                                                       43700020
         DS    0F                  ALIGN WORD                           43800020
         DS    CL1                 ALIGN FOR MBBCCHHR                   43900020
DMBB     DS    CL3                 MBB FIELD FOR CONVERT ROUTINE        44000020
         DS    0CL8                COUNT FIELD FOR I/O                  44100020
DCNT     DS    CL4                 CCHH PORTION OF COUNT                44200020
DRECNO   DS    CL1                 RECORD NUMBER                        44300020
DKEYLEN  DS    CL1                 KEY LENGTH FOR FOR WRITE             44400020
DDATALEN DS    CL2                 DATA LENGTH FOR WRITE                44500020
DKEY     DS    CL44                EXCP- 44 BYTE KEY (DSN)              44600020
DKEY8    DS    CL8                 EXCP- 8 BYTE EXTENSION (PASSWORD)    44700020
DATA     DS    0CL80               DATA FIELD                           44800020
DUSE     DS    CL2                 USE COUNT                            44900020
DMODE    DS    BL1                 PROTECTION MODE BYTE FIELD           45000020
DAT77    DS    CL77                USER DATA (77 BYTES OPTIONAL DATA)   45100020
DSAVLL   EQU   *-DCNT              COUNT-KEY-DATA FIELD LENGTH          45200020
DCLEAR   EQU   *-COMMD             WORK AREA TO BE CLEARED TO ZERO      45300020
DFOXKEY  DS    52C                 52 BYTE KEY OF FF                    45400020
         DS    80C                 80 BYTE DATA FIELD                   45500020
*                                                                       45600020
*        OBTAIN LIST                                                    45700020
*                                                                       45800020
OBTPTR   CAMLST SEARCH,OBTDSN,OBTVOL,OBTWRK                             45900020
         ORG   OBTPTR              LABEL OBTAIN FIELDS                  46000020
OBTAIN1  DS    F                   OBTAIN CAMLST FIRST FULL WORD        46100020
OBTAIN2  DS    F                   OBTAIN CAMLST SECOND FULL WORD       46200020
OBTAIN3  DS    F                   OBTAIN CAMLST THIRD FULL WORD        46300020
OBTAIN4  DS    F                   OBTAIN CAMLST FOURTH FULL WORD       46400020
         ORG                                                            46500020
*                                                                       46600020
*        ENQUEUE PARAMETER LIST                                         46700020
*                                                                       46800020
DENQLST  ENQ   (DMPDSQN,DMPDS,E,HLEN,SYSTEM),MF=L                       46900020
*        NAME LIST FOR ENQUEUE/DEQUEUE AND OBTAIN                       47000020
DMPDSQN  DS    0CL52               ONE FIELD FOR SETTING UP IN WORKD    47100020
         DS    CL8                 QNAME                                47200020
DMPDS    DS    CL44                RNAME                                47300020
OBTDSN   EQU   DMPDS               DSNAME OF MASTER PASSWORD DATA SET   47400020
OBTVOL   DS    CL6                 VOLUME SERIAL OF MPDS DSCB VOLUME    47500020
DREPSAV  DS    CL140               SAVEAREA FOR PASSWORD ENTRY          47600020
LOCNAME  CAMLST NAME,DKEY,,LOCAREA LOCATE CAMLST MACRO                  47700020
         ORG   LOCNAME             LABEL LOCATE CAMLST FIELDS           47800020
LOCNAME1 DS    F                   1ST WORD LOCATE CAMLST               47900020
LOCNAME2 DS    F                   2ND WORD LOCATE CAMLST               48000020
LOCNAME3 DS    F                   3RD WORD LOCATE CAMLST               48100020
LOCNAME4 DS    F                   4TH WORD LOCATE CAMLST               48200020
         ORG                                                            48300020
USECOUNT DS    F                   SAVE POINTER TO USER COUNT HERE      48400020
*  KEEP ENQ AND DEQ LISTS TOGETHER.                                     48450020
ENQLIST  ENQ   (QNAME,RNAME,E,RNLENGTH,SYSTEM),RET=USE,MF=L ENQUEUE     48500020
DEQLIST  DEQ   (QNAME,RNAME,RNLENGTH,SYSTEM),RET=HAVE,MF=L DEQUEUE      48550020
*  NOTE - MFT ENQUEUE WITH QNAME EQUAL TO SYSDSN REQUIRES TCB           48560020
*         ADDRESS IMMEDIATELY FOLLOWING QNAME.                          48570020
QNAME    DS    CL8                 QNAME BUFFER                         48600020
TCBADDR  DS    F                   TCB ADDRESS FOR MFT ENQUEUE          48650020
RNAME    DS    CL44                RNAME BUFFER                         48700020
OLDFLAG  DS    CL1                 OLD PROTECTION STATUS                48800020
NEWFLAG  DS    CL1                 NEW PROTECTION STATUS                48900020
*  WORK AREA NEEDED FOR ALLOCATION                             @YL026TA 48902000
DAPARM   DS    F                   POINTER TO REQUEST BLOCK    @YL026TA 48904000
DARQBLK  DS    0CL20               DYNAMIC ALLOCATION REQUEST          *48906000
                                   BLOCK                       @YL026TA 48908000
DABLKLN  DS    CL1                 LENGTH OF BLOCK             @YL026TA 48910000
DAVERB   DS    CL1                 VERB CODE FOR REQUEST       @YL026TA 48912000
DAFLGS1  DS    CL2                 FLAGS                       @YL026TA 48914000
DAERRCD  DS    CL2                 ERROR RETURN CODE           @YL026TA 48916000
DAINFO   DS    CL2                 INFORMATIONAL RETURN CODE   @YL026TA 48918000
DATXTPT  DS    CL4                 ADDRESS OF TEXT POINTERS    @YL026TA 48920000
DRESVE   DS    CL4                 RESERVED                    @YL026TA 48922000
DAFLGS2  DS    CL4                 FLAGS                       @YL026TA 48924000
* TEXT POINTERS                                                @YL026TA 48926000
DATP1    DS    F                                               @YL026TA 48928000
DATP2    DS    F                                               @YL026TA 48930000
DATP3    DS    F                                               @YL026TA 48932000
DATP4    DS    F                                               @YL026TA 48934000
DATP5    DS    F                                               @YL026TA 48936000
*  TEXT UNITS FOR ALLOCATION AND UNALLOCATION                  @YL026TA 48938000
DADSNM   DS    0CL50               DSNAME TEXT UNIT            @YL026TA 48940000
         DS    CL2                 KEY                         @YL026TA 48942000
         DS    CL2                 NUMBER                      @YL026TA 48944000
DADSL    DS    CL2                 LENGTH                      @YL026TA 48946000
DADSN    DS    CL44                DATA SET NAME               @YL026TA 48948000
DASTAT   DS    0CL7                STATUS TEXT UNIT            @YL026TA 48950000
         DS    CL2                 KEY                         @YL026TA 48952000
         DS    CL2                 NUMBER                      @YL026TA 48954000
         DS    CL2                 LENGTH                      @YL026TA 48956000
         DS    CL1                 STATUS INDICATOR FIELD      @YL026TA 48958000
DAUNIT   DS    0CL9                UNIT NAME TEXT UNIT         @YL026TA 48960000
         DS    CL2                 KEY                         @YL026TA 48962000
         DS    CL2                 NUMBER                      @YL026TA 48964000
         DS    CL2                 LENGTH                      @YL026TA 48966000
DAUNAM   DS    CL3                 UNIT NAME FIELD             @YL026TA 48968000
DADDNM   DS    0CL14               DDNAME TEXT UNIT            @YL026TA 48970000
DADKEY   DS    CL2                 KEY                         @ZA02651 48972037
         DS    CL2                 NUMBER                      @YL026TA 48974000
         DS    CL2                 LENGTH                      @YL026TA 48976000
         DS    CL8                 DDNAME FIELD                @YL026TA 48978000
DAVOL    DS    0CL12               VOLUME TEXT UNIT            @YL026TA 48980000
         DS    CL2                 KEY                         @YL026TA 48982000
         DS    CL2                 NUMBER                      @YL026TA 48984000
         DS    CL2                 LENGTH                      @YL026TA 48986000
DAVOLSR  DS    CL6                 VOLUME SERIAL FIELD         @YL026TA 48988000
REGSAVE  DS    18F                 REG SAVE AREA               @ZA26554 49000037
RCVTSAVE EQU   REGSAVE+F12         CVT SAVEAREA                @ZA26554 49050037
*                                                                       49500020
*              PARAMETER LIST FOR ALL REQUESTS                          49600020
*                                                                       49700020
*                                                                       49800020
*              COMMON  SEGMENT FOR ALL REQUESTS                         49900020
*                                                                       50000020
PARMWDS  DS    0FL7                                            @ZA26554 50050037
ENCODE   DS    0BL1                ENTRY CODE                           50100020
DBUF     DS    CL4                 ADDRESS OF BUFFER FOR CODE 04/05     50200020
DSNLL    DS    0CL1                DSN LENGTH                           50300020
DSN      DS    CL4                 ADDRESS OF DATA SET NAME             50400020
CURRENT  DS    CL4                 ADDRESS OF CURRENT PASSWORD          50500020
*                                                                       50600020
*              ADD / REPLACE / DELETE COMMON SEGMENT                    50700020
*                                                                       50800020
CONTROL  DS    CL4                 ADDRESS OF CONTROL PASSWORD          50900020
VOLNUM   DS    0CL1                NUMBER OF VOLUMES SPECIFIED          51000020
VOLIST   DS    CL4                 ADDRESS OF VOLUME LIST               51100020
*                                                                       51200020
*              ADD / REPLACE  COMMON SEGMENT                            51300020
*                                                                       51400020
PCODE    DS    0BL1                PROTECTION CODE                      51500020
NEW      DS    CL4                 ADDRESS OF NEW PASSWORD              51600020
STRINGL  DS    0CL1                STRING LENGTH                        51700020
STRING   DS    CL4                 ADDRESS OF DATA STRING               51800020
*                                                                       51900020
WKSIZE   EQU   *-WORKD             SIZE OF PROGRAM WORKAREA             51920037
*                                                                       51940037
*        END OF MAPPING OF DSECT WORKAREA                               51960037
         EJECT                                                          52000020
*                                                                       52100020
WRKSPACE DSECT                                                          52200020
*                                                                       52300020
*  OBTAIN WORKAREA AND LOCATE WORKAREA                                  52400020
*                                                                       52500020
OBTWRK   DS    CL96                DSCB                                 52600020
OBTCCH   DS    CL5                 CCHHR                                52700020
         DS    CL249               OBTAIN WORK SPACE                    52800020
         DS    0D                  ALIGN LOCATE WORKAREA                52900020
LOCAREA  DS    CL265               LOCATE WORK SPACE (VOLUME LIST)      53000020
WRKSIZE  EQU   *-WRKSPACE          SIZE OF LOCATE AND OBTAIN WORKAREA   53100020
*                                                                       53200020
         EJECT                                                          53300020
*                                                                       53400020
         EJECT                                                          53700020
SRT      DSECT                                                          53800020
         IEFUCBOB                                                       53900020
         EJECT                                                          54000020
CVT      DSECT                                                          54100020
         CVT                                                            54200020
         EJECT                                                 @YL026TA 54300000
         IHAPSA                                                @YL026TA 57300000
         EJECT                                                 @YL026TA 60300000
         IEFZB4D0                                              @YL026TA 63300000
*                                                                       66300000
         END                                                            69300000
