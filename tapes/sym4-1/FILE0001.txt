./  ADD  SSI=43440351,NAME=IECTATEN
         TITLE 'IECTATEN - BTAM LOCAL 3270 FIRST LEVEL ATTN RTN'        00600002
IECTATEN CSECT                                                          01200002
         SPACE 3                                                        01210002
*********                                                               01250002
*                                                                       01250102
*      THIS MODULE HAS BEEN PARTIALLY RE-WRITTEN FOR OS/VS2-REL2        01400002
*                                                                       01400102
*********                                                               01450002
*                                                                       01650002
*        YA02144                   YM4074                               01660002
*        YA03953                   YM5698                               01670002
*        YA03957                   YM6997                               01680002
*        ZA02340  (11/22/74)                                            01690002
*                                                                       01692002
*********                                                               01700002
         SPACE 3                                                        01750002
* STATUS- CHANGE LEVEL 000                                              01800002
*                                                                       02400002
* FUNCTION-HANDLE ALL ATTENTION INTERRUPTS FOR LOCAL 3270 DEVICES IN    03000002
*    OS/BTAM.  SCHEDULE THE SECOND LEVEL ATTENTION RTN. (IGG019PG) IF   03600002
*    A READ IS TO BE STARTED.  UPDATE ATTENTION INFORMATION FOR THE     04200002
*    BTAM LINE GROUP.                                                   04800002
*                                                                       05400002
* ENTRY POINT- THE ROUTINE IS ENTERED AT IECTATEN FROM THE I/O INTER-   06000002
*    RUPT SUPERVISOR WHENEVER ATTENTION STATUS OCCURS FROM A LOCAL 3270 06600002
*    DEVICE.                                                            07200002
*                                                                       07800002
* INPUT- REGISTERS 7, 10, AND 14 ARE ESTABLISHED BY IOS                 08400002
*    REGISTER  7 - THE ADDRESS OF THE UCB FOR THE DEVICE                09000002
*    REGISTER 10 - ADDRESS OF THE ENTRY POINT OF AEE2                   09600002
*    REGISTER 14 - RETURN POINT ADDRESS                                 10200002
*                                                                       10800002
* OUTPUT- UPDATED ATTENTION FLAGS AND COUNT IN THE LINE GROUP'S UCB'S.  11400002
*    AN INITIALIZED IQE IF THE SECOND LEVEL ATTENTION RTN IS SCHEDULED. 12000002
*                                                                       12600002
* EXTERNAL REFERENCES- ASYNCHRONOUS EXIT EFFECTOR, STAGE 2 (AEE2)       13200002
*                                                                       13800002
* EXITS,NORMAL- RETURN TO IOS WITH ATTENTION INFORMATION UPDATED        14400002
*                                                                       15000002
* EXITS,ERROR- RETURN TO IOS WITHOUT UPDATING ATTENTION INFORMATION     15600002
*                                                                       16200002
* TABLES/WORK AREAS- NONE                                               16800002
*                                                                       17400002
* ATTRIBUTES- NUCLEUS RESIDENT, DISABLED, SUPERVISOR PROTECT KEY,       18000002
*    READ ONLY.                                                         18600002
*                                                                       19200002
* CHARACTER CODE DEPENDENCY- N/A                                        19800002
*                                                                       20400002
* NOTES- THIS ROUTINES LOGS ATTENTION INTERRUPTS RECEIVED FROM LOCAL    21000002
*    3270 DEVICES ON OPEN BTAM LINE GROUPS.  IF AN OUTSTANDING READ     21600002
*    INITIAL EXISTS FOR THE LINE GROUP AND THE DEVICE IS ABLE TO        22200002
*    PROCESS READ INITIALS, THE SECOND LEVEL ATTENTION ROUTINE IS       22800002
*    SCHEDULED USING AEE2 TO START THE READ.  ATTENTION INFORMATION     23400002
*    IN THE LINE GROUP'S UCB'S IS UPDATED AS REQUIRED.                  24000002
*                                                                       24600002
         EJECT                                                          25200002
*/*IECTATEN: CHART */                                                   25220002
*/* HEADER                                                              25240002
*/*IECTATEN - BTAM FIRST LEVEL ATTENTION ROUTINE FOR 3270 DEVICES   */  25260002
*/* E ENTRY FROM IOS */                                                 25280002
*/* M SAVE REGS AND ESTABLISH ADDRESSABILITY */                         25300002
*/* D (YES,CHKTYPE,NO,) USER'S SPACE ADDRESSABLE? */                    25310002
*/* P RESTORE IOS'S REGISTERS */                                        25312002
*/* R RETURN TO IOS+4 */                                                25314002
*/*CHKTYPE: D (YES,,NO,RTNTOIOS) IS DEVICE A 3270 DEVICE? */            25320002
*/*OPENCHK1: D (YES,CHKCSW,NO,RTNTOIOS) ATTN HANDLING IRB ADDRESS       25340002
*/*NON-ZERO? */                                                         25342002
*/*RTN2IOS: P TURN OFF BUSY,NOT READY, AND CU BUSY IN UCBFL1 */         25530002
*/* P RESTORE IOS'S REGISTERS */                                        25532002
*/* R RETURN TO IOS+4 (INTERCEPT BIT UNCHANGED) */                      25534002
*/*RTNTOIOS: P RESTORE IOS'S REGISTERS */                               25540002
*/* R RETURN TO IOS */                                                  25560002
*/*CHKREADY: D (NO,,YES,CHKFUTH) OPEN FAIL ON THIS DEVICE (UCBGRAF) ?   25570002
*/* */                                                                  25572002
*/* D (YES,FLGERCMP,NO,RTNTOIOS) DE WITH ERROR (UCBGCB) ? */            25574002
*/*CHKFUTH: D (YES,,NO,NFUTHCHK) I/O QUEUED FOR THIS DEVICE (UCBFL1) ?  25576002
*/**/                                                                   25578002
*/* D (YES,FLGERCMP,NO,RTNTOIOS) DE WITH ERROR (UCBGCB) ? */            25578402
*/*NFUTHCHK: P SET READY FLAG (UCBGRAF) */                              25578802
*/* P GET IQE ADDRESS FROM IRB AND RECHAIN IQE'S */                     25579202
*/* P GET ADDRESS OF MASTER UCB */                                      25579602
*/* D (YES,,NO,NOSETRDY) USING BTAM'S READY ROUTINE IGG019UP ? */       25579702
*/* P (,LNRDYSET) MARK LINE READY (MTRGRAF) */                          25579802
*/*NOSETRDY: P TURN OFF LINE READY (MTRGRAF) */                         25579902
*/*LNRDYSET: P SET RLN AND DEB ADDRESS AS IQE PARAMETERS */             25583202
*/* S AEE2:SCHEDULE IQE FOR READY ROUTINE */                            25585202
*/* P TURN OFF OPEN FAIL FLAG FOR DEVICE (UCBGRAF) */                   25585602
*/* D (YES,FLGERCMP,NO,RTN2IOS) DE WITH ERROR (UCBGCB) ? */             25586002
*/*FLAGRDY: P FLAG INTERUPT DURING OPEN (UCBGRAF) */                    25586402
*/* D (YES,FLGERCMP,NO,RTNTOIOS) DE WITH ERROR (UCBGRAF) ? */           25588402
*/*CHKCSW: D (YES,OTHRSTS,NO,) ATTN, DE, AND/OR CUE ONLY STATUS? */     25594402
*/*FLGERROR: P SET IOB INTERCEPT FLAG IN UCBFL1 */                      25594802
*/* D (YES,,NO,FLGERCMP) DEVICE END STATUS ? */                         25595202
*/* P SET DE WITH ERROR (UCBGCB) */                                     25595602
*/* D (NO,,YES,OPENCHK) DEVICE PREVIOUSLY NOT READY (UCBGRAF) ? */      25595702
*/*FLGERCMP: P (,RTN2IOS) TURN OFF DE WITH ERROR (UCBGCB) */            25596002
*/*OTHRSTS: D (YES,PROCATTN,NO,) ATTN STATUS PRESENTED? */              25596402
*/* D (YES,,NO,RTNTOIOS) DEVICE END STATUS ? */                         25598002
*/*OPENCHK: D (YES,,NO,NXTCHK) DEVICE READY (UCBGRAF) ? */              25598402
*/* D (YES,FLGERCMP,NO,RTNTOIOS) DE WITH ERROR (UCBGCB) ? */            25598802
*/*NXTCHK: D (NO,,YES,FLAGRDY) OPEN IN PROGRESS (UCBGRAF) ? */          25648802
*/* D (NO,,YES,CHKREADY) READYQ SPECIFIED IN DCB (UCBRDYQ) ? */         25658802
*/* D (YES,FLGERCMP,NO,RTNTOIOS) DE WITH ERROR (UCBGCB) ? */            25668802
*/*PROCATTN: D (NO,,YES,RTN2IOS) I/O OPERATION QUEUED FOR THIS DVC? */  25669202
*/*ACPTATN: D (NO,CHKRLN,YES,SETATNFL) SKIP FLAG ON (UCBGCB) ? */       25669602
*/*SETATNFL: P (,RTN2IOS) SET ATTENTION FLAG IN UCBGCB */               25669702
*/*CHKRLN: P OBTAIN ADDRESS OF MASTER UCB */                            25669802
*/*RDTIPND: D (NO,,YES,NOSCHED) PROCESSING DEVICE READY (MTRGRAF) ? */  25669902
*/* D (NO,,YES,SCHEDIQE) READ INITIAL PENDING (MTRGCB) ? */             25670002
*/*NOSCHED: D (NO,,YES,RTN2IOS) ATTENTION FLAG ON (UCBGCB) ? */         25670102
*/* P (,SETATNFL) INCREMENT ATTENTION COUNT IN MASTER UCB BY 1          25670202
*/*(MTRATNCT) */                                                        25670302
*/*SCHEDIQE: P GET IQE FROM RBNEXAV QUEUE IN IRB */                     25672602
*/* P STORE UCB ADDRESS IN IQE */                                       25673302
*/* P SET RBNEXAV TO ZERO IN IRB */                                     25674002
*/* P SET READ INITIAL PENDING FLAG OFF (MTRGCB) */                     25676002
*/* S (,RTN2IOS) AEE2:SCHEDULE 2ND LEVEL ATTN RTN */                    25678002
*/*IECTATEN: END */                                                     25680002
         EJECT                                                          25700002
*********************************************************************** 25750002
*                                                                       25760002
*         REGISTER DEFINITION                                           25770002
*                                                                       25780002
*********************************************************************** 25790002
         SPACE 5                                                        25792002
PARMREG  EQU   1                    PARAMETER REGISTER                  25800002
AEEREG   EQU   12                   ADDRESS OF AEE2           LD Y02947 26400002
R12      EQU   12                                             LD Y02947 26450002
SAVEREG  EQU   13                   ADDRESS OF SAVE AREA                27000002
R13      EQU   13                                             LD Y02947 27050002
RTNREG   EQU   14                   RETURN POINT REGISTER               27600002
R14      EQU   14                                             LD Y02947 27650002
EPREG    EQU   15                   ENTRY POINT REGISTER                28200002
*                                                                       28800002
BASEREG  EQU   11                   BASE REG FOR ATT RTN      LD Y02947 29400002
IRBREG   EQU   9                    POINTER TO IRB                      30000002
MSTREG   EQU   8                    BASE REGISTER FOR MASTER UCB        30600002
UCBREG   EQU   7                    BASE REGISTER FOR DEVICE UCB        31200002
IQEREG   EQU   6                    POINTER TO IQE                      31800002
CVTREG   EQU   5                    POINTER TO CVT            LD Y02947 31850002
ASCBREG  EQU   5                    POINTER TO ASCB           LD Y02947 31860002
DEBREG   EQU   4                  ADDR OF DEB FROM MSTRUCB     @YA02128 31870002
IOSBREG  EQU   4                    POINTER TO OISB           LD Y02947 31900002
SRBREG   EQU   3                    POINTER TO SRB            LD Y02947 31950002
WORK2    EQU   SRBREG                                        LD YA02128 32000002
UCBEXTRG EQU   2                    POINTER TO UCB EXTENSION  LD YM0160 32400002
WORK1    EQU   2                    WORK REGISTER                       33000002
         SPACE 5                                                        34200002
*********************************************************************** 34250002
*                                                                       34300002
*         EQUATIONS                                                     34350002
*                                                                       34400002
*********************************************************************** 34450002
         SPACE 5                                                        34500002
ALLON    EQU   X'FF'                ONE BYTE MASK-ALL BITS ON           34800002
ATNSTAT  EQU   X'80'                ATTENTION STATUS                    37200002
DESTAT   EQU   X'04'                DEVICE END STATUS                   37800002
CUESTAT  EQU   X'20'                CONTROL UNIT END STATUS  LD YA02144 37850002
IQEPARAM EQU   4                    DISPLACEMENT TO IQEPARAM            38400002
RBNEXAV  EQU   96                   DISPLACEMENT TO IRB POINTER TO IQE  39000002
IOBNTCPT EQU   X'10'                UCB IOB INTERCEPT FLAG              40800002
DVC3277  EQU   X'09'                DEVICE TYPE FOR 3277 DISPLAY        42000002
DVC3286  EQU   X'0B'                DEVICE TYPE FOR 3286 PRINTER        43200002
IQELNGTH EQU   16                 LENGTH OF AN IQE             @YA02128 43250002
IQELINK  EQU   0                  DISPL. TO LK FILD IN IEQ   LD YA03953 43300000
*                                                                       43800002
DEERR    EQU   X'40'              DEVICE END PLUS ERROR        @YA02128 44450002
IGG019UP EQU   X'10'              USING BTAM'S READY ROUT      @YA02128 44500002
LINERDY  EQU   X'01'              MTR FLAG FOR READY IN GROUP  @YA02128 44550002
OPENFAIL EQU   X'02'              OPEN FAILED FOR DEVICE       @YA02128 44600002
OPENINIT EQU   X'80'              OPEN IN PROGRESS FLAG        @YA02128 44650002
OPENRDY  EQU   X'40'              DEV INTERRUPT DURING OPEN    @YA02128 44700002
READY    EQU   X'20'              GRAF FLAG READY              @YA02128 45650002
RDYNDONE EQU   X'04'              PROCESSING READY             @YA02128 45700002
RLN1     EQU   X'01'                RLN FOR RLN 1                       46200002
ONE      EQU   1                                                        46600002
TWO      EQU   2                                              LD Y02947 46650002
FOUR     EQU   4                                                        46700002
ZERO     EQU   0                                              LD Y02947 46710002
A12      EQU   12                                             LD Y02947 46750002
X28      EQU   X'28'                                        LD @ZA02340 46760002
         EJECT                                                          46800002
******                                                                  46850002
*              ENTRY CODE & ADDRESSABILITY                              47400002
******                                                                  47410002
         SPACE 3                                                        47450002
         STM   ZERO,EPREG,ZERO(R13) SAVE REGISTERS            LD Y02947 47700002
         BALR  BASEREG,ZERO         ESTABLISH ADDRSSBLTY FOR  LD Y02947 52200002
         USING *,BASEREG            ATTENTION RTN CSECT                 52800002
         B     CONTIN               BRANCH AOUND MOD ID        @YA02128 52850002
         DC    CL8'IECTATEN'        MODULE ID                 LD Y02947 52900002
         DC    C' 4322'             DATE LAST CHANGE        LD @ZA02340 52950002
         DC    C'&SYSDATE'          DATE LAST ASSEMBLY      LD @ZA02340 52954002
PATCH    DC    10F'0'               PATCH AREA                          52960000
CONTIN   DS    0H                                              @YA02128 53000002
         USING UCB,UCBREG           ESTABLISH ADDRESSABILITY FOR UCB    53400002
         USING IOSB,IOSBREG         ADDRESSABILITY FOR IOSB   LD Y02947 53500002
         SPACE 5                                                        53550002
******                                                                  53552002
*         CHECK ADDRESSABILITY OF ATTN RTN.                             53554002
*         IF RUNNING UNDER THE MASTER SCHEDULER ADDRESSABILITY          53556002
*         RETURN TO IOS+4 IN ORDER TO BE RESCHEDULED UNDER THE          53558002
*         USER ADDRESSABILITY.                                          53558402
******                                                                  53558802
         USING SRB,SRBREG                                     LD Y02947 53558902
         USING ASCB,ASCBREG                                   LD Y02947 53559002
         LR    IOSBREG,PARMREG      GET IOSB ADDRESS          LD Y02947 53559202
         L     SRBREG,IOSSRB        GET SRB ADDRESS           LD Y02947 53559602
         L     ASCBREG,SRBASCB      GET ADDRESS OF ASCB       LD Y02947 53559702
         L     UCBREG,IOSUCB        ADDRESS OF UCB            LD Y02947 53561902
         L     UCBEXTRG,UCBEXTPT    ADDR OF COMMON UCB EXT    LD YM0160 53563002
         USING UCBCMEXT,UCBEXTRG    ADDRESSABILITY FOR...     LD YM0160 53565002
*                                   COMMON UCB EXTENSION.     LD YM0160 53565402
         CLC   UCBASID(TWO),ZEROS   IS THIS AN...             LD YM6997 53565800
*                                   UNSOLICITED ATTENTION?    LD YM6997 53566200
         BE    RTNTOIOS             YES, RETURN               LD YM6997 53566300
*                                                             LD YM6997 53566400
         CLC   ASCBASID(TWO),UCBASID IS ATTN RTN RUNNING      LD Y02947 53566602
*                                   UNDER USER ADDRESSABILITY LD Y02947 53569902
         DROP  ASCBREG                                                  53573202
         DROP  SRBREG                                                   53575202
         BE    CONTINUE             BRANCH IF YES             LD Y02947 53583202
         MVC   IOSASID(TWO),UCBASID MOVE USER MEMORY ID TO    LD YM0160 53583602
*                                   IOSB FOR IOS.             LD YM0160 53584002
         LM    ZERO,EPREG,ZERO(R13) AND RETURN TO             LD Y02947 53585202
         B     FOUR(R14)            IOS+4                     LD Y02947 53585602
         SPACE 5                                                        53586002
******                                                                  53586702
*         ADDRESS OF AEE STAGE 2 FROM CVT                               53600002
******                                                                  53650002
CONTINUE EQU   *                                              LD Y02947 53650402
         USING CVT,CVTREG           ADDRESSABILITY FOR CVT    LD Y02947 53652002
         L     CVTREG,CVTPTR        ADDRESS OF CVT            LD Y02947 53660002
         L     AEEREG,CVT0EF00      ADDRESS OF AEE STAGE 2    LD Y02947 53670002
         DROP  CVTREG                                         LD Y02947 53680002
         SPACE 5                                                        53700002
*              VALIDATE DEVICE                                          54000002
         SPACE 3                                                        54050002
CHKTYPE  CLI   UCBTBYT3,UCB3DISP   GRPHS DEVICE CLASS IN UCB  LD Y02947 54600002
         BNE   RTNTOIOS             NO, RETURN TO IOS                   55200002
         CLI   UCBTBYT4,DVC3277    IS DEVICE 3270 DEVICE      LD Y02947 55800002
         BL    RTNTOIOS            NO, RETURN TO IOS                    56400002
         CLI   UCBTBYT4,DVC3286    MAYBE, CHECK FURTHER       LD Y02947 57000002
         BH    RTNTOIOS            NO, RETURN TO IOS                    57600002
         SPACE 3                                                        57650002
*              CHECK OPEN STATUS                                        58200002
         SPACE 3                                                        58250002
OPENCHK1 L     IRBREG,UCBIRB        GET ADDRESS OF IRB         @YA02128 58800002
         LA    IRBREG,0(IRBREG)   CLEAR GRAF FLAGS             @YA02128 58850002
         LTR   IRBREG,IRBREG        IRB ADDR ESTABLISHED BY OPEN        59400002
         BZ    RTNTOIOS             NO, IGNORE ATTENTION    LD @ZA02340 60000002
         TM    UCBFL1,X28          RQE ADDR PRESENT         LD @ZA02340 60010002
         BZ    CHKCSW              NO, ASYNCHRONOUS         LD @ZA02340 60020002
*                                  YES, RETURN TO IOS...    LD @ZA02340 60030002
*                                  ...SINCE THIS IS...      LD @ZA02340 60040002
*                                  ...ENDING STATUS.        LD @ZA02340 60042002
         SPACE 3                                                        60050002
*              EXIT CODE                                                60600002
         SPACE 3                                                        60650002
RTNTOIOS EQU   *                                              LD Y02947 61200002
         LM    ZERO,EPREG,ZERO(R13) LOAD REGISTER             LD Y02947 61850002
         BR    RTNREG                                         LD Y02947 61900002
         SPACE 3                                                        61950002
*                                 ASYNCHRONOUS READY           @YA02128 62000002
CHKREADY EQU   *                  READY QUEUE HAS BEEN         @YA02128 62050002
*                                 INITIALIZED                  @YA02128 62100002
         TM    UCBGRAF,OPENFAIL   DID OPEN FOR DEVICE FAIL ?   @YA02128 62150002
         BO    CHKFUTH            NO, RETURN TO IOS            @YA02128 62200002
         TM    UCBGCB,DEERR       DE WITH ERROR ?              @YA02128 62250002
         BO    FLGERCMP           YES, SET ERROR               @YA02128 62300002
         B     RTNTOIOS           NO, RETURN                   @YA02128 62350002
CHKFUTH  EQU   *                  CHECK FURTHER                @YA02128 62400102
*                                                                       62410100
*              6 LINES DELETED                               LD YA03957 62420100
*                                                                       62430100
         OI    UCBGRAF,READY      SET READY FLAG               @YA02128 62446002
         L     IQEREG,RBNEXAV(IRBREG) GET ADDR OF READY QUEUE  @YA02128 62448002
         MVC   RBNEXAV(FOUR,IRBREG),0(IQEREG) CHAIN NEXT IQE   @YA02128 62448402
         XC    0(FOUR,IQEREG),0(IQEREG) REMOVE IQE FROM CHAIN  @YA02128 62448802
         XR    WORK1,WORK1        CLEAR EVEN REG               @YA02128 62449202
         IC    WORK2,UCBRLN       PICK UP RLN OF THIS DEVICE   @YA02128 62449602
         CLI   UCBRLN,RLN1        IS THIS THE MASTER UCB ?     @YA02128 62449702
         BE    MSTADDOK           YES, USE THE ADDRESS         @YA02128 62449802
         L     MSTREG,UCBCTLNK    NO, GET ADDR OF MASTER UCB   @YA02128 62449902
         SPACE 3                                                        62450002
         LA    MSTREG,0(MSTREG)   CLEAR THE HIGH BYTE          @YA02128 62499902
         B     MSTUCBOK           GO AND CHECK                 @YA02128 62509902
MSTADDOK EQU   *                  SET UP TO CHECK MASTER UCB   @YA02128 62519902
         LR    MSTREG,UCBREG      PICK UP MASTER UCB ADDR      @YA02128 62529902
MSTUCBOK EQU   *                  MSTREG CONTAINS ADDRESS      @YA02128 62539902
         USING MSTRUCB,MSTREG     TELL ASSEMBLER               @YA02128 62541902
         TM    MTRGRAF,IGG019UP   USING BTAM'S ?               @YA02128 62543902
         BNO   NOSETRDY           NO, DON'T SET LINERDY        @YA02128 62545902
         OI    MTRGRAF,LINERDY    INDICATE DEVICE READY        @YA02128 62547902
         B     LNRDYSET           BYPASS TURN OFF              @YA02128 62548302
NOSETRDY EQU   *                  TURN OFF MTR LINE READY      @YA02128 62548702
         NI    MTRGRAF,ALLON-LINERDY TURN OFF LINE READY       @YA02128 62549102
LNRDYSET EQU   *                  MTR GRAF FLAGS SET           @YA02128 62549502
         L     DEBREG,MTRDEBAD    GET DEB ADDRESS FOR GROUP    @YA02128 62549602
         DROP  MSTREG             DON'T NEED MASTER ANYMORE    @YA02128 62549702
         LA    DEBREG,0(DEBREG)   CLEAR HIGH BYTE              @YA02128 62549802
         SLL   WORK2,24           PUT RLN IN HIGH BYTE         @YA02128 62599802
         OR    DEBREG,WORK2       PUT RLN IN PARM              @YA02128 62609802
         ST    DEBREG,IQEPARAM(IQEREG) STORE RLN/DEBADDR       @YA02128 62619802
         LNR   PARMREG,IQEREG     PARM = COMPLEMENT OF         @YA02128 62629802
*                                 IQE ADDRESS                  @YA02128 62639802
         LR    EPREG,AEEREG       ENTRY POINT TO AEE2          @YA02128 62641802
         BALR  RTNREG,EPREG       GO TO AEE2 TO SCHEDULE       @YA02128 62643802
*                                 ASYNCHRONOUS DEVICE          @YA02128 62645802
*                                 READY ROUTINE                @YA02128 62647802
         NI    UCBGRAF,ALLON-OPENFAIL TURN OFF OPENFAIL FLAG   @YA02128 62648202
         TM    UCBGCB,DEERR       ERROR WITH DE STAT ?         @YA02128 62648602
         BO    FLGERCMP           YES, SET ERROR               @YA02128 62649002
         B     RTNTOIOS           RETURN TO IOS+4              @YA02128 62649402
FLAGRDY  EQU   *                  DEVICE INTERRUPT IN OPEN     @YA02128 62649502
         OI    UCBGRAF,OPENRDY    SET FLAG INT DURING OPEN     @YA02128 62649602
         TM    UCBGCB,DEERR       ERROR WITH DE STAT ?         @YA02128 62649702
         BO    FLGERCMP           YES, SET ERROR               @YA02128 62699702
         B     RTNTOIOS           RETURN TO IOS                @YA02128 62709702
*              CHECK CSW STATUS OTHER THAN ATTN,DE AND CUE   LD YA02144 62749702
CHKCSW   TM    IOSTSA,ALLON-ATNSTAT-DESTAT-CUESTAT           LD YA02144 63000002
         BZ    OTHRSTS              NO, CHECK FURTHER                   63600002
FLGERROR EQU   *                                              LD YM5698 64200000
         TM    IOSTSA,DESTAT      DEVICE END ?                 @YA02128 64250002
         BNO   PROCATTN           SINCE ERROR, TRY TO...     LD YA03957 64300000
*                                 TO SCHE 2ND LEVEL SO...    LD YA03957 64320000
*                                 USER CAN BE AWARE OF.      LD YA03957 64330000
         OI    UCBGCB,DEERR       SET DE WITH ERROR FLAG       @YA02128 64350002
         TM    UCBGRAF,OPENFAIL   NOT PREVIOUSLY READY ?       @YA02128 64400002
         BO    OPENCHK            YES, PROCESS READY           @YA02128 64450002
FLGERCMP EQU   *                  RETURN WITH ERROR            @YA02128 64500002
         NI    UCBGCB,ALLON-DEERR TURN OFF DE WITH ERROR       @YA02128 64550002
         B     RTNTOIOS             RETURN TO IOS             LD Y02947 64800002
OTHRSTS  TM    IOSTSB,ALLON         ERROR STATUS IN BYTE2     LD Y02947 65400002
         BNZ   FLGERROR             YES, FLAG ERROR IN UCB              66000002
         TM    IOSTSA,ATNSTAT       ATTENTION STATUS ON       LD Y02947 66600002
         BO    PROCATTN           YES, GO PROCESS IT           @YA02128 67200002
         TM    IOSTSA,DESTAT      DEVICE END STATUS ?          @YA02128 67250002
         BZ    RTNTOIOS           NO, RETURN TO IOS            @YA02128 67300002
OPENCHK  EQU   *                  SEE IF OPEN IN PROGRESS,     @YA02128 67350002
*                                 OR IF OPEN COMPLETE          @YA02128 67400002
         TM    UCBGRAF,OPENRDY+READY UCB ALREADY READY         @YA02128 67450002
         BZ    NXTCHK             NO, CHECK FURTHER            @YA02128 67500002
         TM    UCBGCB,DEERR       ERROR STAT ?                 @YA02128 67550002
         BO    FLGERCMP           YES, SET ERROR               @YA02128 67600002
         B     RTNTOIOS           NO, RETURN                   @YA02128 67650002
NXTCHK   EQU   *                  CHECK FURTHER                @YA02128 67700002
         TM    UCBGRAF,OPENINIT   IS OPEN IN PROGRESS ?        @YA02128 67750002
         BO    FLAGRDY            YES, FLAG INT DURING OPEN    @YA02128 67760002
         L     IRBREG,UCBRDYQ     GET ADDRESS OF READY IRB     @YA02128 67770002
         LA    IRBREG,0(IRBREG)   CLEAR HIGH BYTE              @YA02128 67780002
         LTR   IRBREG,IRBREG      READY QUEUE INITIALIZED ?    @YA02128 67790002
         BNZ   CHKREADY           YES, SEE IF NEED SCHEDULE    @YA02128 67792002
         TM    UCBGCB,DEERR       ERROR WITH STAT ?            @YA02128 67794002
         BO    FLGERCMP           YES, SET ERROR               @YA02128 67796002
         B     RTNTOIOS           NO, RETURN                   @YA02128 67798002
*                                                                       68450002
PROCATTN EQU   *                  PROCESS THE ATTENTION        @YA02128 68450102
*                                                                       68460100
*              2 LINES DELETED                               LD YA03957 68500100
*                                                                       68550100
ACPTATN  TM    UCBGCB,UCBSKPFG      SKIP FLAG ON              LD Y02947 69000002
         BZ    CHKRLN               NO, CHECK FOR PENDING READ          69600002
SETATNFL OI    UCBGCB,UCBATRCD      SET ATT. FLAG IN GCB      LD Y02947 70200002
         B     RTNTOIOS             RETURN TO IOS             LD Y02947 70800002
*                                                                       71400002
CHKRLN   CLI   UCBRLN,RLN1          UCB RLN 1 FOR LINE GROUP            72000002
         BE    RLNISONE             YES, UCB = MASTER UCB               72600002
         L     MSTREG,UCBCTLNK      NO, GET ADDRESS OF MASTER UCB       73200002
         USING MSTRUCB,MSTREG       & ESTABLISH ADDRESSABILITY          73800002
*                                                                       74400002
RDTIPND  EQU   *                  CHECK STATUS OF UCB          @YA02128 74450002
         TM    MTRGRAF,RDYNDONE   PROCESSING READY ?           @YA02128 74500002
         BO    NOSCHED            YES, DON'T SCHEDULE          @YA02128 74550002
         TM    MTRGCB,UCBRIPND      READ INITIAL PENDING                75000002
         BO    SCHEDIQE             YES, SCHEDULE 2ND LEVEL ATTN RTN    75600002
NOSCHED  EQU   *                  WON'T SCHEDULE               @YA02128 75650002
         TM    UCBGCB,UCBATRCD      IF ATT. FLAG ALREADY ON,  LD Y02947 76200002
         BO    RTNTOIOS             RETURN TO IOS             LD Y02947 76800002
         SR    WORK1,WORK1                                              77400002
         IC    WORK1,MTRATNCT       INCREMENT ATTENTION COUNT IN        78000002
         LA    WORK1,ONE(WORK1)     MASTER UCB BY 1                     78600002
         STC   WORK1,MTRATNCT                                           79200002
         B     SETATNFL             SET ATTENTION FLAG IN GCB           79800002
*              SCHEDULE 2ND LEVEL ATTENTION ROUTINE                     80400002
SCHEDIQE L     IQEREG,RBNEXAV(IRBREG) GET ADDRESS OF IQE                81000002
         ST    UCBREG,IQEPARAM(IQEREG) STORE ADDRESS OF UCB IN IQE      81600002
         MVC   RBNEXAV(FOUR,IRBREG),IQELINK(IQEREG) UNCHAIN  LD YA03953 82200000
*                                   1ST AVAILABLE IQE        LD YA03953 82250000
         LNR   PARMREG,IQEREG       PARM = COMPLEMENT OF IQE ADDRESS    82800002
         LR    EPREG,AEEREG         EP = AEE2                           83400002
         BALR  RTNREG,EPREG         GO TO AEE2 TO SCHEDULE IQE          84000002
         NI    MTRGCB,ALLON-UCBRIPND TURN RD PENDING FLAG OFF LD Y02947 84600002
         B     RTNTOIOS             RETURN TO IOS             LD Y02947 85200002
RLNISONE LR    MSTREG,UCBREG        TRANSFER UCB ADDRESS TO MASTER      85800002
         B     RDTIPND              UCB BASE AND CHECK FOR PENDING READ 86400002
*                                                                       87000002
ZEROS    DC    H'0'                 HALF WORD OF ZEROS       LD YA03953 87050000
*                                                                       87100000
         EJECT                                                          88200002
ASCB     IHAASCB                                              LD Y02947 88260002
         EJECT                                                          88300002
CVT      DSECT                                                LD Y02947 88800002
         CVT                                                  LD Y02947 88850002
         EJECT                                                          88900002
         IECDIOSB                                             LD Y02947 88950002
         EJECT                                                          89045202
SRB      IHASRB                                               LD Y02947 89045602
         EJECT                                                          89046002
UCB      DSECT                                                LD Y02947 89050002
         IEFUCBOB                                             LD Y02947 89100002
         EJECT                                                          89110002
MSTRUCB  DSECT                                                          89120002
MTRATNCT EQU   MSTRUCB+(UCBATNCT-UCBOB)                                 89130002
MTRGCB   EQU   MSTRUCB+(UCBGCB-UCBOB)                                   89140002
MTRGRAF  EQU   MSTRUCB+(UCBGRAF-UCBOB)                                  89142002
MTRDEBAD EQU   MSTRUCB+(UCBRLN-UCBOB)                                   89144002
         SPACE 5                                                        89150002
         END                                                            89400002
./  ADD  SSI=31320016,NAME=IECTCHGN
         TITLE 'AUTOPOLL CHANGE ENTRY SUBROUTINE.'                      00600013
IECTCHGN CSECT                                                          01200013
* STATUS -          CHANGE LEVEL 000    APRIL 26, 1967                  01800013
*                                                                       02400013
* FUNCTION -        THIS ROUTINE PERFORMS THE FUNCTION OF PHYSICALLY  * 02410002
*                   RESTRUCTURING A POLLING LIST IN ORDER TO CAUSE AN * 02420002
*                   ENTRY TO BE SKIPPED OR REACTIVATED.               * 02430002
*                                                                     * 02440002
* ENTRY POINT -     FIRST EXECUTABLE INSTRUCTION                      * 02450002
*                                                                     * 02460002
* INPUT -           REGISTER ZERO CONTAINS THE POSITION (NUMERICAL    * 02470002
*                     VALUE) OF THE ENTRY TO BE CHANGED IN THE        * 02480002
*                     POLLING LIST.                                   * 02490002
*                   REGISTER ONE CONTAINS THE ADDRESS OF THE POLLING  * 02500002
*                     LIST.                                           * 02510002
*                                                                     * 02520002
* OUTPUT -          THE TERMINAL LIST WITH THE INDICATED ENTRY SKIPPED* 02530002
*                     OR ACTIVATED.                                   * 02540002
*                                                                     * 02550002
* EXTERNAL ROUTINES- NONE                                             * 02560002
*                                                                     * 02570002
* EXITS -           VIA REGISTER 14 WITH ONE OF THE FOLLOWING RETURN  * 02580002
*                     CODES -                                         * 02590002
*                                                                     * 02600002
*                     X'00'- REQUESTED ACTION WAS PERFORMED           * 02610002
*                     X'04'- REQUESTED ACTION WAS NOT PERFORMED       * 02620002
*                            BECAUSE THE LIST WAS IN USE              * 02630002
*                     X'08'- REQUESTED ACTION WAS NOT PERFORMED       * 02640002
*                            BECAUSE THE OPERAND SPECIFYING THE       * 02650002
*                            POSITION OF THE ENTRY WAS TOO LARGE.     * 02660002
*                                                                     * 02670002
* ATTRIBUTES -      THIS ROUTINE IS REENTRANT.                        * 02680002
*                                                                     * 02690002
*********************************************************************** 02700002
RINDX  EQU   0                                                          03000013
RLSB   EQU   1                                                          03600013
RWKE   EQU   2                                                          04200013
RWKO   EQU   3                                                          04800013
RTE    EQU   4                                                          05400013
RAE    EQU   5                                                          06000013
RNNN   EQU   6                                                          06600013
RLST   EQU   7                                                          07200013
RMVP   EQU   8                                                          07800013
RBASE  EQU   9                                                          08400013
RNPC   EQU   10                                                         09000013
*                                                                       09600013
       SAVE  (0,10)                                                     10200013
       BALR  RBASE,0                                                    10800013
       USING *,RBASE                                                    11400013
       SH    RLSB,HDR                                                   12000013
*                             CLEAR RETURN CODE                         12600013
       SR    15,15                                                      13200013
*                                  TEST USAGE COUNT                     13800013
       TM    2(RLSB),X'0F'                                              14400013
       BNZ   EXIT4                                                      15000013
*                                  CLEAR REGESTERS                      15600013
       SR    RTE,RTE                                                    16200013
       SR    RAE,RAE                                                    16800013
       SR    RNNN,RNNN                                                  17400013
*                                  INITIALIZE REGESTERS                 18000013
       STC   RINDX,INDEX                                                18600013
       IC    RTE,0(RLSB)                                                19200013
       CR    RTE,RINDX                                                  19800013
       BL    EXIT8                                                      20400013
       IC    RAE,1(RLSB)                                                21000013
       IC    RNNN,2(RLSB)                                               21600013
       SRL   RNNN,5                                                     22200013
       CH    RNNN,ONE              IF NNN 0 OR 1, IT MEANS      YA01016 22300002
       BH    COUNT1                8 OR 9, CONVERT IT TO THE    YA01016 22400002
       LA    RNNN,8(RNNN)          TRUE VALUE                   YA01016 22500002
COUNT1 EQU   *                                                  YA01016 22600002
       LR    RNPC,RNNN                                                  22800013
       BCTR  RNPC,0                                                     23400013
       LTR   RLST,RLSB                                                  24000013
       BM    ACTIVATE                                                   24600013
*                                                                       25200013
*                             SKIP ENTRY                                25800013
       LTR   RAE,RAE                                                    26400013
       BZ    EXIT                                                       27000013
*                                  SCAN FOR SUBJECT ENTRY               27600013
SCAN1  AR    RLST,RNNN                                                  28200013
       CLC   INDEX(1),2(RLST)                                           28800013
       BE    HOLD1                                                      29400013
       BCT   RAE,SCAN1                                                  30000013
       B     EXIT                                                       30600013
HOLD1  BCT   RAE,SAVE1                                                  31200013
       B     INCR                                                       31800013
*                                  SAVE ENTRY                           32400013
SAVE1  SR    RLST,RNNN                                                  33000013
       EX    RNPC,MOVE1                                                 33600013
       LA    RMVP,0(RNNN,RLST)                                          34200013
*                                  MOVE REMAINDER OF ACTIVE ENTRIES     34800013
SHIFT1 EX    RNPC,MOVE2                                                 35400013
       AR    RLST,RNNN                                                  36000013
       AR    RMVP,RNNN                                                  36600013
       BCT   RAE,SHIFT1                                                 37200013
*                                  STORE SUBJECT ENTRY IN SKIP LIST     37800013
       EX    RNPC,MOVE3                                                 38400013
INCR   IC    RAE,1(RLSB)                                                39000013
*                                  DECREMENT ACTIVE COUNT               39600013
       BCTR  RAE,0                                                      40200013
       B     OUT                                                        40800013
*                                                                       41400013
*                                                                       42000013
*                             ACTIVATE ENTRY                            42600013
*                                                                       43200013
ACTIVATE  DS 0H                                                         43800013
       CR    RAE,RTE                                                    44400013
       BE    EXIT                                                       45000013
*                                  FIND START OF SKIP LIST              45600013
       LR    RWKO,RAE                                                   46200013
       MR    RWKE,RNNN                                                  46800013
       LA    RLST,0(RWKO,RLSB)                                          47400013
       LR    RWKE,RTE                                                   48000013
       SR    RWKE,RAE                                                   48600013
*                                  FIND SUBJECT ENTRY                   49200013
SCAN2  AR    RLST,RNNN                                                  49800013
       CLC   INDEX(1),2(RLST)                                           50400013
       BE    SAVE2                                                      51000013
       BCT   RWKE,SCAN2                                                 51600013
*                                                                       52200013
       B     EXIT                                                       52800013
*                                  SAVE SUBJECT ENTRY                   53400013
SAVE2  SR    RLST,RNNN                                                  54000013
       EX    RNPC,MOVE1                                                 54600013
*                                                                       55200013
       LR    RMVP,RLST                                                  55800013
       AR    RLST,RNNN                                                  56400013
       AR    RWKE,RAE                                                   57000013
       LCR   RWKE,RWKE                                                  57600013
       AR    RWKE,RTE                                                   58200013
       BZ    SHIFT3                                                     58800013
*                                  MOVE HIGHER SKIP ENTRYS              59400013
SHIFT2 SR    RLST,RNNN                                                  60000013
       SR    RMVP,RNNN                                                  60600013
       EX    RNPC,MOVE2                                                 61200013
       BCT   RWKE,SHIFT2                                                61800013
*                                  MOVE ACTIVE ENTRYS AND TEST INDEX    62400013
SHIFT3 LA    RWKE,1(RAE)                                                63000013
LOOP   SR    RLST,RNNN                                                  63600013
       CLC   INDEX(1),2(RMVP)                                           64200013
       BH    STORE                                                      64800013
       SR    RMVP,RNNN                                                  65400013
       EX    RNPC,MOVE2                                                 66000013
       BCT   RWKE,LOOP                                                  66600013
*                                  STORE SUBJECT ENTRY IN ACTIVE LIST   67200013
STORE  EX    RNPC,MOVE3                                                 67800013
*                                  INCREMENT ACTIVE COUNT               68400013
       AH    RAE,ONE                                                    69000013
*                                                                       69600013
OUT    STC   RAE,1(RLSB)                                                70200013
*                                                                       70800013
EXIT   RETURN (0,10)                                                    71400013
*                                                                       72000013
*                        ERROR RETURNS                                  72600013
*                             IN USE, RETURN 4                          73200013
EXIT4  LA    15,4                                                       73800013
       B     EXIT                                                       74400013
*                             INVALID INDEX, RETURN 8                   75000013
EXIT8  LA    15,8                                                       75600013
       B     EXIT                                                       76200013
*                                                                       76800013
MOVE1  MVC   HOLD(*-*),3(RLST)                                          77400013
*                                                                       78000013
MOVE2  MVC   3(*-*,RLST),3(RMVP)                                        78600013
*                                                                       79200013
MOVE3  MVC   3(*-*,RLST),HOLD                                           79800013
*                                                                       80400013
ONE    DC    H'1'                                                       81000013
*                                                                       81600013
HDR    DC    H'3'                                                       82200013
*                                                                       82800013
HOLD     DS    9X                                                  3131 83400018
*                                                                       84000013
INDEX  DS    C                                                          84600013
*                                                                       85200013
         END                                                            85800013
./  ADD  SSI=32230329,NAME=IECTEDIT
         TITLE 'LOGIC FOR TPEDIT MACRO'                                 00100019
IECTEDIT CSECT                                                          00200019
*********************************************************************** 00300019
* FUNCTION     PROVIDES PROGRAM LOGIC FOR TPEDIT MACRO. EDITS DATA      00400019
*              FROM 50 MDI                                              00500019
*                                                                       00600019
* INPUT        REGISTER 1 CONTAINS A POINTER TO A PARAMETER LIST        00700019
*              PROVIDED BY THE USER                                     00800019
*                                                                       00900019
*              REGISTER 0 CONTAINS A POINTER TO THE EDIT OPTIONS        01000019
*              SPECIFIED IN THE TPEDIT MACRO                            01100019
*                                                                       01200019
*              REGISTER 13 CONTAINS A POINTER TO A 72 BYTE SAVE AREA    01300019
*                                                                       01400019
*              REGISTER 14 CONTAINS THE RETURN ADDRESS                  01500019
*                                                                       01600019
* OUTPUT       REGISTER 1 CONTAINS A POINTER TO A PARAMETER LIST WHICH  01700019
*              CONTAINS THE RECORD ADDRESS AND ADDRESS OF THE RECORD    01800019
*              LENGTH                                                   01900019
*                                                                       02000019
* ENTRY        THE FIRST EXECUTABLE INSTRUCTION                         02100019
*                                                                       02200019
* EXITS        USER ERROR EXIT ROUTINE IF ONE IS SPECIFIED              02300019
*                                                                       02400019
* ATTRIBUTES   REENTRANT                                                02500019
*                                                                       02600019
*********************************************************************** 02700019
         SR    RTCDRG,RTCDRG       ZERO REG 15                          02800019
         STM   RETRNRG,BASERG,12(SAVERG) SAVE USERS REGISTERS           02900019
         BALR  BASERG,0            LOAD BASE REGISTER                   03000019
         USING *,BASERG                                                 03100019
         USING PARMLIST,PRMLSTRG   SET UP AND LOAD                      03200019
         B     A                                                        03250002
         DC    CL8'IECTEDIT'            MODULE IDENTIFIER               03260002
         DC    XL2'3221'                REVISION DATE                   03270002
         DS    CL48                     PATCH AREA                      03280002
A        DS    0F                                                       03290002
         LR    PRMLSTRG,PARMRG1    DSECT REG FOR USER PARM LIST         03300019
         USING EDITPARM,EDTPRMRG   SET UP AND LOAD                      03400019
         LR    EDTPRMRG,PARMRG0    DSECT REG FOR MACRO PARMS            03500019
         USING WORKSTOR,WRKSTRG    SET UP AND LOAD                      03600019
         SR    WRKRG2,WRKRG2       ZERO REG FOR COMPARE                 03700019
         CL    WRKRG2,PRMWRKAD     IS PTR TO WORK AREA ZERO             03800019
         BNE   LOADRG              BR IF NO TO LOAD REG FOR DSECT BASE  03900019
         L     WRKRG2,PRMMXRCL     GET MAX RCD LNG                      04000019
         LA    WRKRG2,96(WRKRG2)   ADD FIXED NO BYTES RQD               04100019
         TM    EDTTYPSW,HEX08      IS USER EXIT SPECIFIED               04200019
         BO    NOEXIT              BR IF NO                             04300019
         LA    WRKRG2,76(WRKRG2)                                        04400019
NOEXIT   TM    EDTTYPSW,HEX40      DOES RECFM = V                       04500019
         BZ    RECFMNTU            BR IF NO                             04600019
         LA    WRKRG2,4(WRKRG2)                                         04700019
RECFMNTU SRL   WRKRG2,3            DIVIDE BY 8                          04800019
         SLL   WRKRG2,3            MULTIPLY BY 8                        04900019
         LR    PARMRG0,WRKRG2      PUT CORE RQMT IN REG 0 FOR GETMAIN   05000019
         GETMAIN R,LV=(0)                                               05100019
         ST    PARMRG1,PRMWRKAD    SAVE PTR TO CORE OBTAINED            05200019
         OI    PRMMXRCL,HEX40      INDICATE GETMAIN ISSUED              05300019
LOADRG   L     WRKSTRG,PRMWRKAD    LOAD DSECT REG FOR WORK STORAGE      05400019
         TM    PRMMXRCL,HEX80      IS THIS THE BEGINING OF CARTRIDGE    05500019
         BO    NOFORMAT            BR IF NO                             05600019
*                                                                       05700019
* * *  FORMAT WORKING STORAGE  * * *                                    05800019
*                                                                       05900019
FORMAT   XC    WRKADRRC(84),WRKADRRC ZERO OUT CONSTANT AREA             06000019
         OI    PRMMXRCL,HEX80      IND NOT BEG OF CARTRIDGE             06100019
         ST    WRKRG2,WRKLNGSV     SAVE LENGTH OF CORE OBTAINED         06200019
         MVI   WRKLEVST,CHAR0      RESET LEVEL STATUS                   06300019
         LA    PARMRG1,WRKSVLZJ+8  GET ADDR OF RCD LNG                  06400019
         ST    PARMRG1,WRKSVLZJ+4  SAVE ADDR OF RCD LNGTH               06500019
         LA    PARMRG1,WRKMACSV    POINT TO END OF RCD LENGTH           06600019
         TM    EDTTYPSW,HEX08      IS USER EXIT SPECIFIED               06700019
         BO    HUITCLOS            BR IF NO                             06800019
         LA    PARMRG1,76(PARMRG1)                                      06900019
HUITCLOS TM    EDTTYPSW,HEX40      DOES RECFM = V                       07000019
         BZ    RECFMU              BR IF NO                             07100019
         LA    PARMRG1,4(PARMRG1)                                       07200019
RECFMU   ST    PARMRG1,WRKNXAVW    SAVE PTR TO NEXT AVAIL WORK          07300019
         AH    PARMRG1,PRMMXRCL+2  POINT TO END OF WORK + 1             07400019
         ST    PARMRG1,WRKENWRK    SAVE PTR TO END OF WORK              07500019
         SH    PARMRG1,PRMMXRCL+2  RESTORE PTR TO BEG OF WORK           07600019
         ST    PARMRG1,WRKADRRC    SAVE PTR TO RCD                      07700019
         OI    WRKEDSW1,HEX0A      EXPECT SOR AND DO NOT ALLOW DUP      07800019
         L     PARMRG1,PRMINPUT    GET PTR TO INPUT                     07900019
         ST    PARMRG1,WRKADNXB    SAVE PTR TO INPUT                    08000019
NOFORMAT TM    WRKEDSW2,HEX08      WAS INPUT EMPTY AFTER LAST REC       08100019
         BO    CKPARRCD            BR IF NO                             08200019
         L     PARMRG1,WRKADNXB    GET PTR TO NEXT BUFFER               08300019
         LTR   PARMRG1,PARMRG1     ANY BUFFERS LEFT                     08400019
         BNZ   GETBUF              BR IF YES                            08500019
         L     PARMRG1,PRMINPUT    GET POINTER TO INPUT                 08600019
         ST    PARMRG1,WRKADNXB    SAVE PTR TO NEXT BUFFER              08700019
GETBUF   OI    WRKEDSW2,HEX08      INDICATE INPUT NOT EMPTY             08800019
         AH    PARMRG1,PRMIPTLN+2  POINT TO INPUT END + 1               08900019
         ST    PARMRG1,WRKENIPT    AND SAVE                             09000019
         SH    PARMRG1,PRMIPTLN+2  RESTORE PTR TO INPUT                 09100019
         TM    EDTTYPSW,HEX10      ARE USING BTAM BUFFERS               09200019
         BZ    NOBUF1              BR IF NO                             09300019
         L     WRKRG2,0(PARMRG1)   PICK UP PTR TO NEXT BUFFER           09400019
         LA    WRKRG2,0(WRKRG2)    ZERO HIGH ORDER BYTE                 09500019
         ST    WRKRG2,WRKADNXB     SAVE PTR TO NEXT AVAIL BUFFER        09600019
         LA    PARMRG1,4(PARMRG1)  INCR PAST CHAIN FIELD                09700019
NOBUF1   BCTR  PARMRG1,0           DECRE INPUT POINTER                  09800019
         ST    PARMRG1,WRKNXAVI    AND SAVE                             09900019
CKPARRCD TM    WRKEDSW2,HEX01      WAS LAST RCD A PARTIAL RCD           10000019
         BO    PTAGN               BR IF YES                            10100019
ZROTYPST MVI   WRKTYPST,HEX00      ZERO TYPE STATUS                     10200019
         SR    WRKRG2,WRKRG2                                            10300019
         STH   WRKRG2,WRKLZFCT     ZERO PREVIOUS COUNT OF LZF           10400019
PTAGN    BAL   LNKRG8,PTINPUT      GO POINT TO NEXT AVAIL IN INPUT      10500019
         NI    WRKEDSW2,HEXFE      RESET POSSIBLE PARTIAL RCD INDICATOR 10600019
         CLI   0(PARMRG1),HEX19    END OF DATA CODE                     10900019
         BE    ENDDATA             BR IF YES                            11000019
         CLI   0(PARMRG1),DLE      IS FIRST CHAR A DLE                  11100019
         BE    PTAGN               BR IF YES TO POINT TO NEXT BYTE      11200019
         CLI   0(PARMRG1),STX      IS FIRST CHAR A STX                  11300019
         BE    PTAGN               BR IF YES                            11400019
         CLI   0(PARMRG1),ETB      IS THIS BSC END CHAR                 11500019
         BE    BSCCHARS            BR IF YES                            11600019
         CLI   0(PARMRG1),HEX03    IS THIS BSC END CHAR                 11700019
         BE    BSCCHARS            BR IF YES                            11800019
         TM    WRKEDSW2,HEX10      IN LEFT ZERO MODE?          @YA02458 11850002
         BO    CMPRLZF             BR IF YES                   @YA02458 11860002
         TM    WRKEDSW1,HEX08 *    IS SOR EXPECTED                      11900019
         BZ    CONTSCAN            BR IF NO TO CONTINUE SCAN            12000019
         NI    WRKEDSW1,HEXF7      RESET EXPECTED SOR SW                12100019
         SR    WRKRG4,WRKRG4                                            12200019
         IC    WRKRG4,0(PARMRG1)   GET CHAR IN SOR LOCATION             12300019
         LA    WRKRG3,HEX78+1                                           12400019
         LA    WRKRG5,HEX71-1      INIT SCAN FOR PROGRAM LEVEL CODES    12500019
SCNPGMLV LA    WRKRG5,1(WRKRG5)                                         12600019
         CLR   WRKRG5,WRKRG4       IS THIS BYTE A PROG LEVEL CODE       12700019
         BE    PGMLVFND            BR IS YES                            12800019
         CLR   WRKRG5,WRKRG3       HAS SCAN EXCEEDER RANGE OF PL CODES  12900019
         BL    SCNPGMLV            BR IF NO TO CONT SCAN                13000019
         CLI   0(PARMRG1),HEXCAN   IS THIS A CANCEL CODE                13100019
         BE    CANFND              BR IF YES                            13200019
         CLI   0(PARMRG1),HEXGS    IS THIS A GS CODE                    13300019
         BE    GSFND               BR IF YES                            13400019
         OI    WRKTYPST,HEX01      INDICATE SOR/EOR ERROR IN TYPE STAT  13500019
         MVI   WRKSORSV,HEX0E      SET SOR ERROR IN ERROR DESCRIPTION   13600019
         B     CKKPSOR1                                                 13700019
CANFND   OI    WRKEDSW1,HEX82      SET ON DELET SW AND DO NOT ALLOW DUP 13800019
         MVI   WRKLEVST,HEXF0      RESET LEVEL STATUS                   13900019
         B     PTAGN               BR TO CONT SCAN                      14000019
GSFND    OI    WRKEDSW1,HEX08      SET EXPECT SOR SWITCH ON             14100019
         B     PTAGN                                                    14200019
CONTSCAN L     WRKRG3,WRKENIPT     GET INPUT END + 1                    14300019
         SR    WRKRG3,PARMRG1      GET LNG OF BUFFER REMAINING          14400019
         LTR   WRKRG3,WRKRG3       IS INPUT EMPTY                       14500019
         BP    L256CK              BR IF NO                             14600019
         BCTR  PARMRG1,0           DECR PTR TO NXT AVAIL IN IPT         14700019
         B     NOCDS1                                                   14800019
L256CK   C     WRKRG3,LGT256       ARE THERE MORE THAN 256 BYTES LEFT   14900019
         BNH   DECRRG              BR IF NO                             15000019
         L     WRKRG3,LGT256       SET LENGTH TO 256                    15100019
DECRRG   BCTR  WRKRG3,0            DECR LENGTH                          15200019
         LR    WRKRG5,PARMRG1      ADDR OF FIRST BYTE TO BE SCANNED     15300019
         AR    WRKRG5,WRKRG3       PLUS SCAN LNG - 1                    15400019
         ST    WRKRG5,WRKNXAVI     GIVES INPUT PTR IF NO SPECIAL CODES  15500019
         ST    WRKRG5,WRKENSCN     STORE AS END OF SCANNED              15600019
         SR    WRKRG2,WRKRG2       PREPARE FOR TRT                      15700019
         EX    WRKRG3,TRTTBL       TRANSLATE AND TEST                   15800019
         BC    8,NOSPECCD          BR IF NO SPECIAL CODES FOUND         15900019
         ST    PARMRG1,WRKNXAVI    SAVE LAST SCANNED AS INPUT PTR       16000019
         TM    WRKEDSW1,HEX80      IS THIS RECORD BEING DELETED         16100019
         BZ    BRTBL               BR IS NO                             16200019
         CH    WRKRG2,TWOOH        IS THIS END OF DELETED RECORD        16300019
         BL    PTAGN                                                    16400019
BRTBL    B     BRNCHTBL-4(WRKRG2)  BR TO BR TABLE TO HANDLE NONZERO     16500019
NOSPECCD L     PARMRG1,WRKENSCN    GET END OF SCANNED                   16600019
         L     WRKRG6,WRKENIPT     IS END OF SCANNED NOW                16700019
         BCTR  WRKRG6,0            POINTING AT LAST                     16800019
         CR    WRKRG6,PARMRG1      BYTE IN THIS BUFFER                  16900019
         BNE   CKCANRCD            BR IF NO                             17000019
NOCDS1   OI    WRKEDSW2,HEX01      IND PARTIAL RCD                      17100019
         NI    WRKEDSW2,HEXF7      INDICATE IPT EMPTY                   17200019
         TM    WRKEDSW1,HEX80      IS  RCD BEING DELETED                17300019
         BZ    SETRTURN            BR IF NO                             17400019
         TM    EDTTYPSW,HEX10      ARE USING BTAM BUFFERS               17500019
         BZ    DELETRCD            BR IF NO                             17600019
         L     PARMRG1,WRKADNXB    GET PTR TO NEXT BUFFER               17700019
         LTR   PARMRG1,PARMRG1     ARE ANY BUFFERS LEFT                 17800019
         BNZ   GETBUF              BR IF YES TO POINT TO NEXT BUFFE    17900019
DELETRCD MVI   19(SAVERG),HEX08    IND IPT EMPTY RCD NOT AVAIL          18000019
         B     RETURNX                                                  18100019
CKCANRCD TM    WRKEDSW1,HEX80      IS RECORD BEING DELETED              18200019
         BO    PTAGN               BR IF YES                            18300019
         B     SETRTURN            GO MOVE IT OUT                       18400019
*                                                                       18500019
* * *  BRANCH TABLE * * *                                               18600019
*                                                                       18700019
TRTTBL   TRT   0(0,PARMRG1),TRNSTBLE                                    18800019
BRNCHTBL B     LEFTZROF *          LEFT ZERO FILL                       18900019
         B     DUP      *          DUP                                  19000019
         B     LFTZROST *          LEFT ZERO START                      19100019
         B     CANCEL   *          CANCEL                               19200019
         B     PTAGN    *          GROUP SEPARATOR CODES                19300019
         B     BSCCHARS *          BCS CHARS                            19400019
         B     DATACK   *          DATA CHECK -2772 REPLACE CHARACTER   19500019
         B     ENDDATA             END OF DATA ON CARTRIDGE             19600019
         B     RMORVOK  *          RECORD MARK OR VERIFY OK             19700019
         B     PGMLEVEL *          PROGRAM LEVEL 1-8                    19800019
*                                                                       19900019
* * * END OF BRANCH TABLE * * *                                         20000019
*                                                                       20100019
* *  HANDLE LEFT ZERO FILL CODES                                        20200019
LEFTZROF TM    WRKEDSW1,HEX40      HAS A LEFT ZERO START BEEN FOUND     20300019
         BZ    NOLZSFND            BR IF NO                             20400019
LZFCNT   LH    WRKRG2,WRKLZFCT     PICK UP COUNT OF LA FIL CHARS        20500019
         LA    WRKRG2,1(WRKRG2)    INCR COUNT OF LZF                    20600019
         STH   WRKRG2,WRKLZFCT     AND SAVE                             20700019
         MVC   0(1,PARMRG1),EDTREPCR  MOVE IN REP CHAR IN CASE FLD      20800019
         OI    WRKEDSW2,HEX10      INDICATE LZF FOUND                   20900019
*                                     REMAINS UNJUSTIFIED               21000019
         BAL   LNKRG8,MOVERTN      GO MOVE IT OUT                       21100019
         BAL   LNKRG8,PTINPUT      GO POINT TO NEXT BYTE                21200019
         TM    WRKEDSW2,HEX08      IS INPUT EMPTY                       21300019
         BZ    RETURNX             BR IF YES                            21400019
         CLI   0(PARMRG1),ETB      IS THIS BSC END CHAR                 21500019
         BE    BSCCHARS            BR IF YES                            21600019
         CLI   0(PARMRG1),HEX03    IS THIS BSC END CHAR                 21700019
         BE    BSCCHARS            BR IF YES                            21800019
CMPRLZF  CLI   0(PARMRG1),HEXLZF   IS THIS ALSO A LEFT ZERO FILL        21900019
         BE    LZFCNT              BR IF YES TO CONT SCAN FOR LZF       22000019
         OI    WRKEDSW1,HEX20      INDICATE END OF LZ FIELD             22100019
         NI    WRKEDSW2,HEXEF      RESET LZ MODE SW                     22200019
         BCTR  PARMRG1,0           DECR INPUT POINTER                   22300019
         ST    PARMRG1,WRKNXAVI    STORE INPUT POINTER                  22400019
         B     SETRTURN            GO SET UP FOR ADJUST                 22500019
NOLZSFND MVC   0(1,PARMRG1),EDTREPCR REPLACE FIELD ERROR BYTE           22600019
         OI    WRKTYPST,HEX04      INDICATE FIELD ERROR IN TYPE STATUS  22700019
         B     SETRTURN            GO MOVE IT OUT                       22800019
         SPACE 1                                                        22900019
* * HANDLE DUP CODES                                                    23000019
DUP      NI    WRKEDSW1,HEX9F      RESET POSSIBLE LEFT ZERO             23100019
         BCTR  PARMRG1,0           DECR INPUT POINTER                   23200019
         ST    PARMRG1,WRKNXAVI    STORE PREV ADDR AS INPUT POINTER     23300019
         BAL   LNKRG8,MOVERTN      GO MOVE OUT ALL UP TO DUP            23400019
         BAL   LNKRG8,PTINPUT      POINT TO DUP AGAIN                   23500019
         OI    WRKEDSW1,HEX01      INDICATE DUP FOUND IN THIS RECORD    23600019
         TM    WRKEDSW1,HEX02      IS DUP ALLOWED                       23700019
         BO    NOLZSFND            BR IF NO                             23800019
         L     WRKRG5,WRKNXAVW     GET NEXT AVAIL IN WORK               23900019
         L     WRKRG6,WRKLDBPV     GET PTR TO LAST DATA BYTE PREV RCD   24000019
         TM    EDTTYPSW,HEX80      ARE TO KEEP SOR/EOR CHARS            24100019
         BZ    CMPR8               BR IF NO                             24200019
         BCTR  WRKRG6,0            DECR PTR TO LAST DATA BYTE PREV RCD  24300019
CMPR8    CR    WRKRG5,WRKRG6       IS DUP BEYOND END OF PREV RCD        24400019
         BH    NOLZSFND            BR IF YES TO INDICATE FIELD ERROR    24500019
         CLC   0(WRKRG5),EDTREPCR  IS BYTE TO BE DUPED A REPLACE CHAR   24600019
         BE    NOLZSFND            BR IS YES                            24700019
         MVC   0(1,PARMRG1),0(WRKRG5) PERFORM DUPLICATION               24800019
         B     SETRTURN            GO MOVE IT OUT                       24900019
         SPACE 1                                                        25000019
* *  HANDLE LEFT ZERO START CODES                                       25100019
LFTZROST BCTR  PARMRG1,0           DO NOT MOVE LEFT ZERO START          25200019
         BAL   LNKRG8,MOVERTN      MOVE OUT ALL UP TO LEFT ZERO START   25300019
         OI    WRKEDSW1,HEX40      INDICATE LZ START                    25400019
         MVC   WRKFBLZF,WRKNXAVW   SAVE ADDR OF START OF LZ FIELD       25500019
         B     PTAGN                                                    25600019
         SPACE 1                                                        25700019
* *  HANDLE VERIFY OK OR RECORD MARK                                    25800019
RMORVOK  NI    WRKEDSW1,HEX9F      RESET POSSIBLE LZ MODE               25900019
         OI    WRKEDSW1,HEX08      SET EXPECT SOR SWITCH ON             26000019
         TM    WRKEDSW1,HEX80      IS THIS RECORD BEING DELETED         26100019
         BO    RECDEL              BR IF YES                            26200019
         MVI   WRKEORSV,CVOK       SET VOK IND IN ERROR DESCRIPTION     26300019
         CLI   0(PARMRG1),HEXVOK   WAS EOR AN IRS(VOK) CODE             26400019
         BE    VOK                 BR IF YES                            26500019
         MVI   WRKEORSV,CRM        SAVE RM INDICATOR IN EDW             26600019
         TM    EDTTYPSW,HEX20      MUST EOR BE VOK                      26700019
         BZ    VOK                 BR IF NO                             26800019
         OI    WRKTYPST,HEX01      INDICATE SOR/EOR ERROR IN EDW        26900019
VOK      TM    EDTTYPSW,HEX80      IS EOR TO BE RETAINED                27000019
         BO    EORRTAIN            BR IF YES                            27100019
         BCTR  PARMRG1,0           DECR INPUT PTR SO EOR NOT MOVED OUT  27200019
EORRTAIN B     SETRTURN            GO MOVE IT OUT                       27300019
RECDEL   NI    WRKEDSW1,HEX7F      SET OFF DELETE SWITCH                27400019
         B     PTAGN               GO CONT SCAN                         27500019
         SPACE 1                                                        27600019
* *  HANDLE PROGRAM LEVEL CODES                                         27700019
PGMLEVEL TM    WRKEDSW1,HEX80      IS THIS RECORD BEING DELETED         27800019
         BZ    CANCEL              BR IF NO TO FORCE END OF PREV RCD    27900019
         NI    WRKEDSW1,HEX7F      SET OFF DELETE SW                    28000019
PGMLVFND MVC   WRKSORSV(1),0(PARMRG1) SAVE IT AS SOR IN EDW             28100019
         NI    WRKSORSV,HEX0F      PUT IN FORM OF HEX 0X                28200019
CKKPSOR1 TM    EDTTYPSW,HEX80      SOR TO BE RETAINED                   28300019
         BZ    PTAGN               BR IF NO TO CONT SCAN                28400019
         ST    PARMRG1,WRKFBSCN    SAVE AS START                        28500019
         B     SETRTURN            GO MOVE IT OUT                       28600019
CANCEL   OI    WRKEDSW1,HEX08      SET EXPECT SOR SW ON                 28700019
         NI    WRKEDSW1,HEX9F      RESET POSSIBLE LZ MODE               28800019
         OI    WRKTYPST,HEX01      INDICATE SOR/EOR ERROR               28900019
         MVI   WRKEORSV,CHE        IND EOR ERROR IN EDW                 29000019
         BCTR  PARMRG1,0           DECR INPUT POINTER                   29100019
         ST    PARMRG1,WRKNXAVI    STORE INPUT POINTER                  29200019
         TM    EDTTYPSW,HEX80      EOR TO BE RETAINED                   29300019
         BO    NOEOR               BR IF YES                            29400019
         BCTR  PARMRG1,0           DECR INPUT PTR SO EOR NOT MOVED      29500019
NOEOR    OI    WRKEDSW1,HEX04      INDICATE EOR FORCED                  29600019
         B     SETRTURN            GO MOVE IT OUT                       29700019
         SPACE 1                                                        29800019
* *  HANDLE DATA CHECK  - 2772 REPLACE CHARS X'3F'                      29900019
DATACK   MVC   0(1,PARMRG1),EDTREPCR REPLACE DATA CK IND WITH REP CHAR  30000019
         OI    WRKTYPST,HEX08      IND DATA CHECK IN TYPE STATUS        30100019
         BAL   LNKRG8,MOVERTN      GO MOVE IT OUT                       30200019
         BAL   LNKRG8,PTINPUT      POINT TO NEXT BYTES                  30300019
         CLI   0(PARMRG1),HEX3F    IS THIS DATA CK BYTE ALSO            30400019
         BO    DBLDC               BR IF YES                            30500019
         BCTR  PARMRG1,0           DECR INPUT POINTER                   30600019
         ST    PARMRG1,WRKNXAVI    STORE INPUT POINTER                  30700019
         B     PTAGN                                                    30800019
DBLDC    MVC   0(1,PARMRG1),EDTREPCR REPLACE DATA CK IND WITH REP CHAR  30900019
         OI    WRKEDSW2,HEX02      INDICATE DOUBLE DATA CK              31000019
         B     SETRTURN            GO MOVE IT OUT                       31100019
         SPACE 1                                                        31200019
* *  HANDLE BSC CHARACTERS                                              31300019
BSCCHARS OI    WRKEDSW2,HEX04      INDICATE BSC END CHAR FOUND          31400019
         BCTR  PARMRG1,0           DECR PTR TO IPT                      31500019
         TM    WRKEDSW1,HEX08      IS SOR EXPECTED                      31600019
         BZ    NOCDS1                                                   31700019
         NI    WRKEDSW2,HEXF7      IND IPT EMPTY                        31800019
         MVI   19(SAVERG),HEX08    IND IPT EMPTY RCD NOT AVAIL          31900019
         B     RETURN                                                   32000019
         SPACE 1                                                        32100019
* * HANDLE END OF DATA CODE                                             32200019
ENDDATA  TM    WRKEDSW1,HEX08      IS SOR EXPECTED                      32300019
         BZ    CANCEL              BR IF NO TO FORCE END OF PREV RCD    32400019
         MVI   19(SAVERG),HEX0C    IND LAST RCD                         32500019
         NI    PRMMXRCL,HEX7F      IND BEG OF CARTRIDGE                 32600019
         TM    PRMMXRCL,HEX40      WAS GETMAIN ISSUED                   32700019
         BZ    RETRNZ              BR IF NO                             32800019
         L     PARMRG1,PRMWRKAD    GET PTR TO CORE OBTAINED VIA GETMAIN 32900019
         L     PARMRG0,WRKLNGSV    GET LNG OF CORE OBTAINED             33000019
         SR    WRKRG2,WRKRG2                                            33100019
         ST    WRKRG2,PRMWRKAD     ZERO PTR TO WORK STORAGE             33200019
         FREEMAIN R,LV=(0),A=(1)                                        33300019
RETRNZ   NI    PRMMXRCL,HEXBF      RESET GETMAIN SW                     33400019
         B     RETURNX             RETURN TO USER                       33500019
SETRTURN LA    LNKRG8,PTAGN        SET RETURN ADDR FROM MOVE RTN        33600019
*                                                                       33700019
* * *  MOVE ROUTINE  * * *                                              33800019
*                                                                       33900019
MOVERTN  L     WRKRG5,WRKNXAVW     GET ADDR OF NEXT AVAIL IN WORK       34000019
         L     WRKRG7,WRKFBSCN     GET ADDR OF FIRST BYTE SCANNED       34100019
         LR    WRKRG4,PARMRG1      ADDR OF LAST BYTE SCANNED            34200019
         LA    WRKRG4,1(WRKRG4)    GET END OF SCANNED +1                34300019
         SR    WRKRG4,WRKRG7       CALC LENGTH OF SCANNED               34400019
         BNP   NOBYTES             BR IF NO BYTES TO BE MOVED           34500019
         L     WRKRG6,WRKENWRK     GET END OF WORK AREA + 1             34600019
         SR    WRKRG6,WRKRG5       CALC NO BYTES AVAIL IN WORK AREA     34700019
         CR    WRKRG4,WRKRG6       WILL ALL SCANNED BYTES FIT IN WORK   34800019
         BNH   MVSCN               BR IF YES TO MOVE SCANNED            34900019
         OI    WRKEDSW1,HEX10      INDICATE NOT ALL FIT                 35000019
         NI    WRKEDSW2,HEXFE      RESET POSSIBLE PARTIAL RCD IND       35100019
         LTR   WRKRG4,WRKRG6       WILL ANY BYTES FIT                   35200019
         BNP   RCDTOOLG            BR IF NO                             35300019
MVSCN    BCTR  WRKRG4,0            DECR LNG FOR EXECUTE                 35400019
         EX    WRKRG4,MOVESCND     MOVE SCANNED FROM INPUT TO WORK AREA 35500019
         LA    WRKRG4,1(WRKRG4)    RESTORE LNG                          35600019
         AR    WRKRG7,WRKRG4       CALC ADDR OF FIRST BYTE NOT MOVED    35700019
         ST    WRKRG7,WRKFBSCN     FROM INPUT TO WORK AREA              35800019
         TM    EDTTYPSW,HEX80      ARE TO KEEP SOR/EOR CHARS            35900019
         BZ    DONOTKP             BR IF NO                             36000019
         BCTR  WRKRG7,0            DECR POINTER TO NXT AV IPT           36100019
DONOTKP  AR    WRKRG5,WRKRG4       CALC NEXT AVAIL WORK                 36200019
         ST    WRKRG5,WRKNXAVW     SAVE ADDR OF NEXT AVAIL WORK         36300019
         TM    WRKEDSW1,HEX10      DID ALL SCANNED FIT                  36400019
         BO    RCDTOOLG            BR IF NO                             36500019
NOFCREOR TM    WRKEDSW1,HEX08      WAS END OF RECORD FOUND              36600019
         BO    ENDRCFND            BR IF YES                            36700019
         TM    WRKEDSW2,HEX01      IS THIS A PARTIAL RCD                36800019
         BO    ENDRCFND            BR IF YES                            36900019
         TM    WRKEDSW1,HEX20      WAS END OF LZ FIELD FOUND            37000019
         BCR   8,LNKRG8            BR IF NO TO CALLING RTN              37100019
         SPACE 1                                                        37200019
* * LEFT ZERO JUSTIFICATION                                             37300019
LZJSTRTN NI    WRKEDSW1,HEX9F      SET OFF LZ MODE                      37400019
         L     WRKRG4,WRKFBLZF     GET ADDR OF START OF LZ FIELD        37500019
         LH    WRKRG3,WRKLZFCT     GET COUNT OF LZ FILLS                37600019
         SR    WRKRG5,WRKRG4       CALC FIELD LNG                       37700019
         CH    WRKRG5,HLF15        DOES FIELD LNG EXCEED 15             37800019
         BNH   ADJUST              BR IF NO TO ADJUST                   37900019
         OI    WRKTYPST,HEX04      INDICATE FIELD ERROR                 38000019
         BR    LNKRG8              RETURN TO CALLING RTN                38100019
ADJUST   SR    WRKRG5,WRKRG3       GET NO OF SIGNIFICANT DIGITS         38200019
         BCTR  WRKRG5,0            DECR LNG FOR EXECUTE                 38300019
         LR    WRKRG6,WRKRG4       ADDR OF START OF LZ FIELD IN WORK    38400019
         AR    WRKRG6,WRKRG3       FIELD START + LZ FILL COUNT          38500019
         EX    WRKRG5,MVSIGDGT     MOVE SIGNIFICANT DIGITS TO HOLD AREA 38600019
         EX    WRKRG5,MVDGTWRK     MOVE SIGNIFICANT DIGITS TO RIGHT     38700019
MVZROFIL MVI   0(WRKRG4),HEXF0     MOVE ZERO FILL                       38800019
         LA    WRKRG4,1(WRKRG4)    INCR WORK ADDR                       38900019
         BCT   WRKRG3,MVZROFIL     BR IF NOT ALL FILLED                 39000019
         STH   WRKRG3,WRKLZFCT     ZERO COUNT FIELD                     39100019
         BR    LNKRG8              RETURN TO CALLING ROUTINE            39200019
MVSIGDGT MVC   WRKSVLZJ(0),0(WRKRG4) USED BY EXECUTE TO                 39300019
MVDGTWRK MVC   0(0,WRKRG6),WRKSVLZJ  RIGHT JUSTIFY FIELD                39400019
         SPACE 1                                                        39500019
* *  THIS ROUTINE IS ENTERED FOR RECORDS WHICH EXCEED USER SPECIFIED *  39600019
* *      RECORD  LENGTH                                                 39700019
RCDTOOLG OI    WRKTYPST,HEX03      INDICATE SOR/EOR AND LENGTH ERROR    39800019
         MVI   WRKEORSV,CHE        SET EOR ERROR IN ERROR DESCRIPTION   39900019
         OI    WRKEDSW1,HEX08      SET EXPECT SOR SW ON                 40000019
         OI    WRKEDSW2,HEX08      IND IPT NOT EMPTY                    40100019
         ST    WRKRG7,WRKNXAVI     SAVE ADDR AS INPUT POINTER           40200019
         TM    WRKEDSW1,HEX40      IN LZ MODE                           40300019
         BZ    ENDRCFND            BR IF NO                             40400019
         SR    PARMRG0,PARMRG0     ZERO REG FOR COMPARE                 40500019
         CH    PARMRG0,WRKLZFCT    ANY LZ FILLS FOUND                   40600019
         BE    ENDRCFND            BR IF NO                             40700019
         ST    PARMRG0,WRKLZFCT    SET CNT FIELD TO ZERO                40800019
         BCTR  WRKRG5,0            POINT TO LAST BYTE MOVED TO WORKAREA 40900019
         CLC   0(1,WRKRG5),EDTREPCR WAS LAST MOVED A FILL CHAR          41000019
         BNE   CKKPSOR             BR IF NO                             41100019
         OI    WRKTYPST,HEX04      INDICATE A FIELD ERROR IN TYPE STAT  41200019
CKKPSOR  TM    EDTTYPSW,HEX80      RETAIN SOR/EOR BYTES SPECIFIED       41300019
         BZ    SETUP               BR IF NO                             41400019
         BCTR  WRKRG5,0            POINT TO LAST MOVED TO WORK          41500019
         B     SETUP               GO SET UP TO OUTPUT RCD              41600019
NOBYTES  TM    EDTTYPSW,HEX80      PRE TO KEEP SOR/EOR CHARS            41700019
         BO    NOFCREOR            BR IF YES                            41800019
         TM    WRKEDSW1,HEX04      WAS EOR FORCED                       41900019
         BZ    NOFCREOR            BR IF NO                             42000019
         BCTR  WRKRG5,0            DECR ADDR NEXT WORK SO BAD           42100019
         ST    WRKRG5,WRKNXAVW     EOR NOT RETAINED AS PART OF RCD      42200019
ENDRCFND BCTR  WRKRG5,0            POINT TO LAST MOVED TO WORK          42300019
SETUP    L     PARMRG1,WRKNXAVI    GET POINTER TO INPUT                 42400019
         LA    PARMRG1,1(PARMRG1)  POINT NEXT AVAIL BYTE                42500019
BALROUT  BAL   LNKRG8,CKINPUT      GO SET STATUS OF INPUT               42600019
         TM    WRKEDSW2,HEX08      IS INPUT EMPTY                       42700019
         BZ    IPTNTEPT            BR IF NO                             42800019
         BCTR  PARMRG1,0           DECR POINTER TO INPUT                42900019
         ST    PARMRG1,WRKNXAVI    SAVE AS NEXT AVAIL IN INPUT          43000019
IPTNTEPT TM    WRKEDSW2,HEX01      IS THIS PARTIAL RCD                  43100019
         BO    RETURN              BR IF YES                            43200019
         L     PARMRG0,WRKADRRC    GET ADDR OF RCD                      43300019
         L     PARMRG1,WRKNXAVW    GET PTR TO NEXT AVAIL IN WORK        43400019
         ST    PARMRG0,WRKNXAVW    REINIT PTR TO NEXT AVAIL WORK        43500019
         SR    PARMRG1,PARMRG0     CAL LENGTH OF RCD                    43600019
         TM    EDTTYPSW,HEX80      ARE SOR/EOR CHARS TO BE RETAINED     43700019
         BO    CKLNFR3             BR IF YES                            43800019
         LTR   PARMRG1,PARMRG1     IS RCD LENGTH AT LEAST ONE           43900019
         BZ    CKPARRCD            BR IF NO                             44000019
         BP    SVLSTBYT            BR IF YES TO PASS IT                 44100019
DONTPASS OI    WRKEDSW1,HEX02      RESET EDT SW AND DO NOT ALLOW DUP    44200019
         NI    WRKEDSW1,HEX0A      RESET EDIT SW                        44300019
         NI    WRKEDSW2,HEX88                                           44400019
         MVI   WRKLEVST,CHAR0      RESET LEVEL STATUS                   44500019
         B     ZROTYPST            GO ZERO TYPE STATUS                  44600019
CKLNFR3  CH    PARMRG1,THREE       IS RCD LENGTH AT LEAST 3             44700019
         BL    DONTPASS            BR IF NO                             44800019
SVLSTBYT ST    WRKRG5,WRKLDBPV     SAVE LAST DATA BYTE IN RCD           44900019
         ST    PARMRG1,WRKSVLZJ+8  SAVE LNG OF RCD                      45000019
*                                                                       45100019
* * *  OUTPUT ROUTINE  * * *                                            45200019
OUTPUT   TM    WRKEDSW2,HEX01      IS THIS PARTIAL RCD                  45300019
         BO    RETURN              BR IF YES                            45400019
         CLI   WRKSORSV,HEX0E      WAS SOR IN ERROR                     45500019
         BO    WRNGLN              BR IF YES                            45600019
         SR    WRKRG4,WRKRG4       SET TO ZERO FOR COMPARE              45700019
         SR    WRKRG5,WRKRG5       SET TO ZERO FOR CALC                 45800019
         IC    WRKRG5,WRKSORSV     GET SOR CHAR                         45900019
         AR    WRKRG5,WRKRG5       DOUBLE IT TO INDEX TABL              46000019
         CH    WRKRG4,WRKSVPGL-2(WRKRG5) HAS LENGTH BEEN SAVED          46100019
         BNE   CKLNGPL             BE IF YES                            46200019
         TM    WRKTYPST,HEX0F      DOES RCD HAVE INDENTIFIABLE ERROR    46300019
         BNZ   IDENTER             BR IF YES                            46400019
         STH   PARMRG1,WRKSVPGL-2(WRKRG5) SAVE LNG FOR THIS LEVEL       46500019
         BO    IDENTER             BYPASS LNG CHECK                     46600019
CKLNGPL  CH    PARMRG1,WRKSVPGL-2(WRKRG5) CK LNG WITH SAVED LNG         46700019
         BE    IDENTER             BR IF LNG OK                         46800019
         OI    WRKTYPST,HEX02      INDICATE WRONG LNG RCD               46900019
IDENTER  TM    WRKTYPST,HEX02      WAS IT A WRONG LNG RCD               47000019
         BO    WRNGLN              BR IF YES                            47100019
         TM    WRKEDSW2,HEX02      WAS DOUBLE DATA CHECK FOUND          47200019
         BO    WRNGLN              BR IF YES                            47300019
         CLI   WRKLEVST,CHAR0      IS LEVEL STATUS ZERO                 47400019
         BE    RESETSW             BR IF YES                            47500019
         TM    WRKEDSW1,HEX01      WAS DUP ENCOUNTERED                  47600019
         BO    MKLEVST2            BR IF YES                            47700019
         MVI   WRKLEVST,CHAR0      RESET LEVEL STATUS                   47800019
         B     RESETSW             GO RESET EDIT SWITCHES               47900019
WRNGLN   CLI   WRKLEVST,CHAR0      IS LEVEL STATUS ZERO                 48000019
         BNE   MKLEVST2            BR IF NO                             48100019
         MVI   WRKLEVST,CHAR1      MAKE IT 1                            48200019
         B     RESETSW             GO RESET EDIT SWITCHES               48300019
MKLEVST2 MVI   WRKLEVST,CHAR2      MAKE IT 2                            48400019
RESETSW  NI    WRKEDSW1,HEX08      RESET EDIT SWITCHES                  48500019
         NI    WRKEDSW2,HEX88                                           48600019
         CH    PARMRG1,EDTMINLN    CHECK MINIMUM LENGTH                 48700019
         BNL   MINLNOK             BR IF NOT SHORT                      48800019
         OI    WRKTYPST,HEX02      INDICATE LENGTH ERROR                48900019
MINLNOK  TR    WRKTYPST(2),TREDW   MAKE TYPE AND LEVEL STATUS PRNTABLE  49000019
RETURN1  LR    WRKRG3,PARMRG0      PTR TO RCD                           49100019
         LA    PARMRG0,HEX04       SET UP REG FOR SUB                   49200019
         TM    EDTTYPSW,HEX08      USER ERROR EXIT SPECIFIED            49300019
         BO    CKVFRMT1            BR IF NO                             49400019
         CLC   WRKSVEDW(2),CHAR00  IS THIS AN ERROR RECORD              49500019
         BE    CKVFRMT1            BR IF NO                             49600019
         SR    WRKRG3,PARMRG0      DECR PTR TO RCD                      49700019
         MVC   0(4,WRKRG3),WRKSVEDW APPEND EDW TO BEG OF RCD            49800019
         LA    PARMRG1,4(PARMRG1)  INCR LENGTH OF RCD TO INCLUDE EDW    49900019
CKVFRMT1 TM    EDTTYPSW,HEX40      DOES RECFM=V                         50000019
         BZ    RECFMU1             BR IF NO                             50100019
         LA    PARMRG1,4(PARMRG1)  INCR RCD LENGTH TO INCLUDE V-FIELD   50200019
         SR    WRKRG3,PARMRG0      DECR PTR TO RCD                      50300019
         STH   PARMRG1,0(WRKRG3)   SAVE LENGTH IN V-FIELD               50400019
         XC    2(2,WRKRG3),2(WRKRG3) SET SECOND HALF TO ZERO            50500019
RECFMU1  ST    PARMRG1,WRKSVLZJ+8  SAVE RECORD LENGTH                   50600019
         ST    WRKRG3,WRKSVLZJ     SAVE RECORD ADDR                     50700019
         LA    WRKRG3,WRKSVLZJ+8                                        50800019
         ST    WRKRG3,WRKSVLZJ+4                                        50900019
         TM    EDTTYPSW,HEX08      IS USER ERROR EXIT SPEC              51000019
         BO    RETURN              BR IF NO                             51100019
         CLC   WRKSVEDW(2),CHAR00  IS THIS AN ERROR RECORD              51200019
         BE    RETURN              BR IF NO                             51300019
         LR    WRKRG2,SAVERG       SAVE PTR TO USER SAVE AREA           51400019
         LA    SAVERG,WRKMACSV     POINT TO SAVE AREA                   51500019
         L     RTCDRG,EDTUSRXT     GET ADDR OF USER EXIT RTN            51600019
         LA    PARMRG1,WRKSVLZJ    POINT TO PARM LIST                   51700019
         BALR  RETRNRG,RTCDRG      GO TO USER EXIT ROUTINE              51800019
         LR    SAVERG,WRKRG2       RESTORE PTR SAVE AREA                51900019
         L     PARMRG1,WRKSVLZJ+8  GET RCD LNG                          52000019
         LA    PARMRG0,HEX04       SET UP RG FOR SUB                    52100019
         SR    PARMRG1,PARMRG0     DECR RCD LNG                         52200019
         ST    PARMRG1,WRKSVLZJ+8  SAVE RCD LNG                         52300019
         L     WRKRG3,WRKSVLZJ                                    M4292 52400019
         LA    WRKRG3,4(WRKRG3)    INCR RCD ADDR                        52500019
         TM    EDTTYPSW,HEX40      RECFM=V                              52600019
         BZ    NORCFM3             BR IF NO                             52700019
         MVC   0(4,WRKRG3),0(WRKRG7) MOVE V FIELD                       52800019
         STH   PARMRG1,0(WRKRG3)   SAVE RCD LNG IN V-FIELD              52900019
NORCFM3  ST    WRKRG3,WRKSVLZJ     SAVE RCD ADDR IN PARM LIST           53000019
         LTR   RTCDRG,RTCDRG       ARE TO PASS RCD                      53100019
         BNZ   NOFORMAT            BYPASS RCD                           53200019
RETURN   LA    WRKRG3,WRKSVLZJ     POINT TO PARMLIST                    53300019
         ST    WRKRG3,24(SAVERG)   AND SAVE                             53400019
RETURNX  LM    RETRNRG,BASERG,12(SAVERG) RESTORE USERS REGS             53500019
         BR    RETRNRG                                                  53600019
PTINPUT  L     PARMRG1,WRKNXAVI    POINT TO                             53700019
         LA    PARMRG1,1(PARMRG1)  NEXT BYTE                            53800019
         ST    PARMRG1,WRKNXAVI    IN INPUT                             53900019
SVSCBST  ST    PARMRG1,WRKFBSCN    SAVE SCAN START ADDR                 54000019
CKINPUT  C     PARMRG1,WRKENIPT    ANY BYTES LEFT IN INPUT              54100019
         BNL   IPTBSC              BR IF NO                             54200019
         TM    WRKEDSW2,HEX04      WAS BSC END CHAR FOUND               54300019
         BO    IPTBSC              BR IF YES                            54400019
         OI    WRKEDSW2,HEX08           INPUT NOT EMPTY          A35755 54450020
         MVI   19(SAVERG),HEX04    INDICATE INPUT NOT EMPTY RCD AVAIL   54500019
         BR    LNKRG8              RETURN TO CALLING ROUTINE            54600019
IPTBSC   NI    WRKEDSW2,HEXFB      RESET BSC END CHAR FOUND SW          54700019
         TM    WRKEDSW1,HEX08      SOR EXPECTED                         54800019
         BO    CKBTAMBF                                                 54900019
         OI    WRKEDSW2,HEX01      IND PARTIAL RCD                      55000019
CKBTAMBF TM    EDTTYPSW,HEX10      ARE USING BTAM BUFFERS               55100019
         BZ    NOBUF2              BR IF NO                             55200019
         L     PARMRG1,WRKADNXB    GET PTR TO NEXT BUFFER IN CHAIN      55300019
         LTR   PARMRG1,PARMRG1     ARE ANY MORE BUFFERS IN CHAIN        55400019
         BZ    NOBUF2              BR IF NO                             55500019
         NI    WRKEDSW2,HEXF7      IND BUFFER EMPTY                     55600019
         TM    WRKEDSW2,HEX01      IS THIS A PARTIAL RCD                55700019
         BO    GETBUF              BR IF YES                            55800019
         MVI   19(SAVERG),HEX04    IND IPT NOT EMPTY RCD NOT AVAIL      55900019
         BR    LNKRG8              RETURN TO CALLING RTN                56000019
NOBUF2   NI    WRKEDSW2,HEXF7      INDICATE INPUT EMPTY                 56100019
         MVI   19(SAVERG),HEX00    IND IPT EMPTY RCD AVAIL              56200019
         TM    WRKEDSW1,HEX08      SOR EXPECTED                         56300019
         BCR   1,LNKRG8                                                 56400019
         MVI   19(SAVERG),HEX08    IND INPUT EMPTY RCD NOT AVAIL        56500019
         BR    LNKRG8              RETURN TO CALLING RTN                56600019
*                                                                       56700019
* * *  REGISTER EQUATES * * *                                           56800019
*                                                                       56900019
PARMRG0  EQU   0                                                        57000019
PARMRG1  EQU   1                                                        57100019
WRKRG2   EQU   2                                                        57200019
WRKRG3   EQU   3                                                        57300019
WRKRG4   EQU   4                                                        57400019
WRKRG5   EQU   5                                                        57500019
WRKRG6   EQU   6                                                        57600019
WRKRG7   EQU   7                                                        57700019
LNKRG8   EQU   8                                                        57800019
WRKSTRG  EQU   9                                                        57900019
EDTPRMRG EQU   10                                                       58000019
PRMLSTRG EQU   11                                                       58100019
BASERG   EQU   12                                                       58200019
SAVERG   EQU   13                                                       58300019
RETRNRG  EQU   14                                                       58400019
RTCDRG   EQU   15                                                       58500019
*                                                                       58600019
* * *  EQUATES USED AS CONSTANTS  * * *                                 58700019
*                                                                       58800019
HEX00    EQU   X'00'                                                    58900019
HEX01    EQU   X'01'                                                    59000019
HEX02    EQU   X'02'                                                    59100019
HEX03    EQU   X'03'                                                    59200019
HEX04    EQU   X'04'                                                    59300019
HEX08    EQU   X'08'                                                    59400019
HEX0A    EQU   X'0A'                                                    59500019
HEX0C    EQU   X'0C'                                                    59600019
HEX10    EQU   X'10'                                                    59700019
HEX20    EQU   X'20'                                                    59800019
HEX40    EQU   X'40'                                                    59900019
HEX80    EQU   X'80'                                                    60000019
DLE      EQU   X'10'                                                    60100019
STX      EQU   X'02'                                                    60200019
HEXF7    EQU   X'F7'                                                    60300019
HEX71    EQU   X'71'                                                    60400019
HEX78    EQU   X'78'                                                    60500019
HEXCAN   EQU   X'18'                                                    60600019
HEXGS    EQU   X'1D'                                                    60700019
HEX0E    EQU   X'0E'                                                    60800019
HEX82    EQU   X'82'                                                    60900019
HEXF0    EQU   X'F0'                                                    61000019
HEXLZF   EQU   X'00'                                                    61100019
HEX9F    EQU   X'9F'                                                    61200019
CRM      EQU   C'U'                                                     61300019
HEX7F    EQU   X'7F'                                                    61400019
CVOK     EQU   C'V'                                                     61500019
HEX0F    EQU   X'0F'                                                    61600019
CHE      EQU   C'E'                                                     61700019
HEX3F    EQU   X'3F'                                                    61800019
CHAR0    EQU   C'0'                                                     61900019
CHAR1    EQU   C'1'                                                     62000019
CHAR2    EQU   C'2'                                                     62100019
HEXFE    EQU   X'FE'                                                    62200019
HEXFB    EQU   X'FB'                                                    62300019
HEXDUP   EQU   X'11'                                                    62400019
ETB      EQU   X'26'                                                    62500019
HEX19    EQU   X'19'                                                    62600019
HEXVOK   EQU   X'1E'                                                    62700019
HEXRM    EQU   X'3C'                                                    62800019
HEX12    EQU   X'12'                                                    62900019
HEX88    EQU   X'88'                                                    63000019
HEX16    EQU   X'16'                                                    63100019
HEXBF    EQU   X'BF'                                                    63200019
HEXEF    EQU   X'EF'                                                    63300019
*                                                                       63400019
* * *  CONSTANTS  * * *                                                 63500019
*                                                                       63600019
LGT256   DC    F'256'                                                   63700019
TWOOH    DC    H'20'                                                    63800019
HLF15    DC    H'15'                                                    63900019
THREE    DC    H'3'                                                     64000019
TREDW    DC    C'01234567'         USED TO MAKE EDW                     64100019
         DC    C'89ABCDEF'         PRINTABLE                            64200019
CHAR00   DC    C'00'                                                    64300019
MOVESCND MVC   0(0,WRKRG5),0(WRKRG7) USED BY EXECUTE IN MOVE RTN        64400019
*                                                                       64500019
* * *  TRANSLATE AND TEST TABLE  * * *                                  64600019
*                                                                       64700019
TRNSTBLE DC    256X'00'                                                 64800019
         ORG   TRNSTBLE+HEXLZF                                          64900019
         DC    X'04' *             LEFT ZERO FILL                       65000019
         ORG   TRNSTBLE+HEXDUP                                          65100019
         DC    X'08'               DUP                                  65200019
         ORG   TRNSTBLE+HEX12                                           65300019
         DC    X'0C'               LEFT ZERO START                      65400019
         ORG   TRNSTBLE+HEXCAN                                          65500019
         DC    X'10'               CANCEL                               65600019
         ORG   TRNSTBLE+HEX0C                                           65700019
         DC    X'14'               GROUP SEPARATOR                      65800019
         ORG   TRNSTBLE+ETB                                             65900019
         DC    X'18'               ETB                                  66000019
         ORG   TRNSTBLE+HEX03                                           66100019
         DC    X'18'               ETX                                  66200019
         ORG   TRNSTBLE+HEX3F                                           66300019
         DC    X'1C'               DATA CHECK                           66400019
         ORG   TRNSTBLE+HEX19                                           66500019
         DC    X'20'               END DATA                             66600019
         ORG   TRNSTBLE+HEXVOK                                          66700019
         DC    X'24'               VERIFY OK                            66800019
         ORG   TRNSTBLE+HEXRM                                           66900019
         DC    X'24'               RECORD MARK                          67000019
         ORG   TRNSTBLE+HEX71                                           67100019
         DC    8X'28'              PROGRAM LEVEL 1-8                    67200019
         ORG                                                            67300019
PARMLIST DSECT                                                          67400019
PRMINPUT DS    A *                 ADDR OF INPUT                        67500019
PRMIPTLN DS    A *                 LENGTH OF INPUT                      67600019
PRMWRKAD DS    A *                 ADDR OF WORK AREA                    67700019
PRMMXRCL DS    A *                 MAXIMUM RECORD LENGTH                67800019
EDITPARM DSECT                                                          67900019
EDTTYPSW DS    B *                 EDIT SWS INDICATING USER OPTIONS     68000019
EDTREPCR DS    X *                 REPLACE CHARACTER                    68100019
EDTMINLN DS    H *                 MINIMUN ACCEPTABLE RECORD LENGTH     68200019
EDTUSRXT DS    V *                 USER ERROR EXIT ROUTINE              68300019
WORKSTOR DSECT                                                          68400019
WRKADRRC DS    A *                 ADDR OF RECORD                       68500019
WRKADNXB DS    A *                 POINTER TO NEXT BUFFER               68600019
WRKENWRK DS    A *                 PTR TO END OF WORK + 1               68700019
WRKNXAVW DS    A *                 PTR TO NEXT AVAIL IN WORK AREA       68800019
WRKNXAVI DS    A *                 PTR TO NEXT AVAIL IN INPUT           68900019
WRKENIPT DS    A *                 PTR TO END OF INPUT + 1              69000019
WRKFBSCN DS    A *                 PTR TO FIRST BYTE SCANNED            69100019
WRKENSCN DS    A *                 PTR TO LAST BYTE SCANNED             69200019
WRKLDBPV DS    A *                 PTR TO LAST DATA BYTE OF PREV RCD    69300019
WRKFBLZF DS    A *                 PTR TO FIRST BYTE OF LZ FIELD        69400019
WRKSVLZJ DS    4F *                SAVE AREA FOR LZ JUSTIFICATION RTN   69500019
WRKSVEDW DS    F *                 ERROR DESCRIPTION WORD               69600019
         ORG   WRKSVEDW *                                               69700019
WRKLEVST DS    C *                 LEVEL STATUS                         69800019
WRKTYPST DS    B *                 TYPE STATUS                          69900019
WRKSORSV DS    X *                 SOR                                  70000019
WRKEORSV DS    X *                 EOR                                  70100019
WRKSVPGL DS    8H *                SAVE AREA FOR LNG OF PGM LEVEL CODES 70200019
WRKLZFCT DS    H *                 COUNT OF LZ FILL CHARS               70300019
         SPACE 1                                                        70400019
*      THE BITS IN WRKEDSW1 ARE USED AS FOLLOWS                         70500019
*      BIT 0  ON INDICATES DELETE THIS RECORD                           70600019
*      BIT 1  ON INDICATES LEFT ZERO START CODE FOUND                   70700019
*      BIT 2  ON INDICATES END OF LEFT ZERO FIELD FOUND                 70800019
*      BIT 3  ON INDICATES ALL SCANNED NOT FIT IN WORK AREA             70900019
*      BIT 4  ON INDICATES SOR CHARACTER EXPECTED                       71000019
*      BIT 5  ON INDICATES END OF RECORD FORCED                         71100019
*      BIT 6  ON INDICATES DUP NOT ALLOWED IN THIS RECORD               71200019
*      BIT 7  ON INDICATES DUP FOUND IN THIS RECORD                     71300019
WRKEDSW1 DS    B *                 EDIT SWITCHES                        71400019
         SPACE 1                                                        71500019
*      THE BITS IN WRKEDSW2 ARE USED AS FOLLOWS                         71600019
*      BITS 0-3  RESERVED                                               71700019
*      BIT 4  ON INDICATES INPUT IS NOT EMPTY                           71800019
*     BIT 5 ON INDICATES BSC END CHARACTER FOUND                        71900019
*      BIT 6  ON INDICATES DOUBLE DATA CHECK FOUND IN THIS RECORD       72000019
*      BIT 7  ON INDICATES THIS RECORD IS A PARTIAL RECORD              72100019
WRKEDSW2 DS    B *                 EDIT SWITCH                          72200019
WRKLNGSV DS    F *                 SAVE FOR LENGTH OF WORK AREA         72300019
WRKMACSV DS    F *                 BEGIN OF SAVE AREA IF PRESENT        72400019
         END                                                            72500019
./  ADD  SSI=20590212,NAME=IECTLERP
         TITLE 'IECTLERP - BTAM LINE ERROR PRINT ROUTINE'               00020000
IECTLERP CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL 000    JANUARY 16, 1967                00080000
         SPACE 2                                                        00100000
*********************************************************************** 00120000
*                                                                     * 00140000
*        LINE ERROR RECORDING PRINT ROUTINE (LERPRT)                  * 00160000
*                                                                     * 00180000
* FUNCTION -        THIS ROUTINE PRINTS LINE ERROR DATA FOR THE       * 00190021
*                   FOLLOWING -                                       * 00200021
*                                                                     * 00210021
*                     1. DATA CHECK ERRORS                            * 00220021
*                     2. INTERVENTION REQUIRED ERRORS                 * 00230021
*                     3. TIME OUT ERRORS                              * 00240021
*                                                                     * 00250021
* ENTRY -           FIRST EXECUTABLE INSTRUCTION                      * 00260021
*                                                                     * 00270021
* INPUT -           1. REGISTER 0 CONTAINS THE RELATIVE LINE NUMBER.  * 00280021
*                      IF REGISTER 0=0,ALL LINES ASSOCIATED WITH THE  * 00290021
*                      LINE GROUP WILL BE PRINTED.                    * 00300021
*                   2. REGISTER 1 CONTAINS A POINTER TO THE ASSOCIATED* 00310021
*                      LINE GROUP DATA CONTROL BLOCK.                 * 00320021
*                                                                     * 00330021
* OUTPUT -          LINE ERROR MESSAGES TO THE OPERATOR CONSOLE       * 00340021
*                                                                     * 00350021
* EXTERNAL ROUTINE - SVC 35 - WRITE TO OPERATOR                       * 00360021
*                                                                     * 00370021
* EXIT -            RETURN TO USER VIA REGISTER 14                    * 00380021
*                                                                     * 00390021
* ATTRIBUTES -      THIS ROUTINE IS REENTRANT.                        * 00400021
*                                                                     * 00500000
*********************************************************************** 00520000
         USING *,BASREG                                                 00540000
         STM   LNKREG,CLRREG,12(SAVREG) SAVE PROBLEM PROG REGS          00560000
         SR    CLRREG,CLRREG           CLEAR REGISTER            A27630 00570019
         LTR   PARRG1,PARRG1           TEST REGISTER U FOR POS   A27630 00580019
         BP    NOCOMPL                 BRANCH IF YES             A27630 00590019
         LA    CLRREG,1                IF NO, CLEAR=YES          A27630 00600019
         LCR   PARRG1,PARRG1           CONVERT TO POSITIVE ADDRESS27630 00610019
NOCOMPL  TM    DCBERROP(PARRG1),DCBLECT LINE ERROR RECORDING SPECA27630 00620019
         BZ    LERPRT11                NO EXIT                   A27630 00630019
         L     DEBREG,DCBDEBAD(PARRG1)  ADDRESS OF DEB                  00700000
         LA    PTRREG,DEBUCBAD-4(DEBREG) ADDRESS OF FIRST UCB POINTER-4 00720000
         SR    LERBRG,LERBRG            INITIALIZE LERB REGISTER        00740000
         LTR   RLNREG,PARRG0            CHECK FOR RELATIVE LINE PRINT   00760000
         BZ    LERPRT00                 LINE GROUP PRINT REQUIRED       00780000
         BCTR  RLNREG,PARRG0            ADJUST RLN FOR FACTORING        00800000
         LR    LERBRG,RLNREG            FACTOR TO MULTIPLY REG          00820000
         MH    LERBRG,LERPCN20          RESOLVE LERB INDEX              00840000
         SLL   RLNREG,2                 RESOLVE UCB INDEX               00860000
         LA    LNCTRG,1                 SET TO PRINT ONE LINE           00880000
         B     LERPRT01                 PRINT RELATIVE LINE             00900000
LERPRT00 SR    LNCTRG,LNCTRG            LINE GROUP PRINT ROUTINE SETUP  00920000
         IC    LNCTRG,DEBNMEXT(DEBREG)  NUMBER OF LINES TO BE PRINTED   00940000
LERPRT01 A     LERBRG,DCBLERB(PARRG1)   ADDRESS OF LERB BLOCKS          00960000
         SH    LERBRG,LERPCN20          ADJUST FOR PRINT ROUTINE        00980000
         AR    PTRREG,RLNREG            ADJUST UCB POINTER TO FIRST ENT 01000000
LERPRT02 AH    LERBRG,LERPCN20          STEP LERB POINTER TO NEXT ENTRY 01020000
         LA    PTRREG,4(PTRREG)         STEP UCB POINTER TO NEXT ENTRY  01040000
         L     WRKREG,0(LERBRG)         TOTAL NUMBER OF TRANSMISSIONS   01060000
         SR    CNTREG,CNTREG            INITIALIZE IC REGISTER          01080000
         IC    CNTREG,LERBTHCT(LERBRG)  PICK UP THRESHOLD COUNT         01100000
         AR    WRKREG,CNTREG            NEW COUNT                       01120000
         ST    WRKREG,0(LERBRG)         UPDATE TOTAL COUNTER            01140000
         CVD   WRKREG,LERPDBWD                                          01160000
         UNPK  OUTMSG03+6(8),LERPDBWD+3(5) MOVE INTO MSG IN ZONE FORMAT 01180000
         OI    OUTMSG03+13,MASK3        MASK OUT SIGN                   01200000
         LH    WRKREG,LERBDCTC(LERBRG)  PICK UP TOTAL DATA CHECK COUNT  01220000
         IC    CNTREG,LERBDCNC(LERBRG)  PICK UP DATA CHECK NEW COUNT    01240000
         AR    WRKREG,CNTREG            NEW TOTAL                       01260000
         STH   WRKREG,LERBDCTC(LERBRG)  UPDATE TOTAL COUNTER            01280000
         CVD   WRKREG,LERPDBWD                                          01300000
         UNPK  OUTMSG04+3(5),LERPDBWD+5(3) MOVE MSG INTO  AREA W/ZONES  01320000
         OI    OUTMSG04+7,MASK3         MASK OUT SIGN                   01340000
LERPRT04 LH    WRKREG,LERBIRTC(LERBRG)  PICK UP OLD TOTAL COUNT         01360000
         IC    CNTREG,LERBIRNC(LERBRG)  PICK UP NEW COUNT               01380000
         AR    WRKREG,CNTREG            NEW TOTAL                       01400000
         STH   WRKREG,LERBIRTC(LERBRG)  UPDATE TOTAL COUNTER            01420000
         CVD   WRKREG,LERPDBWD                                          01440000
         UNPK  OUTMSG05+3(5),LERPDBWD+5(3) MOVE COUNT TO MSG WITH ZONES 01460000
         OI    OUTMSG05+7,MASK3         MASK OUT SIGN                   01480000
LERPRT06 LH    WRKREG,LERBTOTC(LERBRG)  TIME OUT TOTAL COUNT            01500000
         IC    CNTREG,LERBTONC(LERBRG)  TIME OUT NEW COUNT              01520000
         AR    WRKREG,CNTREG            NEW TOTAL                       01540000
         STH   WRKREG,LERBTOTC(LERBRG)  UPDATE TOTAL COUNTER            01560000
         CVD   WRKREG,LERPDBWD                                          01580000
         UNPK  OUTMSG06+3(5),LERPDBWD+5(3) PUT COUNT INTO MSG WITH ZONE 01600000
         OI    OUTMSG06+7,MASK3         MASK OUT SIGN                   01620000
         XC    LERBTHCT(4,LERBRG),LERBTHCT(LERBRG) CLEAR INTERIM CTRS   01640000
         L     WRKREG,0(PTRREG)         ADDRESS OF UCB                  01660000
         MVC   OUTMSG02(3),UCBNAME(WRKREG) MOVE IN LINE ADDRESS         01680000
         LR    WRKREG,BASREG            SAVE BASE                       01700000
         LR    CNTREG,PARRG1            SAVE PARAMETER REGISTER         01720000
         LR    PARRG0,PARRG1           CONSOLE ID TO R0          A29589 01722019
         SRL   PARRG0,24               NOW TO LOW ORDER BYTE     A29589 01724019
         LTR   PARRG0,PARRG0           SEE IF MCS FLAGS SHOULD   A29589 01726019
*                                      BE CHANGED                A29589 01728019
         BZ    LERPRT12                NO                        A29589 01730019
         MVI   MSGAREA+2,X'40'         CHANGE MCS FLAGS SO THAT  A29589 01732019
*                                      LERB IS SENT TO REQUESTINGA29589 01734019
*                                      CONSOLE                   A29589 01736019
LERPRT12 EQU   *                                                 A29589 01738019
         LA    PARRG1,MSGAREA           WTO PARAMETER VALUE             01740000
         WTO   MF=(E,(1))               WRITE MESSAGE                   01760000
         LR    BASREG,WRKREG            RESTORE BASE                    01780000
         LR    PARRG1,CNTREG            RESTORE PARAMETER REG           01800000
LERPRT09 LTR   CLRREG,CLRREG            COUNTER CLEAR REQUIRED          01820000
         BZ    LERPRT10                 NO EXIT                         01840000
         MVI   0(LERBRG),NONAME         READY TO CLEAR COUNTERS         01860000
         MVC   1(13,LERBRG),0(LERBRG)   CLEAR}                          01880000
LERPRT10 BCT   LNCTRG,LERPRT02          BRANCH IF MORE LINES TO PROCESS 01900000
LERPRT11 EQU   *                                                        01920000
         LM    LNKREG,CLRREG,12(SAVREG) RESTORE PROBLEM PROG REGISTERS  01940000
         BR    LNKREG                   RETURN                          01960000
LERPDBWD DC    D'0'                                                     01980000
MSGAREA  WTO   'IEC802I     LINE TOTALS TRANS=         DC=      IR=    X02000018
                 TO=      ',MF=L,ROUTCDE=(8),DESC=(4)              000H 02020018
OUTMSG02 EQU   MSGAREA+12                                          000H 02040018
OUTMSG03 EQU   MSGAREA+28                                          000H 02060018
OUTMSG04 EQU   MSGAREA+43                                          000H 02080018
OUTMSG05 EQU   MSGAREA+52                                          000H 02100018
OUTMSG06 EQU   MSGAREA+61                                          000H 02120018
LERPCN20 DC    AL2(20)                                                  02140000
COUNTSW  DC    X'00'                                                    02160000
DCBDEBAD EQU   44                                                       02180000
DCBERROP EQU   33                                                       02200000
DCBLECT  EQU   X'08'                                                    02220000
DEBUCBAD EQU   32                                                       02240000
DEBNMEXT EQU   16                                                       02260000
DCBLERB  EQU   52                                                       02280000
LERBTHCT EQU   10                                                       02300000
LERBDCTC EQU   4                                                        02320000
UCBNAME  EQU   13                                                       02340000
LERBDCNC EQU   11                                                       02360000
LINEACT  EQU   X'10'                                                    02380000
MASK3    EQU   X'F0'                                                    02400000
LERBIRTC EQU   6                                                        02420000
LERBIRNC EQU   12                                                       02440000
LERBTOTC EQU   8                                                        02460000
LERBTONC EQU   13                                                       02480000
MASKALL  EQU   255                                                      02500000
NONAME   EQU   0                                                        02520000
PARRG0   EQU   0                                                        02540000
PARRG1   EQU   1                                                        02560000
DEBREG   EQU   2                                                        02580000
LNCTRG   EQU   3                                                        02600000
PTRREG   EQU   4                                                        02620000
UCBREG   EQU   5                                                        02640000
RLNREG   EQU   6                                                        02660000
LERBRG   EQU   7                                                        02680000
WRKREG   EQU   8                                                        02700000
CNTREG   EQU   9                                                        02720000
CLRREG   EQU   10                                                       02740000
SAVREG   EQU   13                                                       02760000
LNKREG   EQU   14                                                       02780000
BASREG   EQU   15                                                       02800000
         END                                                            02820000
./  ADD  SSI=71360298,NAME=IECTLOPN
         TITLE 'IECTLOPN - LOPEN MACRO SUBROUTINE'                      00400015
IECTLOPN CSECT                                                          00800015
*                                                              @YA02128 00850000
*        FOLLOWING FIXES APPLIED:                              @YA02128 00900000
*              OY02128     OCT 1973                            @YA02128 00950000
*              OY02471     OCT 1973                            @YA02471 01000000
*                                                              @YA02128 01050000
* C303300-303600                                             LD YA03254 01100000
* A136500,C487000,A544500-547920,A642600-643100,             LD YA03257 01150000
* A806500-808500                                             LD YA03257 01160000
* C704600                                                    LD YA03956 01162000
*        ZA00535  (11/15/74)                                            01164003
*        ZA02300  (11/15/74)        ZA02301  (11/15/74)                 01166003
*        AZ04194  (09/05/75)                                            01167003
*        AZ08076 (02/02/76)                                             01168003
*        AZ11421 (06/09/76)                                             01168500
*        AZ11458 (07/21/76)         AZ12130  (07/21/76)                 01169000
*        AZ12159 (08/19/76)         AZ12162  (08/19/76)                 01169500
*        AZ12163 (08/19/76)         AZ15416  (11/12/76)                 01170000
*        AZ16559 (01/03/77)         AZ17715  (03/01/77)                 01570000
*        AZ18590 (05/12/77)                                             01770000
         SPACE 2                                                        02000015
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02400015
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02800015
*                                                                     * 03200015
*                                                                     * 03600015
*FUNCTION/OPERATION-THIS ROUTINE WILL RE-ISSUE SAD,SET MODE OR ENABLE   04000015
*   COMMANDS TO A CONTROL UNIT TYPE 2701, 2702, 2703. THIS IS AN      * 04200000
*   ATTEMPT TO RECOVER FROM A FAILURE AT OPEN TIME.                   * 04400000
*                                                                     * 05200015
*                                                                     * 05600015
*ENTRY- WILL BE TO THE FIRST BYTE OF THE MODULE. NORMAL ENTRY WILL BE * 06000015
*   FROM A 'LOPEN' MACRO IN THE USER CSECT.                           * 06400015
*                                                                     * 06800015
*                                                                     * 07200015
*INPUT-GENERAL REGESTER 1 WILL CONTAIN A POINTER TO A DECB.           * 07600015
*                                                                     * 08000015
* OUTPUT -          RETURN CODE IN REGISTER FIFTEEN                   * 08100021
*                                                                     * 08200021
*                                                                     * 08400015
*EXTERNAL ROUTINES- NONE                                              * 08800015
*                                                                     * 09200015
*                                                                     * 09600015
*EXIT-VIA A 'RETURN' WITH RETURN CODES                                * 10000015
*  X'00' = NORMAL EXIT                                                * 10200000
*  X'04' = COMMAND(S) NOT COMPLETED SUCCESSFULY                       * 10400000
*  X'08' = ERROR-IOB HAS BUSY FLAG ON                                 * 10800000
*  X'0C' = ERROR-DECRLN IS GREATER THAN NUMBER OF EXTENTS             * 11200000
*  X'10' = ERROR-DCB HAS NOT BEEN OPENED                              * 11400000
*  X'14' = OLTEP IS EXECUTING                                         * 11800000
*  X'20' = LOCAL DEVICE OTHER THAN 3270                               * 11900000
*                                                                     * 12400015
* ATTRIBUTES -      THIS ROUTINE IS REENTRANT                         * 12600021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 12800015
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 13200015
         SPACE                                                          13600015
R1       EQU   1                                             LD YA03257 13650000
RDCB     EQU   2                                                        14000015
RIOB     EQU   3                        BASE FOR IOB                    14400015
RCTL     EQU   4                        CONTROL SWITCH                  14800015
RPTR     EQU   5                        POINTER TO NEXT CCW             15200015
RWKE     EQU   6                        WORK REG (EVEN)                 15600015
RWKO     EQU   RWKE+1                   WORK REG (ODD)                  16000015
RUCB     EQU   8                        BASE FOR UCB                    16400015
RDECB    EQU   9                                                        16800015
RDEB     EQU   10                                                       17200015
RBASE    EQU   12                                                       17600015
RL3270   EQU   11                   REG 11=LOCAL/REMOTE TEST   @ZA04194 17700003
RCREG    EQU   15                    RETURN CODE REG           @ZA04194 17800003
         SPACE                                                          18000015
         SAVE  (14,12)                                         @ZA15416 18200000
         SPACE                                                          18800015
         USING IECTIOB,RIOB                                             19200015
         USING UCBSTART,RUCB                                            19600015
         USING IHADCB,RDCB                                              20000015
         USING IECTDECB,RDECB           BASE FOR DECB                   20400015
         USING IECTDEB+36,RDEB                                          20800015
         SPACE                                                          21200015
         BALR  RBASE,0                                                  21600015
         USING *,RBASE                  BASE REGISTER                   22000015
         B     CONTINUE                BRANCH AROUND ID        @YA02128 22050000
         DC    CL8'IECTLOPN'             MODULE ID             @YA02128 22100000
         DC    XL3'010593'               PTF NUMBER            @YA18590 22150000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY                   22160002
         DS    0F                                              @ZA11458 22170000
PATCH    DC    40X'00'             PATCH AREA                  @ZA11458 22180000
CONTINUE DS    0H                                              @YA02128 22200000
         SPACE                                                          22400015
         SR    RCREG,RCREG              CLEAR RETURN CODE      @ZA04194 22600003
         SR    RL3270,RL3270    CLEAR REG 11 FO 3270 TEST      @ZA04194 22800003
*                              ZERO MEANS REMOTE, NON-ZERO     @ZA04194 22900003
*                               MEANS LOCAL                    @ZA04194 23000003
         LR    RDECB,1                                                  23200015
         SPACE                                                          23600015
         L     RDCB,DECDCBAD            BASE FOR DCB                    24000015
         L     RDEB,DCBDEBAD            BASE FOR DEB               1850 24400015
         TM    DCBOFLGS,OPENFLG         TEST FOR OPEN                   24800015
         BZ    EXIT10                                                   25200015
         SR    RWKO,RWKO                CLEAR WORK REG                  25600015
         SR    RWKE,RWKE                                                26000015
         CLC   DECRLN(1),DEBNMEXT       IS RLN A POSSIBILITY?           26400015
         BH    EXITC                     NO - ERROR EXIT                26800015
         IC    RWKO,DECRLN              GET RLN                         27200015
         IC    RWKE,DCBEIOBX            IOB LENGTH                      27600015
         MR    RWKE,RWKE                 X RELATIVE LINE NUMBER         28000015
         L     RIOB,DCBIOBAD             + START                        28400015
         AR    RIOB,RWKO                BASE FOR IOB                    28800015
         SR    RUCB,RUCB               CLEAR REG FOR UCB BASE           28850017
         IC    RUCB,IOBUCBX            FIND UCB INDEX                   28900017
         SLL   RUCB,2                  MULTIPLY BY FOUR TO GET OFFSET   28950017
         L     RUCB,DEBUCBAD(RUCB)     LOAD UCB ADDRESS FROM DEB LIST   29000017
         CLI   UCBDEVTP+3,TYPE3        TEST FOR 2260 ON TYPE 3 ADAPTER  29050017
         BE    EXIT0                   IF SO, EXIT (LOPEN INEFFECTIVE)  29100017
         SPACE                                                          29200015
         TM    IOBINCAM,BUSY            IS IOB BUSY FLAG SET            29600015
         BO    EXIT8               YES, SET BUSY RC AND EXIT            30000000
         CLI   UCBDEVTP+2,GRAPHICS TEST FOR GRAPHICS DEVICE CLASS       30005000
         BNE   CHKTCU              IF NOT, TEST TCU                     30010000
         CLI   UCBDEVTP+3,DSPL3277 TEST FOR 3277 DISPLAY                30015000
         BE    DVC3270             YES, SET UP ERASE WRITE              30020000
         CLI   UCBDEVTP+3,PRT3284  TEST FOR 3284 PRINTER                30025000
         BE    DVC3270             YES, SET UP ERASE/WRITE              30027000
         CLI   UCBDEVTP+3,PRT3286  TEST FOR 3286 PRINTER                30035000
         BE    DVC3270             YES, SET UP ERASE/WRITE     @ZA16559 30036000
         CLI   UCBDEVTP+2,GRAPHICS   STILL GRAPICS             @ZA12163 30037000
         BE    EXIT20              YES SET ERROR CODE          @ZA12163 30038000
DVC3270  EQU   *                                                        30040000
         LA    RL3270,ONE         MAKE NON-ZERO TO INDICATE    @ZA04194 30042003
*                                  LOCAL DEVICE                @ZA04194 30044003
         TM    UCBGCB,OLTEP        IS OLTEP EXECUTING ?        @ZA04194 30046003
         BO    TSTOLTEP           BRANCH IF YES                @ZA04194 30048003
         TM    UCBGRAF,IGG019UP     USING BTAMS ?              @YA02128 30050000
         BNO   CONTLOPN             NO, DON'T CHECK FLAGS      @YA02128 30052000
         TM    UCBGRAF,RDYNDONE     READY PROCESSING NOW       @YA02128 30054000
         BO    EXIT4                YES, OPEN FAILED           @YA02128 30054100
         TM    UCBGRAF,NOTRDY       DEVICE NOT READY ?         @YA02128 30054400
         BO    EXIT4                YES, OPEN FAILED           @YA02128 30054800
CONTLOPN EQU   *                                               @YA02128 30054900
         MVI   DECTYPE+1,WTERASE       DECTYPE FOR WRITE/ERASE @YA02471 30056100
         OI    IOBINCAM,BUSY       LOCAL 3270 DVC - TURN ON BUSY BIT    30058800
         LA    RPTR,IOBCPA         SET POINTER TO IOBCPA                30060000
         ST    RPTR,IOBSTART       STORE IN IOBSTART                    30062802
         MVC   0(CCWLNGTH,RPTR),ERASEWRT MOVE IN ERASE/WRITE CMD        30067102
         B     EXCP1               ISSUE EXCP                           30071402
TSTOLTEP EQU   *                                                        30075702
         LA    RCREG,ERR14            SET RETURN CODE 14       @ZA04194 30080003
         B     OUT                                                      30085000
CHKTCU   EQU   *                                               @ZA04194 30100003
*             THREE LINES OF CODE DELETED BY--------------->   @ZA04194 30150003
* TWO INSTRUCTIONS REMOVED BY APAR OZ12130                     @ZA12130 30330000
         OI    IOBINCAM,BUSY                                            30400015
         SPACE                                                          30800015
         LA    RPTR,IOBCPA              SET POINTER                     33200015
         ST    RPTR,IOBSTART                                            33250017
         MVC   0(8,RPTR),DISABLE       MOVE IN DISABLE COMMAND     000H 33300017
         LA    RPTR,8(RPTR)                                        000H 33400017
         TM    UCBDEVTP+3,CU0103       TEST FOR 2701 OR 2703            34000017
         BO    SMODETST                IF SO, DON'T SET UP SAD COMMAND  34600017
         SPACE                                                          35200015
SETADD   SR    RWKO,RWKO                CLEAR WORK REG                  35600015
         IC    RWKO,UCBDEVTP+1          SET COMMAND CODE                36000015
         N     RWKO,ANDMASK                                             36400015
         IC    RWKO,SADCODE(RWKO)       INSERT ACTUAL COMMAND CODE      36800015
         STC   RWKO,0(RPTR)             STORE IN CCW                    37200015
         MVC   1(7,RPTR),CCWCONST       SET REMAINDER OF SAD COMMAND    37600015
         LA    RPTR,8(RPTR)             INCREMENT RPTR FOR 2ND CCW      38000015
         SPACE                                                          38800015
SMODETST TM    UCBDEVTP+3,CU0103BS      TEST FOR 2701/3 BSC             39200015
         BNO   ENABLTST                   NOT 2701/3 BSC                39600015
         SPACE  2                                                       40100017
         LA    RCTL,DCBXMODE           GET ADDRESS OF MODE CONTROL      40600017
         ST    RCTL,0(RPTR)                BYTE AND STOREIN CH. PGM.    41100017
         MVI   0(RPTR),MODECMCD         INSERT COMMAND CODE             41600015
         MVC   4(4,RPTR),CCWCONST+3                                     42000015
         LA    RPTR,8(RPTR)             INCREMENT RPTR FOR NEXT CCW     42400015
         SPACE  2                                                       43000017
ENABLTST TM    UCBDEVTP+1,AUTO         TEST FOR AUTO-CALL, AUTO-ANSWER  43600017
         BNE   EXCP                    IF SO, DON'T ENABLE              44200017
         MVC   0(8,RPTR),ENABLE        MOVE ENABLE COMMAND TO CH. PGM.  44800017
         B     EXCP1                                                    45400017
         SPACE                                                          46000015
EXCP     SH    RPTR,EIGHT               POINT TO LAST CCW   LD @ZA02301 46400003
         NI    4(RPTR),CCOFF            TURN OFF COMMAND CHAIN          46800015
EXCP1    LR    R1,RIOB                  LOAD IOB ADDRESS       @ZA04194 47000003
         NI    IOBINCAM,FF-SADENER        CLEAR FAIL FLAG      @ZA04194 47200003
         LTR   RL3270,RL3270         LOCAL OR REMOTE DEVICE ?  @ZA04194 47300003
         BNZ   LBTAMECB             BRANCH FOR LOCAL DEV       @ZA04194 47400003
         ST    RDECB,IOBECBPT     PUT USER DECB IN IOB REMOTE  @ZA04194 47500003
EXCP2    EQU   *                                               @ZA04194 47600003
         EXCP  (1)                                                      48000015
         MVI   IOBINCAM+1,X'00'        SET TIMER-COUNT BYTE TO ZERO     48100017
STIMER   STIMER  WAIT,BINTVL=TIME                                       48200017
         L     R1,IOBECBPT              LOAD POINTER TO ECB    @ZA04194 48250003
         TM    0(1),X'40'              IS OPERATION COMPLETE            48400017
         BO    COMPNORM                YES, CHECK COMPLETION CODE       48500017
         CLI   IOBINCAM+ONE,COUNT       IS TIME EXHAUSTED ?    @ZA04194 48550003
         BNL   EXIT4A                                          @ZA04194 48600003
         IC    RCTL,IOBINCAM+1         INCREMENT                        48800017
         LA    RCTL,1(RCTL)                TIMER COUNT FOR              48900017
         STC   RCTL,IOBINCAM+1                   ANOTHER 1/2 SEC        49000017
         B     STIMER                                 AND REISSUE       49100017
LBTAMECB LA    RWKE,IOBERCCW     USE IT AS A BTAM ECB          @ZA04194 49110003
         XC    IOBERCCW(L4),IOBERCCW   CLEAR THE ECB           @ZA04194 49120003
         ST    RWKE,IOBECBPT    PUT BTAM DECB IN IOB LOCAL     @ZA04194 49130003
         SPACE 1                                                        49130900
*********************************************************************** 49131800
*         FOLLOWING CODE GETS WCC CHARACTER AND ITS ADDRESS    @ZA17715 49132700
*         WHICH MUST BE PASSED TO SIO/PAGE FIX APPENDAGE.      @ZA17715 49133600
*********************************************************************** 49134500
         SPACE 1                                                        49135400
         MVC   46(2,RIOB),LNGONE  MOVE LENGTH INTO BTAM DECB   @ZA17715 49136300
         L     RWKE,IOBCPA        GET ADDR OF WCC FROM CCW     @ZA17715 49137200
         LA    RWKE,0(RWKE)       CLEAR HIGH ORDER BYTE.       @ZA17715 49138100
         ST    RWKE,52(RIOB)      PUT WCC ADDR IN BTAM DECB    @ZA17715 49139000
         B    EXCP2                                            @ZA04194 49140003
COMPNORM EQU   *                                               @ZA04194 49150003
         MVI   IOBINCAM+1,X00      SET TIMER COUNT TO ZERO     @ZA04194 49200003
         LTR    RL3270,RL3270       LOCAL OR REMOTE DEVICE     @ZA04194 49250003
         BNZ   PUDECB             BRANCH FOR LOCAL DEVICE      @ZA04194 49300003
NORMCOMP EQU   *                                               @ZA04194 49330003
         CLI   ZERO(RDECB),NORM     IS COMPLETION CODE A 7F ?  @ZA08076 49360003
         BNE   EXIT4                                                    50400015
         SPACE                                                          50800015
         SPACE                                                          51200015
*   GOOD RETURN                                                         51600015
         SPACE                                                          52000015
EXIT0    NI    IOBINCAM,FF-SADENER      CLEAR FAIL FLAG                 52400015
         SR    RCREG,RCREG              CLEAR RETURN CODE REG  @ZA04194 52500003
         B     EXIT                                                     52800015
PUDECB   EQU   *                                               @ZA04194 52850003
         TM    0(RDECB),X'80'        USER ECB WAITING?         @ZA18590 52860000
         BO    EXIT4                 YES WAITING, DON'T POST   @ZA18590 52870000
         XC    0(1,RDECB),0(RDECB)   CLEAR USERS ECB COMP CODE @ZA18590 52880000
         L     RL3270,IOBERCCW       GET COMPLETION CODE       @ZA04194 52900003
*                                       FROM BTAM ECB          @ZA04194 52950003
         N     RL3270,CLEAR         CLEAR BITS 8 THRU 31       @ZA04194 53000003
         POST (RDECB),(RL3270)        POST USER ECB            @ZA04194 53050003
         B     NORMCOMP                                        @ZA04194 53100003
         SPACE                                                          53200015
         SPACE                                                          53600015
*   CONTROL UNIT NOT OPERATIONAL                                        54000015
         SPACE                                                          54400015
*              FOUR LINES OF CODE DELETED BY APAR ---------->  @ZA04194 54405003
EXIT4A   EQU   *                                               @ZA04194 54450003
         LTR   RL3270,RL3270        LOCAL OR REMOTE DEVICE     @ZA04194 54456003
         BNZ   EXIT4                BRANCH FOR LOCAL DEVICE    @ZA04194 54462003
         LR    R1,RUCB           LOAD UCB ADDRESS IN REG1      @ZA04194 54468003
         LA    R1,ZERO(R1)       CLEAR HIGH ORDER BYTE         @ZA04194 54474003
         SVC   33                ISSUE IOHALT                  @ZA04194 54480003
         SPACE   1                                                      54486003
*    ERROR------- OPEN NOT SUCCESSFUL                          @ZA04194 54492003
*              ELEVEN LINES OF CODE DELETED BY APAR-------->   @ZA04194 54792003
EXIT4    OI    IOBINCAM,SADENER         SET FAIL FLAG          @ZA04194 54800003
         MVI   IOBINCAM+ONE,X00    SET TIMER TO ZERO           @ZA04194 54900003
         LR    R1,RDECB           PUT DECB ADDRESS IN REG 1    @ZA04194 55000003
         LA    RCREG,ERR4               SET RETURN CODE        @ZA12163 55050000
         B     EXIT                                            @ZA04194 55200003
         SPACE                                                          56000015
         SPACE                                                          56400015
*   ERROR -- IOB BUSY                                                   56800015
         SPACE                                                          57200015
EXIT8    LA    RCREG,ERR8               SET RETURN CODE        @ZA12163 57300000
         B     OUT                                                      58000015
         SPACE                                                          58400015
         SPACE                                                          58800015
*   ERROR -- DECRLN NOT VALID                                           59200015
         SPACE                                                          59600015
EXITC    LA    RCREG,ERRC               SET RETURN CODE        @ZA12163 59700000
         B     OUT                                                      60400015
         SPACE 2                                                        60800015
*   ERROR -- DCB NOT OPENED                                             61200015
         SPACE                                                          61600015
EXIT10   LA    RCREG,ERR10              SET RETURN CODE        @ZA12163 61700000
         B     OUT                                                      62400015
         SPACE                                                          62500000
EXIT20   LA    RCREG,ERR20       SET RETURN CODE X'20'         @ZA12163 62600000
         B     OUT                                             @ZA12163 62700000
         SPACE                                                          62800015
EXIT     NI    IOBINCAM,FF-BUSY                                         63200015
         LR    R1,RDECB            GET USER ECB                @ZA18590 63260000
         ST    R1,IOBECBPT         RESTORE USER IN IOB         @ZA18590 63320000
OUT      RETURN (14,12),,RC=(15)        RESTORE REGISTERS      @ZA15416 63400000
         EJECT                                                          64002002
*                                                                       64002402
*        EQUATIONS  AND CONSTANTS                                       64004002
*                                                                       64006002
X00      EQU   X'00'                                           @ZA04194 64008003
GRAPHICS EQU   X'10'               GRAPHICS DEVICE CLASS                64010000
DSPL3277 EQU   X'09'               DVC TYPE - 3277 DISPLAY              64020000
PRT3284  EQU   X'0A'               DVC TYPE - 3284 PRINTER              64030000
PRT3286  EQU   X'0B'               DVC TYPE - 3286 PRINTER              64040000
IGG019UP EQU   X'10'               USING BTAMS READY           @YA02128 64042000
RDYNDONE EQU   X'04'               READY BEING PROCESSED       @YA02128 64046000
NOTRDY   EQU   X'02'               DEVICE NOT READY            @YA02128 64048000
OLTEP    EQU   X'80'               OLTEP EXECUTING FLAG                 64050000
WTERASE  EQU   X'0E'     DECB OPTION TYPE FOR 3270 WRITE/ERASE  YA02471 64070003
COUNT    EQU   X'08'                                           @ZA11421 64075000
ONE      EQU   1                                               @ZA04194 64090003
L4       EQU   4                                               @ZA04194 64100003
DVCLASS  EQU   2                   DISP OF DVC CLASS IN UCBDEVTP        64110002
ADAPTYPE EQU   3                   DISP OF ADAPTER TYPE IN UCBDEVTP     64160002
CCWLNGTH EQU   8                   LENGTH OF A CCW                      64210002
ZERO     EQU   0                                             LD YA03257 64260000
SIXTEEN  EQU   16                                            LD YA03257 64310000
         SPACE                                                          64400015
OPENFLG  EQU   X'10'                                                    64800015
*       ONE LINE OF CODE DELETED BY APAP----------------->     @ZA12159 64820000
NORM     EQU   X'7F'                                                    65200015
*       ONE LINE OF CODE DELETED BY APAP----------------->     @ZA12159 65400000
SADENER  EQU   X'80'                                                    66000015
BUSY     EQU   X'40'                                                    66400015
CU0103BS EQU   X'92'                                                    66800015
MODECMCD EQU   X'23'                                                    67400017
CU0103   EQU   X'02'                                                    68000017
CCOFF    EQU   X'BF'                                                    68800015
FF       EQU   X'FF'                                                    69200015
TYPE3    EQU   X'82'                                                    69600015
AUTO     EQU   X'90'                                                    70000017
LNGONE   DC    H'1'                LENGTH OF X'0001' FOR WCC   @ZA17715 70010000
WCC      DC    X'C3'               WCC WITH RESET MODIFIED DATA AND     70020000
XA0      EQU   X'A0'                                        LD @ZA00535 70030003
*                                   RESET KEYBOARD TAGS ON              70040000
EIGHT    DC    H'8'                                         LD @ZA02301 70090003
         DS    0F                                                       70400015
*        ONE LINE OF CODE DELETED BY APAR --------------->     @ZA12159 70405000
CLEAR    DC    X'FF000000'                                     @ZA04194 70415003
ERASEWRT DC    X'05'               ERASE WRITE CCW WITH -               70420000
WCCADDR  DC    AL3(WCC)                 ADDR OF WCC CHAR                70440000
         DC    X'00A40001'              COUNT OF ONE         LD YA03956 70460000
ANDMASK  DC    X'00000003'                                              70800015
TIME     DC    F'50'                                                    71000017
CCWCONST DC    X'00000060240001'                                        71200015
DISABLE  DC   X'2F00000060010001'                                  000H 71400017
SADCODE  DC    X'13'                    SAD 0 * TABLE INDEXING @ZA04194 71460003
         DC    X'17'                    SAD 1 *   DO NOT       @ZA04194 71520003
         DC    X'1B'                    SAD 2 *   CHANGE       @ZA04194 71600003
         DC    X'1F'                    SAD 3 *  SEQUENCING    @ZA04194 72400003
         SPACE                                                          73200015
ENABLE   DC    X'2700000020A40001'                          LD @ZA02301 74200003
         SPACE                                                          76000015
ERR4     EQU   X'04'                                           @ZA12163 76200000
ERR8     EQU   X'08'                                           @ZA12163 76400000
ERRC     EQU   X'0C'                                           @ZA12163 76800000
ERR10    EQU   X'10'                                           @ZA12163 77200000
ERR14    EQU   X'14'                                                    77300000
ERR20    EQU   X'20'                                           @ZA12163 77400000
*        FIVE LINES OF CODE DELETED BY APAR ------------>      @ZA12159 80650000
         EJECT                                                          80900000
         DCBD  DSORG=BX,DEVD=BS                                         83600017
         EJECT                                                          83650002
         IECTIOBX                                                       88400015
         EJECT                                                          88450002
         IECTDECB                                                       88800015
         EJECT                                                          88850002
         IECTDEBX                                                       89200015
         EJECT                                                          89600002
UCBSTART DSECT                                                          90000015
UCBDEVTP EQU   UCBSTART+16                                              90400015
UCBGCB   EQU   UCBSTART+27         3270 ATTENTION CONTROL BYTE          90600000
UCBGRAF  EQU   UCBSTART+28        GRAPHICS STATUS FLAGS         YA02128 90650002
         END                                                            90800015
./  ADD  SSI=21410037,NAME=IECTONLT
         TITLE 'IECTONLT - LOGIC TO GENERATE AN RFT MESSAGE'       000D 00700016
         SPACE 2                                                        01400016
IECTONLT CSECT                                                          02100016
*********************************************************************** 02110016
*                                                                     * 02120016
* STATUS -           CHANGE LEVEL  001,  MARCH 19,1968                  02130016
*                                                                     * 02140016
* FUNCTION -          TO GENERATE RFT MESSAGE                         * 02150016
*                                                                     * 02160016
* ENTRY POINT -       ENTRY IS TO FIRST EXECUTABLE INSTRUCTION        * 02170016
*                     FROM ONLTST MACRO EXPANSION IN USER CODE.       * 02180016
*                                                                     * 02190016
* INPUT -             USER SPECIFIED PARAMETERS IN ONLTST MACRO.      * 02200016
*                                                                     * 02210016
* OUTPUT -            AN RFT MESSAGE TO REQUEST THE TEST AND NO.      * 02220016
*                     OF TRANSMISSIONS SPECIFIED BY THE USER.         * 02230016
*                                                                     * 02240016
* EXTERNAL ROUTINES - IGG019MA, BTAM READ/WRITE ROUTINE.              * 02250016
*                                                                     * 02260016
* EXIT -              RETURN TO USER ADDRESS IN REGISTER 14 WITH      * 02270016
*                     POSSIBLE RETURN CODES AS LISTED BELOW.          * 02280016
*                       1.  12 - INVALID XX OR YY SPECIFIED.          * 02290016
*                       2.  ANY OF RETURN CODES GIVEN BY READ/WRITE   * 02300016
*                                                                     * 02310016
* IN LINE ROUTINES -  1. BITON - GETS AREA ADDRESS FROM DECB AND      * 02320016
*                        POINT TO FIRST AVAILABLE TEXT BYTE.          * 02330016
*                        CHECKS FOR VALID XX AND YY OPERANDS,         * 02340016
*                        CONVERTS VALUES TO ZONED DECIMAL AND         * 02350016
*                        INSERTS THEM INTO RFT. ADDS SOH %            * 02360016
*                        HEADER, SET UP 'N' FIELD, ATTACH             * 02370016
*                        STX-ETX. BRANCH GETLENG.                     * 02380016
*                                                                     * 02390016
*                     2. MOVETEXT  - IF XX = 1, MOVE USER DEFINED     * 02400016
*                        TEXT INTO RFT MESSAGE.                       * 02410016
*                                                                     * 02420016
*                     3. GETLENG - GET LENGTH OF MESSAGE TO BE        * 02430016
*                        SENT AND STORE IN DECB. SET ZONE BITS FOR    * 02440016
*                        ASCII. SET WRITE INITIAL OR WRITE INITIAL    * 02450016
*                        TRANSPARENT COMMAND CODE.                    * 02460016
*                                                                     * 02470016
*                     4. GETADDR - LINK TO READ/WRITE AND RETURN.     * 02480016
*                                                                     * 02490016
* ATTRIBUTES-    THIS MODULE IS RE-ENTRANT.                           * 02500016
*                                                                     * 02510016
*********************************************************************** 02520016
         SPACE 2                                                        02800016
DECBREG  EQU   1                       DECB DSECT BASE REGISTER   000D  03500016
DCBREG   EQU   2                       DCB DSECT BASE REG          000D 04200016
IOBREG   EQU   3                       IOB DSECT BASE REGISTER     000D 04900016
TEXTREG  EQU   4                       PTR TO USER TEXT            000D 05600016
LENGTREG EQU   5                       WORK REGISTER               000D 06300016
AREAREG  EQU   6                       PTR TO I/O AREA             000D 07000016
LREG     EQU   7                                                   000D 07700016
DIV1     EQU   8                                                        08400016
DIV2     EQU   9                                                        09100016
UCBREG   EQU   10                                                A29562 09300019
CCWREG   EQU   11                                                A29562 09500019
BASEREG   EQU   12                                                      09800016
         SPACE   2                                                      10500016
         STM   14,12,12(13)                                        000D 11200016
         BALR   BASEREG,0                                          000D 11900016
         USING *,BASEREG                  MODULE ADDRESSABILITY    000D 12600016
         USING IECTDECB,DECBREG           DECB ADDRESSABILITY      000D 13300016
         USING IHADCB,DCBREG              *                        000D 14000016
         USING IECTIOB,IOBREG             *                        000D 14700016
         ST    13,SAVEAREA+4            STORE USER SAVEAREA ADDR   000D 15400016
         LA    13,SAVEAREA              GET SAVEAREA ADDR TO LINK  000D 16100016
         L     DCBREG,DECDCBAD            DCB ADDRESSABILITY       000D 16800016
         SR    IOBREG,IOBREG           CLEAR REGISTER              000D 17500016
         IC    IOBREG,DCBEIOBX         GET IOB SIZE                000D 18200016
         NI   DECFLAGS,X'00'           TURN OFF DECB FLAGS         000D 18900016
         MH    IOBREG,DECRLN-1         MULTIPLY BY IOB INDEX       000D 19600016
         A     IOBREG,DCBIOBAD         ADD OFFSET TO IOB ADDR      000D 20300016
         L     AREAREG,DECAREA          GET I/O AREA FROM DECB     000D 21000016
         TM    DCBERROP,TESTBIT        TERM TEST SPECIFIED IN DCB  000D 21700016
         BO    BITON                   YES, GENERATE MESSAGE       000D 22400016
         LA    15,24                   NO, SET RETURN CODE         000D 23100016
         B     LOADMULT                RETURN TO USER              000D 23800016
BITON    TM    DCBBFTEK,DYNBUF         DYNAMIC BUFFERING USED      000D 24500016
         BZ    NOBUFF                   NO, PROCEED AS NORMAL      000D 25200016
         LA    AREAREG,4(AREAREG)       POINT AREAREG TO 1ST TEXT  000D 25900016
NOBUFF   CLI   DECTYPE,LOWX            IS X VALUE                  000D 26600016
         BL    INVALID                    WITHIN ALLOWABLE         000D 27300016
         CLI   DECTYPE,HIGHX                RANGE OF               000D 28000016
         BH    INVALID                        00-19 DECIMAL.       000D 28700016
         CLI   DECTYPE+1,LOWY           IS Y VALUE                 000D 29400016
         BL    INVALID                    WITHIN ALLOWABLE         000D 30100016
         CLI   DECTYPE+1,HIGHY              RANGE OF               000D 30800016
         BH    INVALID                        01-99 DECIMAL        000D 31500016
         SR    LENGTREG,LENGTREG        CLEAR REGISTER             000D 32200016
         IC    LENGTREG,DECTYPE         GET X VALUE IN REGISTER    000D 32900016
         CVD   LENGTREG,IOBERCCW        CONVERT TO DECIMAL AND     000D 33600016
         UNPK  2(2,AREAREG),IOBERCCW+6(2) UNPACK TO GO IN RFT      000D 34300016
         OI    3(AREAREG),ZONE          OR IN ZONE FOR LAST BYTE   000D 35000016
         IC    LENGTREG,DECTYPE+1       GET Y VALUE IN REGISTER    000D 35700016
         CVD   LENGTREG,IOBERCCW        CONVERT TO DECIMAL AND     000D 36400016
         UNPK  4(2,AREAREG),IOBERCCW+6(2) UNPACK TO GO IN RFT      000D 37100016
         OI    5(AREAREG),ZONE          OR IN ZONE FOR LAST BYTE   000D 37800016
         LA    LENGTREG,ZONE            GET ZONED '0' FOR N FIELD  000D 38500016
         STC   LENGTREG,6(AREAREG)      PUT 'N' FIELD IN RFT MSG   000D 39200016
         MVC   0(2,AREAREG),DCBBSONL    MOVE SOH-PERCENT CHARS     000F 39900017
         LH    LREG,DECLNGTH            SAVE MESSAGE LENGTH        000D 40600016
         L     TEXTREG,DECPOLPT        GET TEXT ADDRESS          A29581 40900019
         CLI   DECTYPE,X'01'            IS X EQUAL TO ZERO OR ONE  000D 41300016
         BE    MOVETEXT                 YES, GO MOVE IN USER TEXT  000D 42000016
         MVC   7(1,AREAREG),DCBBSSTX    MOVE IN STX-ETX TO GO      000D 42700016
         MVC   8(1,AREAREG),DCBBSETX      OUT IN RFT MESSAGE       000D 43400016
         LA    LENGTREG,9               GET MESSAGE LENGTH         000D 44100016
         B     GETLENG                 TEST FOR BUFFERING          000D 44800016
         SPACE 2                                                   000D 45500016
MOVETEXT EQU   *                                                 A29581 46200019
         LR    10,AREAREG                                               46900016
         LR    11,TEXTREG                                               47600016
         SR    DIV1,DIV1               CLEAR REGISTER              000D 48300016
         LH    DIV2,DECLNGTH           GET USER LENGTH             000D 49000016
         LA    LENGTREG,256            GET DIVISOR                 000D 49700016
         DR    DIV1,LENGTREG                                       000D 50400016
         BCTR  LENGTREG,0               DECREMENT BY ONE FOR       000D 51100016
TEST    LTR   DIV2,DIV2                IS QUOTIENT ZERO            000D 51800016
         BZ    TESTREG                 YES, GO MOVE REMAINDER      000D 52500016
         BCTR   DIV2,0                 DECREMENT QUOTIENT BY ONE   000D 53200016
         EX    LENGTREG,MOVE           MOVE TEST MSSG INTO RFT     000D 53900016
         LA    10,256(10)                                               54600016
         LA    11,256(11)                                               55300016
         B     TEST                                                000D 56000016
TESTREG  LTR   DIV1,DIV1               IS REMAINDER ZERO           000D 56700016
         BZ    LOADDR                                              000D 57400016
         BCTR    DIV1,0                DECREMENT BY ONE FOR EXECUTE000D 58100016
         EX    DIV1,MOVE                                           000D 58800016
LOADDR    EQU   *                                                       59500016
         LA    LENGTREG,7(LREG)        GET MESSAGE LENGTH          000D 60200016
GETLENG  EQU   *                                                   000D 60900016
         TM    DCBBFTEK,DYNBUF         IS DYNAMIC BUFFERING USED   000D 61600016
         BZ    STORLENG                                            000D 62300016
         LA    LENGTREG,4(LENGTREG)    INCREMENT COUNT BY FOUR     000D 63000016
STORLENG STH   LENGTREG,DECLNGTH        STORE MESSAGE LENGTH       000D 63700016
         XC    DECTYPE(2),DECTYPE      ZERO OUT DECTYPE FIELD      000D 64400016
         TM    DCBXCODE,X'04'           TEST FOR ASCII                  64600001
         BZ    NOTASCII                 IF NOT, TEST FURTHER            64800001
         NI    2(AREAREG),X'7F'        TURN OFF HIGH-ORDER         000D 65100016
PROPZONE MVZ   3(4,AREAREG),2(AREAREG)  ZONE BITS                       65300001
         B     ENDTRANS                 CONTINUE PROCESSING             65500001
NOTASCII TM    DCBXCODE,X'08'           TEST FOR 6 BIT TRANSCODE        65700001
         BZ    ENDTRANS                 EBCDIC, NO TRANS NEEDED         65900001
         NI    2(AREAREG),X'3F'         TURN OFF 2 HIGH ORDER          X66100001
                                        BITS FOR TRANSCODE              66300001
         B     PROPZONE                 PROPAGATE ZONE                  66500001
ENDTRANS MVI   DECTYPE+1,X'02'          PUT WRITE TI CMD CODE           66700001
         CLC   0(2,TEXTREG),DCBBSTSX   IS MESSG TRANSPARENT        000D 67200016
         BNE   GETADDR                                             000D 67900016
         OI    DECTYPE+1,X'10'          SET ON TRANSPARENCY BIT    000D 68600016
GETADDR  L     15,DCBWRITE             GET RD/WRT ADDRESS          000D 69300016
         OI    DECDCBAD,X'80'          ONLTST MACRO HAS BEEN USED       70000018
         BALR  14,15                                               000D 70700016
         STH   LREG,DECLNGTH            RESTORE LENGTH             000D 71400016
         L     13,SAVEAREA+4            GET USER SAVE ADDRESS      000D 72100016
         L     14,12(13)               RESTORE USER REGISTERS      000D 72800016
         B     RETURN                                              000D 73500016
INVALID  LA    15,12                    GET RETURN CODE            000D 74200016
LOADMULT L     13,SAVEAREA+4                                            74900016
RETURN   LM    0,12,20(13)                                         000D 75600016
         BR    14                       RETURN TO USER             000D 76300016
         SPACE 2                                                        77000016
DYNBUF   EQU   X'08'                    DYNAMIC BUFFERING MASK     000D 77700016
ZONE     EQU   X'F0'                                               000D 78400016
LOWX     EQU   X'00'                    LOWEST ALLOWABLE X VALUE   000D 79100016
HIGHX    EQU   X'16'                    HIGHEST ALLOWABLE X VALUE  000L 79800019
TESTBIT  EQU   X'10'                   ON LINE TEST BIT IN DCB     000D 80500016
LOWY     EQU   X'01'                    LOWEST ALLOWABLE Y VALUE   000D 81200016
HIGHY    EQU   X'63'                    HIGHEST ALLOWABLE Y VALUE  000D 81900016
DEVTP    EQU   16               UCB OFFSET TO DEVICE TYPE        A29562 82000019
UCBAD    EQU   32               DEB OFFSET TO UCB ADDR TABLE     A29562 82100019
DIALINE  EQU   X'90'                                             A29562 82200019
SAVEAREA DS    18F                                                 000D 82600016
DISABLE  DC    X'2F00000020800001'                               A29562 82900019
MODNAME  DC    CL8'IGC0006F'            BASIC MODULE NAME FOR SVC  000D 83300016
MOVE     MVC   7(1,10),0(11)                                            84000016
*                                         INTO DECAREA             000D 84700016
         IECTDECB                                                       85400016
         IECTIOBX                                                       86100016
         DCBD  DSORG=BX,DEVD=BS                                         86800016
         END                                                            87500016
./  ADD  SSI=70060197,NAME=IECTSCAN
         TITLE 'IECTSCAN - SUBROUTINE TO CHANGE ALPHA-NUMERIC (SCAN)   *00001000
                        '                                               00002000
IECTSCAN CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IECTSCAN  77.006'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  ST    @14,12(,@13)                                        0001 00010000
         STM   @01,@12,24(@13)                                     0001 00011000
         BALR  @11,0                                               0001 00012000
@PSTART  DS    0H                                                  0001 00013000
         USING @PSTART,@11                                         0001 00014000
         LR    9,1                                                      00015000
*/**************************************************************/  0032 00016000
*/**************************************************************/  0032 00017000
*/*                                                            */  0032 00018000
*/*                                                            */  0032 00019000
*/* SCAN INITIAL HOUSKEEPING - THE FOLLOWING CODE SETS UP      */  0032 00020000
*/*     ADDRESSABILITY FOR THE SOURCE AREA, THE SINK AREA,     */  0032 00021000
*/*     ESTABLISHES WHETHER THE DEVICE IS REMOTE AND SETS      */  0032 00022000
*/*     RMTDV (DACFLG, BIT 7) ON IF IT IS REMOTE. IF THE       */  0032 00023000
*/*     DEVICE IS REMOTE THE SOURCE IS CHECKED FOR AN STX,     */  0032 00024000
*/*     AND IF PRESENT STXHER (DACFLG, BIT 6) IS SET ON        */  0032 00025000
*/*     AND THE STX PLACED IN THE SINK. LAST, IT IS            */  0032 00026000
*/*     DETERMINED WHETHER THIS IS A READ OR A WRITE OP,       */  0032 00027000
*/*     AND CONTROL IS PASSED TO SUBROUTINE READ OR WRITE.     */  0032 00028000
*/*                                                            */  0032 00029000
*/**************************************************************/  0032 00030000
*/**************************************************************/  0032 00031000
*           SINKAD = DACSINAD;        /*SINK ADDRESSABILIT     */  0032 00032000
         L     SINKAD,DACSINAD(,DACAD)                             0032 00033000
*           SOURAD = DACSRCAD;        /*SOURCE ADDRESSABIL     */  0033 00034000
         L     SOURAD,DACSRCAD(,DACAD)                             0033 00035000
*           IF SOURCE(DACSRCLN) = '03'X /*LAST CHARACTER ETX ? */  0034 00036000
*               THEN                  /*SET REMOTE FLAG ON     */  0034 00037000
         LH    @12,DACSRCLN(,DACAD)                                0034 00038000
         ALR   @12,SOURAD                                          0034 00039000
         BCTR  @12,0                                               0034 00040000
         CLI   SOURCE(@12),X'03'                                   0034 00041000
         BNE   @RF00034                                            0034 00042000
*                 DO;                 /*AND                    */  0035 00043000
*/**************************************************************/  0036 00044000
*/*                                                            */  0036 00045000
*/* BACKGO     FROM      WRTETX, RDETX                         */  0036 00046000
*/*      REPROCESS DATA STREAM AS REMOTE, ETX ENCOUNTERED AND  */  0036 00047000
*/* RMTDV IN DACFLG (BIT 7) WAS NOT ON                         */  0036 00048000
*/**************************************************************/  0036 00049000
*BACKGO:              RMTDV = '1'B;   /*TEST TO SEE IF AN      */  0036 00050000
BACKGO   OI    RMTDV(DACAD),B'00000001'                            0036 00051000
*                     DACIND = '02'X;                              0037 00052000
         MVI   DACIND(DACAD),X'02'                                 0037 00053000
*                     IF SOURCE(1) = '02'X /*IS STX FIRST ?    */  0038 00054000
*                         THEN        /*CHAR IN DATA STRM      */  0038 00055000
         CLI   SOURCE(SOURAD),X'02'                                0038 00056000
         BNE   @RF00038                                            0038 00057000
*                           DO;       /*SET STXHER ON AND      */  0039 00058000
*                               SOURAD = SOURAD + 1;               0040 00059000
         AH    SOURAD,@CH00061                                     0040 00060000
*                                     /*INCREMENT SOURCE POINTR*/  0041 00061000
*/**************************************************************/  0041 00062000
*/*                                                            */  0041 00063000
*/* STXPLUG    FROM     STXPLUG                                */  0041 00064000
*/*      INSERT AN STX IN THE SINK                             */  0041 00065000
*/**************************************************************/  0041 00066000
*                              STXHER = '1'B; /*MOVE STX       */  0041 00067000
         OI    STXHER(DACAD),B'00000010'                           0041 00068000
*                               DACIND = '03'X;                    0042 00069000
         MVI   DACIND(DACAD),X'03'                                 0042 00070000
*                                     /*SET INDICATOR BYTE     */  0043 00071000
*STXPLUG:;                                                         0043 00072000
STXPLUG  DS    0H                                                  0044 00073000
*                               SINK(1) = '02'X;                   0044 00074000
         MVI   SINK(SINKAD),X'02'                                  0044 00075000
*                                     /*FROM SOURCE TO SIN     */  0045 00076000
*                              SINKAD = SINKAD + 1;                0045 00077000
         AH    SINKAD,@CH00061                                     0045 00078000
*                                     /*INCREMENT SINK PTR     */  0046 00079000
*                           END;      /*IF NO STX              */  0046 00080000
*                ELSE                                              0047 00081000
*                     GO TO STXPLUG;  /*SET AN STX             */  0047 00082000
*                 END;                /*IF NO ETX OR ETB       */  0048 00083000
*               ELSE;                 /*RMTDX NOT SET ON       */  0049 00084000
@RF00034 DS    0H                                                  0050 00085000
*           IF RMTDV = '1'B                                        0050 00086000
*                THEN                                              0050 00087000
         TM    RMTDV(DACAD),B'00000001'                            0050 00088000
         BNO   @RF00050                                            0050 00089000
*                  DO;                                             0051 00090000
*                     GEN  REFS(DACAD) SETS(DACIND,SPECAR) SEQFLOW ;    00091000
         SR    SPECAR,SPECAR                                            00092000
         IC    SPECAR,DACIND(DACAD)                     Y02947          00093000
         AH    SPECAR,HAF3                                              00094000
         STC   SPECAR,DACIND(DACAD)                     Y02947          00095000
*                  END;                                            0053 00096000
*                ELSE DACIND = '03'X;                              0054 00097000
         B     @RC00050                                            0054 00098000
@RF00050 MVI   DACIND(DACAD),X'03'                                 0054 00099000
*           GEN REFS(DACOPTYP,DACAD) FLOWS(READ) SEQFLOW  /*Y02947*/ ;  00100000
@RC00050 DS    0H                                                  0055 00101000
         TM    DACOPTYP(DACAD),X'07'         IS IT A READ OPTYPE        00102000
         BNZ   READ                  YES GO TO READ, NO FALL            00103000
*           GEN;                                                   0056 00104000
         EJECT                                                          00105000
*/*     FOLLOWING ARE THE FLOW CHARTING STATEMENTS FOR THE     */  0057 00106000
*/*     PRECEDING CODE:                                        */  0057 00107000
*/*IECTSCAN: CHART                                             */  0057 00108000
*/* HEADER                                                         0057 00109000
*/*        IECTSCAN - SUBROUTINE TO CHANGE ALPHA-NUMERIC (SCAN)    0057 00110000
*/*                                            PAGE #          */  0057 00111000
*/*IECTSCAN:     E SCAN ENTRY (AND ENTRY - INITIAL                 0057 00112000
*/*                HOUSEKEEPING)                               */  0057 00113000
*/*              P ESTABLISH SINK, SOURCE, AND DACA                0057 00114000
*/*                ADDRESSABILITY                              */  0057 00115000
*/*              D (NO,%RMTDV,YES,) IS ETX LAST                    0057 00116000
*/*                CHARACTER IN SOURCE ?                       */  0057 00117000
*/*BACKGO:       P SET RMTDV ON, SET DACIND TO '02'X           */  0057 00118000
*/*              D (NO,STXPLUG,YES,) IS STX FIRST                  0057 00119000
*/*                CHARACTER IN SOURCE ?                       */  0057 00120000
*/*              P BUMP SOURCE ONE                             */  0057 00121000
*/*STXPLUG:      P SET STXHER ON, SET DACIND TO '03'X, MOVE        0057 00122000
*/*                STX TO SINK, BUMP SINK                      */  0057 00123000
*/*%RMTDV:       D (NO,%NORMTDV,YES,) IS RMTDV ON ?            */  0057 00124000
*/*              P (,%WHATOP) ADD THREE TO DACIND              */  0057 00125000
*/*%NORMTDV:     P SET DACIND TO THREE                         */  0057 00126000
*/*%WHATOP:      D (RD,READ,WR,WRITE) IS IT A READ OR A WRITE      0057 00127000
*/*                OPERATION ?                                 */  0057 00128000
*        GEN;                                                      0057 00129000
         EJECT                                                          00130000
*/**************************************************************/  0058 00131000
*/**************************************************************/  0058 00132000
*/*                                                            */  0058 00133000
*/*                                                            */  0058 00134000
*/* WRITE MAJOR ENTRY FROM HOUSEKEEPING TO PROCESS ALL         */  0058 00135000
*/*      OUTPUT DATA STREAMS. THIS INITIAL CODE PERFORMS       */  0058 00136000
*/*      THOSE HOUSEKEEPING FUNCTIONS SPECIFICALLY RELATED     */  0058 00137000
*/*      TO OUTPUT DATA STREAMS. IT INSERTS THE OPENING        */  0058 00138000
*/*      ORDERS AND CONTROL NESSECARY FOR THE 3270. THE        */  0058 00139000
*/*      INSERTIONS ARE BASED UPON THE CONDITION OF RMTDV      */  0058 00140000
*/*      (DACFLG, BIT 7) AND DACOPTYP (WHICH TYPE OF WRITE     */  0058 00141000
*/*      OPERATION TO BE DEALT WITH).                          */  0058 00142000
*/*       THIS SECTION ALSO MAKE THE DETERMINATION TO (AND     */  0058 00143000
*/*      INSERTS IF NEEDED) PLACE ORDER TO NULL AN             */  0058 00144000
*/*      EXISTING START OF MESSAGE ON THE 3270 SCREEN IN       */  0058 00145000
*/*      THE DATA STREAM. THIS IS BASED ON THE CONDITION       */  0058 00146000
*/*      OF SHRD (DACFLAG, BIT 1) AND DACSOMAD (ALL ONES       */  0058 00147000
*/*      OR A VALID ADDRESS). THE SCREEN IS SET TO BLANKS      */  0058 00148000
*/*      IF RVOID = NO WAS SPECIFIED ON A WRITE ERASE (IE:     */  0058 00149000
*/*      DACFLG, BIT 0 SET TO 0). CONTROL IS THEN PASSED       */  0058 00150000
*/*      TO WRITENT.                                           */  0058 00151000
*/*                                                            */  0058 00152000
*/**************************************************************/  0058 00153000
*/**************************************************************/  0058 00154000
*WRITE:;                              /*ENTRY FOR OUTPUTS      */  0058 00155000
WRITE    DS    0H                                                  0059 00156000
*           IF RMTDV = '1'B           /*IS IT REMOTE           */  0059 00157000
*                THEN                 /*YES, PUT ESCAPE        */  0059 00158000
         TM    RMTDV(DACAD),B'00000001'                            0059 00159000
         BNO   @RF00059                                            0059 00160000
*                  DO;                /*SEQUENCE IN SINK       */  0060 00161000
*                     SINK(1) = '27'X; /*AND INCREMENT THE     */  0061 00162000
         MVI   SINK(SINKAD),X'27'                                  0061 00163000
*                     SINKAD = SINKAD + 1; /*SINK PTR          */  0062 00164000
         LA    @12,1                                               0062 00165000
         ALR   SINKAD,@12                                          0062 00166000
*                     IF EWR = '1'B   /*ERASE WRITE ?          */  0063 00167000
*                          THEN       /*YES, PUT COMMAND       */  0063 00168000
         TM    EWR(DACAD),B'00001000'                              0063 00169000
         BNO   @RF00063                                            0063 00170000
*                            DO;      /*CODE OF 5 IN SINK      */  0064 00171000
*                               SINK(1) = 'F5'X; /*INCREMENT   */  0065 00172000
         MVI   SINK(SINKAD),X'F5'                                  0065 00173000
*                               SINKAD = SINKAD + 1;               0066 00174000
         ALR   SINKAD,@12                                          0066 00175000
*/**************************************************************/  0067 00176000
*/*                                                            */  0067 00177000
*/* REMTEWR    FROM      RTASET                                */  0067 00178000
*/*      ESTABLISH WCC, SCREEN FORMATTING ORDERS FOR AN ERASE  */  0067 00179000
*/* WRITE OPERATION TYPE                                       */  0067 00180000
*/**************************************************************/  0067 00181000
*REMTEWR:;                            /*THE SINK PTR           */  0067 00182000
REMTEWR  DS    0H                                                  0068 00183000
*           GEN SETS(SPECAR) REFS(ANWIDE,DACAD) SEQFLOW  /*Y02947*/ ;   00184000
         SR    SPECAR,SPECAR          CLEAR A WORK REG                  00185000
         IC    SPECAR,ANWIDE(DACAD)       PICK UP ANWIDE                00186000
         SRL   SPECAR,6               MAKE AN ARGUMENT                  00187000
         LA    SPECAR,1(SPECAR)       PREVENT ZERO ARGUMENT             00188000
*                               SINK(1) = WCCTAB(SPECAR);          0069 00189000
         LA    @12,WCCTAB-1(SPECAR)                                0069 00190000
         MVC   SINK(1,SINKAD),0(@12)                               0069 00191000
*                                     /* PUT WCC               */  0070 00192000
*                                     /*IN THE SINK AND        */  0070 00193000
*                               SINKAD = SINKAD + 1;               0070 00194000
         AH    SINKAD,@CH00061                                     0070 00195000
*                                     /*INCREMENT THE SINK     */  0071 00196000
*/**************************************************************/  0071 00197000
*/*                                                            */  0071 00198000
*/* RTASET     FROM      (NO REFERENCES)                       */  0071 00199000
*/*      REPEAT TO ADDRESS ORDER INSERTION, TO CLEAR SCREEN    */  0071 00200000
*/* TO BLANKS IF RVOID = NO                                    */  0071 00201000
*/**************************************************************/  0071 00202000
*RTASET:;                             /*NULL OR BLANK SCREEN ? */  0071 00203000
RTASET   DS    0H                                                  0072 00204000
*                               IF RVOID = '1'B /*NULL ?       */  0072 00205000
*                                    THEN GO TO WRITENT;           0072 00206000
         TM    RVOID(DACAD),B'10000000'                            0072 00207000
         BO    @RT00072                                            0072 00208000
*                                     /*ALREADY NULLS          */  0074 00209000
*                                    ELSE; /*SET UP TO         */  0074 00210000
*           GEN SETS(REG0,SPECAR) REFS(BLNK,BUILDEND) SEQFLOW      0075 00211000
*                                       /*Y02947*/   ;             0075 00212000
         SR    REG0,REG0                                                00213000
         IC    REG0,BLNK                                                00214000
         LA    SPECAR,BUILDEND                                          00215000
*RTABUILD:;                                                        0076 00216000
RTABUILD DS    0H                                                  0077 00217000
*           GEN REFS(DACDSSCR,ANWIDE,ANLINE,REG0,DACOPTYP)         0077 00218000
*             SETS(WORKREG1,WORKREG2,WORKREG3,WORKREG4,CURSAD)     0077 00219000
*                FLOWS(BUILDEND,WITCH4)                  /*02947*/  ;   00220000
         LA    WORKREG1,480                  GET MAX RTA LENGTH         00221000
         SR    WORKREG2,WORKREG2              CLEAR A WORK REGISTER     00222000
         IC    WORKREG2,DSLINE(DACAD)       PICK UP 2260 LINE COUNT     00223000
         SR    WORKREG4,WORKREG4             CLEAR A WORK REGISTER      00224000
         IC    WORKREG4,ANWIDE(DACAD)            PICK UP 3270 WIDTH     00225000
         SR    WORKREG3,WORKREG3              CLEAR A WORK REGISTER     00226000
         IC    WORKREG3,ANLINE(DACAD)         PICK UP 3270 LINE COUNT   00227000
         SR    CURSAD,CURSAD           CLEAR CURSOR FOR SET UP          00228000
         LTR   REG0,REG0                     RTA TO END OF 3270 ?       00229000
         BNZ   UPPER                   NO, THEN BLANK 2260              00230000
         SR    WORKREG3,WORKREG2              GET EXCESS LINE COUNT     00231000
         B     CALC1                   GO SEE HOW MUCH TO RTA           00232000
UPPER    EQU   *                       WANTS TO BLANK 2260              00233000
         LR    WORKREG3,WORKREG2       GET 2260 LINE COUNT              00234000
CALC1    EQU   *                       COMPUTE RTA COUNT                00235000
         MR    WORKREG4,WORKREG4           LINES TIMES WIDTH            00236000
         LTR   REG0,REG0               RTA 2260 SCREEN TO BLANK ?       00237000
         BNZ   CALC2                   YES, GO FIGURE NUMBER RTAS       00238000
         TM    DACOPTYP(DACAD),X'40'   PROT = YES SPECIFIED ?           00239000
         BNO   CALC2                   NO, GO FIGURE NUMBER RTAS        00240000
         BCTR  WORKREG3,0              REDUCE COUNT FOR ATTRIBUTE       00241000
CALC2    EQU   *                       FIGURE NUMBER OF RTAS            00242000
         SR    WORKREG4,WORKREG4       CLEAR HIGH HALF OF DIVIDEND      00243000
         DR    WORKREG4,WORKREG1           480 INTO COUNT               00244000
         LR    WORKREG1,WORKREG4           SAVE THE REMAINDER           00245000
         LR    WORKREG2,WORKREG3                   SAVE THE QUOTIENT    00246000
         LTR   REG0,REG0               RTA TO END OF 3270 ?             00247000
         BNZ   UPHLF                   NO, GO SET TO BLNK 2260          00248000
         SR    WORKREG4,WORKREG4           CLEAR A WORK REGISTER        00249000
         IC    WORKREG4,DSLINE(DACAD)    PICK 2260 LINE COUNT           00250000
         SR    WORKREG3,WORKREG3       CLEAR A WORK REGISTER            00251000
         IC    WORKREG3,ANWIDE(DACAD)  PICK UP 3270 WIDTH               00252000
         MR    WORKREG4,WORKREG4           GET END OF 2260 IN BUFFER    00253000
         BCTR  WORKREG3,0              ACCOUNT FOR FIRST POS 0  YA01253 00254000
         LR    CURSAD,WORKREG3         SAVE FINAL RTA ADDRESS           00255000
         B     LOWHLF                  GO PREPARE TO NULL 3270          00256000
UPHLF    EQU   *                       WANTS TO BLANK 2260              00257000
         LTR   WORKREG2,WORKREG2       RTA COUNT 480 OR MORE ?          00258000
         BNZ   PAT                     YES, GENERATE RTAS               00259000
         LTR   WORKREG1,WORKREG1       ANY REMAINING COUNT ?            00260000
         BZ    RETBCK                  NO, RETURN TO CALLER             00261000
         AR    CURSAD,WORKREG1         YES, BUMP THE CURSOR             00262000
         B     SETORD                  GO DO ONE RTA                    00263000
LOWHLF   EQU   *                       WANTS TO NULL 3270               00264000
         LTR   WORKREG2,WORKREG2       RTA COUNT 480 OR MORE ?          00265000
         BNZ   ONTST                   YES, CONTINUE SET UP             00266000
         SR    CURSAD,CURSAD           RTA ADDRESS TO BUFFER ZERO       00267000
         B     SETORD                  GO DO ONE RTA TO ZERO            00268000
ONTST    EQU   *                       MORE THAN 480 AT BOTTOM          00269000
         BCT   WORKREG2,UPPIT          MORE THAN 960 GO TO UPPIT        00270000
         LTR   WORKREG1,WORKREG1       ANY REMAINING COUNT ?            00271000
         BNZ   UPPITY                  YES, CONTINUE SET UP             00272000
         SR    CURSAD,CURSAD           SET ADDRESS TO BUFFER ZERO       00273000
         B     SETORD                  GO DO ONE RTA TO ZERO            00274000
UPPIT    EQU   *                       960 OR MORE TO DO AT BOTTOM      00275000
         LTR   WORKREG1,WORKREG1       ODD COUNT REMAINING ?            00276000
         BZ    PAT                     NO, GO DO RTAS                   00277000
UPPITY   EQU   *                       480 + TO DO AT BOTTOM            00278000
         LA    WORKREG2,1(WORKREG2)    PUT RTA COUNT BACK               00279000
PAT      EQU   *                       INITIAL ENTRY TO LOOP            00280000
         LA    WORKREG2,1(WORKREG2)    BUMP COUNT FOR LOOP              00281000
RAT      EQU   *                       LOOP ITERATION ENTRY             00282000
         BCT   WORKREG2,LOOP           MORE 480 BYTE RTAS TO DO ?       00283000
         B     LOOPDONE                NO, DO FINAL SET UP              00284000
LOOP     EQU   *                       CONSTRUCT RTA SEQUENCES          00285000
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                        00286000
*                                    ARE THE SCREENS EQUAL  ?   YA01253 00287000
         BNE   LOOP1                   NO, GO SET UP RTA        YA01253 00288000
         LTR   WORKREG1,WORKREG1       MORE RTAS AFTER THIS ?   YA01253 00289000
         BNZ   LOOP1                   YES, GO SET UP RTA       YA01253 00290000
         C     WORKREG2,ONE            MORE RTAS AFTER THIS ?   YA01253 00291000
         BH    LOOP1                   YES, GO SET UP RTA       YA01253 00292000
         XR    CURSAD,CURSAD           CURSOR AT ZERO          @YA02151 00293000
         B     SETORD                  DO RTA TO ZERO           YA01253 00294000
LOOP1    EQU   *                                                YA01253 00295000
         LA    CURSAD,480(CURSAD)      SET RTA ADDRESS                  00296000
SETORD   EQU   *                       ENTRY FOR SINGLE RTA             00297000
*                                      REG 12 MUST BE ZERO              00298000
         MVI   0(SINKAD),X'3C'         INSERT RTA ORDER IN SINK         00299000
         LA    SINKAD,1(SINKAD)        BUMP SINK POINTER                00300000
         BAL   CARADD,OUTVERT          GO COMPUTE ADDRESS IN 3270       00301000
         SR    CARADD,CARADD           CLEAR LINK REG                   00302000
         STC   REG0,0(SINKAD)          PUT REPEATED CHARACTER           00303000
         LA    SINKAD,1(SINKAD)        BUMP SINK POINTER                00304000
         LTR   WORKREG2,WORKREG2       LOOP COUNTER AT ZERO ?           00305000
         BNZ   RAT                     NO, STAY IN LOOP                 00306000
RETBCK   EQU   *                       RETURN TO CALLER                 00307000
         BR    SPECAR                  GO TO ADDRESS IN SPECAR          00308000
LOOPDONE EQU   *                       ALL 480 BYTE RTAS DONE           00309000
         LTR   REG0,REG0               DOING 2260 SCREEN ?              00310000
         BZ    LOWHLF                  NO, GO SEE IF MORE AT BOTTOM     00311000
         B     UPHLF                   YES, GO SEE IF MORE 2260         00312000
*BUILDEND:;                                                        0078 00313000
BUILDEND DS    0H                                                  0079 00314000
*                               SINK(1) = '11'X;                   0079 00315000
         MVI   SINK(SINKAD),X'11'                                  0079 00316000
*                                     /*SET BUFFER TO FRST     */  0080 00317000
*                               SINKAD = SINKAD + 1;               0080 00318000
         AH    SINKAD,@CH00061                                     0080 00319000
*                                     /*OF 3270 SCREEN         */  0081 00320000
*                               SINK(1) = '40'X;                   0081 00321000
         MVI   SINK(SINKAD),X'40'                                  0081 00322000
*                               SINK(2) = '40'X;                   0082 00323000
         MVI   SINK+1(SINKAD),X'40'                                0082 00324000
*                               SINKAD = SINKAD + 2;               0083 00325000
         AH    SINKAD,@CH00059                                     0083 00326000
*                               DACSOMAD = ALLONE;                 0084 00327000
         MVC   DACSOMAD(2,DACAD),ALLONE                            0084 00328000
*                                     /*SET NO SOM INDICAT     */  0085 00329000
*                               GO TO WRITENT;                     0085 00330000
         B     WRITENT                                             0085 00331000
*                            END;                                  0086 00332000
*                          ELSE       /*IF NOT ERASE WRITE     */  0087 00333000
*                            DO;      /*PLUG COMMAND CODE      */  0087 00334000
@RF00063 DS    0H                                                  0088 00335000
*                               SINK(1) = 'F1'X; /* OF ONE     */  0088 00336000
         MVI   SINK(SINKAD),X'F1'                                  0088 00337000
*                               SINKAD = SINKAD + 1;               0089 00338000
         AH    SINKAD,@CH00061                                     0089 00339000
*                                     /*INCREMENT SINK PTR     */  0090 00340000
*                               GO TO LOCLWR;                      0090 00341000
         B     LOCLWR                                              0090 00342000
*                            END;                                  0091 00343000
*                  END;                                            0092 00344000
*                ELSE;                                             0093 00345000
@RF00059 DS    0H                                                  0094 00346000
*           IF EWR = '1'B             /*IS IT ERASE WRITE      */  0094 00347000
*                THEN GO TO REMTEWR;  /*PROCESS IT             */  0094 00348000
         TM    EWR(DACAD),B'00001000'                              0094 00349000
         BO    @RT00094                                            0094 00350000
*                ELSE;                /*NO, SET NORMAL         */  0096 00351000
*/**************************************************************/  0097 00352000
*/*                                                            */  0097 00353000
*/* LOCLWR     FROM      RTASET                                */  0097 00354000
*/*      ESTABLISH WCC, SCREEN FORMATTING ORDERS FOR WRITE TO  */  0097 00355000
*/* CURSOR, WRITE TO LINE ADDRESS OPERATION TYPES              */  0097 00356000
*/**************************************************************/  0097 00357000
*LOCLWR:;                             /*NOT ERASE WRITE        */  0097 00358000
LOCLWR   DS    0H                                                  0098 00359000
*           GEN SETS(SPECAR) REFS(DACAD,ANWIDE) SEQFLOW  /*Y02947*/ ;   00360000
         SR    SPECAR,SPECAR          CLEAR A WORK REG                  00361000
         IC    SPECAR,ANWIDE(DACAD)       PICK UP ANWIDE                00362000
         SRL   SPECAR,6               MAKE AN ARGUMENT                  00363000
         LA    SPECAR,1(SPECAR)       PREVENT ZERO ARGUMENT             00364000
*           SINK(1) = WCCTAB(SPECAR); /* PUT WCC IN SINK       */  0099 00365000
         LA    @12,WCCTAB-1(SPECAR)                                0099 00366000
         MVC   SINK(1,SINKAD),0(@12)                               0099 00367000
*           SINKAD = SINKAD + 1;      /*INCREMENT SINK PTR     */  0100 00368000
         LA    @12,1                                               0100 00369000
         ALR   SINKAD,@12                                          0100 00370000
*           IF SHRD = '0'B            /*LAST READ NOT SHOR     */  0101 00371000
*           & DACSOMAD = ALLONE      /*AND SOM PRESENT        */  0101 00372000
*                THEN                 /*THEN SET UP TO         */  0101 00373000
         TM    SHRD(DACAD),B'01000000'                             0101 00374000
         BNZ   @RF00101                                            0101 00375000
         LH    @10,DACSOMAD(,DACAD)                                0101 00376000
         CH    @10,ALLONE                                          0101 00377000
         BE    @RF00101                                            0101 00378000
*                  DO;                /*NULL PREVIOUS SOM      */  0102 00379000
*                     SINK(1) = '11'X; /* ON 3270 SCREEN       */  0103 00380000
         MVI   SINK(SINKAD),X'11'                                  0103 00381000
*                     SINKAD = SINKAD + 1;                         0104 00382000
         ALR   SINKAD,@12                                          0104 00383000
*                                     /*INCREMENT SINK PTR     */  0105 00384000
*                     CURSAD = DACSOMAD;                           0105 00385000
         LR    CURSAD,@10                                          0105 00386000
*                                     /*PICK UP SOM PTR        */  0106 00387000
*                     GEN;                                         0106 00388000
         BAL   CARADD,OUTVERT         AND CONVERT TO 3270               00389000
*                     SINK(1) = '40'X;                             0107 00390000
         MVI   SINK(SINKAD),X'40'                                  0107 00391000
*                     SINKAD = SINKAD + 1;                         0108 00392000
         LA    @12,1                                               0108 00393000
         ALR   SINKAD,@12                                          0108 00394000
*                                     /*INCREMENT SINK PTR     */  0109 00395000
*                     SINK(1) = '11'X; /* PREPARE FOR DATA     */  0109 00396000
         MVI   SINK(SINKAD),X'11'                                  0109 00397000
*                     SINKAD = SINKAD + 1;                         0110 00398000
         ALR   SINKAD,@12                                          0110 00399000
*                                     /*INCREMENT SINK PTR     */  0111 00400000
*                  END;                                            0111 00401000
*                ELSE                 /*IF NO NEED TO CLER     */  0112 00402000
*                  DO;                /*SOM, THEN PREPARE      */  0112 00403000
         B     @RC00101                                            0112 00404000
@RF00101 DS    0H                                                  0113 00405000
*                     SINK(1) = '11'X; /* FOR DATA             */  0113 00406000
         MVI   SINK(SINKAD),X'11'                                  0113 00407000
*                     SINKAD = SINKAD + 1;                         0114 00408000
         AH    SINKAD,@CH00061                                     0114 00409000
*                                     /*INCREMENT SINK PTR     */  0115 00410000
*                  END;                                            0115 00411000
*           GEN;                                                   0116 00412000
@RC00101 DS    0H                                                  0116 00413000
         EJECT                                                          00414000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0117 00415000
*/*     PRECEDING CODE -                                       */  0117 00416000
*/*WRITE:        D (NO,%NOTRMT,YES,) IS RMTDV ON ?             */  0117 00417000
*/*              P PUT ESCAPE BYTE IN SINK, BUMP SINK          */  0117 00418000
*/*              D (NO,%NOTEWR,YES,) IS THIS AN ERASE WRITE        0117 00419000
*/*                OPERATION ?                                 */  0117 00420000
*/*              P PUT COMMAND CODE OF FIVE IN SINK, BUMP          0117 00421000
*/*                SINK                                        */  0117 00422000
*/*REMTEWR:      P PUT WRITE CONTROL CHARACTER IN SINK, BUMP       0117 00423000
*/*                SINK                                        */  0117 00424000
*/*RTASET:       D (YES,WRITENT,NO,) IS RVOID = YES SPECIFIED ?*/  0117 00425000
*/*              S RTABUILD:BUILD RTA(S) TO BLANK 2260 SCREEN  */  0117 00426000
*/*RTABUILD: CHART                                             */  0117 00427000
*/*RTABUILD:     E CONSTRUCT RTA ORDERS                        */  0117 00428000
*/*              P SET UP WORK REGISTERS                       */  0117 00429000
*/*              D (YES,UPPER,NO,) RTA FOR 2260 PORTION ?      */  0117 00430000
*/*              P (,CALC1) SET TO COMPUTE 3270 PORTION        */  0117 00431000
*/*UPPER:        P SET TO COMPUTE 2260 PORTION                 */  0117 00432000
*/*CALC1:        P COMPUTE TOTAL BYTES SPANNED BY RTA          */  0117 00433000
*/*              D (YES,CALC2,NO,) RTA FOR 2260 PORTION ?      */  0117 00434000
*/*              D (NO,CALC2,YES,) PROT = YES ?                */  0117 00435000
*/*              P MODIFY RTA SPAN MINUS ONE                   */  0117 00436000
*/*CALC2:        P COMPUTE NUMBER OF RTAS NEEDED               */  0117 00437000
*/*              D (YES,UPHLF,NO,) RTA FOR 2260 PORTION ?      */  0117 00438000
*/*              P COMPUTE ADDRESS OF END OF 2260 PORTION      */  0117 00439000
*/*              P (,LOWHLF) SAVE ADDRESS IN CURSAD            */  0117 00440000
*/*UPHLF:        D (YES,PAT,NO,) AT LEAST ONE 480 BYTE RTA ?   */  0117 00441000
*/*              D (NO,RETBCK,YES,) ANY REMAINDER ?            */  0117 00442000
*/*              P (,SETORD) BUMP THE CURSOR BY THE REMAINDER  */  0117 00443000
*/*LOWHLF:       D (YES,ONTST,NO,) AT LEAST ONE 480 BYTE RTA ? */  0117 00444000
*/*              P (,SETORD) SET ADDRESS IN CURSAD TO ZERO     */  0117 00445000
*/*ONTST:        D (YES,UPPIT,NO,) AT LEAST TWO 480 BYTE RTAS ?*/  0117 00446000
*/*              D (YES,UPPITY,NO,) ANY REMAINDER ?            */  0117 00447000
*/*              P (,SETORD) SET ADDRESS IN CURSAD TO ZERO     */  0117 00448000
*/*UPPIT:        D (NO,PAT,YES,) ANY REMAINDER ?               */  0117 00449000
*/*UPPITY:       P MODIFY COUNT OF 480 BYTE RTAS               */  0117 00450000
*/*PAT:          P BUMP RTA COUNT TO COMPENSATE LOOP           */  0117 00451000
*/*RAT:          D (NO,LOOPDONE,YES,) RTA COUNT > ONE ?        */  0117 00452000
*/*LOOP:         P BUMP ADDRESS IN CURSAD BY 480               */  0117 00453000
*/*SETORD:       P PUT RTA IN SINK, BUMP SINK                  */  0117 00454000
*/*              S OUTVERT:CONVERT HEXADECIMAL TO 3270 BUFFER  */  0117 00455000
*/*              P PUT CHARACTER IN SINK, BUMP SINK            */  0117 00456000
*/*              D (YES,RAT,NO,) ANY 480 BYTE RTAS LEFT ?      */  0117 00457000
*/*RETBCK:       R BRANCH ON SPECAR                            */  0117 00458000
*/*LOOPDONE:     D (YES,UPHLF,NO,LOWHLF) RTA FOR 2260 PORTION ?*/  0117 00459000
*/*RTABUILD: END                                               */  0117 00460000
*/*IECTSCAN: CHART                                             */  0117 00461000
*/*BUILDEND:     P PUT A SET BUFFER ADDRESS ORDER IN SINK,         0117 00462000
*/*                BUMP SINK                                   */  0117 00463000
*/*              P (,WRITENT) PUT 3270 BUFFER ADDRESS ZERO         0117 00464000
*/*                IN SINK, BUMP SINK TWO, DACSOMAD =              0117 00465000
*/*                ALLONES                                     */  0117 00466000
*/*%NOTEWR:      P (,LOCLWR) PUT COMMAND CODE ONE IN SINK,         0117 00467000
*/*                BUMP SINK                                   */  0117 00468000
*/*%NOTRMT:      D (YES,REMTEWR,NO,) IS THIS ERASE WRITE           0117 00469000
*/*                OPERATION ?                                 */  0117 00470000
*/*LOCLWR:       P PUT WRITE CONTROL CHARACTER IN SINK, BUMP       0117 00471000
*/*                SINK                                        */  0117 00472000
*/*              D (NO,%NOSOM,YES,) IS AN SOM ON THE SCREEN        0117 00473000
*/*                ?                                           */  0117 00474000
*/*              P PUT SET BUFFER ADDRESS ORDER IN SINK,           0117 00475000
*/*                BUMP SINK, PICK UP SOM POINTER              */  0117 00476000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0117 00477000
*/*              P PUT A BLANK IN THE SINK, BUMP THE SINK      */  0117 00478000
*/*              P (,WRITENT) PUT A SET BUFFER ADDRESS ORDER       0117 00479000
*/*                IN THE SINK, BUMP THE SINK                  */  0117 00480000
*/*%NOSOM:       P PUT A SET BUFFER ADDRESS ORDER IN THE           0117 00481000
*/*                SINK, BUMP THE SINK                         */  0117 00482000
*        GEN;                                                      0117 00483000
         EJECT                                                          00484000
*/**************************************************************/  0118 00485000
*/**************************************************************/  0118 00486000
*/*                                                            */  0118 00487000
*/*                                                            */  0118 00488000
*/* WRITENT ENTRY PROCESSING FOR ALL OUTPUT DATA STREAMS.      */  0118 00489000
*/*      THIS CODE ESTABLISHES THE CURRENT 2260 LINE           */  0118 00490000
*/*      (MAINTAINED IN REGISTER CURLIN), THE CURRENT 2260     */  0118 00491000
*/*      CURSOR POSITION (MAINTAINED IN REGISTER CURSAD),      */  0118 00492000
*/*      AND COMPUTES THE GROUP OF CHARACTERS IN THE           */  0118 00493000
*/*      SOURCE AREA TO BE INITIALLY DEALT WITH (KEPT IN       */  0118 00494000
*/*      REGISTER LINGRO), FOR THE VARIOUS OUTPUT OP TYPES     */  0118 00495000
*/*       FOR WRITE TO CURSOR AND WRITE TO LINE ADDRESS,       */  0118 00496000
*/*      THE 3270 BUFFER POSITION OF THE FIRST CHARACTER       */  0118 00497000
*/*      POSITION IS INSERTED IN THE SINK FOLLOWING THE        */  0118 00498000
*/*      SBA PLACED THERE BY WRITE. FOR ERASE WRITE THE        */  0118 00499000
*/*      3270 BUFFER IS ALREADY AT POSITION ZERO.              */  0118 00500000
*/*       CONTROL IS PASSED TO WITCH1.                         */  0118 00501000
*/*                                                            */  0118 00502000
*/**************************************************************/  0118 00503000
*/**************************************************************/  0118 00504000
*WRITENT:;                                                         0118 00505000
WRITENT  DS    0H                                                  0119 00506000
*           IF EWR = '1'B             /*IS THIS ERASE WRIT     */  0119 00507000
*                THEN                 /*YES, ESTABLISH         */  0119 00508000
         TM    EWR(DACAD),B'00001000'                              0119 00509000
         BNO   @RF00119                                            0119 00510000
*                  DO;                /*INITIAL VALUES         */  0120 00511000
*                     CURLIN = CURLIN - CURLIN;                    0121 00512000
         SLR   CURLIN,CURLIN                                       0121 00513000
*                                     /*LINE # TO ZERO         */  0122 00514000
*                     CURSAD = CURSAD - CURSAD;                    0122 00515000
         SLR   CURSAD,CURSAD                                       0122 00516000
*                                     /*CURSOR TO ZERO         */  0123 00517000
*                     LINGRO = DSWIDE;/*GROUP TO 2260 LINE     */  0123 00518000
         SLR   LINGRO,LINGRO                                       0123 00519000
         IC    LINGRO,DSWIDE(,DACAD)                               0123 00520000
*                     GO TO WITCH1;   /*GO PROCESS DATA        */  0124 00521000
         B     WITCH1                                              0124 00522000
*                  END;               /*IF NOT ERASE WRITE     */  0125 00523000
*                ELSE;                /*IS IT WRITE TO         */  0126 00524000
@RF00119 DS    0H                                                  0127 00525000
*           IF WRCRS = '1'B           /*CURSOR                 */  0127 00526000
*                THEN                 /*YES, ESTABLISH         */  0127 00527000
         TM    WRCRS(DACAD),B'00100000'                            0127 00528000
         BNO   @RF00127                                            0127 00529000
*                  DO;                /*INITIAL VALUES         */  0128 00530000
*                     CURSAD = DACCRS;/*PICK UP CURSOR ADR     */  0129 00531000
         LH    CURSAD,DACCRS(,DACAD)                               0129 00532000
*                     SPECAR = ANWIDE;/*GET SCREEN WIDTH       */  0130 00533000
         SLR   SPECAR,SPECAR                                       0130 00534000
         IC    SPECAR,ANWIDE(,DACAD)                               0130 00535000
*/*  THE FOLLOWING 2 STATEMENTS ARE IN COMMENTS TO             */  0131 00536000
*/*  DOCUMENT THE FOLLOWING GENERATE                           */  0131 00537000
*/*                   CURLIN = CURSAD / SPECAR;                */  0131 00538000
*                                     /*DETERMINE LINE #       */  0131 00539000
*/*                   SPECAR = CURSAD // SPECAR;               */  0131 00540000
*           GEN SETS(WORKREG4,WORKREG3,CURLIN,SPECAR) REFS(CURSAD) 0131 00541000
*                                       SEQFLOW  /*Y02947*/ ;      0131 00542000
         LR    WORKREG4,CURSAD                                          00543000
         SRDA  WORKREG4,32                                              00544000
         DR    WORKREG4,SPECAR                                          00545000
         LR    CURLIN,WORKREG3                                          00546000
         LR    SPECAR,WORKREG4                                          00547000
*                                     /*CHECK TO SEE IF        */  0132 00548000
*                                     /*ANY EXCESS BEYOND      */  0132 00549000
*                     IF SPECAR = FULL0 /*LINE BOUNDRY         */  0132 00550000
*                          THEN       /* NO, SET GROUP TO      */  0132 00551000
         C     SPECAR,FULL0                                        0132 00552000
         BNE   @RF00132                                            0132 00553000
*                            DO;      /*2260 SCREEN WIDTH      */  0133 00554000
*                               LINGRO = DSWIDE;                   0134 00555000
         SLR   LINGRO,LINGRO                                       0134 00556000
         IC    LINGRO,DSWIDE(,DACAD)                               0134 00557000
*                               GO TO OP1;                         0135 00558000
         B     OP1                                                 0135 00559000
*                            END;     /*YES, SET GROUP TO      */  0136 00560000
*                          ELSE       /*REMAINDER OF LINE      */  0137 00561000
*                                  LINGRO = DSWIDE - SPECAR;       0137 00562000
@RF00132 SLR   LINGRO,LINGRO                                       0137 00563000
         IC    LINGRO,DSWIDE(,DACAD)                               0137 00564000
         SLR   LINGRO,SPECAR                                       0137 00565000
*                     GO TO OP1;      /*CURSOR TO 3270         */  0138 00566000
         B     OP1                                                 0138 00567000
*                  END;               /*NOT WRITE TO CURSR     */  0139 00568000
*                ELSE;                /*THEN MUST BE WRITE     */  0140 00569000
@RF00127 DS    0H                                                  0141 00570000
*           IF SOURCE(1) > 'FB'X | SOURCE(1) < 'F0'X               0141 00571000
*                THEN GO TO OUTERR;                                0141 00572000
         CLI   SOURCE(SOURAD),X'FB'                                0141 00573000
         BH    @RT00141                                            0141 00574000
         CLI   SOURCE(SOURAD),X'F0'                                0141 00575000
         BL    @RT00141                                            0141 00576000
*                ELSE;                                             0143 00577000
*           GEN SETS(CURLIN) REFS(SOURAD) SEQFLOW   /*Y02947*/  ;  0144 00578000
         SR    CURLIN,CURLIN                                            00579000
         IC    CURLIN,0(SOURAD)                                         00580000
         SLL   CURLIN,28           SHIFT OUT ZONES             @YA02150 00581000
         SRL   CURLIN,28           REPOSITION VALUE            @YA02150 00582000
*           SPECAR = ANWIDE;          /*GET 3270  WIDTH        */  0145 00583000
         SLR   SPECAR,SPECAR                                       0145 00584000
         IC    SPECAR,ANWIDE(,DACAD)                               0145 00585000
*           CURSAD = CURLIN * SPECAR; /*CALCULATE BUFFER       */  0146 00586000
         LR    @15,SPECAR                                          0146 00587000
         MR    @14,CURLIN                                          0146 00588000
         LR    CURSAD,@15                                          0146 00589000
*                                     /*POSITION OF LINE       */  0147 00590000
*           SOURAD = SOURAD + 1;      /*INCREMENT SOURCE       */  0147 00591000
         AH    SOURAD,@CH00061                                     0147 00592000
*           LINGRO = DSWIDE;          /*GROUP TO 2260 LINE     */  0148 00593000
         SLR   LINGRO,LINGRO                                       0148 00594000
         IC    LINGRO,DSWIDE(,DACAD)                               0148 00595000
*/**************************************************************/  0149 00596000
*/*                                                            */  0149 00597000
*/* OP1        FROM      WRITENT                               */  0149 00598000
*/*      INVOKE OUTVERT TO CALCULATE 3270 BUFFER POSITION FOR  */  0149 00599000
*/* BEGINNING OF WRITE OPERATION                               */  0149 00600000
*/**************************************************************/  0149 00601000
*OP1:;                                /*USE OUTVERT ROUTNE     */  0149 00602000
OP1      DS    0H                                                  0150 00603000
*           GEN;                                                   0150 00604000
         BAL   CARADD,OUTVERT         TO CALCULATE BUFFER               00605000
*                                     /*POSITION               */  0151 00606000
*        GO TO WITCH1;                /*GO PROCESS DATA        */  0151 00607000
         B     WITCH1                                              0151 00608000
*           GEN ;                                                  0152 00609000
         EJECT                                                          00610000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0153 00611000
*/*     PRECEDING CODE -                                       */  0153 00612000
*/*WRITENT:      D (NO,%EWRNOT,YES,) IS THIS AN ERASE WRITE        0153 00613000
*/*                OPERATION ?                                 */  0153 00614000
*/*              P (,WITCH1) CLEAR CURLIN, CURSAD,SET LINGRO TO    0153 00615000
*/*                2260 SCREEN WIDTH                           */  0153 00616000
*/*%EWRNOT:      D (YES,%WLA,NO,) IS THIS A WRITE TO LINE          0153 00617000
*/*                ADDRESS OPERATION ?                         */  0153 00618000
*/*              P PICK UP CURSOR FROM DACCRS, GET 3270            0153 00619000
*/*                SCREEN WIDTH, FIGURE LINE NUMBER            */  0153 00620000
*/*              D (YES,%LINBDY,NO,) EXCESS BEYOND LINE            0153 00621000
*/*                BOUNDRY ?                                   */  0153 00622000
*/*              P (,OP1) SET LINGRO TO 2260 SCREEN WIDTH      */  0153 00623000
*/*%LINBDY:      P (,OP1) SET LINGRO TO REMAINDER OF 2260          0153 00624000
*/*                LINE                                        */  0153 00625000
*/*%WLA:         D (YES,%OK,NO,OUTERR) LINE ADDRESS CHARACTER      0153 00626000
*/*                VALID ?                                     */  0153 00627000
*/*%OK:          P SET CURLIN TO LINE NUMBER, COMPUTE              0153 00628000
*/*                ADDRESS FROM LINE NUMBER                    */  0153 00629000
*/*OP1:          S (,WITCH1) OUTVERT: CONVERT HEXIDECIMAL TO       0153 00630000
*/*                3270 BUFFER                                 */  0153 00631000
*        GEN;                                                      0153 00632000
         EJECT                                                          00633000
*/**************************************************************/  0154 00634000
*/**************************************************************/  0154 00635000
*/*                                                            */  0154 00636000
*/*                                                            */  0154 00637000
*/*WITCH INITIALIZATION, TERMINATION, AND DATA STREAM          */  0154 00638000
*/*    PROCESSING (NOT INVOLVING SPECIAL CHARACTERS) WHICH     */  0154 00639000
*/*    IS SPECIFICALLY RELATED TO THE DATA.                    */  0154 00640000
*/*    WITCH3, WITCH4, AND NOCHAR, WHICH ARE DESCRIBED         */  0154 00641000
*/*      WITCH CONTAINS FIVE SECTIONS, WITCH1, WITCH2,         */  0154 00642000
*/*    IN THE FOLLOWING TEXT -                                 */  0154 00643000
*/*                                                            */  0154 00644000
*/*    WITCH1 IS ENTERED FROM WRITENT, WITCH4, AND SETTLE      */  0154 00645000
*/*    (IN WRSPCHAR). WITCH1 VERIFIES THE SINK, IF TOO         */  0154 00646000
*/*    SMALL IT PASSES CONTROL TO OUTSINK, VERIFIES THE        */  0154 00647000
*/*    SIZE OF THE GROUP OF DATA UNDER CONSIDERATION (IN       */  0154 00648000
*/*    REGISTER LINGRO), IF ZERO IT PASSES CONTROL TO WIT.     */  0154 00649000
*/*    THE PRIME FUNCTION OF WITCH1 IS TO SEARCH FOR           */  0154 00650000
*/*    CERTAIN CHARACTERS WHICH REQUIRE UNIQUE PROCESSING.     */  0154 00651000
*/*    THIS IS ACCOMPLISHED BY EXECUTING A TRANSLATE AND       */  0154 00652000
*/*    TEST (XLATE) AGAINST THE DATA GROUP USING TABLE.        */  0154 00653000
*/*    THE SECONDARY FUNCTION IS TO MOVE ALL CHARACTERS        */  0154 00654000
*/*    WHICH ARE NOT FOUND BY XLATE TO THE SINK AREA. IF       */  0154 00655000
*/*    A UNIQUE CHARACTER IS DISCOVERED, ONLY THOSE            */  0154 00656000
*/*    CHARACTERS PRECEDING IT IN THE DATA GROUP ARE MOVED     */  0154 00657000
*/*    TO THE SINK AREA, AND SPECIAL PROCESSING TAKES          */  0154 00658000
*/*    FOR THE SELECTED CHARACTER. A BRANCH IS MADE INTO       */  0154 00659000
*/*    WRSPCHAR TO ACCOMPLICH THIS PROCESSING. THE BRANCH      */  0154 00660000
*/*    ADDRESS IS DETERMINED BY THE FUNCTION BYTE SELECTED     */  0154 00661000
*/*    FROM TABLE BY XLATE. IF NO SPECIAL PROCESSING IS        */  0154 00662000
*/*    NEEDED, CONTROL PASSES TO NOCHAR.                       */  0154 00663000
*/*                                                            */  0154 00664000
*/*    NOCHAR 7OVES THE ENTIRE DATA GROUP TO THE SINK,         */  0154 00665000
*/*    INCREMENTS THE SINK AND SOURCE POINTERS AND THE         */  0154 00666000
*/*    CURSOR, CHECKS TO SEE IF ALL OF THE DATA HAS BEEN       */  0154 00667000
*/*    PROCESSED AND PASSES CONTROL TO WIT IF IT HAS. IF       */  0154 00668000
*/*    MORE DATA REMAINS, CONTROL IS PASSED TO WITCH2.         */  0154 00669000
*/*                                                            */  0154 00670000
*/*    WITCH2 INCREMENTS THE CURRENT LINE AND TESTS FOR        */  0154 00671000
*/*    SCREEN WRAP. IF WRAP EXISTS, CONTROL IS PASSED TO       */  0154 00672000
*/*    WALL. IF WRAP DOES NOT EXIST, THE CURSOR IS             */  0154 00673000
*/*    ADJUSTED TO THE BEGINNING OF THE NEXT 3270 LINE.        */  0154 00674000
*/*    THE 2260 AND 3270 SCREENS ARE COMPARED AND IF NOT       */  0154 00675000
*/*    EQUAL CONTROL IS PASSED TO WITCH3. IF THE 2260 AND      */  0154 00676000
*/*    3270 SCREEN ARE EQUAL, CONTROL IS PASSED TO WITCH4.     */  0154 00677000
*/*    WITCH2 MAY BE ENTERED FROM NOCHAR, WRTNEWL (IN          */  0154 00678000
*/*    WRSPCHAR).                                              */  0154 00679000
*/*                                                            */  0154 00680000
*/*    WITCH3 INSERTS A REPEAT TO ADDRESS ORDER TO NULL        */  0154 00681000
*/*    THE EXCESS 3270 SCREEN OVER THE 2260 IMAGE. CONTROL     */  0154 00682000
*/*    PASSES TO WITCH4.                                       */  0154 00683000
*/*                                                            */  0154 00684000
*/*    WITCH4 SETS THE GROUPING TO EQUAL THE 2260 WIDTH.       */  0154 00685000
*/*    CONTROL IS PASSED TO WITCH1.                            */  0154 00686000
*/*                                                            */  0154 00687000
*/**************************************************************/  0154 00688000
*/**************************************************************/  0154 00689000
*WITCH1:    GEN SETS(DACSRCAD) REFS(DACAD) SEQFLOW  /*Y02947*/  ;  0154 00690000
WITCH1   DS    0H                                                  0154 00691000
         MVI   DACSRCAD(DACAD),X'00'   INSURE HIGH BYTE CLEAR   YA01252 00692000
*           IF DACSRCAD + DACSRCLN <= SOURAD + LINGRO              0155 00693000
*                THEN                                              0155 00694000
         LH    @12,DACSRCLN(,DACAD)                                0155 00695000
         AL    @12,DACSRCAD(,DACAD)                                0155 00696000
         LR    @10,SOURAD                                          0155 00697000
         ALR   @10,LINGRO                                          0155 00698000
         CR    @12,@10                                             0155 00699000
         BH    @RF00155                                            0155 00700000
*                  DO;                                             0156 00701000
*                     LINGRO = DACSRCAD + DACSRCLN - SOURAD;       0157 00702000
         SLR   @12,SOURAD                                          0157 00703000
         LR    LINGRO,@12                                          0157 00704000
*                     IF LINGRO = FULL0                            0158 00705000
*                          THEN GO TO WRTEND;                      0158 00706000
         C     LINGRO,FULL0                                        0158 00707000
         BE    @RT00158                                            0158 00708000
*                          ELSE;                                   0160 00709000
*                  END;                                            0161 00710000
*                ELSE;                                             0162 00711000
@RF00155 DS    0H                                                  0163 00712000
*           IF DACSINAD + DACSINLN <= SINKAD + LINGRO              0163 00713000
*                THEN GO TO OUTSINK;                               0163 00714000
         LH    @12,DACSINLN(,DACAD)                                0163 00715000
         AL    @12,DACSINAD(,DACAD)                                0163 00716000
         LR    @10,SINKAD                                          0163 00717000
         ALR   @10,LINGRO                                          0163 00718000
         CR    @12,@10                                             0163 00719000
         BNH   @RT00163                                            0163 00720000
*                ELSE;                                             0165 00721000
*           GEN SETS(SPECAR,CARADD,LINGRO,WORKREG4,DACSRCAD)       0166 00722000
*             REFS(XLATE,SOURAD,DACAD) FLOWS(NOCHAR) SEQFLOW       0166 00723000
*                                                       /*Y02947*/  ;   00724000
         SR    SPECAR,SPECAR                                            00725000
         SR    CARADD,CARADD                                            00726000
         BCTR  LINGRO,0                 MAKE IT VALID LENGTH            00727000
         EX    LINGRO,XLATE                                             00728000
         BC    8,NOCHAR                                                 00729000
         SR    WORKREG4,WORKREG4     CLEAR A WORK REGISTER       CODE2  00730000
         LR    WORKREG4,CARADD       PICK UP CHARACTER ADDRESS   CODE2  00731000
         SR    WORKREG4,SOURAD       REDUCE BY START ADDRESS     CODE2  00732000
         SR    LINGRO,WORKREG4       CALCULATE REMAINDER         CODE2  00733000
         STC   LINGRO,DACSRCAD(DACAD)     SAVE VALUE             CODE2  00734000
*           LINGRO = CARADD - SOURAD; /*GROUP PRIOR TO SPECIAL */  0167 00735000
         LR    LINGRO,CARADD                                       0167 00736000
         SLR   LINGRO,SOURAD                                       0167 00737000
*           IF LINGRO = FULL0                                     0168 00738000
*                THEN                                              0168 00739000
         C     LINGRO,FULL0                                        0168 00740000
         BE    @RF00168                                            0168 00741000
*                  DO;                                             0169 00742000
*           GEN SETS(LINGRO) REFS(MYMOV) SEQFLOW   /*Y02947*/  ;   0170 00743000
         BCTR  LINGRO,0                                                 00744000
         EX    LINGRO,MYMOV                                             00745000
         LA    LINGRO,1(LINGRO)                                         00746000
*                     SINKAD = SINKAD + LINGRO;                    0171 00747000
         ALR   SINKAD,LINGRO                                       0171 00748000
*                     SOURAD = SOURAD + LINGRO;                    0172 00749000
         ALR   SOURAD,LINGRO                                       0172 00750000
*                  END;                                            0173 00751000
*                ELSE;                                             0174 00752000
@RF00168 DS    0H                                                  0175 00753000
*           GEN SETS (SPECAR) FLOWS (NOCHAR,WRTNLL,WRTNEWL,        0175 00754000
*            WRTSOM,WRTEOM,WRTETX) NOSEQFLOW  ;              /*Y02947*/ 00755000
         SLL   SPECAR,2                 MULTIPLY BY FOUR                00756000
         B     BRANTAB(SPECAR)          BRANCH ON ARGUMENT              00757000
*********************************************************************** 00758000
*                                                                       00759000
*   BRANTAB    FROM      PREVIOUS INSTRUCTION ONLY                      00760000
*        BRANCH UPON ARGUMENT IN SPECAR TO APPROPRIATE UNIQUE           00761000
*   CHARACTER HANDLING ROUTINE                                          00762000
*********************************************************************** 00763000
BRANTAB  EQU   *                        BRANCH TABLE FOR                00764000
*                                       EXIT FROM TRANSLATE             00765000
*                                       AND TEST, IF CONDT'N            00766000
*                                       CODE IS NOT ZERO                00767000
         B     NOCHAR                   UNUSED POSITION                 00768000
         B     WRTNLL                   NULL IN OUTPUT DATA             00769000
         B     WRTNEWL                  NEW LINE IN DATA                00770000
         B     WRTNLL                EM 3270 IN OUTPUT DATA             00771000
*                                       THIS IS INVALID AND             00772000
*                                       A BLANK WILL GO IN              00773000
         B     WRTSOM                   SOM IN OUTPUT DATA              00774000
         B     WRTNLL                AN ! IN OUTPUT DATA                00775000
*                                       THIS IS INVALID AND             00776000
*                                       A BLANK WILL GO IN              00777000
         B     WRTEOM                   EOM IN OUTPUT DATA              00778000
         B     WRTETX                   END FRAMING DETECTED            00779000
*/**************************************************************/  0176 00780000
*/*                                                            */  0176 00781000
*/* NO CHAR    FROM      WITCH1                                */  0176 00782000
*/*      DATA GROUPS WITH NO UNIQUE CHARACTERS                 */  0176 00783000
*/**************************************************************/  0176 00784000
*NOCHAR:;                                                          0176 00785000
NOCHAR   DS    0H                                                  0177 00786000
*           GEN SETS(LINGRO) REFS(MYMOV) SEQFLOW   /*Y02947*/  ;   0177 00787000
         EX    LINGRO,MYMOV                                             00788000
         LA    LINGRO,1(LINGRO)         PUT LINGRO BACK                 00789000
*           SINKAD = SINKAD + LINGRO;                              0178 00790000
         ALR   SINKAD,LINGRO                                       0178 00791000
*           SOURAD = SOURAD + LINGRO;                              0179 00792000
         ALR   SOURAD,LINGRO                                       0179 00793000
*           CURSAD = CURSAD + LINGRO;                              0180 00794000
         ALR   CURSAD,LINGRO                                       0180 00795000
*WRTDONE:;                                                         0181 00796000
WRTDONE  DS    0H                                                  0182 00797000
*           IF SOURAD >= DACSRCAD + DACSRCLN                       0182 00798000
*                THEN                                              0182 00799000
         LH    @12,DACSRCLN(,DACAD)                                0182 00800000
         AL    @12,DACSRCAD(,DACAD)                                0182 00801000
         CR    SOURAD,@12                                          0182 00802000
         BL    @RF00182                                            0182 00803000
*                  DO;                                             0183 00804000
*WRTEND:;                                                          0184 00805000
WRTEND   DS    0H                                                  0185 00806000
*                     GEN SETS(WORKREG4,WORKREG3,REG0,DACFLG)      0185 00807000
*                      REFS(ANWIDE,DACAD,DSWIDE,DSLINE) FLOWS(WIT) 0185 00808000
*                                           NOSEQFLOW  /*Y02947*/ ;     00809000
         SR    WORKREG4,WORKREG4               GET A WORK REGISTER      00810000
         SR    WORKREG3,WORKREG3               GET A WORK REGISTER      00811000
         SR    REG0,REG0                     GET A WORK REGISTER        00812000
         LR    WORKREG3,CURSAD               GET CURSOR ADDRESS         00813000
         IC    REG0,ANWIDE(DACAD)             GET 3270 WIDTH            00814000
         DR    WORKREG4,REG0                    FIND WHERE ON 3270      00815000
         IC    REG0,DSWIDE(DACAD)     PICK UP 2260 WIDTH       @YA02150 00816000
         CR    WORKREG4,REG0       CURSOR BEYOND MAX COLUMN ?  @YA02150 00817000
         BNL   SETBLAT             YES, GO SET FLAG            @YA02150 00818000
         IC    REG0,DSLINE(DACAD)     PICK UP 2260 LINE COUNT  @YA02150 00819000
         CR    WORKREG3,REG0       CURSOR BEYOND MAX VALUE ?   @YA02150 00820000
         BNL   SETBLAT             YES, GO SET FLAG            @YA02150 00821000
         B     WIT                 NO, CURSOR OK               @YA02150 00822000
SETBLAT  EQU   *                   SET CURSOR ADJUST FLAG      @YA02150 00823000
         OI    DACFLG(DACAD),B'10000000' SET THE 'BLAT' FLAG   @YA02150 00824000
         B     WIT                 GO DO WRITE CLEANUP         @YA02150 00825000
*                  END;                                            0186 00826000
*                ELSE;                  /*FINALIZE             */  0187 00827000
@RF00182 DS    0H                                                  0188 00828000
*/**************************************************************/  0188 00829000
*/*                                                            */  0188 00830000
*/* WITCH2     FROM      WRTNEWL                               */  0188 00831000
*/*      AT THE END OF A 2260 LINE - PERTINENT PROCESSING      */  0188 00832000
*/**************************************************************/  0188 00833000
*WITCH2:    CURLIN = CURLIN + ONE;                                 0188 00834000
WITCH2   AL    CURLIN,ONE                                          0188 00835000
*           GEN SETS(SPECAR) REFS(DSLINE,DACAD) SEQFLOW   /*Y02947*/ ;  00836000
         SR    SPECAR,SPECAR                                            00837000
         IC    SPECAR,DSLINE(DACAD)                                     00838000
*           IF CURLIN = SPECAR                                     0190 00839000
*                THEN GO TO WALL;                                  0190 00840000
         CR    CURLIN,SPECAR                                       0190 00841000
         BE    @RT00190                                            0190 00842000
*                ELSE;                                             0192 00843000
*          GEN SETS(SPECAR) REFS(ANWIDE,DACAD) SEQFLOW  /*Y02947*/  ;   00844000
         IC    SPECAR,ANWIDE(DACAD)                                     00845000
*          CURSAD = CURLIN * SPECAR;                               0194 00846000
         LR    @15,SPECAR                                          0194 00847000
         MR    @14,CURLIN                                          0194 00848000
         LR    CURSAD,@15                                          0194 00849000
*          GEN SETS(CARADD) REFS(DSWIDE,DACAD) SEQFLOW   /*Y02947*/  ;  00850000
         SR    CARADD,CARADD                                            00851000
         IC    CARADD,DSWIDE(DACAD)                                     00852000
*GENA:;                                                            0196 00853000
GENA     DS    0H                                                  0197 00854000
*             /* GERMAN EXTENDED NETWORK ACCESS METHOD */          0197 00855000
*             /* FIXED INTERFACE ENTRY  10/06/72 STB   */          0197 00856000
*          GEN;                                                    0197 00857000
         ENTRY GENA                                                     00858000
*          IF  SPECAR = CARADD                                    0198 00859000
*                THEN                                              0198 00860000
         CR    SPECAR,CARADD                                       0198 00861000
         BE    @RF00198                                            0198 00862000
*                  DO;                                             0199 00863000
*/**************************************************************/  0200 00864000
*/*                                                            */  0200 00865000
*/* WITCH3     FROM      WALL, WALL2                           */  0200 00866000
*/*      END OF LINE RTA ORDER, SCREEN WRAP ENTRY              */  0200 00867000
*/**************************************************************/  0200 00868000
*WITCH3:;                                                          0200 00869000
WITCH3   DS    0H                                                  0201 00870000
*           GEN SETS(CURSAD,REG0,SPECAR) REFS(WITCH4)              0201 00871000
*                     FLOWS(RTABUILD) SEQFLOW    /*Y02947*/ ;      0201 00872000
         LTR   CURSAD,CURSAD           RTA FOR SCREEN WRAP ?            00873000
         BNZ   NOBUILD                 NO, DO NORMAL RTA                00874000
         SR    REG0,REG0               CLEAR A WORK REG                 00875000
*                                      LEAVE A NULL IN REG 0            00876000
         LA    SPECAR,WITCH4           SET UP RETURN POINT              00877000
         B     RTABUILD                                                 00878000
*NOBUILD:;                                                         0202 00879000
NOBUILD  DS    0H                                                  0203 00880000
*                     SINK(1) = '3C'X; /*PUT RTA ORDER IN SINK */  0203 00881000
         MVI   SINK(SINKAD),X'3C'                                  0203 00882000
*                     SINKAD = SINKAD + ONE;                       0204 00883000
         AL    SINKAD,ONE                                          0204 00884000
*           GEN;                                                   0205 00885000
         BAL   CARADD,OUTVERT                                           00886000
*                     SINK(1) = '00'X; /*REPEAT A NULL         */  0206 00887000
         MVI   SINK(SINKAD),X'00'                                  0206 00888000
*                     SINKAD = SINKAD + ONE;                       0207 00889000
         AL    SINKAD,ONE                                          0207 00890000
*                  END;                                            0208 00891000
*                ELSE;                                             0209 00892000
@RF00198 DS    0H                                                  0210 00893000
*/**************************************************************/  0210 00894000
*/*                                                            */  0210 00895000
*/* WITCH4     FROM      WALL1                                 */  0210 00896000
*/*      END OF LINE, SCREEN WRAP ENTRY, EQUAL SCREENS         */  0210 00897000
*/**************************************************************/  0210 00898000
*WITCH4:;                                                          0210 00899000
WITCH4   DS    0H                                                  0211 00900000
*             IF DACDSSCR = DACANSCR & CURLIN = DSLINE - 1         0211 00901000
*                & PROT = '1'B                                     0211 00902000
*                  THEN LINGRO = DSWIDE - 1;                       0211 00903000
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0211 00904000
         BNE   @RF00211                                            0211 00905000
         SLR   @12,@12                                             0211 00906000
         IC    @12,DSLINE(,DACAD)                                  0211 00907000
         BCTR  @12,0                                               0211 00908000
         CR    CURLIN,@12                                          0211 00909000
         BNE   @RF00211                                            0211 00910000
         TM    PROT(DACAD),B'01000000'                             0211 00911000
         BNO   @RF00211                                            0211 00912000
         SLR   LINGRO,LINGRO                                       0212 00913000
         IC    LINGRO,DSWIDE(,DACAD)                               0212 00914000
         BCTR  LINGRO,0                                            0212 00915000
*                  ELSE LINGRO = DSWIDE;                           0213 00916000
         B     @RC00211                                            0213 00917000
@RF00211 SLR   LINGRO,LINGRO                                       0213 00918000
         IC    LINGRO,DSWIDE(,DACAD)                               0213 00919000
*          GO TO WITCH1;                                           0214 00920000
         B     WITCH1                                              0214 00921000
*           GEN;                                                   0215 00922000
         EJECT                                                          00923000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0216 00924000
*/*     PRECEDING CODE -                                       */  0216 00925000
*/*WITCH1:       D (NO,%SINKOK,YES,) DOES LINGRO EXTEND PAST       0216 00926000
*/*                SOURCE ?                                    */  0216 00927000
*/*              P SET LINGRO TO REMAINDER OF SOURCE           */  0216 00928000
*/*              D (NO,%SINKOK,YES,WIT) IS LINGRO = ZERO ?     */  0216 00929000
*/*%SINKOK:      D (NO,%GOON1,YES,OUTSINK) WILL LINGRO EXCEDE THE  0216 00930000
*/*                SINK ?                                      */  0216 00931000
*/*%GOON1:       P USE 'XLATE' TO CHECK FOR UNIQUE                 0216 00932000
*/*                CHARACTERS                                  */  0216 00933000
*/*              D (NO,NOCHAR,YES,) ANY UNIQUE CHARACTER ?     */  0216 00934000
*/*              P CALCULATE COUNT PRECEDING THE UNIQUE            0216 00935000
*/*                CHARACTER                                   */  0216 00936000
*/*              D (NO,%BRAN,YES,) ARE THERE ANY CHARACTERS        0216 00937000
*/*                TO MOVE ?                                   */  0216 00938000
*/*              P MOVE THE PRECEDING CHARACTERS, BUMP THE         0216 00939000
*/*                SINK AND SOURCE                             */  0216 00940000
*/*%BRAN:        D (NULL,WRTNLL,NL,WRTNEWL,EM,WRTNLL,SOM,          0216 00941000
*/*                WRTSOM,!,WRTNLL,EOM,WRTEOM,ETX,                 0216 00942000
*/*                WRTETX) GO PROCESS UNIQUE CHARACTER         */  0216 00943000
*/*NOCHAR:       P MOVE FULL GROUP TO SINK, BUMP SINK AND          0216 00944000
*/*                SOURCE BY GROUP COUNT                       */  0216 00945000
*/*              P INCREMENT CURSAD BY GROUP COUNT             */  0216 00946000
*/*              D (NO,WITCH2,YES,WIT) SOURCE EXPENDED ?       */  0216 00947000
*/*WITCH2:       P INCREMENT CURLIN BY ONE                     */  0216 00948000
*/*              D (NO,%SETCURS,YES,WALL) LAST LINE ON 2260 ?  */  0216 00949000
*/*%SETCURS:     P SET CURSAD TO BEGINNING OF NEXT LINE        */  0216 00950000
*/*              D (YES,WITCH4,NO,WITCH3) ARE THE SCREENS          0216 00951000
*/*                EQUAL ?                                     */  0216 00952000
*/*WITCH3:       D (YES,NOBUILD,NO,) SINGLE LINE RTA ?         */  0216 00953000
*/*              P SET RETURN TO WITCH4, CHARACTER TO NULL     */  0216 00954000
*/*              S (,WITCH4) RTABUILD:CONSTRUCT RTA ORDER(S)   */  0216 00955000
*/*NOBUILD:      P PUT A REPEAT TO ADDRESS ORDER IN THE SINK       0216 00956000
*/*                AND BUMP THE SINK                           */  0216 00957000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0216 00958000
*/*              P PUT A NULL IN THE SINK AND BUMP SINK        */  0216 00959000
*/*WITCH4:       P (,WITCH1) SET LINGRO TO 2260 WIDTH          */  0216 00960000
*        GEN;                                                      0216 00961000
         EJECT                                                          00962000
*/**************************************************************/  0217 00963000
*/**************************************************************/  0217 00964000
*/*                                                            */  0217 00965000
*/*                                                            */  0217 00966000
*/* WALL ENTERED IF WRAP AROUND IS DETECTED, FROM WITCH2       */  0217 00967000
*/*    (IN WITCH). WALL HANDLES THE FUNCTION OF FORMATTING     */  0217 00968000
*/*    THE 3270 SCREEN SO AS TO MAINTAIN THE 2260 IMAGE.       */  0217 00969000
*/*    WALL CALCULATES THE DISPLACEMENT FOR AND INSERTS        */  0217 00970000
*/*    THE PROTECTED ATTRIBUTE IF PROT = YES. WALL PUTS        */  0217 00971000
*/*    A REPEAT TO ADDRESS OF NULLS TO SCREEN POSITION         */  0217 00972000
*/*    ZERO IF  THE 3270 DOES NOT EQUAL THE 2260 BY            */  0217 00973000
*/*    SETTING THE CURSOR TO ZERO AND PASSING CONTROL TO       */  0217 00974000
*/*    WITCH3. IF NO RTA IS NEEDED, CONTROL IS PASSED TO       */  0217 00975000
*/*    WITCH4. IN ANY CASE, THE CURRENT LINE IS SET TO         */  0217 00976000
*/*    ZERO, AND THE CURSOR IS SET TO ZERO.                    */  0217 00977000
*/*                                                            */  0217 00978000
*/**************************************************************/  0217 00979000
*/**************************************************************/  0217 00980000
*WALL:;                                                            0217 00981000
WALL     DS    0H                                                  0218 00982000
*           IF PROT = '1'B                                         0218 00983000
*                THEN                                              0218 00984000
         TM    PROT(DACAD),B'01000000'                             0218 00985000
         BNO   @RF00218                                            0218 00986000
*                  DO;                                             0219 00987000
*                     IF DACDSSCR = DACANSCR                       0220 00988000
*                          THEN                                    0220 00989000
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0220 00990000
         BNE   @RF00220                                            0220 00991000
*                            DO;                                   0221 00992000
*           GEN SETS(CARADD,SPECAR) REFS(DACAD,ANWIDE,ANLINE)      0222 00993000
*                               SEQFLOW      /*Y02947*/  ;         0222 00994000
         SR    CARADD,CARADD                                            00995000
         SR    SPECAR,SPECAR                                            00996000
         IC    CARADD,ANWIDE(DACAD)                                     00997000
         IC    SPECAR,ANLINE(DACAD)                                     00998000
*                               CURSAD = SPECAR * CARADD - 1;      0223 00999000
         LR    @15,CARADD                                          0223 01000000
         MR    @14,SPECAR                                          0223 01001000
         BCTR  @15,0                                               0223 01002000
         LR    CURSAD,@15                                          0223 01003000
*                            END;                                  0224 01004000
*                          ELSE                                    0225 01005000
*                            DO;                                   0225 01006000
         B     @RC00220                                            0225 01007000
@RF00220 DS    0H                                                  0226 01008000
*           GEN SETS(CARADD,SPECAR) REFS(DACAD,ANWIDE,DSWIDE)      0226 01009000
*                               SEQFLOW        /*Y02947*/  ;       0226 01010000
         SR    CARADD,CARADD                                            01011000
         SR    SPECAR,SPECAR                                            01012000
         IC    CARADD,ANWIDE(DACAD)                                     01013000
         IC    SPECAR,DSWIDE(DACAD)                                     01014000
*                               CURSAD = CARADD * (CURLIN - ONE) + 0227 01015000
*                                SPECAR;                           0227 01016000
         LR    @15,CURLIN                                          0227 01017000
         SL    @15,ONE                                             0227 01018000
         MR    @14,CARADD                                          0227 01019000
         ALR   @15,SPECAR                                          0227 01020000
         LR    CURSAD,@15                                          0227 01021000
*                            END;                                  0228 01022000
*                     SINK(1) = '11'X;                             0229 01023000
@RC00220 MVI   SINK(SINKAD),X'11'                                  0229 01024000
*                     SINKAD = SINKAD + 1;                         0230 01025000
         AH    SINKAD,@CH00061                                     0230 01026000
*                     GEN;                                         0231 01027000
         BAL   CARADD,OUTVERT                                           01028000
*                               SINK(1) = '1D'X; /*SF ORDER    */  0232 01029000
         MVI   SINK(SINKAD),X'1D'                                  0232 01030000
*                               SINKAD = SINKAD + ONE;             0233 01031000
         AL    SINKAD,ONE                                          0233 01032000
*                               SINK(1) = '60'X; /*PROT ATTRIB */  0234 01033000
         MVI   SINK(SINKAD),X'60'                                  0234 01034000
*                               SINKAD = SINKAD + 1;               0235 01035000
         AH    SINKAD,@CH00061                                     0235 01036000
*/**************************************************************/  0236 01037000
*/*                                                            */  0236 01038000
*/* WALL2      FROM      WALL                                  */  0236 01039000
*/*      SCREEN WRAP PROCESSING, PROT = NO SPECIFIED           */  0236 01040000
*/**************************************************************/  0236 01041000
*WALL2:;                                                           0236 01042000
WALL2    DS    0H                                                  0237 01043000
*           CURLIN = CURLIN - CURLIN;                              0237 01044000
         SLR   CURLIN,CURLIN                                       0237 01045000
*           CURSAD = CURSAD - CURSAD;                              0238 01046000
         SLR   CURSAD,CURSAD                                       0238 01047000
*           IF DACDSSCR = DACANSCR                                 0239 01048000
*                THEN GO TO WITCH4;                                0239 01049000
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0239 01050000
         BE    @RT00239                                            0239 01051000
*                ELSE GO TO WITCH3;                                0241 01052000
         B     WITCH3                                              0241 01053000
*                  END;                                            0242 01054000
*                ELSE                                              0243 01055000
*                GO TO WALL2;                                      0243 01056000
*           GEN;                                                   0244 01057000
         EJECT                                                          01058000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0245 01059000
*/*     PRECEDING CODE -                                       */  0245 01060000
*/*WALL:         D (NO,WALL2,YES,) PROT = YES SPECIFIED IN         0245 01061000
*/*                DACA ?                                      */  0245 01062000
*/*              D (NO,%NOTEQ,YES,) 3270 SIZE = 2260 SIZE          0245 01063000
*/*                ?                                           */  0245 01064000
*/*              P (,%SETSBA) SET CURSAD TO POINT TO LAST          0245 01065000
*/*                POSITION OF 2260 SCREEN                     */  0245 01066000
*/*%NOTEQ:       P SET CURSAD TO POINT ONE PAST LAST 2260          0245 01067000
*/*                SCREEN POSITION                             */  0245 01068000
*/*%SETSBA:      P SET BUFFER ADDRESS ORDER IN SINK AND            0245 01069000
*/*                BUMP SINK                                   */  0245 01070000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0245 01071000
*/*              P START FIELD, PROTECTED ATTRIBUTE IN             0245 01072000
*/*                SINK, BUMP SINK TWO                         */  0245 01073000
*/*              P SET CURLIN TO ZERO, CURSAD TO ZERO          */  0245 01074000
*/*              D (NO,WITCH3,YES,WALL1) 3270 SIZE = 2260 SIZE?*/  0245 01075000
*/*WALL1:        P (,WITCH4) CLEAR CURLIN, CURSAD TO ZERO      */  0245 01076000
*/*WALL2:        D (YES,WALL1,NO,) 3270 SIZE = 2260 SIZE ?     */  0245 01077000
*/*              P (,WITCH3) CLEAR CURLIN, CURSAD TO ZERO      */  0245 01078000
*        GEN;                                                      0245 01079000
         EJECT                                                          01080000
*/**************************************************************/  0246 01081000
*/**************************************************************/  0246 01082000
*/*                                                            */  0246 01083000
*/*                                                            */  0246 01084000
*/* WRSPCHAR A COLLECTION OF SUBROUTINES TO DEAL WITH          */  0246 01085000
*/*    CHARACTERS REQUIRING SPECIAL ACTION. EACH               */  0246 01086000
*/*    SUBROUTINE IS AN INDIVIDUAL ENTITY, AND NOT             */  0246 01087000
*/*    SPECIFICALLY RELATED TO ANY OTHER. SETTLE IS A          */  0246 01088000
*/*    HOUSEKEEPING FACILITY USED BY SEVERAL, BUT NOT ALL,     */  0246 01089000
*/*    OF THE SUBROUTINES. ALL ARE ENTERED FROM WITCH.         */  0246 01090000
*/*    THE SUBROUTINES ARE:                                    */  0246 01091000
*/*                                                            */  0246 01092000
*/*       WRTNEWL NEW LINE CHARACTER DETECTED IN DATA          */  0246 01093000
*/*          ADJUST CURSOR TO NEXT LINE                        */  0246 01094000
*/*          REPEAT BLANKS (NULLS IF RVOID = YES) TO END       */  0246 01095000
*/*          OF 2260 LINE                                      */  0246 01096000
*/*          PASS CONTROL TO WITCH2                            */  0246 01097000
*/*                                                            */  0246 01098000
*/*       WRTSOM START OF MESSAGE SYMBOL DETECTED IN DATA      */  0246 01099000
*/*          SET A FIELD (UNPROTECTED)                         */  0246 01100000
*/*          PASS CONTROL TO SETTLE                            */  0246 01101000
*/*                                                            */  0246 01102000
*/*       WRTEOM END OF MESSAGE SYMBOL DETECTED IN DATA        */  0246 01103000
*/*          PUT AN EXCLAIMATION POINT IN SINK                 */  0246 01104000
*/*          SET A 3270 END OF MESSAGE                         */  0246 01105000
*/*          PASS CONTROL TO SETTLE                            */  0246 01106000
*/*                                                            */  0246 01107000
*/*       WRTETX ETX DETECTED IN DATA                          */  0246 01108000
*/*          IF REMOTE IS KNOWN, PASS CONTROL TO WIT           */  0246 01109000
*/*          IF NOT KNOWN, REPROCESS AS REMOTE BY RESET        */  0246 01110000
*/*          OF SINK AND SOURCE POINTERS AND PASSING           */  0246 01111000
*/*          CONTROL TO BACKGO (IN HOUSEKEEPING)               */  0246 01112000
*/*                                                            */  0246 01113000
*/*       WRTNLL NULL DETECTED IN DATA STREAM                  */  0246 01114000
*/*          INSERT BLANK IN SINK                              */  0246 01115000
*/*          PASS CONTROL TO SETTLE                            */  0246 01116000
*/*                                                            */  0246 01117000
*/*       SETTLE HOUSEKEEPING FACILITY                         */  0246 01118000
*/*          ADJUST SOURCE POINTER                             */  0246 01119000
*/*          ADJUST CURSOR                                     */  0246 01120000
*/*          IF FROM WRTSOM, SAVE SOM POSITION                 */  0246 01121000
*/*          PASS CONTROL TO WITCH1                            */  0246 01122000
*/*                                                            */  0246 01123000
*/**************************************************************/  0246 01124000
*/**************************************************************/  0246 01125000
*/**************************************************************/  0246 01126000
*/*                                                            */  0246 01127000
*/* WRTNEWL    FROM      BRANTAB                               */  0246 01128000
*/*      NEW LINE CHARACTER PROCESSING                         */  0246 01129000
*/**************************************************************/  0246 01130000
*WRTNEWL:;                                                         0246 01131000
WRTNEWL  DS    0H                                                  0247 01132000
*                      SINK(1) = '1E'X;                            0247 01133000
         MVI   SINK(SINKAD),X'1E'                                  0247 01134000
*                      SINKAD = SINKAD + 1;                        0248 01135000
         AH    SINKAD,@CH00061                                     0248 01136000
*                      GEN REFS(DACSRCAD,DACAD) FLOWS(ENDSCRN)     0249 01137000
*                          SEQFLOW ;     /*Y02947*/                0249 01138000
         CLI   DACSRCAD(DACAD),X'00'  THIS LINE GROUP EXPENDED?  CODE2  01139000
         BNH   ENDSCRN             YES, NO SBA NEEDED           YA01253 01140000
*WRTNEW1:;                                                  /*YA02152*/ 01141000
WRTNEW1  DS    0H                                                  0251 01142000
*                      CURSAD = (CURLIN + 1) * ANWIDE;             0251 01143000
         LA    @15,1                                               0251 01144000
         ALR   @15,CURLIN                                          0251 01145000
         SLR   CURSAD,CURSAD                                       0251 01146000
         IC    CURSAD,ANWIDE(,DACAD)                               0251 01147000
         MR    @14,CURSAD                                          0251 01148000
         LR    CURSAD,@15                                          0251 01149000
*          CTLCOMP:   IF CURLIN + 1 = DSLINE                       0252 01150000
*                          THEN DO;                                0252 01151000
CTLCOMP  LA    @12,1                                               0252 01152000
         ALR   @12,CURLIN                                          0252 01153000
         SLR   @10,@10                                             0252 01154000
         IC    @10,DSLINE(,DACAD)                                  0252 01155000
         CR    @12,@10                                             0252 01156000
         BNE   @RF00252                                            0252 01157000
*                            IF ANWIDE = DSWIDE                    0254 01158000
*                                THEN DO;                   /*YA03264*/ 01159000
         CLC   ANWIDE(1,DACAD),DSWIDE(DACAD)                       0254 01160000
         BNE   @RF00254                                            0254 01161000
*                                 IF ANLINE= DSLINE        /*YA03264*/ 01162000
*                                  THEN GO TO ENDSCRN;      /*YA03264*/ 01163000
         CLC   ANLINE(1,DACAD),DSLINE(DACAD)                       0256 01164000
         BNE   @RT00256                                            0256 01165000
*                                    ELSE DO;               /*YA03264*/ 01166000
*                                   CURSAD = CURSAD         /*YA03264*/ 01167000
*                                         - CURSAD;         /*YA03264*/ 01168000
         SLR   CURSAD,CURSAD                                       0259 01169000
*                                  BLAT = '1'B;             /*YA03264*/ 01170000
         OI    BLAT(DACAD),B'10000000'                             0260 01171000
*                                  END;                     /*YA03264*/ 01172000
*                          END;                             /*YA03264*/ 01173000
*                                 ELSE;                            0263 01174000
@RF00254 DS    0H                                                  0264 01175000
*                               END;                               0264 01176000
*                          ELSE;                                   0265 01177000
@RF00252 DS    0H                                                  0266 01178000
*PLUGSBA:;                                                         0266 01179000
PLUGSBA  DS    0H                                                  0267 01180000
*                      SINK(1) = '11'X;                            0267 01181000
         MVI   SINK(SINKAD),X'11'                                  0267 01182000
*                      SINKAD = SINKAD + 1;                        0268 01183000
         AH    SINKAD,@CH00061                                     0268 01184000
*                      SPECAR = CURSAD;                            0269 01185000
         LR    SPECAR,CURSAD                                       0269 01186000
*                IF BLAT = '1'B                                    0270 01187000
*                   THEN GO TO WRTNEW2;                            0270 01188000
         TM    BLAT(DACAD),B'10000000'                             0270 01189000
         BO    @RT00270                                            0270 01190000
*                   ELSE;                                          0272 01191000
*                      CURSAD = CURSAD - ANWIDE + DSWIDE;          0273 01192000
         LR    @12,CURSAD                                          0273 01193000
         SLR   @10,@10                                             0273 01194000
         IC    @10,ANWIDE(,DACAD)                                  0273 01195000
         SLR   @12,@10                                             0273 01196000
         SLR   @10,@10                                             0273 01197000
         IC    @10,DSWIDE(,DACAD)                                  0273 01198000
         ALR   @12,@10                                             0273 01199000
         LR    CURSAD,@12                                          0273 01200000
*WRTNEW2:;                                                  /*YA02152*/ 01201000
WRTNEW2  DS    0H                                                  0275 01202000
*                      GEN;                                        0275 01203000
         BAL   CARADD,OUTVERT                                           01204000
*                      CURSAD = SPECAR;                            0276 01205000
         LR    CURSAD,SPECAR                                       0276 01206000
*ENDSCRN:;                                                         0277 01207000
ENDSCRN  DS    0H                                                  0278 01208000
*                IF BLAT = '1'B                             /*YA02152*/ 01209000
*                   THEN  GO TO SETTLE1;                           0278 01210000
         TM    BLAT(DACAD),B'10000000'                             0278 01211000
         BO    @RT00278                                            0278 01212000
*                   ELSE;                                          0280 01213000
*                      BLAT = '1'B;                                0281 01214000
         OI    BLAT(DACAD),B'10000000'                             0281 01215000
*                GEN REFS(DACSRCAD,DACAD) FLOWS(SETTLE1)           0282 01216000
*                 SEQFLOW ;    /*Y02947*/                          0282 01217000
         CLI   DACSRCAD(DACAD),X'00' THIS LINE GROUP EXPENDED?  YA02152 01218000
         BNE   SETTLE1             NO, NO SBA NEEDED            YA02152 01219000
*                IF (1 + LINGRO + CURSAD) // DSWIDE = FULL0       0283 01220000
*                   THEN GO TO WRTNEW1;                     /*YA02152*/ 01221000
         LA    @12,1                                               0283 01222000
         LR    @10,LINGRO                                          0283 01223000
         ALR   @10,@12                                             0283 01224000
         ALR   @10,CURSAD                                          0283 01225000
         LR    @14,@10                                             0283 01226000
         SRDA  @14,32                                              0283 01227000
         SLR   @10,@10                                             0283 01228000
         IC    @10,DSWIDE(,DACAD)                                  0283 01229000
         DR    @14,@10                                             0283 01230000
         C     @14,FULL0                                           0283 01231000
         BNE   @RT00283                                            0283 01232000
*                   ELSE;                                          0285 01233000
*                CURSAD = (CURLIN + 1) * ANWIDE;                   0286 01234000
         LR    @15,@12                                             0286 01235000
         ALR   @15,CURLIN                                          0286 01236000
         SLR   CURSAD,CURSAD                                       0286 01237000
         IC    CURSAD,ANWIDE(,DACAD)                               0286 01238000
         MR    @14,CURSAD                                          0286 01239000
         LR    CURSAD,@15                                          0286 01240000
*                      GO TO SETTLE1;                              0287 01241000
         B     SETTLE1                                             0287 01242000
*/**************************************************************/  0288 01243000
*/*                                                            */  0288 01244000
*/* WRTSOM     FROM      BRANTAB                               */  0288 01245000
*/*      START OF MESSAGE SYMBOL PROCESSING                    */  0288 01246000
*/**************************************************************/  0288 01247000
*WRTSOM:;                                                          0288 01248000
WRTSOM   DS    0H                                                  0289 01249000
*                      SINK(1) = '1D'X; /*PUT SF ORDER IN SINK */  0289 01250000
         MVI   SINK(SINKAD),X'1D'                                  0289 01251000
*                     SINKAD = SINKAD + ONE;                       0290 01252000
         L     @12,ONE                                             0290 01253000
         ALR   SINKAD,@12                                          0290 01254000
*                      SINK(1) = 'C1'X; /*PUT ATTRIBUTE IN SINK*/  0291 01255000
         MVI   SINK(SINKAD),X'C1'                                  0291 01256000
*                     SINKAD = SINKAD + ONE;                       0292 01257000
         ALR   SINKAD,@12                                          0292 01258000
*                     SOMP = '1'B;                                 0293 01259000
         OI    SOMP(DACAD),B'00100000'                             0293 01260000
*                     GO TO SETTLE;                                0294 01261000
         B     SETTLE                                              0294 01262000
*/**************************************************************/  0295 01263000
*/*                                                            */  0295 01264000
*/* WRTEOM     FROM      BRANTAB                               */  0295 01265000
*/*      END OF MESSAGE CHARACTER PROCESSING                   */  0295 01266000
*/**************************************************************/  0295 01267000
*WRTEOM:;                                                          0295 01268000
WRTEOM   DS    0H                                                  0296 01269000
*                      SINK(1) = '5A'X; /*PUT A ! IN THE SINK  */  0296 01270000
         MVI   SINK(SINKAD),X'5A'                                  0296 01271000
*                     SINKAD = SINKAD + ONE;                       0297 01272000
         L     @12,ONE                                             0297 01273000
         ALR   SINKAD,@12                                          0297 01274000
*                      SINK(1) = '19'X; /*PUT EM IN SINK       */  0298 01275000
         MVI   SINK(SINKAD),X'19'                                  0298 01276000
*                     SINKAD = SINKAD + ONE;                       0299 01277000
         ALR   SINKAD,@12                                          0299 01278000
*                          GO TO SETTLE;                           0300 01279000
         B     SETTLE                                              0300 01280000
*/**************************************************************/  0301 01281000
*/*                                                            */  0301 01282000
*/* WRTETX     FROM      BRANTAB                               */  0301 01283000
*/*      END TRANSMISSION CHARACTER PROCESSING                 */  0301 01284000
*/**************************************************************/  0301 01285000
*WRTETX:;                             /* END FRAMING CHAR      */  0301 01286000
WRTETX   DS    0H                                                  0302 01287000
*           IF RMTDV = '1'B                                        0302 01288000
*                THEN                                              0302 01289000
         TM    RMTDV(DACAD),B'00000001'                            0302 01290000
         BNO   @RF00302                                            0302 01291000
*                  DO;                                             0303 01292000
*                     IF CURSAD = FULL0                            0304 01293000
*                          THEN                                    0304 01294000
         C     CURSAD,FULL0                                        0304 01295000
         BNE   @RF00304                                            0304 01296000
*                            DO;                                   0305 01297000
*                               BLAT = '1'B;                       0306 01298000
         OI    BLAT(DACAD),B'10000000'                             0306 01299000
*                               CURLIN = DSLINE - 1;               0307 01300000
         SLR   CURLIN,CURLIN                                       0307 01301000
         IC    CURLIN,DSLINE(,DACAD)                               0307 01302000
         BCTR  CURLIN,0                                            0307 01303000
*                            END;                                  0308 01304000
*                          ELSE;                                   0309 01305000
@RF00304 DS    0H                                                  0310 01306000
*                     GO TO WIT;                                   0310 01307000
         B     WIT                                                 0310 01308000
*                  END;                                            0311 01309000
*                ELSE                                              0312 01310000
*                  DO;                                             0312 01311000
@RF00302 DS    0H                                                  0313 01312000
*                     SOURAD = DACSRCAD;                           0313 01313000
         L     SOURAD,DACSRCAD(,DACAD)                             0313 01314000
*                     SINKAD = DACSINAD;                           0314 01315000
         L     SINKAD,DACSINAD(,DACAD)                             0314 01316000
*                     GO TO BACKGO;                                0315 01317000
         B     BACKGO                                              0315 01318000
*                  END;                                            0316 01319000
*/**************************************************************/  0317 01320000
*/*                                                            */  0317 01321000
*/* WRTNLL     FROM      BRANTAB                               */  0317 01322000
*/*      NULL OR INVALID CHARACGER PROCESSING                  */  0317 01323000
*/**************************************************************/  0317 01324000
*WRTNLL:;                                                          0317 01325000
WRTNLL   DS    0H                                                  0318 01326000
*                          SINK(1) = '40'X; /*PUT BLANK IN SINK*/  0318 01327000
         MVI   SINK(SINKAD),X'40'                                  0318 01328000
*                          SINKAD = SINKAD + ONE;                  0319 01329000
         AL    SINKAD,ONE                                          0319 01330000
*/**************************************************************/  0320 01331000
*/*                                                            */  0320 01332000
*/* SETTLE     FROM      WRTSOM, WRTEOM, WRTNLL                */  0320 01333000
*/*      RETURN ROUTE TO MAIN DATA STREAM PROCESSING           */  0320 01334000
*/**************************************************************/  0320 01335000
*SETTLE:;                                                          0320 01336000
SETTLE   DS    0H                                                  0321 01337000
*                      CURSAD = CURSAD + LINGRO + 1;               0321 01338000
         LR    @12,CURSAD                                          0321 01339000
         ALR   @12,LINGRO                                          0321 01340000
         AH    @12,@CH00061                                        0321 01341000
         LR    CURSAD,@12                                          0321 01342000
*SETTLE1:;                                                         0322 01343000
SETTLE1  DS    0H                                                  0323 01344000
*                      SOURAD = SOURAD + 1;                        0323 01345000
         AH    SOURAD,@CH00061                                     0323 01346000
*           GEN SETS(LINGRO,DACSRCAD) REFS(DACAD) SEQFLOW ; /*Y02947*/  01347000
         SR    LINGRO,LINGRO       CLEAR MOVED VALUE OUT        CODE2   01348000
         IC    LINGRO,DACSRCAD(DACAD) PICK UP REMAINING VALUE   A58221  01349000
         XC    DACSRCAD(1,DACAD),DACSRCAD(DACAD) CLEAR SAVE BYTE A58221 01350000
*           IF SOMP = '1'B                                         0325 01351000
*                THEN                                              0325 01352000
         TM    SOMP(DACAD),B'00100000'                             0325 01353000
         BNO   @RF00325                                            0325 01354000
*                  DO;                                             0326 01355000
*                     SOMADD = CURSAD - ONE;                       0327 01356000
         LR    SOMADD,CURSAD                                       0327 01357000
         SL    SOMADD,ONE                                          0327 01358000
*                     SOMP = '0'B;                                 0328 01359000
*                     SOMHER = '1'B;                               0329 01360000
         OI    SOMHER(DACAD),B'00001000'                           0329 01361000
         NI    SOMP(DACAD),B'11011111'                             0329 01362000
*                  END;                                            0330 01363000
*                ELSE;                                             0331 01364000
@RF00325 DS    0H                                                  0332 01365000
*                 IF BLAT ='1'B                                    0332 01366000
*                      THEN DO;                                    0332 01367000
         TM    BLAT(DACAD),B'10000000'                             0332 01368000
         BNO   @RF00332                                            0332 01369000
*                        BLAT = '0'B;                              0334 01370000
         NI    BLAT(DACAD),B'01111111'                             0334 01371000
*                        IF LINGRO <= FULL0                        0335 01372000
*                             THEN GO TO WRTDONE;                  0335 01373000
         C     LINGRO,FULL0                                        0335 01374000
         BNH   @RT00335                                            0335 01375000
*                             ELSE GO TO WITCH2;                   0337 01376000
         B     WITCH2                                              0337 01377000
*                           END;                                   0338 01378000
*                      ELSE;                                       0339 01379000
@RF00332 DS    0H                                                  0340 01380000
*                 IF LINGRO <= FULL0                               0340 01381000
*                      THEN GO TO WRTDONE;                         0340 01382000
         C     LINGRO,FULL0                                        0340 01383000
         BNH   @RT00340                                            0340 01384000
*                      ELSE GO TO WITCH1;                          0342 01385000
         B     WITCH1                                              0342 01386000
*           GEN;                                                   0343 01387000
         EJECT                                                          01388000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0344 01389000
*/*     PRECEDING CODE -                                       */  0344 01390000
*/*WRTNEWL:      P SET CURSAD TO BEGINNING OF NEXT LINE        */  0344 01391000
*/*              D (NO,%NOTLAST,YES,) LAST POSITION IN 2260        0344 01392000
*/*                LINE ?                                      */  0344 01393000
*/*              P (,WITCH2) BUMP SOURCE, PUT FM IN SINK,          0344 01394000
*/*                BUMP SINK                                   */  0344 01395000
*/*%NOTLAST:     P PUT FIELD MARK IN SINK, BUMP SINK, PUT          0344 01396000
*/*                SBA IN SINK, BUMP SINK                      */  0344 01397000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0344 01398000
*/*              P (,WITCH2) BUMP SOURCE                       */  0344 01399000
*/*WRTSOM:       P PUT START FIELD, ATTRIBUTE IN SINK, BUMP        0344 01400000
*/*                SINK TWO                                    */  0344 01401000
*/*              P (,SETTLE) SET SOMP FLAG ON                  */  0344 01402000
*/*WRTEOM:       P (,SETTLE) PUT !, END MESSAGE IN SINK,           0344 01403000
*/*                BUMP SINK TWO                               */  0344 01404000
*/*WRTETX:       D (NO,%RMTDVNO,YES,WIT) IS RMTDV ON ?         */  0344 01405000
*/*%RMTDVNO:     P (,BACKGO) RESET SOURCE, SINK TO BEGINNING   */  0344 01406000
*/*WRTNLL:       P PUT BLANK IN SINK, BUMP SINK                */  0344 01407000
*/*SETTLE:       P BUMP SOURCE, INCREMENT CURSAD, SET LINGRO       0344 01408000
*/*                TO REMAINING PART                           */  0344 01409000
*/*              D (NO,%OUT,YES,) IS SOMP ON ?                 */  0344 01410000
*/*              P SET SOMADD TO BUFFER ADDRESS OF SF, SET         0344 01411000
*/*              SOMP OFF, SET SOMHER ON                       */  0344 01412000
*/*%OUT:         D (YES,WITCH2,NO,WITCH1) IS LINGRO = 0 ?      */  0344 01413000
*        GEN;                                                      0344 01414000
         EJECT                                                          01415000
*/**************************************************************/  0345 01416000
*/**************************************************************/  0345 01417000
*/*                                                            */  0345 01418000
*/*                                                            */  0345 01419000
*/* WIT TERMINATION OF SCAN PROCESSING FOR OUTPUT DATA.        */  0345 01420000
*/*    WIT IS ENTERED FROM WITCH1, NOCHAR (IN WITCH), AND      */  0345 01421000
*/*    WRETX (IN WRSPCHAR). WIT TESTS PROT AND IF YES, WIT     */  0345 01422000
*/*    ASCERTAINS THAT AN SOM (START FIELD, UNPROTECTED)       */  0345 01423000
*/*    IS ON THE SCREEN. WIT SETS AN INSERT CURSOR ORDER       */  0345 01424000
*/*    FOLLOWING THE LAST DATA. IF IT IS A REMOTE DATA         */  0345 01425000
*/*    STREAM, WIT PLACES AN ETX AT THE END. CONTROL IS        */  0345 01426000
*/*    PASSED TO OUTNORM.                                      */  0345 01427000
*/*                                                            */  0345 01428000
*/**************************************************************/  0345 01429000
*/**************************************************************/  0345 01430000
*WIT:       IF DACSINAD + DACSINLN <= SINKAD + 10                  0345 01431000
*                THEN GO TO OUTSINK;                               0345 01432000
WIT      LH    @12,DACSINLN(,DACAD)                                0345 01433000
         AL    @12,DACSINAD(,DACAD)                                0345 01434000
         LA    @10,10                                              0345 01435000
         ALR   @10,SINKAD                                          0345 01436000
         CR    @12,@10                                             0345 01437000
         BNH   @RT00345                                            0345 01438000
*                ELSE                                              0347 01439000
*                  DO;                                             0347 01440000
*                     IF SOMHER = '0'B /*IF NO SOM EXISTS      */  0348 01441000
*                     & PROT = '1'B   /*AND PROT = YES AND     */  0348 01442000
*                     & SHRD = '0'B   /*NOT SHORT READ ON      */  0348 01443000
*                     | SOMHER = '0'B /*IF NO SOM EXISTS       */  0348 01444000
*                     & RVOID = '1'B  /*AND RVOID = YES        */  0348 01445000
*                     & SHRD = '0'B   /*AND NOT SHORT READ ON  */  0348 01446000
*                          THEN                                    0348 01447000
         TM    SOMHER(DACAD),B'00001000'                           0348 01448000
         BNZ   @GL00005                                            0348 01449000
         TM    PROT(DACAD),B'01000000'                             0348 01450000
         BNO   @GL00005                                            0348 01451000
         TM    SHRD(DACAD),B'01000000'                             0348 01452000
         BZ    @RT00348                                            0348 01453000
@GL00005 TM    SOMHER(DACAD),B'00001000'                           0348 01454000
         BNZ   @RF00348                                            0348 01455000
         TM    RVOID(DACAD),B'10000000'                            0348 01456000
         BNO   @RF00348                                            0348 01457000
         TM    SHRD(DACAD),B'01000000'                             0348 01458000
         BNZ   @RF00348                                            0348 01459000
@RT00348 DS    0H                                                  0349 01460000
*                            DO;                                   0349 01461000
*                               SINK(1) = '1D'X; /*SF IN SINK  */  0350 01462000
         MVI   SINK(SINKAD),X'1D'                                  0350 01463000
*                               SINK(2) = 'C1'X; /*ATTR IN SINK*/  0351 01464000
         MVI   SINK+1(SINKAD),X'C1'                                0351 01465000
*                               SINKAD = SINKAD + 2;               0352 01466000
         AH    SINKAD,@CH00059                                     0352 01467000
*                               SOMHER = '1'B;                     0353 01468000
         OI    SOMHER(DACAD),B'00001000'                           0353 01469000
*                               SOMADD = CURSAD;                   0354 01470000
         LR    SOMADD,CURSAD                                       0354 01471000
*                               CURSAD = CURSAD + 1;               0355 01472000
         AH    CURSAD,@CH00061                                     0355 01473000
*                            END;                                  0356 01474000
*                          ELSE;                                   0357 01475000
@RF00348 DS    0H                                                  0358 01476000
*                     IF BLAT = '1'B                               0358 01477000
*                          THEN                                    0358 01478000
         TM    BLAT(DACAD),B'10000000'                             0358 01479000
         BNO   @RF00358                                            0358 01480000
*                             DO;                                  0359 01481000
*                                BLAT = '0'B;                      0360 01482000
         NI    BLAT(DACAD),B'01111111'                             0360 01483000
*                                IF CURLIN = DSLINE - 1            0361 01484000
*                                     THEN                         0361 01485000
         SLR   @12,@12                                             0361 01486000
         IC    @12,DSLINE(,DACAD)                                  0361 01487000
         BCTR  @12,0                                               0361 01488000
         CR    CURLIN,@12                                          0361 01489000
         BNE   @RF00361                                            0361 01490000
*                                      DO;                         0362 01491000
*                                         CURLIN = CURLIN - CURLIN;     01492000
         SLR   CURLIN,CURLIN                                       0363 01493000
*                                         CURSAD = CURSAD - CURSAD;     01494000
         SLR   CURSAD,CURSAD                                       0364 01495000
*                                         IF SOMHER = '1'B         0365 01496000
*                                         & SOMADD = FULL0         0365 01497000
*                                         | DACSOMAD = HAF0        0365 01498000
*                                           THEN CURSAD = CURSAD + 1;   01499000
         TM    SOMHER(DACAD),B'00001000'                           0365 01500000
         BNO   @GL00010                                            0365 01501000
         C     SOMADD,FULL0                                        0365 01502000
         BE    @RT00365                                            0365 01503000
@GL00010 CLC   DACSOMAD(2,DACAD),HAF0                              0365 01504000
         BNE   @RF00365                                            0365 01505000
@RT00365 DS    0H                                                  0366 01506000
         AH    CURSAD,@CH00061                                     0366 01507000
*                                           ELSE;                  0367 01508000
@RF00365 DS    0H                                                  0368 01509000
*                                         SINK(1) = '11'X;/*SBA*/  0368 01510000
         MVI   SINK(SINKAD),X'11'                                  0368 01511000
*                                         SINKAD = SINKAD + 1;     0369 01512000
         AH    SINKAD,@CH00061                                     0369 01513000
*                                           GEN;                   0370 01514000
         BAL   CARADD,OUTVERT                                           01515000
*                                      END;                        0371 01516000
*                                     ELSE                         0372 01517000
*                                      DO;                         0372 01518000
         B     @RC00361                                            0372 01519000
@RF00361 DS    0H                                                  0373 01520000
*                                         CURLIN = CURLIN + 1;     0373 01521000
         LA    @12,1                                               0373 01522000
         ALR   CURLIN,@12                                          0373 01523000
*                                         CURSAD = ANWIDE * CURLIN;     01524000
         LR    @15,CURLIN                                          0374 01525000
         SLR   CURSAD,CURSAD                                       0374 01526000
         IC    CURSAD,ANWIDE(,DACAD)                               0374 01527000
         MR    @14,CURSAD                                          0374 01528000
         LR    CURSAD,@15                                          0374 01529000
*                                         SINK(1) = '11'X;/*SBA*/  0375 01530000
         MVI   SINK(SINKAD),X'11'                                  0375 01531000
*                                         SINKAD = SINKAD + 1;     0376 01532000
         ALR   SINKAD,@12                                          0376 01533000
*                                         GEN;                     0377 01534000
         BAL   CARADD,OUTVERT                                           01535000
*                                      END;                        0378 01536000
*                             END;                                 0379 01537000
*                          ELSE;                                   0380 01538000
@RF00358 DS    0H                                                  0381 01539000
*                     SINK(1) = '13'X; /*INSERT CURSOR IN SINK */  0381 01540000
@RC00358 MVI   SINK(SINKAD),X'13'                                  0381 01541000
*                     SINKAD = SINKAD + ONE;                       0382 01542000
         AL    SINKAD,ONE                                          0382 01543000
*                     SPECAR = CURSAD;                             0383 01544000
         LR    SPECAR,CURSAD                                       0383 01545000
*              GEN SETS(DACCRS) REFS(DACAD,CURSAD) SEQFLOW ; /*Y02947*/ 01546000
         STH   CURSAD,DACCRS(DACAD)  STORE CURSOR POSITION        GENA  01547000
*                     IF DACANSCR = DACDSSCR                       0385 01548000
*                          THEN                                    0385 01549000
         CLC   DACANSCR(2,DACAD),DACDSSCR(DACAD)                   0385 01550000
         BNE   @RF00385                                            0385 01551000
*                            DO;                                   0386 01552000
*                     SINK(1) = '11'X; /*PUT SBA ORDER IN SINK */  0387 01553000
         MVI   SINK(SINKAD),X'11'                                  0387 01554000
*                     SINKAD = SINKAD + 1;                         0388 01555000
         AH    SINKAD,@CH00061                                     0388 01556000
*                               CURSAD = ANWIDE * ANLINE - 1;      0389 01557000
         SLR   @15,@15                                             0389 01558000
         IC    @15,ANLINE(,DACAD)                                  0389 01559000
         SLR   CURSAD,CURSAD                                       0389 01560000
         IC    CURSAD,ANWIDE(,DACAD)                               0389 01561000
         MR    @14,CURSAD                                          0389 01562000
         BCTR  @15,0                                               0389 01563000
         LR    CURSAD,@15                                          0389 01564000
*                               GEN;                               0390 01565000
         BAL   CARADD,OUTVERT                                           01566000
*                               GO TO SETPROT;                     0391 01567000
         B     SETPROT                                             0391 01568000
*                            END;                                  0392 01569000
*                          ELSE                                    0393 01570000
*                            DO;                                   0393 01571000
@RF00385 DS    0H                                                  0394 01572000
*                               IF ANWIDE = DSWIDE                 0394 01573000
*                                    THEN                          0394 01574000
         CLC   ANWIDE(1,DACAD),DSWIDE(DACAD)                       0394 01575000
         BNE   @RF00394                                            0394 01576000
*                                      DO;                         0395 01577000
*                                         SINK(1) = '11'X;/*SBA*/  0396 01578000
         MVI   SINK(SINKAD),X'11'                                  0396 01579000
*                                         SINKAD = SINKAD + 1;     0397 01580000
         AH    SINKAD,@CH00061                                     0397 01581000
*                                         CURSAD = ANWIDE *        0398 01582000
*                                         DSLINE;                  0398 01583000
         SLR   @15,@15                                             0398 01584000
         IC    @15,DSLINE(,DACAD)                                  0398 01585000
         SLR   CURSAD,CURSAD                                       0398 01586000
         IC    CURSAD,ANWIDE(,DACAD)                               0398 01587000
         MR    @14,CURSAD                                          0398 01588000
         LR    CURSAD,@15                                          0398 01589000
*                                         GEN;                     0399 01590000
         BAL   CARADD,OUTVERT                                           01591000
*                                         GO TO SETPROT;           0400 01592000
         B     SETPROT                                             0400 01593000
*                                      END;                        0401 01594000
*                                    ELSE;                         0402 01595000
@RF00394 DS    0H                                                  0403 01596000
*                               IF CURLIN = DSLINE                 0403 01597000
*                                    THEN CURLIN = CURLIN - 1;     0403 01598000
         SLR   @12,@12                                             0403 01599000
         IC    @12,DSLINE(,DACAD)                                  0403 01600000
         CR    CURLIN,@12                                          0403 01601000
         BNE   @RF00403                                            0403 01602000
         BCTR  CURLIN,0                                            0404 01603000
*                                    ELSE;                         0405 01604000
@RF00403 DS    0H                                                  0406 01605000
*/**************************************************************/  0406 01606000
*/*                                                            */  0406 01607000
*/* CLERLOOP   FROM      CLERLOOP                              */  0406 01608000
*/*      END OF DATA STREAM LINE CLEANUP LOOP POINT            */  0406 01609000
*/**************************************************************/  0406 01610000
*CLERLOOP:;                                                        0406 01611000
CLERLOOP DS    0H                                                  0407 01612000
*                               SINK(1) = '11'X; /*SBA IN SINK */  0407 01613000
         MVI   SINK(SINKAD),X'11'                                  0407 01614000
*                               SINKAD = SINKAD + 1;               0408 01615000
         AH    SINKAD,@CH00061                                     0408 01616000
*                               CURSAD = CURLIN * ANWIDE + DSWIDE; 0409 01617000
         SLR   @15,@15                                             0409 01618000
         IC    @15,ANWIDE(,DACAD)                                  0409 01619000
         MR    @14,CURLIN                                          0409 01620000
         SLR   CURSAD,CURSAD                                       0409 01621000
         IC    CURSAD,DSWIDE(,DACAD)                               0409 01622000
         ALR   @15,CURSAD                                          0409 01623000
         LR    CURSAD,@15                                          0409 01624000
*                               GEN;                               0410 01625000
         BAL   CARADD,OUTVERT                                           01626000
*                               CURLIN = CURLIN + 1;               0411 01627000
         LA    @12,1                                               0411 01628000
         ALR   CURLIN,@12                                          0411 01629000
*                               IF CURLIN = DSLINE                 0412 01630000
*                                    THEN GO TO SETPROT;           0412 01631000
         SLR   @10,@10                                             0412 01632000
         IC    @10,DSLINE(,DACAD)                                  0412 01633000
         CR    CURLIN,@10                                          0412 01634000
         BE    @RT00412                                            0412 01635000
*                                    ELSE                          0414 01636000
*                                      DO;                         0414 01637000
*                                         SINK(1) = '3C'X;/*RTA*/  0415 01638000
         MVI   SINK(SINKAD),X'3C'                                  0415 01639000
*                                         SINKAD = SINKAD + 1;     0416 01640000
         ALR   SINKAD,@12                                          0416 01641000
*                                         CURSAD = CURLIN * ANWIDE;     01642000
         SLR   @15,@15                                             0417 01643000
         IC    @15,ANWIDE(,DACAD)                                  0417 01644000
         MR    @14,CURLIN                                          0417 01645000
         LR    CURSAD,@15                                          0417 01646000
*                                         GEN;                     0418 01647000
         BAL   CARADD,OUTVERT                                           01648000
*                                         SINK(1) = '00'X;         0419 01649000
         MVI   SINK(SINKAD),X'00'                                  0419 01650000
*                                         SINKAD = SINKAD + 1;     0420 01651000
         AH    SINKAD,@CH00061                                     0420 01652000
*                                         GO TO CLERLOOP;          0421 01653000
         B     CLERLOOP                                            0421 01654000
*                                      END;                        0422 01655000
*                            END;                                  0423 01656000
*/**************************************************************/  0424 01657000
*/*                                                            */  0424 01658000
*/* SETPROT    FROM      WIT, CLERLOOP                         */  0424 01659000
*/*      ESTABLISH PROTECTED FIELD IF PROT = YES               */  0424 01660000
*/**************************************************************/  0424 01661000
*SETPROT:;                                                         0424 01662000
SETPROT  DS    0H                                                  0425 01663000
*                     IF PROT = '1'B                               0425 01664000
*                          THEN                                    0425 01665000
         TM    PROT(DACAD),B'01000000'                             0425 01666000
         BNO   @RF00425                                            0425 01667000
*                            DO;                                   0426 01668000
*                               SINK(1) = '1D'X; /*SF IN SINK  */  0427 01669000
         MVI   SINK(SINKAD),X'1D'                                  0427 01670000
*                               SINK(2) = '60'X; /*PROT ATTR IN*/  0428 01671000
         MVI   SINK+1(SINKAD),X'60'                                0428 01672000
*                               SINKAD = SINKAD + 2;               0429 01673000
         AH    SINKAD,@CH00059                                     0429 01674000
*                               CURSAD = SPECAR;                   0430 01675000
         LR    CURSAD,SPECAR                                       0430 01676000
*                            END;                                  0431 01677000
*                          ELSE CURSAD = SPECAR;                   0432 01678000
         B     @RC00425                                            0432 01679000
@RF00425 LR    CURSAD,SPECAR                                       0432 01680000
*                     IF DACDSSCR = DACANSCR                      0433 01681000
*                          THEN                                    0433 01682000
@RC00425 CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0433 01683000
         BE    @RF00433                                            0433 01684000
*                            DO;                                   0434 01685000
*           GEN SETS(REG0,SPECAR) FLOWS(RTABUILD) SEQFLOW ; /*Y02947*/  01686000
         SR    REG0,REG0                     CLEAR A WORK REGISTER      01687000
*                                      LEAVE A NULL IN REG 0            01688000
         BAL   SPECAR,RTABUILD                                          01689000
*                            END;                                  0436 01690000
*                          ELSE;                                   0437 01691000
@RF00433 DS    0H                                                  0438 01692000
*                     IF RMTDV = '0'B                              0438 01693000
*                          THEN GO TO OUTNORM;                     0438 01694000
         TM    RMTDV(DACAD),B'00000001'                            0438 01695000
         BZ    @RT00438                                            0438 01696000
*                          ELSE                                    0440 01697000
*                            DO;                                   0440 01698000
*                     SINK(1) = '03'X; /*PUT AN ETX IN THE SINK*/  0441 01699000
         MVI   SINK(SINKAD),X'03'                                  0441 01700000
*                     SINKAD = SINKAD + 1;                         0442 01701000
         AH    SINKAD,@CH00061                                     0442 01702000
*                               GO TO OUTNORM;                     0443 01703000
         B     OUTNORM                                             0443 01704000
*                            END;                                  0444 01705000
*                  END;                                            0445 01706000
*           GEN;                                                   0446 01707000
         EJECT                                                          01708000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0447 01709000
*/*     PRECEDING CODE -                                       */  0447 01710000
*/*WIT:          D (NO,%NUF,YES,OUTSINK) WILL EXCEDE SINK ?    */  0447 01711000
*/*%NUF:         D (NO,%SOMOK,YES,) IS PROT OR RVOID ON & SOMHER   0447 01712000
*/*                OFF & SHRD OFF ?                            */  0447 01713000
*/*              P PUT SET FIELD, ATTRIBUTE IN SINK, BUMP          0447 01714000
*/*                SINK, SET SOMHER ON                         */  0447 01715000
*/*              P SAVE ADDRESS OF SF IN SOMADD, INCREMENT         0447 01716000
*/*                CURSAD                                      */  0447 01717000
*/*%SOMOK:       D (NO,%NOBLAT,YES,) IS BLAT ON ?              */  0447 01718000
*/*              P TURN BLAT OFF                               */  0447 01719000
*/*              D (YES,,NO,%MIDDLE) AT END OF 2260 ?          */  0447 01720000
*/*              P SET CURLIN TO 0, CURSAD TO 0                */  0447 01721000
*/*              D (YES,,NO,%NOSOM0) SOM IN POSITION 0 ?       */  0447 01722000
*/*              P INCREMENT CURSAD ONE POSITION               */  0447 01723000
*/*%NOSOM0:      P PUT SBA ORDER IN SINK, BUMP SINK            */  0447 01724000
*/*              S (,%NOBLAT) OUTVERT:CONVERT HEXIDECIMAL TO       0447 01725000
*/*                3270 BUFFER                                 */  0447 01726000
*/*%MIDDLE:      P INCREMENT CURLIN, SET CURSAD TO NEXT LINE   */  0447 01727000
*/*              P PUT SBA ORDER IN SINK, BUMP SINK            */  0447 01728000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0447 01729000
*/*%NOBLAT:      P PUT INSERT CURSOR IN SINK, BUMP SINK        */  0447 01730000
*/*              D (NO,%EQSCRN,YES,) 3270 SIZE = 2260 SIZE         0447 01731000
*/*                ?                                           */  0447 01732000
*/*              P PUT SBA IN SINK, BUMP SINK, SET CURSAD TO       0447 01733000
*/*                LAST 2260 POSITION                          */  0447 01734000
*/*              S (,SETPROT) OUTVERT:CONVERT HEXIDECIMAL TO       0447 01735000
*/*                3270 BUFFER                                 */  0447 01736000
*/*%EQSCRN:      D (NO,%EQWIDE,YES,) ANWIDE = DSWIDE ?         */  0447 01737000
*/*              P PUT SBA IN SINK, BUMP SINK                  */  0447 01738000
*/*              P SET CURSAD ONE PAST 2260 PORTION            */  0447 01739000
*/*              S (,SETPROT) OUTVERT:CONVERT HEXIDECIMAL TO       0447 01740000
*/*                3270 BUFFER                                 */  0447 01741000
*/*%EQWIDE:      D (YES,,NO,CLERLOOP) CURLIN = MAXIMUM 2260        0447 01742000
*/*                LINE ?                                      */  0447 01743000
*/*              P DECREMENT CURLIN ONE                        */  0447 01744000
*/*CLERLOOP:     P PUT SBA IN SINK, BUMP SINK, CURSAD = END        0447 01745000
*/*                OF CURRENT 2260 LINE                        */  0447 01746000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0447 01747000
*/*              P BUMP CURLIN                                 */  0447 01748000
*/*              D (YES,SETPROT,NO,) CURLIN = MAXIMUM 2260         0447 01749000
*/*                LINE ?                                      */  0447 01750000
*/*              P SET RTA IN SINK, BUMP SINK, CURSAD TO           0447 01751000
*/*                BEGINNING OF NEXT LINE                      */  0447 01752000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0447 01753000
*/*              P (,CLERLOOP) PUT NULL IN SINK                */  0447 01754000
*/*SETPROT:      D (NO,%NOPROT,YES,) PROT = YES SPECIFIED          0447 01755000
*/*                ?                                           */  0447 01756000
*/*              P PUT SF, PROTECTED ATTRIBUTE IN SINK, BUMP       0447 01757000
*/*                SINK TWO                                    */  0447 01758000
*/*              P (,%SOPROT) RESTORE CURSAD                   */  0447 01759000
*/*%NOPROT:      P RESTORE CURSAD                              */  0447 01760000
*/*%SOPROT:      D (NO,%NOTEQU,YES,) 3270 SIZE = 2260 SIZE ?   */  0447 01761000
*/*              P SET CHARACTER TO NULL, RETURN TO NEXT           0447 01762000
*/*                SEQUENTIAL INSTRUCTION                      */  0447 01763000
*/*              S RTABUILD:BUILD RTA(S) TO POSITION ZERO      */  0447 01764000
*/*%NOTEQU:      D (NO,%REMOT,YES,OUTNORM) IS RMTDV OFF ?      */  0447 01765000
*/*%REMOT:       D (NO,OUTSINK,YES,%ETX) ONE BYTE LEFT IN SINK?*/  0447 01766000
*/*%ETX:         P (,OUTNORM) PUT ETX IN SINK, BUMP SINK       */  0447 01767000
*        GEN;                                                      0447 01768000
         EJECT                                                          01769000
*/**************************************************************/  0448 01770000
*/**************************************************************/  0448 01771000
*/* READ INITIAL ENTRY FROM HOUSEKEEPING FOR INPUT DATA        */  0448 01772000
*/*     STREAMS. ENTRY READ1 IS USED WHEN PROCESSING READ      */  0448 01773000
*/*     BUFFER, AS THE PROCESSING LOOP ENTRY. READ1 IS         */  0448 01774000
*/*     ENTERED FROM RDLAT (MORTST), AND KERF (INCREM).        */  0448 01775000
*/*      READ TESTS FOR AN SOH AND IF PRESENT PASSES           */  0448 01776000
*/*     CONTROL TO OUTERR. IF THE DEVICE IS REMOTE, THE        */  0448 01777000
*/*     CONTENT OF DACDSAD REPLACES THE 3270 DEVICE ADDRESS.   */  0448 01778000
*/*     THE AID IS TESTED FOR PA1,2,3 OR THE CLEAR KEY         */  0448 01779000
*/*     BEING DEPRESSED. IF SO, THE AID IS PLACED IN THE       */  0448 01780000
*/*     SINK, AN END FRAMING CHARACTER IS INSERTED IF          */  0448 01781000
*/*     NEEDED, AND CONTROL IS PASSED TO OUTSPEC. FOR A        */  0448 01782000
*/*     READ BUFFER OPERATION, PROCESSING IS INITIATED         */  0448 01783000
*/*     IN READ1 ON A LINE AT A TIME BASIS, CONTROL IS         */  0448 01784000
*/*     PASSED TO RDLAT. READ1 TESTS ON SUBSEQUENT             */  0448 01785000
*/*     ENTRIES FOR THE CURRENT PROCESSING LINE BEING EQUAL    */  0448 01786000
*/*     TO THE LAST 2260 LINE AND IF SO, BRANCHES TO           */  0448 01787000
*/*     READOUT IN SOURTST. FOR READ TYPES OTHER THAN          */  0448 01788000
*/*     READ BUFFER, THE CURSOR POSITION IS RELATED TO A       */  0448 01789000
*/*     TRUE CORE ADDRESS. IF AN SBA SEQUENCE IS PRESENT       */  0448 01790000
*/*     THE FIELD POSITION IS RELATED TO A TRUE CORE           */  0448 01791000
*/*     ADDRESS. IF NO SBA SEQUENCE IS PRESENT, THE DATA       */  0448 01792000
*/*     STREAM IS SEARCHED FOR AN X'4A' () AND IF FOUND,      */  0448 01793000
*/*     ITS POSITION BECOMES THE FIELD POSITION. IF THE        */  0448 01794000
*/*     SBA SEQUENCE IS PRESENT, SOURTST RECEIVES CONTROL.     */  0448 01795000
*/*     IF THE SBA IS NOT PRESENT, CKSMI IN SOURTST RECEIVES   */  0448 01796000
*/*     CONTROL.                                               */  0448 01797000
*/*                                                            */  0448 01798000
*/**************************************************************/  0448 01799000
*/**************************************************************/  0448 01800000
*READ:;                                                            0448 01801000
READ     DS    0H                                                  0449 01802000
*           IF SOURCE(1) = '01'X       /*IF THIS IS ERROR MSG  */  0449 01803000
*                THEN GO TO OUTERR;                                0449 01804000
         CLI   SOURCE(SOURAD),X'01'                                0449 01805000
         BE    @RT00449                                            0449 01806000
*                ELSE;                                             0451 01807000
*           IF RMTDV = '1'B                                        0452 01808000
*                THEN                                              0452 01809000
         TM    RMTDV(DACAD),B'00000001'                            0452 01810000
         BNO   @RF00452                                            0452 01811000
*                  DO;                                             0453 01812000
*                     SINK(1) = DACDSAD;                           0454 01813000
         MVC   SINK(1,SINKAD),DACDSAD(DACAD)                       0454 01814000
*                     SINKAD = SINKAD + 1; /*INCREMENT         */  0455 01815000
         AH    SINKAD,@CH00061                                     0455 01816000
*                     SOURAD = SOURAD + 2; /*INCREMENT 2       */  0456 01817000
         AH    SOURAD,@CH00059                                     0456 01818000
*                  END;                                            0457 01819000
*                ELSE;                                             0458 01820000
@RF00452 DS    0H                                                  0459 01821000
*           IF SOURCE(1) = '6C'X | SOURCE(1) = '6E'X | SOURCE(1) = 0459 01822000
*              '6B'X | SOURCE(1) = '6D'X | SOURCE(1) = '60'X       0459 01823000
*                THEN                                              0459 01824000
         CLI   SOURCE(SOURAD),X'6C'                                0459 01825000
         BE    @RT00459                                            0459 01826000
         CLI   SOURCE(SOURAD),X'6E'                                0459 01827000
         BE    @RT00459                                            0459 01828000
         CLI   SOURCE(SOURAD),X'6B'                                0459 01829000
         BE    @RT00459                                            0459 01830000
         CLI   SOURCE(SOURAD),X'6D'                                0459 01831000
         BE    @RT00459                                            0459 01832000
         CLI   SOURCE(SOURAD),X'60'                                0459 01833000
         BNE   @RF00459                                            0459 01834000
@RT00459 DS    0H                                                  0460 01835000
*                  DO;                                             0460 01836000
*                     SINK(1) = SOURCE(1);                         0461 01837000
         MVC   SINK(1,SINKAD),SOURCE(SOURAD)                       0461 01838000
*                     IF RMTDV = '1'B                              0462 01839000
*                          THEN                                    0462 01840000
         TM    RMTDV(DACAD),B'00000001'                            0462 01841000
         BNO   @RF00462                                            0462 01842000
*                            DO;                                   0463 01843000
*                               SINK(2) = SOURCE(4);               0464 01844000
         MVC   SINK+1(1,SINKAD),SOURCE+3(SOURAD)                   0464 01845000
*                     SINKAD = SINKAD + 2;                         0465 01846000
         AH    SINKAD,@CH00059                                     0465 01847000
*                            END;                                  0466 01848000
*                          ELSE SINKAD = SINKAD + ONE;             0467 01849000
         B     @RC00462                                            0467 01850000
@RF00462 AL    SINKAD,ONE                                          0467 01851000
*                     GO TO OUTSPEC;                               0468 01852000
         B     OUTSPEC                                             0468 01853000
*                  END;                                            0469 01854000
*                ELSE;                                             0470 01855000
@RF00459 DS    0H                                                  0471 01856000
*           IF RDBUF = '1'B                                        0471 01857000
*                THEN                                              0471 01858000
         TM    RDBUF(DACAD),B'00000001'                            0471 01859000
         BNO   @RF00471                                            0471 01860000
*                  DO;                                             0472 01861000
*                     IF SOURCE(4) = '11'X                         0473 01862000
*                          THEN SOURAD = SOURAD + 6;               0473 01863000
         CLI   SOURCE+3(SOURAD),X'11'                              0473 01864000
         BNE   @RF00473                                            0473 01865000
         AH    SOURAD,@CH00283                                     0474 01866000
*                          ELSE SOURAD = SOURAD + 3;               0475 01867000
         B     @RC00473                                            0475 01868000
@RF00473 AH    SOURAD,@CH00102                                     0475 01869000
*                     SHRD = '0'B;                                 0476 01870000
@RC00473 NI    SHRD(DACAD),B'10111111'                             0476 01871000
*                     CURLIN = CURLIN - CURLIN;                    0477 01872000
         SLR   CURLIN,CURLIN                                       0477 01873000
*/**************************************************************/  0478 01874000
*/*                                                            */  0478 01875000
*/* READ1      FROM      MORTST, INCREM                        */  0478 01876000
*/*      READ BUFFER SETUP FOR PASS THROUGH RDLAT              */  0478 01877000
*/**************************************************************/  0478 01878000
*READ1:;                              /*READ BUFFER            */  0478 01879000
READ1    DS    0H                                                  0479 01880000
*                     LINGRO = DSWIDE; /*GET 2260 WIDTH        */  0479 01881000
         SLR   LINGRO,LINGRO                                       0479 01882000
         IC    LINGRO,DSWIDE(,DACAD)                               0479 01883000
*                     SPECAR = DSLINE; /*GET 2260 LINE CNT     */  0480 01884000
         SLR   SPECAR,SPECAR                                       0480 01885000
         IC    SPECAR,DSLINE(,DACAD)                               0480 01886000
*                     IF CURLIN = SPECAR                           0481 01887000
*                          THEN GO TO READOUT;                     0481 01888000
         CR    CURLIN,SPECAR                                       0481 01889000
         BE    @RT00481                                            0481 01890000
*                          ELSE GO TO RDLAT;                       0483 01891000
         B     RDLAT                                               0483 01892000
*                  END;                                            0484 01893000
*                ELSE                                              0485 01894000
*                  DO;                                             0485 01895000
@RF00471 DS    0H                                                  0486 01896000
*                     SOURAD = SOURAD + ONE;                       0486 01897000
         AL    SOURAD,ONE                                          0486 01898000
*                     GEN SETS(CURSAD,CARADD,SOURAD) FLOWS(INVERT) 0487 01899000
*                       SEQFLOW ;  /*Y02947*/                      0487 01900000
         SR    CURSAD,CURSAD            CLEAR REGISTER                  01901000
         IC    CURSAD,0(SOURAD)                                         01902000
         SLL   CURSAD,8                                                 01903000
         IC    CURSAD,1(SOURAD)                                         01904000
         BAL   CARADD,INVERT            GO CONVERT ADDRESS              01905000
         LA    CARADD,0(CARADD)                                         01906000
         LA    SOURAD,2(SOURAD)         INCREMENT SOURCE                01907000
*           GEN REFS (CURSAD,DACAD,ANWIDE,DSLINE,DSWIDE)           0488 01908000
*               SETS(DACCRS,WORKREG4,WORKREG3,REG0)                0488 01909000
*                 FLOWS(OUTCURS) SEQFLOW;                    /*Y02947*/ 01910000
         SR    WORKREG4,WORKREG4           CLEAR A WORK REGISTER        01911000
         LR    WORKREG3,CURSAD           PICK UP CURSOR POSITION        01912000
         SR    REG0,REG0              CLEAR A WORK REGISTER             01913000
         IC    REG0,ANWIDE(DACAD)         PICK UP 3270 WIDTH            01914000
         DR    WORKREG4,REG0            GET ROW COLUMN OF CURSOR        01915000
         IC    REG0,DSLINE(DACAD)         PICK UP MAX 2260 LINE         01916000
         CR    WORKREG3,REG0          IS CURSOR BEYOND MAX 2260 LINE    01917000
         BNL   OUTCURS             YES, RETURN WITH CODE X'10'          01918000
         IC    REG0,DSWIDE(DACAD)         PICK UP MAX 2260 COLUMN       01919000
         CR    WORKREG4,REG0            IS CURSOR BEYOND MAX COLUMN     01920000
         BNL   OUTCURS             YES, RETURN WITH CODE X'10'          01921000
         STH   CURSAD,DACCRS(DACAD)                                     01922000
*RDSBATST:;                                                        0489 01923000
RDSBATST DS    0H                                                  0490 01924000
*           SOMADD = CURSAD;                                       0490 01925000
         LR    SOMADD,CURSAD                                       0490 01926000
*           IF SOURCE(1) = '11'X                                   0491 01927000
*                          THEN                                    0491 01928000
         CLI   SOURCE(SOURAD),X'11'                                0491 01929000
         BNE   @RF00491                                            0491 01930000
*                            DO;                                   0492 01931000
*           GEN SETS(SPECAR,DACIND) REFS(DACAD,HAF3)               0493 01932000
*                       SEQFLOW ; /*Y02947*/                       0493 01933000
         SR    SPECAR,SPECAR                                            01934000
         IC    SPECAR,DACIND(DACAD)                                     01935000
         AH    SPECAR,HAF3                                              01936000
         STC   SPECAR,DACIND(DACAD)                                     01937000
*                               SOMHER = '1'B;                     0494 01938000
         OI    SOMHER(DACAD),B'00001000'                           0494 01939000
*          GEN SETS(CURSAD,SOURAD,CARADD,REG0,WORKREG4,WORKREG3)   0495 01940000
*                REFS(ANWIDE,DACAD,DSLINE,DSWIDE)                  0495 01941000
*                      FLOWS(INVERT,RDOPTST)  SEQFLOW ; /*Y02947*/ 0495 01942000
         SR    CURSAD,CURSAD                                            01943000
         IC    CURSAD,1(SOURAD)                                         01944000
         SLL   CURSAD,8                                                 01945000
         IC    CURSAD,2(SOURAD)                                         01946000
         LA    SOURAD,3(SOURAD)                                         01947000
         BAL   CARADD,INVERT                                            01948000
         SR    REG0,REG0           CLEAR A WORK REGISTER        CODE2   01949000
         SR    WORKREG4,WORKREG4    CLEAR EVEN OF EVEN/ODD PAIR  CODE2  01950000
         SR    WORKREG3,WORKREG3   CLEAR ODD OF EVEN/ODD PAIR    CODE2  01951000
         IC    REG0,ANWIDE(DACAD)   PICK UP 3270 WIDTH           CODE2  01952000
         IC    WORKREG3,DSLINE(DACAD)  PICK UP 2260 LINE COUNT   CODE2  01953000
         MR    WORKREG4,REG0        COMPUTE END OF 2260 PLUS     CODE2  01954000
*                                  THE DIFFERENCE 3270-2260      CODE2  01955000
         SR    WORKREG4,WORKREG4   CLEAR A WORK REGISTER         CODE2  01956000
         IC    WORKREG4,DSWIDE(DACAD)  PICK UP THE 2260 WIDTH    CODE2  01957000
         SR    REG0,WORKREG4        GET SCREEN WIDTH DIFFERENCE  CODE2  01958000
         SR    WORKREG3,REG0       GET END OF 2260 SCREEN + 1    CODE2  01959000
*                                  IN 3270 BUFFER UNITS         CODE2   01960000
         CR    CURSAD,WORKREG3     SOM POINT 1 PAST END OF 2260 CODE2   01961000
         BNE   RDOPTST             NO, GO AHEAD AND USE IT      CODE2   01962000
         SR    CURSAD,CURSAD       YES, POINT IT TO FIRST       CODE2   01963000
*                                  POSITION OF SCREEN           CODE2   01964000
*RDOPTST:                       SPECAR = CURSAD;                   0496 01965000
RDOPTST  LR    SPECAR,CURSAD                                       0496 01966000
*                               CURSAD = SOMADD;                   0497 01967000
         LR    CURSAD,SOMADD                                       0497 01968000
*           CARADD = SPECAR // DSWIDE;                             0498 01969000
         SLR   @12,@12                                             0498 01970000
         IC    @12,DSWIDE(,DACAD)                                  0498 01971000
         LR    @00,SPECAR                                          0498 01972000
         SRDA  @00,32                                              0498 01973000
         DR    @00,@12                                             0498 01974000
         LR    CARADD,@00                                          0498 01975000
*           IF CARADD = FULL0                                     0499 01976000
*                THEN                                              0499 01977000
         C     CARADD,FULL0                                        0499 01978000
         BE    @RF00499                                            0499 01979000
*                  DO;                                             0500 01980000
*           CARADD = DSWIDE - CARADD;                              0501 01981000
         SLR   @12,CARADD                                          0501 01982000
         LR    CARADD,@12                                          0501 01983000
*           GEN SETS(LINGRO,DACIND) REFS(DACAD,CARADD)             0502 01984000
*                  SEQFLOW ;   /*Y02947*/                          0502 01985000
         SR    LINGRO,LINGRO                                            01986000
         IC    LINGRO,DACIND(DACAD)                                     01987000
         AR    LINGRO,CARADD                                            01988000
         STC   LINGRO,DACIND(DACAD)                                     01989000
*                  END;                                            0503 01990000
*                ELSE;                                             0504 01991000
@RF00499 DS    0H                                                  0505 01992000
*                            END;                                  0505 01993000
*                          ELSE;                                   0506 01994000
@RF00491 DS    0H                                                  0507 01995000
*                     IF RDMI = '1'B                               0507 01996000
*                          THEN SHRD = '0'B;                       0507 01997000
         TM    RDMI(DACAD),B'00000100'                             0507 01998000
         BNO   @RF00507                                            0507 01999000
         NI    SHRD(DACAD),B'10111111'                             0508 02000000
*                          ELSE SHRD = '1'B;                       0509 02001000
         B     @RC00507                                            0509 02002000
@RF00507 OI    SHRD(DACAD),B'01000000'                             0509 02003000
*                  END;                                            0510 02004000
@RC00507 DS    0H                                                  0511 02005000
*           IF SOMHER = '1'B                                       0511 02006000
*                THEN                                              0511 02007000
         TM    SOMHER(DACAD),B'00001000'                           0511 02008000
         BNO   @RF00511                                            0511 02009000
*                  DO;                                             0512 02010000
*                     LINGRO = LINGRO - LINGRO;                    0513 02011000
         SLR   LINGRO,LINGRO                                       0513 02012000
*           GEN;                                                   0514 02013000
         EJECT                                                          02014000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0515 02015000
*/*     PRECEDING CODE -                                       */  0515 02016000
*/*READ:         D (YES,OUTERR,NO,%REMTST) IS SOH FIRST ?      */  0515 02017000
*/*%REMTST:      D (YES,,NO,%GO002) RMTDV ON ?                 */  0515 02018000
*/*              D (YES,OUTSINK,NO,%GO001) SINK EXPENDED ?     */  0515 02019000
*/*%GO001:       P (,%AIDTST) PUT 2260 DEVICE ADDRESS IN SINK      0515 02020000
*/*                AND BUMP SOURCE BY TWO, SINK BY ONE         */  0515 02021000
*/*%GO002:       D (YES,OUTSINK,NO,%AIDTST) SINK EXPENDED ?    */  0515 02022000
*/*%AIDTST:      D (YES,,NO,%RDBUF) AID FROM PA1,2,3 OR CLEAR ?*/  0515 02023000
*/*              P PUT AID IN SINK                             */  0515 02024000
*/*              D (YES,,NO,%GO003) RMTDV ON ?                 */  0515 02025000
*/*              P (,OUTSPEC) PUT END FRAMING IN SINK, BUMP        0515 02026000
*/*                SINK BY TWO                                 */  0515 02027000
*/*%GO003:       P (,OUTSPEC) BUMP SINK BY ONE                 */  0515 02028000
*/*%RDBUF:       D (YES,,NO,%GO006) READ BUFFER OPERATION ?    */  0515 02029000
*/*              D (YES,,NO,%NOSBA) SBA NEXT IN SOURCE ?       */  0515 02030000
*/*              P (,%GO004) BUMP SOURCE BY SIX                */  0515 02031000
*/*%NOSBA:       P BUMP SOURCE BY THREE                        */  0515 02032000
*/*%GO004:       P SET SHRD OFF, SET CURLIN TO ZERO            */  0515 02033000
*/*READ1:        D (YES,READOUT,NO,RDLAT) ALL 2260 LINES DONE ?*/  0515 02034000
*/*%GO006:       P INCREMENT SOURCE, GET CURSOR ADDRESS IN         0515 02035000
*/*                CURSAD                                      */  0515 02036000
*/*              S INVERT:CONVERT 3270 BUFFER TO HEXADECIMAL   */  0515 02037000
*/*              D (YES,RDSBATST,NO,OUTCURS) CURSOR ON 2260 ?  */  0515 02038000
*/*RDSBATST:     P SAVE CURSAD TEMPORARILY IN SOMAOD           */  0515 02039000
*/*              D (YES,,NO,%GO007) SBA NEXT IN SOURCE ?       */  0515 02040000
*/*              P BUMP DACIND BY THREE, SET SOMHER ON, GET        0515 02041000
*/*                FIRST DATA ADDRESS                          */  0515 02042000
*/*              S INVERT:CONVERT 3270 BUFFER TO HEXIDECIMAL   */  0515 02043000
*/*RDOPTST:      P SAVE SOM ADDRESS IN SPECAR, RESTORE CURSAD  */  0515 02044000
*/*              P CALCULATE OFFSET TO FIRST INTEGRAL LINE         0515 02045000
*/*                BOUNDRY, BUMP DACIND BY OFSET               */  0515 02046000
*/*%GO007:       D (YES,,NO,%GO008) READ MI OPERATION ?        */  0515 02047000
*/*              P  (,%GO009) SET SHRD OFF                     */  0515 02048000
*/*%GO008:       P  SET SHRD ON                                */  0515 02049000
*/*%GO009:       D (YES,%GO009A,NO,CKSMI) IS SOMHER ON ?       */  0515 02050000
*/*%GO009A:      P (,SOURTST) SET LINGRO TO ZERO               */  0515 02051000
*        GEN;                                                      0515 02052000
         EJECT                                                          02053000
*/**************************************************************/  0516 02054000
*/**************************************************************/  0516 02055000
*/*                                                            */  0516 02056000
*/* SOURTST ENTERED FROM READ FOR THE PURPOSE OF ESTABLISHING  */  0516 02057000
*/*     THE BOUNDRIES OF DATA CONVERSION. SOURTST IS ALSO      */  0516 02058000
*/*     ENTERED FROM CKSMI (IN SOURTST) AFTER LOCATING AN      */  0516 02059000
*/*     SMI () IN THE DATA STREAM. SOURTST INCREMENTS         */  0516 02060000
*/*     DACIND TO POINT TO THE FIRST LINE BOUNDRY IN THE       */  0516 02061000
*/*     DATA STREAM, PLACES THE LENGTH TO BE PROCESSED         */  0516 02062000
*/*     IN LINGRO (SCREEN WRAP IS CONSIDERED), AND BRANCHES    */  0516 02063000
*/*     TO RDLAT.                                              */  0516 02064000
*/*                                                            */  0516 02065000
*/*         CKSMI IS ENTERED FROM READ IF NO SBA SEQUENCE      */  0516 02066000
*/*     EXISTS IN THE DATA STREAM. ITS PURPOSE IS TO           */  0516 02067000
*/*     LOCATE AN X'4A' () IN THE DATA STREAM. IF THE SMI     */  0516 02068000
*/*     IS LOCATED CONTROL IS PASSED TO SOURTST. IF NO         */  0516 02069000
*/*     SMI CAN BE FOUND, THE NO SMI PRESENT BIT IS SET ON     */  0516 02070000
*/*     IN DACFLG AND CONTROL IS PASSED TO OUTNORM (IN         */  0516 02071000
*/*     OUTPROC). THIS IS ACCOMPLISHED BY READOUT.             */  0516 02072000
*/*                                                            */  0516 02073000
*/*         READOUT IS THE ROUTE TAKEN BY THE READ             */  0516 02074000
*/*     PROCESSING ROUTINES FOR NORMAL EXIT. READOUT           */  0516 02075000
*/*     INSERTS AN ETX IF NEEDED, AND BRANCHES TO OUTNORM      */  0516 02076000
*/*     (IN OUTPROC).                                          */  0516 02077000
*/*                                                            */  0516 02078000
*/**************************************************************/  0516 02079000
*/**************************************************************/  0516 02080000
*SOURTST:;                                                         0516 02081000
SOURTST  DS    0H                                                  0517 02082000
*                     SOMADD = SPECAR;  /*SAVE SOM ADDRESS     */  0517 02083000
         LR    SOMADD,SPECAR                                       0517 02084000
*                GEN SETS(WORKREG4,WORKREG3,REG0,SPECAR,DACSINAD,BLAT,  02085000
*                            CARADD,CURSAD,DACFLG,LINGRO,SOMADD,LNGDT)  02086000
*                    REFS(DACAD,DACOPTYP,PROT,DACDSSCR,            0518 02087000
*                            DACANSCR,SOMHER)                      0518 02088000
*                    FLOWS(SOURTST,READOUT) SEQFLOW  ;    /*Y02947*/    02089000
         SR    WORKREG4,WORKREG4    CLEAR EVEN                  CODE2   02090000
         CR    CURSAD,SOMADD       SOM RELATIVE TO CURSOR ?     CODE2   02091000
         BL    WRAP                WE HAVE SCREEN WRAPAROUND    CODE2   02092000
         BE    READOUT             WE HAVE NO DATA              CODE2   02093000
         LR    WORKREG3,CURSAD     GET CURSOR POINTER           CODE2   02094000
         SR    REG0,REG0           CLEAR A WORK REGISTER        CODE2   02095000
         IC    REG0,ANWIDE(DACAD)  PICK UP 3270 WIDTH           CODE2   02096000
         DR    WORKREG4,REG0        LINE HOLDING CURSOR - 1     CODE2   02097000
         LR    SPECAR,WORKREG3     SAVE CURSORS LINE            CODE2   02098000
         SR    WORKREG4,WORKREG4       CAN THE REMAINDER        CODE2   02099000
         LR    WORKREG3,SOMADD     PICK UP THE SOM POINTER      CODE2   02100000
         DR    WORKREG4,REG0         LINE HOLDING SOM - 1       CODE2   02101000
         LR    CURLIN,WORKREG3    SAVE SOMS LINE                YA01252 02102000
         SR    SPECAR,WORKREG3    GET THE LINE DIFFERENCE       CODE2   02103000
         LTR   LINGRO,LINGRO           DO WE HAVE SCREEN WRAP?  YA01252 02104000
         BZ    SOURTST1            NO, CONTINUE SETUP           YA01252 02105000
         TM    DACFLG(DACAD),X'80' WRAP WITH OPERATOR SMI ?     YA01252 02106000
         BZ    SOURTST1            NO, CONTINUE SETUP           YA01252 02107000
         SR    WORKREG4,WORKREG4       CLEAR                    YA01252 02108000
         IC    WORKREG4,DSLINE(DACAD)  PICK UP 2260 LINE COUNT  YA01252 02109000
         SR    WORKREG4,WORKREG3     GET DIFFERENCE             YA01252 02110000
         LA    WORKREG4,0(WORKREG4)  INSURE HIGH BYTE CLEAR     YA01252 02111000
         STC   WORKREG4,DACSINAD(DACAD) SAVE VALUE              YA01252 02112000
SOURTST1 EQU   *                   NOT SMI WRAP AND COMMON      YA01252 02113000
         SR    WORKREG4,WORKREG4    CAN THE REMAINDER           YA01252 02114000
         IC    WORKREG4,DSWIDE(DACAD)  PICK UP THE 2260 WIDTH   CODE2   02115000
         SR    REG0,WORKREG4      GET SCREEN WIDTH DIFFERENCE   CODE2   02116000
         SR    WORKREG4,WORKREG4    CLEAR EVEN OF EVEN/ODD PAIR YA01252 02117000
         LR    WORKREG3,SPECAR     GET THE LINE DIFFERENCE      CODE2   02118000
         MR    WORKREG4,REG0       RIGHT BYTES LOST TO NULLS    CODE2   02119000
         LR    CARADD,CURSAD       KEEP CURSAD INTACT           CODE2   02120000
         SR    CARADD,SOMADD       3270 SCREEN POSITIONS SPANND CODE2   02121000
         SR    CARADD,WORKREG3     REDUCE BY LOST NULL COUNT    CODE2   02122000
         LTR   LINGRO,LINGRO                                            02123000
         BZ    NOWRAP                                                   02124000
         TM    DACOPTYP(DACAD),X'40'                                    02125000
         BNO   PROTWRAP                                                 02126000
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                        02127000
         BNE   PROTWRAP                                                 02128000
         BCTR  CARADD,0                                                 02129000
*********************************************************************** 02130000
*                                                                       02131000
*   PROTWRAP   FROM      FIXIT                                          02132000
*        ADJUST FOR PROTECTED FIELD DURING SCREEN WRAP ON A             02133000
*   READ OPERATION                                                      02134000
*********************************************************************** 02135000
PROTWRAP EQU   *                                                        02136000
         SR    WORKREG4,WORKREG4                                        02137000
         SR    WORKREG3,WORKREG3                                        02138000
         IC    WORKREG4,DSLINE(DACAD)                                   02139000
         IC    WORKREG3,ANLINE(DACAD)                                   02140000
         SR    WORKREG3,WORKREG4                                        02141000
         SR    WORKREG4,WORKREG4                                        02142000
         IC    WORKREG4,DSWIDE(DACAD)                                   02143000
         MR    WORKREG4,WORKREG4                                        02144000
         SR    CARADD,WORKREG3                                          02145000
         TM    DACFLG(DACAD),X'80' WRAP WITH OPERATOR SMI ? LD @ZA00540 02146000
         BZ    PROTWRAX            NO, DON'T ADJUST FOR WRAP    CODE2   02147000
         SR    REG0,REG0           CLEAR A WORK REGISTER        CODE2   02148000
         SR    WORKREG4,WORKREG4   CLEAR EVEN OF EVEN/ODD PAIR  CODE2   02149000
         SR    WORKREG3,WORKREG3   CLEAR ODD OF EVEN/ODD PAIR   CODE2   02150000
         IC    REG0,ANWIDE(DACAD)   GET 3270 WIDTH              CODE2   02151000
         IC    WORKREG3,DSLINE(DACAD)  GET 2260 LINE COUNT      CODE2   02152000
         MR    WORKREG4,REG0        END ADDRESS OF LAST 3270    CODE2   02153000
*                                  LINE CONTAINING A 2260 LINE  CODE2   02154000
         SR    WORKREG4,WORKREG4    CLEAR A WORK REGISTER       YA01252 02155000
         IC    WORKREG4,DSWIDE(DACAD)  GET 2260 WIDTH           CODE2   02156000
         SR    REG0,WORKREG4       DIFFERENCE 3270 - 2260 WIDTH CODE2   02157000
         SR    15,0                LAST 2260 SCREEN POSITION    CODE2   02158000
*                                  PLUS ONE                     CODE2   02159000
         LR    CARADD,WORKREG3     SAVE                         CODE2   02160000
         SR    WORKREG3,WORKREG3   CLEAR                        YA01252 02161000
         IC    WORKREG3,DACSINAD(DACAD)  PICK UP DIFFERENCE     YA01252 02162000
         XC    DACSINAD(1,DACAD),DACSINAD(DACAD) CLEAR BYTE     YA01252 02163000
         MR    WORKREG4,REG0        COMPUTE BYTES LOST          YA01252 02164000
         SR    CARADD,WORKREG3     REDUCE COUNT                 YA01252 02165000
         SR    CARADD,SOMADD       COMPUTE DATA LENGTH          CODE2   02166000
PROTWRAX EQU   *                                                CODE2   02167000
         LR    CURSAD,CARADD                                            02168000
         AR    CURSAD,SOMADD                                            02169000
*********************************************************************** 02170000
*                                                                       02171000
*   NOWRAP     FROM      FIXIT, PROTWRAP                                02172000
*        SET LENGTH FOR PROCESSING READ DATA                            02173000
*********************************************************************** 02174000
NOWRAP   EQU   *                                                        02175000
         TM    21(DACAD),X'80'     CHECK RVOID=YES             @YA03964 02176000
         BZ    NOWRAP2             BR IF NO                    @YA03964 02177000
         LR    WORKREG3,SOURAD     LOAD CURRENT SOURCE ADR     @YA03964 02178000
         L     WORKREG4,4(DACAD)   LOAD ORIGINAL SOURCE ADR    @YA03964 02179000
         LA    WORKREG4,0(WORKREG4)     CLEAR HI ORDER BYTE    @YA03964 02180000
         SR    WORKREG3,WORKREG4   GET PROCESSED LENGTH        @YA03964 02181000
         LH    CARADD,12(DACAD)    LOAD ORIG. SOURCE LENGTH    @YA03964 02182000
         SR    CARADD,WORKREG3     REMAINDER IN CARADD         @YA03964 02183000
NOWRAP2  EQU   *                                               @YA03964 02184000
         LR    WORKREG3,CARADD                                          02185000
         LA    WORKREG4,255               EXCEDES 255 BYTES             02186000
         CR    WORKREG3,WORKREG4          IF NO                         02187000
         BNH   UND256                   GO SET ACTUAL IF YES            02188000
         LA    LINGRO,255               SET AT 255                      02189000
         OI    DACFLG(DACAD),X'10'      SET LONG DATA FLAG              02190000
         B     OVR256                   GO SET IT UP                    02191000
*********************************************************************** 02192000
*                                                                       02193000
*   WRAP       FROM      SOURTST                                        02194000
*        SCREEN WRAP ON A READ (CURSOR POSITION LESS THAN SOM           02195000
*********************************************************************** 02196000
WRAP     EQU   *                        WRAPAROUND PRESENT              02197000
         TM    DACFLG(DACAD),X'08' SOMHER FLAG ON (SBA IN DATA) CODE2   02198000
         BO    WRAP1               YES, NOT OPERATOR SMI        CODE2   02199000
         OI    DACFLG(DACAD),X'80' SET BLAT FLAG TO INDICATE    CODE2   02200000
*                                  WRAP WITH OPERATOR SMI       CODE2   02201000
WRAP1    EQU   *                   CODE2                                02202000
         SR    LINGRO,LINGRO            CLEAR FOR SET GROUP             02203000
         IC    LINGRO,ANLINE(DACAD)         GET 3270 LINE COUNT         02204000
         SR    CARADD,CARADD            CLEAR FOR WORK                  02205000
         IC    CARADD,ANWIDE(DACAD)         GET 3270  WIDTH             02206000
         TM    DACOPTYP(DACAD),X'40'                                    02207000
         BO    TOPLOST                                                  02208000
         LR    WORKREG3,CARADD                PUT IN WORK AND           02209000
         MR    WORKREG4,LINGRO                CALCULATE LAST            02210000
         LR    LINGRO,WORKREG3                SAVE                      02211000
         AR    CURSAD,LINGRO            MOVE CURSOR BY SCREN            02212000
         B     SOURTST                  GO BACK AND TRY 'GIN            02213000
TOPLOST  EQU   *                                                        02214000
         IC    LINGRO,DSLINE(DACAD)                                     02215000
         IC    WORKREG3,DSWIDE(DACAD)                                   02216000
         MR    WORKREG4,LINGRO                                          02217000
         LR    CURSAD,WORKREG3                                          02218000
         SR    LINGRO,LINGRO                                            02219000
         B     SOURTST                                                  02220000
*********************************************************************** 02221000
*                                                                       02222000
*   UND256     FROM      NOWRAP                                         02223000
*        SET CALCULATED LENGTH IN LINGRO                                02224000
*********************************************************************** 02225000
UND256   EQU   *                        LESS THAN 256 BYTES             02226000
         LR    LINGRO,WORKREG3                SET REAL LENGTH           02227000
*********************************************************************** 02228000
*                                                                       02229000
*   OVR256     FROM      NOWRAP, UND256                                 02230000
*        OUT TO RDLAT AFTER READ DATA LENGTH SET                        02231000
*********************************************************************** 02232000
OVR256   EQU   *                        MORE THAN 256                   02233000
         SR    SOMADD,SOMADD       SOM TO ZERO FOR PROCESSING   YA01253 02234000
         LR    CURSAD,CARADD       SAVE REAL LENGTH IN CURSAD   YA01252 02235000
*                  END;                                            0519 02236000
*                ELSE                                              0520 02237000
*                  DO;                                             0520 02238000
         B     @RC00511                                            0520 02239000
@RF00511 DS    0H                                                  0521 02240000
*/**************************************************************/  0521 02241000
*/*                                                            */  0521 02242000
*/* CKSMI      FROM      READ1, NOSTART                        */  0521 02243000
*/*      SBA SEQUENCE NOT FOUND, SEARCH FOR SMI                */  0521 02244000
*/**************************************************************/  0521 02245000
*CKSMI:;                                /*SET UP LEN YO BE     */  0521 02246000
CKSMI    DS    0H                                                  0522 02247000
*           GEN SETS(WORKREG3,WORKREG4,LINGRO)                     0522 02248000
*                 REFS(DACSRCAD,DACSRCLN,DACAD,SOURAD,FULL0)       0522 02249000
*                      FLOWS(SMILOOP,NOSTART) SEQFLOW ; /*Y02947*/ 0522 02250000
         LA    WORKREG3,255                   SEARCHED IN ATTEMPT       02251000
         L     WORKREG4,DACSRCAD(DACAD)       TO FIND AN SMI            02252000
         AH    WORKREG4,DACSRCLN(DACAD)       CHARACTER-GET TRUE        02253000
         SR    WORKREG4,SOURAD            REMAINING SOURCE              02254000
         CR    WORKREG3,WORKREG4          IS IT LESS THAN 256           02255000
         BNL   UNDER256                 YES, SET UP REST                02256000
         LA    LINGRO,255               NO, SET UP MAXIMUM              02257000
         B     SMILOOP                  GO LOOK FOR SMI                 02258000
*********************************************************************** 02259000
*                                                                       02260000
*   UNDER256   FROM      CKSMI                                          02261000
*        TOTAL SEARCH LENGTH IS 255 OR LESS                             02262000
*********************************************************************** 02263000
UNDER256 EQU   *                                                        02264000
         LR    LINGRO,WORKREG4                SET UP REMAINDER          02265000
         C     LINGRO,FULL0                                             02266000
         BNH   NOSTART                                                  02267000
*/**************************************************************/  0523 02268000
*/*                                                            */  0523 02269000
*/* SMILOOP    FROM      CKSMI, NOTSMI, UNDER256               */  0523 02270000
*/*      SEARCH FOR SMI ()                                    */  0523 02271000
*/**************************************************************/  0523 02272000
*SMILOOP:;                              /*LOOK FOR SMI         */  0523 02273000
SMILOOP  DS    0H                                                  0524 02274000
*           GEN DEFS(NOSTART) FLOWS(SOURTST,BACKGO,CKSMI) SEQFLOW  0524 02275000
*                SETS(LINGRO,SOURAD,SPECAR,CARADD,WORKREG3,        0524 02276000
*                     WORKREG4,SINKAD,SOURAD,DACFLG,NOSMI)         0524 02277000
*                REFS(DACAD,DACSRCAD,RMTDV,STXHER,DSWIDE,ANWIDE,   0524 02278000
*                     FULL0,DACSINAD,DACSRCLN)    ;      /*Y02947*/     02279000
         BCTR  LINGRO,0                 TRUE COUNT FOR XLATE            02280000
         EX    LINGRO,XLATE             TRANS AND TEST SOURC            02281000
         BC    8,NOSTART1               BRANCH IF TEST FAILS            02282000
         AR    LINGRO,SOURAD            SET GROUP TO UNTESTD            02283000
         SR    LINGRO,CARADD            PORTION                         02284000
         LA    SOURAD,1(CARADD)         SET ON PAST CHARACT             02285000
         CLI   0(CARADD),X'03'                                          02286000
         BE    ENDAT                                                    02287000
         CLI   0(CARADD),X'4A'          IS IT AN SMI                    02288000
         BNE   NOTSMI                   NO, GO SEE IF MORE              02289000
         L     SPECAR,DACSRCAD(DACAD)    PICK UP CORE ADDRESS           02290000
         LA    SPECAR,3(SPECAR)         OF FIRST DATA BYTE              02291000
         SR    CARADD,SPECAR            COMPUTE BUFFER POSIT            02292000
         LA    SPECAR,1(CARADD)        OF SMI                           02293000
         TM    DACFLG(DACAD),X'01'                                      02294000
         BNO   ADJUST                  NO, GO COMPUTE LOST NULLS        02295000
         BCTR  SPECAR,0                 DECREMENT FOR TWO               02296000
         BCTR  SPECAR,0                 BYTE 3270 ADDRESS               02297000
         TM    DACFLG(DACAD),X'02'                                      02298000
         BNO   ADJUST                 NO, GO COMPUTE LOST NULLS         02299000
         BCTR  SPECAR,0                 DECREMENT FOR STX               02300000
*********************************************************************** 02301000
*                                                                       02302000
*   ADJUST     FROM     SMILOOP                                         02303000
*        COMPUTE LOST NULLS AND ADJUST SMI POSITION                     02304000
*********************************************************************** 02305000
ADJUST   EQU   *                      COMPUTE LOST NULLS                02306000
         SR    CARADD,CARADD          CLEAR A REG FOR WORK              02307000
         IC    CARADD,DSWIDE(DACAD)       PICK UP DSWIDE                02308000
         CR    SPECAR,CARADD          SMI IN FIRST LINE ?               02309000
         BL    ADJUST1                                                  02310000
         LR    WORKREG3,SPECAR              SAVE THE DISPLACEMENT       02311000
         SR    WORKREG4,WORKREG4                  CLEAR EVEN REG        02312000
         DR    WORKREG4,CARADD              DIVIDE BY DSWIDE            02313000
         SR    WORKREG4,WORKREG4                  CLEAR EVEN REG        02314000
         IC    WORKREG4,ANWIDE(DACAD)           PICK UP ANWIDE          02315000
         SR    WORKREG4,CARADD              GET SCREEN DIFFERENCE       02316000
         MR    WORKREG4,WORKREG4                  COMPUTE LOST NULLS    02317000
         AR    SPECAR,WORKREG3              ADD TO DISPLACEMENT         02318000
ADJUST1  EQU   *                                                        02319000
         SR    LINGRO,LINGRO                                            02320000
         B     SOURTST                                                  02321000
*********************************************************************** 02322000
*                                                                       02323000
*   NOTSMI     FROM      SMILOOP                                        02324000
*        CHARACTER FOUND IS NOT AN SMI                                  02325000
*********************************************************************** 02326000
NOTSMI   C     LINGRO,FULL0             ANY LEFT                        02327000
         BE    NOSTART                  NO, CHECK REST                  02328000
         B     SMILOOP                  YES, DO REST                    02329000
ENDAT    EQU   *                                                        02330000
         TM    DACFLG(DACAD),X'01'                                      02331000
         BO    NOTSMI                                                   02332000
         L     SOURAD,DACSRCAD(DACAD)                                   02333000
         L     SINKAD,DACSINAD(DACAD)                                   02334000
         B     BACKGO                                                   02335000
*********************************************************************** 02336000
*                                                                       02337000
*   NOSTART1   FROM      SMILOOP                                        02338000
*        NO CHARACTERS SELECTED BY TEST                                 02339000
*********************************************************************** 02340000
NOSTART1 AR    SOURAD,LINGRO            INCREMENT BEGINNING             02341000
*********************************************************************** 02342000
*                                                                       02343000
*   NOSTART    FROM      NOSTART1, NOTSMI                               02344000
*        TEST FOR ADDITIONAL SOURCE TO TEST                             02345000
*********************************************************************** 02346000
NOSTART  EQU   *                        SMI NOT FOUND                   02347000
         LH    WORKREG3,DACSRCLN(DACAD)       COMPUTE CORE              02348000
         A     WORKREG3,DACSRCAD(DACAD)       ADDRESS OF LAST           02349000
         BCTR  WORKREG3,0                     CHARACTER IN SOURCE       02350000
         CR    WORKREG3,SOURAD                ARE WE THERE              02351000
         BH    CKSMI                                                    02352000
         OI    DACFLG(DACAD),X'04'                                      02353000
*/**************************************************************/  0525 02354000
*/*                                                            */  0525 02355000
*/* READOUT    FROM      READ1, MORTST, RDETX, SOURTST         */  0525 02356000
*/*      NORMAL EXIT PROCESSING FOR READ OPERATIONS            */  0525 02357000
*/**************************************************************/  0525 02358000
*RVOIDOUT:;                                                        0525 02359000
RVOIDOUT DS    0H                                                  0526 02360000
*        GEN SETS(LNGDT,DACFLG) REFS(DACAD) SEQFLOW ;      /*Y02947*/   02361000
         NI    DACFLG(DACAD),X'EF' TURN OFF LONG DATA FLAG     YA01252  02362000
*READOUT:;                                                         0527 02363000
READOUT  DS    0H                                                  0528 02364000
*           GEN SETS(SINK,SINKAD,DACFLG,BLAT,SOURAD,CURSAD,        0528 02365000
*                   SPECAR,LINGRO)                                 0528 02366000
*               REFS(DACAD,RMTDV,DACSRCAD,STXHER,DACCRS)           0528 02367000
*               FLOWS(OUTNORM,SOURTST) NOSEQFLOW ;         /*Y02947*/   02368000
         TM    DACFLG(DACAD),X'80'  WRAP WITH OPERATOR SMI ?    CODE2   02369000
         BO    READOUT1            YES, SET UP TO RETURN TO     CODE2   02370000
*                                  FIRST OF DATA STREAM TO      CODE2   02371000
*                                  PICK UP LAST OF DATA         CODE2   02372000
         TM    DACFLG(DACAD),X'01'                                      02373000
         BZ    OUTNORM               NO, GO CLEAN OUT                   02374000
         MVI   0(SINKAD),X'03'                                          02375000
         LA    SINKAD,1(SINKAD)                                         02376000
         B     OUTNORM                  GO CLEAN OUT                    02377000
READOUT1 EQU   *                                                CODE2   02378000
         NI    DACFLG(DACAD),X'7F'   TURN OFF BLAT FLAG         CODE2   02379000
         L     SOURAD,DACSRCAD(DACAD)   GET SOURCE ORIGIN       CODE2   02380000
         LA    SOURAD,3(SOURAD)    POINT TO FIRST DATA BYTE     CODE2   02381000
         TM    DACFLG(DACAD),X'01'   REMOTE DEVICE ?            CODE2   02382000
         BZ    READOUT3            NO, SOURAD IS CORRECT        CODE2   02383000
         LA    SOURAD,2(SOURAD)    BUMP PAST ADDRESS BYTES      CODE2   02384000
         TM    DACFLG(DACAD),X'02'   STX IN DATA STREAM ?       CODE2   02385000
         BNO   READOUT3            NO, SOURAD IS CORRECT        CODE2   02386000
         LA    SOURAD,1(SOURAD)    BUMP PAST STX                CODE2   02387000
READOUT3 EQU   *                                                CODE2   02388000
         LH    CURSAD,DACCRS(DACAD)  RESTORE CURSOR TO ORIGINAL CODE2   02389000
         LA    SPECAR,256          MAX LENGTH                   YA01252 02390000
         CR    SPECAR,CURSAD       256 LEFT ?                   YA01252 02391000
         BH    READOUT4            YES, CONTINUE SETUP          YA01252 02392000
         BCTR  CURSAD,0            REDUCE BY ONE                YA01252 02393000
READOUT4 EQU   *                                                YA01252 02394000
         SR    SPECAR,SPECAR       SET SOM POINTER TO ZERO      CODE2   02395000
         SR    LINGRO,LINGRO       CLEAR WRAP INDICATION        CODE2   02396000
         B     SOURTST             GO SET UP SECOND PASS        CODE2   02397000
*                  END;                                            0529 02398000
*           GEN;                                                   0530 02399000
@RC00511 DS    0H                                                  0530 02400000
         EJECT                                                          02401000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0531 02402000
*/*     PRECEDING CODE -                                       */  0531 02403000
*/*SOURTST:      P SAVE SOM ADDRESS IN SOMADD                  */  0531 02404000
*/*              D (LOW,WRAP,EQ,READOUT,HI,) CURSOR ADDRESS        0531 02405000
*/*                RELATIVE TO SOM ?                           */  0531 02406000
*/*              P CALCULATE TOTAL SCREEN DIFFERENCE BETWEEN       0531 02407000
*/*                SOM AND CURSOR                              */  0531 02408000
*/*              P TEMPORARILY SAVE VALUE IN CARADD            */  0531 02409000
*/*              P PICK UP DACIND AND DECREMENT BY THREE       */  0531 02410000
*/*              D (YES,,NO,REMOTST) SOMHER ON ?               */  0531 02411000
*/*              P DECREMENT MODIFIED DACIND BY THREE          */  0531 02412000
*/*REMOTST:      D (YES,,NO,FIXIT) RMTDV ON ?                  */  0531 02413000
*/*              P DECREMENT MODIFIED DACIND BY TWO            */  0531 02414000
*/*              D (YES,,NO,FIXIT) STXHER ON ?                 */  0531 02415000
*/*              P DECREMENT MODIFIED DACIND BY ONE            */  0531 02416000
*/*FIXIT:        P INCREMENT DIFFERENCE BY OFFSET FROM SOM TO      0531 02417000
*/*                FIRST LINE BOUNDRY                          */  0531 02418000
*/*              P DIVIDE RESULT BY 3270 SCREEN WIDTH TO GET       0531 02419000
*/*                NUMBER OF LINES SPANNED                     */  0531 02420000
*/*              P COMPUTE DIFFERENCE BETWEEN 2260 AND 3270        0531 02421000
*/*                SCREEN WIDTHS                               */  0531 02422000
*/*              P MULTIPLY WIDTH DIFFERENCE BY NUMBER OF LINES    0531 02423000
*/*                SPANNED                                     */  0531 02424000
*/*              P DECREMENT CARADD BY RESULT                  */  0531 02425000
*/*              D (YES,NOWRAP,NO,) LINGRO = ZERO ?            */  0531 02426000
*/*              D (YES,,NO,PROTWRAP) PROT = YES SPECIFIED ?   */  0531 02427000
*/*              D (YES,,NO,PROTWRAP) SCREENS EQUAL ?          */  0531 02428000
*/*              P DECREMENT CARADD BY ONE                     */  0531 02429000
*/*PROTWRAP:     P CALCULATE LINE DIFFERENCE BETWEEN 2260 AND      0531 02430000
*/*                3270                                        */  0531 02431000
*/*              P MULTIPLY BY 2260 WIDTH                      */  0531 02432000
*/*              P DECREMENT CARADD BY RESULT                  */  0531 02433000
*/*NOWRAP:       D (YES,,NO,UND256) STREAM OVER 255 BYTES ?    */  0531 02434000
*/*              P (,OVR256) SET LINGRO TO 255, TURN ON LNGDT  */  0531 02435000
*/*WRAP:         P (,SOURTST) INCREMENT CURSAD BY 3270 SCREEN      0531 02436000
*/*                SIZE, SET LINGRO NON ZERO                   */  0531 02437000
*/*UND256:       P SET LINGRO TO ACTUAL DATA LENGTH            */  0531 02438000
*/*OVR256:       P (,RDLAT) CLEAR CURLIN                       */  0531 02439000
*/*CKSMI:        P CALCULATE REMAINING SOURCE LENGTH - NOT         0531 02440000
*/*                INCLUDING AID, SBA, ETC.                    */  0531 02441000
*/*              D (YES,UNDER256,NO,) LENGTH LESS THAN 256 ?   */  0531 02442000
*/*              P (,SMILOOP) SET LINGRO TO 256                */  0531 02443000
*/*UNDER256:     P SET LINGRO TO ACTUAL LENGTH                 */  0531 02444000
*/*              D (YES,NOSTART,NO,) IS LINGRO ZERO ?          */  0531 02445000
*/*SMILOOP:      D (NO,NOSTART1,YES,) ANY SPECIAL CHARACTERS ? */  0531 02446000
*/*              P SET LINGRO TO UNTESTED PORTION              */  0531 02447000
*/*              D (YES,ENDAT,NO,) IS IT AN ETX ?              */  0531 02448000
*/*              D (NO,NOTSMI,YES,) IS IT AN SMI ?             */  0531 02449000
*/*              P COMPUTE BUFFER POSITION OF SMI              */  0531 02450000
*/*              D (NO,ADJUST,YES,) IS RMTDV ON ?              */  0531 02451000
*/*              P DECREMENT BY TWO TO REMOTE ADDRESS          */  0531 02452000
*/*              D (NO,ADJUST,YES,) IS STXHER ON ?             */  0531 02453000
*/*              P (,ADJUST) DECREMENT BY ONE FOR STX          */  0531 02454000
*/*ADJUST:       D (NO,,YES,ADJUST1) IS SMI IN FIRST LINE ?    */  0531 02455000
*/*              P DIVIDE DISPLACEMENT OF SMI INTO SOURCE BY       0531 02456000
*/*                DSWIDE                                      */  0531 02457000
*/*              P MULTIPLY QUOTIENT BY ANWIDE-DSWIDE TO GET       0531 02458000
*/*                NUMBER OF LOST NULLS                        */  0531 02459000
*/*              P ADD NUMBER OF LOST NULLS                        0531 02460000
*/*                TO DISPLACEMENT INTO SOURCE OF SMI          */  0531 02461000
*/*ADJUST1:      P (,SOURTST) CLEAR LINGRO TO ZERO             */  0531 02462000
*/*NOTSMI:       D (NO,SMILOOP,YES,NOSTART) IS LINGRO ZERO ?   */  0531 02463000
*/*ENDAT:        D (YES,NOTSMI,NO,) RMTDV ON ?                 */  0531 02464000
*/*              P (,BACKGO) RESTORE SOURCE, SINK TO BEGINNING */  0531 02465000
*/*NOSTART1:     P INCREMENT SOURAD BY LINGRO                  */  0531 02466000
*/*NOSTART:      D (NO,CKSMI,YES,) SOURAD POINT TO LAST BYTE ? */  0531 02467000
*/*              P TURN ON NOSMI FLAG                          */  0531 02468000
*/*READOUT:      D (NO,OUTNORM,YES,%REMT) IS RMTDV ON ?        */  0531 02469000
*/*%REMT:        P (,OUTNORM) PUT ETX IN SINK, BUMP SINK       */  0531 02470000
*        GEN;                                                      0531 02471000
         EJECT                                                          02472000
*/**************************************************************/  0532 02473000
*/**************************************************************/  0532 02474000
*/*                                                            */  0532 02475000
*/* RDLAT PROCESSING OF INPUT DATA STREAMS NOT INVOLVING       */  0532 02476000
*/*     UNIQUE CHARACTERS. TESTING IS DONE FOR UNIQUE          */  0532 02477000
*/*     CHARACTERS AND IF FOUND, RDLAT MOVES THAT              */  0532 02478000
*/*     PORTION OF THE SOURCE WHICH PRECEDES THE UNIQUE        */  0532 02479000
*/*     CHARACTER INTO THE SINK. CONTROL IS THEN PASSED TO     */  0532 02480000
*/*     THE APPROPRIATE SPECIAL PROCESSING CODE IN KERF.       */  0532 02481000
*/*     CONTROL IS PASSED THROUGH A BRANCH TABLE BASED         */  0532 02482000
*/*     UPON AN ARGUMENT SELECTED FROM 'TABLE' BY XLATE.       */  0532 02483000
*/*                                                            */  0532 02484000
*/*       RDMOV (RNOCHAR) MOVES THE ENTIRE GROUP TO THE        */  0532 02485000
*/*     SINK, ADJUSTS THE GROUP, AND PASSES CONTROL TO         */  0532 02486000
*/*     MORTST IF NO UNIQUE CHARACTER IS FOUND.                */  0532 02487000
*/*                                                            */  0532 02488000
*/*       MORTST VERIFYS THAT THERE IS SOURCE LEFT TO          */  0532 02489000
*/*     PROCESS, IF NOT CONTROL IS PASSED TO READOUT IN        */  0532 02490000
*/*     SOURTST. IF ITS A READ BUFFER OPERATION, THE SOURCE    */  0532 02491000
*/*     POINTER IS SET TO THE BEGINNING OF THE NEXT LINE,      */  0532 02492000
*/*     THE CURRENT LINE IS INCREMENTED, AND CONTROL IS        */  0532 02493000
*/*     PASSED TO READ1 IN READ. FOR OTHER OPTYPES, THE        */  0532 02494000
*/*     LENGTH IS ESTABLISHED AT 255 OR ALL REMAINING,         */  0532 02495000
*/*     AND CONTROL IS PASSED TO RDLAT.                        */  0532 02496000
*/*                                                            */  0532 02497000
*/**************************************************************/  0532 02498000
*/**************************************************************/  0532 02499000
*RDLAT:     GEN SETS(SPECAR,CARADD,LINGRO)                         0532 02500000
*                REFS(DACSRCAD,DACAD,SOMADD)                       0532 02501000
*                 FLOWS(RNOCHAR) SEQFLOW  ;        /*Y02947*/      0532 02502000
RDLAT    DS    0H                                                  0532 02503000
         SR    SPECAR,SPECAR                                            02504000
         SR    CARADD,CARADD                                            02505000
         BCTR  LINGRO,0                 SET COUNT FOR XLATE             02506000
         EX    LINGRO,XLATE                                             02507000
         LA    LINGRO,1(LINGRO)         PUT COUNT BACK                  02508000
         BC    8,RNOCHAR                                                02509000
         STC   SPECAR,DACSRCAD(DACAD)     SAVE THE ARGUMENT             02510000
         LR    SPECAR,SOMADD          SAVE THE SOM ADDRESS              02511000
*           SOMADD = LINGRO - CARADD + SOURAD - 1;                 0533 02512000
         LR    SOMADD,LINGRO                                       0533 02513000
         SLR   SOMADD,CARADD                                       0533 02514000
         ALR   SOMADD,SOURAD                                       0533 02515000
         BCTR  SOMADD,0                                            0533 02516000
*           LINGRO = CARADD - SOURAD;                              0534 02517000
         LR    LINGRO,CARADD                                       0534 02518000
         SLR   LINGRO,SOURAD                                       0534 02519000
*                     SPECAR = SPECAR + LINGRO + 1;                0535 02520000
         LR    @12,SPECAR                                          0535 02521000
         ALR   @12,LINGRO                                          0535 02522000
         AH    @12,@CH00061                                        0535 02523000
         LR    SPECAR,@12                                          0535 02524000
*           IF DACSINAD + DACSINLN < SINKAD + LINGRO               0536 02525000
*                THEN GO TO OUTSINK;                               0536 02526000
         LH    @12,DACSINLN(,DACAD)                                0536 02527000
         AL    @12,DACSINAD(,DACAD)                                0536 02528000
         LR    @10,SINKAD                                          0536 02529000
         ALR   @10,LINGRO                                          0536 02530000
         CR    @12,@10                                             0536 02531000
         BL    @RT00536                                            0536 02532000
*                ELSE;                                             0538 02533000
*           IF LINGRO = FULL0                                     0539 02534000
*                THEN                                              0539 02535000
         C     LINGRO,FULL0                                        0539 02536000
         BE    @RF00539                                            0539 02537000
*                  DO;                                             0540 02538000
*           GEN SETS(LINGRO) SEQFLOW ;               /*Y02947*/    0541 02539000
         BCTR  LINGRO,0                                                 02540000
         EX    LINGRO,MYMOV                                             02541000
         LA    LINGRO,1(LINGRO)                                         02542000
*                     SINKAD = SINKAD + LINGRO;                    0542 02543000
         ALR   SINKAD,LINGRO                                       0542 02544000
*                     SOURAD = CARADD;                             0543 02545000
         LR    SOURAD,CARADD                                       0543 02546000
*                  END;                                            0544 02547000
*                ELSE;                                             0545 02548000
@RF00539 DS    0H                                                  0546 02549000
*                     GEN SETS (CARADD,SPECAR,DACSRCAD)            0546 02550000
*                            REFS(DACAD,DACOPTYP,RDBUF)            0546 02551000
*          FLOWS (RNOCHAR,RDNULL,RDFLDMK,RDSMI,RDEOM,              0546 02552000
*                 RDETX,RDSOM,RDBFM,RDBSMI,RDBEOM,RDBSOM)          0546 02553000
*          NOSEQFLOW ;                                       /*Y02947*/ 02554000
         LR    CARADD,SPECAR          SAVE THE SOM ADDRESS              02555000
         SR    SPECAR,SPECAR          CLEAR SPECAR                      02556000
         IC    SPECAR,DACSRCAD(DACAD)        RESTORE THE ARGUMENT       02557000
         XC    DACSRCAD(1,DACAD),DACSRCAD(DACAD) CLEAR 1 BYTE SAVE AREA 02558000
         SLL   SPECAR,2                 MULTIPLY BY FOUR                02559000
         TM    DACOPTYP(DACAD),X'01'      READ BUFFER OPERAT'N          02560000
         BZ    RDTAB(SPECAR)          NO, PROCEDE                       02561000
         LA    SPECAR,40(SPECAR)        YES, PUT INTO READ              02562000
*                                       BUFFER SECTION                  02563000
         B     RDTAB(SPECAR)            BRANCH ON ARGUMENT              02564000
*********************************************************************** 02565000
*                                                                       02566000
*   RDTAB      FROM      RDLAT                                          02567000
*        BRANCH UPON ARGUMENT IN SPECAR TO APPROPRIATE UNIQUE           02568000
*   CHARACTER HANDLING ROUTINE                                          02569000
*********************************************************************** 02570000
RDTAB    EQU   *                        BRANCH TABLE FOR                02571000
*                                       EXIT FROM TRANSLATE             02572000
*                                       AND TEST, IF CONDT'N            02573000
*                                       CODE IS NOT ZERO                02574000
         B     RNOCHAR                  UNUSED POSITION                 02575000
         B     RDNULL                NL IN INPUT DATA   THIS            02576000
*                                       IS INVALID AND A                02577000
*                                       BLANK WILL GO IN                02578000
         B     RDNULL                   NULL IN DATA                    02579000
         B     RDFLDMK                  FIELD MARK IN DATA              02580000
         B     RDSMI                                                    02581000
         B     RDEOM                    EOM IN DATA - X'5A'             02582000
         B     RDNULL                EOM IN DATA - X'6A'                02583000
*                                       THIS IS INVALID AND             02584000
*                                       A BLANK WILL GO IN              02585000
         B     RDETX                    END FRAMING DETECTED            02586000
         B     RDSOM                    SOM IN DATA                     02587000
         B     RNOCHAR                  UNUSED POSITION                 02588000
RDBUFTAB EQU   *                        IF READ BUFFER OPTYP            02589000
         B     RNOCHAR                  UNUSED POSITION                 02590000
         B     RDNULL                   NULL IN DATA                    02591000
         B     RDNULL                NL IN INPUT DATA   THIS            02592000
*                                       IS INVALID AND A                02593000
*                                       BLANK WILL GO IN                02594000
         B     RDBFM                    FIELD MARK IN DATA              02595000
         B     RDBSMI                                                   02596000
         B     RDBEOM                   EOM IN DATA - X'5A'             02597000
         B     RDNULL                EOM IN DATA - X'6A'                02598000
*                                       THIS IS INVALID AND             02599000
*                                       A BLANK WILL GO IN              02600000
         B     RDETX                    END FRAMING DETECTED            02601000
         B     RDBSOM                   SOM IN DATA                     02602000
*/**************************************************************/  0547 02603000
*/*                                                            */  0547 02604000
*/* RNOCHAR    FROM      RDLAT                                 */  0547 02605000
*/*      DATA GROUPS WITH NO UNIQUE CHARACTERS                 */  0547 02606000
*/**************************************************************/  0547 02607000
*RNOCHAR:;                                                         0547 02608000
RNOCHAR  DS    0H                                                  0548 02609000
*           GEN SETS(SOMADD,WORKREG4,WORKREG3,LINGRO,SINKAD,SOURAD)     02610000
*                 REFS(DACSINAD,DACAD,DACSINLN)                    0548 02611000
*                    FLOWS(OUTSINK) SEQFLOW  ;       /*Y02947*/    0548 02612000
         AR    SOMADD,LINGRO                                            02613000
         LR    WORKREG4,SINKAD                                          02614000
         AR    WORKREG4,LINGRO                                          02615000
         L     WORKREG3,DACSINAD(DACAD)                                 02616000
         AH    WORKREG3,DACSINLN(DACAD)                                 02617000
         BCTR  WORKREG3,0                                               02618000
         CR    WORKREG3,WORKREG4                                        02619000
         BL    OUTSINK                                                  02620000
         BCTR  LINGRO,0                                                 02621000
         EX    LINGRO,MYMOV                                             02622000
         LA    LINGRO,1(LINGRO)                                         02623000
         AR    SINKAD,LINGRO                                            02624000
         AR    SOURAD,LINGRO                                            02625000
*/**************************************************************/  0549 02626000
*/*                                                            */  0549 02627000
*/* MORTST     FROM      RNOCHAR, DATLNTST                     */  0549 02628000
*/*      SETUP FOR CONTINUED PROCESSING, IF MORE DATA LEFT     */  0549 02629000
*/**************************************************************/  0549 02630000
*MORTST:;                                                          0549 02631000
MORTST   DS    0H                                                  0550 02632000
*           IF LNGDT = '0'B                                        0550 02633000
*                THEN                                              0550 02634000
         TM    LNGDT(DACAD),B'00010000'                            0550 02635000
         BNZ   @RF00550                                            0550 02636000
*                  DO;                                             0551 02637000
*                     IF RDBUF = '0'B                              0552 02638000
*                          THEN GO TO READOUT;                     0552 02639000
         TM    RDBUF(DACAD),B'00000001'                            0552 02640000
         BZ    @RT00552                                            0552 02641000
*                          ELSE                                    0554 02642000
*                            DO;                                   0554 02643000
*                               SOURAD = SOURAD + ANWIDE -         0555 02644000
*                               DSWIDE;                            0555 02645000
         LR    @12,SOURAD                                          0555 02646000
         SLR   @10,@10                                             0555 02647000
         IC    @10,ANWIDE(,DACAD)                                  0555 02648000
         ALR   @12,@10                                             0555 02649000
         SLR   @10,@10                                             0555 02650000
         IC    @10,DSWIDE(,DACAD)                                  0555 02651000
         SLR   @12,@10                                             0555 02652000
         LR    SOURAD,@12                                          0555 02653000
*                               CURLIN = CURLIN + ONE;             0556 02654000
         AL    CURLIN,ONE                                          0556 02655000
*                               GO TO READ1;                       0557 02656000
         B     READ1                                               0557 02657000
*                            END;                                  0558 02658000
*                  END;                                            0559 02659000
*                ELSE;                                             0560 02660000
@RF00550 DS    0H                                                  0561 02661000
*           GEN SETS(LINGRO,WORKREG4,DACFLG,LNGDT)                 0561 02662000
*                REFS(CURSAD,SOMADD,DACAD)                         0561 02663000
*                   FLOWS(READOUT,RDLAT) SEQFLOW ;     /*Y02947*/  0561 02664000
         LR    LINGRO,CURSAD           PICK UP REAL LENGTH      YA01252 02665000
         SR    LINGRO,SOMADD                                            02666000
         BNP   READOUT                 WE HAVE PASSED CURSOR            02667000
         LA    WORKREG4,255                   THAN 256                  02668000
         CR    LINGRO,WORKREG4                                          02669000
         BNH   LOW256                   LEAVE REMAINDER                 02670000
         LA    LINGRO,255               ELSE PLUG 255 AS                02671000
         B     RDLAT                    GROUP AND GO PROCESS            02672000
*********************************************************************** 02673000
*                                                                       02674000
*   LOW256     FROM      MORTST                                         02675000
*        LESS  THAN 256 BYTES OF SOURCE LEFT                            02676000
*********************************************************************** 02677000
LOW256   EQU   *                        SET THE LONG DATA               02678000
         NI    DACFLG(DACAD),X'EF'          FLAG OFF                    02679000
*           GO TO RDLAT;                                           0562 02680000
         B     RDLAT                                               0562 02681000
*           GEN;                                                   0563 02682000
         EJECT                                                          02683000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0564 02684000
*/*     PRECEDING CODE -                                       */  0564 02685000
*/*RDLAT:        D (NO,RNOCHAR,YES,) ANY UNIQUE CHARACTERS ?   */  0564 02686000
*/*              P SAVE THE BRANCH ARGUMENT, SAVE SOMADD       */  0564 02687000
*/*              P SOMADD TO REMAINING PORTION OF STREAM       */  0564 02688000
*/*              P LINGRO TO TESTED PORTION LESS ONE           */  0564 02689000
*/*              P BUMP SOM BY LINGRO                          */  0564 02690000
*/*              D (NO,OUTSINK,YES,%MOVIT) SINK HOLD LINGRO ?  */  0564 02691000
*/*%MOVIT:       D (NO,,YES,%SETBR) LINGRO = ZERO ?            */  0564 02692000
*/*              P MOVE TESTED PORTION LESS UNIQUE CHARACTER TO    0564 02693000
*/*                SINK                                        */  0564 02694000
*/*              P BUMP SINK BY LINGRO, SOURAD EQUAL UNIQUE        0564 02695000
*/*                CHARACTER'S ADDRESS                         */  0564 02696000
*/*%SETBR:       P SAVE SOM ADDRESS IN CARADD, RESTORE THE         0564 02697000
*/*                BRANCH ARGUMENT                             */  0564 02698000
*/*              D (NO,,YES,%BUFBR) IS THIS A READ BUFFER ?    */  0564 02699000
*/*              D (NL,RDNULL,NULL,RDNULL,FM,RDFLDMK,SMI,          0564 02700000
*/*                RDSMI,!,RDEOM,EOM,RDNULL,ETX,RDETX,SOM,         0564 02701000
*/*                RDSOM) WHAT IS CHARACTER ?                  */  0564 02702000
*/*%BUFBR:       D (NO,RDNULL,NULL,RDNULL,FM,RDBFM,SMI,            0564 02703000
*/*                RDBSMI,!,RDBEOM,EOM,RDNULL,ETX,RDETX,           0564 02704000
*/*                SOM,RDBSOM) WHAT IS CHARACTER ?             */  0564 02705000
*/*RNOCHAR:      P BUMP SOM ADDRESS BY LINGRO                  */  0564 02706000
*/*              D (NO,OUTSINK,YES,%DOMOV) SINK HOLD LINGRO ?  */  0564 02707000
*/*%DOMOV:       P MOVE THE TESTED GROUP TO THE SINK, BUMP THE     0564 02708000
*/*                SINK BY LINGRO                              */  0564 02709000
*/*MORTST:       D (NO,%GO011,YES,) IS LNGDT OFF ?             */  0564 02710000
*/*              D (YES,%GO010,NO,READOUT) READ BUFFER OPTYPE ?*/  0564 02711000
*/*%GO010:       P POINT SOURAD TO BEGINNING OF NEXT 2260 LINE */  0564 02712000
*/*              P (,READ1) INCREMENT CURLIN BY ONE            */  0564 02713000
*/*%GO011:       D (YES,,NO,LOW256) 256 BYTES LEFT ?           */  0564 02714000
*/*              P (,RDLAT) SET LINGRO TO 255                  */  0564 02715000
*/*LOW256:       P (,RDLAT) TURN OFF LNGDT IN DACFLG           */  0564 02716000
*        GEN;                                                      0564 02717000
         EJECT                                                          02718000
*/**************************************************************/  0565 02719000
*/**************************************************************/  0565 02720000
*/*                                                            */  0565 02721000
*/* KERF A COLLECTION OF SUBROUTINES TO DEAL WITH              */  0565 02722000
*/*     CHARACTERS REQUIRING SPECIAL ACTION. EACH              */  0565 02723000
*/*     SUBROUTINE IS AN INDIVIDUAL AND NOT NECESSARILY        */  0565 02724000
*/*     RELATED TO ANY OTHER. DATLNTST AND INCREM ARE          */  0565 02725000
*/*     FACILITIES USED BY SOME OF THE SUBROUTINES TO          */  0565 02726000
*/*     EFFECT RETURN TO MAIN DATA STREAM PROCESSING.          */  0565 02727000
*/*                                                            */  0565 02728000
*/*        RDSOM START FIELD DECTECTED IN DATA                 */  0565 02729000
*/*            INCREMENT SOURCE POINTER                        */  0565 02730000
*/*            FALL INTO RDSMI                                 */  0565 02731000
*/*                                                            */  0565 02732000
*/*        RDSMI OPERATOR ENTERED SOM 'X'4A') DETECTED         */  0565 02733000
*/*            POINT SINK TO BEGINNING                         */  0565 02734000
*/*            INCREMENT SOURCE                                */  0565 02735000
*/*            BRANCH TO DATLNTST                              */  0565 02736000
*/*                                                            */  0565 02737000
*/*        RDEOM END OF MESSAGE DETECTED                       */  0565 02738000
*/*            PUT 2260 EOM IN SINK                            */  0565 02739000
*/*            INCREMENT SINK AND SOURCE                       */  0565 02740000
*/*            BRANCH TO DATLNTST                              */  0565 02741000
*/*                                                            */  0565 02742000
*/*        RDFLDMK 3270 FIELD MARK DETECTED                    */  0565 02743000
*/*            PUT 2260 NEW LINE IN SINK                       */  0565 02744000
*/*            INCREMENT SINK AND SOURCE                       */  0565 02745000
*/*            SET LINGRO, SOURCE POINTER IF REQUIRED          */  0565 02746000
*/*            BRANCH TO DATLNTST                              */  0565 02747000
*/*                                                            */  0565 02748000
*/*        RDETX ETX DETECTED                                  */  0565 02749000
*/*            IF THIS IS REMOTE, BRANCH TO READOUT            */  0565 02750000
*/*                IN SOURTST                                  */  0565 02751000
*/*            IF THIS IS NOT REMOTE, RESET SOURCE             */  0565 02752000
*/*                AND SINK TO BEGINNING AND BRANCH            */  0565 02753000
*/*                TO BACKGO IN HOUSEKEEPING                   */  0565 02754000
*/*                                                            */  0565 02755000
*/*        RDBSOM START FIELD DETECTED                         */  0565 02756000
*/*            INCREMENT SOURCE                                */  0565 02757000
*/*            FALL INTO RDBSMI                                */  0565 02758000
*/*                                                            */  0565 02759000
*/*        RDBSMI OPERATOR ENTERED SOM 'X'4A') DETECTED        */  0565 02760000
*/*            PUT 2260 SOM IN SINK                            */  0565 02761000
*/*            BRANCH TO INCREM                                */  0565 02762000
*/*                                                            */  0565 02763000
*/*        RDBEOM END OF MESSAGE DETECTED                      */  0565 02764000
*/*            PUT 2260 EOM IN SINK                            */  0565 02765000
*/*            INCREMENT THE SOURCE                            */  0565 02766000
*/*            BRANCH TO INCREM                                */  0565 02767000
*/*                                                            */  0565 02768000
*/*        RDBFM FIELD MARK DETECTED                           */  0565 02769000
*/*            PUT NEW LINE IN SINK                            */  0565 02770000
*/*            BRANCH TO INCREM                                */  0565 02771000
*/*                                                            */  0565 02772000
*/*        RDNULL NULL OR INVALID CHARACTER DETECTED           */  0565 02773000
*/*            PUT A BLANK IN SINK                             */  0565 02774000
*/*            IF READ BUFFER OP, BRANCH TO INCREM             */  0565 02775000
*/*            IF NOT, BRANCH TO DATLNTST                      */  0565 02776000
*/*                                                            */  0565 02777000
*/*        DATLNTST NORMAL READ RETURN                         */  0565 02778000
*/*            IF REMAINING GROUP IS ZERO, BRANCH              */  0565 02779000
*/*                TO MORTST                                   */  0565 02780000
*/*            OTHERWISE BRANCH TO RDLAT                       */  0565 02781000
*/*                                                            */  0565 02782000
*/*        INCREM READ BUFFER RETURN                           */  0565 02783000
*/*            INCREMENT SINK AND SOURCE                       */  0565 02784000
*/*            IF REMAINING GROUP IS ZERO, POINT SOURCE        */  0565 02785000
*/*                TO NEXT LINE, INCREMENT LINE,               */  0565 02786000
*/*                BRANCH TO READ1 IN READ                     */  0565 02787000
*/*            OTHERWISE BRANCH TO RDLAT                       */  0565 02788000
*/*                                                            */  0565 02789000
*/*                                                            */  0565 02790000
*/**************************************************************/  0565 02791000
*/**************************************************************/  0565 02792000
*/**************************************************************/  0565 02793000
*/*                                                            */  0565 02794000
*/* RDSOM      FROM      RDTAB                                 */  0565 02795000
*/*      PROCESS START FIELD ORDER                             */  0565 02796000
*/**************************************************************/  0565 02797000
*RDSOM:;                                                           0565 02798000
RDSOM    DS    0H                                                  0566 02799000
*           SOURAD = SOURAD + 1;                                   0566 02800000
         AH    SOURAD,@CH00061                                     0566 02801000
*/**************************************************************/  0567 02802000
*/*                                                            */  0567 02803000
*/* RDSMI      FROM      RDTAB                                 */  0567 02804000
*/*      PROCESS OPERATOR ENTERED START OF MESSAGE             */  0567 02805000
*/**************************************************************/  0567 02806000
*RDSMI:;                                                           0567 02807000
RDSMI    DS    0H                                                  0568 02808000
*           IF RMTDV = '1'B                                        0568 02809000
*                THEN SINKAD = DACSINAD + 2;                       0568 02810000
         TM    RMTDV(DACAD),B'00000001'                            0568 02811000
         BNO   @RF00568                                            0568 02812000
         LA    SINKAD,2                                            0569 02813000
         AL    SINKAD,DACSINAD(,DACAD)                             0569 02814000
*                ELSE SINKAD = DACSINAD;                           0570 02815000
         B     @RC00568                                            0570 02816000
@RF00568 L     SINKAD,DACSINAD(,DACAD)                             0570 02817000
*           SOURAD = SOURAD + 1;                                   0571 02818000
@RC00568 LA    @12,1                                               0571 02819000
         ALR   SOURAD,@12                                          0571 02820000
*           CARADD = CARADD + 1;                                   0572 02821000
         ALR   CARADD,@12                                          0572 02822000
*/**************************************************************/  0573 02823000
*/*                                                            */  0573 02824000
*/* DATLNTST   FROM      RDSMI, RDEOM, RDFLDMK, LINBOUND,      */  0573 02825000
*/*                      RDNULL                                */  0573 02826000
*/*      EXIT TO NORMAL DATA STREAM PROCESSING FOR READ MI     */  0573 02827000
*/* AND SHORT READ MI                                          */  0573 02828000
*/**************************************************************/  0573 02829000
*DATLNTST:;                                                        0573 02830000
DATLNTST DS    0H                                                  0574 02831000
*           LINGRO = SOMADD;                                       0574 02832000
         LR    LINGRO,SOMADD                                       0574 02833000
*           SOMADD = CARADD;          /*RESTORE SOM ADDRES     */  0575 02834000
         LR    SOMADD,CARADD                                       0575 02835000
*           IF LINGRO <= FULL0                                     0576 02836000
*                THEN GO TO MORTST;                                0576 02837000
         C     LINGRO,FULL0                                        0576 02838000
         BNH   @RT00576                                            0576 02839000
*                ELSE GO TO RDLAT;                                 0578 02840000
         B     RDLAT                                               0578 02841000
*/**************************************************************/  0579 02842000
*/*                                                            */  0579 02843000
*/* RDEOM      FROM      RDTAB                                 */  0579 02844000
*/*      PROCESS END OF MESSAGE CHARACTER                      */  0579 02845000
*/**************************************************************/  0579 02846000
*RDEOM:;                                                           0579 02847000
RDEOM    DS    0H                                                  0580 02848000
*                     SINK(1) = '6A'X; /*PUT EOM IN SINK       */  0580 02849000
         MVI   SINK(SINKAD),X'6A'                                  0580 02850000
*                     SINKAD = SINKAD + ONE;                       0581 02851000
         L     @12,ONE                                             0581 02852000
         ALR   SINKAD,@12                                          0581 02853000
*                     SOURAD = SOURAD + ONE;                       0582 02854000
         ALR   SOURAD,@12                                          0582 02855000
*                     GO TO DATLNTST;                              0583 02856000
         B     DATLNTST                                            0583 02857000
*/**************************************************************/  0584 02858000
*/*                                                            */  0584 02859000
*/* RDFLDMK    FROM      RDTAB                                 */  0584 02860000
*/*      PROCESS FIELD MARK CHARACTER (NL)                     */  0584 02861000
*/**************************************************************/  0584 02862000
*RDFLDMK:;                                                         0584 02863000
RDFLDMK  DS    0H                                                  0585 02864000
*           SINK(1) = '15'X;           /*PUT NEW LINE IN SINK  */  0585 02865000
         MVI   SINK(SINKAD),X'15'                                  0585 02866000
*           SINKAD = SINKAD + ONE;                                 0586 02867000
         L     @12,ONE                                             0586 02868000
         ALR   SINKAD,@12                                          0586 02869000
*           SOURAD = SOURAD + ONE;                                 0587 02870000
         ALR   SOURAD,@12                                          0587 02871000
*           IF RVOID = '1'B                                        0588 02872000
*                THEN DO;                                          0588 02873000
         TM    RVOID(DACAD),B'10000000'                            0588 02874000
         BNO   @RF00588                                            0588 02875000
*                GEN SETS(REG0,WORKREG4,WORKREG3,CURLIN,SOMADD)    0590 02876000
*                    REFS(DSLINE,DACAD,ANWIDE,DACCRS)              0590 02877000
*                    FLOWS(RVOIDOUT,DATLNTST) NOSEQFLOW ; /*Y02947*/    02878000
         SR    REG0,REG0          CLEAR WORK REGISTER           YA01252 02879000
         IC    REG0,DSLINE(DACAD)   PICK UP MAX LINE            YA01252 02880000
         BCTR  REG0,0             REDUCE MINUS ONE              YA01252 02881000
         CR    REG0,CURLIN        MAX LINE TO CURRENT LINE      YA01252 02882000
         BNH   RVOIDOUT            JUST PROCESSED LINE MAX      YA01252 02883000
         SR    WORKREG4,WORKREG4  CLEAR REG                     YA01252 02884000
         IC    REG0,ANWIDE(DACAD)  PICK UP 3270 WIDTH          @ZA14059 02885000
         LH    WORKREG3,DACCRS(DACAD) PICK UP CURSOR POSITION  @ZA14059 02886000
         DR    WORKREG4,REG0       GET CURSOR'S LINE LESS ONE  @ZA14059 02887000
*                                  REMAINDER IS IN 14 FOR      @ZA14059 02888000
*                                  LATER USE                   @ZA14059 02889000
         LTR   WORKREG3,WORKREG3   FIRST LINE?                 @ZA14059 02890000
         BNZ   NOTFIRST            BRANCH IF NOT FIRST LINE    @ZA14059 02891000
         LTR   CURLIN,CURLIN       END OF DATA MOVED ON        @ZA14059 02892000
*                                  FIRST LINE?                 @ZA14059 02893000
         BZ    RVOIDOUT            YES,DONE IN THIS ROUTINE    @ZA14059 02894000
NOTFIRST EQU   *                                               @ZA14059 02895000
         CR    WORKREG3,CURLIN     CURSOR'S LINE TO CURRENT?   @ZA14059 02896000
         BNE   RDMKC               BR IF NO                    @YA03965 02897000
         BCTR  SINKAD,0            REDUCE SINK BY ONE          @YA03965 02898000
         B     RVOIDOUT            FINISHED PROCESSING         @YA03965 02899000
RDMKC    EQU   *                                               @YA03965 02900000
         LR    WORKREG3,LINGRO     GET LENGTH OF DATA JUST     @ZA14059 02901000
*                                  MOVED                       @ZA14059 02902000
         SR    WORKREG4,WORKREG4   CLEAR REG                   @ZA14059 02903000
         DR    WORKREG4,REG0       DETERMINE NUMBER OF FULL    @ZA14059 02904000
*                                  LINES OF DATA MOVED         @ZA14059 02905000
         AR    CURLIN,WORKREG3     ADJUST CURLIN BY AMOUNT OF  @ZA14059 02906000
*                                  DATA JUST MOVED             @ZA14059 02907000
         LA    CURLIN,1(CURLIN)   BUMP CURRENT LINE POINTER     YA01252 02908000
         LH    WORKREG3,DACCRS(DACAD) PICK UP CURSOR POSITION  @ZA14059 02909000
         SR    WORKREG4,WORKREG4  AND DEVELOP THE REMAINDER    @ZA14059 02910000
         DR    WORKREG4,0         OF DATA ON THE CURSORS LINE  @ZA14059 02911000
         CR    WORKREG3,CURLIN    NEXT LINE CURSORS LINE ?      YA01252 02912000
         BNE   DATLNTST            NO, GO DO ANOTHER            YA01252 02913000
         LR    SOMADD,WORKREG4    YES, SET TO DO REMAINDER      YA01252 02914000
         LTR   SOMADD,SOMADD       ANY ON CURSOR'S LINE TO DO?  YA01252 02915000
         BZ    RVOIDOUT            NO, DONE                     YA01252 02916000
         B     DATLNTST            YES, GO DO LAST LINE         YA01252 02917000
*              END;                                                0591 02918000
*                ELSE                                              0592 02919000
*                  DO;                                             0592 02920000
@RF00588 DS    0H                                                  0593 02921000
*           GEN SETS(WORKREG4,WORKREG3,SOURAD,CARADD,SOMADD,REG0)  0593 02922000
*               REFS(DACSRCAD,DACAD,DACIND,DSWIDE)                 0593 02923000
*               FLOWS(DATLNTST) NOSEQFLOW ;        /*Y02947*/      0593 02924000
         LCR   WORKREG4,SOURAD   SUBTRACT SOURCE POINTER FROM   CODE2   02925000
         A     WORKREG4,DACSRCAD(DACAD)  SOURCE BASE PLUS DACINDCODE2   02926000
         SR    WORKREG3,WORKREG3   CLEAR A WORK REGISTER        CODE2   02927000
         IC    WORKREG3,DACIND(DACAD)   PICK UP DACIND          CODE2   02928000
         AR    WORKREG4,WORKREG3    INTRODUCE DACIND            CODE2   02929000
         LTR   WORKREG4,WORKREG4    CHECK RELATION TO LINE BDRY CODE2   02930000
         BZ    DATLNTST            WE HAVE COINCIDENCE          CODE2   02931000
         BM    LINBOUND            WE ARE PAST FIRST BOUNDRY    CODE2   02932000
*********************************************************************** 02933000
*                                                                       02934000
*   RAPON      FROM      RDFLDMK                                        02935000
*        PROCESS NEW LINE NOT IN FIRST 2260 LINE                        02936000
*********************************************************************** 02937000
RAPON    EQU   *                                                        02938000
         AR    SOURAD,WORKREG4      BUMP SOURCE TO NEXT LINE    CODE2   02939000
         AR    CARADD,WORKREG4      BUMP SOM BUFFER UNITS       CODE2   02940000
         SR    SOMADD,WORKREG4      REDUCE RESIDUAL COUNT       CODE2   02941000
         B     DATLNTST            GO SET UP FOR NEXT PASS      CODE2   02942000
*********************************************************************** 02943000
*                                                                       02944000
*   LINBOUND   FROM      RAPON                                          02945000
*        ADJUST LINE GROUPING                                           02946000
*********************************************************************** 02947000
LINBOUND EQU   *                                                        02948000
         LR    WORKREG4,SOURAD      COMPUTE OFFSET TO NEXT LINE CODE2   02949000
         S     WORKREG4,DACSRCAD(DACAD)   REDUCE BY BEGINNING   CODE2   02950000
         SR    WORKREG4,WORKREG3    REDUCE BY DACIND            CODE2   02951000
         LR    WORKREG3,WORKREG4    PUT IN ODD OF EVEN/ODD PAIR CODE2   02952000
         SR    WORKREG4,WORKREG4    CLEAR EVEN                  CODE2   02953000
         SR    REG0,REG0            CLEAR WORK FOR DIVISOR      CODE2   02954000
         IC    REG0,DSWIDE(DACAD)   PICK UP 2260 WIDTH          CODE2   02955000
         DR    WORKREG4,REG0        COUNT INTO THIS LINE        CODE2   02956000
         LTR   WORKREG4,WORKREG4    ARE WE ON A LINE BOUNDRY    CODE2   02957000
         BZ    DATLNTST            YES, POINTERS NOW OK         CODE2   02958000
         SR    REG0,WORKREG4        REMAINDER OF LINE           CODE2   02959000
         LR    WORKREG4,REG0        PUT REMAINDER IN WORK       CODE2   02960000
         B     RAPON               GO UPDATE POINTERS           CODE2   02961000
*                  END;                                            0594 02962000
*/**************************************************************/  0595 02963000
*/*                                                            */  0595 02964000
*/* RDETX      FROM      RDTAB                                 */  0595 02965000
*/*      PROCESS ETX CHARATER                                  */  0595 02966000
*/**************************************************************/  0595 02967000
*RDETX:;                                                           0595 02968000
RDETX    DS    0H                                                  0596 02969000
*           IF RMTDV = '1'B                                        0596 02970000
*                THEN GO TO READOUT;                               0596 02971000
         TM    RMTDV(DACAD),B'00000001'                            0596 02972000
         BO    @RT00596                                            0596 02973000
*                ELSE                                              0598 02974000
*                  DO;                                             0598 02975000
*                     SOURAD = DACSRCAD;                           0599 02976000
         L     SOURAD,DACSRCAD(,DACAD)                             0599 02977000
*                     SINKAD = DACSINAD;                           0600 02978000
         L     SINKAD,DACSINAD(,DACAD)                             0600 02979000
*                     GO TO BACKGO;                                0601 02980000
         B     BACKGO                                              0601 02981000
*                  END;                                            0602 02982000
*RDBSOM:;                                                          0603 02983000
RDBSOM   DS    0H                                                  0604 02984000
*/**************************************************************/  0604 02985000
*/*                                                            */  0604 02986000
*/* RDBSOM     FROM      RDTAB                                 */  0604 02987000
*/*      PROCESS START FIELD ORDER (READ BUFFER ONLY)          */  0604 02988000
*/**************************************************************/  0604 02989000
*           SOURAD = SOURAD + 1;                                   0604 02990000
         AH    SOURAD,@CH00061                                     0604 02991000
*/**************************************************************/  0605 02992000
*/*                                                            */  0605 02993000
*/* RDBSMI     FROM      RDTAB                                 */  0605 02994000
*/*      PROCESS OPERATOR ENTERED SOM () (READ BUFFER ONLY)   */  0605 02995000
*/**************************************************************/  0605 02996000
*RDBSMI:;                                                          0605 02997000
RDBSMI   DS    0H                                                  0606 02998000
*           SINK(1) = '4A'X;           /*PUT SOM IN SINK       */  0606 02999000
         MVI   SINK(SINKAD),X'4A'                                  0606 03000000
*           GO TO INCREM;                                          0607 03001000
         B     INCREM                                              0607 03002000
*/**************************************************************/  0608 03003000
*/*                                                            */  0608 03004000
*/* RDBEOM     FROM      RDTAB                                 */  0608 03005000
*/*      PROCESS END OF MESSAGE (READ BUFFER ONLY)             */  0608 03006000
*/**************************************************************/  0608 03007000
*RDBEOM:;                                                          0608 03008000
RDBEOM   DS    0H                                                  0609 03009000
*           SINK(1) = '6A'X;           /*PUT EOM IN SINK       */  0609 03010000
         MVI   SINK(SINKAD),X'6A'                                  0609 03011000
*           SOURAD = SOURAD + 1;                                   0610 03012000
         AH    SOURAD,@CH00061                                     0610 03013000
*           GO TO INCREM;                                          0611 03014000
         B     INCREM                                              0611 03015000
*/**************************************************************/  0612 03016000
*/*                                                            */  0612 03017000
*/* RDBFM      FROM      RDTAB                                 */  0612 03018000
*/*      PROCESS FIELD MARK (READ BUFFER ONLY)                 */  0612 03019000
*/**************************************************************/  0612 03020000
*RDBFM:;                                                           0612 03021000
RDBFM    DS    0H                                                  0613 03022000
*           SINK(1) = '15'X;           /*PUT NEW LINE IN SINK  */  0613 03023000
         MVI   SINK(SINKAD),X'15'                                  0613 03024000
*           GO TO INCREM;                                          0614 03025000
         B     INCREM                                              0614 03026000
*/**************************************************************/  0615 03027000
*/*                                                            */  0615 03028000
*/* RDNULL     FROM      RDTAB                                 */  0615 03029000
*/*      PROCESS NULL OR INVALID CHARACTERS                    */  0615 03030000
*/**************************************************************/  0615 03031000
*RDNULL:;                                                          0615 03032000
RDNULL   DS    0H                                                  0616 03033000
*           SINK(1) = '40'X;           /*PUT BLANK IN SINK     */  0616 03034000
         MVI   SINK(SINKAD),X'40'                                  0616 03035000
*           IF RDBUF = '1'B                                        0617 03036000
*                THEN GO TO INCREM;                                0617 03037000
         TM    RDBUF(DACAD),B'00000001'                            0617 03038000
         BO    @RT00617                                            0617 03039000
*                ELSE GO TO DATLNTST;                              0619 03040000
         B     DATLNTST                                            0619 03041000
*/**************************************************************/  0620 03042000
*/*                                                            */  0620 03043000
*/* INCREM     FROM      RDBSMI, RDBEOM, RDBFM, RDNULL         */  0620 03044000
*/*      EXIT TO NORMAL DATA STREAM PROCESSING                 */  0620 03045000
*/**************************************************************/  0620 03046000
*INCREM:;                                                          0620 03047000
INCREM   DS    0H                                                  0621 03048000
*           SINKAD = SINKAD + ONE;                                 0621 03049000
         L     @12,ONE                                             0621 03050000
         ALR   SINKAD,@12                                          0621 03051000
*           SOURAD = SOURAD + ONE;                                 0622 03052000
         ALR   SOURAD,@12                                          0622 03053000
*           LINGRO = SOMADD;                                       0623 03054000
         LR    LINGRO,SOMADD                                       0623 03055000
*           SOMADD = CARADD;          /*RESTORE SOM ADDRES     */  0624 03056000
         LR    SOMADD,CARADD                                       0624 03057000
*           IF LINGRO = FULL0                                      0625 03058000
*                THEN                                              0625 03059000
         C     LINGRO,FULL0                                        0625 03060000
         BNE   @RF00625                                            0625 03061000
*                  DO;                                             0626 03062000
*                     SOURAD = SOURAD + ANWIDE - DSWIDE;           0627 03063000
         LR    @12,SOURAD                                          0627 03064000
         SLR   @10,@10                                             0627 03065000
         IC    @10,ANWIDE(,DACAD)                                  0627 03066000
         ALR   @12,@10                                             0627 03067000
         SLR   @10,@10                                             0627 03068000
         IC    @10,DSWIDE(,DACAD)                                  0627 03069000
         SLR   @12,@10                                             0627 03070000
         LR    SOURAD,@12                                          0627 03071000
*                     CURLIN = CURLIN + 1;                         0628 03072000
         AH    CURLIN,@CH00061                                     0628 03073000
*                     GO TO READ1;    /*GO SEE WHATS LEFT      */  0629 03074000
         B     READ1                                               0629 03075000
*                  END;                                            0630 03076000
*                ELSE;                                             0631 03077000
@RF00625 DS    0H                                                  0632 03078000
*           GO TO RDLAT;                                           0632 03079000
         B     RDLAT                                               0632 03080000
*           GEN;                                                   0633 03081000
         EJECT                                                          03082000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0634 03083000
*/*     PRECEDING CODE -                                       */  0634 03084000
*/*RDSOM:        P INCREMENT SOURAD BY ONE                     */  0634 03085000
*/*RDSMI:        D (NO,%GO012,YES,) IS RMTDV ON ?              */  0634 03086000
*/*              P (,%GO013) SET SINKAD TO DACSINAD PLUS TWO   */  0634 03087000
*/*%GO012:       P SET SINK TO DACSINAD                        */  0634 03088000
*/*%GO013:       P BUMP SOURCE                                 */  0634 03089000
*/*DATLNTST:     P LINGRO = REMAINING DATA, RESTORE SOMADD     */  0634 03090000
*/*              D (NO,RDLAT,YES,MORTST) LINGRO = ZERO ?       */  0634 03091000
*/*RDEOM:        P (,DATLNTST) PUT EOM IN SINK, BUMP SINK          0634 03092000
*/*                AND SOURCE                                  */  0634 03093000
*/*RDFLDMK:      P PUT NL IN SINK, BUMP SINK AND SOURCE        */  0634 03094000
*/*              D (YES,DATLNTST,NO,) DATA REMAINING = ZERO ?  */  0634 03095000
*/*              D (YES,DATLNTST,NO,) RVOID = YES SPECIFIED ?  */  0634 03096000
*/*              P INCREMENT CURLIN                            */  0634 03097000
*/*              D (NO,RAPON,YES,) ARE IN FIRST 2260 LINE ?    */  0634 03098000
*/*              P CALCULATE COUNT TO BE SKIPPED               */  0634 03099000
*/*              P DECREMENT REMAINING COUNT BY COUNT TO BE        0634 03100000
*/*                SKIPPED                                     */  0634 03101000
*/*              P LINGRO = REMAINDER                          */  0634 03102000
*/*              P (,DATLNTST) SET SOURAD TO POINT TO FIRST        0634 03103000
*/*                CHARACTER OF NEXT LINE                      */  0634 03104000
*/*RAPON:        P CALCULATE DIFFERENCE FROM FIRST LINE BOUNDRY    0634 03105000
*/*                TO FM                                       */  0634 03106000
*/*              P DIVIDE IT BY THE 2260 WIDTH, SPECAR =           0634 03107000
*/*                QUOTIENT                                    */  0634 03108000
*/*              P LINGRO = THE REMAINDER                      */  0634 03109000
*/*LINBOUND:     P POINT SOURAD TO BEGINNING OF NEXT LINE      */  0634 03110000
*/*              P (,DATLNTST) SET CURLIN TO ONE PAST SPECAR,      0634 03111000
*/*                SOMADD TO REMAINING DATA PORTION            */  0634 03112000
*/*RDETX:        D (YES,READOUT,NO,%GO015) IS RMTDV ON ?       */  0634 03113000
*/*%GO015:       P (,BACKGO) RESET SOURCE, SINK TO BEGINNING   */  0634 03114000
*/*RDBSOM:       P BUMP SOURCE                                 */  0634 03115000
*/*RDBSMI:       P (,INCREM) PUT SOM IN SINK                   */  0634 03116000
*/*RDBEOM:       P (,INCREM) PUT EOM IN SINK, BUMP SOURCE      */  0634 03117000
*/*RDBFM:        P (,INCREM) PUT NL IN SINK                    */  0634 03118000
*/*RDNULL:       P PUT A BLANK IN SINK                         */  0634 03119000
*/*              D (YES,INCREM,NO,DATLNTST) READ BUFFER ?      */  0634 03120000
*/*INCREM:       P BUMP SINK, SOURCE, LINGRO = SOMADD, RESTORE     0634 03121000
*/*                SOMADD                                      */  0634 03122000
*/*              D (YES,,NO,RDLAT) IS LINGRO = ZERO ?          */  0634 03123000
*/*              P (,READ1) SOURAD TO BEGINNING OF NEXT LINE,      0634 03124000
*/*                BUMP CURLIN                                 */  0634 03125000
*        GEN;                                                      0634 03126000
         EJECT                                                          03127000
*/**************************************************************/  0635 03128000
*/**************************************************************/  0635 03129000
*/*                                                            */  0635 03130000
*/* INVERT ROUTINE TO CONVERT INCOMING ADDRESSES TO HEX        */  0635 03131000
*/*     INVERT IS USED BY VIRTUALLY ALL PHASES OF THE READ     */  0635 03132000
*/*     DATA STREAM PROCESSING TO CONVERT 3270 ADDRESSES TO    */  0635 03133000
*/*     HEXADECIMAL. NORMAL ENTRY IS VIA A BRANCH AND LINK     */  0635 03134000
*/*     ON REGISTER CARADD. RETURN IS VIA A BRANCH REGISTER    */  0635 03135000
*/*     CARADD.                                                */  0635 03136000
*/*                                                            */  0635 03137000
*/**************************************************************/  0635 03138000
*/**************************************************************/  0635 03139000
*INVERT:  GEN SETS(SPECAR,CURSAD) REFS(MASK,SINKAD,CARADD) ; /*Y02947*/ 03140000
INVERT   DS    0H                                                  0635 03141000
         SLDL  SPECAR,24                                                03142000
         SRL   CURSAD,24                                                03143000
         N     SPECAR,MASK                                              03144000
         N     CURSAD,MASK                                              03145000
         SLL   SPECAR,6                                                 03146000
         AR    SPECAR,CURSAD                                            03147000
         STC   SPECAR,1(SINKAD)                                         03148000
         SRL   SPECAR,8                                                 03149000
         STC   SPECAR,0(SINKAD)                                         03150000
         IC    CURSAD,0(SINKAD)                                         03151000
         SLL   CURSAD,8                                                 03152000
         IC    CURSAD,1(SINKAD)                                         03153000
         BR    CARADD                                                   03154000
*           GEN;                                                   0636 03155000
         EJECT                                                          03156000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0637 03157000
*/*     PRECEDING CODE -                                       */  0637 03158000
*/*INVERT: CHART                                               */  0637 03159000
*/* HEADER                                                         0637 03160000
*/*        SCAN - CONVERSION OF INCOMING 3270 BUFFER ADDRESSES TO HEX   03161000
*/*                                            PAGE #          */  0637 03162000
*/*INVERT:       E READ ADDRESS CONVERSION                     */  0637 03163000
*/*              P CONVERT 3270 TO HEX                         */  0637 03164000
*/*              R BR CARADD                                   */  0637 03165000
*/*INVERT: END                                                 */  0637 03166000
*           GEN;                                                   0637 03167000
         EJECT                                                          03168000
*/**************************************************************/  0638 03169000
*/**************************************************************/  0638 03170000
*/*                                                            */  0638 03171000
*/* OUTVERT ROUTINE TO CONVERT OUTGOING ADDRESSES TO 3270      */  0638 03172000
*/*     OUTVERT IS USED BY VIRTUALLY ALL PHASES OF THE WRITE   */  0638 03173000
*/*     DATA STREAM PROCESSING TO CONVERT HEXADECIMAL          */  0638 03174000
*/*     ADDRESSES TO 3270. NORMAL ENTRY IS VIA A BRANCH AND    */  0638 03175000
*/*     LINK ON REGISTER CARADD. RETURN IS VIA A BRANCH        */  0638 03176000
*/*     REGISTER CARADD.                                       */  0638 03177000
*/*                                                            */  0638 03178000
*/**************************************************************/  0638 03179000
*/**************************************************************/  0638 03180000
*OUTVERT:   GEN SETS(SINK,CURSAD,SINKAD) REFS(CARADD) ;   /*Y02947*/    03181000
OUTVERT  DS    0H                                                  0638 03182000
         STC   CURSAD,2(SINKAD)                                         03183000
         SRL   CURSAD,8                                                 03184000
         STC   CURSAD,3(SINKAD)                                         03185000
         SLL   CURSAD,8                                                 03186000
         IC    CURSAD,2(SINKAD)                                         03187000
         STC   CURSAD,1(SINKAD)                                         03188000
         NI    1(SINKAD),X'3F'                                          03189000
         SRL   CURSAD,6                                                 03190000
         STC   CURSAD,0(SINKAD)                                         03191000
         NI    0(SINKAD),X'1F'                                          03192000
         TR    0(2,SINKAD),ADDRTAB                                      03193000
         IC    CURSAD,3(SINKAD)                                         03194000
         SLL   CURSAD,8                                                 03195000
         IC    CURSAD,2(SINKAD)                                         03196000
         LA    SINKAD,2(SINKAD)                                         03197000
         BR    CARADD                                                   03198000
*           GEN;                                                   0639 03199000
         EJECT                                                          03200000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0640 03201000
*/*     PRECEDING CODE -                                       */  0640 03202000
*/*OUTVERT: CHART                                              */  0640 03203000
*/* HEADER                                                         0640 03204000
*/*        SCAN - CONVERSION OF OUTGOING ADDRESSES TO 3270 BUFFER  0640 03205000
*/*                                            PAGE #          */  0640 03206000
*/*OUTVERT:      E WRITE ADDRESS CONVERSION                    */  0640 03207000
*/*              P CONVERT HEX TO 3270, USING ADDRTAB          */  0640 03208000
*/*              P BUMP SINK POINTER BY TWO                    */  0640 03209000
*/*              R BR CARADD                                   */  0640 03210000
*/*OUTVERT: END                                                */  0640 03211000
*        GEN;                                                      0640 03212000
         EJECT                                                          03213000
*/**************************************************************/  0641 03214000
*/**************************************************************/  0641 03215000
*/* XLATE TRANSLATE AND TEST INSTRUCTION, MOVE CHARACTERS      */  0641 03216000
*/*     INSTRUCTION                                            */  0641 03217000
*/*     THESE INSTRUCTIONS ARE UTILIZED VIA EXECUTE            */  0641 03218000
*/*     INSTRUCTIONS AT VARIOUS POINTS THROUGH SCAN. THE       */  0641 03219000
*/*     TRT TRANSLATES SOME PORTION OF THE SOURCE AGAINST      */  0641 03220000
*/*     'TABLE'. THE MVC MOVES SOME PORTION OF THE SOURCE      */  0641 03221000
*/*     INTO THE SINK.                                         */  0641 03222000
*/*                                                            */  0641 03223000
*/**************************************************************/  0641 03224000
*/**************************************************************/  0641 03225000
*XLATE:     GEN;                                                   0641 03226000
XLATE    DS    0H                                                  0641 03227000
         TRT   0(1,SOURAD),TABLE                                        03228000
*MYMOV:;                                                           0642 03229000
MYMOV    DS    0H                                                  0643 03230000
*           GEN;                                                   0643 03231000
         MVC   0(1,SINKAD),0(SOURAD)                                    03232000
*           GEN;                                                   0644 03233000
         EJECT                                                          03234000
*/**************************************************************/  0645 03235000
*/**************************************************************/  0645 03236000
*/*                                                            */  0645 03237000
*/* OUTPROC THE VARIOUS EXITS FROM SCAN                        */  0645 03238000
*/*     OUTPROC IS ACTUALY A COLLECTION OF CONDITION RETURN    */  0645 03239000
*/*     PROCESSORS. EACH MAY PERFORM SOME SPECIAL FUNCTION,    */  0645 03240000
*/*     THEN WILL LOAD REGISTER 15 WITH X'10' (16) AND BRANCH  */  0645 03241000
*/*     TO THE POINT IN GOBACK WHICH WILL LEAVE THE REQUIRED   */  0645 03242000
*/*     RETURN CODE IN REGISTER 15. EACH SUCCESSIVE STEP       */  0645 03243000
*/*     THROUGH GOBACK DECREMENTS REGISTER 15 BY FOUR. HENCE,  */  0645 03244000
*/*     FOR RETURN CODE OF 0, A BRANCH TO GOBACK00 IS          */  0645 03245000
*/*     REQUIRED, OF 4, A BRANCH TO GOBACK04, ETC. THE         */  0645 03246000
*/*     CURSOR IS SAVED IN DACCRS ONLY FOR GOBACK00. THE       */  0645 03247000
*/*     LENGTH OF SINK IS CALCULATED IN GOBACK08, SO GOBACK00  */  0645 03248000
*/*     AND GOBACK04 ALSO RESULT IN SINK LENGTH BEING PASSED   */  0645 03249000
*/*     IN REGISTER 0. THE DACFLG IS CLEARED EXCEPT FOR        */  0645 03250000
*/*     BITS 0 AND 1 FOR ALL EXITS. DACIND IS CLEARED FOR      */  0645 03251000
*/*     ALL EXITS.                                             */  0645 03252000
*/*                                                            */  0645 03253000
*/*       OUTNORM CHECKS FOR THE NO SMI BIT IN DACFLG AND IF   */  0645 03254000
*/*     ON BRANCHES TO OUTNSMI. IF THIS IS A WRITE AND THE     */  0645 03255000
*/*     SOM HERE BIT IN DACFLG IS ON, OUTNORM SAVES THE SOM    */  0645 03256000
*/*     ADDRESS IN DACSOMAD. IF SOM HERE IS OFF OUTNORM        */  0645 03257000
*/*     CHECKS THE SHORT READ FLAG. IF THE SHORT READ FLAG     */  0645 03258000
*/*     IF OFF, A HALFWORD OF ONES IS STORED IN DACSOMAD.      */  0645 03259000
*/*     OTHERWISE DACSOMAD IS NOT ALTERED. LOADS REG 15 WITH   */  0645 03260000
*/*     16 AND BRANCHES TO GOBACK00.                           */  0645 03261000
*/*                                                            */  0645 03262000
*/*       OUTSPEC LOADS REG 15 WITH 16 AND BRANCHES TO         */  0645 03263000
*/*     GOBACK04.                                              */  0645 03264000
*/*                                                            */  0645 03265000
*/*       OUTSINK LOADS REG 15 WITH 16 AND BRANCHES TO         */  0645 03266000
*/*     GOBACK08.                                              */  0645 03267000
*/*                                                            */  0645 03268000
*/*       OUTNSMI LOADS REG 15 WITH 16 AND BRANCHES TO         */  0645 03269000
*/*     GOBACK0C.                                              */  0645 03270000
*/*                                                            */  0645 03271000
*/*       OUTERR LOADS REG 15 WITH 16 AND BRANCHES TO          */  0645 03272000
*/*     GOBACK10.                                              */  0645 03273000
*/*                                                            */  0645 03274000
*/**************************************************************/  0645 03275000
*/**************************************************************/  0645 03276000
*/**************************************************************/  0645 03277000
*/*                                                            */  0645 03278000
*/* OUTNORM    FROM      SETPROT, OUTTST                       */  0645 03279000
*/*      NORMAL EXIT FROM SCAN                                 */  0645 03280000
*/**************************************************************/  0645 03281000
*OUTNORM:;                                                         0645 03282000
OUTNORM  DS    0H                                                  0646 03283000
*           IF NOSMI = '1'B                                        0646 03284000
*                THEN GO TO OUTNSMI;                               0646 03285000
         TM    NOSMI(DACAD),B'00000100'                            0646 03286000
         BO    @RT00646                                            0646 03287000
*                ELSE;                                             0648 03288000
*           IF WRCRS = '1'B           /*IF THIS IS A WRITE     */  0649 03289000
*           | WRLA = '1'B             /*OPERATION - CHECK      */  0649 03290000
*           | EWR = '1'B              /*TO SEE IF AN SOM       */  0649 03291000
*                THEN                                              0649 03292000
         TM    WRCRS(DACAD),B'00111000'                            0649 03293000
         BZ    @RF00649                                            0649 03294000
*                  DO;                                             0650 03295000
*                     IF SOMHER = '1'B                             0651 03296000
*                          THEN                                    0651 03297000
         TM    SOMHER(DACAD),B'00001000'                           0651 03298000
         BNO   @RF00651                                            0651 03299000
*                            DO;                                   0652 03300000
*                               GEN SETS(DACSOMAD) REFS(SOMADD,DACAD)   03301000
*                                ; /*Y02947*/                      0653 03302000
         STH   SOMADD,DACSOMAD(DACAD)                                   03303000
*                            END;                                  0654 03304000
*                          ELSE                                    0655 03305000
*                            DO;                                   0655 03306000
         B     @RC00651                                            0655 03307000
@RF00651 DS    0H                                                  0656 03308000
*                               IF SHRD = '1'B                     0656 03309000
*                                   THEN;                          0656 03310000
         TM    SHRD(DACAD),B'01000000'                             0656 03311000
         BO    @RT00656                                            0656 03312000
*                                   ELSE DACSOMAD = ALLONE;        0658 03313000
         MVC   DACSOMAD(2,DACAD),ALLONE                            0658 03314000
*                            END;                                  0659 03315000
*                  END;                                            0660 03316000
*                ELSE;                                             0661 03317000
@RF00649 DS    0H                                                  0662 03318000
*           GEN;                                                   0662 03319000
@RC00649 DS    0H                                                  0662 03320000
         LA    WORKREG3,RETCONST                                        03321000
*           GO TO GOBACK00;                                        0663 03322000
         B     GOBACK00                                            0663 03323000
*/**************************************************************/  0664 03324000
*/*                                                            */  0664 03325000
*/* OUTSPEC    FROM      READ                                  */  0664 03326000
*/*      EXIT FOR PA1,2,3 AND CLEAR AID RECIEVED               */  0664 03327000
*/**************************************************************/  0664 03328000
*OUTSPEC:   GEN;                                                   0664 03329000
OUTSPEC  DS    0H                                                  0664 03330000
         LA    WORKREG3,RETCONST                                        03331000
*           GO TO GOBACK04;                                        0665 03332000
         B     GOBACK04                                            0665 03333000
*/**************************************************************/  0666 03334000
*/*                                                            */  0666 03335000
*/* OUTSINK    FROM      WITCH1, WIT, SETPROT, READ, RDLAT,    */  0666 03336000
*/*                      RDMOV                                 */  0666 03337000
*/*      EXIT FOR EXPIRATION OF SINK                           */  0666 03338000
*/**************************************************************/  0666 03339000
*OUTSINK:   GEN;                                                   0666 03340000
OUTSINK  DS    0H                                                  0666 03341000
         LA    WORKREG3,RETCONST                                        03342000
*           GO TO GOBACK08;                                        0667 03343000
         B     GOBACK08                                            0667 03344000
*/**************************************************************/  0668 03345000
*/*                                                            */  0668 03346000
*/* OUTNSMI    FROM      OUTNORM                               */  0668 03347000
*/*      EXIT FOR NO START OF MESSAGE FOUND                    */  0668 03348000
*/**************************************************************/  0668 03349000
*OUTNSMI:;                                                         0668 03350000
OUTNSMI  DS    0H                                                  0669 03351000
*           GEN;                                                   0669 03352000
         LA    WORKREG3,RETCONST                                        03353000
*           GO TO GOBACK0C;                                        0670 03354000
         B     GOBACK0C                                            0670 03355000
*/**************************************************************/  0671 03356000
*/*                                                            */  0671 03357000
*/* OUTERR     FROM      READ                                  */  0671 03358000
*/*      EXIT FOR SOH ERROR OR TEST REQUEST DETECTED           */  0671 03359000
*/**************************************************************/  0671 03360000
*OUTERR:;                                                          0671 03361000
OUTERR   DS    0H                                                  0672 03362000
*           GEN;                                                   0672 03363000
         LA    WORKREG3,RETCONST                                        03364000
*           GO TO GOBACK10;                                        0673 03365000
         B     GOBACK10                                            0673 03366000
*OUTCURS:;                                                         0674 03367000
OUTCURS  DS    0H                                                  0675 03368000
*           GEN;                                                   0675 03369000
         LA    WORKREG3,RETCONST                                        03370000
*           GO TO GOBACK14;                                        0676 03371000
         B     GOBACK14                                            0676 03372000
*/**************************************************************/  0677 03373000
*/*                                                            */  0677 03374000
*/* GOBACK00   FROM      OUTNORM                               */  0677 03375000
*/*      SET UP RETURN CODE 0                                  */  0677 03376000
*/**************************************************************/  0677 03377000
*GOBACK00:;                                                        0677 03378000
GOBACK00 DS    0H                                                  0678 03379000
*           GEN;                                                   0678 03380000
         SH    WORKREG3,HAF4                                            03381000
*/**************************************************************/  0679 03382000
*/*                                                            */  0679 03383000
*/* GOBACK04   FROM      OUTSPEC                               */  0679 03384000
*/*      SET UP RETURN CODE 4                                  */  0679 03385000
*/**************************************************************/  0679 03386000
*GOBACK04:;                                                        0679 03387000
GOBACK04 DS    0H                                                  0680 03388000
*           GEN;                                                   0680 03389000
         SH    WORKREG3,HAF4                                            03390000
*/**************************************************************/  0681 03391000
*/*                                                            */  0681 03392000
*/* GOBACK08   FROM      OUTSINK                               */  0681 03393000
*/*      SET UP RETURN CODE 8                                  */  0681 03394000
*/**************************************************************/  0681 03395000
*GOBACK08:;                                                        0681 03396000
GOBACK08 DS    0H                                                  0682 03397000
*           GEN SETS(REG0,WORKREG3) REFS(SINKAD,DACSINAD,DACAD,HAF4)    03398000
*                SEQFLOW  ;                      /*Y02947*/        0682 03399000
         LR    REG0,SINKAD                                              03400000
         S     REG0,DACSINAD(DACAD)                                     03401000
         SH    WORKREG3,HAF4                                            03402000
*/**************************************************************/  0683 03403000
*/*                                                            */  0683 03404000
*/* GOBACK0C   FROM      OUTNSMI                               */  0683 03405000
*/*      SET UP RETURN CODE 12                                 */  0683 03406000
*/**************************************************************/  0683 03407000
*GOBACK0C:;                                                        0683 03408000
GOBACK0C DS    0H                                                  0684 03409000
*           GEN;                                                   0684 03410000
         SH    WORKREG3,HAF4                                            03411000
*/**************************************************************/  0685 03412000
*/*                                                            */  0685 03413000
*/* GOBACK10   FROM      OUTERR                                */  0685 03414000
*/*      SET UP RETURN CODE 16                                 */  0685 03415000
*/**************************************************************/  0685 03416000
*GOBACK10:;                                                        0685 03417000
GOBACK10 DS    0H                                                  0686 03418000
*           GEN;                                                   0686 03419000
         SH    WORKREG3,HAF4                                            03420000
*GOBACK14:;                                                        0687 03421000
GOBACK14 DS    0H                                                  0688 03422000
*           GEN SETS(DACFLG,SHRD,DACIND) REFS(DACAD) ; /*Y02947*/  0688 03423000
         NI    DACFLG(DACAD),X'40'                                      03424000
         NI    DACIND(DACAD),X'00'                                      03425000
*           RETURN;                                                0689 03426000
@EL00001 DS    0H                                                  0689 03427000
@EF00001 DS    0H                                                  0689 03428000
@ER00001 L     @14,12(,@13)                                        0689 03429000
         LM    @01,@12,24(@13)                                     0689 03430000
         BR    @14                                                 0689 03431000
*           GEN;                                                   0690 03432000
         EJECT                                                          03433000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0691 03434000
*/*     PRECEDING CODE -                                       */  0691 03435000
*/*IECTSCAN: CHART                                             */  0691 03436000
*/*OUTNORM:      D (YES,OUTNSMI,NO,) IS NSMI ON ?              */  0691 03437000
*/*              D (YES,,NO,%GO020) IS THIS A WRITE ?          */  0691 03438000
*/*              D (YES,,NO,%GO019) IS SOMHER ON ?             */  0691 03439000
*/*              P (,%GO020) STORE THE SOM ADDRESS IN DACSOMAD */  0691 03440000
*/*%GO019:       D (YES,%GO020,NO,) IS SHRD ON ?               */  0691 03441000
*/*              P SET DACSOMAD TO X'FFFF'                     */  0691 03442000
*/*%GO020:       P (,GOBACK00) PUT RETCONST IN REG 15          */  0691 03443000
*/*OUTSPEC:      P (,GOBACK04) PUT RETCONST IN REG 15          */  0691 03444000
*/*OUTSINK:      P (,GOBACK08) PUT RETCONST IN REG 15          */  0691 03445000
*/*OUTNSMI:      P (,GOBACK0C) PUT RETCONST IN REG 15          */  0691 03446000
*/*OUTERR:       P (,GOBACK10) PUT RETCONST IN REG 15          */  0691 03447000
*/*OUTCURS:      P (,GOBACK14) PUT RETCONST IN REG 15          */  0691 03448000
*/*GOBACK00:     P STORE CURSOR IN DACCRS, DECREMENT 15 BY FOUR*/  0691 03449000
*/*GOBACK04:     P DECREMENT 15 BY FOUR                        */  0691 03450000
*/*GOBACK08:     P SET REG 0 TO SINK USED, DECREMENT 15 BY FOUR*/  0691 03451000
*/*GOBACK0C:     P DECREMENT 15 BY FOUR                        */  0691 03452000
*/*GOBACK10:     P DECREMENT 15 BY FOUR                        */  0691 03453000
*/*GOBACK14:     P TURN OFF ALL FLAGS BUT PRIEN, SHRD          */  0691 03454000
*/*              R RETURN TO CALLER                            */  0691 03455000
*/*IECTSCAN: END                                               */  0691 03456000
*           GEN;                                                   0691 03457000
RETCONST EQU   20                                                       03458000
*              1 LINE DELETED                                    Y02947 03459000
*        END;                                                      0692 03460000
         B     @EL00001                                            0692 03461000
@DATA    DS    0H                                                       03462000
@CH00061 DC    H'1'                                                     03463000
@CH00059 DC    H'2'                                                     03464000
@CH00102 DC    H'3'                                                     03465000
@CH00283 DC    H'6'                                                     03466000
@DATD    DSECT                                                          03467000
         DS    0F                                                       03468000
IECTSCAN CSECT                                                          03469000
         DS    0F                                                       03470000
@DATD    DSECT                                                          03471000
         DS    0D                                                       03472000
@ENDDATD EQU   *                                                        03473000
IECTSCAN CSECT                                                          03474000
         NOPR  ((@ENDDATD-@DATD)*16)                                    03475000
         DS    0F                                                       03476000
@SIZDATD DC    AL1(0)                                                   03477000
         DC    AL3(@ENDDATD-@DATD)                                      03478000
         DS    0D                                                       03479000
DUM      DC    XL4'5B7B4B00'                                            03480000
FULL0    DC    XL4'00000000'                                            03481000
ONE      DC    XL4'00000001'                                            03482000
MASK     DC    XL4'0000003F'                                            03483000
ALLONE   DC    XL2'FFFF'                                                03484000
HAF0     DC    XL2'0000'                                                03485000
HAF3     DC    XL2'0003'                                                03486000
HAF4     DC    XL2'0004'                                                03487000
ADDRTAB  DS    CL64                                                     03488000
         ORG   ADDRTAB                                                  03489000
BLNK     DC    X'40'                                                    03490000
@NM00009 DC    X'C1C2C3C4C5C6C7C8C94A4B4C4D4E4F'                        03491000
@NM00010 DC    X'50D1D2D3D4D5D6D7D8D95A5B5C5D5E5F'                      03492000
@NM00011 DC    X'6061E2E3E4E5E6E7E8E96A6B6C6D6E6F'                      03493000
@NM00012 DC    X'F0F1F2F3F4F5F6F7F8F97A7B7C7D7E7F'                      03494000
         ORG   ADDRTAB+64                                               03495000
TABLE    DS    CL256                                                    03496000
         ORG   TABLE                                                    03497000
@NM00013 DC    X'01000007000000000000040000000000'                      03498000
@NM00014 DC    X'00000000000200000000000000080300'                      03499000
@NM00015 DC    X'00000000000007000000000000000000'                      03500000
@NM00016 DC    X'00000000000000000000000000000000'                      03501000
@NM00017 DC    X'00000000000000000000040000000000'                      03502000
@NM00018 DC    X'00000000000000000000050000000000'                      03503000
@NM00019 DC    X'00000000000000000000060000000000'                      03504000
@NM00020 DC    X'00000000000000000000000000000000'                      03505000
@NM00021 DC    X'00000000000000000000000000000000'                      03506000
@NM00022 DC    X'00000000000000000000000000000000'                      03507000
@NM00023 DC    X'00000000000000000000000000000000'                      03508000
@NM00024 DC    X'00000000000000000000000000000000'                      03509000
@NM00025 DC    X'00000000000000000000000000000000'                      03510000
@NM00026 DC    X'00000000000000000000000000000000'                      03511000
@NM00027 DC    X'00000000000000000000000000000000'                      03512000
@NM00028 DC    X'00000000000000000000000000000000'                      03513000
         ORG   TABLE+256                                                03514000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       03515000
@01      EQU   01                                                       03516000
@02      EQU   02                                                       03517000
@03      EQU   03                                                       03518000
@04      EQU   04                                                       03519000
@05      EQU   05                                                       03520000
@06      EQU   06                                                       03521000
@07      EQU   07                                                       03522000
@08      EQU   08                                                       03523000
@09      EQU   09                                                       03524000
@10      EQU   10                                                       03525000
@11      EQU   11                                                       03526000
@12      EQU   12                                                       03527000
@13      EQU   13                                                       03528000
@14      EQU   14                                                       03529000
@15      EQU   15                                                       03530000
DACAD    EQU   @09                                                      03531000
SOMADD   EQU   @08                                                      03532000
CURLIN   EQU   @07                                                      03533000
SOURAD   EQU   @06                                                      03534000
SINKAD   EQU   @05                                                      03535000
LINGRO   EQU   @04                                                      03536000
CURSAD   EQU   @03                                                      03537000
SPECAR   EQU   @02                                                      03538000
CARADD   EQU   @01                                                      03539000
REG0     EQU   @00                                                      03540000
WORKREG1 EQU   @10                                                      03541000
WORKREG2 EQU   @12                                                      03542000
WORKREG3 EQU   @15                                                      03543000
WORKREG4 EQU   @14                                                      03544000
DACA     EQU   0                                                        03545000
DACCRS   EQU   DACA                                                     03546000
DACSOMAD EQU   DACA+2                                                   03547000
DACSRCAD EQU   DACA+4                                                   03548000
DACSINAD EQU   DACA+8                                                   03549000
DACSRCLN EQU   DACA+12                                                  03550000
DACSINLN EQU   DACA+14                                                  03551000
DACDSSCR EQU   DACA+16                                                  03552000
DSLINE   EQU   DACDSSCR                                                 03553000
DSWIDE   EQU   DACDSSCR+1                                               03554000
DACANSCR EQU   DACA+18                                                  03555000
ANLINE   EQU   DACANSCR                                                 03556000
ANWIDE   EQU   DACANSCR+1                                               03557000
DACDSAD  EQU   DACA+20                                                  03558000
DACOPTYP EQU   DACA+21                                                  03559000
RVOID    EQU   DACOPTYP                                                 03560000
PROT     EQU   DACOPTYP                                                 03561000
WRCRS    EQU   DACOPTYP                                                 03562000
WRLA     EQU   DACOPTYP                                                 03563000
EWR      EQU   DACOPTYP                                                 03564000
RDMI     EQU   DACOPTYP                                                 03565000
RDBUF    EQU   DACOPTYP                                                 03566000
DACFLG   EQU   DACA+22                                                  03567000
BLAT     EQU   DACFLG                                                   03568000
SHRD     EQU   DACFLG                                                   03569000
SOMP     EQU   DACFLG                                                   03570000
LNGDT    EQU   DACFLG                                                   03571000
SOMHER   EQU   DACFLG                                                   03572000
NOSMI    EQU   DACFLG                                                   03573000
STXHER   EQU   DACFLG                                                   03574000
RMTDV    EQU   DACFLG                                                   03575000
DACIND   EQU   DACA+23                                                  03576000
SOURCE   EQU   0                                                        03577000
SINK     EQU   0                                                        03578000
WCCTAB   EQU   DUM                                                      03579000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    03580000
NNAME    EQU   SINK                                                     03581000
NONAME   EQU   SOURCE                                                   03582000
@NM00008 EQU   DACIND                                                   03583000
@NM00007 EQU   DACIND                                                   03584000
@NM00006 EQU   DACIND                                                   03585000
@NM00005 EQU   DACIND                                                   03586000
@NM00004 EQU   DACIND                                                   03587000
@NM00003 EQU   DACIND                                                   03588000
@NM00002 EQU   DACIND                                                   03589000
@NM00001 EQU   DACIND                                                   03590000
SRDMI    EQU   DACOPTYP                                                 03591000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      03592000
@RF00038 EQU   STXPLUG                                                  03593000
@RT00072 EQU   WRITENT                                                  03594000
@RT00094 EQU   REMTEWR                                                  03595000
@RT00141 EQU   OUTERR                                                   03596000
@RT00158 EQU   WRTEND                                                   03597000
@RT00163 EQU   OUTSINK                                                  03598000
@RT00190 EQU   WALL                                                     03599000
@RC00211 EQU   WITCH1                                                   03600000
@RT00239 EQU   WITCH4                                                   03601000
@RF00239 EQU   WITCH3                                                   03602000
@RF00218 EQU   WALL2                                                    03603000
@RT00256 EQU   ENDSCRN                                                  03604000
@RT00270 EQU   WRTNEW2                                                  03605000
@RT00278 EQU   SETTLE1                                                  03606000
@RT00283 EQU   WRTNEW1                                                  03607000
@RT00335 EQU   WRTDONE                                                  03608000
@RF00335 EQU   WITCH2                                                   03609000
@RT00340 EQU   WRTDONE                                                  03610000
@RF00340 EQU   WITCH1                                                   03611000
@RT00345 EQU   OUTSINK                                                  03612000
@RC00361 EQU   @RC00358                                                 03613000
@RT00412 EQU   SETPROT                                                  03614000
@RT00438 EQU   OUTNORM                                                  03615000
@RT00449 EQU   OUTERR                                                   03616000
@RC00462 EQU   OUTSPEC                                                  03617000
@RT00481 EQU   READOUT                                                  03618000
@RF00481 EQU   RDLAT                                                    03619000
@RT00536 EQU   OUTSINK                                                  03620000
@RT00552 EQU   READOUT                                                  03621000
@RT00576 EQU   MORTST                                                   03622000
@RF00576 EQU   RDLAT                                                    03623000
@RT00596 EQU   READOUT                                                  03624000
@RT00617 EQU   INCREM                                                   03625000
@RF00617 EQU   DATLNTST                                                 03626000
@RT00646 EQU   OUTNSMI                                                  03627000
@RC00651 EQU   @RC00649                                                 03628000
@RT00656 EQU   @RC00649                                                 03629000
@ENDDATA EQU   *                                                        03630000
         END   IECTSCAN,(C'PLS1241',0701,77006)                         03631000
./  ADD  SSI=71080084,NAME=IECTSVC
         TITLE 'IECTSVC - BTAM LOCAL 3270 SUPPORTING SVC LOGIC'         00100002
IECTSVC  CSECT                                                          00300002
*                                                                       00310002
*                                                                       00350002
*        MAINTENANCE ACTIVITY                                           00360002
*                                                                       00370002
*        YA02130                                                        00372002
*        YA02174                                                        00374002
*        YA02128                                                        00380002
*        YA02451                                                        00390002
*        YA03231                                                        00392002
*        YA03253                                                        00394002
*                                                                       00396002
*        ZA00537  (11/25/74)        ZA02332  (11/25/74)                 00398003
*        ZA03587  (03/19/75)        AZ08050  (01/29/76)                 00458003
*        ZA14028  (09/14/76)                                            00518000
*                                                                       00580002
         SPACE 5                                                        00590002
         ENTRY IECTRDIL,IECTATRL,IECTCHSL,IECTCHAL,IECTRSTL             00600002
         EJECT                                                          00900002
* STATUS- CHANGE LEVEL 000                                              01200002
*                                                                       01500002
* FUNCTION- 1. TEST FOR AN OUTSTANDING ATTENTION ON A LINE GROUP AND    01800002
*    QUEUE THE READ INITIAL IF NO ATTENTION EXISTS (IECTRDIL).          02100002
*                                                                       02400002
*         2. RESET ATTENTION STATUS FLAG FOR A DEVICE AND UPDATE THE    02700002
*    LINE GROUP'S ATTENTION COUNT (IECTATRL).                           03000002
*                                                                       03300002
*         3. SET THE SKIP FLAG FOR A DEVICE TO INHIBIT PERFORMING READ  03600002
*    INITIAL OPERATIONS ON THAT DEVICE (IECTCHSL).                      03900002
*                                                                       04200002
*         4. RESET THE SKIP FLAG FOR A DEVICE TO PERMIT PERFORMING READ 04500002
*    INITIAL OPERATIONS ON THAT DEVICE (IECTCHAL).                      04800002
*                                                                       05100002
*         5. DEQUEUE A QUEUED READ INITIAL OPERATION (IECTRSTL).        05400002
*                                                                       05700002
* ENTRY POINTS- 1. IECTRDIL FROM SVC 116 IF THE ROUTING CODE WAS 0.     06000002
*                                                                       06300002
*         2. IECTATRL FROM SVC 116 IF THE ROUTING CODE WAS 1.           06600002
*                                                                       06900002
*         3. IECTCHSL FROM SVC 116 IF THE ROUTING CODE WAS 2.           07200002
*                                                                       07500002
*         4. IECTCHAL FROM SVC 116 IF THE ROUTING CODE WAS 3.           07800002
*                                                                       08100002
*         5. IECTRSTL FROM SVC 116 IF THE ROUTING CODE WAS 4.           08400002
*                                                                       08700002
* INPUT-  1. REGISTER 15 CONTAINS THE ROUTING CODE ON ENTRY TO SVC 116. 09000002
*         2. REGISTER  0 CONTAINS THE ADDRESS OF THE DECB FOR IECTRSTL  09300002
*    AND ZERO IN ALL OTHER CASES                                        09600002
*         3. REGISTER  1 CONTAINS THE ADDRESS OF THE UCB FOR THE RLN    09900002
*    SPECIFIED OR IMPLIED                                               10200002
*         4. REGISTER 14 CONTAINS THE ADDRESS OF THE TYPE 1 SVC EXIT    10500002
*    ROUTINE.                                                           10800002
*                                                                       11100002
* OUTPUT- 1. UPDATED ATTENTION FLAGS IN THE UCB'S FOR THE DEVICE AND    11400002
*    LINE GROUP.                                                        11700002
*         2. A RETURN CODE IN REGISTER 15.                              12000002
*                                                                       12300002
* EXITS,NORMAL- BR 14 TO THE TYPE 1 SVC EXIT ROUTINE.                   12600002
*                                                                       12900002
* EXITS,ERROR-  BR 14 TO THE TYPE 1 SVC EXIT ROUTINE.                   13200002
*                                                                       13500002
* TABLES/WORK AREAS- NONE                                               13800002
*                                                                       14100002
* ATTRIBUTES- NUCLEUS RESIDENT, DISABLED, SUPERVISOR PROTECT KEY, READ  14400002
*    ONLY, TYPE 1 SVC INITIATED FUNCTION.                               14700002
*                                                                       15000002
         EJECT                                                          15003002
         EJECT                                                          15246002
* CHARACTER CODE DEPENDENCY- N/A                                        15300002
*                                                                       15600002
* NOTES- THIS ROUTINE MANIPULATES ATTENTION HANDLING FLAGS IN THE UCB'S 15900002
*    FOR LOCAL 3270 DEVICES SUPPORTED UNDER BTAM.  USER REGISTERS 2-14  16200002
*    ARE SAVED BY SVC FLIH AND RESTORED ON RETURN TO THE USER.          16500002
*                                                                       16800002
         EJECT                                                          16803002
*/*IECTSVC: CHART */                                                    16806002
*/* HEADER                                                              16809002
*/*LOGIC MODULE FOR ESR ROUTING CODES 0 THROUGH 4                       16812002
*/*BTAM 3270 ATTENTION HANDLING SUPPORTING SVC                      */  16815002
*/*IECTRDIL: E ENTRY FROM ESR */                                        16818002
*/* M ESTABLISH ADDRESSABILITY AND SAVE RETURN ADDR */                  16821002
*/* S UCBCHK: CHECK UCB ADDRESS FOR VALIDITY */                         16824002
*/* D (YES,,NO,RC8) UCB VALID? */                                       16827002
*/* D (YES,,NO,RC0) ATTENTION COUNT IS ZERO? */                         16830002
*/* D (YES,,NO,CONTRDTI) BTAM READY PROCESSING ? */                     16832002
*/* D (YES,RDYPROC,NO,) READY IN LINE GROUP ? */                        16834002
*/*CONTRDTI: P SET READ INITIAL PENDING FLAG */                         16834402
*/* P (,RC4) SAVE RLN OF INITIALIZED IOB */                             16836002
*/*RDYPROC: P SET READ INITIAL PENDING FLAG */                          16838002
*/* P (,RCC) SAVE RLN IN MASTER, SET READY NOT DONE IN MASTER */        16838402
*/*IECTATRL: E ENTRY FROM ESR */                                        16839002
*/* M ESTABLISH ADDRESSABILITY AND SAVE RETURN ADDR */                  16842002
*/* S UCBCHK: CHECK UCB ADDRESS FOR VALIDITY */                         16845002
*/* D (YES,,NO,RC4) UCB VALID? */                                       16848002
*/* D (YE>,,NO,RDYCHKT) ATTN FLAG SET ? */                              16850002
*/* D (YES,RDYCHKT,NO,) PROCESSING READY ? */                           16852002
*/* P RESET THE ATTENTION FLAG */                                       16854002
*/* D (NO,,YES,RC0) SKIP FLAG SET? */                                   16857002
*/* P (,RC0) DECREMENT ATTENTION COUNT FOR LINE GROUP BY 1 */           16860002
*/*RDYCHKT: D (YES,,NO,RC4) USING BTAM'S READY ROUTINE ? */             16862002
*/*RDYCHK: D (YES,,NO,RC0) READY NOT DONE FLAG ON ? */                  16864002
*/* L (,RC0) INVOKE POST TO RESETPL THE READ */                         16866002
*/*IECTCHSL: E ENTRY FROM ESR */                                        16870602
*/* M ESTABLISH ADDRESSABILITY AND SAVE RETURN ADDR */                  16874302
*/* S UCBCHK: CHECK UCB ADDRESS FOR VALIDITY */                         16878002
*/* D (YES,,NO,RC8) UCB VALID? */                                       16881702
*/* D (NO,,YES,RC0) SKIP FLAG SET? */                                   16885402
*/* P SET THE SKIP FLAG */                                              16889102
*/* D (YES,,NO,RC0) ATTENTION FLAG SET */                               16892802
*/* P (,RC0) DECREMENT ATTENTION COUNT FOR LINE GROUP BY 1 */           16896502
*/*IECTCHAL: E ENTRY FROM ESR */                                        16900202
*/* M ESTABLISH ADDRESSABILITY AND SAVE RETURN ADDR */                  16903902
*/* S UCBCHK: CHECK UCB ADDRESS FOR VALIDITY */                         16907602
*/* D (YES,,NO,RC8) UCB VALID? */                                       16911302
*/* D (YES,,NO,RC0) SKIP FLAG SET? */                                   16915002
*/* P RESET THE SKIP FLAG */                                            16918702
*/* D (YES,,NO,RC0) ATTENTION FLAG SET? */                              16922402
*/* D (NO,,YES,SCHEDIQE) READ INITIAL PENDING? */                       16926102
*/* P (,RC0) INCREMENT ATTENTION COUNT FOR LINE GROUP BY 1 */           16929802
*/*SCHEDIQE: P RESET READ INITIAL PENDING AND ATTENTION FLAGS */        16933502
*/* P OBTAIN AND INITIALIZE IQE */                                      16937202
*/* L (,RC0) INVOKE AEE2 TO SCHEDULE READ */                            16940902
*/*IECTRSTL: E ENTRY FROM ESR */                                        16944602
*/* M ESTABLISH ADDRESSABILITY AND SAVE RETURN ADDR */                  16948302
*/* S UCBCHK: CHECK UCB ADDRESS FOR VALIDITY */                         16952002
*/* D (0,,4,RC8,8,RCC) TEST RETURN CODE */                              16955702
*/*RDTITST: D (YES,,NO,RC4) READ INITIAL PENDING? */                    16959402
*/* P RESET READ INITIAL PENDING FLAG */                                16963102
*/* P CLEAR INITIALIZED RLN FIELD */                                    16966802
*/* L (,RC0) POST USER'S ECB COMPLETE WITH X'48' CODE */                16970502
*/*RC0: P SET RETURN CODE OF 0 */                                       16974202
*/* R BR TO TYPE I SVC EXIT RTN */                                      16977902
*/*RC4: P SET RETURN CODE OF 4 */                                       16981602
*/* R BR TO TYPE I SVC EXIT RTN */                                      16985302
*/*RC8: P SET RETURN CODE OF 8 */                                       16989002
*/* R BR TO TYPE I SVC EXIT RTN */                                      16992702
*/*RCC: P SET RETURN CODE OF X'0C' */                                   16996402
*/* R BR TO TYPE I SVC EXIT RTN */                                      17000102
*/*IECTSVC: END */                                                      17003802
*/*UCBCHK: CHART */                                                     17007502
*/* HEADER                                                              17011202
*/*IECTSVC UCB VALIDITY CHECK SUBROUTINE                            */  17014902
*/*UCBCHK: E ENTRY */                                                   17018602
*/* M ESTABLISH ADDRESSABILITY FOR SUBROUTINE */                        17022302
*/* M ESTABLISH ADDRESSABILITY FOR DEVICE UCB */                        17026002
*/* D (YES,,NO,VCRC08) UCBID = X'FF'? */                                17029702
*/* D (YES,,NO,VCRC04) IS DEVICE A 3270 DEVICE? */                      17033402
*/* D (YES,,NO,VCRC08) IRB ADDRESS INITIALIZED? */                      17037102
*/* D (NO,,YES,RLNISONE) DEVICE UCB = MASTER UCB? */                    17040802
*/* M OBTAIN ADDRESS OF MASTER UCB FROM DEVICE UCB */                   17044502
*/*CHKMSTR: D (YES,,NO,VCRC08) UCBID OF MASTER UCB = X'FF'? */          17048202
*/* D (YES,,NO,VCRC04) IS MASTER DEVICE A 3270 DEVICE? */               17051902
*/* D (YES,,NO,VCRC08) IRB ADDR IN MASTER UCB NON-ZERO? */              17055602
*/* D (YES,,NO,VCRC08) BOTH UCB IRB ADDRESSES THE SAME? */              17059302
*/* D (YES,,NO,VCRC08) RLN IN MASTER UCB = 1? */                        17063002
*/*VCRC00:  P SET RETURN CODE OF ZERO */                                17066702
*/* R RETURN */                                                         17070402
*/*VCRC04: P SET RETURN CODE OF FOUR */                                 17074102
*/* R RETURN */                                                         17077802
*/*VCRC08: P SET RETURN CODE OF EIGHT */                                17081502
*/* R RETURN */                                                         17085202
*/*RLNISONE: P (,VCRC00) SET MASTER UCB = DEVICE UCB */                 17088902
*/*UCBCHK: END */                                                       17092602
         EJECT                                                          17096302
PARMREG2 EQU   0                    SECOND PARAMETER REGISTER           17100002
PARMREG1 EQU   1                    FIRST PARAMETER REGISTER            17400002
CVTREG   EQU   3                    POINTER TO CVT                      17700002
TCBREG   EQU   4                   POINTER TO TCB                       18000002
RTNREG   EQU   14                   RETURN POINT REGISTER               18300002
EPREG    EQU   15                   ENTRY POINT REGISTER                18600002
*                                                                       18900002
BASEREG  EQU   5                    BASE REGISTER FOR MAIN ROUTINE      19200002
SUBASREG EQU   10                   BASE REGISTER FOR SUB-ROUTINE       19500002
UCBREG   EQU   9                    BASE REGISTER FOR DEVICE UCB        19800002
MSTREG   EQU   8                    BASE REGISTER FOR MASTER UCB        20100002
IRBREG   EQU   7                    POINTER TO IRB                      20400002
IQEREG   EQU   6                    POINTER TO IQE                      20700002
*                                                                       21000002
SAVEREG  EQU   12                   SAVE REGISTER FOR REGISTER 14       21300002
WORKREG  EQU   2                    WORK REGISTER                       21600002
POSTCODE EQU   10                  COMPLETION CODE REG FOR POST         21900002
POSTECB  EQU   11                  ECB ADDR REG FOR POST                22200002
POSTTCB  EQU   12                  TCB ADDR REG FOR POST                22500002
ONEBYTE  EQU   8                   EIGHT BITS IN A BYTE     LD @ZA00537 22550002
*                                                                       22800002
DVC3277  EQU   X'09'                DEVICE TYPE FOR 3277 DISPLAY        23700002
DVC3286  EQU   X'0B'               DEVICE TYPE FOR 3286 PRINTER         24000002
*              X'0A'               DEVICE TYPE FOR 3284 PRINTER         24300002
READY    EQU   X'20'               HAS COME READY FLAG         @YA02128 25210002
LINERDY  EQU   X'01'               MTR DEVICE IN GROUP READY   @YA02128 25220002
RDTIACTV EQU   X'08'               READ INIT REQ OUTSTANDING    YA01033 25300002
RDYNDONE EQU   X'04'               INDICATE READY NOT DONE     @YA02128 25350002
RLN1     EQU   X'01'                RLN FOR RLN 1 OF LINE GROUP         25500002
IGG019UP EQU   X'10'               USING BTAM EXIT ROUT        @YA02128 26450002
*                                   (CVT0PT01)                          27000002
ZERO     EQU   X'00'                COMPARE VALUE OF 0                  27300002
ONE      EQU   X'01'                INCREMENT VALUE OF 1                27600002
FOUR     EQU   X'04'                RETURN CODE OF 4                    27900002
EIGHT    EQU   X'08'                RETURN CODE OF 8                    28200002
TWELVE   EQU   X'0C'                RETURN CODE OF X'0C'                28500002
X58      EQU   X'58'                DISPLACEMENT TI 1ST IOB  LD YA02451 28550002
SIXTEEN  EQU   X'10'               RETURN CODE X'10'           @YA02128 28550102
         EJECT                                                          28800002
         USING UCB,UCBREG           ADDRESSABILITY FOR DEVICE UCB       29100002
         USING MSTRUCB,MSTREG       AND MASTER UCB                      29400002
         USING RBBASIC,IRBREG                                 LD Y02947 29450002
         USING CVT,CVTREG                                     LD Y02947 29460002
         USING IQESECT,IQEREG                                 LD Y02947 29500002
         SPACE 5                                                        29550002
*        READ INITIAL ATTENTION TEST                                    29700002
         SPACE 3                                                        29750002
IECTRDIL LR    SAVEREG,RTNREG       SAVE RETURN ADDRESS                 30000002
         BALR  BASEREG,0            ESTABLISH BASE REGISTER             30300002
         USING *,BASEREG            AND ADDRESSABILITY                  30600002
         B     BEGIN1              BRANCH AROUND ID         LD @ZA02332 30650002
         DC    C' IECTSVC'          MODULE IDENTIFIER          @YA02128 30700003
         DC    C'** MVS *'                                     @ZA02332 30730003
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY       LD @ZA02332 30770002
PATCH1   DC    20X'00'             PATCH AREA FOR IECTRDIL  LD @ZA02332 30800002
BEGIN1   DS    0F                                           LD @ZA02332 30850002
*                                                                       30900002
         BAL   RTNREG,UCBCHK        CHECK UCB ADDRESS FOR VALIDITY      31200002
         LTR   EPREG,EPREG          UCB VALID                           31500002
         BNZ   RC8                  NO, RETURN WITH RETURN CODE OF 8    31800002
*                                                                       32100002
         OI    MTRGCB,RDTIACTV     READ INIT REQ OUTSTANDING    YA01033 32200002
         CLI   MTRATNCT,ZERO        IS ATTENTION COUNT ZERO             32400002
         BNE   RC0                  NO, RETURN WITH RETURN CODE OF 0    32700002
*                                                                       33000002
         TM    UCBGRAF,IGG019UP    BTAM READY PROCESSING ?     @YA02128 33050002
         BNO   CONTRDTI            NO, DO READ TI              @YA02128 33100002
         TM    MTRGRAF,LINERDY     COME READY ?                @YA02128 33150002
         BO    RDYPROC             YES, PROCESS READY          @YA02128 33200002
CONTRDTI EQU   *                   COMPLETE RDTI               @YA02128 33250002
         OI    MTRGCB,UCBRIPND      SET READ INIT.PEND. FLAG  LD Y02947 33300002
         MVC   MTRINRLN(ONE),UCBRLN  MOVE RLN OF INITIALIZED LINE       33600002
         B     RC4                  RETURN WITH RETURN CODE OF 4        33900002
RDYPROC  EQU   *                   DEVICE READY                @YA02128 33950002
         OI    MTRGCB,UCBRIPND     SET PENDING FLAG            @YA02128 34000002
         MVC   MTRINRLN(ONE),UCBRLN MOVE RLN OF INIT LINE      @YA02128 34050002
         OI    MTRGRAF,RDYNDONE    SET NOT DONE IN UCB         @YA02128 34100002
         B     RCC                 GIVE RETURN 0C              @YA02128 34150002
         DROP  BASEREG                                                  34200002
         EJECT                                                          34500002
*                                                                       34550002
*        RESET ATTENTION FLAG                                           34800002
         SPACE 3                                                        34850002
IECTATRL LR    SAVEREG,RTNREG       SAVE RETURN ADDRESS                 35100002
         BALR  BASEREG,0            ESTABLISH BASE REGISTER             35400002
         USING *,BASEREG            AND ADDRESSABILITY                  35700002
ATRLBASE EQU   *                   ALLOW ADDRESSABILITY     L5 @ZA03587 35702003
         B     BEGIN2              BRANCH AROUND PATCHAREA  LD @ZA02332 35710002
PATCH2   DC    20X'00'             PATCH AREA FOR IECTATRL  LD @ZA02332 35720002
BEGIN2   DS    0F                                           LD @ZA02332 35730002
*                                                                       36000002
         BAL   RTNREG,UCBCHK        CHECK UCB ADDRESS FOR VALIDITY      36300002
         LTR   EPREG,EPREG          UCB VALID                           36600002
         BNZ   RC4                  NO, GIVE RETURN CODE OF 4           36900002
*                                                                       37200002
         TM    UCBGCB,UCBATRCD      ATTENTION FLAG SET        LD Y02947 37500002
         BZ    RDYCHKT              NO, SEE IF READY           @YA02128 37800002
         TM    MTRGRAF,RDYNDONE    READY NOT DONE FLAG ?       @YA02128 37850002
         BO    RDYCHKT             YES, PROCESS READY          @YA02128 37900002
         XI    UCBGCB,UCBATRCD      YES, RESET THE ATT. FLAG  LD Y02947 38100002
*                                                                       38400002
         TM    UCBGCB,UCBSKPFG      SKIP FLAG SET             LD Y02947 38700002
         BO    RC0                  YES, GIVE RETURN CODE OF 0          39000002
         SR    WORKREG,WORKREG                                          39300002
         IC    WORKREG,MTRATNCT     DECREMENT ATTENTION COUNT           39600002
         BCTR  WORKREG,0            FOR LINE GROUP BY 1                 39900002
         STC   WORKREG,MTRATNCT                                         40200002
         B     RC0                  GIVE RETURN CODE OF 0               40500002
RDYCHKT  EQU   *                   SEE IF BTAM                 @YA02128 40510002
         TM    UCBGRAF,IGG019UP    USE BTAMS ?                 @YA02128 40520002
         BNO   RC0                 NO, GIVE RETURN CODE 0      @YA02128 40530002
RDYCHK   EQU   *                   CHECK FOR READY             @YA02128 40550002
         TM    MTRGRAF,RDYNDONE    NOT DONE FLAG ?             @YA02128 40600002
         BZ    RC0                 NO, GIVE RETURN CODE 0      @YA02128 40650002
         LTR   PARMREG2,PARMREG2   DECB ADDR IN REG ?       L5 @ZA03567 40700003
         BZ    RC8                 IF NO,SET RET CODE TO 8  L5 @ZA03567 40750003
         LR    SUBASREG,BASEREG    ESTABLISH NEW BASE          @YA02128 40752002
         DROP  BASEREG             RELEASE OLD BASE            @YA02128 40802002
         USING ATRLBASE,SUBASREG   AND USE NEW BASE            @YA02128 40852002
         LA    BASEREG,RSTLBASE   ESTABLISH NEW ADDRESSABILITY @YA02128 40902002
         B     POST48              GO POST READ                @YA02128 41002002
         DROP  SUBASREG            DROP ADDRESSABILITY         @YA02128 41052002
         EJECT                                                          41100002
*                                                                       41150002
*        INHIBIT READ INITIALS ON A DEVICE                              41400002
         SPACE 3                                                        41450002
IECTCHSL LR    SAVEREG,RTNREG       SAVE RETURN ADDRESS                 41700002
         BALR  BASEREG,0            ESTABLISH BASE REGISTER             42000002
         USING *,BASEREG            AND ADDRESSABILITY                  42300002
         B     BEGIN3              BR AROUND PATCH AREA     LD @ZA02332 42350002
PATCH3   DC    20X'00'             PATCH AREA FOR IECTCHSL  LD @ZA02332 42400002
BEGIN3   DS    0F                                           LD @ZA02332 42450002
*                                                                       42600002
         BAL   RTNREG,UCBCHK        CHECK UCB ADDRESS FOR VALIDITY      42900002
         LTR   EPREG,EPREG          UCB VALID                           43200002
         BNZ   RC8                  NO, GIVE RETURN CODE OF 8           43500002
*                                                                       43800002
         TM    UCBGCB,UCBSKPFG      SKIP FLAG SET             LD Y02947 44100002
         BO    RC0                  YES, GIVE RETURN CODE OF 0          44400002
         OI    UCBGCB,UCBSKPFG      NO, SET THE SKIP FLAG     LD Y02947 44700002
*                                                                       45000002
         TM    UCBGCB,UCBATRCD      ATTENTION FLAG SET        LD Y02947 45300002
         BZ    RC0                  NO, GIVE RETURN CODE OF 0           45600002
         SR    WORKREG,WORKREG                                          45900002
         IC    WORKREG,MTRATNCT     DECREMENT ATTENTION COUNT           46200002
         BCTR  WORKREG,0            FOR LINE GROUP BY 1                 46500002
         STC   WORKREG,MTRATNCT                                         46800002
         B     RC0                  GIVE RETURN CODE OF 0               47100002
         DROP  BASEREG                                                  47400002
         EJECT                                                          47450002
*                                                                       47700002
*        PERMIT READ INITIALS ON A DEVICE                               48000002
         SPACE 3                                                        48050002
IECTCHAL LR    SAVEREG,RTNREG       SAVE RETURN ADDRESS                 48300002
         BALR  BASEREG,0            ESTABLISH BASE REGISTER             48600002
         USING *,BASEREG            AND ADDRESSABILITY                  48900002
         B     BEGIN4              BR AROUND PATCH AREA     LD @ZA02332 48950002
PATCH4   DC    20X'00'             PATCH AREA FOR IECTCHAL  LD @ZA02332 49000002
BEGIN4   DS    0F                                           LD @ZA02332 49050002
*                                                                       49200002
         BAL   RTNREG,UCBCHK        CHECK UCB ADDRESS FOR VALIDITY      49500002
         LTR   EPREG,EPREG          UCB VALID                           49800002
         BNZ   RC8                  NO, GIVE RETURN CODE OF 8           50100002
*                                                                       50400002
         TM    UCBGCB,UCBSKPFG      SKIP FLAG SET             LD Y02947 50700002
         BZ    RC0                  NO, GIVE RETURN CODE OF 0           51000002
         XI    UCBGCB,UCBSKPFG      YES, RESET THE SKIP FLAG  LD Y02947 51300002
*                                                                       51600002
         TM    UCBGCB,UCBATRCD      ATTENTION FLAG SET        LD Y02947 51900002
         BZ    RC0                  NO, GIVE RETURN CODE OF 0           52200002
*                                                                       52500002
         TM    MTRGCB,UCBRIPND      READ INITIAL PENDING      LD Y02947 52800002
         BO    SCHEDIQE             YES, SCHEDULE 2ND LEVEL ATTN. RTN   53100002
*                                   TO DO READ                          53400002
         SR    WORKREG,WORKREG      NO, INCREMENT ATTENTION COUNT       53700002
         IC    WORKREG,MTRATNCT     FOR LINE GROUP BY 1                 54000002
         LA    WORKREG,ONE(WORKREG)                                     54300002
         STC   WORKREG,MTRATNCT                                         54600002
         B     RC0                  GIVE RETURN CODE OF ZERO            54900002
*                                                                       55200002
SCHEDIQE XI    MTRGCB,UCBRIPND      RESET RD INIT.PEND. FLAG  LD Y02947 55500002
         XI    UCBGCB,UCBATRCD      RESET ATTENTION FLAG      LD Y02947 55800002
         L     IQEREG,RBNEXAV       GET ADDRESS OF IQE        LD Y02947 56100002
         XC    RBNEXAV(FOUR),RBNEXAV  CLEAR IQE LINK          LD Y02947 56400002
         ST    UCBREG,IQEPARAM      STORE UCB ADDRESS IN IQE  LD Y02947 56700002
         LNR   PARMREG1,IQEREG      PARM = COMPLEMENT OF IQE ADDR       57000002
         L     EPREG,CVT0EF00       EP = AEE2                 LD Y02947 57300002
         BALR  RTNREG,EPREG         SCHEDULE IQE                        57600002
         B     RC0                  GIVE RETURN CODE OF 0               57900002
         EJECT                                                          57950002
*                                                                       58200002
*        DEQUEUE PENDING READ INITIAL                                   58500002
         SPACE 3                                                        58550002
IECTRSTL LR    SAVEREG,RTNREG       SAVE RETURN ADDRESS                 58800002
         DROP  BASEREG                                                  59100002
         BALR  BASEREG,0            ESTABLISH BASE REGISTER             59400002
         USING *,BASEREG            AND ADDRESSABILITY                  59700002
RSTLBASE EQU   *                   ALLOW ADDRESSABILITY     L5 @ZA03587 59702003
         B     BEGIN5              BR AROUND PATCH AREA     LD @ZA02332 59710002
PATCH5   DC    20X'00'             PATCH AREA FOR IECTRSTL  LD @ZA02332 59720002
BEGIN5   DS    0F                                           LD @ZA02332 59730002
*                                                                       60000002
         BAL   RTNREG,UCBCHK        CHECK UCB ADDRESS FOR VALIDITY      60300002
         B     RCTABLE(EPREG)       TEST RETURN CODE                    60600002
RCTABLE  B     RDTITST             GO TEST READ INITIAL     LD @ZA02332 60900002
         B     RC8                  4, INVALID DVC- GIVE RC OF 8        61200002
         B     RCC                  8, INVALID UCB- GIVE RC OF X'0C'    61500002
*                                                                       61800002
*              14 LINES DELETED FOR ----->                  LD @ZA02332 61850002
*                                                                       62098802
RDTITST  TM    MTRGCB,RDTIACTV     READ INIT REQ OUTSTANDING?   YA01033 62100002
         BZ    RC10                RC=16                       @ZA14028 62200000
         TM    MTRGCB,UCBRIPND     READ INIT PENDING?         LD Y02947 62300002
         BZ    RC4                  NO, GIVE RETURN CODE OF 4           62400002
*                                   (OPERATION IN PROGRESS)             62700002
POST48   EQU   *                                             LD YA02174 62750002
         NI    MTRGCB,X'FF'-RDTIACTV-UCBRIPND     YES,        LD Y02947 63000002
*                                  RESET READ INIT PENDING      YA01033 63200002
*                                  AND OUTSTANDING FLAGS        YA01033 63400002
         TM    MTRGRAF,IGG019UP    BTAM READY ?                @YA02128 63400102
         BNO   CONTPOST            NO, DON'T DO READY CHECK    @YA02128 63450002
         TM    MTRGRAF,RDYNDONE    READY PROCESSING            @YA02128 63500002
         BNO   CONTPOST            NO, DON'T RESET FLAGS       @YA02128 63550002
         NI    MTRGRAF,X'FB'       TURN OFF READY NOT DONE     @YA02128 63560002
         NI    UCBGRAF,X'DB'       TURN OFF READY FLAG         @YA02128 63570002
         L     EPREG,MTRDEBAD      GET DEB ADDRESS             @YA02128 63580002
         LA    EPREG,0(EPREG)      CLEAR HIGH BYTE             @YA02128 63590002
         XR    POSTECB,POSTECB     CLEAR RLN REG               @YA02128 63592002
         IC    POSTECB,16(EPREG)   GET NUMBER EXTENTS          @YA02128 63594002
         XR    POSTCODE,POSTCODE   CLEAR INDEX REGISTER        @YA02128 63596002
READYLP  EQU   *                   CHECK UCB'S FOR READY       @YA02128 63598002
         L     PARMREG1,32(POSTCODE,EPREG) POINT TO UCB        @YA02128 63598402
         TM    28(PARMREG1),READY  COME READY                  @YA02128 63598802
         BO    CONTPOST            YES, DON'T TURN OFF         @YA02128 63599202
*                                  LINE READY IN MASTER        @YA02128 63599602
         LA    POSTCODE,4(POSTCODE) BUMP INDEX                 @YA02128 63599702
         BCT   POSTECB,READYLP     CHECK IF MORE TO DO         @YA02128 63599802
         NI    MTRGRAF,X'FE'       TURN OFF LINE READY         @YA02128 63599902
CONTPOST EQU   *                   CONTINUE THE POST           @YA02128 63649902
*                                                                       63650002
         MVI   MTRINRLN,ZERO        CLEAR INITIALIZED RLN               63699902
*        SAVE CONTENTS OF REG 12 ACROSS CALL TO POST                    63900002
*                                                                       63950002
         LR    PARMREG1,SAVEREG    REG 1 IS SAVED BY POST               64200002
*                                                                       64250002
*        SET UP LINKAGE TO POST -- NON-STANDARD                         64500002
*                                                                       64550002
         L     POSTCODE,COMPCODE   REG 10 = COMPLETION CODE             64800002
         LR    POSTECB,PARMREG2    REG 11 = ECB ADDR         LD YA03231 64850002
         LA    POSTECB,ZERO(POSTECB) CLEAR HIGH ORDER BYTE   LD YA03231 64900002
         LR    POSTTCB,TCBREG      REG 12 = TCB ADDR                    65400002
         L     EPREG,CVT0PT01      EP = POST                  LD Y02947 65700002
         BALR  RTNREG,EPREG        POST USER'S ECB COMPLETE             66000002
         LR    SAVEREG,PARMREG1    RESTORE REG 12                       66300002
         B     RC0                  GIVE RETURN CODE OF 0               66600002
         DROP  BASEREG                                                  66900002
         EJECT                                                          67200002
*                                                                       67250002
*        RETURN CODES SUBROUTINE                                        67300002
*                                                                       67350002
RC0      SR    EPREG,EPREG          SET REGISTER 15 = 0                 67500002
         LR    RTNREG,SAVEREG       EXIT RTN ADDRESS IN 14              67800002
         BR    RTNREG               BRANCH TO TYPE 1 EXIT RTN.          68100002
*                                                                       68400002
RC4      LA    EPREG,FOUR           SET RC = 4                          68700002
         LR    RTNREG,SAVEREG       EXIT RTN ADDR TO REG 14             69000002
         BR    RTNREG               BRANCH TO TYPE 1 EXIT RTN.          69300002
*                                                                       69600002
RC8      LA    EPREG,EIGHT          SET RC = 8                          69900002
         LR    RTNREG,SAVEREG       EXIT RTN ADDR TO REG 14             70200002
         BR    RTNREG               BRANCH TO TYPE 1 EXIT RTN.          70500002
*                                                                       70800002
RCC      LA    EPREG,TWELVE         SET RC = X'0C'                      71100002
         LR    RTNREG,SAVEREG       EXIT RTN ADDR TO REG 14             71400002
         BR    RTNREG               BRANCH TO TYPE 1 EXIT RTN.          71700002
*                                                                       72000002
RC10     EQU   *                                               @ZA14028 72010000
         LR    WORKREG,PARMREG2     LOAD DECB ADDR             @ZA14028 72030000
         SLL   WORKREG,ONEBYTE      DECB ADDR IN HI BYTE       @ZA14028 72050000
         LA    EPREG,SIXTEEN        RC=X'10'                   @ZA14028 72070000
         OR    EPREG,WORKREG        DECB ADDR IN REG 15        @ZA14028 72090000
         LR    RTNREG,SAVEREG       EXIT ROUT ADDR IN REG 14   @ZA14028 72110000
         BR    RTNREG               BR TYPE1 EXIT ROUT         @ZA14028 72130000
         EJECT                                                          72160002
*                                                                       72200002
*        UCB VALIDITY CHECK ROUTINE                                     72300002
         SPACE 3                                                        72350002
UCBCHK   BALR  SUBASREG,0           ADDRESSABILITY FOR                  72600002
         USING *,SUBASREG           VALIDITY SUBROUTINE                 72900002
         LR    UCBREG,PARMREG1      ADDRESSABILITY FOR UCB              73200002
*                                                                       73500002
         CLI   UCBID,UCBSTND        UCBID = X'FF'             LD Y02947 73800002
         BNE   VCRC08               NO, GIVE RETURN CODE OF 8           74100002
*                                                                       74400002
         CLI   UCBTBYT3,UCB3DISP    IS DEVICE A GRAPHICS DEV. LD Y02947 74700002
         BNE   VCRC04               NO, GIVE RETURN CODE OF 4           75000002
         CLI   UCBTBYT4,DVC3277    DEVICE 3277 DISPLAY        LD Y02947 75300002
         BL    VCRC04              NO, GIVE RETURN CODE OF 4            75600002
         CLI   UCBTBYT4,DVC3286    DEV. ANY OTHER 3270 DEVICE LD Y02947 75900002
         BH    VCRC04              NO, GIVE RETURN CODE OF 4            76200002
*                                                                       76500002
CHKIRB   L     IRBREG,UCBIRB        GET IRB ADDRESS                     76800002
         LA    IRBREG,0(IRBREG)    CLEAR GRAF FLAGS            @YA02128 76850002
         LTR   IRBREG,IRBREG        IS IT ZERO                          77100002
         BZ    VCRC08               YES, GIVE RETURN CODE OF 8          77400002
         CLI   UCBRLN,RLN1          DEVICE UCB = MASTER UCB             77700002
         BE    RLNISONE             YES, SET MASTER UCB BASE            78000002
         L     MSTREG,UCBCTLNK      GET ADDRESS OF MASTER UCB           78300002
*                                                                       78600002
CHKMSTR  CLI   MTRUCBID,UCBSTND     UCBID OF MASTER UCB       LD Y02947 78900002
         BNE   VCRC08               NO, GIVE RETURN CODE OF 8           79200002
*                                                                       79500002
         CLI   MTRDVCLS,UCB3DISP    DEVICE A GRAPHICS DEVICE  LD Y02947 79800002
         BNE   VCRC04               NO, GIVE RETURN CODE OF 4           80100002
         CLI   MTRUNTYP,DVC3277     DEVICE 3277 DISPLAY                 80400002
         BL    VCRC04              NO, GIVE RETURN CODE OF 4            80700002
         CLI   MTRUNTYP,DVC3286    DEVICE ANY OTHER 3270 DEVICE         81000002
         BH    VCRC04              NO, GIVE RETURN CODE OF 4            81300002
*                                                                       81600002
CHKIRB1  L     WORKREG,MTRIRB       GET IRB ADDRESS                     81900002
         LA    WORKREG,0(WORKREG)  CLEAR GRAF FLAGS            @YA02128 81950002
         LTR   WORKREG,WORKREG      IS IT ZERO                          82200002
         BZ    VCRC08               YES, GIVE RETURN CODE OF 8          82500002
         CR    WORKREG,IRBREG       EQUAL TO ADDRESS FROM DEVICE UCB    82800002
         BNE   VCRC08               NO, GIVE RETURN CODE OF 8           83100002
         CLI   MTRRLN,RLN1          RLN = 1                             83400002
         BNE   VCRC08               NO, GIVE RETURN CODE OF 8           83700002
*                                                                       84000002
VCRC00   SR    EPREG,EPREG          YES, GIVE RETURN CODE OF 0          84300002
         BR    RTNREG               AND RETURN                          84600002
*        INVALID DEVICE TYPE                                            84900002
VCRC04   LA    EPREG,FOUR           GIVE RETURN CODE OF 4               85200002
         BR    RTNREG               AND RETURN                          85500002
*        INVALID CONTROL BLOCK                                          85800002
VCRC08   LA    EPREG,EIGHT          GIVE RETURN CODE OF 8               86100002
         BR    RTNREG              AND RETURN                           86400002
*                                                                       86700002
RLNISONE LR    MSTREG,UCBREG        SET MASTER UCB = DEVICE UCB         87000002
         B     VCRC00               MASTER UCB OK. GIVE RETURN CODE 0   87300002
*                                                                       87600002
         DS    0F                                                       87900002
COMPCODE DC    X'48000000'         COMPLETION CODE FOR RESETPL          88200002
*                                                                       88500002
IN       EQU   8                                                        88600002
         EJECT                                                          88800002
CVT      DSECT                                                          88810002
         CVT                                          LD Y02947         88820002
         EJECT                                                          88820402
         DCBD  DSORG=BX                                      LD YA02451 88822402
         EJECT                                                          88822802
         IECTDEBX                                            LD YA02451 88824002
         EJECT                                                          88826002
         IECTIOBX                                            LD YA02451 88828002
         EJECT                                                          88830002
         IHAIQE                                                         88850002
         EJECT                                                          89099602
         IHARB                                                          89099702
         EJECT                                                          89099802
UCB      DSECT                                                          89099902
         IEFUCBOB                                                       89149902
         EJECT                                                          89151902
MSTRUCB  DSECT                                                          89153902
MTRUCBID EQU   MSTRUCB+(UCBID-UCBOB)                                    89155902
MTRDVCLS EQU   MSTRUCB+(UCBDVCLS-UCBOB)                                 89157902
MTRUNTYP EQU   MSTRUCB+(UCBUNTYP-UCBOB)                                 89158302
MTRATNCT EQU   MSTRUCB+(UCBATNCT-UCBOB)                                 89158702
MTRGCB   EQU   MSTRUCB+(UCBGCB-UCBOB)                                   89159102
MTRIRB   EQU   MSTRUCB+(UCBIRB-UCBOB)                                   89159502
MTRGRAF  EQU   MTRIRB                                                   89166202
MTRINRLN EQU   MSTRUCB+(UCBINRLN-UCBOB)                                 89173102
MTRRLN   EQU   MSTRUCB+(UCBRLN-UCBOB)                                   89179802
MTRDEBAD EQU   MTRRLN                                                   89186502
         SPACE 5                                                        89193202
         END                                                            89199902
./  ADD  SSI=62290175,NAME=IECTTRNS
         TITLE 'IECTTRNS - TRANSLATE MACRO SUBROUTINE'                  00020000
IECTTRNS CSECT                                                          00040000
*00010006001000,006200,010800,011200,011800,012200                 000C 00060015
*                                                                       00080000
* STATUS            CHANGE LEVEL  001   NOVEMBER 14, 1967               00100015
*                                                                       00106000
*******************************************************************     00112000
*                                                                       00120000
*              FOLLOWING FIXES APPLIED                                  00123000
*        AZ04193  (09/05/75)                                            00126000
*        AZ12135  (07/21/76)                                            00127000
*                                                                       00129000
********************************************************************    00132000
*                                                                       00135000
* FUNCTION -        TRANSLATE STORAGE BYTES FROM EBCDIC TO TELECOMMUN-  00140000
*                   ICATION DEVICE TRANSMISSION CODES                   00160000
         SPACE 2                                                        00180000
* ENTRY POINT -     ENTRY IS TO 1ST EXECUTABLE INSTRUCTION FROM IOS     00200000
         SPACE 2                                                        00220000
* INPUT -           REGISTER  1 - ADDRESS OF PARAMETER LIST             00240000
*                   REGISTER 14 - RETURN ADDRESS                        00260000
         SPACE 2                                                        00280000
* OUTPUT -          TRANSLATED DATA IN AREAS SPECIFIED BY PARAMETER     00300000
*                   LIST                                                00320000
         SPACE 2                                                        00340000
* IN LINE ROUTINES -LOAD THE PARAMETERS, DCB ADRS, TRANSLATE TABLE      00360000
*                   ADRS AND AREA ADRS, AND   DECREMENT THE COUNT BY    00380000
*                   256 UNTIL LESS THAN 256 BYTES REMAIN TO BE          00400000
*                   TRANSLATED.  TRANSLATE 256 BYTES WITH EACH DECRE-   00420000
*                   MENT.  WHEN LESS THAN 256 BYTES REMAIN ADD BACK     00440000
*                   255 AND TRANSLATE THE REMAINING BYTES.  WHEN        00460000
*                   DYNAMIC BUFFERING IS SPECIFIED THE COUNT CAN BE     00480000
*                   OBTAINED FROM THE DCB FOR THE FIRST BUFFER.  A      00500000
*                   CHAIN OF BUFFERS IS ASSUMMED AND THE LAST BUFFER    00520000
*                   IS DETERMINED BY LOOKING FOR A FULL WORD OF ZEROS   00540000
*                   AT THE START OF THE BUFFER (AREA).                  00560000
         EJECT                                                          00580000
         USING *,15                                                     00600000
         B     START                                                    00603000
         DC    C'IECTTRNS'                                              00606000
         DC    CL8'&SYSDATE'                                            00609000
         DS    0F                                                       00612000
PATCH    DC    16C'TRNS'             PATCH AREA                         00615000
START    STM   DREG,NREG,28(SREG)       SAVE REGISTERS             000C 00620000
         LM    DREG,AREG,0(PREG)        LOAD PARAMTER LIST INTO REGS    00640000
         LA    CREG,255                 LOAD MAXIMUM COUNT              00660000
         LR    LREG,0                   LOAD GIVEN COUNT                00680000
         LTR   ZEROREG,ZEROREG         TEST COUNT REGISTER       A38564 00700002
         BZ    TRNS0Z                  IF ZERO EXIT              A38564 00720002
         BNM   TRNS0A                  IF NOT 'S' CODE,BRANCH    A38564 00740002
         LTR   DREG,DREG               TEST DCB ADDRESS          A38564 00760002
         BZ    TRNS0Z                  'S' CODE NEEDS DCB ADDR   A38564 00780002
         B     TRNS0D                  GO LOAD COUNT FROM DCB    A38564 00800002
TRNS0A   EQU   *                                               @ZA04193 00810000
         LTR   DREG,DREG            DCB ADDRESS PRESENT ?      @ZA04193 00820000
         BZ    TRNS0H                 BRANCH IF NO             @ZA04193 00830000
         TM    DCBBFTEK(DREG),DYNBFR    DYNAMIC BUFFERING?      YA01032 00850000
         BO    TRNS0E              YES, BRANCH                  YA01032 00860002
TRNS0H   EQU   *                                               @ZA04193 00865000
         SH    AREG,K4             NET ADR TO START OF AREA     YA01032 00870002
TRNS0F   LR    NREG,AREG           SAVE ADDR OF START OF AREA      000C 00872002
TRNS0B   SH    LREG,K256           SUB MAX COUNT                        00874002
         BNP   TRNS0C                   IF NEG OR ZERO, LAST TRNS  000A 00880000
         EX    CREG,TRNS0T              TRANSLATE                       00900000
         AH    AREG,K256                UPDATE ADDRESS             000A 00920000
         B     TRNS0B                   LOOP                            00940000
TRNS0C   AR    LREG,CREG                RESTORE COUNT                   00960000
         EX    LREG,TRNS0T              TRANSLATE                       00980000
         LTR   ZEROREG,ZEROREG          'S' CODE?               YA01032 01010002
         BM    TRNS0G                   YES, CONTINUE           YA01032 01040002
         LTR   DREG,DREG                TEST FOR DCB ADDR      @ZA12135 01043000
         BZ    TRNS0Z                   NO, EXIT               @ZA12135 01046000
         TM    DCBBFTEK(DREG),DYNBFR    DYNAMIC BUFFERING?      YA01032 01050002
         BZ    TRNS0Z                   NO, EXIT                YA01032 01060002
TRNS0G   EQU   *                                                YA01032 01070002
         CLC   1(3,NREG),K0             IS THIS LAST BUFFER        000C 01080015
         BE    TRNS0Z                   IF SO EXIT                      01100000
         L     AREG,0(NREG)             LOAD ADDRESS OF NEXT BUFFER000C 01120015
TRNS0D   LH    LREG,DCBBUFL(DREG)       LOAD COUNT FROM DCB             01140000
TRNS0E   SH    LREG,K4                  ADJUST FOR LINK FIELD           01160000
         B     TRNS0F                   LOOP                       000C 01180015
TRNS0T   TR    4(0,AREG),0(TREG)        TRNSLATE INSTRUCTION            01200000
TRNS0Z   LM    DREG,NREG,28(SREG)       RESTORE REGISTERS          000C 01220015
         BR    RETREG                   RETURN                          01240000
         SPACE 5                                                        01260000
K0       DC    F'0'                                                     01280000
K4       DC    H'4'                                                     01300000
K256     DC    H'256'                   MAXIMUM COUNT CONSTANT          01320000
DYNBFR   EQU   X'08'                    DYNAMIC BUFFERING IF ON         01340000
DCBBUFL  EQU   24                       OFFSET TO BUFFER LENGTH         01360000
DCBBFTEK EQU   32                                                       01380000
ZEROREG  EQU   0                       LENGTH REGISTER           A38564 01390002
         SPACE 5                                                        01400000
PREG     EQU   1                        PARAMETER REGISTER              01420000
DREG     EQU   2                        DCB ADDRESS                     01440000
TREG     EQU   3                        TRANSLATE TABLE ADDRESS         01460000
AREG     EQU   4                        AREA ADDRESS                    01480000
CREG     EQU   5                        MAXIMUM COUNT                   01500000
LREG     EQU   6                        TRANSLATE COUNT                 01520000
NREG     EQU   7                        AREA START ADDRESS         000C 01530015
SREG     EQU   13                       SAVE AREA ADDRESS IN USER'S PRG 01540000
RETREG   EQU   14                       RETURN REGISTER                 01560000
         END                                                            01580000
./  ADD  SSI=72210263,NAME=IEEC2740
         TITLE 'IEEC2740 - BTAM CONSOLE PROCESSOR FOR THE 2740 '        00200000
IEEC2740 CSECT                                                          00250000
         ENTRY IGCXX07B                                                 00300000
*********************************************************************** 00350000
*                                                                       00400000
* MODULE NAME:                                                          00450000
*    IEEC2740                                                           00500000
*                                                                       00550000
* DESCRIPTIVE NAME:                                                     00600000
*    BTAM CONSOLE PROCESSOR FOR THE 2740                                00650000
*                                                                       00700000
* COPYRIGHT:                                                            00750000
*    NONE                                                               00800000
*                                                                       00850000
* FUCTION:                                                              00900000
*    PERFORM THE BASIC FUNCTIONS FOR A 2740 IN A MULTIPLE CONSOLE       00950000
*    ENVIRONMENT:                                                       01000000
*        OPEN                                                           01050000
*        WRITE                                                          01100000
*        READ                                                           01150000
*        CLOSE                                                          01200000
*                                                                       01250000
* NOTES:                                                                01300000
*    DEPENDENCIES:                                                      01350000
*        THIS MODULE HAS CPU MODEL DEPENDENT TIMING LOOPS.              01400000
*    RESTRICTIONS:                                                      01450000
*        THIS MODULE IS FOR A 2740 CONSOLE IN MCS ONLY.                 01500000
*    REGISTER CONVENTIONS:                                              01550000
*        SEE 'REGISTER DEFINITION' BELOW.                               01600000
*    NOTES:                                                             01650000
*        THIS MODULE HAS HARD CODED MODEL CONTROL BLOCKS.               01700000
*                                                                       01750000
* PATCH LABEL:                                                          01800000
*    PACHAREA (420 BYTES)                                               01850000
*                                                                       01900000
* MODULE TYPE:                                                          01950000
*    PROCEDURE                                                          02000000
*    PROCESSOR:                                                         02050000
*        BAL                                                            02100000
*    MODULE SIZE:                                                       02150000
*        4272 BYTES                                                     02200000
*    ATTRIBUTES:                                                        02250000
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, LOCAL AND         02300000
*        CMS LOCKS HELD.                                                02350000
*                                                                       02400000
* ENTRY POINT:                                                          02450000
*    IEEC2740                                                           02500000
*    IGCXX07B                                                           02550000
*    PURPOSE:                                                           02600000
*        SEE 'FUNCTION'                                                 02650000
*    LINKAGE:                                                           02700000
*        FROM THE COMMUNICATIONS TASK VIA SVC 72                        02750000
*    INPUT:                                                             02800000
*        REG 1 = ADDRESS OF CXSA                                        02850000
*    OUTPUT:                                                            02900000
*        FOR OPEN                                                       02950000
*            A DEB IS ADDED TO THE DEB CHAIN OF THE COMM TASK TCB.      03000000
*            THE UCM ENTRY AND ITS CONTROL BLOCKS (DEB,DCB,ETC.)        03050000
*            ARE INITIALIZED FOR THE 2740.                              03100000
*            THE EIL (EVENT INDICATOR LIST) IS MODIFIED TO POINT TO AN  03150000
*            ECB FOR THE 2740.                                          03200000
*            BTAM MODULES ARE LOADED, IGG019MA, IGG019MB, AND IGG019M0, 03250000
*            AND IGG019MR.                                              03300000
*            THE LINE TO THE 2740 IS INITIALIZED USING EXCP.            03350000
*        FOR WRITE                                                      03400000
*            IF THE LINE TO THE 2740 HAS BEEN 'PREPARED' FOR            03450000
*            A PREVIOUS 'READ', IT IS RESET USING 'HALT I/O'.           03500000
*            A MESSAGE IS FOUND ON THE OUTPUT QUEUE, TRANSLATED         03550000
*            TO 2740 CODE, AND SENT TO THE 2740 USING THE BTAM          03600000
*            ROUTINE 'IGG019MA'.                                        03650000
*        FOR READ                                                       03700000
*            THE LINE TO THE 2740 IS 'PREPARED' FOR INPUT.              03750000
*            WHEN THE COMPLETE MESSAGE IS RECEIVED, IT IS               03800000
*            TRANSLATED TO EBCDIC AND SENT TO SVC 34.                   03850000
*        FOR CLOSE                                                      03900000
*            ALL OUTSTANDING MESSAGES ARE SENT.                         03950000
*            ALL OUTSTANDING REPLIES ARE RECEIVED.                      04000000
*            THE UCM ENTRY AND ITS CONTROL BLOCKS ARE DE-INITIALIZED.   04050000
*            THE DEB IS REMOVED FROM THE DEB CHAIN OF THE COMM          04100000
*            TASK'S TCB.                                                04150000
*            THE UCB IS SET SO IT CAN BE ALLOCATED TO ANOTHER           04200000
*            TASK IF REQUESTED.                                         04250000
*            THE BTAM MODULES ARE DELETED.                              04300000
*                                                                       04350000
* EXITS-NORMAL:                                                         04400000
*    RETURN VIA BR REG 14                                               04450000
*                                                                       04500000
* EXITS-ERROR:                                                          04550000
*    TO CONSOLE SWITCH BY BRANCH                                        04600000
*                                                                       04650000
* EXTERNAL REFERENCES:                                                  04700000
*    ROUTINES:                                                          04750000
*        IGG019MA (BTAM 'READ/WRITE')                                   04800000
*        SVC 34 (SYSTEM COMMAND HANDLER)                                04850000
*        SVC 16 (IOS PURGE I/O ROUTINE)                                 04900000
*        SVC 10 (GETMAIN/FREEMAIN)                                      04950000
*        SVC 8 (LOAD)                                                   05000000
*        SVC 9 (DELETE)                                                 05050000
*        SVC 43 (CIRB)                                                  05100000
*    DATA AREAS:                                                        05150000
*        ASMTRTAB - TO GENERATE TRANSLATE TABLES FOR 2740               05200000
*            INPUT AND OUTPUT.                                          05250000
*    CONTROL BLOCKS:                                                    05300000
*        DCB   (MAPPED BY DCBD)                                         05350000
*        DECB  (MAPPED BY IHADECB)                                      05400000
*        DEB   (MAPPED BY IEZDEB)                                       05450000
*        UCM   (MAPPED BY IEECUCM)                                      05500000
*        WQE   (MAPPED BY IHAWQE)                                       05550000
*        TCB   (MAPPED BY IKJTCB)                                       05600000
*        UCB   (MAPPED BY IEFUCBOB)                                     05650000
*        CQE   (MAPPED BY IHACTM)                                       05700000
*        CXSA  (MAPPED BY IHACTM)                                       05750000
*        IOB   (MAPPED BY IEZIOB)                                       05800000
*        IQE   (MAPPED BY IHAIQE)                                       05850000
*        IRB   (MAPPED BY IKJRB)                                        05900000
*        CVT PREFIX                                                     05950000
*                                                                       06000000
* TABLES AND WORKAREAS:                                                 06050000
*    DYNAMICALLY GOTTEN BUFFERS FOR READ AND WRITE DATA AREAS           06100000
*    DYNAMICALLY GOTTEN BUFFERS FOR I/O CONTROL BLOCKS                  06150000
*                                                                       06200000
* MACROS:                                                               06250000
*    GETMAIN                                                            06300000
*    LOAD                                                               06350000
*    CIRB                                                               06400000
*    WRITE                                                              06450000
*    NIL                                                                06500000
*    DELETE                                                             06550000
*    FREEMAIN                                                           06600000
*    READ                                                               06650000
*    SETLOCK                                                            06700000
*                                                                       06750000
* CHANGE ACTIVITY:                                                      06800000
*    YA01058  (IN BASE)                                                 06850000
*    YA01059  (IN BASE)                                                 06900000
*    YA01063  (IN BASE)                                                 06950000
*    YA01247  (IN BASE)                                                 07000000
*    YA00837  (IN BASE)                                                 07050000
*    YM02593  (9/25/73)                                                 07100000
*    YM04057  (10/1/73)                                                 07150000
*    YM04091  (11/7/73)                                                 07200000
*    YA02125  (11/7/73)                                                 07250000
*    YA02443  (11/7/73)                                                 07300000
*    YA02444  (COVERED BY YM04057 AND YM04091)                          07350000
*    YA02445  (11/7/73)                                                 07400000
*    YM04095  (11/15/73)                                                07450000
*    YM04096  (11/15/73)                                                07500000
*    YM05650  (2/7/74)                                                  07550000
*    YM05695  (2/28/74)                                                 07600000
*    YM07708  (3/26/74)                                                 07610000
*    ZA00515  (7/02/74)                                                 07620000
*    ZA00517  (8/13/74)                                                 07630000
*    AZ04651  (07/14/75)          AZ04667  (07/01/75)                   07635000
*    AZ14029  (09/14/76)          AZ17703  (03/15/77)                   07640000
*    AZ17713  (03/18/77)          G51CK02  (05/20/77)                   07645000
*********************************************************************** 07700000
         EJECT                                                          07750000
IGCXX07B EQU   *                                                        07800000
         LR    RBASE,RCODE         PROGRAM BASE                         07850000
         USING IEEC2740,RBASE                                           07900000
         B     BEGIN               BRANCH AROUD ID                      07910000
         DC    C'IEEC2740'         MODULE ID                            07920000
         DC    C'010579'           PTF NUMBER                           07925000
         DC    C'** MVS *'                                              07930000
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY                   07935000
         DS    0H                                                       07940000
BEGIN    EQU   *                                                        07942000
         LA    RBASE2,CONSTS       SET BASE FOR CONSTANT    LD @ZA00515 07944003
         USING CONSTS,RBASE2       CONSTANT ADDRESSABILITY  LD @ZA00515 07946003
         LR    RCXSATCB,RPARM      SAVE ADDR OF EXTENDED SAVE AREA      07950000
         USING CXSA,RCXSATCB                                            08000000
*                                                                     * 08050003
*        CSAXA WILL BE USED TO SAVE RETURN ADDRESS (BYTES 1,2,3)      * 08055003
*        HIGH ORDER BYTE OF CASXA (BYTE 0) WILL BE USED AS A FLAG     * 08060003
*        FOR GETLOCK AND SETFRR IN THE FOLLOWING MANNER:              * 08065003
*        CASXA+0 = X'80' LOCAL LOCK OBTAINED                          * 08070003
*                  X'40' CMS LOCK OBTAINED                            * 08075003
*                  X'20' FRR OBTAINED                                 * 08080003
*                                                                     * 08085003
         XC    CSAXA(L1),CSAXA     CLEAR LOCKS & FRR FLAGS  LD @ZA00515 08090003
         STCM  RLINK,L7,CSAXA+L1   SAVE RETURN ADDRESS      LD @ZA00515 08095003
         L     RUCME,CSAUCM        UCM ENTRY BASE                       08100000
         USING UCMLIST,RUCME                                            08150000
         L     RUCM,CSACTLM        UCM BASE BASE                        08200000
         USING UCM,RUCM                                         YM05695 08250000
         USING IHADCB,RDCB                                              08300000
         USING UCBOB,RUCB                                               08350000
         USING DEBBASIC,RDEB                                            08400000
         USING WQE,RWQE                                                 08450000
*                                                                     * 08452003
*        SET UP ESTAE ENVIROMENT                                      * 08454003
*                                                                     * 08456003
         ICM   RWORK1,L15,CSANPTR  GET RECOVERY AREA        LD @ZA00515 08458003
         BZ    NOESTAE             NOT THERE, BYPASS        LD @ZA00515 08460003
         USING PARMLIST,RWORK1     PARMLIST ADDRESSABILITY  LD @ZA00515 08462003
         LA    RWORK2,ERRORTRY     GET 2740 RECOVERY ADDR   LD @ZA00515 08464003
         C     RWORK2,PARMRTAD     OUR RETRY IN STACK       LD @ZA00515 08466003
         BE    NOESTAE             YES, LEAVE IT            LD @ZA00515 08468003
         MVC   CSANAME(L8),PARMRTAD SAVE RETRY & REGSAVE    LD @ZA00515 08470003
         ST    RWORK2,PARMRTAD     SAVE RETRY ADDRESS       LD @ZA00515 08472003
         DROP  RWORK1                                       LD @ZA00515 08474003
         USING UCBOB,RUCB          RE-BASE UCB              LD @ZA00515 08476003
NOESTAE  EQU   *                                            LD @ZA00515 08478003
*                                                                     * 08480003
*        ESTAE OR FRR RECOVERY WILL ENTER HERE FOR AN                 * 08482003
*        OPEN RETRY                                                   * 08484003
*                                                                     * 08486003
OPNRTRY  EQU   *                                            LD @ZA00515 08488003
         BAL   RCODE,GETLOCK       OBTAIN LOCAL AND CMS LOCKS   YM02593 08500000
         L     RUCB,UCMUCB         BASE UCB                     YM02593 08550000
         L     RDCB,UCMDCB         BASE DCB AND COMMON DSECT    YM04096 08600000
*                                  IF ZERO, IT WILL BE SET BY   YM04096 08650000
*                                  OPEN ROUTINE.                YM04096 08700000
         TM    UCMSTS,UCMTA        IS THIS AN OPEN REQUEST      YM02593 08750000
         BO    OPEN                YES                          YM02593 08800000
         LA    RDEB,CBDEB          BASE DEB                     YM02593 08850000
         BAL   RCODE,FREELOCK      RELEASE CMS AND LOCAL LOCKS  YM02593 08900000
         TM    UCMSTS,UCMCF        IS THIS A CLOSE REQUEST      YM02593 08950000
         BO    CLOSE               YES                          YM02593 09000000
         B     OTHER               CHECK FOR OTHER FUNCTIONS    YM02593 09050000
OPEN     EQU   *                                                        09100000
         NC    UCMDCB(L4),UCMDCB   CONSOLE ALREADY OPEN         YM02593 09150000
         BNZ   OPENEND             YES, DON'T OPEN AGAIN        YM02593 09200000
         BAL   RCODE,FREELOCK      RELEASE CMS AND LOCAL LOCKS  YM02593 09250000
         ICM   RWORK,L15,CSANPTR   GET RECOVERY AREA        LD @ZA00515 09258003
         BZ    NORCVRY             IF NONE, SKIP SET UP     LD @ZA00515 09266003
         USING PARMLIST,RWORK      PARMLIST ADDRESSABILITY  LD @ZA00515 09274003
         OI    PARMFTPT,OPENREQ    THIS IS AN OPEN REQUEST  LD @ZA00515 09282003
NORCVRY  EQU   *                                            LD @ZA00515 09290003
         GETMAIN R,LV=CBSIZ,SP=SUBPOOL                                  09300000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 09308003
         BZ    NORCVRY1            IF NONE, SKIP SET UP     LD @ZA00515 09316003
         ST    RPARM,UCMDCB        SAVE DCB ADDR FOR RCVRY  LD @ZA00515 09324003
         OI    PARMFTPT,GTMAINON   INDICATE GETMAIN DONE    LD @ZA00515 09332003
NORCVRY1 EQU   *                                            LD @ZA00515 09340003
         LR    RDCB,RPARM          ADDRESS OF AREA OBTAINED             09350000
         MVC   IHADCB(CBLEN1),DCB401   COPY MODEL CONTROL       YM02593 09400000
         MVC   IOBSTDRD(CBLEN2),IOB401   BLOCKS TO                      09450000
         MVC   SAVEAREA(CBLEN3),XSAVE   THIS NEW AREA           YM02593 09500000
         LA    RDEB,CBDEB          BASE DEB                             09550000
         LA    RWORK,DECB          POINTER TO DECB              YM02593 09600000
         ST    RWORK,IOBECBPT      STORE DECB ADDRESS                   09650000
         ST    RDCB,IOBDCBPT       STORE DCB ADDRESS                    09700000
         LA    RLINK,IOBCPA        POINT TO CHANNEL PROGRAM AREA        09750000
         ST    RLINK,IOBSTART      AND STORE IN IOB                     09800000
         ST    RDEB,DCBDEBAD       INITIALIZE DEB ADDRESS               09850000
         LA    RLINK,IOBLNTH       GET MY IOB LENGTH                    09900000
         LA    RPARM,IOBSTDRD      POINT TO IOB                         09950000
         SR    RPARM,RLINK         SUBTRACT FROM IOB ADDRESS            10000000
         IC    RLINK,DCBIOBAD      SAVE DCBDEVTP                        10050000
         ST    RPARM,DCBIOBAD      STORE IOB ADDRESS-LENGTH IN DCB      10100000
         STC   RLINK,DCBIOBAD      SAVE DCBDEVTP                        10150000
         ST    RDCB,DECDCBAD       INITIALIZE DCB ADDRESS IN DECB       10200000
         LA    RLINK,CBIRB         INITIALIZE IRB POINTER SLOT          10250000
         ST    RLINK,DEBIRBAD      IN DEB                               10300000
         LA    RLINK,APPVTAB       INITIALIZE AVT               YM02593 10350000
         IC    RPARM,DEBAPPAD      SAVE BYTE                    YM05695 10400000
         ST    RLINK,DEBAPPAD      IN DEB                               10450000
         STC   RPARM,DEBAPPAD      SAVE BYTE                    YM05695 10500000
         LA    RPARM,MESSAGE       ADDRESS OF MSG AREA          YM02593 10550000
         ST    RPARM,DECAREA       DATA AREA FOR DECB                   10600000
         L     RPARM,CVTPTR        POINT TO CVT                 YM04057 10650000
         USING CVTMAP,RPARM                                     YM04057 10700000
         L     RPARM,CVTSVDCB      GET SVCLIB DCB ADDR          YM04057 10750000
         DROP  RPARM                                            YM04057 10800000
         LOAD  EPLOC=MA,DCB=(1)    LOAD IGG019MA                YM04057 10850000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 10858003
         BZ    NORCVRY2            IF NONE, SKIP SET UP     LD @ZA00515 10866003
         OI    PARMFTPT,LOADMAON   INDICATE LOAD FOR        LD @ZA00515*10874003
                                   IGG019MA IS DONE         LD @ZA00515 10882003
NORCVRY2 EQU   *                                            LD @ZA00515 10890003
         IC    RPARM,DCBOFLGS      SAVE FLAGS                           10900000
         ST    RZERO,DCBREAD       STORE MA ADDRESS                     10950000
         STC   RPARM,DCBOFLGS      RESTORE FLAGS                        11000000
         L     RPARM,CVTPTR        POINT TO CVT                 YM04057 11050000
         USING CVTMAP,RPARM                                     YM04057 11100000
         L     RPARM,CVTSVDCB      GET SVCLIB DCB ADDR          YM04057 11150000
         DROP  RPARM                                            YM04057 11200000
         LOAD  EPLOC=MB,DCB=(1)    LOAD IGG019MB                YM04057 11250000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 11258003
         BZ    NORCVRY3            IF NONE, SKIP SET UP     LD @ZA00515 11266003
         OI    PARMFTPT,LOADMBON   INDICATE LOAD FOR        LD @ZA00515*11274003
                                   IGG019MB WAS DONE        LD @ZA00515 11282003
NORCVRY3 EQU   *                                            LD @ZA00515 11290003
         L     RPARM,DEBAPPAD      BASE VECTOR TABLE                    11300000
         USING DEBAVT,RPARM                                             11350000
         ST    RZERO,DEBCEA        STORE CHANNEL END APPENDAGE ADDR     11400000
         ST    RZERO,DEBXCEA       STORE ABNORMAL END APPENDAGE ADDR    11450000
         DROP RPARM                                                     11500000
         L     RPARM,CVTPTR        POINT TO CVT                 YM04091 11550000
         USING CVTMAP,RPARM                                     YM04091 11600000
         L     RPARM,CVTSVDCB      POINT TO SVCLIB DCB          YM04091 11650000
         DROP  RPARM                                            YM04091 11700000
         LOAD EPLOC=MR,DCB=(1)     LOAD IGG019MR                YM04091 11750000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 11758003
         BZ    NORCVRY4            IF NONE, SKIP SET UP     LD @ZA00515 11766003
         OI    PARMFTPT,LOADMRON   INDICATE LOAD FOR        LD @ZA00515*11774003
                                   IGG019MR WAS DONE        LD @ZA00515 11782003
NORCVRY4 EQU   *                                            LD @ZA00515 11790003
         CIRB  EP=(RZERO),KEY=SUPR,MODE=SUPR,STAB=(RE),WKAREA=5         11800000
         USING RBSECT,RPARM                                             11850000
         USING IQESECT,RLNTH                                            11900000
         LA    RLNTH,RBIQEWRK      ADDRESS OF IQE                       11950000
         ST    RLNTH,TEMP2         SAVE ADDRESS OF IQE                  12000000
         ST    RLNTH,RBNEXAV       SET POINTER TO IQE IN IRB            12050000
         XC    IQELNK(L8),IQELNK   ZERO IQELINK AND IQEPARM             12100000
         ST    RPARM,IQEIRB        IRB ADDRESS IN THIRD WORD            12150000
         MVI   IQESTAT2,ZERO       ZERO THESE FLAG BYTES                12200000
         MVI   IQEFLAGS,ZERO       DITTO                                12250000
         MVC   IQEDCB(L16),IQELNK   DUPLICATE SECOND 16 BYTES           12300000
         LA    RLNTH,IQEDCB        BASE SECOND 16                       12350000
         ST    RLNTH,RBIQEWRK      STORE IN IRB                         12400000
         DROP  RLNTH                                                    12450000
         L     RLNTH,DEBIRBAD      ADDRESS OF IRB POINTER               12500000
         ST    RPARM,ZERO(RLNTH)   STORE IRB ADDRESS                    12550000
         DROP  RPARM                                                    12600000
         LOAD  EPLOC=M0            LOAD IGG019M0                        12650000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 12658003
         BZ    NORCVRY5            IF NONE, SKIP SET UP     LD @ZA00515 12666003
         OI    PARMFTPT,LOADM0ON   INDICATE LOAD FOR        LD @ZA00515*12674003
                                   IGG019M0 WAS DONE        LD @ZA00515 12682003
NORCVRY5 EQU   *                                            LD @ZA00515 12690003
         L     RPARM,DCBREAD       PUT IGG019M0 IN THE                  12700000
         LA    RPARM,DEVIODIR(RPARM)                                    12750000
         ST    RPARM,CSAXB         'DEVICE I/O DIRECTORY' (IN           12800000
         USING IODIRECT,RPARM      BTAM R/W ROUTINE)                    12850000
OPENA    EQU   *                                                        12900000
         TM    IODEVTP,IOFULL      IS THE DIRECTORY FULL                12950000
         BO    ERRC1               YES, ERROR                 LD YM7708 13000000
         NC    IODEVTP(L4),IODEVTP   IS THIS ENTRY IN USE               13050000
         BZ    OPENB               NO, USE IT                           13100000
         CLC   IODEVTP,DCBDEVTP    DOES 2740 HAVE THE CHECKING FEATURE  13150000
         BE    OPENC               YES, USE IT AS IT IS                 13200000
         LA    RPARM,IONEXT        POINT TO NEXT ENTRY                  13250000
         B     OPENA               CHECK IT                             13300000
OPENB    EQU   *                                                        13350000
         ST    RZERO,IODEVMOD      SET FOR 2740 WITH CHECKING FEATURE   13400000
         MVC   IODEVTP,DCBDEVTP    INITIALIZE ENTRY                     13450000
OPENC    EQU   *                                                        13500000
         S     RPARM,CSAXB         FIND ENTRY DISPLACEMENT              13550000
         SRL   RPARM,DIVIDE4       COMPUTE TOTAL                        13600000
         STC   RPARM,DCBDEVTP      STORE IN DCB                         13650000
         BAL   RCODE,GETLOCK       OBTAIN LOCAL AND CMS LOCKS           13700000
         SR    RLNTH,RLNTH         CLEAR REG                    YM05650 13750000
         IC    RLNTH,UCMID         GET MY CONSOLE NUMBER        YM05650 13800000
         BCTR  RLNTH,ZERO          REDUCE BY ONE                YM05650 13850000
         SLL   RLNTH,MULT4         MULTIPLY BY EIL ENTRY SIZE   YM05650 13900000
         DROP  RPARM                                                    13950000
         L     RPARM,UCMLSTP       POINT TO EIL                         14000000
         USING UCMEIL,RPARM                                             14050000
         LA    RPARM,UCMIECBA      POINT TO FIRST EIL ENTRY     YM05650 14100000
         DROP  RPARM                                                    14150000
         AR    RPARM,RLNTH         POINT TO CORRECT ENTRY       YM05650 14200000
         LA    RWORK,DECB          POINTER TO DECB              YM02593 14250000
         IC    RZERO,ZERO(RPARM)   SAVE STOPPER                         14300000
         ST    RWORK,ZERO(RPARM)   YES, STORE ECB IN EIL                14350000
         STC   RZERO,ZERO(RPARM)   SAVE STOPPER                         14400000
OPEND    EQU   *                                                        14450000
         ST    RCXSATCB,TEMP1      SAVE XSA ADDRESS                     14500000
         DROP  RCXSATCB                                                 14550000
         L     RCXSATCB,UCMPXA     ADDRESS OF TCB                       14600000
         USING TCB,RCXSATCB                                             14650000
         ST    RCXSATCB,DEBTCBAD   SET THE DEB TCB ADDRESS              14700000
         L     RPARM,TCBDEB        POINT TO DEB CHAIN                   14750000
         ST    RDEB,TCBDEB         PUT THE DEB ON THE CHAIN             14800000
         IC    RZERO,DEBAMLNG      SAVE FLAGS                           14850000
         ST    RPARM,DEBDEBAD      SET FORWARD POINTER                  14900000
         STC   RZERO,DEBAMLNG      RESTORE FLAGS                        14950000
         IC    RZERO,DEBDCBAD      SAVE BYTE                    YM05695 15000000
         ST    RDCB,DEBDCBAD       PUT DCB ADDRESS IN DEB               15050000
         STC   RZERO,DEBDCBAD      SAVE BYTE                    YM05695 15100000
         ST    RUCB,DEBSUCBA       PUT UCB ADDRESS IN DEB               15150000
         MVC   DEBPRIOR,TCBDSP     SET DEB PRIORITY                     15200000
         MVZ   DEBPROTG,TCBPKF     SET DEB PROTECT KEY                  15250000
         L     RLNTH,TEMP2         PICK UP ADDRESS OF IQE               15300000
         ST    RCXSATCB,L12(RLNTH)   PUT TCB ADDRESS IN IQE             15350000
         DROP  RCXSATCB                                                 15400000
         USING CXSA,RCXSATCB                                            15450000
         L     RCXSATCB,TEMP1      RE-ESTABLISH BASE FOR XSA            15500000
         ST    RDCB,UCMDCB         SET THE DCB ADDR IN UCM              15550000
         LA    RWORK,DECB          GET ADDRESS OF DECB          YM02593 15600000
         ST    RWORK,UCMECB        PUT IT IN THE UCM                    15650000
         OI    UCMATR,UCMUF        SET 2740 AS ACTIVE                   15700000
         NI    UCMDEVC,ONES-UCMDEVB   PREPARE IS NOT IN PROGRESS        15750000
         OI    DCBOFLGS,OPENFL     SET DCB OPEN FOR 'LOPEN'             15800000
         MVI   DCBIFLGS,ZERO       ZERO IFLGS FOR 'LOPEN'               15850000
         NI    IOBINCAM,X7F        CLEAR SAD/ENABLE FAIL                15900000
         TM    IOBINCAM,IOBINUSE   IS IOB BUSY                          15950000
         BO    ERRC                YES, SWITCH                          16000000
         BAL   RCODE,FREELOCK      RELEASE CMS & LOCAL LOCKS            16050000
         OI    IOBINCAM,IOBINUSE   SET IOB AS BUSY                      16100000
         LA    RMSG,IOBCPA         POINT TO CHANNEL PGM AREA            16150000
         MVC   ZERO(L8,RMSG),DISABLE   MOVE IN DISABLE CCW              16200000
         LA    RMSG,L8(RMSG)       POINT TO NEXT CCW SLOT               16250000
         TM    UCBTYP+L3,CU0103    IS CONTROL UNIT 2701 OR 2703         16300000
         BO    OPENF               YES, DO NOT ISSUE SAD                16350000
         SR    RLNTH,RLNTH         CLEAR REG                            16400000
         IC    RLNTH,UCBTYP+L1     INSERT SAD CODE                      16450000
         N     RLNTH,ANDMASK       CLEAR UNUSED BITS                    16500000
         IC    RLNTH,SADCODE(RLNTH)   GET SAD COMMAND CODE              16550000
         STC   RLNTH,ZERO(RMSG)    STORE IN CCW                         16600000
         MVC   L1(L7,RMSG),CCWCONST   MOVE IN REMAINDER OF CCW          16650000
         LA    RMSG,L8(RMSG)       POINT TO NEXT CCW SLOT               16700000
OPENF    EQU   *                                                        16750000
         MVC   ZERO(L8,RMSG),ENABLE   MOVE IN ENABLE                    16800000
         NI    DECSDECB,ONES-X7E   CLEAR ECB                            16850000
         LA    RPARM,IOBSTDRD      POINT TO IOB FOR EXCP                16900000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 16910003
         BZ    NORCVRY6            IF NONE, SKIP SET UP     LD @ZA00515 16920003
         OI    PARMFTPT,IOSTART    INDICATE START I/O       LD @ZA00515 16930003
NORCVRY6 EQU   *                                            LD @ZA00515 16940003
         EXCP  (1)                                                      16950000
         TIME  DEC                                                      17000000
         L     RCODE,CVTPTR        POINT TO CVT                         17050000
         SH    RCODE,HSIX          POINT TO CPU MODEL ID                17100000
         CLC   ZERO(L2,RCODE),MOD145   MODEL 145                        17150000
         BE    IS145               YES                                  17200000
         CLC   ZERO(L2,RCODE),MOD155   MODEL 155                        17250000
         BE    IS155               YES                                  17300000
         CLC   ZERO(L2,RCODE),MOD158   MODEL 158            LD @ZA00517 17310000
         BE    IS158               YES                      LD @ZA00517 17320000
         CLC   ZERO(L2,RCODE),MOD165   MODEL 165                        17350000
         BE    IS165               YES                                  17400000
         CLC   ZERO(L2,RCODE),MOD168   MODEL 168            LD @ZA00517 17410000
         BE    IS168               YES                      LD @ZA00517 17420000
         CLC   ZERO(L2,RCODE),MOD3031  MODEL 3031              @G51CK02 17422000
         BE    IS3031              YES                         @G51CK02 17424000
         CLC   ZERO(L2,RCODE),MOD3032  MODEL 3032              @G51CK02 17426000
         BE    IS3032              YES                         @G51CK02 17428000
         CLC   ZERO(L2,RCODE),MOD3033  MODEL 3033              @G51CK02 17430000
         B     IS3033              YES OR ASSUME 3033          @G51CK02 17432000
  SPACE 1                                                               17434000
*                                  NEW MODEL TESTS SHOULD BE INSERTED   17436000
*                                  HERE                                 17438000
  SPACE 2                                                               17440000
IS145    EQU   *                                                        17442000
         L     RCODE,TIME145       LOAD LOOP COUNT                      17444000
         B     TIMELOOP            DO LOOP                              17446000
IS155    EQU   *                                                        17448000
IS158    EQU   *                                            LD @ZA00517 17450000
         L     RCODE,TIME155       LOAD LOOP COUNT                      17452000
         B     TIMELOOP            DO LOOP                              17454000
IS165    EQU   *                                                        17456000
IS168    EQU   *                                            LD @ZA00517 17458000
         L     RCODE,TIME165       LOAD LOOP COUNT                      17460000
         B     TIMELOOP            DO LOOP                              17462000
IS3031   EQU   *                                               @G51CK02 17464000
         L     RCODE,TIME3031      LOAD LOOP COUNT             @G51CK02 17466000
         B     TIMELOOP            DO LOOP                     @G51CK02 17468000
IS3032   EQU   *                                               @G51CK02 17470000
         L     RCODE,TIME3032      LOAD LOOP COUNT             @G51CK02 17472000
         B     TIMELOOP            DO LOOP                     @G51CK02 17474000
IS3033   EQU   *                                               @G51CK02 17476000
         L     RCODE,TIME3033      LOAD LOOP COUNT             @G51CK02 17478000
         B     TIMELOOP            DO LOOP                     @G51CK02 17480000
  SPACE 2                                                               17482000
TIMELOOP EQU   *                                                        17650000
         TM    DECSDECB,X7E        I/O COMPLETED            LD @ZA00515 17700003
         BO    OPENK               YES, EXIT LOOP                       17750000
         BCT   RCODE,TIMELOOP      LOOP 5 SECONDS                       17800000
         B     OPENK               EXIT                                 17850000
  SPACE 2                                                               18150000
OPENK    EQU   *                                                        18200000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 18201003
         BZ    NORCVRY7            IF NONE, SKIP SET UP     LD @ZA00515 18202003
         NI    PARMFTPT,IOEND      INDICATE I/O WAS         LD @ZA00515*18203003
                                   SUCCESSFUL               LD @ZA00515 18204003
NORCVRY7 EQU   *                                            LD @ZA00515 18205003
         BAL   RCODE,GETLOCK       OBTAIN LOCAL & CMS LOCKS             18210000
         NI    UCMSTS,ONES-UCMBF   THE 2740 IS NOT BUSY                 18250000
         TM    DECSDECB,X7E        GOOD COMPLETION                      18300000
         BNO   ERRC                NO, SWITCH                           18350000
         NI    UCMDEVC,ONES-UCMDEVE   RESET I/O COMPLETE                18400000
         MVI   DECTYPE+L1,ONES     INDICATE BREAK                       18450000
         NI    UCMSTS,ONES-UCMTA   OPEN HAS BEEN PERFORMED              18500000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 18510003
         BZ    NORCVRY8            IF NONE, SKIP SET UP     LD @ZA00515 18520003
         NI    PARMFTPT,OPENOFF    SAME IN PARMLIST         LD @ZA00515 18530003
NORCVRY8 EQU   *                                            LD @ZA00515 18540003
         B     OTHER1              CHECK FOR OTHER FUNCTIONS            18550000
OPENEND  EQU   *                                                        18600000
         NI    UCMSTS,ONES-UCMTA   OPEN HAS BEEN PERFORMED              18650000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 18658003
         BZ    NORCVRY9            IF NONE, SKIP SET UP     LD @ZA00515 18666003
         NI    PARMFTPT,OPENOFF    SAME IN PARMLIST         LD @ZA00515 18674003
         DROP  RWORK                                        LD @ZA00515 18682003
NORCVRY9 EQU   *                                            LD @ZA00515 18690003
         B     RET                 RETURN                               18700000
OTHER    EQU   *                                                        18750000
         BAL   RCODE,GETLOCK       OBTAIN LOCAL AND CMS LOCKS           18800000
OTHER1   EQU   *                                                        18850000
         TM    UCMDEVC,UCMDEVE     HAS AN I/O OPERATION JUST COMPLETED  18900000
         BNO   OUTP                NO, CHECK FOR OTHER FUNCTIONS        18950000
         NI    UCMSTS,ONES-UCMBF   THE 2740 IS NOT BUSY                 19000000
         NI    UCMDEVC,ONES-UCMDEVE   TURN OFF I/O COMPLETE             19050000
         TM    DCBTIOT,TRMRESET    IOCMP ON RESET MESSAGE               19100000
         BO    ERRA                YES                                  19150000
         TM    UCMDEVC,UCMDEVB+UCMDEVG   IS IT I/O FROM A WRITE         19200000
         BZ    WRITE               YES, MIXED FALLS THROUGH             19250000
         BO    READ                CHECK OTHER FUNCTIONS                19300000
         TM    UCMDEVC,UCMDEVB     IS IT I/O FROM READ                  19350000
         BO    READA               YES                                  19400000
READ     EQU   *                                                        19450000
         NI    UCMDEVC,ONES-UCMDEVG-UCMDEVB  RESET PREPARE AND HALTIO   19500000
         B     OUTP                OUTPUT AFTER HALTIO                  19550000
READA    EQU   *                                                        19600000
         NI    UCMDEVC,ONES-UCMDEVB   RESET PREPARE IN PROGRESS         19650000
         TM    DECSDECB,X7E        GOOD COMPLETION                      19700000
         BNO   ERR                 NO, SWITCH                           19750000
         NI    DCBTIOT,ONES-BIDHIT-RETRIED    RESET DCB FLAGS           19800000
         TR    MESSAGE,IECTRC40    TRANSLATE INPUT TO EBCDIC            19850000
         MVI   MESSAGE+L'MESSAGE-L1,EOB   FORCE EOB                     19900000
         LA    RPARM,MESSAGE       POINT TO MESSGAE                     19950000
         LR    RZERO,RPARM         AGAIN                                20000000
READB    EQU   *                                                        20050000
         CLI   ZERO(RPARM),EOT     EOT FOUND                            20100000
         BE    OUTP                YES                                  20150000
         CLI   ZERO(RPARM),BSP     BACKSPACE FOUND                      20200000
         BNE   READC               NO, CHECK FOR EOB                    20250000
         CLI   L1(RPARM),RTRN      YES, IS IT FOR A CANCEL FUNCTION     20300000
         BE    OUTP                YES, CHECK FOR OUTPUT                20350000
         LR    RLINK,RPARM         NO, BACKSPACE MESSAGE                20400000
         BCTR  RLINK,ZERO                                               20450000
         CR    RLINK,RZERO         START OF MESSAGE AREA                20500000
         BL    OUTP                YES, CANCEL MESSAGE                  20550000
         SR    RPARM,RZERO         CALCULATE THE                        20600000
         LNR   RPARM,RPARM         REMAINING BUFFER LENGTH              20650000
         LA    RPARM,PARTLNTH(RPARM)                                    20700000
         EX    RPARM,BKSPCMVC      BACKSPACE 2 SPACES                   20750000
         LR    RPARM,RLINK         RESET THE SCAN POINTER               20800000
         B     READB               LOOK AT NEXT CHARACTER               20850000
READC    EQU   *                                                        20900000
         CLI   ZERO(RPARM),EOB     ARE WE AT THE END OF MSG             20950000
         BE    READF               YES                                  21000000
         CLI   ZERO(RPARM),RTRN    IS THE CHAR CARRIAGE RETURN          21050000
         BNE   READE               NO                                   21100000
         MVI   ZERO(RPARM),BLANK   CHANGE IT TO BLANK                   21150000
READE    EQU   *                                                        21200000
         LA    RPARM,L1(RPARM)     BUMP TO NEXT CHARACTER               21250000
         B     READB               LOOK AT THE NEXT CHARACTER           21300000
READF    EQU   *                                                        21350000
         MVI   ZERO(RPARM),BLANK   CHANGE IT TO BLANK                   21400000
         SR    RPARM,RZERO         COMPUTE LENGTH                       21450000
         LA    RPARM,L4(RPARM)     OF MESSAGE                           21500000
         STH   RPARM,MESSLNTH      PREPARE THE MSG FOR                  21550000
         SR    RZERO,RZERO         CLEAR REG                            21600000
         IC    RZERO,UCMID         TELL SVC 34 ITS FROM ME              21650000
         LA    RPARM,MSG           BASE PARAMETER LIST          YM02593 21700000
         BAL   RCODE,FREELOCK      RELEASE CMS & LOCAL LOCKS            21750000
         SVC   34                  GIVE COMMAND TO SYSTEM               21800000
         B     OUTPB               CONTINUE TERMINAL OPERATIONS         21850000
WRITE    EQU   *                                                        21900000
         L     RPARM,UCMWLAST      POINT TO QUEUE ENTRY WRITTEN         21950000
         USING CQEWQE,RPARM                                             22000000
         TM    DECSDECB,X7E        GOOD COMPLETION                      22050000
         BNO   ERRB                NO, SWITCH                           22100000
         NI    DCBTIOT,ONES-RETRIED-WREOT   RESET DCB FLAGS             22150000
         CLI   DECTYPE+L1,WRRESET   COMPLETE ON WR EOT                  22200000
         BNE   WRITA               NO, SET WQE USED                     22250000
         MVI   DECTYPE+L1,ONES     SET BREAK                            22300000
         B     OUTPB               CONTINUE OPERATIONS                  22350000
WRITA    EQU   *                                                        22400000
         TM    CQEFLAG,CQEMAJOR    WAS WRITE PERFORMED ON MLWTO         22450000
         BO    WRITD               YES                                  22500000
WRITB    EQU   *                                                        22550000
         OI    CQEFLAG,CQEAVAIL    DEQUEUE FROM THIS CONSOLE            22600000
         NI    CQEFLAG,ONES-CQEENTR   NO LONGER VALID                   22650000
         OI    UCMSTS,UCMTB        DEQUEUE WORK TO BE DONE              22700000
WRITC    EQU   *                                                        22750000
         CLI   DECRESPN+1,SPACE    OPERATOR ATTENTION                   22800000
         BNE   OUTPB               NO, WRITE ANOTHER                    22850000
         OI    DCBTIOT,BIDHIT      OPERATOR WANTS IN                    22900000
         B     PREP                SET UP FOR READ                      22950000
WRITD    EQU   *                                                        23000000
         NC    UCMMLAST(L4),UCMMLAST   MINOR JUST WRITTEN               23050000
         BNZ   WRITG               YES                                  23100000
         L     RWQE,CQEWQE         MAJOR POINTER                        23150000
         TM    WMJMLTYP,WMJMLTYD   END INDICATOR IN MAJOR               23200000
         BO    WRITJ               YES, SET UP FOR PURGE                23250000
         TM    WMJMMLW,WMJMMLWF    MINOR QUEUEING IN PROCESS            23300000
         BO    WRITK               YES, WAIT FOR IT                     23350000
WRITF    EQU   *                                                        23400000
         L     RWQE,CQEWQE         MAJOR POINTER                YA02445 23450000
         TM    WMJMMLW,WMJMMLWH    ANY MINOR TEXT EXISTS                23500000
         BO    WRITK               NO                                   23550000
         NI    CQEFLAG,ONES-CQEATTOP   STARTING NEW MINOR CHAIN         23600000
         MVC   UCMMLAST(L4),WMJMMIN   NEXT LINE TO BE WRITTEN           23650000
         B     WRITC               CHECK ATTN                           23700000
WRITG    EQU   *                                                        23750000
         L     RWQE,UCMMLAST       POINT TO MINOR WRITTEN               23800000
         SR    RLNTH,RLNTH         CLEAR REG                            23850000
         IC    RLNTH,WMNMUC1       GET USE COUNT                        23900000
         BCTR  RLNTH,RZERO         REDUCE BY ONE                        23950000
         STC   RLNTH,WMNMUC1       STORE USE COUNT                      24000000
         LTR   RLNTH,RLNTH         USE COUNT = 0                        24050000
         BNZ   WRITH               NO                                   24100000
         L     RLNTH,CQEWQE        MAJOR POINTER                        24150000
         OI    L4(RLNTH),WMJMMLWG   TELL DEQ TO CHECK CHAIN             24200000
         OI    UCMSTS,UCMTB        TELL DEQ TO CHECK MY QUEUE           24250000
WRITH    EQU   *                                                        24300000
         TM    WMNMLT1,WMNMLT1D    END INDICATOR IN THIS LINE           24350000
         BO    WRITJ               YES, PURGE                           24400000
WRITI    EQU   *                                                        24450000
         NC    WMNMNX1(L3),WMNMNX1   NEXT LINE EXIST                    24500000
         BZ    WRITK               NO                                   24550000
         L     RLNTH,WMNMUC1       POINT TO NEXT MINOR                  24600000
         LA    RLNTH,ZERO(RLNTH)   CLEAR OUT USE COUNT                  24650000
         NC    L5(L2,RLNTH),L5(RLNTH)   NEXT LINE TYPE FILLED IN        24700000
         BZ    WRITK               NO, WAIT FOR IT                      24750000
         MVC   UCMMLAST+L1(L3),WMNMNX1   NEXT LINE TO WRITE             24800000
         B     WRITC               CHECK ATTN                           24850000
WRITJ    EQU   *                                                        24900000
         NI    UCMSTS,ONES-UCMTC   NO LONGER WORKING ON MLWTO           24950000
         B     WRITB               COMPLETE PURGE                       25000000
WRITK    EQU   *                                                        25050000
         NI    UCMSTS,ONES-UCMPF   NO MORE OUTPUT UNTIL WE RECEIVE      25100000
*                                  ANOTHER MLWTO LINE                   25150000
         OI    UCMSDS5,UCMSDS5A    WAITING ON AN MLWTO                  25200000
         B     PREP                PUT UP READ                          25250000
WRITL    EQU   *                                                        25300000
         L     RPARM,UCMWLAST      CURRENT OUTQ ENTRY                   25350000
         NI    UCMSDS5,ONES-UCMSDS5A   TURN OFF WAITING BIT             25400000
         NC    UCMMLAST(L4),UCMMLAST   WAS LAST WRITE FOR MINOR         25450000
         BZ    WRITM               NO                                   25500000
         TM    CQEFLAG,CQEATTOP    HAS MINOR CHAIN BEEN RORDERED        25550000
         BO    WRITF               YES, START WITH FIRST MINOR          25600000
         L     RWQE,UCMMLAST       BASE WQE                             25650000
         B     WRITI               GET NEW LINE PTR                     25700000
WRITM    EQU   *                                                        25750000
         L     RWQE,CQEWQE         CURRENT WQE                          25800000
         B     WRITF               GET NEXT LINE                        25850000
OUTP     EQU   *                                                        25900000
         TM    UCMSTS,UCMPF        IS THERE OUTPUT PENDING              25950000
         BNO   PREP                NO, SET UP FOR READ                  26000000
         TM    DCBTIOT,PURGE       IS PURGE IN PROCESS                  26050000
         BNO   OUTPA               NO, CONTINUE                         26100000
         CLI   DECSDECB,X48        IS PURGE COMPLETE                    26150000
         BNE   RET                 NO, EXIT                             26200000
OUTPA    EQU   *                                                        26250000
         TM    UCMDEVC,UCMDEVB     YES, IS PREPARE IN PROGRESS          26300000
         BO    HALT                YES, HALT PREPARE                    26350000
OUTPB    EQU   *                                                        26400000
         TM    UCMSDS5,UCMSDS5A    WERE WE WAITING ON AN MLWTO          26450000
         BO    WRITL               YES, CONTINUE WITH WRITE             26500000
         TM    UCMSTS,UCMTC        WORKING ON MLWTO                     26550000
         BO    OUTPQ               YES, WRITE LINE                      26600000
         L     RPARM,UCMOUTQ       IS THERE ANYTHING                    26650000
         LTR   RPARM,RPARM         IN THE OUTPUT QUEUE                  26700000
         BZ    PREP                NO, SET UP FOR READ                  26750000
OUTPC    EQU   *                                                        26800000
         TM    CQEFLAG,CQEENTR     VALID ENTRY                          26850000
         BO    OUTPG               YES, SET UP FOR WRITE                26900000
OUTPD    EQU   *                                                        26950000
         TM    CQEFLAG,CQEEOB      POINTER TO NEXT BLOCK                27000000
         BO    OUTPE               YES                                  27050000
         BZ    OUTPF               THIS IS A NULL ENTRY                 27100000
         NI    UCMSTS,ONES-UCMPF   TURN OFF OUTPUT PENDING              27150000
         B     PREP                SET UP FOR READ                      27200000
OUTPE    EQU   *                                                        27250000
         L     RPARM,CQEWQE        POINT TO NEXT BLOCK                  27300000
         LA    RPARM,ZERO(RPARM)   CLEAR OUT FLAGS                      27350000
         B     OUTPC               TRY THE NEXT ENTRY                   27400000
OUTPF    EQU   *                                                        27450000
         LA    RPARM,CQEWQE+L4     POINT TO NEXT ENTRY                  27500000
         B     OUTPC               CHECK IT                             27550000
OUTPG    EQU   *                                                        27600000
         L     RWQE,CQEWQE         GET WQE                              27650000
         TM    CQEFLAG,CQEMLQHC    IS IT QUEUED FOR HARDCOPY            27700000
         BNO   OUTPH               NO                                   27750000
         TM    WQEXA,WQEPURGE      PURGE BIT OFF                        27800000
         BNO   OUTPI               YES, PUT IT OUT                      27850000
         TM    WQEAVAIL,WQEBUFC    NO, BUT IS IT READY FOR HARDCOPY     27900000
         BO    OUTPI               YES, PUT IT OUT                      27950000
         B     OUTPP               NO, DEQUEUE IT                       28000000
OUTPH    EQU   *                                                        28050000
         TM    WQEXA,WQEPURGE      IS THIS MSG TO BE PURGED             28100000
         BO    OUTPP               YES - DON'T WRITE IT                 28150000
         OI    WQEAVAIL,WQEBUFC    SHOW MSG READY FOR HARDCOPY          28200000
OUTPI    EQU   *                                                        28250000
         ST    RPARM,TEMP2         SAVE THAT ENTRY POINTER FOR MSG      28300000
         TM    CQEFLAG,CQEMAJOR    IS THIS ENTRY AN MLWTO               28350000
         BO    OUTPQ               YES, GO WRITE IT                     28400000
         L     RLNTH,WQENBR        PICK UP MSG LENTH                    28450000
         BCTR  RLNTH,ZERO          REDUCE FOR EXECUTE                   28500000
         TM    CQEFLAG,CQEMLQHC    REQUEST FOR HARDCOPY FORMAT          28550000
         BNO   OUTPJ               NO                                   28600000
         LA    RLNTH,L23(RLNTH)    BUMP FOR HARDCOPY TEXT               28650000
         LA    RPARM,WQERR         POINT TO HARDCOPY TEXT               28700000
         B     OUTPR               MOVE TEXT                            28750000
OUTPJ    EQU   *                                                        28800000
         TM    UCMDISP2,UCMDISPI   HASP TIMESTAMP AND JOBNAME           28850000
         BO    HASPBOTH            YES                                  28900000
         TM    UCMDISP2,UCMDISPJ   HASP JOBNAME ONLY                    28950000
         BO    HASPONE             YES                                  29000000
         LA    RPARM,WQETXT        POINT TO TEXT                        29050000
         B     OUTPR               MOVE IT                              29100000
HASPBOTH EQU   *                                                        29150000
         LA    RLNTH,L18(RLNTH)    BUMP FOR BOTH                        29200000
         LA    RPARM,WQETS         POINT TO TEXT                        29250000
         B     OUTPR               MOVE IT                              29300000
HASPONE  EQU   *                                                        29350000
         LA    RLNTH,L9(RLNTH)     BUMP FOR NAME                        29400000
         LA    RPARM,WQEJOBNM      POINT TO TEXT                        29450000
         B     OUTPR               MOVE IT                              29500000
OUTPK    EQU   *                                                        29550000
         LA    RLNTH,ZERO(RLNTH)                                        29600000
         LA    RPARM,L127          MAX CHARS 127                        29650000
         CR    RPARM,RLNTH         IF MSG LESS THAN 127                 29700000
         BH    OUTPL               BRANCH                               29750000
         LR    RLNTH,RPARM         MSG GREATER THAN 127                 29800000
OUTPL    EQU   *                                                        29850000
         LA    RPARM,MESSAGE(RLNTH)   SET RETURN EOB                    29900000
         MVC   ZERO(L'RETRNEOB,RPARM),RETRNEOB                          29950000
         TM    DECTYPE+L1,RST      IS BREAK NECESSARY                   30000000
         BO    OUTPM               CHECK UCB                            30050000
         MVI   DECTYPE+L1,WRCONT   NO, WRITE CONTINUE                   30100000
         B     OUTPO                                                    30150000
OUTPM    EQU   *                                                        30200000
         CLI   UCBTYP,T2740B       DO WE NEED BREAK                     30250000
         BE    OUTPN               YES, SET UP WRITE BREAK              30300000
         MVI   DECTYPE+L1,WRINIT   NO, SET UP WR INITIAL                30350000
         B     OUTPO                                                    30400000
OUTPN    EQU   *                                                        30450000
         MVI   DECTYPE+L1,WRBREAK   WRITE BREAK                         30500000
OUTPO    EQU   *                                                        30550000
         BAL   RCODE,FREELOCK      RELEASE CMS AND LOCAL LOCKS          30600000
         LA    ROPEN,SAVEAREA      REG SAVE AREA                        30650000
         LA    RLNTH,DECB          POINT TO DECB            LD @ZA00515 30700003
         WRITE (RLNTH),T,MF=E                               LD @ZA00515 30750003
         LR    RLNTH,RCODE                                              30800000
         BAL   RCODE,GETLOCK       OBTAIN LOCAL & CMS LOCKS             30850000
         LTR   RLNTH,RLNTH         TEST R/W RETURN CODE                 30900000
         BNZ   ERRC                BAD CODE, SWITCH                     30950000
         OI    UCMSTS,UCMBF        THE 2740 IS BUSY                     31000000
         TM    DCBTIOT,TRMRESET+WREOT   AVOID STORING WQE ADDR          31050000
         BNZ   RET                 YES, DIDN'T USE WQE                  31100000
         L     RPARM,TEMP2         GET SAVED WQE POINTER                31150000
         ST    RPARM,UCMWLAST      SAVE CURRENT MSG  POINTER ENTRY      31200000
         B     RET                 RETURN                               31250000
OUTPP    EQU   *                                                        31300000
         OI    UCMSTS,UCMTB        DEQUEUE REQUIRED                     31350000
         NI    CQEFLAG,ONES-CQEENTR   NO LONGER VALID                   31400000
         OI    CQEFLAG,CQEAVAIL    WQE IS TO BE DEQUEUED                31450000
         B     OUTPD               CHECK FOR END OF Q BLOCK             31500000
OUTPQ    EQU   *                                                        31550000
         SR    RLNTH,RLNTH         CLEAR REG                            31600000
         TM    UCMSTS,UCMTC        WORKING ON MLWTO                     31650000
         BO    OUTPT               YES, OLD WRITE                       31700000
         XC    UCMMLAST(L4),UCMMLAST   ZERO LAST MINOR POINTER          31750000
         OI    UCMSTS,UCMTC        NOW WORKING ON MLWTO                 31800000
         IC    RLNTH,WMJMTXTL+L1   GET TEXT LENGTH                      31850000
         BCTR  RLNTH,RZERO         REDUCE FOR EXECUTE                   31900000
         TM    CQEFLAG,CQEMLQHC    MLWTO FOR HARDCOPY                   31950000
         BO    OUTPS               YES, INCLUDE HARDCOPY TEXT           32000000
         TM    UCMDISP2,UCMDISPI   HASP TS AND JN                       32050000
         BO    HASMBOTH            YES                                  32100000
         TM    UCMDISP2,UCMDISPJ   HASP JN ONLY                         32150000
         BO    HASMONE             YES                                  32200000
         LA    RPARM,WMJMTXT       POINT TO TEXT                        32250000
         B     OUTPR               MOVEIT                               32300000
HASMBOTH EQU   *                                                        32350000
         LA    RLNTH,L18(RLNTH)    BUMP FOR BOTH                        32400000
         LA    RPARM,WMJMTS        POINT TO TEXT                        32450000
         B     OUTPR               MOVE IT                              32500000
HASMONE  EQU   *                                                        32550000
         LA    RLNTH,L9(RLNTH)     BUMP FOR NAME                        32600000
         LA    RPARM,WMJMJBNM      POINT TO TEXT                        32650000
OUTPR    EQU   *                                                        32700000
         EX    RLNTH,MOVETXT       MOVE TEXT TO MESSAGE AREA            32750000
         LA    RLNTH,L1(RLNTH)     RESTORE LENGTH                       32800000
         TR    MESSAGE,MODTABLE    TRANSLATE EBCDIC TO 2740             32850000
         B     OUTPK               COMPLETE SET UP                      32900000
OUTPS    EQU   *                                                        32950000
         LA    RLNTH,L23(RLNTH)    ADD TO LENGTH FOR HCTXT              33000000
         LA    RPARM,WMJMRR        POINT TO TEXT                        33050000
         B     OUTPR               MOVE IT                              33100000
OUTPT    EQU   *                                                        33150000
         L     RPARM,UCMWLAST      CURRENT OUTQ ENTRY                   33200000
         L     RWQE,UCMMLAST       POINT MINOR HALF                     33250000
         IC    RLNTH,WMNMTL1       GET LENGTH                           33300000
         LTR   RLNTH,RLNTH         LENGTH ZERO                          33350000
         BZ    WRITG               YES, HANDLE AS LAST OR END           33400000
         TM    CQEFLAG,CQEMLQHC    MLWTO FOR HARDCOPY                   33450000
         BO    OUTPU               YES                                  33500000
         BCTR  RLNTH,RZERO         REDUCE FOR EXECUTE                   33550000
         LA    RPARM,WMNMTXT1      POINT TO TEXT                        33600000
         B     OUTPR               MOVE IT                              33650000
OUTPU    EQU   *                                                        33700000
         LA    RPARM,WMNMHCT1      TEXT POINTER                         33750000
         LA    RLNTH,L3(RLNTH)     ADD TO TEXT LENGTH FOR HCTXT         33800000
         B     OUTPR               MOVE IT                              33850000
         DROP  RPARM                                                    33900000
CLOSE    EQU   *                                                        33950000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 33957003
         BZ    NORCVRY0            IF NONE, SKIP SET UP     LD @ZA00515 33964003
         USING PARMLIST,RWORK      PARMLIST ADDRESSABILITY  LD @ZA00515 33971003
         OI    PARMFTPT,CLOSEREQ   THIS IS A CLOSE REQUEST  LD @ZA00515 33978003
         DROP  RWORK                                        LD @ZA00515 33985003
NORCVRY0 EQU   *                                            LD @ZA00515 33992003
         TM    DCBTIOT,PURGE       IS PURGE IN PROCESS                  34000000
         BNO   CLOSA               NO, CONTINUE                         34050000
         CLI   DECSDECB,X48        IS PURGE COMPLETE                    34100000
         BNE   RET                 NO, EXIT                             34150000
CLOSA    EQU   *                                                        34200000
         TM    UCMDEVC,UCMDEVB     PREPARE IN PROGRESS                  34250000
         BO    HALT1               YES                        LD YM7708 34300000
         TM    UCBFL1,UCBPOST      OPERATION IN PROGRESS                34350000
         BO    RET                 YES, INTERRUPT EXPECTED              34400000
         TM    IOBFLAG1,IOBERRTN   ERP IN CONTROL                       34450000
         BO    RET                 YES, ALLOW TO FINISH                 34500000
         L     RPARM,UCMOUTQ       ARE THERE ANY MSGS OR REPLIES        34550000
         LTR   RPARM,RPARM         OUTSTANDING                          34600000
         BZ    CLOSD               NO, CLOSE THE 2740                   34650000
CLOSB    EQU   *                                                        34700000
         USING CQEWQE,RPARM                                             34750000
         TM    CQEFLAG,CQEENTR     VALID ENTRY                          34800000
         BNO   CLOSB1              NO, CHECK FURTHER                    34850000
         OI    CQEFLAG,CQEAVAIL    DEQUEUE FROM THIS CONSOLE            34900000
         NI    CQEFLAG,ONES-CQEENTR   NO LONGER VALID                   34950000
         OI    UCMSTS,UCMTB        DEQUEUE WORK TO BE DONE              35000000
CLOSB1   EQU   *                                                        35050000
         TM    CQEFLAG,CQEEOB      POINTER TO NEXT BLOCK                35100000
         BM    CLOSD               NO, CLOSE THE 2740                   35150000
         BO    CLOSC               YES                                  35200000
         LA    RPARM,CQEWQE+L4     BUMP TO NEXT ENTRY                   35250000
         B     CLOSB               CHECK IT                             35300000
CLOSC    EQU   *                                                        35350000
         L     RPARM,CQEWQE        POINT TO NEXT BLOCK                  35400000
         B     CLOSB               TRY THE NEXT ENTRY                   35450000
         DROP  RPARM                                                    35500000
CLOSD    EQU   *                                                        35550000
         NI    UCMATR,ONES-UCMUF   THIS 2740 IS INACTIVE                35600000
         SR    RLNTH,RLNTH         CLEAR REG                    YM05650 35650000
         IC    RLNTH,UCMID         GET MY CONSOLE ID            YM05650 35700000
         BCTR  RLNTH,ZERO          REDUCE BY ONE                YM05650 35750000
         SLL   RLNTH,MULT4         MULTIPLY BY EIL ENTRY SIZE   YM05650 35800000
         L     RPARM,UCMLSTP       POINT TO EIL                         35850000
         USING UCMEIL,RPARM                                             35900000
         LA    RPARM,UCMIECBA      POINT TO FIRST EIL ENTRY     YM05650 35950000
         DROP  RPARM                                                    36000000
         AR    RPARM,RLNTH         POINT TO CORRECT ENTRY       YM05650 36050000
         IC    RZERO,ZERO(RPARM)   SAVE FLAGS                           36100000
         ST    RUCME,ZERO(RPARM)   RESET ENTRY                          36150000
         STC   RZERO,ZERO(RPARM)   RESTORE FLAGS                        36200000
CLOSF    EQU   *                                                        36250000
         TM    UCBSTAT,UCBCHGS     DEVICE GOING TO OFFLINE              36300000
         BNO   CLOSH               NO                                   36350000
         NIL   UCBSTAT,X'00',REF=UCBOB,WREGS=(RZERO,RLINK,RCODE)        36400000
         B     CLOSI               CONTINUE                             36450000
CLOSH    EQU   *                                                        36500000
         NIL   UCBSTAT,X'80',REF=UCBOB,WREGS=(RZERO,RLINK,RCODE)        36550000
CLOSI    EQU   *                                                        36600000
         ST    RCXSATCB,TEMP1                                   YM04095 36650000
         DROP  RCXSATCB                                         YM04095 36700000
         L     RCXSATCB,UCMPXA     POINT TO TCB                 YM04095 36750000
         USING TCB,RCXSATCB                                     YM04095 36800000
         LA    RDEB,CBDEB          POINT TO OUR DEB             YM02593 36850000
         L     RPARM,TCBDEB        POINT TO DEB OFF TCB QUEUE   YM04095 36900000
         LA    RPARM,0(RPARM)      CLEAR HI-ORDER BYTE         @ZA17703 36920000
         CR    RPARM,RDEB          IS OUR DEB FIRST             YM04095 36950000
         BNE   CLOSJ               NO                           YM04095 37000000
         MVC   TCBDEB(L4),DEBDEBAD   MAKE SECOND DEB FIRST DEB  YM04095 37050000
         B     CLOSK               CONTINUE                     YM04095 37100000
CLOSJ    EQU   *                                                YM04095 37150000
         DROP  RDEB                                             YM04095 37200000
         USING DEBBASIC,RPARM                                   YM04095 37250000
         LR    RCXSATCB,RPARM      SAVE THIS DEB POINTER        YM04095 37300000
         ICM   RPARM,L7,DEBDEBB    POINT TO NEXT DEB           @ZA04651 37350000
         CR    RPARM,RDEB          IS THIS OUR DEB              YM04095 37400000
         BNE   CLOSJ               NO, TRY THE NEXT DEB         YM04095 37450000
         MVC   L5(L3,RCXSATCB),DEBDEBAD+L1   RECHAIN DEB QUEUE  YM04095 37500000
CLOSK    EQU   *                                                YM04095 37550000
         DROP  RPARM                                            YM04095 37600000
         USING DEBBASIC,RDEB                                    YM04095 37650000
         DROP  RCXSATCB                                         YM04095 37700000
         USING CXSA,RCXSATCB                                    YM04095 37750000
         L     RCXSATCB,TEMP1      BASE CXSA                            37800000
         NI    UCMSTS,ONES-UCMCF-UCMBF   CLOSE PERFORMED, BUSY OFF      37850000
         SR    RLINK,RLINK         CLEAR DCB AND DECB ADDRESSES         37900000
         ST    RLINK,UCMDCB        IN UCM ENTRY                         37950000
         ST    RLINK,UCMECB                                             38000000
         BAL   RCODE,FREELOCK      RELEASE CMS & LOCAL LOCKS            38050000
DELETEM0 EQU   *                                            LD @ZA00515 38070003
         DELETE EPLOC=M0           DELETE IGG019MA                      38100000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 38110003
         BZ    NOESTAE0            IF NONE, SKIP SET UP     LD @ZA00515 38112003
         USING PARMLIST,RWORK      PARMLIST ADDRESSABILITY  LD @ZA00515 38114003
         NI    PARMFTPT,LOADM0OF   IGG019M0 DELETED         LD @ZA00515 38116003
NOESTAE0 EQU   *                                            LD @ZA00515 38118003
DELETEMR EQU   *                                            LD @ZA00515 38120003
         DELETE EPLOC=MR           DELETE 1GG019MB                      38150000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 38160003
         BZ    NOESTAE1            IF NONE, SKIP SET UP     LD @ZA00515 38162003
         NI    PARMFTPT,LOADMROF   IGG019MR DELETED         LD @ZA00515 38166003
NOESTAE1 EQU   *                                            LD @ZA00515 38168003
DELETEMB EQU   *                                            LD @ZA00515 38170003
         DELETE EPLOC=MB           DELETE IGG019M0                      38200000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 38210003
         BZ    NOESTAE2            IF NONE, SKIP SET UP     LD @ZA00515 38212003
         NI    PARMFTPT,LOADMBOF   IGG019MB DELETED         LD @ZA00515 38214003
NOESTAE2 EQU   *                                            LD @ZA00515 38216003
DELETEMA EQU   *                                            LD @ZA00515 38220003
         DELETE EPLOC=MA           DELETE IGG019MR                      38250000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 38260003
         BZ    NOESTAE3            IF NONE, SKIP SET UP     LD @ZA00515 38262003
         NI    PARMFTPT,LOADMAOF   IGG019MA DELETED         LD @ZA00515 38264003
NOESTAE3 EQU   *                                            LD @ZA00515 38266003
FREEMAIN EQU   *                                            LD @ZA00515 38270003
         FREEMAIN R,LV=CBSIZ,A=(RDCB),SP=SUBPOOL   FREE BUFFER          38300000
         ICM   RWORK,L15,CSANPTR   GET PTR TO RECOVERY AREA LD @ZA00515 38310003
         BZ    NOESTAE4            IF NONE, SKIP SET UP     LD @ZA00515 38320003
         NI    PARMFTPT,GTMAINOF   FREEMAIN DONE            LD @ZA00515 38330003
         DROP  RWORK                                        LD @ZA00515 38332003
NOESTAE4 EQU   *                                            LD @ZA00515 38340003
         B     RETA                LEAVE                                38350000
PREP     EQU   *                                                        38400000
         MVI   MESSAGE,X01         BLANK MESSAGE AREA PRIOR             38450000
         MVC   MESSAGE+1(L139),MESSAGE   TO READ                        38500000
         CLI   UCBTYP,T2740B       DO WE HAVE BREAK                     38550000
         BNE   PREPA               NO, ISSUE RD INITIAL                 38600000
         TM    DECTYPE+L1,RST      IS BREAK NECESSARY                   38650000
         BO    PREPB               YES                                  38700000
         TM    DCBTIOT,BIDHIT      OPERATOR WANTS IN                    38750000
         BO    PREPA               YES, DON'T USE BREAK                 38800000
         MVI   DECTYPE+L1,WRRESET   WRITE EOT OP TYPE                   38850000
         OI    DCBTIOT,WREOT       WE ARE WRITING EOT                   38900000
         B     OUTPO               GO TO ISSUE WRITE                    38950000
PREPA    EQU   *                                                        39000000
         MVI   DECTYPE+L1,RDINIT   READ INITIAL                         39050000
         B     PREPC                                                    39100000
PREPB    EQU   *                                                        39150000
         MVI   DECTYPE+L1,RDBREAK   READ INITIAL BREAK                  39200000
PREPC    EQU   *                                                        39250000
         BAL   RCODE,FREELOCK      RELEASE CMS & LOCAL LOCKS            39300000
         LA    ROPEN,SAVEAREA      REG SAVE AREA                        39350000
         LA    RLNTH,DECB          POINT TO DECB            LD @ZA00515 39400003
         READ  (RLNTH),T,MF=E                               LD @ZA00515 39450003
         LR    RLNTH,RCODE                                              39500000
         BAL   RCODE,GETLOCK       OBTAIN LOCAL & CMS LOCKS             39550000
         LTR   RLNTH,RLNTH         TEST R/W RETURN CODE                 39600000
         BNZ   ERRC                BAD CODE, SWITCH                     39650000
         OI    UCMSTS,UCMBF        THE 2740 IS BUSY                     39700000
         OI    UCMDEVC,UCMDEVB     PREPARE IS IN PROGRESS               39750000
         TM    DCBTIOT,BIDHIT      OPERATOR ATTN                        39800000
         BNO   RET                 NO                                   39850000
         MVI   DECRESPN,ZERO       YES, BLOCK WRITE                     39900000
         B     RET                 LEAVE                                39950000
HALT1    EQU   *                                              LD YM7708 39960000
         BAL   RCODE,GETLOCK       OBTAIN LOCAL AND CMS LOCKS LD YM7708 39970000
HALT     EQU   *                                                        40000000
         CLI   UCBID,ONES          VALID UCB                            40050000
         BNE   ERRC                NO, SWITCH                           40100000
         CLI   DECRESPN,ZERO       IS DATA BEING TRANSFERRED            40150000
         BE    RET                 YES, RETURN                          40200000
         OI    DCBTIOT,PURGE       SHOW PURGE IN PROCESS                40250000
         NI    UCMDEVC,ONES-UCMDEVB   TURN OFF PREPARE                  40300000
         OI    UCMSTS,UCMBF        DEVICE IS BUSY                       40350000
         OI    UCMDEVC,UCMDEVG     INDICATE HALT I/O IN PROCESS         40400000
         NI    IOBINCAM,ONES-IOBINUSE   IOB BUSY BIT OFF                40450000
         NI    IOBFLAG1,ONES-IOBERRTN-IOBIOERR   TURN OFF ERP FLAGS     40500000
         MVI   DECTYPE+L1,ONES     INDICATE BREAK                       40550000
         BAL   RCODE,FREELOCK      RELEASE CMS & LOCAL LOCKS            40600000
         LA    RPARM,CBPURGE       PURGE PARM LIST                      40650000
         LA    RDEB,CBDEB          POINT TO DEB                         40700000
         ST    RDEB,ZERO(RPARM)    DEB ADDRESS TO PARM LIST             40750000
         MVI   ZERO(RPARM),XE0     PURGE OPTIONS                        40800000
         L     RLINK,UCMPXA        PICK UP TCB ADDRESS                  40850000
         ST    RLINK,L4(RPARM)     AND PUT IT IN PARM LIST              40900000
         LA    RLNTH,IOBSTDRD      POINT TO IOB                 YM05650 40950000
         IC    RZERO,DEBUSRPG      SAVE EXLIST                  YM05695 41000000
         ST    RLNTH,DEBUSRPG      PUT IT IN PURGE SLOT         YM05650 41050000
         STC   RZERO,DEBUSRPG      SAVE EXLIST                  YM05695 41100000
         MVC   IOBRSTRB(L3),FOXFOX   SET AS LAST IOB            YM05650 41150000
         LA    RLNTH,DEBUSRPG      PURGE IOB CHAIN POINTER              41200000
         ST    RLNTH,L8(RPARM)     STORE IT                             41250000
         MVI   L8(RPARM),L1        SET FOR ONE I/O TO PURGE     YM05650 41300000
         SVC   16                  PURGE SVC                            41350000
         NI    IOBINCAM,ONES-IOBINUSE   IOB BUSY BIT OFF                41400000
         NI    IOBFLAG1,ONES-IOBERRTN-IOBIOERR   TURN OFF ERP FLAGS     41450000
         XC    IOBRSTRB(L3),IOBRSTRB   RESTORE IOBRSTR                  41500000
         MVI   DECTYPE+L1,ONES     INDICATE BREAK                       41550000
         NI    DCBTIOT,ONES-PURGE   SHOW PURGE COMPLETE                 41600000
         B     RETA                LEAVE                                41650000
RET      EQU   *                                                        41700000
         BAL   RCODE,FREELOCK      RELEASE CMS & LOCAL LOCKS            41750000
RETA     EQU   *                                                        41800000
         L     RLINK,CSAXA         RESTORE RETURN ADDRESS               41850000
RETURN   EQU   *                                                        41900000
         ICM   RWORK1,L15,CSANPTR  GET RECOVERY AREA        LD @ZA00515 41902003
         BZ    NOESTAE5            NOT THERE, BYPASS        LD @ZA00515 41904003
         USING PARMLIST,RWORK1     PARMLIST ADDRESSABILITY  LD @ZA00515 41906003
         MVC   PARMRTAD(L8),CSANAME RESTORE RETRY & REGSAVE LD @ZA00515 41908003
NOESTAE5 EQU   *                                            LD @ZA00515 41910003
         NI    PARMFTPT,CLOSEOFF   INDICATE CLOSE DONE      LD @ZA00515 41912003
         DROP  RWORK1                                                   41914003
         USING UCBOB,RUCB          RE-BASE UCB              LD @ZA00515 41916003
*                                                                     * 41918003
*        ADDRESS OF END-OF-EXTEND APPENDAGE RTN FOR AVR               * 41920003
*                                                                     * 41922003
DEBEOEAP EQU   *                                            LD @ZA00515 41924003
*                                                                     * 41926003
*        ADDRESS OF START I/O APPENDAGE RTN FOR AVT                   * 41928003
*                                                                     * 41930003
DEBSIOAP EQU   *                                            LD @ZA00515 41932003
*                                                                     * 41934003
*        ADDRESS OF PCI APPENDAGE RTN FOR AVT                         * 41936003
*                                                                     * 41938003
DEBPCIAP EQU   *                                            LD @ZA00515 41940003
         BR    RLINK               VIA THE ADDRESS IN REG 14            41950000
GETLOCK  EQU   *                                                        42000000
         STM   RUCME,RLINK,CSAXC   SAVE REGS USED BY SETLOCK            42050000
         TM    CSAXA,LOCALON       DO WE HAVE LOCAL LOCK    LD @ZA00515 42060003
         BNZ   TESTCMS             YES, DONT GET IT         LD @ZA00515 42070003
GETLOCL  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        X42100000
               RELATED=(WQE,IEEC2740(FREELOCL))                         42150000
         OI    CSAXA,LOCALON       SET LOCAL LOCK FLAG ON   LD @ZA00515 42160003
TESTCMS  EQU   *                                            LD @ZA00515 42170003
         TM    CSAXA,CMSON         DO EW HAVE CMS LOCK      LD @ZA00515 42180003
         BNZ   TESTFRR             YES, DONT GET IT         LD @ZA00515 42190003
GETCMS   SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                          X42200000
               RELATED=(UCM,IEEC2740(FREECMS))                          42250000
         OI    CSAXA,CMSON         SET CMS LOCK FLAG ON     LD @ZA00515 42252003
TESTFRR  EQU   *                                            LD @ZA00515 42254003
         TM    CSAXA,FRRON         DO EW HAVE FRR           LD @ZA00515 42256003
         BNZ   RESTORE1            YES, DONT GET IT         LD @ZA00515 42258003
         L     RFRRADD,UCMFRRAD    GET ADDR OF COMM FRR RTN LD @ZA00515 42260003
         USING PSA,RZERO           BASE THE PSA (ADDR=0)    LD @ZA00515 42262003
GETFRR   SETFRR A,FRRAD=(14),PARMAD=(13),WRKREGS=(12,13),              *42264003
               RELATED=(CMS-LOCK,IEEC2740(FREEFRR))         LD @ZA00515 42266003
         ST    RPARMADD,CSADCBP    SAVE FRR PARMLIST PTR    LD @ZA00515 42268003
         USING PARMLIST,RPARMADD   PARMLIST ADDRESSABILITY  LD @ZA00515 42270003
         ICM   RWORK3,L15,CSANPTR  GET ESTAE PARMLIST ADD   LD @ZA00515 42272003
         BZ    NOESTAE6            NO THERE, BYPASS         LD @ZA00515 42274003
         MVC   PARMLIST(PARMSIZE),ZERO(RWORK3) COPY ESTAE PARMLIST TO  *42276003
                                              FRR PARMLIST  LD @ZA00515 42278003
NOESTAE6 EQU   *                                            LD @ZA00515 42280003
         MVC   PARMID,SVC72ID      MOVE ID IN FOR RECOVERY  LD @ZA00515 42282003
         DROP  RPARMADD                                        @ZA14029 42283000
         OI    CSAXA,FRRON         SET FRR FLAD ON          LD @ZA00515 42284003
RESTORE1 EQU   *                                            LD @ZA00515 42286003
         LM    RUCME,RLINK,CSAXC   RESTORE REGS AFTER SETLOCK           42300000
         BR    RCODE               RETURN TO CALLER                     42350000
FREELOCK EQU   *                                                        42400000
         STM   RUCME,RLINK,CSAXC   SAVE REGS USED BY SETLOCK            42450000
         TM    CSAXA,FRRON         DO WQ HAVE FRR           LD @ZA00515 42454003
         BZ    CHECKCMS            NO, DONT FREE IT         LD @ZA00515 42458003
         USING PSA,RZERO           BASE THE PSA (ADDR=0)    LD @ZA00515 42462003
FREEFRR  SETFRR D,WRKREGS=(12,13),                                     *42466003
               RELATED=(CMS-LOCK,IEEC2740(GETFRR))          LD @ZA00515 42470003
         XC    CSADCBP,CSADCBP     ZERO PTR                 LD @ZA00515 42474003
         NI    CSAXA,FRROFF        SET FRR FLAG OFF         LD @ZA00515 42478003
CHECKCMS EQU   *                                            LD @ZA00515 42482003
         TM    CSAXA,CMSON         DO WE HAVE CMS LOCK      LD @ZA00515 42486003
         BZ    CHECKLCL            NO, DONT FREE IT         LD @ZA00515 42490003
FREECMS  SETLOCK RELEASE,TYPE=CMS,                                     X42500000
               RELATED=(UCM,IEEC2740(GETCMS))                           42550000
         NI    CSAXA,CMSOFF        SET CMS FLAG OFF         LD @ZA00515 42560003
CHECKLCL EQU   *                                            LD @ZA00515 42570003
         TM    CSAXA,LOCALON       DO WE HAVE LOCAL LOCK    LD @ZA00515 42580003
         BZ    RESTORE2            NO, RETURN TO CALLER     LD @ZA00515 42590003
FREELOCL SETLOCK RELEASE,TYPE=LOCAL,                                   X42600000
               RELATED=(WQE,IEEC2740(GETLOCL))                          42650000
         NI    CSAXA,LOCALOFF      SET LOCAL LOCK FLAG OFF  LD @ZA00515 42660003
RESTORE2 EQU   *                                            LD @ZA00515 42670003
         LM    RUCME,RLINK,CSAXC   RESTORE REGS AFTER SETLOCK           42700000
         BR    RCODE               RETURN TO CALLER                     42750000
ERR      EQU     *                                                      42800000
         CLI   UCBTYP,T2740B       DO WE HAVE BREAK                     42850000
         BNE   ERRC                NO, SWITCH                           42900000
         TM    DECSENS0,TIMEOUT    READ TIMEOUT                         42950000
         BNO   ERRB                NO, CHECK RETRY                      43000000
         MVC   MESSAGE(L34),TOERMSG   MOVE IN TIMEOUT MESSAGE           43050000
         OI    DCBTIOT,TRMRESET                                         43100000
         B     OUTPN               GO TO WRITE IT                       43150000
ERRA     EQU   *                                                        43200000
         NI    DCBTIOT,ONES-TRMRESET   AFTER IO COMPLETE ON WRITE       43250000
         TM    DECSDECB,X7E        GOOD COMPLETION                      43300000
         BNO   ERRC                NO, SWITCH                           43350000
         B     OUTP                                                     43400000
ERRB     EQU   *                                                        43450000
         CLI   UCBTYP,T2740B       DO WE HAVE BREAK                     43500000
         BNE   ERRC                NO, SWITCH                           43550000
         TM    DECSENS0,RETRYMSK   SHOULD WE RETRY AFTER                43600000
         BNZ   ERRC                THIS ERROR                           43650000
         TM    DCBTIOT,RETRIED     HAVE WE RETRIED                      43700000
         BO    ERRC                YES, SWITCH                          43750000
         MVI   DECTYPE+L1,ONES     NO, SET BREAK                        43800000
         OI    DCBTIOT,RETRIED     AND RETRY                            43850000
         OC    UCMMLAST,UCMMLAST   IS UCMLAST ZERO?            @ZA17713 43860000
         BNZ   OUTP                NO BRANCH                   @ZA17713 43870000
         NI    UCMSTS,ONES-UCMTC   TURN OFF INLINE WTO         @ZA17713 43880000
         B     OUTP                                                     43900000
ERRC1    EQU   *                                              LD YM7708 43910000
         BAL   RCODE,GETLOCK       OBTAIN LOCAL AND CMS LOCKS LD YM7708 43920000
ERRC     EQU   *                                                        43950000
         OI    UCMDEVC,UCMDEVCC    INDICATE CONSOLE SWITCH              44000000
         NI    UCMDEVC,ONES-UCMDEVCC-UCMDEVE-UCMDEVB   RESET ALL        44050000
         NI    UCMSTS,ONES-UCMTA-UCMBF   CNSLE FLGS FOR NO QUICK REOPEN 44100000
         BAL   RCODE,FREELOCK      RELEASE LOCKS              LD YM7708 44110000
         LR    RPARM,RCXSATCB      POINT TO CXSA                        44150000
         L     RLINK,CSAXA         SET RETURN ADDRESS                   44200000
         ICM   RWORK1,L15,CSANPTR  GET RECOVERY AREA        LD @ZA00515 44207003
         BZ    NOESTAE7            BOT THERE, BYPASS        LD @ZA00515 44214003
         USING PARMLIST,RWORK1     PARMLIST ADDRESSABILITY  LD @ZA00515 44221003
         MVC   PARMRTAD(L8),CSANAME RESTORE RETRY & REGSAVE LD @ZA00515 44228003
         DROP  RWORK1                                       LD @ZA00515 44235003
NOESTAE7 EQU   *                                            LD @ZA00515 44242003
         L     RCODE,UCMSWCH       ADDRESS OF CONSOLE SWITCH            44250000
         BR    RCODE               GO TO CONSOLE SWITCH                 44300000
         EJECT                                                          44350000
*                                                                     * 44350203
*                                                                     * 44350403
*        ESTAE RETRY ROUTINE FOR 2740'S                     LD @ZA00515 44350603
*                                                                     * 44350803
*                                                                     * 44351003
         SPACE 3                                                        44351203
ERRORTRY DS    0H                                           LD @ZA00515 44351403
         BALR  RTRYBASE,RZERO      SET SUBROUTINE BASE      LD @ZA00515 44351603
         USING *,RTRYBASE                                   LD @ZA00515 44351803
         L     RBASE,ADDR2740      RESET MAINLINE BASE      LD @ZA00515 44352003
         L     RBASE2,ADDRCONS     RESET CONSTANT BASE      LD @ZA00515 44352203
         USING PSA,RZERO           BASE PSA ON LOCATION 0   LD @ZA00515 44352403
         L     RWORK,PSATOLD       GET PTR TO MY TCB        LD @ZA00515 44352603
         DROP  RZERO                                        LD @ZA00515 44352803
         USING TCB,RWORK           TCB ADDRESSABILITY       LD @ZA00515 44353003
         L     RWORK,TCBRBP        GET PTR TO MY SVRB       LD @ZA00515 44353203
         DROP  RWORK                                        LD @ZA00515 44353403
         USING RBSECT,RWORK        RB ADDRESSABILITY        LD @ZA00515 44353603
         LA    RCXSATCB,RBEXSAVE   TELOAD CXSA BASE         LD @ZA00515 44353803
         DROP  RWORK                                        LD @ZA00515 44354003
         L     RLINK,FREERTN       ADDR OF FREELOCK RTN     LD @ZA00515 44354203
         BALR  RCODE,RLINK         GO FREE LOCKS IF ANY AND LD @ZA00515*44354403
                                   DELETE FRR               LD @ZA00515 44354603
         L     RWORK,CSANPTR       GET REVOVERY PARMLIST    LD @ZA00515 44354803
         USING PARMLIST,RWORK      PARMLIST ADDRESSABILITY  LD @ZA00515 44355003
         TM    PARMFTPT,OPENREQ    IS OPEN PENDING          LD @ZA00515 44355203
         BO    OPNRCVRY            YES GO TO SET UP RETRY   LD @ZA00515 44355403
         TM    PARMFTPT,CLOSEREQ   IS CLOSE PENDING         LD @ZA00515 44355603
         BO    CLSRCVRY            YES GO SET UP RETRY      LD @ZA00515 44355803
         SPACE 2                                                        44356003
*                                                                     * 44356203
*        ADDITIONAL RECOVERY WILL GO HERE                   LD @ZA00515 44356403
*                                                                     * 44356603
         SPACE 2                                                        44356803
SWTCHCSL EQU   *                                            LD @ZA00515 44357003
         L     RRTRN,SWTCHADR      SET FOR CONSOLE SWITCH   LD @ZA00515 44357203
         B     RETRY                                        LD @ZA00515 44357403
         EJECT                                                          44357603
*                                                                     * 44357803
*                                                                     * 44358003
*        OPEN RECOVERY SETUP SUBROUTINE                               * 44358203
*                                                                     * 44358403
*                                                                     * 44358603
         SPACE 2                                                        44358803
OPNRCVRY EQU   *                                            LD @ZA00515 44359003
         TM    PARMFTPT,IOSTART    I/O SUCCESSFUL?          LD @ZA00515 44359203
         BO    SWTCHCSL            NO SWITCH CONSOLE        LD @ZA00515 44359403
         TM    PARMFTPT,GTMAINON   WAS GETMAIN DONE         LD @ZA00515 44359603
         BO    CHECKLD             YES CHECK IF LOADS       LD @ZA00515*44359803
                                   WERE DONE                LD @ZA00515 44360003
         L     RRTRN,RTRYOPN       SET OPEN RETRY ADDREES   LD @ZA00515*44360203
                                   FROM BEGINNING           LD @ZA00515 44360403
         B     RETRY               GO TO RETRY              LD @ZA00515 44360603
         EJECT                                                          44360803
*                                                                     * 44361003
*                                                                     * 44361203
*        CLOSE RECOVERY SETUP SUBROUTINE                              * 44361403
*                                                                     * 44361603
*                                                                     * 44361803
         SPACE 2                                                        44362003
CLSRCVRY EQU   *                                            LD @ZA00515 44362203
         TM    PARMFTPT,GTMAINON   WAS FREEMAIN DONE        LD @ZA00515 44362403
         BO    CHECKLD1            NO, CHECK IF DELETES     LD @ZA00515*44362603
                                   DONE                     LD @ZA00515 44362803
         L     RRTRN,RTRYCLS       SET CLOSE RETRY ADDRESS  LD @ZA00515 44363003
         B     RETRY               GO TO RETRY              LD @ZA00515 44363203
         EJECT                                                          44363403
*                                                                     * 44363603
*                                                                     * 44363803
*        THIS SUBROUTINE WILL CHECK HOW MANY LOADS OR DELETES HAS     * 44364003
*        BEEN DONE. ACCORDINGLY WILL SET UP THE RETRY                 * 44364203
*                                                                     * 44364403
*                                                                     * 44364603
         SPACE 2                                                        44364803
CHECKLD  EQU   *                                            LD @ZA00515 44365003
         MVC   CSAXC,CSAXA         SAVE RTN ADDR FROM       LD @ZA00515*44365203
                                   MAINLINE                 LD @ZA00515 44365403
         LA    RLINK,RTNENTRY      SET NEW RETURN ADDR      LD @ZA00515 44365603
         ST    RLINK,CSAXA         FOR MAINLINE             LD @ZA00515 44365803
CHECKLD1 EQU   *                                            LD @ZA00515 44366003
         TM    PARMFTPT,LOADM0ON   IS IGG019M0 LOAD DONE    LD @ZA00515 44366203
         BZ    CHECKMR             NO, CHECK NEXT           LD @ZA00515 44366403
         L     RRTRN,M0DELETE      SET RETRY ADDR           LD @ZA00515 44366603
         B     RETRY1              RETRY                    LD @ZA00515 44366803
         SPACE 2                                                        44367003
CHECKMR  EQU   *                                            LD @ZA00515 44367203
         TM    PARMFTPT,LOADMRON   IS IGG019MR LOAD DONE    LD @ZA00515 44367403
         BZ    CHECKMB             NO, CHECK NEXT           LD @ZA00515 44367603
         L     RRTRN,MRDELETE      SET RETRY ADDRESS        LD @ZA00515 44367803
         B     RETRY1              GO TO RETRY              LD @ZA00515 44368003
         SPACE 2                                                        44368203
CHECKMB  EQU   *                                            LD @ZA00515 44368403
         TM    PARMFTPT,LOADMBON   IS IGG019MB LOAD DONE    LD @ZA00515 44368603
         BZ    CHECKMA             NO, CHECK NEXT           LD @ZA00515 44368803
         L     RRTRN,MBDELETE      SET RETRY ADDRESS        LD @ZA00515 44369003
         B     RETRY1              GO TO RETRY              LD @ZA00515 44369203
         SPACE 2                                                        44369403
CHECKMA  EQU   *                                            LD @ZA00515 44369603
         TM    PARMFTPT,LOADMAON   IS IGG019MA LOAD DONE    LD @ZA00515 44369803
         BZ    CONTINUE            NO, CONTINUE             LD @ZA00515 44370003
         L     RRTRN,MADELETE      SET RETRY ADDRESS        LD @ZA00515 44370203
         B     RETRY1              GO TO RETRY              LD @ZA00515 44370403
         SPACE 2                                                        44370603
CONTINUE EQU   *                                            LD @ZA00515 44370803
         L     RRTRN,FRMADDR       SET RETRY ADDRESS        LD @ZA00515 44371003
         B     RETRY1              GO TO RETRY              LD @ZA00515 44371203
         SPACE 2                                                        44371403
RTNENTRY EQU   *                                            LD @ZA00515 44371603
         MVC   CSAXA,CSAXC         RESTORE RETURN ADDREES   LD @ZA00515*44371803
                                   FOR MAINLINE             LD @ZA00515 44372003
         L     RRTRN,RTRYOPN       SET RETRY ADDRESS FOR    LD @ZA00515*44372203
                                   OPEN                     LD @ZA00515 44372403
         B     RETRY               GO TO RETRY              LD @ZA00515 44372603
         EJECT                                                          44372803
*                                                                     * 44373003
*                                                                     * 44373203
*        EXIT ROUTINE                                       *           44373403
*                                                                     * 44373603
*                                                                     * 44373803
         SPACE 2                                                        44374003
RETRY    EQU   *                                            LD @ZA00515 44374203
         XC    PARMFTPT,PARMFTPT   CLEAR FOOTPRINTS         LD @ZA00515 44374403
RETRY1   EQU   *                                            LD @ZA00515 44374603
         L     RUCME,CSAUCM        RELOAD UCME PTR          LD @ZA00515 44374803
         L     RUCM,CSACTLM        RELOAD UCM BASE          LD @ZA00515 44375003
         L     RDCB,UCMDCB         RELOAD DCB BASE          LD @ZA00515 44375203
         L     RUCB,UCMUCB         RELOAD UCB BASE          LD @ZA00515 44375403
         LA    RDEB,CBDEB          RELOAD DEB BASE          LD @ZA00515 44375603
         XC    UCMECB,UCMECB       CLEAR ECB FIELD IN UCM   LD @ZA00515 44375703
         XC    UCMDCB,UCMDCB       CLEAR DCB FIELD IN UCM   LD @ZA00515 44376203
         DROP  RTRYBASE                                     LD @ZA00515 44379003
         USING IEEC2740,RBASE      MAIN LINE ADDRESSABILITY LD @ZA00515 44379503
         BR    RRTRN               GO TO RETRY              LD @ZA00515 44380003
         DROP  RWORK                                        LD @ZA00515 44380503
         EJECT                                                          44381003
*                                                                     * 44381503
*                                                                     * 44382003
*        CONSTANTS AND EQUATION FOR ESTAE RETRY ROUTINE               * 44382503
*                                                                     * 44383003
*                                                                     * 44383503
         SPACE 2                                                        44384003
ADDR2740 DC    A(IEEC2740)         ADDR OF MAINLINE         LD @ZA00515 44384503
ADDRCONS DC    A(CONSTS)           ADDR OF MAINLINE CONST.  LD @ZA00515 44385003
RTRYOPN  DC    A(OPNRTRY)          ADDR OF OPEN RETRY       LD @ZA00515 44385503
FREERTN  DC    A(FREELOCK)         ADDR OF FREELOCKS RTN    LD @ZA00515 44386003
RTRYCLS  DC    A(RETA)             ADDR OF CLOSE RETRY      LD @ZA00515 44386503
FRMADDR  DC    A(FREEMAIN)         ADDR OF FREEMAIN RETRY   LD @ZA00515 44387003
SWTCHADR DC    A(ERRC1)            ADDR OF SWITCH CONSOLE   LD @ZA00515 44387503
*                                                                     * 44388003
*        ADDRESSES OF DELETES RETRY                                   * 44388503
*                                                                     * 44389003
M0DELETE DC    A(DELETEM0)                                  LD @ZA00515 44389503
MRDELETE DC    A(DELETEMR)                                  LD @ZA00515 44390003
MBDELETE DC    A(DELETEMB)                                  LD @ZA00515 44390503
MADELETE DC    A(DELETEMA)                                  LD @ZA00515 44391003
         SPACE 4                                                        44391503
GTMAINON EQU   B'10000000'                                  LD @ZA00515 44392003
GTMAINOF EQU   B'01111111'                                  LD @ZA00515 44392503
OPENREQ  EQU   B'01000000'                                  LD @ZA00515 44393003
OPENOFF  EQU   B'10111111'                                  LD @ZA00515 44393503
CLOSEREQ EQU   B'00100000'                                  LD @ZA00515 44394003
CLOSEOFF EQU   B'11011111'                                  LD @ZA00515 44394503
IOSTART  EQU   B'00010000'                                  LD @ZA00515 44395003
IOEND    EQU   B'11101111'                                  LD @ZA00515 44395503
LOADMAON EQU   B'00001000'                                  LD @ZA00515 44396003
LOADMAOF EQU   B'11110111'                                  LD @ZA00515 44396503
LOADMBON EQU   B'00000100'                                  LD @ZA00515 44397003
LOADMBOF EQU   B'11111011'                                  LD @ZA00515 44397503
LOADMRON EQU   B'00000010'                                  LD @ZA00515 44398003
LOADMROF EQU   B'11111101'                                  LD @ZA00515 44398503
LOADM0ON EQU   B'00000001'                                  LD @ZA00515 44399003
LOADM0OF EQU   B'11111110'                                  LD @ZA00515 44399503
**********                                                              44400000
*                                                                       44450000
*        EXECUTED INSTRUCTIONS                                          44500000
*                                                                       44550000
**********                                                              44600000
MOVETXT  EQU   *                                                        44650000
         MVC   MESSAGE(ZERO),ZERO(RPARM)                                44700000
BKSPCMVC EQU   *                                                        44750000
         MVC   ZERO(L1,RLINK),L2(RLINK)                                 44800000
         EJECT                                                          44810003
CONSTS   EQU   *                                            LD @ZA00515 44820003
         SPACE 3                                                        44830003
**********                                                              44850000
*                                                                       44900000
*        CONSTANTS                                                      44950000
*                                                                       45000000
**********                                                              45050000
MOD145   DC    XL2'0145'           CPU ID                               45100000
MOD155   DC    XL2'0155'           CPU ID                               45150000
MOD158   DC    XL2'0158'           CPU ID                   LD @ZA00517 45160000
MOD165   DC    XL2'0165'           CPU ID                               45200000
MOD168   DC    XL2'0168'           CPU ID                   LD @ZA00517 45210000
MOD3031  DC    XL2'3031'           CPU ID                      @G51CK02 45220000
MOD3032  DC    XL2'3032'           CPU ID                      @G51CK02 45230000
MOD3033  DC    XL2'3033'           CPU ID                      @G51CK02 45240000
ANDMASK  DC    F'3'                                                     45250000
SVC72ID  DC    CL4'VCTR'           RECOVERY IDENTIFIER      LD @ZA00515 45270003
TIME145  DC    XL4'0011B39F'       5 SECONDS                            45300000
TIME155  DC    XL4'002753A8'       5 SECONDS                            45350000
TIME165  DC    XL4'005971BC'       5 SECONDS                            45400000
TIME3031 DC    XL4'00381936'       5 SECONDS                   @G51CK02 45420000
TIME3032 DC    XL4'0069F6BC'       5 SECONDS                   @G51CK02 45440000
TIME3033 DC    XL4'00BA1532'       5 SECONDS                   @G51CK02 45460000
DISABLE  DC    X'2F00000060010001'                                      45500000
ENABLE   DC    X'2700000020240001'                                      45550000
MA       DC    CL8'IGG019MA'       NAME OF BTAM R/W ROUTINE             45600000
MB       DC    CL8'IGG019MB'       NAME OF BTAM CEA ROUTINE             45650000
M0       DC    CL8'IGG019M0'       NAME OF BTAM DEV  I/O ROUTINE        45700000
MR       DC    CL8'IGG019MR'       NAME OF OLT CONTROL MODULE           45750000
HSIX     DC    H'6'                CONSTANT                             45800000
SADCODE  DC    X'13171B1F'                                              45850000
*                   I E E X X X X   T I M E O U T   -                   45900000
TOERMSG  DC    XL18'F3EBEB020715F301A6F3C9EBCCA9A6014001'               45950000
*                   T E R M I N A L   R E S E T                         46000000
         DC    XL16'A6EBD2C9F3CAE2C601D2EBA5EBA65B3D'                   46050000
         ASMTRTAB RC40                                                  46100000
MODTABLE EQU   *                                                        46150000
*                 0 1 2 3 4 5 6 7 8 9 A B C D E F                       46200000
         DC    X'01011601010101010101010101010101' 0                    46250000
         DC    X'01010101010101010101010101010101' 1                    46300000
         DC    X'01010101010101010101010101010101' 2                    46350000
         DC    X'01010101010101010101010101010188' 3                    46400000
         DC    X'01010101010101010101A0768493E1B7' 4                    46450000
         DC    X'61010101010101010101D757909587F6' 5                    46500000
         DC    X'4023010101010101010101378BC08EA3' 6                    46550000
         DC    X'010101010101010101018816208D8296' 7                    46600000
         DC    X'01626467686B6D6E7073010101010101' 8                    46650000
         DC    X'01434546494A4C4F5152010101010101' 9                    46700000
         DC    X'01012526292A2C2F3132010101010101' A                    46750000
         DC    X'01010101010101010101010101010101' B                    46800000
         DC    X'01E2E4E7E8EBEDEEF0F3010101010101' C                    46850000
         DC    X'01C3C5C6C9CACCCFD1D2010101010101' D                    46900000
         DC    X'0101A5A6A9AAACAFB1B2010101010101' E                    46950000
         DC    X'15020407080B0D0E1013010101010101' F                    47000000
CCWCONST DC    X'00000060240001'   CCW SKELETON                         47050000
RETRNEOB DC    0XL10'0'                                                 47100000
         DC    AL1(RTRN2740)                                            47150000
         DC    8AL1(IDLE)                                               47200000
         DC    AL1(EOB2740)                                             47250000
FOXFOX   DC    X'FFFFFF'           STOPPER FOR PURGE            YM05650 47300000
PACHAREA EQU   *                                                        47350000
         DC    100X'00'            PATCH AREA FOR MAINTENANCE  @ZA17713 47400000
         EJECT                                                          47450000
**********                                                              47500000
*                                                                       47550000
*        REGISTER DEFINITION                                            47600000
*                                                                       47650000
**********                                                              47700000
RZERO    EQU   0                   WORK REG                             47750000
RPARM    EQU   1                   CXSA BASE/WORK REG/EIL BASE/CQE BASE 47800000
*                                  AVT BASE/IO DIRECTORY BASE           47850000
RUCM     EQU   2                   UCM BASE                             47900000
RUCB     EQU   3                   UCB BASE                             47950000
RWORK1   EQU   RUCB                WORK REGISTER            LD @ZA00515 47970003
RMSG     EQU   4                   WORK REG/CURRENT MESSAGE BASE        48000000
RTRYBASE EQU   RMSG                BASE FOR RETRY RTN       LD @ZA00515 48020003
RBASE    EQU   5                   PROGRAM BASE                         48050000
RWQE     EQU   6                   WQE BASE/WORK REG                    48100000
RBASE2   EQU   7                   BASE REG FOR CONSTANT    LD @ZA00515 48150003
RDCB     EQU   8                   DCB BASE/COMMON DSECT BASE           48200000
RWORK2   EQU   RDCB                WORK REGISTER            LD @ZA00515 48210003
RWORK4   EQU   RDCB                                         LD @ZA00515 48220003
RCXSATCB EQU   9                   CXSA BASE/TCB BASE/WORK REG          48250000
RDEB     EQU   10                  DEB BASE                             48300000
RUCME    EQU   11                  UCM ENTRY BASE                       48350000
RLNTH    EQU   12                  LENGTH OF TEXT/WORK REG              48400000
RWORK3   EQU   RLNTH               WORK REGISTER            LD @ZA00515 48410003
RRTRN    EQU   RLNTH                                        LD @ZA00515 48420003
ROPEN    EQU   13                  WORK REG                             48450000
RPARMADD EQU   ROPEN               PARM ADD FROM SETFRR     LD @ZA00515 48460003
RWORK    EQU   ROPEN               WORK REGISTER            LD @ZA00515 48470003
RLINK    EQU   14                  LINK REG/WORK REG                    48500000
RFRRADD  EQU   RLINK               ADDR OF COMM FRR RTN     LD @ZA00515 48520003
RCODE    EQU   15                  LINK REG/WORK REG                    48550000
         EJECT                                                          48600000
**********                                                              48650000
*                                                                       48700000
*        MISCELLANEOUS EQUATES                                          48750000
*                                                                       48800000
**********                                                              48850000
DEVTP40  EQU   X'0C'               2740 CODE FOR 'DCBDEVTP'             48900000
CU0103   EQU   X'02'                                                    48950000
MULT4    EQU   2                   TO MULTIPLY BY 4, SHIFT BY 2         49000000
DIVIDE4  EQU   2                   TO DIVIDE BY 4, SHIFT BY 2           49050000
IDLE     EQU   X'5E'                                                    49100000
RTRN2740 EQU   X'5B'               2740 CARR RETN-NEW LINE              49150000
EOB2740  EQU   X'3D'               2740 EOB                             49200000
RTRN     EQU   X'15'               2740 CARRIAGE RETURN                 49250000
BSP      EQU   X'16'               2740 BACKSPACE                       49300000
EOB      EQU   X'26'               EOB CHARACTER                        49350000
EOT      EQU   X'37'               END-OF-TRANSMISSION CHARACTER        49400000
DEVIODIR EQU   12                  DISPLACEMENT OF THE 'DEVICE I/O      49450000
*                                  DIRECTORY' FROM THE BEGINNING OF     49500000
*                                  THE 'BTAM R/W ROUTINE' (IGG019MA)    49550000
IOFULL   EQU   X'FF' I             INDICATOR OF THE 'FULL' CONDITION OF 49600000
*                                  THE DEVICE I/O DIRECTORY             49650000
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              49700000
L1       EQU   1                   LENGTH AND DISPLACEMENT              49750000
L2       EQU   2                   LENGTH AND DISPLACEMENT              49800000
L3       EQU   3                   LENGTH AND DISPLACEMENT              49850000
L4       EQU   4                   LENGTH AND DISPLACEMENT              49900000
L5       EQU   5                   LENGTH AND DISPLACEMENT              49950000
L7       EQU   7                   LENGTH AND DISPLACEMENT              50000000
L8       EQU   8                   LENGTH AND DISPLACEMENT              50050000
L9       EQU   9                   LENGTH AND DISPLACEMENT              50100000
L12      EQU   12                  LENGTH AND DISPLACEMENT              50150000
L15      EQU   15                  MASK FOR ICM INSTR.      LD @ZA00515 50170003
L16      EQU   16                  LENGTH AND DISPLACEMENT              50200000
L18      EQU   18                  LENGTH AND DISPLACEMENT              50250000
L23      EQU   23                  LENGTH AND DISPLACEMENT              50300000
L34      EQU   34                  LENGTH AND DISPLACEMENT              50350000
L40      EQU   40                  LENGTH AND DISPLACEMENT              50400000
L127     EQU   127                 LENGTH AND DISPLACEMENT              50450000
L139     EQU   139                 LENGTH AND DISPLACEMENT              50500000
X01      EQU   X'01'               MASK                                 50550000
X80      EQU   X'80'               MASK                                 50600000
X48      EQU   X'48'               MASK                                 50650000
X7E      EQU   X'7E'               MASK                                 50700000
X7F      EQU   X'7F'               MASK                                 50750000
XE0      EQU   X'E0'               MASK                                 50800000
ONES     EQU   X'FF'               AND MASK                             50850000
SUBPOOL  EQU   255                 COMM TASK SUBPOOL                    50900000
RETRYMSK EQU   X'88'                                                    50950000
BLANK    EQU   C' '                BLANK                                51000000
RST      EQU   X'80'                                                    51050000
SPACE    EQU   X'01'               2740 TRANSCODE SPACE                 51100000
WRINIT   EQU   X'02'                                                    51150000
T2740B   EQU   X'59'                                                    51200000
WRCONT   EQU   X'04'               WR CONTINUE OP TYPE                  51250000
WRBREAK  EQU   X'16'               WR BREAK OP TYPE                     51300000
WRRESET  EQU   X'0A'               WRITE EOT OP TYPE                    51350000
RDINIT   EQU   X'81'               READ INITIAL OP TYPE                 51400000
RDBREAK  EQU   X'95'               READ BREAK OP TYPE                   51450000
TIMEOUT  EQU   X'01'               TIMEOUT BIT IN SENSE FIELD           51500000
UCBPOST  EQU   X'20'               UCBFL1 POST BIT                      51550000
TRMRESET EQU   X'01'                                                    51600000
BIDHIT   EQU   X'02'                                                    51650000
RETRIED  EQU   X'04'                                                    51700000
WREOT    EQU   X'08'               WRITING EOT INDICATOR                51750000
PURGE    EQU   X'10'               PURGE IN PROCESS INDICATOR           51800000
OPENFL   EQU   X'10'               DCB IS OPEN                          51850000
LOCALON  EQU   X'80'               MASK FOR LOCAL LCK IND.  LD @ZA00515 51857003
LOCALOFF EQU   X'7F'                                        LD @ZA00515 51864003
CMSON    EQU   X'40'               MASK FOR CMS LCK IND.    LD @ZA00515 51871003
CMSOFF   EQU   X'BF'                                        LD @ZA00515 51878003
FRRON    EQU   X'20'               MASK FOR FRR IND.        LD @ZA00515 51885003
FRROFF   EQU   X'DF'                                        LD @ZA00515 51892003
         EJECT                                                          51900000
**********                                                              51950000
*                                                                       52000000
*        MODEL BTAM CONTROL BLOCKS FOR 2740 CONSOLE                     52050000
*                                                                       52100000
**********                                                              52150000
*                                                                       52200000
*              **********                                               52250000
*              *        *                                               52300000
*              *  DCB   *                                               52350000
*              *        *                                               52400000
*              **********                                               52450000
*                                                                       52500000
DCB401   DS    0D                                                       52550000
         ORG   *+20                MOVE FORWARD PAST THE UNUSED SPACE   52600000
*                                  COMMON INTERFACE                     52650000
         DC    AL1(0),AL3(0),AL2(0)   DCBBUFNO,DCBBUFCB,DCBBUFL         52700000
         DC    X'1000'             DCBDSORG = CX                        52750000
         DC    AL1(DEVTP40),AL3(IOB401-IOBLNTH)   DCBDEVTP,DCBIOBAD     52800000
*                                  FOUNDATION EXTENSION                 52850000
         DC    AL1(0),X'16',AL2(0)   DCBBFTEK,DCBERROP = (R,W,E)        52900000
         DC    AL1(IOBLNTH),AL3(0)   DCBIOBX,DCBEXLST                   52950000
*                                  FOUNDATION SEGMENT (AFTER OPEN)      53000000
         DC    AL2(0),X'2020',AL1(0),AL3(DEB401)   DCBTIOT,DCBMACRF,    53050000
*                                  DCBIFLGS,DCBDEBAD                    53100000
         DC    AL1(0),AL3(0)       DCBOFLGS,DCBREAD/DCBWRITE            53150000
         DC    A(0)                DCBLERB                              53200000
*                                                               YM02593 53250000
*              **********                                       YM02593 53300000
*              *        *                                       YM02593 53350000
*              *  AVT   *                                       YM02593 53400000
*              *        *                                       YM02593 53450000
*              **********                                       YM02593 53500000
*                                                               YM02593 53550000
APP2740  DC    A(DEBEOEAP,DEBSIOAP,DEBPCIAP,0,0)   AVT      LD @ZA00515 53600003
*                                                                       53650000
*                                                                       53700000
*              **********                                               53750000
*              *        *                                               53800000
*              *  DECB  *                                               53850000
*              *        *                                               53900000
*              **********                                               53950000
*                                                                       54000000
         DS    0D                  TO MATCH COMMON DSECT ALIGNMENT      54050000
         READ DECB401,T,DCB401,,L'MESSAGE,,1,MF=L                       54100000
*              **********                                               54150000
*              *        *                                               54200000
*              *  IOB   *                                               54250000
*              *        *                                               54300000
*              **********                                               54350000
*                                                                       54400000
IOB401   DS    0D                                                       54450000
*                                  STANDARD FIELDS                      54500000
         DC    X'C2',AL1(0,0,0,0),AL3(DECB401)   IOBFLAG1,IOBFLAG2,     54550000
*                                  IOBSENS0,IOBSENS1,IOBECBPT           54600000
         DC    AL1(0),AL3(IOB401),XL4'00',AL1(0),AL3(CP401)   IOBFLAG3, 54650000
*                                  IOBCSW,IOBSIOCC,IOBSTART             54700000
         DC    A(DCB401,0),AL2(0,0)   IOBDCBPT,IOBRESTR,IOBINCAM,       54750000
*                                  IOBERRCT                             54800000
*                                  BTAM EXTENSION SEGMENT               54850000
         DC    AL1(0),XL7'00',XL8'00',XL16'00'   IOBUCBX,IOBWORK,       54900000
*                                  IOBERCCW,IOBERINF                    54950000
CP401    DC    28F'0'              CHANNEL PROGRAM AREA         YA02125 55000000
         DC    2F'0'               ERP EXTENSION               @ZA04667 55010000
*                                                                       55050000
*                                                                       55070000
*              **********                                               55100000
*              *        *                                               55150000
*              *  DEB   *                                               55200000
*              *        *                                               55250000
*              **********                                               55300000
*                                                                       55350000
*                                  PREFIX SECTION                       55400000
         DC    A(0),AL1((DEBEND1-DEB401)/8+1),AL3(0)  DEBDCBMK,DEBLNGTH 55450000
*                                  BASIC SECTION                        55500000
DEB401   DC    AL1(0),AL3(0)       DEBNMSUB,DEBTCBAD                    55550000
         DC    AL1(4),AL3(0)       DEBAMLNG,DEBDEBAD                    55600000
         DC    AL1(0),AL3(DEBIRB1),AL1(0),AL3(0)   DEBOFLGS,DEBIRBAD,   55650000
*                                  DEBOPATB,DEBSYSPG                    55700000
         DC    AL1(1),AL3(0),AL1(0),AL3(0)   DEBNMEXT = 1,              55750000
*                                  DEBUSPRG,DEBPRIOR,DEBECBAD           55800000
         DC    X'0F',AL3(DCB401),AL1(2),AL3(APP2740)   DEBPROTG/        55850000
*                                  DEBDEBID,DEBDCBAD,DEBEXSCL = 2,      55900000
*                                  DEBAPPAD                             55950000
*                                  DEVICE DEPENDENT SECTION             56000000
         DC    A(0)                DEBSUCBA                             56050000
DEBEND1  EQU   *                   END OF DEB                           56100000
DEBIRB1  DC    A(0)                                                     56150000
PURGE1   DC    3F'0'               PARM LIST FOR PURGE                  56200000
*                                                                       56250000
*              **********                                               56300000
*              *        *                                               56350000
*              *  SAVE  *                                               56400000
*              *  AREA  *                                               56450000
*              *        *                                               56500000
*              **********                                               56550000
*                                                                       56600000
XSAVE    DC    20F'0'                                                   56650000
*                                                                       56700000
*              **********                                               56750000
*              *        *                                               56800000
*              *  MSG   *                                               56850000
*              *  BUFFR *                                               56900000
*              *        *                                               56950000
*              **********                                               57000000
*                                                                       57050000
XMSGAREA DC    XL144'00'                                                57100000
*                                                                       57150000
**********                                                              57200000
*                                                                       57250000
*        END OF CONTROL BLOCKS                                          57300000
*                                                                       57350000
**********                                                              57400000
         EJECT                                                          57450000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57550000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57650000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57750000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57800000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57850000
*                                                                       57900000
*                                                                       57950000
*  XXXXX    XXXXX    X   X    X   X    XXXXX    X   X                   58000000
*  X        X   X    XX XX    XX XX    X   X    XX  X                   58050000
*  X        X   X    X X X    X X X    X   X    X X X                   58100000
*  X        X   X    X   X    X   X    X   X    X  XX                   58150000
*  X        X   X    X   X    X   X    X   X    X   X                   58200000
*  XXXXX    XXXXX    X   X    X   X    XXXXX    X   X                   58250000
*                                                                       58300000
*                                                                       58350000
*  XXX     XXXXX   XXXXX   XXXXX   XXXXX                                58400000
*  X  X    X       X       X         X                                  58450000
*  X   X   XXXXX   XXXXX   X         X                                  58500000
*  X   X       X   X       X         X                                  58550000
*  X  X        X   X       X         X                                  58600000
*  XXX     XXXXX   XXXXX   XXXXX     X                                  58650000
*                                                                       58700000
*                                                                       58750000
**********                                                      YM02593 58800000
*                                                               YM02593 58850000
*        DSECT FOR GETMAINED AREA FOR MODEL CONTROL             YM02593 58900000
*        BLOCKS IN THE FOLLOWING SEQUENCE:                      YM02593 58950000
*              DCB                 ADDRESSING LABEL = IHADCB    YM02593 59000000
*              AVT                 ADDRESSING LABEL = APPVTAB   YM02593 59050000
*              DECB                ADDRESSING LABEL = DECB      YM02593 59100000
*              IOB                 ADDRESSING LABEL = IOBSTDRD  YM02593 59150000
*              DEB                 ADDRESSING LABEL = CBDEB     YM02593 59200000
*              SAVEAREA            ADDRESSING LABEL = SAVEAREA  YM02593 59250000
*              MESSAGEAREA         ADDRESSING LABEL = MSG       YM02593 59300000
*        NOTE-THE DEB IS NOT MAPPED WITHIN THE COMMON DSECT     YM02593 59350000
*             BECAUSE THE MACRO DOES NOT ACCEPT DSECT=NO        YM02593 59400000
*                                                               YM02593 59450000
*                                                               YM02593 59500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 59550000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 59600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 59650000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 59700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 59750000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 59800000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 59850000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 59900000
         EJECT                                                          59950000
         DS    0D                  FOR ALIGNMENT                YM02593 60000000
         DCBD  DSORG=BX                                         YM02593 60050000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60100000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60150000
         SPACE 5                                                        60200000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60250000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60300000
         ORG   DCBLERB+4                                        YM02593 60350000
APPVTAB  DS    5F                  APPENDAGE VECTOR TABLE       YM02593 60400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60450000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60500000
         SPACE 5                                                        60550000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60650000
         IHADECB DSECT=NO                                       YM02593 60700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60750000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60800000
         SPACE 5                                                        60850000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60900000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60950000
**********                                                      YM02593 61000000
*                                                               YM02593 61050000
*        THE FOLLOWING ORG IS 16 LESS THAN THE SIZE OF THE      YM02593 61100000
*        DECB SO THE IOBSTDRD FIELD OF THE IOB (NOT THE IOB     YM02593 61150000
*        PREFIX) WILL BE THE FIRST LOGICAL PORTION OF THE IOB   YM02593 61200000
*                                                               YM02593 61250000
         ORG   DECB+24                                          YM02593 61300000
         IEZIOB DSECT=NO                                        YM02593 61350000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 61400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 61450000
         SPACE 5                                                        61500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 61550000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 61600000
         ORG   IOBSTDRD+176                                     YA02125 61650000
IOBLNTH  EQU   *-IOBSTDRD          LENGTH OF THIS IOB           YM02593 61660000
ERPEXT   DS    2F              INCREASE GETMAIN FOR THE        @ZA04667 61670000
*                              ERPEXT BY 2 FULL WORDS          @ZA04667 61700000
CBLEN1   EQU   IOBSTDRD-IHADCB     LENGTH OF DCB AND DECB       YM02593 61750000
CBDEBP   DS    2F                                                       61800000
CBDEB    DS    9F                                                       61850000
CBIRB    DS    F                                                        61900000
CBPURGE  DS    3F                                                       61950000
CBLEN2   EQU   *-IOBSTDRD                                       YM02593 62000000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 62050000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 62100000
         SPACE 5                                                        62150000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 62200000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 62250000
SAVEAREA DS    18F                                              YM02593 62300000
TEMP1    DS    F                                                YM02593 62350000
TEMP2    DS    F                                                YM02593 62400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 62450000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 62500000
         SPACE 5                                                        62550000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 62600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 62650000
*                                  DSECT FOR AN INPUT MESSAGE   YM02593 62700000
MCSFLAGS EQU   0                   SVC 34 FLAGS FOR MCS SUPPORT         62750000
MSGLNTH  EQU   144                 LENGTH OF INPUT MESSAGE              62800000
PARTLNTH EQU   MSGLNTH-6           THE PARTIAL LENGTH USED IN EDITING A 62850000
*                                  MESSAGE                              62900000
MSG      EQU   *                                                YM02593 62950000
MESSLNTH DS    XL2                 LENGTH OF THIS MESSAGE               63000000
MESSFLGS DS    XL2                 IGNORED BY SVC 34                    63050000
MESSAGE  DS    CL(MSGLNTH-4)       THE MESSAGE CONTENT                  63100000
CBLEN3   EQU   *-SAVEAREA                                     LD YM7713 63150000
CBSIZ    EQU   *-IHADCB                                         YM02593 63200000
         EJECT                                                          63250000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63300000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63350000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63450000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63550000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63650000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63750000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63800000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63850000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63900000
*                                                                       63950000
*                                                                       64000000
*  XXXXX   X   X   XXX                                                  64050000
*  X       XX  X   X  X                                                 64100000
*  XXXXX   X X X   X   X                                                64150000
*  X       X  XX   X   X                                                64200000
*  X       X   X   X  X                                                 64250000
*  XXXXX   X   X   XXX                                                  64300000
*                                                                       64350000
*                                                                       64400000
*  XXXXX    XXXXX    X   X    X   X    XXXXX    X   X                   64450000
*  X        X   X    XX XX    XX XX    X   X    XX  X                   64500000
*  X        X   X    X X X    X X X    X   X    X X X                   64550000
*  X        X   X    X   X    X   X    X   X    X  XX                   64600000
*  X        X   X    X   X    X   X    X   X    X   X                   64650000
*  XXXXX    XXXXX    X   X    X   X    XXXXX    X   X                   64700000
*                                                                       64750000
*                                                                       64800000
*  XXX     XXXXX   XXXXX   XXXXX   XXXXX                                64850000
*  X  X    X       X       X         X                                  64900000
*  X   X   XXXXX   XXXXX   X         X                                  64950000
*  X   X       X   X       X         X                                  65000000
*  X  X        X   X       X         X                                  65050000
*  XXX     XXXXX   XXXXX   XXXXX     X                                  65100000
*                                                                       65150000
*                                                                       65200000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65250000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65300000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65350000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65450000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65550000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65650000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65750000
         EJECT                                                          65800000
         IEZDEB LIST=YES                                                65850000
         EJECT                                                          65900000
         IKJTCB                                                         65950000
         EJECT                                                          66000000
CVT      DSECT                                                          66050000
         CVT                                                            66100000
         EJECT                                                          66150000
UCBSET   DSECT                                                          66200000
         IEFUCBOB                                                       66250000
         EJECT                                                          66300000
         IHACTM CQE                                                     66350000
         EJECT                                                          66400000
         IHACTM CXSA                                                    66450000
         EJECT                                                          66452000
         IHACTM FTPT                                                    66460000
         EJECT                                                          66470000
         IHAFRRS                                                        66480000
         EJECT                                                          66500000
         IHAPSA                                                         66550000
         EJECT                                                          66600000
         IHAIQE                                                         66650000
         EJECT                                                          66700000
         IKJRB                                                          66750000
         EJECT                                                          66800000
*                                  MACRO CALL CHANGE            YM05695 66850000
         IEECUCM FORMAT=NEW                                             66900000
         EJECT                                                          66950000
         IHAWQE                                                         67000000
         EJECT                                                          67050000
IODIRECT DSECT                                                          67100000
IODEVTP  DS    0XL1                CODE SAVED HERE FROM 'DCBDEVTP'      67150000
IODEVMOD DS    F                   ADDRESS DEVICE I/O MODULE            67200000
IONEXT   DS    0F                  NEXT DIRECTORY ENTRY                 67250000
         END                                                            67300000
./  ADD  SSI=13150255,NAME=IGC0A06F
         TITLE 'IGC0A06F-2741 TERMINAL TEST MODULE. PTTC'               00300018
IGC0A06F CSECT                                                          00600018
         SPACE 2                                                        00900018
* STATUS -          CHANGE LEVEL 000    21 NOVEMBER 1968                01200018
         SPACE 2                                                        01500018
*                                                                       01800018
*                                                                       02100018
* FUNCTION -        GENERATE CHANNEL PROGRAM FOR 2741 ON LINE TESTS     02400018
*                                                                       02700018
*                                                                       03000018
* ENTRY POINT -     ENTRY IS TO FIRST INSTRUCTION FROM HEADER ANALYSIS  03300018
*                   MODULE                                              03600018
*                                                                       03900018
*                                                                       04200018
* INPUT -           REGISTER 1 - ADDRESS OF IOB                         04500018
*                   REGISTER 14 - RETURN ADDRESS                        04800018
*                                                                       05100018
*                                                                       05400018
* OUTPUT -          1.  GENERATED CHANNEL PROGRAM                       05700018
*                   2.  UPDATED USAGE COUNT AND POINTER IN              06000018
*                       TERMINAL TEST MODULE (IGG019MR)                 06300018
*                                                                       06600018
*                                                                       06900018
* EXTERNAL ROUTINE -SVC 4 ROUTINE (GETMAIN)                             07200018
*                                                                       07500018
*                                                                       07800018
* EXIT -            RETURN TO ADDRESS IN REGISTER 14                    08100018
*                                                                       08400018
*                                                                       08700018
* INLINE ROUTINES -THE INPUT MESSAGE IS LOCATED THROUGH THE PARAMETER   09000018
*                   LIST AND IS ANALYZED FOR TYPE OF REQUEST.  CCW'S    09300018
*                   FOR THE PROPER DATA AND CONTROL PURPOSES ARE FORMED 09600018
*                   IN THE CCW AREA OF THE IOB.  IF THE REQUESTED DATA  09900018
*                   PATTERN IS NOT IN USE, CORE WILL BE OBTAINED AND    10200018
*                   THE PATTERN MOVED INTO THE NEW AREA.  IF NO CORE IS 10500018
*                   AVAILABLE, THE TEST REQUEST WILL BE SWITCHED TO THE 10800018
*                   TERMINAL SPECIFIED IN THE TEST REQUEST.             11100018
*                   A SUB-ROUTINE--                                     11400018
*                                                                       11700018
*                        A.  SETS UP THE ADDRESS FOR THE CHANNEL        12000018
*                            PROGRAM.                                   12300018
*                        B.  MOVES THE BASIC CCW'S INTO THE CCW AREA OF 12600018
*                            THE IOB.                                   12900018
*                                                                       13200018
*                                                                       13500018
* ATTRIBUTES -      THIS ROUTINE IS EXECUTED IN THE SVC TRANSIENT AREA  13800018
*                   AS A TYPE 4 SVC ROUTINE, ENABLED,PRIVILEGED AND     14100018
*                   REENTRANT.                                          14400018
*                                                                       14700018
         EJECT                                                          15000018
*                                                                       15300018
*                                                                       15600018
*                                                                       15900018
         BALR  BASEREG,0                                                16200018
         USING *,BASEREG                                                16500018
         USING IHADCB,DCBREG                                            16800018
         USING IECTIOB,IOBREG                                           17100018
         USING IECTDECB,DECBREG                                         17400018
         USING PARMLIST,PARREG                                          17700018
         USING CPA,CCWREG                                               18000018
*                                                                       18300018
         LR    IOBREG,1                 LOAD IOB ADDRESS                18600018
         L     PARREG,IOBPARM           LOAD PARAMETER LIST ADDRESS     18900018
         L     IOREG,IOBAREA            LOAD I/O AREA ADDRESS           19200018
         L     DECBREG,IOBECBPT         ADDRESS OF DECB                 19500018
         L     DCBREG,DECDCBAD          ADDRESS OF DCB                  19800018
SETCCWRG EQU   *                                                        20100018
         LA    CCWREG,IOBCPA            ADDRESS OF CCW AREA             20400018
         ST    CCWREG,IOBSTART         RESET CCW AREA POINTER           20700018
         MVC   0(16,CCWREG),CHANPROG     MOVE TWO CCWS                  21000018
SETADCCW L     WORKREG2,NLIDLES         GET ADDRESS OF NL, PADS         21300018
         ST    WORKREG2,CCW1           STORE IN CCW                     21600018
         MVI   CCW1,X'01'               RESTORE OP CODE                 21900018
         CLI   6(IOREG),X'02'           BRANCH IF                       22200018
         BE    MSGSWTCH                           SWITCH TEST (1)       22500018
         CLI   6(IOREG),X'0B'           BRANCH IF                       22800018
         BE    COMPARE                            COMPARE TEST (5)      23100018
         SR    TESTREG,TESTREG          CLEAR TEST REGISTER             23400018
         IC    TESTREG,6(IOREG)         INSERT TEST SEL. CHARACTER      23700018
         SRA   TESTREG,1                SHIFT OUT PARITY BIT            24000018
         IC    TESTREG,TESTCODE-2(TESTREG)   SET UP INDEXING            24300018
         L     PATRNREG,PATTERN         GET ADDRESS OF PATTERN NAME TBL 24600018
         LA    WORKREG,0(TESTREG,PATRNREG)                              24900018
         CLI   0(WORKREG),X'00'         BRANCH IF THIS PATTERN          25200018
         BE    NOTINUSE                                   IS NOT IN USE 25500018
         IC    WORKREG,0(TESTREG,PATRNREG)   1-UP                       25800018
         LA    WORKREG,1(WORKREG)             USAGE                     26100018
         STC   WORKREG,0(TESTREG,PATRNREG)     COUNT                    26400018
*                                                                       26700018
SETCCWS  EQU   *                                                        27000018
         L     WORKREG,0(TESTREG,PATRNREG)                              27300018
         IC    WORKREG3,0(WORKREG)     INSERT PATTERN AREA COUNT        27600018
         LA    WORKREG,1(WORKREG)       ADDRESS OF DATA TO BE SENT      27900018
         ST    WORKREG,CCW2             PUT IN CCW                      28200018
         MVI   CCW2,X'01'               RESTORE OP CODE                 28500018
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          28800018
         IC    WORKREG,0(TESTREG,PATRNREG)   CHARACTER COUNT            29100018
         BCTR  WORKREG3,0              REDUCE BY ONE                    29400018
         STC   WORKREG3,CCW2+7         PUT IN CCW                       29700018
         STC   TESTREG,DECONLTT         PUT DISPLACEMENT                30000018
*                                                                       30300018
*                                                                       30600018
RETURN1  BR    RETURN                                                   30900018
*                                                                       31200018
NOTINUSE L     GETMAIN,0(PATRNREG)      ADDRESS OF GETMAIN CONSTANTS    31500018
         EX    0,DATAADDR-4(TESTREG)         ADDRESS OF DATA TO MOVE    31800018
         LA    TOREG,0(TESTREG,PATRNREG)     ADDRESS OF THE TABLY ENTRY 32100018
         ST    TOREG,4(GETMAIN)         PUT IN GETMAIN CONSTANTS        32400018
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          32700018
         IC    WORKREG,0(FROMREG)       CHARACTER COUNT OF DATA         33000018
         ST    WORKREG,0(GETMAIN)       PUT IN GETMAIN CONSTANTS        33300018
         SVC   4                        ISSUE GETMAIN SVC               33600018
         SLL   15,24                    ELIMINATE HIGH ORDER BITS       33900018
         NR    15,15                    TEST FOR ZERO RETURN CODE       34200018
         BNE   MSGSWTCH                 NON-ZERO IS NO CORE AVAILABLE   34500018
         MVI   0(TOREG),X'01'           SET USAGE COUNT TO ONE          34800018
         L     TOREG,0(TOREG)           GET ADRESS OF DATA AREA         35100018
         BCTR  WORKREG,0                ADJUST COUNT FOR MVC INST       35400018
         EX    WORKREG,EXMVC            MOVE THE DATA                   35700018
         B     SETCCWS                                                  36000018
*                                                                       36300018
*                                                                       36600018
COMPARE  EQU   *                                                        36900018
         LH    WORKREG,DECLNGTH         INPUT AREA LENGTH               37200018
         SH    WORKREG,IOBCSW+6         - RESIDUAL COUNT                37500018
         SH    WORKREG,HA                                               37800018
         BM    NOCHAR                                                   38100018
         CH    WORKREG,MAXLNG           IS LENGTH TOO GREAT?            38400018
         BNH   CMPTST                   NO                              38700018
         LH    WORKREG,MAXLNG           YES, SUBSTITUTE MAX LENGTH      39000018
CMPTST   EX    WORKREG,EXCOMP                                           39300018
         BNE   MSGSWTCH                 BAD COMPARE, MSG SWITCH         39600018
LOADMSG  MVC   0(LN,IOREG),CMPVALD      GOOD, LOAD COMPARE VALID MSG.   39900018
         LA    WORKREG,COMPDATA(WORKREG) FIND LAST CHARACTER            40200018
         MVC   8(1,IOREG),0(WORKREG)    INSERT IN MSG                   40500018
RETURN2  ST    IOREG,CCW2                                               40800018
         MVI   CCW2,X'01'               RESTORE OP CODE                 41100018
         MVI   CCW2+7,LN                                                41400018
         BR    RETURN                                                   41700018
NOCHAR   MVC   0(LN,IOREG),CMPVALD      LOAD COMPARE VALID MSG          42000018
         B     RETURN2                                                  42300018
*                                                                       42600018
*                                                                       42900018
MSGSWTCH EQU   *                                                        43200018
         ST    IOREG,CCW2               ADDRESS OF DATA TO CCW          43500018
         MVI   CCW2,X'01'               RESTORE OP CODE                 43800018
         LH    WORKREG,DECLNGTH         USED IF NOT DYNAMIC BUFFERING   44100018
         TM    DCBBFTEK,X'08'           TEST IF DYNAMIC BUFFERING USED  44400018
         BZ    *+12                                                     44700018
         LH    WORKREG,DCBBUFL          USED WITH DYNAMIC BUFFERING     45000018
         SH    WORKREG,=H'4'            ADJUST FOR TIC                  45300018
         BCTR  WORKREG,0                BYPASS EOA CHAR                 45600018
         STH   WORKREG,CCW2+6           IN CASE NO EOT FOUND            45900018
         CLI   0(IOREG),X'1F'           LOOK FOR EOT                    46200018
         BE    FOUNDEOT                                                 46500018
         LA    IOREG,1(IOREG)           UP CORE POINTER                 46800018
         BCT   WORKREG,*-12             LOOP ON COUNT                   47100018
         BR    RETURN                                                   47400018
*                                                                       47700018
FOUNDEOT EQU   *                                                        48000018
         S     IOREG,IOBAREA            COMPUTE NUMBER OF CHARACTERS    48300018
         STH   IOREG,CCW2+6             STORE COUNT                     48600018
         BR    RETURN                                                   48900018
*                                                                       49200018
*  CONSTANTS                                                            49500018
*                                                                       49800018
TESTCODE DC    X'04080C001014'                                          50100018
EXMVC    MVC   0(1,TOREG),0(FROMREG)                                    50400018
         EJECT                                                          50700018
*                                                                       51000018
*  PATTERN OF DATA FOR 2740 TESTS                                       51300018
*                                                                       51600018
TILT     DC    AL1(TILTEND-TILT)                                        51900018
         DC    X'622367266B2A6E2F70316120642568296D2C733276375B5E5E5E'  52200018
         DC    X'5E5E5E573452134C0D49084504401551104F0E4A0B460743025B'  52500018
         DC    X'5E5E5E5E5E5E'                                          52800018
TILTEND  EQU   *                                                        53100018
*                                                                       53400018
ROTATE   DC    AL1(ROTATEND-ROTATE)                                     53700018
         DC    X'62766B6D706443574A4C514523372A23312502340B0D5B5E5E5E'  54000018
         DC    X'5E5E5E100407130E081526322F292046524F494067736E68615B'  54300018
         DC    X'5E5E5E5E5E5E'                                          54600018
ROTATEND EQU   *                                                        54900018
*                                                                       55200018
TWIST    DC    AL1(TWISTEND-TWIST)                                      55500018
         DC    X'E234A357E713A652EB0DAA4CEE08AF49F004B145E1155B5E5E5E'  55800018
         DC    X'5E5E5E8276C3378773C6328B6DCA2C8E68CF299064D125A0405B'  56100018
         DC    X'5E5E5E5E5E5E'                                          56400018
TWISTEND EQU   *                                                        56700018
*                                                                       57000018
ALLCHAR  DC    AL1(ALLCHARX-ALLCHAR)                                    57300018
         DC    X'15020407080B0D0E1013626467686B6D6E7073434546494A4C4F'  57600018
         DC    X'51522526292A2C2F31325B5E5E5E5E5E5EE2E4E7E8EBEDEEF0F3'  57900018
         DC    X'C3C5C6C9CACCCFD1D2A5A6A9AAACAFB1B25B5E5E'              58200018
ALLCHARX EQU   *                                                        58500018
*                                                                       58800018
ANALYZER DC    AL1(ANALYZEX-ANALYZER)                                   59100018
         DC    X'020407080B016701130101250162016B616445254F5D5D5D5D5D'  59400018
         DC    X'5D5D5D5D5D5D5D155D5D5D105D5D5D0D0101010101014F01675B'  59700018
         DC    X'01010101010101675E5B5E5E5E466D3B5E5E023B5E5E043B5E5E'  60000018
         DC    X'075B'                                                  60300018
ANALYZEX EQU   *                                                        60600018
*                                                                       60900018
*  ADDRESSES OF DATA TO BE MOVED TO PATTERN BUFFER                      61200018
*                                                                       61500018
         DS    0H                                                       61800018
DATAADDR EQU   *                                                        62100018
         LA    FROMREG,TILT                                             62400018
         LA    FROMREG,ROTATE                                           62700018
         LA    FROMREG,TWIST                                            63000018
         LA    FROMREG,ALLCHAR                                          63300018
         LA    FROMREG,ANALYZER                                         63600018
*                                                                       63900018
*                                                                       64200018
COMPDATA DC    X'15020407080B0D0E1013626467686B' STORED                 64500018
         DC    X'6D6E7073434546494A4C4F51522526'       COMPARISON       64800018
         DC    X'292A2C2F3132'                                   DATA   65100018
*                                                                       65400018
CMPVALD  DC    X'67494F012A466840235B'   VALID COMPARE MESSG            65700018
*                                                                       66000018
LN       EQU   L'CMPVALD                LENGTH ATTRIBUTE OF VALID MSG   66300018
HA       DC    H'10'                                                    66600018
MAXLNG   DC    H'35'                                                    66900018
EXCOMP   CLC   8(*-*,IOREG),COMPDATA                                    67200018
*                                                                       67500018
*  CCW'S                                                                67800018
*                                                                       68100018
CHANPROG DS    0D                                                       68400018
         CCW   X'01',0,X'A0',15         WRITE CARRIAGE RETURN AND IDLES 68700018
         CCW   X'01',0,X'20',0          WRITE THE TEST MESSAGE          69000018
         EJECT                                                          69300018
*                                                                       69600018
*  EQUATES                                                              69900018
*                                                                       70200018
WORKREG2 EQU   1                                                        70500018
GETMAIN  EQU   1                                                        70800018
WORKREG  EQU   2                                                        71100018
PARREG   EQU   3                                                        71400018
FROMREG  EQU   4                                                        71700018
IOBREG   EQU   5                                                        72000018
BASEREG  EQU   6                                                        72300018
IOREG    EQU   7                                                        72600018
TESTREG  EQU   8                                                        72900018
PATRNREG EQU   9                                                        73200018
CCWREG   EQU   10                                                       73500018
DCBREG   EQU   11                                                       73800018
DECBREG  EQU   12                                                       74100018
TOREG    EQU   13                                                       74400018
WORKREG3 EQU   13                                                       74700018
RETURN   EQU   14                                                       75000018
LINKREG  EQU   15                                                       75300018
         EJECT                                                          75600018
         DCBD  DSORG=BX,DEVD=BS                                         75900018
         EJECT                                                          76200018
         IECTIOBX                                                       76500018
         SPACE 2                                                        76800018
IOBNAME  EQU   IOBERCCW                                                 77100018
IOBAREA  EQU   IOBNAME+8                                                77400018
IOBPARM  EQU   IOBNAME+12                                               77700018
         EJECT                                                          78000018
         IECTDECB                                                       78300018
         EJECT                                                          78600018
PARMLIST DSECT                                                          78900018
PATTERN  DS    F                                                        79200018
NLIDLES  DS    F                                                        79500018
         SPACE 5                                                        79800018
CPA      DSECT                                                          80100018
CCW1     DS    D                        WRITE EOA                       80400018
CCW2     DS    D                        WRITE NL,PADS                   80700018
         END                                                            81000018
./  ADD  SSI=13150256,NAME=IGC0B06F
         TITLE 'IGC0B06F - 2760 ON-LINE TERMINAL TEST MODULE'           00500018
IGC0B06F CSECT                                                          01000018
*  STATUS -        CHANGE LEVEL 000       05-01-69                      01500018
         SPACE 2                                                        02000018
*  FUNCTION -      PERFORM ONLINE TERMINAL TESTS FOR THE IBM 2760       02500018
*                    OPTICAL IMAGE UNIT                                 03000018
         SPACE 2                                                        03500018
*  ENTRY POINT -    ENTRY IS TO THE FIRST EXECUTABLE INSTRUCTION.       04000018
*                   MODULE IS REQUESTED VIA AN SVC 66 FROM THE          04500018
*                   MODULE IGC0006F WHEN A TYPE 10 OR 11 2740 TEST      05000018
*                   IS REQUESTED.                                       05500018
         SPACE 2                                                        06000018
*  INPUT -          REGISTER 1 - ADDRESS OF THE IOB FOR LINE REQUESTING 06500018
*                                    THE TEST.                          07000018
*                   IOBERCCW (IOB+40)                                   07500018
*                             +0 - NAME OF THIS MODULE                  08000018
*                             +8 - ADDRESS OF REQUEST MESSAGE           08500018
*                            +12 - ADDRESS OF PARAMETER LIST            09000018
*                                      IN IGG019MR.                     09500018
*                   PARAMETER LIST -                                    10000018
*                             +0 ADDRESS OF PATTERN AREA                10500018
*                             +4 ADDRESS OF NL AND IDLES                11000018
         SPACE 2                                                        11500018
*  EXTERNAL ROUTINES - NONE                                             12000018
         SPACE 2                                                        12500018
*  EXIT -           A BRANCH ON REGISTER 14 RETURNS CONTROL TO          13000018
*                     IGG019MR.  IGG019MR THEN EXECUTES THE CHANNEL     13500018
*                     PROGRAM BUILT BY THIS MODULE.                     14000018
         SPACE 1                                                        14500018
*          ERROR EXIT - SAME AS ABOVE EXCEPT THAT BIT 7 OF IOBINCAM     15000018
*                       (IOB+28) IS SET TO 0 TO INDICATE TO IGG019MR    15500018
*                       THAT THE CHANNEL PROGRAM IS NOT TO BE EXECUTED. 16000018
         SPACE 2                                                        16500018
*  ATTRIBUTES - THIS ROUTINE IS REENTRANT                               17000018
         SPACE 2                                                        17500018
*  COMMENTS                                                             18000018
*              BASIC CCWS ARE MOVED INTO THE IOBCPA FIELD IN GROUPS     18500018
*              ACCORDING TO THE FUNCTION TO BE PERFORMED.  THESE CCWS   19000018
*              HAVE THE REQUIRED COMMAND CODES, FLAGS, AND IN MOST      19500018
*              INSTANCES, DATA COUNT.                                   20000018
*                                                                       20500018
*              WHEN A DATA ADDRESS IS TO BE INSERTED INTO THE CCW, THE  21000018
*              FOLLOWING METHOD IS USED:                                21500018
*                                                                       22000018
*              1.  LOAD THE DATA ADDRESS INTO A REGISTED.               22500018
*                                                                       23000018
*              2.  ADD THE FIRST WORD OF THE REQUIRED CCW TO THE        23500018
*                  REGISTER.  NOTE THAT THE COMMAND CODE WILL BE        24000018
*                  CARRIED ALONG AND WILL BE IN THE HIGH                24500018
*                  ORDER BYTE OF THE REGISTER.                          25000018
*                                                                       25500018
*              3.  STORE THE REGISTER AT THE FIRST BYTE OF THE          26000018
*                  CCW.  THE COMMAND CODE WILL NOT BE CHANGED.          26500018
         EJECT                                                          27000018
IOBREG   EQU   1                        POINTER TO IOB                  27500018
DECBREG  EQU   2                        POINTER TO DECB                 28000018
PARMREG  EQU   3                        PARAMETERS PASSED FROM ONLINE   28500018
*                                         TEST CONTROL                  29000018
AREAREG  EQU   4                        POINTER TO REQUEST MESSAGE      29500018
OIUREG   EQU   5                        POINTER TO 2760 CONTROL CHARS   30000018
WORKREG  EQU   6                        WORK REGISTER                   30500018
BASEREG  EQU   12                       BASE FOR THIS MODULE            31000018
RETREG   EQU   14                                                       31500018
TESTCODE EQU 5                          OFFSET INTO MSG TO TEST CODE    32000018
NOENTRY  EQU   X'BF'                    TURNS OFF REENTRY FLAG          32500018
CC       EQU   X'40'                    CHAIN COMMAND FLAG              33000018
REENTRY  EQU   X'40'                    REENTRY CODE IN DECONLTT        33500018
EOTOFF   EQU   21                       OFFSET TO EOT CHARS IN PARM     34000018
*                                            LIST                       34500018
DIALBITS EQU   X'90'                    A CALL AANSR FEATURE BITS       35000018
READTI   EQU   1                        READ INITIAL OPTYPE             35500018
READTV   EQU   5                        READ CONVERSATIONAL OPTYPE      36000018
TCO      EQU   X'0E'                    INVITATIONAL OPTICAL TYPE       36500018
         BALR  BASEREG,0                                                37000018
         USING *,BASEREG                                                37500018
         USING  IECTDECB,DECBREG                                        38000018
         USING IECTIOB,IOBREG                                           38500018
         L     DECBREG,IOBECBPT         POINTER TO DECB                 39000018
         L     PARMREG,IOBERCCW+12      POINTER TO PARAMETER LIST       39500018
         L     AREAREG,IOBERCCW+8       INPUT AREA                      40000018
         TM    DECONLTT,REENTRY         FIRST ENTRY FOR THIS TEST       40500018
         BO    SECOND                   BRANCH IF NOT                   41000018
         CLI   DECTYPE+1,TCO            TEST ENTERED ON WRITE TCO       41500018
         BNE   VALIDITY                 BRANCH IF NO                    42000018
         TM    FEATURES,DIALBITS        IS THIS A DIAL LINE             42500018
         BNZ   DIAL                     BRANCH IF YES                   43000018
         MVI   DECTYPE+1,READTI         CONSTRUCT READ TI AFTER TEST    43500018
VALIDITY TM    FEATURES,X'2C'           IS DEVICE 2740 CHECKING,OIU     44000018
         BNO   NOGOOD                   BRANCH IF NOT                   44500018
         MVC   IOBWORK+3(4),DPREFIXO    2760 CONTROL CHARS TO IOB       45000018
         MVC   IOBCPA(40),TIOCCWS       MOVE CCWS TO WRITE TO 2760      45500018
*                                         INTO IOBCPA                   46000018
         LA    WORKREG,IOBWORK+3        POINT TO 2760 CONTROL CHARS     46500018
         A     WORKREG,IOBCPA           ADD COMMAND AND OFFSET TO       47000018
*                                         CONTROL CHARACTER ADDRESS     47500018
         ST    WORKREG,IOBCPA           WRITE EOA PREFIX O              48000018
         SPACE 2                                                        48500018
         LR    WORKREG,AREAREG          DATA AREA                       49000018
         LA    WORKREG,8(WORKREG)       BUMP TO FRAME CHANGE MESSAGE    49500018
         A     WORKREG,IOBCPA+8                                         50000018
         ST    WORKREG,IOBCPA+8         WRITE FRAME CHANGE              50500018
         SPACE 2                                                        51000018
         LA    WORKREG,IOBWORK+6        CIRCLE B                        51500018
         A     WORKREG,IOBCPA+16                                        52000018
         ST    WORKREG,IOBCPA+16        WRITE EOB                       52500018
         SPACE 2                                                        53000018
         LA    WORKREG,DECRESPN+1       RESPONSE AREA                   53500018
         A     WORKREG,IOBCPA+24                                        54000018
         ST    WORKREG,IOBCPA+24        READ RESPONSE TO EOB            54500018
         SPACE 2                                                        55000018
         L     WORKREG,4(PARMREG)       POINTER TO CRIDLES              55500018
         LA    WORKREG,EOTOFF(WORKREG)  POINTER TO EOT                  56000018
         A     WORKREG,IOBCPA+32                                        56500018
         ST    WORKREG,IOBCPA+32        WRITE CIRCLE C                  57000018
         SPACE 2                                                        57500018
         CLC   TESTCODE(2,AREAREG),ELEVEN IS THIS SCAN POINT TEST       58000018
         BNE   GOODEXIT                 BRANCH IF NO                    58500018
         SPACE 2                                                        59000018
         OI    IOBCPA+36,CC             TURN ON CHAIN COMMAND FLAG IN   59500018
*                                         WRITE CIRCLE C CCW            60000018
         MVC   IOBCPA+40(16),RESPCCWS   CCWS TO READ OPERATORS          60500018
*                                         RESPONSE MESSAGE              61000018
         A     AREAREG,IOBCPA+48                                        61500018
         ST    AREAREG,IOBCPA+48        DATA AREA IN READ DATA CCW      62000018
         LH    WORKREG,DECLNGTH         LENGTH OF DATA AREA             62500018
         STH   WORKREG,IOBCPA+54        READ DATA CCW                   63000018
         SPACE 2                                                        63500018
         OI    DECONLTT,REENTRY         TURN ON REENTRY FLAG            64000018
         SPACE 2                                                        64500018
GOODEXIT EQU   *                                                        65000018
         OI    IOBINCAM,X'01'           INDICATE TEST IS TO BE EXECUTED 65500018
EXIT     EQU   *                                                        66000018
         BR    RETREG                                                   66500018
NOGOOD   EQU   *                        INVALID TEST EXIT               67000018
         NI    IOBINCAM,X'FE'           INDICATE TEST NOT TO BE         67500018
*                                          EXECUTED                     68000018
         B     EXIT                                                     68500018
         SPACE   2                                                      69000018
DIAL     MVI   DECTYPE+1,READTV         CONSTRUCT READ TV AFTER TEST    69500018
         B     VALIDITY                 CHECK FOR VALID FEATURES        70000018
         EJECT                                                          70500018
SECOND   EQU   *                                                        71000018
         NI    DECONLTT,NOENTRY         TURN OFF REENTRY FLAG           71500018
         CLC   0(2,AREAREG),PREFIXO     PROBE FROM 2760                 72000018
         BNE   NOGOOD                   BRANCH IF NO                    72500018
         MVC   IOBCPA(24),WTICCWS       MOVE CCW BASES INTO IOB         73000018
         SPACE 2                                                        73500018
         L     WORKREG,4(PARMREG)       POINTER TO CRIDLES FROM         74000018
*                                       PARAMETER LIST                  74500018
         A     WORKREG,IOBCPA                                           75000018
         ST    WORKREG,IOBCPA           WRITE CIRCLE D PAD              75500018
*                                             NEW LINE PAD              76000018
         SPACE 2                                                        76500018
         LA    AREAREG,2(AREAREG)       BUMP PAST LEADING CONTROL CHARS 77000018
         A     AREAREG,IOBCPA+8                                         77500018
         ST    AREAREG,IOBCPA+8         DATA AREA                       78000018
         LH    WORKREG,DECLNGTH         LENGTH OF DATA AREA             78500018
         SH    WORKREG,IOBCSW+6         SUBTRACT RESIDUAL COUNT         79000018
         SH    WORKREG,THREE            EXCLUDE PRE,O,EOT               79500018
         STH   WORKREG,IOBCPA+14        WRITE DATA TO 2740              80000018
         SPACE 2                                                        80500018
         L     WORKREG,4(PARMREG)       POINTER TO CONTROL CHARS FROM   81000018
*                                         PARAMETER LIST                81500018
         LA    WORKREG,EOTOFF(WORKREG)  GET TO EOT                      82000018
         A     WORKREG,IOBCPA+16                                        82500018
         ST    WORKREG,IOBCPA+16        WRITE EOT                       83000018
         B     GOODEXIT                                                 83500018
          EJECT                                                         84000018
         DS    0D                                                       84500018
TIOCCWS  DC    X'0100000080000003'      WR D PRE O                      85000018
         DC    X'0100000080000003'      WR FRAME CHANGE                 85500018
         DC    X'0100000060000001'      WR EOB                          86000018
         DC    X'0200000060000001'      RD RESPONSE                     86500018
         DC    X'0100000020000003'      WR EOT                          87000018
         SPACE 2                                                        87500018
RESPCCWS DC    X'0600000060000001'      PREPARE                         88000018
         DC    X'0200000020000000'      RD DATA                         88500018
         SPACE 2                                                        89000018
WTICCWS  DC    X'0100000080000014'      WR EOA NL PADS                  89500018
         DC    X'0100000080000000'      WR DATA                         90000018
         DC    X'0100000020000003'      WR EOT                          90500018
         SPACE 2                                                        91000018
*      THESE THREE CONSTANTS MUST BE KEPT TOGETHER                      91500018
DPREFIXO DC    X'16'                    EOA                             92000018
PREFIXO  DC    X'3E4C'                                                  92500018
EOB      DC    X'3D'                    EOB CHARACTER                   93000018
THREE    DC    H'3'                                                     93500018
ELEVEN   DC    X'0202'                                                  94000018
         EJECT                                                          94500018
         IECTDECB                                                       95000018
         EJECT                                                          95500018
         IECTIOBX                                                       96000018
FEATURES EQU  IOBWORK+3                                                 96500018
         END                                                            97000018
./  ADD  SSI=13150257,NAME=IGC0C06F
         TITLE '  IGC0C06F - 2740C ONLINE TEST MODULE '                 00300019
IGC0C06F CSECT                                                          00600019
         SPACE 2                                                        00900019
* STATUS -          CHANGE LEVEL 000    JULY 11, 1969                   01200019
         SPACE 2                                                        01500019
*                                                                       01800019
*                                                                       02100019
* FUNCTION -        GENERATE CHANNEL PROGRAM FOR 2740 ON LINE TESTS     02400019
*                                                                       02700019
*                                                                       03000019
* ENTRY POINT -     ENTRY IS TO FIRST INSTRUCTION FROM HEADER ANALYSIS  03300019
*                   MODULE                                              03600019
*                                                                       03900019
*                                                                       04200019
* INPUT -           REGISTER 1 - ADDRESS OF IOB                         04500019
*                   REGISTER 14 - RETURN ADDRESS                        04800019
*                                                                       05100019
*                                                                       05400019
* OUTPUT -          1.  GENERATED CHANNEL PROGRAM                       05700019
*                   2.  UPDATED USAGE COUNT AND POINTER IN              06000019
*                       TERMINAL TEST MODULE (IGG019MR)                 06300019
*                                                                       06600019
*                                                                       06900019
* EXTERNAL ROUTINE -SVC 4 ROUTINE (GETMAIN)                             07200019
*                                                                       07500019
*                                                                       07800019
* EXIT -            RETURN TO ADDRESS IN REGISTER 14                    08100019
*                                                                       08400019
*                                                                       08700019
* INLINE ROUTINES -THE INPUT MESSAGE IS LOCATED THROUGH THE PARAMETER   09000019
*                   LIST AND IS ANALYZED FOR TYPE OF REQUEST.  CCW'S    09300019
*                   FOR THE PROPER DATA AND CONTROL PURPOSES ARE FORMED 09600019
*                   IN THE CCW AREA OF THE IOB.  IF THE REQUESTED DATA  09900019
*                   PATTERN IS NOT IN USE, CORE WILL BE OBTAINED AND    10200019
*                   THE PATTERN MOVED INTO THE NEW AREA.  IF NO CORE IS 10500019
*                   AVAILABLE, THE TEST REQUEST WILL BE SWITCHED TO THE 10800019
*                   TERMINAL SPECIFIED IN THE TEST REQUEST.             11100019
*                   A SUB-ROUTINE--                                     11400019
*                                                                       11700019
*                        A.  SETS UP THE ADDRESS FOR THE CHANNEL        12000019
*                            PROGRAM.                                   12300019
*                        B.  DETERMINES IF DIAL CCW'S ARE REQUIRED AND  12600019
*                            PREPARES THEM IF NEEDED.                   12900019
*                        D.  MOVES THE BASIC CCW'S INTO THE CCW AREA OF 13200019
*                            THE IOB.                                   13500019
*                                                                       13800019
*                                                                       14100019
* ATTRIBUTES -      THIS ROUTINE IS EXECUTED IN THE SVC TRANSIENT AREA  14400019
*                   AS A TYPE 4 SVC ROUTINE, ENABLED,PRIVILEGED AND     14700019
*                   REENTRANT.                                          15000019
*                                                                       15300019
         EJECT                                                          15600019
*                                                                       15900019
*                                                                       16200019
*                                                                       16500019
         BALR  BASEREG,0                                                16800019
         USING *,BASEREG                                                17100019
         USING IHADCB,DCBREG                                            17400019
         USING IECTIOB,IOBREG                                           17700019
         USING IECTDECB,DECBREG                                         18000019
         USING PARMLIST,PARREG                                          18300019
*                                                                       18600019
         LR    IOBREG,1                 LOAD IOB ADDRESS                18900019
         L     PARREG,IOBPARM           LOAD PARAMETER LIST ADDRESS     19200019
         L     IOREG,IOBAREA            LOAD I/O AREA ADDRESS           19500019
         L     DECBREG,IOBECBPT         ADDRESS OF DECB                 19800019
         L     DCBREG,DECDCBAD          ADDRESS OF DCB                  20100019
         CLI   6(IOREG),ONE             BRANCH IF                       20400019
         BE    MSGSWTCH                           SWITCH TEST (1)       20700019
         CLI   6(IOREG),FIVE            BRANCH IF                       21000019
         BE    COMP                     COMPARE TEST (5)                21300019
         SR    TESTREG,TESTREG          CLEAR TEST REGISTER             21600019
         IC    TESTREG,6(IOREG)         INSERT TEST SEL. CHARACTER      21900019
         SRA   TESTREG,1                SHIFT OUT PARITY BIT            22200019
         IC    TESTREG,TESTCODE-2(TESTREG)   SET UP INDEXING            22500019
         L     PATRNREG,PATTERN         GET ADDRESS OF PATTERN NAME TBL 22800019
         LA    WORKREG,0(TESTREG,PATRNREG)                              23100019
         CLI   0(WORKREG),X'00'         BRANCH IF THIS PATTERN          23400019
         BE    NOTINUSE                                   IS NOT IN USE 23700019
         IC    WORKREG,0(TESTREG,PATRNREG)   1-UP                       24000019
         LA    WORKREG,1(WORKREG)             USAGE                     24300019
         STC   WORKREG,0(TESTREG,PATRNREG)     COUNT                    24600019
*                                                                       24900019
SETCCWS  EQU   *                                                        25200019
         BAL   LINKREG,SETCCWRG                                         25500019
         L     WORKREG,0(TESTREG,PATRNREG)                              25800019
         IC    WORKREG3,0(WORKREG)     INSERT PATTERN AREA COUNT        26100019
         LA    WORKREG,1(WORKREG)       ADDRESS OF DATA TO BE SENT      26400019
         ST    WORKREG,32(CCWREG)       PUT IN CCW                      26700019
         MVI   32(CCWREG),X'01'         RESTORE OP CODE                 27000019
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          27300019
         IC    WORKREG,0(TESTREG,PATRNREG)   CHARACTER COUNT            27600019
         BCTR  WORKREG3,0              REDUCE BY ONE                    27900019
         STC   WORKREG3,39(CCWREG)     PUT IN CCW                       28200019
         STC   TESTREG,8(DECBREG)       PUT DISPLACEMENT                28500019
*                                                                       28800019
FINCCWS  EQU   *                                                        29100019
         TM    DCBERROP+2,X'08'        TEST FOR STC                     29400019
         BZ    RETURN1                 ZERO MEANS NOT STC               29700019
         L     WORKREG2,NLIDLES        ADDRESS OF EOA, CR AND IDLES     30000019
         LA    WORKREG,25(WORKREG2)    ADDRESS OF CIRCLE C AND CIRCLE S 30300019
         ST    WORKREG,0(CCWREG)        PUT IN CCW                      30600019
         MVI   0(CCWREG),X'01'          RESTORE OP CODE                 30900019
*                                                                       31200019
         ST    WORKREG2,24(CCWREG)     STORE ADDRESS IN CCW             31500019
         MVI   24(CCWREG),X'01'        RESTORE WRITE OP CODE            31800019
*                                                                       32100019
         LA    WORKREG,26(DECBREG)      GET ADDRESS OF RESPONSE AREA    32400019
         ST    WORKREG,16(CCWREG)       PUT IN CCW                      32700019
         MVI   16(CCWREG),X'02'         RESTORE OP CODE                 33000019
*                                                                       33300019
         LA    WORKREG,33(IOBREG)       GET ADDRESS OF ADDRESSING CHARS 33600019
         ST    WORKREG,8(CCWREG)        PUT IN CCW                      33900019
         MVI   8(CCWREG),X'01'          RESTORE OP CODE                 34200019
*                                                                       34500019
RETURN1  BR    RETURN                                                   34800019
*                                                                       35100019
NOTINUSE L     GETMAIN,0(PATRNREG)      ADDRESS OF GETMAIN CONSTANTS    35400019
         EX    0,DATAADDR-4(TESTREG)         ADDRESS OF DATA TO MOVE    35700019
         LA    TOREG,0(TESTREG,PATRNREG)     ADDRESS OF THE TABLY ENTRY 36000019
         ST    TOREG,4(GETMAIN)         PUT IN GETMAIN CONSTANTS        36300019
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          36600019
         IC    WORKREG,0(FROMREG)       CHARACTER COUNT OF DATA         36900019
         ST    WORKREG,0(GETMAIN)       PUT IN GETMAIN CONSTANTS        37200019
         SVC   4                        ISSUE GETMAIN SVC               37500019
         SLL   15,24                    ELIMINATE HIGH ORDER BITS       37800019
         NR    15,15                    TEST FOR ZERO RETURN CODE       38100019
         BNE   MSGSWTCH                 NON-ZERO IS NO CORE AVAILABLE   38400019
         MVI   0(TOREG),X'01'           SET USAGE COUNT TO ONE          38700019
         L     TOREG,0(TOREG)           GET ADRESS OF DATA AREA         39000019
         BCTR  WORKREG,0                ADJUST COUNT FOR MVC INST       39300019
         EX    WORKREG,EXMVC            MOVE THE DATA                   39600019
         B     SETCCWS                                                  39900019
         EJECT                                                          40200019
SETCCWRG LA    CCWREG,IOBCPA            START OF CHANNEL                40500019
*                                       PROGRAM AREA                    40800019
         ST    CCWREG,IOBSTART          START HERE                      41100019
         TM    DCBERROP+2,X'0C'         S CONTROL OR XCONTROL           41400019
         BM    CHECKSC                  BRANCH IF EITHER                41700019
         SPACE 2                                                        42000019
MOVE     MVC   0(16,CCWREG),CHANPROG+24 BASE CHANNEL PROGRAMS           42300019
         L     WORKREG2,NLIDLES         ADDR OF NLIDLES IN IGG019MR     42600019
         ST    WORKREG2,0(CCWREG)       SEND EOA IDLES                  42900019
         MVI   0(CCWREG),X'01'          NL  IDLES                       43200019
         MVI   7(CCWREG),COUNT          COUNT OF CHARACTERS             43500019
         SH    CCWREG,TWENTY4           RESET CCWREG FOR INTERFACE      43800019
         BR    LINKREG                  RETURN                          44100019
         SPACE  4                                                       44400019
CHECKSC  TM    DCBERROP+2,X'08'         STATION CONTROL                 44700019
         BZ    MOVE                     RETURN IF NOT                   45000019
*                                                                       45300019
STATCTL  MVC   0(40,CCWREG),CHANPROG   MOVE CCWS TO IOB                 45600019
         MVI   34(IOBREG),X'01'        MOVE SPACE CHARACTER             45900019
         BR    LINKREG                  RETURN                          46200019
*                                                                       46500019
COMP     EQU   *                                                        46800019
         LH    CTRREG,DECLNGTH         INPUT AREA LENGTH                47100019
         A     CTRREG,DECAREA          - OFFSET                         47400019
         SR    CTRREG,IOREG                 FROM START OF MSG           47700019
         SH    CTRREG,RCOUNT           - RESIDUAL COUNT                 48000019
         SH    CTRREG,H12                                               48300019
         BM    NOCHAR                                                   48600019
         CH    CTRREG,MAXLNG           IS LENGTH TOO GREAT              48900019
         BNH   FINDTXT                 NO                               49200019
         LH    CTRREG,MAXLNG           YES, SUBSTITUTE MAXLNG           49500019
FINDTXT  LA    WORKREG3,10(IOREG)      POINT TO FIRST COMPARE CHAR      49800019
         LA    WORKREG2,ALLCHAR+1                                       50100019
CMPTST   EX    CTRREG,COMPARE                                           50400019
         BNE   MSGSWTCH                BAD COMPARE, MSG SWITCH          50700019
*                                                                       51000019
LOADMSG  EQU   *                                                        51300019
         MVC   0(LN,IOREG),CMPVALD     MOVE COMPARE VALID MESSG         51600019
         AR    WORKREG2,CTRREG         ADD LENGTH TO GET OFFSET         51900019
         MVC   8(1,IOREG),0(WORKREG2)  GET LAST CHARACTER               52200019
         B     MSGSWTCH                 BUILD CHANNEL PROGRAM           52500019
         SPACE  2                                                       52800019
NOCHAR   MVC   0(LN,IOREG),CMPVALD                                      53100019
         B     MSGSWTCH                                                 53400019
         SPACE 2                                                        53700019
COMPARE  CLC   0(0,WORKREG3),0(WORKREG2)                                54000019
*                                                                       54300019
MAXLNG   DC    H'35'                                                    54600019
H12      DC    H'12'                                                    54900019
*                                                                       55200019
*                 C M P   V L   - /NLEOT                                55500019
CMPVALD  DC    X'2F43680146312A76705B1F'                                55800019
*                                                                       56100019
LN       EQU   L'CMPVALD                LENGTH ATTRIBUTE OF VALID MSG   56400019
*                                                                       56700019
         EJECT                                                          57000019
         DS    0H                                                       57300019
MSGSWTCH EQU   *                                                        57600019
         BAL   LINKREG,SETCCWRG         SET UP CCW AREA POINTER + DIAL  57900019
         ST    IOREG,32(CCWREG)         ADDRESS OF DATA TO CCW          58200019
         MVI   32(CCWREG),X'01'         RESTORE OP CODE                 58500019
         LH    WORKREG,6(DECBREG)       USED IF NOT DYNAMIC BUFFERING   58800019
         TM    32(DCBREG),X'08'         TEST IF DYNAMIC BUFFERING USED  59100019
         BZ    *+12                                                     59400019
         LH    WORKREG,24(DCBREG)       USED WITH DYNAMIC BUFFERING     59700019
         SH    WORKREG,=H'4'            ADJUST FOR TIC                  60000019
         BCTR  WORKREG,0                BYPASS EOA CHAR                 60300019
         STH   WORKREG,38(CCWREG)       IN CASE NO EOT FOUND            60600019
         CLI   0(IOREG),X'1F'           LOOK FOR EOT                    60900019
         BE    FOUNDEOT                                                 61200019
         LA    IOREG,1(IOREG)           UP CORE POINTER                 61500019
         BCT   WORKREG,*-12             LOOP ON COUNT                   61800019
         BCTR  IOREG,0                  ADJUST TO POINT TO LAST POS.    62100019
         MVI   0(IOREG),X'1F'           PUT IN EOT AT LAST POSITION     62400019
         B     FINCCWS                  CONTINUE CCW PROCESSING         62700019
*                                                                       63000019
FOUNDEOT EQU   *                                                        63300019
         S     IOREG,IOBAREA            COMPUTE NUMBER OF CHARACTERS    63600019
         LA    IOREG,1(IOREG)           UP COUNT TO INCLUDE EOT         63900019
         STH   IOREG,38(CCWREG)         SAVE COUNT TEMPORARILY          64200019
         B     FINCCWS                  CONTINUE CCW PROCESSING         64500019
*                                                                       64800019
*  CONSTANTS                                                            65100019
*                                                                       65400019
TESTCODE DC    X'0408001410000C'                                        65700019
EXMVC    MVC   0(1,TOREG),0(FROMREG)                                    66000019
         EJECT                                                          66300019
ONE      EQU   X'02'                    LINE CODE -1-                   66600019
FIVE     EQU   X'08'                    LINE CODE -5-                   66900019
*                                                                       67200019
*  PATTERN OF DATA FOR 2740 TESTS                                       67500019
*                                                                       67800019
TILT     DC    AL1(TILTEND-TILT)                                        68100019
         DC    X'622367266B2A6E2F70316120642568296D2C733276375B5E5E5E'  68400019
         DC    X'5E5E5E573452134C0D49084504401551104F0E4A0B460743025B'  68700019
         DC    X'5E5E5E5E5E5E'                                          69000019
TILTEND  EQU   *                                                        69300019
*                                                                       69600019
ROTATE   DC    AL1(ROTATEND-ROTATE)                                     69900019
         DC    X'62766B6D706443574A4C514523372A23312502340B0D5B5E5E5E'  70200019
         DC    X'5E5E5E100407130E081526322F292046524F494067736E68615B'  70500019
         DC    X'5E5E5E5E5E5E'                                          70800019
ROTATEND EQU   *                                                        71100019
*                                                                       71400019
TWIST    DC    AL1(TWISTEND-TWIST)                                      71700019
         DC    X'E234A357E713A652EB0DAA4CEE08AF49F004B145E1155B5E5E5E'  72000019
         DC    X'5E5E5E8276C3378773C6328B6DCA2C8E68CF299064D125A0405B'  72300019
         DC    X'5E5E5E5E5E5E'                                          72600019
TWISTEND EQU   *                                                        72900019
*                                                                       73200019
ALLCHAR  DC    AL1(ALLCHARX-ALLCHAR)                                    73500019
**                0 1 2 3 4 5 6 7 8 9 a b c d e f g h i j k l m n o p   73800019
         DC    X'1302040710080D0B0E164F372F2A296762324C612C3143255168'  74100019
*                 q r s t u v w x y zNL             A B C D E F G H I   74400019
         DC    X'6D4A52202646572373155B5E5E5E5E5E5ECFB7AFAAA9E7E2B2CC'  74700019
*                 J K L M N O P Q R S T U V W X Y ZNL                   75000019
         DC    X'E1ACB1C3A5D1E8EDCAD2A0A6C6D7A3F3955B5E5E'              75300019
ALLCHARX EQU   *                                                        75600019
*                                                                       75900019
ANALYZER DC    AL1(ANALYZEX-ANALYZER)                                   76200019
*                 1 2 3 4 5SP cSP 9SPSP sSP aSP e & b k s pBSBSBSBSBS   76500019
         DC    X'0204071008012F0116010152014F01298B372C52685D5D5D5D5D'  76800019
*                BSBSBSBSBSBSBS 0BSBSBS 8BSBSBS 6SPSPSPSPSPSP pSP cNL   77100019
         DC    X'5D5D5D5D5D5D5D135D5D5D0E5D5D5D0D01010101010168012F5B'  77400019
*                SPSPSPSPSPSPSP cILNLILILIL l fLFILIL 1LFILIL 2LFILIL   77700019
         DC    X'010101010101012F5E5B5E5E5E31673B5E5E023B5E5E043B5E5E'  78000019
*                 3NL                                                   78300019
         DC    X'075B'                                                  78600019
ANALYZEX EQU   *                                                        78900019
*                                                                       79200019
*  ADDRESSES OF DATA TO BE MOVED TO PATTERN BUFFER                      79500019
*                                                                       79800019
         DS    0H                                                       80100019
DATAADDR EQU   *                                                        80400019
         LA    FROMREG,TILT                                             80700019
         LA    FROMREG,ROTATE                                           81000019
         LA    FROMREG,TWIST                                            81300019
         LA    FROMREG,ALLCHAR                                          81600019
         LA    FROMREG,ANALYZER                                         81900019
*                                                                       82200019
*  CCW'S                                                                82500019
*                                                                       82800019
DIALCCW  CCW   X'2F',0,X'60',1          DISABLE THE LINE                83100019
         CCW   X'29',0,X'60',0          SEND THE DIAL DIGITS            83400019
CHANPROG CCW   X'01',0,X'A0',4          WRITE CIRCLE D AND CIRCLE C     83700019
         CCW   X'01',0,X'60',2          WRITE THE ADDRESSING CHARACTERS 84000019
         CCW   X'02',0,X'60',1          READ THE ADDRESSING RESPONSE    84300019
         CCW   X'01',0,X'A0',15         WRITE CARRIAGE RETURN AND IDLES 84600019
         CCW   X'01',0,X'20',0          WRITE THE TEST MESSAGE          84900019
         EJECT                                                          85200019
*                                                                       85500019
*  EQUATES                                                              85800019
*                                                                       86100019
WORKREG2 EQU   1                                                        86400019
GETMAIN  EQU   1                                                        86700019
WORKREG  EQU   2                                                        87000019
CTRREG   EQU   WORKREG                                                  87300019
PARREG   EQU   3                                                        87600019
FROMREG  EQU   4                                                        87900019
IOBREG   EQU   5                                                        88200019
BASEREG  EQU   6                                                        88500019
IOREG    EQU   7                                                        88800019
TESTREG  EQU   8                                                        89100019
PATRNREG EQU   9                                                        89400019
CCWREG   EQU   10                                                       89700019
DCBREG   EQU   11                                                       90000019
DECBREG  EQU   12                                                       90300019
TOREG    EQU   13                                                       90600019
WORKREG3 EQU   13                                                       90900019
RETURN   EQU   14                                                       91200019
LINKREG  EQU   15                                                       91500019
COUNT    EQU   20                       COUNT OF CHARACTERS             91800019
TWENTY4  DC    H'24'                    THREE CCWS                      92100019
         EJECT                                                          92400019
         DCBD  DSORG=BX,DEVD=BS                                         92700019
         EJECT                                                          93000019
         IECTIOBX                                                       93300019
         SPACE 2                                                        93600019
IOBNAME  EQU   IOBERCCW                                                 93900019
IOBAREA  EQU   IOBNAME+8                                                94200019
IOBPARM  EQU   IOBNAME+12                                               94500019
FEATURES EQU   IOBWORK+3                OPTIONAL FEATURES FROM UCB      94800019
RCOUNT   EQU   IOBWORK+5                RESIDUAL COUNT                  95100019
         EJECT                                                          95400019
         IECTDECB                                                       95700019
         EJECT                                                          96000019
PARMLIST DSECT                                                          96300019
PATTERN  DS    F                                                        96600019
NLIDLES  DS    F                                                        96900019
         END                                                            97200019
./  ADD  SSI=62740001,NAME=IGC0D06F
         TITLE  'IGC0D06F  -  ON-LINE TEST CONTROL MODULE    '          00300002
IGC0D06F CSECT                                                          00600018
*********************************************************************** 00900018
*                                                                     * 01200018
* STATUS -            CHANGE LEVEL 003, OCTOBER 21,1974               * 01500003
*                                                                     * 01800018
* FUNCTION -   SERVICE BSC ON-LINE-TEST REQUESTS FOR BTAM.            * 02100000
*                                                                     * 02400018
*                   1. SELECTS APPROPRIATE SECOND SVC LOAD            * 02700018
*                      ACCORDING TO VALUE GIVEN XX= AND TRANSMISSION  * 03000018
*                      CODE.                                          * 03300018
*                                                                     * 03600018
*              VALIDATES REQUEST FOR TEST MESSAGES AND XCTL'S         * 03900018
*              TO APPROPRIATE DEVICE DEPENDENT SUBSEQUENT LOAD.       * 04200018
*                                                                     * 04500018
* ENTRY POINT- ENTRY IS TO FIRST EXECUTABLE INSTRUCTION.              * 04800018
*                                                                     * 05100018
* INPUT -             REGISTER 1 - ADDRESS OF THE IOB                 * 05400018
*                     ADDRESS OF RFT MESSAGE IN IOBERINF INSERTED     * 05700018
*                        BY IGG019MB (CHANNEL END).                   * 06000018
*                     ADDRESS OF PARAMETER LIST IN IOBERINF+4 (FOR    * 06300018
*                        START-STOP ONLY) INSERTED BY IGG019MR        * 06600018
*                        (TERMINAL TEST CONTROL MODULE).              * 06900018
*                                                                     * 07200018
* OUTPUT -            REGISTER 1 - ADDRESS OF IOB                     * 07500018
*                                                                     * 07800018
* EXTERNAL ROUTINES - EXECUTE CHANNEL PROGRAM ROUTINE                 * 08100018
*                                                                     * 08400018
* EXITS -             IF AN UNSUCCESSFUL CONDITION IS MET, A RETURN   * 08700018
*                        TO THE USER ADDRESS IN REG 14.               * 09000018
*                                                                     * 09300018
*                     XCTL TO APPROPRIATE SUBSEQUENT LOAD.            * 09600018
*                                                                     * 09900018
* DECERRST:                                                           * 09920000
*     .... ...1  RFT ERROR BIT.                                       * 09940000
*                     AN INVALID REQUEST WAS RECEIVED ON A READ       * 09960000
*                     CONTINUE OPERATION AND BTAM COULD NOT SUCCESS-  * 09980000
*                     FULLY RESET THE LINE PRIOR TO POSTING.          * 10000000
*                                        OR                           * 10020000
*                     ON A 3275 DIAL DEVICE, THE RFT MESSAGE WAS      * 10040000
*                     TRANSMITTED THE SPECIFIED NUMBER OF TIMES,      * 10060000
*                     FOLLOWED BY A WRITE RESET. THE RESPONSE TO      * 10080000
*                     THE WRITE RESET INDICATES AN ERROR CONDITION.   * 10100000
*                                                                     * 10120000
*                                                                     * 24300018
* ATTRIBUTES - THIS ROUTINE IS REENTRANT.                             * 24600018
*                                                                     * 24900018
* CHANGE ACTIVITY AS FOLLOWS:                                         * 24950000
*                                                                     * 25000000
*     ZA00532 (10/18/74)                                              * 25050003
*     ZA02332  (11/20/74)        ZA02333  (11/20/74)                  * 25052003
*     AZ03978  (04/24/75)                                             * 25061003
*     AZ06398  (11/05/75)        AZ06401  (11/05/75)                  * 25070003
*     AZ09321  (03/11/76)        AZ13191  (09/20/76)                  * 25079000
*                                                                     * 25088003
*                                                                     * 25100000
*********************************************************************** 25200018
         SPACE 2                                                        25500018
PARMREG  EQU   0                   PARAMETER REGISTER       LD @ZA02332 25550003
IOBREG   EQU   1                   IOB REGISTER             LD @ZA02332 25600003
DEBREG   EQU   2                                                        25800018
CHKREG   EQU   2                                                        26100018
SAVEAREG EQU   2                                                        26400018
PARREG   EQU   3                                                        26700018
TYPEREG  EQU   4                                                        27000018
CMPCNTRG EQU   4                                                        27300018
MUTPREG  EQU   5                                                        27600018
BASEREG  EQU   6                                                        27900018
IOREG    EQU   7                                                        28200000
TESTREG  EQU   8                                                        28500018
LENGTREG EQU   9                                                        28800018
CNTREG   EQU   9                                                        29100018
ADREG    EQU   10                                                       29400000
DCBREG   EQU   11                                                       29700018
DECBREG  EQU   12                                                       30000018
UCBREG   EQU   13                                                       30300018
         SPACE   4                                                      30600018
         BALR  BASEREG,0                                                30900018
         USING *,BASEREG                                                31200018
         USING IECTIOB,1                *                               31500018
         USING IECTDEB,DEBREG           * DSECTS FOR CONTROL BLOCKS     31800018
         USING IHADCB,DCBREG            *                               32100018
         USING IECTDECB,DECBREG                                         32400018
         B     A                                               @YA02157 32450002
         DC    CL8'IGC0D06F'            MODULE IDENTIFIER      @YA02157 32500002
         DC    C'** MVS *'                                              32550000
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY       LD @ZA02332 32560003
PATCH    DC    48X'00'                  PATCH AREA             @YA02157 32600002
A        DS    0H                                              @YA02157 32650002
         L     DECBREG,IOBECBPT                                         32700018
         L     DCBREG,IOBDCBPT          LOAD DCB ADDRESS                33000018
         L     DEBREG,DCBDEBAD          LOAD POINTER TO DEB             33300018
         L     DEBREG,28(DEBREG)        LOAD ADDR. OF TRUE START OF DEB 33600018
         SR    UCBREG,UCBREG            CLEAR REGISTER                  33900018
         IC    UCBREG,IOBUCBX           GET INDEX TO UCB FOR THIS LINE  34200018
         SLL   UCBREG,2                 MULTIPLY BY FOUR                34500018
         L     UCBREG,DEBUCBAD(UCBREG)  GET UCB ADDRESS FOR THIS LINE   34800018
BISNTST  L     TESTREG,IOBERINF        GET RFT MESSAGE AREA ADDR   000D 35100002
         LA    CNTREG,XXYYLNG          SET CTR TO 4            @YA01056 35150002
         LA    ADREG,XXDISP(TESTREG)   GET ADDR OF XX FIELD    @YA01056 35200002
NUMLOOP  EQU   *                                               @YA01056 35250002
         TM    DCBXCODE,DCBXCEBC      IS THIS EBCDC?           @ZA03978 35254003
         BZ    EBCDCNUM               YES BRANCH TO EBCDC      @ZA09321 35258003
ASCIINUM TM    ZERO(ADREG),X30        IS THIS A VALID          @ZA03978 35262003
*                                     NUMBER FOR ASCII?        @ZA03978 35266003
         BNO   INVALID                NO, SET ON ERROR BIT     @ZA03978 35270003
         B     VALIDNUM                                        @ZA03978 35274003
EBCDCNUM TM    ZERO(ADREG),NUMERIC    IS THIS A VALID          @ZA03978 35278003
*                                     NUMBER FOR EBCDC         @ZA03978 35282003
         BNO   INVALID                NO, SET ON ERROR BIT     @ZA03978 35286003
VALIDNUM LA    ADREG,INCR(ADREG)      INCREMENT COUNT          @ZA03978 35290003
         BCT   CNTREG,NUMLOOP          LOOP AND CHECK          @YA01056 35370002
         NI    6(TESTREG),ZONEOFF  AND OFF ZONES IN N FIELD    @YA02157 35460002
         IC    CNTREG,6(TESTREG)   PUT N VALUE IN CNTREG       @YA02157 35470002
         AR    ADREG,CNTREG        ADD N VALUE TO ADREG        @YA02157 35480002
         LA    ADREG,INCR(ADREG)   BUMP PAST LAST ADR BYTE     @YA02157 35490002
*                                                                       35500003
*        TWO LINES HAVE NEEN DELETED FOR APAR OZ00532       LD @ZA00532 35540003
*                                                                       35542003
         CLC   ZERO(DISP1,ADREG),DCBBSETX  IS IT AN ETX        @ZA06401 35544003
         BE    PACK                YES CONTINUE                @ZA06401 35552003
         CLC   ZERO(DISP1,ADREG),DCBBSSTX   IS IT AN STX       @ZA06401 35560003
         BE    PACK                 YES CONTINUE               @ZA06401 35568003
         CLC   ZERO(L2,ADREG),DCBBSTSX   XPARENT STX ??        @ZA06401 35576003
         BE    PACK               YES CONTINUE                 @ZA06401 35584003
INVALID  EQU   *                                               @YA01056 35594002
         NI    IOBINCAM,X'C0'          TURN OFF RFT ERROR BIT  @YA02157 35600002
         CLI   DECTYPE+1,READTT        WAS IT A READ TT?       @YA02157 35610002
         BE    WRTEOT                  YES, BRANCH             @ZA06398 35620003
         XI    IOBSNDPT,FLIP           RESTORE ACK POINTER     @YA02157 35630002
         TM    DCBBFTEK,DYNBUF     TEST FOR DYN BUF         LD @ZA02333 35632003
         BZ    AUTOTEST            BRANCH IF NOT            LD @ZA02333 35634003
         L     TESTREG,IOBCSW      GET CSW ADDRESS          LD @ZA02333 35636003
         SH    TESTREG,HWRD8       SUBSTRACT 8              LD @ZA02333 35638003
         OI    DISP5(TESTREG),FIRSTPCI  TURN ON FIRST PCI   LD @ZA02333 35638403
         MVI   DISP8(TESTREG),X02  CHANGE TIC TO RD SKIP    LD @ZA02333 35638803
AUTOTEST EQU   *                                            LD @ZA02333 35639203
         TM    17(UCBREG),AUTOPOLL     AUTOPOLL DEVICE?        @YA02157 35640002
         BZ    EXCP                    GO SET UP CHAN PGM      @YA02157 35642002
         OI    DECTYPE,X'80'           SET AUTOPOLL FLAG       @YA02157 35644002
         B     EXCP                    GO SET UP CHAN PGM      @YA02157 35650002
PACK     EQU   *                                               @YA01056 35660002
         MVC   IOBERINF+4(4),2(TESTREG)   SAVE X AND Y VALUES      000D 35700018
         PACK  IOBERINF+8(8),2(2,TESTREG) PREPARE ZONED X-OPERAND  000D 36000018
*        TWO LINES OF CODE DELETED BY APAR --------------->    @ZA13191 36050000
         OI    IOBERINF+L15,X0C         CONVERT TO PLUS SIGN   @ZA13191 36150000
*        ONE LINE OF CODE DELETED BY --------------------->    @ZA13191 36200000
         NI    IOBERINF+L15,SIGN        ZERO LOW ORDER BITS    @ZA03978 36300000
         CVB   TYPEREG,IOBERINF+DISP8                          @ZA03978 36400000
         PACK  IOBERINF+DISP8(L8),DISP4(L2,TESTREG)            @ZA03978 36500000
*                                      PREPARE ZONED Y-OPERAND @ZA03978 36600003
*        TWO LINES OF CODE DELETED BY APAR ---------------->   @ZA13191 36700000
         OI    IOBERINF+L15,X0C         CONVERT TO PLUS SIGN   @ZA13191 36900000
*        ONE LINE OF CODE DELETED BY APAR ---------------->    @ZA13191 37000000
         NI    IOBERINF+L15,SIGN        ZERO LOW ORDER BITS    @ZA03978 37200000
         CVB   PARREG,IOBERINF+DISP8                           @ZA03978 37500000
         STC   PARREG,IOBWORK           STORE Y-VALUE IN Y-COUNTER  00D 37800018
         CLI   IOBWORK,ZERO            ZERO Y COUNT INVALID      A28609 37860019
         BNE   ZEROFLD                 NO, CONTINUE              A28609 37920019
*     ONE LINE OF CODE DELETED BY ---------------------->      @ZA06398 37980003
         B     TERRB             TURN ON ERROR BIT & EXIT      @ZA06398 38040003
ZEROFLD  XC    IOBCPA(64),IOBCPA        CLEAR OUT CHAN PGM AREA  A27602 38100019
         SPACE 2                                                        38400018
         TM    DECDCBAD,ONLT           DID THIS PROGRAM ISSUE ONLTST    38700018
         BO    RFTSENT                                                  39000018
         CLC   2(2,TESTREG),ZEROS      IS X FIELD EQUAL ZERO       000D 39300018
         BE    CODE00                   IF REC D RFT AND X = 0     000D 39600018
         OI    DECDCBAD,BIT40ON        SET X FLAG IN DECB TO ONE  M4299 39900019
         SR    ADREG,ADREG              CLEAR REGISTER             000D 40200018
*        ONE LINE OF CODE DELETED BY APAR -------------->      @ZA13191 40500000
         TM    17(UCBREG),X'40'         IS THIS A MULTIPOINT LINE  000L 40700019
         BZ    POINTPT                                             000L 40900002
         CLI   6(TESTREG),X'00'                                @YA01057 40950002
         BZ    TERRB                   TURN ON ERR BIT AND RET @YA01057 41000002
         CLI   6(TESTREG),X'06'                                @YA01057 41050002
         BNH   BYPAC                                           @YA01057 41060002
TERRB    OI    IOBINCAM,X'02'          TURN ON ERROR BIT       @YA01057 41070002
         B     EXCP                                            @YA01057 41080002
BYPAC    IC    ADREG,6(TESTREG)       GET LENGTH OF 'TO' FIELD @YA01057 41090002
         BCTR  ADREG,0                 DECREMENT FOR EXECUTE       000D 41400002
         EX    ADREG,INSTRUCT           EXECUTE MOVE INSTRUCTION   000D 41700018
         LA    ADREG,1(ADREG)                                      000D 42000018
         IC    PARREG,DCBBSENQ          GET ENQ CHARACTER AND    A27602 42300019
         STC   PARREG,IOBERINF+10(ADREG)  PUT W/ ADDR CHARACTERS   000D 42600018
         LA    PARREG,IOBERINF+10      GET ADDRESS OF ADDRESSING   000D 42900018
         ST    PARREG,IOBCPA+24           CHARS AND STORE IN CCW A27602 43200019
         LA    ADREG,1(ADREG)           ADD 1 TO CHAR COUNT - ENQ  000D 43500018
         STH   ADREG,IOBCPA+30          STORE COUNT IN CHANNEL PGM27602 43600019
         BCTR  ADREG,0                                           A27611 43700019
         LA    PARREG,DCBBSEOT          GET ADDRESS OF EOT       A27602 43800019
         ST    PARREG,IOBCPA+16         GENERATE WRITE EOT CCW   A27602 43900019
TSTGENPL EQU   *                                                        43930002
         TM    IOBINCAM,GENPOLL         GENERAL POLL CTL UNIT ?         43960002
         BZ    TESTACK                  NO, TEST ACK                    43990002
         LA    PARREG,DCBBSRVI          GET ADDR OF RVI SEQUENCE        44020002
         B     STORE                    GO STORE IT IN CCW              44050002
TESTACK  TM    IOBSNDPT,ACKPTR          IS ACK TO BE ACK-0         000D 44100018
         BNZ   ACK1                     NO, GET ACK-1 ADDRESS      000D 44400018
         LA    PARREG,DCBBSAK0          GET ACK-0 ADDRESS AND      000D 44700018
STORE    ST    PARREG,IOBCPA              STORE IN CCW             000D 45000018
         LA    MUTPREG,7(TESTREG,ADREG) BUMP REGISTER TO TEXT      000D 45300018
         ST    MUTPREG,IOBCPA+40        STORE INTO CCW           A27602 45600019
         LA    PARREG,DECRESPN          GET DECB RESPONSE FIELD    000D 45900018
         ST    PARREG,IOBCPA+8            ADDRESS AND STORE IN CCW 000D 46200018
         ST    PARREG,IOBCPA+32           *                      A27602 46500019
         ST    PARREG,IOBCPA+56            *                     A27602 46800019
         LA    PARREG,DCBBSTEX          GET TRANSPARENT END CHARS  000D 47100018
         ST    PARREG,IOBCPA+48          ADDRESS AND STORE       A27602 47400019
         OC    IOBCPA(64),SENDLONG      OR IN COMPLETE CHAN PGM  A27602 47700002
         TM    IOBINCAM,RFTERR          IS ERROR BIT ON?       @YA01056 47750002
         BO    EXCP                     YES, START CHAN PGM    @YA01056 47800002
         CH    TYPEREG,BIN34         IS X AN ALLOWABLE VALUE   @ZA13191 48000000
         BNH    XCTL                   YES, LOAD PROPER MODULE     000D 48300018
*     ONE LINE OF CODE DELETED BY ---------------------->      @ZA06398 48600003
         B     TERRB                SET ERROR BIT & EXIT       @ZA06398 48660003
WRTEOT   EQU   *                                               @ZA06398 48720003
*    IF AN RFT READ ON A READ TT IS INVALID, BTAM WILL ISSUE   @ZA06398 48780003
*    A NOP TO GET BACK TO IGG019MR, WHICH WILL THEN WRITE EOT  @ZA06398 48840003
*    TO RESET THE LINE. IGG019MR WILL POST THE READ COMPLETE   @ZA06398 48900003
*    WITH EOT IN THE USER'S BUFFER.                            @ZA06398 48960003
         MVC   IOBCPA(ONECCW),RECLONG+TWOCCW  MOVE IN NOP CCW  @ZA06398 49020003
         NI    IOBCPA+CCWFLAGS,FOXFOX-CMCH TURN OFF CMD CHAIN  @ZA06398 49080003
         B     EXCP                     RETURN                 @ZA06398 49140003
         SPACE 2                                                    00D 49200018
ACK1     LA    PARREG,DCBBSAK1          GET ADDRESS OF ACK-1        00D 49500018
         B     STORE                                                00D 49800018
         SPACE 2                                                        50100018
INSTRUCT MVC   IOBERINF+10(1),7(TESTREG) MOVE ADDR. CHARS TO IOB   000D 50400018
         SPACE 2                                                        50700018
POINTPT  EQU   *                                                   000D 51000018
         IC    ADREG,6(TESTREG)         GET LENGTH OF 'TO' FIELD   000L 51100019
         LA    PARREG,DCBBSENQ         GET ENQ ADDRESS AND         000D 51300018
         ST    PARREG,IOBCPA+24         STORE IN CCW             A27602 51500019
         OI    IOBCPA+16,NOOP           PUT IN NO-OP COMMAND     A27602 51700019
         B     TESTACK                  SEE IF GEN POLL CU       S99245 51900002
CODE00   LA    PARREG,DCBBSAK1         GET ACK-1 ADDRESS AND       000D 52200018
         ST    PARREG,IOBCPA+32        STORE                      M4299 52500019
         ST    TESTREG,IOBCPA+40       STORE DATA ADDRESS IN CCW  M4299 52800019
         OC    IOBCPA+32(16),RECSHORT  OR IN COMPLETE CHAN PROG   M4299 53100019
         LH    PARREG,IOBCSW+6          LOAD THE RESIDUAL COUNT    000D 53400018
         LA    PARREG,9(PARREG)         ADD LENGTH OF RFT MESSAGE  000D 53700018
         STH   PARREG,IOBCPA+46        STORE COUNT INTO READ CCW  M4299 53900019
         LA    PARREG,IOBCPA+32        LOAD ADDRESS OF CHAN PROG  M4299 54100019
         B     EXCP2                   BRANCH TO EXECUTE          M4299 54300019
         SPACE 2                                                        54600018
RFTSENT  CLC   2(2,TESTREG),ZEROS       DOES X = 0                 000D 54900018
         BE    CODE40                   IF SO, BRANCH              000D 55200018
         OI    DECDCBAD,BIT40ON        SET X FLAG IN DECB TO ONE        55500018
         LA    PARREG,DCBBSEOT          GET EOT ADDRESS AND STORE  000D 55800018
         ST    PARREG,IOBCPA                 IN CCW              A27602 56100019
         LA    PARREG,DECRESPN          GET DECB RESPONSE FIELD    000D 56400018
         ST    PARREG,IOBCPA+24           ADDR AND STORE IN CCW    000D 56700018
         LA    PARREG,DCBBSAK0          GET ACK-0 ADDRESS AND      000D 57000018
         ST    PARREG,IOBCPA+32           STORE                    000D 57300018
         ST    TESTREG,IOBCPA+40       STORE TEXT ADDRESSS IN CCW  000D 57600018
         OC    IOBCPA(48),RECLONG       OR IN COMPLETE CHANNEL PGM 000D 57900018
         NI    IOBCPA+44,X'BF'          TURN OFF CC FLAG         A27602 57970019
         MVI   IOBCPA+7,X'01'           COUNT FOR EOT            A27602 58040019
         MVI   IOBCPA+31,X'02'          COUNT FOR RESPONSE       A27602 58110019
         B     EXCP                                                 00D 58200018
         SPACE 2                                                        58500018
CODE40   LH    PARREG,DECLNGTH         GET COUNT OF RFT MESSAGE    000D 58800018
         STH   PARREG,IOBCPA+46  STORE NEW COUNT IN CH PROG    @ZA13191 59100000
         L     MUTPREG,DECPOLPT        GET MESSAGE ADDRESS         000D 59400018
         ST    MUTPREG,IOBCPA+40        STORE IN CHANNEL PROGRAM A27602 59700019
         LA    PARREG,DCBBSTEX          LOAD ADDR OF TRANSPARENT   000D 60000018
         ST    PARREG,IOBCPA+48              END CHARS FOR CCW   A27602 60300019
         LA    PARREG,DECRESPN          GET DECB RESPONSE FIELD    000D 60600018
         ST    PARREG,IOBCPA+56              ADDR AND PUT IN CCW A27602 60900019
         OC    IOBCPA+40(24),SENDSHRT   OR IN COMPLETE CHAN PROG A27602 61200019
         CLC   0(2,MUTPREG),DCBBSTSX   IS TRANSPARENT TEXT USED    000D 61500018
         BE    LOADADDR                                                 61800018
         SPACE 2                                                        62100018
NORMAL   MVC   IOBCPA+48(8),IOBCPA+56   OVERLAY WR END CHARS     A27602 62400019
LOADADDR LA    PARREG,IOBCPA+40         GET CHANNEL PGM ADDR     A27602 62700019
         B     EXCP2                                               000D 63000018
EXCP     LA    PARREG,IOBCPA            GET CHANNEL PROGRAM ADDR    00D 63300018
EXCP2    ST    PARREG,IOBSTART         STORE IN IOB                000D 63600018
         XC    IOBUCBX+2(4),IOBUCBX+2   CLEAR COUNTERS              00D 63900018
         LR    MUTPREG,IOBREG      SAVE ADDR OF IOB         LD @ZA02332 63950003
         L     PARMREG,GETPARM     SET SUBPOOL & LENGTH     LD @ZA02332 64000003
         GETMAIN R,LV=(0)          GET 8 BYTES FOR ECB      LD @ZA02332 64050003
         LR    LENGTREG,IOBREG     SAVE NEW ECB ADDR        LD @ZA02332 64100003
         LR    IOBREG,MUTPREG      RESTORE IOB ADDR         LD @ZA02332 64150003
         ST    DECBREG,DISP4(LENGTREG) SAVE DECB ADDR       LD @ZA02332 64200003
         MVI   DISP4(LENGTREG),FOXFOX  FLAG AS DUMMY        LD @ZA02332 64250003
         STCM  LENGTREG,MASK,IOBECBPT+DISP1 POINT IOB...    LD @ZA02332 64300003
*                                  ...TO DUMMY              LD @ZA02332 64350003
         SVC   ZERO                EXCP                     LD @ZA02332 64400003
         STCM  DECBREG,MASK,IOBECBPT+DISP1  REPOINT IOB...  LD @ZA02332 64450003
*                                  ...TO DECB               LD @ZA02332 64500003
         L     PARMREG,GETPARM     SET UP FOR FREEMAIN      LD @ZA02332 64550003
         FREEMAIN R,LV=(0),A=(LENGTREG) FREE DUMMY ECB      LD @ZA02332 64600003
         SVC   3                       RETURN                      000D 65100018
         SPACE 2                                                    00D 65400018
XCTL     SLL   TYPEREG,1                MULTIPLY INDEX BY 2        000D 65700002
         LH    PARREG,NAMTABLE-CHAR2(TYPEREG) GET ID OF NEXT            66030002
         SRL   TYPEREG,1            RESTORE XX VALUE               4122 66040002
         STC   PARREG,IOBERCCW+4        STORE IN MODULE NAME            66070002
         SRL   PARREG,8                                                 66140002
         STC   PARREG,IOBERCCW+3                                        66210002
LOADIT   LA    PARREG,IOBERCCW         GET ADDRESS OF MODULE NAME  000D 66300018
         XCTL  EPLOC=(3)               LINK TO NEXT LOAD           000D 66600018
         SPACE 4                                                        66900018
         SPACE 2                                                   000D 67200018
NAMTABLE DC    CL2'07'    X=1 MESSAGE                              000D 67500002
         DC    CL2'08'    TRANSPARENT EBCDIC MESSAGE               000D 67800002
         DC    CL2'07'    X=TRANSPARENT USASCII MESSAGE             00D 68100002
         DC    CL2'08'    X=NORMAL EBCDIC MESSAGE                   00D 68400002
         DC    CL2'07'    X=NORMAL USASCII MESSAGE                  00D 68700002
         DC    CL2'07'    X=ALPHAMERIC USASCII MESSAGE              00D 69000002
         DC    CL2'07'    X=USASCII PRINTER MESSAGE                 00D 69300002
         DC    CL2'07'    X=USASCII PUNCH MESSAGE                   00D 69600002
         DC    CL2'07'    X=TRANSCODE PRINTER MESSAGE               00D 69900002
         DC    CL2'07'    X=TRANSCODE PUNCH MESSAGE                 00D 70200002
         DC    CL2'07'    X=TRANSCODE MULTIPOINT MESSAGE            00D 70500002
         DC    CL2'08'    X=EBCDIC PRINTER MESSAGE                  00D 70800002
         DC    CL2'08'    X=EBCDIC PUNCH MESSAGE                    00D 71100002
         DC    CL2'08'    X=EBCDIC ALPHAMERIC MESSAGE               00D 71400002
         DC    CL2'08'    X=EBCDIC WEAK PATTERN MSG -SWITCHED       00D 71700002
         DC    CL2'08'    X=EBCDIC WEAK PATTERN MSG -LEASED         00D 72000002
         DC    CL2'07'    X=TRANSCODE WEAK PATRN - SWITCHED         00D 72300002
         DC    CL2'07'    X=TRANSCODE WEAK PATRN - LEASED           00D 72600002
         DC    CL2'08'    X=EBCDIC WEAK PATRN -DLE SYN INSERTN      00D 72900002
         DC    CL2'08'    X=EBCDIC 80 CHAR TRANSPARENT MESSAGE     000L 72970002
         DC    CL2'08'    X=EBCDIC 120 CHAR TRANSPARENT MESSAGE    000L 73040002
         DC    CL2'08'    X=EBCDIC 144 CHAR TRANSPARENT MESSAGE    000L 73110002
         DC    CL2'0E'    3270 BASIC EBCDIC                             73116002
         DC    CL2'0E'    3270 MOD 1 ALIGN EBCDIC                       73122002
         DC    CL2'14'    3270 MOD 2 ALIGN EBCDIC                       73128002
         DC    CL2'0F'    3270 ORDERS EBCDIC                            73134002
         DC    CL2'0F'    3270 BASIC PRINTER EBCDIC                     73140002
         DC    CL2'13'    3270 NL/EOM PRINTER EBCDIC                    73146002
         DC    CL2'10'    3270 BASIC ASCII                              73152002
         DC    CL2'10'    3270 MOD 1 ALIGN ASCII                        73158002
         DC    CL2'11'    3270 MOD 2 ALIGN ASCII                        73164002
         DC    CL2'10'    3270 ORDERS ASCII                             73170002
         DC    CL2'11'    3270 BASIC PRINTER ASCII                      73176002
         DC    CL2'11'    3270 NL/EOM PRINTER ASCII                     73182002
         SPACE 2                                                        73200018
ZEROS    DC    4X'F0'                                                   73500018
  SPACE  2                                                              73800018
         DS    0D                ALLIGNMENT FOR CCWS                    74100018
SENDLONG DC    X'01'                    *                          000D 74400018
         DC    AL3(0)                   **   WRITE RESPONSE CCW    000D 74700018
         DC    X'60400002'              ***                        000D 75000018
         DC    X'02'                    *                          000D 75300018
         DC    AL3(0)                   **   READ TEXT CCW         000D 75600018
         DC    X'20400002'              ***                        000D 75900018
         DC    X'01'                    *                        A27602 75970019
         DC    AL3(0)                   **   WRITE EOT           A27602 76040019
         DC    X'60400001'              ***                      A27602 76110019
         DC    X'01'                    *                          000D 76200018
         DC    AL3(0)                   **   WRITE ENQ CCW         000D 76500018
         DC    X'60400001'              ***                        000D 76800018
         DC    X'02'                    *                          000D 77100018
         DC    AL3(0)                   **   READ RESPONSE CCW     000D 77400018
         DC    X'20C00002'              ***                        000D 77700018
SENDSHRT DC    X'01'                    *                          000D 78000018
         DC    AL3(0)                   **   WRITE TEXT CCW        000D 78300018
         DC    X'60000000'              ***                        000D 78600018
         DC    X'01'                    *                          000D 78900018
         DC    AL3(0)                   **   WRITE ENDING CHARS CCW000D 79200018
         DC    X'60000002'              ***                        000D 79500018
         DC    X'02'                    *                          000D 79800018
         DC    AL3(0)                   **   READ RESPONSE CCW     000D 80100018
         DC    X'20800002'              ***                        000D 80400018
RECLONG  DC    X'01'                    *                        A27602 81100019
         DC    AL3(0)                   **   WRITE EOT CCW         000D 81900018
         DC    X'60400001'              **                         000D 82200018
         DC    X'06'                    *                          000D 82500018
         DC    AL3(0)                   **   PREPARE CCW           000D 82800018
         DC    X'60400001'              ***                        000D 83100018
         DC    X'03'                    *                        A27602 83170019
         DC    AL3(0)                   **                       A27602 83240019
         DC    X'60400001'              ***  NO-OP CCW           A27602 83310019
         DC    X'02'                    *                          000D 83400018
         DC    AL3(0)                   **   READ ENQ CCW          000D 83700018
         DC    X'20C00002'              ***                        000D 84000018
RECSHORT DC    X'01'                    *                          000D 84300018
         DC    AL3(0)                   **                         000D 84600018
         DC    X'60000002'              ***  WRITE RESPONSE CCW    000D 84900018
         DC    X'02'                    *                          000D 85200018
         DC    AL3(0)                   **   READ TEXT CCW         000D 85500018
         DC    X'2080012C'              ***                        000D 85800018
GETPARM  DC    X'FA000008'         SUBPOOL # AND LENGTH     LD @ZA02332 85850003
FOXFOX   EQU   X'FF'               ALL ONES                 LD @ZA02332 85900003
MASK     EQU   7                   MASK FOR STCM            LD @ZA02332 85950003
         SPACE 2                                                        86100018
BIN34    DC    H'34'                    MAXIMUM TEST NUMBER    @ZA13191 86200000
HWRD8    DC    X'0008'                                      LD @ZA02333 86250003
CHAR2    EQU   2                   LENGTH OF ID IN NAMTABLE             86255000
DYNBUF   EQU   X'08'                                        LD @ZA02333 86260003
FIRSTPCI EQU   X'40'                                        LD @ZA02333 86270003
ZERO     EQU   X'00'                                             A28609 86300019
P0       EQU   X'15'                                                    86400018
ENQCHAR  EQU   X'2D'                                               000D 86700018
ONLT     EQU   X'80'                                                    87000018
BIT40ON  EQU   X'40'                                                    87300018
SIGN     EQU   X'FC'                                                00D 87600018
ZONEOFF  EQU   X'0F'                                                00D 87900018
ACKPTR   EQU   X'FF'                                                00D 88200018
NOOP     EQU   X'03'                    CHANGE WRITE TO NO-OP    A27602 88300019
GENPOLL  EQU   X'10'               GEN POLL CTL UNIT BIT                88400002
XXDISP   EQU   2                   DISP OF XX VALUE IN STD RFT @YA01056 88450002
XXYYLNG  EQU   4                   LENGTH OF XX,YY FIELDS      @YA01056 88460002
NUMERIC  EQU   X'F0'               NUMERIC ZONE                @YA01056 88470002
INCR     EQU   1                   USED TO INCR CTR BY 1       @YA01056 88480002
RFTERR   EQU   X'02'               RFT ERROR BIT IN IOBINCAM   @YA01056 88490002
READTT   EQU   X'03'                    READ CONTINUE OP TYPE  @YA02157 88492002
FLIP     EQU   X'02'                    ACK POINTER FLIPPER    @YA02157 88494002
AUTOPOLL EQU   X'40'                    AUTOPOLL FLAG IN DECB  @YA02157 88496002
DISP1    EQU   1                                            LD @ZA02332 88498003
L2       EQU   2                                               @ZA03978 88498203
DISP4    EQU   4                                            LD @ZA02332 88498403
L4       EQU   4                                               @ZA03978 88498603
DISP5    EQU   5                                            LD @ZA02333 88498803
DISP8    EQU   8                                            LD @ZA02333 88499203
L8       EQU   8                                               @ZA03978 88499303
L15      EQU   15                                              @ZA03978 88499403
X02      EQU   X'02'               READ SKIP OP-CODE        LD @ZA02333 88499603
X0C      EQU   X'0C'                                           @ZA13191 88499700
X30      EQU   X'30'                                           @ZA03978 88499803
ONECCW   EQU   8          LENGTH OF ONE CCW                    @ZA06398 88499903
TWOCCW   EQU   16        LENGTH OF TWO CCWS                    @ZA06398 88500003
CCWFLAGS EQU   4         DISPLACEMENT IN CCW FLAGS             @ZA06398 88570003
CMCH     EQU   X'40'      COMMAND CHAINING BIT                 @ZA06398 88640003
         EJECT                                                          88710003
         CNOP   0,8                                                     88800018
         DCBD  DSORG=BX,DEVD=BS                                         89100018
         EJECT                                                          89150002
         IECTDECB                                                       89400018
         EJECT                                                          89450002
         IECTDEBX                                                       89700018
         EJECT                                                          89750002
         IECTIOBX                                                       90000018
         END                                                            90300018
./  ADD  SSI=43460635,NAME=IGC0E06F
         TITLE ' IGC0E06F - 3270 LOCAL/REMOTE EBCDIC TEST MODULE '      00300002
IGC0E06F CSECT                                                          00600002
*********************************************************************** 00600402
*        MAINTENANCE ACTIVITY                                         * 00600802
*                                                                     * 00602802
*        ZA02332  (11/20/74)                                          * 00604803
*        ZA02334  (11/20/74)                                          * 00605303
*                                                                     * 00609302
*********************************************************************** 00614002
*             3270 LOCAL/REMOTE EBCDIC TEST MODULE                    * 00618402
*********************************************************************** 00622802
*                                                                     * 00627202
* STATUS:                                                             * 00631602
*    CHANGE LEVEL 000         NOVEMBER 5, 1971                        * 00636002
*                                                                     * 00640402
* FUNCTION:                                                           * 00644802
*    THIS MODULE BUILDS PREDEFINED EBCDIC ON-LINE TEST MESSAGES       * 00649202
*    FOR THE 3270 DISPLAY SYSTEM - LOCAL OR REMOTE.                   * 00653602
*                                                                     * 00658002
* ENTRY:                                                              * 00662402
*         ENTRY IS TO THE FIRST EXECUTABLE INSTRUCTION VIA XCTL       * 00666802
*         FROM IGC0D06F(REMOTE) OR IGC1206F(LOCAL).                   * 00671202
*                                                                     * 00675602
* INPUT:                                                              * 00680002
*    REG 1 - ADDRESS OF THE IOB                                       * 00684402
*    REG 4 - TEST TYPE XX VALUE                                       * 00688802
*    IOBERINF - ADDRESS OF THE RFT                                    * 00693202
*    ON-LINE TEST CHANNEL PROGRAM IN IOB, BUILT BY IGC0D06F           * 00697602
*    (REMOTE) OR IGC1206F (LOCAL).                                    * 00702002
*                                                                     * 00706402
* OUTPUT:                                                             * 00710802
*    LOCAL--                                                          * 00715202
*                                                                     * 00719602
*    TEST MESSAGE (MINUS LINE CONTROL) BUILT IN USER'S AREA.          * 00724002
*    COUNT INSERTED IN ERASE/WRITE CCW.                               * 00728402
*    IF THE USER'S BUFFER IS NOT LONG ENOUGH (300) BYTES OR           * 00732802
*    THE TEST MESSAGE NUMBER IS INVALID, AN ERROR FLAG (IOBINCAM,     * 00737202
*    BYTE 0, BIT 6) IS TURNED ON, AND A NOP REPLACES THE ERASE/       * 00741602
*    WRITE CCW. THIS WILL CAUSE IGG019PI TO CANCEL THE TEST BY        * 00746002
*    RE-ISSUING THE USER'S READ INITIAL.                              * 00750402
*                                                                     * 00754802
*    REMOTE--                                                         * 00759202
*                                                                     * 00763602
*    TEST MESSAGE BUILT IN USER'S AREA.                               * 00768002
*    COUNT IN WRITE TEXT CCW.                                         * 00772402
*    IF AN ERROR IS FOUND, THE ERROR FLAG (SEE LOCAL) IS TURNED       * 00776802
*    ON TO CAUSE IGG019MR TO CANCEL THE TEST.                         * 00781202
*                                                                     * 00785602
*    TESTS BUILT BY THIS MODULE:                                      * 00790002
*                                                                     * 00794402
*    TEST 23 - 3270 BASIC EBCDIC                                      * 00798802
*    TEST 24 - 3270 MODEL 1 ALIGN EBCDIC                              * 00803202
*                                                                     * 00807602
* EXTERNAL REFERENCES:                                                * 00812002
*         SVC 0 - EXECUTE CHANNEL PROGRAM                             * 00816402
*                                                                     * 00820802
* EXITS, NORMAL:                                                      * 00825202
*         SVC 3 - RETURN TO IOS                                       * 00829602
*                                                                     * 00834002
* EXITS, ERROR:                                                       * 00838402
*         NONE                                                        * 00842802
*                                                                     * 00847202
* TABLES/WORK AREAS:                                                  * 00851602
*         NONE                                                        * 00856002
*                                                                     * 00860402
* ATTRIBUTES:                                                         * 00864802
*    RE-ENTRANT                                                       * 00869202
*                                                                     * 00873602
* CHARACTER CODE DEPENDENCY:                                          * 00878002
*    NONE                                                             * 00882402
*                                                                     * 00886802
*********************************************************************** 00891202
       EJECT                                                            00895602
*/*IGC0E06F: CHART*/                                                    00900002
*/* E IGC0E06F*/                                                        01200002
*/* D (YES,,NO,SETERR) IS BUFFER LONG ENOUGH (300 BYTES)*/              01500002
*/* D (YES,,NO,SETERR) IS TEST NUMBER VALID (23 OR 24)*/                01800002
*/* P GET MESSAGE LENGTH AND ADDRESS*/                                  02100002
*/*TESTLCL: D (YES,LOCAL,NO,REMOTE) IS DEVICE A LOCAL 3270*/            02400002
*/*LOCAL: D (NO,,YES,ISSUENOP) IS ERROR FLAG ON*/                       02700002
*/* P POINT MESSAGE ADDRESS PAST STX, ESC, AND CMD CODE*/               03000002
*/* P STORE ADDR OF START OF RFT IN CCW*/                               03300002
*/* P (,MOVEIN) GET ADDRESS OF START OF CCW*/                           03600002
*/*REMOTE: D (NO,,YES,REMOTERR) IS ERROR FLAG ON*/                      03900002
*/* P OVERLAY TRANSPARENT CCW*/                                         04200002
*/* P GET ADDR OF CCW*/                                                 04500002
*/* P STORE ADDR OF START OF RFT IN CCW*/                               04800002
*/*MOVEIN: P (,STARTEST) MOVE MESSAGE INTO USER'S BUFFER*/              05100002
*/*SETERR: M (,TESTLCL) TURN ON ERROR FLAG*/                            05400002
*/*ISSUENOP: P SET COUNT TO ONE*/                                       05700002
*/* P (,STARTEST) MOVE NOP COMMAND INTO CCW*/                           06000002
*/*REMOTERR: P SET COUNT TO ONE*/                                       06300002
*/*STARTEST: P STORE COUNT IN CCW*/                                     06600002
*/* P SAVE THE ECB*/                                                    06900002
*/* L SVC 0*/                                                           07200002
*/* P RESTORE THE ECB*/                                                 07500002
*/* R SVC 3*/                                                           07800002
*/*IGC0E06F: END*/                                                      07900002
       EJECT                                                            08000002
         SPACE 2                                                        08100002
*        ESTABLISH ADDRESSABILITY                                       08400002
         SPACE                                                          08700002
         BALR  BASEREG,0           SET UP BASE REG                      09000002
         USING *,BASEREG                                                09300002
         USING IECTIOB,IOBREG      IOB DSECT                            09600002
         USING IECTDECB,DECBREG    DECB DSECT                           09900002
         USING IHADCB,DCBREG       DCB DSECT                            10200002
         USING IECTDEB,DEBREG      DEB DSECT                            10500002
         USING UCBDSECT,UCBREG     UCB DSECT                            10800002
         B     SETUP               BRANCH AROUND ID USED TO             11100002
         DC    C'IGC0E06F'         FIND MODULE IN DUMP                  11400002
         DC    C' 4322'            DATE LAST CHANGE         LD @ZA02334 11450000
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY       LD @ZA02334 11500003
         DS    0H                                           LD @ZA02334 11550003
PATCH    DC    40X'00'             PATCH AREA               LD @ZA02334 11600003
         DS    0H                                           LD @ZA02334 11650003
SETUP    EQU   *                                                        11700002
         L     DECBREG,IOBECBPT    GET DECB ADDR                        12000002
         L     DCBREG,IOBDCBPT     GET DCB ADDR                         12300002
         L     DEBREG,DCBDEBAD     GET DEB ADDR                         12600002
         L     DEBREG,PREFIX(DEBREG) GO PAST PREFIX                     12900002
         L     RFTREG,IOBERINF     GET ADDR OF RFT                      13000002
         SPACE 2                                                        13200002
*        VALIDITY CHECK BUFFER LENGTH AND TEST NUMBER. IF               13500002
*        INVALID, SET UP NOP CCW AND TURN ON ERROR FLAG.                13800002
         SPACE                                                          14100002
         CLC   DECLNGTH(LNGTH2),MINBUF IS BUFFER LONG ENOUGH            14400002
         BL    SETERR              NO, SET UP FOR ERROR                 14700002
         C     TESTREG,TEST23      IS IT TEST # 23 ?                    15000002
         BE    GETINFO             YES, GET MSG ADDR & COUNT            15300002
         C     TESTREG,TEST24      IS IT TEST # 24 ?                    15600002
         BNE   SETERR              NO, SET UP FOR ERROR                 15900002
         SPACE 2                                                        16200002
*        GET TEST MESSAGE ADDRESS AND LENGTH                            16500002
         SPACE                                                          16800002
GETINFO  LR    WORKREG1,TESTREG    GET TEST #                           17100002
         S     WORKREG1,TEST23     SUBTRACT 23 TO GET INDEX             17400002
*                                  (23 IS LOWEST TEST NUMBER            17700002
*                                  THIS MODULE WILL HANDLE)             18000002
         SLL   WORKREG1,2          MULTIPLY BY 4                        18300002
         L     COUNTREG,COUNTAB(WORKREG1) GET MSG LENGTH                18600002
         B     ADDRTAB(WORKREG1)   GET MSG ADDR                         18900002
         SPACE 2                                                        19200002
*        MESSAGE ADDRESS AND LENGTH TABLES - (TEST MESSAGE              19500002
*        NUMBER - 23) X 4 = THE ARGUMENT USED TO OBTAIN VALUES          19800002
*        FROM THE TABLE.                                                20100002
         SPACE                                                          20400002
         DS    0F                                                       20700002
COUNTAB  EQU   *                   MESSAGE LENGTH IN BYTES              21000002
         DC    A(TST23SZ)          00   TEST # 23                       21300002
         DC    A(TST24SZ)          04   TEST # 24                       21600002
         SPACE 2                                                        21900002
ADDRTAB  EQU   *                   ADDRESS OF TEST MESSAGE              22200002
         B     TEST23AD            00   GET TEST 23 ADDR                22500002
         B     TEST24AD            04   GET TEST 2J ADDR                22800002
TEST23AD LA    ADDREG,IJLBOT23     GET ADDR                             23100002
         B     TESTLCL             CONTINUE                             23400002
TEST24AD LA    ADDREG,IJLBOT24     GET ADDR                             23700002
         SPACE 2                                                        24000002
*        TEST FOR LOCAL OR REMOTE                                       24300002
         SPACE                                                          24600002
TESTLCL  EQU   *                                                        24900002
         SR    UCBREG,UCBREG       CLEAR REG FOR IC                     25200002
         IC    UCBREG,IOBUCBX      GET INDEX TO UCB                     25500002
         SLL   UCBREG,2            MULTIPLY BY FOUR                     25800002
         L     UCBREG,DEBUCBAD(UCBREG)  GET ADDR OF UCB                 26100002
         CLI   DVCLASS,GRAPHIC     IS DVC A GRAPHIC ?                   26400002
         BNE   REMOTE              NO, SET UP FOR REMOTE                26700002
         CLI   UNITYPE,A3277       IS DVC A 3277 ?                      27000002
         BE    LOCAL               YES, SET UP FOR LOCAL                27300002
         CLI   UNITYPE,A3284       IS DVC A 3284 ?                      27600002
         BE    LOCAL               YES, SET UP FOR LOCAL                27900002
         CLI   UNITYPE,A3286       IS DVC A 3286 ?                      28200002
         BNE   REMOTE              NO, SET UP FOR REMOTE                28500002
*        FOR LOCAL DEVICES, STRIP OFF STX, ESC, CMD CODE, AND           28800002
*        ETX OF MESSAGE                                                 29100002
         SPACE                                                          29400002
LOCAL    EQU   *                                                        29700002
         LA    CCWREG,IOBCPA       GET ADDR OF CCW                      29800002
         TM    IOBINCAM,ERFLAG     IS ERROR FLAG ON ?                   30000002
         BO    ISSUENOP            YES, GO ISSUE NOP                    30300002
         LA    WORKREG2,LCLNGTH    SUBTRACT 4 FROM LENGTH               30600002
         SR    COUNTREG,WORKREG2   OF MESSAGE                           30900002
         LA    ADDREG,LINECTL(ADDREG) POINT MSG ADDR PAST               31200002
*                                  STX, ESC, CMD CODE                   31500002
         LA    RFTREG,TENCHARS(RFTREG) ADJUST POINTER PAST RFT          32100002
         B     MOVEIN              GO SET UP MSG                        32700002
         SPACE 2                                                        33000002
*        FOR REMOTE, LEAVE MSG ADDRESS AND LENGTH ALONE                 33300002
         SPACE                                                          33600002
REMOTE   EQU   *                                                        33900002
         LA    WORKREG2,IOBCPA     STORE ADDR OF IOBCPA          S99245 33950002
         ST    WORKREG2,IOBSTART   INTO IOBSTART                 S99245 33960002
         LA    CCWREG,IOBCPA+40    GET ADDR OF CCW                      34000002
         TM    IOBINCAM,ERFLAG     IS ERROR FLAG ON ?                   34200002
         BO    REMOTERR            YES, ISSUE CCW                       34500002
         MVC   IOBCPA+48(CCWLNGTH),IOBCPA+56 OVERLAY TRANS CCW          34800002
         CLI   NVALUE(RFTREG),NOADDR   IS THIS A DIAL RFT?       S99245 34850002
         BNE   BSC3RFT             NO,FOLLOW BSC3 PROCEDURE      S99245 34900002
         LA    RFTREG,CHARS7(RFTREG)   ADJUST PTR PAST RFT       S99245 34950002
         B     MOVEIN              GO SET UP MSG                 S99245 35000002
BSC3RFT  EQU   *                                                 S99245 35050002
         LA    RFTREG,CHARS11(RFTREG) ADJUST PTR PAST RFT               35400002
         SPACE 2                                                        36000002
*        MOVE TEST MSG INTO USER'S BUFFER                               36300002
         SPACE                                                          36600002
MOVEIN   EQU   *                                                        36900002
         SR    WORKREG2,WORKREG2   CLEAR REG                            37500002
         C     COUNTREG,MAXLNGTH   IS MSG LNGTH OVER 256 ?              37800002
         BNH   LNGTHOK             NO, BRANCH                           38100002
         LR    WORKREG2,COUNTREG   GET EXCESS OVER 256                  38400002
         S     WORKREG2,MAXLNGTH                                        38700002
         L     COUNTREG,MAXLNGTH   SET COUNT TO 256                     39000002
LNGTHOK  EQU   *                                                        39300002
         BCTR  COUNTREG,ZERO       SUBTRACT 1 FROM LNGTH FOR            39600002
*                                  EXECUTE                              39900002
         EX    COUNTREG,MSGMOVE    MOVE TEST MSG INTO USER'S            40200002
*                                  BUFFER                               40500002
         LTR   WORKREG2,WORKREG2   ANY MORE TO MOVE ?                   40800002
         BZ    STARTEST            NO,BRANCH                            41100002
         A     RFTREG,MAXLNGTH     BUMP ADDRESS PAST 256                41400002
         A     ADDREG,MAXLNGTH     CHARS JUST MOVED                     41700002
         BCTR  COUNTREG,ZERO       SUBTRACT 1 FOR EXECUTE               42000002
         EX    WORKREG2,MSGMOVE    MOVE REMAINDER OF TEXT               42300002
         B     STARTEST            BRANCH AROUND EXECUTE                42600002
MSGMOVE  MVC   0(FILLIN,RFTREG),0(ADDREG) MOVE TEST MSG TO              42900002
*                                  USER'S BUFFER, USING LENGTH          43200002
*                                  SPECIFIED IN COUNTREG                43500002
       SPACE 2                                                          43560002
*      IF AN ERROR WAS FOUND, TURN ON ERROR FLAG AND GO GET             43620002
*      ADDRESS OF CCW.                                                  43680002
       SPACE                                                            43740002
SETERR   EQU   *                                                        43800002
         OI    IOBINCAM,ERFLAG     TURN ON ERROR FLAG                   44100002
         B     TESTLCL             GO SEE IF LOCAL                      44400002
       SPACE 2                                                          44470002
*      FOR ERROR IN LOCAL, SET UP A NOP CCW                             44540002
       SPACE                                                            44610002
ISSUENOP EQU   *                                                        44700002
         LA    COUNTREG,ONECHAR    SET COUNT TO ONE                     45000002
         MVI   0(CCWREG),NOP       MOVE IN NOP COMMAND                  45300002
         B     STARTEST            GO ISSUE NOP                         45600002
       SPACE 2                                                          45670002
*      FOR REMOTE ERROR, SET COUNT IN WRITE TEXT CCW TO ONE             45740002
       SPACE                                                            45810002
REMOTERR EQU   *                                                        45900002
         LA    COUNTREG,ONECHAR    SET COUNT TO ONE                     46200002
         B     STARTEST            DO TEST                              46500002
         SPACE 2                                                        46800002
*        MOVE COUNT INTO CCW AND START TEST                             47100002
         SPACE                                                          47400002
STARTEST EQU   *                                                        47700002
         LA    COUNTREG,ONECHAR(COUNTREG) RESTORE COUNT                 48000002
         STH   COUNTREG,BYTECNT(CCWREG) STORE COUNT IN CCW              48300002
*                                                                       48350002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 48400003
*                                                                       48450002
         LR    WORKREG1,IOBREG     SAVE IOB REG             LD @ZA02332 48500003
         L     PARMREG,GETPARM     SET SOBPOOL & LENGTH     LD @ZA02332 48550003
         GETMAIN R,LV=(0)          GETMAIN FOR ECB          LD @ZA02332 48600003
         LR    WORKREG2,IOBREG     SAVE ADDR OF ECB         LD @ZA02332 48650003
         ST    DECBREG,DISP4(WORKREG2)  SAVE ADDR OF DECB   LD @ZA02332 48700003
         MVI   DISP4(WORKREG2),FOXFOX  FLAG AS DUMMY ECB    LD @ZA02332 48750003
         LR    IOBREG,WORKREG1     RESTORE IOB REGISTER     LD @ZA02332 48800003
         STCM  WORKREG2,MASK,IOBECBPT+DISP1  POINT IOB...   LD @ZA02332 48850003
*                                  ...TO DUMMY              LD @ZA02332 48860003
         SVC   ZERO                EXCP                     LD @ZA02332 48870003
         STCM  DECBREG,MASK,IOBECBPT+DISP1  REPOINT IOB...  LD @ZA02332 48880003
*                                  ...TO DECB               LD @ZA02332 48890003
         L     PARMREG,GETPARM     SET FOR FREEMAIN         LD @ZA02332 48892003
         FREEMAIN R,LV=(0),A=(WORKREG2) FREE DUMMY ECB      LD @ZA02332 48894003
*                                                                       48944002
*              2 LINES DELETED FOR ----->                   LD @ZA02332 48994003
*                                                                       49044002
         SVC   RETURN              RETURN                               49500002
         SPACE 2                                                        49800002
         SPACE                                                          50700002
         SPACE 2                                                        51000002
*        REGISTER EQUATES                                               51300002
         SPACE                                                          51600002
PARMREG  EQU   0                   PARAMETER REGISTER       LD @ZA02332 51650003
IOBREG   EQU   1                   ADDR OF IOB                          51900002
DECBREG  EQU   2                   ADDR OF DECB                         52200002
DCBREG   EQU   3                   ADDR OF DCB                          52500002
TESTREG  EQU   4                   TEST #                               52800002
WORKREG1 EQU   5                   WORK REG                             53100002
WORKREG2 EQU   6                   WORK REG                             53400002
DEBREG   EQU   7                   ADDR OF DEB                          53700002
UCBREG   EQU   8                   ADDR OF UCB                          54000002
ADDREG   EQU   9                   TEST MSG ADDRESS                     54300002
COUNTREG EQU   10                  TEST MSG LENGTH                      54600002
CCWREG   EQU   11                  ADDR OF CCW TO WRITE TEST MSG        54900002
BASEREG  EQU   12                                                       55200002
RFTREG   EQU   13                  ADDR OF RFT IN USER'S                55500002
*                                  BUFFER                               55800002
ZERO     EQU   0                   USED IN BCTR TO DECREMENT            55900002
         SPACE 2                                                        56100002
*        MISCELLANEOUS EQUATES                                          56400002
         SPACE                                                          56700002
A3286    EQU   X'0B'               3286 DEVICE TYPE                     57000002
A3284    EQU   X'0A'               3284 DEVICE TYPE                     57300002
A3277    EQU   X'09'               3277 DEVICE TYPE                     57600002
GRAPHIC  EQU   X'10'               GRAPHICS DEVICE TYPE                 57900002
NOP      EQU   X'03'               NOP COMMAND CODE                     58200002
ERFLAG   EQU   X'02'               ERROR FLAG                           58500002
TENCHARS EQU   10                  LENGTH OF STANDARD RFT - LOCAL       58501002
CHARS11  EQU   11                  LENGTH OF STANDARD RFT - REMOTE      58502002
PREFIX   EQU   28                  DISP IN DEB PAST PREFIX              58505002
LNGTH2   EQU   2                   LNGTH OF DECLNGTH FIELD              58510002
LCLNGTH  EQU   4                   NO. OF LINE CONTROL CHARS            58515002
LINECTL  EQU   3                   # OF LINE CONTROL CHARS              58520002
*                                   PRECEDING MSG                       58525002
CCWLNGTH EQU   8                   LENGTH OF A CCW                      58530002
FILLIN   EQU   0                   LENGTH FILLED IN EX INSTR            58535002
ONECHAR  EQU   1                   ONE CHARACTER                        58540002
BYTECNT  EQU   6                   DISP IN CCW OF BYTE COUNT            58545002
EXCP     EQU   0                   EXCP SVC #                           58550002
RETURN   EQU   3                   RETURN SVC #                         58555002
NVALUE   EQU   6                   DISP INTO RFT OF N VALUE      S99245 58605002
NOADDR   EQU   X'00'               IF N=0, IT IS A DIAL RFT      S99245 58655002
CHARS7   EQU   7                   LENGTH OF STANDARD DIAL RFT   S99245 58705002
FOXFOX   EQU   X'FF'               BYTE OF ALL ONES         LD @ZA02332 58755003
MASK     EQU   7                   MASK FOR STCM            LD @ZA02332 58765003
DISP1    EQU   1                   DISPLACEMENT             LD @ZA02332 58775003
DISP4    EQU   4                   DISPLACEMENT             LD @ZA02332 58785003
         SPACE 2                                                        58800002
*        STORAGE                                                        59100002
         SPACE                                                          59400002
         DS    0F                  FULLWORD BOUNDARY        LD @ZA02332 59450003
GETPARM  DC    X'FA000008'         SUBPOOL # AND LENGTH     LD @ZA02332 59500003
MINBUF   DC    X'012C'             MINIMUM BUFFER LENGTH                59700002
TEST23   DC    F'23'               ACCEBTABLE TEST NUMBER               60000002
TEST24   DC    F'24'               ACCEPTABLE TEST NUMBER               60300002
MAXLNGTH DC    F'256'              MAX # OF CHARS FOR MVC               60600002
IJLBOT23 EQU   *                                                        60900002
         DC    X'0227F5'           STX-ESC-EWRT                         61200002
         DC    X'5F'               WCC  SOUND ALARM/RESTORE KEYBORAD/   61500002
*                                       START PRINT/40 CHAR LINE        61800002
         DC    X'11C150'           SBA 80                               62100002
         DC    X'1D60'             PROTECTED,NORMAL INTENSITY           62400002
         DC    C'ABCDEFGHIJKLMNOPQRSTUVWXYZ '  BEGIN MESSAGE            62700002
         DC    X'1D6C'             PROTECTED,NON DISPLAY                63000002
         DC   C'NON DISPLAY'       FOUND IN NON-DISPLAY AREA            63300002
         DC    X'11C260'           SBA 160                              63600002
         DC    X'1D40'             UNPROTECTED,NORMAL INTENSITY         63900002
         DC    X'13'               INSERT CURSOR                        64200002
         DC   C'COPY ABOVE IN THIS LINE    '   INSTRUCTION TO CONSOLE   64500002
         DC    X'1D40'             NORMAL INT/ UNPROTECTED              64800002
         DC    C'INSERT CK'                                             65100002
         DC    X'0000'             2 NULL CHARS                         65400002
         DC    X'1D60'             PROTECTED,NORMAL INTENSITY           65700002
         DC    X'11C3F0'           SBA 240                              66000002
         DC    X'1DE8'             PROTECTED,HIGH INTENSITY             66300002
         DC    C'<(+|&&!$*)-/;%_>?:#@''="'  SPECIAL CHARS TEST        66600002
         DC    X'1DF8'             PROTECTED,HIGH INTENSITY             66900002
         DC    C'0123456789,.-A'    NUMERIC FIELD                       67200002
         DC    X'11C540'           SBA  320                             67500002
         DC    X'1DC8'             UNPROTECTED,HIGH INTENSITY           67800002
         DC    C'COPY ABOVE IN THIS LINE ' INSTRUCTIONS TO CONSOLE      68100002
         DC    X'1DD8'             NUMERIC,UNPROTECTED,HIGH INTENSITY   68400002
         DC    X'11C5E8'           SBA 360                              68700002
         DC    X'1D60'             PROTECTED,NORMAL INTENSITY           69000002
         DC    X'11C650'           SBA 400                              69300002
         DC    X'1DE4'             PROTECTED,NORMAL INTENSITY,SELECTOR  69600002
*                                                                PEN    69900002
         DC    C'?SEL PEN TEST'    DEFINE SEL PEN AREA                  70200002
         DC    X'000000'           3 NULL CHARACTERS                    70500002
         DC    X'1DE8'             PROTECTED,HIGH INTENSITY,SELECTOR    70800002
*                                                                PEN    71100002
         DC   C'>SEL PEN TEST'     DEFINE SEL PEN FIELD                 71400002
         DC    X'03'               ETX                                  71700002
TST23SZ  EQU   *-IJLBOT23          LENGTH OF TEST 23                    71800002
IJLBOT24 EQU   *                                                        72000002
         DC    X'0227F55F'          STX-ESC-EWRT-WCC                    72300002
         DC    X'114040'           SBA 0                    LD @ZA02334 72350003
         DC    X'3C40E8C5C8'        RA 40,E -H                          72600002
         DC    X'11C14FC8C8'       SBA  79,HH                           72900002
         DC    X'11C1F7C8C8'       SBA 119,HH                           73200002
         DC    X'11C25FC8C8'       SBA 159,HH                           73500002
         DC    X'11C3C7C8C8'       SBA 199,HH                           73800002
         DC    X'11C36FC8C8'       SBA 239,HH                           74100002
         DC    X'11C4D7C8C8'       SBA 279,HH                           74400002
         DC    X'11C4BFC8C8'       SBA 319,HH               LD @ZA02334 74700003
         DC    X'11C5E7C8C8'       SBA 359,HH                           75000002
         DC    X'11C64FC8C8'       SBA 399,HH                           75300002
         DC    X'11C6F7C8'         SBA 439,H                LD @ZA02334 75600003
         DC    X'11C35BD6D6'       SBA 219,OO                           75900002
         DC    X'11C4C3D6D6'       SBA 259,OO                           76200002
         DC    X'11C45D'           SBA 285                              76500002
         DC    C'TEST PATTERN FOR 3277-1/3275-1'   TEST MESSAGE         76800002
         DC    X'11C54F'           SBA 335                              77100002
         DC    C'ALIGNMENT'                                             77400002
         DC    X'11C5F05C'         SBA 368,*                            77700002
         DC    X'1D40'             SF  40                               78000002
         DC    X'13'               INC                                  78300002
         DC   C'UNPROTECTED DATA'                                       78600002
         DC    X'11C6C6'           SBA 390                              78900002
         DC    X'1DE05C'           SF 60,*                  LD @ZA02334 79200003
         DC    X'11C6F8'           440                      LD @ZA02334 79500003
         DC    X'3CC75FC5'         RA 479,E                             79800002
         DC    C'E'                LAST E                               80100002
         DC    X'03'               ETX                                  80400002
TST24SZ  EQU   *-IJLBOT24          LENGTH OF TEST 24                    80500002
         EJECT                                                          80700002
*        DSECTS                                                         81000002
         SPACE                                                          81300002
         IECTIOBX                                                       81600002
         EJECT                                                          81900002
         IECTDECB                                                       82200002
         EJECT                                                          82500002
         DCBD  DSORG=BX,DEVD=BS                                         82800002
         EJECT                                                          83100002
         IECTDEBX                                                       83400002
         EJECT                                                          83450002
UCBDSECT DSECT                                                          83700002
         DS    0F                                                       84000002
         ORG   UCBDSECT+13                                              84300002
CHARADDR DS    CL3                 UNIT ADDR (EBCDIC)                   84600002
         ORG   UCBDSECT+18                                              84900002
DVCLASS  DS    CL1                 DEVICE CLASS                         85200002
UNITYPE  DS    CL1                 UNIT TYPE                            85500002
         ORG   UCBDSECT+36                                              85800002
RLN      DS    CL1                 RELATIVE LINE NUMBER                 86100002
      END                                                               86400002
./  ADD  SSI=43460639,NAME=IGC0F06F
         TITLE ' IGC0F06F - 3270 LOCAL/REMOTE EBCDIC TEST MODULE '      00300002
IGC0F06F CSECT                                                          00600002
         SPACE 3                                                        00610002
*********************************************************************** 00650002
*                                                                     * 00700002
*        MAINTENANCE ACTIVITY                                         * 00750002
*                                                                     * 00800002
*        ZA02332  (11/20/74)                                          * 00850003
*                                                                     * 00860002
*********************************************************************** 00870002
         EJECT                                                          00880002
*/*IGC0F06F: CHART*/                                                    00900002
*/* E IGC0F06F*/                                                        01200002
*/* D (YES,,NO,SETERR) IS BUFFER LONG ENOUGH (300 BYTES)*/              01500002
*/* D (YES,,NO,SETERR) IS TEST NUMBER VALID (26 OR 27)*/                01800002
*/* P GET MESSAGE LENGTH AND ADDRESS*/                                  02100002
*/*TESTLCL: D (YES,LOCAL,NO,REMOTE) IS DEVICE A LOCAL 3270*/            02400002
*/*LOCAL: D (NO,,YES,ISSUENOP) IS ERROR FLAG ON*/                       02700002
*/* P POINT MESSAGE ADDRESS PAST STX, ESC, AND CMD CODE*/               03000002
*/* P STORE ADDR OF START OF RFT IN CCW*/                               03300002
*/* P (,MOVEIN) GET ADDRESS OF START OF CCW*/                           03600002
*/*REMOTE: D (NO,,YES,REMOTERR) IS ERROR FLAG ON*/                      03900002
*/* P OVERLAY TRANSPARENT CCW*/                                         04200002
*/* P GET ADDR OF CCW*/                                                 04500002
*/* P STORE ADDR OF START OF RFT IN CCW*/                               04800002
*/*MOVEIN: P (,STARTEST) MOVE MESSAGE INTO USER'S BUFFER*/              05100002
*/*SETERR: M (,TESTLCL) TURN ON ERROR FLAG*/                            05400002
*/*ISSUENOP: P SET COUNT TO ONE*/                                       05700002
*/* P (,STARTEST) MOVE NOP COMMAND INTO CCW*/                           06000002
*/*REMOTERR: P SET COUNT TO ONE*/                                       06300002
*/*STARTEST: P STORE COUNT IN CCW*/                                     06600002
*/* P SAVE THE ECB*/                                                    06900002
*/* L SVC 0*/                                                           07200002
*/* P RESTORE THE ECB*/                                                 07500002
*/* R SVC 3*/                                                           07800002
*/*IGC0F06F: END*/                                                      08100002
         SPACE 2                                                        08400002
*        ESTABLISH ADDRESSABILITY                                       08700002
         SPACE                                                          09000002
         BALR  BASEREG,0           SET UP BASE REG                      09300002
         USING *,BASEREG                                                09600002
         USING IECTIOB,IOBREG      IOB DSECT                            09900002
         USING IECTDECB,DECBREG    DECB DSECT                           10200002
         USING IHADCB,DCBREG       DCB DSECT                            10500002
         USING IECTDEB,DEBREG      DEB DSECT                            10800002
         USING UCBDSECT,UCBREG     UCB DSECT                            11100002
         B     SETUP               BRANCH AROUND ID USED TO             11400002
         DC    C'IGC0F06F'         FIND MODULE IN DUMP                  11700002
         DC    C' 4322'            DATE LAST CHANGE         LD @ZA02332 11750000
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY       LD @ZA02332 11800003
         DS    0H                                           LD @ZA02332 11850003
PATCH    DC    48X'00'             PATCH AREA               LD @ZA02332 11900003
         DS    0H                                           LD @ZA02332 11950003
SETUP    EQU   *                                                        12000002
         L     DECBREG,IOBECBPT    GET DECB ADDR                        12300002
         L     DCBREG,IOBDCBPT     GET DCB ADDR                         12600002
         L     DEBREG,DCBDEBAD     GET DEB ADDR                         12900002
         L     DEBREG,28(DEBREG)   GO PAST PREFIX                       13200002
           L     RFTREG,IOBERINF     GET ADDR OF RFT                    13300002
         SPACE 2                                                        13500002
*        VALIDITY CHECK BUFFER LENGTH AND TEST NUMBER. IF               13800002
*        INVALID, SET UP NOP CCW AND TURN ON ERROR FLAG.                14100002
         SPACE                                                          14400002
         CLC   DECLNGTH(2),MINBUF  IS BUFFER LONG ENOUGH ?              14700002
         BL    SETERR              NO, SET UP FOR ERROR                 15000002
         C     TESTREG,TEST26      IS IT TEST # 26 ?                    15300002
         BE    GETINFO             YES, GET MSG ADDR & COUNT            15600002
         C     TESTREG,TEST27      IS IT TEST # 27 ?                    15900002
         BNE   SETERR              NO, SET UP FOR ERROR                 16200002
         SPACE 2                                                        16500002
*        GET TEST MESSAGE ADDRESS AND LENGTH                            16800002
         SPACE                                                          17100002
GETINFO  LR    WORKREG1,TESTREG    GET TEST #                           17400002
         S     WORKREG1,TEST26     SUBTRACT 26 TO GET INDEX             17700002
*                                  (26 IS LOWEST TEST NUMBER            18000002
*                                  THIS MODULE WILL HANDLE)             18300002
         SLL   WORKREG1,2          MULTIPLY BY 4                        18600002
         L     COUNTREG,COUNTAB(WORKREG1) GET MSG LENGTH                18900002
         B     ADDRTAB(WORKREG1)   GET MSG ADDR                         19200002
         SPACE 2                                                        19500002
*        MESSAGE ADDRESS AND LENGTH TABLES - (TEST MESSAGE              19800002
*        NUMBER - 26) X 4 = THE ARGUMENT USED TO OBTAIN VALUES          20100002
*        FROM THE TABLE.                                                20400002
         SPACE                                                          20700002
         DS    0F                                                       21000002
COUNTAB  EQU   *                   MESSAGE LENGTH IN BYTES              21300002
         DC    A(TST26SZ)          TEST 26                              21600002
         DC    A(TST27SZ)          TEST 27                              21900002
         SPACE 2                                                        22200002
ADDRTAB  EQU   *                   ADDRESS OF TEST MESSAGE              22500002
         B     TEST26AD            00   GET TEST 26 ADDR                22800002
         B     TEST27AD            04   GET TEST 27 ADDR                23100002
TEST26AD LA    ADDREG,IJLBOT26     GET ADDR                             23400002
         B     TESTLCL             CONTINUE                             23700002
TEST27AD LA    ADDREG,IJLBOT27     GET ADDR                             24000002
         SPACE 2                                                        24300002
*        TEST FOR LOCAL OR REMOTE                                       24600002
         SPACE                                                          24900002
TESTLCL  EQU   *                                                        25200002
         SR    UCBREG,UCBREG       CLEAR REG FOR IC                     25500002
         IC    UCBREG,IOBUCBX      GET INDEX TO UCB                     25800002
         SLL   UCBREG,2            MULTIPLY BY FOUR                     26100002
         L     UCBREG,DEBUCBAD(UCBREG)  GET ADDR OF UCB                 26400002
         CLI   DVCLASS,GRAPHIC     IS DVC A GRAPHIC ?                   26700002
         BNE   REMOTE              NO, SET UP FOR REMOTE                27000002
         CLI   UNITYPE,A3277       IS DVC A 3277 ?                      27300002
         BE    LOCAL               YES, SET UP FOR LOCAL                27600002
         CLI   UNITYPE,A3284       IS DVC A 3284 ?                      27900002
         BE    LOCAL               YES, SET UP FOR LOCAL                28200002
         CLI   UNITYPE,A3286       IS DVC A 3286 ?                      28500002
         BNE   REMOTE              NO, SET UP FOR REMOTE                28800002
*        FOR LOCAL DEVICES, STRIP OFF STX, ESC, CMD CODE, AND           29100002
*        ETX OF MESSAGE                                                 29400002
         SPACE                                                          29700002
LOCAL    EQU   *                                                        30000002
           LA    CCWREG,IOBCPA       GET ADDR OF CCW                    30100002
         TM    IOBINCAM,ERFLAG     IS ERROR FLAG ON ?                   30300002
         BO    ISSUENOP            YES, GO ISSUE NOP                    30600002
         LA    WORKREG2,4          SUBTRACT 4 FROM LENGTH               30900002
         SR    COUNTREG,WORKREG2   OF MESSAGE                           31200002
         LA    ADDREG,3(ADDREG)    POINT MESSAGE ADDRESS PAST           31500002
*                                  STX, ESC, CMD CODE                   31800002
         LA    RFTREG,10(RFTREG)   ADJUST PTR PAST RFT                  32700002
         B     MOVEIN              GO SET UP MSG                        33000002
         SPACE 2                                                        33300002
*        FOR REMOTE, LEAVE MSG ADDRESS AND LENGTH ALONE                 33600002
         SPACE                                                          33900002
REMOTE   EQU   *                                                        34200002
         LA    WORKREG2,IOBCPA     GET ADDR OF IOBCPA            S99245 34250002
         ST    WORKREG2,IOBSTART   AND STORE IN IOBSTART         S99245 34260002
         LA    CCWREG,IOBCPA+40    GET ADDR OF CCW                      34300002
         TM    IOBINCAM,ERFLAG     IS ERROR FLAG ON ?                   34500002
         BO    REMOTERR            YES, ISSUE CCW                       34800002
         MVC   IOBCPA+48(8),IOBCPA+56 OVERLAY TRANS CCW                 35100002
         CLI   NVALUE(RFTREG),NOADDR   IS THIS A DIAL RFT?       S99245 35150002
         BNE   BSC3RFT             NO,FOLLOW BSC3 PROCEDURE      S99245 35200002
         LA    RFTREG,CHARS7(RFTREG)   ADJUST PTR PAST RFT       S99245 35250002
         B     MOVEIN              GO SET UP MSG                 S99245 35300002
BSC3RFT  EQU   *                                                 S99245 35350002
         LA    RFTREG,11(RFTREG)   ADJUST PTR PAST RFT                  35400002
         SPACE 2                                                        36300002
*        MOVE TEST MSG INTO USER'S BUFFER                               36600002
         SPACE                                                          36900002
MOVEIN   EQU   *                                                        37200002
         SR    WORKREG2,WORKREG2   CLEAR REG                            37800002
         C     COUNTREG,MAXLNGTH   IS MSG LNGTH OVER 256 ?              38100002
         BNH   LNGTHOK             NO, BRANCH                           38400002
         LR    WORKREG2,COUNTREG   GET EXCESS OVER 256                  38700002
         S     WORKREG2,MAXLNGTH                                        39000002
         L     COUNTREG,MAXLNGTH   SET COUNT TO 256                     39300002
LNGTHOK  EQU   *                                                        39600002
         BCTR  COUNTREG,0          SUBTRACT 1 FROM LNGTH FOR            39900002
*                                  EXECUTE                              40200002
         EX    COUNTREG,MSGMOVE    MOVE TEST MSG INTO USER'S            40500002
*                                  BUFFER                               40800002
         LTR   WORKREG2,WORKREG2   ANY MORE TO MOVE ?                   41100002
         BZ    STARTEST            NO, BRANCH                           41400002
         A     RFTREG,MAXLNGTH     BUMP ADDRESS PAST 256                41700002
         A     ADDREG,MAXLNGTH     CHARS JUST MOVED                     42000002
         AR    COUNTREG,WORKREG2   ADD LENGTH TO COUNTREG       YA01228 42050002
         BCTR  WORKREG2,0          SUBTRACT 1 FOR EXECUTE               42300002
         EX    WORKREG2,MSGMOVE    MOVE REMAINDER OF TEXT               42600002
         B     STARTEST            BRANCH AROUND EXECUTE                42900002
MSGMOVE  MVC   0(0,RFTREG),0(ADDREG) MOVE TEST MSG TO                   43200002
*                                  USER'S BUFFER, USING LENGTH          43500002
*                                  SPECIFIED IN COUNTREG                43800002
SETERR   EQU   *                                                        44100002
         OI    IOBINCAM,ERFLAG     TURN ON ERROR FLAG                   44400002
         B     TESTLCL             GO SEE IF LOCAL                      44700002
ISSUENOP EQU   *                                                        45000002
         LA    COUNTREG,1          SET COUNT TO ONE                     45300002
         MVI   0(CCWREG),NOP       MOVE IN NOP COMMAND                  45600002
         B     STARTEST            GO ISSUE NOP                         45900002
REMOTERR EQU   *                                                        46200002
         LA    COUNTREG,1          SET COUNT TO ONE                     46500002
         B     STARTEST            DO TEST                              46800002
         SPACE 2                                                        47100002
*        MOVE COUNT INTO CCW AND START TEST                             47400002
         SPACE                                                          47700002
STARTEST EQU   *                                                        48000002
         LA    COUNTREG,1(COUNTREG) RESTORE COUNT AFTER EX              48300002
         STH   COUNTREG,6(CCWREG)  STORE COUNT IN CCW                   48600002
*                                                                       48650002
*              3 LINES DELETED FOR ----->                   LD @ZA02332 48700003
*                                                                       48750002
         LR    WORKREG1,IOBREG     SAVE IOB ADDR            LD @ZA02332 48800003
         L     PARMREG,GETPARM     SET FOR GETMAIN          LD @ZA02332 48850003
         GETMAIN R,LV=(0)          GETMAIN FOR ECB          LD @ZA02332 48900003
         LR    WORKREG2,IOBREG     SAVE ECB ADDR            LD @ZA02332 48950003
         ST    DECBREG,DISP4(WORKREG2)  SAVE DECB ADDR      LD @ZA02332 49000003
         MVI   DISP4(WORKREG2),FOXFOX  FLAG AS DUMMY ECB    LD @ZA02332 49050003
         LR    IOBREG,WORKREG1     RESTORE IOB REG          LD @ZA02332 49100003
         STCM  WORKREG2,MASK,IOBECBPT+DISP1  POINT IOB...   LD @ZA02332 49150003
*                                  ...TO DUMMY ECB          LD @ZA02332 49160003
         SVC   ZERO                EXCP                     LD @ZA02332 49200003
         STCM  DECBREG,MASK,IOBECBPT+DISP1  REPOINT IOB...  LD @ZA02332 49250003
*                                  ...TO DECB               LD @ZA02332 49300003
         L     PARMREG,GETPARM     SET UP FOR FREEMAIN      LD @ZA02332 49350003
         FREEMAIN R,LV=(0),A=(WORKREG2) FREE DUMMY ECB      LD @ZA02332 49400003
         SVC   3                   RETURN                               49800002
         SPACE 2                                                        50100002
*        IF AN ERROR WAS FOUND, TURN ON ERROR FLAG, GET CCW             50400002
*        ADDR, AND ISSUE NOP CCW                                        50700002
         SPACE                                                          51000002
         SPACE 2                                                        51300002
*        REGISTER EQUATES                                               51600002
         SPACE                                                          51900002
PARMREG  EQU   0                   PARAMETER REGISTER       LD @ZA02332 51950003
IOBREG   EQU   1                   ADDR OF IOB                          52200002
DECBREG  EQU   2                   ADDR OF DECB                         52500002
DCBREG   EQU   3                   ADDR OF DCB                          52800002
TESTREG  EQU   4                   TEST #                               53100002
WORKREG1 EQU   5                   WORK REG                             53400002
WORKREG2 EQU   6                   WORK REG                             53700002
DEBREG   EQU   7                   ADDR OF DEB                          54000002
UCBREG   EQU   8                   ADDR OF UCB                          54300002
ADDREG   EQU   9                   TEST MSG ADDRESS                     54600002
COUNTREG EQU   10                  TEST MSG LENGTH                      54900002
CCWREG   EQU   11                  ADDR OF CCW TO WRITE TEST MSG        55200002
BASEREG  EQU   12                                                       55500002
RFTREG   EQU   13                  ADDR OF RFT                          55800002
         SPACE 2                                                        56100002
*        MISCELLANEOUS EQUATES                                          56400002
         SPACE                                                          56700002
A3286    EQU   X'0B'               3286 DEVICE TYPE                     57000002
A3284    EQU   X'0A'               3284 DEVICE TYPE                     57300002
A3277    EQU   X'09'               3277 DEVICE TYPE                     57600002
GRAPHIC  EQU   X'10'               GRAPHICS DEVICE TYPE                 57900002
NOP      EQU   X'03'               NOP COMMAND CODE                     58200002
ERFLAG   EQU   X'02'               ERROR FLAG                           58500002
NVALUE   EQU   6                   DISP INTO RFT OF N VALUE      S99245 58550002
NOADDR   EQU   X'00'               IF N=0, IT IS A DIAL RFT      S99245 58600002
CHARS7   EQU   7                   LENGTH OF STANDARD DIAL RFT   S99245 58650002
FOXFOX   EQU   X'FF'               BYTE OF ALL ONES         LD @ZA02332 58700003
MASK     EQU   7                   MASK FOR STCM            LD @ZA02332 58750003
DISP1    EQU   1                   DISPLACEMENT             LD @ZA02332 58760003
DISP4    EQU   4                   DISPLACEMENT             LD @ZA02332 58770003
ZERO     EQU   0                                            LD @ZA02332 58780003
         SPACE 2                                                        58800002
*        STORAGE                                                        59100002
         SPACE                                                          59400002
         DS    0F                  FULLWORD BOUNDARY        LD @ZA02332 59450003
GETPARM  DC    X'FA000008'         SUBPOOL # AND LENGTH     LD @ZA02332 59500003
MINBUF   DC    X'012C'             MINIMUM BUFFER LENGTH                59700002
TEST26   DC    F'26'               ACCEPTABLE TEST NUMBER               60000002
TEST27   DC    F'27'               ACCEPTABLE TEST NUMBER               60300002
MAXLNGTH DC    F'256'              MAX # OF CHARS FOR MVC               60600002
IJLBOT26 EQU   *                                                        60900002
         DC    X'0227F5'           STX-ESC-EWRT                         61200002
         DC    X'6F'               WCC  START PRINT/64 CHARS PER LINE/  61500002
*                                       SOUND ALARM/RESTORE KEYBOARD    61800002
         DC    X'1D60'             SF/NORMAL INT/PROTECTED              62100002
         DC    C'FOR CLUSTERED PRINTERS DATA SHOULD'                    62400002
         DC    C' START NEXT LINE HERE ------>'    NEW LINE AT CHAR 65  62700002
         DC    C'CHECKING PROGRAM TAB/ERASE UNPROT. TO '                63000002
         DC    C'ADDR/DUP/FIELD MARK ORDERS'                            63300002
         DC    X'11C3F0'           SBA 240                              63600002
         DC    X'13'               INSERT CURSOR                        63900002
         DC    X'1DF8'             AUTOSKIP,PROTECTED,HIGH INTENSITY    64200002
         DC    X'3CC540F1'         RA 320 (1'S)                         64500002
         DC    X'1DC8'             UNPROTECTED,HIGH INTENSITY           64800002
         DC    X'3CC650'           RA 400 (A'S)                         65100002
         DC    C'A'                REPEATED CHAR                        65400002
         DC    X'1D60'             PROTECTED,NORMAL INTENSITY           65700002
         DC    X'3CC75F'           RA   479  (B'S)                      66000002
         DC    C'B'                REPEATED CHAR                        66300002
         DC    X'11C4D7F1'         SBA 279,1                            66600002
         DC    X'05'               PROGRAM TAB                          66900002
         DC    X'11C5E8'           SBA 360                              67200002
         DC    X'12C650'           EUA 400                              67500002
         DC    X'11C64A'           SBA 394                              67800002
         DC    X'1C1E1519'         DUP/FIELD MARK/NEW LINE/EOM          68100002
         DC    X'03'               ETX                                  68400002
TST26SZ  EQU   *-IJLBOT26          LENGTH OF TEST 26                    68500002
IJLBOT27 EQU   *                                                        68700002
         DC    X'0227F5'           STX-ESC-EWRT                         69000002
* UNIVERSAL 3270 TEST PATTERN (RFT MESSAGE)                             69300002
         DC    X'4F'     WCC   SOUND ALARM/RESTORE KEYBOARD/            69600002
*                              START PRINT/132 CHARCTRS PER LINE        69900002
         DC    X'8182838485868788898A8C8D8E8F'                          70200002
         DC    X'909192939495969798999A9D9E9F'                          70500002
         DC    X'1140E7'           SBA 39                               70800002
         DC    X'1D60'             SF 60                                71100002
         DC    X'A2A3A4A5A6A7A8A9AAACADAEAF'                            71400002
         DC    X'BABBBCBDBEBF808B9B9CA0A1AB'                            71700002
         DC    X'B0B1B2B3B475B6B7B879'                                  72000002
         DC    X'11C14F'           SBA 79                               72300002
         DC    X'1D40'             SF 40                                72600002
         DC    X'414243444546474849'                                    72900002
         DC    X'515253545556575859'                                    73200002
         DC    X'6263646566676869'                                      73500002
         DC    X'70717273747576777879'                                  73800002
         DC    X'11C1F7'           SBA 119                              74100002
         DC    X'1D60'             SF 60                                74400002
         DC    X'C1C2C3C4C5C6C7C8C9'                                    74700002
         DC    X'D1D2D3D4D5D6D7D8D9'                                    75000002
         DC    X'E2E3E4E5E6E7E8E9'                                      75300002
         DC    X'F0F1F2F3F4F5F6F7F8F9'                                  75600002
         DC    X'11C25F'           SBA 159                              75900002
         DC    X'1D40'             SF 40                                76200002
         DC    X'40506061C0D0E0E1'                                      76500002
         DC    X'11C3C7'           SBA 199                              76800002
         DC    X'1D60'             SF 60                                77100002
         DC    X'4A4B4C4D4E4F'                                          77400002
         DC    X'5A5B5C5D5E5F'                                          77700002
         DC    X'6A6B6C6D6E6F'                                          78000002
         DC    X'7A7B7C7D7E7F'                                          78300002
         DC    X'11C36F'           SBA 239                              78600002
         DC    X'1D40'             SF 40                                78900002
         DC    X'CACBCCCDCECF'                                          79200002
         DC    X'DADBDCDDDEDF'                                          79500002
         DC    X'EAEBECEDEEEF'                                          79800002
         DC    X'FAFBFCFDFEFF'                                          80100002
         DC    X'11C4D7'           SBA 279                              80400002
         DC    X'1D60'             SF 60                                80700002
         DC    C'N/L CHECK'                                             81000002
         DC    X'15B515B515'       5 NEW LINE MESSAGES                  81300002
         DC    X'11C540'           SBA  320                             81600002
         DC    C'EOM CHECK'                                             81900002
         DC    X'B919'             END OF MESSAGE (ALT. CODES)          82200002
         DC    X'11C64F'           SBA  399                             82500002
         DC    X'1D40'             SF 40                                82800002
         DC    X'13'               INC                                  83100002
         DC    X'03'               ETX                                  83400002
TST27SZ  EQU   *-IJLBOT27          LENGTH OF TEST 27                    83500002
         EJECT                                                          83700002
*        DSECTS                                                         84000002
         SPACE                                                          84300002
         IECTIOBX                                                       84600002
         EJECT                                                          84900002
         IECTDECB                                                       85200002
         EJECT                                                          85500002
         DCBD  DSORG=BX,DEVD=BS                                         85800002
         EJECT                                                          86100002
         IECTDEBX                                                       86400002
         EJECT                                                          86450002
UCBDSECT DSECT                                                          86700002
         DS    0F                                                       87000002
         ORG   UCBDSECT+13                                              87300002
CHARADDR DS    CL3                 UNIT ADDR (EBCDIC)                   87600002
         ORG   UCBDSECT+18                                              87900002
DVCLASS  DS    CL1                 DEVICE CLASS                         88200002
UNITYPE  DS    CL1                 UNIT TYPE                            88500002
         ORG   UCBDSECT+36                                              88800002
RLN      DS    CL1                 RELATIVE LINE NUMBER                 89100002
         END                                                            89400002
./  ADD  SSI=71360301,NAME=IGC0006F
         TITLE  'IGC0006F  -  ON-LIN TEST CONTROL MODULE    '           00250002
IGC0006F CSECT                                                          00300002
         SPACE 3                                                        00310002
*                                                                       00312002
* C070500,A070600                                             LD YM4058 00314002
* A054100,054200,061100,061300,061400                       L5 @ZA02806 00314400
* A072600-072900,073020,085100-085400,085600                L5 @ZA02806 00314800
* A097100-097300,097600                                     L5 @ZA02806 00315200
*                                                                       00316002
         SPACE 3                                                        00318002
*********************************************************************** 00320002
*                                                                       00330002
*                                                                       00340002
*      THIS MODULE HAS BEEN RE-WRITTEN FOR OS/VS2-REL2 (MVM)            00340402
*                                                                       00342002
*                                                                       00344002
*********************************************************************** 00350002
*                                                                     * 00400002
* STATUS -           CHANGE LEVEL 002,  1AUG 1969                  000M 00450002
*                                                                     * 00500002
*FUNCTION -         SERVICES BTAM START-STOP ON LINE TEST REQUESTS    * 00550002
*                   VALIDATES REQUEST FOR TEST MESSAGES AND XCTL'S    * 00600002
*                     TO APPROPRIATE DEVICE DEPENDENT LOAD.           * 00650002
*                                                                     * 00700002
*ENTRY -            ENTRY IS TO THE FIRST EXECUTABLE INSTRUCTION.     * 00750002
*                                                                     * 00800002
* INPUT -           REGISTER 1 - ADDRESS OF THE IOB.                  * 00850002
*                   ADDRESS OF THE RFT MESSAGE IN IOBERINF INSERTED   * 00900002
*                     BY IGG019MB (CHANNEL END).                      * 00950002
*                   ADDRESS OF THE PARAMETER LIST IN IOBERINF+4       * 01000002
*                     INSERTED BY IGG019MR (TERMINAL TEST CONTROL     * 01050002
*                       MODULE).                                      * 01100002
*                                                                     * 01150002
* OUTPUT -            REGISTER 1 - ADDRESS OF IOB                     * 01200002
*                                                                     * 01250002
* EXTERNAL ROUTINES - EXECUTE CHANNEL PROGRAM ROUTINE                 * 01300002
*                                                                     * 01350002
* EXIT -            XCTL TO APPROPRIATE SUBSEQUENT LOAD.              * 01400002
*                                                                     * 01450002
* IN-LINE ROUTINES- THIS FIRST SVC LOAD DETERMINES BY TESTING THE UCB * 01500002
*                   WHETHER THE LINE IN TEST IS BI-SYNC OR START-STOP.* 01550002
*                   IF START-STOP, IT MOVES ADAPTER TYPE AND MODEL    * 01600002
*                   CODE INTO THE DCB, USES CODE AS INDEX TO TYPE OF  * 01650002
*                   TERMINAL AND TEST, GETS I/O AREA FROM THE IOB,    * 01700002
*                   AND PROCESSES TEST REQUESTS WITH THE FOLLOWING    * 01750002
*                   SUBROUTINES.                                      * 01800002
*                                                                     * 01850002
*                     1. DISPTEST - THIS SUBROUTINE IS USED IF REQUEST* 01900002
*                        IS FOR A 2848. ALL POSSIBILITIES OF ILLEGAL  * 01950002
*                        TEST REQUESTS ARE CHECKED. CONTROL UNIT AND  * 02000002
*                        DISPLAY STATION SELECTION ADDRESSES ARE      * 02050002
*                        CHECKED FOR VALIDITY. IF NO ERRORS, XCTL TO  * 02100002
*                        MODULE IGC0506F.                             * 02150002
*                     2. CHK1050 - MOVES IN ADDRESSING CHARACTERS,    * 02200002
*                        MOVES UCB FEATURES FIELD TO DCB, CHECKS FOR  * 02250002
*                        COMPONENT SELECTION SPECIFIED IN RFT, CHECKS * 02300002
*                        FOR ILLEGAL COMPONENT, CHECKS FIRST TEST     * 02350002
*                        SELECTION CODE = 00. IF THESE CONDITIONS ARE * 02400002
*                        MET, GOES TO COMCHK, IF NOT, RESTART.        * 02450002
*                                                                     * 02500002
*                     3. CHK1060 - CHECKS SELECTION CODE, COMPONENT   * 02550002
*                        SELECTION, AND FIRST ADDRESS POSITION. IF    * 02600002
*                        THESE ARE VALID, GOES TO COMCHK, IF NOT,     * 02650002
*                        RESTARTS.                                    * 02700002
*                                                                     * 02750002
*                     4. CHK1030 - TESTS SELECTION CODE. IF VALID,    * 02800002
*                        GOES TO COMCHK, IF NOT, RESTARTS.            * 02850002
*                                                                     * 02900002
*                     5. CHK2740 - MOVES UCB FEATURES FIELD TO IOB,   * 02950002
*                        CHECKS FOR 2760 TEST, TESTS SELECTION CODE.  * 03000002
*                        GOES TO COMCHK IF VALID, RESTARTS IF NOT.    * 03050002
*                                                                     * 03100002
*                     6. CHKNUM - CHECKS 1030 MANUAL ENTRY OR BADGE   * 03150002
*                        READER. CHECKS TEST SELECTION CODE AND FIRST * 03200002
*                        ADDRESS POSITION. IF VALID, GOES TO COMCHK,  * 03250002
*                        IF NOT, RESTARTS.                            * 03300002
*                                                                     * 03350002
*                     7. COMCHK - CHECKS TEST SELECTION CODE FURTHER. * 03400002
*                        IF STILL VALID, GOES TO XCTL. IF NOT,        * 03450002
*                        RESTARTS.                                    * 03500002
*                                                                     * 03550002
*                     8. RESTART - RETURN TO USER VIA REGISTER 14     * 03600002
*                        WITH ON-LINE TEST FLAG IN IOBINCAM TURNED    * 03650002
*                        OFF.                                         * 03700002
*                                                                     * 03750002
*                     9. CHK2740C - MOVES UCB FEATURES FIELD TO IOB,  * 03800002
*                        CHECKS SELECTION CODES AND GOES TO RESTART   * 03850002
*                        IF CODE IS 0, GREATER THAN 7, OR A SPACE     * 03900002
*                        CHARACTER. OTHERWISE, GOES TO XCTL.          * 03950002
*                                                                     * 04000002
*                    10. CHK2741C - SAME AS CHK2740C.                 * 04050002
*                                                                     * 04100002
*                    11. CHK2741P - SAME AS CHK2740.                  * 04150002
*                                                                     * 04200002
*                   IF THE TEST IS FOR BI-SYNC, THIS ROUTINE XCTL'S   * 04250002
*                   TO IGC0D06F.                                      * 04300002
*                                                                     * 04350002
*                   IF THE TEST IS FOR A LOCAL 3270, THIS             * 04400002
*                   ROUTINE XCTL'S TO IGC1206F                        * 04450002
*                                                                     * 04500002
* ATTRIBUTES - THIS ROUTINE IS REENTRANT.                             * 04550002
*                                                                     * 04600002
*********************************************************************** 04650002
         EJECT                                                          04700002
IOBREG   EQU   1                                                        04750002
DEBREG   EQU   2                                                        04800002
PARREG   EQU   3                                                        04950002
TYPEREG  EQU   4                                                        05000002
BASEREG  EQU   6                                                        05150002
IOREG    EQU   7                                                        05200002
TESTREG  EQU   8                                                        05250002
CNTREG   EQU   9                                                        05350002
ADREG    EQU   10                                                       05400002
TCBREG   EQU   10                                           L5 @ZA02806 05410000
RTCD     EQU   15                                           L5 @ZA02806 05420000
DCBREG   EQU   11                                                       05450002
DECBREG  EQU   12                                                       05500002
UCBREG   EQU   13                                                       05550002
RTNREG   EQU   14                                                       05560002
         SPACE 4                                                        05600002
         BALR  BASEREG,ZERO                                             05650002
         USING *,BASEREG                                                05700002
         USING IOBSTDRD,IOBREG        *                                 05750002
         USING DEB,DEBREG             * DSECTS FOR CONTROL BLOCKS       05800002
         USING IHADCB,DCBREG          *                                 05850002
         USING DECB,DECBREG                                             05900002
         USING UCB,UCBREG                                               05910002
         B     AROUND                                                   05920000
         DC    CL8'IGC0006F'                                            05930000
         DC    XL2'5052'                                                05940000
         DC    C'&SYSDATE'                                              05942000
         DC    S(*)                                                     05944000
PATCH    DC    20F'0'                                                   05946000
         DS    0F                                                       05948000
AROUND   EQU   *                                                        05948400
         L     DECBREG,IOBECBPT                                         05950002
         L     DCBREG,IOBDCBPT          LOAD DCB ADDRESS                06000002
         L     DEBREG,DCBDEBAD          LOAD POINTER TO DEB             06050002
         SH    DEBREG,H36              ADJUST FOR DSECT                 06100002
         LR    TCBREG,IOBREG           SAVE IOB ADDR        L5 @ZA02806 06102000
         LR    CNTREG,RTNREG           SAVE RETURN REG      L5 @ZA02806 06104000
         DEBCHK (DCBREG),TYPE=VERIFY,AM=TAM                 L5 @ZA02806 06110000
         LTR   RTCD,RTCD               CHECK RET CODE       L5 @ZA02806 06130000
         BNZ   ABEND                   ABEND WITH 16E       L5 @ZA02806 06140000
         LR    IOBREG,TCBREG           RESTORE IOBADDR      L5 @ZA02806 06142000
         LR    RTNREG,CNTREG           RESTORE RETURM REG   L5 @ZA02806 06144000
         TM    DECONLTT,DECRCVMS        IS REQUEST FOR REENTRY          06150002
         BO    RE2760                   BRANCH IF YES                   06200002
         SR    UCBREG,UCBREG            CLEAR REGISTER                  06250002
         IC    UCBREG,IOBUCBX           GET INDEX TO UCB FOR THIS LINE  06300002
         SLL   UCBREG,TWO               MULTIPLY BY FOUR                06350002
         L     UCBREG,DEBSUCBA          GET UCB ADDRESS FOR THIS LINE   06400002
         TM    UCBTBYT4,BISYNC          IS THIS A BI-SYNC LINE          06450002
         BO    BISNTST                                                  06500002
         CLI   UCBTBYT3,UCB3DISP        IS DVC A GRAPHIC ?              06550002
         BNE   NOTGRAPH                 NO,CAN'T BE A 3270 DEVICE       06600002
         CLI   UCBTBYT4,UCB3211         IS IT A 3277 ?                  06650002
         BE    PATH3270                 YES, XCTL TO IGC1206F           06700002
         CLI   UCBTBYT4,A3284           IS IT A 3284 ?                  06750002
         BE    PATH3270                 YES, XCTL                       06800002
         CLI   UCBTBYT4,A3286           IS IT A 3286 ?                  06850002
         BE    PATH3270                 YES, XCTL                       06900002
NOTGRAPH EQU   *                                                        06950002
         MVN   DCBERROP+TWO(ONE),UCBTBYT1    MOVE MODEL CODE INTO DCB   07000002
         MVZ   DCBERROP+TWO(ONE),UCBTBYT4    MOVE ADAPTER.... LD YM4058 07050002
*                                            TYPE INTO DCB    LD YM4058 07060002
         L     IOREG,IOBERINF           GET I/O AREA ADDR FROM IOBLIST  07100002
         CLI   SEVEN(IOREG),FIFTY6      BRANCH IF REQUEST               07150002
         BE    DISPTEST                 FOR 2848                        07200002
         SR    TYPEREG,TYPEREG          CLEAR THE TYPE REGISTER         07250002
         L     TCBREG,DEBNMSUB         GET TCB ADDR         L5 @ZA02806 07260000
         USING TCB,TCBREG              BASE FOR DSECT       L5 @ZA02806 07270000
         MODESET EXTKEY=TCB,WORKREG=15 GO TO USER KEY       L5 @ZA02806 07280000
         DROP  TCBREG                                                   07290000
         IC    TYPEREG,SEVEN(IOREG)     GET TYPECODE FROM INPUT AREA    07300002
         MODESET EXTKEY=ZERO                                L5 @ZA02806 07302000
         N     TYPEREG,BADBITS          TURN OFF UNWANTED BITS          07350002
         SRL   TYPEREG,ONE              DIVIDE BY TWO                   07400002
         BZ    RESTART                  BRANCH IF TYPE CODE EQUAL ZERO  07450002
         IC    TESTREG,LOADSEL-ONE(TYPEREG) GET MODULE NUMBER FOR XCTL  07500002
         STC   TESTREG,IOBERCCW+FOUR    STORE MODULE ID NUMBER IN NAME  07550002
         LA    TESTREG,MODADAPT-ONE(TYPEREG)    GET ADDR - ADAPTER...   07600002
*                                               AND MOD CODE            07610002
         CLI   DCBERROP+TWO,TYP1050     IS TYPE A 1050                  07650002
         BE    VAL1050                                             000M 07700002
         CLI   DCBERROP+TWO,TYP1050X                                    07750002
         BE    VAL1050                                                  07800002
         CLI   DCBERROP+TWO,TTY1050X                                    07850002
         BE    VAL1050                                                  07900002
         CLI   DCBERROP+TWO,TYP2740X                                    07950002
         BE    VAL2740                                                  08000002
         CLI   DCBERROP+TWO,NINETEEN    2S THIS 2740B                   08050002
         BNE   CHECKVAL                 NO                              08100002
         MVI   DCBERROP+TWO,FOURTEEN    YES, TREAT AS 2740              08150002
CHECKVAL EQU   *                                                        08200002
         CLC   DCBERROP+TWO(ONE),ZERO(TESTREG)  COMPARE FOR VALIDITY    08250002
         BNE   RESTART                                                  08300002
         CLI   SEVEN(IOREG),MAX         BRANCH IF TYPE CODE IS          08350002
         BH    RESTART                  GREATER THAN 5                  08400002
         SPACE 2                                                        08450002
         SLL   TYPEREG,TWO              MULTIPLY BY FOUR                08500002
         L     TCBREG,DEBNMSUB         GET TCB ADDR         L5 @ZA02806 08510000
         USING TCB,TCBREG              BASE FOR DSECT       L5 @ZA02806 08520000
         MODESET EXTKEY=TCB,WORKREG=15  GO TO USER KEY      L5 @ZA02806 08540000
         DROP  TCBREG                                       L5 @ZA02806 08542000
         MVC   IOBWORK(TWO),EIGHT(IOREG)    MOVE IN ADDRESS CHARACTERS  08550002
         MODESET EXTKEY=ZERO                                L5 @ZA02806 08560000
         B     BRANSEL-FOUR(TYPEREG)    BRANCH TO GET MODULE TYPE       08600002
         SPACE 2                                                        08650002
*                                                                       08660002
*                             SPECIAL VALIDITY TESTS                    08700002
*                                                                       08710002
VAL1050  CLI   SEVEN(IOREG),P2          TEST 1050 ON IBM TELL ADAPT     08750002
         BE    CHK1050                                                  08800002
         B     RESTART                                                  08850002
         SPACE 1                                                        08900002
VAL2740  CLI   SEVEN(IOREG),P4          TEST 2740X                      08950002
         BE    CHK2740                                                  09000002
         B     RESTART                                                  09050002
         SPACE 2                                                        09100002
BRANSEL  B     CHK1030                  CHECK 1030 REQUEST              09150002
         B     CHK1050                  CHECK 1050 REQUEST              09200002
         B     CHK1060                  CHECK 1060 REQUEST              09250002
         B     CHK2740                  CHECK 2740 REQUEST              09300002
         B     CHKNUM                   CHECK 1030 M.E. OR BADGE        09350002
         B     RESTART                  RESERVED 2848/2260              09400002
         B     RESTART                  RESERVED                        09450002
         B     CHK2740C                                                 09500002
         B     CHK2741C                                                 09550002
         B     CHK2741P                                                 09600002
         SPACE 2                                                        09650002
CHK1050  EQU   *                                                        09700002
         L     TCBREG,DEBNMSUB         GET TCB ADDRR        L5 @ZA02806 09710000
         USING TCB,TCBREG              BASE FOR TCB DSECT   L5 @ZA02806 09720000
         MODESET EXTKEY=TCB,WORKREG=15  GO TO USER KEY      L5 @ZA02806 09730000
         DROP TCBREG                                        L5 @ZA02806 09740000
         MVC   IOBWORK(TWO),EIGHT(IOREG)  MOVE IN ADDRESSING CHARACTERS 09750002
         MODESET EXTKEY=ZERO                                L5 @ZA02806 09760000
         MVC   DCBERROP+TWO(ONE),UCBTBYT2  MOVE FEATURES FIELD FROM UCB 09800002
         CLI   NINE(IOREG),TWO          BRANCH IF                       09850002
         BL    RESTART                  NO COMPONENT SELECTION          09900002
         CLI   NINE(IOREG),FIFTEEN      BRANCH IF                       09950002
         BH    RESTART                  ILLEGAL COMPONENT               10000002
FIRSTSEL CLI   FIVE(IOREG),FIFTEEN      BRANCH IF FIRST TEST            10050002
         BNE   RESTART                  SELECTION CODE NOT ZERO         10100002
         B     COMCHK                   GO TO COMMON CHECKS             10150002
         SPACE 2                                                        10200002
CHK1060  EQU   *                                                        10250002
         CLI   SIX(IOREG),X0B           BRANCH IF                       10300002
         BE    LOADIT                   COMPARE TEST                    10350002
         CLI   FIVE(IOREG),FIFTEEN      BRANCH IF FIRST TEST            10400002
         BNE   RESTART                  SELECTION CODE NOT ZERO         10450002
         CLI   TEN(IOREG),TWO           BRANCH IF COMPONENT             10500002
         BE    CHKADDR                  SELECTION OF 1                  10550002
         CLI   TEN(IOREG),SEVEN         BRANCH IF COMPONENT             10600002
         BE    CHKADDR                  SELECTION OF 3                  10650002
         B     RESTART                  BRANCH IF ILLEGAL COMPONENT     10700002
CHKADDR  CLI   EIGHT(IOREG),FIFTEEN     BRANCH IF FIRST ADDRESS         10750002
         BE    COMCHK                   POSITION IS ZERO                10800002
         CLI   EIGHT(IOREG),TWO         BRANCH IF FIRST ADDRESS         10850002
         BE    COMCHK                   POSITION IS 1                   10900002
         CLI   EIGHT(IOREG),FOUR                                        10950002
         BNE   RESTART                                                  11000002
         SPACE 2                                                        11050002
COMCHK   CLI   SIX(IOREG),FIFTEEN       BRANCH IF                       11100002
         BE    RESTART                  TEST CODE OF ZERO               11150002
         CLI   SIX(IOREG),X0E           BRANCH IF TEST SELECTION        11200002
         BH    RESTART                  GREATER THAN SEVEN              11250002
         CLI   SIX(IOREG),ONE           BRANCH IF                       11300002
         BE    RESTART                  TEST CODE IS BLANK              11350002
         B     LOADIT                                                   11400002
         SPACE 2                                                        11450002
CHK1030  CLI   FIVE(IOREG),TWENTY       BRANCH IF FIRST TEST            11500002
         BNE   RESTART                  SELECTION CODE NOT ZERO         11550002
         CLI   SIX(IOREG),TWENTY        BRANCH IF TEST                  11600002
         BE    RESTART                  CODE OF ZERO                    11650002
         B     COMCHK+EIGHT                                             11700002
         SPACE 3                                                        11750002
CHK2741P EQU   *                                                        11800002
         SPACE 2                                                        11850002
CHK2740  MVC   IOBWORK+THREE(ONE),UCBTBYT2    MOVE FEATURES FIELD       11900002
         CLC   FIVE(TWO,IOREG),SCANTEST SCAN POINT TEST                 11950002
         BE    RE2760                   BRANCH IF YES                   12000002
         CLC   FIVE(TWO,IOREG),FRAMETST FRAME CHANGE TEST               12050002
         BNE   FIRSTSEL                 BRANCH IF NO                    12100002
         SPACE 2                                                        12150002
RE2760   MVI   IOBERCCW+FOUR,MOD2760    CODE FOR 2760 TEST MODULE       12200002
         B     LOADIT                                                   12250002
         SPACE 2                                                        12300002
CHK2740C EQU   *                                                        12350002
CHK2741C EQU   *                                                        12400002
         MVC   IOBWORK+THREE(ONE),UCBTBYT2   MOVE FEATURES FIELD        12450002
         CLI   FIVE(IOREG),C0           BRANCH IF FIRST TEST SELECTION  12500002
         BNE   RESTART                  CODE NOT ZERO                   12550002
         CLI   SIX(IOREG),C8            BRANCH IF INVALID CODE          12600002
         BE    RESTART                  *          THAT IS  0,          12650002
         CLI   SIX(IOREG),C4            *          GREATER THAN 7,      12700002
         BH    RESTART                  *          OR A SPACE CHARACTER 12750002
         CLI   SIX(IOREG),SP            *                               12800002
         BE    RESTART                  *                               12850002
         B     LOADIT                                                   12900002
         SPACE 3                                                        12950002
CHKNUM   CLI   FIVE(IOREG),TWENTY        BRANCH IF                      13000002
         BNE   RESTART                  TEST SELECT 1 NOT ZERO          13050002
         CLI   SIX(IOREG),TWENTY        BRANCH IF                       13100002
         BE    RESTART                  TEST CODE OF ZERO               13150002
         CLI   EIGHT(IOREG),TWENTY      BRANCH IF FIRST ADDRESS         13200002
         BE    COMCHK+EIGHT             POSITION IS ZERO                13250002
         CLI   EIGHT(IOREG),TWO         BRANCH IF FIRST ADDRESS         13300002
         BE    COMCHK+EIGHT             POSITION IS ONE                 13350002
         CLI   EIGHT(IOREG),FOUR        BRANCH IF FIRST ADDRESS         13400002
         BNE   RESTART                  POSITION IS NOT TWO             13450002
         B     COMCHK+EIGHT                                             13500002
         SPACE 2                                                        13550002
LOADSEL  DC    CL1'1'                   1030 TEST SEL. MODULE NUMBER    13600002
         DC    CL1'2'                   1050 TEST SEL. MODULE NUMBER    13650002
         DC    CL1'3'                   1060 TEST SEL. MOD. NUMBER      13700002
         DC    CL1'4'                   2740 TEST SEL. MOD. NUMBER      13750002
         DC    CL1'1'                   1030 M.E. OR BADGE              13800002
         DC    CL1'5'                   2848 TEST SEL. MOD. NUMBER      13850002
         DC    CL1'F'                   NCS                             13900002
         DC    CL1'C'                   2740C TEST SEL. MODULE NUMB000M 13950002
         DC    CL1'9'                   2741C TEST SEL. MODULE NUMBER   14000002
         DC    CL1'A'                   2741P TEST SEL. MODULE NUMBER   14050002
         SPACE 2                                                        14100002
MODADAPT DC    X'21'                                                    14150002
         DC    X'11'                                                    14200002
         DC    X'12'                                                    14250002
         DC    X'14'                                                    14300002
         DC    X'21'                                                    14350002
         DC    X'81'                                                    14400002
         DC    X'00'                                                    14450002
         DC    X'13'                                                    14500002
         DC    X'15'                                                    14550002
         DC    X'16'                                                    14600002
         SPACE 2                                                        14650002
DISPTEST MVI   IOBERCCW+FOUR,CHAR5      STORE MODULE ID IN NAME         14700002
         CLI   FIVE(IOREG),FIFTY        BRANCH IF FIRST                 14750002
         BNE   RESTART                  TEST POSITION NOT ZERO          14800002
         CLI   SIX(IOREG),FIFTY9        BRANCH IF                       14850002
         BH    RESTART                  1.ILLEGAL TEST REQUESTED        14900002
         BE    LOADIT                   2.ADDRESS RETURN TEST           14950002
         CLI   SIX(IOREG),FIFTY1        BRANCH IF                       15000002
         BL    RESTART                  ILLEGAL TEST REQUESTED          15050002
         CLI   SIX(IOREG),FIFTY7        BRANCH IF                       15100002
         BE    RESTART                  ILLEGAL TEST REQUESTED          15150002
         LA    CNTREG,FOUR              LOAD POSITION CNT TO BE CHECKED 15200002
         LA    ADREG,EIGHT(IOREG)       LOAD ADDR OF DC&DS SELECTION    15250002
TESTHDR  CLI   ZERO(ADREG),FIFTY        BRANCH IF                       15300002
         BL    RESTART                  ILLEGAL SELECTION               15350002
         CLI   ZERO(ADREG),FIFTY9       BRANCH IF                       15400002
         BH    RESTART                  ILLEGAL SELECTION               15450002
         LA    ADREG,ONE(ADREG)         POINT TO NEXT POSITION          15500002
         BCT   CNTREG,TESTHDR           GO CHECK NEXT POSITION          15550002
         CLI   TEN(IOREG),FIFTY2        BRANCH IF                       15600002
         BNH   LOADIT                                                   15650002
RESTART  NI    IOBINCAM,ONLTT           INDICATE UNSUCCESSFUL           15700002
         BR    RTNREG                   RETURN                          15750002
         SPACE 2                                                        15800002
PATH3270 EQU   *                                                        15850002
         MVI   IOBERCCW+THREE,CHAR1     SET UP TO LOAD IGC1206F         15900002
         MVI   IOBERCCW+FOUR,CHAR2                                      15950002
         B     LOADIT                   GO XCTL                         16000002
         SPACE 2                                                        16050002
BISNTST  MVI   IOBERCCW+FOUR,CHARD      SET UP TO LOAD DO6F   BSC       16100002
LOADIT   LA    PARREG,IOBERCCW          GET ADDRESS OF MODULE NAME      16150002
         XCTL  EPLOC=(3)                LINK TO NEXT LOAD               16200002
ABEND    ABEND DEBCHK                  DEBCHK ABEND         L5 @ZA02806 16210000
         SPACE 4                                                        16250002
P0       EQU   X'15'                                                    16350002
MAX      EQU   P0                                                       16400002
DEBCHK   EQU   X'16E'                 ABEND CODE FOR DEBCHK L5 @ZA02806 16410000
P2       EQU   X'04'                                                    16450002
P4       EQU   X'08'                                                    16500002
SP       EQU   X'01'                    SPACE CHARACTER                 16550002
C0       EQU   X'13'                    CORRS 0                         16600002
C4       EQU   X'10'                    CORRS 4                         16650002
C8       EQU   X'0E'                    CORRS 8                         16700002
         SPACE 4                                                        16750002
BADBITS  DC    0F'0',X'0000001E'                                        16800002
SCANTEST DC    X'0202'                   TYPE 11 TEST                   16850002
FRAMETST DC    X'0215'                  TYPE 10 TEST                    16900002
ZERO2740 DC    X'1515'                  ZEROS IN 2740 CODE              16950002
         SPACE 4                                                        17000002
ONLTT    EQU   X'00'                                                    17050002
TYP1050  EQU   X'31'                                                    17100002
TYP1050X EQU   X'17'                                                    17150002
TTY1050X EQU   X'32'                                                    17200002
TYP2740X EQU   X'18'                                                    17250002
BISYNC   EQU   X'90'                                                    17300002
MOD2760  EQU   X'C2'                    CODE FOR 2760 TEST MODULE       17400002
         SPACE 4                                                        17450002
H36      DC    H'36'                                                    17600002
A3284    EQU   X'0A'                    3284 DEVICE TYPE                17650002
A3286    EQU   X'0B'                    3286 DEVICE TYPE                17700002
DVCLASS  EQU   18                       DEVICE CLASS IN UCB             17750002
UNITYPE  EQU   19                       UNIT TYPE IN UCB                17800002
CHAR1    EQU   C'1'                     USED TO LOAD IGC1206F IF A      17850002
CHAR2    EQU   C'2'                     LOCAL 3270 DVC                  17900002
CHAR5    EQU   C'5'                                                     17910002
CHARD    EQU   C'D'                                                     17920002
         SPACE 4                                                        17950002
ZERO     EQU   X'00'                                                    17960002
ONE      EQU   X'01'                                                    17970002
TWO      EQU   X'02'                                                    17980002
THREE    EQU   X'03'                                                    17990002
FOUR     EQU   X'04'                                                    17992002
FIVE     EQU   X'05'                                                    17994002
SIX      EQU   X'06'                                                    17996002
SEVEN    EQU   X'07'                                                    17998002
EIGHT    EQU   X'08'                                                    17998402
NINE     EQU   X'09'                                                    17998802
TEN      EQU   X'0A'                                                    17999202
FOURTEEN EQU   X'14'                                                    17999602
FIFTEEN  EQU   X'15'                                                    17999702
NINETEEN EQU   X'19'                                                    17999802
TWENTY   EQU   X'20'                                                    17999902
THIRTY3  EQU   X'33'                                                    18016602
FIFTY    EQU   X'50'                                                    18026602
FIFTY1   EQU   X'51'                                                    18028602
FIFTY2   EQU   X'52'                                                    18030602
FIFTY6   EQU   X'56'                                                    18032602
FIFTY7   EQU   X'57'                                                    18033002
FIFTY9   EQU   X'59'                                                    18033102
X0B      EQU   X'0B'                                                    18033202
X0E      EQU   X'0E'                                                    18038802
         EJECT                                                          18048802
         DCBD  DSORG=BX,DEVD=BS                                         18050002
         EJECT                                                          18060002
         IHADECB                                                        18100002
         EJECT                                                          18110002
         IEZDEB LIST=YES                                                18150002
         EJECT                                                          18160002
         IEZIOB                                                         18200002
         EJECT                                                          18202000
         IKJTCB DSECT=YES,LIST=YES                          L5 @ZA02806 18204000
         EJECT                                                          18210002
UCB      DSECT                                                          18220002
         IEFUCBOB LIST=YES                                              18230002
         SPACE 5                                                        18240002
         END                                                            18250002
./  ADD  SSI=13150260,NAME=IGC0106F
         TITLE 'IGC0106F-1030 TERMINAL TEST MODULE.'                    00300016
IGC0106F CSECT                                                          00600016
         SPACE 2                                                        00900016
         SPACE 2                                                        01100016
* STATUS -          CHANGE LEVEL 001    MARCH 18,1968                   01300016
         SPACE 2                                                        01500016
*                                                                       01700016
*                                                                       01900016
* FUNCTION -        GENERATE CHANNEL PROGRAM FOR 1030 ON LINE TESTS     02100016
*                                                                       02300016
*                                                                       02500016
* ENTRY POINT -     ENTRY IS TO FIRST INSTRUCTION FROM HEADER ANALYSIS  02700016
*                   MODULE                                              02900016
*                                                                       03100016
*                                                                       03300016
* INPUT -           REGISTER 1 - ADDRESS OF IOB                         03500016
*                   REGISTER 14 - RETURN ADDRESS                        03700016
*                                                                       03900016
*                                                                       04100016
* OUTPUT -          1.  GENERATED CHANNEL PROGRAM                       04300016
*                   2.  UPDATED USAGE COUNT AND POINTER IN              04500016
*                       TERMINAL TEST MODULE (IGG019MR)                 04700016
*                                                                       04900016
*                                                                       05100016
* EXTERNAL ROUTINE -SVC 4 ROUTINE (GETMAIN)                             05300016
*                                                                       05500016
*                                                                       05700016
* EXIT -            RETURN TO ADDRESS IN REGISTER 14                    05900016
*                                                                       06100016
*                                                                       06300016
* INLINE ROUTINES -THE INPUT MESSAGE IS LOCATED THROUGH THE PARAMETER   06500016
*                   LIST AND IS ANALYZED FOR TYPE OF REQUEST.  CCW'S    06700016
*                   FOR THE PROPER DATA AND CONTROL PURPOSES ARE FORMED 06900016
*                   IN THE CCW AREA OF THE IOB.  IF THE REQUESTED DATA  07100016
*                   PATTERN IS NOT IN USE, CORE WILL BE OBTAINED AND    07300016
*                   THE PATTERN MOVED INTO THE NEW AREA.  IF NO CORE IS 07500016
*                   AVAILABLE, THE TEST REQUEST WILL BE SWITCHED TO THE 07700016
*                   TERMINAL SPECIFIED IN THE TEST REQUEST.             07900016
*                   A SUB-ROUTINE--                                     08100016
*                                                                       08300016
*                        A.  SETS UP THE ADDRESS FOR THE CHANNEL        08500016
*                            PROGRAM.                                   08700016
*                        B.  DETERMINES IF DIAL CCW'S ARE REQUIRED AND  08900016
*                            PREPARES THEM IF NEEDED.                   09100016
*                        D.  MOVES THE BASIC CCW'S INTO THE CCW AREA OF 09300016
*                            THE IOB.                                   09500016
*                                                                       09700016
*                                                                       09900016
* ATTRIBUTES -      THIS ROUTINE IS EXECUTED IN THE SVC TRANSIENT AREA  10100016
*                   AS A TYPE 4 SVC ROUTINE, ENABLED,PRIVILEGED AND     10300016
*                   REENTRANT.                                          10500016
*                                                                       10700016
         EJECT                                                          10900016
         EJECT                                                          15300016
*                                                                       15600016
*                                                                       15900016
         BALR  BASEREG,0                                                16200016
         USING *,BASEREG                                                16500016
         USING IHADCB,DCBREG                                            16800016
         USING IECTIOB,IOBREG                                           17100016
         USING IECTDECB,DECBREG                                         17400016
         USING PARMLIST,PARREG                                          17700016
*                                                                       18000016
         LR    IOBREG,1                 LOAD IOB ADDRESS                18300016
         L     PARREG,IOBPARM           LOAD PARAMETER LIST ADDRESS     18600016
         L     IOREG,IOBAREA            LOAD I/O AREA ADDRESS           18900016
         L     PATRNREG,PATTERN         GET ADDRESS OF PATTERN NAME TBL 19200016
         CLI   6(IOREG),X'02'           BRANCH IF                       19500016
         BE    MSGSWTCH                           SWITCH TEST (1)       19800016
         CLI   7(IOREG),X'0B'           CHECK FOR MANUAL ENTRY OR BADGE 20100016
         BE    *+20                     READER                          20400016
         CLI   6(IOREG),X'0B'           BRANCH IF                       20700016
         BE    MSGSWTCH                           COMPARE TEST (5)      21000016
         CLI   6(IOREG),X'68'           BRANCH IF                       21300016
         BE    MSGSWTCH                           VALID COMPARE (D)     21600016
         SR    TESTREG,TESTREG          CLEAR TEST REGISTER             21900016
         IC    TESTREG,6(IOREG)         INSERT TEST SEL. CHARACTER      22200016
         SRA   TESTREG,1                SHIFT OUT PARITY BIT            22500016
         IC    TESTREG,TESTCODE-2(TESTREG)   SET UP INDEXING            22800016
         LA    WORKREG,0(TESTREG,PATRNREG)                              23100016
         CLI   0(WORKREG),X'00'         BRANCH IF THIS PATTERN          23400016
         BE    NOTINUSE                                   IS NOT IN USE 23700016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          24000016
         IC    WORKREG,0(TESTREG,PATRNREG)   1-UP                       24300016
         LA    WORKREG,1(WORKREG)             USAGE                     24600016
         STC   WORKREG,0(TESTREG,PATRNREG)     COUNT                    24900016
*                                                                       25200016
SETCCWS  EQU   *                                                        25500016
         BAL   LINKREG,SETCCWRG         SET UP CCW ADDRESSES IN IOB     25800016
         STC   TESTREG,8(DECBREG)       PUT DISPLACEMENT IN DECB        26100016
         L     WORKREG,0(TESTREG,PATRNREG)   GET ADDRESS OF DATA        26400016
         SR    WORKREG2,WORKREG2        CLEAR WORKING REGISTER 2        26700016
         IC    WORKREG2,0(WORKREG)      GET COUNT OF DATA               27000016
         SH    WORKREG2,=H'4'           REDUCE BY FOUR                  27300016
         STC   WORKREG2,39(CCWREG)      PUT IN CCW                      27600016
         LA    WORKREG,4(WORKREG)       ADDRESS OF DATA TO BE SENT      27900016
FINCCWS  EQU   *                                                        28200016
         ST    WORKREG,32(CCWREG)       PUT IN CCW                      28500016
         MVI   32(CCWREG),X'01'         RESTORE OP CODE                 28800016
*                                                                       29100016
         L     WORKREG,NLIDLES                                          29400016
         LA    WORKREG,24(WORKREG)      ADDRESS OF CIRCLE Y, C, S.      29700016
         ST    WORKREG,0(CCWREG)        PUT IN CCW                      30000016
         MVI   0(CCWREG),X'01'          RESTORE OP CODE                 30300016
*                                                                       30600016
         LA    WORKREG,33(IOBREG)       ADDRESS OF ADDRESSING CHARS     30900016
         ST    WORKREG,8(CCWREG)        PUT IN CCW                      31200016
         MVI   8(CCWREG),X'01'          RESTORE OP CODE                 31500016
         MVI   1(WORKREG),X'02'         INSERT SECOND ADDRESSING CHAR   31800016
*                                                                       32100016
         LA    WORKREG,26(DECBREG)      ADDRESS OF RESPONSE AREA        32400016
         ST    WORKREG,16(CCWREG)       PUT IN CCW                      32700016
         MVI   16(CCWREG),X'02'         RESTORE OP CODE                 33000016
*                                                                       33300016
         MVC   25(3,CCWREG),NLIDLES+1   ADDRESS OF NL-IDLES FOR  CCW    33600016
*                                                                       33900016
         LA    WORKREG,27(DECBREG)      ADDRESS OF LRC RESPONSE AREA    34200016
         ST    WORKREG,40(CCWREG)       PUT IN CCW                      34500016
         MVI   40(CCWREG),X'02'         RESTORE OP CODE                 34800016
*                                                                       35100016
         L     IOREG,IOBAREA            RE-ESTABLISH I/O POINTER        35400016
         CLI   7(IOREG),X'0B'           CHECK FOR MANUAL ENTRY OR BADGE 35700016
         BCR   7,RETURN                 READER--EXIT IF NOT             36000016
         SR    WORKREG,WORKREG          CLEAR RESULT REGISTER           36300016
         CLI   8(IOREG),X'20'           TEST TENS FOR ZERO              36600016
         BE    TESTUNIT                                                 36900016
         SR    WORKREG2,WORKREG2        CLEAR SECOND WORK REGISTER      37200016
         IC    WORKREG2,8(IOREG)        TENS ADDRESSING CHARACTER       37500016
         SRA   WORKREG2,1               DROP PARITY                     37800016
         BZ    RESTART                  NO TEST--INVALID CHARACTER      38100016
         SLA   WORKREG2,1               TIMES TWO                       38400016
         AR    WORKREG,WORKREG2         TO RESULT REGISTER              38700016
         SLA   WORKREG2,2               TIMES FOUR MORE                 39000016
         AR    WORKREG,WORKREG2         TIMES TEN IN RESULT REGISTER    39300016
TESTUNIT CLI   9(IOREG),X'20'           TEST UNITS FOR ZERO             39600016
         BE    TESTRSLT                                                 39900016
         SR    WORKREG2,WORKREG2        CLEAR SECOND WORKING REGISTER   40200016
         IC    WORKREG2,9(IOREG)        UNITS ADDRESSING CHARACTER      40500016
         SRA   WORKREG2,1               DROP PARITY                     40800016
         BZ    RESTART                  NO TEST--INVALID CHARACTER      41100016
         CH    WORKREG2,=H'9'           UNITS CHARACTER MUST BE NUMERIC 41400016
         BH    RESTART                  BRANCH IF NOT                   41700016
         AR    WORKREG,WORKREG2         DEVELOP FINAL RESULT            42000016
TESTRSLT CH    WORKREG,=H'26'           TEST RESULT FOR 26              42300016
         BH    RESTART                  OVER 26 IS INVALID              42600016
         SR    WORKREG2,WORKREG2        CLEAR SECOND WORK REGISTER      42900016
         IC    WORKREG2,ADDRCHAR(WORKREG)   ADDRESSING CHARACTER        43200016
         STC   WORKREG2,33(IOBREG)      PUT IN IOB                      43500016
         NR    WORKREG2,WORKREG2        TEST REGISTER                   43800016
         BZ    RESTART                  ZERO IS AN INVALID ADDRESS      44100016
         BR    RETURN                   RETURN                          44400016
*                                                                       44700016
NOTINUSE EQU   *                                                        45000016
         EX    0,DATAADDR-X'2C'(TESTREG)     ADDRESS OF DATA TO MOVE    45300016
         SR    COUNTREG,COUNTREG        CLEAR REGISTER FOR COUNT        45600016
         IC    COUNTREG,0(FROMREG)      GET COUNT                       45900016
         LA    TOREG,0(TESTREG,PATRNREG)     ADDRESS OF TABLE ENTRY     46200016
         BAL   LINKREG,GETCORE          GET STORAGE, MOVE DATA, ETC.    46500016
         LA    WORKREG,0(TESTREG,PATRNREG)   ADDRESS OF TABLE ENTRY     46800016
         MVI   0(WORKREG),X'01'         SET USAGE COUNT TO 1            47100016
         L     WORKREG,0(WORKREG)       DATA AREA ADDRESS               47400016
         IC    WORKREG2,3(WORKREG)      COUNT WAS PADDED                47700016
         STC   WORKREG2,0(WORKREG)      PUT IN CORRECT PLACE            48000016
         B     SETCCWS                  SETUP CCW'S                     48300016
*                                                                       48600016
MSGSWTCH EQU   *                                                        48900016
         BAL   LINKREG,SETCCWRG         SET UP CCW ADDRESSES IN IOB     49200016
         LH    WORKREG,6(DECBREG)       USED IF NOT DYNAMIC BUFFERING   49500016
         TM    32(DCBREG),X'08'         TEST IF DYNAMIC BUFFERING USED  49800016
         BZ    *+12                                                     50100016
         L     WORKREG,24(DCBREG)       USED WITH DYNAMIC BUFFERING     50400016
         SH    WORKREG,=H'4'            ADJUST FOR TIC                  50700016
         BCTR  WORKREG,0                BYPASS EOA CHAR                 51000016
         BCTR  WORKREG,0                BYPASS TRANSACTION CODE         51300016
         STH   WORKREG,38(CCWREG)       TEMP SAVE                       51600016
         CLI   0(IOREG),X'3D'           LOOK FOR EOB                    51900016
         BE    FOUNDEOB                                                 52200016
         LA    IOREG,1(IOREG)           UP CORE POINTER                 52500016
         BCT   WORKREG,*-12             LOOP ON COUNT                   52800016
         BCTR  IOREG,0                  ADJUST TO POINT TO LAST POS.    53100016
         MVI   0(IOREG),X'3D'           PUT IN EOB AT LAST POSITION     53400016
SETDATA  EQU   *                                                        53700016
         L     FROMREG,IOBAREA          GET 'FROM' ADDRESS OF DATA      54000016
         LH    COUNTREG,38(CCWREG)      COUNT OF DATA TO BE MOVED       54300016
         SLA   COUNTREG,2                                               54600016
         LA    TOREG,36(IOBREG)         ADDRESS TO STORE CORE ADDRESS   54900016
         TM    38(CCWREG),X'FF'        TEST FOR ILLEGAL COUNT           55200016
         BNZ   RESTART                 NOT ZERO MEANS ILLEGAL           55500016
         CLI   39(CCWREG),X'63'        TEST FOR ILLEGAL COUNT           55800016
         BH    RESTART                 HIGH MEANS ILLEGAL COUNT         56100016
         BAL   LINKREG,GETCORE          GET STORAGE, MOVE DATA, ETC.    56400016
         LH    WORKREG,2(GETMAIN)       SIZE OF DATA AREA               56700016
         BCTR  WORKREG,0                REDUCE BY ONE                   57000016
         STH   WORKREG,38(CCWREG)       PUT IN CCW                      57300016
         L     WORKREG,36(IOBREG)       ADDRESS OF DATA AREA            57600016
         MVC   0(1,WORKREG),3(GETMAIN)  MOVE COUNT TO BEGINNING OF AREA 57900016
         LA    WORKREG,1(WORKREG)       UP ADDRESS PAST COUNT           58200016
         MVI   8(DECBREG),X'FF'                                         58500016
         B     FINCCWS                  FINISH CCW'S                    58800016
*                                                                       59100016
FOUNDEOB EQU   *                                                        59400016
         S     IOREG,IOBAREA            COMPUTE NUMBER OF CHARACTERS    59700016
         LA    IOREG,1(IOREG)           UP COUNT TO INCLUDE EOB         60000016
         STH   IOREG,38(CCWREG)         SAVE COUNT TEMPORARILY          60300016
         B     SETDATA                                                  60600016
*                                                                       60900016
GETCORE  EQU   *                                                        61200016
         L     GETMAIN,0(PATRNREG)      ADDRESS OF GETMAIN CONSTANTS    61500016
         ST    TOREG,4(GETMAIN)         PUT ADDRESS IN GETMAIN CONSTANT 61800016
         ST    COUNTREG,0(GETMAIN)      COUNT TO GETMAIN CONSTANTS      62100016
         SVC   4                        ISSUE GETMAIN SVC               62400016
         SLL   15,24                    ELIMINATE HIGH ORDER BITS       62700016
         NR    15,15                    TEST FOR ZERO RETURN CODE       63000016
         BNE   NOCORE                   NON-ZERO IS NO CORE AVAILABLE   63300016
         L     TOREG,0(TOREG)           GET ADDRESS OF BUFFER           63600016
         L     WORKREG,=X'DFDFDFDF'     INITIALIZE PADDING REGISTER     63900016
         SRA   COUNTREG,2               DIVIDE COUNT BY 4               64200016
         IC    WORKREG,0(FROMREG)       GET A CHARACTER                 64500016
         ST    WORKREG,0(TOREG)         STORE A WORD WITH PADS AND CHAR 64800016
         LA    FROMREG,1(FROMREG)       UP POINTERS                     65100016
         LA    TOREG,4(TOREG)                                           65400016
         BCT   COUNTREG,*-16            LOOP ON COUNT                   65700016
         BR    LINKREG                  RETURN                          66000016
*                                                                       66300016
NOCORE   EQU   *                                                        66600016
         NI    IOBINCAM,NOTEST          SET NOTEST SWITCH               66900016
         BR    RETURN                   EXIT                            67200016
*                                                                       67500016
SETCCWRG EQU   *                                                        67800016
         L     DECBREG,IOBECBPT         ADDRESS OF DECB                 68100016
         L     DCBREG,DECDCBAD          ADDRESS OF DCB                  68400016
         LA    CCWREG,56(IOBREG)        ADDRESS OF CCW AREA             68700016
         ST    CCWREG,16(IOBREG)       RESET CCW AREA POINTER           69000016
         MVC   0(48,CCWREG),CHANPROG    MOVE CCW'S TO CCW AREA          69300016
         BR    LINKREG                  RETURN                          69600016
*                                                                       69900016
*                                                                       70200016
*                                                                       70500016
*  PATTERN OF DATA FOR 1030 TESTS                                       70800016
*                                                                       71100016
TILT     DC    AL1(4*(TILTEND-TILT))                                    71400016
         DC    X'62026B0B701064046D0D765BDFDFDFDF167313680861156E0E68'  71700016
         DC    X'075BDF3D'                                              72000016
TILTEND  EQU   *                                                        72300016
*                                                                       72600016
ROTATE   DC    AL1(4*(ROTATEND-ROTATE))                                 72900016
         DC    X'62766E686143574F49405BDFDFDFDF23372F292002160E08155B'  73200016
         DC    X'DF3D'                                                  73500016
ROTATEND EQU   *                                                        73800016
*                                                                       74100016
TWIST    DC    AL1(4*(TWISTEND-TWIST))                                  74400016
         DC    X'62160276700410646B0D0B6D5BDFDFDFDF43322352512531454A'  74700016
         DC    X'2C2A4C5BDF3D'                                          75000016
TWISTEND EQU   *                                                        75300016
*                                                                       75600016
ALLCHAR  DC    AL1(4*(ALLCHARX-ALLCHAR))                                75900016
         DC    X'15020407080B0D0E1013626467686B6D6E7073434546494A4C4F'  76200016
         DC    X'51522526292A2C2F31325BDF3D'                            76500016
ALLCHARX EQU   *                                                        76800016
*                                                                       77100016
ANALYZER DC    AL1(4*(ANALYZEX-ANALYZER))                               77400016
         DC    X'25014F01620167016B5B0101010101010167015BDFDF466D3BDF'  77700016
         DC    X'023BDF045BDF3D'                                        78000016
ANALYZEX EQU   *                                                        78300016
*                                                                       78600016
*  CCW'S                                                                78900016
*                                                                       79200016
CHANPROG CCW   X'01',0,X'A0',5          WRITE CIRCLE Y, C'S, S          79500016
         CCW   X'01',0,X'60',2          WRITE ADDRESSING CHARACTERS     79800016
         CCW   X'02',0,X'60',1          READ ADDRESSING RESPONSE        80100016
         CCW   X'01',0,X'A0',20         WRITE CARRIAGE RETURN AND IDLES 80400016
         CCW   X'01',0,X'60',0          WRITE THE TEST MESSAGE          80700016
         CCW   X'02',0,X'20',1          READ THE LRC RESPONSE           81000016
*                                                                       81300016
         EJECT                                                          81600016
*  ADDRESSES OF DATA TO BE MOVED TO PATTERN BUFFER                      81900016
*                                                                       82200016
DATAADDR EQU   *                                                        82500016
         LA    FROMREG,TILT                                             82800016
         LA    FROMREG,ROTATE                                           83100016
         LA    FROMREG,TWIST                                            83400016
         LA    FROMREG,ALLCHAR                                          83700016
         LA    FROMREG,ANALYZER                                         84000016
*                                                                       84300016
TESTCODE DC    X'2C303400383C'                                          84600016
ADDRCHAR DC    X'00006467686B6D6E7073004546494A4C4F51522526292A2C2F31'  84900016
         DC    X'32'                                                    85200016
*                                                                       85500016
*  EQUATES                                                              85800016
*                                                                       86100016
NOTEST   EQU   X'FE'                                                    86400016
RESTART  EQU   NOCORE                                                   86700016
WORKREG2 EQU   1                                                        87000016
GETMAIN  EQU   1                                                        87300016
LINKREG  EQU   2                                                        87600016
PARREG   EQU   3                                                        87900016
WORKREG  EQU   4                                                        88200016
MULTEVEN EQU   4                                                        88500016
MULTODD  EQU   MULTEVEN+1  5                                            88800016
IOBREG   EQU   5                                                        89100016
IOREG    EQU   7                                                        89400016
BASEREG  EQU   6                                                        89700016
FROMREG  EQU   7                                                        90000016
TESTREG  EQU   8                                                        90300016
PATRNREG EQU   9                                                        90600016
CCWREG   EQU   10                                                       90900016
TOREG    EQU   11                                                       91200016
DCBREG   EQU   11                                                       91500016
DECBREG  EQU   12                                                       91800016
COUNTREG EQU   13                                                       92100016
RETURN   EQU   14                                                       92400016
         EJECT                                                          92700016
         DCBD  DSORG=BX,DEVD=BS                                         93000016
         EJECT                                                          93300016
         IECTIOBX                                                       93600016
         SPACE 2                                                        93900016
IOBNAME  EQU   IOBERCCW                                                 94200016
IOBAREA  EQU   IOBNAME+8                                                94500016
IOBPARM  EQU   IOBNAME+12                                               94800016
         EJECT                                                          95100016
         IECTDECB                                                       95400016
         EJECT                                                          95700016
PARMLIST DSECT                                                          96000016
PATTERN  DS    F                                                        96300016
NLIDLES  DS    F                                                        96600016
         END                                                            96900016
./  ADD  SSI=13150261,NAME=IGC0206F
         TITLE 'IGC0206F-1050 TERMINAL TEST MODULE.'                    00300016
IGC0206F CSECT                                                          00600016
         SPACE 2                                                        00900016
         SPACE 2                                                        01100016
* STATUS -          CHANGE LEVEL 001    MARCH 18,1968                   01300016
         SPACE 2                                                        01500016
*                                                                       01700016
*                                                                       01900016
* FUNCTION -        GENERATE CHANNEL PROGRAM FOR 1050 ON LINE TESTS     02100016
*                                                                       02300016
*                                                                       02500016
* ENTRY POINT -     ENTRY IS TO FIRST INSTRUCTION FROM HEADER ANALYSIS  02700016
*                   MODULE                                              02900016
*                                                                       03100016
*                                                                       03300016
* INPUT -           REGISTER 1 - ADDRESS OF IOB                         03500016
*                   REGISTER 14 - RETURN ADDRESS                        03700016
*                                                                       03900016
*                                                                       04100016
* OUTPUT -          1.  GENERATED CHANNEL PROGRAM                       04300016
*                   2.  UPDATED USAGE COUNT AND POINTER IN              04500016
*                       TERMINAL TEST MODULE (IGG019MR)                 04700016
*                                                                       04900016
*                                                                       05100016
* EXTERNAL ROUTINE -SVC 4 ROUTINE (GETMAIN)                             05300016
*                                                                       05500016
*                                                                       05700016
* EXIT -            RETURN TO ADDRESS IN REGISTER 14                    05900016
*                                                                       06100016
*                                                                       06300016
* INLINE ROUTINES -THE INPUT MESSAGE IS LOCATED THROUGH THE PARAMETER   06500016
*                   LIST AND IS ANALYZED FOR TYPE OF REQUEST.  CCW'S    06700016
*                   FOR THE PROPER DATA AND CONTROL PURPOSES ARE FORMED 06900016
*                   IN THE CCW AREA OF THE IOB.  IF THE REQUESTED DATA  07100016
*                   PATTERN IS NOT IN USE, CORE WILL BE OBTAINED AND    07300016
*                   THE PATTERN MOVED INTO THE NEW AREA.  IF NO CORE IS 07500016
*                   AVAILABLE, THE TEST REQUEST WILL BE SWITCHED TO THE 07700016
*                   TERMINAL SPECIFIED IN THE TEST REQUEST.             07900016
*                   A SUB-ROUTINE--                                     08100016
*                                                                       08300016
*                        A.  SETS UP THE ADDRESS FOR THE CHANNEL        08500016
*                            PROGRAM.                                   08700016
*                        B.  DETERMINES IF DIAL CCW'S ARE REQUIRED AND  08900016
*                            PREPARES THEM IF NEEDED.                   09100016
*                        D.  MOVES THE BASIC CCW'S INTO THE CCW AREA OF 09300016
*                            THE IOB.                                   09500016
*                                                                       09700016
*                                                                       09900016
* ATTRIBUTES -      THIS ROUTINE IS EXECUTED IN THE SVC TRANSIENT AREA  10100016
*                   AS A TYPE 4 SVC ROUTINE, ENABLED,PRIVILEGED AND     10300016
*                   REENTRANT.                                          10500016
*                                                                       10700016
         EJECT                                                          10900016
* ATTRIBUTES -      THIS ROUTINE IS EXECUTED IN THE SVC TRANSIENT AREA  15300016
*                   AS A TYPE 4 SVC ROUTINE, ENABLED,PRIVILEGED AND     15600016
*                   REENTRANT.                                          15900016
*                                                                       16200016
         EJECT                                                          16500016
*                                                                       16800016
*                                                                       17100016
*                                                                       17400016
         BALR  BASEREG,0                                                17700016
         USING *,BASEREG                                                18000016
         USING IHADCB,DCBREG                                            18300016
         USING IECTIOB,IOBREG                                           18600016
         USING IECTDECB,DECBREG                                         18900016
         USING PARMLIST,PARREG                                          19200016
*                                                                       19500016
         LR    IOBREG,1                 LOAD IOB ADDRESS                19800016
         L     PARREG,IOBPARM           LOAD PARAMETER LIST ADDRESS     20100016
         L     IOREG,IOBAREA            LOAD I/O AREA ADDRESS           20400016
         CLI   6(IOREG),X'02'           BRANCH IF                       20700016
         BE    MSGSWTCH                           SWITCH TEST (1)       21000016
         CLI   6(IOREG),X'0B'           BRANCH IF                       21300016
         BE    MSGSWTCH                           COMPARE TEST (5)      21600016
         CLI   6(IOREG),X'68'           BRANCH IF                       21900016
         BE    MSGSWTCH                           VALID COMPARE (D)     22200016
         SR    TESTREG,TESTREG          CLEAR TEST REGISTER             22500016
         IC    TESTREG,6(IOREG)         INSERT TEST SEL. CHARACTER      22800016
         SRA   TESTREG,1                SHIFT OUT PARITY BIT            23100016
         IC    TESTREG,TESTCODE-2(TESTREG)   SET UP INDEXING            23400016
         L     PATRNREG,PATTERN         GET ADDRESS OF PATTERN NAME TBL 23700016
         LA    WORKREG,0(TESTREG,PATRNREG)                              24000016
         CLI   0(WORKREG),X'00'         BRANCH IF THIS PATTERN          24300016
         BE    NOTINUSE                                   IS NOT IN USE 24600016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          24900016
         IC    WORKREG,0(TESTREG,PATRNREG)   1-UP                       25200016
         LA    WORKREG,1(WORKREG)             USAGE                     25500016
         STC   WORKREG,0(TESTREG,PATRNREG)     COUNT                    25800016
*                                                                       26100016
SETCCWS  EQU   *                                                        26400016
         BAL   LINKREG,SETCCWRG                                         26700016
         L     WORKREG,0(TESTREG,PATRNREG)                              27000016
         SR    WORKREG3,WORKREG3       CLEAR REGISTER                   27300016
         IC    WORKREG3,0(WORKREG)     INSERT PATTERN AREA COUNT        27600016
         LA    WORKREG,1(WORKREG)       ADDRESS OF DATA TO BE SENT      27900016
         ST    WORKREG,32(CCWREG)       PUT IN CCW                      28200016
         MVI   32(CCWREG),X'01'         RESTORE OP CODE                 28500016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          28800016
         IC    WORKREG,0(TESTREG,PATRNREG)   CHARACTER COUNT            29100016
         BCTR  WORKREG3,0              REDUCE BY ONE                    29400016
         STC   WORKREG3,39(CCWREG)     PUT IN CCW                       29700016
         STC   TESTREG,8(DECBREG)       PUT DISPLACEMENT                30000016
*                                                                       30300016
FINCCWS  EQU   *                                                        30600016
         L     WORKREG,NLIDLES                                          30900016
         LA    WORKREG,20(WORKREG)      ADDRESS OF CIRCLE D AND C       31200016
         ST    WORKREG,0(CCWREG)        PUT IN CCW                      31500016
         MVI   0(CCWREG),X'01'          RESTORE OP CODE                 31800016
*                                                                       32100016
         MVC   25(3,CCWREG),NLIDLES+1   ADDRESS OF NL-IDLES FOR  CCW    32400016
*                                                                       32700016
         LA    WORKREG,26(DECBREG)      GET ADDRESS OF RESPONSE AREA    33000016
         ST    WORKREG,16(CCWREG)       PUT IN CCW                      33300016
         MVI   16(CCWREG),X'02'         RESTORE OP CODE                 33600016
*                                                                       33900016
         LA    WORKREG,33(IOBREG)       GET ADDRESS OF ADDRESSING CHARS 34200016
         ST    WORKREG,8(CCWREG)        PUT IN CCW                      34500016
         MVI   8(CCWREG),X'01'          RESTORE OP CODE                 34800016
*                                                                       35100016
         BR    RETURN                                                   35400016
*                                                                       35700016
NOTINUSE L     GETMAIN,0(PATRNREG)      ADDRESS OF GETMAIN CONSTANTS    36000016
         EX    0,DATAADDR-4(TESTREG)         ADDRESS OF DATA TO MOVE    36300016
         LA    TOREG,0(TESTREG,PATRNREG)     ADDRESS OF THE TABLY ENTRY 36600016
         ST    TOREG,4(GETMAIN)         PUT IN GETMAIN CONSTANTS        36900016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          37200016
         IC    WORKREG,0(FROMREG)       CHARACTER COUNT OF DATA         37500016
         ST    WORKREG,0(GETMAIN)       PUT IN GETMAIN CONSTANTS        37800016
         SVC   4                        ISSUE GETMAIN SVC               38100016
         SLL   15,24                    ELIMINATE HIGH ORDER BITS       38400016
         NR    15,15                    TEST FOR ZERO RETURN CODE       38700016
         BNE   MSGSWTCH                 NON-ZERO IS NO CORE AVAILABLE   39000016
         MVI   0(TOREG),X'01'           SET USAGE COUNT TO ONE          39300016
         L     TOREG,0(TOREG)           GET ADRESS OF DATA AREA         39600016
         BCTR  WORKREG,0                ADJUST COUNT FOR MVC INST       39900016
         EX    WORKREG,EXMVC            MOVE THE DATA                   40200016
         B     SETCCWS                                                  40500016
*                                                                       40800016
SETCCWRG EQU   *                                                        41100016
         L     DECBREG,IOBECBPT         ADDRESS OF DECB                 41400016
         L     DCBREG,DECDCBAD          ADDRESS OF DCB                  41700016
         LA    CCWREG,56(IOBREG)        ADDRESS OF CCW AREA             42000016
         ST    CCWREG,16(IOBREG)       RESET CCW AREA POINTER           42300016
         TM    DCBERROP+2,X'90'        TEST FOR DIAL                    42600017
         BZ    DIALEXIT                                                 42900016
         L     WORKREG,20(DECBREG)      ADDRESS OF TERMINAL LIST        43200016
         CLI   0(WORKREG),X'00'                                         43500016
         BE    DIALEXIT                                                 43800016
         MVC   0(16,CCWREG),DIALCCW     MOVE IN DIAL CCW'S              44100016
         MVC   15(1,CCWREG),0(WORKREG)  NUMBER OF DIAL DIGITS           44400016
         LA    WORKREG,1(WORKREG)       ADDRESS OF DIAL DIGITS          44700016
         ST    WORKREG,8(CCWREG)        PUT IN CCW                      45000016
         MVI   8(CCWREG),X'29'          RESTORE OP CODE IN CCW          45300016
         LA    CCWREG,16(CCWREG)        UP CCW STORE LOCATION PAST DIAL 45600016
         ST    CCWREG,IOBSTART                                     000D 45700016
DIALEXIT MVC   0(40,CCWREG),CHANPROG    MOVE CCW'S INTO IOB             45900016
         BR    LINKREG                  RETURN                          46200016
*                                                                       46500016
MSGSWTCH EQU   *                                                        46800016
         BAL   LINKREG,SETCCWRG         SET UP CCW AREA POINTER + DIAL  47100016
         ST    IOREG,32(CCWREG)         ADDRESS OF DATA TO CCW          47400016
         MVI   32(CCWREG),X'01'         RESTORE OP CODE                 47700016
         LH    WORKREG,6(DECBREG)       USED IF NOT DYNAMIC BUFFERING   48000016
         TM    32(DCBREG),X'08'         TEST IF DYNAMIC BUFFERING USED  48300016
         BZ    *+12                                                     48600016
         LH    WORKREG,24(DCBREG)       USED WITH DYNAMIC BUFFERING     48900016
         SH    WORKREG,=H'4'            ADJUST FOR TIC                  49200016
         BCTR  WORKREG,0                BYPASS EOA CHAR                 49500016
         STH   WORKREG,38(CCWREG)       IN CASE NO EOT FOUND            49800016
         CLI   0(IOREG),X'1F'           LOOK FOR EOT                    50100016
         BE    FOUNDEOT                                                 50400016
         LA    IOREG,1(IOREG)           UP CORE POINTER                 50700016
         BCT   WORKREG,*-12             LOOP ON COUNT                   51000016
         BCTR  IOREG,0                  ADJUST TO POINT TO LAST POS.    51300016
         MVI   0(IOREG),X'1F'           PUT IN EOT AT LAST POSITION     51600016
         B     FINCCWS                  CONTINUE CCW PROCESSING         51900016
*                                                                       52200016
FOUNDEOT EQU   *                                                        52500016
         S     IOREG,IOBAREA            COMPUTE NUMBER OF CHARACTERS    52800016
         LA    IOREG,1(IOREG)           UP COUNT TO INCLUDE EOT         53100016
         STH   IOREG,38(CCWREG)         SAVE COUNT TEMPORARILY          53400016
         B     FINCCWS                  CONTINUE CCW PROCESSING         53700016
*                                                                       54000016
*  CONSTANTS                                                            54300016
*                                                                       54600016
TESTCODE DC    X'04080C001014'                                          54900016
EXMVC    MVC   0(1,TOREG),0(FROMREG)                                    55200016
         EJECT                                                          55500016
*                                                                       55800016
*  PATTERN OF DATA FOR 1050 TESTS                                       56100016
*                                                                       56400016
TILT     DC    AL1(TILTEND-TILT)                                        56700016
         DC    X'622367266B2A6E2F70316120642568296D2C733276375B5E5E5E'  57000016
         DC    X'5E5E5E573452134C0D49084504401551104F0E4A0B460743025B'  57300016
         DC    X'5E5E5E5E5E5E1F'                                        57600016
TILTEND  EQU   *                                                        57900016
*                                                                       58200016
ROTATE   DC    AL1(ROTATEND-ROTATE)                                     58500016
         DC    X'62766B6D706443574A4C514523372A23312502340B0D5B5E5E5E'  58800016
         DC    X'5E5E5E100407130E081526322F292046524F494067736E68615B'  59100016
         DC    X'5E5E5E5E5E5E1F'                                        59400016
ROTATEND EQU   *                                                        59700016
*                                                                       60000016
TWIST    DC    AL1(TWISTEND-TWIST)                                      60300016
         DC    X'E234A357E713A652EB0DAA4CEE08AF49F004B145E1155B5E5E5E'  60600016
         DC    X'5E5E5E8276C3378773C6328B6DCA2C8E68CF299064D125A0405B'  60900016
         DC    X'5E5E5E5E5E5E1F'                                        61200016
TWISTEND EQU   *                                                        61500016
*                                                                       61800016
ALLCHAR  DC    AL1(ALLCHARX-ALLCHAR)                                    62100016
         DC    X'15020407080B0D0E1013626467686B6D6E7073434546494A4C4F'  62400016
         DC    X'51522526292A2C2F31325B5E5E5E5E5E5EE2E4E7E8EBEDEEF0F3'  62700016
         DC    X'C3C5C6C9CACCCFD1D2A5A6A9AAACAFB1B25B5E5E1F'            63000016
ALLCHARX EQU   *                                                        63300016
*                                                                       63600016
ANALYZER DC    AL1(ANALYZEX-ANALYZER)                                   63900016
         DC    X'020407080B016701130101250162016B616445254F5D5D5D5D5D'  64200016
         DC    X'5D5D5D5D5D5D5D155D5D5D105D5D5D0D0101010101014F01675B'  64500016
         DC    X'0101010101010101675B5E5E5E466D3B5E5E023B5E5E043B5E5E'  64800016
         DC    X'075B1F'                                                65100016
ANALYZEX EQU   *                                                        65400016
*                                                                       65700016
*  ADDRESSES OF DATA TO BE MOVED TO PATTERN BUFFER                      66000016
*                                                                       66300016
         DS    0F                                                       66600016
DATAADDR EQU   *                                                        66900016
         LA    FROMREG,TILT                                             67200016
         LA    FROMREG,ROTATE                                           67500016
         LA    FROMREG,TWIST                                            67800016
         LA    FROMREG,ALLCHAR                                          68100016
         LA    FROMREG,ANALYZER                                         68400016
*                                                                       68700016
*  CCW'S                                                                69000016
*                                                                       69300016
DIALCCW  CCW   X'2F',0,X'60',1          DISABLE THE LINE                69600016
         CCW   X'29',0,X'60',0          SEND THE DIAL DIGITS            69900016
CHANPROG CCW   X'01',0,X'A0',4          WRITE CIRCLE D AND CIRCLE C     70200016
         CCW   X'01',0,X'60',2          WRITE THE ADDRESSING CHARACTERS 70500016
         CCW   X'02',0,X'60',1          READ THE ADDRESSING RESPONSE    70800016
         CCW   X'01',0,X'A0',15         WRITE CARRIAGE RETURN AND IDLES 71100016
         CCW   X'01',0,X'20',0          WRITE THE TEST MESSAGE          71400016
         EJECT                                                          71700016
*                                                                       72000016
*  EQUATES                                                              72300016
*                                                                       72600016
GETMAIN  EQU   1                                                        72900016
WORKREG  EQU   2                                                        73200016
PARREG   EQU   3                                                        73500016
FROMREG  EQU   4                                                        73800016
IOBREG   EQU   5                                                        74100016
BASEREG  EQU   6                                                        74400016
IOREG    EQU   7                                                        74700016
TESTREG  EQU   8                                                        75000016
PATRNREG EQU   9                                                        75300016
CCWREG   EQU   10                                                       75600016
DCBREG   EQU   11                                                       75900016
DECBREG  EQU   12                                                       76200016
TOREG    EQU   13                                                       76500016
WORKREG3 EQU   13                                                       76800016
RETURN   EQU   14                                                       77100016
LINKREG  EQU   15                                                       77400016
         EJECT                                                          77700016
         DCBD  DSORG=BX,DEVD=BS                                         78000016
         EJECT                                                          78300016
         IECTIOBX                                                       78600016
         SPACE 2                                                        78900016
IOBNAME  EQU   IOBERCCW                                                 79200016
IOBAREA  EQU   IOBNAME+8                                                79500016
IOBPARM  EQU   IOBNAME+12                                               79800016
         EJECT                                                          80100016
         IECTDECB                                                       80400016
         EJECT                                                          80700016
PARMLIST DSECT                                                          81000016
PATTERN  DS    F                                                        81300016
NLIDLES  DS    F                                                        81600016
         END                                                            81900016
./  ADD  SSI=13150262,NAME=IGC0306F
         TITLE 'IGC0306F-1060 TERMINAL TEST MODULE.'                    00300016
IGC0306F CSECT                                                          00600016
         SPACE 2                                                        00900016
         SPACE 2                                                        01200016
* STATUS -          CHANGE LEVEL 001    MARCH 18,1968                   01500016
         SPACE 2                                                        01800016
*                                                                       02100016
*                                                                       02400016
* FUNCTION -        GENERATE CHANNEL PROGRAM FOR 1060 ON LINE TESTS     02700016
*                                                                       03000016
*                                                                       03300016
* ENTRY POINT -     ENTRY IS TO FIRST INSTRUCTION FROM HEADER ANALYSIS  03600016
*                   MODULE                                              03900016
*                                                                       04200016
*                                                                       04500016
* INPUT -           REGISTER 1 - ADDRESS OF IOB                         04800016
*                   REGISTER 14 - RETURN ADDRESS                        05100016
*                                                                       05400016
*                                                                       05700016
* OUTPUT -          1.  GENERATED CHANNEL PROGRAM                       06000016
*                   2.  UPDATED USAGE COUNT AND POINTER IN              06300016
*                       TERMINAL TEST MODULE (IGG019MR)                 06600016
*                                                                       06900016
*                                                                       07200016
* EXTERNAL ROUTINE -SVC 4 ROUTINE (GETMAIN)                             07500016
*                                                                       07800016
*                                                                       08100016
* EXIT -            RETURN TO ADDRESS IN REGISTER 14                    08400016
*                                                                       08700016
*                                                                       09000016
* INLINE ROUTINES -THE INPUT MESSAGE IS LOCATED THROUGH THE PARAMETER   09300016
*                   LIST AND IS ANALYZED FOR TYPE OF REQUEST.  CCW'S    09600016
*                   FOR THE PROPER DATA AND CONTROL PURPOSES ARE FORMED 09900016
*                   IN THE CCW AREA OF THE IOB.  IF THE REQUESTED DATA  10200016
*                   PATTERN IS NOT IN USE, CORE WILL BE OBTAINED AND    10500016
*                   THE PATTERN MOVED INTO THE NEW AREA.  IF NO CORE IS 10800016
*                   AVAILABLE, THE TEST REQUEST WILL BE SWITCHED TO THE 11100016
*                   TERMINAL SPECIFIED IN THE TEST REQUEST.             11400016
*                   A SUB-ROUTINE--                                     11700016
*                                                                       12000016
*                        A.  SETS UP THE ADDRESS FOR THE CHANNEL        12300016
*                            PROGRAM.                                   12600016
*                        B.  MOVES THE BASIC CCW'S INTO THE CCW AREA OF 12900016
*                            THE IOB.                                   13200016
*                                                                       13500016
*                                                                       13800016
* ATTRIBUTES -      THIS ROUTINE IS EXECUTED IN THE SVC TRANSIENT AREA  14100016
*                   AS A TYPE 4 SVC ROUTINE, ENABLED,PRIVILEGED AND     14400016
*                   REENTRANT.                                          14700016
*                                                                       15000016
         EJECT                                                          15300016
         EJECT                                                          15900016
*                                                                       16200016
*                                                                       16500016
         BALR  BASEREG,0                                                16800016
         USING *,BASEREG                                                17100016
         USING IHADCB,DCBREG                                            17400016
         USING IECTIOB,IOBREG                                           17700016
         USING IECTDECB,DECBREG                                         18000016
         USING PARMLIST,PARREG                                          18300016
*                                                                       18600016
         LR    IOBREG,1                 LOAD IOB ADDRESS                18900016
         L     PARREG,IOBPARM           LOAD PARAMETER LIST ADDRESS     19200016
         L     IOREG,IOBAREA            LOAD I/O AREA ADDRESS           19500016
         CLI   6(IOREG),X'02'           BRANCH IF                       19800016
         BE    MSGSWTCH                           SWITCH TEST (1)       20100016
         CLI   6(IOREG),X'0B'           BRANCH IF                       20400016
         BE    MSGSWTCH                     COMPARE TEST (5)            20700016
         SR    TESTREG,TESTREG          CLEAR TEST REGISTER             21000016
         IC    TESTREG,6(IOREG)         INSERT TEST SEL. CHARACTER      21300016
         SRA   TESTREG,1                SHIFT OUT PARITY BIT            21600016
         IC    TESTREG,TESTCODE-2(TESTREG)   SET UP INDEXING            21900016
         L     PATRNREG,PATTERN         GET ADDRESS OF PATTERN NAME TBL 22200016
         LA    WORKREG,0(TESTREG,PATRNREG)                              22500016
         CLI   0(WORKREG),X'00'         BRANCH IF THIS PATTERN          22800016
         BE    NOTINUSE                                   IS NOT IN USE 23100016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          23400016
         IC    WORKREG,0(TESTREG,PATRNREG)   1-UP                       23700016
         LA    WORKREG,1(WORKREG)             USAGE                     24000016
         STC   WORKREG,0(TESTREG,PATRNREG)     COUNT                    24300016
*                                                                       24600016
SETCCWS  EQU   *                                                        24900016
         BAL   LINKREG,SETCCWRG                                         25200016
         L     WORKREG,0(TESTREG,PATRNREG)                              25500016
         SR    WORKREG3,WORKREG3       CLEAR REGISTER                   25800016
         IC    WORKREG3,0(WORKREG)     INSERT PATTERN AREA COUNT        26100016
         LA    WORKREG,1(WORKREG)       ADDRESS OF DATA TO BE SENT      26400016
         ST    WORKREG,32(CCWREG)       PUT IN CCW                      26700016
         MVI   32(CCWREG),X'01'         RESTORE OP CODE                 27000016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          27300016
         IC    WORKREG,0(TESTREG,PATRNREG)   CHARACTER COUNT            27600016
         BCTR  WORKREG3,0              REDUCE BY ONE                    27900016
         STC   WORKREG3,39(CCWREG)     PUT IN CCW                       28200016
         STC   TESTREG,8(DECBREG)       PUT DISPLACEMENT                28500016
*                                                                       28800016
FINCCWS  EQU   *                                                        29100016
         L     WORKREG,NLIDLES                                          29400016
         LA    WORKREG,24(WORKREG)      ADDRESS OF CIRCLE Y, C, S.      29700016
         ST    WORKREG,0(CCWREG)        PUT IN CCW                      30000016
         MVI   0(CCWREG),X'01'          RESTORE OP CODE                 30300016
*                                                                       30600016
         LA    WORKREG,33(IOBREG)       ADDRESS OF ADDRESSING CHARS     30900016
         ST    WORKREG,8(CCWREG)        PUT IN CCW                      31200016
         MVI   8(CCWREG),X'01'          RESTORE OP CODE                 31500016
*                                                                       31800016
         LA    WORKREG,26(DECBREG)      ADDRESS OF RESPONSE AREA        32100016
         ST    WORKREG,16(CCWREG)       PUT IN CCW                      32400016
         MVI   16(CCWREG),X'02'         RESTORE OP CODE                 32700016
*                                                                       33000016
         MVC   25(3,CCWREG),NLIDLES+1   ADDRESS OF NL-IDLES FOR  CCW    33300016
*                                                                       33600016
         LA    WORKREG,27(DECBREG)      ADDRESS OF LRC RESPONSE AREA    33900016
         ST    WORKREG,40(CCWREG)       PUT IN CCW                      34200016
         MVI   40(CCWREG),X'02'         RESTORE OP CODE                 34500016
*                                                                       34800016
         L     IOREG,IOBAREA            RE-ESTABLISH I/O POINTER        35100016
         CLI   6(IOREG),X'0B'           BRANCH IF                       35400016
         BE    CMPISON1                           COMPARE TEST (5)      35700016
         SR    WORKREG,WORKREG          CLEAR RESULT REGISTER           36000016
         CLI   8(IOREG),X'15'           TEST TENS FOR ZERO              36300016
         BE    TESTUNIT                                                 36600016
         SR    WORKREG2,WORKREG2        CLEAR SECOND WORK REGISTER      36900016
         IC    WORKREG2,8(IOREG)        TENS ADDRESSING CHARACTER       37200016
         SRA   WORKREG2,1               DROP PARITY                     37500016
         BZ    RESTART                  NO TEST--INVALID CHARACTER      37800016
         SLA   WORKREG2,1               TIMES TWO                       38100016
         AR    WORKREG,WORKREG2         TO RESULT REGISTER              38400016
         SLA   WORKREG2,2               TIMES FOUR MORE                 38700016
         AR    WORKREG,WORKREG2         TIMES TEN IN RESULT REGISTER    39000016
TESTUNIT CLI   9(IOREG),X'15'           TEST UNITS FOR ZERO             39300016
         BE    TESTRSLT                                                 39600016
         SR    WORKREG2,WORKREG2        CLEAR SECOND WORKING REGISTER   39900016
         IC    WORKREG2,9(IOREG)        UNITS ADDRESSING CHARACTER      40200016
         SRA   WORKREG2,1               DROP PARITY                     40500016
         BZ    RESTART                  NO TEST--INVALID CHARACTER      40800016
         CH    WORKREG2,=H'9'           UNITS CHARACTER MUST BE NUMERIC 41100016
         BH    RESTART                  BRANCH IF NOT                   41400016
         AR    WORKREG,WORKREG2         DEVELOP FINAL RESULT            41700016
TESTRSLT CH    WORKREG,=H'26'           TEST RESULT FOR 26              42000016
         BH    RESTART                  OVER 26 IS ILLEGAL              42300016
         SR    WORKREG2,WORKREG2        CLEAR SECOND WORK REGISTER      42600016
         IC    WORKREG2,ADDRCHAR(WORKREG)   ADDRESSING CHARACTER        42900016
         STC   WORKREG2,33(IOBREG)      PUT IN IOB                      43200016
         NR    WORKREG2,WORKREG2        TEST REGISTER                   43500016
         BZ    RESTART                  ZERO IS AN INVALID ADDRESS      43800016
         MVC   34(1,IOBREG),10(IOREG)  MOVE 1062 ADDRESSING CHARACTER   44100016
         CLI   6(IOREG),X'02'          TEST FOR MESSAGE SWITCH          44400016
         BE    GETEOA                  EQUAL MEANS MESSAGE SWITCH       44700016
         BR    RETURN                  RETURN TO SEND TEST MESSAGE      45000016
GETEOA   BCTR  IOREG,0                 POINT TO EOA                     45300016
         MVC   0(13,IOREG),1(IOREG)    SHIFT DATA                       45600016
         AR    WORKREG,IOREG           STORE                            45900016
         LA    WORKREG,10(WORKREG)          THE                         46200016
         MVI   13(IOREG),X'75'                 RESTORE CHAR.            46500016
         MVI   14(IOREG),X'3D'                              AND EOB     46800016
         ST    IOREG,32(CCWREG)         ADDRESS OF DATA TO CCW          47100016
         MVI   32(CCWREG),X'01'         RESTORE OP CODE                 47400016
GOBACK   BR    RETURN                   RETURN                          47700016
*                                                                       48000016
MSGSWTCH EQU   *                                                        48300016
         BAL   LINKREG,SETCCWRG         SET UP CCW AREA POINTER + DIAL  48600016
         LH    WORKREG,6(DECBREG)       USED IF NOT DYNAMIC BUFFERING   48900016
         TM    32(DCBREG),X'08'         TEST IF DYNAMIC BUFFERING USED  49200016
         BZ    *+12                                                     49500016
         L     WORKREG,24(DCBREG)       USED WITH DYNAMIC BUFFERING     49800016
         SH    WORKREG,=H'4'            ADJUST FOR TIC                  50100016
         STH   WORKREG,38(CCWREG)       IN CASE NO EOT FOUND            50400016
         B     FINCCWS                  CONTINUE CCW PROCESSING         50700016
*                                                                       51000016
NOTINUSE L     GETMAIN,0(PATRNREG)      ADDRESS OF GETMAIN CONSTANTS    51300016
         EX    0,DATAADDR-X'18'(TESTREG)     ADDRESS OF DATA TO MOVE    51600016
         LA    TOREG,0(TESTREG,PATRNREG)     ADDRESS OF THE TABLY ENTRY 51900016
         ST    TOREG,4(GETMAIN)         PUT IN GETMAIN CONSTANTS        52200016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          52500016
         IC    WORKREG,0(FROMREG)       CHARACTER COUNT OF DATA         52800016
         ST    WORKREG,0(GETMAIN)       PUT IN GETMAIN CONSTANTS        53100016
         SVC   4                        ISSUE GETMAIN SVC               53400016
         SLL   15,24                    ELIMINATE HIGH ORDER BITS       53700016
         NR    15,15                    TEST FOR ZERO RETURN CODE       54000016
         BNE   MSGSWTCH                 NON-ZERO IS NO CORE AVAILABLE   54300016
         MVI   0(TOREG),X'01'           SET USAGE COUNT TO ONE          54600016
         L     TOREG,0(TOREG)           GET ADRESS OF DATA AREA         54900016
         BCTR  WORKREG,0                ADJUST COUNT FOR MVC INST       55200016
         EX    WORKREG,EXMVC            MOVE THE DATA                   55500016
         B     SETCCWS                                                  55800016
*                                                                       56100016
CMPISON1 L     ADREG,36(DECBREG)       LOAD ADDR. OF LAST POLL CHAR.    56400016
         MVC   33(1,IOBREG),0(ADREG)   MOVE ADDRESSING CHARACTER        56700016
         CLI   1(ADREG),X'0D'          BRANCH IF                        57000016
         BC    8,FIRST62                       FIRST 1062               57300016
         MVI   34(IOBREG),X'07'        SELECT SECOND 1062 PRINTER       57600016
         B     CMPISON3                BRANCH TO COMPARE DATA           57900016
FIRST62  MVI   34(IOBREG),X'02'        SELECT FIRST 1062 PRINTER        58200016
CMPISON3 CLC   5(7,IOREG),CMPDATA      BRANCH IF                        58500016
         BC    8,GOODCMP                        VALID COMPARISON        58800016
         B     GETEOA                  RETURN DATA                      59100016
GOODCMP  MVC   0(9,IOREG),VALIDMSG     LOAD VALID COMPARE MESSAGE       59400016
         B     GETEOA                  SEND VALID MESSAGE               59700016
*                                                                       60000016
RESTART  EQU   *                                                        60300016
         NI    IOBINCAM,NOTEST          SET NOTEST SWITCH               60600016
         BR    RETURN                                                   60900016
*                                                                       61200016
*                                                                       61500016
SETCCWRG EQU   *                                                        61800016
         L     DECBREG,IOBECBPT         ADDRESS OF DECB                 62100016
         L     DCBREG,DECDCBAD          ADDRESS OF DCB                  62400016
         LA    CCWREG,56(IOBREG)        ADDRESS OF CCW AREA             62700016
         ST    CCWREG,16(IOBREG)       RESET CCW AREA POINTER           63000016
         MVC   0(48,CCWREG),CHANPROG    MOVE CCW'S TO CCW AREA          63300016
         BR    LINKREG                  RETURN                          63600016
*                                                                       63900016
EXMVC    MVC   0(1,TOREG),0(FROMREG)                                    64200016
         EJECT                                                          64500016
*                                                                       64800016
*  PATTERN OF DATA FOR 1060 TESTS                                       65100016
TILT     DC    AL1(TILTEND-TILT)                                        65400016
         DC    X'6123294F2C4A702664327637732567'                        65700016
         DC    X'312A4C2F4962585B5E5E5E5E5E5E40'           * TILT *     66000016
         DC    X'1508680D6D51104504571652134607'           * TEST *     66300016
         DC    X'0B6B0E6E4302755E5E5E5E5E5E3D'                          66600016
TILTEND  EQU   *                                                        66900016
*                                                                       67200016
ROTATE   DC    AL1(ROTATEND-ROTATE)                                     67500016
         DC    X'61622C2A647343400B0D524523584A'                        67800016
         DC    X'4C322502156B6D5B5E5E5E5E5E5E13'           * ROTATE *   68100016
         DC    X'046E680710164F492631370E084651'           *  TEST  *   68400016
         DC    X'57292F706776755E5E5E5E5E5E3D'                          68700016
ROTATEND EQU   *                                                        69000016
*                                                                       69300016
TWIST    DC    AL1(TWISTEND-TWIST)                                      69600016
         DC    X'6115234029684F082C6D4A0D701026'                        69900016
         DC    X'516404324576165B5E5E5E5E5E5E02'           * TWIST *    70200016
         DC    X'6243586E2F0E496B2A0B4C07674631'           * TEST  *    70500016
         DC    X'137352253757755E5E5E5E5E5E3D'                          70800016
TWISTEND EQU   *                                                        71100016
*                                                                       71400016
ALLCHAR  DC    AL1(ALLCHARX-ALLCHAR)                                    71700016
         DC    X'15020407080B0D0E1013626467686B6D'    * ALL CHARACTER * 72000016
         DC    X'6E7073434546494A4C4F51522526292A'                      72300016
         DC    X'2C2F3132755E5E5E5E5E5E3D'            * TEST  MESSAGE * 72600016
ALLCHARX EQU   *                                                        72900016
*                                                                       73200016
ANALYZER DC    AL1(ANALYZEX-ANALYZER)                                   73500016
         DC    X'02010401070108010B010D010E011367'    *SELECTRIC*       73800016
         DC    X'010101254F62676B5B01010101010101'    * ANALYZER*       74100016
         DC    X'01010101010101010101675B5E5E5E46'    *  TEST   *       74400016
         DC    X'6D3B5E5E023B5E5E043B5E5E07753D'                        74700016
ANALYZEX EQU   *                                                        75000016
         EJECT                                                          75300016
*                                                                       75600016
*  CCW'S                                                                75900016
*                                                                       76200016
CHANPROG CCW   X'01',0,X'A0',4          WRITE CIRCLE Y, C'S, S          76500016
         CCW   X'01',0,X'60',2          WRITE ADDRESSING CHARACTERS     76800016
         CCW   X'02',0,X'60',1          READ ADDRESSING RESPONSE        77100016
         CCW   X'01',0,X'A0',20         WRITE CARRIAGE RETURN AND IDLES 77400016
         CCW   X'01',0,X'60',0          WRITE THE TEST MESSAGE          77700016
         CCW   X'02',0,X'20',1          READ THE LRC RESPONSE           78000016
*                                                                       78300016
*  ADDRESSES OF DATA TO BE MOVED TO PATTERN BUFFER                      78600016
*                                                                       78900016
DATAADDR EQU   *                                                        79200016
         LA    FROMREG,TILT                                             79500016
         LA    FROMREG,ROTATE                                           79800016
         LA    FROMREG,TWIST                                            80100016
         LA    FROMREG,ALLCHAR                                          80400016
         LA    FROMREG,ANALYZER                                         80700016
*                                                                       81000016
VALIDMSG DC    X'67494F012A4668753D'   VALID COMPARE MESSAGE            81300016
CMPDATA  DC    X'0D0B0708040215'       COMPARISON DATA                  81600016
TESTCODE DC    X'181C20002428'                                          81900016
ADDRCHAR DC    X'00626467686B6D6E7073434546494A4C4F51522526292A2C2F31'  82200016
         DC    X'32'                                                    82500016
         EJECT                                                          82800016
*                                                                       83100016
*  EQUATES                                                              83400016
*                                                                       83700016
GETMAIN  EQU   1                                                        84000016
WORKREG2 EQU   1                                                        84300016
LINKREG  EQU   2                                                        84600016
PARREG   EQU   3                                                        84900016
ADREG    EQU   4                                                        85200016
WORKREG  EQU   4                                                        85500016
MULTEVEN EQU   4                                                        85800016
MULTODD  EQU   MULTEVEN+1  5                                            86100016
IOBREG   EQU   5                                                        86400016
BASEREG  EQU   6                                                        86700016
FROMREG  EQU   7                                                        87000016
IOREG    EQU   7                                                        87300016
TESTREG  EQU   8                                                        87600016
PATRNREG EQU   9                                                        87900016
CCWREG   EQU   10                                                       88200016
DCBREG   EQU   11                                                       88500016
DECBREG  EQU   12                                                       88800016
TOREG    EQU   13                                                  000D 89100016
WORKREG3 EQU   13                                                       89400016
RETURN   EQU   14                                                       89700016
NOTEST   EQU   X'FE'                                                    90000016
         EJECT                                                          90300016
         DCBD  DSORG=BX,DEVD=BS                                         90600016
         EJECT                                                          90900016
         IECTIOBX                                                       91200016
         SPACE 2                                                        91500016
IOBNAME  EQU   IOBERCCW                                                 91800016
IOBAREA  EQU   IOBNAME+8                                                92100016
IOBPARM  EQU   IOBNAME+12                                               92400016
         EJECT                                                          92700016
         IECTDECB                                                       93000016
         EJECT                                                          93300016
PARMLIST DSECT                                                          93600016
PATTERN  DS    F                                                        93900016
NLIDLES  DS    F                                                        94200016
         END                                                            94500016
./  ADD  SSI=13150263,NAME=IGC0406F
         TITLE 'IGC0406F-2740 TERMINAL TEST MODULE.'                    00300016
IGC0406F CSECT                                                          00600016
         SPACE 2                                                        00605016
* STATUS -          CHANGE LEVEL 001    MARCH 18,1968                   00610016
         SPACE 2                                                        00615016
*                                                                       00620016
*                                                                       00625016
* FUNCTION -        GENERATE CHANNEL PROGRAM FOR 2740 ON LINE TESTS     00630016
*                                                                       00635016
*                                                                       00640016
* ENTRY POINT -     ENTRY IS TO FIRST INSTRUCTION FROM HEADER ANALYSIS  00645016
*                   MODULE                                              00650016
*                                                                       00655016
*                                                                       00660016
* INPUT -           REGISTER 1 - ADDRESS OF IOB                         00665016
*                   REGISTER 14 - RETURN ADDRESS                        00670016
*                                                                       00675016
*                                                                       00680016
* OUTPUT -          1.  GENERATED CHANNEL PROGRAM                       00685016
*                   2.  UPDATED USAGE COUNT AND POINTER IN              00690016
*                       TERMINAL TEST MODULE (IGG019MR)                 00695016
*                                                                       00700016
*                                                                       00705016
* EXTERNAL ROUTINE -SVC 4 ROUTINE (GETMAIN)                             00710016
*                                                                       00715016
*                                                                       00720016
* EXIT -            RETURN TO ADDRESS IN REGISTER 14                    00725016
*                                                                       00730016
*                                                                       00735016
* INLINE ROUTINES -THE INPUT MESSAGE IS LOCATED THROUGH THE PARAMETER   00740016
*                   LIST AND IS ANALYZED FOR TYPE OF REQUEST.  CCW'S    00745016
*                   FOR THE PROPER DATA AND CONTROL PURPOSES ARE FORMED 00750016
*                   IN THE CCW AREA OF THE IOB.  IF THE REQUESTED DATA  00755016
*                   PATTERN IS NOT IN USE, CORE WILL BE OBTAINED AND    00760016
*                   THE PATTERN MOVED INTO THE NEW AREA.  IF NO CORE IS 00765016
*                   AVAILABLE, THE TEST REQUEST WILL BE SWITCHED TO THE 00770016
*                   TERMINAL SPECIFIED IN THE TEST REQUEST.             00775016
*                   A SUB-ROUTINE--                                     00780016
*                                                                       00785016
*                        A.  SETS UP THE ADDRESS FOR THE CHANNEL        00790016
*                            PROGRAM.                                   00795016
*                        B.  DETERMINES IF DIAL CCW'S ARE REQUIRED AND  00800016
*                            PREPARES THEM IF NEEDED.                   00805016
*                        D.  MOVES THE BASIC CCW'S INTO THE CCW AREA OF 00810016
*                            THE IOB.                                   00815016
*                                                                       00820016
*                                                                       00825016
* ATTRIBUTES -      THIS ROUTINE IS EXECUTED IN THE SVC TRANSIENT AREA  00830016
*                   AS A TYPE 4 SVC ROUTINE, ENABLED,PRIVILEGED AND     00835016
*                   REENTRANT.                                          00840016
*                                                                       00845016
         EJECT                                                          00850016
         SPACE 2                                                        00900016
         EJECT                                                          16200016
*                                                                       16500016
*                                                                       16800016
*                                                                       17100016
         BALR  BASEREG,0                                                17400016
         USING *,BASEREG                                                17700016
         USING IHADCB,DCBREG                                            18000016
         USING IECTIOB,IOBREG                                           18300016
         USING IECTDECB,DECBREG                                         18600016
         USING PARMLIST,PARREG                                          18900016
*                                                                       19200016
         LR    IOBREG,1                 LOAD IOB ADDRESS                19500016
         L     PARREG,IOBPARM           LOAD PARAMETER LIST ADDRESS     19800016
         L     IOREG,IOBAREA            LOAD I/O AREA ADDRESS           20100016
         L     DECBREG,IOBECBPT         ADDRESS OF DECB                 20400016
         L     DCBREG,DECDCBAD          ADDRESS OF DCB                  20700016
         CLI   6(IOREG),X'02'           BRANCH IF                       21000016
         BE    MSGSWTCH                           SWITCH TEST (1)       21300016
         CLI   6(IOREG),X'0B'           BRANCH IF                       21600016
         BE    MSGSWTCH                           COMPARE TEST (5)      21900016
         CLI   6(IOREG),X'68'           BRANCH IF                       22200016
         BE    MSGSWTCH                           VALID COMPARE (D)     22500016
         SR    TESTREG,TESTREG          CLEAR TEST REGISTER             22800016
         IC    TESTREG,6(IOREG)         INSERT TEST SEL. CHARACTER      23100016
         SRA   TESTREG,1                SHIFT OUT PARITY BIT            23400016
         IC    TESTREG,TESTCODE-2(TESTREG)   SET UP INDEXING            23700016
         L     PATRNREG,PATTERN         GET ADDRESS OF PATTERN NAME TBL 24000016
         LA    WORKREG,0(TESTREG,PATRNREG)                              24300016
         CLI   0(WORKREG),X'00'         BRANCH IF THIS PATTERN          24600016
         BE    NOTINUSE                                   IS NOT IN USE 24900016
         IC    WORKREG,0(TESTREG,PATRNREG)   1-UP                       25200016
         LA    WORKREG,1(WORKREG)             USAGE                     25500016
         STC   WORKREG,0(TESTREG,PATRNREG)     COUNT                    25800016
*                                                                       26100016
SETCCWS  EQU   *                                                        26400016
         BAL   LINKREG,SETCCWRG                                         26700016
         L     WORKREG,0(TESTREG,PATRNREG)                              27000016
         IC    WORKREG3,0(WORKREG)     INSERT PATTERN AREA COUNT        27300016
         LA    WORKREG,1(WORKREG)       ADDRESS OF DATA TO BE SENT      27600016
         ST    WORKREG,32(CCWREG)       PUT IN CCW                      27900016
         MVI   32(CCWREG),X'01'         RESTORE OP CODE                 28200016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          28500016
         IC    WORKREG,0(TESTREG,PATRNREG)   CHARACTER COUNT            28800016
         BCTR  WORKREG3,0              REDUCE BY ONE                    29100016
         STC   WORKREG3,39(CCWREG)     PUT IN CCW                       29400016
         STC   TESTREG,8(DECBREG)       PUT DISPLACEMENT                29700016
*                                                                       30000016
FINCCWS  EQU   *                                                        30300016
         TM    FEATURES,X'2C'           CHECK FOR OIU FEATURE      000K 30370018
         BO    OIU                      BRANCH IF YES              000K 30440018
         SPACE 1                                                   000K 30510018
         TM    FEATURES,X'08'          TEST FOR STC               M3111 30610018
         BZ    RETURN1                 ZERO MEANS NOT STC               30900016
         L     WORKREG2,NLIDLES        ADDRESS OF EOA, CR AND IDLES     31200016
         LA    WORKREG,25(WORKREG2)    ADDRESS OF CIRCLE C AND CIRCLE S 31500016
         ST    WORKREG,0(CCWREG)        PUT IN CCW                      31800016
         MVI   0(CCWREG),X'01'          RESTORE OP CODE                 32100016
*                                                                       32400016
         ST    WORKREG2,24(CCWREG)     STORE ADDRESS IN CCW             32700016
         MVI   24(CCWREG),X'01'        RESTORE WRITE OP CODE            33000016
*                                                                       33300016
         LA    WORKREG,26(DECBREG)      GET ADDRESS OF RESPONSE AREA    33600016
         ST    WORKREG,16(CCWREG)       PUT IN CCW                      33900016
         MVI   16(CCWREG),X'02'         RESTORE OP CODE                 34200016
*                                                                       34500016
         LA    WORKREG,33(IOBREG)       GET ADDRESS OF ADDRESSING CHARS 34800016
         ST    WORKREG,8(CCWREG)        PUT IN CCW                      35100016
         MVI   8(CCWREG),X'01'          RESTORE OP CODE                 35400016
*                                                                       35700016
RETURN1  BR    RETURN                                                   36000016
*                                                                       36300016
NOTINUSE L     GETMAIN,0(PATRNREG)      ADDRESS OF GETMAIN CONSTANTS    36600016
         EX    0,DATAADDR-4(TESTREG)         ADDRESS OF DATA TO MOVE    36900016
         LA    TOREG,0(TESTREG,PATRNREG)     ADDRESS OF THE TABLY ENTRY 37200016
         ST    TOREG,4(GETMAIN)         PUT IN GETMAIN CONSTANTS        37500016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          37800016
         IC    WORKREG,0(FROMREG)       CHARACTER COUNT OF DATA         38100016
         ST    WORKREG,0(GETMAIN)       PUT IN GETMAIN CONSTANTS        38400016
         SVC   4                        ISSUE GETMAIN SVC               38700016
         SLL   15,24                    ELIMINATE HIGH ORDER BITS       39000016
         NR    15,15                    TEST FOR ZERO RETURN CODE       39300016
         BNE   MSGSWTCH                 NON-ZERO IS NO CORE AVAILABLE   39600016
         MVI   0(TOREG),X'01'           SET USAGE COUNT TO ONE          39900016
         L     TOREG,0(TOREG)           GET ADRESS OF DATA AREA         40200016
         BCTR  WORKREG,0                ADJUST COUNT FOR MVC INST       40500016
         EX    WORKREG,EXMVC            MOVE THE DATA                   40800016
         B     SETCCWS                                                  41100016
         SPACE 2                                                   000K 41600018
OIU      EQU   *                                                   000K 42100018
*     AT THIS POINT, DEVICE CAN ONLY BE 2740 WITH CHECKING AND OIU 000K 42600018
         CLI   DECTYPE+1,TCO            TEST ENTERED ON WRITE TCO  000K 43100018
         BNE   RETURN1                  BRANCH IF NO               000K 43600018
*     IF THE REQUEST FOR TEST WAS ENTERED ON A WRITE TCO           000K 44100018
*     OPERATION, A TCO CANNOT BE REINITIATED AFTER THE TEST.       000K 44600018
*     IF THIS IS A SWITCHED LINE, A READ TV WILL BE CONSTRUCTED.   000K 45100018
*     IS THIS IS A NON-SWITCHED LINE, A READ TI WILL BE            000K 45600018
*     CONSTRUCTED.                                                 000K 46100018
         TM    FEATURES,DIALBITS        SWITCHED LINE              000K 46600018
         BNZ   DIALOIU                  BRANCH IF YES              000K 47100018
         MVI   DECTYPE+1,READTI         RESTART WITH READ INITIAL  000K 47600018
         B     RETURN1                                             000K 48100018
         SPACE 2                                                   000K 48600018
DIALOIU  MVI   DECTYPE+1,READTV         RESTART ON READ CONV.      000K 49100018
         B     RETURN1                                             000K 49600018
         SPACE 2                                                   000K 50100018
         EJECT                                                     000K 50600018
SETCCWRG LA    CCWREG,IOBCPA            START OF CHANNEL           000K 51100018
*                                       PROGRAM AREA               000K 51600018
         ST    CCWREG,IOBSTART          START HERE                 000K 52100018
         TM    FEATURES,X'0C'           S CONTROL OR XCONTROL     M3111 52600018
         BM    CHECKSC                  BRANCH IF EITHER           000K 53100018
         SPACE 2                                                   000K 53600018
MOVE     MVC   0(16,CCWREG),CHANPROG+24 BASE CHANNEL PROGRAMS      000K 54100018
         L     WORKREG2,NLIDLES         ADDR OF NLIDLES IN IGG019MR 00K 54600018
         ST    WORKREG2,0(CCWREG)       SEND EOA IDLES             000K 55100018
         MVI   0(CCWREG),X'01'          NL  IDLES                  000K 55600018
         MVI   7(CCWREG),COUNT          COUNT OF CHARACTERS        000K 56100018
         SH    CCWREG,TWENTY4           RESET CCWREG FOR INTERFACE 000K 56600018
         BR    LINKREG                  RETURN                     000K 57100018
         SPACE  4                                                  000K 57600018
CHECKSC  TM    FEATURES,X'08'           STATION CONTROL           M3111 58100018
         BZ    MOVE                     RETURN IF NOT              000K 58600018
*                                                                       61500016
STATCTL  MVC   0(40,CCWREG),CHANPROG   MOVE CCWS TO IOB                 61800016
         MVI   34(IOBREG),X'01'        MOVE SPACE CHARACTER             62100016
         BR    LINKREG                  RETURN                          62400016
*                                                                       62700016
MSGSWTCH EQU   *                                                        63000016
         BAL   LINKREG,SETCCWRG         SET UP CCW AREA POINTER + DIAL  63300016
         ST    IOREG,32(CCWREG)         ADDRESS OF DATA TO CCW          63600016
         MVI   32(CCWREG),X'01'         RESTORE OP CODE                 63900016
         LH    WORKREG,6(DECBREG)       USED IF NOT DYNAMIC BUFFERING   64200016
         TM    32(DCBREG),X'08'         TEST IF DYNAMIC BUFFERING USED  64500016
         BZ    *+12                                                     64800016
         LH    WORKREG,24(DCBREG)       USED WITH DYNAMIC BUFFERING     65100016
         SH    WORKREG,=H'4'            ADJUST FOR TIC                  65400016
         BCTR  WORKREG,0                BYPASS EOA CHAR                 65700016
         STH   WORKREG,38(CCWREG)       IN CASE NO EOT FOUND            66000016
         CLI   0(IOREG),X'1F'           LOOK FOR EOT                    66300016
         BE    FOUNDEOT                                                 66600016
         CLI   0(IOREG),X'3D'          LOOK FOR EOB              A27618 66700019
         BE    FOUNDEOT                BRANCH IF FOUND           A27618 66800019
         LA    IOREG,1(IOREG)           UP CORE POINTER                 66900016
         BCT   WORKREG,*-12             LOOP ON COUNT                   67200016
         BCTR  IOREG,0                  ADJUST TO POINT TO LAST POS.    67500016
         MVI   0(IOREG),X'1F'           PUT IN EOT AT LAST POSITION     67800016
         B     FINCCWS                  CONTINUE CCW PROCESSING         68100016
*                                                                       68400016
FOUNDEOT EQU   *                                                        68700016
         S     IOREG,IOBAREA            COMPUTE NUMBER OF CHARACTERS    69000016
         LA    IOREG,1(IOREG)           UP COUNT TO INCLUDE EOT         69300016
         STH   IOREG,38(CCWREG)         SAVE COUNT TEMPORARILY          69600016
         B     FINCCWS                  CONTINUE CCW PROCESSING         69900016
*                                                                       70200016
*  CONSTANTS                                                            70500016
*                                                                       70800016
TESTCODE DC    X'04080C001014'                                          71100016
EXMVC    MVC   0(1,TOREG),0(FROMREG)                                    71400016
         EJECT                                                          71700016
*                                                                       72000016
*  PATTERN OF DATA FOR 2740 TESTS                                       72300016
*                                                                       72600016
TILT     DC    AL1(TILTEND-TILT)                                        72900016
         DC    X'622367266B2A6E2F70316120642568296D2C733276375B5E5E5E'  73200016
         DC    X'5E5E5E573452134C0D49084504401551104F0E4A0B460743025B'  73500016
         DC    X'5E5E5E5E5E5E1F'                                        73800016
TILTEND  EQU   *                                                        74100016
*                                                                       74400016
ROTATE   DC    AL1(ROTATEND-ROTATE)                                     74700016
         DC    X'62766B6D706443574A4C514523372A23312502340B0D5B5E5E5E'  75000016
         DC    X'5E5E5E100407130E081526322F292046524F494067736E68615B'  75300016
         DC    X'5E5E5E5E5E5E1F'                                        75600016
ROTATEND EQU   *                                                        75900016
*                                                                       76200016
TWIST    DC    AL1(TWISTEND-TWIST)                                      76500016
         DC    X'E234A357E713A652EB0DAA4CEE08AF49F004B145E1155B5E5E5E'  76800016
         DC    X'5E5E5E8276C3378773C6328B6DCA2C8E68CF299064D125A0405B'  77100016
         DC    X'5E5E5E5E5E5E1F'                                        77400016
TWISTEND EQU   *                                                        77700016
*                                                                       78000016
ALLCHAR  DC    AL1(ALLCHARX-ALLCHAR)                                    78300016
         DC    X'15020407080B0D0E1013626467686B6D6E7073434546494A4C4F'  78600016
         DC    X'51522526292A2C2F31325B5E5E5E5E5E5EE2E4E7E8EBEDEEF0F3'  78900016
         DC    X'C3C5C6C9CACCCFD1D2A5A6A9AAACAFB1B25B5E5E1F'            79200016
ALLCHARX EQU   *                                                        79500016
*                                                                       79800016
ANALYZER DC    AL1(ANALYZEX-ANALYZER)                                   80100016
         DC    X'020407080B016701130101250162016B616445254F5D5D5D5D5D'  80400016
         DC    X'5D5D5D5D5D5D5D155D5D5D105D5D5D0D0101010101014F01675B'  80700016
         DC    X'01010101010101675E5B5E5E5E466D3B5E5E023B5E5E043B5E5E'  81000016
         DC    X'075B1F'                                                81300016
ANALYZEX EQU   *                                                        81600016
*                                                                       81900016
*  ADDRESSES OF DATA TO BE MOVED TO PATTERN BUFFER                      82200016
*                                                                       82500016
         DS    0H                                                       82800016
DATAADDR EQU   *                                                        83100016
         LA    FROMREG,TILT                                             83400016
         LA    FROMREG,ROTATE                                           83700016
         LA    FROMREG,TWIST                                            84000016
         LA    FROMREG,ALLCHAR                                          84300016
         LA    FROMREG,ANALYZER                                         84600016
*                                                                       84900016
*  CCW'S                                                                85200016
*                                                                       85500016
DIALCCW  CCW   X'2F',0,X'60',1          DISABLE THE LINE                85800016
         CCW   X'29',0,X'60',0          SEND THE DIAL DIGITS            86100016
CHANPROG CCW   X'01',0,X'A0',4          WRITE CIRCLE D AND CIRCLE C     86400016
         CCW   X'01',0,X'60',2          WRITE THE ADDRESSING CHARACTERS 86700016
         CCW   X'02',0,X'60',2          READ THE ADDRESSING RESPONSE    87000018
         CCW   X'01',0,X'A0',15         WRITE CARRIAGE RETURN AND IDLES 87300016
         CCW   X'01',0,X'20',0          WRITE THE TEST MESSAGE          87600016
TWENTY4  DC    H'24'                    THREE CCWS                 000K 87700018
         EJECT                                                          87900016
*                                                                       88200016
*  EQUATES                                                              88500016
*                                                                       88800016
WORKREG2 EQU   1                                                        89100016
GETMAIN  EQU   1                                                        89400016
WORKREG  EQU   2                                                        89700016
PARREG   EQU   3                                                        90000016
FROMREG  EQU   4                                                        90300016
IOBREG   EQU   5                                                        90600016
BASEREG  EQU   6                                                        90900016
IOREG    EQU   7                                                        91200016
TESTREG  EQU   8                                                        91500016
PATRNREG EQU   9                                                        91800016
CCWREG   EQU   10                                                       92100016
DCBREG   EQU   11                                                       92400016
DECBREG  EQU   12                                                       92700016
TOREG    EQU   13                                                       93000016
WORKREG3 EQU   13                                                       93300016
RETURN   EQU   14                                                       93600016
LINKREG  EQU   15                                                       93900016
COUNT    EQU   20                       COUNT OF CHARACTERS        000K 93950018
TCO      EQU   X'0E'                    INVITATIONAL OPTICAL       000K 94000018
DIALBITS EQU   X'90'                    ACALL,AANSR FEATURES       000K 94050018
READTI   EQU   1                        READ INITIAL               000K 94100018
READTV   EQU   5                        READ CONVERSATIONAL        000K 94150018
         EJECT                                                          94200016
         DCBD  DSORG=BX,DEVD=BS                                         94500016
         EJECT                                                          94800016
         IECTIOBX                                                       95100016
         SPACE 2                                                        95400016
IOBNAME  EQU   IOBERCCW                                                 95700016
IOBAREA  EQU   IOBNAME+8                                                96000016
IOBPARM  EQU   IOBNAME+12                                               96300016
FEATURES EQU   IOBWORK+3                OPTIONAL FEATURES FROM UCB 000K 96400018
         EJECT                                                          96600016
         IECTDECB                                                       96900016
         EJECT                                                          97200016
PARMLIST DSECT                                                          97500016
PATTERN  DS    F                                                        97800016
NLIDLES  DS    F                                                        98100016
         END                                                            98400016
./  ADD  SSI=13150264,NAME=IGC0506F
         TITLE 'IGC0506F-2848/2260 TERMINAL TEST MODULE.'               00300016
IGC0506F CSECT                                                          00600016
         SPACE 2                                                        00606016
* STATUS -          CHANGE LEVEL 001    MARCH 18,1968                   00612016
         SPACE 2                                                        00618016
*                                                                       00624016
* FUNCTION -        GENERATE CHANNEL PROGRAM FOR 2848 ON LINE TESTS     00630016
*                                                                       00636016
*                                                                       00642016
* ENTRY POINT -     ENTRY IS TO FIRST INSTRUCTION FROM HEADER ANALYSIS  00648016
*                   MODULE                                              00654016
*                                                                       00660016
*                                                                       00666016
* INPUT -           REGISTER 1 - ADDRESS OF IOB                         00672016
*                   REGISTER 14 - RETURN ADDRESS                        00678016
*                                                                       00684016
*                                                                       00690016
* OUTPUT -          1.  GENERATED CHANNEL PROGRAM (COMPLETE IF REQUEST  00696016
*                       IS FOR A PATTERN)                               00702016
*                   2.  UPDATED USAGE COUNT AND POINTER IN TERMINAL     00708016
*                       TEST CONTROL MODULE (IGG019MR)                  00714016
*                                                                       00720016
*                                                                       00726016
* EXTERNAL ROUTINE -SVC 4 ROUTINE (GETMAIN)                             00732016
*                   SVC 7 ROUTINE (TRANSFER CONTROL)                    00738016
*                                                                       00744016
*                                                                       00750016
* EXIT -            RETURN TO ADDRESS IN REGISTER 14 IF REQUEST IS FOR  00756016
*                   A PATTERN OR TRANSFER CONTROL TO 'IGC0606F'         00762016
*                                                                       00768016
*                                                                       00774016
* INLINE ROUTINES -THE INPUT MESSAGE IS LOCATED THROUGH THE PARAMETER   00780016
*                   LIST AND IS ANALYZED FOR TYPE OF REQUEST.  CCW'S    00786016
*                   FOR THE PROPER DATA AND CONTROL PURPOSES ARE FORMED 00792016
*                   IN THE CCW AREA OF THE IOB.  IF THE REQUESTED DATA  00798016
*                   PATTERN IS NOT IN USE, CORE WILL BE OBTAINED AND    00804016
*                   THE PATTERN MOVED INTO THE NEW AREA.  IF NO CORE IS 00810016
*                   AVAILABLE, THE TEST REQUEST WILL BE SWITCHED TO THE 00816016
*                   TERMINAL SPECIFIED IN THE TEST REQUEST.             00822016
*                   SUB-ROUTINES--                                      00828016
*                                                                       00834016
*                        A.  CONVERT TWO ASCII DIGITS TO BINARY.        00840016
*                        B.  FIND THE LENGTH OF A BUFFER.               00846016
*                                                                       00852016
*                                                                       00858016
* ATTRIBUTES -      THIS ROUTINE IS EXECUTED IN THE SVC TRANSIENT AREA  00864016
*                   AS A TYPE 4 SVC ROUTINE, ENABLED,PRIVILEGED AND     00870016
*                   REENTRANT.                                          00876016
*                                                                       00882016
         EJECT                                                          00888016
         SPACE 2                                                        00900016
         EJECT                                                          15600016
*                                                                       15900016
*                                                                       16200016
         BALR  BASEREG,0                                                16500016
         USING *,BASEREG                                                16800016
         USING PARMLIST,PARREG                                          17100016
         USING IECTIOB,IOBREG                                           17400016
         USING IECTDECB,DECBREG                                         17700016
*                                                                       18000016
         LR    IOBREG,1                 LOAD IOB ADDRESS                18300016
         L     PARREG,IOBPARM           LOAD PARAMETER LIST ADDRESS     18600016
         L     DECBREG,IOBECBPT         ADDRESS OF DECB                 18900016
         L     DCBREG,DECDCBAD          ADDRESS OF DCB                  19200016
         LA    CCWREG,56(IOBREG)       ADDRESS OF CCW AREA         000D 19500016
         ST    CCWREG,16(IOBREG)        PUT IN IOB POINTER              19800016
         MVC   0(32,CCWREG),CHANPROG    MOVE CCW'S INTO CCW AREA        20100016
         L     IOREG,IOBAREA            LOAD I/O AREA ADDRESS           20400016
         CLI   6(IOREG),X'59'           TEST FOR REQUESTED ADDRESS      20700016
         BE    REQADDRX                                                 21000016
*                                                                       21300016
         BAL   LINKREG,ASCIIBIN         CONVERT DC ADDRESS TO BINARY    21600016
         IC    WORKREG,8(IOREG)         TENS                            21900016
         IC    WORKREG2,9(IOREG)        UNITS                           22200016
         BZ    RESTART                  ZERO RESULT IS NOT VALID        22500016
         CH    WORKREG,H33+2            TEST FOR 1-32                   22800016
         BL    ADD3F                                                    23100016
         CH    WORKREG,H65+2            TEST FOR 33-64                  23400016
         BL    ADD40                                                    23700016
         LA    WORKREG,32(WORKREG)      ADDRESS IS 65-96                24000016
ADD40    LA    WORKREG,64(WORKREG)      ADDRESS IS 33 OR MORE           24300016
ADD3F    LA    WORKREG,63(WORKREG)                                      24600016
         STC   WORKREG,35(IOBREG)       PUT DC ADDRESS IN IOB           24900016
         BAL   LINKREG,ASCIIBIN         CONVERT DEVICE ADDRESS          25200016
H10      IC    WORKREG,10(IOREG)        TENS                            25500016
         IC    WORKREG2,11(IOREG)       UNITS                           25800016
         BZ    RESTART                  ZERO RESULT IS NOT VALID        26100016
         CH    WORKREG,H26              IS DS ADDRESS 26 OR MORE A27620 26140019
         BL    NOT2265                  NO, DEVICE IS 2260       A27620 26180019
         CLI   35(IOBREG),X'50'         IS DC ADDRESS VALID      A27620 26220019
         BNL   RESTART                  NO, RESTART              A27620 26260019
         IC    WORKREG2,35(IOBREG)      GET DC ADDRESS           A27620 26300019
         CH    WORKREG,H27              COMPARE DS ADDRESS TO 27 A27620 26340019
         BH    RESTART                  MORE THAN 27, INVALID    A27620 26380019
         BE    PRNTR                    EQUAL TO 27, 2845/1053   A27620 26420019
         LA    WORKREG2,16(WORKREG2)    DS ADDRESS 26, 2845/2265 A27620 26460019
PRNTR    STC   WORKREG2,36(IOBREG)      STORE DS ADDRESS         A27620 26500019
         B     REQADDRX                                          A27620 26540019
NOT2265  LA    WORKREG,159(WORKREG)     DEVELOP ADDRESS RESULT   A27620 26580019
         STC   WORKREG,36(IOBREG)       PUT DEVICE ADDRESS IN IOB       26700016
REQADDRX MVI   33(IOBREG),X'02'         PUT STX IN IOB                  27000016
         MVI   34(IOBREG),X'04'         PUT EOT IN IOB                  27300016
         MVI   37(IOBREG),X'A0'         PUT THE OP CODE IN IOB          27600016
         CLI   6(IOREG),X'58'           CHECK FOR TYPE 8 REQUEST        27900016
         BNE   *+8                      BRANCH IF NOT                   28200016
         MVI   37(IOBREG),X'B0'         PUT IN OP FOR TYPE 8 REQUEST    28500016
H33      LA    WORKREG,33(IOBREG)       ADDRESS OF STX, ETC.            28800016
         ST    WORKREG,0(CCWREG)        PUT IN CCW                      29100016
         MVI   0(CCWREG),X'01'          RESTORE OP CODE                 29400016
*                                                                       29700016
         LA    WORKREG,26(DECBREG)      ADDRESS FOR ADDRESSING RESPONSE 30000016
         ST    WORKREG,8(CCWREG)        PUT IN CCW                      30300016
         MVI   8(CCWREG),X'02'          RESTORE OP CODE                 30600016
*                                                                       30900016
         LA    WORKREG,27(DECBREG)      ADDRESS FOR LRC RESPONSE        31200016
         ST    WORKREG,24(CCWREG)       PUT IN CCW                      31500016
         MVI   24(CCWREG),X'02'         RESTORE OP CODE                 31800016
         CLI   6(IOREG),X'51'           BRANCH IF                       32100016
         BE    MSGSWTCH                           MESSAGE SWITCH        32400016
         CLI   6(IOREG),X'55'           BRANCH IF                       32700016
         BE    COMPARE                            COMPARE TEST          33000016
         CLI   6(IOREG),X'58'           BRANCH IF                       33300016
         BE    WRATLINE                      WRITE AT LINE ADDRESS TEST 33600016
         BH    REQADDR    09            BRANCH IF REQUEST ADDRESS       33900016
         SR    TESTREG,TESTREG          CLEAR TEST REGISTER             34200016
         IC    TESTREG,6(IOREG)         INSERT TEST SELECT CHARACTER    34500016
         IC    TESTREG,TESTCODE-82(TESTREG)   SET UP INDEXING           34800016
         L     WORKREG2,0(PARREG)       ADDRESS OF PATTERN NAME TABLE   35100016
         LA    WORKREG,0(TESTREG,WORKREG2)                              35400016
         CLI   0(WORKREG),X'00'         BRANCH IF THIS PATTERN          35700016
         BE    NOTINUSE                                   IS NOT IN USE 36000016
         IC    WORKREG,0(TESTREG,WORKREG2)   1-UP                       36300016
         LA    WORKREG,1(WORKREG)             USAGE                     36600016
         STC   WORKREG,0(TESTREG,WORKREG2)     COUNT                    36900016
SETDATA  EQU   *                                                        37200016
         L     WORKREG,0(TESTREG,WORKREG2)                              37500016
         IC    WORKREG2,0(WORKREG)      LENGTH OF DATA                  37800016
         BCTR  WORKREG2,0               REDUCE BY ONE                   38100016
         STC   WORKREG2,23(CCWREG)      PUT IN CCW                      38400016
         STC   TESTREG,8(DECBREG)       STORE DISPLACEMENT FOR LATER    38700016
         LA    WORKREG,1(WORKREG)       ADDRESS OF DATA TO BE SENT      39000016
         ST    WORKREG,16(CCWREG)       PUT IN CCW                      39300016
         MVI   16(CCWREG),X'01'         RESTORE OP CODE                 39600016
         BR    RETURN                   EXIT                            39900016
*                                                                       40200016
NOTINUSE EQU   *                                                        40500016
         L     GETMAIN,0(WORKREG2)      ADDRESS OF GETMAIN CONSTANTS    40800016
         EX    0,DATAADDR-X'40'(TESTREG)     ADDRESS OF TEST DATA       41100016
         LA    TOREG,0(TESTREG,WORKREG2)     ADDRESS OF THE TABLE ENTRY 41400016
         ST    TOREG,4(GETMAIN)                                         41700016
         SR    COUNTREG,COUNTREG        CLEAR A REGISTER FOR COUNT      42000016
         IC    COUNTREG,0(WORKREG)      CHARACTER COUNT OF DATA         42300016
         ST    COUNTREG,0(GETMAIN)     PUT IN GETMAIN CONSTANTS         42600016
         SVC   4                        ISSUE GETMAIN SVC               42900016
         SLL   15,24                    ELIMINATE HIGH ORDER BITS       43200016
         NR    15,15                    TEST FOR ZERO RETURN CODE       43500016
         BNE   MSGSWTCH                 NON-ZERO IS NO CORE AVAILABLE   43800016
         MVI   0(TOREG),X'01'           SET USAGE COUNT TO ONE          44100016
         L     TOREG,0(TOREG)           GET ADDRESS OF DATA AREA        44400016
         BCTR  COUNTREG,0               ADJUST COUNT FOR MVC INST       44700016
         EX    COUNTREG,EXMVC           MOVE THE DATA                   45000016
         B     SETDATA                  FINISH THE DATA CCW             45300016
*                                                                       45600016
RESTART  EQU   *                                                        45900016
         NI    IOBINCAM,NOTEST          SET NOTEST SWITCH               46200016
         BR    RETURN                                                   46500016
*                                                                       46800016
COMPARE  EQU   *                                                        47100016
         BAL   LINKREG,GETCOUNT         GET LENGTH OF BUFFER            47400016
         LR    COUNTREG,WORKREG                                         47700016
         SH    COUNTREG,H14             BYPASS HEADER                   48000016
         LA    IOREG,12(IOREG)          ADDRESS OF CHARACTERS IN INPUT  48300016
         LA    WORKREG,ALLCHAR+3        ADDRESS OF COMPARE DATA         48600016
CHECKETX CLI   0(IOREG),X'03'           CHECK FOR ETX                   48900016
         BE    COMPDONE                                                 49200016
         CLI   0(WORKREG),X'0A'         CHECK IF PAST END OF DATA       49500016
         BE    MSGSWTCH                 IF YES, SWITCH THE MESSAGE      49800016
         CLC   0(1,IOREG),0(WORKREG)    IS THIS CHARACTER EQUAL         50100016
         BNE   MSGSWTCH                 IF NOT, SWITCH THE MESSAGE      50400016
         LA    IOREG,1(IOREG)           UP POINTERS                     50700016
         LA    WORKREG,1(WORKREG)                                       51000016
         BCT   COUNTREG,CHECKETX        LOOP ON COUNT                   51300016
*                                                                       51600016
COMPDONE EQU   *                                                        51900016
         BCTR  IOREG,0                  BACK INPUT POINTER TO LAST CHAR 52200016
         L     WORKREG,IOBAREA          START ADDRESS              000D 52500016
         MVC   0(10,WORKREG),VALIDCMP   MOVE IN VALID COMPARE MESSAGE   52800016
         IC    WORKREG2,0(IOREG)        LAST CHARACTER COMPARED         53100016
         LA    WORKREG,11(WORKREG)      COMPUTE DISPLACEMENT OF LAST    53400016
         SR    WORKREG,IOREG             CHARACTER DISPLAYED            53700016
         BZ    MSGSWTCH                 ZERO--NO CHARACTERS             54000016
         L     WORKREG,IOBAREA                                     000D 54300016
         STC   WORKREG2,8(WORKREG)      PUT LAST CHAR COMPARED IN MSG.  54600016
         B     MSGSWTCH                                                 54900016
*                                                                       55200016
MSGSWTCH EQU   *                                                        55500016
WRATLINE EQU   *                                                        55800016
REQADDR  EQU   *                                                        56100016
         IC    PARREG,=X'F6'           GET NEXT MODULE ID          000D 56500016
         STC   PARREG,IOBERCCW+4       STORE IN MODULE NAME        000D 56900016
         LA    PARREG,IOBERCCW         GET ADDR OF MODULE NAME     000D 57300016
         XCTL  EPLOC=(3)               LINK TO NEXT LOAD                57700016
*                                                                       58200016
*  CONVERT TWO ASCII DIGITS TO A BINARY NUMBER  ENTRY IS--              58500016
*                                                                       58800016
*        BAL   LINKREG,ASCIIBIN                                         59100016
*        IC    WORKREG,TENSCHAR         RESULT IS RETURNED IN WORKREG   59400016
*        IC    WORKREG2,UNITCHAR                                        59700016
ASCIIBIN EQU   *                                                        60000016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTERS         60300016
         SR    WORKREG2,WORKREG2                                        60600016
         EX    0,0(LINKREG)             GET TENS CHARACTER              60900016
         N     WORKREG,F15              DROP ZONE BITS                  61200016
         MH    WORKREG,H10+2            CONVERT TO TENS FACTOR          61500016
         EX    0,4(LINKREG)             GET UNITS CHARACTER             61800016
         N     WORKREG2,F15             DROP ZONE BITS                  62100016
         AR    WORKREG,WORKREG2         DEVELOP FINAL RESULT            62400016
         B     8(LINKREG)               RETURN                          62700016
*                                                                       63000016
*  GET COUNT OF CHARACTERS IN A BUFFER                                  63300016
*                                                                       63600016
GETCOUNT EQU   *                                                        63900016
         LH    WORKREG,6(DECBREG)       USED IF NOT DYNAMIC BUFFERING   64200016
         TM    32(DCBREG),X'08'         TEST IF DYNAMIC BUFFERING USED  64500016
         BZ    *+12                                                     64800016
         LH    WORKREG,24(DCBREG)       USED WITH DYNAMIC BUFFERING     65100016
         SH    WORKREG,H4+2             BYPASS TIC                      65400016
         BR    LINKREG                                                  65700016
*                                                                       66000016
*                                                                       66300016
*  PATTERNS OF DATA FOR 2848 TESTS                                      66600016
*                                                                       66900016
TILT     DC    AL1(TILTEND-TILT)                                        67200016
         DC    X'020AA1BFA3B4A5B6A7B8A8B9455FA2B3A4B5A6B7A9BA5A48AA5C'  67500016
         DC    X'AC0A49AE4AB047B1FE5EBDABFCAD5BAF42B25D0A03'            67800016
TILTEND  EQU   *                                                        68100016
*                                                                       68400016
ROTATE   DC    AL1(ROTATEND-ROTATE)                                     68700016
         DC    X'020AA1A9A5A4A8A2AAB2AEADB1ABBFBAB6B5B9B3484249FC47BD'  69000016
         DC    X'5159550A54585243535657505D5C5B4AFE5AB4B7B85FACAFB05E'  69300016
         DC    X'A3A6A7450A03'                                          69600016
ROTATEND EQU   *                                                        69900016
*                                                                       70200016
TWIST    DC    AL1(TWISTEND-TWIST)                                      70500016
         DC    X'020AA143BF44A359B4A9A556B6A6A754B8A4A852B9A24550B346'  70800016
         DC    X'A457A6B8B755A9B6BA0A534351485DB253AF5C42AD55AB495B5E'  71100016
         DC    X'58B1FCB050AEBDAC52AAFE54AE56B1590A03'                  71400016
TWISTEND EQU   *                                                        71700016
*                                                                       72000016
ALLCHAR  DC    AL1(ALLCHARX-ALLCHAR)                                    72300016
         DC    X'020A50515253545556575859A1A2A3A4A5A6A7A8A9AAABACADAE'  72600016
         DC    X'AFB0B1B2B3B4B5B6B7B8B9BA0A03'                          72900016
ALLCHARX EQU   *                                                        73200016
*                                                                       73500016
*  CCW'S                                                                73800016
*                                                                       74100016
F15      CCW   X'00',15,X'60',5         STX, EOT, ADDRESS, OPERATION    74400016
         CCW   X'02',0,X'60',1          READ ADDRESSING RESPONSE        74700016
H65      CCW   X'01',65,X'60',42        WRITE THE TEST MESSAGE          75000016
         CCW   X'02',0,X'20',1          READ THE LRC RESPONSE           75300016
*                                                                       75600016
*  ADDRESSES OF DATA TO BE MOVED TO PATTERN BUFFER                      75900016
*                                                                       76200016
DATAADDR EQU   *                                                        76500016
         LA    FROMREG,TILT                                             76800016
         LA    FROMREG,ROTATE                                           77100016
         LA    FROMREG,TWIST                                            77400016
         LA    FROMREG,ALLCHAR                                          77700016
*                                                                       78000016
*  CONSTANTS                                                            78300016
*                                                                       78600016
TESTCODE DC    X'404448004C'                                            78900016
EXMVC    MVC   0(1,TOREG),0(FROMREG)                                    79200016
VALIDCMP DC    X'A3ADB040B6ACA44D4F03'  VALID COMPARE MESSAGE           79500016
H4       DC    H'4'                                                     79800016
H14      DC    H'14'                                                    80100016
H26      DC    H'26'                                                    80200019
H27      DC    H'27'                                                    80300019
*                                                                       80400016
*  EQUATES                                                              80700016
*                                                                       81000016
GETMAIN  EQU   1                                                        81300016
LINKREG  EQU   2                                                        81600016
TOREG    EQU   2                                                        81900016
PARREG   EQU   3                                                        82200016
TESTREG  EQU   4                                                        82500016
MULTEVEN EQU   4                                                        82800016
MULTODD  EQU   5                                                        83100016
IOBREG   EQU   5                                                        83400016
BASEREG  EQU   6                                                        83700016
IOREG    EQU   7                                                        84000016
FROMREG  EQU   8                                                        84300016
WORKREG  EQU   8                                                        84600016
WORKREG2 EQU   9                                                        84900016
CCWREG   EQU   10                                                       85200016
DCBREG   EQU   11                                                       85500016
DECBREG  EQU   12                                                       85800016
COUNTREG EQU   13                                                       86100016
RETURN   EQU   14                                                       86400016
CHANPROG EQU   F15                                                      86700016
NOTEST   EQU   X'FE'                                                    87000016
         SPACE 2                                                        87300016
         IECTIOBX                                                       87600016
IOBNAME  EQU   IOBERCCW                                                 87900016
IOBAREA  EQU   IOBNAME+8                                                88200016
IOBPARM  EQU   IOBNAME+12                                               88500016
         EJECT                                                          88800016
         IECTDECB                                                       89100016
         EJECT                                                          89400016
PARMLIST DSECT                                                          89700016
PATTERN  DS    F                                                        90000016
NLIDLES  DS    F                                                        90300016
         END                                                            90600016
./  ADD  SSI=60410458,NAME=IGC058
 TITLE 'IGC058 - BTAM SVC ROUTINE FOR DYNAMIC BUFFERING'                00020000
IGC058   CSECT                                                          00040000
         SPACE 2                                                        00060000
**********                                                   ********** 00070002
*                                                                     * 00072002
*     THIS MODULE HAS BEEN PARTIALLY RE-WRITTEN FOR OS/VS2 REL 2      * 00074002
*                                                                     * 00076002
**********                                                   ********** 00078002
         SPACE 2                                                        00078402
* STATUS -          CHANGE LEVEL 000    JANUARY 25, 1967                00080000
         SPACE 2                                                        00100000
*FUNCTION@ THIS ROUTINE PROVIDES ACCESS TO A DYNAMIC BUFFER MANAGEMENT* 00120000
*   ROUTINE LOADED AT OPEN                                            * 00140000
         SPACE 2                                                        00160000
* ENTRY POINT -     ENTRY IS TO 1ST EXECUTABLE INSTRUCTION              00180000
         SPACE 2                                                        00200000
* INPUT -           REGISTER 0 - REQUEST COUNT OR RELEASE ADDRESS       00220000
*                   REGISTER 1 - DCB ADDRESS                            00240000
         SPACE 2                                                        00260000
* OUTPUT -          REGISTER 15- 00-12 RETURN CODE FROM BUFFER ROUTINE  00280000
*                                16    NO BUFFER ROUTINE                00300000
         SPACE 2                                                        00320000
*EXTERNAL ROUTINES@ BUFFER ROUTINE (IGG019MS)                         * 00340000
         SPACE 2                                                        00360000
* EXIT -            RETURN IS TO SVC HANDLER VIA REGISTER 14            00380000
         SPACE 2                                                        00400000
*ATTRIBUTES - THIS IS A TYPE I SVC ROUTINE.  IT IT IS RESIDENT AND    * 00420000
*             RUNS DISABLED IN SUPERVISOR MODE.                       * 00440000
*                                                                       00450000
**************** APAR FIXES ******************************************* 00452000
*********************************************************************** 00453000
*      ZA02831                    ZA02836                               00454000
*      AZ08069  (02/02/76)                                              00455000
*                                                                       00456000
*                                                                       00457000
*                                                                       00458000
*********************************************************************** 00459000
         EJECT                                                          00460000
*                                                                       00470002
*                   REGISTER EQUATION                                   00472002
*                                                                       00474002
REGZERO  EQU   0                                                        00476002
DCBREG   EQU   1                        ADDRESS OF DCB                  00480000
DEBREGAD EQU   1                        DEB ADDR FOR DEBCHK   LD Y02947 00482002
AREAREG  EQU   1                        ADDR FROM GETMAIN     LD YM4077 00482402
SAVEREG  EQU   2                                                        00484002
TESTREG  EQU   3                                                        00488002
TCBREG   EQU   4                        TCB ADDRESS           LD YM4077 00492002
DEBREG   EQU   5                        ADDR OF DEB           LD YM4077 00496002
SAVE2REG EQU   6                                                        00498002
ASCBREG  EQU   7                        ADDRESS OF ASCB       LD YM4077 00500002
CVTREG   EQU   8                        PTR TO CVT            LD Y02947 00510002
SAVREG15 EQU   8                                              LD YM4077 00510402
CVTEXTRG EQU   9                        PTR TO CVT EXTENSION  LD Y02947 00512002
TCBREG2  EQU   10                       PTR TO TCB            LD YM4077 00514002
FREEMREG EQU   11                       FREEMAIN ADDRESS      LD YM4077 00516002
BASEREG  EQU   12                       BASE REGISTER                   00520000
SAVERG   EQU   13                       SAVEAREA REG          LD YM4077 00530002
RETREG   EQU   14                       RETURN REGISTER                 00540000
BRREG    EQU   15                       BRANCH REGISTER                 00560000
         SPACE 3                                                        00570002
*                                                                       00572002
*                    MISCELLANEOUS EQUATIONS                            00574002
*                                                                       00576002
ZERO     EQU   0                                              LD Y02947 00578002
TWO      EQU   2                                              LD Y02947 00578402
CRRNTTCB EQU   4                        CURRENT TCB PRT       LD YM4061 00578502
EIGHT    EQU   8                                              LD Y02947 00578802
CRNTASCB EQU   12                      CURRENT ASCB PRT       LD YM4077 00588802
DEBCHK   EQU   X'16E'                  ABEND CODE FOR DEBCHK  LD YM4061 00628802
TAM      EQU   X'10'                   BTAM ID              L5 @ZA02831 00638800
         EJECT                                                          00660002
         BALR  BASEREG,ZERO                                   LD Y02947 00680002
         USING *,BASEREG                                                00700000
         USING IHADCB,DCBREG           ADDRESSABILITY FOR DCB LD Y02947 00702002
         USING DEB,DEBREG         ADDRESSABILITY FOR DEB    L5 @ZA02831 00702400
         B     AROUND                                                   00702800
         DC    CL8'IGC058  '                                            00703200
         DC    C'** MVS *'                                              00703600
         DC    C'&SYSDATE'                                              00703700
         DC    S(*)                                                     00703800
PATCH    DC    10F'0'                                                   00703900
         DS    0F                                                       00709500
AROUND   EQU   *                                                        00711500
         LR    SAVEREG,RETREG          SAVE RETURN REGISTER             00715202
TESTDCB  EQU   *                                              LD Y02947 00720802
         SPACE 1                                                        00726402
         TM    DCBOFLGS,DCBOFOPN       IS DCB OPEN            LD Y02947 00732002
         BNO   NOR                     NO, ABORT                        00736002
*                                                                       00750002
*                                                                       00752002
*        SET PARM AND BRANCH TO DEB VALIDITY CHECK RTN                * 00754002
*        TO VERIFY THE DEB                                            * 00756002
*                                                                       00756402
*                                                                       00756802
         L     DEBREG,DCBDEBAD         DEB ADDR               LD Y02947 00757202
         SH    DEBREG,H36              ADJUST FOR DSECT     L5 @ZA02831 00757600
         CLI   DEBAMTYP,TAM            IS IT BTAM DEB?      L5 @ZA02831 00757700
         BNE   ABEND                   NO,ABEND             L5 @ZA02831 00757800
         LR    TESTREG,DCBREG          SAVE DCB ADDRESS           3866  00758002
         LR    SAVE2REG,REGZERO        SAVE REG 0             LD YM4061 00768002
         USING CVT,CVTREG          ADDRESSABILITY FOR CVT     LD YM4061 00770002
         USING CVTXTNT2,CVTEXTRG   ADDRESSABILITY FOR CVT EXT LD YM4061 00770102
         L     CVTREG,CVTPTR           CVT POINTER            LD YM4061 00770202
         L     CVTEXTRG,CVTEXT2        ADDRESS OF CVT EXT     LD YM4061 00770302
         L     TCBREG,CVTTCBP          PRT TO TCB'S ADDRS     LD YM4061 00770702
         L     ASCBREG,CRNTASCB(TCBREG) ADDRS OF CURRENT ASCB LD YM4077 00770802
         L     TCBREG,CRRNTTCB(TCBREG) ADDR OF TCB            LD YM4061 00771102
         L     BRREG,CVTDEBVR          ADDR OF BRANCH ENTRY.. LD YM4061 00771402
*                                      POINT TO DEB VALIDITY..LD YM4061 00773402
*                                      CHECK ROUTINE          LD YM4061 00773502
         SR    REGZERO,REGZERO         PARM REG0 = 0          LD YM4061 00775502
         LR    DEBREGAD,DEBREG         PARM REG1 = DEB ADDR   LD YM4051 00776002
         LA    DEBREGAD,36(DEBREGAD)   POINT TO DEB BASIC   L5 @ZA02831 00776400
         LR    TCBREG2,TCBREG          PARM REG10 = TCB ADDR  LD YM4077 00776802
         BALR  RETREG,BRREG            BRANCH TO DEBCHK RTN   LD YM4061 00777302
*                                      UPON RETURN FROM DEBVER;         00779200
*                                      DEB OK RETURN TO R14             00781200
*                                      DEB BAD RETURN T0 R14+4          00781600
*                                                                       00781802
*                                                                       00783702
         B     OKDEB                   CONTINUE             L5 @ZA02836 00786000
         B     ABEND                   DEB BAD,ABEND        L5 @ZA02836 00787500
OKDEB    LR    REGZERO,SAVE2REG        RESTORE REG 0        L5 @ZA02836 00790000
         LR    DCBREG,TESTREG          RESTORE DCBREG             3866  00791302
         SPACE 1                                                        00793202
         CLI   DEBAMLNG,ZERO           IS THERE A BUFFER RTN  LD Y02947 00795102
         BE    NOR                     NO, ABORT              LD Y02947 00797002
         L     REGZERO,AREASIZE        SIZE FOR GETMAIN       LD YM4077 00798902
         GETMAIN R,LV=(0),BRANCH=YES                          LD YM4077 00800802
         LR    SAVERG,AREAREG       SET SAVEAREA REG FOR MS   LD YM4077 00802702
         LR    FREEMREG,AREAREG     SAVE ADDR FOR FREEMAIN    LD YM4077 00804602
         LR    REGZERO,SAVE2REG        RESTORE REG 0          LD YM4077 00806502
         LR    DCBREG,TESTREG          RESTORE DCBREG         LD YM4077 00808402
         SR    BRREG,BRREG             CLEAR REGISTER                   00810302
         IC    BRREG,DEBNMEXT          NUMBER OF UCBS         LD Y02947 00812202
         SLL   BRREG,TWO               SIZE OF UCB TABLE      LD Y02947 00814102
         SPACE 1                                                        00816002
         L     BRREG,DEBSUCBA(BRREG)   GET MS ADDRESS         LD Y02947 00820002
         SPACE 1                                                        00844002
         BALR  RETREG,BRREG            LINK TO BUFFER ROUTINE           00890002
         SPACE 1                                                        00900002
         L     REGZERO,AREASIZE     SET SIZE FOR FREEMAIN     LD YM4077 00910002
         LR    AREAREG,FREEMREG     SET ADDR FOR FREEMAIN     LD YM4077 00912002
         LR    SAVREG15,BRREG       SAVE REGISTER 15          LD YM4077 00912402
         FREEMAIN R,LV=(0),A=(1),BRANCH=YES                   LD YM4077 00914002
         LR    REGZERO,SAVE2REG        RESTORE REG 0          LD YM4077 00914402
         LR    DCBREG,TESTREG          RESTORE DCBREG         LD YM4077 00914802
         LR    BRREG,SAVREG15          RESTORE REGISTER 15    LD YM4077 00915202
RET      LR    RETREG,SAVEREG          RESTORE RETURN ADDRESS           00916002
         BR    RETREG                                                   00920000
NOR      L     BRREG,NORTMSK           SET ERROR CODE                   00940002
         B     RET                                                      00960000
         SPACE 2                                                        00960302
*                                                                       00970302
*         ABEND ROUTINE                                               * 00980302
*         THIS ROUTINE WILL ISSUE AN 16E ABEND WHEN THE DEB           * 00982702
*         IS NOT A VALID ONE                                          * 00983102
*                                                                       00983502
ABEND    ABEND DEBCHK,DUMP,STEP,SYSTEM                         @ZA08069 00988800
         EJECT                                                          00990802
PAGEBOUN DS    0F                                                       00994102
         DC    X'00FFF800'                                              00999402
NORTMSK  DC    X'10000000'              ERROR CODE FOR NO BUFFER ROUTIN 01004702
AREASIZE DC    X'FA00004C'     SUBPOOL AND SIZE FOR GETMAIN   LD YM4077 01006702
H36      DC    H'36'                                        L5 @ZA02831 01008700
         EJECT                                                          01010002
CVT      DSECT                                                          01010402
         CVT LIST=YES                                                   01010802
         EJECT                                                          01011202
         DCBD  DSORG=BX,DEVD=BS                                         01012002
         EJECT                                                          01014002
         IEZDEB LIST=YES                                                01016002
         SPACE 3                                                        01018002
         CNOP  0,8                                                      01020000
         END                                                            01040000
./  ADD  SSI=13150266,NAME=IGC0606F
         TITLE 'IGC0606F-2848/2260 TERMINAL TEST MODULE.'               00500016
IGC0606F CSECT                                                          01000016
         SPACE 2                                                        01010016
* STATUS -          CHANGE LEVEL 001    MARCH 18,1968                   01020016
* STATUS -          CHANGE LEVEL 000    JANUARY 14, 1967                01030016
         SPACE 2                                                        01040016
*                                                                       01050016
* FUNCTION -        COMPLETE CHANNEL PROGRAM FOR 2848 ON LINE TESTS     01060016
*                                                                       01070016
*                                                                       01080016
* ENTRY POINT -     ENTRY IS TO FIRST INSTRUCTION FROM IGC0509I         01090016
*                                                                       01100016
*                                                                       01110016
* INPUT -           REGISTER  3 - ADDRESS OF A PARAMETER LIST           01120016
*                   REGISTER  5 - ADDRESS OF THE IOB                    01130016
*                   REGISTER  7 - ADDRESS OF THE INPUT AREA             01140016
*                   REGISTER 10 - ADDRESS OF THE CCW AREA IN THE IOB    01150016
*                   REGISTER 12 - ADDRESS OF THE DECB                   01160016
*                   REGISTER 14 - RETURN ADDRESS                        01170016
*                                                                       01180016
*                                                                       01190016
* OUTPUT -          COMPLETED CHANNEL PROGRAM                           01200016
*                                                                       01210016
*                                                                       01220016
* EXTERNAL ROUTINES-NONE                                                01230016
*                                                                       01240016
*                                                                       01250016
* EXIT -            RETURN TO ADDRESS IN REGISTER 14                    01260016
*                                                                       01270016
*                                                                       01280016
* INLINE ROUTINES - THE INPUT MESSAGE IS ANALYZED FOR TYPE OF REQUEST.  01290016
*                   THE DATA CCW IS COMPLETED AND DATA MOVED TO THE     01300016
*                   INPUT AREA IF REQUIRED.                             01310016
*                   SUBROUTINES--                                       01320016
*                        A.  CONVERT TWO ASCII DIGITS TO BINARY.        01330016
*                        B.  FIND THE LENGTH OF A BUFFER.               01340016
*                        C.  CONVERT AN ASCII ADDRESSING CHAR TO BINARY 01350016
*                                                                       01360016
*                                                                       01370016
* ATTRIBUTES -      THIS ROUTINE IS EXECUTED IN THE SVC TRANSIENT AREA  01380016
*                   AS A TYPE 4 SVC ROUTINE, ENABLED, PRIVILEGED AND    01390016
*                   REENTRANT.                                          01400016
         EJECT                                                          01410016
         SPACE 2                                                        01500016
         EJECT                                                          21000016
         BALR  BASEREG,0                                                21500016
         USING *,BASEREG                                                22000016
         USING  IECTIOB,IOBREG                                     000D 22070016
         LR    IOBREG,1                GET IOB ADDRESS             000D 22140016
         L     IOREG,IOBAREA           GET READ-IN AREA ADDR       000D 22210016
         L     PARREG,IOBPARM          LOAD PARAMETER LIST ADDR    000D 22280016
         L     DECBREG,IOBECBPT        GET DECB ADDRESS            000D 22350016
         LA    CCWREG,56(IOBREG)       ADDRESS OF CCW AREA         000D 22420016
*                                                                       22500016
         CLI   6(IOREG),X'A4'          BRANCH IF                        23000016
         BE    MSGSWTCH                         COMPARE VALID MESSAGE   23500016
         CLI   6(IOREG),X'58'           BRANCH IF                       24000016
         BE    WRATLINE                      WRITE AT LINE ADDRESS TEST 24500016
         BH    REQADDR                  BRANCH IF REQUEST ADDRESS       25000016
*                                                                       25500016
MSGSWTCH EQU   *                                                        26000016
         MVI   8(DECBREG),X'00'                                         26500016
         L     IOREG,IOBAREA            ADDRESS OF DATA TO BE SWTCHD    27000017
         BCTR  IOREG,0                  REDUCE ADDRESS FOR STX          27500016
         MVI   0(IOREG),X'02'           PUT IN STX                      28000016
         ST    IOREG,16(CCWREG)         PUT ADDRESS IN CCW              28500016
         MVI   16(CCWREG),X'01'         RESTORE OP CODE                 29000016
         BAL   LINKREG,GETCOUNT                                         29500016
         STC   WORKREG,23(CCWREG)       IN CASE NO END FOUND            30000016
         CLC   7(2,IOREG),=X'5058'      CHECK FOR WRITE AT LINE REQUEST 30500016
         BE    *+6                                                      31000016
         BCTR  WORKREG,0                BYPASS FIRST CHARACTER          31500016
         CLI   0(IOREG),X'03'           LOOK FOR ETX                    32000016
         BE    FOUNDIT                                                  32500016
         LA    IOREG,1(IOREG)           UP CORE POINTER                 33000016
         BCT   WORKREG,*-12             LOOP ON COUNT                   33500016
         BCTR  IOREG,0                  ADJUST TO POINT TO LAST POS.    34000016
         MVI   0(IOREG),X'03'           PUT IN ETX AT LAST POSITION     34500016
         BR    RETURN                                                   35000016
*                                                                       35500016
FOUNDIT S     IOREG,IOBAREA            COMPUTE NO. CHARACTERS      000D 36000016
         LA    IOREG,2(IOREG)           UP COUNT TO INCLUDE STX AND ETX 36500016
         STC   IOREG,23(CCWREG)         PUT IN CCW                      37000016
         BR    RETURN                                                   37500016
*                                                                       38000016
WRATLINE EQU   *                                                        38500016
         L     IOREG,IOBAREA           GET INPUT AREA ADDR         000D 39000016
         BCTR  IOREG,0                  ALLOW FOR ADDRESS CHARACTER     39500016
         ST    IOREG,IOBAREA           NEEDED LATER                000D 40000016
         BAL   LINKREG,ASCIIBIN         CONVERT LINE ADDRESS TO BINARY  40500016
         IC    WORKREG,13(IOREG)        TENS                            41000016
         IC    WORKREG2,14(IOREG)       UNITS                           41500016
         LA    WORKREG,79(WORKREG)      CONVERT TO ASCII CHARACTER      42000016
         STC   WORKREG,0(IOREG)         PUT AT BEGINNING OF MESSAGE     42500016
         B     MSGSWTCH                                                 43000016
*                                                                       43500016
REQADDR  EQU   *                                                        44000016
         BCTR  IOREG,0                  REDUCE INPUT AREA POINTER       44500016
         L     WORKREG,36(DECBREG)     GET ADDRESS OF POLLING CHAR.     45000016
         MVC   35(1,IOBREG),0(WORKREG)  PUT DC ADDRESS IN IOB           45500016
         MVC   36(1,IOBREG),0(IOREG)    PUT DS ADDRESS IN IOB           46000016
         MVC   1(11,IOREG),DEVMSG       PUT MESSAGE IN INPUT AREA       46500016
         LA    WORKREG,35(IOBREG)       ADDRESS OF DC IN ASCII          47000016
         BAL   LINKREG,CONVERT          CONVERT TO BINARY               47500016
         LA    WORKREG,X'50'            INITIALIZE WORK REGISTER        48000016
         SH    WORKREG2,=H'10'          CONVERT                         48500016
         BM    *+12                      BINARY                         49000016
         LA    WORKREG,1(WORKREG)         TO                            49500016
         B     *-12                        DECIMAL                      50000016
         STC   WORKREG,7(IOREG)         PUT TENS IN MESSAGE             50500016
         LA    WORKREG2,90(WORKREG2)                                    51000016
         STC   WORKREG2,8(IOREG)        PUT UNITS IN MESSAGE            51500016
         LA    WORKREG,36(IOBREG)       ADDRESS OF DS IN ASCII          52000016
         CLI   36(IOBREG),X'A0'         DS ADDRESS LESS THAN A0  A27620 52070019
         BNL   NOT2265                  NO, 2845                 A27620 52140019
         MVC   9(1,IOREG),36(IOBREG)    SAVE DS ADDRESS          A27620 52210019
         NI    9(IOREG),X'F0'           REMOVE DS ADDR NUMERICS  A27620 52280019
         CLI   9(IOREG),X'50'           IS DS ADDRESS 5X         A27620 52350019
         BE    DSPLY65                  YES, SET MESSAGE         A27620 52420019
         CLI   9(IOREG),X'40'           IS DS ADDRESS 4X         A27620 52490019
         BNE   RESTART                  NO, INVALID              A27620 52560019
         MVC   9(2,IOREG),X5257         MESSAGE FOR 2845/1053    A27620 52630019
         B     MSGSWTCH                 GO TO MESSAGE SWITCH     A27620 52700019
DSPLY65  MVC   9(2,IOREG),X5256         MESSAGE FOR 2845/2265    A27620 52770019
         B     MSGSWTCH                 GO TO MESSAGE SWITCH     A27620 52840019
NOT2265  BAL   LINKREG,CONVERT          CONVERT TO BINARY        A27620 52910019
         MVI   9(IOREG),X'51'           STORE TENS ONE IN ASCII         53000016
         CH    WORKREG2,=H'33'                                          53500016
         BL    RESTART                  LESS THAN 33 IS NOT VALID       54000016
         CH    WORKREG2,=H'57'                                          54500016
         BH    RESTART                  OVER 57 IS NOT VALID            55000016
         SH    WORKREG2,=H'42'                                          55500016
         BC    10,*+12                  PLUS OR ZERO--10 TO 12          56000016
         LA    WORKREG2,10(WORKREG2)    CORRECT RESULTING UNITS         56500016
         MVI   9(IOREG),X'50'           STORE TENS ZERO IN ASCII        57000016
         STC   WORKREG2,10(IOREG)       STORE UNITS                     57500016
         OI    10(IOREG),X'50'          ADD ASCII ZONE                  58000016
         B     MSGSWTCH                 SWITCH THIS MESSAGE             58500016
*                                                                       59000016
*                                                                       59500016
*  CONVERT AN ASCII ADDRESSING CHARACTER TO BINARY                      60000016
*                                                                       60500016
CONVERT  EQU   *                                                        61000016
         SR    WORKREG2,WORKREG2        CLEAR SECOND WORKING REGISTER   61500016
         IC    WORKREG2,0(WORKREG)      GET CHARACTER TO BE CONVERTED   62000016
         CLI   0(WORKREG),X'40'         LESS THAN 40 IS INVALID         62500016
         BL    RESTART                                                  63000016
         CLI   0(WORKREG),X'60'         40 TO 5F IS EQUIVALENT TO 1-32  63500016
         BL    SUB3F                                                    64000016
         CLI   0(WORKREG),X'A0'         60 TO 9F IS INVALID             64500016
         BL    RESTART                                                  65000016
         CLI   0(WORKREG),X'C0'         A0 TO BF IS EQUIVALENT TO 33-64 65500016
         BL    SUB40                                                    66000016
         CLI   0(WORKREG),X'E0'         C0 TO DF IS INVALID             66500016
         BL    RESTART                                                  67000016
         SH    WORKREG2,=H'32'          E0 TO FF IS EQUIVALENT TO 65-96 67500016
SUB40    SH    WORKREG2,=H'64'                                          68000016
SUB3F    SH    WORKREG2,=H'63'                                          68500016
         BR    LINKREG                  RETURN                          69000016
*                                                                       69500016
*                                                                       70000016
*  CONVERT TWO ASCII DIGITS TO A BINARY NUMBER  ENTRY IS--              70500016
*                                                                       71000016
*        BAL   LINKREG,ASCIIBIN                                         71500016
*        IC    WORKREG,TENSCHAR         RESULT IS RETURNED IN WORKREG   72000016
*        IC    WORKREG2,UNITCHAR                                        72500016
*                                                                       73000016
*                                                                       73500016
ASCIIBIN EQU   *                                                        74000016
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTERS         74500016
         SR    WORKREG2,WORKREG2                                        75000016
         EX    0,0(LINKREG)             GET TENS CHARACTER              75500016
         N     WORKREG,=F'15'           DROP ZONE BITS                  76000016
         MH    WORKREG,=H'10'           CONVERT TO TENS FACTOR          76500016
         EX    0,4(LINKREG)             GET UNITS CHARACTER             77000016
         N     WORKREG2,=F'15'          DROP ZONE BITS                  77500016
         AR    WORKREG,WORKREG2         DEVELOP FINAL RESULT            78000016
         B     8(LINKREG)               RETURN                          78500016
*                                                                       79000016
RESTART  EQU   *                                                   000D 79200016
         NI    IOBINCAM,NOTEST         SET NOTEST SWITCH           000D 79400016
         BR    RETURN                                              000D 79600016
         BR    RETURN                                                   80000016
*                                                                       80500016
*                                                                       81000016
*  GET COUNT OF CHARACTERS IN A BUFFER                                  81500016
*                                                                       82000016
GETCOUNT EQU   *                                                        82500016
         LH    WORKREG,6(DECBREG)       USED IF NOT DYNAMIC BUFFERING   83000016
         TM    32(DCBREG),X'08'         TEST IF DYNAMIC BUFFERING USED  83500016
         BZ    *+12                                                     84000016
         LH    WORKREG,24(DCBREG)       USED WITH DYNAMIC BUFFERING     84500016
         SH    WORKREG,=H'4'            BYPASS TIC                      85000016
         BR    LINKREG                                                  85500016
*                                                                       86000016
DEVMSG   DC    X'A4A34BA4B6404040404003'     DEVICE ADDRESS MESSAGE     86500016
X5257    DC    X'5257'                                                  86600019
X5256    DC    X'5256'                                                  86700019
*                                                                       87000016
*  EQUATES                                                              87500016
*                                                                       88000016
LINKREG  EQU   2                                                        88500016
PARREG   EQU   3                                                        89000016
IOBREG   EQU   5                                                        89500016
BASEREG  EQU   6                                                        90000016
IOREG    EQU   7                                                        90500016
WORKREG  EQU   8                                                        91000016
WORKREG2 EQU   9                                                        91500016
CCWREG   EQU   10                                                       92000016
DCBREG   EQU   11                                                       92500016
DECBREG  EQU   12                                                       93000016
RETURN   EQU   14                                                       93500016
NOTEST   EQU   X'FE'                                               000D 93600016
         IECTIOBX                                                  000D 93700016
IOBAREA  EQU   IOBERCCW+8                                          000D 93800016
IOBPARM  EQU   IOBERCCW+12                                         000D 93900016
         END                                                            94000016
./  ADD  SSI=13150267,NAME=IGC0706F
         TITLE 'IGC0706F' - BSC ONLTST ASCII-TRANSCODE MODULE'     000D 00500016
         SPACE 2                                                        01000016
IGC0706F CSECT                                                          01500016
*********************************************************************** 01508016
*                                                                     * 01516016
* STATUS -            CHANGE LEVEL 001, NOVEMBER 7,1969               * 01524019
*                                                                     * 01532016
* FUNCTION -          BUILD XX=1 AND PREDEFINED ASCII AND TRANS-      * 01540016
*                     CODE MESSAGES. STORE COUNT IN TEXT CCW.         * 01548016
*                                                                     * 01556016
* ENTRY POINT -       ENTRY IS TO FIRST EXECUTABLE INSTRUCTION        * 01564016
*                     VIA XCTL FROM IGC0006F.                         * 01572016
*                                                                     * 01580016
* INPUT -             CHANNEL PROGRAM IN CHANNEL PROGRAM AREA         * 01588016
*                     REGISTER 1 - ADDRESS OF IOB                     * 01596016
*                     REGISTER 4 - XX VALUE                           * 01604016
*                                                                     * 01612016
* OUTPUT -            TEST MESSAGE IN USER AREA AND COUNT IN WRITE    * 01620016
*                     TEXT CCW.                                       * 01628016
*                                                                     * 01636016
* EXTERNAL ROUTINES - SVC 0, EXECUTE CHANNEL PROGRAM                  * 01644016
*                                                                     * 01652016
* EXIT              - SVC 3, RETURN                                   * 01660016
*                                                                     * 01668016
* IN LINE ROUTINES -  1. CONTINUE - SETS UP MESSAGE FOR XX=1, USER    * 01676016
*                        DEFINED DATA.                                * 01684016
*                                                                     * 01692016
*                     2. TRANSASC - MOVE TRANSPARENT ASCII MESSAGE    * 01700016
*                        INTO USER AREA AND SET UP COUNT IN CCW.      * 01708016
*                                                                     * 01716016
*                     3. NORMASC - MOVES NORMAL PRINTABLE ASCII       * 01724016
*                        MESSG INTO AREA AND SETS COUNT IN CCW        * 01732016
*                                                                     * 01740016
*                     4. ALPHAASC - SETS UP ALPHAMERIC ASCII MSG IN   * 01748016
*                        AREA AND MOVES COUNT INTO CCW.               * 01756016
*                                                                     * 01764016
*                     5. PRINTASC - SETS UP ASCII PRINTER MSG AND     * 01772016
*                        COUNT IN CCW.                                * 01780016
*                                                                     * 01788016
*                     6. PUNCHASC - SETS UP ASCII PUNCH MSG AND       * 01796016
*                        COUNT IN CCW.                                * 01804016
*                                                                     * 01812016
*                     7. PRNTTRNS - SETS UP TRANSCODE PRINTER MSG     * 01820016
*                        AND COUNT IN CCW.                            * 01828016
*                                                                     * 01836016
*                     8. PNCHTRNS - SETS UP TRANSCODE PUNCH MSG AND   * 01844016
*                        COUNT IN CCW.                                * 01852016
*                                                                     * 01860016
*                     9. MPTTRNS - SETS UP TRANSCODE MULTIPOINT MSG   * 01868016
*                        AND COUNT IN CCW.                            * 01876016
*                                                                     * 01884016
*                     10. EXCP - STORES CPA IN IOBSTART, CLEARS       * 01892016
*                        ERROR COUNTERS, ISSUES SVC 0.                * 01900016
*                                                                     * 01908016
*                     11. WEAKLEAS - BUILDS TRANSCODE WEAK PATTERN    * 01916016
*                        MESSAGE AND COUNT IN CCW.                    * 01924016
*                                                                     * 01932016
*                     12. WEAKSWIT - BUILDS TRANSCODE WEAK-PATTERN-   * 01940016
*                        ON-SWITCHED-LINE MSG AND COUNT IN CCW.       * 01948016
*                                                                     * 01956016
* ATTRIBUTES - THIS MODULE IS RE-ENTRANT.                             * 01964016
*                                                                     * 01972016
*********************************************************************** 01980016
         SPACE 2                                                   000D 02000016
IOBREG   EQU   1                        IOB BASE REGISTER          000D 02500016
DEBREG    EQU   2                                                       02700019
WREG    EQU   2                                                         03000016
XREG     EQU   3                                                        03500016
TYPEREG  EQU   4                        X REGISTER                 000D 04000016
IOREG    EQU   5                       POINTER TO I0O AREA         000D 04500016
BASEREG  EQU   6                        MODULE BASE REGISTER       000D 05000016
LENGTREG EQU   7                        LENGTH OF MESSAGE REGISTER 000D 05500016
TESTREG  EQU   8                        WORK REGISTER              000D 06000016
CNTREG   EQU   9                        PARAMETER REG FROM 0006F   000D 06500016
DECBREG  EQU   10                      DECB ADDRESSABILITY         000D 07000016
DCBREG   EQU   11                       BASE REGISTER FOR DCB      000D 07500016
UCBREG   EQU   13                                                       07700019
         SPACE 2                                                        08000016
         BALR  BASEREG,0                ESTABLISH                  000D 08500016
         USING *,BASEREG                  MODULE ADDRESSABILITY    000D 09000016
         USING IECTIOB,IOBREG             IOB DSECT ADDRESSABILITY 000D 09500016
         USING   IHADCB,DCBREG         DCB DSECT ADDRESSABILITY    0000 10000016
         USING  IECTDECB,DECBREG       DECB ADDRESSABILITY         000D 10500016
         L     DECBREG,IOBECBPT                                    000D 11000016
         L     DCBREG,8(DECBREG)                                   000D 11500016
         USING IECTDEB,DEBREG                                           11560019
         L     DEBREG,DCBDEBAD                                          11620019
         L     DEBREG,28(DEBREG)                                        11680019
         SR    UCBREG,UCBREG                                            11740019
         IC    UCBREG,IOBUCBX                                           11800019
         SLL   UCBREG,2                                                 11860019
         L     UCBREG,DEBUCBAD(UCBREG)                                  11920019
         LA    WREG,300                                            000D 12000016
         CH    WREG,6(DECBREG)         I/O AREA AT LEAST 300 BYTES 000D 12500016
         BNH    CONTINUE                                           000D 13000016
NOMESSG   EQU   *                                                       13500016
         OI    IOBINCAM,X'02'          TURN ON ERROR BIT           000D 14000016
         B     STORLENG                GO, START CHANNEL PROGRAM   300D 14500016
CONTINUE EQU   *                                                   000D 15000016
         L     IOREG,IOBCPA+40          GET TEXT ADDRESS FROM CCWA27602 15500019
         LA    IOREG,0(IOREG)                                      000D 16000016
         BCT   TYPEREG,ANDOFF           IF X NE 1, GO TO OTHER RTN 000D 16500016
         L     CNTREG,DECAREA          ADDRESS OF USER READ IN AREA000D 17000016
         LR    WREG,IOREG              GET TEXT ADDRSSS            000D 17500016
         SR    WREG,CNTREG             NO. BYTES IN MESSG HEADER   000D 18000016
         LH    LENGTREG,DECLNGTH       GET ORIGINAL COUNT          000D 18500016
         SH    LENGTREG,IOBCSW+6       SUBTRACT RESIDUAL COUNT     000D 19000016
         SR    LENGTREG,WREG           SUBTRACT HEADER             000D 19500016
         CLC   0(2,IOREG),DCBBSTSX      IS TRANSPARENT TEXT USED   000D 20000016
         BNE   NORMTEXT                 MODIFY CH.PGM FOR NORM.TXT 000D 20500016
         BCTR  LENGTREG,0              SUBTRACT ONE FOR ETX        000D 21000016
         TM    DCBXMODE,IBCMODE        IS INTRMD. BLOCK CHK USED   000D 21500016
         BNO   STORLENG                GO STORE COUNT IN CCW       000D 22000016
         BCTR  LENGTREG,0              SUBTRACT ONE FOR IBC CHAR.  000D 22500016
         B     STORLENG                 STORE COUNT IN CCW         000D 23000016
         SPACE 2                                                   000D 23500016
NORMTEXT MVC   IOBCPA+48(8),IOBCPA+56   OVERLAY XPARENT CCW      A27602 24000019
         B     STORLENG                STORE COUNT IN CCW          000D 24500016
         SPACE 2                                                        25000016
ANDOFF   N     TYPEREG,MASK             TURN OFF HI-ORDER BIT      000D 25500016
         SLL   TYPEREG,2                MULTIPLY BY FOUR           000D 26000016
         B     MESSGSEL(TYPEREG)        BRANCH TO X-MESSG RTN      000D 26500016
         SPACE 2                                                   000D 27000016
MESSGSEL B     WEAKSWIT                 WEAK TRANSCODE-SWITCHED    000D 27500016
         B     WEAKLEAS                 WEAK TRANSCODE-LEASED      000D 28000016
         B     TRANSASC                 TRANSPARENT ASCII MESSAGE  000D 28500016
         NOP   NORMTEXT                                            000D 29000016
         B     NORMASC                  NORMAL ASCII MESSAGE       000D 29500016
         B     ALPHAASC                 ALPHAMERIC ASCII MESSAGE   000D 30000016
         B     PRINTASC                 PRINTER ASCII MESSAGE      000D 30500016
         B     PUNCHASC                 PUNCH ASCII MESSAGE        000D 31000016
         B     PRNTTRNS                 PRINTER TRANSCODE MESSAGE  000D 31500016
         B     PNCHTRNS                 PUNCH TRANSCODE MESSAGE    000D 32000016
         B     MPTTRANS                 MULTI-PT TRANSCODE MESSAGE 000D 32500016
TRANSASC MVC   0(2,IOREG),DCBBSTSX      MOVE DLE-STX TO AREA       000D 33000016
         LA    LENGTREG,128             GET HIGHEST VALUE IN ASCII 000D 33500016
         STC   LENGTREG,2(LENGTREG,IOREG) BUILD TABLE OF ALL VALID 000D 34000016
         BCT   LENGTREG,*-4                ASCII REPRESENTATIONS   000D 34500016
         STC   LENGTREG,2(IOREG)       STORE ZEROTH DIGIT          000D 35000016
         LA    LENGTREG,130             GET LENGTH OF MESSAGE      000D 35500016
         B     STORLENG                                            000D 36000016
         SPACE 2                                                        36500016
NORMASC  MVC   0(121,IOREG),ASCCHARS    MOVE MESSAGE TO I/O AREA   000L 36800019
         BAL   3,ADDR                                              000L 37100019
         LA    LENGTREG,121             LENGTH OF ASCII NON-DATA-  000L 37400019
         B     MOVECCW                    LINK-CONTROL CHARACTERS  000D 38000016
         SPACE 2                                                        38500016
ALPHAASC MVI   0(IOREG),STX             MOVE STX INTO I/O AREA     000D 39000016
         MVC   1(2,IOREG),ASCSYN       MOVE IN SYN CHARACTERS           39200019
         BAL   3,ADDR                                              000L 39400019
         MVC   3(37,IOREG),ASCII        FOLLOW WITH APLHAMERIC MSG 000L 39600019
         B     MOVE38                                              000D 40000016
         SPACE 2                                                        40500016
PRINTASC MVC   0(3,IOREG),PRINTSEL      PRINTER SELECT SEQUENCE    000D 41000016
MOVECHAR MVC   3(37,IOREG),ASCII        ASCII TEXT                 000D 41500016
         B     MOVE40                                              000D 42000016
         SPACE 2                                                        42500016
PUNCHASC MVC   0(3,IOREG),PUNCHSEL      PUNCH SELECT SEQUENCE      000D 43000016
         B     MOVECHAR                                            000D 43500016
         SPACE 2                                                        44000016
PRNTTRNS MVC   0(3,IOREG),TRNSPRNT      MOVE STX & PRINTER ESCAPE  000D 44500016
MOVETRNS MVC   3(37,IOREG),TRANSCHR     MOVE IN TRANSCODE CHARS    000D 45000016
         B     MOVE40                                              000D 45500016
         SPACE 2                                                        46000016
PNCHTRNS MVC   0(3,IOREG),TRNSPNCH      MOVE STX & PUNCH ESCAPE    000D 46500016
         B     MOVETRNS                                            000D 47000016
         SPACE 2                                                        47500016
MPTTRANS MVI   0(IOREG),TRANSSTX        MOVE STX INTO I/O AREA     000D 48000016
         MVC   1(2,IOREG),TRANSSYN     MOVE IN SYN CHARACTERS           48200019
         BAL   3,ADDR                                              000L 48400019
         MVC   3(37,IOREG),TRANSCHR     MOVE TRANSCODE CHARACTERS  000L 48600019
         B     MOVE38                                              000D 49000016
         SPACE 2                                                        49500016
MOVE38   LA    LENGTREG,40              GET LENGTH OF MESSAGE      000L 50000019
         B     MOVECCW                                             000D 50500016
MOVE40   LA    LENGTREG,40              GET LENGTH OF MESSAGE      000D 51000016
MOVECCW MVC    IOBCPA+48(8),IOBCPA+56                            A27602 51500019
STORLENG STH   LENGTREG,IOBCPA+46                                A27602 52000019
EXCP     LA    TESTREG,IOBCPA           GET CH.PGM ADDRESS         000D 52500016
         ST    TESTREG,IOBSTART         STORE IN IOB               000D 53000016
         XC    IOBUCBX+2(4),IOBUCBX+2   CLEAR COUNTERS             000D 53500016
         L     LENGTREG,IOBECBPT       GET DECB ADDRESS            000D 54000016
         L     TYPEREG,0(LENGTREG)     SAVE ECB                    000D 54500016
         SVC    0                                                  000D 55000016
         ST    TYPEREG,0(LENGTREG)     RESTORE ECB                 000D 55500016
         SVC   3                       RETURN                      000D 56000016
         SPACE 2                                                   000D 56500016
WEAKLEAS MVI   0(IOREG),TRANSSTX        MOVE IN TRANSCODE STX      000D 57000016
         MVC   1(2,IOREG),TRANSSYN     MOVE IN SYN CHARACTERS           57300019
         BAL   3,ADDR                                              000L 57600019
         MVI   3(IOREG),NCHAR           MOVE TRANSCODE 'N' CHARS   000L 57900019
         MVC   4(39,IOREG),3(IOREG)        ALONG WITH ESCAPE CHARS 000L 58200019
         MVI   43(IOREG),ESC               TO FORM WEAK TRANSCODE  000L 58500019
         MVC   44(39,IOREG),43(IOREG)      PATTERN ON SWITCHED LNE 000L 58800019
MOVEETX  MVI   83(IOREG),ETX           MOVE ETX INTO TEXT AREA     000L 59100019
         LA    LENGTREG,84              GET MESSAGE LENGTH         000L 59400019
         B     MOVECCW                  GO COMPLETE CH.PGM & EXCP  000D 60500016
         SPACE 2                                                        61000016
WEAKSWIT MVI   0(IOREG),TRANSSTX        MOVE IN TRANSCODE          000D 61500016
         MVC   1(2,IOREG),TRANSSYN     MOVE IN SYN CHARACTERS           61800019
         BAL   3,ADDR                                              000L 62100019
         MVI   3(IOREG),SOH             WEAK PATTERN ON SWITCHED   000L 62400019
         MVC   4(79,IOREG),3(IOREG)       LINE - TRANSCODE         000L 62700019
         B     MOVEETX                                             000D 63000016
         SPACE 2                                                        63500016
ADDR     EQU   *                                                   000L 63550019
         TM    17(UCBREG),X'40'         IS THIS MULTIPOINT         000L 63600019
         BZ    ADDR0                                               000L 63650019
         BR    3                                                   000L 63700019
ADDR0    EQU   *                                                   000L 63750019
         L     CNTREG,12(DECBREG)       GET ADDR OF I/O AREA       000L 63800019
         CLI   6(CNTREG),ZERO           ADDR=0                     000L 63850019
         BE    0(3)                                                000L 63900019
         CLI   6(CNTREG),ONE            ADDR=1                     000L 63950019
         BNE   NOT1                                                000L 64000019
         MVC   1(1,IOREG),7(CNTREG)     MOVE ADDR INTO TEXT        000L 64050019
         BR    3                        RETURN                     000L 64100019
NOT1     EQU   *                                                   000L 64150019
         MVC   1(2,IOREG),7(CNTREG)     MOVE ADDR INTO TEXT        000L 64200019
         BR    3                        RETURN                     000L 64250019
      SPACE   2                                                         64300019
ASCCHARS DC    X'021616'                                           000L 64350019
         DC    X'000708090A0B0C0D0E0F'                                  64500016
         DC    X'1112131418191A1B1C'                                    65000016
         DC    X'1D1E2021222324252627'                                  65500016
         DC    X'28292A2B2C2D2E2F30313233'                              66000016
         DC    X'3435363738393A3B3C3D3E3F'                              66500016
         DC    X'404142434445464748494A4B4C4D4E4F'                      67000016
         DC    X'505152535455565758595A'                                67500016
         DC    X'5B5C5D5E5F6061'                                        68000016
         DC    X'62636465666768696A6B'                                  68500016
         DC    X'6C6D6E6F707172737475'                                  69000016
         DC    X'767778797A7B7C7D7E7F'                                  69500016
         DC    X'03'                                                    70000016
ASCII    DC    X'4142434445464748494A'                                  70500016
         DC    X'4B4C4D4E4F5051525354'                                  71000016
         DC    X'55565758595A'                                          71500016
         DC    X'30313233343536373839'                                  72000016
         DC    X'03'                                                    72500016
PRINTSEL DC    X'021B51'                                                73000016
PUNCHSEL DC    X'021B34'                                                73500016
TRANSCHR DC    X'01020304050607080911'                                  74000016
         DC    X'12131415161718192223'                                  74500016
         DC    X'24252627282930313233'                                  75000016
         DC    X'3435363738392E'                                        75500016
TRNSPRNT DC    X'0A2A21'                                                76000016
TRNSPNCH DC    X'0A2A34'                                                76500016
MASK     DS    0F                                                       77000016
         DC    X'0000000F'                                              77500016
ZERO     EQU   X'00'                                               000L 77600019
ONE      EQU   X'01'                                               000L 77700019
IBCMODE  EQU   X'40'                   BIT FOR IBC MODE            000D 78000016
SOH      EQU   X'00'                                                    78500016
NCHAR    EQU   X'15'                                                    79000016
ESC      EQU   X'2A'                                                    79500016
ETX      EQU   X'2E'                                                    80000016
STX      EQU   X'02'                                                    80500016
TRANSSTX EQU   X'0A'                                                    81000016
ASCSYN   DC    X'1616'                                                  81100019
TRANSSYN DC    X'3A3A'                                                  81200019
         IECTIOBX                                                       81500016
         DCBD  DSORG=BX,DEVD=BS                                         82000016
         IECTDECB                                                       82500016
         IECTDEBX                                                       82700019
         END                                                            83000016
./  ADD  SSI=13150268,NAME=IGC0806F
         TITLE 'IGC0806F - BSC ONLTST EBCDIC MODULE'               000D 00600016
         SPACE 2                                                        01200016
IGC0806F CSECT                                                          01800016
         TITLE 'IGC0806F - A 2ND LOAD OF SVC 66 FOR EBCDIC MESSGS'      01810016
*********************************************************************** 01820016
*                                                                     * 01830016
* STATUS -            CHANGE LEVEL 001, NOVEMBER 7,1969               * 01840019
*                                                                     * 01850016
* FUNCTION -          BUILD EBCDIC ON-LINE-TEST MESSAGES              * 01860016
*                                                                     * 01870016
* ENTRY POINT -       ENTRY IS TO FIRST EXECUTABLE INSTRUCTION        * 01880016
*                     VIA XCTL FROM IGC0006F                          * 01890016
*                                                                     * 01900016
* INPUT -             REGISTER 1 - ADDRESS OF THE IOB                 * 01910016
*                     REGISTER 4 - XX VALUE                           * 01920016
*                     CHANNEL PROGRAM IN IOB                          * 01930016
*                                                                     * 01940016
* OUTPUT -            TEST MESSAGE BUILT IN USER'S AREA AND COUNT     * 01950016
*                        INSERTED IN CCW                              * 01960016
*                     ERROR BIT SET IN IOBINCAM IF USER AREA NOT      * 01970016
*                        AT LEAST 300 BYTES LONG.                     * 01980016
*                                                                     * 01990016
* EXTERNAL ROUTINES - SVC 0, EXECUTE CHANNEL PROGRAM                  * 02000016
*                                                                     * 02010016
* EXIT -              SVC 3, RETURN TO IOS                            * 02020016
*                                                                     * 02030016
* IN LINE ROUTINES - 1. NORMEBCD - BUILD NORMAL EBCDIC MESSAGE        * 02040016
*                       AND STORE COUNT IN CCW.                       * 02050016
*                                                                     * 02060016
*                    2. WEAKLEAS - BUILD WEAK PATTERN MESSAGE FOR     * 02070016
*                       A LEASED LINE AND STORE COUNT IN CCW.         * 02080016
*                                                                     * 02090016
*                    3. XPARENT - BUILD TRANSPARENT EBCDIC MESSAGE    * 02100016
*                       AND STORE COUNT IN CCW.                       * 02110016
*                                                                     * 02120016
*                    4. WKDLESYN - BUILD WEAK PATTERN EBCDIC MESSAGE  * 02130016
*                       TO TEST SYN INSERTION AND STORE COUNT IN CCW. * 02140016
*                                                                     * 02150016
*                    5. PRINTER - BUILD EBCDIC PRINTER MESSAGE AND    * 02160016
*                       STORE COUNT IN CCW.                           * 02170016
*                                                                     * 02180016
*                    6. PUNCH - BUILD EBCDIC PUNCH MESSAGE AND STORE  * 02190016
*                       COUNT IN CCW.                                 * 02200016
*                                                                     * 02210016
*                    7. WEAKSWIT - BUILD WEAK PATTERN MESSAGE FOR A   * 02220016
*                       SWITCHED LINE AND STORE COUNT IN CCW.         * 02230016
*                                                                     * 02240016
*                    8. ALPHA - BUILD EBCDIC ALPHAMERIC MESSAGE AND   * 02250016
*                       STORE COUNT IN CCW.                           * 02260016
*                                                                     * 02270016
*                    9. STORLENG - STORES CH.PGM. ADDRESS IN IOBSTART * 02280016
*                       AND ISSUES SVC 0 AND RETURNS                  * 02290016
*                                                                     * 02300016
*                    10. TEST20 - BUILD 80 CHARACTER TRANSPARENT      * 02301019
*                       MESSAGE AND STORE COUNT IN CCW.               * 02302019
     SPACE  2                                                           02303019
*                    11. TEST21 - BUILD 120 CHARACTER TRANSPARENT     * 02304019
*                       MESSAGE AND STORE COUNT IN CCW.               * 02305019
     SPACE  2                                                           02306019
*                    12. TEST22 - BUILD 144 CHARACTER TRANSPARENT     * 02307019
*                       MESSAGE AND STORE COUNT IN CCW.               * 02308019
       SPACE   2                                                        02309019
* ATTRIBUTES - THIS MODULE IS RE-ENTRANT                              * 02310016
*                                                                     * 02320016
*********************************************************************** 02330016
         SPACE 2                                                        02400016
IOBREG   EQU   1                        IOB DSECT BASE REGISTER    000D 03000016
DEBREG    EQU   2                                                       03300019
COMREG     EQU   2                                                      03600016
XREG     EQU   3                                                        04200016
TYPEREG  EQU   4                        X-REGISTER                 000D 04800016
CNTREG   EQU   5                                                   000L 05100019
BASEREG  EQU   6                        MODULE BASE REGISTER       000D 05400016
IOREG    EQU   7                        POINTER TO I/O AREA        000D 06000016
DECBREG  EQU   8                                                        06600016
LENGTREG EQU   9                        LENGTH OF MESSAGE          000D 07200016
DCBREG   EQU   11                       DCB DSECT BASE REGISTER    000D 07800016
UCBREG   EQU   13                                                       08100019
         SPACE 2                                                        08400016
         BALR  BASEREG,0                ESTABLISH                  000D 09000016
         USING *,BASEREG                  MODULE ADDRESSABILITY    000D 09600016
         USING IECTIOB,IOBREG             IOB ADDRESSABILITY       000D 10200016
         USING IHADCB,DCBREG              DCB ADDRESSABILITY       000D 10800016
         L     DECBREG,IOBECBPT        GET DECB ADDRESS            000D 11400016
         USING IECTDEB,DEBREG                                           11470019
         L     DEBREG,DCBDEBAD                                          11540019
         L     DEBREG,28(DEBREG)                                        11610019
         SR    UCBREG,UCBREG                                            11680019
         IC    UCBREG,IOBUCBX                                           11750019
         SLL   UCBREG,2                                                 11820019
         L     UCBREG,DEBUCBAD(UCBREG)                                  11890019
         LA    COMREG,300                                          000D 12000016
         CH    COMREG,6(DECBREG)                                   000D 12600016
         BNH    CONTINUE                                           000D 13200016
NOMESSG   EQU   *                                                       13800016
         OI    IOBINCAM,X'02'          TURN ON ERROR BIT           000D 14400016
         B     STORLENG                                            000D 15000016
CONTINUE EQU   *                                                   000D 15600016
         L     DCBREG,IOBECBPT             *                       000D 16200016
         L     DCBREG,8(DCBREG)             *                      000D 16800016
         L     IOREG,IOBCPA+40          GET ADDRESS OF I/O AREA  A27602 17400019
         CH    TYPEREG,CODE4            IS X FOR NORMAL EBCDIC MSG 000D 18000016
         BE    NORMEBCD                 YES, GO TO PROPER ROUTINE  000D 18600016
         CH    TYPEREG,CODE20           DOES X=20                  000L 18680019
         BE    TEST20                                              000L 18760019
         CH    TYPEREG,CODE21           DOES X=21                  000L 18840019
         BE    TEST21                                              000L 18920019
         CH    TYPEREG,CODE22           DOES X=22                  000L 19000019
         BE    TEST22                                              000L 19080019
         N     TYPEREG,MASK             TURN OFF HI-ORDER BITS     000D 19200016
         SLL   TYPEREG,2                MULTIPLY BY FOUR           000D 19800016
         B     FINDTBLE(TYPEREG)        GO TO RIGHT RTN. VIA B-TAB 000D 20400016
         SPACE 2                                                   000D 21000016
FINDTBLE B     WEAKLEAS                 WEAK MESSAGE - LEASED LINE 000D 21600016
         NOP   FINDTBLE                                            000D 22200016
         B     XPARENT                  TRANSPARENT MESSAGE        000D 22800016
         B     WKDLESYN                 WEAK PATTRN - DLESYN       000D 23400016
         B     PRINTER                  PRINTER MESSAGE            000D 24000016
         B     PUNCH                    PUNCH MESSAGE              000D 24600016
         B     ALPHA                    ALPHAMERIC MESSAGE         000D 25200016
         B     WEAKSWIT                 WEAK MESSAGE - SWITCHED    000D 25800016
         SPACE 2                                                   000D 26400016
NORMEBCD MVC   0(249,IOREG),NORMTEXT    MOVE TEXT INTO MESSGE AREA 000L 26800019
         BAL   10,ADDR                                             000L 27200019
         LA    LENGTREG,249             GET LENGTH OF MESSAGE      000L 27600019
         B     MOVECCW                                             000D 28200016
         SPACE 2                                                        28800016
TEST20   MVC   0(2,IOREG),DCBBSTSX      MOVE IN DLE STX            000L 28820019
         MVC   2(16,IOREG),UTHRUZ       MOVE IN U-Z, 0-9           000L 28840019
         MVC   18(64,IOREG),TRANSTXT    MOVE IN 00 - 3F            000L 28860019
         LA    LENGTREG,82              GET LENGTH                 000L 28880019
         B     STORLENG                                            000L 28900019
    SPACE  2                                                            28920019
TEST21   BAL   10,MOVE                  MOVE IN DLESTX             000L 28940019
         MVC   38(84,IOREG),TRANSTXT    MOVE IN 00 - 53            000L 28960019
         LA    LENGTREG,122             LOAD LENGTH                000L 28980019
         B     STORLENG                                            000L 29000019
    SPACE   2                                                           29020019
TEST22   BAL   10,MOVE                                             000L 29040019
         MVC   38(108,IOREG),TRANSTXT   MOVE IN 00 - 6B            000L 29060019
         LA    LENGTREG,146             GET LENGTH                 000L 29080019
         B     STORLENG                                            000L 29100019
   SPACE   2                                                            29120019
MOVE     MVC   0(2,IOREG),DCBBSTSX      MOVE IN DLE STX            000L 29140019
         MVC   2(36,IOREG),EBCDIC       MOVE IN A - Z, 0 - 9       000L 29160019
         BR    10                                                  000L 29180019
     SPACE    2                                                         29200019
WEAKLEAS MVI   0(IOREG),STX             MOVE STX INTO I/O AREA     000D 29400016
         MVC   1(2,IOREG),EBCDSYN      MOVE IN SYN CHARACTERS           29800019
         BAL   10,ADDR                                             000L 30200019
         MVI   3(IOREG),XAA             BUILD MESSAGE IN I/O AREA  000L 30600019
         MVC   4(39,IOREG),3(IOREG)       WEAK PATTERN             000L 31000019
         MVI   43(IOREG),X55                FOR                    000L 31400019
         MVC   44(39,IOREG),43(IOREG)         LEASED LINE          000L 31800019
MOVEETX  MVI   83(IOREG),ETX            MOVE ETX INTO I/O AREA     000L 32200019
         LA    LENGTREG,84              GET MESSAGE LENGTH         000L 32600019
         B     MOVECCW                  MODIFY CH.PGM FOR NORMAL   000D 33600016
         SPACE 2                                                   000D 34200016
XPARENT  MVC   0(2,IOREG),DCBBSTSX      MOVE DLE-STX CHARS         000D 34800016
         LA    LENGTREG,256             BUILD TABLE                000D 35400016
         STC   LENGTREG,2(LENGTREG,IOREG)   OF ALL                 000D 36000016
         BCT   LENGTREG,*-4                   EBCDIC CHARACTERS    000D 36600016
         STC   LENGTREG,2(IOREG)       STORE ZEROTH DIGIT          000D 37200016
         LA    LENGTREG,258             GET MESSAGE LENGTH         000D 37800016
         B     STORLENG                                            000D 38400016
         SPACE 2                                                   000D 39000016
WKDLESYN MVC   0(2,IOREG),DCBBSTSX      MOVE DLE STX CHARACTERS    000D 39600016
         MVI   2(IOREG),ZERO            BUILD MESSAGE FOR          000D 40200016
         MVC   3(256,IOREG),2(IOREG)      WEAK PATTERN             000D 40800016
         MVC   259(23,IOREG),258(IOREG)    DLE-SYN INSERTION       000D 41400016
         MVI   282(IOREG),SYN                *                     000D 42000016
         MVC   283(9,IOREG),282(IOREG)         *                   000D 42600016
         LA    LENGTREG,292             GET MESSAGE LENGTH         000D 43200016
         B     STORLENG                                            000D 43800016
         SPACE 2                                                        44400016
PRINTER  MVC   0(3,IOREG),PRNTESC       MOVE STX & ESCAPE SEQUENCE 000D 45000016
MOVETEXT MVC   3(37,IOREG),EBCDIC       MOVE TEXT TO I/O AREA      000D 45600016
         LA    LENGTREG,40              GET MESSAGE LENGTH         000D 46200016
         B     MOVECCW                                             000D 46800016
PUNCH    MVC   0(3,IOREG),PNCHESC       MOVE STX & ESCAPE SEQUENCE 000D 47400016
         B     MOVETEXT                                            000D 48000016
         SPACE 2                                                        48600016
WEAKSWIT MVI   0(IOREG),STX             MOVE STX INTO I/O AREA     000D 49200016
         MVC   1(2,IOREG),EBCDSYN      MOVE IN SYN CHARACTERS           49600019
         BAL   10,ADDR                                             000L 50000019
         MVI   3(IOREG),ZERO            MOVE IN TEXT FOR           000L 50400019
         MVC   4(73,IOREG),3(IOREG)       WEAK PATTER              000L 50800019
         MVI   77(IOREG),SYN                ON A                   000L 51200019
         MVC   78(5,IOREG),77(IOREG)         SWITCHED LINE         000L 51600019
         B     MOVEETX                                             000D 52200016
         SPACE 2                                                        52800016
ADDR     EQU   *                                                   000L 52830019
         TM    17(UCBREG),X'40'         IS THIS MULTIPOINT         000L 52860019
         BZ    ADDR0                                               000L 52890019
         BR    10                                                  000L 52920019
ADDR0    EQU   *                                                   000L 52950019
         L     CNTREG,12(DECBREG)       GET ADDR OF I/O AREA       000L 52980019
         CLI   6(CNTREG),X'00'          ADDR = 0                   000L 53010019
         BE    0(10)                                               000L 53040019
         CLI   6(CNTREG),X'01'          ADDR = 1                   000L 53070019
         BNE   NOT1                                                000L 53100019
         MVC   1(1,IOREG),7(CNTREG)     MOVE ADDR INTO TEXT        000L 53130019
         BR    10                                                  000L 53160019
NOT1     EQU   *                                                   000L 53190019
         MVC   1(2,IOREG),7(CNTREG)                                000L 53220019
         BR    10                       RETURN                     000L 53250019
      SPACE   2                                                         53280019
ALPHA    MVI   0(IOREG),STX             MOVE IN ETX                000D 53400016
         MVC   1(2,IOREG),EBCDSYN      MOVE IN SYN CHARACTERS           53700019
         BAL   10,ADDR                                             000L 54000019
         MVC   3(37,IOREG),EBCDIC       MOVE TEXT INTO I/O AREA    000L 54300019
         LA    LENGTREG,40              GET MESSAGE LENGTH         000L 54600019
MOVECCW  MVC   IOBCPA+48(8),IOBCPA+56   OVERLAY TRANSPARENT CCW  A27602 55200019
STORLENG STH   LENGTREG,IOBCPA+46       STORE LENGTH IN CCW      A27602 55800019
         LA    IOREG,IOBCPA             OUT CHANNEL PROGRAM        000D 56400016
         ST    IOREG,IOBSTART             ADDRESS IN IOBSTART      000D 57000016
         XC    IOBUCBX+2(4),IOBUCBX+2   ZERO OUT COUNTERS          000D 57600016
         L     LENGTREG,IOBECBPT       GET DECB ADDRESS            000D 58200016
         L     TYPEREG,0(LENGTREG)     SAVE ECB                    000D 58800016
         SVC    0                                                  000D 59400016
         ST    TYPEREG,0(LENGTREG)     RESTORE ECB                 000D 60000016
         SVC   3                       RETURN          LAGS        000D 60600016
NORMTEXT DC    X'023232'                                           000L 61200019
         DC    X'000405060708090A0B0C0D'                           000D 61800016
         DC    X'0E0F111213141516171819'                           000D 62400016
         DC    X'1A1B1C1D1E2021222324'                             000D 63000016
         DC    X'252728292A2B2C2F303133'                           000D 63600016
         DC    X'34353638393A3B3C3E3F40'                           000D 64200016
         DC    X'4142434445464748494A4B'                           000D 64800016
         DC    X'4C4D4E4F50515253545556'                           000D 65400016
         DC    X'5758595A5B5C5D5E5F6061'                           000D 66000016
         DC    X'62636465666768696A6B6C'                           000D 66600016
         DC    X'6D6E6F7071727374757677'                           000D 67200016
         DC    X'78797A7B7C7D7E7F808182'                           000D 67800016
         DC    X'838485868788898A8B8C8D'                           000D 68400016
         DC    X'8E8F909192939495969798'                           000D 69000016
         DC    X'999A9B9C9D9E9FA0A1A2A3'                           000D 69600016
         DC    X'A4A5A6A7A8A9AAABACADAE'                           000D 70200016
         DC    X'AFB0B1B2B3B4B5B6B7B8B9'                           000D 70800016
         DC    X'BABBBCBDBEBFC0C1C2C3C4'                                71400016
         DC    X'C5C6C7C8C9CACBCCCD'                                    72000016
         DC    X'CECFD0D1D2D3D4D5D6D7D8D9'                              72600016
         DC    X'DADBDCDDDEDFE0E1'                                      73200016
         DC    X'E2E3E4E5E6E7E8E9EAEBEC'                                73800016
         DC    X'EDEEEFF0F1F2F3F4F5F6F7F8F9'                            74400016
         DC    X'FAFBFCFDFEFF'                                          75000016
         DC    X'03'                                                    75600016
TRANSTXT DC    X'000102030405060708090A'                           000L 75650019
         DC    X'0B0C0D0E0F101112131415'                           000L 75700019
         DC    X'161718191A1B1C1D1E1F20'                           000L 75750019
         DC    X'2122232425262728292A2B'                           000L 75800019
         DC    X'2C2D2E2F30313233343536'                           000L 75850019
         DC    X'3738393A3B3C3D3E3F4041'                           000L 75900019
         DC    X'42434445464748494A4B4C'                           000L 75950019
         DC    X'4D4E4F5051525354555657'                           000L 76000019
         DC    X'58595A5B5C5D5E5F606162'                           000L 76050019
         DC    X'636465666768696A6B'                               000L 76100019
EBCDIC   DC    X'C1C2C3C4C5C6C7C8C9D1D2'                           000D 76200016
         DC    X'D3D4D5D6D7D8D9E2E3'                               000L 76800019
UTHRUZ   DC    X'E4E5E6E7E8E9'                                     000L 77400019
NUMBERS  DC    X'F0F1F2F3F4F5F6F7F8F9'                             000L 78000019
         DC    X'03'                                               000D 78600016
STX      EQU   X'02'                                               000D 79200016
ETX      EQU   X'03'                                               000D 79800016
XAA      EQU   X'AA'                                               000D 80400016
X55      EQU   X'55'                                               000D 81000016
SYN      EQU   X'32'                                               000D 81600016
ZERO     EQU   X'00'                                               000D 82200016
EBCDSYN DC     X'3232'                                                  82500019
PRNTESC  DC    X'022761'                                           000D 82800016
PNCHESC  DC    X'0227F4'                                           000D 83400016
         DS    0F                                                  000D 84000016
MASK     DC    X'FFFFFFE7'                                         000D 84600016
CODE4    DC    X'0004'                                             000D 85200016
CODE20   DC    X'0014'                                             000L 85300019
CODE21   DC    X'0015'                                             000L 85400019
CODE22   DC    X'0016'                                             000L 85500019
         CNOP   0,8                                                000D 85800016
         IECTDEBX                                                       86100019
         IECTIOBX                                                  000D 86400016
         DCBD  DSORG=BX,DEVD=BS                                    000D 87000016
         END                                                            87600016
./  ADD  SSI=13150269,NAME=IGC0906F
         TITLE 'IGC0906F-2741 TERMINAL TEST MODULE. CORRS'              00300018
IGC0906F CSECT                                                          00600018
         SPACE 2                                                        00900018
* STATUS -          CHANGE LEVEL 000    21 NOVEMBER 1968                01200018
         SPACE 2                                                        01500018
*                                                                       01800018
*                                                                       02100018
* FUNCTION -        GENERATE CHANNEL PROGRAM FOR 2741 ON LINE TESTS     02400018
*                                                                       02700018
*                                                                       03000018
* ENTRY POINT -     ENTRY IS TO FIRST INSTRUCTION FROM HEADER ANALYSIS  03300018
*                   MODULE                                              03600018
*                                                                       03900018
*                                                                       04200018
* INPUT -           REGISTER 1 - ADDRESS OF IOB                         04500018
*                   REGISTER 14 - RETURN ADDRESS                        04800018
*                                                                       05100018
*                                                                       05400018
* OUTPUT -          1.  GENERATED CHANNEL PROGRAM                       05700018
*                   2.  UPDATED USAGE COUNT AND POINTER IN              06000018
*                       TERMINAL TEST MODULE (IGG019MR)                 06300018
*                                                                       06600018
*                                                                       06900018
* EXTERNAL ROUTINE -SVC 4 ROUTINE (GETMAIN)                             07200018
*                                                                       07500018
*                                                                       07800018
* EXIT -            RETURN TO ADDRESS IN REGISTER 14                    08100018
*                                                                       08400018
*                                                                       08700018
* INLINE ROUTINES -THE INPUT MESSAGE IS LOCATED THROUGH THE PARAMETER   09000018
*                   LIST AND IS ANALYZED FOR TYPE OF REQUEST.  CCW'S    09300018
*                   FOR THE PROPER DATA AND CONTROL PURPOSES ARE FORMED 09600018
*                   IN THE CCW AREA OF THE IOB.  IF THE REQUESTED DATA  09900018
*                   PATTERN IS NOT IN USE, CORE WILL BE OBTAINED AND    10200018
*                   THE PATTERN MOVED INTO THE NEW AREA.  IF NO CORE IS 10500018
*                   AVAILABLE, THE TEST REQUEST WILL BE SWITCHED TO THE 10800018
*                   TERMINAL SPECIFIED IN THE TEST REQUEST.             11100018
*                   A SUB-ROUTINE--                                     11400018
*                                                                       11700018
*                        A.  SETS UP THE ADDRESS FOR THE CHANNEL        12000018
*                            PROGRAM.                                   12300018
*                        B.  MOVES THE BASIC CCW'S INTO THE CCW AREA OF 12600018
*                            THE IOB.                                   12900018
*                                                                       13200018
*                                                                       13500018
* ATTRIBUTES -      THIS ROUTINE IS EXECUTED IN THE SVC TRANSIENT AREA  13800018
*                   AS A TYPE 4 SVC ROUTINE, ENABLED,PRIVILEGED AND     14100018
*                   REENTRANT.                                          14400018
*                                                                       14700018
         EJECT                                                          15000018
*                                                                       15300018
*                                                                       15600018
*                                                                       15900018
         BALR  BASEREG,0                                                16200018
         USING *,BASEREG                                                16500018
         USING IHADCB,DCBREG                                            16800018
         USING IECTIOB,IOBREG                                           17100018
         USING IECTDECB,DECBREG                                         17400018
         USING PARMLIST,PARREG                                          17700018
         USING CPA,CCWREG                                               18000018
*                                                                       18300018
         LR    IOBREG,1                 LOAD IOB ADDRESS                18600018
         L     PARREG,IOBPARM           LOAD PARAMETER LIST ADDRESS     18900018
         L     IOREG,IOBAREA            LOAD I/O AREA ADDRESS           19200018
         L     DECBREG,IOBECBPT         ADDRESS OF DECB                 19500018
         L     DCBREG,DECDCBAD          ADDRESS OF DCB                  19800018
SETCCWRG EQU   *                                                        20100018
         LA    CCWREG,IOBCPA            ADDRESS OF CCW AREA             20400018
         ST    CCWREG,IOBSTART         RESET CCW AREA POINTER           20700018
         MVC   0(16,CCWREG),CHANPROG     MOVE TWO CCWS                  21000018
SETADCCW L     WORKREG2,NLIDLES         GET ADDRESS OF NL, PADS         21300018
         ST    WORKREG2,CCW1           STORE IN CCW                     21600018
         MVI   CCW1,X'01'               RESTORE OP CODE                 21900018
         CLI   6(IOREG),X'02'           BRANCH IF                       22200018
         BE    MSGSWTCH                           SWITCH TEST (1)       22500018
         CLI   6(IOREG),X'08'           BRANCH IF                       22800018
         BE    COMPARE                            COMPARE TEST (5)      23100018
         SR    TESTREG,TESTREG          CLEAR TEST REGISTER             23400018
         IC    TESTREG,6(IOREG)         INSERT TEST SEL. CHARACTER      23700018
         SRA   TESTREG,1                SHIFT OUT PARITY BIT            24000018
         IC    TESTREG,TESTCODE-2(TESTREG)   SET UP INDEXING            24300018
         L     PATRNREG,PATTERN         GET ADDRESS OF PATTERN NAME TBL 24600018
         LA    WORKREG,0(TESTREG,PATRNREG)                              24900018
         CLI   0(WORKREG),X'00'         BRANCH IF THIS PATTERN          25200018
         BE    NOTINUSE                                   IS NOT IN USE 25500018
         IC    WORKREG,0(TESTREG,PATRNREG)   1-UP                       25800018
         LA    WORKREG,1(WORKREG)             USAGE                     26100018
         STC   WORKREG,0(TESTREG,PATRNREG)     COUNT                    26400018
*                                                                       26700018
SETCCWS  EQU   *                                                        27000018
         L     WORKREG,0(TESTREG,PATRNREG)                              27300018
         IC    WORKREG3,0(WORKREG)     INSERT PATTERN AREA COUNT        27600018
         LA    WORKREG,1(WORKREG)       ADDRESS OF DATA TO BE SENT      27900018
         ST    WORKREG,CCW2             PUT IN CCW                      28200018
         MVI   CCW2,X'01'               RESTORE OP CODE                 28500018
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          28800018
         IC    WORKREG,0(TESTREG,PATRNREG)   CHARACTER COUNT            29100018
         BCTR  WORKREG3,0              REDUCE BY ONE                    29400018
         STC   WORKREG3,CCW2+7         PUT IN CCW                       29700018
         STC   TESTREG,DECONLTT         PUT DISPLACEMENT                30000018
*                                                                       30300018
*                                                                       30600018
RETURN1  BR    RETURN                                                   30900018
*                                                                       31200018
NOTINUSE L     GETMAIN,0(PATRNREG)      ADDRESS OF GETMAIN CONSTANTS    31500018
         EX    0,DATAADDR-4(TESTREG)         ADDRESS OF DATA TO MOVE    31800018
         LA    TOREG,0(TESTREG,PATRNREG)     ADDRESS OF THE TABLY ENTRY 32100018
         ST    TOREG,4(GETMAIN)         PUT IN GETMAIN CONSTANTS        32400018
         SR    WORKREG,WORKREG          CLEAR WORKING REGISTER          32700018
         IC    WORKREG,0(FROMREG)       CHARACTER COUNT OF DATA         33000018
         ST    WORKREG,0(GETMAIN)       PUT IN GETMAIN CONSTANTS        33300018
         SVC   4                        ISSUE GETMAIN SVC               33600018
         SLL   15,24                    ELIMINATE HIGH ORDER BITS       33900018
         NR    15,15                    TEST FOR ZERO RETURN CODE       34200018
         BNE   MSGSWTCH                 NON-ZERO IS NO CORE AVAILABLE   34500018
         MVI   0(TOREG),X'01'           SET USAGE COUNT TO ONE          34800018
         L     TOREG,0(TOREG)           GET ADRESS OF DATA AREA         35100018
         BCTR  WORKREG,0                ADJUST COUNT FOR MVC INST       35400018
         EX    WORKREG,EXMVC            MOVE THE DATA                   35700018
         B     SETCCWS                                                  36000018
*                                                                       36300018
*                                                                       36600018
COMPARE  EQU   *                                                        36900018
         LH    WORKREG,DECLNGTH         INPUT AREA LENGTH               37200018
         SH    WORKREG,IOBCSW+6         - RESIDUAL COUNT                37500018
         SH    WORKREG,HA                                               37800018
         BM    NOCHAR                                                   38100018
         CH    WORKREG,MAXLNG           IS LENGTH TOO GREAT?            38400018
         BNH   CMPTST                   NO                              38700018
         LH    WORKREG,MAXLNG           YES, SUBSTITUTE MAX LENGTH      39000018
CMPTST   EX    WORKREG,EXCOMP                                           39300018
         BNE   MSGSWTCH                 BAD COMPARE, MSG SWITCH         39600018
LOADMSG  MVC   0(LN,IOREG),CMPVALD      GOOD, LOAD COMPARE VALID MSG.   39900018
         LA    WORKREG,COMPDATA(WORKREG) FIND LAST CHARACTER            40200018
         MVC   8(1,IOREG),0(WORKREG)    INSERT IN MSG                   40500018
RETURN2  ST    IOREG,CCW2                                               40800018
         MVI   CCW2,X'01'               RESTORE OP CODE                 41100018
         MVI   CCW2+7,LN                                                41400018
         BR    RETURN                                                   41700018
NOCHAR   MVC   0(LN,IOREG),CMPVALD      LOAD COMPARE VALID MSG          42000018
         B     RETURN2                                                  42300018
*                                                                       42600018
*                                                                       42900018
MSGSWTCH EQU   *                                                        43200018
         ST    IOREG,CCW2               ADDRESS OF DATA TO CCW          43500018
         MVI   CCW2,X'01'               RESTORE OP CODE                 43800018
         LH    WORKREG,DECLNGTH         USED IF NOT DYNAMIC BUFFERING   44100018
         TM    DCBBFTEK,X'08'           TEST IF DYNAMIC BUFFERING USED  44400018
         BZ    *+12                                                     44700018
         LH    WORKREG,DCBBUFL          USED WITH DYNAMIC BUFFERING     45000018
         SH    WORKREG,=H'4'            ADJUST FOR TIC                  45300018
         BCTR  WORKREG,0                BYPASS EOA CHAR                 45600018
         STH   WORKREG,CCW2+6           IN CASE NO EOT FOUND            45900018
         CLI   0(IOREG),X'1F'           LOOK FOR EOT                    46200018
         BE    FOUNDEOT                                                 46500018
         LA    IOREG,1(IOREG)           UP CORE POINTER                 46800018
         BCT   WORKREG,*-12             LOOP ON COUNT                   47100018
         BR    RETURN                                                   47400018
*                                                                       47700018
FOUNDEOT EQU   *                                                        48000018
         S     IOREG,IOBAREA            COMPUTE NUMBER OF CHARACTERS    48300018
         STH   IOREG,CCW2+6             STORE COUNT                     48600018
         BR    RETURN                                                   48900018
*                                                                       49200018
*  CONSTANTS                                                            49500018
*                                                                       49800018
TESTCODE DC    X'0408001410000C'                                        50100018
EXMVC    MVC   0(1,TOREG),0(FROMREG)                                    50400018
         EJECT                                                          50700018
*                                                                       51000018
*  PATTERN OF DATA FOR 2740 TESTS                                       51300018
*                                                                       51600018
TILT     DC    AL1(TILTEND-TILT)                                        51900018
         DC    X'622367266B2A6E2F70316120642568296D2C733276375B5E5E5E'  52200018
         DC    X'5E5E5E573452134C0D49084504401551104F0E4A0B460743025B'  52500018
         DC    X'5E5E5E5E5E5E'                                          52800018
TILTEND  EQU   *                                                        53100018
*                                                                       53400018
ROTATE   DC    AL1(ROTATEND-ROTATE)                                     53700018
         DC    X'62766B6D706443574A4C514523372A23312502340B0D5B5E5E5E'  54000018
         DC    X'5E5E5E100407130E081526322F292046524F494067736E68615B'  54300018
         DC    X'5E5E5E5E5E5E'                                          54600018
ROTATEND EQU   *                                                        54900018
*                                                                       55200018
TWIST    DC    AL1(TWISTEND-TWIST)                                      55500018
         DC    X'E234A357E713A652EB0DAA4CEE08AF49F004B145E1155B5E5E5E'  55800018
         DC    X'5E5E5E8276C3378773C6328B6DCA2C8E68CF299064D125A0405B'  56100018
         DC    X'5E5E5E5E5E5E'                                          56400018
TWISTEND EQU   *                                                        56700018
*                                                                       57000018
ALLCHAR  DC    AL1(ALLCHARX-ALLCHAR)                                    57300018
**                0 1 2 3 4 5 6 7 8 9 a b c d e f g h i j k l m n o p   57600018
         DC    X'1302040710080D0B0E164F372F2A296762324C612C3143255168'  57900018
*                 q r s t u v w x y zNL             A B C D E F G H I   58200018
         DC    X'6D4A52202646572373155B5E5E5E5E5E5ECFB7AFAAA9E7E2B2CC'  58500018
*                 J K L M N O P Q R S T U V W X Y ZNL                   58800018
         DC    X'E1ACB1C3A5D1E8EDCAD2A0A6C6D7A3F3955B5E5E'              59100018
ALLCHARX EQU   *                                                        59400018
*                                                                       59700018
ANALYZER DC    AL1(ANALYZEX-ANALYZER)                                   60000018
*                 1 2 3 4 5SP cSP 9SPSP sSP aSP e & b k s pBSBSBSBSBS   60300018
         DC    X'0204071008012F0116010153014F01298B372C52685D5D5D5D5D'  60600018
*                BSBSBSBSBSBSBS 0BSBSBS 8BSBSBS 6SPSPSPSPSPSP pSP cNL   60900018
         DC    X'5D5D5D5D5D5D5D135D5D5D0E5D5D5D0D01010101010168012F5B'  61200018
*                SPSPSPSPSPSPSP cILNLILILIL l fLFILIL 1LFILIL 2LFILIL   61500018
         DC    X'010101010101012F5E5B5E5E5E31673B5E5E023B5E5E043B5E5E'  61800018
*                 3NL                                                   62100018
         DC    X'075B'                                                  62400018
ANALYZEX EQU   *                                                        62700018
*                                                                       63000018
*  ADDRESSES OF DATA TO BE MOVED TO PATTERN BUFFER                      63300018
*                                                                       63600018
         DS    0H                                                       63900018
DATAADDR EQU   *                                                        64200018
         LA    FROMREG,TILT                                             64500018
         LA    FROMREG,ROTATE                                           64800018
         LA    FROMREG,TWIST                                            65100018
         LA    FROMREG,ALLCHAR                                          65400018
         LA    FROMREG,ANALYZER                                         65700018
*                                                                       66000018
*                                                                       66300018
COMPDATA EQU   *  0 1 2 3 4 5 6 7 8 9 A B C D E                         66600018
         DC    X'1302040710080D0B0E164F372F2A29'  STORED                66900018
*                 F G H I J K L M N O P Q R S T         COMPARISON      67200018
         DC    X'6762324C612C31432551686D4A5220'                  DATA  67500018
*                 U V W X Y Z                                           67800018
         DC    X'264657237315'                                          68100018
*                                                                       68400018
*                 C M P   V L D - /NL                                   68700018
CMPVALD  DC    X'2F43680146312A76705B'                                  69000018
*                                                                       69300018
LN       EQU   L'CMPVALD                LENGTH ATTRIBUTE OF VALID MSG   69600018
HA       DC    H'10'                                                    69900018
MAXLNG   DC    H'35'                                                    70200018
EXCOMP   CLC   8(*-*,IOREG),COMPDATA                                    70500018
*                                                                       70800018
*  CCW'S                                                                71100018
*                                                                       71400018
CHANPROG DS    0D                                                       71700018
         CCW   X'01',0,X'A0',15         WRITE CARRIAGE RETURN AND IDLES 72000018
         CCW   X'01',0,X'20',0          WRITE THE TEST MESSAGE          72300018
         EJECT                                                          72600018
*                                                                       72900018
*  EQUATES                                                              73200018
*                                                                       73500018
WORKREG2 EQU   1                                                        73800018
GETMAIN  EQU   1                                                        74100018
WORKREG  EQU   2                                                        74400018
PARREG   EQU   3                                                        74700018
FROMREG  EQU   4                                                        75000018
IOBREG   EQU   5                                                        75300018
BASEREG  EQU   6                                                        75600018
IOREG    EQU   7                                                        75900018
TESTREG  EQU   8                                                        76200018
PATRNREG EQU   9                                                        76500018
CCWREG   EQU   10                                                       76800018
DCBREG   EQU   11                                                       77100018
DECBREG  EQU   12                                                       77400018
TOREG    EQU   13                                                       77700018
WORKREG3 EQU   13                                                       78000018
RETURN   EQU   14                                                       78300018
LINKREG  EQU   15                                                       78600018
         EJECT                                                          78900018
         DCBD  DSORG=BX,DEVD=BS                                         79200018
         EJECT                                                          79500018
         IECTIOBX                                                       79800018
         SPACE 2                                                        80100018
IOBNAME  EQU   IOBERCCW                                                 80400018
IOBAREA  EQU   IOBNAME+8                                                80700018
IOBPARM  EQU   IOBNAME+12                                               81000018
         EJECT                                                          81300018
         IECTDECB                                                       81600018
         EJECT                                                          81900018
PARMLIST DSECT                                                          82200018
PATTERN  DS    F                                                        82500018
NLIDLES  DS    F                                                        82800018
         SPACE 5                                                        83100018
CPA      DSECT                                                          83400018
CCW1     DS    D                        WRITE EOA                       83700018
CCW2     DS    D                        WRITE NL,PADS                   84000018
         END                                                            84300018
./  ADD  SSI=43440437,NAME=IGC1006F
         TITLE ' IGC1006F - 3270 REMOTE ASCII TEST MODULE '             00300002
IGC1006F CSECT                                                          00600002
*********************************************************************** 00605002
*                  3270 REMOTE ASCII TEST MODULE                      * 00610002
*********************************************************************** 00615002
*                                                                     * 00620002
* STATUS:                                                             * 00625002
*                                                                     * 00635002
*        ZA02332  (11/20/74)                                          * 00637003
*                                                                     * 00639002
*********************************************************************** 00639402
*                                                                     * 00639802
* FUNCTION:                                                           * 00640002
*    THIS MODULE BUILDS PREDEFINED ASCII ON-LINE TEST MESSAGES        * 00645002
*    FOR THE REMOTE 3270 DISPLAY SYSTEM.                              * 00650002
*                                                                     * 00655002
* ENTRY:                                                              * 00660002
*         ENTRY IS TO THE FIRST EXECUTABLE INSTRUCTION VIA XCTL       * 00665002
*         FROM IGC0D06F.                                              * 00670002
*                                                                     * 00675002
* INPUT:                                                              * 00680002
*    REG 1 - ADDRESS OF THE IOB                                       * 00685002
*    REG 4 - TEST TYPE XX VALUE                                       * 00690002
*    IOBERINF - ADDRESS OF THE RFT                                    * 00695002
*    ON-LINE TEST CHANNEL PROGRAM IN IOB, BUILT BY IGC0D06F.          * 00700002
*                                                                     * 00705002
*                                                                     * 00710002
* OUTPUT:                                                             * 00715002
*    TEST MESSAGE BUILT IN USER'S AREA.                               * 00720002
*    COUNT IN WRITE TEXT CCW.                                         * 00725002
*    IF THE USER'S BUFFER IS NOT LONG ENOUGH (300 BYTES) OR THE       * 00730002
*    TEST MESSAGE NUMBER IS INVALID, AN ERROR FLAG (IOBINCAM,         * 00735002
*    BYTE 0, BIT 6) IS TURNED ON. THIS WILL CAUSE IGG019MR TO         * 00740002
*    CANCEL THE TEST                                                  * 00745002
*    TESTS BUILT BY THIS MODULE:                                      * 00750002
*    TEST 29 - 3270 BASIC ASCII                                       * 00755002
*    TEST 30 - 3270 MODEL 1 ALIGN ASCII                               * 00760002
*    TEST 32 - 3270 ORDERS ASCII                                      * 00765002
* EXTERNAL REFERENCES:                                                * 00770002
*         SVC 0 - EXECUTE CHANNEL PROGRAM                             * 00775002
*                                                                     * 00780002
* EXITS, NORMAL:                                                      * 00785002
*     SVC 3 - RETURN TO IOS                                           * 00790002
*                                                                     * 00795002
* EXITS, ERROR:                                                       * 00800002
*         NONE                                                        * 00805002
*                                                                     * 00810002
* TABLES/WORK AREAS:                                                  * 00815002
*         NONE                                                        * 00820002
*                                                                     * 00825002
* ATTRIBUTES:                                                         * 00830002
*    RE-ENTRANT                                                       * 00835002
*                                                                     * 00840002
* CHARACTER CODE DEPENDENCY:                                          * 00845002
*    NONE:                                                            * 00850002
*                                                                     * 00855002
*********************************************************************** 00860002
         EJECT                                                          00865002
*/*IGC1006F: CHART*/                                                    00900002
*/* E IGC1006F*/                                                        01200002
*/* P OVERLAY TRANSPARENT CCW*/                                         01500002
*/* P STORE ADDR OF START OF RFT IN CCW*/                               01800002
*/* D (YES,,NO,SETERR) IS BUFFER LONG ENOUGH*/                          02100002
*/* D (YES,,NO,SETERR) IS TEST NUMBER VALID (29,30, OR 32)*/            02400002
*/* P GET MESSAGE LENGTH AND ADDRESS*/                                  02700002
*/* P (,STARTEST) MOVE TEST MESSAGE INTO USER'S BUFFER*/                03000002
*/*SETERR: M TURN ON ERROR FLAG*/                                       03300002
*/* P SET COUNT TO ONE*/                                                03600002
*/*STARTEST: P STORE COUNT IN CCW*/                                     03900002
*/* P SAVE THE ECB*/                                                    04200002
*/* L SVC 0*/                                                           04500002
*/* P RESTORE THE ECB*/                                                 04800002
*/* R SVC 3*/                                                           05100002
*/*IGC1006F: END*/                                                      05400002
         EJECT                                                          05500002
         SPACE 2                                                        05700002
*        ESTABLISH ADDRESSABILITY                                       06000002
         SPACE                                                          06300002
         BALR  BASEREG,ZEROREG     SET UP BASE REG                      06600002
         USING *,BASEREG                                                06900002
         USING IECTIOB,IOBREG      IOB DSECT                            07200002
         USING IECTDECB,DECBREG    DECB DSECT                           07500002
         USING IHADCB,DCBREG       DCB DSECT                            07800002
         USING IECTDEB,DEBREG      DEB DSECT                            08100002
         USING UCBDSECT,UCBREG     UCB DSECT                            08400002
         B     SETUP               BRANCH AROUND ID USED TO             08700002
         DC    C'IGC1006F'         FIND MODULE IN DUMP                  09000002
         DC    C' 4322'            DATE LAST CHANGE         LD @ZA02332 09050003
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY       LD @ZA02332 09100003
         DS    0H                                           LD @ZA02332 09150003
PATCH    DC    48X'00'             PATCH AREA               LD @ZA02332 09200003
         DS    0H                                           LD @ZA02332 09250003
SETUP    EQU   *                                                        09300002
         L     DECBREG,IOBECBPT    GET DECB ADDR                        09600002
         L     DCBREG,IOBDCBPT     GET DCB ADDR                         09900002
         L     DEBREG,DCBDEBAD     GET DEB ADDR                         10200002
         L     DEBREG,PREFIX(DEBREG) GO PAST PREFIX                     10500002
         SPACE                                                          10800002
         SPACE                                                          11100002
*        SET UP CHANNEL PROGRAM                                         11400002
         SPACE                                                          11700002
         MVC   IOBCPA+48(CCWLNG),IOBCPA+56 OVERLAY TRANS CCW            12000002
         LA    CCWREG,IOBCPA+40    GET ADDR OF CCW                      12300002
         SPACE 2                                                        13200002
*        VALIDITY CHECK BUFFER LENGTH AND TEST NUMBER. IF               13500002
*        INVALID, SET UP NOP CCW AND TURN ON ERROR FLAG.                13800002
         SPACE                                                          14100002
         CLC   DECLNGTH(BUFLNG),MINBUF IS BUFFER LONG ENOUGH            14400002
         BL    SETERR              NO, SET UP FOR ERROR                 14700002
         C     TESTREG,TEST29      IS IT TEST 29 ?                      15000002
         BE    GETINFO             YES, GET MSG ADDR & COUNT            15300002
         C     TESTREG,TEST30      IS IT TEST 30 ?                      15600002
         BE    GETINFO             YES, GET MSG ADDR & COUNT            15900002
         C     TESTREG,TEST32      IS IT TEST 32 ?                      16200002
         BNE   SETERR              NO, SET UP FOR ERROR                 16500002
         SPACE 2                                                        16800002
*        GET TEST MESSAGE ADDRESS AND LENGTH                            17100002
         SPACE                                                          17400002
GETINFO  LR    WORKREG1,TESTREG    GET TEST #                           17700002
         S     WORKREG1,TEST29     SUBTRACT 29 TO GET INDEX             18000002
*                                  (29 IS LOWEST TEST NUMBER            18300002
*                                  THIS MODULE WILL HANDLE)             18600002
         SLL   WORKREG1,2          MULTIPLY BY 4                        18900002
         L     COUNTREG,COUNTAB(WORKREG1) GET MSG LENGTH                19200002
         B     ADDRTAB(WORKREG1)   GET MSG ADDR                         19500002
         SPACE 2                                                        19800002
*        MESSAGE ADDRESS AND LENGTH TABLES - (TEST MESSAGE              20100002
*        NUMBER - 29) X 4 = THE ARGUMENT USED TO OBTAIN VALUES          20400002
*        FROM THE TABLE.                                                20700002
         SPACE                                                          21000002
         DS    0F                                                       21300002
COUNTAB  EQU   *                   MESSAGE LENGTH IN BYTES              21600002
         DC    A(TST29SZ)          TEST 29                              21900002
         DC    A(TST30SZ)          TEST 30                              22200002
         DC    A(0)                UNUSED                               22500002
         DC    A(TST32SZ)          TEST 32                              22800002
         SPACE 2                                                        23100002
ADDRTAB  EQU   *                   ADDRESS OF TEST MESSAGE              23400002
         B     TEST29AD            00   GET TEST 29 ADDR                23700002
         B     TEST30AD            04   GET TEST 30 ADDR                24000002
         B     SETERR              08   UNUSED                          24300002
         B     TEST32AD            0C   GET TEST 32 ADDR                24600002
TEST29AD LA    ADDREG,IJLBOT29     GET MSG ADDR                         24900002
         B     MOVEIN              CONTINUE                             25200002
TEST30AD LA    ADDREG,IJLBOT30     GET MSG ADDR                         25500002
         B     MOVEIN              CONTINUE                             25800002
TEST32AD LA    ADDREG,IJLBOT32     GET MSG ADDR                         26100002
         SPACE 2                                                        26400002
         SPACE 2                                                        26700002
*        MOVE TEST MSG INTO USER'S BUFFER                               27000002
         SPACE                                                          27300002
MOVEIN   EQU   *                                                        27600002
         L     RFTREG,IOBERINF     GET ADDR OF RFT                      27900002
         LA    WORKREG2,IOBCPA     STORE ADDR IOBCPA             S99245 27950002
         ST    WORKREG2,IOBSTART   INTO IOBSTART                 S99245 27960002
         CLI   NVALUE(RFTREG),NOADDR   IS THIS A DIAL RFT?       S99245 27970002
         BNE   BSC3RFT             NO,FOLLOW BSC3 PROCEDURE      S99245 27980002
         LA    RFTREG,CHARS7(RFTREG)   ADJUST PTR PAST RFT       S99245 27990002
         B     TSTLNG                                            S99245 27992002
BSC3RFT  EQU   *                                                 S99245 27994002
         LA    RFTREG,CHARS11(RFTREG) ADJUST PTE PAST RFT               28000002
TSTLNG   EQU   *                                                 S99245 28050002
         SR    WORKREG2,WORKREG2   CLEAR REG                            28200002
         C     COUNTREG,MAXLNGTH   IS MSG LNGTH OVER 256 ?              28500002
         BNH   LNGTHOK             NO, BRANCH                           28800002
         LR    WORKREG2,COUNTREG   GET EXCESS OVER 256                  29100002
         S     WORKREG2,MAXLNGTH                                        29400002
         L     COUNTREG,MAXLNGTH   SET COUNT TO 256                     29700002
LNGTHOK  EQU   *                                                        30000002
         BCTR  COUNTREG,ZEROREG    SUBTRACT ONE FROM LNGTH FOR          30300002
*                                  EXECUTE                              30600002
         EX    COUNTREG,MSGMOVE    MOVE TEST MSG TO USER'S              30900002
*                                  BUFFER                               31200002
         LTR   WORKREG2,WORKREG2   ANY MORE TO MOVE ?                   31500002
         BZ    STARTEST            NO, BRANCH                           31800002
         A     RFTREG,MAXLNGTH     BUMP ADDRESS PAST 256                32100002
         A     ADDREG,MAXLNGTH     CHARS JUST MOVED                     32400002
         BCTR  WORKREG2,ZEROREG    SUBTRACT ONE FOR EXECUTE             32700002
         EX    WORKREG2,MSGMOVE    MOVE REMAINDER OF TEXT               33000002
         B     STARTEST            BRANCH AROUND EXECUTE                33300002
MSGMOVE  MVC   0(FILLIN,RFTREG),0(ADDREG) MOVE TEST MSG TO              33600002
*                                  USER'S BUFFER, USING LENGTH          33900002
*                                  SPECIFIED IN COUNTREG                34200002
SETERR   EQU   *                                                        34500002
         OI    IOBINCAM,ERFLAG     TURN ON ERROR FLAG                   34800002
         LA    COUNTREG,ONECHAR    SET COUNT TO ONE                     35100002
         B     STARTEST            DO TEST                              35400002
         SPACE 2                                                        35700002
*        MOVE COUNT INTO CCW AND START TEST                             36000002
         SPACE                                                          36300002
STARTEST EQU   *                                                        36600002
         LA    COUNTREG,ONECHAR(COUNTREG) RESTORE COUNT                 36900002
         STH   COUNTREG,BYTECNT(CCWREG) STORE COUNT IN CCW              37200002
*                                                                       37250002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 37300003
*                                                                       37350002
         LR    WORKREG1,IOBREG     SAVE IOB ADDR            LD @ZA02332 37400003
         L     PARMREG,GETPARM     SET FOR GETMAIN          LD @ZA02332 37450003
         GETMAIN R,LV=(0)          GETMAIN FOR ECB          LD @ZA02332 37500003
         LR    WORKREG2,IOBREG     SAVE ECB ADDR            LD @ZA02332 37550003
         ST    DECBREG,DISP4(WORKREG2)  SAVE ECB ADDR       LD @ZA02332 37600003
         MVI   DISP4(WORKREG2),FOXFOX   FLAG AS DUMMY DECB  LD @ZA02332 37650003
         LR    IOBREG,WORKREG1     RESTORE IOB REG          LD @ZA02332 37700003
         STCM  WORKREG2,MASK,IOBECBPT+DISP1  POINT IOB...   LD @ZA02332 37750003
*                                  ...TO DUMMY              LD @ZA02332 37760003
         SVC   EXCP                DO TEST                              37800002
*                                                                       37850002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 37900003
*                                                                       37950002
         STCM  DECBREG,MASK,IOBECBPT+DISP1  REPOINT IOB...  LD @ZA02332 38000003
*                                  ...TO DECB               LD @ZA02332 38050003
         L     PARMREG,GETPARM     SET UP FOR FREEMAIN      LD @ZA02332 38100003
         FREEMAIN R,LV=(0),A=(WORKREG2)  FREEMAIN ECB       LD @ZA02332 38150003
         SVC   RETURN              RETURN                               38400002
         SPACE 2                                                        38700002
*        IF AN ERROR WAS FOUND, TURN ON ERROR FLAG, GET CCW             39000002
*        ADDR, AND ISSUE NOP CCW                                        39300002
         SPACE                                                          39600002
         SPACE 2                                                        39900002
*        REGISTER EQUATES                                               40200002
         SPACE                                                          40500002
PARMREG  EQU   0                   PARAMETER REG            LD @ZA02332 40550003
IOBREG   EQU   1                   ADDR OF IOB                          40800002
DECBREG  EQU   2                   ADDR OF DECB                         41100002
DCBREG   EQU   3                   ADDR OF DCB                          41400002
TESTREG  EQU   4                   TEST #                               41700002
WORKREG1 EQU   5                   WORK REG                             42000002
WORKREG2 EQU   6                   WORK REG                             42300002
DEBREG   EQU   7                   ADDR OF DEB                          42600002
UCBREG   EQU   8                   ADDR OF UCB                          42900002
ADDREG   EQU   9                   TEST MSG ADDRESS                     43200002
COUNTREG EQU   10                  TEST MSG LENGTH                      43500002
CCWREG   EQU   11                  ADDR OF CCW TO WRITE TEST MSG        43800002
BASEREG  EQU   12                                                       44100002
RFTREG   EQU   13                  ADDR OF RFT                          44400002
ZEROREG  EQU   0                   IN BCTR FOR NO BRANCH                44500002
         SPACE 2                                                        44700002
*        MISCELLANEOUS EQUATES                                          45000002
         SPACE                                                          45300002
ERFLAG   EQU   X'02'               ERROR FLAG                           45600002
PREFIX  EQU    28                  DISP OF START OF DEB                 45630002
CCWLNG   EQU   8                   LENTH OF A CCW                       45660002
BUFLNG   EQU   2                   LENGTH OF DECLNGTH FIELD             45690002
CHARS11  EQU   11                  LENGHT OF STD RFT - REMOTE           45720002
FILLIN   EQU   0                   LENGTH FILLED IN EX INSTR            45750002
ONECHAR  EQU   1                   ONE CHARACTER                        45780002
BYTECNT  EQU   6                   DISP IN CCW OF BYTE COUNT            45810002
EXCP     EQU   0                   EXCP SVC #                           45840002
RETURN   EQU   3                   RETURN SVC #                         45870002
NVALUE   EQU   6                   DISP INTO RFT OF N VALUE      S99245 45880002
NOADDR   EQU   X'00'               IF N=0, IT IS A DIAL RFT      S99245 45890002
CHARS7   EQU   7                   LENGTH OF STANDARD DIAL RFT   S99245 45892002
FOXFOX   EQU   X'FF'               BYTE OF ALL ONES         LD @ZA02332 45894003
MASK     EQU   7                   MASK FOR STCM            LD @ZA02332 45896003
DISP1    EQU   1                   DISPLACEMENT             LD @ZA02332 45898003
DISP4    EQU   4                   DISPLACEMENT             LD @ZA02332 45898403
         SPACE 2                                                        45900002
*        STORAGE                                                        46200002
         SPACE                                                          46500002
         DS    0F                  FULLWORD BOUNDARY        LD @ZA02332 46550003
GETPARM  DC    X'FA000008'         SUBPOOL # AND LENGTH     LD @ZA02332 46600003
MINBUF   DC    X'012C'             MINIMUM BUFFER LENGTH                46800002
TEST29   DC    F'29'               ACCEPTABLE TEST NUMBER               47100002
TEST30   DC    F'30'               ACCEPTABLE TEST NUMBER               47400002
TEST32   DC    F'32'               ACCEPTABLE TEST NUMBER               47700002
MAXLNGTH DC    F'256'              MAX # OF CHARS FOR MVC               48000002
IJLBOT29 EQU   *                                                        48300002
         DC    X'021B355E'         STX-ESC-EWRT-WCC                     48600002
         DC    X'114126'           SBA 80                               48900002
         DC    X'1D2D'             SF 60                                49200002
         DC    X'41424344454647'   ABCDEFG                              49500002
         DC    X'48494A4B4C4D4E4F'         HIJKLMNO                     49800002
         DC    X'5051525354555657' PQRSTUVW                             50100002
         DC    X'58595A20'                 XYZ                          50400002
         DC    X'1D25'             SF 6C                                50700002
         DC    X'4E4F4E204449'     NON DI                               51000002
         DC    X'53504C4159'              SPLAY                         51300002
         DC    X'11422D'           SBA 160                              51600002
         DC    X'1D20'             SF 40                                51900002
         DC    X'13'               INC                                  52200002
         DC    X'434F50592041424F56' COPY ABOV                          52500002
         DC    X'4520494E20544849'            E IN THI                  52800002
         DC    X'53204C494E45'                        S LINE            53100002
         DC    X'20202020'         (FOUR SPACES)                        53400002
         DC    X'1D20'             SF40                                 53700002
         DC    X'494E534552542043' INSERT C                             54000002
         DC    X'4B0000'                   K-(2 NULLS)                  54300002
         DC    X'1D2D'             SF 60                                54600002
         DC    X'114330'           SBA 240                              54900002
         DC    X'1D59'             SF E8                                55200002
         DC    X'5B3C282B2126'     SPECIAL CHARS                        55500002
         DC    X'5D242A295E2D2F3B' SPECIAL CHARS                        55800002
         DC    X'255F3E3F3A234027' SPECIAL CHARS                        56100002
         DC    X'3D22'             SPECIAL CHARS                        56400002
         DC    X'1D38'             SF F8                                56700002
         DC    X'3031323334353637' 01234567                             57000002
         DC    X'38392C2E2D41'             89,.-A                       57300002
         DC    X'114520'           SBA 320                              57600002
         DC    X'1D48'             SF C8                                57900002
         DC    X'434F50592041424F56' COPY ABOV                          58200002
         DC    X'4520494E20544849'            E IN THI                  58500002
         DC    X'53204C494E4520'                      S LINE            58800002
         DC    X'1D51'             SF D8                                59100002
         DC    X'114559'           SBA 360                              59400002
         DC    X'1D2D'             SF 60                                59700002
         DC    X'114626'           SBA 400                              60000002
         DC    X'1D55'             SF E4                                60300002
         DC    X'3F53454C2050454E20' ?SEL PEN                           60600002
         DC    X'54455354000000'              TEST                      60900002
         DC    X'1D59'             SF E8                                61200002
         DC    X'3E53454C205045'   >SEL PE                              61500002
         DC    X'4E2054455354'            N TEST                        61800002
         DC    X'03'               ETX                                  62100002
TST29SZ  EQU   *-IJLBOT29          LENGTH OF TEST 29                    62200002
IJLBOT30 EQU   *                                                        62400002
         DC    X'021B355E'         STX-ESC-EWRT-WCC                     62700002
         DC    X'112020'           SBA 0                                63000002
         DC    X'14205945'         RA 40,E                              63300002
         DC    X'48'               H                                    63600002
         DC    X'1141214848'       SBA 79,HH                            63900002
         DC    X'1141374848'       SBA 119,HH                           64200002
         DC    X'11425E4848'       SBA 159,HH                           64500002
         DC    X'1143474848'       SBA 199,HH                           64800002
         DC    X'11433F4848'       SBA 239,HH                           65100002
         DC    X'1144504848'       SBA 279,HH                           65400002
         DC    X'1144224848'       SBA 319,HH                           65700002
         DC    X'1145584848'       SBA 359,HH                           66000002
         DC    X'1146214848'       SBA 399,HH                           66300002
         DC    X'11463748'         SBA 439,H                            66600002
         DC    X'1143244F4F'       SBA 219,OO                           66900002
         DC    X'1144434F4F'       SBA 299,OO                           67200002
         DC    X'114429'           SBA 285                              67500002
         DC    X'5445535420504154' TEST PAT                             67800002
         DC    X'5445524E20464F52'         TERN FOR                     68100002
         DC    X'20333237372D312F'  3277-1/                             68400002
         DC    X'333237352D31'             3275-1                       68700002
         DC    X'114521'           SBA 335                              69000002
         DC    X'414C49474E4D45'   ALIGNME                              69300002
         DC    X'4E54'                    NT                            69600002
         DC    X'1145302A'         SBA 368,*                            69900002
         DC    X'1D20'             SF 40                                70200002
         DC    X'13'               INC                                  70500002
         DC    X'554E50524F5445'   UNPROTE                              70800002
         DC    X'435445442044415441'      CTED DATA                     71100002
         DC    X'114646'           SBA 390                              71400002
         DC    X'1D2D2A'           SF 60,*                              71700002
         DC    X'114638'           SBA 440                              72000002
         DC    X'14475E45'         RA 479,E                             72300002
         DC    X'45'               E                                    72600002
         DC    X'03'               ETX                                  72900002
TST30SZ  EQU   *-IJLBOT30          LENGTH OF TEST 30                    73000002
IJLBOT32 EQU   *                                                        73200002
         DC    X'021B353F'         STX-ESC-EWRT-WCC                     73500002
         DC    X'1D2D'             SF 60                                73800002
         DC    X'464F5220434C55'   FOR CLU                              74100002
         DC    X'53544552454420'          STERED                        74400002
         DC    X'5052494E54455253'               PRINTERS               74700002
         DC    X'2044415441205348'  DATA SH                             75000002
         DC    X'4F554C442053544152'       OULD STAR                    75300002
         DC    X'54204E455854204C'                  T NEXT L            75600002
         DC    X'494E452048455245'                          INE HERE    75900002
         DC    X'202D2D2D2D2D2D3E'  ------>                             76200002
         DC    X'434845434B494E472050'     CHECKING P                   76500002
         DC    X'524F4752414D205441422F'             PROGRAM TAB/       76800002
         DC    X'455241534520554E' ERASE UN                             77100002
         DC    X'50524F542E20544F204144'   PROT. TO AD                  77400002
         DC    X'44522F4455502F464945'                DR/DUP/FIE        77700002
         DC    X'4C44204D4152'     LD MAR                               78000002
         DC    X'4B204F5244455253'       K ORDERS                       78300002
         DC    X'114330'           SBA 240                              78600002
         DC    X'13'               INC                                  78900002
         DC    X'1D38'             SF F8                                79200002
         DC    X'14452031'         RA 320,1                             79500002
         DC    X'1D48'             SF 68                                79800002
         DC    X'14462641'         RA 400,A                             80100002
         DC    X'1D2D'             SF 60                                80400002
         DC    X'14475E42'         RA 479,B                             80700002
         DC    X'11445031'         SBA 279,1                            81000002
         DC    X'09'               PT                                   81300002
         DC    X'114559'           SBA 360                              81600002
         DC    X'124626'           EUA 400                              81900002
         DC    X'11465B'           SBA 394                              82200002
         DC    X'1C1E0A19'         DUP/FM/NL/EOM                        82500002
         DC    X'03'               ETX                                  82800002
TST32SZ  EQU   *-IJLBOT32          LENGTH OF TEST 32                    82900002
         SPACE 2                                                        83100002
*        DSECTS                                                         83400002
         SPACE                                                          83700002
         IECTIOBX                                                       84000002
         EJECT                                                          84300002
         IECTDECB                                                       84600002
         EJECT                                                          84900002
         DCBD  DSORG=BX,DEVD=BS                                         85200002
         EJECT                                                          85500002
         IECTDEBX                                                       85800002
UCBDSECT DSECT                                                          86100002
         DS    0F                                                       86400002
         ORG   UCBDSECT+13         UCBNAME (UNIT NAME)                  86700002
CHARADDR DS    CL3                 UNIT ADDR (EBCDIC)                   87000002
         ORG   UCBDSECT+18         UCBTYP + 2                           87300002
DVCLASS  DS    CL1                 DEVICE CLASS                         87600002
UNITYPE  DS    CL1                 UNIT TYPE                            87900002
         ORG   UCBDSECT+36         UCBRLN                               88200002
RLN      DS    CL1                 RELATIVE LINE NUMBER                 88500002
      END                                                               88800002
./  ADD  SSI=62660413,NAME=IGC1106F
         TITLE ' IGC1106F - 3270 REMOTE ASCII TEST MODULE '             00300002
IGC1106F CSECT                                                          00600002
*********************************************************************** 00605002
*                  3270 REMOTE ASCII TEST MODULE                      * 00610002
*********************************************************************** 00615002
*                                                                     * 00620002
* STATUS:                                                             * 00625002
*                                                                     * 00639002
*        ZA02332  (11/20/74)                                          * 00639403
*        AZ09327  (03/11/76)                                          * 00639600
*                                                                     * 00639802
*********************************************************************** 00639902
*                                                                     * 00645302
* FUNCTION:                                                           * 00651602
*    THIS MODULE BUILDS PREDEFINED ASCII ON-LINE TEST MESSAGES        * 00657002
*    FOR THE REMOTE 3270 DISPLAY SYSTEM.                              * 00662402
*                                                                     * 00667802
* ENTRY:                                                              * 00673202
*         ENTRY IS TO THE FIRST EXECUTABLE INSTRUCTION VIA XCTL       * 00678602
*         FROM IGC0D06F.                                              * 00684002
*                                                                     * 00689402
* INPUT:                                                              * 00694802
*    REG 1 - ADDRESS OF THE IOB                                       * 00700202
*    REG 4 - TEST TYPE XX VALUE                                       * 00705602
*    IOBERINF - ADDRESS OF THE RFT                                    * 00711002
*    ON-LINE TEST CHANNEL PROGRAM IN IOB, BUILT BY IGC0D06F.          * 00716402
*                                                                     * 00721802
*                                                                     * 00727202
* OUTPUT:                                                             * 00732602
*    TEST MESSAGE BUILT IN USER'S AREA.                               * 00738002
*    COUNT IN WRITE TEXT CCW.                                         * 00743402
*    IF THE USER'S BUFFER IS NOT LONG ENOUGH (300 BYTES) OR THE       * 00748802
*    TEST MESSAGE NUMBER IS INVALID, AN ERROR FLAG (IOBINCAM,         * 00754202
*    BYTE 0, BIT 6) IS TURNED ON. THIS WILL CAUSE IGG019MR TO         * 00759602
*    CANCEL THE TEST                                                  * 00765002
*    TESTS BUILT BY THIS MODULE:                                      * 00770402
*    TEST 31 - 3270 MODEL 2 ALIGN ASCII                               * 00775802
*    TEST 33 - 3270 BASIC PRINTER ASCII                               * 00781202
*    TEST 34 - 3270 NL/EOM PRINTER ASCII                              * 00786602
* EXTERNAL REFERENCES:                                                * 00792002
*         SVC 0 - EXECUTE CHANNEL PROGRAM                             * 00797402
*                                                                     * 00802802
* EXITS, NORMAL:                                                      * 00808202
*     SVC 3 - RETURN TO IOS                                           * 00813602
*                                                                     * 00819002
* EXITS, ERROR:                                                       * 00824402
*         NONE                                                        * 00829802
*                                                                     * 00835202
* TABLES/WORK AREAS:                                                  * 00840602
*         NONE                                                        * 00846002
*                                                                     * 00851402
* ATTRIBUTES:                                                         * 00856802
*    RE-ENTRANT                                                       * 00862202
*                                                                     * 00867602
* CHARACTER CODE DEPENDENCY:                                          * 00873002
*    NONE:                                                            * 00878402
*                                                                     * 00883802
*********************************************************************** 00889202
         EJECT                                                          00894602
*/*IGC1106F: CHART*/                                                    00900002
*/* E IGC1106F*/                                                        01200002
*/* P OVERLAY TRANSPARENT CCW*/                                         01500002
*/* P STORE ADDR OF START OF RFT IN CCW*/                               01800002
*/* D (YES,,NO,SETERR) IS BUFFER LONG ENOUGH*/                          02100002
*/* D (YES,,NO,SETERR) IS TEST NUMBER VALID (31,33, OR 34)*/            02400002
*/* P GET MESSAGE LENGTH AND ADDRESS*/                                  02700002
*/* P (,STARTEST) MOVE TEST MESSAGE INTO USER'S BUFFER*/                03000002
*/*SETERR: M TURN ON ERROR FLAG*/                                       03300002
*/* P SET COUNT TO ONE*/                                                03600002
*/*STARTEST: P STORE COUNT IN CCW*/                                     03900002
*/* P SAVE THE ECB*/                                                    04200002
*/* L SVC 0*/                                                           04500002
*/* P RESTORE THE ECB*/                                                 04800002
*/* R SVC 3*/                                                           05100002
*/*IGC1106F: END*/                                                      05400002
         EJECT                                                          05500002
         SPACE 2                                                        05700002
*        ESTABLISH ADDRESSABILITY                                       06000002
         SPACE                                                          06300002
         BALR  BASEREG,ZEROREG     SET UP BASE REG                      06600002
         USING *,BASEREG                                                06900002
         USING IECTIOB,IOBREG      IOB DSECT                            07200002
         USING IECTDECB,DECBREG    DECB DSECT                           07500002
         USING IHADCB,DCBREG       DCB DSECT                            07800002
         USING IECTDEB,DEBREG      DEB DSECT                            08100002
         USING UCBDSECT,UCBREG     UCB DSECT                            08400002
         B     SETUP               BRANCH AROUND ID USED TO             08700002
         DC    C'IGC1106F'         FIND MODULE IN DUMP                  09000002
         DC    C' 4322'            DATE LAST CHANGE         LD @ZA02332 09050003
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY       LD @ZA02332 09100003
         DS    0H                                           LD @ZA02332 09150003
PATCH    DC    48X'00'             PATCH AREA               LD @ZA02332 09200003
         DS    0H                                           LD @ZA02332 09250003
SETUP    EQU   *                                                        09300002
         L     DECBREG,IOBECBPT    GET DECB ADDR                        09600002
         L     DCBREG,IOBDCBPT     GET DCB ADDR                         09900002
         L     DEBREG,DCBDEBAD     GET DEB ADDR                         10200002
         L     DEBREG,PREFIX(DEBREG) GO PAST PREFIX                     10500002
         SPACE 2                                                        10800002
*        SET UP CHANNEL PROGRAM                                         11100002
         SPACE                                                          11400002
         MVC   IOBCPA+48(CCWLNG),IOBCPA+56 OVERLAY TRANS CCW            11700002
         LA    CCWREG,IOBCPA+40    GET ADDR OF CCW                      12000002
         SPACE 2                                                        12900002
*        VALIDITY CHECK BUFFER LENGTH AND TEST NUMBER. IF               13200002
*        INVALID, SET UP NOP CCW AND TURN ON ERROR FLAG.                13500002
         SPACE                                                          13800002
         CLC   DECLNGTH(BUFLNG),MINBUF IS BUFFER LONG ENOUGH            14100002
         BL    SETERR              NO, SET UP FOR ERROR                 14400002
         C     TESTREG,TEST31      IS IT TEST 31 ?                      14700002
         BE    GETINFO             YES, GET MSG ADDR & COUNT            15000002
         C     TESTREG,TEST33      IS IT TEST 33 ?                      15300002
         BE    GETINFO             YES, GET MSG ADDR & COUNT            15600002
         C     TESTREG,TEST34      IS IT TEST 34 ?                      15900002
         BNE   SETERR              NO, SET UP FOR ERROR                 16200002
         SPACE 2                                                        16500002
*        GET TEST MESSAGE ADDRESS AND LENGTH                            16800002
         SPACE                                                          17100002
GETINFO  LR    WORKREG1,TESTREG    GET TEST #                           17400002
         S     WORKREG1,TEST31     SUBTRACT 31 TO GET INDEX             17700002
*                                  (31 IS LOWEST TEST NUMBER            18000002
*                                  THIS MODULE WILL HANDLE)             18300002
         SLL   WORKREG1,2          MULTIPLY BY 4                        18600002
         L     COUNTREG,COUNTAB(WORKREG1) GET MSG LENGTH                18900002
         B     ADDRTAB(WORKREG1)   GET MSG ADDR                         19200002
         SPACE 2                                                        19500002
*        MESSAGE ADDRESS AND LENGTH TABLES - (TEST MESSAGE              19800002
*        NUMBER - 31) X 4 = THE ARGUMENT USED TO OBTAIN VALUES          20100002
*        FROM THE TABLE.                                                20400002
         SPACE                                                          20700002
         DS    0F                                                       21000002
COUNTAB  EQU   *                   MESSAGE LENGTH IN BYTES              21300002
         DC    A(TST31SZ)          TEST 31                              21600002
         DC    A(0)                UNUSED                               21900002
         DC    A(TST33SZ)          TEST 33                              22200002
         DC    A(TST34SZ)          TEST 34                              22500002
         SPACE 2                                                        22800002
ADDRTAB  EQU   *                   ADDRESS OF TEST MESSAGE              23100002
         B     TEST31AD            00   GET TEST 31 ADDR                23400002
         B     SETERR              04   UNUSED                          23700002
         B     TEST33AD            08   GET TEST 33 ADDR                24000002
         B     TEST34AD            0C   GET TEST 34 ADDR                24300002
TEST31AD LA    ADDREG,IJLBOT31     GET MSG ADDR                         24600002
         B     MOVEIN              CONTINUE                             24900002
TEST33AD LA    ADDREG,IJLBOT33     GET MSG ADDR                         25200002
         B     MOVEIN              CONTINUE                             25500002
TEST34AD LA    ADDREG,IJLBOT34     GET MSG ADDR                         25800002
         SPACE 2                                                        26100002
*        MOVE TEST MSG INTO USER'S BUFFER                               26400002
         SPACE                                                          26700002
MOVEIN   EQU   *                                                        27000002
         L     RFTREG,IOBERINF     GET ADDR OF RFT                      27300002
         LA    WORKREG2,IOBCPA     GET ADDR OF IOBCPA            S99245 27350002
         ST    WORKREG2,IOBSTART   AND STORE IN IOBSTART         S99245 27360002
         CLI   NVALUE(RFTREG),NOADDR   IS THIS A DIAL RFT?       S99245 27370002
         BNE   BSC3RFT             NO,FOLLOW BSC3 PROCEDURE      S99245 27380002
         LA    RFTREG,CHARS7(RFTREG)   ADJUST PTR PAST RFT       S99245 27390002
         B     TSTLNG              GO CHECK MSG LENGTH           S99245 27392002
BSC3RFT  EQU   *                                                 S99245 27394002
         LA    RFTREG,CHARS11(RFTREG) ADJUST PTR PAST RFT               27400002
TSTLNG   EQU   *                                                 S99245 27450002
         SR    WORKREG2,WORKREG2   CLEAR REG                            27600002
         C     COUNTREG,MAXLNGTH   IS MSG LNGTH OVER 256 ?              27900002
         BNH   LNGTHOK             NO, BRANCH                           28200002
         LR    WORKREG2,COUNTREG   GET EXCESS OVER 256                  28500002
         S     WORKREG2,MAXLNGTH                                        28800002
         L     COUNTREG,MAXLNGTH   SET COUNT TO 256                     29100002
LNGTHOK  EQU   *                                                        29400002
         BCTR  COUNTREG,ZEROREG    SUBTRACT ONE FROM LENGTH FOR         29700002
*                                  EXECUTE                              30000002
         EX    COUNTREG,MSGMOVE    MOVE TEST MSG TO USER'S              30300002
*                                  BUFFER                               30600002
         LTR   WORKREG2,WORKREG2   ANY MORE TO MOVE ?                   30900002
         BZ    STARTEST            NO, BRANCH                           31200002
         A     RFTREG,MAXLNGTH     BUMP ADDRESS PAST 256                31500002
         A     ADDREG,MAXLNGTH     CHARS JUST MOVED                     31800002
         AR    COUNTREG,WORKREG2   ADD LENGTH TO COUNTREG       YA01228 31850002
         BCTR  WORKREG2,ZEROREG    SUBTRACT ONE FOR EX                  32100002
         EX    WORKREG2,MSGMOVE    MOVE REMAINDER OF TEXT               32400002
         B     STARTEST            BRANCH AROUND EXECUTE                32700002
MSGMOVE  MVC   0(FILLIN,RFTREG),0(ADDREG) MOVE TEST MSG TO              33000002
*                                  USER'S BUFFER, USING LENGTH          33300002
*                                  SPECIFIED IN COUNTREG                33600002
SETERR   EQU   *                                                        33900002
         OI    IOBINCAM,ERFLAG     TURN ON ERROR FLAG                   34200002
         LA    COUNTREG,ONECHAR    SET COUNT TO ONE                     34500002
         B     STARTEST            DO TEST                              34800002
         SPACE 2                                                        35100002
*        MOVE COUNT INTO CCW AND START TEST                             35400002
         SPACE                                                          35700002
STARTEST EQU   *                                                        36000002
         LA    COUNTREG,ONECHAR(COUNTREG) RESTORE COUNT                 36300002
         STH   COUNTREG,BYTECNT(CCWREG) STORE COUNT OF CCW              36600002
*                                                                       36650002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 36700003
*                                                                       36750002
         LR    WORKREG1,IOBREG     SAVE IOB ADDR            LD @ZA02332 36800003
         L     PARMREG,GETPARM     SET UP FOR GETMAIN       LD @ZA02332 36850003
         GETMAIN R,LV=(0)          GETMAIN FOR ECB          LD @ZA02332 36900003
         LR    WORKREG2,IOBREG     SAVE ECB ADDR            LD @ZA02332 36950003
         ST    DECBREG,DISP4(WORKREG2)  SAVE DECB ADDR      LD @ZA02332 37000003
         MVI   DISP4(WORKREG2),FOXFOX   FLAG AS DUMMY ECB   LD @ZA02332 37050003
         LR    IOBREG,WORKREG1     RESTORE IOB REG          LD @ZA02332 37100003
         STCM  WORKREG2,MASK,IOBECBPT+DISP1  POINT IOB...   LD @ZA02332 37150003
*                                  ...DUMMY                 LD @ZA02332 37160003
         SVC   EXCP                DO TEST                              37200002
*                                                                       37250002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 37300003
*                                                                       37350002
         STCM  DECBREG,MASK,IOBECBPT+DISP1  POINT IOB...    LD @ZA02332 37400003
*                                  ...TO DECB               LD @ZA02332 37450003
         L     PARMREG,GETPARM     SET UP FOR FREEMAIN      LD @ZA02332 37500003
         FREEMAIN R,LV=(0),A=(WORKREG2)  FREE DUMMY ECB     LD @ZA02332 37550003
         SVC   RETURN              RETURN                               37800002
         SPACE 2                                                        38100002
*        IF AN ERROR WAS FOUND, TURN ON ERROR FLAG, GET CCW             38400002
*        ADDR, AND ISSUE NOP CCW                                        38700002
         SPACE                                                          39000002
         SPACE 2                                                        39300002
*        REGISTER EQUATES                                               39600002
         SPACE                                                          39900002
PARMREG  EQU   0                   PARAMETER REGISTER       LD @ZA02332 39950003
IOBREG   EQU   1                   ADDR OF IOB                          40200002
DECBREG  EQU   2                   ADDR OF DECB                         40500002
DCBREG   EQU   3                   ADDR OF DCB                          40800002
TESTREG  EQU   4                   TEST #                               41100002
WORKREG1 EQU   5                   WORK REG                             41400002
WORKREG2 EQU   6                   WORK REG                             41700002
DEBREG   EQU   7                   ADDR OF DEB                          42000002
UCBREG   EQU   8                   ADDR OF UCB                          42300002
ADDREG   EQU   9                   TEST MSG ADDRESS                     42600002
COUNTREG EQU   10                  TEST MSG LENGTH                      42900002
CCWREG   EQU   11                  ADDR OF CCW TO WRITE TEST MSG        43200002
BASEREG  EQU   12                                                       43500002
RFTREG   EQU   13                  ADDR OF RFT                          43800002
ZEROREG  EQU   0                   USED IN BCTR FOR NO BRANCH           43900002
         SPACE 2                                                        44100002
*        MISCELLANEOUS EQUATES                                          44400002
         SPACE                                                          44700002
ERFLAG   EQU   X'02'               ERROR FLAG                           45000002
PREFIX   EQU   28                  DISP OF START OF DEB                 45030002
CCWLNG   EQU    8                  LENGTH OF A CCW                      45060002
BUFLNG   EQU   2                   LENGHT OF DECLNGTH FIELD             45090002
CHARS11  EQU   11                  LENGHT OF STD RFT                    45120002
FILLIN   EQU   0                   LENTH FILLED IN EX INSTR             45150002
ONECHAR   EQU   1                  ONE CHARACTER                        45180002
BYTECNT   EQU   6                  DISP IN CCW OF BYTE COUNT            45210002
EXCP     EQU   0                   EXCP SVC NUMBER                      45240002
RETURN   EQU   3                   RETURN SVC #                         45270002
NVALUE   EQU   6                   DISP INTO RFT OF N VALUE      S99245 45280002
NOADDR   EQU   X'00'               IF N=0, IT IS A DIAL RFT      S99245 45290002
CHARS7   EQU   7                   LENGTH OF STANDARD DIAL RFT   S99245 45292002
FOXFOX   EQU   X'FF'               BYE OF ALL ONES          LD @ZA02332 45294003
MASK     EQU   7                   MASK FOR STCM            LD @ZA02332 45296003
DISP1    EQU   1                   DISPLACEMENT             LD @ZA02332 45298003
DISP4    EQU   4                   DISPLACEMENT             LD @ZA02332 45298403
         SPACE 2                                                        45300002
*        STORAGE                                                        45600002
         SPACE                                                          45900002
         DS    0F                  FULLWORD BOUNDARY        LD @ZA02332 45950003
GETPARM  DC    X'FA000008'         SUBPOOL # AND LENGTH     LD @ZA02332 46000003
MINBUF   DC    X'012C'             MINIMUM BUFFER LENGTH                46200002
TEST31   DC    F'31'               ACCEPTABLE TEST NUMBER               46500002
TEST33   DC    F'33'               ACCEPTABLE TEST NUMBER       YA02054 46800002
TEST34   DC    F'34'               ACCEPTABLE TEST NUMBER               47100002
MAXLNGTH DC    F'256'              MAX # OF CHARS FOR MVC               47400002
IJLBOT31 EQU   *                                                        47700002
         DC    X'021B3522'         STX-ESC-EWRT-WCC                     48000002
         DC    X'14412645'         RA 80,E                              48300002
         DC    X'48'               H                                    48600002
         DC    X'11425E4848'       SBA 159,HH                  @ZA09327 48900000
         DC    X'11433F4848'       SBA 239,HH                           49200002
         DC    X'1144224848'       SBA 319,HH                           49500002
         DC    X'1146214848'       SBA 399,HH                           49800002
         DC    X'11475E4848'       SBA 479,HH                  @ZA09327 50100000
         DC    X'114756'           SBA 485                              50400002
         DC    X'544553542050415454' TEST PATT                          50700002
         DC    X'45524E20464F5220'            ERN FOR                   51000002
         DC    X'333237352D322F33'                    3275-2/3          51300002
         DC    X'3237372D32'                                  277-2     51600002
         DC    X'11483F4848'       SBA 559,HH                           51900002
         DC    X'11483D'           SBA 574                              52200002
         DC    X'414C49474E4D454E54' ALIGNMENT                          52500002
         DC    X'1149224848'       SBA 639,HH                           52800002
         DC    X'112E214848'       SBA 719,HH                           53100002
         DC    X'113C5E4848'       SBA 799,HH                           53400002
         DC    X'113C582A'         SBA 807,*                            53700002
         DC    X'1D20'             SF 40                                54000002
         DC    X'13'               INC                                  54300002
         DC    X'554E50524F544543' UNPROTEC                             54600002
         DC    X'5445442041524541'         TED AREA                     54900002
         DC    X'20202020'         (4 SPACES)                           55200002
         DC    X'1D2D2A'           SF 60,*                              55500002
         DC    X'11283F4848'       SBA 879,HH                           55800002
         DC    X'112B504F4F'       SBA 919,OO                           56100002
         DC    X'112B224848'       SBA 959,HH                           56400002
         DC    X'1121584F4F'       SBA 999,OO                           56700002
         DC    X'1126214848'       SBA 1039,HH                          57000002
         DC    X'114A5E4848'       SBA 1119,HH                          57300002
         DC    X'114B3F4848'       SBA 1199,HH                          57600002
         DC    X'114C224848'       SBA 1279,HH                          57900002
         DC    X'114E214848'       SBA 1359,HH                          58200002
         DC    X'114F5E4848'       SBA 1439,HH                          58500002
         DC    X'11503F4848'       SBA 1519,HH                          58800002
         DC    X'1151224848'       SBA 1599,HH                          59100002
         DC    X'115D214848'       SBA 1679,HH                          59400002
         DC    X'11245E4848'       SBA 1759,HH                          59700002
         DC    X'112A3F48'         SBA 1839,H                           60000002
         DC    X'14202045'         RA 0,E                               60300002
         DC    X'03'               ETX                                  60600002
TST31SZ  EQU   *-IJLBOT31          LENGTH OF TEST 31                    60700002
IJLBOT33 EQU   *                                                        60900002
         DC    X'021B35'           STX-ESC-EWRT                         61200002
         DC    X'21'               WCC-STRT PRNT/SND ALRM/RST KEYBRD    61500002
         DC    X'404142434445464748494A4B4C4D4E4F'  ASCII               61800002
         DC    X'112058'           SBA  39                              62100002
         DC    X'1D2D'             SF 60                                62400002
         DC    X'505152535455565758595A5B5C5D5E5F'    UNIVERSAL         62700002
         DC    X'114121'           SBA  79                              63000002
         DC    X'1D20'             SF  40                               63300002
         DC    X'606162636465666768696A6B6C6D6E6F'      CHARACTER       63600002
         DC    X'114137'           SBA  119                             63900002
         DC    X'1D2D'             SF 60                                64200002
         DC    X'707172737475767778797A7B7C7D7E7F'      SET             64500002
         DC    X'11425E'           SBA 159                              64800002
         DC    X'1D20'             SF  40                               65100002
         DC    X'303132333435363738393A3B3C3D3E3F'  FOR                 65400002
         DC    X'114347'           SBA  199                             65700002
         DC    X'1D2D'             SF 60                                66000002
         DC    X'202122232425262728292A2B2C2D2E2F'    ANR-3270          66300002
         DC    X'11433F'           SBA  239                             66310002
         DC    X'1D20'             SF   40                              66320002
         DC    X'4E2F4C20434845484B20'  NEW LINE CHAR TO FOLLOW         66330002
         DC    X'0A0A0A0A0A'                                            66340002
         DC    X'114450'           SBA  279                             66350002
         DC    X'1D2D'             SF  60                               66360002
         DC    X'454F4D20434845434B20'  EOM CHECK                       66370002
         DC    X'19'                                                    66380002
         DC    X'114621'           SBA  399                             66390002
         DC    X'1D20'             SF   40                              66400002
         DC    X'13'               INC                                  66410002
         DC    X'03'               ETX                                  66600002
TST33SZ  EQU   *-IJLBOT33          LENGTH OF TEST 33                    66700002
IJLBOT34 EQU   *                                                        66900002
         DC    X'021B35'           STX-ESC-EWRT                         67200002
         DC    X'214E4557204C'     WCC- NEW L                           67500002
         DC    X'494E452046554E43'           INE FUNC                   67800002
         DC    X'54494F4E20434845'                   TION CHE           68100002
         DC    X'434B0A4E4557204C' CK-NL-NEW L                          68400002
         DC    X'494E452046554E43'            INE FUNC                  68700002
         DC    X'54494F4E0A4E4557'                     TION-NL-NEW      69000002
         DC    X'204C494E450A4E45'  LINE-NL-NE                          69300002
         DC    X'570A4E4557204C49'            W-NL-NEW LI               69600002
         DC    X'4E450A4E4557204C'                       NE-NL-NEW L    69900002
         DC    X'494E452046554E43' INE FUNC                             70200002
         DC    X'54494F4E0A4E4557'         TION-NL-NEW                  70500002
         DC    X'204C494E45204655'  LINE FU                             70800002
         DC    X'4E4354494F4E2043'         NCTION C                     71100002
         DC    X'4845434B0A'                       HECK-NL              71400002
         DC    X'1D3C'             SF 4C                                71700002
         DC    X'544849532044415441' THIS DATA                          72000002
         DC    X'204E4F5420564953'             NOT VIS                  72300002
         DC    X'49424C452F454F4D' IBLE/EOM                             72600002
         DC    X'20414E44204E2F4C'          AND N/L                     72900002
         DC    X'2049474E4F524544'  IGNORED                             73200002
         DC    X'0A19'             NL-EOM                               73500002
         DC    X'1D20'             SF 40                                73800002
         DC    X'454E442D4F462D4D' END-OF-M                             74100002
         DC    X'4553534147452D54'         ESSAGE-T                     74400002
         DC    X'45524D494E415445'                 ERMINATE             74700002
         DC    X'53205052494E5419' S PRINT-EOM                          75000002
         DC    X'0A324E4420454F4D' NL-2ND EOM                           75300002
         DC    X'204C494E45204E4F'  LONE NO                             75600002
         DC    X'54204F4E20505249'         T ON PRI                     75900002
         DC    X'4E544552204F55'                   NTER OU              76200002
         DC    X'5450555419'       TPUT-EOM                             76500002
         DC    X'03'               ETX                                  76800002
TST34SZ  EQU   *-IJLBOT34          LENGTH OF TEST 34                    76900002
         SPACE 2                                                        77100002
*        DSECTS                                                         77400002
         SPACE                                                          77700002
         IECTIOBX                                                       78000002
         EJECT                                                          78300002
         IECTDECB                                                       78600002
         EJECT                                                          78900002
         DCBD  DSORG=BX,DEVD=BS                                         79200002
         EJECT                                                          79500002
         IECTDEBX                                                       79800002
UCBDSECT DSECT                                                          80100002
         DS    0F                                                       80400002
         ORG   UCBDSECT+13         UCBNAME (UNIT NAME)                  80700002
CHARADDR DS    CL3                 UNIT ADDR (EBCDIC)                   81000002
         ORG   UCBDSECT+18         UCBTYP+2                             81300002
DVCLASS  DS    CL1                 DEVICE CLASS                         81600002
UNITYPE  DS    CL1                 UNIT TYPE                            81900002
         ORG   UCBDSECT+36         UCBRLN                               82200002
RLN      DS    CL1                 RELATIVE LINE NUMBER                 82500002
      END                                                               82800002
./  ADD  SSI=21230106,NAME=IGC1206F
         TITLE ' IGC1206F - LOCAL TEST CONTROL '                        00800000
IGC1206F CSECT                                                          01600000
*********************************************************************** 01610000
*               IGC1206F - LOCAL TEST CONTROL                         * 01620000
*********************************************************************** 01630000
*                                                                     * 01640000
* STATUS:                                                             * 01650000
*    CHANGE LEVEL 000           NOVEMBER 11, 1971                     * 01660000
*                                                                     * 01670000
* FUNCTION:                                                           * 01680000
*    THIS MODULE SETS UP THE CHANNEL PROGRAM FOR LOCAL 3270 ON-LINE   * 01690000
*    TEST AND SELECTS THE APPROPRIATE SECOND SVC 66 (ACCORDING TO     * 01700000
*    THE VALUE OF XX) AND XCTL'S TO IT.                               * 01710000
*                                                                     * 01720000
* ENTRY:                                                              * 01730000
*         TO THE FIRST EXECUTABLE INSTRUCTION VIA XCTL FROM           * 01740000
*         IGC0006F.                                                   * 01750000
*                                                                     * 01760000
* INPUT:                                                              * 01770000
*    REGISTER 1 - ADDRESS OF THE IOB.                                 * 01780000
*    IOBERINF - ADDRESS OF THE START OF THE RFT IN THE USER'S         * 01790000
*    BUFFER.                                                          * 01800000
*                                                                     * 01810000
* OUTPUT:                                                             * 01820000
*                                                                     * 01830000
*    REGISTER 4 - BINARY XX VALUE                                     * 01840000
*    IOBERINF+4 (1 BYTE) - BINARY XX VALUE                            * 01850000
*    IOBERINF+5 (1 BYTE) - BINARY YY VALUE                            * 01860000
*    IOBWORK+2 (1 BYTE) - BINARY YY VALUE (COUNTER)                   * 01870000
*    IOBCPA (8 BYTES) - ERASE/WRITE CCW WITH ADDRESS OF NEXT BYTE     * 01880000
*    IN USER'S BUFFER PAST THE RFT. THE FLAGS AND COUNT ARE ZERO.     * 01890000
*    IOBSTART - ADDRESS OF IOBCPA                                     * 01900000
*                                                                     * 01910000
* EXTERNAL REFERENCES:                                                * 01920000
*         XCTL (TO NEXT ON-LINE TEST SVC 66 LOAD)                     * 01930000
*                                                                     * 01940000
* EXITS, NORMAL:                                                      * 01950000
*         XCTL TO IGC0E06F (FOR TESTS 23 AND 24)                      * 01960000
*         XCTL TO IGC0F06F (FOR TESTS 26 AND 27)                      * 01970000
*         XCTL TO IGC1306F (FOR TEST 28)                              * 01980000
*         XCTL TO IGC1406F (FOR TEST 25)                              * 01990000
*                                                                     * 02000000
* EXITS, ERROR:                                                       * 02010000
*         NONE                                                        * 02020000
*                                                                     * 02030000
* TABLES/WORK AREAS:                                                  * 02040000
*         NONE                                                        * 02050000
*                                                                     * 02060000
* ATTRIBUTES:                                                         * 02070000
*    TRANSIENT, RE-ENTRANT.                                           * 02080000
*                                                                     * 02090000
* CHARACTER CODE DEPENDENCY:                                          * 02100000
*    NONE                                                             * 02110000
*                                                                     * 02120000
*********************************************************************** 02130000
       EJECT                                                            02140000
*/*IGC1206F: CHART*/                                                    02400000
*/* E IGC1206F*/                                                        03200000
*/* P CONVERT XX AND YY VALUES TO BINARY AND STORE IN IOB*/             04000000
*/* P GET ADDRESS OF DATA AND SET UP ERASE/WRITE CCW*/                  04800000
*/* P PUT CCW ADDRESS IN IOBSTART*/                                     05600000
*/* P GET ID OF NEXT MODULE*/                                           06400000
*/* R XCTL TO NEXT LOAD*/                                               07200000
*/*IGC1206F: END*/                                                      08000000
       EJECT                                                            08400000
         SPACE 2                                                        08800000
*        ESTABLISH ADDRESSABILITY                                       09600000
         SPACE                                                          10400000
         BALR  BASEREG,0           SET UP BASE REG                      11200000
         USING *,BASEREG                                                12000000
         USING IECTIOB,IOBREG                                           12800000
         USING RFTMSG,RFTREG                                            13600000
         B     GETRFT              BRANCH AROUND ID USED TO             14400000
         DC    C'IGC1206F'         FIND MODULE IN DUMP                  15200000
         SPACE 2                                                        16000000
*        CONVERT XX AND YY VALUES TO BINARY AND STORE IN                16800000
*        APPROPRIATE FIELDS OF IOB                                      17600000
         SPACE                                                          18400000
GETRFT   L     RFTREG,IOBERINF     GET RFT ADDR                         19200000
         PACK  IOBERINF(8),TESTNUMB CONVERT TEST NUMBER (XX)            20000000
         CVB   BINXXREG,IOBERINF   TO BINARY                            20800000
         PACK  IOBERINF(8),PASSCNT CONVERT NUMBER OF TESTS              21600000
         CVB   WORKREG1,IOBERINF   (YY) TO BINARY                       22400000
         ST    RFTREG,IOBERINF     PUT RFT ADDR BACK                    23200000
         STC   BINXXREG,IOBERINF+4 PUT BINARY XX AND YY VALUES          24000000
         STC   WORKREG1,IOBERINF+5 IN IOBERINF                          24800000
         STC   WORKREG1,IOBWORK+2  PUT YY VALUE IN COUNTER              25600000
*                                  USED BY IGG019PI                     26400000
         SPACE 2                                                        27200000
*        GET ADDRESS OF DATA AND SET UP ERASE/WRITE CCW                 28000000
         SPACE                                                          28800000
         LA    DATADDR,DATA(RFTREG)                                     29600000
         ST    DATADDR,IOBCPA      PUT DATA ADDR IN CCW                 30400000
         MVI   IOBCPA,EWCMD        PUT ERASE/WRITE CMD IN CCW           31200000
*                                  IN CCW                               32000000
         XC    IOBCPA+4(4),IOBCPA+4 ZERO OUT FLAGS AND COUNT            32800000
*                                  IN CCW                               33600000
         SPACE 2                                                        34400000
*        PUT CCW ADDRESS IN IOBSTART                                    35200000
         SPACE                                                          36000000
         LA    WORKREG1,IOBCPA     GET ADDR OF CHAN PGM AREA            36800000
         ST    WORKREG1,IOBSTART   STORE IN IOBSTART                    37600000
         SPACE 2                                                        38400000
*        GET ID OF NEXT MODULE AND XCTL TO IT                           39200000
         SPACE                                                          40000000
         CLI   IOBERINF+4,TWENTY8  IS IT TEST # 28 ?                    40800000
         BE    USE1306F            YES, SET UP FOR IGC1306F             41600000
         CLI   IOBERINF+4,TWENTY5  IS IT TEST # 25 ?                    42400000
         BE    USE1406F            YES, SET UP FOR IGC1406F             43200000
         BL    USE0E06F            TESTS 23&24, SET UP FOR              44000000
*                                  IGC0E06F                             44800000
         MVI   IOBERCCW+3,C'0'     TESTS 26 & 27, SET UP TO LOAD        45600000
         MVI   IOBERCCW+4,C'F'     IGC0F06F                             46400000
         B     LOADIT              GO XCTL                              47200000
USE0E06F EQU   *                                                        48000000
         MVI   IOBERCCW+3,C'0'     TESTS 23 & 24, SET UP TO LOAD        48800000
         MVI   IOBERCCW+4,C'E'     IGC0E06F                             49600000
         B     LOADIT              IGC0E06F                             50400000
USE1306F EQU   *                                                        51200000
         MVI   IOBERCCW+4,C'3'     TEST 28, SET UP TO LOAD              52000000
         B     LOADIT              IGC1306F                             52800000
USE1406F EQU   *                                                        53600000
         MVI   IOBERCCW+4,C'4'     TEST 25, LOAD IGC1406F               54400000
LOADIT   EQU   *                                                        55200000
         LA    WORKREG1,IOBERCCW   GET ADDR OF LOAD NAME                56000000
         XCTL  EPLOC=(3)                                                56800000
         SPACE 2                                                        57600000
*        REGISTER EQUATES                                               58400000
         SPACE                                                          59200000
IOBREG   EQU   1                   ADDR OF IOB                          60000000
RFTREG   EQU   2                   ADDR OF RFT MSG                      60800000
WORKREG1 EQU   3                   WORK REG                             61600000
BINXXREG EQU   4                   BINARY VALUE OF XX                   62400000
DATADDR  EQU   5                                                        63200000
BASEREG  EQU   12                  BASEREG                              64000000
         SPACE 2                                                        64800000
*        MISCELLANEOUS EQUATES                                          65600000
         SPACE                                                          66400000
DATA     EQU   10                  DISP OF DATA PAST START OF           67200000
*                                  RFT IN USER'S BUFFER                 68000000
EWCMD    EQU   X'05'               ERASE/WRITE COMMAND                  70400000
TWENTY8  EQU   X'1C'               TEST # 28                            73600000
TWENTY5  EQU   X'19'               TEST # 25                            74400000
         SPACE 2                                                        75200000
*        STORAGE                                                        76000000
         SPACE                                                          76800000
ID0E     DC    C'IGC0E06F'         ID FOR TESTS 23 & 24                 77600000
ID0F     DC    C'IGC0F06F'         ID FOR TESTS 26 & 27                 78400000
ID13     DC    C'IGC1306F'         ID FOR TEST 28                       79200000
ID14     DC    C'IGC1406F'         ID FOR TEST 25                       80000000
         SPACE 2                                                        80800000
*        DSECTS                                                         81600000
RFTMSG   DSECT                                                          82400000
         DS    0F                                                       83200000
SOHPERC  DS    CL2                                                      84000000
TESTNUMB DS    CL2                                                      84800000
PASSCNT  DS    CL2                                                      85600000
ADBYTCNT DS    CL1                                                      86400000
CUUADDR  DS    CL3                                                      87200000
         SPACE 2                                                        88000000
         IECTIOBX                                                       88800000
         END                                                            89600000
./  ADD  SSI=43460640,NAME=IGC1306F
         TITLE ' IGC1306F - 3270 LOCAL/REMOTE EBCDIC TEST MODULE '      00400002
IGC1306F CSECT                                                          00800002
*********************************************************************** 00806002
*             3270 LOCAL/REMOTE EBCDIC TEST MODULE                    * 00812002
*********************************************************************** 00818002
*                                                                     * 00824002
* STATUS:                                                             * 00830002
*                                                                     * 00842002
*        ZA02332  (11/20/74)                                          * 00844003
*                                                                     * 00846002
*********************************************************************** 00846402
*                                                                     * 00846802
* FUNCTION:                                                           * 00848002
*    THIS MODULE BUILDS PREDEFINED EBCDIC ON-LINE TEST MESSAGES       * 00854002
*    FOR THE 3270 DISPLAY SYSTEM - LOCAL OR REMOTE.                   * 00860002
*                                                                     * 00866002
* ENTRY:                                                              * 00872002
*         ENTRY IS TO THE FIRST EXECUTABLE INSTRUCTION VIA XCTL       * 00878002
*         FROM IGC0D06F(REMOTE) OR IGC1206F(LOCAL).                   * 00884002
*                                                                     * 00890002
* INPUT:                                                              * 00896002
*    REG 1 - ADDRESS OF THE IOB                                       * 00902002
*    REG 4 - TEST TYPE XX VALUE                                       * 00908002
*    IOBERINF - ADDRESS OF THE RFT                                    * 00914002
*    ON-LINE TEST CHANNEL PROGRAM IN IOB, BUILT BY IGC0D06F           * 00920002
*    (REMOTE) OR IGC1206F (LOCAL).                                    * 00926002
*                                                                     * 00932002
* OUTPUT:                                                             * 00938002
*    LOCAL--                                                          * 00944002
*                                                                     * 00950002
*    TEST MESSAGE (MINUS LINE CONTROL) BUILT IN USER'S AREA.          * 00956002
*    COUNT INSERTED IN ERASE/WRITE CCW.                               * 00962002
*    IF THE USER'S BUFFER IS NOT LONG ENOUGH (300) BYTES OR           * 00968002
*    THE TEST MESSAGE NUMBER IS INVALID, AN ERROR FLAG (IOBINCAM,     * 00974002
*    BYTE 0, BIT 6) IS TURNED ON, AND A NOP REPLACES THE ERASE/       * 00980002
*    WRITE CCW. THIS WILL CAUSE IGG019PI TO CANCEL THE TEST BY        * 00986002
*    RE-ISSUING THE USER'S READ INITIAL.                              * 00992002
*                                                                     * 00998002
*    REMOTE--                                                         * 01004002
*                                                                     * 01010002
*    TEST MESSAGE BUILT IN USER'S AREA.                               * 01016002
*    COUNT IN WRITE TEXT CCW.                                         * 01022002
*    IF AN ERROR IS FOUND, THE ERROR FLAG (SEE LOCAL) IS TURNED       * 01028002
*    ON TO CAUSE IGG019MR TO CANCEL THE TEST.                         * 01034002
*                                                                     * 01040002
*    TESTS BUILT BY THIS MODULE:                                      * 01046002
*                                                                     * 01052002
*    TEST 28 - 3270 NL/EOM PRINTER EBCDIC                               01058002
*                                                                     * 01064002
* EXTERNAL REFERENCES:                                                * 01070002
*         SVC 0 - EXECUTE CHANNEL PROGRAM                             * 01076002
*                                                                     * 01082002
* EXITS, NORMAL:                                                      * 01088002
*         SVC 3 - RETURN TO IOS                                       * 01094002
*                                                                     * 01100002
* EXITS, ERROR:                                                       * 01106002
*         NONE                                                        * 01112002
*                                                                     * 01118002
* TABLES/WORK AREAS:                                                  * 01124002
*         NONE                                                        * 01130002
*                                                                     * 01136002
* ATTRIBUTES:                                                         * 01142002
*    RE-ENTRANT                                                       * 01148002
*                                                                     * 01154002
* CHARACTER CODE DEPENDENCY:                                          * 01160002
*    NONE                                                             * 01166002
*                                                                     * 01172002
*********************************************************************** 01178002
       EJECT                                                            01184002
*/*IGC1306F: CHART*/                                                    01200002
*/* E IGC1306F*/                                                        01600002
*/* D (YES,,NO,SETERR) IS BUFFER LONG ENOUGH (300 BYTES)*/              02000002
*/* D (YES,,NO,SETERR) IS TEST NUMBER VALID (28)*/                      02400002
*/* P GET MESSAGE LENGTH AND ADDRESS*/                                  02800002
*/*TESTLCL: D (YES,LOCAL,NO,REMOTE) IS DEVICE A LOCAL 3270*/            03200002
*/*LOCAL: D (NO,,YES,ISSUENOP) IS ERROR FLAG ON*/                       03600002
*/* P POINT MESSAGE ADDRESS PAST STX, ESC, AND CMD CODE*/               04000002
*/* P STORE ADDR OF START OF RFT IN CCW*/                               04400002
*/* P (,MOVEIN) GET ADDRESS OF START OF CCW*/                           04800002
*/*REMOTE: D (NO,,YES,REMOTERR) IS ERROR FLAG ON*/                      05200002
*/* P OVERLAY TRANSPARENT CCW*/                                         05600002
*/* P GET ADDR OF CCW*/                                                 06000002
*/* P STORE ADDR OF START OF RFT IN CCW*/                               06400002
*/*MOVEIN: P (,STARTEST) MOVE MESSAGE INTO USER'S BUFFER*/              06800002
*/*SETERR: M (,TESTLCL) TURN ON ERROR FLAG*/                            07200002
*/*ISSUENOP: P SET COUNT TO ONE*/                                       07600002
*/* P (,STARTEST) MOVE NOP COMMAND INTO CCW*/                           08000002
*/*REMOTERR: P SET COUNT TO ONE*/                                       08400002
*/*STARTEST: P STORE COUNT IN CCW*/                                     08800002
*/* P SAVE THE ECB*/                                                    09200002
*/* L SVC 0*/                                                           09600002
*/* P RESTORE THE ECB*/                                                 10000002
*/* R SVC 3*/                                                           10400002
*/*IGC1306F: END*/                                                      10800002
       EJECT                                                            11000002
         SPACE 2                                                        11200002
*        ESTABLISH ADDRESSABILITY                                       11600002
         SPACE                                                          12000002
         BALR  BASEREG,0           SET UP BASE REG                      12400002
         USING *,BASEREG                                                12800002
         USING IECTIOB,IOBREG      IOB DSECT                            13200002
         USING IECTDECB,DECBREG    DECB DSECT                           13600002
         USING IHADCB,DCBREG       DCB DSECT                            14000002
         USING IECTDEB,DEBREG      DEB DSECT                            14400002
         USING UCBDSECT,UCBREG     UCB DSECT                            14800002
         B     SETUP               BRANCH AROUND ID USED TO             15200002
         DC    C'IGC1306F'         FIND MODULE IN DUMP                  15600002
         DC    C' 4322'            DATE LAST CHANGE         LD @ZA02332 15650003
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY       LD @ZA02332 15700003
         DS    0H                                           LD @ZA02332 15750003
PATCH    DC    48X'00'             PATCH AREA               LD @ZA02332 15800003
         DS    0H                                           LD @ZA02332 15850003
SETUP    EQU   *                                                        16000002
         L     DECBREG,IOBECBPT    GET DECB ADDR                        16400002
         L     DCBREG,IOBDCBPT     GET DCB ADDR                         16800002
         L     DEBREG,DCBDEBAD     GET DEB ADDR                         17200002
         L     DEBREG,28(DEBREG)   GO PAST PREFIX                       17600002
         L     RFTREG,IOBERINF     GET ADDR OF RFT                      17800002
         SPACE 2                                                        18000002
*        VALIDITY CHECK BUFFER LENGTH AND TEST NUMBER. IF               18400002
*        INVALID, SET UP NOP CCW AND TURN ON ERROR FLAG.                18800002
         SPACE                                                          19200002
         CLC   DECLNGTH(2),MINBUF  IS BUFFER LONG ENOUGH ?              19600002
         BL    SETERR              NO, SET UP FOR ERROR                 20000002
         C     TESTREG,TEST28      IS IT TEST # 28 ?                    20400002
         BNE   SETERR              NO, SET UP FOR ERROR                 20800002
         SPACE 2                                                        21200002
*        GET TEST MESSAGE ADDRESS AND LENGTH                            21600002
         SPACE                                                          22000002
GETINFO  LR    WORKREG1,TESTREG    GET TEST #                           22400002
         S     WORKREG1,TEST28     SUBTRACT 28 TO GET INDEX             22800002
*                                  (28 IS LOWEST TEST NUMBER            23200002
*                                  THIS MODULE WILL HANDLE)             23600002
         SLL   WORKREG1,2          MULTIPLY BY 4                        24000002
         L     COUNTREG,COUNTAB(WORKREG1) GET MSG LENGTH                24400002
         B     ADDRTAB(WORKREG1)   GET MSG ADDR                         24800002
         B     TESTLCL                                                  25200002
         SPACE 2                                                        25600002
*        MESSAGE ADDRESS AND LENGTH TABLES - (TEST MESSAGE              26000002
*        NUMBER - 28) X 4 = THE ARGUMENT USED TO OBTAIN VALUES          26400002
*        FROM THE TABLE.                                                26800002
         SPACE                                                          27200002
         DS    0F                                                       27600002
COUNTAB  EQU   *                   MESSAGE LENGTH IN BYTES              28000002
         DC    A(TST28SZ)          TEST 28                              28400002
         SPACE 2                                                        28800002
ADDRTAB  EQU   *                   ADDRESS OF TEST MESSAGE              29200002
         B     TEST28AD            00   GET TEST 28 ADDR                29600002
TEST28AD LA    ADDREG,IJLBOT28     GET ADDR                             30000002
         SPACE 2                                                        30400002
*        TEST FOR LOCAL OR REMOTE                                       30800002
         SPACE                                                          31200002
TESTLCL  EQU   *                                                        31600002
         SR    UCBREG,UCBREG       CLEAR REG FOR IC                     32000002
         IC    UCBREG,IOBUCBX      GET INDEX TO UCB                     32400002
         SLL   UCBREG,2            MULTIPLY BY FOUR                     32800002
         L     UCBREG,DEBUCBAD(UCBREG)  GET ADDR OF UCB                 33200002
         CLI   DVCLASS,GRAPHIC     IS DVC A GRAPHIC ?                   33600002
         BNE   REMOTE              NO, SET UP FOR REMOTE                34000002
         CLI   UNITYPE,A3277       IS DVC A 3277 ?                      34400002
         BE    LOCAL               YES, SET UP FOR LOCAL                34800002
         CLI   UNITYPE,A3284       IS DVC A 3284 ?                      35200002
         BE    LOCAL               YES, SET UP FOR LOCAL                35600002
         CLI   UNITYPE,A3286       IS DVC A 3286 ?                      36000002
         BNE   REMOTE              NO, SET UP FOR REMOTE                36400002
*        FOR LOCAL DEVICES, STRIP OFF STX, ESC, CMD CODE, AND           36800002
*        ETX OF MESSAGE                                                 37200002
         SPACE                                                          37600002
LOCAL    EQU   *                                                        38000002
          LA    CCWREG,IOBCPA       GET ADDR OF CCW                     38200002
         TM    IOBINCAM,ERFLAG     IS ERROR FLAG ON ?                   38400002
         BO    ISSUENOP            YES, GO ISSUE NOP                    38800002
         LA    WORKREG2,4          SUBTRACT 4 FROM LENGTH               39200002
         SR    COUNTREG,WORKREG2   OF MESSAGE                           39600002
         LA    ADDREG,3(ADDREG)    POINT MESSAGE ADDRESS PAST           40000002
*                                  STX, ESC, CMD CODE                   40400002
         LA    RFTREG,10(RFTREG)   ADJUST PTR PAST RFT                  41200002
         B     MOVEIN              GO SET UP MSG                        42000002
         SPACE 2                                                        42400002
*        FOR REMOTE, LEAVE MSG ADDRESS AND LENGTH ALONE                 42800002
         SPACE                                                          43200002
REMOTE   EQU   *                                                        43600002
         LA    WORKREG2,IOBCPA     GET ADDR OF IOBCPA            S99245 43650002
         ST    WORKREG2,IOBSTART   AND STORE IN IOBSTART         S99245 43700002
         LA    CCWREG,IOBCPA+40    GET ADDR OF CCW                      43800002
         TM    IOBINCAM,ERFLAG     IS ERROR FLAG ON ?                   44000002
         BO    REMOTERR            YES, ISSUE CCW                       44400002
         MVC   IOBCPA+48(8),IOBCPA+56 OVERLAY TRANS CCW                 44800002
         CLI   NVALUE(RFTREG),NOADDR   IS THIS A DIAL RFT?       S99245 44850002
         BNE   BSC3RFT             NO,FOLLOW BSC3 PROCEDURE      S99245 44900002
         LA    RFTREG,CHARS7(RFTREG)   ADJUST PTR PAST RFT       S99245 44950002
         B     MOVEIN              GO SET UP MSG                 S99245 45000002
BSC3RFT  EQU   *                                                 S99245 45050002
         LA    RFTREG,11(RFTREG)   ADJUST PTR PAST RFT                  45600002
         SPACE 2                                                        46400002
*        MOVE TEST MSG INTO USER'S BUFFER                               46800002
         SPACE                                                          47200002
MOVEIN   EQU   *                                                        47600002
         SR    WORKREG2,WORKREG2   CLEAR REG                            48400002
         C     COUNTREG,MAXLNGTH   IS MSG LNGTH OVER 256 ?              48800002
         BNH   LNGTHOK             NO, BRANCH                           49200002
         LR    WORKREG2,COUNTREG   GET EXCESS OVER 256                  49600002
         S     WORKREG2,MAXLNGTH                                        50000002
         L     COUNTREG,MAXLNGTH   SET COUNT TO 256                     50400002
LNGTHOK  EQU   *                                                        50800002
         BCTR  COUNTREG,0          SUBTRACT 1 FROM LNGTH FOR            51200002
*                                  EXECUTE                              51600002
         EX    COUNTREG,MSGMOVE    MOVE TEST MSG INTO USER'S            52000002
*                                  BUFFER                               52400002
         LTR   WORKREG2,WORKREG2   ANY MORE TO MOVE ?                   52800002
         BZ    STARTEST            NO, BRANCH                           53200002
         A     RFTREG,MAXLNGTH     BUMP ADDRESS PAST 256                53600002
         A     ADDREG,MAXLNGTH     CHARS JUST MOVED                     54000002
         BCTR  WORKREG2,0          SUBTRACT 1 FOR EXECUTE               54400002
         EX    WORKREG2,MSGMOVE    MOVE REMAINDER OF TEXT               54800002
         B     STARTEST            BRANCH AROUND EXECUTE                55200002
MSGMOVE  MVC   0(0,RFTREG),0(ADDREG) MOVE TEST MSG TO                   55600002
*                                  USER'S BUFFER, USING LENGTH          56000002
*                                  SPECIFIED IN COUNTREG                56400002
       SPACE 2                                                          56480002
*      IF AN ERROR WAS FOUND, TURN ON ERROR FLAG AND GO GET             56560002
*      ADDRESS OF CCW.                                                  56640002
       SPACE                                                            56720002
SETERR   EQU   *                                                        56800002
         OI    IOBINCAM,ERFLAG     TURN ON ERROR FLAG                   57200002
         B     TESTLCL             GO SEE IF LOCAL                      57600002
       SPACE 2                                                          57700002
*      FOR ERROR IN LOCAL, SET UP A NOP CCW                             57800002
       SPACE                                                            57900002
ISSUENOP EQU   *                                                        58000002
         LA    COUNTREG,1          SET COUNT TO ONE                     58400002
         MVI   0(CCWREG),NOP       MOVE IN NOP COMMAND                  58800002
         B     STARTEST            GO ISSUE NOP                         59200002
       SPACE 2                                                          59300002
*      FOR REMOTE ERROR, SET COUNT IN WRITE TEXT CCW TO ONE             59400002
       SPACE                                                            59500002
REMOTERR EQU   *                                                        59600002
         LA    COUNTREG,1          SET COUNT TO ONE                     60000002
         B     STARTEST            DO TEST                              60400002
         SPACE 2                                                        60800002
*        MOVE COUNT INTO CCW AND START TEST                             61200002
         SPACE                                                          61600002
STARTEST EQU   *                                                        62000002
         LA    COUNTREG,1(COUNTREG) RESTORE COUNT AFTER EX              62400002
         STH   COUNTREG,6(CCWREG)  STORE COUNT IN CCW                   62800002
*                                                                       62850002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 62900003
*                                                                       62950002
         LR    WORKREG1,IOBREG     SAVE IOB ADDR            LD @ZA02332 63000003
         L     PARMREG,GETPARM     SET UP FOR GETMAIN       LD @ZA02332 63050003
         GETMAIN R,LV=(0)          GETMAIN FOR ECB          LD @ZA02332 63100003
         LR    WORKREG2,IOBREG     SAVE ECB ADDR            LD @ZA02332 63150003
         ST    DECBREG,DISP4(WORKREG2)  SAVE DECB ADDR      LD @ZA02332 63200003
         MVI   DISP4(WORKREG2),FOXFOX   FLAG AS DUMMY ECB   LD @ZA02332 63250003
         LR    IOBREG,WORKREG1     RESTORE IOB REG          LD @ZA02332 63300003
         STCM  WORKREG2,MASK,IOBECBPT+DISP1  POINT IOB...   LD @ZA02332 63350003
*                                  ...TO DUMMY              LD @ZA02332 63400003
         SVC   0                   DO TEST                              63600002
*                                                                       63650002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 63700003
*                                                                       63750002
         STCM  DECBREG,MASK,IOBECBPT+DISP1  REPOINT IOB...  LD @ZA02332 63800003
*                                  ...TO DECB               LD @ZA02332 63850003
         L     PARMREG,GETPARM     SET UP FOR FREEMAIN      LD @ZA02332 63900003
         FREEMAIN R,LV=(0),A=(WORKREG2)  FREE DUMMY ECB     LD @ZA02332 63950003
         SVC   3                   RETURN                               64400002
         SPACE 2                                                        64800002
         SPACE                                                          66000002
         SPACE 2                                                        66400002
*        REGISTER EQUATES                                               66800002
         SPACE                                                          67200002
PARMREG  EQU   0                   PARAMETER REGISTER       LD @ZA02332 67250003
IOBREG   EQU   1                   ADDR OF IOB                          67600002
DECBREG  EQU   2                   ADDR OF DECB                         68000002
DCBREG   EQU   3                   ADDR OF DCB                          68400002
TESTREG  EQU   4                   TEST #                               68800002
WORKREG1 EQU   5                   WORK REG                             69200002
WORKREG2 EQU   6                   WORK REG                             69600002
DEBREG   EQU   7                   ADDR OF DEB                          70000002
UCBREG   EQU   8                   ADDR OF UCB                          70400002
ADDREG   EQU   9                   TEST MSG ADDRESS                     70800002
COUNTREG EQU   10                  TEST MSG LENGTH                      71200002
CCWREG   EQU   11                  ADDR OF CCW TO WRITE TEST MSG        71600002
BASEREG  EQU   12                                                       72000002
RFTREG   EQU   13                  ADDR OF RFT                          72400002
         SPACE 2                                                        72800002
*        MISCELLANEOUS EQUATES                                          73200002
         SPACE                                                          73600002
A3286    EQU   X'0B'               3286 DEVICE TYPE                     74000002
A3284    EQU   X'0A'               3284 DEVICE TYPE                     74400002
A3277    EQU   X'09'               3277 DEVICE TYPE                     74800002
GRAPHIC  EQU   X'10'               GRAPHICS DEVICE TYPE                 75200002
NOP      EQU   X'03'               NOP COMMAND CODE                     75600002
ERFLAG   EQU   X'02'               ERROR FLAG                           76000002
NVALUE   EQU   6                   DISP INTO RFT OF N VALUE      S99245 76050002
NOADDR   EQU   X'00'               IF N=0, IT IS A DIAL RFT      S99245 76100002
CHARS7   EQU   7                   LENGTH OF STANDARD DIAL RFT   S99245 76150002
FOXFOX   EQU   X'FF'               BYTE OF ALL ONES         LD @ZA02332 76200003
MASK     EQU   7                   MASK FOR STCM            LD @ZA02332 76250003
DISP1    EQU   1                   DISPLACEMENT             LD @ZA02332 76300003
DISP4    EQU   4                   DISPLACEMENT             LD @ZA02332 76350003
         SPACE 2                                                        76400002
*        STORAGE                                                        76800002
         SPACE                                                          77200002
         DS    0H                                           LD @ZA02332 77260000
GETPARM  DC    X'FA000008'         SUBPOOL # AND LENGTH     LD @ZA02332 77300003
MINBUF   DC    X'012C'             MINIMUM BUFFER LENGTH                77600002
TEST28   DC    F'28'               ACCEPTABLE TEST NUMBER               78000002
MAXLNGTH DC    F'256'              MAX # OF CHARS FOR MVC               78400002
IJLBOT28 EQU   *                                                        78800002
         DC    X'0227F5'           STX-ESC-EWRT                         79200002
         DC    X'4F'               WCC- RSTRE KYBRD/SND ALRM/STRT PRNT  79600002
         DC    C'NEW LINE FUNCTION CHECK'                   DS LINE 1   80000002
         DC    X'15'               NEW LINE                             80400002
         DC    C'NEW LINE FUNCTION'                         DS LINE 2   80800002
         DC    X'15'               NEW LINE                             81200002
         DC    C'NEW LINE'                                  DS LINE 3   81600002
         DC    X'15'               NEW LINE                             82000002
         DC    C'NEW'                                       DS LINE 4   82400002
         DC    X'15'               NEW LINE                             82800002
         DC    C'NEW LINE'                                  DS LINE 5   83200002
         DC    X'15'               NEW LINE                             83600002
         DC    C'NEW LINE FUNCTION'                         DS LINE 6   84000002
         DC    X'15'               NEW LINE                             84400002
         DC    C'NEW LINE FUNCTION CHECK'                   DS LINE 7   84800002
         DC    X'15'               NEW LINE                             85200002
         DC    X'1D4C'             NON DISPLAY,NON PRINT,NON DETECTABLE 85600002
         DC    C'THIS DATA NOT VISIBLE/EOM AND N/L IGNORED'             86000002
         DC    X'1519'             NEW LINE EOM (IGNORED)               86400002
        DC    X'1D40'             SF/NORMAL INT/ UNPROTECTED            86800002
         DC    C'END-OF-MESSAGE-TERMINATES PRINT'                       87200002
         DC    X'19'               END OF MESSAGE                       87600002
         DC    X'15'               NEW LINE                 DS LINE 8   88000002
         DC    C'2ND EOM LINE NOT ON PRINTER OUTPUT'                    88400002
         DC    X'19'               END OF MESSAGE                       88800002
         DC    X'03'               ETX                                  89200002
TST28SZ  EQU   *-IJLBOT28          LENGTH OF TEST 28                    89400002
         SPACE 2                                                        89600002
*        DSECTS                                                         90000002
         SPACE                                                          90400002
         IECTIOBX                                                       90800002
         EJECT                                                          91200002
         IECTDECB                                                       91600002
         EJECT                                                          92000002
         DCBD  DSORG=BX,DEVD=BS                                         92400002
         EJECT                                                          92800002
         IECTDEBX                                                       93200002
UCBDSECT DSECT                                                          93600002
         DS    0F                                                       94000002
         ORG   UCBDSECT+13                                              94400002
CHARADDR DS    CL3                 UNIT ADDR (EBCDIC)                   94800002
         ORG   UCBDSECT+18                                              95200002
DVCLASS  DS    CL1                 DEVICE CLASS                         95600002
UNITYPE  DS    CL1                 UNIT TYPE                            96000002
         ORG   UCBDSECT+36                                              96400002
RLN      DS    CL1                 RELATIVE LINE NUMBER                 96800002
         END                                                            97200002
./  ADD  SSI=72780438,NAME=IGC1406F
         TITLE ' IGC1406F - 3270 LOCAL/REMOTE EBCDIC TEST MODULE '      00300002
IGC1406F CSECT                                                          00600002
*                                                                     * 00650002
*********************************************************************** 00700002
*                                                                     * 00750002
*        MAINTENANCE ACTIVITY                                         * 00800002
*                                                                     * 00850002
*        ZA02332  (11/20/74)                                          * 00860003
*        ZA03972  (04/24/75)                                          * 00865000
*        ZA26729  (10/03/77)                                          * 00866000
*                                                                     * 00870002
*********************************************************************** 00880002
         EJECT                                                          00892002
*/*IGC1406F: CHART*/                                                    00900002
*/* E IGC1406F*/                                                        01200002
*/* D (YES,,NO,SETERR) IS BUFFER LONG ENOUGH (300 BYTES)*/              01500002
*/* D (YES,,NO,SETERR) IS TEST NUMBER VALID (25)*/                      01800002
*/* P GET MESSAGE LENGTH AND ADDRESS*/                                  02100002
*/*TESTLCL: D (YES,LOCAL,NO,REMOTE) IS DEVICE A LOCAL 3270*/            02400002
*/*TESTLCL: D (NO,,YES,TSTLCONT) IS DVC 3277 AND MODEL2*/               02430000
*/*M SET ON IOB ERROR FLAG FOR A 3277 THAT IS NOT A MODEL2*/            02470000
*/*TSTLCONT: D (YES,LOCAL,NO,REMOTE) IS DEVICE A LOCAL 3270*/           02540000
*/*LOCAL: D (NO,,YES,ISSUENOP) IS ERROR FLAG ON*/                       02700002
*/* P POINT MESSAGE ADDRESS PAST STX, ESC, AND CMD CODE*/               03000002
*/* P STORE ADDR OF START OF RFT IN CCW*/                               03300002
*/* P (,MOVEIN) GET ADDRESS OF START OF CCW*/                           03600002
*/*REMOTE: D (NO,,YES,REMOTERR) IS ERROR FLAG ON*/                      03900002
*/* P OVERLAY TRANSPARENT CCW*/                                         04200002
*/* P GET ADDR OF CCW*/                                                 04500002
*/* P STORE ADDR OF START OF RFT IN CCW*/                               04800002
*/*MOVEIN: P (,STARTEST) MOVE MESSAGE INTO USER'S BUFFER*/              05100002
*/*SETERR: M (,TESTLCL) TURN ON ERROR FLAG*/                            05400002
*/*ISSUENOP: P SET COUNT TO ONE*/                                       05700002
*/* P (,STARTEST) MOVE NOP COMMAND INTO CCW*/                           06000002
*/*REMOTERR: P SET COUNT TO ONE*/                                       06300002
*/*STARTEST: P STORE COUNT IN CCW*/                                     06600002
*/* P SAVE THE ECB*/                                                    06900002
*/* L SVC 0*/                                                           07200002
*/* P RESTORE THE ECB*/                                                 07500002
*/* R SVC 3*/                                                           07800002
*/*IGC1406F: END*/                                                      08100002
         SPACE 2                                                        08400002
*        ESTABLISH ADDRESSABILITY                                       08700002
         SPACE                                                          09000002
         BALR  BASEREG,0           SET UP BASE REG                      09300002
         USING *,BASEREG                                                09600002
         USING IECTIOB,IOBREG      IOB DSECT                            09900002
         USING IECTDECB,DECBREG    DECB DSECT                           10200002
         USING IHADCB,DCBREG       DCB DSECT                            10500002
         USING IECTDEB,DEBREG      DEB DSECT                            10800002
         USING UCBDSECT,UCBREG     UCB DSECT                            11100002
         B     SETUP               BRANCH AROUND ID USED TO             11400002
         DC    C'IGC1406F'         FIND MODULE IN DUMP                  11700002
         DC    XL3'014779'         PTF NUMBER                           11750000
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY       LD @ZA02332 11800003
         DS    0H                                           LD @ZA02332 11850003
PATCH    DC    48X'00'             PATCH AREA               LD @ZA02332 11900003
         DS    0H                                           LD @ZA02332 11950003
SETUP    EQU   *                                                        12000002
         L     DECBREG,IOBECBPT    GET DECB ADDR                        12300002
         L     DCBREG,IOBDCBPT     GET DCB ADDR                         12600002
         L     DEBREG,DCBDEBAD     GET DEB ADDR                         12900002
         L     DEBREG,28(DEBREG)   GO PAST PREFIX                       13200002
         L     RFTREG,IOBERINF     GET ADDR OF RFT                      13300002
         SPACE 2                                                        13500002
*        VALIDITY CHECK BUFFER LENGTH AND TEST NUMBER. IF               13800002
*        INVALID, SET UP NOP CCW AND TURN ON ERROR FLAG.                14100002
         SPACE                                                          14400002
         CLC   DECLNGTH(2),MINBUF  IS BUFFER LONG ENOUGH ?              14700002
         BL    SETERR              NO, SET UP FOR ERROR                 15000002
         C     TESTREG,TEST25      IS IT TEST # 25 ?                    15300002
         BNE   SETERR              NO, SET UP FOR ERROR                 15600002
         SPACE 2                                                        15900002
*        GET TEST MESSAGE ADDRESS AND LENGTH                            16200002
         SPACE                                                          16500002
GETINFO  LR    WORKREG1,TESTREG    GET TEST #                           16800002
         S     WORKREG1,TEST25     SUBTRACT 25 TO GET INDEX             17100002
*                                  (25 IS LOWEST TEST NUMBER            17400002
*                                  THIS MODULE WILL HANDLE)             17700002
         SLL   WORKREG1,2          MULTIPLY BY 4                        18000002
         L     COUNTREG,COUNTAB(WORKREG1) GET MSG LENGTH                18300002
         B     ADDRTAB(WORKREG1)   GET MSG ADDR                         18600002
         SPACE 2                                                        18900002
*        MESSAGE ADDRESS AND LENGTH TABLES - (TEST MESSAGE              19200002
*        NUMBER - 25) X 4 = THE ARGUMENT USED TO OBTAIN VALUES          19500002
*        FROM THE TABLE.                                                19800002
         SPACE                                                          20100002
         DS    0F                                                       20400002
COUNTAB  EQU   *                   MESSAGE LENGTH IN BYTES              20700002
         DC    A(TST25SZ)          TEST 25                              21000002
         SPACE 2                                                        21300002
ADDRTAB  EQU   *                   ADDRESS OF TEST MESSAGE              21600002
         B     TEST25AD            00   GET TEST 25 ADDR                21900002
TEST25AD LA    ADDREG,IJLBOT25     GET ADDR                             22200002
         SPACE 2                                                        22500002
*        TEST FOR LOCAL OR REMOTE                                       22800002
         SPACE                                                          23100002
TESTLCL  EQU   *                                                        23400002
         SR    UCBREG,UCBREG       CLEAR REG FOR IC                     23700002
         IC    UCBREG,IOBUCBX      GET INDEX TO UCB                     24000002
         SLL   UCBREG,2            MULTIPLY BY FOUR                     24300002
         L     UCBREG,DEBUCBAD(UCBREG)  GET ADDR OF UCB                 24600002
         CLI   UNITYPE,A3277           IS DEVICE A 3277        @ZA03972 24640000
         BNE   TSTLCONT        NO, BRANCH TO CONTINUE TEST     @ZA03972 24680000
         TM    MODTYPE,MOD2        IS 3277 A MODEL2            @ZA03972 24720000
         BO    TSTLCONT        YES, BRANCH TO CONTINUE         @ZA03972 24760000
         OI    IOBINCAM,ERFLAG SET ON ERROR FLAG FOR OTHER MOD @ZA03972 24800000
TSTLCONT EQU   *                TEST LOCAL CONTINUE            @ZA03972 24840000
         CLI   DVCLASS,GRAPHIC     IS DVC A GRAPHIC ?                   24900002
         BNE   REMOTE              NO, SET UP FOR REMOTE                25200002
         CLI   UNITYPE,A3277       IS DVC A 3277 ?                      25500002
         BE    LOCAL               YES, SET UP FOR LOCAL                25800002
         CLI   UNITYPE,A3284       IS DVC A 3284 ?                      26100002
         BE    LOCAL               YES, SET UP FOR LOCAL                26400002
         CLI   UNITYPE,A3286       IS DVC A 3286 ?                      26700002
         BNE   REMOTE              NO, SET UP FOR REMOTE                27000002
*        FOR LOCAL DEVICES, STRIP OFF STX, ESC, CMD CODE, AND           27300002
*        ETX OF MESSAGE                                                 27600002
         SPACE                                                          27900002
LOCAL    EQU   *                                                        28200002
         LA    CCWREG,IOBCPA       GET ADDR OF CCW                      28300002
         TM    IOBINCAM,ERFLAG     IS ERROR FLAG ON ?                   28500002
         BO    ISSUENOP            YES, GO ISSUE NOP                    28800002
         LA    WORKREG2,4          SUBTRACT 4 FROM LENGTH               29100002
         SR    COUNTREG,WORKREG2   OF MESSAGE                           29400002
         LA    ADDREG,3(ADDREG)    POINT MESSAGE ADDRESS PAST           29700002
*                                  STX, ESC, CMD CODE                   30000002
         LA    RFTREG,10(RFTREG)   ADJUST PTR PAST RFT                  30900002
         B     MOVEIN              GO SET UP MSG                        31200002
         SPACE 2                                                        31500002
*        FOR REMOTE, LEAVE MSG ADDRESS AND LENGTH ALONE                 31800002
         SPACE                                                          32100002
REMOTE   EQU   *                                                        32400002
         LA    WORKREG2,IOBCPA     GET ADDR OF IOBCPA            S99245 32450002
         ST    WORKREG2,IOBSTART   AND STORE IN IOBSTART         S99245 32460002
         LA    CCWREG,IOBCPA+40    GET ADDR OF CCW                      32500002
         TM    IOBINCAM,ERFLAG     IS ERROR FLAG ON ?                   32700002
         BO    REMOTERR            YES, ISSUE CCW                       33000002
         MVC   IOBCPA+48(8),IOBCPA+56 OVERLAY TRANS CCW                 33300002
         CLI   NVALUE(RFTREG),NOADDR   IS THIS A DIAL RFT?       S99245 33350002
         BNE   BSC3RFT             NO,FOLLOW BSC3 PROCEDURE      S99245 33400002
         LA    RFTREG,CHARS7(RFTREG)   ADJUST PTR PAST RFT       S99245 33450002
         B     MOVEIN              GO SET UP MSG                 S99245 33500002
BSC3RFT  EQU   *                                                 S99245 33550002
         LA    RFTREG,11(RFTREG)   ADJUST PTR PAST RFT                  33600002
         SPACE 2                                                        34500002
*        MOVE TEST MSG INTO USER'S BUFFER                               34800002
         SPACE                                                          35100002
MOVEIN   EQU   *                                                        35400002
         SR    WORKREG2,WORKREG2   CLEAR REG                            36000002
         C     COUNTREG,MAXLNGTH   IS MSG LNGTH OVER 256 ?              36300002
         BNH   LNGTHOK             NO, BRANCH                           36600002
         LR    WORKREG2,COUNTREG   GET EXCESS OVER 256                  36900002
         S     WORKREG2,MAXLNGTH                                        37200002
         L     COUNTREG,MAXLNGTH   SET COUNT TO 256                     37500002
LNGTHOK  EQU   *                                                        37800002
         BCTR  COUNTREG,0          SUBTRACT 1 FROM LNGTH FOR            38100002
*                                  EXECUTE                              38400002
         EX    COUNTREG,MSGMOVE    MOVE TEST MSG INTO USER'S            38700002
*                                  BUFFER                               39000002
         LTR   WORKREG2,WORKREG2   ANY MORE TO MOVE ?                   39300002
         BZ    STARTEST            NO, BRANCH                           39600002
         A     RFTREG,MAXLNGTH     BUMP ADDRESS PAST 256                39900002
         A     ADDREG,MAXLNGTH     CHARS JUST MOVED                     40200002
         BCTR  WORKREG2,0          SUBTRACT 1 FOR EXECUTE               40500002
         EX    WORKREG2,MSGMOVE    MOVE REMAINDER OF TEXT               40800002
         B     STARTEST            BRANCH AROUND EXECUTE                41100002
MSGMOVE  MVC   0(0,RFTREG),0(ADDREG) MOVE TEST MSG TO                   41400002
*                                  USER'S BUFFER, USING LENGTH          41700002
*                                  SPECIFIED IN COUNTREG                42000002
SETERR   EQU   *                                                        42300002
         OI    IOBINCAM,ERFLAG     TURN ON ERROR FLAG                   42600002
         B     TESTLCL             GO SEE IF LOCAL                      42900002
ISSUENOP EQU   *                                                        43200002
         LA    COUNTREG,1          SET COUNT TO ONE                     43500002
         MVI   0(CCWREG),NOP       MOVE IN NOP COMMAND                  43800002
         B     STARTEST            GO ISSUE NOP                         44100002
REMOTERR EQU   *                                                        44400002
         LA    COUNTREG,1          SET COUNT TO ONE                     44700002
         B     STARTEST            DO TEST                              45000002
         SPACE 2                                                        45300002
*        MOVE COUNT INTO CCW AND START TEST                             45600002
         SPACE                                                          45900002
STARTEST EQU   *                                                        46200002
         LA    COUNTREG,1(COUNTREG) RESTORE COUNT AFTER EX              46500002
         STH   COUNTREG,6(CCWREG)  STORE COUNT IN CCW                   46800002
*                                                                       46850002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 46900003
*                                                                       46950002
         LR    WORKREG1,IOBREG     SAVE IOB ADDR            LD @ZA02332 47000003
         L     PARMREG,GETPARM     SET UP FOR GETMAIN       LD @ZA02332 47050003
         GETMAIN R,LV=(0)          GETMAIN FOR ECB          LD @ZA02332 47100003
         LR    WORKREG2,IOBREG     SAVE ECB ADDR            LD @ZA02332 47150003
         ST    DECBREG,DISP4(WORKREG2)  SAVE DECB ADDR      LD @ZA02332 47200003
         MVI   DISP4(WORKREG2),FOXFOX   FLAG AS DUMMY ECB   LD @ZA02332 47250003
         LR    IOBREG,WORKREG1     RESTORE IOB REG          LD @ZA02332 47300003
         STCM  WORKREG2,MASK,IOBECBPT+DISP1  POINT IOB...   LD @ZA02332 47350003
*                                  ...TO DUMMY              LD @ZA02332 47360003
         SVC   0                   DO TEST                              47400002
*                                                                       47450002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 47500003
*                                                                       47550002
         STCM  DECBREG,MASK,IOBECBPT+DISP1  REPOINT IOB...  LD @ZA02332 47600003
*                                  ...TO DECB               LD @ZA02332 47650003
         L     PARMREG,GETPARM     SET UP FOR FREEMAIN      LD @ZA02332 47700003
         FREEMAIN R,LV=(0),A=(WORKREG2)  FREE DUMMY ECB     LD @ZA02332 47750003
         SVC   3                   RETURN                               48000002
         SPACE 2                                                        48300002
*        IF AN ERROR WAS FOUND, TURN ON ERROR FLAG, GET CCW             48600002
*        ADDR, AND ISSUE NOP CCW                                        48900002
         SPACE                                                          49200002
         SPACE 2                                                        49500002
*        REGISTER EQUATES                                               49800002
         SPACE                                                          50100002
PARMREG  EQU   0                   PARAMETER REGISTER       LD @ZA02332 50150003
IOBREG   EQU   1                   ADDR OF IOB                          50400002
DECBREG  EQU   2                   ADDR OF DECB                         50700002
DCBREG   EQU   3                   ADDR OF DCB                          51000002
TESTREG  EQU   4                   TEST # 4                             51300002
WORKREG1 EQU   5                   WORK REG                             51600002
WORKREG2 EQU   6                   WORK REG                             51900002
DEBREG   EQU   7                   ADDR OF DEB                          52200002
UCBREG   EQU   8                   ADDR OF UCB                          52500002
ADDREG   EQU   9                   TEST MSG ADDRESS                     52800002
COUNTREG EQU   10                  TEST MSG LENGTH                      53100002
CCWREG   EQU   11                  ADDR OF CCW TO WRITE TEST MSG        53400002
BASEREG  EQU   12                                                       53700002
RFTREG   EQU   13                  ADDR OF RFT                          54000002
         SPACE 2                                                        54300002
*        MISCELLANEOUS EQUATES                                          54600002
         SPACE                                                          54900002
A3286    EQU   X'0B'               3286 DEVICE TYPE                     55200002
A3284    EQU   X'0A'               3284 DEVICE TYPE                     55500002
A3277    EQU   X'09'               3277 DEVICE TYPE                     55800002
MOD2     EQU   X'12'               MODEL2 3277                 @ZA03972 55850000
GRAPHIC  EQU   X'10'               GRAPHICS DEVICE TYPE                 56100002
NOP      EQU   X'03'               NOP COMMAND CODE                     56400002
ERFLAG   EQU   X'02'               ERROR FLAG                           56700002
NVALUE   EQU   6                   DISP INTO RFT OF N VALUE      S99245 56750002
NOADDR   EQU   X'00'               IF N=0, IT IS DIAL RFT        S99245 56800002
CHARS7   EQU   7                   LENGTH OF STANDARD DIAL RFT   S99245 56850002
FOXFOX   EQU   X'FF'               BYTE OF ALL ONES         LD @ZA02332 56900003
MASK     EQU   7                   MASK FOR STCM            LD @ZA02332 56950003
DISP1    EQU   1                   DISPLACEMENT             LD @ZA02332 56960003
DISP4    EQU   4                   DISPLACEMENT             LD @ZA02332 56970003
         SPACE 2                                                        57000002
*        STORAGE                                                        57300002
         SPACE                                                          57600002
         DS    0F                  FULLWORD BOUNDARY        LD @ZA02332 57650003
GETPARM  DC    X'FA000008'         SUBPOOL # AND LENGTH     LD @ZA02332 57700003
MINBUF   DC    X'012C'             MINIMUM BUFFER LENGTH                57900002
TEST25   DC    F'25'               ACCEPTABLE TEST NUMBER               58200002
MAXLNGTH DC    F'256'              MAX # OF CHARS FOR MVC               58500002
IJLBOT25 EQU   *                                                        58800002
         DC    X'0227F5'           STX-ESC-EWRT                         59100002
         DC    X'7F'               WCC-SOUND ALARM/RESTORE KEYBOARD/    59400002
*                                      START PRINT/80 CHARS PER LINE    59700002
         DC    X'3CC150'           REPEAT TO ADDR                       60000002
         DC    C'E'                80 E CHARACTERS                      60300002
         DC    C'H'                CHAR 81=H                            60600002
         DC    X'11C25F'           SBA 159                              60900002
         DC    C'HH'                                                    61200002
         DC    X'11C36F'           SBA 239                              61500002
         DC    C'HH'                                                    61800002
         DC    X'11C47F'           SBA 319                              62100002
         DC    C'HH'                                                    62400002
         DC    X'11C64F'           SBA 399                              62700002
         DC    C'HH'                                                    63000002
         DC    X'11C75F'           SBA 479                     @ZA26729 63300000
         DC    C'HH'                                                    63600002
         DC    X'11C7E5'           SBA   485                            63900002
         DC    C'TEST PATTERN FOR 3275-2/3277-2'                        64200002
         DC    X'11C86F'           SBA 559                              64500002
         DC    C'HH'                                                    64800002
         DC    X'11C87E'           SBA 574                              65100002
         DC    C'ALIGNMENT'                                             65400002
         DC    X'11C97F'           SBA 639                              65700002
         DC    C'HH'                                                    66000002
         DC    X'114B4F'           SBA 719                              66300002
         DC    C'HH'                                                    66600002
         DC    X'114C5F'           SBA 799                              66900002
         DC    C'HH'                                                    67200002
         DC    X'114CE7'           SBA 807                              67500002
         DC    C'*'                ASTERISK                             67800002
         DC    X'1D40'             UNPROTECTED,NORMAL INTENSITY         68100002
         DC    X'13'               INSERT CURSOR                        68400002
         DC    C'UNPROTECTED AREA    '                                  68700002
         DC    X'1D60'             PROTECTED,NORMAL INTENSITY           69000002
         DC    C'*'                                                     69300002
         DC    X'114D6F'           SBA 879                              69600002
         DC    C'HH'                                                    69900002
         DC    X'114ED7'           SBA 919                              70200002
         DC    C'OO'               TWO LETTER O'S                       70500002
         DC    X'114E7F'           SBA 959                              70800002
         DC    C'HH'                                                    71100002
         DC    X'114FE7'           SBA 999                              71400002
         DC    C'OO'               TWO LETTER O'S                       71700002
         DC    X'11504F'           SBA 1039                             72000002
         DC    C'HH'                                                    72300002
         DC    X'11D15F'           SBA 1119                             72600002
         DC    C'HH'                                                    72900002
         DC    X'11D26F'           SBA 1199                             73200002
         DC    C'HH'                                                    73500002
         DC    X'11D37F'           SBA 1279                             73800002
         DC    C'HH'                                                    74100002
         DC    X'11D54F'           SBA 1359                             74400002
         DC    C'HH'                                                    74700002
         DC    X'11D65F'           SBA 1439                             75000002
         DC    C'HH'                                                    75300002
         DC    X'11D76F'           SBA 1519                             75600002
         DC    C'HH'                                                    75900002
         DC    X'11D87F'           SBA 1599                             76200002
         DC    C'HH'                                                    76500002
         DC    X'115A4F'           SBA 1679                             76800002
         DC    C'HH'                                                    77100002
         DC    X'115B5F'           SBA 1759                             77400002
         DC    C'HH'                                                    77700002
         DC    X'115C6F'           SBA 1839                             78000002
         DC    C'H'                                                     78300002
         DC    X'3C4040'           LAST LINE = 80                       78600002
         DC    C'E'                CHARS OF E'S                         78900002
         DC    X'03'               ETX                                  79200002
TST25SZ  EQU   *-IJLBOT25          LENGTH OF TEST 25                    79300002
         SPACE 2                                                        79500002
*        DSECTS                                                         79800002
         SPACE                                                          80100002
         IECTIOBX                                                       80400002
         EJECT                                                          80700002
         IECTDECB                                                       81000002
         EJECT                                                          81300002
         DCBD  DSORG=BX,DEVD=BS                                         81600002
         EJECT                                                          81900002
         IECTDEBX                                                       82200002
UCBDSECT DSECT                                                          82500002
         DS    0F                                                       82800002
         ORG   UCBDSECT+13                                              83100002
CHARADDR DS    CL3                 UNIT ADDR (EBCDIC)                   83400002
MODTYPE  DS    CL1                 MODEL TYPE                  @ZA03972 83450000
         ORG   UCBDSECT+18                                              83700002
DVCLASS  DS    CL1                 DEVICE CLASS                         84000002
UNITYPE  DS    CL1                 UNIT TYPE                            84300002
         ORG   UCBDSECT+36                                              84600002
RLN      DS    CL1                 RELATIVE LINE NUMBER                 84900002
         END                                                            85200002
./  ADD  SSI=62590025,NAME=IGE0004A
         TITLE 'IGE0004A - BTAM ERP CONTROL MODULE'                     00200002
IGE0004A CSECT                                                          00250002
*********************************************************************** 00300002
*                                                                     * 00350002
* MODULE NAME:                                                        * 00400002
*    IGE0004A                                                         * 00450002
*                                                                     * 00500002
* DESCRIPTIVE NAME:                                                   * 00550002
*    BTAM ERROR RECOVERY CONTROL PROCEDURE                            * 00600002
*                                                                     * 00650002
* COPYRIGHT:                                                          * 00700002
*    NONE                                                             * 00750002
*                                                                     * 00800002
* STATUS:                                                             * 00850002
*    CHANGE LEVEL 001                                                 * 00900002
*                                                                     * 00950002
* FUNCTION:                                                           * 01000002
*    1. PROVIDES LINKAGE TO SUBSEQUENT LOADS OF EITHER BTAM           * 01050002
*       ACCESS METHODS ERROR ROUTINES                                 * 01100002
*    2. DETERMINES IF ENTRY IS DUE TO INITIAL ERROR OR AS             * 01150002
*       A RESULT OF ERROR ROUTINE CHANNEL PROGRAM EXECUTION           * 01200002
*    3. DETERMINES TYPE OF INITIAL ERROR ENCOUNTERED AND              * 01250002
*       LINKS TO PROPER ROUTINE VIA CVT XCTL ROUTINE                  * 01300002
*    4. GENERATES RETURN LINKAGE TO SUBSEQUENT LOADS OF               * 01350002
*       ERROR ROUTINES WHEN REQUIRED DUE TO ERROR ROUTINE             * 01400002
*       CHANNEL PROGRAM EXECUTION                                     * 01450002
*                                                                     * 01500002
* NOTES:                                                              * 01550002
*    DEPENDENCIES:                                                    * 01600002
*        NONE                                                         * 01650002
*    RESTRICTIONS:                                                    * 01700002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01750002
*    REGISTER CONVENTIONS:                                            * 01800002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01850002
*                                                                     * 01900002
* PATCHLABEL:                                                         * 01950002
*    PACHAREA (68 BYTES)                                              * 02000002
*                                                                     * 02050002
* MODULE TYPE:                                                        * 02100002
*    PROCEDURE                                                        * 02150002
*    PROCESSOR:                                                       * 02200002
*        BAL                                                          * 02250002
*    ATTRIBUTES:                                                      * 02400002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, LOCK HELD       * 02450000
*        WHEN GOING TO TRANSLATOR.                                    * 02470000
*                                                                     * 02500002
* ENTRY POINT:                                                        * 02550002
*    IGE0004A                                                         * 02600002
*    PURPOSE:                                                         * 02650002
*        SEE 'FUNCTION'                                               * 02700002
*    LINKAGE:                                                         * 02750002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02800002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02850002
*    INPUT:                                                           * 02900002
*        REG 1 = ADDRESS OF IOSB                                      * 02950002
*    OUTPUT:                                                          * 03000002
*        NONE FOR THIS MODULE                                         * 03050002
*                                                                     * 03100002
* EXITS-NORMAL:                                                       * 03150002
*    STATISTICS UPDATE ROUTINE (IGE0025D) VIA BRANCH ENTRY TO XCTL    * 03200002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03250002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03300002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03350002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03400002
*        LOADS ARE 1000 GREATER.                                      * 03450002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03500002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03550002
*                                                                     * 03600002
* EXITS-ERROR:                                                        * 03650002
*    NONE                                                             * 03700002
*                                                                     * 03750002
* EXTERNAL REFERENCES:                                                * 03800002
*    ROUTINES:                                                        * 03850002
*        IECVTCCW (IOS CCW TRANSLATOR)                                * 03900002
*        IOS INTERPRETOR                                              * 03950002
*        IECVIOPM                                                     * 03970000
*    DATA AREAS                                                       * 04000002
*        IOB (MAPPED BY IEZIOB)                                       * 04050002
*        VIRTUAL CHANNEL PROGRAM                                      * 04100002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04150002
*    CONTROL BLOCKS                                                   * 04200002
*        UCB                                                          * 04250002
*        DCB                                                          * 04300002
*        DECB                                                         * 04350002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04400002
*        CVT          (MAPPED BY CVT)                                 * 04450002
*        IOB          (MAPPED BY IEZIOB)                              * 04500002
*        RQE          (MAPPED BY IECDRQE)                             * 04550002
*        TCCW         (MAPPED BY IECDTCCW)                            * 04600002
*        IOCOM        (MAPPED BY IECDIOCM)                            * 04650002
*                                                                     * 04700002
* TABLES-WORKAREAS:                                                   * 04750002
*    ERP WORKAREA                                                     * 04800002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04850002
*                                                                     * 04900002
* NOTES:                                                              * 04907000
*    IOBERRCT+1 DETERMINES THE TYPE OF EXIT TO BE PERFORMED           * 04914000
*    IOBERRCT+1=00    NORMAL EXIT DETERMINED BY ERROR CONDITION FOUND * 04921000
*    IOBERRCT+1=01    INTERVENTION REQUIRED RETURN                    * 04928000
*    IOBERRCT+1=0F    SPECIAL ENTRY FOR LOAD 2                        * 04935000
*                                                                     * 04942000
* MACROS:                                                             * 04950002
*    NONE                                                             * 05000002
*                                                                     * 05050002
* CHANGE ACTIVITY:                                                    * 05100002
*    YA01230  (IN BASE)                                               * 05110002
*    YM02568K (8/6/73)                                                * 05150002
*    YM02595K (9/20/73)                                               * 05200002
*    YM02594K (9/24/73)                                               * 05250002
*    YA02441  (11/1/73)                                               * 05260002
*    YA02452  (11/1/73)                                               * 05270002
*    YM05652K (1/25/74)                                               * 05280002
*    YM08278 (4/9/74)                                                 * 05290000
*    ZA02815  (01/17/75)           ZM00634  (01/27/75)                * 05292000
*    ZA03585 (03/24/75)                                               * 05294000
*    AZ04166  (08/25/75)          AZ04683  (08/26/76)                 * 05295000
*    AZ04868  (08/27/75)          AZ04869  (08/27/75)                 * 05296000
*    AZ06395  (11/04/75)          AZ09345  (04/08/76)                 * 05297000
*    AZ09351  (04/08/76)  DELETES APAR AZ04869                        * 05298000
*    AZ10030  (04/12/76)           AZ12155  (08/04/76)                * 05299000
*                                                                     * 05300000
*********************************************************************** 05350002
         EJECT                                                          05400002
         USING *,BASREG                                                 05450002
         LR    BASREG,ERREG5       SET BASE REG                         05500002
         B     BEGIN               BRANCH AROUND ID                     05510000
         DC    C'IGE0004A'         MODULE ID                            05520000
         DC    C'** MVS *'                                              05526000
         DC    CL8'&SYSDATE'                                            05532000
         DS    0H                                                       05540000
BEGIN    EQU   *                                                        05542000
         USING IOSB,IOSBREG                                             05550002
         USING RQE,ERREG5                                               05600002
         USING IOBSTDRD,IOBREG                                          05650002
         USING EWA,EWAREG                                               05700002
         L     ERREG5,IOSUSE       BASE RQE                             05750002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05800002
         L     IOBREG,RQEIOB       BASE IOB                             05850002
         L     DECBRG,IOBECBPT     BASE DECB                            05900002
         L     DCBREG,IOBDCBPT     BASE DCB                             05950002
         L     ERREG1,CVTPTR       BASE CVT                    YM02594K 06350002
         USING CVTMAP,ERREG1                                   YM02594K 06400002
         L     ERREG1,CVTIXAVL     POINT TO IOCOM              YM02594K 06450002
         DROP  ERREG1                                          YM02594K 06500002
         USING IOCOM,ERREG1                                    YM02594K 06550002
         L     ERREG1,IOCTCCW      POINT TO TRANSLATE ROUTINE  YM02594K 06600002
         ST    ERREG1,EWAITRAN     SAVE FOR DURATION OF ERROR  YM02594K 06650002
         DROP  ERREG1                                          YM02594K 06700002
         CLI   IOSDVRID,IOSXCPID   EXCP I/O                             06702002
         BNE   ERRUPDTE            NO, GET OUT                          06704002
         TM    IOSFLA,IOSERR         FIRST ENTRY                        06710002
         BO    NOTFIRST            NO                                   06720002
         XC    EWASTUP(L2),EWASTUP   CLEAR STAT UPDATE BYTES            06730002
         XC    EWAITCCW(L124),EWAITCCW   CLEAR EWA USER AREA            06740002
         MVC   EWAIOVST(L4),IOSVST   SAVE ADDRESS              YM02594K 06742002
****  ONE LINE OF CODE DELETED BY ---------------------->      @ZA06395 06750000
         B     FIRST               BRANCH AROUND IOBCSW MAP             06800002
NOTFIRST EQU   *                                                        06850002
         L     CCWREG,IOSCC        LOAD CSW                    YM02594K 06900002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT CONDITION CODE  YM02594K 06950002
*                                                                       07000000
*              ONE DELETED FOR ----->                       LD @ZM00634 07010000
*                                                                       07020000
         LR    ERREG3,CCWREG       SET PARAMETER REG           YM02594K 07050002
         LR    ERREG1,IOSBREG      SAVE IOSB BASE              YM02594K 07100002
         DROP  IOSBREG                                         YM02594K 07150002
         TM    EWAIND0,EWAIPMAP    PARALLEL MAPPING DONE       YM02594K 07200002
         BNO   HISTCCW             NO                          YM02594K 07250002
         L     IOSBREG,EWAITCCW    BASE MY TCCW                YM02594K 07300002
         B     GOTRANS             GO TO TRANSLATOR            YM02594K 07350002
HISTCCW  EQU   *                                               YM02594K 07400002
         L     IOSBREG,RQETCCW     GET IOS TCCW                YM02594K 07450002
GOTRANS  EQU   *                                               YM02594K 07500002
         TM    RQETYPE,RQE1TO1     DOES V EQUAL R ?            @ZA04166 07507000
         BZ    GETLOCK             NO GO MAP IOBCSW            @ZA04166 07514000
         USING IOSB,ERREG1          SET IOSB ADDRESSIBLITY     @ZA04166 07521000
         MVC   IOBCSW(L7),IOSCSW   MOVE CSW FROM IOSB TO IOB   @ZA04166 07528000
         DROP  ERREG1                                          @ZA04166 07535000
         LR    IOSBREG,ERREG1   REINITILIZE IOSB REG           @ZA10030 07538000
         B     FIRST               BRANCH AROUND IOBCSW MAP    @ZA04166 07542000
         DROP  ERREG5                                          YM02594K 07550002
         USING TCCW,IOSBREG                                    YM02594K 07600002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        *07610000
               RELATED=(ERP,IGE0004A(FREELOCK))             LD @ZA02815 07620000
         MVI   TCCWOPTN,TCCWCSWX   SET FOR CSW BACK TRANS      @ZA12155 07700000
         L     ERREG5,EWAITRAN     POINT TO IECVTCCW           YM02594K 07750002
         BALR  ERRETR,ERREG5       GO TO TRANSLATOR            YM02594K 07800002
FREELOCK SETLOCK RELEASE,TYPE=LOCAL,                                   *07810000
               RELATED=(ERP,IGE0004A(GETLOCK))              LD @ZA02815 07830000
         LR    CCWREG,ERREG3       LOAD FOR LOAD ADDR          YM02594K 07850002
*                                                                       07900000
*              ONE LINE DELETED FOR ----->                  LD @ZM00634 07910000
*                                                                       07920000
         ST    CCWREG,EWAISAVE     SET CCW ADDRESS IN AREA     YM02594K 07950002
         MVC   IOBCMDA(L3),EWAISAVE+L1   MOVE TO CSW           YM02594K 08000002
         DROP  IOSBREG                                         YM02594K 08050002
         LR    IOSBREG,ERREG1      REBASE IOSB                 YM02594K 08100002
         USING IOSB,IOSBREG                                    YM02594K 08150002
         MVC   IOBSTBYT(L4),IOSTATUS   MOVE STATUS AND COUNT   YM02594K 08200002
FIRST    EQU   *                                                        08250002
         MVC   IOBSENS0(L2),IOSSNS   MOVE SENSE IOSB TO IOB             08300002
         MVC   IOBSIOCC(L1),IOSCC   MOVE SIO CC IOSB TO IOB             08350002
         MVC   IOBECBCC(L1),IOSCOD   MOVE ECB CC IOSB TO IOB            08400002
         SR    ERREG1,ERREG1       CLEAR LINKAGE REGISTER               08800002
         L     CCWREG,IOBFL3       ADDRESS OF CCW FROM IOB CSW          08850002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT CC                       08900002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW IN IOB         08950002
         OI    IOSFLB,IOSMSG       INDICATE I/O ERROR TO MSG WRITER     09000002
         TM    IOBFLAG2,IOBRESP    RESET POLL ISSUED            YA02441 09060002
         BNO   ERRCK05A            NO                           YA02452 09070002
         MVI   IOBERRCT,L2         SET RETRY COUNT TO ALLOW     YA02452 09080002
*                                  RESET TO COMPLETE            YA02452 09082002
ERRCK05A EQU   *                                                YA02452 09090002
         TM    IOSFLA,IOSERR       ERP ROUTINE IN CONTROL               09100002
         BNO   ERRCK02             NO CONTINUE PROCESSING               09150002
         OI    IOSFLA,IOSEX        SET ERP IN CONTROL                   09200002
         OI    IOBFLAG1,IOBIOERR   ALSO IN IOB                          09250002
         CLI   IOBERRCT+L1,ZERO    NORMAL RETRY                         09300002
         BE    ERRCK01             YES, CONTINUE RETRY CHECKING         09350002
         CLI   IOBERRCT+L1,L1      SPECIAL RETURN FOR INT REQ           09400002
         BE    ERRM38              YES, BRANCH                          09450002
         CLI   IOBERRCT+L1,MASK15   LINK ROUTINE SPECIFIED              09500002
         BL    EREXCTL1            YES RETURN VIA LINK MOCULE           09550002
         B     ERRWTO              RETURN VIA ERROR POST                09600002
ERRCK01  TM    IOBCSW+L3,CSWNORM1   NORMAL COMPLETION          YM02568K 09650002
         BNZ   ERRCK02             NO NORMAL PROCESSING                 09700002
         TM    IOBCSW+L4,CSWNORM2   MORE NORMAL COMPLETION     YM02568K 09750002
         BNZ   ERRCK02             NO NORMAL PROCESSING                 09800002
         TM    IOBCSW+L3,CSWUE     THIS UNIT EXCEPTION         YM02568K 09850002
         BZ    ERRUPDTE            NO STASTICSTICS UPDATE OR POST       09900002
         CLI   ZERO(CCWREG),CCWRDCMD   READ COMMAND                     09950002
         BNE   ERRCK01A            IF NOT, CHECK FOR INHIBIT            10000002
         TM    TPCODE(CCWREG),CCWRRTXT   READ RESPONSE TO TEXT BIT      10050002
         BNO   ERRUPDTE            IF NOT SET, BRANCH TO DO SDR OR POST 10100002
         TM    TPCODE(CCWREG),L255-CCWRRTXT-HIBIT   ANY OTHER TP        10150002
         BNZ   ERRUPDTE            OP CODE BITS SET?  IF SO, BRANCH     10200002
ERRCK01A CLI   ZERO(CCWREG),CCWINHCD   INHIBIT COMMAND                  10250002
         BE    ERRUPDTE            IF SO, BRANCH TO DO SDR OR POST      10300002
ERRCK02 EQU    *                                                        10350002
         CLI   IOBECBCC,HIOISS     HAS HIO BEEN ISSUED                  10400002
         BE    ERRSTA01            YES, RETURN INTERRUPT TO APP         10450002
         OI    IOSFLA,IOSERR+IOSEX   INDICATE ERP IN CONTROL            10500002
         OI    IOBFLAG1,IOBERRTN+IOBIOERR   ALSO IN IOB                 10550002
         TM    IOBCSW+L4,ICORCC    INTERFACE OR CONTROL CHECK           10600002
         BZ    CHKMORE                                                  10650002
         LA    ERREG1,L1                                                10700002
         B     ERRM43                                                   10750002
CHKMORE  TM    IOBCSW+L4,CPC       CHANNEL PGM CHECK OCCUR              10800002
         BO    ERRM43              YES, GO TO STATUS CHECK RTN          10850002
         CLC   IOSSNS(L2),SCC3SNS   SIO CC3 SENSE                       10900002
         BNE   CHKMORE1            NO                                   10950002
         TM    IOSCC,IOSCC3        SIO CC 3                    @ZA09345 11000000
         BO    ERRPST03            YES, BRANCH                 @ZA09345 11050000
CHKMORE1 EQU   *                                                        11100002
         TM    IOSCC,IOSCC3        SIO CC NOT = 3                       11150002
         BM    ERRSTA04            IF SIO COND CODE 1, GO TO CONTROL    11200002
*                                  LOAD 2 TO HANDLE INITIAL SELECTION   11250002
*                                  ERROR.                               11300002
         TM    IOBCSW+L4,CSWCDC    CHANNEL DATA CHECK?                  11350002
         BO    ERRM35              IF SO, GO TO SPECIAL ENTRY OF        11400002
*                                  CONTROL LOAD 2                       11450002
         TM    IOBCSW+L3,CSWASCB   ATTEN, STATUS MOD, CTRL UNIT         11500002
*                                  END OR BUSY INDICATED                11550002
         BNZ   ERRSNO              ENTRY TO ERROR POST                  11600002
         TM    IOBCSW+L3,CSWUCK    IS THIS UNIT CHECK                   11650002
         BNO   ERRM43   STATUS CHECK ENTRY TO BRANCHING TABLE  @ZA12155 11750000
ERRSTA02 TM    IOBCSW+L3,CSWCDE    BOTH CHAN AND DEV END                11800002
         BO    ERRPST04            YES, EXAMINE SENSE BITS              11850002
         B     ERRSTA04            NO                                   11900002
ERRUPDTE NI    IOSFLA,L255-IOSERR-IOSEX   TURN OFF ERP FLAGS            11950002
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR   ALSO IN IOB            12000002
         CLI   EWASTUP,ZERO        STAT UPDATE REQUIRED                 12010002
         BE    RETRY               NO, POST COMPLETE           YM05652K 12020002
         TM    EWASTUP+L1,X01      CHANNEL CHECK OCCUR                  12030002
         BNO   RETRY               NO                          YM05652K 12040002
         MVI   EWAIND1,EWAISTAT    GO TO STAT UPDATE           YM05652K 12040402
         OI    IOSFLB,IOSLOG       CAUSE UPDATE EXIT                    12042002
ERRSTA01 EQU   *                                                        12050002
         L     NAMEREG,TRANSRTN    LOAD NAME                            12100002
EREXCTL  EQU   *                                                        12150002
         L     ERRETR,CVTPTR       POINT TO CVT                         12200002
         USING CVTMAP,ERRETR                                            12250002
         L     ERRETR,CVTXTLER     XCTL ROUTINE ADDRESS                 12300002
         BR    ERRETR              EXIT VIA XCTL                        12350002
         DROP  ERRETR                                                   12400002
RETRY    EQU   *                                               YM05652K 12410002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 12420002
         B     ERRSTA01            EXIT TO 904B                YM05652K 12430002
ERRPST03 EQU   *                                                        12450002
         L     UCBREG,IOSUCB       GET ADDR OF UCB            LD YM8278 12460000
         LA    UCBREG,ZERO(UCBREG) CLEAR HIGH ORDER BYTE      LD YM8278 12470000
         LR    ERREG1,IOSBREG      SAVE IOSB ADDR             LD YM8278 12480000
         MVC   EWAIEXIT(L16),EXITADDR MOVE ESTAE LIST         LD YM8278 12482000
         LA    PARMREG,EWAIEXIT    POINT TO ESTAE LIST        LD YM8278 12484000
         ESTAE MF=(E,(1))          SETUP RECOVERY RTN         LD YM8278 12486000
         L     ERREG3,SAVE         SUBPOOL AND LENGTH         LD YM8278 12490000
         GETMAIN R,LV=(0)          GET STORAGE FOR PARM WORD  LD YM8278 12492000
*                                  AND SAVEAREA               LD YM8278 12494000
         LA    NAMEREG,L4(PARMREG) ADDRESS OF SAVEAREA        LD YM8278 12495000
         ST    UCBREG,ZERO(PARMREG) INITIALIZE PARM WORD      LD YM8278 12496000
         LINK  EPLOC=IECVIOPM      LINK TO CHECK ALT PATH      @ZA09351 12498800
*                                            ALT. PATH                  12499200
         LR    ERREG4,ERREG5       SAVE RETURN CODE           LD YM8278 12499600
         L     ERREG3,SAVE         SUBPOOL AND LENGTH         LD YM8278 12502400
         FREEMAIN R,LV=(0),A=(1)   FREE STORAGE FOR PARM      LD YM8278 12505400
*                                  AND SAVEAREA.              LD YM8278 12508200
         ESTAE 0                   CLEAR OUT RECOVERY EXIT     @ZA04868 12511000
         LR    IOSBREG,ERREG1      RESTORE IOSB REG           LD YM8278 12513800
         LTR   ERREG4,ERREG4       CHECK FOR 0 RTN CODE       LD YM8278 12516600
         BZ    RETRY               RC=0, RETRY ON NEW PATH    LD YM8278 12526600
         LH    NAMEREG,ERLOD16     ADDRESS OF INT REQ MSG WRITER        12533302
         B     EREXCTL             LINK TO MESSAGE WRITER               12550002
ERRPST04 EQU   *                                                        12600002
         L     ERREG5,CVTPTR       POINT TO CVT                         12650002
         USING CVTMAP,ERREG5                                            12700002
         L     ERREG5,CVTXITP      LOAD NAME INTERPRETER RTNE           12750002
         DROP  ERREG5                                                   12800002
ERRM30   BALR  ERRETR,ERREG5       EXIT TO INTERPRETER                  12850002
         DC    X'03'                         EQUIPMENT CHECK            12900002
         DC    AL1(ERRM35-ERRM30-2)                                     12950002
         DC    X'06'                         LOST DATA                  13000002
         DC    AL1(ERRM36-ERRM30-4)                                     13050002
         DC    X'07'                         TIME OUT                   13100002
         DC    AL1(ERRM37-ERRM30-6)                                     13150002
         DC    X'01'                         INTERVENTION REQUIRED      13200002
         DC    AL1(ERRM38-ERRM30-8)                                     13250002
         DC    X'02'                         BUS OUT CHECK              13300002
         DC    AL1(ERRM39-ERRM30-10)                                    13350002
         DC    X'04'                         DATA CHECK                 13400002
         DC    AL1(ERRM40-ERRM30-12)                                    13450002
         DC    X'05'                         OVERRUN                    13500002
         DC    AL1(ERRM39-ERRM30-14)                                    13550002
         DC    X'00'                         COMMAND REJECT             13600002
         DC    AL1(ERRM35-ERRM30-16)                                    13650002
         DC    X'2F'                         END OF TEST                13700002
         DC    AL1(ERRSNO-ERRM30-18)                                    13750002
ERRSNO   EQU   *                                                        13800002
         OI    DECERRST(DECBRG),CSWSNO  INDICATE SHOULD NOT OCCUR ERROR 13850002
         NI    IOSFLA,L255-IOSERR  TURN OFF ERP IN CONTROL     @ZA04683 13860000
*                                    IN IOSB                   @ZA04683 13870000
         NI    IOBFLAG1,L255-IOBERRTN    ALSO IN IOB           @ZA04683 13880000
*                                  ENTRY FOR COMMAND REJECT             13900002
ERRM35   MVI   IOBERRCT+L1,MASK15   IND SPECIAL ENTRY LOAD 2            13950002
ERRSTA04 EQU   *                                                        14000002
         TM    IOBSTBYT+L1,CSWCHK  CHAIN, PROG OR PROT CHECK?  @ZA12155 14050000
         BNZ   ERRSCR06            YES                         @ZA12155 14100000
         TM    IOBSTBYT,CSWUE      UNIT EXCEPTION                       14350002
         BNO   ERRSCR05            NO, NONE OF THE ABOVE                14400002
ERRSCR04 LA    NAMEREG,ERLOD13     ADDRESS OF UNIT EXCEPTION RTN        14450002
         B     EREXCTL             EXIT ROUTINE                         14500002
ERRSCR05 OI    DECERRST(DECBRG),CSWSNO  INDICATE SHOULD NOT OCCUR ERROR 14550002
         NI    IOSFLA,L255-IOSERR  TURN OFF ERP IN CONTROL     @ZA04683 14560000
*                                      IN IOSB                 @ZA04683 14570000
         NI    IOBFLAG1,L255-IOBERRTN      ALSO IOB            @ZA04683 14580000
ERRSCR06 EQU   *                                                        14600002
         L     UCBREG,IOSUCB       POINT TO UCB                         14650002
         TM    UCBTYP+L1(UCBREG),SWLINE  IS A DISABLE REQUIRED          14700002
         BZ    ERRSCR07            NO GO TO OBR ROUTINE                 14750002
         MVI   IOBERRCT+L1,MASK15   SPECIAL ENTRY INDICATOR             14800002
         L     NAMEREG,ERLOD9      ADDRESS OF DISABLE ROUTINE           14850002
         B     EREXCTL             EXIT                                 14900002
ERRSCR07 OI    IOSFLB,IOSLOG       INDICATE STAT UPDATE REQUIRED        14950002
         LH    NAMEREG,ERLOD5      ADDRESS OF POST ROUTINE              15000002
         B     EREXCTL             EXIT                                 15050002
ERSTA4Q  EQU   *                                                        15100002
         LA    ERREG1,ERRRTCON(ERREG1)   ENTRY FOR CDC, INITIAL         15150002
*                                  SELECTION ERRORS AND EQUIPMENT CHECK 15200002
ERRM43   LA    ERREG1,ERRRTCON(ERREG1)   ENTRY FOR STATUS CHECK         15250002
EREXCTL1 LA    ERREG1,ERRRTCON(ERREG1)   ENTRY FOR A READ-SKIP OR       15300002
*                                  BREAK WHICH WERE ISSUED TO RECOVER   15350002
*                                  FROM LOST DATA ON A READ             15400002
*                                  OR UNIT EXCEPTION ON A WRITE         15450002
*                                  ENTRY FOR BUS-OUT CHECK              15500002
ERRM39   LA    ERREG1,ERRRTCON(ERREG1)   ENTRY FOR OVERRUN              15550002
ERRWTO   LA    ERREG1,ERRRTCON(ERREG1)   ENTRY FOR ERROR POST           15600002
ERRM36   LA    ERREG1,ERRRTCON(ERREG1)   ENTRY FOR LOST DATA            15650002
ERRM38   LA    ERREG1,ERRRTCON(ERREG1)   ENTRY FOR INTERVENTION REQ     15700002
ERRM37   LA    ERREG1,ERRRTCON(ERREG1)   ENTRY FOR TIME OUT             15750002
ERRM40   AH    ERREG1,ERLOD1       ADD BTAM INTERFACE VALUE             15800002
         LR    NAMEREG,ERREG1      SET UP LINK REGISTER                 15850002
         B     EREXCTL             EXIT VIA LINK MODULE                 15900002
         EJECT                                                          15950002
**********                                                    LD YM8278 15960000
*                                                             LD YM8278 15970000
*        ESTAE EXIT ROUTINE                                   LD YM8278 15980000
*                                                             LD YM8278 15990000
**********                                                    LD YM8278 15992000
         SPACE 2                                                        15992400
EXITRTN  EQU   *                                              LD YM8278 15994000
         DROP  BASREG                                         LD YM8278 15996000
         BALR  BASREG,ZERO                                    LD YM8278 15998000
         USING *,BASREG            ROUTINE ADDRESSABILITY     LD YM8278 15998400
*              PROCEED WITH ABEND                             LD YM8278 15998800
         SETRP                                                          15999200
         BR    ERRETR              RETURN TO TASK RECOVERY    LD YM8278 15999600
         EJECT                                                          15999700
**********                                                              16000002
*                                                                       16050002
*        CONSTANTS                                                      16100002
*                                                                       16150002
**********                                                              16200002
         SPACE 2                                                        16210000
EXITADDR ESTAE EXITRTN,MF=L                                   LD YM8278 16220000
         SPACE 2                                                        16230000
TRANSRTN DC    F'9042'             TRANSLATE ROUTINE NAME FOR XCTL      16250002
ERLOD9   DC    F'9041'             DISABLE ROUTINE NAME FOR XCTL        16300002
ERLOD5   DC    H'5041'             POST ROUTINE NAME FOR XCTL           16350002
ERLOD16  DC    H'6042'             INT REQ MSG WRITER NAME FOR XCTL     16400002
ERRCN8   DC    H'8'                CONSTANT FOR ARITHMETIC              16450002
ERLOD1   DC    H'1041'             BTAM INTERFACE VALUE                 16500002
SCC3SNS  DC    X'10FE'             SENSE FOR SIOCC=3                    16550002
         DS    0F                                                       16560000
SAVE     DC    X'FF00004C'         SUBPOOL 255 AND LENGTH     LD YM8278 16570000
IECVIOPM DC    C'IECVIOPM'                                    LD YM8278 16580000
PACHAREA DC    17C'004A'           PATCH AREA FOR MAINTENANCE           16600002
**********                                                              16650002
*                                                                       16700002
*        REGISTER DEFINITION                                            16750002
*                                                                       16800002
**********                                                              16850002
ERREG3   EQU   0                   WORK REG                             16900002
IOSBREG  EQU   1                   IOSB BASE                            16950002
PARMREG  EQU   IOSBREG             PARM REG FOR IECVIOPM      LD YM8278 16960000
ERREG2   EQU   2                   WORK REG/RQE BASE                    17000002
EWAREG   EQU   3                   EWA BASE                             17050002
CCWREG   EQU   4                   CCW POINTER                          17100002
DECBRG   EQU   5                   DECB BASE                            17150002
BASREG   EQU   6                   PROGRAM BASE                         17200002
UCBREG   EQU   7                   UCB BASE/WORK REG                    17250002
DCBREG   EQU   8                   DCB BASE                             17300002
ERREG1   EQU   9                   WORK REG                             17350002
IOBREG   EQU   10                  IOB BASE                             17400002
ERREG4   EQU   11                  WORK REG                             17450002
ERREG6   EQU   12                  WORK REG                             17500002
NAMEREG  EQU   13                  LINK REG/WORK REG                    17550002
ERRETR   EQU   14                  LINK REG/RETURN REG                  17600002
ERREG5   EQU   15                  WORK REG/LINK REG                    17650002
**********                                                              17700002
*                                                                       17750002
*        MISCELLANEOUS EQUATES                                          17800002
*                                                                       17850002
**********                                                              17900002
ZERO     EQU   0                   NUMBER AND DISPLACEMENT              17950002
L1       EQU   1                   NUMBER AND DISPLACEMENT              18000002
L2       EQU   2                   NUMBER AND DISPLACEMENT              18050002
L3       EQU   3                   NUMBER AND DISPLACEMENT              18100002
L4       EQU   4                   NUMBER AND DISPLACEMENT              18150002
L5       EQU   5                   NUMBER AND DISPLACEMENT              18200002
L6       EQU   6                   NUMBER AND DISPLACEMENT              18250002
L7       EQU   7                                               @ZA04166 18270000
L8       EQU   8                   LENGTH AND DISPLACEMENT              18300002
L16      EQU   16                                             LD YM8278 18310000
L124     EQU   124                 NUMBER AND DISPLACEMENT              18350002
L255     EQU   255                 NUMBER AND DISPLACEMENT              18400002
ERRRTCON EQU   1000                NUMBER USED TO CREATE BTAM LOAD NAME 18450002
ERLOD13  EQU   3042                UNIT EXCEPTION RTN NAME FOR XCTL     18500002
DECERRST EQU   29                                                       18550002
HIBIT    EQU   X'C0'     END OF CHANNEL PROG AND 1ST TIME PCI BITS      18600002
MASK15   EQU   X'0F'                                                    18650002
SWLINE   EQU   X'90'                                                    18700002
TPCODE   EQU   5                                                        18750002
UCBTYP   EQU   16                                                       18800002
HIOISS   EQU   X'48'               HALT IO ISSUED                       18850002
IOBRESP  EQU   X'01'               RESET POLL FLAG IN IOBFLAG2  YA02441 18860002
X01      EQU   X'01'               CHANNEL CHECK IN EWASTUP             18870002
**********                                                              18900002
*                                                                       18950002
*        CCW AND CSW RELATED EQUATES                                    19000002
*                                                                       19050002
**********                                                              19100002
CCWINHCD EQU   X'0A'               INHIBIT COMMAND                      19150002
CCWRDCMD EQU   X'02'               READ COMMAND                         19200002
CCWRRTXT EQU   X'20'               READ RESPONSE-TO-TEXT TP CODE        19250002
CSWASCB  EQU   X'F0'                                                    19300002
CSWCDC   EQU   X'08'               CHANNEL DATA CHECK                   19350002
CSWCDE   EQU   X'0C'               CHANNEL AND DEVICE END               19400002
CSWSNO   EQU   X'40'                                                    19450002
CSWUCK   EQU   X'02'               UNIT CHECK                           19500002
CSWUE    EQU   X'01'                                                    19550002
CSWNORM1 EQU   X'F2'                                                    19600002
CSWNORM2 EQU   X'BF'                                                    19650002
ICORCC   EQU   X'06'               CONTROL CHECKS                       19700002
CPC      EQU   X'20'               CHANNEL PROGRAM CHECK                19750002
CSWCHK   EQU   X'31'    CHAINING , PROG OR PROT CHECK          @ZA12155 19800000
         EJECT                                                          19950002
         IECDRQE                                                        20000002
         EJECT                                                          20050002
         IEZIOB                                                         20100002
         EJECT                                                          20150002
CVT      DSECT                                                          20200002
         CVT                                                            20250002
         EJECT                                                          20300002
         IECDERWA                                                       20350002
**********                                                              20400002
*                                                                       20450002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        20500002
*                                                                       20550002
**********                                                              20600002
         ORG   EWAIERP                                                  20650002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 20700002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 20750002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 20800002
EWAIND0  DS    B                   FLAG BYTE                            20850002
EWAIVISR EQU   X'10'               V=R REQUEST                          21450002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 21500002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 21550002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 21600002
EWAIND1  DS    B                   FLAG BYTE                            21650002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 21700002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 21750002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 21800002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 21810002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 21820002
EWAIND2  DS    B                   FLAG BYTE                            21850002
EWAIND3  DS    B                   FLAG BYTE                            21900002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     21950002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  22000002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 22050002
*********  END OF BTAM LOCAL DEFINITIONS **********                     22100002
         EJECT                                                          22150002
         IHAPSA                                                         22160000
         EJECT                                                          22170000
         IECDIOCM                                                       22200002
         EJECT                                                          22250002
         IECDTCCW                                                       22300002
         EJECT                                                          22350002
         IECDIOSB                                                       22400002
         EJECT                                                          22410000
         IHASDWA                                                        22420000
         END                                                            22450002
./  ADD  SSI=40240779,NAME=IGE0004B
         TITLE 'IGE0004B - BTAM ERROR DATA CHECK LOAD TWO'              00450002
IGE0004B CSECT                                                          00500002
*********************************************************************** 00550002
*                                                                     * 00600002
* MODULE NAME:                                                        * 00650002
*    IGE0004B                                                         * 00700002
*                                                                     * 00750002
* DESCRIPTIVE NAME:                                                   * 00800002
*    BTAM ERROR DATA CHECK LOAD TWO                                   * 00850002
*                                                                     * 00900002
* COPYRIGHT:                                                          * 00950002
*    NONE                                                             * 01000002
*                                                                     * 01050002
* STATUS:                                                             * 01100002
*    CHANGE LEVEL 000                                                 * 01150002
*                                                                     * 01200002
* FUNCTION:                                                           * 01250002
*    1.ATTEMPT ERROR RECOVERY OF DATA CHECK ERRORS OCCURRING          * 01300002
*    DURING OR AFTER TEXT TRANSFERS. ERRORS THAT OCCUR AFTER TEXT     * 01350002
*    TRANSFER ARE RETRIED AUTOMATICALLY. ERRORS THAT OCCUR DURING     * 01400002
*    TEXT TRANSFER ARE RETRIED ONLY IF DECERROP PARAMETER             * 01500002
*    SPECIFIES READ RETRIES.                                          * 01550002
*    2.PROVIDE LINKAGE TO LINE ERROR RECORDING ROUTINE IF LERB        * 01600002
*    INDICATOR IS SPECIFIED IN DECERROP PARAMETER                     * 01700002
*    3.PROVIDE LINKAGE TO POST ROUTINE IF ERROR IS DETERMINED         * 01750002
*    PERMANENT OR IF DURING TEXT TRANSFER AND READ RETRIES            * 01800002
*    ARE NOT SPECIFIED                                                * 01850002
*                                                                     * 01900002
* NOTES:                                                              * 01950002
*    DEPENDENCIES:                                                    * 02000002
*        NONE                                                         * 02050002
*    RESTRICTIONS:                                                    * 02100002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 02150002
*    REGISTER CONVENTIONS:                                            * 02200002
*        SEE 'REGISTER DEFINITION' BELOW                              * 02250002
*                                                                     * 02300002
* PATCHLABEL:                                                         * 02350002
*    PACHAREA (48 BYTES)                                              * 02400002
*                                                                     * 02450002
* MODULE TYPE:                                                        * 02500002
*    PROCEDURE                                                        * 02550002
*    PROCESSOR:                                                       * 02600002
*        BAL                                                          * 02650002
*    MODULE SIZE:                                                     * 02700002
*        500 BYTES                                                    * 02750002
*    ATTRIBUTES:                                                      * 02800002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02850002
*                                                                     * 02900002
* ENTRY POINT:                                                        * 02950002
*    IGE0004B                                                         * 03000002
*    PURPOSE:                                                         * 03050002
*        SEE 'FUNCTION'                                               * 03100002
*    LINKAGE:                                                         * 03150002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 03200002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 03250002
*    INPUT:                                                           * 03300002
*        REG 1 = ADDRESS OF IOSB                                      * 03350002
*    OUTPUT:                                                          * 03400002
*        ALTERS EXISTING CCWS OR CREATES NEW ONES FOR RECOVERY        * 03450002
*        ALTERS DECERRST FOR SHOULD NOT OCCUR ERROR.                  * 03500002
*        ALTERS DECERRST FOR DISABLE REQUIRED.                        * 03550002
*                                                                     * 03600002
* EXITS-NORMAL:                                                       * 03650002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03750002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03800002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03850002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03900002
*        LOADS ARE 1000 GREATER.                                      * 03950002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 04000002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 04050002
*                                                                     * 04100002
* EXITS-ERROR:                                                        * 04150002
*    NONE                                                             * 04200002
*                                                                     * 04250002
* EXTERNAL REFERENCES:                                                * 04300002
*    ROUTINES:                                                        * 04350002
*        NONE                                                         * 04400002
*    DATA AREAS                                                       * 04500002
*        IOB (MAPPED BY IEZIOB)                                       * 04550002
*        VIRTUAL CHANNEL PROGRAM                                      * 04600002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04650002
*    CONTROL BLOCKS                                                   * 04700002
*        UCB                                                          * 04750002
*        DCB                                                          * 04800002
*        DECB                                                         * 04850002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04900002
*        CVT          (MAPPED BY CVT)                                 * 04950002
*        IOB          (MAPPED BY IEZIOB)                              * 05000002
*        RQE          (MAPPED BY IECDRQE)                             * 05050002
*        TCCW         (MAPPED BY IECDTCCW)                            * 05100002
*        IOCOM        (MAPPED BY IECDIOCM)                            * 05150002
*                                                                     * 05200002
* TABLES-WORKAREAS:                                                   * 05250002
*    ERP WORKAREA                                                     * 05300002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 05350002
*                                                                     * 05400002
* MACROS:                                                             * 05450002
*    NONE                                                             * 05500002
*                                                                     * 05550002
* CHANGE ACTIVITY:                                                    * 05600002
*    YM02595K (9/20/73)                                               * 05650002
*    YM02594K (9/24/73)                                               * 05660002
*    YM05652K (1/24/74)                                               * 05670002
*                                                                     * 05700002
*********************************************************************** 05750002
         EJECT                                                          05800002
         USING *,BASEREG                                                05850002
         LR    BASEREG,ERREG4      BASE PROGRAM                         05900002
         USING RQE,ERREG5                                               05950002
         USING IOSB,IOSBREG                                             06000002
         USING IOBSTDRD,IOBRG                                           06050002
         USING EWA,EWAREG                                               06100002
         L     ERREG5,IOSUSE       BASE RQE                             06150002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    06200002
         L     IOBRG,RQEIOB        BASE IOB                             06250002
         L     DECBRG,IOBECBPT     BASE DECB                            06300002
         L     DCBREG,IOBDCBPT     BASE DCB                             06350002
         DROP  ERREG5                                                   06400002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       06450002
         LA    CCWREG,ZERO(CCWREG)   CLEAR FLAG BYTE                    06500002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                06550002
         CLI   IOBERRCT+L1,MASK3   ENTRY FROM 1ST LOAD FOR LERB CHECK   06600002
         BE    ERRDCD03            YES CHECK FOR LERB REQUIRED          06650002
         CLI   ZERO(CCWREG),CCWAPOLL   POLL COMMAND                     06700002
         BE    ERRDCD12            YES TREAT AS READ                    06750002
         CLI   ZERO(CCWREG),CCWINCMD   INHIBIT COMMAND                  06800002
         BE    READ                YES                                  06850002
         CLI   ZERO(CCWREG),CCWRDCMD   READ COMMAND                     06900002
         BNE   ERRDCD00             NO CHECK FOR WRITE                  06950002
READ     EQU   *                                                        07000002
         CLI   IOBWORK,CCWTWXID    READ RESPONSE TWX ID                 07050002
         BE    ERRDCD01            YES INITIALIZE START                 07100002
         CLI   IOBCPA,CCWDISAB     FIRST COMMAND A DISABLE              07150002
         BNE   ERRDCD01            NO INITIALIZE START                  07200002
         LA    ERREG1,IOBCMD3      SET CPA TO THIRD CCW                 07250002
         ST    ERREG1,IOBSTART     STORE IN POINTER                     07300002
         B     ERRDCD03            CHECK FOR LINE ERROR RECORDING       07450002
ERRDCD00 CLI   ZERO(CCWREG),CCWWRT   WRITE COMMAND                      07500002
         BE    ERRDCD02            YES                                  07550002
         OI    DECERRST(DECBRG),CSWSNO   SET SHOULD NOT OCCUR ERROR     07600002
         B     ERRDCD05            CHECK FOR SWITCHED LINE              07650002
ERRDCD02 EQU   *                                                        07700002
         CLI   IOBWORK+L2,TTYADPT1   THIS TELETYPE ADAPTER 1            07800002
         BE    ERRDCD14            IF SO, BRANCH                        07850002
         CLI   IOBWORK+L2,TTYADPT2   THIS TELETYPE ADAPTER 2            07900002
         BE    ERRDCD14            IF SO, BRANCH                        07950002
         MVI   IOBERRCT,ERTRYCT    SET RETRY COUNT TO 2                 08000002
         L     UCBREG,IOSUCB       POINT TO UCB                         08050002
         TM    UCBTYP+L3(UCBREG),X90   IS A WTTA                        08100002
         BNZ   ERRDCD03            BRANCH IF NOT                        08150002
         TM    UCBTYP+L3(UCBREG),X60   IS A WTTA                        08200002
         BO    ERRDCD16            BRANCH IF YES                        08250002
         B     ERRDCD03            CHECK FOR LINE ERROR RECORDING       08300002
ERRDCD01 EQU   *                                                        08350002
         CLI   IOBWORK,CCWRDIX     READ RESPONSE TO POLL ID             08400002
         BNE   ERRDCD13            NO ALL COMMANDS GOOD                 08450002
ERRDCD12 EQU   *                                                        08500002
         L     ERREG1,IOBCPA+L8    LOAD ENTRY ADDRESS FROM PREVIOUS     08550002
*                                  POLL (WITH POLL COMMAND CODE         08600002
*                                  IN HIGH ORDER BYTE)                  08650002
         MVC   IOBCPA+L9(L3),DECENTRY+L1(DECBRG)   MOVE IN ADDRESS      08700002
*                                  OF LAST ENTRY POLLED (TO BE          08750002
*                                  USED AS RESTART ADDRESS)             08800002
         L     ERREG4,IOBCPA+L8    LOAD ENTRY ADDRESS FOR NEXT POLL     08850002
*                                  (WITH POLL COMMAND CODE IN           08900002
*                                  HIGH ORDER BYTE)                     08950002
         SR    ERREG1,ERREG4       SUBTRACT NEW POLL ADDRESS            09000002
*                                  FROM PREVIOUS POLL ADDRESS.          09050002
         AH    ERREG1,IOBCPA+L14   IF THE NEW POLL ADDRESS              09100002
*                                  WERE LESS THAN THE PREVIOUS POLL     09150002
*                                  ADDRESS, THE EFFECT IS TO ADD THE    09200002
*                                  ABSOLUTE DIFFERENCE TO THE PREVIOUS  09250002
*                                  COUNT; IF IT WERE GREATER, THE       09300002
*                                  EFFECT IS TO SUBTRACT THE ABSOLUTE   09350002
*                                  DIFFERENCE FROM THE PREVIOUS COUNT   09400002
         STH   ERREG1,IOBCPA+L14   STORE ADJUSTED COUNT IN              09450002
*                                  POLL COMMAND.                        09500002
ERRDCD13 EQU   *                                                        09650002
         LA    ERREG4,IOBCPA       START OF CHANNEL PROGRAM             09700002
         ST    ERREG4,IOBSTART     STORE CPA IN POINTER                 09750002
ERRDCD03 MVI   IOBERRCT+L1,NONAME   CLEAR SPECIAL ENTRY INDICATOR       09900002
         TM    DCBERROP(DCBREG),DCBLERB   LINE ERROR RECORDING REQUIRED 09950002
         BZ    ERRDCD04            NO CHECK RETRIES                     10000002
         MVI   IOBERRCT-L1,LERBDC   INDICATE LERB DATA CHECK ERROR      10050002
ERRDCD04 CLI   IOBERRCT,ERTRYCT    RETRY REQUIRED                       10100002
         BL    ERRDCD06            YES UPDATE RETRY COUNT               10150002
         TM    DCBBFTEK(DCBREG),DYNBUF   IS DYNAMIC BUF SPECIFIED?      10200002
         BO    ERRDCD05            YES, NO DIAG ISSUED                  10250002
         CLI   IOBWORK+L3,CTRL2701   THIS A 2701 CONTROL UNIT           10300002
         BE    ERRDCD10            YES ISSUE DIAG WRITE/READ            10350002
ERRDCD05 EQU   *                                                        10400002
         L     UCBREG,IOSUCB       BASE UCB                             10450002
         TM    UCBTYP+L1(UCBREG),SWLINE   DISABLE REQUIRED              10500002
         BZ    ERRDCD07            NO INDICATE PERMANENT ERROR          10550002
         MVC   IOBERINF+L8(L8),ZERO(CCWREG)   SAVE FAILING CCW          10600002
         MVC   IOBERINF(L1),IOBSENS0   SAVE SENSE BYTE                  10650002
         MVC   IOBERINF+L1(L7),IOBCSW   SAVE CSW DATA                   10700002
         MVC   IOBERCCW(L8),DISABCMD   GENERATE DISABLE CCW             10750002
         LA    ERREG1,IOBERCCW     ADDRESS OF CCW                       10800002
         ST    ERREG1,IOBSTART     CPA START IN POINTER                 10850002
         MVI   IOBERRCT+L1,DISABIND   INDICATE DISABLE EXECUTED         10950002
         OI    DECERRST(DECBRG),DISABLOK   INDICATE DISABLE EXECUTED    11000002
ERRDCD06 IC    ERREG1,IOBERRCT     RETRY COUNT                          11050002
         LA    ERREG1,L1(ERREG1)   BUMP COUNT                           11100002
         STC   ERREG1,IOBERRCT     STORE NEW COUNT                      11150002
         MVI   IOBSENS0,NONAME     CLEAR SENSE BYTE                     11200002
         CLI   IOBERRCT-L1,NONAME  IS LERB SPECIFIED                    11250002
         BNE   ERRDCD09            IF YES, BRANCH                       11300002
RETRY    EQU   *                                                        11350002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 11400002
         L     NAMEREG,TRANSRTN    LOAD NAME                            16050002
         B     ERRDCD08            XCTL                                 16100002
ERRDCD07 NI    IOSFLA,L255-IOSERR   INDICATE POST TO LERB               16150002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     16160002
         CLI   IOBERRCT-L1,NONAME   LINE ERROR RECORDING                16200002
         BNE   ERRDCD09                                                 16250002
         LH    NAMEREG,ERLOD5      NAME OF POST ROUTINE                 16300002
ERRDCD08 L     ERRETR,CVTPTR       BASE CVT                             16350002
         USING CVTMAP,ERRETR                                            16400002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                16450002
         BR    ERRETR              XCTL                                 16500002
         DROP  ERRETR                                                   16550002
ERRDCD09 LA    NAMEREG,ERLOD12     NAME OF LERB ROUTINE                 16600002
         B     ERRDCD08            XCTL                                 16650002
ERRDCD10 CLI   IOBERRCT-L1,NONAME   LINE ERROR RECORDING REQUIRED       16700002
         BE    ERRDCD11            NO EXIT TO DIAG WRT/RD               16750002
         MVI   IOBERRCT+L1,RTRNCDE   INDICATE DIAG WR/RD REQ            16800002
         LA    NAMEREG,ERLOD12     NAME OF LERB ROUTINE                 16850002
         B     ERRDCD08            XCTL                                 16900002
ERRDCD11 LA    NAMEREG,ERLOD11     NAME OF DIAG WR/RD ROUTINE           16950002
         B     ERRDCD08            XCTL                                 17000002
ERRDCD14 TM    L5(CCWREG),CCWTXTDT   DURING TEXT TRANSFER               17050002
         BZ    ERRDCD13            IF NOT, GO TO RETRY                  17100002
         TM    DCBERROP(DCBREG),CCWRTRT   WRITE RETRIES SPECIFIED       17150002
         BO    ERRDCD13            IF SO, GO TO RETRY                   17200002
ERRDCD16 EQU   *                                                        17250002
         TM    DCBERROP(DCBREG),DCBLERB   LINE ERROR COUNTS             17300002
         BZ    ERRDCD15            IF NOT, POST                         17350002
         MVI   IOBERRCT-L1,LERBDC   INDICATE LERB DATA CHECK            17400002
         NI    IOSFLA,L255-IOSERR-IOSEX   INDICATE POST WITH NO         17450002
*                                  ERROR MESSAGE                        17500002
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR   ALSO IN IOB            17510002
         B     ERRDCD09            GO TO LERB                           17550002
ERRDCD15 NI    IOSFLA,L255-IOSERR   INDICATE PERM ERROR                 17600002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     17610002
         B     RETRY               RETRY EXCP AND RETURN                17650002
         EJECT                                                          17700002
**********                                                              17750002
*                                                                       17800002
*        CONSTANTS                                                      17850002
*                                                                       17900002
**********                                                              17950002
         DS    0D                                                       18000002
DISABCMD DC    X'2F00000020300001'   DISABLE CCW                        18050002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       18060002
ERLOD5   DC    H'5041'             NAME OF POST ROUTINE                 18100002
ERRCN8   DC    H'8'                ARITHMETIC                           18150002
PACHAREA DC    12C'ZAP'            PATCH AREA FOR MAINTENANCE           18250002
**********                                                              18300002
*                                                                       18350002
*        MISCELLANEOUS EQUATES                                          18400002
*                                                                       18450002
**********                                                              18500002
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              18550002
L1       EQU   1                   LENGTH AND DISPLACEMENT              18600002
L2       EQU   2                   LENGTH AND DISPLACEMENT              18650002
L3       EQU   3                   LENGTH AND DISPLACEMENT              18700002
L4       EQU   4                   LENGTH AND DISPLACEMENT              18710002
L5       EQU   5                   LENGTH AND DISPLACEMENT              18750002
L6       EQU   6                   LENGTH AND DISPLACEMENT              18760002
L7       EQU   7                   LENGTH AND DISPLACEMENT              18800002
L8       EQU   8                   LENGTH AND DISPLACEMENT              18850002
L9       EQU   9                   LENGTH AND DISPLACEMENT              18900002
L14      EQU   14                  LENGTH AND DISPLACEMENT              18950002
X90      EQU   X'90'               WTTA MASK                            19000002
X60      EQU   X'60'               WTTA MASK                            19050002
CCWAPOLL EQU   X'09'                                                    19100002
CCWINCMD EQU   X'0A'                                                    19150002
CCWDISAB EQU   X'2F'                                                    19200002
CCWRDCMD EQU   X'02'                                                    19250002
CCWRDIX  EQU   X'0A'                                                    19300002
CCWRTRT  EQU   X'04'                                                    19350002
CCWTXTDT EQU   X'10'                                                    19400002
CCWTWXID EQU   X'07'                                                    19450002
CCWWRT   EQU   X'01'                                                    19500002
CSWSNO   EQU   X'40'                                                    19550002
CTRL2701 EQU   X'02'                                                    19600002
DCBERROP EQU   33                                                       19650002
DCBBFTEK EQU   X'20'                                                    19700002
DYNBUF   EQU   X'08'                                                    19750002
DCBLERB  EQU   X'08'                                                    19800002
DECENTRY EQU   20                                                       19850002
DECERRST EQU   29                                                       19900002
DISABIND EQU   X'80'                                                    19950002
DISABLOK EQU   X'08'                                                    20000002
ERLOD11  EQU   1042                NAME OF DIAG RD/WRT ROUTINE          20050002
ERLOD12  EQU   2042                NAME OF LERB ROUTINE                 20100002
ERTRYCT  EQU   X'02'                                                    20150002
LERBDC   EQU   X'01'                                                    20250002
L255     EQU   255                 AND MASK                             20300002
MASK3    EQU   X'F0'                                                    20350002
NONAME   EQU   X'00'                                                    20400002
RTRNCDE  EQU   X'C0'                                                    20500002
SWLINE   EQU   X'90'                                                    20550002
TTYADPT1 EQU   X'40'                                                    20600002
TTYADPT2 EQU   X'50'                                                    20650002
UCBTYP   EQU   16                  DEVICE TYPE CODE                     20700002
**********                                                              20750002
*                                                                       20800002
*        REGISTER DEFINITION                                            20850002
*                                                                       20900002
**********                                                              20950002
ERREG2   EQU   0                   WORK REG                             21000002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              21050002
EWAREG   EQU   2                   ERP WORKAREA BASE                    21100002
BASEREG  EQU   3                   PROGRAM BASE                         21150002
CCWREG   EQU   4                   CCW ADDRESS                          21200002
DECBRG   EQU   5                   DECB BASE                            21250002
DCBREG   EQU   6                   DCB BASE                             21300002
UCBREG   EQU   7                   WORK REG/UCB BASE                    21350002
ERREG5   EQU   8                   WORK REG                             21400002
ERREG1   EQU   9                   WORK REG                             21450002
IOBRG    EQU   10                  IOB BASE                             21500002
ERREG3   EQU   11                  WORK REG                             21550002
ERRLNK   EQU   12                  LINK REG                             21600002
NAMEREG  EQU   13                  LINK REG                             21650002
ERRETR   EQU   14                  RETURN REG                           21700002
ERREG4   EQU   15                  LINK REG                             21750002
         EJECT                                                          21900002
         IECDRQE                                                        21950002
         EJECT                                                          22000002
         IEZIOB                                                         22050002
IOBCMD3  EQU   IOBCPA+16                                                22100002
         EJECT                                                          22150002
CVT      DSECT                                                          22200002
         CVT                                                            22250002
         EJECT                                                          22300002
         IECDERWA                                                       22350002
**********                                                              22400002
*                                                                       22450002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        22500002
*                                                                       22550002
**********                                                              22600002
         ORG   EWAIERP                                                  22650002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 22700002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 22750002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 22800002
EWAIND0  DS    B                   FLAG BYTE                            22850002
EWAIVISR EQU   X'10'               V=R REQUEST                          23450002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 23500002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 23550002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 23600002
EWAIND1  DS    B                   FLAG BYTE                            23650002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 23700002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 23750002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 23800002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 23810002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 23820002
EWAIND2  DS    B                   FLAG BYTE                            23850002
EWAIND3  DS    B                   FLAG BYTE                            23900002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     23950002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  24000002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 24050002
*********  END OF BTAM LOCAL DEFINITIONS **********                     24100002
         EJECT                                                          24700002
         IECDIOSB                                                       24750002
         END                                                            24800002
./  ADD  SSI=81250040,NAME=IGE0004C
         TITLE 'IGE0004C - BSC ERP CONTROL MODULE'                      00100002
IGE0004C CSECT                                                          00150002
*********************************************************************** 00200002
*                                                                     * 00250002
* MODULE NAME:                                                        * 00300002
*    IGE0004C                                                         * 00350002
*                                                                     * 00400002
* DESCRIPTIVE NAME:                                                   * 00450002
*    BTAM BSC CONTROL ERP                                             * 00500002
*                                                                     * 00550002
* COPYRIGHT:                                                          * 00600002
*    NONE                                                             * 00650002
*                                                                     * 00700002
* STATUS:                                                             * 00750002
*    CHANGE LEVEL 001                                                 * 00800002
*                                                                     * 00850002
* FUNCTION:                                                           * 00900002
*    THIS ROUTINE IS THE FIRST LOAD OF EACH ERP RETRY ATTEMPT.        * 00950002
*    IT ROUTINE PERFORMS THE FOLLOWING FUNCTIONS:                     * 01000002
*        * PROVIDES LINKAGE TO PROPER ERP ROUTINE FOR TYPE OF         * 01050002
*          ERROR ENCOUNTERED.                                         * 01100002
*        * DETERMINES IF ERP RETRIES ARE SUCCESSFUL.                  * 01150002
*        * MAINTAINS SOR TABLE FOR TEMPORARY ERRORS.                  * 01200002
*                                                                     * 01250002
* NOTES:                                                              * 01300002
*    DEPENDENCIES:                                                    * 01350002
*        NONE                                                         * 01400002
*    RESTRICTIONS:                                                    * 01450002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01500002
*    REGISTER CONVENTIONS:                                            * 01550002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01600002
*                                                                     * 01650002
* PATCHLABEL:                                                         * 01700002
*    PACHAREA (100 BYTES)                                             * 01750002
*                                                                     * 01800002
* MODULE TYPE:                                                        * 01850002
*    PROCEDURE                                                        * 01900002
*    PROCESSOR:                                                       * 01950002
*        BAL                                                          * 02000002
*    MODULE SIZE:                                                     * 02050002
*        980 BYTES                                                    * 02100002
*    ATTRIBUTES:                                                      * 02150002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02200002
*                                                                     * 02250002
* ENTRY POINT:                                                        * 02300002
*    IGE0004C                                                         * 02350002
*    PURPOSE:                                                         * 02400002
*        SEE 'FUNCTION'                                               * 02450002
*    LINKAGE:                                                         * 02500002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02550002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02600002
*    INPUT:                                                           * 02650002
*        REG 1 = ADDRESS OF IOSB                                      * 02700002
*    OUTPUT:                                                          * 02750002
*        ALTERED CHANNEL PROGRAM                                      * 02800002
*        SETS INDICATOR IN DECERRST FOR SHOULD NOT OCCUR ERROR        * 02850002
*                                                                     * 02900002
* EXITS-NORMAL:                                                       * 02950002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03000002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03050002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03100002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03150002
*        LOADS ARE 1000 GREATER.                                      * 03200002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03250002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03300002
*                                                                     * 03350002
* EXITS-ERROR:                                                        * 03400002
*    NONE                                                             * 03450002
*                                                                     * 03500002
* EXTERNAL REFERENCES:                                                * 03550002
*    ROUTINES:                                                        * 03600002
*        IOS INTERPRETER                                              * 03650002
*        IECVTCCW (IOS CCW TRANSLATOR)                                * 03700002
*    DATA AREAS                                                       * 03750002
*        IOB (MAPPED BY IEZIOB)                                       * 03800002
*        VIRTUAL CHANNEL PROGRAM                                      * 03850002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 03900002
*    CONTROL BLOCKS                                                   * 03950002
*        DCB                                                          * 04000002
*        DECB                                                         * 04050002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04100002
*        CVT          (MAPPED BY CVT)                                 * 04150002
*        IOB          (MAPPED BY IEZIOB)                              * 04200002
*        RQE          (MAPPED BY IECDRQE)                             * 04250002
*        TCCW         (MAPPED BY IECDTCCW)                            * 04300002
*        IOCOM        (MAPPED BY IECDIOCM)                            * 04350002
*                                                                     * 04400002
* TABLES-WORKAREAS:                                                   * 04450002
*    ERP WORKAREA                                                     * 04500002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04550002
*                                                                     * 04600002
* MACROS:                                                             * 04650002
*    NONE                                                             * 04700002
*                                                                     * 04750002
* CHANGE ACTIVITY:                                                    * 04800002
*    YM02595K (9/20/73)                                               * 04850002
*    YM02594K (9/24/73)                                               * 04900002
*    YM05652K (1/24/74)                                               * 04910002
*    YM05680K (1/24/74)                                               * 04920002
*    YM07711  (4/2/74)                                                * 04930000
*    YM08278 (4/16/74)                                                * 04940000
*    ZA02815  (01/17/75)                 ZM00634  (01/27/75)          * 04942000
*    AZ04166  (08/25/75)          AZ04681  (08/26/75)                 * 04943000
*    AZ04868  (08/27/75)          AZ04869  (08/27/75)                 * 04953000
*    AZ09345  (04/08/76)                                              * 04963000
*    AZ09351  (04/08/76)  DELETES APAR AZ04869                        * 04973000
*    AZ10030  (04/12/76)                                              * 04983000
*    AZ24270  (09/29/77)                                              * 04991000
*    AZ28893   12/20/77                                               * 04992000
*    AZ31667   04/06/78                                               * 04993000
*********************************************************************** 05000002
         EJECT                                                          05050002
         USING *,BASEREG                                                05100002
         LR    BASEREG,ERREG5      SET BASE REG                         05150002
         USING RQE,ERREG5                                               05200002
         USING IECTDECB,DECBRG                                          05250002
         USING IHADCB,DCBREG                                            05300002
         USING IOSB,IOSBREG                                             05350002
         USING IOBSTDRD,IOBRG                                           05400002
         USING EWA,EWAREG                                               05450000
         B     BEGIN               BRANCH AROUND ID                     05460000
         DC    C'IGE0004C'         MODULE ID                            05470000
         DC    XL3'017983'         PTF NUMBER                           05476000
         DC    CL8'&SYSDATE'                                            05482000
         DS    0H                                                       05490000
BEGIN    EQU   *                                                        05492000
         L     ERREG5,IOSUSE       BASE RQE                             05500002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05550002
         L     IOBRG,RQEIOB        BASE IOB                             05600002
         L     DECBRG,IOBECBPT     BASE DECB                            05650002
         L     DCBREG,IOBDCBPT     BASE DCB                             05700002
         L     ERREG1,CVTPTR       BASE CVT                    YM02594K 06100002
         USING CVTMAP,ERREG1                                   YM02594K 06150002
         L     ERREG1,CVTIXAVL     POINT TO IOCOM              YM02594K 06200002
         DROP  ERREG1                                          YM02594K 06250002
         USING IOCOM,ERREG1                                    YM02594K 06300002
         L     ERREG1,IOCTCCW      POINT TO TRANSLATE ROUTINE  YM02594K 06350002
         ST    ERREG1,EWAITRAN     SAVE FOR DURATION OF ERROR  YM02594K 06400002
         DROP  ERREG1                                          YM02594K 06450002
         CLI   IOSDVRID,IOSXCPID   EXCP I/O                             06460002
         BNE   BSCUET09            NO, GET OUT                          06470002
         CLI   EWAIND1,EWAILD00    DIRECT ENTRY FROM OTHER ERP YM05680K 06472002
         BE    ERRBSC1             YES                         YM05680K 06474002
         TM    IOSFLA,IOSERR       FIRST ENTRY                          06480002
         BO    NOTFIRST            NO                                   06490002
         XC    EWASTUP(L2),EWASTUP   CLEAR STAT UPDATE DATA AREA        06492002
         XC    EWAITCCW(L124),EWAITCCW   CLEAR EWA USER AREA            06494002
         MVC   EWAIOVST(L4),IOSVST   SAVE ADDRESS              YM02594K 06496002
*        ONE LINE OF CODE DELETED BY-------------------->      @ZA04681 06500000
         B     FIRST               BRANCH AROUND IOBCSW MAP             06550002
NOTFIRST EQU   *                                                        06600002
         L     CCWREG,IOSCC        LOAD CSW                    YM02594K 06650002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT CONDITION CODE  YM02594K 06700002
*                                                                       06750000
*              ONE LINE DELETED FOR ----->                  LD @ZM00634 06760000
*                                                                       06770000
         LR    ERREG3,CCWREG       SET PARAMETER REG           YM02594K 06800002
         LR    ERREG1,IOSBREG      SAVE IOSB BASE              YM02594K 06850002
         DROP  IOSBREG                                         YM02594K 06900002
         TM    EWAIND0,EWAIPMAP    PARALLEL MAPPING DONE       YM02594K 06950002
         BNO   HISTCCW             NO                          YM02594K 07000002
         L     IOSBREG,EWAITCCW    BASE MY TCCW                YM02594K 07050002
         B     GOTRANS             GO TO TRANSLATOR            YM02594K 07100002
HISTCCW  EQU   *                                               YM02594K 07150002
         L     IOSBREG,RQETCCW     GET IOS TCCW                YM02594K 07200002
GOTRANS  EQU   *                                               YM02594K 07210000
         TM    RQETYPE,RQE1TO1     DOES V EQUAL R ?            @ZA04166 07220000
         BZ    GETLOCK             NO GO MAP IOBCSW            @ZA04166 07250000
         USING IOSB,ERREG1         SET IOSB ADDRESSIBLITY      @ZA04166 07260000
         MVC   IOBCSW(L7),IOSCSW  MOVE CSW FROM IOSB TO IOB    @ZA04166 07270000
         DROP  ERREG1                                          @ZA04166 07280000
         LR    IOSBREG,ERREG1   REINITILIZE IOSB REG           @ZA10030 07285000
         B     FIRST               BRANCH AROUND IOBCSW MAP    @ZA04166 07290000
         DROP  ERREG5                                          YM02594K 07300002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        *07310000
               RELATED=(ERP,IGE0004C(FREELOCK))             LD @ZA02815 07320000
         USING TCCW,IOSBREG                                    YM02594K 07350002
         MVI   TCCWOPTN,ZERO       CLEAR OUT OPTION FIELD      YM02594K 07400002
         OI    TCCWOPTN,TCCWCSWX   SET FOR CSW BACK TRANS      YM02594K 07450002
         L     ERREG5,EWAITRAN     POINT TO IECVTCCW           YM02594K 07500002
         BALR  ERRETR,ERREG5       GO TO TRANSLATOR            YM02594K 07550002
FREELOCK SETLOCK RELEASE,TYPE=LOCAL,                                   *07560000
               RELATED=(ERP,IGE0004C(GETLOCK))              LD @ZA02815 07570000
         LR    CCWREG,ERREG3       LOAD FOR LOAD ADDR          YM02594K 07600002
*              ONE LINE DELETED FOR ----->                  LD @ZM00634 07660000
         ST    CCWREG,EWAISAVE     SET CCW ADDRESS IN AREA     YM02594K 07700002
         MVC   IOBCMDA(L3),EWAISAVE+L1   MOVE TO CSW           YM02594K 07750002
         DROP  IOSBREG                                         YM02594K 07800002
         LR    IOSBREG,ERREG1      REBASE IOSB                 YM02594K 07850002
         USING IOSB,IOSBREG                                    YM02594K 07900002
         MVC   IOBSTBYT(L4),IOSTATUS   MOVE STATUS AND COUNT   YM02594K 07950002
FIRST    EQU   *                                                        08000002
         MVC   IOBSENS0(L2),IOSSNS   MOVE SENSE IOSB TO IOB             08050002
         MVC   IOBSIOCC(L1),IOSCC   MOVE SIO CC IOSB TO IOB             08100002
         MVC   IOBECBCC(L1),IOSCOD   MOVE ECB CC IOSB TO IOB            08150002
ERRBSC1  EQU   *                                                        08200002
         OI    IOSFLA,IOSEX        INSURE FLAG IS ON                    08250002
         OI    IOBFLAG1,IOBIOERR   ALSO IN IOB                          08300002
         SR    ERREG6,ERREG6       CLEAR WORK REGISTER                  08350002
         LA    ERREG2,ERRRTCON     SET UP FOR INDEXING                  08400002
         SR    ERREG1,ERREG1       CLEAR LINKAGE REGISTER               08450002
         SR    ERREG4,ERREG4       ZERO ERROR IN CONTROL                08500002
         TM    DCBOFLGS,X11        IS CLOSE IN PROCESS                  08550002
         BO    BSCCT025            IF SO, BRANCH                        08600002
         TM    IOBCSW+L4,CSWCCK    CHAN OR INTERFACE CTL CHECK          08650002
         BZ    NOTCHAN             NO CONTINUE                 @ZA31667 08700000
         BCT   ERREG1,BSCCT016     SUBTRACT 1 FROM REG 9       @ZA31667 08710000
NOTCHAN  L     CCWREG,IOBFL3       ADDRESS OF CCW              @ZA31667 08750000
         LA    CCWREG,ZERO(CCWREG)   CLEAR HI ORDER BYTE                08800002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                08850002
         OI    IOSFLB,IOSMSG       INDICATE I/O ERR TO MSG WT           08900002
         MVC   IOBWORK(L1),TPOPCODE(CCWREG)   SETUP WORK AREA           08950002
         NI    IOBWORK,L255-HIBIT  CLEAR UNUSED BITS                    09000002
         CLI   DECTYPE+1,RDINIT    READ INITIAL ?              @ZA28893 09001000
         BNE   ERRESTPL            NO, BRANCH                  @ZA28893 09002000
         TM    IOBFLAG2,RESETPL    RESETPL ISSUED ?            @ZA28893 09003000
         BNO   ERRESTPL            NO, BRANCH                  @ZA28893 09004000
         MVI   IOBERRCT,ERRMAXCT   SET RETRY TO MAX            @ZA28893 09005000
ERRESTPL EQU   *                                               @ZA28893 09006000
         TM    IOSFLA,IOSERR       ERP ROUTINE IN CONTROL               09050002
         BNO   BSCSAVE             NO,  SAVE SENSE, CSW INFO            09100002
         TM    IOBCSW+L3,CSWUCK    UNIT CHECK OCCUR                     09150002
         BO    BSCCT003            YES CONTINUE FLOW                    09200002
         STH   ERREG6,IOBSENS0     CLEAR SENSE INFO                     09250002
BSCCT003 EQU   *                                                        09300002
         IC    ERREG6,IOBERRCT+L1  BRANCH OFFSET TO LOADS               09350002
         LTR   ERREG6,ERREG6       ERROR RETURN                         09400002
         BP    BSCCT008(ERREG6)    YES, GO THERE                        09450002
         CLI   L5(CCWREG),ZERO     ANY TP OP CODE                       09500002
         BNE   BSCCT002            YES                                  09550002
         TM    IOBCSW+L3,XF3       ANYTHING OTHER THAN CE/DE            09600002
         BNZ   BSCCT002            YES                                  09650002
         TM    IOBCSW+L3,CSWCDE    CHECK FOR BOTH CE AND DE             09700002
         BO    SETMAX              IF BOTH ON SET MAX RETRY             09750002
BSCCT002 OI    IOSFLA,IOSEX+IOSERR   INDICATE ERP IN CONTROL            09800002
         OI    IOBFLAG1,IOBERRTN+IOBIOERR   ALSO IN IOB                 09850002
         CLC   IOSSNS(L2),SCC3SNS   SIO CC3 SENSE                       09900002
         BNE   NOSIOCC3            NO                                   09950002
         TM    IOSCC,IOSCC3        SIO CC 3                    @ZA09345 10000000
         BO    BSCCT005            YES, BRANCH                 @ZA09345 10050000
NOSIOCC3 EQU   *                                                        10100002
         TM    IOSCC,IOSCC1        SIO COND CODE 1                      10150002
         BO    BSCCT016            YES                                  10200002
         TM    IOBCSW+L3,CSWASCB   ATTEN, STATUS MOD, CONTROL UNIT END  10250002
*                                  OR BUSY INDICATED                    10300002
         BNZ   BSCCT008            YES, SNO & ERROR POST                10350002
         TM    IOSTSA,CSWUCK       UNIT CHECK                           10400002
         BO    BSCCT009            YES                                  10450002
         TM    IOSTSB,CSWCHAIN     CHAINING CHECK                       10500002
         BO    BSCS001             YES                                  10550002
         TM    IOSTSB,CSWPROG      PROGRAM CHECK                        10600002
         BO    BSCS001             YES                                  10650002
         TM    IOSTSB,CSWPROT      PROTECTION CHECK                     10700002
         BO    BSCS001             YES                                  10750002
         TM    IOSTSA,CSWUNITE     UNIT EXCEPTION                       10800002
         BO    BSCUE0AA            YES                                  10850002
         TM    IOSTSB,CSWCDC       CHANNEL DATA CHECK                   10900002
         BO    BSCCT016            YES                                  10950002
BSCS002  LTR   ERREG4,ERREG4       FIRST TIME THRU ERP (SET BY BSCSAVE) 11000002
         BZ    BSCCT004            NO, POST  NORMAL RETURN              11050002
         OI    DECERRST,DECSNO     SET SHOULD NOT OCCUR                 11100002
BSCS001  OI    IOSFLB,IOSLOG       INDICATE OBR RECORDING               11150002
         B     BSCCT022            LINK TO ERROR POST                   11200002
SETMAX   MVI   IOBERRCT,ERRMAXCT   SET RETRY TO MAX                     11250002
         OI    DECERRST,DECSNO     SET SHOULD NOT OCCUR                 11300002
         B     BSCCT022            LINK TO ERROR POST                   11350002
BSCCT025 NI    IOSFLA,L255-IOSERR  TURN OFF IOB EXCEPTION               11400002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     11450002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 11460002
         B     RETRY               ERROR EXCP                           11500002
BSCCT004 NI    IOSFLA,L255-IOSEX-IOSERR   TURN OFF ERP CONTROL INDS.    11550002
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR   ALSO IN IOB            11600002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 11602002
         NI    EWASTUP,FIRSTBIT    TEST AND SET X'80'                   11610002
         BZ    RETRY               NO, POST COMPLETE                    11620002
         MVI   IOBSENS0,ZERO                                            11650002
         OI    IOSFLB,IOSLOG       SET LOGOUT REQUIRED                  11700002
         MVI   EWAIND1,EWAISTAT    STAT UPDATE EXIT            YM05652K 11710002
RETRY    EQU   *                                                        11750002
         L     NAMEREG,TRANSRTN    LOAD NAME FOR 904B          YM02594K 11800002
         B     XCTLOUT             XCTL                                 11850002
BSCSAVE  MVC   IOBERCCW+L16(L1),IOBSENS0   MOVE SENSE INFO TO AREA      11900002
         MVC   IOBERCCW+L17(L7),IOBCSW   MOVE CSW TO AREA               11950002
         XC    IOBWORK+L1(L3),IOBWORK+L1   CLEAR WORK AREA              12000002
         XC    IOBERCCW(L8),IOBERCCW   CLEAR ERP CCW AREA               12050002
         LR    ERREG4,IOBRG                                             12100002
         B     BSCCT002            SET ERP IN CONTROL                   12150002
BSCCT005 EQU   *                                              LD YM8278 12160000
         L     ERREG2,IOSUCB       GET ADDR OF UCB            LD YM8278 12190000
         LA    ERREG2,ZERO(ERREG2) CLEAR HIGH ORDER BYTE      LD YM8278 12192000
         LR    ERREG1,IOSBREG      SAVE IOSB ADDR             LD YM8278 12194000
         MVC   EWAIEXIT(L16),EXITADDR MOVE ESTAE LIST         LD YM8278 12196000
         LA    PARMREG,EWAIEXIT    POINT TO ESTAE LIST        LD YM8278 12196400
         ESTAE MF=(E,(1))          SETUP RECOVERY RTN         LD YM8278 12196800
         L     ERREG3,SAVE         SUBPOOL AND LENGTH         LD YM8278 12197200
*                                  GET STORAGE FOR PARM WORD  LD YM8278 12197600
         GETMAIN R,LV=(0)          AND SAVEAREA               LD YM8278 12198000
         LA    NAMEREG,L4(PARMREG) ADDRESS OF SAVEAREA        LD YM8278 12198400
         ST    ERREG2,ZERO(PARMREG) INITIALIZE PARM WORD      LD YM8278 12198600
         LINK  EPLOC=IECVIOPM      LINK TO CHECK ALT PATH      @ZA09351 12207700
*                                            ALT. PATH                  12215700
         LR    ERREG4,ERREG5       SAVE RETURN CODE           LD YM8278 12226600
*                                  FREE STORAGE FOR PARM      LD YM8278 12227000
         L     ERREG3,SAVE         SUBPOOL AND LENGTH         LD YM8278 12227400
         FREEMAIN R,LV=(0),A=(1)   AND SAVEAREA               LD YM8278 12228600
         ESTAE 0                   CLEAR OUT RECOVERY RTN      @ZA04868 12230600
         LR    IOSBREG,ERREG1      RESTORE IOSB REG           LD YM8278 12232600
         LTR   ERREG4,ERREG4       CHECK FOR 0 RTN CODE       LD YM8278 12233000
         BZ    RETRY               RC=0, RETRY ON NEW PATH    LD YM8278 12233100
         LH    NAMEREG,ERLOD16     INT REQ MSG WRITER ADDRESS           12233300
         B     XCTLOUT             LINK TO MSG WRITER                   12250002
BSCCT009 TM    IOBCSW+L3,CSWCDE    BOTH CHAN AND DEV END OFF            12300002
         BZ    BSCCT016            INITIAL SELECTION                    12350002
BSCCT012 EQU   *                                                        12400002
         L     ERREG5,CVTPTR       POINT TO CVT                         12450002
         USING CVTMAP,ERREG5                                            12500002
         L     ERREG5,CVTXITP      POINT TO INTERPRETER                 12550002
         DROP  ERREG5                                                   12600002
BSCCT014 BALR  ERRETR,ERREG5       EXIT TO INTERPRETER RTNE             12650002
         DC    X'03'                         EQUIPMENT CHECK            12700002
         DC    AL1(BSCCT016-BSCCT014-2)                                 12750002
         DC    X'06'                         LOST DATA                  12800002
         DC    AL1(BSCCT018-BSCCT014-4)                                 12850002
         DC    X'07'                         TIME OUT                   12900002
         DC    AL1(BSCCT020-BSCCT014-6)                                 12950002
         DC    X'01'                         INTERVENTION REQUIRED      13000002
         DC    AL1(BSCCT021-BSCCT014-8)                                 13050002
         DC    X'02'                         BUS-OUT CHECK              13100002
         DC    AL1(BSCCT017-BSCCT014-10)                                13150002
         DC    X'04'                         DATA CHECK                 13200002
         DC    AL1(BSCCT023-BSCCT014-12)                                13250002
         DC    X'05'                         OVERRUN                    13300002
         DC    AL1(BSCCT017-BSCCT014-14)                                13350002
         DC    X'00'                         COMMAND REJECT             13400002
         DC    AL1(BSCCT016-BSCCT014-16)                                13450002
         DC    X'2F'                         END OF TEST                13500002
         DC    AL1(BSCCT008-BSCCT014-18)                                13550002
BSCCT008 OI    DECERRST,CSWSNO     SET SHOULD NOT OCCUR ERR             13600002
BSCCT016 AR    ERREG1,ERREG2       ENTRY EQUIP CHECK                    13650002
BSCCT017 AR    ERREG1,ERREG2       ENTRY BUSOUT OVERRUN                 13700002
BSCCT018 AR    ERREG1,ERREG2       ENTRY LOST DATA                      13750002
         NOP   ZERO                NO OPERATION INSTRUCTION   LD YM7711 13760000
         OC    EWASTUP(L1),IOBSENS0   SET FOR STAT UPDATE               13800002
BSCCT019 AR    ERREG1,ERREG2       ENTRY SPEC RETURN                    13850002
BSCCT020 AR    ERREG1,ERREG2       ENTRY 2ND LOAD T/O RTN               13900002
BSCCT021 AR    ERREG1,ERREG2       ENTRY INTERVENTION REQ               13950002
BSCCT022 AR    ERREG1,ERREG2       ENTRY ERROR POST                     14000002
BSCCT023 LA    NAMEREG,BSCLOD1(ERREG1)  ENTRY DATA CHECK                14050002
         B     XCTLOUT             LINK TO NEXT ERP MODULE              14100002
BSCUE0AA CLI   ZERO(CCWREG),CCWREAD   IS THIS READ OPERATION            14150002
         BNE   BSCUE0TP            NO                                   14200002
         LTR   ERREG4,ERREG4       FIRST TIME THRU ERP                  14250002
         BZ    BSCEREAD            NO, CHECK TP-OP CODE                 14300002
         CLI   IOBWORK,X11         READ TEXT                            14350002
         BNE   BSCUE0A1            NO, LOAD UNIT EXCEPTION              14400002
         LH    ERREG4,L6(CCWREG)   PICK UP ORIG CT                      14450002
         BCTR  ERREG4,ZERO         SUBTRACT ONE                         14500002
         CH    ERREG4,IOBCSW+L5    THIS COUNT = RESIDUAL COUNT          14550002
         BNE   CHKSOHR             NO, CHK FOR SOH%R MSG                14600002
         L     ERREG4,ZERO(CCWREG)   ENQ POINTER                        14650002
         CLC   ZERO(L1,ERREG4),DCBBSENQ   ENQ RECEIVED                  14700002
         BNE   BSCUE0A1            NO, LOAD UNIT EXCEPTION              14750002
         TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFER                       14800002
         BO    BSCUET09            YES, POST WITH ERROR                 14850002
         CLI   DECTYPE+L1,X13      RD CONT/GRAPHICS                     14900002
         BE    BSCUETAB            YES, BRANCH                          14950002
         CLI   DECTYPE+L1,X17      RD REPEAT/GRAPHICS                   15000002
         BNE   BSCUE0A1            NO, LOAD UNIT EXCEPTION              15050002
BSCUETAB SH    CCWREG,ERRCN16      BACK UP TO WR GRAPHICS               15100002
         B     BSCUETA7            BRANCH TO EXECUTE                    15150002
CHKSOHR  L     ERREG4,IOBERINF     GET ADDR OF INPUT AREA               15200002
         TM    DCBXCODE,ASCII      IS IT ASCII XMISSION CODE            15250002
         BO    USEASCII            YES, TEST FOR SOH%R IN ASCII         15300002
         CLC   ZERO(SOHRLNG,ERREG4),EBCSOHR   IS IT AN EBCDIC SOH%R     15350002
*                                  MESSAGE                              15400002
         BNE   BSCUE0A1            NO, LOAD UNIT EXCEPTION              15450002
         ST    ERREG4,IOBERINF     SAVE ADDR OF SOH%R MSG               15500002
         B     XFERCTL             YES, SET UP TO TRANSFER              15550002
*                                  CONTROL TO ERROR POST                15600002
USEASCII CLC   ZERO(SOHRLNG,ERREG4),ASCSOHR   IS IT ASCII SOH%R MSG     15650002
         BNE   BSCUE0A1            NO, LOAD UNIT EXCEPTION              15700002
XFERCTL  L     NAMEREG,LOAD3270    LOAD ADDR OF 3270 ERROR POST         15750002
         B     XCTLOUT             EXIT VIA XCTL ROUTINE                15800002
BSCUE0A1 L     NAMEREG,ERLOD904                                         15850002
         B     XCTLOUT                                                  15900002
BSCUE0TP CLI   IOBWORK,TPOPERP     THIS ERP WR CCW                      15950002
         BNE   BSCUE0A1            NO, GO TO UNIT EXCEPTION             16000002
         L     ERREG4,ZERO(CCWREG)   GET WR CHAR                        16050002
         CLC   ZERO(L1,ERREG4),DCBBSENQ   IS THIS ERP WR ENQ            16100002
         BNE   BSCUE02G            CHECK FOR NAK                        16150002
         MVI   IOBWORK+L1,RTRNCD3   SET SP RETURN                       16200002
         B     BSCUET2A            COMPLETE RD SKIP CHAN PROG           16250002
BSCUE02G CLC   ZERO(L1,ERREG4),DCBBSNAK   IS THIS ERP WR NAK            16300002
         BNE   BSCUE0A1            NO, GO TO UNIT EXCEPTION             16350002
         MVI   IOBWORK+L1,RTRNCD8   SET SP RETURN              @ZA24270 16400000
BSCUET2A LA    ERREG5,CCWNOP       SET 2ND COMMAND FOR NO-OP            16450002
BSCUE02B LA    ERREG2,IOBWORK+L2   DATA ADDRESS                         16500002
         LA    ERREG4,CCWREAD      SET FIRST COMMAND FOR READ           16550002
BSCUET04 EQU   *                                                        16600002
BSCUET05 ST    ERREG2,IOBERCCW     STORE DATA ADDR IN CHAN PROG         16650002
         STC   ERREG4,IOBERCCW     STORE COMMAND IN 1ST CCW             16700002
BSCUET06 ST    ERREG4,IOBERCCW+L4   PUT COUNT IN CCW                    16750002
         CLI   IOBWORK+L1,ZERO                                          16800002
         BE    BSCUETA6                                                 16850002
         MVI   IOBERRCT+L1,RTRNSPCD                                     16900002
BSCUETA6 EQU   *                                                        16950002
         CLI   IOBWORK+L1,RTRNCD8   SPEC RETURN OF 88          @ZA24270 17000000
         BNE   BSCUE02H            BRANCH IF NOT                        17050002
BSCUE02J MVI   IOBERCCW+L4,X70     COM CH, SLI, SKIP                    17100002
         B     BSCUE02F                                                 17150002
BSCUE02H CLI   IOBWORK+L1,RTRNCD3   SPEC RETURN OF 83                   17200002
         BE    BSCUE02J            BRANCH IF YES                        17250002
         ST    CCWREG,IOBERCCW+L8   STORE TIC ADDR                      17300002
         MVI   IOBERCCW+L4,CHAINCDE   COM CH, SLI                       17350002
BSCUE02F STC   ERREG5,IOBERCCW+L8   STORE COMMAND IN 2ND CCW            17400002
         ST    ERREG4,IOBERCCW+L12   PUT COUNT IN CCW                   17450002
         LA    CCWREG,IOBERCCW     ADDR OF NEW CHAN PROG                17550002
         B     BSCUETA7            RETRY ERROR                          17600002
BSCEREAD EQU   *                                                        17650002
         CLI   L5(CCWREG),ZERO     IS THIS ERP CCW                      17700002
         BNE   BSCCT004            NO, POST NORMAL                      17750002
         L     CCWREG,IOBERCCW+L8   ADDRESS FAILING CCW                 17800002
BSCUETA7 ST    CCWREG,IOBSTART                                          17900002
BSCUET08 CLI   IOBERRCT,ERRMAXCT   RETRIES EXHAUSTED                    18050002
         BNL   BSCUET09            YES SET PERM ERROR                   18100002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  18150002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE                          18200002
         STC   ERREG1,IOBERRCT     RESTORE NEW COUNT                    18250002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 18260002
         B     RETRY               SET FOR EXIT                         18300002
BSCUET09 NI    IOSFLA,L255-IOSERR   INDICATE PERM ERROR                 18350002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     18400002
BSCUET0A LA    NAMEREG,BSCLOD2     ADDRESS OF ERROR POST                18450002
XCTLOUT  EQU   *                                                        18500002
         L     ERRETR,CVTPTR       POINT TO CVT                         18550002
         USING CVTMAP,ERRETR                                            18600002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUITNE                18650002
         DROP  ERRETR                                                   18700002
         BR    ERRETR              EXIT VIA XCTL ROUTINE                18750002
         EJECT                                                          18752000
**********                                                    LD YM8278 18760000
*                                                             LD YM8278 18770000
*        ESTAE EXIT ROUTINE                                   LD YM8278 18780000
*                                                             LD YM8278 18790000
**********                                                    LD YM8278 18792000
         SPACE 2                                                        18794000
EXITRTN  EQU   *                                              LD YM8278 18796000
         DROP  BASEREG                                        LD YM8278 18798000
         BALR  BASEREG,ZERO                                   LD YM8278 18798400
         USING *,BASEREG           ROUTINE ADDRESSABILITY     LD YM8278 18798800
*              PROCEED WITH ABEND                             LD YM8278 18799200
         SETRP                                                LD YM8278 18799600
         BR    ERRETR              RETURN TO TASK RECOVERY    LD YM8278 18799700
         EJECT                                                          18800002
**********                                                              18850002
*                                                                       18900002
*        CONSTANTS                                                      18950002
*                                                                       19000002
**********                                                              19050002
         SPACE 2                                                        19060000
EXITADDR ESTAE EXITRTN,MF=L                                   LD YM8278 19070000
         SPACE 2                                                        19080000
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       19100002
ERLOD904 DC    F'9043'                                                  19150002
LOAD3270 DC    F'7042'             3270 ERROR POST IDENT                19200002
ERRCN16  DC    H'16'                                                    19250002
ERRCN8   DC    H'8'                                                     19300002
ERLOD16  DC    H'6042'             WTOR ERP I.D.                        19350002
SCC3SNS  DC    X'10FE'             SPECIAL SENSE FOR SIOCC=3            19400002
EBCSOHR  DC    X'016CD9'           SOH%R SEQUENCE - EBCDIC              19450002
ASCSOHR  DC    X'012552'           SOH%R SEQUENCE - ASCII               19500002
         DS    0F                                                       19510000
SAVE     DC    X'FF00004C'         SUBPOOL 255 AND LENGTH     LD YM8278 19520000
IECVIOPM DC    C'IECVIOPM'                                    LD YM8278 19530000
PACHAREA DC    25C'004C'           PATCH AREA FOR MAINTENANCE           19550002
**********                                                              19600002
*                                                                       19650002
*        MISCELLANEOUS EQUATES                                          19700002
*                                                                       19750002
**********                                                              19800002
DYNBUF   EQU   X'08'               DYNAMIC BUFFERING                    19850002
DECSNO   EQU   X'40'               SHOULD NOT OCCUR FLAG                19900002
L255     EQU   X'FF'               AND MASK                             19950002
BSCLOD1  EQU   1043                BSC ERP BASE IDENT                   20000002
BSCLOD2  EQU   2043                BSC ERROR POST IDENT                 20050002
CSWCHAIN EQU   X'01'               CHAINING CHECK                       20100002
CSWPROG  EQU   X'20'               PROGRAM CHECK                        20150002
CSWPROT  EQU   X'10'               PROTECTION CHECK                     20200002
CSWUNITE EQU   X'01'               UNIT EXCEPTION                       20250002
CSWCDC   EQU   X'08'               CHANNEL DATA CHECK                   20300002
CSWASCB  EQU   X'F0'               ATTEN,STATUS,CTL UNIT,BUSY           20350002
CSWCCK   EQU   6                   CHAN CTL AND INTF CTL CHECK          20400002
CCWREAD  EQU   2                                                        20450002
RESETPL  EQU   X'01'                                           @ZA28893 20453000
RDINIT   EQU   X'01'                                           @ZA28893 20456000
CSWCDE   EQU   X'0C'               CHANNEL AND DEVICE END               20500002
CSWSNO   EQU   X'40'               SHOULD NOT OCCUR                     20550002
CSWUCK   EQU   X'02'               UNIT CHECK                           20600002
ERRRTCON EQU   1000                ERP LOAD MODULE INCREMENT            20650002
SIOCODE1 EQU   X'10'               START I/O CODE 1                     20700002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              20750002
L1       EQU   1                   LENGTH AND DISPLACEMENT              20800002
L2       EQU   2                   LENGTH AND DISPLACEMENT              20850002
L3       EQU   3                   LENGTH AND DISPLACEMENT              20900002
L4       EQU   4                   LENGTH AND DISPLACEMENT              20950002
L5       EQU   5                   LENGTH AND DISPLACEMENT              21000002
L6       EQU   6                   LENGTH AND DISPLACEMENT              21050002
L7       EQU   7                   LENGTH AND DISPLACEMENT              21100002
L8       EQU   8                   LENGTH AND DISPLACEMENT              21150002
L12      EQU   12                  LENGTH AND DISPLACEMENT              21200002
L16      EQU   16                  LENGTH AND DISPLACEMENT              21250002
L17      EQU   17                  LENGTH AND DISPLACEMENT              21300002
L124     EQU   124                 LENGTH AND DISPLACEMENT              21350002
XF3      EQU   X'F3'               ANYTHING OTHER THAN CE/DE            21400002
X11      EQU   X'11'               CLOSE FLAG                           21450002
X13      EQU   X'13'               READ CONTINUE/GRAPHICS               21500002
X17      EQU   X'17'               READ REPEAT/GRAPHICS                 21550002
X70      EQU   X'70'               ERROR CCW FLAGS                      21600002
CCWNOP   EQU   3                                                        21650002
CHAINCDE EQU   X'60'                                                    21700002
RTRNSPCD EQU   X'14'                                                    21750002
RTRNCD3  EQU   X'83'                                                    21800002
RTRNCD8  EQU   X'88'                                           @ZA24270 21850000
TPOPERP  EQU   X'00'                                                    21900002
WLR      EQU   X'40'               SLI FLAG                             21950002
TPOPCODE EQU   5                                                        22000002
HIBIT    EQU   X'C0'                                                    22050002
ERRMAXCT EQU   X'07'                                                    22100002
ASCII    EQU   X'14'               BIT SETTING FOR ASCII                22150002
FIRSTBIT EQU   X'7F'               FIRST BIT OF EWASTUP                 22160002
SOHRLNG  EQU   3                   3 CHARS ARE NEEDED TO RECOGNIZE      22200002
*                                  SOH%R MSG                            22250002
**********                                                              22300002
*                                                                       22350002
*        REGISTER DEFINITIONS                                           22400002
*                                                                       22450002
**********                                                              22500002
ERREG3   EQU   0                   WORK REG                             22550002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              22600002
PARMREG  EQU   IOSBREG             PARM REG FOR IECVIOPM      LD YM8278 22610000
ERREG2   EQU   2                   WORK REG                             22650002
ERREG4   EQU   3                   WORK REG                             22700002
CCWREG   EQU   4                   CCW ADDRESS REG                      22750002
DECBRG   EQU   5                   DECB BASE                            22800002
DCBREG   EQU   6                   DCB BASE                             22850002
EWAREG   EQU   7                   ERP WORKAREA BASE                    22900002
BASEREG  EQU   8                   PROGRAM BASE                         22950002
ERREG1   EQU   9                   WORK REG                             23000002
IOBRG    EQU   10                  IOB BASE                             23050002
ERREG6   EQU   11                  WORK REG                             23100002
ERRLNK   EQU   12                  LINK REG                             23150002
NAMEREG  EQU   13                  LINK REG                             23200002
ERRETR   EQU   14                  LINK REG                             23250002
ERREG5   EQU   15                  LINK REG/WORK REG                    23300002
         EJECT                                                          23350002
         IECTDECB                                                       23400002
         EJECT                                                          23450002
         DCBD  DSORG=BX,DEVD=BS              DCB DESECT MACRO           23500002
         EJECT                                                          23550002
         IECDRQE                                                        23600002
         EJECT                                                          23650002
         IEZIOB                                                         23700002
         EJECT                                                          23750002
CVT      DSECT                                                          23800002
         CVT                                                            23850002
         EJECT                                                          23900002
         IECDERWA                                                       23950002
**********                                                              24000002
*                                                                       24050002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        24100002
*                                                                       24150002
**********                                                              24200002
         ORG   EWAIERP                                                  24250002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 24300002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 24350002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 24400002
EWAIND0  DS    B                   FLAG BYTE                            24450002
EWAIVISR EQU   X'10'               V=R REQUEST                          25050002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 25100002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 25150002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 25200002
EWAIND1  DS    B                   FLAG BYTE                            25250002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 25300002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 25350002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 25400002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 25410002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 25420002
EWAIND2  DS    B                   FLAG BYTE                            25450002
EWAIND3  DS    B                   FLAG BYTE                            25500002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     25550002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  25600002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 25650002
*********  END OF BTAM LOCAL DEFINITIONS **********                     25700002
         EJECT                                                          25750002
         IHAPSA                                                         25760000
         EJECT                                                          25770000
         IECDTCCW                                                       25800002
         EJECT                                                          25850002
         IECDIOCM                                                       25900002
         EJECT                                                          25950002
         IECDIOSB                                                       26000002
         EJECT                                                          26010000
         IHASDWA                                                        26020000
         END                                                            26050002
./  ADD  SSI=72980185,NAME=IGE0104A
         TITLE 'IGE0104A - BTAM ERROR DATA CHECK LOAD ONE'              00550002
IGE0104A CSECT                                                          00600002
*********************************************************************** 00650002
*                                                                     * 00700002
* MODULE NAME:                                                        * 00750002
*    IGE0104A                                                         * 00800002
*                                                                     * 00850002
* DESCRIPTIVE NAME:                                                   * 00900002
*    BTAM ERROR DATA CHECK LOAD ONE                                   * 00950002
*                                                                     * 01000002
* COPYRIGHT:                                                          * 01050002
*    NONE                                                             * 01100002
*                                                                     * 01150002
* STATUS:                                                             * 01200002
*    CHANGE LEVEL 000                                                 * 01250002
*                                                                     * 01300002
* FUNCTION:                                                           * 01350002
*    THIS MODULE IS ENTERED ON THE OCCURRENCE OF A DATA CHECK ERROR.  * 01400002
*    A CHECK IS MADE TO DETERMINE IF THE ERROR OCCURRED BEFORE,       * 01450002
*    DURING, OR AFTER TEXT TRANSFER.  IF REQUIRED, A CHANNEL          * 01500002
*    PROGRAM IS CONSTRUCTED AND EXECUTED.  LINKAGE IS PROVIDED        * 01550002
*    TO DATA CHECK LOAD TWO AND THE DIAGNOSTIC WRITE/READ ROUTINES.   * 01600002
*                                                                     * 01650002
* NOTES:                                                              * 01700002
*    DEPENDENCIES:                                                    * 01750002
*        NONE                                                         * 01800002
*    RESTRICTIONS:                                                    * 01850002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01900002
*    REGISTER CONVENTIONS:                                            * 01950002
*        SEE 'REGISTER DEFINITION' BELOW                              * 02000002
*                                                                     * 02050002
* PATCHLABEL:                                                         * 02100002
*    PACHAREA (60 BYTES)                                              * 02150002
*                                                                     * 02200002
* MODULE TYPE:                                                        * 02250002
*    PROCEDURE                                                        * 02300002
*    PROCESSOR:                                                       * 02350002
*        BAL                                                          * 02400002
*    MODULE SIZE:                                                     * 02450002
*        614 BYTES                                                    * 02500002
*    ATTRIBUTES:                                                      * 02550002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02600002
*                                                                     * 02650002
* ENTRY POINT:                                                        * 02700002
*    IGE0104A                                                         * 02750002
*    PURPOSE:                                                         * 02800002
*        SEE 'FUNCTION'                                               * 02850002
*    LINKAGE:                                                         * 02900002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02950002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 03000002
*    INPUT:                                                           * 03050002
*        REG 1 = ADDRESS OF IOSB                                      * 03100002
*    OUTPUT:                                                          * 03150002
*        CREATES NEW CHANNEL PROGRAM FOR RECOVERY                     * 03200002
*                                                                     * 03250002
* EXITS-NORMAL:                                                       * 03300002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03400002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03450002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03500002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03550002
*        LOADS ARE 1000 GREATER.                                      * 03600002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03650002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03700002
*                                                                     * 03750002
* EXITS-ERROR:                                                        * 03800002
*    NONE                                                             * 03850002
*                                                                     * 03900002
* EXTERNAL REFERENCES:                                                * 03950002
*    ROUTINES:                                                        * 04000002
*        NONE                                                         * 04050002
*    DATA AREAS                                                       * 04100002
*        IOB (MAPPED BY IEZIOB)                                       * 04150002
*        VIRTUAL CHANNEL PROGRAM                                      * 04200002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04250002
*    CONTROL BLOCKS                                                   * 04300002
*        UCB                                                          * 04350002
*        DCB                                                          * 04400002
*        DECB                                                         * 04450002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04500002
*        CVT          (MAPPED BY CVT)                                 * 04550002
*        IOB          (MAPPED BY IEZIOB)                              * 04600002
*        RQE          (MAPPED BY IECDRQE)                             * 04650002
*                                                                     * 04700002
* TABLES-WORKAREAS:                                                   * 04750002
*    ERP WORKAREA                                                     * 04800002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04850002
*                                                                     * 04900002
* MACROS:                                                             * 04950002
*    READ                                                             * 05000002
*                                                                     * 05050002
* CHANGE ACTIVITY:                                                    * 05100002
*    YM02595K (9/20/73)                                               * 05150002
*    YM02594K (9/24/73)                                               * 05200002
*    YM05652K (1/24/74)                                               * 05210002
*    ZA00504  (5/9/74)                                                * 05220000
*    ZA26418  (10/11/77)                                              * 05250000
*********************************************************************** 05300002
         EJECT                                                          05350002
         USING *,BASEREG                                                05400002
         LR    BASEREG,ERREG6      SET BASE REG                         05450002
         B     BEGIN                                           @ZA00504 05460000
         DC    C' IGE0104A '       MODULE NAME                 @ZA00504 05470000
         DC    XL3'014830'         PTF NUMBER                  @ZA26418 05480000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY          @ZA00504 05490000
BEGIN    DS    0H                                              @ZA00504 05492000
         USING RQE,ERREG5                                               05500002
         USING IOSB,IOSBREG                                             05550002
         USING IOBSTDRD,IOBRG                                           05600002
         USING EWA,EWAREG                                               05650002
         L     ERREG5,IOSUSE       BASE RQE                             05700002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05750002
         L     IOBRG,RQEIOB        BASE IOB                             05800002
         L     DECBRG,IOBECBPT     BASE DECB                            05850002
         L     DCBREG,IOBDCBPT     BASE DCB                             05900002
         DROP  ERREG5                                                   05950002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       06000002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06050002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                06100002
         MVC   IOBWORK(L1),L5(CCWREG)   MOVE TP OP CODE TO WORK AREA    06150002
         NI    IOBWORK,L255-CCWMASK1   MASK OUT UNUSED BITS             06200002
         MVC   IOBWORK+L1(L1),DECTYPE+L1(DECBRG)   OPERATION TYPE       06250002
         NI    IOBWORK+L1,L255-HIBIT   MASK OUT RESET BIT               06300002
         L     UCBREG,IOSUCB       BASE UCB                             06350002
         MVC   IOBWORK+L2(L1),UCBTYP+L3(UCBREG)   ADAPTER TYPE          06400002
         NI    IOBWORK+L2,MASK3    MASK OUT UNUSED HALF BYTE            06450002
         MVC   IOBWORK+L3(L1),UCBTYP+L3(UCBREG)   CONTROL UNIT TYPE     06500002
         NI    IOBWORK+L3,MASK15   MASK OUT UNUSED HALF BYTE            06550002
         CLI   ZERO(CCWREG),CCWAPOLL   POLL COMMAND                     06600002
         BE    ERRDCD09            YES CALL IN SECOND LOAD              06650002
         CLI   ZERO(CCWREG),CCWINCMD   INHIBIT COMMAND                  06700002
         BE    READ                YES                                  06750002
         CLI   ZERO(CCWREG),CCWRDCMD   READ COMMAND                     06800002
         BNE   ERRDCD09            NO CALL IN SECOND LOAD               06850002
READ     EQU   *                                                        06900002
         TM    IOBWORK,CCWPTXFR    READ PRIOR TO TEXT TRANSFER          06950002
         BZ    ERRDCD09            YES CALL IN SECOND LOAD              07000002
         TM    DCBBFTEK(DCBREG),X08   IS DYNAMIC BUFFERING SPECIFIED    07050002
         BZ    ERRDCD14            NO, TEST FOR DATA TRANS              07100002
         NI    IOSFLA,L255-IOSERR   TURN ERP CONTROL OFF                07150002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     07200002
         B     ERRDCD01            POST ERROR                           07250002
ERRDCD14 TM    IOBWORK,CCWTXTDT    DURING TEXT TRANSFER                 07300002
         BZ    ERRDCD00            NO CHECK FOR READ RESPONSE TEXT      07350002
         TM    DCBERROP(DCBREG),DCBRDTRY   READ RETRY SPECIFIED         07400002
         BZ    ERRDCD01            NO CHECK FOR LERB                    07450002
         CLI   IOBERRCT,ERTRYCT    MORE RETRIES NECESSARY               07500002
         BNL   ERRDCD08            NO SET TO CALL SECOND LOAD           07550002
         CLI   IOBWORK+L1,DECRDRPT   OPERATION TYPE READ REPEAT         07600002
         BE    ERRDCD03            YES RE-EXECUTE CHANNEL PROGRAM       07650002
         CLI   IOBWORK+L1,DECWRTTV   OPERATION WRITE TTV                07700002
         BNE   ERRDCD13            NO                                   07750002
         LA    ERREG2,IOBCPA       POINT TO FIRST CCW                   07850002
NEXTCCW  EQU   *                                                        07900002
         LA    ERREG2,L8(ERREG2)   POINT TO NEXT CCW                    07950002
         CLI   L5(ERREG2),RESET    FIND READ TV PART OF WRITE TTV       08000002
         BNE   NEXTCCW             NO                                   08050002
         ST    ERREG2,IOBSTART     SET RESTART ADDRESS                  08250002
         B     ERRDCD03            EXECUTE CHANNEL PROGRAM              08300002
ERRDCD13 EQU   *                                                        08350002
         NI    DECTYPE+L1(DECBRG),HIBIT   CLEAR LOW ORDER 6 BITS OF     08400002
*                                  TYPE                                 08450002
         OI    DECTYPE+L1(DECBRG),DECRDRPT   SET OPERATION TYPE         08500002
*                                  TO READ TP                           08550002
ERRDCD10 TM    DECTYPE(DECBRG),AUTOPOLL   IS AN AUTOPOLL OPERATION      08600002
         BZ    ERRDCD07            IN PROGRESS.  IF NOT, BRANCH.        08650002
         L     ERREG4,DECAREA(DECBRG)   LOAD MESSAGE AREA ADDRESS       08700002
         MVC   DECPOLPT(L1,DECBRG),ZERO(ERREG4)   AND SAVE INDEX BYTE.  08750002
ERRDCD07 EQU   *                                                        08800002
         LR    ERREG2,IOSBREG      SAVE IOSB POINTER                    08850002
         OI    IOBINCAM,ERPBIT     ERP IN CONTROL BIT                   08900002
         LA    NAMEREG,EWAIAREA    REGISTER SAVE AREA ADDRESS           08950002
         LR    IOSBREG,DECBRG      DECB ADDRESS IN PARAMETER REG        09000002
         READ  (1),T,MF=E          CONSTRUCT CHANNEL PROGRAM            09050002
         LR    IOSBREG,ERREG2      RESTORE IOSB BASE                    09100002
         NI    IOBINCAM,L255-ERPBIT   TURN OFF ERP BIT                  09250002
ERRDCD03 IC    ERREG2,IOBERRCT     RETRY COUNT UPDATE                   09300002
         LA    ERREG2,L1(ERREG2)   BUMP COUNT BY ONE                    09350002
         STC   ERREG2,IOBERRCT     STORE BACK                           09400002
         MVI   IOBSENS0,ZERO       CLEAR SENSE BYTE                     09450002
         TM    DCBERROP(DCBREG),DCBLERB   IS LERB REQUIRED              09500002
         BO    ERRDCD04            YES                                  09550002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 09600002
         L     NAMEREG,TRANSRTN    LOAD NAME                            12350002
         B     ERRDCD05            XCTL                                 12400002
ERRDCD04 LA    NAMEREG,ERLOD12     ADDRESS OF  LERB ROUTINE             12650002
         MVI   IOBERRCT-L1,LERBDC   INDICATE DATA CHECK ERROR           12700002
ERRDCD05 EQU   *                                                        12750002
         L     ERRETR,CVTPTR       POINT TO CVT                         12800002
         USING CVT,ERRETR                                               12850002
         L     ERRETR,CVTXTLER     XCTL ROUTINE NAME                    12900002
         BR    ERRETR              XCTL                                 12950002
         DROP  ERRETR                                                   13000002
ERRDCD00 CLI   IOBWORK,CCWRRTXT    READ RESPONSE TO TEXT                13050002
         BNE   ERRDCD01            NO CHECK FOR LINE ERROR RECORDS      13100002
         TM    DCBERROP(DCBREG),CCWRTRT   LINE ERROR RECORDING REQUIRED 13150002
         BO    ERRDCD06            YES CHECK COUNT                      13200002
ERRDCD01 TM    DCBERROP(DCBREG),DCBLERB   LINE ERROR RECORDING REQUIRED 13250002
         BO    ERRDCD02            YES SET UP FOR LERB                  13300002
         LH    NAMEREG,ERLOD5      ADDRESS OF ERROR POST                13350002
         NI    IOSFLA,L255-IOSERR   INDICATE PERM ERROR        @ZA26418 13360000
         NI    IOBFLAG1,L255-IOBERRTN    IOB ALSO              @ZA26418 13370000
         B     ERRDCD05            BRANCH TO POST ROUTINE               13400002
ERRDCD02 MVI   IOBERRCT-L1,LERBDC   INDICATE DATA CHECK TO LERB         13450002
         NI    IOSFLA,L255-IOSERR   INDICATE PERM ERROR                 13500002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     13550002
         B     ERRDCD04            EXIT TO LERB PRINT ROUTINE           13600002
ERRDCD06 CLI   IOBERRCT,ERTRYCT    RETRY COUNT AT MAXIMUM               13650002
         BNL   ERRDCD08            YES, CALL IN SECOND LOAD             13700002
         CLI   IOBWORK+L1,CCWWRTCT   OPERATION TYPE WRITE CONTINUE      13800002
         BE    ERRDCD03            YES RETRY CHAN PROG                  13850002
         CLI   IOBWORK+L1,TTV      OPERATION TYPE WRITE TTV             13900002
         BE    ERRDCD03            YES, RETRY CHANNEL PROGRAM           13950002
         L     UCBREG,IOSUCB       BASE UCB                             14050002
         TM    UCBTYP+L3(UCBREG),NOTADAP1   IS THIS ADAPTER TYPE I      14100002
         BNZ   ERRDCD12            NO, BRANCH                           14150002
         TM    UCBTYP(UCBREG),NOT2740   IS THIS 2740                    14200002
         BNZ   ERRDCD12            IF NOT BRANCH                        14250002
         TM    UCBTYP+L1(UCBREG),VERIMAT   IS THIS 2760                 14300002
         BNO   ERRDCD12            IF NOT, BRANCH                       14350002
         CLI   IOBWORK+L1,TIO      WRITE TIO                            14450002
         BE    ERRDCD11            BRANCH IF YES                        14500002
         CLI   IOBWORK+L1,TCO      WRITE TCO                            14550002
         BE    ERRDCD11            BRANCH IF YES                        14600002
         CLI   IOBWORK+L1,TVO      WRITE TVO                            14650002
         BE    ERRDCD11            BRANCH IF YES                        14700002
ERRDCD12 CLI   IOBWORK+L1,TCO      IS THIS A WRITE ERASE?               14750002
         BE    ERRDCD03            YES RETRY CHANNEL PROGRAM            14800002
         NI    DECTYPE+L1(DECBRG),HIBIT   CLEAR OPERATION TYPE CODE     14900002
         OI    DECTYPE+L1(DECBRG),CCWRTRT   OPERATION WRITE CONTINUE    14950002
         B     ERRDCD07            CONSTRUCT CHANNEL PROGRAM            15000002
ERRDCD08 MVI   IOBERRCT+L1,MASK3   INDICATE LERB CHECK ENTRY            15050002
ERRDCD09 LA    NAMEREG,ERLOD10     NAME OF DISABLE CHECK ROUTINE        15100002
         B     ERRDCD05            XCTL                                 15150002
ERRDCD11 EQU   *                                                        15200002
         SH    CCWREG,TWENTY4      BACK UP TO WR D PRE O CCW            15300002
         CLI   L7(CCWREG),L2       CHECK TO SEE IF A DATA CHECK ERROR   15500002
*                                  HAS ALREADY BEEN HANDLED ON          15550002
*                                  THIS OPERATION                       15600002
         BE    ERRDCD03            IF COUNT IS TWO, BRANCH BECAUSE      15650002
*                                  BECAUSE CCW HAS ALREADY BEEN ALTERED 15700002
         ST    CCWREG,IOBSTART     RESTART ON THIS ONE                  15900002
         L     ERREG2,ZERO(CCWREG)   DATA ADDRESS                       15950002
         LA    ERREG2,L1(ERREG2)   BUMP PAST EOA                        16000002
         STCM  ERREG2,L7,L1(CCWREG)   STORE IN CCW             @ZA00504 16050000
         L     ERREG2,L4(CCWREG)   DATA LENGTH                          16100002
         BCTR  ERREG2,ZERO         SUBTRACT 1                           16150002
         ST    ERREG2,L4(CCWREG)   STORE IN CCW                         16200002
         B     ERRDCD03            UPDATE RETRY COUNT                   16650002
         EJECT                                                          16700002
**********                                                              16750002
*                                                                       16800002
*        CONSTANTS                                                      16850002
*                                                                       16900002
**********                                                              16950002
TRANSRTN DC    F'9042'             BTAM TRANSLATE ROUTINE NAME          17000002
ERRCN8   DC    H'8'                ARITHMETIC                           17050002
ERLOD5   DC    H'5041'             XCTL NAME OF ERROR POST              17100002
TWENTY4  DC    H'24'               SIZE OF 3 CCWS                       17150002
PACHAREA DC    15C'104A'           PATCH AREA FOR MAINTENANCE           17200002
**********                                                              17250002
*                                                                       17300002
*        MISCELLANEOUS EQUATES                                          17350002
*                                                                       17400002
**********                                                              17450002
ERPBIT   EQU   X'08'                                                    17550002
NOTADAP1 EQU   X'E0'                                                    17600002
NOT2740  EQU   X'0B'                                                    17650002
VERIMAT  EQU   X'0C'                                                    17700002
CCWAPOLL EQU   X'09'                                                    17750002
CCWMASK1 EQU   X'C0'                                                    17800002
CCWPTXFR EQU   X'30'                                                    17850002
CCWINCMD EQU   X'0A'                                                    17900002
CCWRDCMD EQU   X'02'                                                    17950002
CCWRRTXT EQU   X'20'                                                    18000002
CCWRTRT  EQU   X'04'                                                    18050002
CCWTXTDT EQU   X'10'                                                    18100002
CCWWRTCT EQU   X'04'                                                    18150002
DECWRTTV EQU   X'0F'                                                    18200002
DCBBFTEK EQU   X'20'                                                    18250002
DCBERROP EQU   33                                                       18300002
DCBLERB  EQU   X'08'                                                    18350002
DCBRDTRY EQU   X'02'                                                    18400002
DECRDRPT EQU   X'07'                                                    18450002
DECTYPE  EQU   4                                                        18500002
DECAREA  EQU   12                                                       18550002
DECPOLPT EQU   36                                                       18600002
AUTOPOLL EQU   X'80'                                                    18650002
UCBTYP   EQU   16                                                       18700002
ERLOD10  EQU   42                                                       18750002
ERLOD12  EQU   2042                                                     18800002
ERTRYCT  EQU   X'02'                                                    18850002
HIBIT    EQU   X'C0'                                                    18950002
LERBDC   EQU   X'01'                                                    19000002
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              19050002
L1       EQU   1                   LENGTH AND DISPLACEMENT              19100002
L2       EQU   2                   LENGTH AND DISPLACEMENT              19150002
L3       EQU   3                   LENGTH AND DISPLACEMENT              19200002
L4       EQU   4                   LENGTH AND DISPLACEMENT              19250002
L5       EQU   5                   LENGTH AND DISPLACEMENT              19300002
L6       EQU   6                   LENGTH AND DISPLACEMENT              19350002
L7       EQU   7                   LENGTH AND DISPLACEMENT              19400002
L8       EQU   8                   LENGTH AND DISPLACEMENT              19450002
L255     EQU   255                 AND MASK                             19500002
X08      EQU   X'08'                                                    19550002
MASK3    EQU   X'F0'                                                    19650002
MASK15   EQU   X'0F'                                                    19700002
RESET    EQU   X'02'                                                    19750002
TCO      EQU   14                  OPERATION TYPE FOR WRITE TCO         19850002
TIO      EQU   12                  OPERATION TYPE FOR WRITE TIO         19900002
TTV      EQU   15                  OPERATION TYPE FOR WRITE TTV         19950002
TVO      EQU   18                  OPERATION TYPE FOR WRITE TVO         20000002
**********                                                              20050002
*                                                                       20100002
*        REGISTER DEFINITION                                            20150002
*                                                                       20200002
**********                                                              20250002
ERREG1   EQU   0                   WORK REG/PARAMETER REG               20300002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              20350002
ERREG2   EQU   2                   WORK REG                             20400002
ERREG3   EQU   3                   WORK REG                             20450002
CCWREG   EQU   4                   CCW ADDRESS REG                      20500002
DECBRG   EQU   5                   DECB BASE                            20550002
DCBREG   EQU   6                   DCB BASE                             20600002
UCBREG   EQU   7                   UCB BASE/WORK REG                    20650002
BASEREG  EQU   8                   PROGRAM BASE                         20700002
EWAREG   EQU   9                   ERP WORKAREA BASE                    20750002
IOBRG    EQU   10                  IOB BASE                             20800002
ERREG4   EQU   11                  WORK REG                             20850002
ERREG5   EQU   12                  LINK REG                             20900002
NAMEREG  EQU   13                  LINK REG                             20950002
ERRETR   EQU   14                  LINK REG                             21000002
ERREG6   EQU   15                  LINK REG,WORK REG                    21050002
         EJECT                                                          21100002
         IECDRQE                                                        21150002
         EJECT                                                          21200002
         IEZIOB                                                         21250002
         EJECT                                                          21300002
CVT      DSECT                                                          21350002
         CVT                                                            21400002
         EJECT                                                          21450002
         IECDERWA                                                       21500002
**********                                                              21550002
*                                                                       21600002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        21650002
*                                                                       21700002
**********                                                              21750002
         ORG   EWAIERP                                                  21800002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 21850002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 21900002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 21950002
EWAIND0  DS    B                   FLAG BYTE                            22000002
EWAIVISR EQU   X'10'               V=R REQUEST                          22600002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 22650002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 22700002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 22750002
EWAIND1  DS    B                   FLAG BYTE                            22800002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 22850002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 22900002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 22950002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 22960002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 22970002
EWAIND2  DS    B                   FLAG BYTE                            23000002
EWAIND3  DS    B                   FLAG BYTE                            23050002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     23100002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  23150002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 23200002
*********  END OF BTAM LOCAL DEFINITIONS **********                     23250002
         EJECT                                                          23900002
         IECDIOSB                                                       23950002
         END                                                            24000002
./  ADD  SSI=40240794,NAME=IGE0104B
         TITLE 'IGE0104B - BTAM ERP DIAGNOSTIC READ/WRITE MODULE'       00070002
IGE0104B CSECT                                                          00120002
*********************************************************************** 00170002
*                                                                     * 00220002
* MODULE NAME:                                                        * 00270002
*    IGE0104B                                                         * 00320002
*                                                                     * 00370002
* DESCRIPTIVE NAME:                                                   * 00420002
*    BTAM DIAGNOSTIC READ/WRITE ERP                                   * 00470002
*                                                                     * 00520002
* COPYRIGHT:                                                          * 00570002
*    NONE                                                             * 00620002
*                                                                     * 00670002
* STATUS:                                                             * 00720002
*    CHANGE LEVEL 000                                                 * 00770002
*                                                                     * 00820002
* FUNCTION:                                                           * 00870002
*    THIS MODULE GENERATES A DIAGNOSTIC WRITE/READ PROGRAM. IT SAVES  * 00920002
*    INFORMATION FROM THE CCW AND CSW. DISABLE IS EXECUTED            * 00970002
*    IF REQUIRED.                                                     * 01020002
*                                                                     * 01070002
* NOTES:                                                              * 01120002
*    DEPENDENCIES:                                                    * 01170002
*        NONE                                                         * 01220002
*    RESTRICTIONS:                                                    * 01270002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01320002
*    REGISTER CONVENTIONS:                                            * 01370002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01420002
*                                                                     * 01470002
* PATCHLABEL:                                                         * 01520002
*    PACHAREA (44 BYTES)                                              * 01570002
*                                                                     * 01620002
* MODULE TYPE:                                                        * 01670002
*    PROCEDURE                                                        * 01720002
*    PROCESSOR:                                                       * 01770002
*        BAL                                                          * 01820002
*    MODULE SIZE:                                                     * 01870002
*        450 BYTES                                                    * 01920002
*    ATTRIBUTES:                                                      * 01970002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02020002
*                                                                     * 02070002
* ENTRY POINT:                                                        * 02120002
*    IGE0104B                                                         * 02170002
*    PURPOSE:                                                         * 02220002
*        SEE 'FUNCTION'                                               * 02270002
*    LINKAGE:                                                         * 02320002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02370002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02420002
*    INPUT:                                                           * 02470002
*        REG 1 = ADDRESS OF IOSB                                      * 02520002
*    OUTPUT:                                                          * 02570002
*        SETS INDICATOR IN DECERRST FOR DISABLE EXECUTED              * 02620002
*        CREATES NEW CHANNEL PROGRAM FOR RECOVERY                     * 02670002
*                                                                     * 02720002
* EXITS-NORMAL:                                                       * 02770002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 02870002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 02920002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 02970002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03020002
*        LOADS ARE 1000 GREATER.                                      * 03070002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03120002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03170002
*                                                                     * 03220002
* EXITS-ERROR:                                                        * 03270002
*    NONE                                                             * 03320002
*                                                                     * 03370002
* EXTERNAL REFERENCES:                                                * 03420002
*    ROUTINES:                                                        * 03470002
*        NONE                                                         * 03520002
*    DATA AREAS                                                       * 03620002
*        IOB (MAPPED BY IEZIOB)                                       * 03670002
*        VIRTUAL CHANNEL PROGRAM                                      * 03720002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 03770002
*    CONTROL BLOCKS                                                   * 03820002
*        UCB                                                          * 03870002
*        DCB                                                          * 03920002
*        DECB                                                         * 03970002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04020002
*        CVT          (MAPPED BY CVT)                                 * 04070002
*        IOB          (MAPPED BY IEZIOB)                              * 04120002
*        RQE          (MAPPED BY IECDRQE)                             * 04170002
*                                                                     * 04320002
* TABLES-WORKAREAS:                                                   * 04370002
*    ERP WORKAREA                                                     * 04420002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04470002
*                                                                     * 04520002
* MACROS:                                                             * 04570002
*    NONE                                                             * 04620002
*                                                                     * 04670002
* CHANGE ACTIVITY:                                                    * 04720002
*    YM02595K (9/20/73)                                               * 04770002
*    YM02594K (9/24/73)                                               * 04780002
*    YM05652K (1/24/74)                                               * 04790002
*                                                                     * 04820002
*********************************************************************** 04870002
         EJECT                                                          04920002
         USING *,BASEREG                                                04970002
         LR    BASEREG,ERREG5      SET BASE REG                         05020002
         USING RQE,ERREG5                                               05070002
         USING IOSB,IOSBREG                                             05120002
         USING IOBSTDRD,IOBRG                                           05170002
         USING EWA,EWAREG                                               05220002
         L     UCBREG,IOSUCB       BASE UCB                             05270002
         L     ERREG5,IOSUSE       BASE RQE                             05320002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05370002
         L     IOBRG,RQEIOB        BASE IOB                             05420002
         L     DECBRG,IOBECBPT     BASE DECB                            05470002
         DROP  ERREG5                                                   05520002
         L     CCWREG,IOBFL3       GET ADDR OF CSW                      05570002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                05620002
         SH    CCWREG,ERRCN8       BACK UP ONE CCW                      05670002
ERE5C1   EQU   *                   ISSUE DIAGNOSTIC WRITE/READ HERE     05720002
         MVC   IOBERINF(L1),IOBSENS0   SAVE SENSE BYTE                  05770002
         MVC   IOBERINF+L1(L7),IOBCSW   SAVE 7 LOW ORDER BYTES OF       05820002
*                                  CHANNEL STATUS WORD                  05870002
         MVC   IOBERINF+L8(L8),ZERO(CCWREG)   SAVE FAILING CCW          05920002
         XC    IOBSENS0(L2),IOBSENS0   CLEAR SENSE BYTES                05970002
         MVI   IOBERRCT+L1,RTRNCDE   INDICATE DIAG W/R                  06020002
         LA    ERREG1,IOBCPA       START OF CHANNEL PROGRAM             06070002
         ST    ERREG1,IOBSTART     POINTER LOC FOR CCW                  06120002
         MVC   IOBCPA(L32),ERRSKEL1   PUT CHAN PROG IN IOB              06170002
         TM    UCBTYP+L3(UCBREG),M2702   CHECK 2702/2703                06220002
         BO    T27023              BRANCH IF 2702 OR 2703               06270002
         MVC   IOBWORK(L1),UCBTYP+L3(UCBREG)   MOVE ADAPTER             06320002
         NI    IOBWORK,MASK3       TYPE TO IOBWORK CLEAR BITS           06370002
         CLI   IOBWORK,MOD2260     CHECK FOR TYPE III ADAPTER           06420002
         BNE   T27023              BRANCH IF NOT                        06470002
         MVI   IOBCPA+L16,RDCMD2   DIAG READ CMND IN CCW                06520002
         B     T2701               MOVE TP OP CODE                      06570002
T27023   MVI   IOBCPA+L16,RDCMD    DIAG READ COMMAND IN CCW             06620002
T2701    MVI   IOBCPA+L21,DIAGTPRD   MOVE IN TPOP CODE                  06670002
         LA    ERRLNK,L8           SET UP TO                            06720002
         LA    ERREG1,L4           GENERATE CORRECT                     06770002
         LA    ERREG2,L24          DATA ADDRESS IN                      06820002
         LA    ERREG4,IOBWORK      CCW'S FOR DIAG WR/RD                 06870002
ERERPT   L     NAMEREG,IOBCPA(ERREG2)   FIRST WORD OF CCW               06920002
         AR    NAMEREG,ERREG4      ADD DATA ADDR                        06970002
         ST    NAMEREG,IOBCPA(ERREG2)   STORE IN CCW                    07020002
         SR    ERREG2,ERRLNK       DETERMINE NEXT CCW                   07070002
         BCT   ERREG1,ERERPT       REPEAT IF MORE CCW'S                 07120002
         MVC   IOBWORK(L1),UCBTYP+L3(UCBREG)   PICK UP DEV TYPE IND     07170002
         NI    IOBWORK,MASK3       CLEAR UNUSED BITS                    07220002
         CLI   IOBWORK,MOD2260     IS THIS A 2260                       07270002
         BNE   ERECK01             NO CHECK FOR SWITCHED LINE           07320002
         L     ERREG1,IOBSTART     PICK UP CPA POINTER                  07370002
         LA    ERREG1,L8(ERREG1)   BUMP PAST DISABLE                    07420002
         ST    ERREG1,IOBSTART     RESTORE POINTER                      07470002
         B     ERECLNP             EXECUTE CHAN PROGRAM                 07520002
ERECK01  EQU   *                                                        07570002
         TM    UCBTYP+L1(UCBREG),SWLINE   THIS A SWITCHED LINE          07620002
         BNZ   ERECLNP             YES CHAN PROG IS COMPLETE            07670002
         MVI   IOBCPA+L20,CHAINCDE   CHAIN IN ENABLE COMMAND            07720002
ERECLNP  MVC   IOBWORK(L1),UCBTYP+L3(UCBREG)   DEVICE DATA TO IOBWORK   07770002
         NI    IOBWORK,MASK3       MASK OUT EXTRA BITS                  07820002
         TM    IOBWORK,MASK4       CHECK FOR 2260,83B3 OR 115A          07870002
         BZ    EREMV01             YES SET UP FOR MOVE                  07920002
         NI    IOBWORK,MASK5       CHECK FOR TWX ADAPTERS 1 OR 2        07970002
         BZ    EREMV02             ADAPTERS 1,2,3 IF BRANCH             08020002
         OI    IOBWORK,MASK6       TWX SPACIFIED                        08070002
EREMV01  SR    ERREG1,ERREG1       CLEAR REGISTER                       08120002
         IC    ERREG1,IOBWORK      PICK UP INDEX                        08170002
         SRL   ERREG1,L3           ADJUST FOR CHAR COUNT                08220002
EREMV02  LA    ERREG1,ERRDATA1(ERREG1)   RESOLVE DATA ADDRESS           08270002
         MVC   IOBWORK(L7),ZERO(ERREG1)   MOVE DATA INTO BUFFER         08320002
         OI    IOBFLAG1,IOBCMDCH   INDICATE CHAINED CHAN PROG           08370002
         OI    IOSFLA,IOSCCHN      COMMAND CHAINED                      08420002
         TM    UCBTYP+L1(UCBREG),SWLINE   THIS A SWITCHED LINE          08470002
         BZ    EXCP                NO, DON'T SET FLAG                   08520002
         OI    DECERRST(DECBRG),DISABLOK   SET DISABLE EXECUTED         08570002
EXCP     EQU   *                                                        08620002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 08670002
         L     NAMEREG,TRANSRTN    LOAD ROUTINE NAME           YM02594K 08720002
         USING CVTMAP,ERRETR                                   YM02594K 08820002
         L     ERRETR,CVTPTR       POINT TO CVT                YM02594K 08870002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE       YM02594K 08920002
         BR    ERRETR              GO TO IT                    YM02594K 08970002
         DROP  ERRETR                                          YM02594K 09020002
         EJECT                                                          09670002
**********                                                              09720002
*                                                                       09770002
*        CONSTANTS                                                      09820002
*                                                                       09870002
**********                                                              09920002
         DS    0D                                                       09970002
ERRSKEL1 EQU   *                                                        10020002
         DC    X'2F00000060300007'   DISABLE COMMAND                    10070002
         DC    X'0500000060340007'   DIAG WRITE COMMAND                 10120002
         DC    X'0000000020000007'   DIAG READ COMMAND                  10170002
         DC    X'27000000203C0007'   ENABLE COMMAND                     10220002
ERRDATA1 DC    X'16626467686B3D00'   MESSAGE FORMAT ONE 1050'> ETC      10270002
         DC    X'18130E121B051F00'   MESSAGE FORMAT TWO 115A, 83B3      10320002
         DC    X'02A1A2A3A3A40300'   MESSAGE FORMAT THREE 2260'S        10370002
         DC    X'8343C323A36321'     MESSAGE FORMAT FOUR TWX            10420002
TRANSRTN DC     F'9042'            NAME OF BTAM TRANSLATE RTN  YM02594K 10430002
ERRCN8   DC    H'8'                DECIMAL 8                            10470002
PACHAREA DC    11C'104B'           PATCH AREA FOR MAINTENANCE           10520002
**********                                                              10570002
*                                                                       10620002
*        MISCELLANEOUS EQUATES                                          10670002
*                                                                       10720002
**********                                                              10770002
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              10820002
L1       EQU   1                   LENGTH AND DISPLACEMENT              10870002
L2       EQU   2                   LENGTH AND DISPLACEMENT              10920002
L3       EQU   3                   LENGTH AND DISPLACEMENT              10970002
L4       EQU   4                   LENGTH AND DISPLACEMENT              11020002
L5       EQU   5                   LENGTH AND DISPLACEMENT              11070002
L6       EQU   6                   LENGTH AND DISPLACEMENT              11120002
L7       EQU   7                   LENGTH AND DISPLACEMENT              11170002
L8       EQU   8                   LENGTH AND DISPLACEMENT              11220002
L9       EQU   9                   LENGTH AND DISPLACEMENT              11270002
L16      EQU   16                  LENGTH AND DISPLACEMENT              11320002
L20      EQU   20                  LENGTH AND DISPLACEMENT              11370002
L21      EQU   21                  LENGTH AND DISPLACEMENT              11420002
L24      EQU   24                  LENGTH AND DISPLACEMENT              11470002
L32      EQU   32                  LENGTH AND DISPLACEMENT              11520002
L255     EQU   255                 AND MASK                             11620002
CHAINCDE EQU   X'60'                                                    11670002
CHAININD EQU   X'40'                                                    11720002
DIAGTPRD EQU   X'38'                                                    11770002
DECERRST EQU   29                                                       11820002
DISABLOK EQU   X'08'                                                    11870002
UCBTYP   EQU   16                  DEVICE TYPE CODE                     11970002
MASK3    EQU   X'F0'                                                    12020002
MASK4    EQU   X'30'                                                    12070002
MASK5    EQU   X'40'                                                    12120002
MASK6    EQU   X'80'                                                    12170002
MOD2260  EQU   X'80'                                                    12220002
RDCMD    EQU   X'12'                                                    12270002
RTRNCDE  EQU   X'C0'                                                    12370002
SWLINE   EQU   X'90'                                                    12420002
M2702    EQU   X'01'                                                    12470002
RDCMD2   EQU   X'06'                                                    12520002
**********                                                              12570002
*                                                                       12620002
*        REGISTER DEFINITIONS                                           12670002
*                                                                       12720002
**********                                                              12770002
ERREG3   EQU   0                   WORK REG                             12820002
IOSBREG  EQU   1                   IOSB BASE                            12870002
ERREG2   EQU   2                   WORK REG                             12920002
BASEREG  EQU   3                   PROGRAM BASE                         12970002
CCWREG   EQU   4                   CCW ADDRESS                          13020002
DECBRG   EQU   5                   DECB BASE                            13070002
UCBREG   EQU   7                   UCB BASE                             13120002
EWAREG   EQU   8                   ERP WORKAREA BASE                    13170002
ERREG1   EQU   9                   WORK REG                             13220002
IOBRG    EQU   10                  IOB BASE                             13270002
ERREG4   EQU   11                  WORK REG                             13320002
ERRLNK   EQU   12                  LINK REG                             13370002
NAMEREG  EQU   13                  LINK REG/WORK REG                    13420002
ERRETR   EQU   14                  LINK REG                             13470002
ERREG5   EQU   15                  WORK REG                             13520002
         EJECT                                                          13670002
         IECDRQE                                                        13720002
         EJECT                                                          13770002
         IEZIOB                                                         13820002
IOBCMD3  EQU   IOBCPA+L16                                               13870002
         EJECT                                                          13920002
CVT      DSECT                                                          13970002
         CVT                                                            14020002
         EJECT                                                          14070002
         IECDERWA                                                       14120002
**********                                                              14170002
*                                                                       14220002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        14270002
*                                                                       14320002
**********                                                              14370002
         ORG   EWAIERP                                                  14420002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 14470002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 14520002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 14570002
EWAIND0  DS    B                   FLAG BYTE                            14620002
EWAIVISR EQU   X'10'               V=R REQUEST                          15220002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 15270002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 15320002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 15370002
EWAIND1  DS    B                   FLAG BYTE                            15420002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 15470002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 15520002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 15570002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 15580002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 15590002
EWAIND2  DS    B                   FLAG BYTE                            15620002
EWAIND3  DS    B                   FLAG BYTE                            15670002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     15720002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  15770002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 15820002
*********  END OF BTAM LOCAL DEFINITIONS **********                     15870002
         EJECT                                                          16620002
         IECDIOSB                                                       16670002
         END                                                            16720002
./  ADD  SSI=63070728,NAME=IGE0104C
         TITLE 'IGE0104C BSC DATA CHECK ERP ROUTINE'                    00550002
IGE0104C CSECT                                                          00600002
*********************************************************************** 00650002
*                                                                     * 00700002
* MODULE NAME:                                                        * 00750002
*    IGE0104C                                                         * 00800002
*                                                                     * 00850002
* DESCRIPTIVE NAME:                                                   * 00900002
*    BTAM BSC DATA CHECK ERP                                          * 00950002
*                                                                     * 01000002
* COPYRIGHT:                                                          * 01050002
*    NONE                                                             * 01100002
*                                                                     * 01150002
* STATUS:                                                             * 01200002
*    CHANGE LEVEL 000                                                 * 01250002
*                                                                     * 01300002
* FUNCTION:                                                           * 01350002
*    THIS MODULE IS ENTERED FOR DATA CHECK ERRORS. IT DETERMINES      * 01400002
*    WHEN THE DATA CHECK OCCURRED AND THEN ATTEMPTS RECOVERY.         * 01450002
*    ALL READ TYPE CCW'S WILL RESULT IN A RECOVERY ATTEMPT EXCEPT     * 01500002
*    FOR A READ DURING TEXT TRANSFER WITH DYNAMIC BUFFERING.          * 01550002
*                                                                     * 01600002
* NOTES:                                                              * 01650002
*    DEPENDENCIES:                                                    * 01700002
*        NONE                                                         * 01750002
*    RESTRICTIONS:                                                    * 01800002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01850002
*    REGISTER CONVENTIONS:                                            * 01900002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01950002
*                                                                     * 02000002
* PATCHLABEL:                                                         * 02050002
*    PACHAREA (48 BYTES)                                              * 02100002
*                                                                     * 02150002
* MODULE TYPE:                                                        * 02200002
*    PROCEDURE                                                        * 02250002
*    PROCESSOR:                                                       * 02300002
*        BAL                                                          * 02350002
*    MODULE SIZE:                                                     * 02400002
*        458 BYTES                                                    * 02450002
*    ATTRIBUTES:                                                      * 02500002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02550002
*                                                                     * 02600002
* ENTRY POINT:                                                        * 02650002
*    IGE0104C                                                         * 02700002
*    PURPOSE:                                                         * 02750002
*        SEE 'FUNCTION'                                               * 02800002
*    LINKAGE:                                                         * 02850002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02900002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02950002
*    INPUT:                                                           * 03000002
*        REG 1 = ADDRESS OF IOSB                                      * 03050002
*    OUTPUT:                                                          * 03100002
*        SETS INDICATOR IN DECERRST FOR FAILING LINE                  * 03150002
*        ALTERED CHANNEL PROGRAM                                      * 03200002
*                                                                     * 03250002
* EXITS-NORMAL:                                                       * 03300002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03400002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03450002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03500002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03550002
*        LOADS ARE 1000 GREATER.                                      * 03600002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03650002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03700002
*                                                                     * 03750002
* EXITS-ERROR:                                                        * 03800002
*    NONE                                                             * 03850002
*                                                                     * 03900002
* EXTERNAL REFERENCES:                                                * 03950002
*    ROUTINES:                                                        * 04000002
*        NONE                                                         * 04050002
*    DATA AREAS                                                       * 04150002
*        IOB (MAPPED BY IEZIOB)                                       * 04200002
*        VIRTUAL CHANNEL PROGRAM                                      * 04250002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04300002
*    CONTROL BLOCKS                                                   * 04350002
*        UCB                                                          * 04400002
*        DCB                                                          * 04450002
*        DECB                                                         * 04500002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04550002
*        CVT          (MAPPED BY CVT)                                 * 04600002
*        IOB          (MAPPED BY IEZIOB)                              * 04650002
*        RQE          (MAPPED BY IECDRQE)                             * 04700002
*                                                                     * 04750002
* TABLES-WORKAREAS:                                                   * 04800002
*    ERP WORKAREA                                                     * 04850002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04900002
*                                                                     * 04950002
* MACROS:                                                             * 05000002
*    NONE                                                             * 05050002
*                                                                     * 05100002
* CHANGE ACTIVITY:                                                    * 05150002
*    YM02595K (9/20/73)                                               * 05200002
*    YM02594K (9/24/73)                                               * 05250002
*    YA02436  (11/5/73)                                               * 05260002
*    YM05652K (1/25/74)                                               * 05270002
*    YA03249  (2/15/74)                                               * 05280000
*    YM07710  (4/2/74)                                                * 05290000
*    ZA00504  (5/9/74)                                                * 05292000
*    ZA14139  (10/28/76)                                              * 05300000
*********************************************************************** 05350002
         EJECT                                                          05400002
         USING *,BASEREG                                                05450002
         LR    BASEREG,ERREG5      SET BASE REG                         05500002
         B     BEGIN               BRANCH AROUND ID            @ZA00504 05510000
         DC    C' IGE0104C '       MODULE ID                   @ZA00504 05520000
         DC    C' 4129 '           DATE LAST CHANGE            @ZA00504 05530000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY          @ZA00504 05540000
         USING IECTDECB,DECBRG                                          05550002
         USING IHADCB,DCBREG                                            05600002
         USING RQE,ERREG5                                               05650002
         USING IOSB,IOSBREG                                             05700002
         USING IOBSTDRD,IOBRG                                           05750002
         USING EWA,EWAREG                                               05800002
         DS    0H                                                       05840000
BEGIN    EQU   *                                                        05842000
         L     ERREG5,IOSUSE       BASE RQE                             05850002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05900002
         L     IOBRG,RQEIOB        BASE IOB                             05950002
         L     DECBRG,IOBECBPT     BASE DECB                            06000002
         L     DCBREG,IOBDCBPT     BASE DCB                             06050002
         L     UCBREG,IOSUCB       BASE UCB                             06100002
         DROP  ERREG5                                                   06150002
         L     CCWREG,IOBFL3       POINT TO CSW IN IOB                  06200002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06250002
         SH    CCWREG,ERRCN8          FAILING CCW IN IOB                06300002
         MVC   IOBWORK(L1),TPOPCODE(CCWREG)   INITIALIZE WORK AREA      06350002
         NI    IOBWORK,L255-HIBIT   CLEAR UNUSED BITS                   06400002
         CLI   ZERO(CCWREG),CCWREAD   ERROR ON A READ                   06450002
         BNE   BSCDCSNO            NO GO TO SNO ROUTINE                 06500002
         TM    IOBWORK,TPOPPTXT    ERROR PRIOR TO TEXT                  06550002
         BZ    BSCDC03             YES CHECK FURTHER                    06600002
         TM    IOBWORK,TPOPDTXT    ERROR DURING TEXT                    06650002
         BO    BSCDC04             YES CHECK BUFFER TECHNIQUE           06700002
         TM    IOBWORK,TPOPATXT    ERROR AFTER TEXT                     06750002
         BO    BSCDC07             YES GO TO WRT ENQ ROUTINE            06800002
BSCDCSNO OI    DECERRST,DECSNO     INDICATE SNO                         06850002
BSCDC00  MVI   IOBERRCT,ERRMAXCT   SET FOR NO RETRIES                   06900002
BSCDC01  TM    DCBERROP,DCBLERBI   LERB REQUIRED                        06950002
         BNO   BSCDC02             NO CHECK RETRIES                     07000002
         MVI   IOBINCAM+L1,LERBDCID   NDICATE LERB DATA CHECK           07050002
BSCDC02  CLI   IOBERRCT,ERRMAXCT   RETRY COUNT AT MAX                   07100002
         BNL   BSCDC08             YES GO TO PERM ERROR                 07150002
         IC    ERREG1,IOBERRCT     ADJUST RETRY COUNT                   07200002
         LA    ERREG1,L1(ERREG1)   FOR NEXT RETRY ATTEMPT               07250002
         STC   ERREG1,IOBERRCT     STORE IT BACK                        07300002
         CLI   IOBINCAM+L1,LERBDCID   IS LERB REQUIRED          YA02436 07350002
         BE    BSCDC10             YES, GO TO LERB ROUTINE      YA02436 07400002
         MVI   EWAIND1,EWAISVCF    SVC 15/SVC 3                YM05652K 07450002
         L     NAMEREG,TRANSRTN    LOAD NAME                            10200002
         B     XCTLOUT             XCTL                                 10250002
BSCDC03  CLI   IOBWORK,TPOPRENQ    READ ENQ                             10500002
         BE    BSCDC06             YES SET TO RETRY                     10550002
         CLI   IOBWORK,TPREADID    IS THIS READ ID CCW                  10600002
         BE    BSCDC0A             YES, CHECK FURTHER                   10650002
         CLI   IOBWORK,TPOPRREN    READ RESP ENQ                        10700002
         BNE   BSCDCSNO            NO INDICATE SNO ERROR                10750002
         SH    CCWREG,ERRCN8       SET CCWREG FOR RETRY                 10800002
         B     BSCDC06             GO TO RETRY                          10850002
BSCDC0A  SH    CCWREG,ERRCN8       BACK UP ONE CCW                      10900002
         CLI   L5(CCWREG),TPWRITID   THIS WIRTE ID CCW                  11000002
         BE    BSCDC06            YES, RESTART WITH THIS CCW            11050002
         LA    CCWREG,L8(CCWREG)   BUMP BY ONE CCW                      11150002
         B     BSCDC06            RESTART WITH READ ID CCW              11200002
BSCDC04  TM    DCBBFTEK,DYNBUF    DYNAMIC BUFFERING USED                11250002
         BO    BSCDC00            YES GO TO PERM ERROR ROUTINE          11300002
         CLI   IOBCPA,CCWAPOLL    THIS A MULTIPOINT READ INITIAL        11350002
         BNE   BSCDC05            NO CONTINUE FLOW                      11400002
         LR    ERREG1,CCWREG      POINT TO CURRENT CCW                  11450002
         SH    ERREG1,ERRCN8      BACK UP ONE                           11500002
         L     ERREG1,ZERO(ERREG1)   GET AREA ADDRESS                   11550002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE                          11600002
         CLM   ERREG1,L7,L1(CCWREG)   HAS COUNT BEEN ADJUSTED  @ZA14139 11650000
         BE    BSCDC05             YES, CONTINUE                        11700002
         STCM  ERREG1,L7,L1(CCWREG)   NO, RESTORE READ         @ZA00504 11750000
         LH    ERREG1,L6(CCWREG)   PICK UP COUNT                        11800002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE                          11850002
         STH   ERREG1,L6(CCWREG)   STORE                                11900002
BSCDC05  TM    DCBXCODE,ITBMODE    ITB MODE                             12000002
         BO    BSCDC11             YES, CHECK RESID COUNT               12050002
BSCDC12  LA    ERREG1,DCBBSNAK     ADDRESS OF NAK CHAR                  12100002
         MVI   IOBWORK+L1,RTRNCDE2   SET SPECIAL RETURN BRA.  LD YM7710 12150000
         MVI   IOBERRCT+L1,RTRNSPCD   SET SPECIAL RETURN CODE LD YM7710 12200000
         MVI   IOBERCCW+L7,NAKCOUNT   SET COUNT FOR NAK                 12250002
BSCDC051 SH    CCWREG,ERRCN8       BACK UP ONE CCW                      12300002
         CLI   L5(CCWREG),TPRDRESP   IS THIS READ RESPONSE              12350002
         BE    BSCDC052            YES. RESTART WITH THIS CCW           12400002
         LA    CCWREG,L8(CCWREG)   NO, RESTART WITH TEXT CCW            12450002
BSCDC052 ST    CCWREG,IOBERCCW+L8   GENERATE TIC COMMAND                12500002
         ST    ERREG1,IOBERCCW     SET UP DATA FIELD ADDR               12550002
         MVI   IOBERCCW,CCWWRITE   MOVE IN WRITE COMMAND                12600002
         MVI   IOBERCCW+L4,CMDCHAIN   SET UP FOR COMMAND CHAINING       12650002
         MVI   IOBERCCW+L8,CCWTIC   MOVE IN TIC COMMAND                 12700002
         LA    CCWREG,IOBERCCW     SET UP CHAN START ADDRESS            12750002
BSCDC06  ST    CCWREG,IOBSTART     STORE IN RESTART ADDRESS             12850002
         B     BSCDC01             CHECK RETRY COUNT                    13350002
BSCDC07  LA    ERREG1,DCBBSENQ     ADDRESS OF ENQ CHAR                  13400002
         ST    ERREG1,IOBERCCW     GENERATE CHAN PROG                   13450002
         MVI   IOBERCCW+L7,ENQCOUNT   SET UP COUNT                      13500002
         B     BSCDC051            CONTINUE GENERATION                  13550002
BSCDC08  NI    IOBFLAG1,L255-IOBERRTN  INDICATE PERMANENT ERROR         13600002
         NI    IOSFLA,L255-IOSERR   ALSO IN IOSB                        13610002
         CLI   IOBINCAM+L1,LERBDCID   LERB REQUIRED             YA02436 13650002
         BE    BSCDC10             YES EXIT VIA LERB            YA02436 13700002
         LA    NAMEREG,ERLOD25     ADDRESS OF ERROR POST                13750002
XCTLOUT  EQU   *                                                        13800002
         L     ERRETR,CVTPTR       POINT TO CVT                         13850002
         USING CVTMAP,ERRETR                                            13900002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                13950002
         DROP  ERRETR                                                   14000002
         BR    ERRETR              EXIT VIA XCTL ROUTINE                14050002
BSCDC10  LA    NAMEREG,ERLOD12     ADDRESS OF LERB ROUTINE              14100002
         B     XCTLOUT             GO TO EXIT ROUTINE                   14150002
BSCDC11  LH    UCBREG,IOBCSW+L5    GET RESIDUAL COUNT                   14200002
         LA    UCBREG,L1(UCBREG)   ADD ONE                              14250002
         CH    UCBREG,L6(CCWREG)   MORE THAN ONE CHARACTER              14300002
         BL    BSCDC00             YES, PERMANENT ERROR                 14350002
         B     BSCDC12                                                  14400002
         EJECT                                                          14450002
**********                                                              14500002
*                                                                       14550002
*        CONSTANTS                                                      14600002
*                                                                       14650002
**********                                                              14700002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       14750002
ERRCN8   DC    H'8'                                                     14800002
PACHAREA DC    12C'104C'           PATCH AREA FOR MAINTENANCE           14850002
**********                                                              14900002
*                                                                       14950002
*        MISCELLANEOUS EQUATES                                          15000002
*                                                                       15050002
**********                                                              15100002
TPREADID EQU   X'07'                                                    15200002
TPWRITID EQU   X'03'                                                    15250002
TPRDRESP EQU   X'25'                                                    15300002
TPOPDTXT EQU   X'11'                                                    15350002
LERBDCID EQU   X'01'                                                    15450002
TPOPCODE EQU   5                                                        15650002
L255     EQU   X'FF'               AND MASK                             15700002
CCWREAD  EQU   X'02'                                                    15750002
TPOPPTXT EQU   X'30'                                                    15800002
HIBIT    EQU   X'C0'                                                    15850002
TPOPATXT EQU   X'20'                                                    15900002
DECSNO   EQU   X'40'                                                    15950002
ERRMAXCT EQU   7                                                        16000002
DCBLERBI EQU   X'08'                                                    16050002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              16100002
L1       EQU   1                   LENGTH AND DISPLACEMENT              16150002
L2       EQU   2                   LENGTH AND DISPLACEMENT              16200002
L3       EQU   3                   LENGTH AND DISPLACEMENT              16250002
L4       EQU   4                   LENGTH AND DISPLACEMENT              16300002
L5       EQU   5                   LENGTH AND DISPLACEMENT              16350002
L6       EQU   6                   LENGTH AND DISPLACEMENT              16400002
L7       EQU   7                   LENGTH AND DISPLACEMENT              16450002
L8       EQU   8                   LENGTH AND DISPLACEMENT              16500002
TPOPRENQ EQU   X'0B'                                                    16650002
TPOPRREN EQU   X'0C'                                                    16700002
DYNBUF   EQU   X'08'                                                    16750002
CCWAPOLL EQU   X'09'                                                    16800002
CCWWRITE EQU   X'01'                                                    16850002
CMDCHAIN EQU   X'60'                                                    16900002
NAKCOUNT EQU   1                                                        16950002
ITBMODE  EQU   X'40'                                                    17000002
RTRNCDE2 EQU   X'82'                                            YA03249 17050000
RTRNSPCD EQU   X'14'               SPECIAL RTN CODE           LD YM7710 17100000
CCWTIC   EQU   X'08'                                                    17150002
ENQCOUNT EQU   X'01'                                                    17200002
ERLOD25  EQU   2043                                                     17300002
ERLOD12  EQU   2042                                                     17400002
**********                                                              17550002
*                                                                       17600002
*        REGISTER DEFINITION                                            17650002
*                                                                       17700002
**********                                                              17750002
ERREG3   EQU   0                   WORK REG                             17800002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              17850002
EWAREG   EQU   2                   ERP WORKAREA BASE                    17900002
ERREG4   EQU   3                   WORK REG                             17950002
CCWREG   EQU   4                   CCW ADDRESS REG                      18000002
DECBRG   EQU   5                   DECB BASE                            18050002
DCBREG   EQU   6                   DCB BASE                             18100002
UCBREG   EQU   7                   UCB BASE                             18150002
BASEREG  EQU   8                   PROGRAM BASE                         18200002
ERREG1   EQU   9                   WORK REG                             18250002
IOBRG    EQU   10                  IOB BASE                             18300002
ERRLNK   EQU   12                  LINK REG                             18350002
NAMEREG  EQU   13                  LINK REG                             18400002
ERRETR   EQU   14                  LINK REG                             18450002
ERREG5   EQU   15                  LINK REG/WORK REG                    18500002
         EJECT                                                          18550002
         DCBD  DSORG=BX,DEVD=BS                                         18600002
         EJECT                                                          18650002
         IECTDECB                                                       18700002
         EJECT                                                          18750002
         IECDRQE                                                        18800002
         EJECT                                                          18850002
         IEZIOB                                                         18900002
         EJECT                                                          18950002
CVT      DSECT                                                          19000002
         CVT                                                            19050002
         EJECT                                                          19100002
         IECDERWA                                                       19150002
**********                                                              19200002
*                                                                       19250002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        19300002
*                                                                       19350002
**********                                                              19400002
         ORG   EWAIERP                                                  19450002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 19500002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 19550002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 19600002
EWAIND0  DS    B                   FLAG BYTE                            19650002
EWAIVISR EQU   X'10'               V=R REQUEST                          20250002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 20300002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 20350002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 20400002
EWAIND1  DS    B                   FLAG BYTE                            20450002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 20500002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 20550002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 20600002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 20610002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 20620002
EWAIND2  DS    B                   FLAG BYTE                            20650002
EWAIND3  DS    B                   FLAG BYTE                            20700002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     20750002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  20800002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 20850002
*********  END OF BTAM LOCAL DEFINITIONS **********                     20900002
         EJECT                                                          21550002
         IECDIOSB                                                       21600002
         END                                                            21650002
./  ADD  SSI=72980186,NAME=IGE0204A
         TITLE 'IGE0204A - BTAM ERP TIME OUT MODULE'                    00450002
IGE0204A CSECT                                                          00500002
*********************************************************************** 00550002
*                                                                     * 00600002
* MODULE NAME:                                                        * 00650002
*    IGE0204A                                                         * 00700002
*                                                                     * 00750002
* DESCRIPTIVE NAME:                                                   * 00800002
*    BTAM ERP TIME OUT                                                * 00850002
*                                                                     * 00900002
* COPYRIGHT:                                                          * 00950002
*    NONE                                                             * 01000002
*                                                                     * 01050002
* STATUS:                                                             * 01100002
*    CHANGE LEVEL 000                                                 * 01150002
*                                                                     * 01200002
* FUNCTION:                                                           * 01250002
*    IF REQUIRED, RETRIES CHANNEL PROGRAM THAT FAILED BECAUSE OF      * 01300002
*    A TIME OUT CONDITION.  DETERMINES IF LINE ERROR RECORDING IS     * 01350002
*    REQUIRED AND XCTLS EITHER TO DISABLE, LERB OR POST ROUTINE.      * 01400002
*                                                                     * 01450002
* NOTES:                                                              * 01500002
*    DEPENDENCIES:                                                    * 01550002
*        NONE                                                         * 01600002
*    RESTRICTIONS:                                                    * 01650002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01700002
*    REGISTER CONVENTIONS:                                            * 01750002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01800002
*                                                                     * 01850002
* PATCHLABEL:                                                         * 01900002
*    PACHAREA (68 BYTES)                                              * 01950002
*                                                                     * 02000002
* MODULE TYPE:                                                        * 02050002
*    PROCEDURE                                                        * 02100002
*    PROCESSOR:                                                       * 02150002
*        BAL                                                          * 02200002
*    MODULE SIZE:                                                     * 02250002
*        692 BYTES                                                    * 02300002
*    ATTRIBUTES:                                                      * 02350002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02400002
*                                                                     * 02450002
* ENTRY POINT:                                                        * 02500002
*    IGE0204A                                                         * 02550002
*    PURPOSE:                                                         * 02600002
*        SEE 'FUNCTION'                                               * 02650002
*    LINKAGE:                                                         * 02700002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02750002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02800002
*    INPUT:                                                           * 02850002
*        REG 1 = ADDRESS OF IOSB                                      * 02900002
*    OUTPUT:                                                          * 02950002
*        ALTERS EXISTING CCWS OR CREATES NEW ONES FOR RECOVERY        * 03000002
*        ALTERS DECERRST FOR SHOULD NOT OCCUR ERROR.                  * 03050002
*                                                                     * 03100002
* EXITS-NORMAL:                                                       * 03150002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03250002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03300002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03350002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03400002
*        LOADS ARE 1000 GREATER.                                      * 03450002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03500002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03550002
*                                                                     * 03600002
* EXITS-ERROR:                                                        * 03650002
*    NONE                                                             * 03700002
*                                                                     * 03750002
* EXTERNAL REFERENCES:                                                * 03800002
*    ROUTINES:                                                        * 03850002
*        NONE                                                         * 03900002
*    DATA AREAS                                                       * 04000002
*        IOB (MAPPED BY IEZIOB)                                       * 04050002
*        VIRTUAL CHANNEL PROGRAM                                      * 04100002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04150002
*    CONTROL BLOCKS                                                   * 04200002
*        UCB                                                          * 04250002
*        DCB                                                          * 04300002
*        DECB                                                         * 04350002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04400002
*        CVT          (MAPPED BY CVT)                                 * 04450002
*        IOB          (MAPPED BY IEZIOB)                              * 04500002
*        RQE          (MAPPED BY IECDRQE)                             * 04550002
*                                                                     * 04700002
* TABLES-WORKAREAS:                                                   * 04750002
*    ERP WORKAREA                                                     * 04800002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04850002
*                                                                     * 04900002
* MACROS:                                                             * 04950002
*    NONE                                                             * 05000002
*                                                                     * 05050002
* CHANGE ACTIVITY:                                                    * 05100002
*    YA01060  (IN BASE)                                               * 05110002
*    YM02595K (9/20/73)                                               * 05150002
*    YM02594K (9/24/73)                                               * 05160002
*    YA02436  (11/1/73)                                               * 05170002
*    YA02463  (11/1/73)                                               * 05180002
*    YM05652K (1/25/74)                                               * 05190002
*    AZ04683 (08/26/75)                                                 05195000
*    AZ25078 (10/15/77)                                               * 05200000
*********************************************************************** 05250002
         EJECT                                                          05300002
         USING *,BASEREG                                                05350002
         LR    BASEREG,ERREG5      SET BASE REG                         05400002
         USING RQE,ERREG5                                               05450002
         USING IOSB,IOSBREG                                             05500002
         USING IOBSTDRD,IOBRG                                           05550002
         USING EWA,EWAREG                                               05600002
         L     ERREG5,IOSUSE       BASE RQE                             05650002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05700002
         L     IOBRG,RQEIOB        BASE IOB                             05750002
         L     DECBRG,IOBECBPT     BASE DECB                            05800002
         L     DCBREG,IOBDCBPT     BASE DCB                             05850002
         L     UCBREG,IOSUCB       BASE UCB                             05900002
         DROP  ERREG5                                                   05950002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       06000002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06050002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                06100002
         MVC   IOBWORK(L1),L5(CCWREG)   TP OP CODE TO WORK AREA         06150002
         NI    IOBWORK,L255-CCWMASK1   MASK OUT UNUSED BITS             06200002
         LA    ERREG1,IOBCPA       ADDRESS OF CHAN PROG                 06250002
         ST    ERREG1,IOBSTART     STORE IN PTR LOC                     06300002
         CLI   ZERO(CCWREG),CCWAPOLL   THIS POLL COMMAND                06450002
         BE    ERRTOT02            UPDATE POLL COMMAND                  06500002
         CLI   ZERO(CCWREG),CCWINCMD   INHIBIT COMMAND                  06550002
         BE    READ                YES                                  06600002
         CLI   ZERO(CCWREG),CCWRDCMD    READ COMMAND                    06650002
         BNE   ERRTOD00            NO CHECK FOR DISABLE OR PREPARE      06700002
READ     EQU   *                                                        06750002
         TM    IOBWORK,CCWPTXFR    PRIOR TO TEXT TRANSFER               06800002
         BZ    ERRTOD06            YES, CHECK ADAPTER                   06850002
         TM    DCBBFTEK(DCBREG),X08   DYNAMIC BUFFER SPECIFIED          06900002
         BZ    ERRTOT03            NO, CHECK FOR READ RESPONSE TEXT     06950002
         NI    IOSFLA,L255-IOSERR   TURN OFF ERP CONTROL                07000002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     07010002
         B     ERRPERM1            POST PERMANENT ERROR                 07050002
ERRTOD06 TM    UCBTYP+L3(UCBREG),T83B3A   IS THIS 83B3 ADAPTER          07100002
         BNZ   ERRTOT08            NO CONTINUE PROCESSING               07150002
         TM    UCBTYP(UCBREG),T83B3D   IS THIS 83B3                     07200002
         BNO   ERRTOT08            NO CONTINUE PROCESSING               07250002
         CLI   IOBWORK,CCWRDRSP    READ RESPONSE TO ADDRESSING          07300002
         BE    ERRTOT09            YES SET UP RETRY                     07350002
ERRTOT08 CLI   IOBWORK,CCWTWXID    THIS TWX ID RESPONSE                 07400002
         BE    ERRTOD03            YES CHECK FOR LERB                   07450002
ERRTOT00 CLI   IOBCPA,CCWDISAB     FIRST COMMAND DISABLE                07500002
         BNE   ERRTOT01            NO CHECK FOR POLL RESPONSE           07550002
ERRTOT09 LA    ERREG1,IOBCMD3      INITIALIZE CPA TO 3RD COMMND         07600002
         ST    ERREG1,IOBSTART     STORE CPA START IN POINTER           07650002
ERRTOT01 CLI   IOBWORK,CCWPOLL     READ RESPONSE TO POLLING             07800002
         BNE   ERRTOD04            NO, CHECK FOR AUTOPOLL               07850002
*                                  READ INDEX.                          07900002
         CLC   IOBCSW+L5(L2),L6(CCWREG)   RESIDUAL COUNT = ORIG COUNT   07950002
         BE    ERRTOD03            YES CHECK FOR LERB                   08000002
         B     ERRCTT01            NO CHECK FOR RETRY                   08050002
ERRTOD04 CLI   L5(CCWREG),CCWRDIX   READ RESPONSE TO INDEX              08100002
         BNE   ERRTOD03            NO CHECK FOR LERB                    08150002
ERRTOT02 EQU   *                                                        08200002
         L     ERREG1,IOBCPA+L8    LOAD ENTRY ADDRESS FROM PREVIOUS     08250002
*                                  POLL (WITH POLL COMMAND CODE IN      08300002
*                                  HIGH ORDER BYTE).                    08350002
         MVC   IOBCPA+L9(L3),DECENTRY+L1(DECBRG)   MOVE IN ADDRESS      08400002
*                                  OF LAST ENTRY POLLED (TO BE USED     08450002
*                                  AS RESTART ADDRESS).                 08500002
         L     ERREG4,IOBCPA+L8    LOAD ENTRY ADDRESS FOR NEXT POLL     08550002
*                                  (WITH POLL COMMAND CODE IN HIGH      08600002
*                                  ORDER BYTE).                         08650002
         SR    ERREG1,ERREG4       SUBTRACT NEW POLL ADDRESS            08700002
*                                  FROM PREVIOUS POLL ADDRESS.          08750002
         AH    ERREG1,IOBCPA+L14   IF THE NEW POLL ADDRESS              08800002
*                                  WERE LESS THAN THE PREVIOUS POLL     08850002
*                                  ADDRESS, THE EFFECT IS TO ADD THE    08900002
*                                  ABSOLUTE DIFFERENCE TO THE PREVIOUS  08950002
*                                  COUNT; IF IT WERE GREATER, THE       09000002
*                                  EFFECT IS TO SUBTRACT THE            09050002
*                                  ABSOLUTE DIFFERENCT FROM THE         09100002
*                                  PREVIOUS COUNT.                      09150002
         STH   ERREG1,IOBCPA+L14   STORE ADJUSTED COUNT IN              09200002
*                                  POLL COMMAND.                        09250002
         CLI   ZERO(CCWREG),CCWAPOLL   POLL COMMAND                     09400002
         BE    ERRTOD03            YES CHECK FOR LERB                   09450002
         B     ERRCTT01            NO CHECK FOR MORE RETRIES            09500002
ERRTOD00 CLI   ZERO(CCWREG),CCWDISAB   DISABLE COMMAND                  09550002
         BE    ERRTOD02            YES  SET CPA TO START OF CHAN PROG   09600002
         CLI   ZERO(CCWREG),CCWENABL   ENABLE COMMAND                   09650002
         BE    ERRFIX01            YES, CHECK FOR RESTART               09700002
         CLI   ZERO(CCWREG),CCWPREP   PREPARE COMMAND                   09750002
         BE    ERRTOD02            YES  SET CPA TO START CHAN PROG      09800002
         CLI   ZERO(CCWREG),CCWDIAL   DIAL COMMAND                      09850002
         BE    ERRCTT01            YES CHECK FOR LERB                   09900002
         CLI   ZERO(CCWREG),CCWWRITE   WRITE COMMAND                    09950002
         BNE   ERRTOSNO            NO, SHOULD NOT OCCUR                 10000002
         MVC   IOBWORK(L1),UCBTYP+L3(UCBREG)   MOVE DEVTP TO WORK       10050002
         NI    IOBWORK,MASK3       AND OFF UNUSED BITS                  10100002
         CLI   IOBWORK,IBMTYP3     IBM TYPE 3 ADAPTER                   10150002
         BNE   ERRTOSNO            NO  SET SHOULD NOT OCCUR             10200002
         MVC   IOBERINF+L8(L1),IOBSENS0   SAVE SENSE BYTE               10250002
         MVC   IOBERINF+L9(L7),IOBCSW   SAVE 7 BYTE CSW                 10300002
         MVC   IOBERCCW(L16),IOBCPA   MOVE 2 CCWS                       10350002
         MVC   IOBCPA(L16),RSET2848   SET UP RESET CHAN PROG            10500002
         MVI   IOBERRCT+L1,RTRN2848   INDICATE 2848 RESET               10550002
         B     ERRTRY02            EXECUTE RESET CHAN PROG              10750002
ERRFIX01 SH    CCWREG,ERRCN8       BACK UP ONE CCW                      10950002
         CLI   ZERO(CCWREG),CCWDISAB   DISABLE COMMAND                  11000002
         BE    ERRTOD02            YES,RESTART CHAN PROG                11050002
ERRTOSNO OI    DECERRST(DECBRG),CSWSNO   INDICATE SHOULD NOT OCCUR      11100002
         NI    IOSFLA,L255-IOSERR  TURNOFF ERP IN CONTROL      @ZA04683 11110000
*                                      IN IOSB                 @ZA04683 11120000
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB            @ZA04683 11130000
         B     ERRTRY01            EXIT TO WRITE MESSAGE                11150002
ERRTOD02 EQU   *                                                        11200002
         ST    CCWREG,IOBSTART     ADDR OF FAILING CCW IN POINTER       11250002
ERRTOD03 TM    DCBERROP(DCBREG),DCBLERB   LINE ERROR RECORDING REQUIRED 11750002
         BNO   ERRCTT01            NO CONTINUE FLOW                     11800002
         MVI   IOBERRCT-L1,LERBTO   INDICATE TIME OUT LERB REQUIRED     11850002
ERRCTT01 CLI   DECTYPE+L1(DECBRG),TYPETTV   IS OP TYPE A WRITE TTV?     11900002
         BNE   ERRTOD05            NO, CHECK FOR RETRY                  11950002
         LA    ERREG1,IOBCMD3      YES, POINT TO START OF POLLING       12000002
         ST    ERREG1,IOBSTART     STORE FOR RESTART                    12050002
ERRTOD05 CLI   IOBERRCT,ERTRYCT    RETRY REQUIRED                       12200002
         BL    ERRTRY02            YES SET UP FOR RETRY                 12250002
         CLI   ZERO(CCWREG),CCWDISAB   DISABLE EXECUTED                 12300002
         BE    ERRPERM1            YES POST COMPLETE WITH ERROR         12350002
ERRTRY01 TM    UCBTYP+L1(UCBREG),SWLINE   DISABLE REQUIRED              12400002
         BZ    ERRPERM1            NO POST COMPLETE                     12450002
         MVI   IOBERRCT+L1,MASK3   SET MASK                             12500002
         LA    NAMEREG,ERLOD3      ADDRESS OF DISABLE ROUTINE           12550002
         B     ERRLINK1            XCTL                                 12600002
ERRTRY02 IC    ERREG1,IOBERRCT     ERROR RETRY COUNT                    12650002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE                          12700002
         STC   ERREG1,IOBERRCT     RESTORE IN COUNT FIELD               12750002
         MVI   IOBSENS0,ZERO       CLEAR SENSE BYTE                     12800002
         CLI   IOBERRCT-L1,LERBTO   LINE ERROR RECORDING REQ    YA02436 12850002
         BE    ERLERBTO            YES, EXIT TO LERB ROUTINE    YA02436 12900002
RETRY    EQU   *                                                        12950002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 13000002
         L     NAMEREG,TRANSRTN    LOAD NAME                            14600002
         B     ERRLINK1             XCTL                                14650002
ERRPERM1 CLI   IOBERRCT-L1,LERBTO   LINE ERROR RECORDING REQ    YA02436 17750002
         BE    ERLERBT1            YES EXIT                     YA02436 17800002
         NI    IOSFLA,L255-IOSERR   INDICATE ERROR POST IOSB   @ZA25078 17810000
         NI    IOBFLAG1,L255-IOBERRTN    ALSO IN IOB           @ZA25078 17820000
         LH    NAMEREG,ERLOD5      NAME OF POST ROUTINE                 17850002
ERRLINK1 EQU   *                                                        17900002
         L     ERRETR,CVTPTR       POINT TO CVT                         17950002
         USING CVTMAP,ERRETR                                            18000002
         L     ERRETR,CVTXTLER     GET BRANCH ENTRY TO XCTL             18050002
         BR    ERRETR              XCTL                                 18100002
         DROP  ERRETR                                                   18150002
ERLERBT1 NI    IOSFLA,L255-IOSERR   INDICATE POST AFTER LERB            18200002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     18210002
ERLERBTO LA    NAMEREG,ERLOD12     NAME OF LERB ROUTINE                 18250002
         B     ERRLINK1            XCTL                                 18300002
ERRTOT03 TM    IOBWORK,CCWTXTDT    ERROR DURING TRANSFER                18350002
         BZ    ERRTOT07            NO CHECK FOR READ RESPONSE TO TXT    18400002
         CLI   IOBWORK,CCWRDTXT    CHECK FOR READ TEXT                  18450002
         BNE   ERRPERM1            NO, CHECK FOR LERB                   18500002
         TM    UCBTYP+L3(UCBREG),IBMTYP3   IS DEVICE 2260/2265  YA02463 18550002
         BO    ERRPERM1            YES, BRANCH                  YA02463 18600002
         NI    IOSFLA,L255-IOSERR   YES, INDICATE POST                  18650002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     18660002
         B     RETRY               EXIT TO SVC 15                       18700002
ERRTOT07 CLI   IOBWORK,CCWRRTXT    READ RESPONSE TO TEXT                18750002
         BE    ERRTOT05            YES CONTINUE FLOW                    18800002
         B     ERRPERM1            NO, INDICATE PERM ERROR              18850002
ERRTOT05 TM    DCBERROP(DCBREG),CCWRTRT   WRITE RETRY REQUIRED          18900002
         BZ    ERRTOT06            NO CONTINUE FLOW                     18950002
         MVC   IOBWORK+L1(L1),DECTYPE+L1(DECBRG)   TYPE CDE TO WORK     19000002
         NI    IOBWORK+L1,L255-HIBIT   CLEAR UNUSED BITS                19050002
         CLI   IOBWORK+L1,CCWWRTCT   PREVIOUS CMD WRITE CONTINUE        19100002
         BNE   ERRTOT00            NO RESUME FLOW                       19150002
ERRTOT06 TM    DCBERROP(DCBREG),DCBLERB   LINE ERROR RECORDING REQ      19200002
         BNO   ERRPERM1            NO POST COMPLETE WITH ERROR          19250002
         MVI   IOBERRCT-L1,LERBTO   INDICATE LERB RECORDING             19300002
         NI    IOSFLA,L255-IOSEX-IOSERR   INDICATE POST NO WTO          19350002
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR   ALSO IN IOB            19360002
         LA    NAMEREG,ERLOD12     LINE ERROR RECORDING ROUTINE         19400002
         B     ERRLINK1            XCTL                                 19450002
         EJECT                                                          19500002
**********                                                              19550002
*                                                                       19600002
*        CONSTANTS                                                      19650002
*                                                                       19700002
**********                                                              19750002
         DS    0D                                                       19800002
RSET2848 DC    X'42000001700003C0'  RESET CCWS                          19850002
         DC    X'41000001200003E8'                                      19900002
TRANSRTN DC    F'9042'             XCTL NAME OF BTAM TRANSLATE ROUTINE  19950002
ERRCN8   DC    H'8'                DECIMAL 8                            20000002
ERLOD5   DC    H'5041'                                                  20050002
PACHAREA DC    17C'204A'           PATCH AREA FOR MAINTENANCE           20100002
**********                                                              20150002
*                                                                       20200002
*        MISCELLANEOUS EQUATES                                          20250002
*                                                                       20300002
**********                                                              20350002
IBMTYP3  EQU   X'80'                                                    20450002
CCWWRITE EQU   X'01'                                                    20500002
RTRN2848 EQU   X'80'                                                    20550002
T83B3A   EQU   X'B0'                                                    20600002
T83B3D   EQU   X'01'                                                    20650002
CCWRDRSP EQU   X'06'                                                    20700002
CCWAPOLL EQU   X'09'                                                    20750002
CCWDIAL  EQU   X'29'                                                    20800002
CCWDISAB EQU   X'2F'                                                    20850002
CCWENABL EQU   X'27'                                                    20900002
CCWMASK1 EQU   X'C0'                                                    20950002
CCWPOLL  EQU   X'05'                                                    21000002
CCWPREP  EQU   X'06'                                                    21050002
CCWPTXFR EQU   X'30'                                                    21100002
CCWRDCMD EQU   X'02'                                                    21150002
CCWINCMD EQU   X'0A'                                                    21200002
CCWRDIX  EQU   X'0A'                                                    21250002
CCWRRTXT EQU   X'20'                                                    21300002
CCWRTRT  EQU   X'04'                                                    21350002
CCWTWXID EQU   X'07'                                                    21400002
CCWTXTDT EQU   X'10'                                                    21450002
CCWWRTCT EQU   X'04'                                                    21500002
CSWSNO   EQU   X'40'                                                    21550002
DCBBFTEK EQU   X'20'                                                    21600002
DCBERROP EQU   33                                                       21650002
DCBLERB  EQU   X'08'                                                    21700002
DECENTRY EQU   20                                                       21750002
DECERRST EQU   29                                                       21800002
DECTYPE  EQU   4                                                        21850002
ERLOD3   EQU   3041                                                     21900002
ERLOD12  EQU   2042                                                     21950002
ERTRYCT  EQU   X'02'                                                    22000002
HIBIT    EQU   X'C0'                                                    22100002
LERBTO   EQU   X'03'                                                    22150002
L1       EQU   1                   LENGTH AND DISPLACEMENT              22200002
L2       EQU   2                   LENGTH AND DISPLACEMENT              22250002
L3       EQU   3                   LENGTH AND DISPLACEMENT              22300002
L4       EQU   4                   LENGTH AND DISPLACEMENT              22350002
L5       EQU   5                   LENGTH AND DISPLACEMENT              22400002
L6       EQU   6                   LENGTH AND DISPLACEMENT              22450002
L7       EQU   7                   LENGTH AND DISPLACEMENT              22500002
L8       EQU   8                   LENGTH AND DISPLACEMENT              22550002
L9       EQU   9                   LENGTH AND DISPLACEMENT              22600002
L14      EQU   14                  LENGTH AND DISPLACEMENT              22650002
L16      EQU   16                  LENGTH AND DISPLACEMENT              22700002
X08      EQU   X'08'               DYNAMIC BUFFERING MASK               22750002
L255     EQU   255                 AND MASK                             22800002
MASK3    EQU   X'F0'                                                    22850002
SWLINE   EQU   X'90'                                                    22950002
TYPETTV  EQU   X'0F'                                                    23000002
UCBTYP   EQU   16                  DEVICE TYPE CODE                     23050002
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              23100002
CCWRDTXT EQU   X'11'                                                    23150002
**********                                                              23200002
*                                                                       23250002
*        REGISTER DEFINITION                                            23300002
*                                                                       23350002
**********                                                              23400002
ERREG3   EQU   0                   WORK REG/PARAMETER REG               23450002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              23500002
ERREG2   EQU   2                   WORK REG                             23550002
EWAREG   EQU   3                   ERP WORKAREA BASE                    23600002
CCWREG   EQU   4                   CCW ADDRESS REG                      23650002
DECBRG   EQU   5                   DECB BASE                            23700002
DCBREG   EQU   6                   DCB BASE                             23750002
UCBREG   EQU   7                   UCB BASE                             23800002
BASEREG  EQU   8                   PROGRAM BASE                         23850002
ERREG1   EQU   9                   WORK REG                             23900002
IOBRG    EQU   10                  IOB BASE                             23950002
ERREG4   EQU   11                  LINK REG/WORK REG                    24000002
ERRLNK   EQU   12                  LINK REG                             24050002
NAMEREG  EQU   13                  LINK REG                             24100002
ERRETR   EQU   14                  LINK REG                             24150002
ERREG5   EQU   15                  LINK REG/WORK REG                    24200002
         EJECT                                                          24350002
         IECDRQE                                                        24400002
         EJECT                                                          24450002
         IEZIOB                                                         24500002
IOBCMD3  EQU   IOBCPA+L16                                               24550002
         EJECT                                                          24600002
CVT      DSECT                                                          24650002
         CVT                                                            24700002
         EJECT                                                          24750002
         IECDERWA                                                       24800002
**********                                                              24850002
*                                                                       24900002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        24950002
*                                                                       25000002
**********                                                              25050002
         ORG   EWAIERP                                                  25100002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 25150002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 25200002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 25250002
EWAIND0  DS    B                   FLAG BYTE                            25300002
EWAIVISR EQU   X'10'               V=R REQUEST                          25900002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 25950002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 26000002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 26050002
EWAIND1  DS    B                   FLAG BYTE                            26100002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 26150002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 26200002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 26250002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 26260002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 26270002
EWAIND2  DS    B                   FLAG BYTE                            26300002
EWAIND3  DS    B                   FLAG BYTE                            26350002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     26400002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  26450002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 26500002
*********  END OF BTAM LOCAL DEFINITIONS **********                     26550002
         EJECT                                                          27300002
         IECDIOSB                                                       27350002
         END                                                            27400002
./  ADD  SSI=40240797,NAME=IGE0204B
         TITLE 'IGE0204B - BTAM LINE ERROR RECORDING MODULE'            00100002
IGE0204B CSECT                                                          00150002
*********************************************************************** 00200002
*                                                                     * 00250002
* MODULE NAME:                                                        * 00300002
*    IGE0204B                                                         * 00350002
*                                                                     * 00400002
* DESCRIPTIVE NAME:                                                   * 00450002
*    BTAM LINE ERROR RECORDING MODULE                                 * 00500002
*                                                                     * 00550002
* COPYRIGHT:                                                          * 00600002
*    NONE                                                             * 00650002
*                                                                     * 00700002
* STATUS:                                                             * 00750002
*    CHANGE LEVEL 000                                                 * 00800002
*                                                                     * 00850002
* FUNCTION:                                                           * 00900002
*    THIS MODULE UPDATES THE FOLLOWING COUNTS IN THE LINE ERROR       * 00950002
*    RECORDING BLOCK POINTED TO BY THE DCB:                           * 01000002
*        1.  TRANSMISSION COUNT                                       * 01050002
*        2.  LINE ERROR COUNT                                         * 01100002
*        3.  TOTAL TRANSMISSIONS COUNT                                * 01150002
*        4.  DATA CHECK TOTAL COUNT                                   * 01200002
*        5.  INTERVENTION REQUIRED TOTAL COUNT                        * 01250002
*        6.  TIME OUT TOTAL COUNT                                     * 01300002
*    WRITES A MESSAGE TO THE OPERATOR CONSOLE AND PROVIDES            * 01350002
*    LINKAGE TO THE ERROR POST AND DIAGNOSTIC READ/WRITE ROUTINES.    * 01400002
*                                                                     * 01450002
* NOTES:                                                              * 01500002
*    DEPENDENCIES:                                                    * 01550002
*        NONE                                                         * 01600002
*    RESTRICTIONS:                                                    * 01650002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01700002
*    REGISTER CONVENTIONS:                                            * 01750002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01800002
*                                                                     * 01850002
* PATCHLABEL:                                                         * 01900002
*    PACHAREA (48 BYTES)                                              * 01950002
*                                                                     * 02000002
* MODULE TYPE:                                                        * 02050002
*    PROCEDURE                                                        * 02100002
*    PROCESSOR:                                                       * 02150002
*        BAL                                                          * 02200002
*    MODULE SIZE:                                                     * 02250002
*        470 BYTES                                                    * 02300002
*    ATTRIBUTES:                                                      * 02350002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02400002
*                                                                     * 02450002
* ENTRY POINT:                                                        * 02500002
*    IGE0204B                                                         * 02550002
*    PURPOSE:                                                         * 02600002
*        SEE 'FUNCTION'                                               * 02650002
*    LINKAGE:                                                         * 02700002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02750002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02800002
*    INPUT:                                                           * 02850002
*        REG 1 = ADDRESS OF IOSB                                      * 02900002
*    OUTPUT:                                                          * 02950002
*        SEE 'FUNCTION'                                               * 03000002
*                                                                     * 03050002
* EXITS-NORMAL:                                                       * 03100002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03200002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03250002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03300002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03350002
*        LOADS ARE 1000 GREATER.                                      * 03400002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03450002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03500002
*                                                                     * 03550002
* EXITS-ERROR:                                                        * 03600002
*    NONE                                                             * 03650002
*                                                                     * 03700002
* EXTERNAL REFERENCES:                                                * 03750002
*    ROUTINES:                                                        * 03800002
*        WTO (SVC 35)                                                 * 03850002
*    DATA AREAS                                                       * 03950002
*        IOB (MAPPED BY IEZIOB)                                       * 04000002
*        VIRTUAL CHANNEL PROGRAM                                      * 04050002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04100002
*    CONTROL BLOCKS                                                   * 04150002
*        UCB                                                          * 04200002
*        DCB                                                          * 04250002
*        DECB                                                         * 04300002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04350002
*        CVT          (MAPPED BY CVT)                                 * 04400002
*        IOB          (MAPPED BY IEZIOB)                              * 04450002
*        RQE          (MAPPED BY IECDRQE)                             * 04500002
*                                                                     * 04550002
* TABLES-WORKAREAS:                                                   * 04600002
*    ERP WORKAREA                                                     * 04650002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04700002
*                                                                     * 04750002
* MACROS:                                                             * 04800002
*    WTO (SVC 35)                                                     * 04850002
*                                                                     * 04900002
* CHANGE ACTIVITY:                                                    * 04950002
*    YM02595K (9/20/73)                                               * 05000002
*    YM02594K (9/24/73)                                               * 05050002
*    YM05652K (1/24/74)                                               * 05060002
*    YM05680K (1/24/74)                                               * 05070002
*                                                                     * 05100002
*********************************************************************** 05150002
         EJECT                                                          05200002
         USING *,BASEREG                                                05250002
         LR    BASEREG,ERREG5      BASE PROGRAM                         05300002
         USING RQE,ERREG5                                               05350002
         USING IOSB,IOSBREG                                             05400002
         USING IOBSTDRD,IOBRG                                           05450002
         USING EWA,EWAREG                                               05500002
         L     ERREG5,IOSUSE       BASE RQE                             05550002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05600002
         L     IOBRG,RQEIOB        BASE IOB                             05650002
         L     DCBREG,IOBDCBPT     BASE DCB                             05700002
         DROP  ERREG5                                                   05750002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       05800002
         LA    CCWREG,ZERO(CCWREG)   CLEAR FLAG BYTE                    05850002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                05900002
         LH    NAMEREG,ERLOD5      ERROR POST NAME                      05950002
         L     ERREG1,DCBLERB(DCBREG)   ADDRESS OF TABLE                06000002
         LTR   ERREG1,ERREG1       CHECK FOR LERB ADDRESS               06050002
         BZ    ERRDIAG             NONE                                 06100002
         MVC   EWAIAREA(LMSG),MSGAREA   MOVE PARAMETER LIST TO EWA      06150002
         SR    ERREG2,ERREG2       CLEAR REGISTER                       06200002
         IC    ERREG2,IOBUCBX      INDEX FACTOR TO TABLE ENTRY          06250002
         MH    ERREG2,ERRCN20      RESOLVE TABLE INDEX                  06300002
         AR    ERREG2,ERREG1       RESOLVE FINAL ADDRESS                06350002
         SR    ERRLNK,ERRLNK       CLEAR IC REGISTER                    06400002
         IC    ERRLNK,LERBTRCT(ERREG2)   TOTAL TRANS COUNT              06450002
         LA    ERRLNK,L1(ERRLNK)   UPDATE COUNT                         06500002
         STC   ERRLNK,LERBTRCT(ERREG2)   STORE NEW COUNT                06550002
         SR    ERREG1,ERREG1       REPLACES 3 INSTRUCTIONS              06600002
         IC    ERREG1,IOBERRCT-L1   PICK UP TABLE OFFSET                06650002
         AH    ERREG1,ERRCN10      ADD STANDARD OFFSET                  06700002
         AR    ERREG1,ERREG2       RESOLVE FINAL ADDRESS                06750002
         IC    ERRLNK,ZERO(ERREG1)   PICK UP ERROR LINE COUNT           06800002
         LA    ERRLNK,L1(ERRLNK)   UPDATE COUNT                         06850002
         STC   ERRLNK,ZERO(ERREG1)   STORE NEW COUNT                    06900002
         EX    ERRLNK,ERRCTCMP     COUNT EQUAL MAX ALLOWED              06950002
         BE    ERRLRB01            BYPASS NO WTO                        07000002
         CLC   LERBTRCT(L1,ERREG2),LERBTRT(ERREG2) TRANS COUNT REACHED  07050002
         BNE   ERRDIAG             NO CHECK IF DIAG WR/RD REQUIRED      07100002
         OI    IOBERRCT-L1,NOPRINT   INDICATE NO WTO                    07150002
ERRLRB01 EQU   *                                                        07200002
         L     ERREG1,ZERO(ERREG2)   YES UPDATE ACCUMULATIVE COUNTER    07250002
         IC    ERRLNK,L10(ERREG2)   TOTAL TRANSMISSIONS COUNT           07300002
         AR    ERREG1,ERRLNK       UPDATED ACCUM TRANS COUNT            07350002
         ST    ERREG1,ZERO(ERREG2)   STORE NEW COUNT                    07400002
         CVD   ERRLNK,EWAISAVE     GENERATE MESSAGE FORMAT              07450002
         UNPK  ERRMSG02+L7(L3),EWAISAVE+L6(L2)   CREATE PRINTABLE CHARS 07500002
         OI    ERRMSG02+L9,MASK16   REMOVE SIGN                         07550002
         LH    ERREG1,L4(ERREG2)    DATA CHECK TOTAL ERROR COUNT        07600002
         IC    ERRLNK,L11(ERREG2)   DATA CHECK NEW COUNT                07650002
         AR    ERREG1,ERRLNK        NEW TOTAL COUNT                     07700002
         STH   ERREG1,L4(ERREG2)    STORE UPDATED TOTAL COUNT           07750002
         CVD   ERRLNK,EWAISAVE      DECIMAL COUNT FOR WTO MESSAGE       07800002
         UNPK  ERRMSG03+L4(L3),EWAISAVE+L6(L2)   PRINT FORMAT INTO MSG  07850002
         OI    ERRMSG03+L6,MASK16   MESSAGE FORMAT COMPLETE             07900002
         LH    ERREG1,L6(ERREG2)   INTERVENTION REQUIRED TOTAL COUNT    07950002
         IC    ERRLNK,L12(ERREG2)   NEW COUNT                           08000002
         AR    ERREG1,ERRLNK       NEW TOTAL COUNT                      08050002
         STH   ERREG1,L6(ERREG2)   STORE NEW TOTAL                      08100002
         CVD   ERRLNK,EWAISAVE     NEW COUNT TO DECIMAL                 08150002
         UNPK  ERRMSG04+L4(L3),EWAISAVE+L6(L2)   FORMAT FOR OUTPUT MSG  08200002
         OI    ERRMSG04+L6,MASK16   REMOVE SIGN                         08250002
         LH    ERREG1,L8(ERREG2)   TIME OUT TOTAL COUNT                 08300002
         IC    ERRLNK,L13(ERREG2)   TIME OUT NEW COUNT                  08350002
         AR    ERREG1,ERRLNK       NEW TOTAL COUNT                      08400002
         STH   ERREG1,L8(ERREG2)   STORE NEW TOTAL                      08450002
         TM    IOBERRCT-L1,NOPRINT   WTO REQUIRED                       08500002
         BO    ERRLRB02            NO CONTINUE PROCESSING               08550002
         CVD   ERRLNK,EWAISAVE     DECIMAL COUNT FOR WTO                08600002
         UNPK  ERRMSG05+L4(L3),EWAISAVE+L6(L2)   FORMAT PRINTABLE CHARS 08650002
         OI    ERRMSG05+L6,MASK16   REMOVE SIGN                         08700002
         L     UCBREG,IOSUCB       ADDRESS OF UCB                       08750002
         N     UCBREG,UCBZIP       CLEAR LOW BIT                        08800002
         MVC   ERRMSG01(L3),UCBNAME(UCBREG)   LINE ADDR TO MESSAGE      08850002
         SR    ERREG3,ERREG3       CLEAR PARAMETER REG                  08900002
         LR    ERREG4,IOSBREG      SAVE BASE                   YM05680K 08950002
         LA    IOSBREG,EWAIAREA    POINTER TO MESSAGE                   09000002
         WTO   MF=(E,(1))          WRITE MESSAGE                        09050002
         LR    IOSBREG,ERREG4      RESTORE BASE                YM05680K 09100002
ERRLRB02 EQU   *                                                        09150002
         XC    L10(L4,ERREG2),L10(ERREG2)   CLEAR NEW COUNT FIELDS      09200002
ERRDIAG  MVI   IOBERRCT-L1,ZERO    CLEAR LERB INDICATORS                09250002
         TM    IOBERRCT+L1,RTRNCDE   DIAG WRITE READ REQ                09300002
         BO    ERE5C1              YES GO TO DIAG ROUTINE               09350002
         TM    IOSFLA,IOSEX+IOSERR   DETERMINE EXIT                     09400002
         BM    ERRLRB03                                                 09450002
         OI    IOSFLA,IOSEX        SET ON IOB EXCEPTION FLAG            09500002
         OI    IOBFLAG1,IOBIOERR   ALSO IN IOB                          09550002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 09600002
         L     NAMEREG,TRANSRTN    LOAD NAME                            12350002
         B     EXIT                XCTL                                 12400002
ERRLRB03 TM    UCBTYPE+L3(UCBREG),UCBBSC   THIS A BI-SYNC DEVICE        12650002
         BNO   EXIT                NO, GO TO ERROR POST ROUTINE         12700002
         LA    NAMEREG,ERLOD25     ADDRESS OF ERROR POST                12750002
         B     EXIT                EXIT                                 12800002
ERE5C1   LA    NAMEREG,ERLOD11     ADDRESS OF DIAG WRT/RD ROUTINE       12850002
EXIT     EQU   *                                                        12900002
         L     COMREG,CVTPTR       ADDRESS OF CVT                       12950002
         USING CVTMAP,COMREG                                            13000002
         L     ERRETR,CVTXTLER     XCTL ROUTINE ADDRESS                 13050002
         BR    ERRETR              XCTL                                 13100002
         EJECT                                                          13150002
**********                                                              13200002
*                                                                       13250002
*        EXECUTED INSTRUCTIONS                                          13300002
*                                                                       13350002
**********                                                              13400002
ERRCTCMP EQU   *                                                        13450002
         CLI   L4(ERREG1),ZERO                                          13500002
**********                                                              13550002
*                                                                       13600002
*        CONSTANTS                                                      13650002
*                                                                       13700002
**********                                                              13750002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       13800002
UCBZIP   DC    X'FFFFFFFE'         AND MASK, MUST BE ON WORD            13850002
MSGAREA  WTO   'IEC801I     THRESHOLD TRANS=    DC=    IR=    TO=    ',X13900002
               MF=L,ROUTCDE=(8,10),DESC=(4)                             13950002
LMSG     EQU   *-MSGAREA           LENGTH OF PARAMETER LIST             14000002
ERRCN8   DC    H'8'                DECIMAL 8                            14050002
ERRCN10  DC    H'10'                                                    14100002
ERLOD5   DC    H'5041'                                                  14150002
ERRCN20  DC    H'20'                                                    14200002
PACHAREA DC    12C'204B'           PATCH AREA FOR MAINTENANCE           14250002
**********                                                              14300002
*                                                                       14350002
*        MISCELLANEOUS EQUATES                                          14400002
*                                                                       14450002
**********                                                              14500002
DCBLERB  EQU   52                                                       14600002
ERLOD11  EQU   1042                                                     14650002
UCBBSC   EQU   X'90'                                                    14750002
UCBTYPE  EQU   16                                                       14800002
ERLOD25  EQU   2043                                                     14850002
LERBTRCT EQU   10                                                       14900002
LERBTRT  EQU   14                                                       14950002
MASK16   EQU   X'F0'                                                    15000002
ZERO     EQU   0                                                        15050002
L1       EQU   1                   LENGTH AND DISPLACEMENT              15100002
L2       EQU   2                   LENGTH AND DISPLACEMENT              15150002
L3       EQU   3                   LENGTH AND DISPLACEMENT              15200002
L4       EQU   4                   LENGTH AND DISPLACEMENT              15250002
L5       EQU   5                   LENGTH AND DISPLACEMENT              15300002
L6       EQU   6                   LENGTH AND DISPLACEMENT              15350002
L7       EQU   7                   LENGTH AND DISPLACEMENT              15400002
L8       EQU   8                   LENGTH AND DISPLACEMENT              15450002
L9       EQU   9                   LENGTH AND DISPLACEMENT              15500002
L10      EQU   10                  LENGTH AND DISPLACEMENT              15550002
L11      EQU   11                  LENGTH AND DISPLACEMENT              15600002
L12      EQU   12                  LENGTH AND DISPLACEMENT              15650002
L13      EQU   13                  LENGTH AND DISPLACEMENT              15700002
L14      EQU   14                  LENGTH AND DISPLACEMENT              15750002
L15      EQU   15                  LENGTH AND DISPLACEMENT              15800002
L16      EQU   16                  LENGTH AND DISPLACEMENT              15850002
L255     EQU   255                 AND MASK                             15900002
NOPRINT  EQU   X'10'                                                    15950002
RTRNCDE  EQU   X'C0'                                                    16050002
UCBNAME  EQU   13                                                       16100002
**********                                                              16250002
*                                                                       16300002
*        REGISTER DEFINITION                                            16350002
*                                                                       16400002
**********                                                              16450002
ERREG3   EQU   0                   WORK REG/PARAMETER REG               16500002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              16550002
ERREG2   EQU   2                   WORK REG                             16600002
BASEREG  EQU   3                   PROGRAM BASE                         16650002
CCWREG   EQU   4                   CCW ADMRESS REG                      16700002
EWAREG   EQU   5                   ERP WORKAREA BASE                    16750002
DCBREG   EQU   6                   DCB BASE                             16800002
UCBREG   EQU   7                   UCB BASE                             16850002
COMREG   EQU   8                   CVT BASE                             16900002
ERREG1   EQU   9                   WORK REG                             16950002
IOBRG    EQU   10                  IOB BASE                             17000002
ERREG4   EQU   11                  WORK REG                             17050002
ERRLNK   EQU   12                  LINK REG                             17100002
NAMEREG  EQU   13                  LINK REG                             17150002
ERRETR   EQU   14                  LINK REG                             17200002
ERREG5   EQU   15                  LINK REG/WORK REG                    17250002
         EJECT                                                          17300002
         IECDRQE                                                        17350002
         EJECT                                                          17400002
         IEZIOB                                                         17450002
IOBCMD3  EQU   IOBCPA+L16                                               17500002
         EJECT                                                          17550002
CVT      DSECT                                                          17600002
         CVT                                                            17650002
         EJECT                                                          17700002
         IECDERWA                                                       17750002
**********                                                              17800002
*                                                                       17850002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        17900002
*                                                                       17950002
**********                                                              18000002
         ORG   EWAIERP                                                  18050002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 18100002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 18150002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 18200002
EWAIND0  DS    B                   FLAG BYTE                            18250002
EWAIVISR EQU   X'10'               V=R REQUEST                          18850002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 18900002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 18950002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 19000002
EWAIND1  DS    B                   FLAG BYTE                            19050002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 19100002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 19150002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 19200002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 19210002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 19220002
EWAIND2  DS    B                   FLAG BYTE                            19250002
EWAIND3  DS    B                   FLAG BYTE                            19300002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     19350002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  19400002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 19450002
*********  END OF BTAM LOCAL DEFINITIONS **********                     19500002
ERRMSG01 EQU   EWAIAREA+12                                              19550002
ERRMSG02 EQU   EWAIAREA+25                                              19600002
ERRMSG03 EQU   EWAIAREA+35                                              19650002
ERRMSG04 EQU   EWAIAREA+42                                              19700002
ERRMSG05 EQU   EWAIAREA+49                                              19750002
         EJECT                                                          20400002
         IECDIOSB                                                       20450002
         END                                                            20500002
./  ADD  SSI=71360303,NAME=IGE0204C
         TITLE 'IGE0204C - BSC ERP ERROR POST ROUTINE'                  00150002
IGE0204C CSECT                                                          00200002
*********************************************************************** 00250002
*                                                                     * 00300002
* MODULE NAME:                                                        * 00350002
*    IGE0204C                                                         * 00400002
*                                                                     * 00450002
* DESCRIPTIVE NAME:                                                   * 00500002
*    BTAM BSC ERROR POST ERP                                          * 00550002
*                                                                     * 00600002
* COPYRIGHT:                                                          * 00650002
*    NONE                                                             * 00700002
*                                                                     * 00750002
* STATUS:                                                             * 00800002
*    CHANGE LEVEL 001                                                 * 00850002
*                                                                     * 00900002
* FUNCTION:                                                           * 00950002
*    THIS ROUTINE SETS UP THE IOB FIELDS USED IN PRINTING OPERATOR    * 01000002
*    MESSAGES AND ERROR MESSAGES GENERATED BY TERMINALS FOR           * 01050002
*    SYS1.LOGREC.                                                     * 01100002
*                                                                     * 01150002
* NOTES:                                                              * 01200002
*    DEPENDENCIES:                                                    * 01250002
*        NONE                                                         * 01300002
*    RESTRICTIONS:                                                    * 01350002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01400002
*    REGISTER CONVENTIONS:                                            * 01450002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01500002
*                                                                     * 01550002
* PATCHLABEL:                                                         * 01600002
*    PACHAREA (124 BYTES)                                             * 01650002
*                                                                     * 01700002
* MODULE TYPE:                                                        * 01750002
*    PROCEDURE                                                        * 01800002
*    PROCESSOR:                                                       * 01850002
*        BAL                                                          * 01900002
*    MODULE SIZE:                                                     * 01950002
*        1253 BYTES                                                   * 02000002
*    ATTRIBUTES:                                                      * 02050002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02100002
*                                                                     * 02150002
* ENTRY POINT:                                                        * 02200002
*    IGE0204C                                                         * 02250002
*    PURPOSE:                                                         * 02300002
*        SEE 'FUNCTION'                                               * 02350002
*    LINKAGE:                                                         * 02400002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02450002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02500002
*    INPUT:                                                           * 02550002
*        REG 1 = ADDRESS OF IOSB                                      * 02600002
*        SOH % C MESSAGE FORMAT ON ENTRY TO ERROR POST                * 02650002
*     ***************************************************************** 02700002
*     *               *               *               *               * 02750002
* +0  *      SOH      *       %       *       C       *      DLE      * 02800002
*     *               *               *               *               * 02850002
*     ***************************************************************** 02900002
*     *               *               *                               * 02950002
* +4  *      STX      * ROUTING CODE  *    17 OR 60 BYTES OF TEXT     * 03000002
*     *               *               *                               * 03050002
*     ***************************************************************** 03100002
* NOTE=DLE MAY OR MAY NOT BE PRESENT.                                 * 03150002
*                                                                     * 03200002
*       SOH % E MESSAGE FORMAT ON ENTRY TO ERROR POST                 * 03250002
*     ***************************************************************** 03300002
*     *       *       *       *       *       *       *       *       * 03350002
* +0  *  SOH  *   %   *   E   *  DLE  *  STX  * X'08' * UNUSED* UNUSED* 03400002
*     *       *       *       *       *       *       *       *       * 03450002
*     ***************************************************************** 03500002
*     *               *                                               * 03550002
* +8  *  TERMINAL ID  * 35 BYTES OF ERROR DATA...1 TO 6 35BYTE RECORDS* 03600002
*     *               *                                               * 03650002
*     ***************************************************************** 03700002
* NOTE=DLE MAY BE ABSENT -- SOH % E STX BLANK X'08'.............      * 03750002
*                                                                     * 03800002
*    OUTPUT:                                                          * 03850002
*       ALTERED CHANNEL PROGRAM                                       * 03900002
*       SOH % E MESSAGE FORMAT WHEN PASSED TO EREP (TPR ROUTINE)      * 03950002
*     ***************************************************************** 04000002
*     *               *       *               *       *      CHAN     * 04050002
* +0  *    LENGTH     *   E   *    X'2043'    * X'08' *      UNIT     * 04100002
*     *               *       *               *       *      ADDR     * 04150002
*     ***************************************************************** 04200002
*     *               *                                               * 04250002
* +8  *  TERMINAL ID  * ERROR DATA AS RECEIVED (1 TO 6 35BYTE RECORDS)* 04300002
*     *               *                                               * 04350002
*     ***************************************************************** 04400002
*                                                                     * 04450002
* EXITS-NORMAL:                                                       * 04500002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 04600002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 04650002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 04700002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 04750002
*        LOADS ARE 1000 GREATER.                                      * 04800002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 04850002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 04900002
*                                                                     * 04950002
* EXITS-ERROR:                                                        * 05000002
*    NONE                                                             * 05050002
*                                                                     * 05100002
* EXTERNAL REFERENCES:                                                * 05150002
*    ROUTINES:                                                        * 05200002
*        SVC 35 WTO                                                   * 05250002
*    DATA AREAS                                                       * 05400002
*        IOB (MAPPED BY IEZIOB)                                       * 05450002
*        VIRTUAL CHANNEL PROGRAM                                      * 05500002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 05550002
*    CONTROL BLOCKS                                                   * 05600002
*        UCB                                                          * 05650002
*        DCB                                                          * 05700002
*        DECB                                                         * 05750002
*        IOSB         (MAPPED BY IECDIOSB)                            * 05800002
*        CVT          (MAPPED BY CVT)                                 * 05850002
*        IOB          (MAPPED BY IEZIOB)                              * 05900002
*        RQE          (MAPPED BY IECDRQE)                             * 05950002
*                                                                     * 06000002
* TABLES-WORKAREAS:                                                   * 06050002
*    ERP WORKAREA                                                     * 06100002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 06150002
*                                                                     * 06200002
* MACROS:                                                             * 06250002
*    WTO                                                              * 06300002
*                                                                     * 06350002
* CHANGE ACTIVITY:                                                    * 06400002
*    YA01233  (IN BASE)                                               * 06410002
*    YM02566K (8/6/73)                                                * 06450002
*    YM02595K (9/20/73)                                               * 06500002
*    YM02594K (9/24/73)                                               * 06550002
*    YM05652K (1/24/74)                                               * 06560002
*    YM05680K (1/24/74)                                               * 06570002
*    ZA00504  (5/9/74)                                                * 06580000
*    AZ04158  (10/03/75)          AZ06405  (10/07/75)                   06586000
*    AZ13213  (09/23/76)          AZ14140  (10/28/76)                 * 06593000
*    AZ14138  (12/07/76)          AZ20105  (05/13/77)                 * 06600000
*********************************************************************** 06650002
         EJECT                                                          06700002
         USING *,BASEREG                                                06750002
         LR    BASEREG,ERREG5      SET BASE REG                         06800002
         B     BEGIN               BRANCH AROUND ID            @ZA00504 06810000
         DC    C' IGE0204C '       MODULE ID                   @ZA00504 06820000
         DC    C' 4129 '           DATE LAST CHANGE            @ZA00504 06830000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY          @ZA00504 06840000
BEGIN    DS    0H                                              @ZA00504 06842000
         USING RQE,ERREG5                                               06850002
         USING IECTDECB,DECBRG                                          06900002
         USING IHADCB,DCBREG                                            06950002
         USING IOSB,IOSBREG                                             07000002
         USING IOBSTDRD,IOBRG                                           07050002
         USING EWA,EWAREG                                               07100002
         L     ERREG5,IOSUSE       BASE RQE                             07150002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    07200002
         L     IOBRG,RQEIOB        BASE IOB                             07250002
         L     DECBRG,IOBECBPT     BASE DECB                            07300002
         L     DCBREG,IOBDCBPT     BASE DCB                             07350002
         L     UCBREG,IOSUCB       BASE UCB                             07400002
         DROP  ERREG5                                                   07450002
         L     CCWREG,IOBERCCW+L16   ADDRESS OF ERP CCW                 07500002
         TM    DCBBFTEK,DYNBF      DYNAMIC BUFFERING?                   07550002
         BNO   BSCEP0              NO,BRANCH                            07600002
         L     CCWREG,IOBFL3       GET IOB CSW                          07650002
BSCEP0   EQU   *                                               YM02566K 07700002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                07750002
         SH    CCWREG,ERRCN8       FAILING CCW                          07800002
         LA    DCBREG,ZERO(DCBREG)                                      07850002
         L     ERREG1,IOBERINF  GET DATA AREA ADDR SET BY 19MB @ZA13213 07900000
         CLC   ZERO(L3,ERREG1),OBRRTN   RETURN FROM TPER ROUTINE?       07950002
         BE    BSCEP052                                                 08000002
         CLC   ZERO(L2,ERREG1),DCBBSONL   SOH % MESSAGE?                08050002
         BE    BSCEP04                                                  08100002
BSCEPREG EQU   *                                                        08150002
         CLI   IOBERRCT,ERRMAXCT   RETRIES EXHAUSTED                    08200002
         BNL   BSCEP00             YES NORMAL POST                      08250002
         CLI   IOBERRCT+L1,RTRNCDEP   SPECIAL RETURN                    08300002
         BE    BSCEP03             IF SO, BRANCH                        08350002
         CLI   IOBWORK,ZERO        ERP CCW                              08400002
         BNE   BSCEP00             NO NORMAL POST                       08450002
         CLI   DECTYPE,WRTCONN     IS OPERATION WRITE CONNECT           08500002
         BNE   BSCEP03             NO, PROCESS AS USUAL                 08550002
         TM    IOBSENS0,LOSTDATA                                        08600002
         BO    BSCEP03B            YES, RETRY                           08650002
         L     ERREG1,IOBERCCW+L8   ADDRESS OF CCW THAT FAILED          08700002
         ST    ERREG1,IOBSTART     SET UP FOR EXCP                      08750002
         B     BSCEP03B                                                 08850002
BSCEP03  EQU   *                                                        08900002
         L     CCWREG,IOBFL3                                            08950002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                09000002
         SH    CCWREG,ERRCN8       GET ADDR OF FAILING CCW              09050002
         CLI   ZERO(CCWREG),CCWWRITE   WRITE COMMAND                    09100002
         BNE   BSCEP000            NO CHK SPEC RTRN                     09150002
         MVI   IOBERRCT+L1,RTRNCDEP   SET SPECIAL RTRN                  09250002
BSCEP03A L     ERREG1,IOBERCCW+L8   PICK UP READ CCW                    09300002
         ST    ERREG1,IOBSTART     MODIFY START ADDRESS                 09350002
BSCEP03B EQU   *                                                        09450002
         OI    IOSFLA,IOSERR       SET ERP IN CONTROL                   09500002
         OI    IOBFLAG1,IOBERRTN   ALSO IN IOB                          09550002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 09560002
         B     RETRY               ERROR EXCP                           09600002
BSCEP000 NI    IOBSENS0,L255-LOSTDATA   EXPECTED ERROR                  09650002
         MVI   IOBERRCT+L1,ZERO    ZIP RETURN CODE                      09700002
         CLI   IOBSENS0,ZERO       ANY SENSE ERRORS                     09750002
         BE    BSCEP002            NO CLEAR UC FROM CSW                 09800002
         TM    IOBSENS0,TOERROR    ERROR TIME OUT                       09850002
         BNO   BSCEP00             NO POST IN ERROR                     09900002
         TM    L4(CCWREG),SKIP     SKIP BIT ON                          09950002
         BO    BSCEP03A            YES RESTART WRITE                    10000002
         IC    ERREG2,IOBERRCT     BUMP RETRY                           10050002
         LA    ERREG2,L1(ERREG2)   COUNT BY ONE                         10100002
         STC   ERREG2,IOBERRCT     AND RETRY                            10150002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 10160002
         B     RETRY               ERROR EXCP                           10200002
BSCEP002 EQU   *                                                        10250002
         NI    IOBCSW+L3,L255-IOBCSWUC   TURN OFF UNIT CHECK   YM02566K 10300002
BSCEP001 EQU   *                                                        10400002
         MVI   EWAIND1,EWAILD00    EXIT TO 004C                YM02594K 10450002
         LA    NAMEREG,ERLOD00     GO TO 004C                  YM05680K 10460002
         B     XCTLOUT             GO TO IGE0004C              YM05680K 10500002
BSCEP00  EQU   *                                                        10550002
         NC    DECPOLPT+L1(L3),DECPOLPT+L1   POLLING CHARS AVAIL        10600002
         BZ    BSCEP00B            NO CHECK ADDRESSING                  10650002
         L     ERREG2,DECENTRY     PICK UP CHAR POINTER                 10700002
BSCEP00A MVC   IOBRESTR+L2(L2),ZERO(ERREG2)   MOVE IN CHARACTERS        10750002
         B     BSCEP01             CONTINUE FLOW                        10800002
BSCEP00B NC    DECADRPT+L1(L3),DECADRPT+L1   ADDRESSING CHARS AVAIL     10850002
         BZ    BSCEP01             NO CONTINUE MESSAGE CONSTRUCTION     10900002
         L     ERREG2,DECADRPT     PICK UP CHAR POINTER                 10950002
         B     BSCEP00A            CONTINUE FLOW                        11000002
BSCEP01  EQU   *                                                        11050002
         TM    DCBBFTEK,DYNBF      DYNAMIC BUFFERING?                   11100002
         BNO   BSCEP01A            NO, USE ORIGINAL FAILURE             11150002
         TM    TPOPCODE(CCWREG),X3F   IS IT ERP CCW                     11200002
         BNZ   BSCEP01B            NO, USE CURRENT FAILURE              11250002
         L     ERREG4,IOBERCCW+L16   TIC-ED TO CCW                      11300002
         LA    ERREG4,ZERO(ERREG4)   ZAP HIGH BYTE                      11350002
         SH    ERREG4,ERRCN8       BEGINNING OF CCW                     11400002
         TM    TPOPCODE(ERREG4),X30   PRIOR TO TEXT                     11450002
         BZ    BSCEP01A            YES, USE ORIGINAL FAILURE            11500002
         CLI   L8(CCWREG),X08      IND ERP CCW TIC                      11550002
         BE    BSCEP01X            YES, USE TIC-ED TO CCW               11600002
         CLI   L8(CCWREG),X03      2ND ERP CCW NOP                      11650002
         BNE   BSCEP01A            NO, USE ORIGINAL CCW                 11700002
BSCEP01X MVC   IOBERCCW+L17(L3),L9(CCWREG)   ALTER ORIGINAL CCW         11750002
         L     ERREG4,IOBERCCW+L16   ALTER ORIGINAL CSW                 11800002
         AH    ERREG4,ERRCN8                                            11850002
         ST    ERREG4,IOBERCCW+L16   MAKE IT LOOK LIKE CSW              11900002
BSCEP01A EQU   *                                                        11950002
         MVC   IOBSENS0(L1),IOBERCCW+L16   RESTORE SENSE INFO           12000002
         MVC   IOBCSW(L7),IOBERCCW+L17   RESTORE CSW INFO               12050002
BSCEP01B EQU   *                                                        12150002
         MVC   IOBRESTR(L1),TPOPCODE(CCWREG)   INSERT TP OP CODE        12200002
         MVC   IOBSENS1(L1),DECTYPE+L1    R/W OP TYPE          @ZA04158 12250000
         MVC   IOBRESTR+L1(L1),DECFLAGS   DECB FLAG BYTE       @ZA04158 12270000
         MVI   IOBWORK+L1,ZERO     ZERO OUT WORK FIELD                  12300000
         TM    IOBSENS0,TOERROR    ERROR TIME OUT                       12350002
         BZ    BSCEP01C            NO, ISSUE WTO                        12400002
         TM    DECTYPE,NOLERB      SUPPRESS WTO REQUESTED               12450002
         BO    BSCEP02             YES EXIT VIA IOS                     12500002
BSCEP01C EQU   *                                                        12550002
         TM    UCBTYP(UCBREG),X0A    CHECK FOR BSC1            @ZA14138 12558000
         BNZ   BSCEP01D            NO, CONTINUE                @ZA14138 12566000
         TM    DECFLAGS,SLAVCONT     CHECK FOR CONTENTION      @ZA14138 12574000
         BO    RETRY               IF SO GO POST               @ZA20105 12582000
BSCEP01D EQU   *                                               @ZA14138 12590000
         OI    IOSFLB,IOSLOG       INDICATE LOGOUT REQUESTED            12600002
         MVI   EWAIND1,EWAIWTOL    TELL 904B TO GO TO IOS WTO  YM02594K 12700002
         B     RETRY               GO TO 904B                  YM02594K 12750002
BSCEP02  NI    IOSFLA,L255-IOSERR   SET PERM ERROR IND                  12800002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     12850002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 12860002
         B     RETRY               ERROR EXCP                           12900002
BSCEP04  EQU   *                                                        12950002
         LH    ERREG4,L6(CCWREG)   GET ORIGINAL COUNT                   13000002
         SH    ERREG4,IOBCSW+L5    SUBTRACT RESIDUAL COUNT              13050002
         BCTR  ERREG4,ZERO         ADJUST FOR ENDING CHAR               13100002
         TM    DCBXMODE,INTBLCHK   ITB MODE?                            13150002
         BZ    BSCEP040                                                 13200002
         BCTR  ERREG4,ZERO         ADJUST FOR CHECK CHAR                13250002
BSCEP040 LA    ERREG2,L4(ERREG1)   POINT PAST HEADER                    13300002
         SH    CCWREG,ERRCN8       BACK UP ONE CCW                      13350002
         TM    UCBTYP+L1(UCBREG),X40   MULTIPOINT LINE?                 13400002
         BZ    BSCEP041                                                 13450002
         TM    DECTYPE+L1,READINIT   READ INITIAL?                      13500002
         BNZ   BSCEP041                                                 13550002
         L     ERREG3,ZERO(CCWREG)   PICK UP AREA ADDRESS               13600002
         AH    ERREG3,ERRCN1       INCREMENT ADDRESS BY ONE             13650002
         C     ERREG3,L8(CCWREG)   IS COUNT ADJUSTED?                   13700002
         BE    BSCEP041            YES, NOT FIRST TIME THRU             13750002
         LA    ERREG4,L1(ERREG4)   ADJUST FOR OTHER READ                13800002
BSCEP041 CLI   L2(ERREG1),EBC      EBCDIC C?                            13850002
         BNE   BSCEP05             PROCESS E TYPE MSG                   13900002
BSCEP04C CLC   L3(L1,ERREG1),DCBBSDLE   DLE INCLUDED?                   13950002
         BNE   BSCEP04D                                                 14000002
         LA    ERREG2,L1(ERREG2)   ADJUST FOR DLE                       14050002
         BCTR  ERREG4,ZERO         ADJUST COUNT                         14100002
BSCEP04D SH    ERREG4,ERRCN5       ADJUST FOR OTHER FRAM CHAR           14150002
BSCEP042 EQU   *                                                        14200002
         LA    CCWREG,L8(CCWREG)                                        14250002
         LR    ERREG3,ERREG1                                            14300002
         CH    ERREG4,SHORTMSG     THIS A SHORT MSG?                    14350002
         BH    BSCEP043            NO, SET FOR LONG MSG                 14400002
         MVC   EWAIAREA(LWTO1),WTO1   MOVE TO EWA                       14450002
         LA    ERREG1,EWAIAREA     GET ADDR OF SHORT TXT MSG            14500002
         B     BSCEP044            SET UP MSG                           14550002
BSCEP043 EQU   *                                                        14600002
         MVC   EWAIAREA(LWTO2),WTO2   MOVE TO EWA                       14650002
         LA    ERREG1,EWAIAREA     GET ADDR OF LONG TST MSG             14700002
         CH    ERREG4,RITESIZE     MSG TOO LONG?                        14750002
         BNH   BSCEP044            NO CONTINUE                          14800002
         LH    ERREG4,RITESIZE     SET LENGTH TO RIGHT SIZE             14850002
BSCEP044 MVC   L12(L3,ERREG1),L13(UCBREG)   PUT LINE ADDR ON MSG        14900002
         BCTR  ERREG4,ZERO         DECREMENT FOR MOVE                   14950002
         EX    ERREG4,MOVE         MOVE TEXT INTO MSG                   15000002
         LA    ERREG4,L13(ERREG4)   RESET COUNT & INCL HDR              15050002
         AR    ERREG4,ERREG1       ADD LENGTH TO PARM LIST PTR          15100002
         AH    ERREG4,ERRCN4       ADD NUMBER OF BYTES IN HDRR          15150002
         LA    ERREG4,L2(ERREG4)   ADD LENGTH OF DESCRIP FLD            15200002
         NI    ZERO(ERREG4),NULL   ZERO ROUTE CODE IN MSG               15250002
         NI    L1(ERREG4),NULL                                          15300002
         TM    ZERO(ERREG2),BIT7   ROUTE CODE 2 SPECIFIED?              15350002
         BNO   BSCEP045            NO, CHECK 8                          15400002
         OI    ZERO(ERREG4),CDE2   INDICATE MASTER CONSOLE              15450002
BSCEP045 TM    ZERO(ERREG2),BIT6   ROUTE CODE 8                         15500002
         BNO   BSCEP046            NO, CHECK 10                         15550002
         OI    ZERO(ERREG4),CDE8   INDICATE TP CONSOLE                  15600002
BSCEP046 TM    ZERO(ERREG2),BIT5   ROUTE CODE 10?                       15650002
         BNO   BSCEP047            NO, CONTINUE                         15700002
         OI    L1(ERREG4),CDE10    IND SYS MAINT COLSOLE                15750002
BSCEP047 LR    ERREG2,IOSBREG      SAVE IOSB PTR                        15800002
         LR    IOSBREG,ERREG1      GET PTR TO MSG                       15850002
         WTO   MF=(E,(1))          WRITE CONSOLE MSG                    15900002
         LR    IOSBREG,ERREG2      RESTORE IOSB PTR                     15950002
         L     ERREG1,IOBERINF     GET DATA ADDRESS                     16000002
BSCEP052 EQU   *                                                        16050002
         SH    CCWREG,ERRCN8                                            16100002
         TM    UCBTYP+L1(UCBREG),X40   MULTIPOINT LINE                  16150002
         BZ    BSCEP049                                                 16200002
         TM    DECTYPE+L1,READINIT   READ INITIAL                       16250002
         BNZ   BSCEP049                                                 16300002
         L     ERREG2,ZERO(CCWREG)   PICK UP AREA ADDRESS               16350002
         LA    ERREG2,L1(ERREG2)   INCREMENT BY ONE                     16400002
         CLM   ERREG2,L7,L9(CCWREG)   BEEN THRU BEFORE?        @ZA14140 16450000
         BE    BSCEP04E                                                 16500002
         STCM  ERREG2,L7,L9(CCWREG)   STORE NEW ADDRESS        @ZA00504 16550000
         LH    ERREG2,L14(CCWREG)   GET ORIGINAL COUNT                  16600002
         LA    ERREG2,L1(ERREG2)   ADD ONE TO COUNT                     16650002
         STH   ERREG2,L14(CCWREG)   STORE NEW COUNT                     16700002
BSCEP04E BCTR  ERREG1,ZERO         BACK UP PAST INDEX BYTE              16800002
BSCEP049 SR    ERREG2,ERREG2       CLEAR REGISTER                       16850002
         IC    ERREG2,IOBSNDPT     GET SEND ACK POINTER                 16900002
         AR    ERREG2,DCBREG       ADD DCB ADDRESS                      16950002
         A     ERREG2,WRTRSPCW     ADD COMMAND CODE AND OFFSET          17000002
         ST    ERREG2,IOBERCCW     SET UP FIRST HALF OF WRT             17050002
         MVC   IOBERCCW+L4(L4),WRTRSPCW+L4   SET UP NEXT HALF           17100002
         AH    CCWREG,ERRCN8       GO TO READ CCW                       17150002
         ST    CCWREG,IOBERCCW+L8   SET TIC ADDRESS                     17200002
         LA    ERREG2,CCWTIC       GET COMMAND CODE                     17250002
         STC   ERREG2,IOBERCCW+L8   SET COMMAND CODE                    17300002
         TM    DCBBFTEK,DYNBF      DYNAMIC BUFFERING USED?              17400002
         BZ    BSCEP04A            NO, RESTART CHAN PROGM?              17450002
         OI    L4(CCWREG),X88      SET ON DATA CHAIN AND PCI            17500002
         SH    ERREG1,ERRCN4                                            17550002
         MVI   ZERO(ERREG1),ZERO                                        17600002
         MVC   L8(L8,CCWREG),RDSKIP   MOVE IN READ SKIP CCW             17650002
         MVC   L16(L8,CCWREG),ZERO(CCWREG)   MOVE 1ST CCW TO THIRD CCW  17700002
         MVC   L24(L8,CCWREG),L8(CCWREG)   MOVE 2ND TO 4TH              17750002
         MVC   L17(L3,CCWREG),L1(ERREG1)   MOVE PTR TO NEXT BUFFER      17800002
         L     ERREG2,L16(CCWREG)   GET ADDR OF NEXT BUFFER             17850002
         AH    ERREG2,ERRCN4       ADD LINK FIELD                       17900002
         ST    ERREG2,L16(CCWREG)   STORE AREA ADDR IN 3RD CCW          17950002
         OI    L5(CCWREG),X40      SET ON 1ST PCI BIT IN 1ST CCW        18000002
         O     CCWREG,L24(CCWREG)   PLACE ADDR OF 1ST IN 4TH CCW        18050002
         ST    CCWREG,L24(CCWREG)                                       18100002
         LR    ERREG2,CCWREG       POINT TO 1ST READ                    18150002
         LA    ERREG2,L16(ERREG2)   INCREMENT TO 3RD CCW                18200002
         ST    ERREG2,L8(CCWREG)   PLACE ADDR OF 3RD IN 2ND CCW         18250002
         MVC   L24(L1,CCWREG),L8(CCWREG)                                18300002
         LH    ERREG2,DCBBUFL      GET BUFFER LENGTH                    18400002
         SH    ERREG2,ERRCN4       SUBTRACT LINK FIELD                  18450002
         STH   ERREG2,L22(CCWREG)   STORE IN THIRD CCW                  18500002
         OI    L37(CCWREG),X80     INDICATE LAST CCW                    18550002
BSCEP04A LA    CCWREG,IOBERCCW     GET START ADDRESS                    18600002
         ST    CCWREG,IOBSTART     UPDATE STARTING POINT                18650002
         OI    IOSFLA,IOSERR+IOSEX   SET FLAGS TO RETRY                 18750002
         OI    IOBFLAG1,IOBERRTN+IOBIOERR   ASLO IN IOB                 18800002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 18810002
RETRY    EQU   *                                                        18850002
         L     NAMEREG,TRANSRTN    LOAD NAME OF 904B           YM02594K 18900002
XCTLOUT  EQU   *                                                        18950002
         L     ERRETR,CVTPTR       POINT TO CVT                         19000002
         USING CVTMAP,ERRETR                                            19050002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                19100002
         DROP  ERRETR                                                   19150002
         BR    ERRETR              XCTL                                 19200002
BSCEP05  EQU   *                                                        19250002
         CLI   L2(ERREG1),EBE      E TYPE MSG RECEIVED?                 19300002
         BNE   BSCEPREG                                                 19350002
         STC   ERREG4,L1(ERREG1)   PUT LENGTH IN BUFFER                 19400002
         SRL   ERREG4,L8                                                19450002
         STC   ERREG4,ZERO(ERREG1)                                      19500002
         LA    ERREG4,ERLOD12      GET RETURN ID                        19550002
         STC   ERREG4,L4(ERREG1)   PUT ID IN BUFFER                     19600002
         SRL   ERREG4,L8                                                19650002
         STC   ERREG4,L3(ERREG1)                                        19700002
         MVC   L6(L2,ERREG1),L4(UCBREG)   MOVE IN LINE ADDRESS          19750002
         ST    ERREG1,IOBERCCW     STORE BUFFER POINTER                 19800002
         MVI   EWAIND1,EWAILD15    EXIT TO LOAD 15             YM02594K 19850002
         MVC   EWAIAREA(L4),IOBERINF   MOVE SOH% POINTER TO EWA         19950002
         B     RETRY               GO TO 904B                           20000002
         EJECT                                                          20700002
**********                                                              20750002
*                                                                       20800002
*        EXECUTED INSTRUCTIONS                                          20850002
*                                                                       20900002
**********                                                              20950002
MOVE     EQU   *                                                        21000002
         MVC   L16(ZERO,ERREG1),L1(ERREG2)                              21050002
**********                                                              21100002
*                                                                       21150002
*        CONSTANTS                                                      21200002
*                                                                       21250002
**********                                                              21300002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       21350002
WTO1     WTO   'IEC815I                      ',MF=L,ROUTCDE=(2),       X21850002
               DESC=(3)                                                 21900002
LWTO1    EQU   *-WTO1              LENGTH OF PARAMETER LIST             21950002
WTO2     WTO   'IEC815I                                                X22000002
                                ',MF=L,ROUTCDE=(2),DESC=(3)             22050002
LWTO2    EQU   *-WTO2              LENGTH OF PARAMETER LIST             22100002
WRTRSPCW DC    X'0100004060080002'                                      22160002
RDSKIP   DC    X'02000000B81200C0'                                      22170002
ERRCN1   DC    H'1'                                                     22180002
ERRCN8   DC    H'8'                                                     22190002
ERLOD15  DC    H'6256'                                                  22192002
ERRCN4   DC    H'4'                                                     22194002
SHORTMSG DC    H'17'                                                    22196002
RITESIZE DC    H'60'                                                    22198002
ERRCN5   DC    H'5'                                                     22198402
OBRRTN   DC    C'TPR'                                                   22198802
PACHAREA DC    31C'204C'           PATCH AREA FOR MAINTENANCE           22200002
**********                                                              22250002
*                                                                       22300002
*        MISCELLANEOUS EQUATES                                          22350002
*                                                                       22400002
**********                                                              22450002
ERLOD00  EQU   X'2B'               IGE0004C NAME FOR XCTL      YM05680K 22460002
IOBCSWUC EQU   X'02'               UNIT CHECK MASK             YM02566K 22500002
SKIP     EQU   X'10'                                                    22550002
NOLERB   EQU   X'40'                                                    22600002
TOERROR  EQU   X'01'                                                    22650002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              22700002
L1       EQU   1                   LENGTH AND DISPLACEMENT              22750002
L2       EQU   2                   LENGTH AND DISPLACEMENT              22800002
L3       EQU   3                   LENGTH AND DISPLACEMENT              22850002
L4       EQU   4                   LENGTH AND DISPLACEMENT              22900002
L5       EQU   5                   LENGTH AND DISPLACEMENT              22950002
L6       EQU   6                   LENGTH AND DISPLACEMENT              23000002
L7       EQU   7                   LENGTH AND DISPLACEMENT              23050002
L8       EQU   8                   LENGTH AND DISPLACEMENT              23100002
L9       EQU   9                   LENGTH AND DISPLACEMENT              23150002
L12      EQU   12                  LENGTH AND DISPLACEMENT              23200002
L13      EQU   13                  LENGTH AND DISPLACEMENT              23250002
L14      EQU   14                  LENGTH AND DISPLACEMENT              23300002
L16      EQU   16                  LENGTH AND DISPLACEMENT              23350002
L17      EQU   17                  LENGTH AND DISPLACEMENT              23400002
L22      EQU   22                  LENGTH AND DISPLACEMENT              23450002
L24      EQU   24                  LENGTH AND DISPLACEMENT              23500002
L37      EQU   37                  LENGTH AND DISPLACEMENT              23550002
X3F      EQU   X'3F'                                                    23600002
X30      EQU   X'30'                                                    23650002
X08      EQU   X'08'                                                    23700002
X03      EQU   X'03'                                                    23750002
X40      EQU   X'40'                                                    23800002
X88      EQU   X'88'                                                    23850002
X80      EQU   X'80'                                                    23900002
BIT5     EQU   4                                                        23910002
BIT6     EQU   2                                                        23920002
BIT7     EQU   1                                                        23930002
DCBIOBSZ EQU   X'24'               IOB SIZE IN DCB                      23950002
TPOPCODE EQU   5                                                        24000002
ERRMAXCT EQU   7                                                        24050002
CCWWRITE EQU   1                                                        24100002
RTRNCDEP EQU   X'1A'                                                    24150002
LOSTDATA EQU   2                                                        24350002
L255     EQU   X'FF'               AND MASK                             24400002
WRTCONN  EQU   X'1C'               OP TYPE FOR WRITE CONNECT            24450002
IOBRHA   EQU   X'10'                                                    24550002
WTORTN   EQU   253                                                      24600002
ERLOD12  EQU   2043                ERROR POST                           24650002
UCBTYP   EQU   16                                                       24700002
EBE      EQU   C'E'                                                     24750002
EBC      EQU   C'C'                                                     24800002
CCWTIC   EQU   X'08'                                                    24850002
NULL     EQU   X'00'                                                    24900002
CDE2     EQU   X'40'                                                    24950002
CDE8     EQU   X'01'                                                    25000002
CDE10    EQU   X'40'                                                    25050002
INTBLCHK EQU   X'40'                                                    25100002
DYNBF    EQU   X'08'                                                    25150002
READINIT EQU   X'FE'                                                    25200002
SLAVCONT EQU   X'10'                                           @ZA14138 25210000
X0A      EQU   X'0A'                                           @ZA14138 25220000
**********                                                              25250002
*                                                                       25300002
*        REGISTER DEFINITIONS                                           25350002
*                                                                       25400002
**********                                                              25450002
ERREG3   EQU   0                   WORK REG                             25500002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              25550002
ERREG2   EQU   2                   WORK REG                             25600002
EWAREG   EQU   3                   ERP WORKAREA BASE                    25650002
CCWREG   EQU   4                   CCW ADDRESS REG                      25700002
DECBRG   EQU   5                   DECB BASE                            25750002
DCBREG   EQU   6                   DCB BASE                             25800002
UCBREG   EQU   7                   UCB BASE                             25850002
BASEREG  EQU   8                   PROGRAM BASE                         25900002
ERREG1   EQU   9                   WORK REG                             25950002
IOBRG    EQU   10                  IOB BASE                             26000002
ERREG4   EQU   11                  WORK REG                             26050002
ERRLNK   EQU   12                  LINK REG                             26100002
NAMEREG  EQU   13                  LINK REG                             26150002
ERRETR   EQU   14                  LINK REG                             26200002
ERREG5   EQU   15                  LINK REG/WORK REG                    26250002
         EJECT                                                          26300002
         IECTDECB                                                       26350002
         EJECT                                                          26400002
         DCBD  DSORG=BX,DEVD=BS                                         26450002
         EJECT                                                          26500002
         IECDRQE                                                        26550002
         EJECT                                                          26600002
         IEZIOB                                                         26650002
         EJECT                                                          26700002
CVT      DSECT                                                          26750002
         CVT                                                            26800002
         EJECT                                                          26850002
         IECDERWA                                                       26900002
**********                                                              26950002
*                                                                       27000002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        27050002
*                                                                       27100002
**********                                                              27150002
         ORG   EWAIERP                                                  27200002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 27250002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 27300002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 27350002
EWAIND0  DS    B                   FLAG BYTE                            27400002
EWAIVISR EQU   X'10'               V=R REQUEST                          28000002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 28050002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 28100002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 28150002
EWAIND1  DS    B                   FLAG BYTE                            28200002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 28250002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 28300002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 28350002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 28360002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 28370002
EWAIND2  DS    B                   FLAG BYTE                            28400002
EWAIND3  DS    B                   FLAG BYTE                            28450002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     28500002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  28550002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 28600002
*********  END OF BTAM LOCAL DEFINITIONS **********                     28610002
         EJECT                                                          28650002
         IECDIOSB                                                       28700002
         END                                                            28750002
./  ADD  SSI=40240808,NAME=IGE0304A
         TITLE 'IGE0304A - BTAM ERP INTERVENTION REQUIRED MODULE'       00850002
IGE0304A CSECT                                                          00900002
*********************************************************************** 00950002
*                                                                     * 01000002
* MODULE NAME:                                                        * 01050002
*    IGE0304A                                                         * 01100002
*                                                                     * 01150002
* DESCRIPTIVE NAME:                                                   * 01200002
*    BTAM INTERVENTION REQUIRED ERP                                   * 01250002
*                                                                     * 01300002
* COPYRIGHT:                                                          * 01350002
*    NONE                                                             * 01400002
*                                                                     * 01450002
* STATUS:                                                             * 01500002
*    CHANGE LEVEL 000                                                 * 01550002
*                                                                     * 01600002
* FUNCTION:                                                           * 01650002
*    IF REQUIRED, RETRIES CHANNEL PROGRAM THAT FAILED BECAUSE OF      * 01700002
*    AN INTERVENTION REQUIRED CONDITION. DETERMINES IF LINE ERROR     * 01750002
*    RECORDING IS REQUIRED AND EXITS EITHER TO LERB OR POST ROUTINE.  * 01800002
*                                                                     * 01850002
* NOTES:                                                              * 01900002
*    DEPENDENCIES:                                                    * 01950002
*        NONE                                                         * 02000002
*    RESTRICTIONS:                                                    * 02050002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 02100002
*    REGISTER CONVENTIONS:                                            * 02150002
*        SEE 'REGISTER DEFINITION' BELOW                              * 02200002
*                                                                     * 02250002
* PATCHLABEL:                                                         * 02300002
*    PACHAREA (68 BYTES)                                              * 02350002
*                                                                     * 02400002
* MODULE TYPE:                                                        * 02450002
*    PROCEDURE                                                        * 02500002
*    PROCESSOR:                                                       * 02550002
*        BAL                                                          * 02600002
*    MODULE SIZE:                                                     * 02650002
*        692 BYTES                                                    * 02700002
*    ATTRIBUTES:                                                      * 02750002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02800002
*                                                                     * 02850002
* ENTRY POINT:                                                        * 02900002
*    IGE0304A                                                         * 02950002
*    PURPOSE:                                                         * 03000002
*        SEE 'FUNCTION'                                               * 03050002
*    LINKAGE:                                                         * 03100002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 03150002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 03200002
*    INPUT:                                                           * 03250002
*        REG 1 = ADDRESS OF IOSB                                      * 03300002
*    OUTPUT:                                                          * 03350002
*        SET DECERRST FOR SHOULD NOT OCCUR ERROR.                     * 03400002
*        SET DECERRST FOR DISABLE REQUIRED.                           * 03450002
*        ALTERED CHANNEL PROGRAM.                                     * 03500002
*                                                                     * 03550002
* EXITS-NORMAL:                                                       * 03600002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03700002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03750002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03800002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03850002
*        LOADS ARE 1000 GREATER.                                      * 03900002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03950002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 04000002
*                                                                     * 04050002
* EXITS-ERROR:                                                        * 04100002
*    NONE                                                             * 04150002
*                                                                     * 04200002
* EXTERNAL REFERENCES:                                                * 04250002
*    ROUTINES:                                                        * 04300002
*        NONE                                                         * 04350002
*    DATA AREAS                                                       * 04450002
*        IOB (MAPPED BY IEZIOB)                                       * 04500002
*        VIRTUAL CHANNEL PROGRAM                                      * 04550002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04600002
*    CONTROL BLOCKS                                                   * 04650002
*        UCB                                                          * 04700002
*        DCB                                                          * 04750002
*        DECB                                                         * 04800002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04850002
*        CVT          (MAPPED BY CVT)                                 * 04900002
*        IOB          (MAPPED BY IEZIOB)                              * 04950002
*        RQE          (MAPPED BY IECDRQE)                             * 05000002
*                                                                     * 05150002
* TABLES-WORKAREAS:                                                   * 05200002
*    ERP WORKAREA                                                     * 05250002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 05300002
*                                                                     * 05350002
* MACROS:                                                             * 05400002
*    NONE                                                             * 05450002
*                                                                     * 05500002
* CHANGE ACTIVITY:                                                    * 05550002
*    YM02595K (9/20/73)                                               * 05600002
*    YM02594K (9/24/73)                                               * 05610002
*    YA02435  (11/5/73)                                               * 05620002
*    YA02436  (11/5/73)                                               * 05630002
*    YM05652K (1/25/74)                                               * 05640002
*                                                                     * 05650002
*********************************************************************** 05700002
         EJECT                                                          05750002
         USING *,BASEREG                                                05800002
         LR    BASEREG,ERREG5      SET BASE REG                         05850002
         USING RQE,ERREG5                                               05900002
         USING IOSB,IOSBREG                                             05950002
         USING IOBSTDRD,IOBRG                                           06000002
         USING EWA,EWAREG                                               06050002
         L     ERREG5,IOSUSE       BASE RQE                             06100002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    06150002
         L     IOBRG,RQEIOB        BASE IOB                             06200002
         L     DECBRG,IOBECBPT     BASE DECB                            06250002
         L     DCBREG,IOBDCBPT     BASE DCB                             06300002
         L     UCBREG,IOSUCB       BASE UCB                             06350002
         DROP  ERREG5                                                   06400002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       06450002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06500002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                06550002
         CLI   IOBERRCT+L1,MASK3   SPECIAL ENTRY FOR DISABLE            06600002
         BE    ERRTRY03            YES CHECK FOR DISABLE                06650002
         CLI   IOBERRCT+L1,X01     SPECIAL RETURN FOR WR EOT            06700002
         BE    ERRTRY04            YES, BRANCH                          06750002
         MVC   IOBWORK(L1),L5(CCWREG)   TP OP CODE TO WORK AREA         06800002
         NI    IOBWORK,L255-CCWMASK1   MASK OUT UNUSED BITS             06850002
         CLI   ZERO(CCWREG),CCWAPOLL   THIS AUTOPOLL                    06900002
         BE    ERRIRI02            YES SET UP POLL ADDRESS              06950002
         CLI   ZERO(CCWREG),CCWRDCMD   READ COMMAND                     07000002
         BE    ERRIRR00            YES CHECK WHEN                       07050002
         CLI   ZERO(CCWREG),CCWINHCD   INHIBIT COMMAND                  07100002
         BE    ERRIRR00            TREAT SAME AS READ                   07150002
         CLI   ZERO(CCWREG),CCWDIAL   DIAL COMMAND                      07200002
         BE    ERRIRI00            YES RETRY AT START                   07250002
         CLI   ZERO(CCWREG),CCWPREP   PREPARE COMMAND                   07300002
         BE    ERRIRI03            YES, CHECK ADAPTER TYPE              07350002
         CLI   ZERO(CCWREG),CCWWRT   WRITE COMMAND                      07400002
         BE    ERRIRWT1            YES SET UP TO FINI                   07450002
         CLI   ZERO(CCWREG),CCWBRK   BREAK COMMAND                      07500002
         BE    ERRIRWT1            YES SET UP TO FINI                   07550002
         OI    DECERRST(DECBRG),CSWSNO   SHOULD NOT OCCUR               07600002
         B     ERRTRY01            SET UP TO POST                       07650002
ERRIRWT1 MVI   IOBERRCT,ERTRYCT    SET RETRY COUNT TO MAXIMUM           07700002
         B     ERRTOD03            CHECK FOR LINE ERROR RECORDING       07750002
ERRIRWT0 CLI   IOBWORK,CCWRRPL     READ RESPONCE TO POLLING             07800002
         BNE   ERRIRI01            NO, CHECK FOR READ INDEX             07850002
         CLI   DECBTYPE(DECBRG),TYPEWTTV   IS READ RESP IN WRITE TTV    07900002
         BNE   ERRIRI00            NO, SET UP START OF CHAN PROG        07950002
         LA    ERREG4,IOBCPA+L16   SET UP START OF READ                 08000002
         ST    ERREG4,IOBSTART     SET RESTART ADDRESS                  08050002
         B     ERRTOD03            CHECK FOR LINE ERROR RECORDING       08200002
ERRIRI01 CLI   IOBWORK,CCWRDIX     THIS READ RESP TO INDEX              08250002
         BNE   ERRIRI00            NO, SET UP START OF CHAN PROG        08300002
ERRIRI02 EQU   *                                                        08350002
         L     ERREG1,IOBCPA+L8    LOAD ENTRY ADDRESS FROM PREVIOUS     08400002
*                                  POLL (WITH POLL COMMAND CODE         08450002
*                                  IN HIGH ORDER BYTE).                 08500002
         MVC   IOBCPA+L9(L3),DECENTRY+L1(DECBRG)   MOVE IN ADDRESS      08550002
*                                  OF LAST ENTRY POLLED (TO BE          08600002
*                                  USED AS RESTART ADDRESS).            08650002
         L     ERREG4,IOBCPA+L8    LOAD ENTRY ADDRESS FOR NEXT POLL     08700002
*                                  (WITH POLL COMMAND CODE IN           08750002
*                                  HIGH ORDER BYTE).                    08800002
         SR    ERREG1,ERREG4       SUBTRACT NEW POLL ADDRESS            08850002
*                                  FROM PREVIOUS POLL ADDRESS.          08900002
         AH    ERREG1,IOBCPA+L14   IF THE NEW POLL ADDRESS WERE         08950002
*                                  LESS THAN THE PREVIOUS POLL ADDRESS  09000002
*                                  THE EFFECT IS TO ADD THE ABSOLUTE    09050002
*                                  DIFFERENCE TO THE PREVIOUS COUNT;    09100002
*                                  OTHERWISE THE EFFECT IS TO SUBTRACT. 09150002
         STH   ERREG1,IOBCPA+L14   STORE ADJUSTED COUNT IN              09200002
*                                  POLL COMMAND.                        09250002
ERRIRI00 LA    ERREG4,IOBCPA       RESOLVE START OF CHAN PROGRAM        09350002
         ST    ERREG4,IOBSTART     STORE CPA POINTER                    09400002
         B     ERRTOD03            CHECK FOR LINE ERROR RECORDING       09550002
ERRIRI03 EQU   *                                                        09600002
         MVC   IOBWORK+L1(L1),UCBTYP+L3(UCBREG)   MOVE ADAPTER          09650002
         NI    IOBWORK+L1,MASK3    CLEAR USED BITS                      09700002
         CLI   IOBWORK+L1,X10      IBM TYPE 1 ADAPTER                   09750002
         BNE   ERRIRI00            NO, BRANCH                           09800002
         TM    UCBTYP(UCBREG),X04   TEST                                09850002
         BZ    ERRIRI00            FOR                                  09900002
         TM    UCBTYP(UCBREG),X03   2741                                09950002
         BNM   ERRIRI00            NOT 2741                             10000002
         TM    UCBTYP+L1(UCBREG),X90   SWITCHED LINE                    10050002
         BNZ   ERRIRI00            YES, BRANCH                          10100002
         MVC   IOBERINF+L8(L8),ZERO(CCWREG)   SAVE CCW                  10150002
         MVC   IOBERINF(L1),IOBSENS0   SAVE SENSE STATUS                10200002
         MVC   IOBERINF+L1(L7),IOBCSW   SAVE CSW                        10250002
         MVI   IOBWORK+L2,X1F      MOVE IN EOT                          10300002
         LA    ERREG1,IOBWORK+L2   GET ADDRESS OF EOT                   10350002
         ST    ERREG1,IOBERCCW     STORE IN CCW                         10400002
         LA    ERREG1,CCWWRT       GET COMMAND                          10450002
         STC   ERREG1,IOBERCCW     STORE COMMAND                        10500002
         ST    ERREG1,IOBERCCW+L4  STORE COUNT                          10550002
         LA    ERREG1,IOBERCCW     LOAD CCW ADDRESS                     10600002
         ST    ERREG1,IOBSTART     STORE CCW ADDRESS                    10650002
         MVI   IOBERRCT+L1,X01     MOVE IN SPECIAL RETURN               10800002
         B     ERRTOD03            UPDATE RETRY COUNT                   10850002
ERRTRY04 EQU   *                                                        10900002
         NI    IOBERRCT+L1,XFE     CLEAR SPECIAL RETURN                 10950002
         CLI   IOBERRCT,ERTRYCT    RETRY REQUIRED                       11000002
         BNL   ERRTRY05            NO, BRANCH                           11050002
         LA    ERREG4,IOBCPA                                            11100002
         ST    ERREG4,IOBSTART                                          11150002
         B     ERRTRY06            RESTART FAILING CCW                  11300002
ERRTRY05 EQU   *                                                        11350002
         MVC   IOBSENS0(L1),IOBERINF   RESTORE SENSE                    11400002
         MVC   IOBCSW(L7),IOBERINF+L1   RESTORE CSW                     11450002
         B     ERRPERM1            POST WITH ERROR                      11550002
ERRIRR00 TM    IOBWORK,CCWPTXFR    PRIOR TO TEXT TRANSFER               11600002
         BZ    ERRIRWT0            YES, CHECK FOR RESPONCE TO POLL      11650002
         CLI   IOBWORK,CCWRRTXT    READ RESPONSE TO TEXT                11700002
         BNE   ERRTSTX             NO CHECK FOR READ TEXT       YA02435 11750002
         TM    DCBERROP(DCBREG),DCBRDTRY   TEXT READ RETRIES REQUIRED   11800002
         BZ    ERRTOT06            NO CHECK FOR LINE ERROR UPDATE       11850002
         MVC   IOBWORK+L1(L1),DECTYPE+L1(DECBRG)   OP TYPE TO WORK AREA 11900002
         NI    IOBWORK+L1,L255-HIBIT   CLEAR UNUSED BIT                 11950002
         CLI   IOBWORK+L1,CCWWRTCT   OPERATION A WRITE CONTINUE         12000002
         BNE   ERRTOD03            CHECK FOR LINE ERROR UPDATE          12050002
ERRTOT06 TM    DCBERROP(DCBREG),DCBLERB   LINE ERROR RECORDING REQUIRED 12100002
         BZ    ERRTOT04            NO POST COMPLETE WITH ERROR          12150002
         MVI   IOBERRCT-L1,LERBIR   INDICATE LERB RECORDING             12200002
         NI    IOSFLA,L255-IOSEX-IOSERR   INDICATE POST NO WTO          12250002
         NI    IOBFLAG1,L255-IOBIOERR-IOBERRTN   ALSO IN IOB            12260002
         LA    NAMEREG,ERLOD12     ADDRESS OF LERB ROUTINE              12300002
         B     ERRLINK1                                                 12350002
ERRTSTX  EQU   *                                                YA02435 12360002
         CLI   IOBWORK,CCWRDTXT    READ TEXT                    YA02435 12370002
         BNE   ERRTOT06            NO                           YA02435 12380002
         TM    DCBERROP(DCBREG),DCBLERB   LERB REQUIRED         YA02435 12390002
         BZ    ERRPERM1            NO, POST COMPLETE            YA02435 12392002
         MVI   IOBERRCT-L1,LERBIR   INT. REQ. LERB              YA02435 12394002
         B     ERRPERM1            EXIT                         YA02435 12396002
ERRTOD03 TM    DCBERROP(DCBREG),DCBLERB   LINE ERROR RECORDING REQUIRED 12400002
         BZ    ERRCTT01            NO CONTINUE FLOW                     12450002
         MVI   IOBERRCT-L1,LERBIR   INDICATE INT REQ LERB               12500002
ERRCTT01 CLI   IOBERRCT,ERTRYCT    RETRY REQUIRED                       12550002
         BL    ERRTRY02            YES SET UP FOR RETRY                 12600002
         CLI   ZERO(CCWREG),CCWDISAB   DISABLE EXECUTED                 12650002
         BE    ERRPERM1            YES POST COMPLETE WITH ERROR         12700002
ERRTRY01 TM    UCBTYP+L1(UCBREG),SWLINE   DISABLE REQUIRED              12750002
         BZ    ERRPERM1            NO POST COMPLETE                     12800002
ERRTRY03 EQU   *                                                        12850002
         MVC   IOBERINF+L8(L8),ZERO(CCWREG)   SAVE CCW                  12900002
         MVC   IOBERINF(L1),IOBSENS0   SAVE SENSE DATA                  12950002
         MVC   IOBERINF+L1(L7),IOBCSW   SAVE CSW DATA                   13000002
         MVI   IOBERRCT+L1,DISABIND   INDICATE DISABLE REQUIRED         13050002
         LA    ERREG1,IOBERCCW     CHANNEL PROG ADDRESS                 13100002
         ST    ERREG1,IOBSTART     CHAN PROG POINTER                    13150002
         OI    DECERRST(DECBRG),DISABLOK   INDICATE DISABLE EXECUTED    13300002
         MVC   IOBERCCW(L8),DISABCMD   GENERATE DISABLE CCW             13350002
ERRTRY02 IC    ERREG1,IOBERRCT     ERROR RETRY COUNT                    13400002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE                          13450002
         STC   ERREG1,IOBERRCT     RESTORE IN COUNT FIELD               13500002
         CLI   IOBERRCT-L1,LERBIR    LERB REQUIRED              YA02436 13550002
         BE    ERLERBTO            YES, EXIT TO LERB ROUTINE    YA02436 13600002
ERRTRY06 EQU   *                                                        13650002
         MVI   IOBSENS0,ZERO       CLEAR SENSE BYTE                     13700002
RETRY    EQU   *                                                        13750002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 13800002
         L     NAMEREG,TRANSRTN    LOAD NAME                            15400002
         B     ERRLINK1            XCTL                                 15450002
ERRPERM1 EQU   *                                                        18550002
         NI    IOSFLA,L255-IOSERR                                       18600002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     18610002
         CLI   IOBERRCT-L1,LERBIR    LERB REQUIRED              YA02436 18650002
         BE    ERLERBTO            YES, EXIT                    YA02436 18700002
         LH    NAMEREG,ERLOD5      ADDRESS OF POST ROUTINE              18750002
ERRLINK1 EQU   *                                                        18800002
         L     ERRETR,CVTPTR       POINT TO CVT                         18850002
         USING CVTMAP,ERRETR                                            18900002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                18950002
         BR    ERRETR              XCTL                                 19000002
         DROP  ERRETR                                                   19050002
ERLERBTO LA    NAMEREG,ERLOD12     ADDRESS OF LERB ROUTINE              19100002
         B     ERRLINK1                                                 19150002
ERRTOT04 NI    IOSFLA,L255-IOSERR   INDICATE PERM ERROR                 19200002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     19210002
         B     RETRY              GO EXCP                               19250002
         EJECT                                                          19300002
**********                                                              19350002
*                                                                       19400002
*        CONSTANTS                                                      19450002
*                                                                       19500002
**********                                                              19550002
         DS    0D                                                       19600002
DISABCMD DC    X'2F00000020300001'                                      19650002
TRANSRTN DC    F'9042'             BTAM TRANSLATOR ROUTINE NAME         19700002
ERRCN8   DC    H'8'                DECIMAL 8                            19750002
ERLOD5   DC    H'5041'                                                  19800002
PACHAREA DC    17C'304A'           PATCHAREA FOR MAINTENANCE            19850002
**********                                                              19900002
*                                                                       19950002
*        MISCELLANEOUS EQUATES                                          20000002
*                                                                       20050002
**********                                                              20100002
CCWAPOLL EQU   X'09'                                                    20150002
CCWBRK   EQU   X'0D'                                                    20200002
CCWDIAL  EQU   X'29'                                                    20250002
CCWDISAB EQU   X'2F'                                                    20300002
CCWINHCD EQU   X'0A'                                                    20350002
CCWMASK1 EQU   X'C0'                                                    20400002
CCWPREP  EQU   X'06'                                                    20450002
CCWPTXFR EQU   X'30'                                                    20500002
CCWRDCMD EQU   X'02'                                                    20550002
CCWRDIX  EQU   X'0A'                                                    20600002
CCWRRPL  EQU   X'05'                                                    20650002
CCWRRTXT EQU   X'20'                                                    20700002
CCWWRT   EQU   X'01'                                                    20750002
CCWWRTCT EQU   X'04'                                                    20800002
CSWSNO   EQU   X'40'                                                    20850002
DCBERROP EQU   33                                                       20900002
DCBLERB  EQU   X'08'                                                    20950002
DCBRDTRY EQU   X'02'                                                    21000002
DECBTYPE EQU   X'04'                                                    21050002
DECENTRY EQU   20                                                       21100002
DECERRST EQU   29                                                       21150002
DECTYPE  EQU   4                                                        21200002
DISABIND EQU   X'80'                                                    21250002
DISABLOK EQU   X'08'                                                    21300002
ERLOD12  EQU   2042                                                     21350002
ERTRYCT  EQU   X'02'                                                    21400002
HIBIT    EQU   X'C0'                                                    21500002
LERBIR   EQU   X'02'                                                    21550002
L1       EQU   1                    LENGTH AND DISPLACEMENT             21600002
L2       EQU   2                    LENGTH AND DISPLACEMENT             21650002
L3       EQU   3                    LENGTH AND DISPLACEMENT             21700002
L4       EQU   4                    LENGTH AND DISPLACEMENT             21750002
L5       EQU   5                    LENGTH AND DISPLACEMENT             21800002
L6       EQU   6                    LENGTH AND DISPLACEMENT             21850002
L7       EQU   7                    LENGTH AND DISPLACEMENT             21900002
L8       EQU   8                    LENGTH AND DISPLACEMENT             21950002
L9       EQU   9                    LENGTH AND DISPLACEMENT             22000002
L14      EQU   14                   LENGTH AND DISPLACEMENT             22250002
L16      EQU   16                   LENGTH AND DISPLACEMENT             22350002
L255     EQU   255                  AND MASK                            22400002
MASK3    EQU   X'F0'                                                    22450002
ZERO     EQU   X'00'                LENGTH AND DISPLACEMENT             22500002
SWLINE   EQU   X'90'                                                    22600002
TYPEWTTV EQU   X'0F'                                                    22650002
UCBTYP   EQU   16                   DEVICE TYPE CODE                    22700002
XFE      EQU   X'FE'                                                    22750002
X1F      EQU   X'1F'                                                    22800002
X90      EQU   X'90'                                                    22850002
X03      EQU   X'03'                                                    22900002
X04      EQU   X'04'                                                    22950002
X10      EQU   X'10'                                                    23000002
X01      EQU   X'01'                                                    23050002
CCWRDTXT EQU   X'11'               TP OP CODE FOR READ TEXT     YA02435 23060002
**********                                                              23100002
*                                                                       23150002
*        REGISTER DEFINITION                                            23200002
*                                                                       23250002
**********                                                              23300002
ERREG3   EQU   0                   WORK REG                             23350002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              23400002
EWAREG   EQU   2                   ERP WORKAREA BASE                    23450002
BASEREG  EQU   3                   PROGRAM BASE                         23500002
CCWREG   EQU   4                   CCW ADDRESS REG                      23550002
DECBRG   EQU   5                   DECB BASE                            23600002
DCBREG   EQU   6                   DCB BASE                             23650002
UCBREG   EQU   7                   UCB BASE                             23700002
ERREG2   EQU   8                   WORK REG                             23750002
ERREG1   EQU   9                   WORK REG                             23800002
IOBRG    EQU   10                  IOB BASE                             23850002
ERREG4   EQU   11                  WORK REG                             23900002
ERRLNK   EQU   12                  LINK REG                             23950002
NAMEREG  EQU   13                  LINK REG                             24000002
ERRETR   EQU   14                  RETURN REG                           24050002
ERREG5   EQU   15                  WORK REG                             24100002
         EJECT                                                          24250002
         IECDRQE                                                        24300002
         EJECT                                                          24350002
         IEZIOB                                                         24400002
IOBCMD3  EQU   IOBCPA+L16                                               24450002
         EJECT                                                          24500002
CVT      DSECT                                                          24550002
         CVT                                                            24600002
         EJECT                                                          24650002
         IECDERWA                                                       24700002
**********                                                              24750002
*                                                                       24800002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        24850002
*                                                                       24900002
**********                                                              24950002
         ORG   EWAIERP                                                  25000002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 25050002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 25100002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 25150002
EWAIND0  DS    B                   FLAG BYTE                            25200002
EWAIVISR EQU   X'10'               V=R REQUEST                          25800002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 25850002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 25900002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 25950002
EWAIND1  DS    B                   FLAG BYTE                            26000002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 26050002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 26100002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 26150002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 26160002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 26170002
EWAIND2  DS    B                   FLAG BYTE                            26200002
EWAIND3  DS    B                   FLAG BYTE                            26250002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     26300002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  26350002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 26400002
*********  END OF BTAM LOCAL DEFINITIONS **********                     26450002
         EJECT                                                          27450002
         IECDIOSB                                                       27500002
         END                                                            27550002
./  ADD  SSI=53000167,NAME=IGE0304B
         TITLE 'IGE0304B - BTAM ERP UNIT EXCEPTION MODULE'              00100002
IGE0304B CSECT                                                          00150002
*********************************************************************** 00200002
*                                                                     * 00250002
* MODULE NAME:                                                        * 00300002
*    IGE0304B                                                         * 00350002
*                                                                     * 00400002
* DESCRIPTIVE NAME:                                                   * 00450002
*    BTAM UNIT EXCEPTION ERP                                          * 00500002
*                                                                     * 00550002
* COPYRIGHT:                                                          * 00600002
*    NONE                                                             * 00650002
*                                                                     * 00700002
* STATUS:                                                             * 00750002
*    CHANGE LEVEL 000                                                 * 00800002
*                                                                     * 00850002
* FUNCTION:                                                           * 00900002
*    THIS MODULE RETRIES IF REQUIRED THE CHANNEL PROGRAM THAT         * 00950002
*    FAILED DUE TO A UNIT EXCEPTION CHECK.                            * 01000002
*                                                                     * 01050002
* NOTES:                                                              * 01100002
*    DEPENDENCIES:                                                    * 01150002
*        NONE                                                         * 01200002
*    RESTRICTIONS:                                                    * 01250002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01300002
*    REGISTER CONVENTIONS:                                            * 01350002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01400002
*                                                                     * 01450002
* PATCHLABEL:                                                         * 01500002
*    PACHAREA (76 BYTES)                                              * 01550002
*                                                                     * 01600002
* MODULE TYPE:                                                        * 01650002
*    PROCEDURE                                                        * 01700002
*    PROCESSOR:                                                       * 01750002
*        BAL                                                          * 01800002
*    MODULE SIZE:                                                     * 01850002
*        776 BYTES                                                    * 01900002
*    ATTRIBUTES:                                                      * 01950002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02000002
*                                                                     * 02050002
* ENTRY POINT:                                                        * 02100002
*    IGE0304B                                                         * 02150002
*    PURPOSE:                                                         * 02200002
*        SEE 'FUNCTION'                                               * 02250002
*    LINKAGE:                                                         * 02300002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02350002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02400002
*    INPUT:                                                           * 02450002
*        REG 1 = ADDRESS OF IOSB                                      * 02500002
*    OUTPUT:                                                          * 02550002
*        SET DECERRST FOR SHOULD NOT OCCUR ERROR.                     * 02600002
*        ALTERED CHANNEL PROGRAM.                                     * 02650002
*                                                                     * 02700002
* EXITS-NORMAL:                                                       * 02750002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 02850002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 02900002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 02950002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03000002
*        LOADS ARE 1000 GREATER.                                      * 03050002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03100002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03150002
*                                                                     * 03200002
* EXITS-ERROR:                                                        * 03250002
*    NONE                                                             * 03300002
*                                                                     * 03350002
* EXTERNAL REFERENCES:                                                * 03400002
*    ROUTINES:                                                        * 03450002
*        SVC 35 WTO                                                   * 03500002
*        WRITE                                                        * 03550002
*    DATA AREAS                                                       * 03650002
*        IOB (MAPPED BY IEZIOB)                                       * 03700002
*        VIRTUAL CHANNEL PROGRAM                                      * 03750002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 03800002
*    CONTROL BLOCKS                                                   * 03850002
*        UCB                                                          * 03900002
*        DCB                                                          * 03950002
*        DECB                                                         * 04000002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04050002
*        CVT          (MAPPED BY CVT)                                 * 04100002
*        IOB          (MAPPED BY IEZIOB)                              * 04150002
*        RQE          (MAPPED BY IECDRQE)                             * 04200002
*                                                                     * 04250002
* TABLES-WORKAREAS:                                                   * 04300002
*    ERP WORKAREA                                                     * 04350002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04400002
*                                                                     * 04450002
* MACROS:                                                             * 04500002
*    WTO                                                              * 04550002
*    WRITE                                                            * 04600002
*                                                                     * 04650002
* CHANGE ACTIVITY:                                                    * 04700002
*    YA01250  (IN BASE)                                               * 04710002
*    YM02595K (9/20/73)                                               * 04750002
*    YM02594K (9/24/73)                                               * 04800002
*    YM05652K (1/24/74)                                               * 04810002
*    YA03259  (2/4/74)                                                * 04820000
*    AZ04871  (10/06/75)                                              * 04830000
*    AZ04886  (10/06/75)                                              * 04840000
*                                                                     * 04850002
*********************************************************************** 04900002
         EJECT                                                          04950002
         USING *,BASEREG                                                05000002
         LR    BASEREG,ERREG5      SET BASE REG                         05050002
         USING RQE,ERREG5                                               05100002
         USING IOSB,IOSBREG                                             05150002
         USING IOBSTDRD,IOBRG                                           05200002
         USING EWA,EWAREG                                               05250002
         L     ERREG5,IOSUSE       BASE RQE                             05300002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05350002
         L     IOBRG,RQEIOB        BASE IOB                             05400002
         L     DECBRG,IOBECBPT     BASE DECB                            05450002
         L     DCBREG,IOBDCBPT     BASE DCB                             05500002
         L     UCBREG,IOSUCB       BASE UCB                             05550002
         DROP  ERREG5                                                   05600002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       05650002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                05700002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                05750002
         MVC   IOBWORK(L1),L5(CCWREG)   TP OP CODE TO WORK AREA         05800002
         NI    IOBWORK,L255-CCWMASK1   CLEAR UNUSED BITS                05850002
         MVC   IOBWORK+L1(L1),UCBTYP+L3(UCBREG)   ADAPT TYPE TO         05900002
*                                  WORK AREA                            05950002
         NI    IOBWORK+L1,MASK3    CLEAR UNUSED BITS                    06000002
         CLI   ZERO(CCWREG),CCWWRT   THIS A WRITE COMMAND               06100002
         BE    ERRUEE06            YES CHECK FOR ADAPTER TYPE           06150002
         CLI   ZERO(CCWREG),CCWAPOLL   THIS AUTOPOLL                    06250002
         BE    ERRUEE06            YES TREAT AS READ                    06300002
         CLI   IOBWORK,CCWRRTXT    THIS A READ RESPONSE TO TEXT         06350002
         BNE   ERRUEE01            NO INDICATE SHOULD NO OCCUR          06400002
         CLI   IOBWORK+L1,IBMADPT3   IBM TYPE 3 ADAPTER(2260R)?         06450002
         BE    ERRUEE02            YES, POST WITH ERROR                 06500002
         CLI   IOBWORK+L1,IBMADPT1   IBM TYPE 1 ADAPTER?                06550002
         BNE   ERRUEE01            IF NOT, BRANCH.                      06600002
         TM    UCBTYP(UCBREG),X09   IS IT 2740B                         06650002
         BO    A2740               YES, TREAT AS 2740                   06700002
         TM    UCBTYP(UCBREG),L255-MASK3-MODL2740   MODEL CODE          06750002
         BNZ   ERRUEE01            OTHER THAN 2740 IF SO, BRANCH.       06800002
A2740    EQU   *                                                        06850002
         TM    UCBTYP+L1(UCBREG),SCONTROL+CHECKING   2740 WITH          06900002
*                                  STATION CONTROL AND CHECKING         06950002
*                                  FEATURES. IF SO, A 2740 MOD2         07000002
*                                  HAS DETECTED A BUFFER OVERFLOW       07050002
*                                  PRINTER OVERFLOW OR INCORRECT        07100002
*                                  CASE ERROR CONDITION                 07150002
         BO    ERRUEE03            GO CHECK FOR WRITE RETRIES           07200002
ERRUEE01 CLI   IOBWORK,X06         RD RESP TO ADDR CCW                  07250002
         BNE   ERRSNO              NO, SHOULD NOT OCCUR                 07300002
         TM    UCBTYP+L3(UCBREG),XE0   THIS TYPE I ADAPTER              07350002
         BNZ   ERRSNO              NO, SHOULD NOT OCCUR                 07400002
         TM    UCBTYP(UCBREG),X09   IS IT 2740B                         07450002
         BO    A2740B              YES, TREAT AS 2740                   07500002
         TM    UCBTYP(UCBREG),X0B   THIS A 2740 TERMINAL                07550002
         BNZ   ERRSNO              NO, SHOULD NOT OCCUR                 07600002
A2740B   EQU   *                                                        07650002
         CLI   DECRESPN+L1(DECBRG),X40   THIS A CIRCLE N                07700002
         BNE   ERRCRY              NO, CHECK FOR CIRCLE Y               07750002
         MVI   ZERO(CCWREG),X03    CHANGE OPERATION TO NOP              08250002
         LR    ERREG4,CCWREG       SAVE CCW ADDRESS                     08300002
         B     ERR27402                                                 08350002
ERRCRY   CLI   DECRESPN+L1(DECBRG),X76   THIS A CIRCLE Y                08850002
         BNE   ERRSNO              NO, SHOULD NOT OCCUR                 08900002
         NI    IOBSTBYT,XFE        SET UNIT EXCEPTION OFF               08950002
         LA    ERREG4,L8(CCWREG)   BUMP TO NEXT CCW                     09050002
ERR27402 ST    ERREG4,IOBSTART     STORE ADDRESS RESTART                09100002
         MVC   EWAIAREA(LMSG),ERRMSG   MOVE PARAMETER LIST              09700002
         MVC   EWAICCC(L2),COMCODE   MOVE COMMAND CODE                  09750002
         UNPK  EWAICCSW(L5),IOBSTBYT(L3)   UNPACK CSW                   09800002
         UNPK  EWAICSNS(L5),IOBSENS0(L3)   UNPACK SENSE                 09850002
         MVC   IOBREPOS(L1),L5(CCWREG)   MOVE IN TP OP CODE             09900002
         LR    ERREG4,CCWREG       SAVE CCW ADDRESS                     09950002
LOOP     SH    ERREG4,ERRCN8       BACK UP ONE CCW                      10000002
         CLI   L5(ERREG4),X03      WRITE ADDR CHAR CCW                  10050002
         BNE   LOOP                NO BACK ONE MORE                     10100002
         L     ERREG4,ZERO(ERREG4)   ADDRESS OF ADDR CHARS              10150002
         MVC   IOBRSTRB+L1(L1),ZERO(ERREG4)   MOVE IN ADDR CHARS        10200002
         MVC   IOBRSTRB+L2(L1),DECRESPN(DECBRG)   MOVE IN STATUS CO     10250002
         UNPK  EWAICTP(L9),IOBREPOS(L5)   UNPACK TPOP & ID              10300002
         TR    EWAICCC(L22),ERRTBL-L240   TRANSLATE                     10350002
         MVC   EWAICUCB(L3),UCBNAME(UCBREG)   MOVE IN UNIT NAME         10400002
         MVI   EWAICC1,COMMA       SET UP                               10450002
         MVI   EWAICC2,COMMA       COMMAS AND                           10500002
         MVI   EWAICC3,COMMA       SPACES IN                            10550002
         MVI   EWAICBL,BLANK       MESSAGE                              10600002
         LR    ERREG2,IOSBREG      SAVE IOSB BASE                       10650002
         SR    ERREG3,ERREG3       CLEAR PARAMETER REG                  10700002
         WTO   MF=(E,EWAIAREA)                                          10750002
         LR    IOSBREG,ERREG2      RESTORE IOSB BASE                    10800002
RETRY    EQU   *                                                        10850002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 10900002
         L     NAMEREG,TRANSRTN    LOAD NAME                            13600002
         B     ERRLINK1            XCTL                                 13650002
ERRSNO   OI    DECERRST(DECBRG),CSWSNO   INDICATE SHOULD NOT OCCUR      13900002
ERRUEE02 OI    IOSFLB,IOSLOG       INDICATE OBR LOGOUT                  13950002
         NI    IOSFLA,L255-IOSERR TURN OFF ERP IN CNTL IN IOSB @ZA04886 14000000
         NI    IOBFLAG1,L255-IOBERRTN      ALSO IN IOB         @ZA04886 14050000
         LH    NAMEREG,ERLOD5      ADDRESS OF ERROR POST                14100002
         MVC   EWACHA(L2),L4(UCBREG)  MOVE ADDR TO WORK AREA   @ZA04871 14120000
ERRLINK1 EQU   *                                                        14150002
         L     ERRETR,CVTPTR       POINT TO CVT                         14200002
         USING CVTMAP,ERRETR                                            14250002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                14300002
         BR    ERRETR              XCTL                                 14350002
         DROP  ERRETR                                                   14400002
ERRUEE03 TM    DCBERROP(DCBREG),DCBWRTRY   WRITE RETRIES SPECIFIED      14450002
         BZ    ERRUEE02            NO POST COMPLETE WITH ERROR          14500002
         CLI   IOBERRCT,ERTRYCT    RETRY COUNT AT MAX                   14550002
         BNL   ERRUEC01            YES CHECK FOR DISABLE REQUIRED       14600002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  14650002
         LA    ERREG1,L1(ERREG1)   ADD 1 TO RETRY COUNT                 14700002
         STC   ERREG1,IOBERRCT     STORE NEW COUNT                      14750002
         MVC   IOBWORK+L2(L1),DECTYPE+L1(DECBRG)   OP TYPE TO WORKAREA  14800002
         NI    IOBWORK+L2,L255-HIBIT   CLEAR UNUSED BITS                14850002
         CLI   IOBWORK+L2,DECWINIT   OP TYPE WRITE INITIAL      YA03259 14900000
         BNE   ERRUEE02            NO, GO TO ERROR POST         YA03259 14950000
*                                  THE FOLLOWING DELETED FOR    YA03259 14960000
***      NI    DECTYPE+L1(DECBRG),CCWMASK1   CLEAR OP TYPE BITS         15000000
***      OI    DECTYPE+L1(DECBRG),DECWRCNT   INDICATE WRITE CONTINUE    15050000
ERRUEE04 EQU   *                                                        15100002
***      LR    ERREG2,IOSBREG      SAVE IOSB BASE                       15150000
***      OI    IOBBTAMF,X08        ERP FLAG FOR RD/WR                   15200000
***      LA    NAMEREG,EWAIAREA-L12   ADDRESS OF REG SAVE AREA          15250000
***      LR    IOSBREG,DECBRG      DECB ADDRESS IN PARAMETER REG        15300000
***      WRITE (1),T,MF=E          CONSTRUCT CHANNEL PROGRAM            15350000
***      LR    IOSBREG,ERREG2      RESTORE IOSB BASE                    15400000
***      NI    IOBBTAMF,L255-X08   ERP RD/WR FLAG OFF                   15550000
ERRUEE05 MVI   IOBSENS0,ZERO       CLEAR SENSE BYTE                     15600002
         B     RETRY               ERROR EXCP                           15650002
ERRUEE06 EQU   *                                                        15700002
         CLI   IOBWORK+L1,IBMADPT1   IBM TYPE 1 ADAPTER                 15750002
         BNE   ERRUEC06            NO                                   15800002
         TM    UCBTYP(UCBREG),X04   TEST                                15850002
         BZ    ERRUEC06            FOR                                  15900002
         TM    UCBTYP(UCBREG),X03   2741                                15950002
         BNM   ERRUEC06            NOT 2741                             16000002
         CLI   IOBERRCT,ERTRYCT    RETRY COUNT AT MAX                   16050002
         BNL   ERRUEE02                                                 16100002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  16150002
         LA    ERREG1,L1(ERREG1)   ADD ONE                              16200002
         STC   ERREG1,IOBERRCT     STORE                                16250002
         ST    CCWREG,IOBSTART     RESTART AT WRITE                     16300002
         B     ERRUEE05                                                 16850002
ERRUEC06 EQU   *                                                        16900002
         MVC   IOBERCCW(L8),ERRSKEL1   MOVE SKELETON CCW                16950002
         LA    ERREG1,IOBERCCW     ADDRESS OF DUMMY CCW                 17000002
         ST    ERREG1,IOBSTART     STORE IN CHAN PROG POINTER LOC       17050002
         MVI   IOBERRCT+L1,UELINKID   INDICATE UNIT EXCEPTION RETURN    17200002
         CLI   IOBWORK+L1,TTYADPT1   IS THIS TELETYPE ADAPTER 1         17250002
         BE    ERRUEE07            YES SET UP WRITE BREAK               17300002
         MVI   IOBERCCW,CCWRDSKP   SET UP FOR A READ SKIP OPERATON      17350002
         OI    IOBERCCW+L4,CCWSKPID   INDICATE READ SKIP OPERATION      17400002
         B     ERRUEE08            BRANCH TO EXECUTE CHAN PROGRAM       17450002
ERRUEE07 ST    IOBRG,IOBERCCW      VALID DATA ADDRESS                   17500002
         MVI   IOBERCCW,CCWWRTBK   PUT WRITE CMND IN CCW                17550002
         MVC   IOBERCCW+L6(L2),CCWBRKCT   PUT WRITE BREAK COUNT IN CCW  17600002
ERRUEE08 MVC   IOBERINF(L1),IOBSENS0   SAVE PREVIOUS SENSE DATA         17650002
         MVC   IOBERINF+L8(L8),ZERO(CCWREG)   SAVE FAILING CCW          17700002
         MVI   IOBSENS0,ZERO       CLEAR SENSE BYTE                     17750002
         MVC   IOBERINF+L1(L7),IOBCSW   SAVE CSW DATA                   17800002
         B     RETRY               ERROR EXCP                           17850002
ERRUEC01 TM    UCBTYP+L1(UCBREG),SWLINE  DISABLE REQUIRED               17900002
         BZ    ERRUEE02            NO POST WITH ERROR                   17950002
         MVI   IOBERRCT+L1,MASK15   SPECIAL DISABLE ENTRY INDICATOR     18000002
         L     NAMEREG,ERLOD9      ADDRESS OF DISABLE ROUTINE           18050002
         B     ERRLINK1            EXIT ROUTINE                         18100002
         EJECT                                                          18150002
**********                                                              18200002
*                                                                       18250002
*        CONSTANTS                                                      18300002
*                                                                       18350002
**********                                                              18400002
         DS    0D                                                       18450002
ERRMSG   WTO   'IEA000I  AAA,I/O ERR,BB,CCCC,DDEE,FFGGHHHH ',          X18500002
               MF=L,ROUTCDE=(1,8,10)                                    18550002
LMSG     EQU   *-ERRMSG            LENGTH OF PARAMETER LIST             18600002
TRANSRTN DC    F'9042'             BTAM TRANSLATE ROUTINE NAME          18650002
ERLOD9   DC    F'9041'             BTAM DISABLE ROUTINE NAME            18700002
ERRSKEL1 DC    X'00000000203000FF'                                      18750002
ERRCN8   DC    H'8'                DECIMAL 8                            18800002
ERLOD5   DC    H'5041'             BTAM ERROR POST ROUTINE NAME         18850002
CCWBRKCT DC    H'15'                                                    18900002
ERRTBL   DC    C'0123456789ABCDEF'                                      18950002
COMCODE  DC    C'02'                                                    19000002
PACHAREA DC    19C'304B'           PATCH AREA FOR MAINTENANCE           19050002
**********                                                              19100002
*                                                                       19150002
*        MISCELLANEOUS EQUATES                                          19200002
*                                                                       19250002
**********                                                              19300002
DECWINIT EQU   X'02'               WRITE INITIAL OP TYPE        YA03259 19350000
DECRESPN EQU   26                                                       19400002
UCBNAME  EQU   13                                                       19450002
CCWAPOLL EQU   X'09'                                                    19500002
CCWWRT   EQU   X'01'                                                    19550002
CCWWRTBK EQU   X'0D'                                                    19600002
UELINKID EQU   X'04'                                                    19700002
CCWMASK1 EQU   X'C0'                                                    19800002
MASK3    EQU   X'F0'                                                    19850002
CCWRRTXT EQU   X'20'                                                    19900002
DCBERROP EQU   33                                                       19950002
DCBWRTRY EQU   X'04'                                                    20000002
ERTRYCT  EQU   X'02'                                                    20050002
DECTYPE  EQU   4                                                        20100002
HIBIT    EQU   X'C0'                                                    20150002
DECWRCNT EQU   X'04'                                                    20200002
COMMA    EQU   C','                CHARACTER COMMA                      20250002
BLANK    EQU   C' '                CHARACTER BLANK                      20300002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              20350002
L255     EQU   255                 AND MASK                             20400002
L1       EQU   1                   LENGTH AND DISPLACEMENT              20450002
L2       EQU   2                   LENGTH AND DISPLACEMENT              20500002
L3       EQU   3                   LENGTH AND DISPLACEMENT              20550002
L4       EQU   4                   LENGTH AND DISPLACEMENT              20600002
L5       EQU   5                   LENGTH AND DISPLACEMENT              20650002
L6       EQU   6                   LENGTH AND DISPLACEMENT              20700002
L7       EQU   7                   LENGTH AND DISPLACEMENT              20750002
L8       EQU   8                   LENGTH AND DISPLACEMENT              20800002
L9       EQU   9                   LENGTH AND DISPLACEMENT              20850002
L12      EQU   12                  LENGTH AND DISPLACEMENT              20900002
L22      EQU   22                  LENGTH AND DISPLACEMENT              20950002
L240     EQU   240                 LENGTH AND DISPLACEMENT              21000002
X09      EQU   X'09'               2740B MASK                           21050002
X06      EQU   X'06'               READ RESPONSE MASK                   21100002
XE0      EQU   X'E0'               TYPE 1 ADAPTER MASK                  21150002
X0B      EQU   X'0B'               2740 TERMINAL MASK                   21200002
X40      EQU   X'40'               CIRCLE N MASK                        21250002
X03      EQU   X'03'               NOP                                  21300002
X76      EQU   X'76'               CIRCLE Y MASK                        21350002
XFE      EQU   X'FE'               U/C AND MASK                         21400002
X08      EQU   X'08'               READ/WRITE MASK                      21450002
X04      EQU   X'04'               2741 MASK                            21500002
IBMADPT1 EQU   X'10'                                                    21600002
TTYADPT1 EQU   X'40'                                                    21650002
IBMADPT3 EQU   X'80'                                                    21700002
MODL2740 EQU   X'04'                                                    21750002
SCONTROL EQU   X'08'                                                    21800002
CHECKING EQU   X'20'                                                    21850002
CCWRDSKP EQU   X'02'                                                    21900002
CCWSKPID EQU   X'30'                                                    21950002
DECERRST EQU   29                                                       22000002
CSWSNO   EQU   X'40'                                                    22050002
UCBTYP   EQU   16                                                       22100002
SWLINE   EQU   X'90'                                                    22150002
MASK15   EQU   X'0F'                                                    22250002
**********                                                              22300002
*                                                                       22350002
*        REGISTER DEFINITION                                            22400002
*                                                                       22450002
**********                                                              22500002
ERREG3   EQU   0                   WORK REG                             22550002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              22600002
ERREG2   EQU   2                   WORK REG                             22650002
BASEREG  EQU   3                   PROGRAM BASE                         22700002
CCWREG   EQU   4                   CCW ADDRESS REG                      22750002
DECBRG   EQU   5                   DECB BASE                            22800002
DCBREG   EQU   6                   DCB BASE                             22850002
UCBREG   EQU   7                   UCB BASE                             22900002
EWAREG   EQU   8                   ERP WORKAREA BASE                    22950002
ERREG1   EQU   9                   WORK REG                             23000002
IOBRG    EQU   10                  IOB BASE                             23050002
ERREG4   EQU   11                  WORK REG                             23100002
ERRLNK   EQU   12                  LINK REG                             23150002
NAMEREG  EQU   13                  LINK REG                             23200002
ERRETR   EQU   14                  RETURN REG                           23250002
ERREG5   EQU   15                  WORK REG                             23300002
         EJECT                                                          23350002
         IECDRQE                                                        23400002
         EJECT                                                          23450002
         IEZIOB                                                         23500002
         EJECT                                                          23550002
CVT      DSECT                                                          23600002
         CVT                                                            23650002
         EJECT                                                          23700002
         IECDERWA                                                       23750002
**********                                                              23800002
*                                                                       23850002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        23900002
*                                                                       23950002
**********                                                              24000002
         ORG   EWAIERP                                                  24050002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 24100002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 24150002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 24200002
EWAIND0  DS    B                   FLAG BYTE                            24250002
EWAIVISR EQU   X'10'               V=R REQUEST                          24850002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 24900002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 24950002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 25000002
EWAIND1  DS    B                   FLAG BYTE                            25050002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 25100002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 25150002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 25200002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 25210002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 25220002
EWAIND2  DS    B                   FLAG BYTE                            25250002
EWAIND3  DS    B                   FLAG BYTE                            25300002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     25350002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  25400002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 25450002
*********  END OF BTAM LOCAL DEFINITIONS **********                     25500002
EWAICUCB EQU   EWAIAREA+13         UCB NAME                             25550002
EWAICCC  EQU   EWAIAREA+25         CONDITION CODE                       25600002
EWAICC1  EQU   EWAIAREA+27         FIRST COMMA                          25650002
EWAICCSW EQU   EWAIAREA+28         CSW                                  25700002
EWAICC2  EQU   EWAIAREA+32         SECOND COMMA                         25750002
EWAICSNS EQU   EWAIAREA+33         SENSE                                25800002
EWAICC3  EQU   EWAIAREA+37         THIRD COMMA                          25850002
EWAICTP  EQU   EWAIAREA+38         TP CODE                              25900002
EWAICBL  EQU   EWAIAREA+46         BLANK                                25950002
         EJECT                                                          26600002
         IECDIOSB                                                       26650002
         END                                                            26700002
./  ADD  SSI=63070730,NAME=IGE0304C
         TITLE 'IGE0304C - BSC INTERVENTION REQUIRED ERP ROUTINE'       00050002
IGE0304C CSECT                                                          00100002
*********************************************************************** 00150002
*                                                                     * 00200002
* MODULE NAME:                                                        * 00250002
*    IGE0304C                                                         * 00300002
*                                                                     * 00350002
* DESCRIPTIVE NAME:                                                   * 00400002
*    BTAM INTERVENTION REQUIRED ERP                                   * 00450002
*                                                                     * 00500002
* COPYRIGHT:                                                          * 00550002
*    NONE                                                             * 00600002
*                                                                     * 00650002
* STATUS:                                                             * 00700002
*    CHANGE LEVEL 000                                                 * 00750002
*                                                                     * 00800002
* FUNCTION:                                                           * 00850002
*    THIS ROUTINE RECOVERS FROM INTERVENTION REQUIRED ERROR           * 00900002
*    CONDITIONS THAT OCCUR DURING BSC OPERATION. THE CCW THAT IS      * 00950002
*    IN ERROR IS DETECTED. THE PROPER ERROR RECOVERY PROCEDURE        * 01000002
*    FOR THE TYPE OF OPERATION BEING EXECUTED IS THEN INITIATED.      * 01050002
*                                                                     * 01100002
* NOTES:                                                              * 01150002
*    DEPENDENCIES:                                                    * 01200002
*        NONE                                                         * 01250002
*    RESTRICTIONS:                                                    * 01300002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01350002
*    REGISTER CONVENTIONS:                                            * 01400002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01450002
*                                                                     * 01500002
* PATCHLABEL:                                                         * 01550002
*    PACHAREA (48 BYTES)                                              * 01600002
*                                                                     * 01650002
* MODULE TYPE:                                                        * 01700002
*    PROCEDURE                                                        * 01750002
*    PROCESSOR:                                                       * 01800002
*        BAL                                                          * 01850002
*    MODULE SIZE:                                                     * 01900002
*        470 BYTES                                                    * 01950002
*    ATTRIBUTES:                                                      * 02000002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02050002
*                                                                     * 02100002
* ENTRY POINT:                                                        * 02150002
*    IGE0304C                                                         * 02200002
*    PURPOSE:                                                         * 02250002
*        SEE 'FUNCTION'                                               * 02300002
*    LINKAGE:                                                         * 02350002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02400002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02450002
*    INPUT:                                                           * 02500002
*        REG 1 = ADDRESS OF IOSB                                      * 02550002
*    OUTPUT:                                                          * 02600002
*        SETS INDICATOR IN DECERRST FOR SHOULD NOT OCCUR ERROR        * 02650002
*        ALTERED CHANNEL PROGRAM                                      * 02700002
*                                                                     * 02750002
* EXITS-NORMAL:                                                       * 02800002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 02900002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 02950002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03000002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03050002
*        LOADS ARE 1000 GREATER.                                      * 03100002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03150002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03200002
*                                                                     * 03250002
* EXITS-ERROR:                                                        * 03300002
*    NONE                                                             * 03350002
*                                                                     * 03400002
* EXTERNAL REFERENCES:                                                * 03450002
*    ROUTINES:                                                        * 03500002
*        NONE                                                         * 03550002
*    DATA AREAS                                                       * 03650002
*        IOB (MAPPED BY IEZIOB)                                       * 03700002
*        VIRTUAL CHANNEL PROGRAM                                      * 03750002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 03800002
*    CONTROL BLOCKS                                                   * 03850002
*        UCB                                                          * 03900002
*        DCB                                                          * 03950002
*        DECB                                                         * 04000002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04050002
*        CVT          (MAPPED BY CVT)                                 * 04100002
*        IOB          (MAPPED BY IEZIOB)                              * 04150002
*        RQE          (MAPPED BY IECDRQE)                             * 04200002
*                                                                     * 04250002
* TABLES-WORKAREAS:                                                   * 04300002
*    ERP WORKAREA                                                     * 04350002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04400002
*                                                                     * 04450002
* MACROS:                                                             * 04500002
*    NONE                                                             * 04550002
*                                                                     * 04600002
* CHANGE ACTIVITY:                                                    * 04650002
*    YM02595K (9/20/73)                                               * 04700002
*    YM02594K (9/24/73)                                               * 04750002
*    YA02142  (11/5/73)                                               * 04760002
*    YM05652K (1/25/74)                                               * 04770002
*    ZA00504  (5/9/74)                                                * 04780000
*    ZA00527  (9/4/74)                                                * 04790000
*    ZA14141  (10/28/76)                                              * 04800000
*********************************************************************** 04850002
         EJECT                                                          04900002
         USING *,BASEREG                                                04950002
         LR    BASEREG,ERREG5      SET BASE REG                         05000002
         B     BEGIN               BRANCH ARUOND ID            @ZA00504 05010000
         DC    C' IGE0304C '       MODULE ID                   @ZA00504 05020000
         DC    C' 4129 '           DATE LAST CHANGE            @ZA00504 05030000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY          @ZA00504 05040000
BEGIN    DS    0H                                              @ZA00504 05042000
         USING RQE,ERREG5                                               05050002
         USING IOSB,IOSBREG                                             05100002
         USING IOBSTDRD,IOBRG                                           05150002
         USING EWA,EWAREG                                               05200002
         USING IECTDECB,DECBRG          DECB DSECT BASE REGISTER        05250002
         USING IHADCB,DCBREG            DCB DSECT BASE REGISTER         05300002
         L     ERREG5,IOSUSE       BASE RQE                             05350002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05400002
         L     IOBRG,RQEIOB        BASE IOB                             05450002
         L     DECBRG,IOBECBPT     BASE DECB                            05500002
         L     DCBREG,IOBDCBPT     BASE DCB                             05550002
         L     UCBREG,IOSUCB       BASE UCB                             05600002
         DROP  ERREG5                                                   05650002
         L     CCWREG,IOBFL3       GET IOB CSW                          05700002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                05750002
         SH    CCWREG,ERRCN8       BACK UP TO FAILING CCW IN IOB        05800002
         MVC   IOBWORK(L1),TPOPCODE(CCWREG)   TP CODE TO IOB WORK AREA  05850002
         NI    IOBWORK,L255-UNUSBIT  TURN OFF UNUSED HI-ORDER BITS      05900002
         TM    L17(UCBREG),X90     IS THIS DIAL LINE                    05950002
         BNZ   BSCIR05             YES, DISABLE AND POST                06000002
         CLI   ZERO(CCWREG),CCWPREP   ERROR OCCUR ON A PREPARE CMD.     06050002
         BE    BSCIR06                                                  06100002
         CLI   ZERO(CCWREG),CCWPOLL   ERROR OCCUR ON A POLL COMMAND     06150002
         BE    BSCIR07             UPDATE CHAN PROG. RESTART POLL       06200002
         CLI   IOBWORK,DURINTXT    ERROR OCCUR DURING TEXT              06250002
         BE    BSCIR001            YES CHECK BUFFERING TECH             06300002
         CLI   IOBWORK,ZERO        ERP CCW                              06350002
         BE    BSCIR01             YES, RESTART CHANNEL PROG            06400002
         B     BSCIR06             RESTART FAILING CCW                  06450002
BSCIR001 EQU   *                                                        06500002
         CLI   ZERO(CCWREG),CCWREAD   ERROR OCCUR ON A READ COMMAND     06550002
         BNE   BSCIR08                                                  06600002
         TM    DCBBFTEK,BSCDYBUF   IS DYNAMIC BUFFERING EMPLOYED        06650002
         BZ    BSCIR09                                                  06700002
BSCIR00  MVI   IOBERRCT,ERRMAX     SET RETRY COUNT TO MAXIMUM           06750002
BSCIR01  TM    DCBERROP,LERBREQ    IS LERB REQUIRED                     06800002
         BNO   BSCIR02             NO, SKIP INTV REQ                    06850002
         MVI   IOBINCAM+L1,IRIND   TURN ON INTV REQ FLAG                06900002
BSCIR02  CLI   IOBERRCT,ERRMAX     IS RETRY COUNT AT MAXIMUM            06950002
         BE    BSCIR04             YES, GO INDICATE PERMANENT ERR.      07000002
         IC    ERREG1,IOBERRCT     NO, UPDATE                           07050002
         LA    ERREG1,L1(ERREG1)   RETRY                                07100002
         STC   ERREG1,IOBERRCT     COUNT                                07150002
         CLI   IOBINCAM+L1,IRIND                                        07200002
         BE    BSCIR03                                                  07250002
         MVI   EWAIND1,EWAISVCF    SVC 15/SVC 3                YM05652K 07260002
         L     NAMEREG,TRANSRTN    LOAD NAME OF 904B           YM02594K 07350002
         B     XCTLOUT             XCTL                                 07400002
BSCIR03  LA    NAMEREG,LERBADDR    GET LERB ROUTINE ADDR                07650002
XCTLOUT  EQU   *                                                        07700002
         L     ERRETR,CVTPTR       POINT TO CVT                         07750002
         USING CVTMAP,ERRETR                                            07800002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                07850002
         DROP  ERRETR                                                   07900002
         BR    ERRETR              BRANCH INTO XCTL ROUTINE             07950002
BSCIR04  NI    IOSFLA,L255-IOSERR   TURN ON PERM. ERROR INDICATOR       08000002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     08050002
         CLI   IOBINCAM+L1,IRIND   IS LERB REQUIRED                     08100002
         BE    BSCIR03             GO, BRANCH TO LERB                   08150002
         LA    NAMEREG,ERLOD25     ADDRESS OF ERROR POST                08200002
         B     XCTLOUT                                                  08250002
BSCIR05  CLI   ZERO(CCWREG),CCWDIAL   THIS DIAL CCW                     08300002
         BNE   BSCIR00             NO, POST WITH ERROR                  08350002
         MVI   IOBERCCW,DISABLE    COMMAND CODE DISABLE                 08400002
         MVI   IOBERCCW+L7,DISABCNT   MOVE COUNT INTO DISABLE CCW       08450002
         MVI   IOBERCCW+L4,SLICCFLG   SLI & CC FLAGS INTO CCW           08500002
         ST    CCWREG,IOBERCCW+L8   MOVE FAILING CMD ADDR INTO TIC      08550002
         MVI   IOBERCCW+L8,TICCOMMD   MOVE TIC COMMAND CODE INTO CCW    08650002
BSCIR05A LA    CCWREG,IOBERCCW                                          08700002
BSCIR06  ST    CCWREG,IOBSTART     SET CPA ADDR. TO PREPARE             08750002
         B     BSCIR01                                                  09250002
BSCIR07  LA    ERREG2,IOBCPA       UPDATE IOBSTART TO POINT TO          09300002
         ST    ERREG2,IOBSTART     START OF USER CHANNEL PROGRAM        09350002
         L     ERREG1,IOBCPA+L8    ADDR OF USER POLLING ENTRY           09500002
         MVC   IOBCPA+L9(L3),DECENTRY+L1   MOVE FAILING ADDR TO CCW     09550002
         L     ERREG2,IOBCPA+L8    ADDR OF FAILING POLL CCW             09600002
         SR    ERREG1,ERREG2       COUNT BETWEEN USERS AND FAILED       09650002
         AH    ERREG1,IOBCPA+L14   ADD TOTAL COUNT FROM USER ENTRY      09700002
         STH   ERREG1,IOBCPA+L14   STORE NEW COUNT IN POOL CCW          09750002
         B     BSCIR01                                                  09850002
BSCIR08  CLC   DECCOUNT(L2),L6(CCWREG)   RESIDUAL COUNT=ORIGINAL COUNT  09900002
         BNE   BSCIR00             NO, SET RETRY COUNT TO MAXIMUM       09950002
         B     BSCIR01             YES, CHECK FOR LERB REQUIRED         10000002
BSCIR09  CLI   IOBCPA,CCWPOLL      OPERATION READ TI WITH MULTIPOINT    10050002
         BNE   BSCIR09A                                                 10100002
         LR    ERREG1,CCWREG       POINT TO CURRENT CCW                 10150002
         SH    ERREG1,ERRCN8       BACK UP ONE                          10200002
         L     ERREG1,ZERO(ERREG1)   GET AREA ADDRESS                   10250002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE (INDEX BYTE) LD @ZA00527 10300000
         CLM   ERREG1,L7,L1(CCWREG)   HAS COUNT BEEN ADJUSTED  @ZA14141 10350000
         BE    BSCIR09A            YES, CONTINUE                        10400002
         STCM  ERREG1,L7,L1(CCWREG)   NO, RESTORE READ      LD @ZA00504 10450000
         LH    ERREG1,L6(CCWREG)   PICK UP COUNT                        10500002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE                          10550002
         STH   ERREG1,L6(CCWREG)   STORE                                10600002
BSCIR09A LA    ERREG1,IOBWORK+L2   ENQ-READ-IN ADDR FOR ERP             10700002
         ST    ERREG1,IOBERCCW     ENQ ADDRESS INTO ERP CCW             10750002
         MVI   IOBERCCW,CCWREAD    READ COMMAND CODE INTO ERP CCW       10850002
         MVI   IOBERCCW+L4,SLICCFLG   SLI AND CC FLAGS SET IN CCW       10900002
         MVI   IOBERCCW+L7,CCWCOUNT   COUNT FOR READ ENQ IN CCW         10950002
         ST    CCWREG,IOBERCCW+L8   AND STORE IN NOP COMMAND            11000002
         MVI   IOBERCCW+L8,NOPCC   MOVE NOP COMMAND CODE INTO CCW       11050002
         MVI   IOBWORK+L1,RTRNCDE1   SPEC RETURN CODE                   11100002
         MVI   IOBERRCT+L1,RTRNSPCD   LINK OFFSET                       11150002
         LA    ERREG1,L1           GET COUNT OF ONE             YA02142 11160002
         ST    ERREG1,IOBERINF+L4   STORE IT                    YA02142 11170002
         B     BSCIR05A                                                 11200002
         EJECT                                                          11250002
**********                                                              11300002
*                                                                       11350002
*        CONSTANTS                                                      11400002
*                                                                       11450002
**********                                                              11500002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       11550002
ERRCN8   DC    H'8'                                                     11600002
PACHAREA DC    12C'304C'           PATCH AREA FOR MAINTENANCE           11650002
**********                                                              11700002
*                                                                       11750002
*        MISCELLANEOUS EQUATES                                          11800002
*                                                                       11850002
**********                                                              11900002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              12000002
L1       EQU   1                   LENGTH AND DISPLACEMENT              12050002
L2       EQU   2                   LENGTH AND DISPLACEMENT              12100002
L3       EQU   3                   LENGTH AND DISPLACEMENT              12150002
L4       EQU   4                   LENGTH AND DISPLACEMENT              12200002
L5       EQU   5                   LENGTH AND DISPLACEMENT              12250002
L6       EQU   6                   LENGTH AND DISPLACEMENT              12300002
L7       EQU   7                   LENGTH AND DISPLACEMENT              12350002
L8       EQU   8                   LENGTH AND DISPLACEMENT              12400002
L9       EQU   9                   LENGTH AND DISPLACEMENT              12450002
L14      EQU   14                  LENGTH AND DISPLACEMENT              12500002
L17      EQU   17                  LENGTH AND DISPLACEMENT              12550002
X90      EQU   X'90'               DIAL MASK                            12600002
L255     EQU   X'FF'               AND MASK                             12750002
UNUSBIT  EQU   X'C0'               HI-ORDER BITS OF TP CODE             12850002
CCWDIAL  EQU   X'29'               COMMAND CODE FOR DIAL                12900002
CCWPREP  EQU   X'06'               COMMAND CODE FOR PREPARE             12950002
CCWPOLL  EQU   X'09'               COMMAND CODE FOR POLL                13000002
DURINTXT EQU   X'11'               CCW DURING TEXT TRANSFER             13050002
CCWREAD  EQU   X'02'               COMMAND CODE FOR READ                13100002
BSCDYBUF EQU   X'08'               DYNAMIC BUFFERING FLAG               13150002
ERRMAX   EQU   7                   MAXIMUM RETRY COUNT IN ERP           13200002
LERBREQ  EQU   X'08'               FLAG IN DCB INDICATING LERB          13250002
IRIND    EQU   2                                                        13300002
LERBADDR EQU   2042                LERB ROUTINE ADDR FOR XCTL           13450002
ERLOD25  EQU   2043                                                     13500002
TPOPCODE EQU   5                   OFFSET TO TP CODE IN CCW             13550002
DISABLE  EQU   X'2F'               COMMAND CODE FOR DISABLE             13600002
DISABCNT EQU   X'01'               COUNT FOR DISABLE CCW                13650002
TICCOMMD EQU   X'08'               COMMAND CODE FOR TIC                 13700002
NOPCC    EQU   X'03'                                                    13750002
SLICCFLG EQU   X'60'               SLI & CC FLAGS                       13800002
CCWCOUNT EQU   X'02'               COUNT FOR READ ENQ CCW IN ERP        13850002
RTRNCDE1 EQU   X'81'                                                    13950002
RTRNSPCD EQU   X'14'                                                    14000002
**********                                                              14050002
*                                                                       14100002
*        REGISTER DEFINITION                                            14150002
*                                                                       14200002
**********                                                              14250002
ERREG3   EQU   0                   WORK REG                             14300002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              14350002
EWAREG   EQU   2                   ERP WORKAREA BASE                    14400002
ERREG4   EQU   3                   WORK REG                             14450002
CCWREG   EQU   4                   CCW ADDRESS REG                      14500002
DECBRG   EQU   5                   DECB BASE                            14550002
DCBREG   EQU   6                   DCB BASE                             14600002
UCBREG   EQU   7                   UCB BASE                             14650002
BASEREG  EQU   8                   PROGRAM BASE                         14700002
ERREG2   EQU   9                   WORK REG                             14750002
IOBRG    EQU   10                  IOB BASE                             14800002
ERREG1   EQU   11                  WORK REG                             14850002
ERRLNK   EQU   12                  LINK REG                             14900002
NAMEREG  EQU   13                  LINK REG                             14950002
ERRETR   EQU   14                  LINK REG                             15000002
ERREG5   EQU   15                  LINK REG/WORK REG                    15050002
         EJECT                                                          15100002
         IECTDECB                                                       15150002
         EJECT                                                          15200002
         DCBD  DSORG=BX,DEVD=BS                                         15250002
         EJECT                                                          15300002
         IECDRQE                                                        15350002
         EJECT                                                          15400002
         IEZIOB                                                         15450002
         EJECT                                                          15500002
CVT      DSECT                                                          15550002
         CVT                                                            15600002
         EJECT                                                          15650002
         IECDERWA                                                       15700002
**********                                                              15750002
*                                                                       15800002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        15850002
*                                                                       15900002
**********                                                              15950002
         ORG   EWAIERP                                                  16000002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 16050002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 16100002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 16150002
EWAIND0  DS    B                   FLAG BYTE                            16200002
EWAIVISR EQU   X'10'               V=R REQUEST                          16800002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 16850002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 16900002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 16950002
EWAIND1  DS    B                   FLAG BYTE                            17000002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 17050002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 17100002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 17150002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 17160002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 17170002
EWAIND2  DS    B                   FLAG BYTE                            17200002
EWAIND3  DS    B                   FLAG BYTE                            17250002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     17300002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  17350002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 17400002
*********  END OF BTAM LOCAL DEFINITIONS **********                     17410002
         EJECT                                                          17450002
         IECDIOSB                                                       17500002
         END                                                            17550002
./  ADD  SSI=53040217,NAME=IGE0404A
         TITLE 'IGE0404A - BTAM ERP LOST DATA MODULE'                   00070002
IGE0404A CSECT                                                          00120002
*********************************************************************** 00170002
*                                                                     * 00220002
* MODULE NAME:                                                        * 00270002
*    IGE0404A                                                         * 00320002
*                                                                     * 00370002
* DESCRIPTIVE NAME:                                                   * 00420002
*    BTAM LOST DATA ERP                                               * 00470002
*                                                                     * 00520002
* COPYRIGHT:                                                          * 00570002
*    NONE                                                             * 00620002
*                                                                     * 00670002
* STATUS:                                                             * 00720002
*    CHANGE LEVEL 000                                                 * 00770002
*                                                                     * 00820002
* FUNCTION:                                                           * 00870002
*    IF REQUIRED, RETRIES CHANNEL PROGRAM THAT FAILED BECAUSE OF A    * 00920002
*    LOST DATA CONDITION.                                             * 00970002
*                                                                     * 01020002
* NOTES:                                                              * 01070002
*    DEPENDENCIES:                                                    * 01120002
*        NONE                                                         * 01170002
*    RESTRICTIONS:                                                    * 01220002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01270002
*    REGISTER CONVENTIONS:                                            * 01320002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01370002
*                                                                     * 01420002
* PATCHLABEL:                                                         * 01470002
*    PACHAREA (48 BYTES)                                              * 01520002
*                                                                     * 01570002
* MODULE TYPE:                                                        * 01620002
*    PROCEDURE                                                        * 01670002
*    PROCESSOR:                                                       * 01720002
*        BAL                                                          * 01770002
*    MODULE SIZE:                                                     * 01820002
*        458 BYTES                                                    * 01870002
*    ATTRIBUTES:                                                      * 01920002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 01970002
*                                                                     * 02020002
* ENTRY POINT:                                                        * 02070002
*    IGE0404A                                                         * 02120002
*    PURPOSE:                                                         * 02170002
*        SEE 'FUNCTION'                                               * 02220002
*    LINKAGE:                                                         * 02270002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02320002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02370002
*    INPUT:                                                           * 02420002
*        REG 1 = ADDRESS OF IOSB                                      * 02470002
*    OUTPUT:                                                          * 02520002
*        SET DECERRST FOR SHOULD NOT OCCUR ERROR.                     * 02570002
*        ALTERED CHANNEL PROGRAM                                      * 02620002
*                                                                     * 02670002
* EXITS-NORMAL:                                                       * 02720002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 02820002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 02870002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 02920002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 02970002
*        LOADS ARE 1000 GREATER.                                      * 03020002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03070002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03120002
*                                                                     * 03170002
* EXITS-ERROR:                                                        * 03220002
*    NONE                                                             * 03270002
*                                                                     * 03320002
* EXTERNAL REFERENCES:                                                * 03370002
*    ROUTINES:                                                        * 03420002
*        NONE                                                         * 03470002
*    DATA AREAS                                                       * 03570002
*        IOB (MAPPED BY IEZIOB)                                       * 03620002
*        VIRTUAL CHANNEL PROGRAM                                      * 03670002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 03720002
*    CONTROL BLOCKS                                                   * 03770002
*        UCB                                                          * 03820002
*        DCB                                                          * 03870002
*        DECB                                                         * 03920002
*        IOSB         (MAPPED BY IECDIOSB)                            * 03970002
*        CVT          (MAPPED BY CVT)                                 * 04020002
*        IOB          (MAPPED BY IEZIOB)                              * 04070002
*        RQE          (MAPPED BY IECDRQE)                             * 04120002
*                                                                     * 04270002
* TABLES-WORKAREAS:                                                   * 04320002
*    ERP WORKAREA                                                     * 04370002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04420002
*                                                                     * 04470002
* MACROS:                                                             * 04520002
*    NONE                                                             * 04570002
*                                                                     * 04620002
* CHANGE ACTIVITY:                                                    * 04670002
*    YM02595K (9/20/73)                                               * 04720002
*    YM02594K (9/24/73)                                               * 04730002
*    YM05652K (1/24/74)                                               * 04740002
*    AZ04683 (08/26/75)                                                 04750000
*                                                                     * 04770002
*********************************************************************** 04820002
         EJECT                                                          04870002
         USING *,BASEREG                                                04920002
         LR    BASEREG,ERREG5      SET BASE REG                         04970002
         USING RQE,ERREG5                                               05020002
         USING IOSB,IOSBREG                                             05070002
         USING IOBSTDRD,IOBRG                                           05120002
         USING EWA,EWAREG                                               05170002
         L     ERREG5,IOSUSE       BASE RQE                             05220002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05270002
         L     IOBRG,RQEIOB        BASE IOB                             05320002
         L     DECBRG,IOBECBPT     BASE DECB                            05370002
         L     DCBREG,IOBDCBPT     BASE DCB                             05420002
         L     UCBREG,IOSUCB       BASE UCB                             05470002
         DROP  ERREG5                                                   05520002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       05570002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                05620002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                05670002
         MVC   IOBWORK(L1),TPCODE(CCWREG)   PUT TP OP CODE IN WORK      05720002
         NI    IOBWORK,L255-CCWMASK1   MASK OUT UNUSED BITS             05770002
         CLI   ZERO(CCWREG),CCWDIAL   THIS A DIAL COMMAND               05820002
         BNE   ERRLDC02            NO CHECK FOR READ                    05870002
ERRLDC00 CLI   IOBERRCT,ERTRYCT    RETRY AGAIN                          05920002
         BNL   ERRLDC04            NO CHECK FOR SWITCHED LINE           05970002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  06020002
         LA    ERREG1,L1(ERREG1)   INCREMENT RETRY COUNT                06070002
ERRLDC01 STC   ERREG1,IOBERRCT     RETRY CHANNEL PROG                   06120002
         MVI   IOBSENS0,ZERO       CLEAR SENSE BYTE                     06170002
RETRY    EQU   *                                                        06220002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 06270002
         L     NAMEREG,TRANSRTN    LOAD NAME                            10920002
         B     ERRLINK1            XCTL                                 10970002
ERRLDC02 CLI   ZERO(CCWREG),CCWRDCMD   THIS A READ COMMAND              11020002
         BE    ERRLDC03            YES CHECK IF READ TWX                11070002
         CLI   ZERO(CCWREG),CCWINHCD   THIS AN INHIBIT COMMAND          11120002
         BNE   ERRLDC05            NO INDICATE SHOULD NOT OCCUR         11170002
ERRLDC03 CLI   IOBWORK,CCWTWXID    THIS A READ TWX ID RESPONSE          11220002
         BE    ERRLDC00            YES CHECK FOR RETRY REQUIRED         11270002
         CLI   IOBWORK,CCWRRADR    THIS A READ RESPONSE TO ADDRESS      11320002
         BE    ERRLDC06            YES SET UP TO RETRY CHAN PROG        11370002
         MVC   IOBERINF(L1),IOBSENS0   SAVE PRIOR SENSE DATA            11420002
         MVC   IOBERINF+L1(L7),IOBCSW   SAVE PRIOR CSW DATA             11470002
         MVC   IOBERINF+L8(L8),ZERO(CCWREG)   SAVE FAILING CCW          11520002
         LA    ERREG1,IOBERCCW     ADDRESS OF DUMMY CCW                 11570002
         ST    ERREG1,IOBSTART     POINTER TO CHAN PROGRAM              11620002
         CLI   IOBWORK,CCWRDTXT    THIS A READ TEXT                     11770002
         BE    ERRLDC10            YES CHECK RESIDUAL COUNT             11820002
         CLI   IOBWORK,CCWRRTXT    THIS A READ RESPONSE TO TEXT         11870002
         BE    ERRLDC11            YES SET UP READ SKIP OPERATION       11920002
         CLI   IOBWORK,CCWRDSKP    THIS A READ SKIP                     11970002
         BNE   ERRLDC05            INDICATE SHOULD NOT OCCUR            12020002
ERRLDC10 CLC   IOBCSW+L5(L2),ERRHLF00   RESIDUAL COUNT = 0              12070002
         BNE   ERRLDC05            NO INDICATE SHOULD NOT OCCUR         12120002
         MVC   IOBWORK+L1(L1),UCBTYP+L3(UCBREG)   ADAPTER TYPE TO WORK  12170002
         NI    IOBWORK+L1,MASK3    CLEAR UNWANTED BITS                  12220002
         CLI   IOBWORK+L1,UCBTTYP1   THIS A TELETYPE ADAPTER 1          12270002
         BE    ERRLDC12            YES WRITE BREAK REQUIRED             12320002
         CLI   IOBWORK,CCWRDSKP    THIS A READ SKIP                     12370002
         BE    ERRLDC04            YES, CHECK FOR SWITCH LINE           12420002
         CLI   IOBWORK+L1,ADAPT8   THIS A 2260                          12470002
         BE    ERRLDC14            YES, ISSUE READ CLEAR                12520002
ERRLDC11 SR    ERREG1,ERREG1       CLEAR REGISTER                       12570002
         ST    ERREG1,IOBERCCW     CLEAR DUMMY CCW                      12620002
         MVI   IOBERCCW,CCWRDCMD   PUT READ COMMAND IN CCW              12670002
         MVI   IOBERCCW+L4,RDSKPIND   PUT SKIP INDICATOR IN CCW         12720002
         LA    ERREG5,L1           GET A ONE                            12770002
         SR    ERREG1,ERREG5       GET READ COUNT                       12820002
         STH   ERREG1,IOBERCCW+L6   PUT READ COUNT IN CCW               12870002
         MVI   IOBERCCW+L5,X30     SET TPOP CODE                        12920002
         B     ERRLDC13            EXIT VIA ERROR EXCP ROUTINE          13020002
ERRLDC14 EQU   *                                                        13070002
         MVC   IOBERCCW(L8),RDCL2848   SET UP RD CLEAR                  13170002
         B     ERRLDC13            COMPLETE CHANNEL PROGRAM             13220002
ERRLDC12 ST    IOBRG,IOBERCCW      GENERATE LEGAL DATA ADDRESS          13270002
         MVI   IOBERCCW,WRTBKCMD   PUT WRITE BREAK COMMAND IN CCW       13320002
         LA    ERREG1,MASK15       BREAK COUNT                          13420002
         ST    ERREG1,IOBERCCW+L4   PUT IN CCW AND CLEAR REST           13470002
         MVI   IOBERCCW+L4,SILLYBIT   SET SUPPRESS LENGTH INDICATOR     13520002
ERRLDC13 MVI   IOBERRCT+L1,ERRLDIND   INDICATE LOST DATA RETURN         13570002
         MVI   IOBSENS0,ZERO       CLEAR PREVIOUS SENSE DATA            13620002
         OC    EWASTUP(L1),IOBERINF   MOVE SENSE FOR STAT UPDATE        13670002
         B     RETRY               ERROR EXCP                           13720002
ERRLDC04 TM    UCBTYP+L1(UCBREG),SWLINE   DISABLE REQUIRED              13770002
         BZ    ERRLDC09            NO GO TO ERROR POST                  13820002
         MVI   IOBERRCT+L1,MASK3   INDICATE SPECIAL ENTRY               13870002
         LA    NAMEREG,ERLOD3      DISABLE CHECK ROUTINE ADDRESS        13920002
ERRLINK1 EQU   *                                                        13970002
         L     ERRETR,CVTPTR       POINT TO CVT                         14020002
         USING CVTMAP,ERRETR                                            14070002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                14120002
         DROP  ERRETR                                                   14170002
         BR    ERRETR              XCTL                                 14220002
ERRLDC05 OI    DECERRST(DECBRG),CSWSNO   SET SHOULD NOT OCCUR ERROR     14270002
         NI    IOSFLA,L255-IOSERR  TURN OFF ERP IN CONTROL     @ZA04683 14280000
*                                      IN IOSB                 @ZA04683 14290000
         NI    IOBFLAG1,L255-IOBERRTN    ALSO IN IOB           @ZA04683 14300000
         B     ERRLDC04            CHECK FOR DISABLE REQUIRED           14320002
ERRLDC06 CLI   IOBCPA,CCWDISAB     FIRST CCW DISABLE COMMAND            14370002
         BE    ERRLDC08            YES SET CPA TO THIRD COMMAND         14420002
         LA    ERREG1,IOBCPA       SET CPA TO START OF CHAN PROG        14470002
ERRLDC07 ST    ERREG1,IOBSTART     STORE CPA POINTER                    14520002
         B     ERRLDC00            CHECK FOR RETRY REQUIRED             14670002
ERRLDC08 LA    ERREG1,IOBCMD3      ADDRESS OF THIRD COMMAND             14720002
         B     ERRLDC07            CHECK FOR RETRY REQUIRED             14770002
ERRLDC09 LH    NAMEREG,ERLOD5      ADDRESS OF ERROR POST ROUTINE        14820002
         B     ERRLINK1                                                 14870002
         EJECT                                                          14920002
**********                                                              14970002
*                                                                       15020002
*        CONSTANTS                                                      15070002
*                                                                       15120002
**********                                                              15170002
         DS    0D                                                       15220002
RDCL2848 DC    X'42000001303003C0'     READ CLEAR                       15270002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       15280002
ERRHLF00 DC    H'00'                                                    15370002
ERRCN8   DC    H'8'                                                     15420002
ERLOD5   DC    H'5041'                                                  15470002
PACHAREA DC    12C'404A'           PATCH AREA FOR MAINTENANCE           15570002
**********                                                              15620002
*                                                                       15670002
*        MISCELLANEOUS EQUATES                                          15720002
*                                                                       15770002
**********                                                              15820002
ADAPT8   EQU   X'80'                                                    15920002
CCWRDTXT EQU   X'11'                                                    15970002
CCWRRTXT EQU   X'20'                                                    16020002
CCWRDSKP EQU   X'12'                                                    16070002
UCBTTYP1 EQU   X'40'                                                    16120002
WRTBKCMD EQU   X'0D'                                                    16170002
ERRLDIND EQU   X'08'                                                    16220002
MASK15   EQU   X'0F'                                                    16270002
UCBTYP   EQU   16                                                       16320002
SWLINE   EQU   X'90'                                                    16370002
CCWDIAL  EQU   X'29'                                                    16420002
CCWDISAB EQU   X'2F'                                                    16470002
CCWMASK1 EQU   X'C0'                                                    16520002
CCWRDCMD EQU   X'02'                                                    16570002
CCWRRADR EQU   X'06'                                                    16620002
CCWINHCD EQU   X'0A'                                                    16670002
TPCODE   EQU   5                                                        16770002
RDSKPIND EQU   X'30'                                                    16820002
SILLYBIT EQU   X'20'                                                    16870002
ERTRYCT  EQU   X'02'                                                    16920002
MASK3    EQU   X'F0'                                                    17020002
ERLOD3   EQU   3041                                                     17070002
L255     EQU   255                 AND MASK                             17120002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              17170002
L1       EQU   1                   LENGTH AND DISPLACEMENT              17220002
L2       EQU   2                   LENGTH AND DISPLACEMENT              17270002
L3       EQU   3                   LENGTH AND DISPLACEMENT              17320002
L4       EQU   4                   LENGTH AND DISPLACEMENT              17370002
L5       EQU   5                   LENGTH AND DISPLACEMENT              17420002
L6       EQU   6                   LENGTH AND DISPLACEMENT              17470002
L7       EQU   7                   LENGTH AND DISPLACEMENT              17520002
L8       EQU   8                   LENGTH AND DISPLACEMENT              17570002
L16      EQU   16                  LENGTH AND DISPLACEMENT              17620002
X30      EQU   X'30'               TP OP CODE                           17670002
DECERRST EQU   29                                                       17770002
CCWTWXID EQU   X'07'                                                    17820002
CSWSNO   EQU   X'40'                                                    17870002
**********                                                              17920002
*                                                                       17970002
*        REGISTER DEFINITION                                            18020002
*                                                                       18070002
**********                                                              18120002
ERREG3   EQU   0                   WORK REG                             18170002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              18220002
ERREG2   EQU   2                   WORK REG                             18270002
EWAREG   EQU   3                   ERP WORKAREA BASE                    18320002
CCWREG   EQU   4                   CCW ADDRESS REG                      18370002
DECBRG   EQU   5                   DECB BASE                            18420002
DCBREG   EQU   6                   DCB BASE                             18470002
UCBREG   EQU   7                   UCB BASE                             18520002
BASEREG  EQU   8                   PROGRAM BASE                         18570002
ERREG1   EQU   9                   WORK REG                             18620002
IOBRG    EQU   10                  IOB BASE                             18670002
ERREG4   EQU   11                  WORK REG                             18720002
ERRLNK   EQU   12                  LINK REG                             18770002
NAMEREG  EQU   13                  LINK REG                             18820002
ERRETR   EQU   14                  LINK REG/RETURN REG                  18870002
ERREG5   EQU   15                  LINK REG/WORK REG                    18920002
         EJECT                                                          19070002
         IECDRQE                                                        19120002
         EJECT                                                          19170002
         IEZIOB                                                         19220002
IOBCMD3  EQU   IOBCPA+L16                                               19270002
         EJECT                                                          19320002
CVT      DSECT                                                          19370002
         CVT                                                            19420002
         EJECT                                                          19470002
         IECDERWA                                                       19520002
**********                                                              19570002
*                                                                       19620002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        19670002
*                                                                       19720002
**********                                                              19770002
         ORG   EWAIERP                                                  19820002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 19870002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 19920002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 19970002
EWAIND0  DS    B                   FLAG BYTE                            20020002
EWAIVISR EQU   X'10'               V=R REQUEST                          20620002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 20670002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 20720002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 20770002
EWAIND1  DS    B                   FLAG BYTE                            20820002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 20870002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 20920002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 20970002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 20980002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 20990002
EWAIND2  DS    B                   FLAG BYTE                            21020002
EWAIND3  DS    B                   FLAG BYTE                            21070002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     21120002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  21170002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 21220002
*********  END OF BTAM LOCAL DEFINITIONS **********                     21270002
         EJECT                                                          22020002
         IECDIOSB                                                       22070002
         END                                                            22120002
./  ADD  SSI=40240883,NAME=IGE0404B
         TITLE 'IGE0404B - BTAM ERP RD/SKP WRT/BRK CHECK LOAD TWO'      00550002
IGE0404B CSECT                                                          00600002
*********************************************************************** 00650002
*                                                                     * 00700002
* MODULE NAME:                                                        * 00750002
*    IGE0404B                                                         * 00800002
*                                                                     * 00850002
* DESCRIPTIVE NAME:                                                   * 00900002
*    BTAM RD/SKP AND WRT/BRK CHECK ERP LOAD TWO                       * 00950002
*                                                                     * 01000002
* COPYRIGHT:                                                          * 01050002
*    NONE                                                             * 01100002
*                                                                     * 01150002
* STATUS:                                                             * 01200002
*    CHANGE LEVEL 000                                                 * 01250002
*                                                                     * 01300002
* FUNCTION:                                                           * 01350002
*    THIS MODULE DETERMINES IF A READ COMMAND WAS ISSUED A CHANNEL    * 01400002
*    PROGRAM IS CONSTRUCTED AND EXECUTED IF REQUIRED.                 * 01450002
*                                                                     * 01500002
* NOTES:                                                              * 01550002
*    DEPENDENCIES:                                                    * 01600002
*        NONE                                                         * 01650002
*    RESTRICTIONS:                                                    * 01700002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01750002
*    REGISTER CONVENTIONS:                                            * 01800002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01850002
*                                                                     * 01900002
* PATCHLABEL:                                                         * 01950002
*    PACHAREA (48 BYTES)                                              * 02000002
*                                                                     * 02050002
* MODULE TYPE:                                                        * 02100002
*    PROCEDURE                                                        * 02150002
*    PROCESSOR:                                                       * 02200002
*        BAL                                                          * 02250002
*    MODULE SIZE:                                                     * 02300002
*        464 BYTES                                                    * 02350002
*    ATTRIBUTES:                                                      * 02400002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02450002
*                                                                     * 02500002
* ENTRY POINT:                                                        * 02550002
*    IGE0404B                                                         * 02600002
*    PURPOSE:                                                         * 02650002
*        SEE 'FUNCTION'                                               * 02700002
*    LINKAGE:                                                         * 02750002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02800002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02850002
*    INPUT:                                                           * 02900002
*        REG 1 = ADDRESS OF IOSB                                      * 02950002
*    OUTPUT:                                                          * 03000002
*        SET DECERRST FOR SHOULD NOT OCCUR ERROR.                     * 03050002
*        ALTERED CHANNEL PROGRAM.                                     * 03100002
*                                                                     * 03150002
* EXITS-NORMAL:                                                       * 03200002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03300002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03350002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03400002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03450002
*        LOADS ARE 1000 GREATER.                                      * 03500002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03550002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03600002
*                                                                     * 03650002
* EXITS-ERROR:                                                        * 03700002
*    NONE                                                             * 03750002
*                                                                     * 03800002
* EXTERNAL REFERENCES:                                                * 03850002
*    ROUTINES:                                                        * 03900002
*        READ                                                         * 03950002
*    DATA AREAS                                                       * 04100002
*        IOB (MAPPED BY IEZIOB)                                       * 04150002
*        VIRTUAL CHANNEL PROGRAM                                      * 04200002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04250002
*    CONTROL BLOCKS                                                   * 04300002
*        UCB                                                          * 04350002
*        DCB                                                          * 04400002
*        DECB                                                         * 04450002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04500002
*        CVT          (MAPPED BY CVT)                                 * 04550002
*        IOB          (MAPPED BY IEZIOB)                              * 04600002
*        RQE          (MAPPED BY IECDRQE)                             * 04650002
*                                                                     * 04800002
* TABLES-WORKAREAS:                                                   * 04850002
*    ERP WORKAREA                                                     * 04900002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04950002
*                                                                     * 05000002
* MACROS:                                                             * 05050002
*    READ                                                             * 05100002
*                                                                     * 05150002
* CHANGE ACTIVITY:                                                    * 05200002
*    YM02595K (9/20/73)                                               * 05250002
*    YM02594K (9/24/73)                                               * 05260002
*    YM05652K (1/24/74)                                               * 05270002
*                                                                     * 05300002
*********************************************************************** 05350002
         EJECT                                                          05400002
         USING *,BASEREG                                                05450002
         LR    BASEREG,ERREG5      SET BASE REG                         05500002
         USING RQE,ERREG5                                               05550002
         USING IOSB,IOSBREG                                             05600002
         USING IOBSTDRD,IOBRG                                           05650002
         USING EWA,EWAREG                                               05700002
         L     ERREG5,IOSUSE       BASE RQE                             05750002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05800002
         L     IOBRG,RQEIOB        BASE IOB                             05850002
         L     DECBRG,IOBECBPT     BASE DECB                            05900002
         L     DCBREG,IOBDCBPT     BASE DCB                             05950002
         L     UCBREG,IOSUCB       BASE UCB                             06000002
         DROP  ERREG5                                                   06050002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       06100002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06150002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                06200002
ERRCHK11 CLI   ZERO(CCWREG),CCWRDCMD   WAS A READ ISSUED                06250002
         BNE   ERRCHK10            NO POST COMPLETE WITH ERROR          06300002
         TM    DCBERROP(DCBREG),DCBRDTRY   READ RETRIES REQUIRED        06350002
         BZ    ERRCHK10            NO POST COMPLETE WITH ERROR          06400002
         CLI   IOBCSW+L3,CSWCDE    CHANNEL END DEVICE END ONLY          06450002
         BNE   ERRCHK13            NO CHECK FURTHER                     06500002
         CLI   IOBCSW+L4,ZERO      ANY OTHER ERROR                      06550002
         BNE   ERRCHK10            YES POST COMPLETE WITH ERROR         06600002
ERRCHK14 MVC   IOBWORK+L1(L1),DECTYPE+L1(DECBRG)                        06650002
         NI    IOBWORK+L1,L255-HIBIT   CLEAR UNUSED BITS                06700002
         TM    IOBWORK+L1,READ     IS OPERATION READ                    06750002
         BZ    ERRCHK10            NO, POST WITH ERROR                  06800002
         CLI   IOBWORK+L1,DECRDRPT   OPERATION TYPE READ REPEAT         06850002
         BNE   ERRCHK12            NO CONSTRUCT CHAN PROGRAM            06900002
         TM    L4(CCWREG),X10      IS THIS READ SKIP                    06950002
         BNO   ERRCHK23            NO, START CHAN PROGRAM               07000002
         TM    IOBSENS0,X08        IS THERE DATA CHAINING               07050002
         BO    ERRCHK10            YES,POST WITH ERROR                  07100002
ERRCHK23 EQU   *                                                        07150002
         LA    ERREG2,IOBCPA       START OF CHAN PROGRAM                07200002
         B     ERRCHK04            EXECUTE CHAN PROGRAM                 07250002
ERRCHK12 EQU   *                                                        07300002
         L     ERREG4,DECAREA(DECBRG)   SAVE AREA ADDRESS               07350002
         LH    ERRLNK,DECLNGTH(DECBRG)   SAVE AREA LENGTH               07400002
         CLI   IOBWORK+L1,DECRDINT   OPERATION READ INITIAL             07450002
         BNE   ERRCHK20            NO, DON'T SET DECB                   07500002
         TM    UCBTYP+L1(UCBREG),AUTOPOLL                               07550002
         BNO   ERRCHK20                                                 07600002
         CLI   IOBCPA,X09                                               07650002
         BNE   ERRCHK20                                                 07700002
         TM    L5(CCWREG),X30                                           07750002
         BZ    ERRCHK10                                                 07800002
         L     ERRLNK,DECAREA(DECBRG)                                   07850002
         MVC   DECPOLPT(L1,DECBRG),ZERO(ERRLNK)                         07900002
ERRCHK22 LR    ERRLNK,ERREG4       SAVE AREA ADDRESS                    07950002
         LA    ERRLNK,L1(ERRLNK)   ADD ONE TO ADDRESS                   08000002
         ST    ERRLNK,DECAREA(DECBRG)   UPDATE DECB                     08050002
         LH    ERRLNK,DECLNGTH(DECBRG)   PICK UP AREA LENGTH            08100002
         BCTR  ERRLNK,ZERO         REDUCE BY ONE                        08150002
         STH   ERRLNK,DECLNGTH(DECBRG)   UPDATE DECB                    08200002
         LA    ERRLNK,L1(ERRLNK)   RESTORE LENGTH                       08250002
ERRCHK20 EQU   *                                                        08300002
         LR    ERREG1,IOSBREG      SAVE IOSB BASE                       08350002
         LA    NAMEREG,EWAIAREA-L12   ADDRESS OF REGISTER SAVE AREA     08400002
         LR    IOSBREG,DECBRG       DECB ADDRESS IN PARAMETER REG       08450002
         NI    DECTYPE+L1(DECBRG),HIBIT   CLEAR OP TYPE CODE            08500002
         OI    DECTYPE+L1(DECBRG),DECRDRPT   INDICATE READ REPEAT       08550002
         OI    IOBBTAMF,X08        SET ERP FLAG FOR RD/WR               08600002
         READ  (1),T,MF=E          CONSTRUCT CHAN PROGRAM               08650002
         LR    IOSBREG,ERREG1      RESTORE IOSB ABSE                    08700002
         NI    IOBBTAMF,L255-X08   ERP RD/WR FLAG OFF                   08750002
         ST    ERREG4,DECAREA(DECBRG)   RESET DECB                      08850002
         STH   ERRLNK,DECLNGTH(DECBRG)   RESET DECB                     08900002
         B     ERRCHK05            UPDATE RETRY COUNT                   08950002
ERRCHK13 CLI   IOBCSW+L3,CSWCDEUC   CHAN AND DEV END WITH UNIT CHK.     09000002
         BNE   ERRCHK10            NO POST COMPLETE WITH ERROR          09050002
         TM    IOBSENS0,L255-CSWLDDCO   EXPECTED ERROR                  09100002
         BNZ   ERRCHK10            NO POST COMPLETE WITH ERROR          09150002
         TM    IOBSENS0,CSWLD      LOST DATA ERROR                      09200002
         BZ    ERRCHK14            NO CHECK FOR RETRIES                 09250002
         CLC   L6(L2,CCWREG),ERRCN0   RESIDUAL COUNT 0                  09300002
         BE    ERRCHK10            YES POST WITH ERROR                  09350002
         B     ERRCHK14            NO CHECK FOR RETRIES                 09400002
ERRCHK04 ST    ERREG2,IOBSTART     SET CPA TO FAILING CCW               09450002
ERRCHK05 CLI   IOBERRCT,ERTRYCT    MORE RETRIES NECESSARY               09600002
         BNL   ERRCHK07            NO CHECK FOR DISABLE REQUIRED        09650002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  09700002
         LA    ERREG1,L1(ERREG1)   BUMP COUNT BY ONE                    09750002
         STC   ERREG1,IOBERRCT     STORE NEW COUNT                      09800002
         MVI   IOBERRCT+L1,ZERO    INDICATE NORMAL RETURN               09850002
         OC    EWASTUP(L1),IOBERINF   SET FOR STAT UPDATE               09900002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 09950002
         L     NAMEREG,TRANSRTN    LOAD NAME                            11600002
         B     ERRCHK08            XCTL                                 11650002
ERRCHK06 EQU   *                                                        14750002
         TM    DCBBFTEK(DCBREG),DCBDYNBF   DYNAMIC BUFFERING SPECIFIED  14800002
         BO    ERRCHK10            POST WITH ERROR                      14850002
         LA    ERREG2,IOBCPA       POINT TO START OF CHANNEL PGM        14900002
         B     ERRCHK04            RETRY CHANNEL PROGRAM                14950002
ERRCHK07 EQU   *                                                        15000002
         TM    UCBTYP+L1(UCBREG),SWLINE   DISABLE REQUIRED              15050002
         BZ    ERRCHK10            NO, POST WITH ERROR                  15100002
         LA    NAMEREG,ERLOD3      NAME OF DISABLE ROUTINE              15150002
ERRCHK08 EQU   *                                                        15200002
         L     ERRETR,CVTPTR       POINT TO CVT                         15250002
         USING CVTMAP,ERRETR                                            15300002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                15350002
         DROP  ERRETR                                                   15400002
         BR    ERRETR              XCTL                                 15450002
ERRCHK19 EQU   *                                                        15500002
         OI    DECERRST(DECBRG),DECERPER   SET ERROR IN ERP EXCP        15550002
ERRCHK09 EQU   *                                                        15600002
         OI    DECERRST(DECBRG),CSWSNO   SET SHOULD NOT OCCUR           15650002
ERRCHK10 EQU   *                                                        15700002
         MVI   IOBCSW+L3,CSWCDE    SET ENTRY TO POST                    15750002
         MVI   IOBERRCT+L1,RTRNCDE   FAKE OUT POST ROUTINE              15850002
         OI    IOSFLB,IOSLOG       LOGOUT REQUIRED                      15900002
         LH    NAMEREG,ERLOD5      ERROR POST NAME                      15950002
         B     ERRCHK08            XCTL                                 16000002
         EJECT                                                          16050002
**********                                                              16100002
*                                                                       16150002
*        CONSTANTS                                                      16200002
*                                                                       16250002
**********                                                              16300002
ERRCN0   DC    F'0'                                                     16400002
TRANSRTN DC    F'9042'             BTAM TRANSLATE ROUTINE NAME          16410002
ERRCN8   DC    H'8'                                                     16450002
ERLOD5   DC    H'5041'                                                  16600002
PACHAREA DC    12C'404B'           PATCH AREA FOR MAINTENANCE           16700002
**********                                                              16750002
*                                                                       16800002
*        MISCELLANEOUS EQUATES                                          16850002
*                                                                       16900002
**********                                                              16950002
AUTOPOLL EQU   X'40'                                                    17000002
DECPOLPT EQU   36                                                       17050002
READ     EQU   X'01'                                                    17150002
CSWCDE   EQU   X'0C'                                                    17200002
CSWCDEUC EQU   X'0E'                                                    17250002
DCBBFTEK EQU   32                                                       17400002
DECERPER EQU   X'20'                                                    17450002
CSWSNO   EQU   X'40'                                                    17500002
DECERRST EQU   29                                                       17550002
DECAREA  EQU   12                                                       17600002
DECLNGTH EQU   6                                                        17650002
DECRDINT EQU   X'01'                                                    17700002
HIBIT    EQU   X'C0'                                                    17750002
RTRNCDE  EQU   X'80'                                                    17800002
ERTRYCT  EQU   X'02'                                                    17850002
DECTYPE  EQU   4                                                        17950002
DCBDYNBF EQU   X'08'                                                    18000002
UCBTYP   EQU   16                                                       18050002
SWLINE   EQU   X'90'                                                    18100002
ERLOD3   EQU   3041                                                     18150002
CCWRDCMD EQU   X'02'                                                    18200002
DCBERROP EQU   33                                                       18250002
DCBRDTRY EQU   X'02'                                                    18300002
DECRDRPT EQU   X'07'                                                    18350002
CSWLDDCO EQU   X'0E'                                                    18400002
CSWLD    EQU   X'02'                                                    18450002
X10      EQU   X'10'                                                    18500002
X08      EQU   X'08'                                                    18550002
X09      EQU   X'09'                                                    18600002
X30      EQU   X'30'                                                    18650002
L255     EQU   255                 AND MASK                             18700002
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              18750002
L1       EQU   1                   LENGTH AND DISPLACEMENT              18800002
L2       EQU   2                   LENGTH AND DISPLACEMENT              18850002
L3       EQU   3                   LENGTH AND DISPLACEMENT              18900002
L4       EQU   4                   LENGTH AND DISPLACEMENT              18950002
L5       EQU   5                   LENGTH AND DISPLACEMENT              19000002
L6       EQU   6                   LENGTH AND DISPLACEMENT              19050002
L7       EQU   7                   LENGTH AND DISPLACEMENT              19100002
L8       EQU   8                   LENGTH AND DISPLACEMENT              19110002
L12      EQU   12                  LENGTH AND DISPLACEMENT              19150002
**********                                                              19200002
*                                                                       19250002
*        REGISTER DEFINITION                                            19300002
*                                                                       19350002
**********                                                              19400002
ERREG3   EQU   0                   WORK REG                             19450002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              19500002
ERREG2   EQU   2                   WORK REG                             19550002
BASEREG  EQU   3                   PROGRAM BASE                         19600002
CCWREG   EQU   4                   CCW ADDRESS REG                      19650002
DECBRG   EQU   5                   DECB BASE                            19700002
DCBREG   EQU   6                   DCB BASE                             19750002
UCBREG   EQU   7                   UCB BASE                             19800002
EWAREG   EQU   8                   ERP WORKAREA BASE                    19850002
ERREG1   EQU   9                   WORK REG                             19900002
IOBRG    EQU   10                  IOB BASE                             19950002
ERREG4   EQU   11                  WORK REG                             20000002
ERRLNK   EQU   12                  LINK REG                             20050002
NAMEREG  EQU   13                  LINK REG                             20100002
ERRETR   EQU   14                  RETURN REG                           20150002
ERREG5   EQU   15                  WORK REG                             20200002
         EJECT                                                          20350002
         IECDRQE                                                        20400002
         EJECT                                                          20450002
         IEZIOB                                                         20500002
         EJECT                                                          20550002
CVT      DSECT                                                          20600002
         CVT                                                            20650002
         EJECT                                                          20700002
         IECDERWA                                                       20750002
**********                                                              20800002
*                                                                       20850002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        20900002
*                                                                       20950002
**********                                                              21000002
         ORG   EWAIERP                                                  21050002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 21100002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 21150002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 21200002
EWAIND0  DS    B                   FLAG BYTE                            21250002
EWAIVISR EQU   X'10'               V=R REQUEST                          21850002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 21900002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 21950002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 22000002
EWAIND1  DS    B                   FLAG BYTE                            22050002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 22100002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 22150002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 22200002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 22210002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 22220002
EWAIND2  DS    B                   FLAG BYTE                            22250002
EWAIND3  DS    B                   FLAG BYTE                            22300002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     22350002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  22400002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 22450002
*********  END OF BTAM LOCAL DEFINITIONS **********                     22500002
         EJECT                                                          23700002
         IECDIOSB                                                       23750002
         END                                                            23800002
./  ADD  SSI=73010412,NAME=IGE0404C
         TITLE 'IGE0404C - BSC ERP TIME OUT LOAD 2'                     00050002
IGE0404C CSECT                                                          00100002
*********************************************************************** 00150002
*                                                                     * 00200002
* MODULE NAME:                                                        * 00250002
*    IGE0404C                                                         * 00300002
*                                                                     * 00350002
* DESCRIPTIVE NAME:                                                   * 00400002
*    BTAM BSC TIME OUT ERP LOAD 2                                     * 00450002
*                                                                     * 00500002
* COPYRIGHT:                                                          * 00550002
*    NONE                                                             * 00600002
*                                                                     * 00650002
* STATUS:                                                             * 00700002
*    CHANGE LEVEL 000                                                 * 00750002
*                                                                     * 00800002
* FUNCTION:                                                           * 00850002
*    THIS RECOVERS FROM TIME OUT ERRORS THAT OCCUR DURING             * 00900002
*    BSC OPERATION. THE FAILING CCW IS FOUND AND THE CORRECT          * 00950002
*    PROCEDURE IS INITIATED.                                          * 01000002
*                                                                     * 01050002
* NOTES:                                                              * 01100002
*    DEPENDENCIES:                                                    * 01150002
*        NONE                                                         * 01200002
*    RESTRICTIONS:                                                    * 01250002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01300002
*    REGISTER CONVENTIONS:                                            * 01350002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01400002
*                                                                     * 01450002
* PATCHLABEL:                                                         * 01500002
*    PACHAREA (92 BYTES)                                              * 01550002
*                                                                     * 01600002
* MODULE TYPE:                                                        * 01650002
*    PROCEDURE                                                        * 01700002
*    PROCESSOR:                                                       * 01750002
*        BAL                                                          * 01800002
*    ATTRIBUTES:                                                      * 01950002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02000002
*                                                                     * 02050002
* ENTRY POINT:                                                        * 02100002
*    IGE0404C                                                         * 02150002
*    PURPOSE:                                                         * 02200002
*        SEE 'FUNCTION'                                               * 02250002
*    LINKAGE:                                                         * 02300002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02350002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02400002
*    INPUT:                                                           * 02450002
*        REG 1 = ADDRESS OF IOSB                                      * 02500002
*    OUTPUT:                                                          * 02550002
*        SETS INDICATOR IN DECERRST FOR SHOULD NOT OCCUR ERROR        * 02600002
*        ALTERED CHANNEL PROGRAM                                      * 02650002
*                                                                     * 02700002
* EXITS-NORMAL:                                                       * 02750002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 02850002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 02900002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 02950002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03000002
*        LOADS ARE 1000 GREATER.                                      * 03050002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03100002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03150002
*                                                                     * 03200002
* EXITS-ERROR:                                                        * 03250002
*    NONE                                                             * 03300002
*                                                                     * 03350002
* EXTERNAL REFERENCES:                                                * 03400002
*    ROUTINES:                                                        * 03450002
*        NONE                                                         * 03500002
*    DATA AREAS                                                       * 03600002
*        IOB (MAPPED BY IEZIOB)                                       * 03650002
*        VIRTUAL CHANNEL PROGRAM                                      * 03700002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 03750002
*    CONTROL BLOCKS                                                   * 03800002
*        UCB                                                          * 03850002
*        DCB                                                          * 03900002
*        DECB                                                         * 03950002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04000002
*        CVT          (MAPPED BY CVT)                                 * 04050002
*        IOB          (MAPPED BY IEZIOB)                              * 04100002
*        RQE          (MAPPED BY IECDRQE)                             * 04150002
*                                                                     * 04200002
* TABLES-WORKAREAS:                                                   * 04250002
*    ERP WORKAREA                                                     * 04300002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04350002
*                                                                     * 04400002
* MACROS:                                                             * 04450002
*    NONE                                                             * 04500002
*                                                                     * 04550002
* CHANGE ACTIVITY:                                                    * 04600002
*    YA01231  (IN BASE)                                               * 04610002
*    YM02595K (9/20/73)                                               * 04650002
*    YM02594K (9/24/73)                                               * 04700002
*    YA02436  (11/5/73)                                               * 04710002
*    YA02160  (11/5/73)                                               * 04720002
*    YM05652K (1/25/74)                                               * 04730002
*    YA03261  (2/5/74)                                                * 04740000
*    YA03262  (2/5/74)                                                * 04742000
*    YA03249  (2/15/74)                                               * 04744000
*    ZA00504  (5/9/74)                                                * 04746000
*    AZ03990  (04/24/75)                                              * 04748000
*    ZA04863  (10/03/75)               ZA11456  (07/06/76)            * 04749000
*    ZA17702  (02/15/77)                                              * 04749500
*    ZA26097  (10/26/77)                                              * 04750000
*********************************************************************** 04800002
         EJECT                                                          04850002
         USING *,BASEREG                                                04900002
         LR    BASEREG,ERREG5      SET BASE REG                         04950002
         B     BEGIN               BRANCH AROUND ID            @ZA00504 04960000
         DC    C' IGE0404C '       MODULE ID                   @ZA00504 04970000
         DC    C' UZ15202'         PTF NUMBER                  @ZA26097 04980000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY          @ZA00504 04990000
BEGIN    DS    0H                                              @ZA00504 04992000
         USING RQE,ERREG5                                               05000002
         USING IOSB,IOSBREG                                             05050002
         USING IOBSTDRD,IOBRG                                           05100002
         USING EWA,EWAREG                                               05150002
         USING IECTDECB,DECBRG                                          05200002
         USING IHADCB,DCBREG                                            05250002
         L     ERREG5,IOSUSE       BASE RQE                             05300002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05350002
         L     IOBRG,RQEIOB        BASE IOB                             05400002
         L     DECBRG,IOBECBPT     BASE DECB                            05450002
         L     DCBREG,IOBDCBPT     BASE DCB                             05500002
         L     UCBREG,IOSUCB       BASE UCB                             05550002
         DROP  ERREG5                                                   05600002
         L     CCWREG,IOBFL3       GET IOB CSW                          05650002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                05700002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW IN IOB         05750002
BSCTO0AA TM    IOBWORK,TPOPPTXT    ERROR OCCUR PRIOR TEXT               05800002
         BZ    BSCTO02             YES, CONTINUE FLOW                   05850002
         CLI   ZERO(CCWREG),CCWREAD   ERROR OCCUR ON A READ             05900002
         BNE   BSCTO11             NO, CHECK SPECIAL ERRORS             05950002
         TM    IOBWORK,TPOPDTXT    ERROR OCCUR DURING TEXT              06000002
         BO    BSCTO14             YES, CHECK FURTHER                   06050002
         CLI   IOBWORK,TPOPRRTX    ERROR ON RESPONSE TO TEXT            06100002
         BE    BSCTOT01            YES, SET UP WRITE ENQ                06150002
BSCTO00  OI    DECERRST,DECSNO     INDICATE SHOULD NOT OCCUR            06200002
BSCTO01  MVI   IOBERRCT,ERRMAXCT   SET FOR NO RETRIES                   06250002
         B     BSCTOT07            CHECK FOR LERB                       06300002
BSCTO02  CLI   ZERO(CCWREG),CCWDIAL   ERROR ON A DIAL COMMAND           06350002
         BE    BSCTOT0A            YES, SET UP DISABLE                  06400002
         CLI   IOBWORK,TPOPRENQ    ERROR ON A READ ENQ                  06450002
         BE    BSCTO21X            YES, CHECK OPERATION TYPE            06500002
         CLI   IOBWORK,TPREADID    THIS READ ID CCW                     06550002
         BE    BSCTO22X            YES, CHECK FURTHER                   06600002
         B     BSCTO04                                                  06650002
BSCTO21X CLI   DECTYPE+L1,READINIT   THIS A READ INITIAL                06700002
         BNE   BSCTO02A            NO, CONTINUE CHECKING                06750002
         TM    L17(UCBREG),X90     ARE WE ON DIAL LINE                  06800002
         BNZ   BSCTOT07            YES, RESTART WIRH READ ENQ           06850002
         B     BSCTO03             NO, ADJUST TO PREPARE                06900002
BSCTO02A CLI   DECTYPE+L1,RDINITEN   THIS A READ INITIAL ENQ            06950002
         BE    BSCTO03             YES, REWRITE EOT'S                   07000002
         CLI   DECTYPE+L1,WRENQCP    RD ENQ CP                          07050002
         BNE   BSCTOT07            NO, CHECK FURTHER            YA03261 07100000
         TM    L35(DCBREG),RJEMASK   RJE REQUESTING NO RETRIES          07150002
         BZ    BSCTOT07            CHECK FOR LERB                       07200002
         B     BSCTO01             SET NO RETRIES                       07250002
BSCTOT0B EQU   *                                                        07300002
         CLI   DECTYPE+L1,WRRESET    WRITE RESET CHAN PROGRAM           07400002
         BE    BSCTO01             YES, SET NO RETRIES                  07450002
         B     BSCTOT07            NO, SET CPA TO FAILURE CM            07550002
BSCTO03  SH    CCWREG,ERRCN8       BACK UP ONE CCW                      07600002
         B     BSCTOT07            CONTINUE FLOW                        07650002
BSCTO22X SH    CCWREG,ERRCN8       BACK UP ONE CCW                      07700002
         CLI   L5(CCWREG),TPWRITID   THIS WRITE ID CCW                  07800002
         BE    BSCTOT07            YES, RESTART HERE                    07850002
         LA    CCWREG,L8(CCWREG)   STEP TO NEXT CCW                     07950002
         B     BSCTOT07                                                 08000002
BSCTO04  CLI   IOBWORK,TPOPRREN    ERROR ON A READ RESP TO ENQ          08050002
         BNE   BSCTO2              NO CONTINUE                          08100002
         B     BSCTO03             RETRY                                08150002
BSCTO10  LA    NAMEREG,ERLOD12     ADDRESS OF LERB ROUTINE              08200002
XCTLOUT  EQU   *                                                        08250002
         L     ERRETR,CVTPTR       POINT TO CVT                         08300002
         USING CVTMAP,ERRETR                                            08350002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUITNE                08400002
         DROP  ERRETR                                                   08450002
         BR    ERRETR              EXIT VIA LERB ROUTINE                08500002
BSCTO11  CLI   ZERO(CCWREG),CCWWRITE    ERROR ON A WRITE                08550002
         BE    BSCTO12             YES, SET UP WRITE CHAN PROG          08600002
         CLI   ZERO(CCWREG),CCWDISAB    ERROR ON A DISABLE              08650002
         BNE   BSCTO00             NO, SET SHOULD NOT OCCUR             08700002
         B     BSCTOT07            YES, SET UP TO RETRY                 08750002
BSCTO12  CLI   L13(CCWREG),WENDRSP   ERROR DURING WR TRANS TXT          08800002
         BNE   BSCTO00             NO, POST SNO                         08850002
         MVC   IOBWORK+L2,DCBBSDLE   PREPARE TO WRITE DLE ENQ           08950002
         MVC   IOBWORK+L3,DCBBSENQ                                      09000002
         LA    ERREG2,IOBWORK+L2   ADDRESS OF DLE ENQ                   09050002
         LA    ERREG4,CCWREAD      COUNT OF 2                           09100002
         ST    ERREG4,IOBERCCW+L4   STORE IN CCW                        09150002
         LA    ERREG4,CCWWRITE     SET WRITE COMMAND                    09200002
         LA    ERRLNK,CCWTIC       SET TIC COMMAND                      09250002
         B     BSCTO04A            COMPLETE CHANNEL PROGRAM             09300002
BSCTO14  TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFERING USED               09350002
         BO    BSCTOT09            YES, POST WITH ERROR                 09400002
         CLI   IOBCPA,CCWAPOLL     THIS A POLL OPERATION                09450002
         BNE   BSCTOT07            NO, BRANCH                  @ZA17702 09500000
         SH    CCWREG,ERRCN8       BACK UP ONE CCW                      09550002
         L     ERREG5,ZERO(CCWREG)   PICK UP AREA ADDRESS               09600002
         LA    ERREG5,L1(ERREG5)   INCREMENT ADDRESS BY ONE             09650002
         CLM   ERREG5,L7,L9(CCWREG) IS ADDR & COUNT ADJUSTED   @ZA11456 09700000
         BE    BSCTOTCA            SET UP WRITE NAK AND TIC    @ZA11456 09750000
         STCM  ERREG5,L7,L9(CCWREG)   NO, STORE IN READ        @ZA00504 09800000
         LH    ERREG5,L14(CCWREG)   PICK UP COUNT                       09850002
         LA    ERREG5,L1(ERREG5)   INCREMENT COUNT BY ONE               09900002
         STH   ERREG5,L14(CCWREG)   STORE IN CCW                        09950002
BSCTOTCA AH    CCWREG,ERRCN8       READJUST POINTER            @ZA11456 10000000
         LA    ERREG4,CCWWRITE     WRITE OP TYPE                YA03249 10050000
         LA    ERREG2,DCBBSNAK     NAK                          YA03249 10060000
         LA    ERRLNK,CCWTIC       TIC OP TYPE                  YA03249 10070000
BSCTO142 MVI   IOBWORK+L1,RTRNCDE2   INDICATE INTERNAL ROUTINE  YA03249 10100000
         B     BSCTOT04            CONTINUE CHAN PROG GEN       YA03249 10150000
BSCTOT07 ST    CCWREG,IOBSTART     SET CHAN PROG ADDRESS                10200000
BSCTOTB7 TM    IOBSENS0,LERBDCID   LINE ERROR RECORD REQ                10300002
         BZ    BSCTOTA7            NO, CONTINUE FLOW                    10350002
         TM    DCBERROP,DCBLERBI   IS LERB REQUIRED                     10400002
         BNO   BSCTOTA7            NO, CONTINUE FLOW                    10450002
         TM    DECTYPE,NOLERB      SUPPRESS LERB                        10500002
         BO    BSCTOTA7            YES, DON'T SET LERB                  10550002
         MVI   IOBINCAM+L1,LERBTOID   TIME OUT LERB REQUIRED            10600002
BSCTOTA7 CLI   IOBERRCT,ERRMAXCT   ARE RETRIES EXHAUSTED                10650002
         BNL   BSCTOT09            YES, SET PERM ERROR                  10700002
         IC    ERREG5,IOBERRCT     PICK UP RETRY COUNT                  10750002
         LA    ERREG5,L1(ERREG5)   INCREMENT BY ONE                     10800002
         STC   ERREG5,IOBERRCT     STORE NEW COUNT                      10850002
BSCTO26  EQU   *                                                        10900002
         CLI   IOBINCAM+L1,LERBTOID     LERB REQUIRED           YA02436 10950002
         BE    BSCTO10             YES, EXIT VIA LERB           YA02436 11000002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 11050002
         L     NAMEREG,TRANSRTN    LOAD NAME OF 904B           YM02594K 11100002
         B     XCTLOUT             XCTL                                 11150002
BSCTOT09 NI    IOSFLA,L255-IOSERR   INDICATE PERMANENT ERROR            11200002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     11250002
         L     ERREG5,DECENTRY     GET ADDR OF TERMINAL LIST            11300002
         CLI   ZERO(ERREG5),SWLST   IS THIS A SWLST                     11350002
         BNE   BSCTO21D                                                 11400002
         CLI   DECTYPE+L1,WRTCON   IS THIS WRITE CONNECT                11500002
         BE    BSCTOSW3                                                 11550002
*                                  THE FOLLOWING DELETED FOR    YA03261 11600000
***      CLI   IOBCPA+L21,X07      READ ID (WORLD TRADE)                11650000
***      BE    BSCTO21                                                  11700000
         CLI   L5(CCWREG),X07      IS THIS READ ID ENQ          YA03262 11750000
         BNE   BSCTO21D                                                 11800002
BSCTO21  EQU   *                                                        11850002
         LA    CCWREG,L32(CCWREG)   POINT TO DISABLE CCW                11900002
BSCTODIS EQU   *                                                        11950002
         MVC   IOBERCCW(L16),ZERO(CCWREG)   MOVE DISABLE AND TIC CCWS   12000002
         LA    CCWREG,IOBERCCW     POINT TO ERROR CCW AREA              12100002
         MVI   IOBERRCT,ZERO       ZERO OUT RETRY COUNT                 12150002
         B     BSCTO21E                                                 12200002
BSCTOSW3 EQU   *                                                        12250002
         MVC   IOBERCCW(L16),DLEOTCCW   WRITE DLE EOT , DISABLE         12300002
         LA    ERREG5,DCBBSDLE     GET ADDRESS OF DLE EOT               12400002
         ST    ERREG5,IOBERCCW     STORE ADDRESS IN CCW                 12450002
         MVI   IOBERCCW,CCWWRITE   MOVE IN WRITE COMMAND                12500002
         LA    CCWREG,IOBERCCW                                          12550002
BSCTO21C EQU   *                                                        12600002
         MVC   IOBERCCW+L16(L1),IOBSENS0   MOVE SENSE INFO TO AREA      12650002
         MVC   IOBERCCW+L17(L7),IOBCSW   MOVE CSW TO AREA               12700002
         MVI   IOBERRCT+L1,RTRNSPCD   SET SPECIAL RETURN CODE           12750002
         MVI   IOBWORK+L1,RTNCD8C   SET BRANCH OFFSET                   12800002
BSCTO21E ST    CCWREG,IOBSTART     STORE IN IOBSTART                    12850002
         OI    IOSFLA,IOSERR       TURN ON ERP IN CONTROL               12950002
         OI    IOBFLAG1,IOBERRTN   ALSO IN IOB                          13000002
         B     BSCTO26             EXECUTE CHAN PROGRAM                 13050002
BSCTO21D EQU   *                                                        13100002
         CLI   IOBINCAM+L1,LERBTOID   LERB REQUIRED             YA02436 13150002
         BE    BSCTO10             YES, EXIT VIA LERB           YA02436 13200002
         LH    NAMEREG,ERLOD35     ADDRESS OF ERROR POST ROUTINE        13250002
         B     XCTLOUT             EXIT                                 13300002
BSCTOT01 LA    ERREG2,DCBBSENQ     ADDRESS OF ENQ CHARACTER             13350002
         MVI   IOBWORK+L1,RTNCDE6                                       13400002
BSCTOT02 LA    ERREG4,CCWWRITE     SET WRITE COMMAND                    13450002
         LA    ERRLNK,CCWTIC       SET TIC COMMAND                      13500002
BSCTOT04 ST    ERREG4,IOBERCCW+L4   SET COUNT IN CCW                    13550002
BSCTO04A ST    ERREG2,IOBERCCW     STORE ADDRESS IN CCW                 13600002
         STC   ERREG4,IOBERCCW     SET COMMAND IN CCW                   13650002
         CLI   IOBWORK+L1,ZERO     SPECIAL RETURN REQUIRED              13700002
         BE    BSCTOTA6            NO, DON'T SET CODE                   13750002
         MVI   IOBERRCT+L1,RTRNSPCD   SET SPECIAL RETURN CODE           13800002
BSCTOTA6 ST    CCWREG,IOBERCCW+L8   STORE TIC ADDRESS                   13850002
         STC   ERRLNK,IOBERCCW+L8   SET COMMAND IN CCW                  13900002
         ST    ERREG4,IOBERCCW+L12   SET COUNT IN CCW           YA02160 13950002
         MVI   IOBERCCW+L4,CHAINCDE   SET COMMND CHN & SLI FLAGS        14000002
         LA    CCWREG,IOBERCCW     CHANNEL PROGRAM ADDRESS              14100002
         B     BSCTOT07            RETRY ERROR                          14150002
BSCTOT2A LA    ERRLNK,CCWNOP                                            14200002
         LA    ERREG2,IOBWORK+L2                                        14250002
         LA    ERREG4,CCWREAD                                           14300002
         MVI   IOBWORK+L1,RTRNCDE1  SET SPECIAL RET CD = 81    @ZA11456 14320000
         B     BSCTOT04                                                 14350002
BSCTO2   CLI   IOBWORK,TPOPRRPL    READ RESPONSE TO POLLING             14400002
         BNE   BSCTO23             NO CHECK FURTHER                     14450002
         TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFERING           @ZA03990 14455000
         BNO   BSCT02A             NO, CHECK RETRY             @ZA03990 14460000
         MVC   L9(L3,CCWREG),L1(CCWREG)   PUT INPUT            @ZA03990 14465000
*                     AREA ADDR IN RD TEXT CCW (FROM RD INDEX) @ZA03990 14470000
*                        FOR MB TO RELEASE BUFFERS. THIS MVC   @ZA03990 14475000
*                        IS GOOD FOR BOTH OPEN AND WRAP LIST.  @ZA03990 14480000
         B     BSCTOT09         POST WITH ERROR                @ZA03990 14485000
BSCT02A  EQU   *                                                        14490000
         L     ERREG2,DECAREA      POINT TO BUFFER              YA03249 14500000
         CLC   ZERO(L1,ERREG2),IOBDCBPT   INDEX EQUAL           YA03249 14550000
         BE    INDXEQUL            YES                          YA03249 14600000
         MVC   IOBDCBPT(L1),ZERO(ERREG2)   SET NEW INDEX        YA03249 14610000
         MVI   IOBERRCT,ZERO       SET COUNT TO ZERO            YA03249 14620000
INDXEQUL EQU   *                                                YA03249 14630000
         L     ERREG5,IOBCPA+L8    USER POLLING ENTRY                   14650002
         MVC   IOBCPA+L9(L3),DECENTRY+L1   FAILING ADDR TO CHAN PROG    14700002
         L     ERREG2,IOBCPA+L8    PICK UP FAILING ADDR                 14750002
         SR    ERREG5,ERREG2       DIFF BETWEEN USERS AND FAILED        14800002
         AH    ERREG5,IOBCPA+L14   ADD TOTAL                            14850002
         STH   ERREG5,IOBCPA+L14   STORE NEW COUNT                      14900002
         L     ERREG5,ZERO(CCWREG)   GET DATA ADDRESS           YA03249 14950000
         LA    ERREG5,L1(ERREG5)   BUMP BY ONE                  YA03249 15000000
         STCM  ERREG5,L7,L9(CCWREG)   STORE IN NEXT CCW        @ZA00504 15010000
         LH    ERREG5,L14(CCWREG)   GET COUNT                   YA03249 15020000
         LA    ERREG5,L1(ERREG5)   BUMP BY ONE                  YA03249 15030000
         STH   ERREG5,L14(CCWREG)   RESET COUNT                 YA03249 15040000
         MVI   IOBWORK+L1,RTRNCDE2   SET SPECIAL RETURN         YA03249 15042000
         LA    ERREG2,DCBBSNAK     NAK                          YA03249 15044000
         LA    CCWREG,L8(CCWREG)   START ON NEXT CCW            YA03249 15046000
         B     BSCTOT02            BUILD CHANNEL PROGRAM        YA03249 15048000
BSCTO23  CLI   IOBWORK,TPOPRRAD    READ RESP TO ADDRESSING              15050002
         BE    BSCTO24             YES SET UP RETRY                     15100002
         CLI   ZERO(CCWREG),CCWPREP   IS CCW PREPARE                    15150002
         BE    BSCTO231            YES, POST SNO                        15200002
         CLI   IOBWORK,TPWRITRS    IS THIS WR RESP TO ENQ               15250002
         BE    BSCTO231            YES, POST SNO                        15300002
         CLI   IOBWORK,ZERO        ERP CCW                              15350002
         BNE   BSCTO231            NO, BRANCH                  @ZA26097 15400000
         L     CCWREG,IOBERCCW+L8   LOAD FAILING CCW                    15450002
         B     BSCTOT07            RESTART WITH IT                      15500002
BSCTO242 SH    CCWREG,ERRCN8       RESEND ID AND ENQ                    15550002
         B     BSCTOT07            CONTINUE FLOW                        15600002
BSCTO231 EQU   *                                                        15650002
         OI    DECERRST,DECSNO     SET SHOULD NOT OCCUR                 15700002
         B     BSCTOT09                                                 15750002
BSCTO24  LA    CCWREG,IOBCPA       START OF CHANNEL PROG                15800002
         B     BSCTOT07                                                 15850002
BSCTOT0A MVC   IOBERCCW(L8),DISABCCW   MOVE IN DISABLE                  15900002
         LA    ERRLNK,CCWTIC       SET TIC COMMAND                      15950002
         LA    ERREG4,CCWWRITE     SET COUNT TO ONE                     16000002
         B     BSCTOTA6            SET UP CHANNEL PROGRAM               16050002
         EJECT                                                          16750002
**********                                                              16800002
*                                                                       16850002
*        CONSTANTS                                                      16900002
*                                                                       16950002
**********                                                              17000002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       17050002
DLEOTCCW DC    X'0100000060210002'                                      17100002
DISABCCW DC    X'2F00000020010001'   DISABLE CCW                        17150002
ERLOD35  DC    H'2043'                                                  17200002
ERRCN8   DC    H'8'                                                     17250002
PACHAREA DC    23C'404C'           PATCHAREA FOR MAINTENANCE            17300002
**********                                                              17350002
*                                                                       17400002
*        MISCELLANEOUS EQUATES                                          17450002
*                                                                       17500002
**********                                                              17550002
STATUP   EQU   254                 STATISTICS UPDATE ROUTINE NAME       17600002
TPOPRRPL EQU   X'0A'                                                    17700002
TPOPRRAD EQU   X'06'                                                    17750002
DECSNO   EQU   X'40'                                                    17800002
DCBLERBI EQU   X'08'                                                    17850002
LERBTOID EQU   X'03'                                                    17900002
ERRMAXCT EQU   7                                                        17950002
WRTCON   EQU   X'1C'               WRITE CONNECT                        18000002
CCWDIAL  EQU   X'29'                                                    18050002
WENDRSP  EQU   X'13'                                                    18100002
L1       EQU   1                   LENGTH AND DISPLACEMENT              18150002
L2       EQU   2                   LENGTH AND DISPLACEMENT              18200002
L3       EQU   3                   LENGTH AND DISPLACEMENT              18250002
L4       EQU   4                   LENGTH AND DISPLACEMENT              18300002
L5       EQU   5                   LENGTH AND DISPLACEMENT              18350002
L6       EQU   6                   LENGTH AND DISPLACEMENT              18400002
L7       EQU   7                   LENGTH AND DISPLACEMENT              18450002
L8       EQU   8                   LENGTH AND DISPLACEMENT              18500002
L9       EQU   9                   LENGTH AND DISPLACEMENT              18550002
L12      EQU   12                  LENGTH AND DISPLACEMENT              18560002
L13      EQU   13                  LENGTH AND DISPLACEMENT              18600002
L14      EQU   14                  LENGTH AND DISPLACEMENT              18650002
L16      EQU   16                  LENGTH AND DISPLACEMENT              18700002
L17      EQU   17                  LENGTH AND DISPLACEMENT              18750002
L21      EQU   21                  LENGTH AND DISPLACEMENT              18800002
L32      EQU   32                  LENGTH AND DISPLACEMENT              18850002
L35      EQU   35                  LENGTH AND DISPLACEMENT              18900002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              18950002
X07      EQU   X'07'               READ ID MASK                         19000002
X87      EQU   X'87'               WRITE CONNECT MASK                   19050002
X90      EQU   X'90'               DIAL MASK                            19100002
ERLOD12  EQU   2042                                                     19250002
NOLERB   EQU   X'40'                                                    19300002
L255     EQU   X'FF'               AND MASK                             19350002
CHAINCDE EQU   X'60'                                                    19400002
RTRNSPCD EQU   X'14'                                                    19450002
CCWTIC   EQU   X'08'                                                    19500002
LERBDCID EQU   X'01'                                                    19550002
RTRNCDE1 EQU   X'81'                                                    19600002
RTRNCDE2 EQU   X'82'                                            YA03249 19610000
CCWAPOLL EQU   X'09'                                                    19650002
DYNBUF   EQU   X'08'                                                    19700002
CCWPREP  EQU   X'06'                                                    19750002
CCWDISAB EQU   X'2F'                                                    19800002
CCWWRITE EQU   X'01'                                                    19850002
TPOPRREN EQU   X'0C'                                                    19900002
RDINITEN EQU   X'19'                                                    19950002
RTNCDE6  EQU   X'86'                                                    20000002
TPOPRENQ EQU   X'0B'                                                    20050002
READINIT EQU   X'01'                                                    20100002
TPOPRRTX EQU   X'25'                                                    20150002
TPOPDTXT EQU   X'11'                                                    20200002
CCWREAD  EQU   X'02'                                                    20250002
CCWNOP   EQU   X'03'                                                    20300002
TPOPPTXT EQU   X'30'                                                    20350002
TPREADID EQU   X'07'                                                    20400002
WRRESET  EQU   X'0A'                                                    20450002
WRENQCP  EQU   X'15'                                                    20500002
RJEMASK  EQU   X'80'                                                    20550002
TPWRITID EQU   X'03'                                                    20600002
TPWRITRS EQU   7                                                        20650002
SWLST    EQU   X'FF'                                                    20700002
RTNCD8C  EQU   X'8C'                                                    20750002
COUNT2   EQU   X'02'                                                    20800002
**********                                                              20900002
*                                                                       20950002
*        REGISTER EQUATES                                               21000002
*                                                                       21050002
**********                                                              21100002
ERREG3   EQU   0                   WORK REG                             21150002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              21200002
ERREG2   EQU   2                   WORK REG                             21250002
ERREG1   EQU   3                   WORK REG                             21300002
CCWREG   EQU   4                   CCW ADDRESS REG                      21350002
DECBRG   EQU   5                   DECB BASE                            21400002
DCBREG   EQU   6                   DCB BASE                             21450002
UCBREG   EQU   7                   UCB BASE                             21500002
BASEREG  EQU   8                   PROGRAM BASE                         21550002
EWAREG   EQU   9                   ERP WORKAREA BASE                    21600002
IOBRG    EQU   10                  IOB BASE                             21650002
ERREG4   EQU   11                  WORK REG                             21700002
ERRLNK   EQU   12                  LINK REG                             21750002
NAMEREG  EQU   13                  LINK REG                             21800002
ERRETR   EQU   14                  LINK REG                             21850002
ERREG5   EQU   15                  WORK REG/LINK REG                    21900002
         EJECT                                                          21950002
         IECTDECB                                                       22000002
         EJECT                                                          22050002
         DCBD  DSORG=BX,DEVD=BS                                         22100002
         EJECT                                                          22150002
         IECDRQE                                                        22200002
         EJECT                                                          22250002
         IEZIOB                                                         22300002
         EJECT                                                          22350002
CVT      DSECT                                                          22400002
         CVT                                                            22450002
         EJECT                                                          22500002
         IECDERWA                                                       22550002
**********                                                              22600002
*                                                                       22650002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        22700002
*                                                                       22750002
**********                                                              22800002
         ORG   EWAIERP                                                  22850002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 22900002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 22950002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 23000002
EWAIND0  DS    B                   FLAG BYTE                            23050002
EWAIVISR EQU   X'10'               V=R REQUEST                          23650002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 23700002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 23750002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 23800002
EWAIND1  DS    B                   FLAG BYTE                            23850002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 23900002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 23950002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 24000002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 24010002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 24020002
EWAIND2  DS    B                   FLAG BYTE                            24050002
EWAIND3  DS    B                   FLAG BYTE                            24100002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     24150002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  24200002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 24250002
*********  END OF BTAM LOCAL DEFINITIONS **********                     24260002
         EJECT                                                          24300002
         IECDIOSB                                                       24350002
         END                                                            24400002
./  ADD  SSI=61460231,NAME=IGE0504A
         TITLE 'IGE0504A - BTAM ERP ERROR POST MODULE'                  00070002
IGE0504A CSECT                                                          00120002
*********************************************************************** 00170002
*                                                                     * 00220002
* MODULE NAME:                                                        * 00270002
*    IGE0504A                                                         * 00320002
*                                                                     * 00370002
* DESCRIPTIVE NAME:                                                   * 00420002
*    BTAM ERP ERROR POST                                              * 00470002
*                                                                     * 00520002
* COPYRIGHT:                                                          * 00570002
*    NONE                                                             * 00620002
*                                                                     * 00670002
* STATUS:                                                             * 00720002
*    CHANGE LEVEL 000                                                 * 00770002
*                                                                     * 00820002
* FUNCTION:                                                           * 00870002
*    PERFORMS ERROR MESSAGE WRITING AND MESSAGE CONSTRUCTION FOR ALL  * 00920002
*    BTAM ERP ROUTINES.  CHECKS RESULTS OF DIAGNOSTIC WRITE/READ      * 00970002
*    2701 ADAPTER UNIT. POSTS COMPLETE WITH ERROR.                    * 01020002
*                                                                     * 01070002
* NOTES:                                                              * 01120002
*    DEPENDENCIES:                                                    * 01170002
*        NONE                                                         * 01220002
*    RESTRICTIONS:                                                    * 01270002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01320002
*    REGISTER CONVENTIONS:                                            * 01370002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01420002
*                                                                     * 01470002
* PATCHLABEL:                                                         * 01520002
*    PACHAREA (84 BYTES)                                              * 01570002
*                                                                     * 01620002
* MODULE TYPE:                                                        * 01670002
*    PROCEDURE                                                        * 01720002
*    PROCESSOR:                                                       * 01770002
*        BAL                                                          * 01820002
*    MODULE SIZE:                                                     * 01870002
*        840 BYTES                                                    * 01920002
*    ATTRIBUTES:                                                      * 01970002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE,                 * 02020002
*        LOCAL LOCK HELD ACCROSS POST CALL                            * 02070002
*                                                                     * 02120002
* ENTRY POINT:                                                        * 02170002
*    IGE0504A                                                         * 02220002
*    PURPOSE:                                                         * 02270002
*        SEE 'FUNCTION'                                               * 02320002
*    LINKAGE:                                                         * 02370002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02420002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02470002
*    INPUT:                                                           * 02520002
*        REG 1 = ADDRESS OF IOSB                                      * 02570002
*    OUTPUT:                                                          * 02620002
*        SET DECERRST FOR ERROR STATUS, ENABLE FAILED, DIAG RD/WRT    * 02670002
*        FAILED, DISABLE FAILED.                                      * 02720002
*        ALTERED CHANNEL PROGRAM.                                     * 02770002
*                                                                     * 02820002
* EXITS-NORMAL:                                                       * 02870002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 02920002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 02970002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03020002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03070002
*        LOADS ARE 1000 GREATER.                                      * 03120002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03170002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03220002
*                                                                     * 03270002
* EXITS-ERROR:                                                        * 03320002
*    NONE                                                             * 03370002
*                                                                     * 03420002
* EXTERNAL REFERENCES:                                                * 03470002
*    ROUTINES:                                                        * 03520002
*        SETLOCK                                                      * 03570002
*        POST (IEA0PT01)                                              * 03620002
*    DATA AREAS                                                       * 03670002
*        IOB (MAPPED BY IEZIOB)                                       * 03720002
*        VIRTUAL CHANNEL PROGRAM                                      * 03770002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 03820002
*    CONTROL BLOCKS                                                   * 03870002
*        UCB                                                          * 03920002
*        DCB                                                          * 03970002
*        DECB                                                         * 04020002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04070002
*        CVT          (MAPPED BY CVT)                                 * 04120002
*        IOB          (MAPPED BY IEZIOB)                              * 04170002
*        RQE          (MAPPED BY IECDRQE)                             * 04220002
*        PSA          (MAPPED BY IHAPSA)                              * 04270002
*                                                                     * 04320002
* TABLES-WORKAREAS:                                                   * 04370002
*    ERP WORKAREA                                                     * 04420002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04470002
*                                                                     * 04520002
* MACROS:                                                             * 04570002
*    SETLOCK                                                          * 04620002
*                                                                     * 04670002
* CHANGE ACTIVITY:                                                    * 04720002
*    YM02595K (9/20/73)                                               * 04770002
*    YM02594K (9/24/73)                                               * 04820002
*    YA02437  (11/1/73)                                               * 04830002
*    YA02455  (11/1/73)                                               * 04840002
*    YM05652K (1/25/74)                                               * 04850002
*    ZA02844 (03/03/75)          ZA03591 (03/24/75)                   * 04860000
*    AZ04855 (09/24/75)          AZ07659  (11/25/75)                  * 04862000
*    AZ10051 (05/17/76)                                               * 04864000
*                                                                     * 04866000
*                                                                     * 04870000
*********************************************************************** 04920002
         EJECT                                                          04970002
         USING *,BASEREG                                                05020002
         LR    BASEREG,ERREG5      SET BASE REG                         05070002
         USING RQE,ERREG5                                               05120002
         USING IOSB,IOSBREG                                             05170002
         USING IOBSTDRD,IOBRG                                           05220002
         USING EWA,EWAREG                                               05270002
         B     START                                                    05278000
         DC    C'IGE0504A'       EYE CATCHER                            05286000
         DC    C'** MVS *'                                              05294000
         DC    C'&SYSDATE'      DATE LAST ASSEMBLED                     05302000
         DS    0H                                                       05310000
START    L     ERREG5,IOSUSE       BASE RQE                             05320000
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05370002
         L     IOBRG,RQEIOB        BASE IOB                             05420002
         L     DECBRG,IOBECBPT     BASE DECB                            05470002
         L     DCBREG,IOBDCBPT     BASE DCB                             05520002
         L     UCBREG,IOSUCB       BASE UCB                             05570002
         DROP  ERREG5                                                   05620002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       05670002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                05720002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                05770002
         XC    IOBRESTR(L4),IOBRESTR   CLR XTENDED MSG AREA             05820002
         MVI   IOBSENS1,ZERO                                            05870002
         MVI   IOSSNS+L1,FOXFOX                                         05920002
         SR    ERREG1,ERREG1       INITIALIZE WORK                      05970002
         LA    ERRLNK,L1                                                06020002
         IC    ERREG1,IOBERRCT+L1   PICK UP ENTRY INDEX                 06070002
         SRL   ERREG1,L4           ADJUST INDEX VALUE                   06120002
         B     ERRPST1(ERREG1)     BRANCH VIA BRANCH TQBLE              06170002
ERRPST1  B     ERRPST              NORMAL POST                          06220002
         B     ERRPST              TERM ID BYPASS                       06270002
         B     ERRPST6             DISABLE RESTORE                      06320002
         NI    L5(CCWREG),MASK2    SETUP TO DETERMINE FAILING CCW       06370002
         IC    ERREG1,L5(CCWREG)   INDEX VALUE                          06420002
         B     ERRPST2(ERREG1)     ENTRY TO ERROR ROUTINE               06470002
ERRPST2  B     ERRPST3             DISABLE FAILED                       06520002
         B     ERRPST4             DIAG WRITE FAILED                    06570002
         B     ERRPST5             DIAG READ FAILED                     06620002
         CLI   IOBCSW+L3,CSWCDE    CHAN AND DEV END ONLY                06670002
         BNE   ERRPST21            NO INDICATE ERROR                    06720002
         TM    IOBCSW+L4,FOXFOX    CHECK SECOND STATUS BYTE             06770002
         BZ    ERRPST22            NO ERROR DETECTED                    06820002
ERRPST21 OI    DECERRST(DECBRG),ERRENB   INDICATE ENABLE FAILED         06870002
ERRPST22 EQU   *                                                        06920002
         MVC   IOBSENS0(L1),IOBERINF   RESTORE SENSE BYTE               06970002
         MVC   IOBCSW(L7),IOBERINF+L1   RESTORE 7 LOW                   07020002
*                                  ORDER BYTES OF CHANNEL STATUS WORD   07070002
         L     CCWREG,IOBFL3       RESTORE CCW POINTER                  07170002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                07220002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                07270002
         MVC   ZERO(L8,CCWREG),IOBERINF+L8   RESTORE FAILING CCW        07320002
ERRPST   TM    UCBTYP+L1(UCBREG),SWLINE   IS THIS A SWITCHED LINE       07370002
         BNZ   ERRPST03            YES NO TERM ID'S REQUIRED            07420002
         TM    DECTYPE+L1(DECBRG),READ   IS THIS READ OPERATION         07470002
         BO    RDTYPE              YES, BRANCH                          07520002
         L     ERREG4,DECADRPT(DECBRG)   ADDRESS OF CHARS               07570002
         B     ERRDATA                                                  07620002
RDTYPE   TM    UCBTYP+L1(UCBREG),APOLL   IS OPERATION AUTOPOLL          07670002
         BO    POLTYPE             YES, BRANCH                          07720002
         L     ERREG4,DECPOLPT(DECBRG)   ADDRESS OF POLL CHAR           07770002
         B     ERRDATA                                                  07820002
POLTYPE  L     ERREG4,DECENTRY(DECBRG)   ADDRESS OF POLL CHAR           07870002
ERRDATA  MVC   IOBWARK(L4),UCBTYP(UCBREG)   MOVE DEVICE DATA            07920002
         NI    IOBWARK+L3,MASK3    CLEAR UNWANTED BITS                  07970002
         NI    IOBWARK,MASK2       CLEAR UNWANTED BITS                  08020002
         CLI   IOBWARK+L3,ADAPT5   CHECK FOR TWX ADAPTER                08070002
         BL    ERRPST11            NO, NOT TWX OR ABOVE                 08120002
ERRPST05 CLI   IOBWARK+L3,ADAPT8   THIS A 2260                          08170002
         BNE   ERRPST03            NO, NO ID NEEDED                     08220002
         CLI   IOBCPA+L13,X03      IS THIS WR ADDR/POLL CCW             08270002
         BNE   ERRPST02            NO, USE DECENTRY ADDR                08320002
         L     ERREG4,IOBCPA+L8    PICK UP ADDRESS FROM CCW             08370002
         B     ERRPST02            MOVE ID TO MESSAGE                   08420002
ERRPST11 CLI   IOBERRCT+L1,X40     SUPPRESS ID IN MESSAGE               08470002
         BE    ERRPST03            YES, NO ID IN MESSAGE                08520002
         CLI   IOBWARK,X09         IS THIS 2740B                        08570002
         BE    A2740               YES, TREAT AS 2740                   08620002
         CLI   IOBWARK,MODTYP40    THIS A 2740                          08670002
         BNE   ERRPST04            NO CONTINUE CHECKING                 08720002
A2740    EQU   *                                                        08770002
         TM    IOBWARK+L1,STACTRL   DOES 2740 HAVE STATION CONTROL      08820002
         BZ    ERRPST03            NO TERM ID NOT REQUIRED              08870002
ERRPST01 BCTR  ERRLNK,ZERO         REDUCE REG FOR MOVE                  08920002
ERRPST02 EX    ERRLNK,ERRMOVE      MOVE TERM ID INTO MSG                08970002
ERRPST03 OI    IOBFLAG2,IOBRDHA0   INDICATE EXTENDED MSG TO WTO         09020002
         MVC   IOBRESTR(L1),L5(CCWREG)   PUT TP OP CODE IN MSG          09070002
         L     DCBREG,IOBDCBPT     PICK UP POINTER TO DCB               09120002
         L     ERREG2,IOBSTART     CLEAR 1ST BYTE OF REG                09170002
         CR    CCWREG,ERREG2       IS THIS FIRST CCW                    09220002
         BNE   ERRPST06            NO, BRANCH                           09270002
         TM    IOBRESTR,X21        IS THIS WRITE RESET                  09320002
         BO    ERRPST07            YES, BRANCH                          09370002
ERRPST06 EQU   *                                                        09420002
         LA    CCWREG,IOBCPA       POINT TO FIRST CCW                   09470002
         TM    DCBBFTEK(DCBREG),X08   DYNAMIC BUFFERING                 09520002
         BNO   ERRWTO              NO, NORMAL POST                      09570002
         TM    IOBERINF+L13,X30    ERROR PRIOR TO TEXT                  09620002
         BNZ   ERRWTO              NO, DON'T POST BUFFER                09670002
         TM    IOBRESTR,X11        IS TP OP CODE RD/WR TEXT             09720002
         BO    ERRWTO              YES, DON'T POST BUFFER               09770002
ERRPST07 SR    ERREG2,ERREG2       CLEAR REGISTER                       09820002
         LA    IOBRG,ZERO(IOBRG)   CLEAR HI-ORDER BYTE                  09870002
         IC    ERREG2,DCBIOBSZ(DCBREG)   PICK UP IOB SIZE               09920002
         AR    ERREG2,IOBRG        CALCULATE IOB END                    09970002
ERRPST9B CR    ERREG2,CCWREG       ARE WE IN IOB                        10020002
         BNH   ERRWTO              NO, NORMAL POST                      10070002
         TM    L5(CCWREG),X11      IS THIS READ OR WRITE DATA           10120002
         BO    ERRPST9A            YES, POST THE BUFFER                 10170002
         TM    L5(CCWREG),LASTCCW  IS THIS THE LAST CCW?       @ZA07659 10180000
         BO    ERRWTO              YES, DON'T POST THE BUFFER  @ZA07659 10190000
         LA    CCWREG,L8(CCWREG)   POINT TO NEXT CCW                    10220002
         B     ERRPST9B            CHECK IT                             10270002
ERRPST9A L     ERREG4,ZERO(CCWREG)   PICK UP DATA ADDRESS               10320002
         N     ERREG4,MASKDB       AND TO FULL WORD BOUNDARY            10370002
         SH    ERREG4,ERRCN4       BACK UP TO LINK FIELD                10420002
         LTR   ERREG4,ERREG4       TEST FOR ZERO ADDRESS                10470002
         BNP   ERRWTO              BRANCH IF YES                        10520002
         TM    ZERO(ERREG4),X40    IS BUFFER POSTED                     10570002
         BO    ERRWTO              YES, DON'T POST AGAIN                10620002
         STM   ERREG3,ERREG5,EWAIAREA   SAVE REGS 0-15                  10670002
GET      SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(LOCAL,IGE0504A(X10720002
               REL))               GET LOCAL LOCK                       10770002
         TM    DECSDECB(DECBRG),X'80'  DECB WAITING?        L5 @ZA02844 10820000
         BO    REL                     YES,DONT POST        L5 @ZA02844 10870000
         L     ERREG4,EWAIAREA+L44   GET BFR ADDRESS        L5 @ZA02844 10880000
         L     IOBRG,0(ERREG4)         SET NXT BFR ADDR     L5 @ZA02844 10920000
         LA    IOBRG,0(IOBRG)          CLR HI BYTE          L5 @ZA02844 10970000
         O     IOBRG,POSTCODE      INSERT COMP CODE                     11070002
         LA    ERRLNK,L1           GET A ONE                            11170002
         SLL   ERRLNK,L31          MOVE TO SIGN POSITION                11220002
         OR    ERREG4,ERRLNK       POST WITH ECB                        11270002
         SR    ERRLNK,ERRLNK       MEMORY RELATED POST                  11320002
         L     NAMEREG,IOSSRB      POINT TO SRB                         11370002
         USING SRB,NAMEREG                                              11420002
         L     NAMEREG,SRBASCB     POINT TO ASCB                        11470002
         DROP  NAMEREG                                                  11520002
         L     ERREG5,CVTPTR       POINT TO CVT                         11570002
         USING CVTMAP,ERREG5                                            11620002
         L     ERREG5,CVT0PT01     ADDRESS OF BRANCH ENTRY              11670002
         DROP  ERREG5                                                   11720002
         BALR  ERRETR,ERREG5       LINK TO POST BUFFER                  11770002
REL      SETLOCK RELEASE,TYPE=LOCAL,RELATED=(LOCAL,IGE0504A(GET))       11820002
*                                  GET RID OF LOCAL LOCK                11870002
         LM    ERREG3,ERREG5,EWAIAREA   RESTORE REGS 0-15               11920002
ERRWTO   EQU   *                                                        11970002
         OI    IOSFLB,IOSLOG       INDICATE OBR REQUIRED    L5 @ZA03591 12020000
         MVI   EWAIND1,EWAIWTOL    TELL 904B TO GO TO IOS WTO  YM05652K 12120002
         L     NAMEREG,TRANSRTN    NAME OF TRANSLATE RTN       YM02594K 12170002
XCTLOUT  EQU   *                                                        12220002
         L     ERRETR,CVTPTR       POINT TO CVT                         12270002
         USING CVTMAP,ERRETR                                            12320002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                12370002
         CLI   DECERRST(DECBRG),SNO     SHOULD NOT OCCUR       @ZA10051 12377000
         BNER  ERRETR              NO, GO TO XCTL              @ZA10051 12384000
         TM    IOBSENS0,LDORDC     LOST DATA OR DATA CHECK     @ZA10051 12391000
         BZR   ERRETR              NO, GO TO XCTL              @ZA10051 12398000
         NI    IOSFLA,L255-IOSERR TURN OFF ERP IN CNTL IN IOSB @ZA10051 12405000
         NI    IOBFLAG1,L255-IOBERRTN    ALSO IN IOB           @ZA10051 12412000
         DROP  ERRETR                                                   12420002
         BR    ERRETR              XCTL                                 12470002
ERRPST04 CLI   IOBWARK+L3,ADAPT2   THIS A 1030                          12520002
         BE    ERRPST01            YES REDUCE MOVE COUNT                12570002
         B     ERRPST02            NO MOVE COUNT CORRECT                12620002
ERRPST5  MVC   IOBWARK+L3(L1),UCBTYP+L3(UCBREG)   ADAPTER TYPE BYTE     12670002
         NI    IOBWARK+L3,MASK3   CLEAR UNWANTED BITS                   12720002
         CLI   IOBWARK+L3,ADAPT4   CHECK FOR TELEGRAPH ADAPTER -        12770002
*                                 TYPE I                                12820002
         BNE   ERRPST52           NO ALL ERRORS VALID                   12870002
         CLI   IOBCSW+L3,CSWCDEE   CHECK FOR CHANNEL END - DEVICE       12920002
*                                  END - UNIT EXCEPTION STATUS          12970002
         BNE   ERRPST4             NO INDICATE FAILURE                  13020002
ERRPST51 TM    IOBCSW+L4,FOXFOX    ANY OTHER ERRORS                     13070002
         BNZ   ERRPST4             INDICATE DIAG W/R FAILED             13120002
         B     ERRPST41            NORMAL COMPLETION                    13170002
ERRPST52 TM    L4(CCWREG),CHAINCDE   THIS COMMAND CHAINED               13220002
         BO    ERRPST4             INDICATE FAILURE                     13270002
         TM    IOBCSW+L3,CSWCDE    CHAN AND DEV END                     13320002
         BC    12,ERRPST4          INDICATE FAILURE                     13370002
         TM    IOBCSW+L3,L255-CSWCDE   ANY ERRORS                       13420002
         BZ    ERRPST51            NO ERRORS CHECK FURTHER              13470002
ERRPST4  OI    DECERRST(DECBRG),ERRDIAG   INDICATE DIAG W/R FAILED      13520002
ERRPST41 MVC   IOBSENS1(L1),IOBSENS0   SAVE DIAGNOSTIC                  13570002
*                                  WRITE/READ SENSE BYTE IN SECOND BYTE 13620002
         MVI   IOBSENS0,ZERO       CLEAR FIRST SENSE BYTE               13670002
         TM    IOBCPA+L20,CHAINCDE   ENABLE REQUIRED                    13720002
         BC   12,ERRPST22          NO GO TO WTO AND POST MSG            13770002
         LA    ERREG1,IOBCPA+L24   ADDRESS OF CCW                       13820002
ERRPST42 ST    ERREG1,IOBSTART     LOCATION OF POINTER TO CCW           13870002
RETRY    EQU   *                                                        13970002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 13980002
         L     NAMEREG,TRANSRTN    LOAD NAME                            14020002
         B     XCTLOUT             XCTL                                 14070002
ERRPST3  OI    DECERRST(DECBRG),ERRENB   INDICATE DISABLE FAILED        14120002
         NI    DECERRST(DECBRG),L255-DISABLOK   TURN OFF DISABLE SW     14170002
         LA    ERREG1,IOBCPA+L8    ADDR OF DIAG WRITE CCW               14220002
         B     ERRPST42            EXECUTE DIAG WRITE                   14270002
ERRPST6  CLI   IOBCPA,RSET2848     2848 RESET CHANNEL PROG              14320002
         BE    ERRPST7             YES  BRANCH                          14370002
         NI    IOSFLA,L255-IOSERR TRN OFF ERP IN CNTRL IN IOSB @ZA04855 14380000
         NI    IOBFLAG1,L255-IOBERRTN    ALSO IN IOB           @ZA04855 14390000
         CLI   IOBCSW+L3,CSWCDE    CHAN AND DEVICE END ONLY             14420002
         BE    ERRPST22            YES CONTINUE FLOW                    14470002
         NI    DECERRST(DECBRG),L255-DISABLOK   INCICATE DISABLE FAIL   14520002
         OI    DECERRST(DECBRG),ERRENB   MAKE IT POSITIVE               14570002
         B     ERRPST22            POST OPERATION COMPLETE              14620002
ERRPST7  CLI   ZERO(CCWREG),CCWBREAK   INTERRUPT CAUSED BY BRK CCW      14670002
         BNE   ERRPST71            NO  CAUSED BY READ SKIP              14720002
         MVC   IOBSENS0(L1),IOBERINF+L8   RESTORE SENSE                 14770002
         MVC   IOBCSW(L7),IOBERINF+L9   RESTORE CSW                     14820002
         MVC   IOBCPA(L16),IOBERCCW                                     14920002
         L     ERREG4,DECENTRY(DECBRG)   ADDR OF TERM ID/POLL CHARS     14970002
         B     ERRPST02            POST WITH ERROR                      15020002
ERRPST71 MVC   IOBSTART+L1(L3),IOBCSW   SET FOR RESTART                 15070002
         B     RETRY               EXIT CODE                            15170002
         EJECT                                                          15220002
**********                                                              15270002
*                                                                       15320002
*        EXECUTED INSTRUCTIONS                                          15370002
*                                                                       15420002
**********                                                              15470002
ERRMOVE  EQU   *                                                        15520002
         MVC   IOBRSTRB+L1(ZERO),ZERO(ERREG4)   MOVE RESTART ADDR       15570002
**********                                                              15620002
*                                                                       15670002
*        CONSTANTS                                                      15720002
*                                                                       15770002
**********                                                              15820002
TRANSRTN DC    F'9042'             BTAM TRANSLATE ROUTINE NAME          15870002
POSTCODE DC    X'41000000'                                              15920002
MASKDB   DC    X'00FFFFFC'                                              15970002
ERRCN4   DC    H'4'                                                     16020002
ERRCN8   DC    H'8'                                                     16070002
PACHAREA DC    21C'0000'           PATCH AREA FOR MAINTENANCE           16120000
**********                                                              16170002
*                                                                       16220002
*        MISCELLANEOUS EQUATES                                          16270002
*                                                                       16320002
**********                                                              16370002
DCBIOBSZ EQU   X'24'               IOB SIZE IN DCB                      16420002
CCWBREAK EQU   X'41'                                                    16470002
RSET2848 EQU   X'42'                                                    16520002
ADAPT2   EQU   X'20'                                                    16570002
DCBBFTEK EQU   X'20'                                                    16620002
LASTCCW  EQU   X'80'               FLAG FOR LAST CCW           @ZA07659 16640000
ADAPT4   EQU   X'40'                                                    16670002
SNO      EQU   X'20'           SHOULD NOT OCCUR BIT            @ZA10051 16680000
LDORDC   EQU   X'0A'       LOST DATA OR DATA CHECK             @ZA10051 16690000
DECTYPE  EQU   4                                                        16720002
DECADRPT EQU   32                                                       16770002
DECPOLPT EQU   36                                                       16820002
READ     EQU   X'01'                                                    16870002
APOLL    EQU   X'40'                                                    16920002
ADAPT5   EQU   X'50'                                                    16970002
ADAPT8   EQU   X'80'                                                    17020002
CHAINCDE EQU   X'60'                                                    17070002
CSWCDE   EQU   X'0C'               CHANNEL AND DEVICE END               17120002
CSWCDEE  EQU   X'0D'                                                    17170002
DECENTRY EQU   X'14'                                                    17220002
DECSDECB EQU   0                                            L5 @ZA02844 17230000
DECERRST EQU   X'1D'                                                    17270002
DISABLOK EQU   X'08'                                                    17320002
ERRDIAG  EQU   X'10'                                                    17370002
ERRENB   EQU   X'20'                                                    17420002
EXCPER   EQU   15                  EXCP ERROR ROUTINE                   17470002
L255     EQU   255                 AND MASK                             17520002
FOXFOX   EQU   X'FF'                                                    17570002
X09      EQU   X'09'                                                    17620002
X03      EQU   X'03'                                                    17670002
X40      EQU   X'40'                                                    17720002
X21      EQU   X'21'                                                    17770002
X08      EQU   X'08'                                                    17820002
X30      EQU   X'30'                                                    17870002
X11      EQU   X'11'                                                    17920002
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              17970002
L1       EQU   1                   LENGTH AND DISPLACEMENT              18020002
L2       EQU   2                   LENGTH AND DISPLACEMENT              18070002
L3       EQU   3                   LENGTH AND DISPLACEMENT              18120002
L4       EQU   4                   LENGTH AND DISPLACEMENT              18170002
L5       EQU   5                   LENGTH AND DISPLACEMENT              18220002
L6       EQU   6                   LENGTH AND DISPLACEMENT              18270002
L7       EQU   7                   LENGTH AND DISPLACEMENT              18320002
L8       EQU   8                   LENGTH AND DISPLACEMENT              18370002
L9       EQU   9                   LENGTH AND DISPLACEMENT              18420002
L13      EQU   13                  LENGTH AND DISPLACEMENT              18470002
L16      EQU   16                  LENGTH AND DISPLACEMENT              18520002
L20      EQU   20                  LENGTH AND DISPLACEMENT              18570002
L24      EQU   24                  LENGTH AND DISPLACEMENT              18620002
L31      EQU   31                  LENGTH AND DISPLACEMENT              18670002
L44      EQU   44                  LENGTH AND DISPLACEMENT              18720002
MASK2    EQU   X'0F'                                                    18770002
MASK3    EQU   X'F0'                                                    18820002
MODTYP40 EQU   X'04'                                                    18870002
STACTRL  EQU   X'08'                                                    18920002
SWLINE   EQU   X'90'                                                    18970002
UCBTYP   EQU   16                  DEVICE TYPE CODE                     19020002
**********                                                              19070002
*                                                                       19120002
*        REGISTER DEFINITION                                            19170002
*                                                                       19220002
**********                                                              19270002
ERREG3   EQU   0                   WORK REG                             19320002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              19370002
ERREG2   EQU   2                   WORK REG                             19420002
EWAREG   EQU   3                   ERP WORKAREA BASE                    19470002
CCWREG   EQU   4                   CCW ADDRESS REG                      19520002
DECBRG   EQU   5                   DECB BASE                            19570002
DCBREG   EQU   6                   DCB BASE                             19620002
UCBREG   EQU   7                   UCB BASE                             19670002
BASEREG  EQU   8                   PROGRAM BASE                         19720002
ERREG1   EQU   9                   WORK REG                             19770002
IOBRG    EQU   10                  IOB BASE/PARAMETER REG               19820002
ERREG4   EQU   11                  WORK REG/PARAMETER REG               19870002
ERRLNK   EQU   12                  LINK REG                             19920002
NAMEREG  EQU   13                  LINK REG                             19970002
ERRETR   EQU   14                  RETURN REG                           20020002
ERREG5   EQU   15                  LINK REG                             20070002
         EJECT                                                          20120002
         IHAPSA                                                         20170002
         EJECT                                                          20220002
         IECDRQE                                                        20270002
         EJECT                                                          20320002
         IEZIOB                                                         20370002
IOBWARK  EQU   IOBWORK+3                                       YM05652K 20380002
         EJECT                                                          20420002
CVT      DSECT                                                          20470002
         CVT                                                            20520002
         EJECT                                                          20570002
         IECDERWA                                                       20620002
**********                                                              20670002
*                                                                       20720002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        20770002
*                                                                       20820002
**********                                                              20870002
         ORG   EWAIERP                                                  20920002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 20970002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 21020002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 21070002
EWAIND0  DS    B                   FLAG BYTE                            21120002
EWAIVISR EQU   X'10'               V=R REQUEST                          21720002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 21770002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 21820002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 21870002
EWAIND1  DS    B                   FLAG BYTE                            21920002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 21970002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 22020002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 22070002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 22080002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 22090002
EWAIND2  DS    B                   FLAG BYTE                            22120002
EWAIND3  DS    B                   FLAG BYTE                            22170002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     22220002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  22270002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 22320002
*********  END OF BTAM LOCAL DEFINITIONS **********                     22370002
         EJECT                                                          22420002
         IHASRB                                                         22470002
         EJECT                                                          22520002
         IECDIOSB                                                       22570002
         END                                                            22620002
./  ADD  SSI=40240903,NAME=IGE0504B
         TITLE 'IGE0504B - BTAM ERR OVERRUN MODULE'                     00550002
IGE0504B CSECT                                                          00600002
*********************************************************************** 00650002
*                                                                     * 00700002
* MODULE NAME:                                                        * 00750002
*    IGE0504B                                                         * 00800002
*                                                                     * 00850002
* DESCRIPTIVE NAME:                                                   * 00900002
*    BTAM ERROR OVERRUN ERP                                           * 00950002
*                                                                     * 01000002
* COPYRIGHT:                                                          * 01050002
*    NONE                                                             * 01100002
*                                                                     * 01150002
* STATUS:                                                             * 01200002
*    CHANGE LEVEL 000                                                 * 01250002
*                                                                     * 01300002
* FUNCTION:                                                           * 01350002
*    THIS MODULE IS ENTERED IF AN OVERRUN ERROR HAS OCCURRED. A READ  * 01400002
*    REPEAT CHANNEL PROGRAM IS GENERATED AND EXECUTED IF REQUIRED.    * 01450002
*                                                                     * 01500002
* NOTES:                                                              * 01550002
*    DEPENDENCIES:                                                    * 01600002
*        NONE                                                         * 01650002
*    RESTRICTIONS:                                                    * 01700002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01750002
*    REGISTER CONVENTIONS:                                            * 01800002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01850002
*                                                                     * 01900002
* PATCHLABEL:                                                         * 01950002
*    PACHAREA (40 BYTES)                                              * 02000002
*                                                                     * 02050002
* MODULE TYPE:                                                        * 02100002
*    PROCEDURE                                                        * 02150002
*    PROCESSOR:                                                       * 02200002
*        BAL                                                          * 02250002
*    MODULE SIZE:                                                     * 02300002
*        388 BYTES                                                    * 02350002
*    ATTRIBUTES:                                                      * 02400002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02450002
*                                                                     * 02500002
* ENTRY POINT:                                                        * 02550002
*    IGE0504B                                                         * 02600002
*    PURPOSE:                                                         * 02650002
*        SEE 'FUNCTION'                                               * 02700002
*    LINKAGE:                                                         * 02750002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02800002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02850002
*    INPUT:                                                           * 02900002
*        REG 1 = ADDRESS OF IOSB                                      * 02950002
*    OUTPUT:                                                          * 03000002
*        SET DECERRST FOR SHOULD NOT OCCUR ERROR.                     * 03050002
*        ALTERED CHANNEL PROGRAM.                                     * 03100002
*                                                                     * 03150002
* EXITS-NORMAL:                                                       * 03200002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03300002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03350002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03400002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03450002
*        LOADS ARE 1000 GREATER.                                      * 03500002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03550002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03600002
*                                                                     * 03650002
* EXITS-ERROR:                                                        * 03700002
*    NONE                                                             * 03750002
*                                                                     * 03800002
* EXTERNAL REFERENCES:                                                * 03850002
*    ROUTINES:                                                        * 03900002
*        READ                                                         * 03950002
*    DATA AREAS                                                       * 04100002
*        IOB (MAPPED BY IEZIOB)                                       * 04150002
*        VIRTUAL CHANNEL PROGRAM                                      * 04200002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04250002
*    CONTROL BLOCKS                                                   * 04300002
*        UCB                                                          * 04350002
*        DCB                                                          * 04400002
*        DECB                                                         * 04450002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04500002
*        CVT          (MAPPED BY CVT)                                 * 04550002
*        IOB          (MAPPED BY IEZIOB)                              * 04600002
*        RQE          (MAPPED BY IECDRQE)                             * 04650002
*                                                                     * 04800002
* TABLES-WORKAREAS:                                                   * 04850002
*    ERP WORKAREA                                                     * 04900002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04950002
*                                                                     * 05000002
* MACROS:                                                             * 05050002
*    READ                                                             * 05100002
*                                                                     * 05150002
* CHANGE ACTIVITY:                                                    * 05200002
*    YM02595K (9/20/73)                                               * 05250002
*    YM02594K (9/24/73)                                               * 05260002
*    YM05652K (1/25/74)                                               * 05270002
*                                                                     * 05300002
*********************************************************************** 05350002
         EJECT                                                          05400002
         USING *,BASEREG                                                05450002
         LR    BASEREG,ERREG5      SET BASE REG                         05500002
         USING RQE,ERREG5                                               05550002
         USING IOSB,IOSBREG                                             05600002
         USING IOBSTDRD,IOBRG                                           05650002
         USING EWA,EWAREG                                               05700002
         L     ERREG5,IOSUSE       BASE RQE                             05750002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05800002
         L     IOBRG,RQEIOB        BASE IOB                             05850002
         L     DECBRG,IOBECBPT     BASE DECB                            05900002
         L     DCBREG,IOBDCBPT     BASE DCB                             05950002
         L     UCBREG,IOSUCB       BASE UCB                             06000002
         DROP  ERREG5                                                   06050002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       06100002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06150002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                06200002
         MVC   IOBWORK(L1),DECTYPE+L1(DECBRG)   PICK UP DEV TYPE        06250002
         NI    IOBWORK,L255-HIBIT   CLEAR UNUSED BITS                   06300002
         MVC   IOBWORK+L1(L1),TPCODE(CCWREG)   PICK UP TP OP CODE       06350002
         NI    IOBWORK+L1,L255-HIBIT   CLEAR UNUSED BITS                06400002
         MVC   IOBWORK+L2(L1),UCBTYP+L3(UCBREG)   PICK UP ADAPTER       06450002
         NI    IOBWORK+L2,MASK15   MASK UNUSED BITS                     06500002
         TM    IOBSENS0,IOBSNOVR   THIS OVERRUN                         06550002
         BZ    ERRBOSNO            NO INDICATE SHOULD NOT OCCUR         06600002
         CLI   ZERO(CCWREG),CCWAPOLL   THIS A POLL COMMAND              06650002
         BNE   ERROVR00            NO CHECK FURTHER                     06700002
         CLI   IOBWORK+L2,CTRL2702                                      06750002
         BNE   ERRBOSNO            NO SET SHOULD NOT OCCUR              06800002
ERROVR06 LA    ERREG2,IOBCPA       START OF CHAN PROG                   06850002
         ST    ERREG2,IOBSTART     STORE POINTER                        06900002
         L     ERREG1,IOBCPA+L8    LOAD ENTRY ADDRESS FROM PREVIOUS     07050002
*                                  POLL (WITH POLL COMMAND IN           07100002
*                                  HIGH ORDER BYTE)                     07150002
         MVC   IOBCPA+L9(L3),DECENTRY+L1(DECBRG)   MOVE IN ADDRESS      07200002
*                                  OF LAST ENTRY POLLED (TO BE USED     07250002
*                                  AS RESTART ADDRESS)                  07300002
         L     ERREG4,IOBCPA+L8    LOAD ENTRY ADDRESS FOR NEXT POLL     07350002
*                                  (WITH POLL COMMAND IN HIGH           07400002
*                                  ORDER BYTE)                          07450002
         SR    ERREG1,ERREG4       SUBTRACT NEW POLL ADDRESS            07500002
*                                  FROM PREVIOUS POLL ADDRESS.          07550002
         AH    ERREG1,IOBCPA+L14   IF THE NEW POLL ADDRESS WERE LESS    07600002
*                                  THAN THE PREVIOUS POLL ADDRESS, THE  07650002
*                                  EFFECT IS TO ADD THE ABSOLUTE        07700002
*                                  DIFFERENCE TO THE PREVIOUS COUNT.    07750002
*                                  IF IT WERE GREATER, THE EFFECT IS    07800002
*                                  TO SUBTRACT.                         07850002
         STH   ERREG1,IOBCPA+L14   STORE ADJUSTED COUNT IN POLL COMMAND 07900002
         B     ERROVR01            CHECK FOR RETRIES                    08000002
ERROVR00 EQU   *                                                        08050002
         CLI   ZERO(CCWREG),CCWRDCMD   THIS A READ COMMAND              08100002
         BNE   ERROVR04            NO CHECK FOR INHIBIT COMMAND         08150002
         CLI   IOBWORK+L1,CCWRDIX   READ RESP TO INDEX                  08200002
         BE    ERROVR06            YES SET UP TO REPOLL                 08250002
         CLI   IOBWORK+L1,CCWRRTXT   THIS READ RESPONSE TO TEXT         08300002
         BE    ERROVR02            YES REPEAT COMMAND                   08350002
         TM    DCBBFTEK(DCBREG),X08   IS DYN BUFFERING SPECIFIED        08400002
         BO    ERRBOC11            YES, NO RETRIES                      08450002
ERROVR05 TM    DCBERROP(DCBREG),DCBRDTRY   READ RETRIES REQUIRED        08500002
         BZ    ERRBOC11            NO POST WITH ERROR                   08550002
         CLI   IOBWORK,DECRDRPT    CHAN PROG READ REPEAT                08600002
         BNE   ERROVR03            NO CREATE READ REPEAT CHAN PROG      08650002
ERROVR01 CLI   IOBERRCT,ERTRYCT    RETRY REQUIRED                       08700002
         BNL   ERRCHK1             NO CHECK FOR DISABLE                 08750002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  08800002
         LA    ERREG1,L1(ERREG1)   BUMP COUNT BY ONE                    08850002
         STC   ERREG1,IOBERRCT     STORE NEW COUNT                      08900002
         OC    EWASTUP(L1),IOBSENS0   SET FOR STAT UPDATE               08950002
         MVI   IOBSENS0,ZERO       CLEAR OUT SENSE                      09000002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 09050002
         L     NAMEREG,TRANSRTN    LOAD NAME                            10700002
         B     ERRLINK1            XCTL                                 10750002
ERROVR02 ST    CCWREG,IOBSTART     CPA POINTER TO FAILING CCW           13850002
         B     ERROVR01            CHECK FOR RETRIES                    14450002
ERROVR03 NI    DECTYPE+L1(DECBRG),HIBIT   CLEAR OUT OPERATION TYPE      14500002
         OI    DECTYPE+L1(DECBRG),DECRDRPT   INDICATE READ REPEAT       14550002
         OI    IOBINCAM,X08        SET ERP FOR R/W                      14600002
         LR    ERREG4,IOSBREG      SAVE IOSB POINTER                    14650002
         LA    NAMEREG,EWAIAREA-L12   REGISTER SAVE AREA                14700002
         LR    IOSBREG,DECBRG      INITIALIZE PARAMETER REG             14750002
         READ  (1),T,MF=E          GENERATE READ REPEAT CHAN PROG       14800002
         LR    IOSBREG,ERREG4      RESTORE IOSB POINTER                 14850002
         NI    IOBINCAM,XF7        TURN OFF ERP FLAG                    14950002
         B     ERROVR01            SET UP TO EXECUTE CHAN PROGRAM       15000002
ERROVR04 CLI   ZERO(CCWREG),CCWINHCD   THIS AN INHIBIT COMMAND          15050002
         BE    ERROVR05            YES CHECK FOR READ REPEAT REQ        15100002
ERRBOSNO OI    DECERRST(DECBRG),CSWSNO   SET SHOULD NOT OCCUR ERROR     15150002
ERRBOC11 OI    IOSFLB,IOSLOG       INDICATE OBR RECORDING               15200002
ERRBOC00 LH    NAMEREG,ERLOD5      NAME OF POST ROUTINE                 15250002
         NI    IOSFLA,L255-IOSERR   INDICATE ERROR POST                 15300002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     15310002
ERRLINK1 EQU   *                                                        15350002
         L     ERRETR,CVTPTR       POINT TO CVT                         15400002
         USING CVTMAP,ERRETR                                            15450002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                15500002
         DROP  ERRETR                                                   15550002
         BR    ERRETR              XCTL                                 15600002
ERRCHK1  OI    IOSFLB,IOSLOG       INDICATE LOG OUT REQUIRED            15650002
         TM    UCBTYP+L1(UCBREG),SWLINE   DISABLE REQUIRED              15700002
         BZ    ERRBOC00            NO POST ERROR                        15750002
         MVI   IOBERRCT+L1,MASK15   SPECIAL ENTRY TO DISABLE ROUTINE    15800002
         L     NAMEREG,ERLOD9      NAME OF DISABLE ROUTINE              15850002
         B     ERRLINK1            EXIT ROUTINE                         15900002
         EJECT                                                          15950002
**********                                                              16000002
*                                                                       16050002
*        CONSTANTS                                                      16100002
*                                                                       16150002
**********                                                              16200002
ERLOD9   DC    F'9041'                                                  16210002
TRANSRTN DC    F'9042'             BTAM TRANSLATE ROUTINE NAME          16220002
ERRCN8   DC    H'8'                DECIMAL 8                            16250002
ERLOD5   DC    H'5041'                                                  16300002
PACHAREA DC    10C'504B'           PATCH AREA FOR MAINTENANCE           16500002
**********                                                              16550002
*                                                                       16600002
*        MISCELLANEOUS EQUATES                                          16650002
*                                                                       16700002
**********                                                              16750002
CCWAPOLL EQU   X'09'                                                    16950002
CCWRDIX  EQU   X'0A'                                                    17000002
CTRL2702 EQU   X'01'                                                    17050002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              17100002
L1       EQU   1                   LENGTH AND DISPLACEMENT              17150002
L2       EQU   2                   LENGTH AND DISPLACEMENT              17200002
L3       EQU   3                   LENGTH AND DISPLACEMENT              17250002
L4       EQU   4                   LENGTH AND DISPLACEMENT              17260002
L5       EQU   5                   LENGTH AND DISPLACEMENT              17262002
L6       EQU   6                   LENGTH AND DISPLACEMENT              17270002
L8       EQU   8                   LENGTH AND DISPLACEMENT              17300002
L9       EQU   9                   LENGTH AND DISPLACEMENT              17350002
L12      EQU   12                  LENGTH AND DISPLACEMENT              17400002
L14      EQU   14                  LENGTH AND DISPLACEMENT              17450002
X08      EQU   X'08'                                                    17500002
XF7      EQU   X'F7'                                                    17550002
ERTRYCT  EQU   X'02'                                                    17600002
DECRDRPT EQU   X'07'                                                    17650002
DCBRDTRY EQU   X'02'                                                    17700002
DCBERROP EQU   33                                                       17750002
CCWRRTXT EQU   X'20'                                                    17800002
HIBIT    EQU   X'C0'                                                    17850002
L255     EQU   X'FF'               AND MASK                             17900002
DECTYPE  EQU   4                                                        17950002
TPCODE   EQU   5                                                        18000002
DCBBFTEK EQU   X'20'                                                    18050002
MASK15   EQU   X'0F'                                                    18100002
DECERRST EQU   29                                                       18150002
UCBTYP   EQU   16                                                       18250002
SWLINE   EQU   X'90'                                                    18300002
IOBSNOVR EQU   X'04'                                                    18350002
DECENTRY EQU   20                                                       18400002
CCWRDCMD EQU   X'02'                                                    18450002
CSWSNO   EQU   X'40'                                                    18500002
CCWINHCD EQU   X'0A'                                                    18550002
**********                                                              18600002
*                                                                       18650002
*        REGISTER DEFINITION                                            18700002
*                                                                       18750002
**********                                                              18800002
ERREG3   EQU   0                   WORK REG                             18850002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              18900002
ERREG2   EQU   2                   WORK REG                             18950002
EWAREG   EQU   3                   ERP WORKAREA BASE                    19000002
CCWREG   EQU   4                   CCW ADDRESS REG                      19050002
DECBRG   EQU   5                   DECB BASE                            19100002
DCBREG   EQU   6                   DCB BASE                             19150002
UCBREG   EQU   7                   UCB BASE                             19200002
BASEREG  EQU   8                   PROGRAM BASE                         19250002
ERREG1   EQU   9                   WORK REG                             19300002
IOBRG    EQU   10                  IOB BASE                             19350002
ERREG4   EQU   11                  WORK REG                             19400002
ERRLNK   EQU   12                  LINK REG                             19450002
NAMEREG  EQU   13                  LINK REG                             19500002
ERRETR   EQU   14                  RETURN REG                           19550002
ERREG5   EQU   15                  LINK REG/WORK REG                    19600002
         EJECT                                                          19750002
         IECDRQE                                                        19800002
         EJECT                                                          19850002
         IEZIOB                                                         19900002
         EJECT                                                          19950002
CVT      DSECT                                                          20000002
         CVT                                                            20050002
         EJECT                                                          20100002
         IECDERWA                                                       20150002
**********                                                              20200002
*                                                                       20250002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        20300002
*                                                                       20350002
**********                                                              20400002
         ORG   EWAIERP                                                  20450002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 20500002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 20550002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 20600002
EWAIND0  DS    B                   FLAG BYTE                            20650002
EWAIVISR EQU   X'10'               V=R REQUEST                          21250002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 21300002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 21350002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 21400002
EWAIND1  DS    B                   FLAG BYTE                            21450002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 21500002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 21550002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 21600002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 21610002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 21620002
EWAIND2  DS    B                   FLAG BYTE                            21650002
EWAIND3  DS    B                   FLAG BYTE                            21700002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     21750002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  21800002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 21850002
*********  END OF BTAM LOCAL DEFINITIONS **********                     21900002
         EJECT                                                          22650002
         IECDIOSB                                                       22700002
         END                                                            22750002
./  ADD  SSI=81910066,NAME=IGE0504C
         TITLE 'IGE0504C - BSC ERP SPECIAL RETURN MODULE'               00100002
IGE0504C CSECT                                                          00150002
*********************************************************************** 00200002
*                                                                     * 00250002
* MODULE NAME:                                                        * 00300002
*    IGE0504C                                                         * 00350002
*                                                                     * 00400002
* DESCRIPTIVE NAME:                                                   * 00450002
*    BTAM BSC SPECIAL RETURN ERP                                      * 00500002
*                                                                     * 00550002
* COPYRIGHT:                                                          * 00600002
*    NONE                                                             * 00650002
*                                                                     * 00700002
* STATUS:                                                             * 00750002
*    CHANGE LEVEL 000                                                 * 00800002
*                                                                     * 00850002
* FUNCTION:                                                           * 00900002
*    THIS ROUTINE CHECKS THE RESULTS OF SPECIAL I/O OPERATIONS        * 00950002
*    INITIATED BY THE OTHER BSC ERP ROUTINES. IF THE RESULT IS THE    * 01000002
*    DESIRED ONE, THE CHANNEL PROGRAM IS RESTARTED AT THE POINT       * 01050002
*    INDICATED BY THE INITIATING ERP. THE FOLLOWING TABLE INDICATES   * 01100002
*    THE INITIATED OPERATION AND RESPONSE ACTION:                     * 01150002
*                    VALUE  OP CODE  ACTION                           * 01200002
*                    X'80'    11     IF ENQ RECEIVED- (MULTIPT LINE)  * 01250002
*                                      RESEND ACK AND TIC TO FAIL CCW * 01300002
*                                    IF ENQ RECEIVED- (NON-MULTIPOINT)* 01350002
*                                      RESTART FAILING CCW            * 01400002
*                                    IF ENQ WAS NOT RECEIVED-         * 01450002
*                                      RESTART CHAN PROG AT BEGINNING * 01500002
*                   X'81'     11     IF ENQ WAS RECEIVED-             * 01550002
*                                      WRITE NAK AND TIC TO FAIL CCW  * 01600002
*                                    IF ENQ WAS NOT RECEIVED-         * 01650002
*                                      RESTART CHAN PROG AT BEGINNING * 01700002
*                   X'82'     11     WRITE NAK AND TIC TO FAILING CCW * 01750002
*                   X'83'   07 OR 25 WRITE ENQ AND TIC TO FAILING CCW * 01800002
*                   X'84'   03 OR 0C RESTART FAILING CCW OR CHECK FOR * 01850002
*                                      CONTENTION                     * 01900002
*                   X'85'            NOT USED                         * 01950002
*                   X'86'     25     RESTART AT WRITE TEXT, RESTART   * 02000002
*                                      ERP CHANNEL PROG OR RETURN TO  * 02050002
*                                      SUPERVISOR                     * 02100002
*                   X'87'     21     IF ENQ WAS RECEIVED-             * 02150002
*                                      RESTART AT FAILING CCW         * 02200002
*                                    IF ENQ WAS NOT RECEIVED-         * 02250002
*                                      RESTART AT FOLLOWING CCW IF    * 02300002
*                                      FAILING CCW IS NOT LAST CCW    * 02350002
*                                      IF FAILING CCW IS LAST CCW,    * 02400002
*                                      RESTART AT FAILING CCW.        * 02450002
*                   X'88'   09 OR 11 RESTART AT FAILING CCW.          * 02500002
*                   X'89'     11     IF FIRST TWO CHARACTERS ARE STX  * 02550002
*                                      ENQ, RESTART AT FAILING CCW.   * 02600002
*                   X'8A'            EXECUTE A READ SKIP CCW THEN     * 02650002
*                                      RESTORE ORIGINAL COMMAND.      * 02700002
*                   X'8B'     11     IF ENQ WAS RECEIVED, WRITE NAK   * 02750002
*                                      AND TIC TO THE READ CCW; OTHER-* 02800002
*                                      WISE, POST WITH ERROR.         * 02850002
*                   X'8C'    07      CLEAR SPECIAL RETURN INDICATORS  * 02900002
*                                      AND PROCESS WITH ERROR POSTING * 02950002
*                   X'8D'            GARBLED SYN CHARACTERS IN FRONT  * 02960000
*                                    OF AN EOT                        * 02970000
*                                                                     * 03000002
* NOTES:                                                              * 03050002
*    DEPENDENCIES:                                                    * 03100002
*        NONE                                                         * 03150002
*    RESTRICTIONS:                                                    * 03200002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 03250002
*    REGISTER CONVENTIONS:                                            * 03300002
*        SEE 'REGISTER DEFINITION' BELOW                              * 03350002
*                                                                     * 03400002
* PATCHLABEL:                                                         * 03450002
*    PACHAREA (120 BYTES)                                             * 03500002
*                                                                     * 03550002
* MODULE TYPE:                                                        * 03600002
*    PROCEDURE                                                        * 03650002
*    PROCESSOR:                                                       * 03700002
*        BAL                                                          * 03750002
*    ATTRIBUTES:                                                      * 03900002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 03950002
*                                                                     * 04000002
* ENTRY POINT:                                                        * 04050002
*    IGE0504C                                                         * 04100002
*    PURPOSE:                                                         * 04150002
*        SEE 'FUNCTION'                                               * 04200002
*    LINKAGE:                                                         * 04250002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 04300002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 04350002
*    INPUT:                                                           * 04400002
*        REG 1 = ADDRESS OF IOSB                                      * 04450002
*    OUTPUT:                                                          * 04500002
*        SETS INDICATOR IN DECERRST FOR PERMANENT ERRORS              * 04550002
*        ALTERED CHANNEL PROGRAM                                      * 04600002
*                                                                     * 04608000
*        X'9F' IN IOBWORK+1 INDICATES A SPECIAL RESTART OF THE        * 04616000
*              CHANNEL PROGRAM WHICH CAUSES 19MB TO PASS CONTROL      * 04624000
*              TO IOS. IOS WILL RESTART THE CHANNEL PROGRAM AS IF     * 04632000
*              IT WERE A SVC "0"                                      * 04640000
*                                                                     * 04650002
* EXITS-NORMAL:                                                       * 04700002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 04800002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004C.       * 04850000
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 04900002
*        LOAD.                                                        * 04950000
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 05050002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 05100002
*                                                                     * 05150002
* EXITS-ERROR:                                                        * 05200002
*    NONE                                                             * 05250002
*                                                                     * 05300002
* EXTERNAL REFERENCES:                                                * 05350002
*    ROUTINES:                                                        * 05400002
*        NONE                                                         * 05450002
*    DATA AREAS                                                       * 05550002
*        IOB (MAPPED BY IEZIOB)                                       * 05600002
*        VIRTUAL CHANNEL PROGRAM                                      * 05650002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 05700002
*    CONTROL BLOCKS                                                   * 05750002
*        UCB                                                          * 05800002
*        DCB                                                          * 05850002
*        DECB                                                         * 05900002
*        IOSB         (MAPPED BY IECDIOSB)                            * 05950002
*        CVT          (MAPPED BY CVT)                                 * 06000002
*        IOB          (MAPPED BY IEZIOB)                              * 06050002
*        RQE          (MAPPED BY IECDRQE)                             * 06100002
*                                                                     * 06150002
* TABLES-WORKAREAS:                                                   * 06200002
*    ERP WORKAREA                                                     * 06250002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 06300002
*                                                                     * 06350002
* MACROS:                                                             * 06400002
*    NONE                                                             * 06450002
*                                                                     * 06500002
* CHANGE ACTIVITY:                                                    * 06550002
*    YM02595K (9/20/73)                                               * 06600002
*    YM02594K (9/24/73)                                               * 06650002
*    YA02438  (11/1/73)                                               * 06660002
*    YA02439  (11/1/73)                                               * 06670002
*    YA02440  (11/1/73)                                               * 06680002
*    YM05652K (1/25/74)                                               * 06690002
*    YA03249  (2/15/74)                                               * 06692000
*    YA02308  (11/7/74)                                               * 06694003
*    YA02309  (11/7/74)                                               * 06696003
*    YA02310  (12,6,74)                                               * 06698000
*    ZA02833  (2/21/75)                                               * 06698400
*    AZ03970  (04/22/75)          AZ03971  (04/22/75)                 * 06698900
*    AZ04185  (10/01/75)          AZ04665  (10/01/75)                 * 06700900
*    AZ04679  (10/20/75)          AZ04859  (10/01/75)                 * 06702900
*    AZ04861  (10/01/75)          AZ06381  (10/01/75)                 * 06704900
*    AZ07640  (11/07/75)          AZ07651  (11/12/75)                 * 06706900
*    AZ11037  (05/17/76)          AZ12146  (07/28/76)                 * 06708900
*    AZ12156  (08/04/76)          AZ15426  (12/07/76)                 * 06710900
*    AZ17702  (02/15/77)          AZ20110  (05/12/77)                 * 06712900
*    AZ24635  (09/06/77)          AZ30537  (03/13/78)                 * 06720000
*    AZ31718  (04/12/78)          AZ32428  (05/05/78)                 * 06722000
*    AZ32980  (05/26/78)          AZ33188  (07/05/78)                 * 06724000
*    AZ33188  (07/06/78)                                              * 06732000
*********************************************************************** 06750002
         EJECT                                                          06800002
         USING *,BASEREG                                                06850002
         LR    BASEREG,ERREG5      SET BASE REG                         06860000
         B     BEGIN               BRANCH AROUND ID         LD @ZA02308 06870000
         DC    C'IGE0504C'         MODULE ID                LD @ZA02308 06880000
         DC    C' UZ20070'         PTF NUMBER                  @ZA32980 06890000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY       LD @ZA02308 06940003
BEGIN    DS    0H                                           LD @ZA02308 06942003
         USING RQE,ERREG5                                               06950002
         USING IECTDECB,DECBRG                                          07000002
         USING IHADCB,DCBREG                                            07050002
         USING IOSB,IOSBREG                                             07100002
         USING IOBSTDRD,IOBRG                                           07150002
         USING EWA,EWAREG                                               07200002
         L     ERREG5,IOSUSE       BASE RQE                             07350002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    07400002
         L     IOBRG,RQEIOB        BASE IOB                             07450002
         L     DECBRG,IOBECBPT     BASE DECB                            07500002
         L     DCBREG,IOBDCBPT     BASE DCB                             07550002
         L     UCBREG,IOSUCB       BASE UCB                             07600002
         DROP  ERREG5                                                   07650002
         L     CCWREG,IOBFL3       GET IOB CSW                          07700002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                07750002
         SH    CCWREG,ERRCN8       ADDRESS OF FAILING CCW IN IOB        07800002
         SR    ERREG5,ERREG5       INITIALIZE IC REGISTER               07900002
         LA    ERREG1,FLIPBIT      ACK FLIP BIT                         07950002
         NI    IOBWORK+L1,L255-HIGHBIT0   ZIP UNSED BIT                 08000002
         IC    ERREG5,IOBWORK+L1   PICK UP INDEX FACTOR                 08050002
         TM    IOBSENS0,TOERROR    TIME OUT ERROR OCCUR                 08100002
         BZ    BSCSP00A            NO  CONTINUE                         08150002
         CLI   IOBWORK+L1,X02      RETURN X'82'                 YA03249 08160000
         BE    BSCSP00A            YES                          YA03249 08170000
         TM    IOBERCCW+L4,SKIP    THIS READ SKIP               ZA20110 08200000
         BO    BSCSP00A            YES, CONTINUE                        08250002
         CLI   IOBWORK+L1,UERDSKP   READ SKIP FOR U E                   08300002
         BE    BSCSP00A            YES, CONTINUE NORMAL                 08350002
         CLI   IOBWORK+L1,X04      THIS T.O. ON RD,NOP                  08400002
         BE    BSCSP00A            BRANCH IF YES                        08450002
         CLI   IOBWORK+L1,CODEA    THIS T.O. FOR ERP READ SKIP          08500002
         BE    BSCSP00A            YES, BRANCH                          08550002
         CLI   IOBWORK+L1,X03      L.D. ON RD,NOP                       08600002
         BE    BSCSP00A            YES, BRANCH                          08650002
         TM    IOSSNS,X02          LOST DATA ERROR                      08700002
         BZ    BSCSP073            NO, BRANCH                           08750002
         CLI   IOBWORK+L1,ZERO     L.D. ON RD ENQ                       08800002
         BNE   BSCSP073            NO, BRANCH TO RESTART                08850002
BSCSP00A EQU   *                                                        08900002
         TM    IOBCSW+L3,CSWUE     UNIT EXCEPTION OCCUR                 08950002
         BO    BSCSPX01            YES, CHECK FOR READ SKIP             09000002
BSCSPX02 SLL   ERREG5,L2           MULTIPLY BY FOUR                     09050002
         B     BSCSP00(ERREG5)     BRANCH TO ROUTINE VIA BR TABLE       09100002
BSCSP00  B     BSCSP01             ENTRY FOR RD ENQ,TIC FAIL CCW        09150002
         B     BSCSP021        ENTRY FOR RD ENQ,WRT NAK,TIC LD @ZA02308 09200003
         B     BSCSP02         ENTRY FOR RD SKP,WRT NAK,TIC LD @ZA02308 09250003
         B     BSCSP03             ENTRY FOR RD SKP,WRT ENQ,TIC         09300002
         B     BSCSP04             ENTRY FOR CONTENTION CHECK           09350002
         B     BSCSP06             ENTRY FOR WR ENQ,CHECK RESP          09400002
         B     BSCSP06             ENTRY FOR WRT ENQ BOTH RESP          09450002
         B     BSCSP07A                                                 09500002
         B     BSCSP07                                                  09550002
         B     BSCSP09             ENTRY FOR 2780 ABORT,STX/ENQ         09600002
         B     BSCSP0A                                                  09650002
         B     BSCSP0B             ENTRY FOR WR NAK,TIC,RD TXT          09700002
         B     BSCSP0C             ENTRY FOR T.O. ON W TC ,R TC         09750002
BSCSP0D  EQU   *                                               @ZA04185 09752000
*              THE NEXT LINE IS THE ENTRY FOR INTERNAL CODE    @ZA04185 09754000
*              OF X'8D' FOR GARBLED SYN CHARACTERS IN FRONT    @ZA04185 09756000
*              OF AN EOT.                                      @ZA04185 09758000
         TM    IOBCSW+L3,UNITCK    UNIT CHECK                  @ZA04185 09760000
         BNO   BSCSP063            NO, WE RECOVERED            @ZA04185 09762000
BSCSP0D2 TM    IOBSENS0,IOBTO      TIME OUT SENSE              @ZA04185 09764000
         BNO   BSCSP073            NO, RETRY WRITE NAK         @ZA04185 09766000
*              CHANGE IOBCSW TO MAKE IT APPEAR AS IF ONLY      @ZA04185 09768000
*              AN EOT HAD BEEN READ.                           @ZA04185 09770000
         MVC   IOBCSW+L3(L2),UNITEXCP SET STAT FOR EOT RECVD   @ZA04185 09772000
         L     ERREG2,L0(CCWREG)   GET I/O AREA ADDR           @ZA04185 09774000
         MVC   L0(L1,ERREG2),DCBBSEOT  MOVE IN EOT             @ZA04185 09776000
         LH    ERREG2,L6(CCWREG)   GET RD TXT LENGTH           @ZA04185 09778000
         BCTR  ERREG2,ZERO         DECREMENT BY ONE FOR....    @ZA04185 09780000
         STH   ERREG2,IOBCSW+L5    RESIDUAL COUNT              @ZA04185 09782000
         B     BSCSP063            RETURN                      @ZA04185 09784000
BSCSPX01 CLI   ZERO(CCWREG),CCWWRITE   IS THIS WRITE CCW                09800002
         BNE   BSCSPX02            NO, CONTINUE NORMAL                  09850002
         LA    ERREG4,IOBERCCW     POINT TO FIRST ERP CCW               09900002
         CR    CCWREG,ERREG4       ERROR OCCUR ON FIRST CCW             09950002
         BNE   BSCSPX02            NO, CONTINUE NORMAL                  10000002
         MVC   IOBERCCW+L15(1),IOBWORK+L1   SAVE RETURN CODE IN CCW     10050002
         OI    IOBERCCW+L15,X80    TURN ON HIGH ORDER BIT               10100002
         MVC   IOBERCCW+L14(L1),IOBERCCW+L8   SAVE CCW COMMAND CODE     10150002
         CLI   TPCODE(CCWREG),X03   WRITE ENQ TP OP CODE       @ZA12156 10160000
         BNE   SET8A               NO                           YA02438 10170002
         CLI   L8(CCWREG),CCWTIC   NEXT CCW A TIC               YA02438 10180002
         BNE   SET8A               NO                           YA02438 10190002
         L     ERREG4,L8(CCWREG)   GET CCW ADDR FROM TIC        YA02438 10192002
         LA    ERREG4,ZERO(ERREG4)   CLEAR OUT OP CODE          YA02438 10194002
         TM    TPCODE(ERREG4),TPOPWRTX   READ RESP TO TEXT      YA02438 10196002
         BNO   SET8A               NO                           YA02438 10198002
         CLI   L16(UCBREG),DEVICE    IS IT BSC1 ?              @ZA04861 10198100
         BE    SET8A              YES SET RETURN 8A            @ZA04861 10198200
         MVI   IOBWORK+L1,RTNCD86  SET RTN CODE=X'86'           YA02438 10198402
         LR    CCWREG,ERREG4       SET UP REG                   YA02438 10198502
         B     BSCSPX03            EXIT TO IOS                  YA02438 10198802
SET8A    EQU   *                                                YA02438 10199202
         MVI   IOBERCCW+L8,CCWREAD   SET COMMAND CODE TO READ           10200002
         MVI   IOBERCCW+L12,CCWFLAG1   SET ON SLI, SKIP                 10250002
         MVI   IOBWORK+L1,RTRNCDEA   SET SPECIAL RETURN                 10300002
         LA    CCWREG,IOBERCCW+L8   READ SKIP CCW ADDRESS               10400002
BSCSPX03 ST    CCWREG,IOBSTART                                          10450002
         B     RETRY               RETRY EXCP                           10550002
BSCSP0A  MVC   IOBWORK+L1(L1),IOBERCCW+L15   RESTORE RETURN CODE        10600002
         MVC   IOBERCCW+L8(L1),IOBERCCW+L14   RESTORE COMMAND CODE      10650002
         MVI   IOBERCCW+L12,CCWFLAG2   SET CCW FLAGS                    10700002
         LA    CCWREG,IOBERCCW                                          10800002
         ST    CCWREG,IOBSTART                                          10850002
         B     BSCSP073            UPDATE RETRY COUNT                   10950002
BSCSP0C  NI    IOSFLA,L255-IOSERR   INDICATE ERROR POST                 11000002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     11050002
         B     BSCSP043                                                 11100002
BSCSP07A CLC   IOBWORK+L2(L1),DCBBSENQ   ENQ RECEIVED                   11150002
         BE    BSCSP07             YES RETRANSMIT                       11200002
         L     CCWREG,IOBERCCW+L8   NO DISABLE CHECK                    11250002
         TM    TPCODE(CCWREG),HIGHBIT0   THIS THE LAST CCW              11300002
         BO    BSCSP071           YES, START WITH IT                    11350002
         TM    TPCODE+L8(CCWREG),HIGHBIT0   IS NEXT CCW LAST            11400002
         BNO   BSCSPZZZ           NO, RESTART WITH IT                   11450002
         CLI   TPCODE(CCWREG),TPRESET   THIS WRITE DLE-EOT              11550002
         BE    BSCSP071           YES, REWRITE DLE-EOT                  11600002
BSCSPZZZ LA    CCWREG,L8(CCWREG)    BUMP TO NEXT CCW                    11700002
         B     BSCSP071            CONTINUE FLOW                        11750002
BSCSP09  L     ERREG1,ZERO(CCWREG)   GET AREA ADDRESS                   11800002
         CLC   ZERO(L1,ERREG1),DCBBSEOT   EOT RECEIVED?                 11850002
         BNE   BSCSP091            NO, CHECK FURTHER                    11900002
         MVI   IOBERRCT,ERRMAXCT   SET RETRY COUNT TO MAXIMUM           11950002
         MVC   IOBCSW+L5(L2),IOBERCCW+L22  SAVE NEW RESIDUAL COUNT      12000002
         B     BSCSP043            POST OPERATION                       12100002
BSCSP091 EQU   *                                                        12150002
         LH    ERREG2,L6(CCWREG)   GET ORIGINAL COUNT                   12200002
         SH    ERREG2,IOBCSW+L5    SUBTRACT RESIDUAL COUNT              12250002
         BCTR  ERREG2,ZERO         BACK UP ONE                          12300002
         AR    ERREG2,ERREG1       POINT TO LAST CHAR                   12350002
         CLC   ZERO(L1,ERREG2),DCBBSENQ   ENQ SEQUENCE                  12400002
         BNE   BSCSP092            NO, BRANCH                           12450002
         BCTR  ERREG2,ZERO         BACK UP ONE                          12500002
         CLC   ZERO(L1,ERREG2),DCBBSSTX   STX-ENQ SEQUENCE              12550002
         BE    BSCSP073            YES, CONTINUE TO RETRY               12600002
         B     BSCSP042            SET SHOULD NOT OCCUR                 12650002
BSCSP092 CLC   ZERO(L1,ERREG1),DCBBSSTX   STX    FIRST CHAR             12700002
         BE    BSCSP093            YES, BRANCH                          12750002
         CLC   ZERO(L2,ERREG1),DCBBSTSX   DLE-STX FIRST CHAR            12800002
         BNE   BSCSP042            SET SHOULD NOT OCCUR                 12850002
BSCSP093 NI    DECFLAGS,NONABT     NOT ABORT CONDITION                  12900002
         TM    IOBSENS0,DATACHK+OVERRUN                        @ZA33188 12910000
         BNZ   BSCSP073            RETRY WT NAK & TIC RD TXT   @ZA33188 12920000
         B     BSCSP063            STX ENQ RECOVERY                     12950002
BSCSP06  IC    ERREG5,IOBRCVPT     RECEIVE ACK PTR                      13000002
         LA    ERREG2,DCBBSAK0(ERREG5)   ADDRESS OF EXPECTED ACK        13050002
         CLI   ZERO(CCWREG),CCWWRITE   IS THIS WRITE ENQ                13150002
         BE    BSCSP073            YES, RETRY WRITE ENQ                 13200002
         L     ERREG4,ZERO(CCWREG)   AREA POINTER                       13300002
         AH    ERREG4,L6(CCWREG)   ORIG COUNT                           13350002
         SH    ERREG4,IOBCSW+L5    SUBTRACT RESID COUNT                 13400002
         SH    ERREG4,ERRCN2       BACK UP TWO                          13450002
         CLC   L1(L1,ERREG4),DCBBSNAK   NAK RECEIVED                    13500002
         BE    BSCSP066            YES, CHK FOR ITB MODE                13550002
         CLC   L1(L1,ERREG4),DCBBSEOT   EOT RECEIVED            ZA15426 13557000
         BE    BSCSP063                                         ZA15426 13564000
         CLC   L1(L1,ERREG4),DCBBSENQ   WAS IT AN ENQ           ZA15426 13571000
         BE    BSCSP06A            YES, BRANCH                  ZA15426 13578000
         C     ERREG4,ZERO(CCWREG)  CHECK FOR ONLY 1 BYTE REC.  ZA15426 13585000
         BL    BSCSP06B       YES, DON'T CHECK DOUBLE RESP.     ZA15426 13592000
         CLC   ZERO(L2,ERREG4),ZERO(ERREG2)   THE EXPECTED RESPONSE     13600002
         BE    BSCSP063            YES INDICATE NORMAL COMP             13650002
         XR    ERREG2,ERREG1       FLIP TO WRONG ACK                    13700002
         CLC   ZERO(L2,ERREG4),ZERO(ERREG2)   WRONG ACK RECEIVED        13750002
         BE    BSCSP061            YES RETRANSMIT                       13800002
         CLC   ZERO(L2,ERREG4),DCBBSRVI   RVI RECEIVED                  13950002
         BE    BSCSP063            YES, BRANCH                          14000002
         CLC   ZERO(L2,ERREG4),DCBBSSAK   WAS WACK RECEIVED     YA02440 14010002
         BE    BSCSP063            YES, NORMAL COMP             YA02440 14020002
BSCSP06B EQU   *                                               @ZA15426 14025000
         CLI   L5(CCWREG),RDTEXT     READ TEXT ?               @ZA07651 14032600
         BE    BSCSP063      YES, GO TO NORMAL COMPLETION      @ZA04859 14033200
         CLI   L5(CCWREG),TPOPWRTX  READ RESPONSE CCW       LD @ZA02310 14034000
         BNE   BSCSP073            NO, CHECK RETRIES            YA02439 14040002
         CLI   L7(CCWREG),LEN20    LENGTH OF 20 INDICATES...LD @ZA02310 14040400
*                                  ...CONVERSATIONAL WRITE  LD @ZA02310 14040800
         BNE   BSCSP073            NO CHECK RETRIES         LD @ZA02310 14041200
         B     BSCSP063            SET NORMAL RETURN...     LD @ZA02310 14041600
*                                  ...DATA RECEIVED         LD @ZA02310 14041700
BSCSP06A EQU   *                                            LD @ZA02310 14041800
         SH    CCWREG,ERRCN8       BACK UP TO PREVIOUS CCW      YA02439 14042002
         CLI   L5(CCWREG),TPOPWTXT   IS IT A WRITE TEXT         YA02439 14044002
         BE    BSCSP013            YES                          YA02439 14046002
         CLI   L5(CCWREG),TPOPWDLE   WRITE DLE ETX              YA02439 14048002
         BNE   BSCSP073            NO, CHECK RETRIES            YA02439 14048402
         SH    CCWREG,ERRCN8       BACK UP TO WRITE TEXT        YA02439 14048802
BSCSP013 EQU   *                                                YA02439 14049202
         ST    CCWREG,IOBSTART     SET RESTART ADDR             YA02439 14049602
         B     BSCSP073            NO RETRY WRITE ENQ                   14050002
BSCSP01  CLC   IOBWORK+L2(L1),DCBBSENQ   WAS AN ENQ RECEIVED   @ZA04665 14100000
         BNE   BSCSP073            NO RETRY RD ENQ                      14150002
         CLI   IOBCPA,CCWAPOLL     THIS AUTO POLL                       14200002
         BNE   BSCSP07             NO RESTART FAIL CCW                  14250002
         IC    ERREG5,IOBSNDPT     ACK OFFSET                           14300002
         LA    CCWREG,DCBBSAK0(ERREG5)   LAST GOOD ACK                  14350002
         LA    ERREG1,L2           SET UP COUNT FOR CCW                 14400002
         B     BSCSP074            SET UP RETRY                         14450002
BSCSP02  EQU   *                                                YA03249 14500000
         TM    IOBCSW+L3,X02       UNIT CHECK                   YA03249 14550000
         BO    UNITCHEK            YES                          YA03249 14560000
         CLI   DECTYPE+1,READTI    READ INITIAL                @ZA03971 14562000
         BNE   BSCSP02A                                        @ZA03971 14564000
         CLI   IOBCPA,AUTOPOLL      IS,IT AUTOPOLL?            @ZA03971 14564600
         BNE   BSCSP02A                                        @ZA03971 14565200
         L     ERRLNK,ZERO(CCWREG) GET DATA AREA ADDRESS       @ZA06381 14565300
         LA    ERRLNK,ZERO(ERRLNK)  CLEAR UNUSED BYTE          @ZA06381 14565400
         CLC   ZERO(L1,ERRLNK),DCBBSEOT WAS FIRST CHAR AN EOT  @ZA12156 14565500
         BE    READINIT            YES RESTART POLLING         @ZA06381 14565600
BSCSP02B EQU   *                                               @AZ03971 14566000
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR   NO ERROR       YA03249 14570000
         NI    IOSFLA,L255-IOSEX-IOSERR   ALSO IN IOSB          YA03249 14580000
         B     BSCSP075            EXIT                         YA03249 14580700
BSCSP02A EQU   *                                               @ZA03971 14581400
         CLI   IOBWORK+3,CON9B       SPEC SPEC RETURN?         @ZA32428 14582100
         BNE   NOSPEC                NO! BRANCH                @ZA32428 14582800
         MVI   IOBWORK+3,ZERO        CLEAR SPEC SPEC RETURN    @ZA32428 14583500
         ST    CCWREG,IOBERCCW+8     SET TIC ADDR              @ZA32428 14584200
         L     CCWREG,0(CCWREG)      GET ADDR OF TEXT          @ZA32428 14584900
         CLC   0(1,CCWREG),DCBBSENQ  READ ENQ?                 @ZA32428 14585600
         BNE   BSCSP063              NO! POST NORMAL           @ZA32428 14586300
         LA    CCWREG,IOBERCCW       GET ERP CH PGM ADDR       @ZA32428 14587000
         ST    CCWREG,IOBSTART       SET IOBSTART              @ZA32428 14587700
         LA    CCWREG,DCBBSNAK       GET NAK POINTER           @ZA32428 14588400
         B     BSCSP03A              COMP WRT NAK & TIC TO RD  @ZA32428 14589100
NOSPEC   TM    IOBERINF+L8,LSTDATA   LOST DATA?                @ZA32428 14590400
         BO    BSCSP021              YES, CHECK FOR ENQ        @ZA03971 14590600
         TM    IOBERINF+L8,DATACHK   DATA CHECK ?              @ZA03970 14590800
         BO    BSCSP02B              YES, RESET ERP IN CONTROL @ZA03970 14591000
         B     BSCSP021              NO, CHECK FOR ENQ         @ZA03970 14591200
UNITCHEK EQU   *                                                YA03249 14592000
         TM    IOBSENS0,TIMEOUT    TIME OUT ERROR               YA03249 14594000
         BZ    BSCSP073            NO,RETRY WRITE NAK           YA03249 14596000
         CLI   DECTYPE+L1,READTI   READ INITIAL                 YA03249 14596200
         BNE   BSCSP073            NO, RETRY                    YA03249 14596400
* 2 LINES DELETED                                              @ZA12146 14596500
         CLC   IOBCSW+L5(L2),L6(CCWREG) DOES RES. CNT=ORG CNT  @ZA11037 14597000
         BE    READINIT           YES GO BACK TO POLLING       @ZA11037 14597200
         L     ERREG2,ZERO(CCWREG)  GET DATA AREA ADDRESS      @ZA07640 14598700
         LA    ERREG2,ZERO(ERREG2)   CLEAR HIGH BYTE           @ZA07640 14598800
         CLI   ZERO(ERREG2),L1     IS IT AN SOH                @ZA12146 14598900
         BE    BSCSP073          YES, RETRY WRITE NAK          @ZA12146 14599000
READINIT LA    ERREG2,IOBCPA       POINT TO START OF CCWS       YA03249 14599200
         ST    ERREG2,IOBSTART     RETRY FROM START             YA03249 14599600
         MVI   IOBRCVPT,X02        INITIALIZE RCV PTR       LD @ZA02309 14603003
         MVI   IOBSNDPT,ZERO       INITIALIZE SND PTR       LD @ZA02309 14605003
         LA    ERREG2,IOBCPA+L24   POINT TO CCW 4               YA03249 14606400
         CLI   L5(ERREG2),READINDX   READ INDEX                 YA03249 14609800
         BE    FOUNDIDX            YES                          YA03249 14613200
         LA    ERREG2,L24(ERREG2)   NOT READINDX, IS WRAP LIST  YA03249 14616600
FOUNDIDX EQU   *                                                YA03249 14628600
         L     CCWREG,ZERO(ERREG2)   LOAD AREA ADDRESS          YA03249 14630600
         LA    CCWREG,L2(CCWREG)   ADD 2                        YA03249 14632600
         ST    CCWREG,L8(ERREG2)   STORE IN READ TEXT           YA03249 14633000
         MVI   L8(ERREG2),CCWREAD   RESTORE COMMAND CODE        YA03249 14633100
         LH    CCWREG,DECLNGTH     GET LENGTH                   YA03249 14633200
         BCTR  CCWREG,ZERO         REDUCE                       YA03249 14638800
         BCTR  CCWREG,ZERO         BY TWO                       YA03249 14640800
         STH   CCWREG,L14(ERREG2)   PUT COUNT IN READ TEXT      YA03249 14642800
*  *****     LINES 146432-146443 DELETED BY ZA02833  *****  L5 @ZA02833 14652800
         NI    IOSFLA,L255-IOSEX-IOSERR  SET NRM COMP IN IOSB  @ZA04679 14653700
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR  ALSO IN IOB    @ZA04679 14654600
         MVI   IOBERRCT+L1,ZERO      SET NORMAL RETURN         @ZA04679 14655500
         MVI   IOBWORK+L1,SPFLAG    SET SPECIAL FLAG FOR 19MB  @ZA04679 14656400
         B     RETRY                EXIT                       @ZA04679 14658200
BSCSP021 EQU   *                                            LD @ZA02308 14659200
         CLI   IOBWORK+L3,CON9A        SPEC. IND SET?          @ZA17702 14660200
         BNE   BSCSP02C                NO, CHECK ENQ RECEIVED  @ZA17702 14661200
         L     ERREG2,L0(CCWREG)       GET DATA ADDR.          @ZA17702 14662200
         MVI   IOBWORK+L3,ZERO         CLEAR INDICATOR         @ZA24635 14663200
         ST    CCWREG,IOBERCCW+L8      RESTORE TIC ADDRESS     @ZA24635 14664200
         CLC   L0(L1,ERREG2),DCBBSENQ  IS IT AN ENQ?           @ZA17702 14665200
         BE    BSCSP02D                YES, SET UP NAK         @ZA17702 14666200
         TM    IOBSENS0,DATACHK+OVERRUN  DATACHK OR OVERRUN?   @ZA31718 14667000
         BNZ   BSCSP02D                YES! SET UP NAK         @ZA31718 14667800
         B     BSCSP063                                        @ZA17702 14669600
BSCSP02C CLC   IOBWORK+L2(L1),DCBBSENQ ENQ RECEIVED            @ZA17702 14670200
         BNE   BSCSP073            NO,RETRY READ ENQ        LD @ZA02308 14670603
BSCSP02D LA    CCWREG,DCBBSNAK     ADDRESS OF NAK CHARACTER LD @ZA17702 14672200
         CLI   DECTYPE+1,READTRV   READ INTERRUPT??            @ZA32980 14673200
         BE    SPEC9B              YES BRANCH                  @ZA32980 14674200
         CLI   DECTYPE+1,READTT    READ TT?                    @ZA32428 14675200
         BNE   BSCSP03A            NO BRANCH                   @ZA32428 14676200
SPEC9B   MVI   IOBWORK+3,CON9B     SET SPEC SPEC RETURN        @ZA32980 14677200
         LA    CCWREG,IOBCPA       PTR TO RDTT CH PGM          @ZA32428 14678200
         ST    CCWREG,IOBSTART     SET IOBSTART                @ZA32428 14679200
         B     RETRY               RETRY RDTT                  @ZA32428 14680200
****     THIS STATEMENT REMOVED BY APAR @ZA32428               @ZA32428 14686100
BSCSP03  LA    CCWREG,DCBBSENQ     ADDRESS OF ENQ CHARACTER             14700002
BSCSP03A LA    ERREG1,L1           SET UP COUNT FOR CCW                 14750002
         B     BSCSP074            COMPLETE WRITE OPERATION             14800002
BSCSP04  EQU   *                                                        14850002
         CLI   DECTYPE+L1,WRITTQ   IS THIS A WRITE ENQUIRY              14950002
         BE    BSCSP076            YES, RETRY WRITE ENQ                 15000002
         CLC   IOBWORK+L2(L1),DCBBSENQ   WAS ENQ RECEIVED      @ZA04665 15100000
         BE    BSCSP045                                                 15150002
         CLI   DECTYPE+L1,WRTCONN   IS THIS A WRITE CONNECT             15200002
         BNE   BSCSP07             NO, CONTINUE                         15250002
         OI    IOBERCCW+L4,SKIP    SET UP READ SKIP                     15350002
         MVC   IOBERCCW+L6(L2),SKIPCNT   TO CLEAR THE LINE              15400002
         B     BSCSP072                                                 15500002
BSCSP045 EQU   *                                                        15550002
         MVI   IOBWORK+L1,INITCONS   SET UP TO CHECK WRT INIT           15600002
         XC    IOBWORK+L1(L1),DECTYPE+L1   CHECK VALUE                  15650002
         TM    IOBWORK+L1,MASK15   THIS WRITE INITIAL OPERATION         15700002
         BM    BSCSP042            NO SET SNO                           15750002
         B     BSCSP041            YES CHECK POINT TO POINT             15800002
BSCSP042 OI    DECERRST,DECSNO     INDICATE SNO                         15850002
         MVI   IOBERRCT,ERRMAXCT   SET RETRY COUNT TO MAX               15900002
BSCSP043 LA    NAMEREG,ERLOD25     ADDRESS OF ERROR POST                15950002
         MVI   IOBERRCT+L1,ZERO                                         16000002
         MVI   IOBWORK+L1,ZERO                                          16050002
XCTLOUT  EQU   *                                                        16100002
         L     ERRETR,CVTPTR       POINT TO CVT                         16150002
         USING CVTMAP,ERRETR                                            16200002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                16250002
         DROP  ERRETR                                                   16300002
         BR    ERRETR              XCTL                                 16350002
BSCSP041 TM    UCBTYPE+L1(UCBREG),NOTPTPT   AUTO-CALL,ANSR,POLL         16400002
         BNZ   BSCSP042            YES SET SNO                          16450002
BSCSP048 EQU   *                                                        16500002
         TM    DCBXCODE,DCBMASTA   THIS THE MASTER STATION              16550002
         BZ    BSCSP044            YES RESTART CHAN PROGRAM             16600002
BSCSP046 OI    DECFLAGS,SLVCONT    INDICATE CONTENTION                  16650002
BSCSP047 NI    IOSFLA,L255-IOSERR   INDICATE ERROR POST                 16700002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     16750002
         MVC   IOBCSW(L7),IOBERCCW+L17   RESTORE FAILURE DATA           16800002
         B     BSCSP075            EXIT VIA IOS                         16900002
BSCSP044 LA    CCWREG,IOBCPA       SET TO RESTART CHAN PROGRAM          16950002
         B     BSCSP078            COMPLETE OPERATION                   17000002
BSCSP061 EQU   *                                                        17050002
         TM    DCBBFTEK,DYNBUF     THIS DYNAMIC BUFFERING               17100002
         BO    BSCSP043            YES POST WITH ERROR                  17150002
         TM    IOBERCCW+L16,IOBTO   DID THIS WRONG ACK OCCUR IN         17200002
*                                  TIME OUT SITUATION                   17250002
         BNO   BSCSP073            NO, RESEND THE ENQ                   17300002
         B     BSCSP065                                                 17350002
BSCSP063 NI    IOSFLA,L255-IOSEX-IOSERR   INDICATE NORMAL COMPLETION    17400002
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR   ALSO IN IOB            17450002
         B     BSCSP075            SET NORMAL RETURN                    17500002
BSCSP066 LH    ERREG4,IOBCSW+L5    GET RESIDUAL COUNT                   17550002
         LA    ERREG4,L1(ERREG4)   ADD ONE                              17600002
         CH    ERREG4,L6(CCWREG)   EQUAL TO ORIGINAL                    17650002
         BL    BSCSP043            MORE THAN ONE CHARACTER              17700002
         TM    DCBBFTEK,DYNBUF     THIS DYNAMIC BUFFERING               17750002
         BO    BSCSP043            YES POST WITH ERROR                  17800002
BSCSP065 EQU   *                                                        17850002
         LA    ERRLNK,IOBCPA       START OF CHANNEL PROGRAM             17900002
         CR    ERRLNK,CCWREG       COMPARE TO CCW ADDRESS               17950002
         BE    BSCSP071            IF EQUAL, RESTART CHAN PROG          18000002
         SH    CCWREG,ERRCN8       BACK UP ONE CCW                      18050002
         CLI   L5(CCWREG),TPOPDTXT   THIS TEXT TRANSFER                 18100002
         BNE   BSCSP065            NO BACK UP ANOTHER CCW               18150002
         B     BSCSP071            SET TO RESTART CHAN PROG             18200002
BSCSP0B  EQU   *                                                        18250002
         TM    IOBCSW+L3,X02       UNIT CHECK                           18300002
         BNZ   BSCSP073            YES, SEND NAK AGAIN                  18350002
         L     ERREG2,ZERO(CCWREG)   ENQ POINTER                        18400002
         TM    IOBCSW+L3,X01       UNIT EXCEPTION                       18450002
         BZ    BSCSP0B1                                                 18500002
         CLC   ZERO(L1,ERREG2),DCBBSEOT   EOT RECEIVED                  18550002
         BE    BSCSP063            YES, POST                            18600002
         B     BSCSP073            NO, RETRY                            18650002
BSCSP0B1 EQU   *                                                        18700002
         CLC   ZERO(L1,ERREG2),DCBBSENQ   ENQ RECD                      18750002
         BE    BSCSP073            YES, SEND NAK AGAIN                  18800002
         B     BSCSP063            OTHERWISE POST                       18850002
BSCSP07  L     CCWREG,IOBERCCW+L8   ADDRESS OF FAILING CCW              18900002
BSCSP071 ST    CCWREG,IOBSTART     STORE IN START PTR                   18950002
         B     BSCSP075            COMPLETE CHAN PROGRAM                19050002
BSCSP077 L     ERREG2,L8(CCWREG)   GET DATA ADDRESS OF READ CCW         19100002
         MVC   ZERO(L2,ERREG2),IOBWORK+L2   MOVE DLE-EOT TO USERS AREA  19150002
         B     BSCSP047                                                 19200002
BSCSP076 L     CCWREG,IOBERCCW+L8   ADDRESS OF FAILING CCW              19250002
         CLC   IOBWORK+L2(L1),DCBBSENQ   WAS ENQ RECEIVED      @ZA04665 19300000
         BE    BSCSP048            YES, CHECK CONTENTION                19350002
         CLC   IOBWORK+L2(L2),DCBBSDLE   DLE-EOT RECEIVED               19400002
         BE    BSCSP077            YES, POST DISCONNECT SEQUENCE        19450002
BSCSP078 EQU   *                                                        19500002
         ST    CCWREG,IOBSTART     STORE CHAN PROG ADDRESS              19550002
BSCSP072 MVI   IOBERRCT+L1,ZERO    SET NORMAL RETURN                    19650002
         MVI   IOBWORK+L1,ZERO     CLEAR RETURN CODE                    19700002
BSCSP073 CLI   IOBERRCT,ERRMAXCT   CHECK RETRIES                        19750002
         BNL   BSCSP043            NONE LEFT                            19800002
         IC    ERREG1,IOBERRCT     PICK UP COUNT                        19850002
         LA    ERREG1,L1(ERREG1)   BUMP ONCE                            19900002
         STC   ERREG1,IOBERRCT     RESTORE                              19950002
         MVI   IOBSENS0,ZERO       CLEAR SENSE BYTE                     20000002
         B     RETRY               RETRY EXCP                           20050002
BSCSP074 ST    CCWREG,IOBERCCW     NEW DATA ADDRESS                     20100002
         STH   ERREG1,IOBERCCW+L6   SET COUNT                           20200002
         MVI   IOBERCCW,CCWWRITE   SET WRITE COMMAND                    20250002
         MVI   IOBERCCW+L8,CCWTIC   PUT TIC IN SECOND COMMANE           20300002
BSCSP075 MVI   IOBERRCT+L1,ZERO    SET NORM RETURN                      20400002
         MVI   IOBWORK+L1,ZERO     CLEAR RETURN CODE                    20450002
RETRY    MVI   EWAIND1,EWAISVCF    SVC 15                      @ZA12156 20500000
         L     NAMEREG,TRANSRTN    LOAD NAME                            23250002
         B     XCTLOUT             XCTL                                 23300002
         EJECT                                                          24100002
**********                                                              24150002
*                                                                       24200002
*        CONSTANTS                                                      24250002
*                                                                       24300002
**********                                                              24350002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       24400002
ERRCN2   DC    H'2'                                                     24450002
ERRCN8   DC    H'8'                                                     24500002
SKIPCNT  DC    X'5FFF'                                                  24550002
UNITEXCP DC    X'0D00'             CE,DE, UNIT EXECPTION STAT  @ZA04185 24570000
PACHAREA DC    30C'0000'           PATCH AREA FOR MAINTENANCE           24600000
**********                                                              24650002
*                                                                       24700002
*        MISCELLANEOUS EQUATES                                          24750002
*                                                                       24800002
**********                                                              24850002
TIMEOUT  EQU   X'01'               TIME OUT SENSE               YA03249 24900000
AUTOPOLL EQU   X'09'               CCMD FOR AUTOPOLL           @ZA03971 24905000
READTI   EQU   X'01'               READ INITIAL                 YA03249 24910000
READINDX EQU   X'0A'               READ INDEX                   YA03249 24920000
NONABT   EQU   X'FE'               MASK OFF ABORT SEQUENCE              24950002
SKIP     EQU   X'10'                                                    25000002
TOERROR  EQU   3                                                        25050002
L255     EQU   X'FF'               AND MASK                             25100002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              25150002
L0       EQU   0                                               @ZA04185 25170000
L1       EQU   1                   LENGTH AND DISPLACEMENT              25200002
L2       EQU   2                   LENGTH AND DISPLACEMENT              25250002
L3       EQU   3                   LENGTH AND DISPLACEMENT              25300002
L4       EQU   4                   LENGTH AND DISPLACEMENT              25350002
L5       EQU   5                   LENGTH AND DISPLACEMENT              25400002
L6       EQU   6                   LENGTH AND DISPLACEMENT              25450002
L7       EQU   7                   LENGTH AND DISPLACEMENT              25500002
L8       EQU   8                   LENGTH AND DISPLACEMENT              25550002
L9       EQU   9                   LENGTH AND DISPLACEMENT              25600002
L12      EQU   12                  LENGTH AND DISPLACEMENT              25650002
L14      EQU   14                  LENGTH AND DISPLACEMENT              25700002
L15      EQU   15                  LENGTH AND DISPLACEMENT              25750002
L16      EQU   16                  LENGTH AND DISPLACEMENT              25800002
L17      EQU   17                  LENGTH AND DISPLACEMENT              25850002
L22      EQU   22                  LENGTH AND DISPLACEMENT              25900002
L24      EQU   24                  LENGTH AND DISPLACEMENT      YA03249 25910000
X01      EQU   X'01'                                                    25950002
X02      EQU   X'02'                                                    26000002
X03      EQU   X'03'                                                    26050002
X04      EQU   X'04'                                                    26100002
X80      EQU   X'80'                                                    26150002
SPFLAG   EQU   X'9F'     SPECIAL FLAG FOR IOB WORK             @ZA04679 26220000
UCBTYPE  EQU   16                                                       26300002
TPOPDTXT EQU   X'11'                                                    26350002
HIGHBIT0 EQU   X'80'                                                    26400002
DYNBUF   EQU   X'08'                                                    26450002
CCWAPOLL EQU   9                                                        26500002
IOBTO    EQU   1                   TIME OUT                             26550002
INITCONS EQU   X'0D'                                                    26600002
MASK15   EQU   X'0F'                                                    26650002
WRTCONN  EQU   X'1C'                                                    26700002
WRITTQ   EQU   X'16'                                                    26750002
READTRV  EQU   X'1B'             READ INTERRUPT                @ZA32980 26760000
READTT   EQU   X'03'             READ CONTINUE                 @ZA32428 26770000
CON9B    EQU   X'9B'             SPEC SPEC RETURN FOR 504C     @ZA32428 26780000
TPCODE   EQU   5                                                        26800002
DECSNO   EQU   X'40'                                                    26850002
ERLOD25  EQU   2043                                                     26900002
ERRMAXCT EQU   7                                                        26950002
LSTDATA  EQU   X'02'      LOST DATA SENSE BYTE                 @ZA03971 27000000
DATACHK  EQU   X'08'      DATA CHECK SENSE BYTE                @ZA03970 27050000
OVERRUN  EQU   X'04'      OVERRUN SENSE BYTE                   @ZA31718 27070000
SLVCONT  EQU   X'10'                                                    27150002
NOTPTPT  EQU   X'D0'                                                    27200002
DCBMASTA EQU   X'80'                                                    27250002
CCWWRITE EQU   X'01'                                                    27300002
FLIPBIT  EQU   X'02'                                                    27350002
CCWTIC   EQU   X'08'                                                    27400002
UERDSKP  EQU   X'07'                                                    27450002
CODEA    EQU   X'0A'                                                    27500002
CSWUE    EQU   X'01'                                                    27550002
CCWREAD  EQU   X'02'                                                    27600002
CCWFLAG1 EQU   X'30'                                                    27650002
CCWFLAG2 EQU   X'70'                                                    27700002
RTRNCDEA EQU   X'8A'                                                    27750002
TPRESET  EQU   X'21'                                                    27800002
TPOPWTXT EQU   X'11'               WRITE TEXT                   YA02439 27802002
TPOPWDLE EQU   X'13'               WRITE DLE ETX                YA02439 27804002
TPOPWRTX EQU   X'25'               READ RESP TO TEXT            YA02438 27810002
RDTEXT   EQU   X'91'     READ TEXT TP CODE (LAST ONE)          @ZA04859 27811000
LEN20    EQU   X'14'               LENGTH OF READ RESP...   LD @ZA02310 27812000
*                                  ...CCW FOR CONVERSATINAL LD @ZA02310 27814000
*                                  ...MODE.                 LD @ZA02310 27818000
RTNCD86  EQU   X'86'               RETURN CODE OF 86            YA02438 27820002
DEVICE   EQU   X'55'                                           @ZA04861 27827000
UNITCK   EQU   X'02'               UNIT CHECK STATUS           @ZA04185 27834000
EOTCHAR  EQU   X'37'               EOT CHECK                   @ZA06381 27841000
CON9A    EQU   X'9A'               SPECIAL CODE                @ZA17702 27845000
**********                                                              27850002
*                                                                       27900002
*        REGISTER DEFINITION                                            27950002
*                                                                       28000002
**********                                                              28050002
ERREG3   EQU   0                   WORK REG                             28100002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              28150002
ERREG2   EQU   2                   WORK REG                             28200002
EWAREG   EQU   3                   ERP WORKAREA BASE                    28250002
CCWREG   EQU   4                   CCW ADDRESS REG                      28300002
DECBRG   EQU   5                   DECB BASE                            28350002
DCBREG   EQU   6                   DCB BASE                             28400002
UCBREG   EQU   7                   UCB BASE                             28450002
BASEREG  EQU   8                   PROGRAM BASE                         28500002
ERREG1   EQU   9                   WORK REG                             28550002
IOBRG    EQU   10                  IOB BASE                             28600002
ERREG4   EQU   11                  WORK REG                             28650002
ERRLNK   EQU   12                  LINK REG                             28700002
NAMEREG  EQU   13                  LINK REG                             28750002
ERRETR   EQU   14                  LINK REG                             28800002
ERREG5   EQU   15                  LINK REG/WORK REG                    28850002
         EJECT                                                          28900002
         IECTDECB                                                       28950002
         EJECT                                                          29000002
         DCBD  DSORG=BX,DEVD=BS                                         29050002
         EJECT                                                          29100002
         IECDRQE                                                        29150002
         EJECT                                                          29200002
         IEZIOB                                                         29250002
         EJECT                                                          29300002
CVT      DSECT                                                          29350002
         CVT                                                            29400002
         EJECT                                                          29450002
         IECDERWA                                                       29500002
**********                                                              29550002
*                                                                       29600002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        29650002
*                                                                       29700002
**********                                                              29750002
         ORG   EWAIERP                                                  29800002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 29850002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 29900002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 29950002
EWAIND0  DS    B                   FLAG BYTE                            30000002
EWAIVISR EQU   X'10'               V=R REQUEST                          30600002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 30650002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 30700002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 30750002
EWAIND1  DS    B                   FLAG BYTE                            30800002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 30850002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 30900002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 30950002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 30960002
EWAISVCF EQU   X'08'               SVC 15                      YM05652K 30970002
EWAIND2  DS    B                   FLAG BYTE                            31000002
EWAIND3  DS    B                   FLAG BYTE                            31050002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     31100002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  31150002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 31200002
*********  END OF BTAM LOCAL DEFINITIONS **********                     31250002
         EJECT                                                          31900002
         IECDIOSB                                                       31950002
         END                                                            32000002
./  ADD  SSI=40260013,NAME=IGE0604A
         TITLE 'IGE0604A - BTAM ERR BUS OUT MODULE'                     00550002
IGE0604A CSECT                                                          00600002
*********************************************************************** 00650002
*                                                                     * 00700002
* MODULE NAME:                                                        * 00750002
*    IGE0604A                                                         * 00800002
*                                                                     * 00850002
* DESCRIPTIVE NAME:                                                   * 00900002
*    BTAM BUS OUT ERROR ERP                                           * 00950002
*                                                                     * 01000002
* COPYRIGHT:                                                          * 01050002
*    NONE                                                             * 01100002
*                                                                     * 01150002
* STATUS:                                                             * 01200002
*    CHANGE LEVEL 000                                                 * 01250002
*                                                                     * 01300002
* FUNCTION:                                                           * 01350002
*    THIS MODULE IS ENTERED ON THE OCCURRENCE OF A BUS OUT ERROR.     * 01400002
*    CHECKS FOR AN OVERRUN ERROR AND XCTLS TO THE OVERRUN ROUTINE     * 01450002
*    IF NECESSARY.  THE CHANNEL PROGRAM IS RETRIED IF REQUIRED.       * 01500002
*                                                                     * 01550002
* NOTES:                                                              * 01600002
*    DEPENDENCIES:                                                    * 01650002
*        NONE                                                         * 01700002
*    RESTRICTIONS:                                                    * 01750002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01800002
*    REGISTER CONVENTIONS:                                            * 01850002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01900002
*                                                                     * 01950002
* PATCHLABEL:                                                         * 02000002
*    PACHAREA (24 BYTES)                                              * 02050002
*                                                                     * 02100002
* MODULE TYPE:                                                        * 02150002
*    PROCEDURE                                                        * 02200002
*    PROCESSOR:                                                       * 02250002
*        BAL                                                          * 02300002
*    MODULE SIZE:                                                     * 02350002
*        236 BYTES                                                    * 02400002
*    ATTRIBUTES:                                                      * 02450002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02500002
*                                                                     * 02550002
* ENTRY POINT:                                                        * 02600002
*    IGE0604A                                                         * 02650002
*    PURPOSE:                                                         * 02700002
*        SEE 'FUNCTION'                                               * 02750002
*    LINKAGE:                                                         * 02800002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02850002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02900002
*    INPUT:                                                           * 02950002
*        REG 1 = ADDRESS OF IOSB                                      * 03000002
*    OUTPUT:                                                          * 03050002
*        SET DECERRST FOR SHOULD NOT OCCUR ERROR.                     * 03100002
*        ALTERED CHANNEL PROGRAM.                                     * 03150002
*                                                                     * 03200002
* EXITS-NORMAL:                                                       * 03250002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03350002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03400002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03450002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03500002
*        LOADS ARE 1000 GREATER.                                      * 03550002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03600002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03650002
*                                                                     * 03700002
* EXITS-ERROR:                                                        * 03750002
*    NONE                                                             * 03800002
*                                                                     * 03850002
* EXTERNAL REFERENCES:                                                * 03900002
*    ROUTINES:                                                        * 03950002
*        NONE                                                         * 04000002
*    DATA AREAS                                                       * 04100002
*        IOB (MAPPED BY IEZIOB)                                       * 04150002
*        VIRTUAL CHANNEL PROGRAM                                      * 04200002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04250002
*    CONTROL BLOCKS                                                   * 04300002
*        UCB                                                          * 04350002
*        DCB                                                          * 04400002
*        DECB                                                         * 04450002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04500002
*        CVT          (MAPPED BY CVT)                                 * 04550002
*        IOB          (MAPPED BY IEZIOB)                              * 04600002
*        RQE          (MAPPED BY IECDRQE)                             * 04650002
*                                                                     * 04800002
* TABLES-WORKAREAS:                                                   * 04850002
*    ERP WORKAREA                                                     * 04900002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04950002
*                                                                     * 05000002
* MACROS:                                                             * 05050002
*    NONE                                                             * 05100002
*                                                                     * 05150002
* CHANGE ACTIVITY:                                                    * 05200002
*    YM02595K (9/20/73)                                               * 05250002
*    YM02594K (9/24/73)                                               * 05260002
*    YM05652K (1/24/74)                                               * 05270000
*                                                                     * 05300002
*********************************************************************** 05350002
         EJECT                                                          05400002
         USING *,BASEREG                                                05450002
         LR    BASEREG,ERREG5      SET BASE REG                         05500002
         USING RQE,ERREG5                                               05550002
         USING IOSB,IOSBREG                                             05600002
         USING IOBSTDRD,IOBRG                                           05650002
         USING EWA,EWAREG                                               05700002
         L     ERREG5,IOSUSE       BASE RQE                             05750002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05800002
         L     IOBRG,RQEIOB        BASE IOB                             05850002
         L     DECBRG,IOBECBPT     BASE DECB                            05900002
         L     DCBREG,IOBDCBPT     BASE DCB                             05950002
         L     UCBREG,IOSUCB       BASE UCB                             06000002
         DROP  ERREG5                                                   06050002
         L     CCWREG,IOBFL3       ADDRESS OF CCW                       06100002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06150002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                06200002
         MVC   IOBWORK(L1),DECTYPE+L1(DECBRG)   PICK UP DEV TYPE        06250002
         NI    IOBWORK,L255-HIBIT   CLEAR UNUSED BITS                   06300002
         MVC   IOBWORK+L1(L1),TPCODE(CCWREG)   PICK UP TP OP CODE       06350002
         NI    IOBWORK+L1,L255-HIBIT   CLEAR UNUSED BITS                06400002
         TM    IOBSENS0,IOBSNBOC   THIS BUSSOUT ERROR                   06450002
         BZ    ERROVR00            NO CHECK FOR OVERRUN                 06500002
         CLI   ZERO(CCWREG),CCWAPOLL   THIS A POLL COMMAND              06550002
         BE    ERRBOC03            YES SET UP REPOLL FUNCTION           06600002
         CLI   ZERO(CCWREG),CCWWRT   THIS A WRITE COMMAND               06650002
         BNE   ERRBOC02            NO CHECK FURTHER                     06700002
         TM    IOBWORK+L1,PTXTXFER   IS COMMAND PRIOR TO TEXT XFERS     06750002
         BZ    ERROVR01            YES RETRY CHAN PROGRAM               06800002
         TM    IOBWORK+L1,ATXTXFER   IS COMMAND AFTER TEXT XFER         06850002
         BZ    ERRBOC01            NO CHECK FURTHER                     06900002
ERRSTORE EQU   *                                                        06950002
         ST    CCWREG,IOBSTART     CPA START TO FAILING CCW             07000002
         B     ERROVR01            EXECUTE FAILING CCW                  07600002
ERRBOC01 TM    DCBERROP(DCBREG),DCBWRTRY   WRITE RETRIES REQUESTED      07650002
         BZ    ERRBOC00            NO POST WITH ERROR                   07700002
         TM    TPCODE(CCWREG),CCWLAST   THIS LAST CCW                   07750002
         BO    ERROVR01            YES RE-EXECUTE CHAN PROG             07800002
         MVC   IOBWORK+L3(L1),TPCODE+L8(CCWREG)   PICK UP NEXT OP CODE  07850002
         NI    IOBWORK+L3,L255-HIBIT   CLEAR UNWANTED BITS              07900002
         CLI   IOBWORK+L3,CCWRRTXT   READ RESPONSE TO TEXT              07950002
         BNE   ERROVR01            NO RE-EXECUTE CHAN PROGRAM           08000002
         B     ERRSTORE            RESET IOBSTART                       08050002
ERRBOC02 EQU   *                                                        08100002
         CLI   ZERO(CCWREG),CCWDIAL   THIS A DIAL COMMAND               08150002
         BE    ERROVR01            YES RETRY CHANNEL PROGRAM            08200002
ERRBOSNO OI    DECERRST(DECBRG),CSWSNO   SET SHOULD NOT OCCUR ERROR     08250002
ERRBOC00 LH    NAMEREG,ERLOD5      ADDRESS OF POST ROUTINE              08300002
         OI    IOSFLB,IOSLOG       INDICATE LOG OUT                     08350002
ERRLINK1 EQU   *                                                        08400002
         L     ERRETR,CVTPTR       POINT TO CVT                         08450002
         USING CVTMAP,ERRETR                                            08500002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                08550002
         DROP  ERRETR                                                   08600002
         BR    ERRETR              XCTL                                 08650002
ERRCHK1  EQU   *                                                        08700002
         TM    UCBTYP+L1(UCBREG),SWLINE   DISABLE REQUIRED              08750002
         BZ    ERRBOC00            NO POST ERROR                        08800002
         MVI   IOBERRCT+L1,MASK15   SPECIAL ENTRY TO DISABLE ROUTINE    08850002
         L     NAMEREG,ERLOD9      ADDRESS OF DISABLE ROUTINE           08900002
         B     ERRLINK1            EXIT ROUTINE                         08950002
ERRBOC03 LA    ERREG2,IOBCPA       START OF CHAN PROG                   09000002
         ST    ERREG2,IOBSTART     STORE POINTER                        09050002
         L     ERREG1,IOBCPA+L8    LOAD ENTRY ADDRESS FROM PREVIOUS     09200002
*                                  POLL (WITH COMMAND CODE IN HIGH      09250002
*                                  ORDER BYTE)                          09300002
         MVC   IOBCPA+L9(L3),DECENTRY+L1(DECBRG)    MOVE IN ADDRESS     09350002
*                                  OF LAST ENTRY POLLED (TO BE USED     09400002
*                                  AS RESTART ADDRESS)                  09450002
         L     ERREG4,IOBCPA+L8   LOAD ENTRY ADDRESS FOR NEXT POLL      09500002
*                                  (WITH POLL COMMAND CODE IN HIGH      09550002
*                                  ORDER BYTE)                          09600002
         SR    ERREG1,ERREG4       SUBTRACT NEW POLL ADDRESS            09650002
*                                  FROM PREVIOUS POLL ADDRESS.          09700002
         AH    ERREG1,IOBCPA+L14   IF THE NEW POLL ADDRESS WERE LESS    09750002
*                                  THAN THE PREVIOUS POLL ADDRESS, THE  09800002
*                                  EFFECT IS TO ADD THE ABSOLUTE        09850002
*                                  DIFFERENCE TO THE PREVIOUS COUNT.    09900002
*                                  IF IT WERE GREATER, THE EFFECT IS    09950002
*                                  TO SUBTRACT.                         10000002
         STH   ERREG1,IOBCPA+L14   STORE ADJUSTED COUNT IN              10050002
*                                  POLL COMMAND.                        10100002
ERROVR01 CLI   IOBERRCT,ERTRYCT    RETRY REQUIRED                       10200002
         BNL   ERRCHK1             NO CHECK FOR DISABLE                 10250002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  10300002
         LA    ERREG1,L1(ERREG1)   BUMP COUNT BY ONE                    10350002
         STC   ERREG1,IOBERRCT     STORE NEW COUNT                      10400002
         OC    EWASTUP(L1),IOBSENS0   RECORD TEMPORARY ERRORS           10450002
         MVI   IOBSENS0,ZERO       CLEAR SENSE BYTE                     10500002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 10550000
         L     NAMEREG,TRANSRTN    LOAD NAME                            12200002
         B     ERRLINK1            XCTL                                 12250002
ERROVR00 LH    NAMEREG,ERLOD15     ADDRESS OF OVERRUN ROUTINE           15350002
         B     ERRLINK1            XCTL                                 15400002
         EJECT                                                          15450002
**********                                                              15500002
*                                                                       15550002
*        CONSTANTS                                                      15600002
*                                                                       15650002
**********                                                              15700002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       15750002
ERLOD9   DC    F'9041'                                                  15850002
ERLOD5   DC    H'5041'                                                  15860002
ERLOD15  DC    H'5042'                                                  15900002
ERRCN8   DC    H'8'                DECIMAL 8                            16000002
PACHAREA DC    6C'604A'            PATCH AREA FOR MAINTENANCE           16050002
**********                                                              16100002
*                                                                       16150002
*        MISCELLANEOUS EQUATES                                          16200002
*                                                                       16250002
**********                                                              16300002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              16550002
L1       EQU   1                   LENGTH AND DISPLACEMENT              16600002
L2       EQU   2                   LENGTH AND DISPLACEMENT              16650002
L3       EQU   3                   LENGTH AND DISPLACEMENT              16700002
L4       EQU   4                   LENGTH AND DISPLACEMENT              16710002
L5       EQU   5                   LENGTH AND DISPLACEMENT              16712002
L6       EQU   6                   LENGTH AND DISPLACEMENT              16720002
L8       EQU   8                   LENGTH AND DISPLACEMENT              16750002
L9       EQU   9                   LENGTH AND DISPLACEMENT              16800002
L14      EQU   14                  LENGTH AND DISPLACEMENT              16850002
ERTRYCT  EQU   X'02'                                                    16900002
DCBERROP EQU   33                                                       16950002
CCWRRTXT EQU   X'20'                                                    17000002
HIBIT    EQU   X'C0'                                                    17050002
L255     EQU   X'FF'               AND MASK                             17100002
DECTYPE  EQU   4                                                        17150002
PTXTXFER EQU   X'F0'                                                    17200002
ATXTXFER EQU   X'20'                                                    17250002
TPCODE   EQU   5                                                        17300002
CCWLAST  EQU   X'80'                                                    17350002
DCBWRTRY EQU   X'40'                                                    17400002
CCWWRT   EQU   X'01'                                                    17450002
MASK15   EQU   X'0F'                                                    17500002
CCWDIAL  EQU   X'29'                                                    17550002
CCWAPOLL EQU   X'09'                                                    17600002
DECENTRY EQU   20                                                       17650002
DECERRST EQU   29                                                       17700002
UCBTYP   EQU   16                                                       17750002
SWLINE   EQU   X'90'                                                    17800002
IOBSNBOC EQU   X'20'                                                    17850002
CSWSNO   EQU   X'40'                                                    17900002
**********                                                              17950002
*                                                                       18000002
*        REGISTER DEFINITION                                            18050002
*                                                                       18100002
**********                                                              18150002
ERREG3   EQU   0                   WORK REG                             18200002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              18250002
ERREG2   EQU   2                   WORK REG                             18300002
EWAREG   EQU   3                   ERP WORKAREA BASE                    18350002
CCWREG   EQU   4                   CCW ADDRESS REG                      18400002
DECBRG   EQU   5                   DECB BASE                            18450002
DCBREG   EQU   6                   DCB BASE                             18500002
UCBREG   EQU   7                   UCB BASE                             18550002
BASEREG  EQU   8                   PROGRAM BASE                         18600002
ERREG1   EQU   9                   WORK REG                             18650002
IOBRG    EQU   10                  IOB BASE                             18700002
ERREG4   EQU   11                  WORK REG                             18750002
ERRLNK   EQU   12                  LINK REG                             18800002
NAMEREG  EQU   13                  LINK REG                             18850002
ERRETR   EQU   14                  RETURN REG                           18900002
ERREG5   EQU   15                  LINK REG/WORK REG                    18950002
         EJECT                                                          19100002
         IECDRQE                                                        19150002
         EJECT                                                          19200002
         IEZIOB                                                         19250002
         EJECT                                                          19300002
CVT      DSECT                                                          19350002
         CVT                                                            19400002
         EJECT                                                          19450002
         IECDERWA                                                       19500002
**********                                                              19550002
*                                                                       19600002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        19650002
*                                                                       19700002
**********                                                              19750002
         ORG   EWAIERP                                                  19800002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 19850002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 19900002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 19950002
EWAIND0  DS    B                   FLAG BYTE                            20000002
EWAIVISR EQU   X'10'               V=R REQUEST                          20600002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 20650002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 20700002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 20750002
EWAIND1  DS    B                   FLAG BYTE                            20800002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 20850002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 20900002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 20950002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 20960000
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 20970000
EWAIND2  DS    B                   FLAG BYTE                            21000002
EWAIND3  DS    B                   FLAG BYTE                            21050002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     21100002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  21150002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 21200002
*********  END OF BTAM LOCAL DEFINITIONS **********                     21250002
         EJECT                                                          22000002
         IECDIOSB                                                       22050002
         END                                                            22100002
./  ADD  SSI=40260014,NAME=IGE0604B
         TITLE 'IGE0604B - BTAM ERP INTERVENTION MESSAGE WRITER'        01050002
IGE0604B CSECT                                                          01100002
*********************************************************************** 01150002
*                                                                     * 01200002
* MODULE NAME:                                                        * 01250002
*    IGE0604B                                                         * 01300002
*                                                                     * 01350002
* DESCRIPTIVE NAME:                                                   * 01400002
*    BTAM INTERVENTION REQUIRED MESSAGE WRITER ERP                    * 01450002
*                                                                     * 01500002
* COPYRIGHT:                                                          * 01550002
*    NONE                                                             * 01600002
*                                                                     * 01650002
* STATUS:                                                             * 01700002
*    CHANGE LEVEL 000                                                 * 01750002
*                                                                     * 01800002
* FUNCTION:                                                           * 01850002
*    WRITES MESSAGES TO SYSTEM OPERATOR CONSOLE INDICATING THAT A     * 01900002
*    NOT OPERATIONAL START IO HAS OCCURRED.                           * 01950002
*                                                                     * 02000002
* NOTES:                                                              * 02050002
*    DEPENDENCIES:                                                    * 02100002
*        NONE                                                         * 02150002
*    RESTRICTIONS:                                                    * 02200002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 02250002
*    REGISTER CONVENTIONS:                                            * 02300002
*        SEE 'REGISTER DEFINITION' BELOW                              * 02350002
*                                                                     * 02400002
* PATCHLABEL:                                                         * 02450002
*    PACHAREA (28 BYTES)                                              * 02500002
*                                                                     * 02550002
* MODULE TYPE:                                                        * 02600002
*    PROCEDURE                                                        * 02650002
*    PROCESSOR:                                                       * 02700002
*        BAL                                                          * 02750002
*    MODULE SIZE:                                                     * 02800002
*        296 BYTES                                                    * 02850002
*    ATTRIBUTES:                                                      * 02900002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02950002
*                                                                     * 03000002
* ENTRY POINT:                                                        * 03050002
*    IGE0604B                                                         * 03100002
*    PURPOSE:                                                         * 03150002
*        SEE 'FUNCTION'                                               * 03200002
*    LINKAGE:                                                         * 03250002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 03300002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 03350002
*    INPUT:                                                           * 03400002
*        REG 1 = ADDRESS OF IOSB                                      * 03450002
*    OUTPUT:                                                          * 03500002
*        SETS INDICATOR IN DECERRST FOR NOT OPERATIONAL SIO           * 03550002
*        ISSUE MESSAGE TO SYSTEM OPERATOR                             * 03600002
*                                                                     * 03650002
* EXITS-NORMAL:                                                       * 03700002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03800002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03850002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03900002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03950002
*        LOADS ARE 1000 GREATER.                                      * 04000002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 04050002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 04100002
*                                                                     * 04150002
* EXITS-ERROR:                                                        * 04200002
*    NONE                                                             * 04250002
*                                                                     * 04300002
* EXTERNAL REFERENCES:                                                * 04350002
*    ROUTINES:                                                        * 04400002
*        WTO (SVC 35)                                                 * 04450002
*    DATA AREAS                                                       * 04600002
*        IOB (MAPPED BY IEZIOB)                                       * 04650002
*        VIRTUAL CHANNEL PROGRAM                                      * 04700002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04750002
*    CONTROL BLOCKS                                                   * 04800002
*        UCB                                                          * 04850002
*        DCB                                                          * 04900002
*        DECB                                                         * 04950002
*        IOSB         (MAPPED BY IECDIOSB)                            * 05000002
*        CVT          (MAPPED BY CVT)                                 * 05050002
*        IOB          (MAPPED BY IEZIOB)                              * 05100002
*        RQE          (MAPPED BY IECDRQE)                             * 05150002
*                                                                     * 05300002
* TABLES-WORKAREAS:                                                   * 05350002
*    ERP WORKAREA                                                     * 05400002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 05450002
*                                                                     * 05500002
* MACROS:                                                             * 05550002
*    WTO                                                              * 05600002
*                                                                     * 05650002
* CHANGE ACTIVITY:                                                    * 05700002
*    YM02595K (9/20/73)                                               * 05750002
*    YM02594K (9/24/73)                                               * 05760002
*    YM05652K (1/25/74)                                               * 05770000
*                                                                     * 05800002
*********************************************************************** 05850002
         EJECT                                                          05900002
         USING *,BASEREG                                                05950002
         LR    BASEREG,ERREG5      SET BASE REG                         06000002
         USING RQE,ERREG5                                               06050002
         USING IOSB,IOSBREG                                             06100002
         USING IOBSTDRD,IOBRG                                           06150002
         USING EWA,EWAREG                                               06200002
         L     ERREG5,IOSUSE       BASE RQE                             06250002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    06300002
         L     IOBRG,RQEIOB        BASE IOB                             06350002
         L     DECBRG,IOBECBPT     BASE DECB                            06400002
         L     DCBREG,IOBDCBPT     BASE DCB                             06450002
         L     UCBREG,IOSUCB       BASE UCB                             06500002
         DROP  ERREG5                                                   06550002
         LR    ERREG4,IOSBREG      SAVE IOSB POINTER                    06600002
         CLI   IOBINCAM+L1,L255    SPECIAL RETURN                       06650002
         BE    ERPWTO11            YES POST WITH ERROR                  06700002
         CLI   L96(IOBRG),L255     IS SIO IN OPEN                       06750002
         BNE   ERPWTO10            NO, ISSUE JUST WTO                   06800002
         L     MSGREG,L96(IOBRG)   LOAD DSECT BASE FOR OPEN WTOR        06850002
         USING MSGWTOR,MSGREG                                           06900002
         MVC   REPLYAD(M1LENGTH),MSGAREA2   MOVE MSG TO GETMAINED AREA  06950002
         MVC   MESSAGE+L8(L3),UCBNAME(UCBREG)   MOVE IN UNIT NAME       07000002
         MVC   REPLYAD+M1LENGTH(M2LENGTH),MSGAREA5   MOVE END OF MSG    07050002
         MVI   MESSAGE+L6,CA       CORRECT MESSAGE NUMBER               07100002
         MVI   MESSAGE+L5,C4       CORRECT MESSAGE NUMBER               07150002
         LA    ERREG5,REPLY        INITIALIZE REPLY ADDR                07200002
         ST    ERREG5,REPLYAD                                           07250002
         MVI   REPLYAD,L4          REPLY LENGTH                         07300002
         LA    ERREG5,ECB          INITIALIZE ECB ADDR                  07350002
         ST    ERREG5,ECBAD                                             07400002
         MVI   MSGLN+L1,M3LENGTH   CORRECT MESSAGE LENGTH               07450002
         NI    IOSFLA,L255-IOSERR                                       07550002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     07560002
         B     OPENOUT             RETURN TO OPEN                       07600002
ERPWTO10 LA    IOSBREG,EWAIAREA    PARAMETER FOR WTO                    07650002
         SR    ERREG3,ERREG3       CLEAR REG 0                          07700002
         MVC   EWAIAREA(MSGLNG),MSGAREA   MOVE PARA LIST                07750002
         MVC   TEXTIN(L3),UCBNAME(UCBREG)   LINE ADDR TO MESSAGE        07800002
         WTO   MF=(E,(1))          WRITE CU NOT OPERATIONAL             07850002
         MVI   IOBERINF+L12,ZERO                                        07900002
         MVI   IOBINCAM+L1,L255    SPECIAL RETURN                       07950002
         B     ERPWTO20            CONTINUE FLOW                        08000002
ERPWTO11 EQU   *                                                        08050002
         MVI   IOBINCAM+L1,ZERO    CLEAR SPECIAL RETURN                 08100002
         OI    DECERRST(DECBRG),SIOCC3   INDICATE NOT OPERATIONAL SIO   08150002
         NI    IOSFLA,L255-IOSERR                                       08200002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     08210002
ERPWTO20 NI    UCBBSYBT(UCBREG),L255-HIBIT                              08250002
OPENOUT  EQU   *                                                        08300002
         LR    IOSBREG,ERREG4      RESTORE IOSB POINTER                 08350002
         MVI   EWAIND1,EWAISVCF    SVC 15/SVC 3                YM05652K 08400000
         L     NAMEREG,TRANSRTN    LOAD NAME                            11100002
EREXCTL  EQU   *                                                        11150002
         L     ERRETR,CVTPTR       POINT TO CVT                         11200002
         USING CVTMAP,ERRETR                                            11250002
         L     ERRETR,CVTXTLER     XCTL ROUTINE ADDRESS                 11300002
         BR    ERRETR              EXIT VIA XCTL                        11350002
         DROP  ERRETR                                                   11400002
         EJECT                                                          11650002
**********                                                              11700002
*                                                                       11750002
*        CONSTANTS                                                      11800002
*                                                                       11850002
**********                                                              11900002
TRANSRTN DC    F'9042'            NAME OF BTAM TRANSLATE ROUTINE        11950002
MSGAREA2 DC    AL1(4)             REPLY LENGTH                          12000002
         DC    AL3(1)             REPLY ADDRESS                         12050002
MSGAREA3 DC    A(1)               ECB ADDRESS                           12100002
MSGAREA  DC    AL2(MSGAREA4-*)    MESSAGE LENGTH                        12150002
         DC    X'8000'            MCS FLAGS                             12200002
         DC    C'IEC809I '        MESSAGE                               12250002
MSGAREA1 DC    C'    '                                                  12300002
         DC    C'CONTROL UNIT NOT OPERATIONAL.'                         12350002
MSGAREA4 DC    X'1000'                                                  12400002
         DC    X'0140'                                                  12450002
MSGAREA5 DC    C' REPLY CONT OR POST  '                                 12500002
MSGAREA6 DC    X'2000'                                                  12550002
         DC    X'8140'                                                  12600002
MSGLNG   EQU   *-MSGAREA           LENGTH OF WTO PARAMETER LIST         12650002
M3LENGTH EQU   MSGAREA6-MSGAREA-4                                       12700002
M1LENGTH EQU   MSGAREA4-MSGAREA2                                        12750002
M2LENGTH EQU   MSGAREA6+4-MSGAREA5                                      12800002
ERRCN8   DC    H'8'                CONSTANT                             12850002
PACHAREA DC    7C'604B'            PATCH AREA FOR MAINTENANCE           12900002
**********                                                              12950002
*                                                                       13000002
*        MISCELLANEOUS EQUATES                                          13050002
*                                                                       13100002
**********                                                              13150002
UCBNAME  EQU   13                                                       13250002
L255     EQU   X'FF'               AND MASK                             13300002
HIBIT    EQU   X'80'                                                    13350002
UCBBSYBT EQU   6                                                        13400002
DECERRST EQU   29                                                       13450002
SIOCC3   EQU   X'80'                                                    13500002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              13650002
CA       EQU   C'A'                CHARACTER A                          13700002
C4       EQU   C'4'                CHARACTER 4                          13750002
L1       EQU   1                   LENGTH AND DISPLACEMENT              13800002
L2       EQU   2                   LENGTH AND DISPLACEMENT              13850002
L3       EQU   3                   LENGTH AND DISPLACEMENT              13900002
L4       EQU   4                   LENGTH AND DISPLACEMENT              13950002
L5       EQU   5                   LENGTH AND DISPLACEMENT              14000002
L6       EQU   6                   LENGTH AND DISPLACEMENT              14050002
L8       EQU   8                   LENGTH AND DISPLACEMENT              14100002
L12      EQU   12                  LENGTH AND DISPLACEMENT              14150002
L96      EQU   96                  LENGTH AND DISPLACEMENT              14200002
**********                                                              14350002
*                                                                       14400002
*        REGISTER DEFINITIONS                                           14450002
*                                                                       14500002
**********                                                              14550002
ERREG3   EQU   0                   WORK REG                             14600002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              14650002
ERREG2   EQU   2                   WORK REG                             14700002
EWAREG   EQU   3                   ERP WORKAREA BASE                    14750002
MSGREG   EQU   4                   WTOR PARAMETER LIST BASE             14800002
DECBRG   EQU   5                   DECB BASE                            14850002
DCBREG   EQU   6                   DCB BASE                             14900002
UCBREG   EQU   7                   UCB BASE                             14950002
BASEREG  EQU   8                   PROGRAM BASE                         15000002
ERREG1   EQU   9                   WORK REG                             15050002
IOBRG    EQU   10                  IOB BASE                             15100002
ERREG4   EQU   11                  WORK REG                             15150002
ERRLNK   EQU   12                  LINK REG                             15200002
NAMEREG  EQU   13                  LINK REG                             15250002
ERRETR   EQU   14                  LINK REG                             15300002
ERREG5   EQU   15                  WORK REG/LINK REG                    15350002
         EJECT                                                          15400002
MSGWTOR  DSECT                                                          15450002
*                                  WORKAREA FIELDS FOR OPEN WTOR        15500002
REPLYAD  DS    A                                                        15550002
ECBAD    DS    A                                                        15600002
MSGLN    DS    H                                                        15650002
MCSFLAGS DS    BL2                                                      15700002
MESSAGE  DS    CL68                                                     15750002
DSRTCDS  DS    XL4                                                      15800002
REPLY    DS    2F                                                       15850002
ECB      DS    F                                                        15900002
         EJECT                                                          15950002
         IECDRQE                                                        16000002
         EJECT                                                          16050002
         IEZIOB                                                         16100002
         EJECT                                                          16150002
CVT      DSECT                                                          16200002
         CVT                                                            16250002
         EJECT                                                          16300002
         IECDERWA                                                       16350002
**********                                                              16400002
*                                                                       16450002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        16500002
*                                                                       16550002
**********                                                              16600002
         ORG   EWAIERP                                                  16650002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 16700002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 16750002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 16800002
EWAIND0  DS    B                   FLAG BYTE                            16850002
EWAIVISR EQU   X'10'               V=R REQUEST                          17450002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 17500002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 17550002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 17600002
EWAIND1  DS    B                   FLAG BYTE                            17650002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 17700002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 17750002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 17800002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 17810000
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 17820000
EWAIND2  DS    B                   FLAG BYTE                            17850002
EWAIND3  DS    B                   FLAG BYTE                            17900002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     17950002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  18000002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 18050002
*********  END OF BTAM LOCAL DEFINITIONS **********                     18100002
TEXTIN   EQU   EWAIAREA+L12        TEXT INSERT                          18150002
         EJECT                                                          18800002
         IECDIOSB                                                       18850002
         END                                                            18900002
./  ADD  SSI=42400726,NAME=IGE0604C
         TITLE 'IGE0604C - BSC ERP LOST DATA ROUTINE'                   00450002
IGE0604C CSECT                                                          00500002
*********************************************************************** 00550002
*                                                                     * 00600002
* MODULE NAME:                                                        * 00650002
*    IGE0604C                                                         * 00700002
*                                                                     * 00750002
* DESCRIPTIVE NAME:                                                   * 00800002
*    BTAM LOST DATA ERP                                               * 00850002
*                                                                     * 00900002
* COPYRIGHT:                                                          * 00950002
*    NONE                                                             * 01000002
*                                                                     * 01050002
* STATUS:                                                             * 01100002
*    CHANGE LEVEL 000                                                 * 01150002
*                                                                     * 01200002
* FUNCTION:                                                           * 01250002
*    THIS MODULE IS ENTERED FOR LOST DATA ERRORS. DETERMINES          * 01300002
*    WHEN THE LOST DATA ERROR OCCURRED WITHIN THE CHANNEL             * 01350002
*    PROGRAM AND THEN ATTEMPTS THE APPROPRIATE RECOVERY ACTION.       * 01400002
*                                                                     * 01450002
* NOTES:                                                              * 01500002
*    DEPENDENCIES:                                                    * 01550002
*        NONE                                                         * 01600002
*    RESTRICTIONS:                                                    * 01650002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01700002
*    REGISTER CONVENTIONS:                                            * 01750002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01800002
*                                                                     * 01850002
* PATCHLABEL:                                                         * 01900002
*    PACHAREA (52 BYTES)                                              * 01950002
*                                                                     * 02000002
* MODULE TYPE:                                                        * 02050002
*    PROCEDURE                                                        * 02100002
*    PROCESSOR:                                                       * 02150002
*        BAL                                                          * 02200002
*    MODULE SIZE:                                                     * 02250002
*        534 BYTES                                                    * 02300002
*    ATTRIBUTES:                                                      * 02350002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02400002
*                                                                     * 02450002
* ENTRY POINT:                                                        * 02500002
*    IGE0604C                                                         * 02550002
*    PURPOSE:                                                         * 02600002
*        SEE 'FUNCTION'                                               * 02650002
*    LINKAGE:                                                         * 02700002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02750002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02800002
*    INPUT:                                                           * 02850002
*        REG 1 = ADDRESS OF IOSB                                      * 02900002
*    OUTPUT:                                                          * 02950002
*        POST OPERATION COMPLETE                                      * 03000002
*        ALTERED CHANNEL PROGRAM                                      * 03050002
*                                                                     * 03100002
* EXITS-NORMAL:                                                       * 03150002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03250002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03300002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03350002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03400002
*        LOADS ARE 1000 GREATER.                                      * 03450002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03500002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03550002
*                                                                     * 03600002
* EXITS-ERROR:                                                        * 03650002
*    NONE                                                             * 03700002
*                                                                     * 03750002
* EXTERNAL REFERENCES:                                                * 03800002
*    ROUTINES:                                                        * 03850002
*        NONE                                                         * 03900002
*    DATA AREAS                                                       * 04000002
*        IOB (MAPPED BY IEZIOB)                                       * 04050002
*        VIRTUAL CHANNEL PROGRAM                                      * 04100002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04150002
*    CONTROL BLOCKS                                                   * 04200002
*        DCB                                                          * 04300002
*        DECB                                                         * 04350002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04400002
*        CVT          (MAPPED BY CVT)                                 * 04450002
*        IOB          (MAPPED BY IEZIOB)                              * 04500002
*        RQE          (MAPPED BY IECDRQE)                             * 04550002
*                                                                     * 04600002
* TABLES-WORKAREAS:                                                   * 04650002
*    ERP WORKAREA                                                     * 04700002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04750002
*                                                                     * 04800002
* MACROS:                                                             * 04850002
*    NONE                                                             * 04900002
*                                                                     * 04950002
* CHANGE ACTIVITY:                                                    * 05000002
*    YM02595K (9/20/73)                                               * 05050002
*    YM02594K (9/24/73)                                               * 05100002
*    YA02160  (11/5/73)                                               * 05110002
*    YM05652K (1/25/74)                                               * 05120000
*    YA03249  (2/15/74)                                               * 05130000
*    ZA00504  (5/9/74)                                                * 05140000
*                                                                     * 05150002
*********************************************************************** 05200002
         EJECT                                                          05250002
         USING *,BASEREG                                                05300002
         LR    BASEREG,ERREG5      SET BASE REG                         05350002
         B     BEGIN               BRANCH AROUND ID            @ZA00504 05360000
         DC    C' IGE0604C '       MODULE ID                   @ZA00504 05370000
         DC    C' 4129 '           DATE LAST CHANGE            @ZA00504 05380000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY          @ZA00504 05390000
BEGIN    DS    0H                                              @ZA00504 05392000
         USING RQE,ERREG5                                               05400002
         USING IECTDECB,DECBRG                                          05450002
         USING IHADCB,DCBREG                                            05500002
         USING IOSB,IOSBREG                                             05550002
         USING IOBSTDRD,IOBRG                                           05600002
         USING EWA,EWAREG                                               05650002
         L     ERREG5,IOSUSE       BASE RQE                             05700002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05750002
         L     IOBRG,RQEIOB        BASE IOB                             05800002
         L     DECBRG,IOBECBPT     BASE DECB                            05850002
         L     DCBREG,IOBDCBPT     BASE DCB                             05900002
         DROP  ERREG5                                                   06000002
         L     CCWREG,IOBFL3       POINT TO IOB CSW                     06050002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06100002
         SH    CCWREG,ERRCN8       ADDRESS OF FAILING CCW IN IOB        06150002
         MVC   IOBWORK(L1),TPOPCODE(CCWREG)   INITIALIZE WORK AREA      06200002
         NI    IOBWORK,L255-HIBIT   CLEAR UNUSED BITS                   06250002
         CLI   ZERO(CCWREG),CCWDIAL   ERROR ON A DIAL                   06300002
         BNE   BSCLD01             NO CHECK FURTHER                     06350002
         LA    ERREG4,CCWDISAB     INDICATE DISABLE REQUIRED            06400002
         LA    ERRLNK,CHAINCDE     COMMAND CHAIN, SLI FLAGS             06450002
         LA    ERREG5,CCWTIC       2ND COMMAND                          06500002
BSCLD00A SR    ERREG2,ERREG2       NO DATA ADR REQUIRED                 06550002
BSCLD00  EQU   *                                                        06600002
         ST    ERREG2,IOBERCCW     SET UP CHAN PROG                     06650002
         STC   ERREG4,IOBERCCW     PUT IN COMMAND                       06700002
         ST    ERREG4,IOBERCCW+L4   COUNT FIELD FIRST COMMAND           06750002
         STC   ERRLNK,IOBERCCW+L4   SET CCW FLAGS                       06800002
         ST    CCWREG,IOBERCCW+L8   PUT IN TIC ADDRESS                  06850002
         STC   ERREG5,IOBERCCW+L8   SET SECOND COMMAND                  06900002
         ST    ERREG4,IOBERCCW+L12   COUNT FIELD 2ND COMMAND            06950002
         LA    CCWREG,IOBERCCW     NEW CHAN PROG START                  07000002
         CLI   IOBWORK+L1,ZERO     INTERNAL ROUTINE SPECIFIED           07100002
         BE    BSCLD00C            NO                                   07150000
         MVI   IOBERRCT+L1,RTRNSPCD   SET SPEC RTN INDICATOR            07200002
BSCLD00C EQU   *                                                        07250002
         ST    CCWREG,IOBSTART     STORE IN POINTER LOCATION            07300002
         B     BSCLD06             CHECK FOR LERB                       07800002
BSCLD01  CLI   ZERO(CCWREG),CCWREAD   ERROR ON A READ COMMAND           07850002
         BE    BSCLD02             YES CHECK FURTHER                    07900002
         CLI   ZERO(CCWREG),CCWPREP   ERROR ON PREPARE COMMAND          07950002
         BE    BSCLD06             YES CHECK FOR LERB                   08000002
         OI    DECERRST,DECSNO     SET SHOULD NOT OCCUR                 08050002
BSCLD05C EQU   *                                                        08100002
         MVI   IOBERRCT,ERRMAXCT   SET COUNT TO MAXIMUM                 08150002
         MVI   IOBERRCT+L1,RTRNCDE5   SET SPECIAL RETURN INDICATOR      08200002
BSCLD01A LA    ERREG5,CCWNOP       SET COMMAND FOR NO OPERATION         08250002
BSCLD01B LA    ERREG4,CCWREAD      SET COMMAND FOR READ                 08300002
         LA    ERRLNK,CHAINCD1     COMMAND CHAIN, SLI, SKIP FLAGS       08350002
         B     BSCLD00A            GO COMPLETE CHAN PROGRAM             08400002
BSCLD02  CLI   IOBWORK,TPOPRENQ    ERROR ON READ ENQ                    08450002
         BNE   BSCLD02E            NO, CHECK FURTHER                    08500002
         CLI   DECTYPE+L1,WRRESET   WRITE RESET CHAN PROGRAM            08550002
         BNE   BSCLD00C            NO, CONTINUE                         08600002
         MVI   IOBERRCT,ERRMAXCT   YES, SET NO RETRIES                  08700002
         B     BSCLD07             POST ERROR CONDITION                 08750002
BSCLD02E CLI   IOBWORK,TPOPRIDR    READ ID RESPONSE                     08800002
         BE    BSCLD02C            YES, GENERATE CHAN PROG              08850002
         CLI   IOBWORK,TPOPRIDE    THIS READ ENQ WITH ID                08900002
         BNE   BSCLD02B            NO, CHECK FURTHER                    08950002
         B     BSCLD00C            RETRY FAILING CCW                    09000002
BSCLD02C MVI   IOBWORK+L1,RTRNCDE3   INDICATE INTERNAL ROUTINE          09050002
         B     BSCLD02A            CONTINUE CH.PROG. GENERATN           09100002
BSCLD02B EQU   *                                                        09150002
         CLI   IOBWORK,TPOPRREN    ERROR ON READ RESP ENQ               09200002
         BNE   BSCLD04             NO CHECK FURTHER                     09250002
BSCLD02D SH    CCWREG,ERRCN8       SET CCW TO WRITE ENQ COMMAND         09300002
         LA    ERREG5,CCWTIC       SET 2ND COMMAND FOR TIC              09350002
         B     BSCLD01B            GO COMPLETE CHAN PROGRAM             09400002
BSCLD02A LA    ERREG5,CCWNOP       SECOND COMMAND                       09450002
         LA    ERRLNK,CHAINCDE     CHAINING FLAGS CC,SLI                09500002
         LA    ERREG2,IOBWORK+L2   CONSTANTS FOR CHAN                   09550002
         LA    ERREG4,CCWREAD      PROG GENERATION ROUTINE              09600002
         B     BSCLD00             GENERATE CHANNEL PROGRAM             09650002
BSCLD04  CLI   IOBWORK,TPOPDTXT                                         09700002
         BNE   BSCLD04A                                                 09750002
         MVC   IOBWORK+L2(L1),DECTYPE+L1   OPERATION TYPE CODE          09800002
         NI    IOBWORK+L2,MASK1    ZERO OUT UNUSED HALF                 09850002
         TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFERING USED               09900002
         BO    BSCLD05C            YES, POST WITH ERROR                 09950002
         CLI   IOBWORK+L2,DECCONV   CONVERSATIONAL WRITE                10000002
         BL    BSCLD05A            NO CHECK FOR POLL                    10050002
         SH    CCWREG,ERRCN8       BACK UP TO RD RESP TO TXT            10100002
BSCLD05  MVI   IOBWORK+L1,RTRNCDE2   INDICATE INTERNAL ROUTINE          10150002
         B     BSCLD02A            COMPLETE CHANNEL PROG                10200002
BSCLD04A EQU   *                                                        10250002
         CLI   IOBWORK,TPOPRRTX    THIS READ RESP TO TEXT               10300002
         BNE   BSCLD100                                                 10350002
         MVI   IOBWORK+L1,RTRNCDE3   SPEC RETURN 3O45                   10400002
         B     BSCLD01A            GENERATE CHAN PROGRAM                10450002
BSCLD100 CLI   IOBWORK,TPOPRRAD    READ RESP TO ADDRESSING              10500002
         BE    BSCLD08             YES, SET UP RETRY                    10550002
         OI    DECERRST,DECSNO     SET SHOULD NOT OCCUR                 10600002
         CLI   L5(CCWREG),ZERO     ERP CCW                              10650002
         BNE   BSCLD05C            NO SET PER ERROR                     10700002
         L     CCWREG,IOBERCCW+L8   YES PICK UP RESTART ADDRESS         10750002
         LA    ERREG5,CCWTIC       SET COMMAND FOR TIC                  10800002
         B     BSCLD01B            GO FINISH CHANNEL PROGRAM            10850002
BSCLD05A CLI   IOBCPA,CCWAPOLL     THIS AN AUTOPOLL DEVICE              10900002
         BNE   BSCLD05             NO, SET UP CHAN PROG                 10950002
         LR    ERREG1,CCWREG       POINT TO CURRENT CCW                 11000002
         SH    ERREG1,ERRCN8       BACK UP ONE                          11050002
         L     ERREG1,ZERO(ERREG1)   GET AREA ADDRESS                   11100002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE (INDEX BYTE)             11150002
         C     ERREG1,ZERO(CCWREG)   HAS COUNT BEEN ADJUSTED            11200002
         BE    BSCLD05             YES, CONTINUE                        11250002
         STCM  ERREG1,L7,L1(CCWREG)   NO, RESTORE READ         @ZA00504 11300000
         LH    ERREG1,L6(CCWREG)   PICK UP COUNT                        11350002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE                          11400002
         STH   ERREG1,L6(CCWREG)   STORE                                11450002
         LA    ERREG2,DCBBSNAK     GET NAK                      YA03249 11500000
         LA    ERREG4,CCWWRITE     GET OP TYPE                  YA03249 11510000
         LA    ERRLNK,CHAINCDE     GET CCW FLAGS                YA03249 11520000
         LA    ERREG5,CCWTIC       GET TIC OP TYPE              YA03249 11530000
         MVI   IOBWORK+L1,RTRNCDE2   SET SPECIAL RETURN         YA03249 11540000
         B     BSCLD00             GENERATE CHAN PROG           YA03249 11550000
BSCLD08  LA    CCWREG,IOBCPA       START OF CHAN PROG                   11600002
         B     BSCLD00C            GO STORE IN IOBSTART                 11650002
BSCLD06  EQU   *                                                        11700002
BSCLD06A CLI   IOBERRCT,ERRMAXCT   ANY RETRIES LEFT                     11750002
         BNL   BSCLD07             NO SET PERM ERROR                    11800002
         IC    ERREG1,IOBERRCT     PICK UP LAST COUNT                   11850002
         LA    ERREG1,L1(ERREG1)   BUMP OLD COUNT                       11900002
         STC   ERREG1,IOBERRCT     STORE NEW COUNT                      11950002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 11960000
RETRY    EQU   *                                                        12000002
         L     NAMEREG,TRANSRTN    LOAD NAME                            14750002
         B     XCTLOUT             XCTL                                 14800002
BSCLD07  NI    IOSFLA,L255-IOSERR   SET PERM ERROR INDICATOR            15050002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     15100002
         LA    NAMEREG,ERLOD25                                          15150002
XCTLOUT  EQU   *                                                        15200002
         L     ERRETR,CVTPTR       POINT TO CVT                         15250002
         USING CVTMAP,ERRETR                                            15300002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                15350002
         DROP  ERRETR                                                   15400002
         BR    ERRETR              XCTL                                 15450002
         EJECT                                                          15500002
**********                                                              15550002
*                                                                       15600002
*        CONSTANTS                                                      15650002
*                                                                       15700002
**********                                                              15750002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       15800002
ERRCN8   DC    H'8'                                                     15850002
PACHAREA DC    13C'604C'           PATCHAREA FOR MAINTENANCE            15900002
**********                                                              15950002
*                                                                       16000002
*        MISCELLANEOUS EQUATES                                          16050002
*                                                                       16100002
**********                                                              16150002
CCWDIAL  EQU   X'29'                                                    16300002
CCWWRITE EQU   X'01'               WRITE OP TYPE                YA03249 16310000
CCWDISAB EQU   47                                                       16350002
CCWNOP   EQU   3                                                        16400002
TPOPDTXT EQU   X'11'                                                    16450002
TPOPRRAD EQU   X'06'               READ RESP TO ADDRESSING              16500002
TPOPRIDE EQU   X'03'                                                    16550002
TPOPRRTX EQU   X'25'                                                    16600002
CHAINCDE EQU   X'60'                                                    16650002
TPOPRIDR EQU   X'07'                                                    16700002
RTRNSPCD EQU   X'14'                                                    16750002
RTRNCDE5 EQU   X'1A'                                                    16800002
RTRNCDE3 EQU   X'83'                                                    16850002
RTRNCDE2 EQU   X'82'                                                    16900002
MASK1    EQU   X'0F'                                                    16950002
CHAINCD1 EQU   X'70'                                                    17000002
TPOPCODE EQU   5                                                        17050002
L255     EQU   X'FF'               AND MASK                             17100002
DECCONV  EQU   X'0D'                                                    17150002
CCWREAD  EQU   X'02'                                                    17200002
HIBIT    EQU   X'C0'                                                    17250002
DECSNO   EQU   X'40'                                                    17300002
ERRMAXCT EQU   7                                                        17350002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              17400002
L1       EQU   1                   LENGTH AND DISPLACEMENT              17450002
L2       EQU   2                   LENGTH AND DISPLACEMENT              17500002
L3       EQU   3                   LENGTH AND DISPLACEMENT              17550002
L4       EQU   4                   LENGTH AND DISPLACEMENT              17600002
L5       EQU   5                   LENGTH AND DISPLACEMENT              17650002
L6       EQU   6                   LENGTH AND DISPLACEMENT              17700002
L7       EQU   7                   LENGTH AND DISPLACEMENT     @ZA00504 17710000
L8       EQU   8                   LENGTH AND DISPLACEMENT              17750002
L12      EQU   12                  LENGTH AND DISPLACEMENT              17800002
TPOPRENQ EQU   X'0B'                                                    17950002
TPOPRREN EQU   X'0C'                                                    18000002
DYNBUF   EQU   X'08'                                                    18050002
CCWAPOLL EQU   X'09'                                                    18100002
CCWPREP  EQU   X'06'                                                    18150002
CCWTIC   EQU   X'08'                                                    18200002
ERLOD25  EQU   2043                                                     18250002
WRRESET  EQU   X'0A'                                                    18300002
**********                                                              18450002
*                                                                       18500002
*        REGISTER DEFINITION                                            18550002
*                                                                       18600002
**********                                                              18650002
ERREG3   EQU   0                   WORK REG                             18700002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              18750002
ERREG2   EQU   2                   WORK REG                             18800002
EWAREG   EQU   3                   ERP WORKAREA BASE                    18850002
CCWREG   EQU   4                   CCW ADDRESS REG                      18900002
DECBRG   EQU   5                   DECB BASE                            18950002
DCBREG   EQU   6                   DCB BASE                             19000002
UCBREG   EQU   7                   UCB BASE                             19050002
BASEREG  EQU   8                   PROGRAM BASE                         19100002
ERREG1   EQU   9                   WORK REG                             19150002
IOBRG    EQU   10                  IOB BASE                             19200002
ERREG4   EQU   11                  WORK REG                             19250002
ERRLNK   EQU   12                  LINK REG                             19300002
NAMEREG  EQU   13                  LINK REG                             19350002
ERRETR   EQU   14                  LINK REG                             19400002
ERREG5   EQU   15                  LINK REG/WORK REG                    19450002
         EJECT                                                          19500002
         DCBD  DSORG=BX,DEVD=BS              DCB DESECT MACRO           19550002
         EJECT                                                          19600002
         IECTDECB                                                       19650002
         EJECT                                                          19700002
         IECDRQE                                                        19750002
         EJECT                                                          19800002
         IEZIOB                                                         19850002
         EJECT                                                          19900002
CVT      DSECT                                                          19950002
         CVT                                                            20000002
         EJECT                                                          20050002
         IECDERWA                                                       20100002
**********                                                              20150002
*                                                                       20200002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        20250002
*                                                                       20300002
**********                                                              20350002
         ORG   EWAIERP                                                  20400002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 20450002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 20500002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 20550002
EWAIND0  DS    B                   FLAG BYTE                            20600002
EWAIVISR EQU   X'10'               V=R REQUEST                          21200002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 21250002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 21300002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 21350002
EWAIND1  DS    B                   FLAG BYTE                            21400002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 21450002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 21500002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 21550002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 21560000
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 21570000
EWAIND2  DS    B                   FLAG BYTE                            21600002
EWAIND3  DS    B                   FLAG BYTE                            21650002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     21700002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  21750002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 21800002
*********  END OF BTAM LOCAL DEFINITIONS **********                     21850002
         EJECT                                                          22500002
         IECDIOSB                                                       22550002
         END                                                            22600002
./  ADD  SSI=40260016,NAME=IGE0704A
         TITLE 'IGE0704A - READ/SKIP WRITE/BREAK CHECK MODULE'          00070002
IGE0704A CSECT                                                          00120002
*********************************************************************** 00170002
*                                                                     * 00220002
* MODULE NAME:                                                        * 00270002
*    IGE0704A                                                         * 00320002
*                                                                     * 00370002
* DESCRIPTIVE NAME:                                                   * 00420002
*    BTAM READ/SKIP WRITE/BREAK CHECK ERP                             * 00470002
*                                                                     * 00520002
* COPYRIGHT:                                                          * 00570002
*    NONE                                                             * 00620002
*                                                                     * 00670002
* STATUS:                                                             * 00720002
*    CHANGE LEVEL 000                                                 * 00770002
*                                                                     * 00820002
* FUNCTION:                                                           * 00870002
*    THIS MODULE DETERMINES IF A WRITE/BREAK WAS ISSUED. IF A LOST    * 00920002
*    DATA ERROR HAS OCCURRED EXIT IS MADE TO THE LOST DATA ROUTINE.   * 00970002
*    IF NECESSARY, THE CHANNEL PROGRAM IS RETRIED.                    * 01020002
*                                                                     * 01070002
* NOTES:                                                              * 01120002
*    DEPENDENCIES:                                                    * 01170002
*        NONE                                                         * 01220002
*    RESTRICTIONS:                                                    * 01270002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01320002
*    REGISTER CONVENTIONS:                                            * 01370002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01420002
*                                                                     * 01470002
* PATCHLABEL:                                                         * 01520002
*    PACHAREA (48 BYTES)                                              * 01570002
*                                                                     * 01620002
* MODULE TYPE:                                                        * 01670002
*    PROCEDURE                                                        * 01720002
*    PROCESSOR:                                                       * 01770002
*        BAL                                                          * 01820002
*    MODULE SIZE:                                                     * 01870002
*        474 BYTES                                                    * 01920002
*    ATTRIBUTES:                                                      * 01970002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE,                 * 02020002
*        LOCAL LOCK HELD ACCROSS POST CALL                            * 02070002
*                                                                     * 02120002
* ENTRY POINT:                                                        * 02170002
*    IGE0704A                                                         * 02220002
*    PURPOSE:                                                         * 02270002
*        SEE 'FUNCTION'                                               * 02320002
*    LINKAGE:                                                         * 02370002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02420002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02470002
*    INPUT:                                                           * 02520002
*        REG 1 = ADDRESS OF IOSB                                      * 02570002
*    OUTPUT:                                                          * 02620002
*        SETS INDICATOR FOR ERROR IN ERP EXCP.                        * 02670002
*        SETS INDICATOR IN DECERRST FOR NOT OPERATIONAL SIO           * 02720002
*        ALTERED CHANNEL PROGRAM                                      * 02770002
*                                                                     * 02820002
* EXITS-NORMAL:                                                       * 02870002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 02970002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03020002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03070002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03120002
*        LOADS ARE 1000 GREATER.                                      * 03170002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03220002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03270002
*                                                                     * 03320002
* EXITS-ERROR:                                                        * 03370002
*    NONE                                                             * 03420002
*                                                                     * 03470002
* EXTERNAL REFERENCES:                                                * 03520002
*    ROUTINES:                                                        * 03570002
*        POST                                                         * 03620002
*    DATA AREAS                                                       * 03770002
*        IOB (MAPPED BY IEZIOB)                                       * 03820002
*        VIRTUAL CHANNEL PROGRAM                                      * 03870002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 03920002
*    CONTROL BLOCKS                                                   * 03970002
*        UCB                                                          * 04020002
*        DCB                                                          * 04070002
*        DECB                                                         * 04120002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04170002
*        CVT          (MAPPED BY CVT)                                 * 04220002
*        IOB          (MAPPED BY IEZIOB)                              * 04270002
*        RQE          (MAPPED BY IECDRQE)                             * 04320002
*                                                                     * 04470002
* TABLES-WORKAREAS:                                                   * 04520002
*    ERP WORKAREA                                                     * 04570002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04620002
*                                                                     * 04670002
* MACROS:                                                             * 04720002
*    SETLOCK                                                          * 04770002
*                                                                     * 04820002
* CHANGE ACTIVITY:                                                    * 04870002
*    YM02595K (9/20/73)                                               * 04920002
*    YM02594K (9/24/73)                                               * 04930002
*    YM05652K (1/24/74)                                               * 04940000
*                                                                     * 04970002
*********************************************************************** 05020002
         EJECT                                                          05070002
         USING *,BASEREG                                                05120002
         LR    BASEREG,ERREG5      SET BASE REG                         05170002
         USING RQE,ERREG5                                               05220002
         USING IOSB,IOSBREG                                             05270002
         USING IOBSTDRD,IOBRG                                           05320002
         USING EWA,EWAREG                                               05370002
         L     ERREG5,IOSUSE       BASE RQE                             05420002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05470002
         L     IOBRG,RQEIOB        BASE IOB                             05520002
         L     DECBRG,IOBECBPT     BASE DECB                            05570002
         L     DCBREG,IOBDCBPT     BASE DCB                             05620002
         L     UCBREG,IOSUCB       BASE UCB                             05670002
         DROP  ERREG5                                                   05720002
         L     CCWREG,IOBFL3       POINT TO CCW                         05770002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                05820002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                05870002
         CLI   ZERO(CCWREG),CCWWRTBK   WAS A WRITE BREAK ISSUED         05920002
         BNE   ERRCHK03            NO DETERMINE ENTRY POINT             05970002
         TM    IOBCSW+L3,L255-CSWCDE   IS THIS NORMAL COMPLETION        06020002
         BNZ   ERRCHK01            NO DETERMINE FAILURE TYPE            06070002
         CLI   IOBCSW+L4,ZERO      EXAMINE SECOND STATUS BYTE           06120002
         BE    ERRCHK03            NO ERROR CONTINUE NORMAL OPER.       06170002
ERRCHK01 CLI   IOBCSW+L3,CSWCDEUC   ERROR UNIT CHECK WITH CHAN END      06220002
         BNE   ERRCHK19            NO INDICATE ERP AND SNO ERROR        06270002
         TM    IOBSENS0,IOBSNDC    DATA CHECK ERROR                     06320002
         BO    ERRCHK02            YES CHECK XFER COUNT IN CCW          06370002
         TM    IOBSENS0,IOBSNBOC   BUSSOUT ERROR                        06420002
         BO    ERRCHK03            NORMAL ERROR CONTINUE PROCESSNG      06470002
         B     ERRCHK19            INDICATE ERP AND SNO ERROR           06520002
ERRCHK02 CLI   L7(CCWREG),MASK15   FIRST WRITE BREAK                    06570002
         BNE   ERRCHK19            NO INDICATE ERP AND SNO ERROR        06620002
         LH    ERREG1,L6(CCWREG)   PICK UP WRITE COUNT                  06670002
         SLL   ERREG1,L1           DOUBLE WRITE COUNT                   06720002
         STH   ERREG1,L6(CCWREG)   STORE NEW COUNT                      06770002
         B     RETRY               GO TRANSLATE                         07220002
ERRCHK03 CLI   IOBERRCT+L1,ERRLDIND   LOST DATA FAILURE                 07670002
         BE    ERRCHK11            YES GO TO LOST DATA ERROR ENTRY      07720002
         L     ERREG2,IOBERINF     POINTER TO ORIGINAL FAILING CCW      07770002
         SH    ERREG2,ERRCN8       ADJUST TO REAL FAILING CCW           07820002
         MVC   IOBWORK(L1),TPCODE(ERREG2)   PICK UP TP OP CODE          07870002
         NI    IOBWORK,L255-HIBIT   CLEAR UNWANTED BITS                 07920002
         TM    IOBWORK,CCWAFTXT    ERROR AFTER TEXT TRANSFER            07970002
         BZ    ERRCHK06            NO CHECK FOR DYNAMIC BUFFERING       08020002
ERRCHK04 ST    ERREG2,IOBSTART     SET CPA TO FAILING CCW               08070002
ERRCHK05 CLI   IOBERRCT,ERTRYCT    MORE RETRIES NECESSARY               08570002
         BNL   ERRCHK07            NO CHECK FOR DISABLE REQUIRED        08620002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  08670002
         LA    ERREG1,L1(ERREG1)   BUMP COUNT BY ONE                    08720002
         STC   ERREG1,IOBERRCT     STORE NEW COUNT                      08770002
         MVI   IOBERRCT+L1,ZERO    INDICATE NORMAL RETURN               08820002
RETRY    EQU   *                                                        08870002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 08920000
         L     NAMEREG,TRANSRTN    LOAD NAME                            10520002
         B     ERRCHK08            XCTL                                 10570002
ERRCHK06 TM    DCBBFTEK(DCBREG),DCBDYNBF   DYNAMIC BUFFERING SPECIFIED  13670002
         BO    ERRCHK10            YES POST COMPLETE WITH ERROR         13720002
         LA    ERREG2,IOBCPA       SET CPA TO START OF CHAN PROG.       13770002
         B     ERRCHK04            RETRY CHAN PROGRAM                   13820002
ERRCHK07 TM    UCBTYP+L1(UCBREG),SWLINE   DISABLE REQUIRED              13870002
         BZ    ERRCHK10            NO POST WITH ERROR                   13920002
         LA    NAMEREG,ERLOD3      ADDRESS OF DISABLE ROUTINE           13970002
ERRCHK08 EQU   *                                                        14020002
         L     ERRETR,CVTPTR       POINT TO CVT                         14070002
         USING CVTMAP,ERRETR                                            14120002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                14170002
         DROP  ERRETR                                                   14220002
         BR    ERRETR              XCTL                                 14270002
ERRCHK19 OI    DECERRST(DECBRG),DECERPER   INDICATE ERROR IN ERP EXCP   14320002
ERRCHK09 OI    DECERRST(DECBRG),CSWSNO   INDICATE SHOULD NOT OCCUR      14370002
ERRCHK10 MVC   IOBSENS0(L1),IOBERINF   RESTORE SENSE DATA               14420002
         MVC   IOBCSW(L7),IOBERINF+L1   RESTORE CSW DATA                14470002
         L     ERREG2,IOBFL3       PICK UP CCW POINTER                  14570002
         LA    ERREG2,ZERO(ERREG2)   CLEAR OUT FLAG BYTE                14620002
         SH    ERREG2,ERRCN8       ADJUST TO FAILING CCW                14670002
         MVC   ZERO(L8,ERREG2),IOBERINF+L8   RESTORE FAILING CCW        14720002
         OI    IOSFLB,IOSLOG       INDICATE OBR REQUIRED                14770002
         LH    NAMEREG,ERLOD5      ADDRESS OF ERROR POST                14820002
         B     ERRCHK08            LINK TO POST ROUTINE                 14870002
ERRCHK11 LA    NAMEREG,ERLOD14     ADDRESS OF LOST DATA CHECK RTNE      14920002
         B     ERRCHK08            XCTL                                 14970002
ERRCHK15 LA    CCWREG,IOBCPA+L24   POINT TO FOURTH CCW                  15020002
         TM    L5(CCWREG),X11      READ OR WIRTE TEXT                   15070002
         BNO   ERRCHK10            NO, DON'T POST BUFFER                15120002
         L     ERREG4,ZERO(CCWREG)   POINT TO BUFFER                    15170002
         N     ERREG4,MASK         AND TO FULLWORD BOUNDARY             15220002
         SH    ERREG4,ERRCN4       POINT TO BUFFER LINK FIELD           15270002
         TM    ZERO(ERREG4),X80    IS WAIT BIT ON                       15320002
         BNO   ERRCHK10            NO, DON'T POST BUFFER                15370002
         STM   ERREG3,ERREG5,EWAIAREA   SAVE REGS 0-15                  15420002
GET      SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(LOCAL,IGE0704A(X15470002
               REL))               GET LOCAL LOCK                       15520002
         L     ERREG4,EWAIAREA+L44   RESTORE REG 11                     15570002
         L     IOBRG,ZERO(ERREG4)   GET BUFFER CHAIN ADDRESS            15620002
         LA    IOBRG,ZERO(IOBRG)   CLEAR HIGH ORDER BYTE                15670002
         O     IOBRG,POSTCODE      OR IN COMPLETION CODE                15720002
         LA    ERRLNK,L1           GET A ONE                            15730002
         SLL   ERRLNK,L31          MOVE TO SIGN POSITION                15740002
         OR    ERREG4,ERRLNK       POST WITH ECB                        15750002
         SR    ERRLNK,ERRLNK       MEMORY RELAYED POST                  15760002
         L     NAMEREG,IOSSRB      POINT TO SRB                         15762002
         USING SRB,NAMEREG                                              15764002
         L     NAMEREG,SRBASCB     POINT TO ASCB                        15766002
         DROP  NAMEREG                                                  15768002
         L     ERREG5,CVTPTR       POINT TO CVT                         15770002
         USING CVTMAP,ERREG5                                            15820002
         L     ERREG5,CVT0PT01     ADDRESS OF POST BARNCH ENTRY         15870002
         DROP  ERREG5                                                   15920002
         BALR  ERRETR,ERREG5       LINK TO POST BUFFER                  15970002
REL      SETLOCK RELEASE,TYPE=LOCAL,RELATED=(LOCAL,IGE0704A(GET))       16020002
         LM    ERREG3,ERREG5,EWAIAREA   RESTORE REGS 1-15               16070002
         B     ERRCHK10            CONTINUE PROCESSING                  16120002
         EJECT                                                          16170002
**********                                                              16220002
*                                                                       16270002
*        CONSTANTS                                                      16320002
*                                                                       16370002
**********                                                              16420002
         DS    0F                                                       16470002
POSTCODE DC    X'41000000'                                              16520002
MASK     DC    X'00FFFFFC'                                              16570002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       16580002
ERRCN4   DC    H'4'                                                     16620002
ERRCN8   DC    H'8'                                                     16670002
ERLOD5   DC    H'5041'                                                  16720002
PACHAREA DC    12C'704A'           PATCH AREA FOR MAINTENANCE           16820002
**********                                                              16870002
*                                                                       16920002
*        MISCELLANEOUS EQUATES                                          16970002
*                                                                       17020002
**********                                                              17070002
CCWWRTBK EQU   X'0D'                                                    17170002
L255     EQU   X'FF'               AND MASK                             17220002
CSWCDE   EQU   X'0C'                                                    17270002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              17320002
L1       EQU   1                   LENGTH AND DISPLACEMENT              17370002
L2       EQU   2                   LENGTH AND DISPLACEMENT              17420002
L3       EQU   3                   LENGTH AND DISPLACEMENT              17470002
L4       EQU   4                   LENGTH AND DISPLACEMENT              17520002
L5       EQU   5                   LENGTH AND DISPLACEMENT              17570002
L6       EQU   6                   LENGTH AND DISPLACEMENT              17620002
L7       EQU   7                   LENGTH AND DISPLACEMENT              17670002
L8       EQU   8                   LENGTH AND DISPLACEMENT              17720002
L9       EQU   9                   LENGTH AND DISPLACEMENT              17770002
L24      EQU   24                  LENGTH AND DISPLACEMENT              17820002
L31      EQU   31                  LENGTH AND DISPLACEMENT              17822002
L44      EQU   44                  LENGTH AND DISPLACEMENT              17830002
X11      EQU   X'11'                                                    17870002
X80      EQU   X'80'                                                    17920002
CSWCDEUC EQU   X'0E'                                                    17970002
IOBSNDC  EQU   X'80'                                                    18020002
IOBSNBOC EQU   X'20'                                                    18070002
MASK15   EQU   X'0F'                                                    18120002
ERRLDIND EQU   X'08'                                                    18270002
DECERRST EQU   29                                                       18320002
TPCODE   EQU   5                                                        18370002
HIBIT    EQU   X'C0'                                                    18420002
CCWAFTXT EQU   X'20'                                                    18470002
ERTRYCT  EQU   X'02'                                                    18520002
UCBTYP   EQU   16                                                       18570002
DCBBFTEK EQU   32                                                       18620002
DCBDYNBF EQU   X'08'                                                    18670002
DECERPER EQU   X'20'                                                    18720002
CSWSNO   EQU   X'40'                                                    18770002
SWLINE   EQU   X'90'                                                    18820002
ERLOD3   EQU   3041                                                     18870002
ERLOD14  EQU   4042                                                     18920002
**********                                                              18970002
*                                                                       19020002
*        REGISTER DEFINITION                                            19070002
*                                                                       19120002
**********                                                              19170002
ERREG3   EQU   0                   WORK REG                             19220002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              19270002
ERREG2   EQU   2                   WORK REG                             19320002
EWAREG   EQU   3                   ERP WORKAREA BASE                    19370002
CCWREG   EQU   4                   CCW ADDRESS REG                      19420002
DECBRG   EQU   5                   DECB BASE                            19470002
DCBREG   EQU   6                   DCB BASE                             19520002
UCBREG   EQU   7                   UCB BASE                             19570002
BASEREG  EQU   8                   PROGRAM BASE                         19620002
ERREG1   EQU   9                   WORK REG                             19670002
IOBRG    EQU   10                  IOB BASE                             19720002
ERREG4   EQU   11                  WORK REG                             19770002
ERRLNK   EQU   12                  LINK REG                             19820002
NAMEREG  EQU   13                  LINK REG                             19870002
ERRETR   EQU   14                  LINK REG                             19920002
ERREG5   EQU   15                  WORK REG/LINK REG                    19970002
         EJECT                                                          20020002
         IHAPSA                                                         20070002
         EJECT                                                          20220002
         IECDRQE                                                        20270002
         EJECT                                                          20320002
         IEZIOB                                                         20370002
         EJECT                                                          20420002
CVT      DSECT                                                          20470002
         CVT                                                            20520002
         EJECT                                                          20570002
         IECDERWA                                                       20620002
**********                                                              20670002
*                                                                       20720002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        20770002
*                                                                       20820002
**********                                                              20870002
         ORG   EWAIERP                                                  20920002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 20970002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 21020002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 21070002
EWAIND0  DS    B                   FLAG BYTE                            21120002
EWAIVISR EQU   X'10'               V=R REQUEST                          21720002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 21770002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 21820002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 21870002
EWAIND1  DS    B                   FLAG BYTE                            21920002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 21970002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 22020002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 22070002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 22080000
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 22090000
EWAIND2  DS    B                   FLAG BYTE                            22120002
EWAIND3  DS    B                   FLAG BYTE                            22170002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     22220002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  22270002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 22320002
*********  END OF BTAM LOCAL DEFINITIONS **********                     22370002
         EJECT                                                          23030002
         IHASRB                                                         23040002
         EJECT                                                          23170002
         IECDIOSB                                                       23220002
         END                                                            23270002
./  ADD  SSI=40430490,NAME=IGE0704B
         TITLE '  IGE0704B - 3270 ERROR POST '                          00100002
IGE0704B CSECT                                                          00150002
*********************************************************************** 00200002
*                                                                     * 00250002
* MODULE NAME:                                                        * 00300002
*    IGE0704B                                                         * 00350002
*                                                                     * 00400002
* DESCRIPTIVE NAME:                                                   * 00450002
*    BTAM 3270 ERROR POST ERP                                         * 00500002
*                                                                     * 00550002
* COPYRIGHT:                                                          * 00600002
*    NONE                                                             * 00650002
*                                                                     * 00700002
* STATUS:                                                             * 00750002
*    CHANGE LEVEL 000                                                 * 00800002
*                                                                     * 00850002
* FUNCTION:                                                           * 00900002
*    THIS MODULE IS AN ADDITIONAL LOAD OF THE BSC ERP AND IS XCTL'D   * 00950002
*    TO BY BSC ERP CONTROL (IGE0004C). IT FORMATS THE T-TYPE RECORD   * 01000002
*    USING INFORMATION IN THE ERROR STATUS MESSAGE (SOH%R MESSAGE)    * 01050002
*    FOR THE DEVICES OF THE REMOTE 3270 DISPLAY SYSTEM.               * 01100002
*                                                                     * 01150002
* NOTES:                                                              * 01200002
*    DEPENDENCIES:                                                    * 01250002
*        TRANSLATE TABLE AND CODE TO PROCESS ASCII DATA ARE CHARACTER * 01300002
*        CODE DEPENDENT.                                              * 01350002
*    RESTRICTIONS:                                                    * 01400002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01450002
*    REGISTER CONVENTIONS:                                            * 01500002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01550002
*                                                                     * 01600002
* PATCHLABEL:                                                         * 01650002
*    PACHAREA (36 BYTES)                                              * 01700002
*                                                                     * 01750002
* MODULE TYPE:                                                        * 01800002
*    PROCEDURE                                                        * 01850002
*    PROCESSOR:                                                       * 01900002
*        BAL                                                          * 01950002
*    MODULE SIZE:                                                     * 02000002
*        366 BYTES                                                    * 02050002
*    ATTRIBUTES:                                                      * 02100002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 02150002
*                                                                     * 02200002
* ENTRY POINT:                                                        * 02250002
*    IGE0704B                                                         * 02300002
*    PURPOSE:                                                         * 02350002
*        SEE 'FUNCTION'                                               * 02400002
*    LINKAGE:                                                         * 02450002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02500002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02550002
*    INPUT:                                                           * 02600002
*        REG 1 = ADDRESS OF IOSB                                      * 02650002
*    OUTPUT:                                                          * 02700002
*        BSC3: IOBERINF+4: T-TYPE RECORD WITH THE FOLLOWING FORMAT:   * 02750002
*       +++++++++++++++++++++++++++++++++++++++++++++++++++++++       * 02800002
*       +        +        +        +        +        +        +       * 02850002
*    +0 +     BUFFER      +   NOT  +    XCTL INFO    + RECORD +       * 02900002
*       +      SIZE       +  USED  +        +        +   ID   +       * 02950002
*       +        +        +        +        +        +        +       * 03000002
*       +++++++++++++++++++++++++++++++++++++++++++++++++++++++       * 03050002
*       +        +        +        +        +        +        +       * 03100002
*    +6 +  CHANNEL/UNIT   +   CU   +   DS   +  STAT1 +  STAT2 +       * 03150002
*       +    ADDRESS      +        +        +        +        +       * 03200002
*       +        +        +        +        +        +        +       * 03250002
*       +++++++++++++++++++++++++++++++++++++++++++++++++++++++       * 03300002
*                                                                     * 03350002
*       BSC2: IOBERINF+0: MDR (T-TYPE) RECORD WITH THE FOLLOWING      * 03400002
*       FORMAT:                                                       * 03450002
*       +++++++++++++++++++++++++++++++++++++++++++++++++++++++       * 03500002
*       +        +        +        +        +        +        +       * 03550002
*    +0 +     BUFFER      + SUB-ID +    XCTL INFO    + RECORD +       * 03600002
*       +      SIZE       +  INFO  +        +        +   ID   +       * 03650002
*       +        +        +        +        +        +        +       * 03700002
*       +++++++++++++++++++++++++++++++++++++++++++++++++++++++       * 03750002
*       +        +        +        +        +        +        +       * 03800002
*    +6 +  CHANNEL/UNIT   +     T E R M I N A L     I D       +       * 03850002
*       +    ADDRESS      +        +        +        +        +       * 03900002
*       +        +        +        +        +        +        +       * 03950002
*       +++++++++++++++++++++++++++++++++++++++++++++++++++++++       * 04000002
*       +        +        +                                           * 04050002
*       +  STAT1 +  STAT2 +                                           * 04100002
*    +C +        +        +                                           * 04150002
*       +        +        +                                           * 04200002
*       +++++++++++++++++++                                           * 04250002
*                                                                     * 04300002
* EXITS-NORMAL:                                                       * 04350002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 04400002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 04450002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 04500002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 04550002
*        LOADS ARE 1000 GREATER.                                      * 04600002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 04650002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 04700002
*                                                                     * 04750002
* EXITS-ERROR:                                                        * 04800002
*    NONE                                                             * 04850002
*                                                                     * 04900002
* EXTERNAL REFERENCES:                                                * 04950002
*    ROUTINES:                                                        * 05000002
*        NONE                                                         * 05050002
*    DATA AREAS                                                       * 05100002
*        IOB (MAPPED BY IEZIOB)                                       * 05150002
*        VIRTUAL CHANNEL PROGRAM                                      * 05200002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 05250002
*    CONTROL BLOCKS                                                   * 05300002
*        UCB                                                          * 05350002
*        DCB                                                          * 05400002
*        DECB                                                         * 05450002
*        IOSB         (MAPPED BY IECDIOSB)                            * 05500002
*        CVT          (MAPPED BY CVT)                                 * 05550002
*        IOB          (MAPPED BY IEZIOB)                              * 05600002
*        RQE          (MAPPED BY IECDRQE)                             * 05650002
*                                                                     * 05700002
* TABLES-WORKAREAS:                                                   * 05750002
*    ERP WORKAREA                                                     * 05800002
*    IOB CHANNEL PROGRAM AREA                                         * 05850002
*                                                                     * 05900002
* MACROS:                                                             * 05950002
*    NONE                                                             * 06000002
*                                                                     * 06050002
* CHANGE ACTIVITY:                                                    * 06100002
*    YM02595K (9/20/73)                                               * 06150002
*    YM02594K (9/24/73)                                               * 06200002
*    YM05652K (1/24/74)                                               * 06210000
*    YA03260  (2/4/74)                                                * 06220000
*                                                                     * 06250002
*********************************************************************** 06300002
         EJECT                                                          06350002
         USING *,BASEREG                                                06400002
         LR    BASEREG,ERREG5      SET BASE REG                         06450002
         USING RQE,ERREG5                                               06500002
         USING IOSB,IOSBREG                                             06550002
         USING IOBSTDRD,IOBRG                                           06600002
         USING EWA,EWAREG                                               06650002
         USING IHADCB,DCBREG                                            06700002
         L     ERREG5,IOSUSE       BASE RQE                             06750002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    06800002
         L     IOBRG,RQEIOB        BASE IOB                             06850002
         L     DCBREG,IOBDCBPT     BASE DCB                             06900002
         L     UCBREG,IOSUCB       BASE UCB                             06950002
         DROP  ERREG5                                                   07000002
         TM    UCBTYP+L1(UCBREG),BSC2   IS IT DIAL                      07050002
         BO    BSC2RTN             YES, HANDLE                          07100002
         LA    ERREG2,IOBERINF+L4   POINT TO T-RECORD                   07150002
         ST    ERREG2,IOBERCCW     SAVE ADDR OF T-RECORD FOR ERREP      07200002
         NI    IOSFLB,L255-IOSLOG   NO RECORDING REQUIRED               07250002
         XC    ZERO(RCDLNGTH,ERREG2),ZERO(ERREG2)   CLEAR T RECORD      07400002
         MVI   BUFSIZE(ERREG2),SIZE   MOVE BUFFER SIZE INTO RECORD      07450002
         MVI   RECDID(ERREG2),ID   MOVE IN RECORD ID                    07500002
         MVC   CUA(LINEADDR,ERREG2),UCBCUA(UCBREG)   MOVE LINE ADDR     07550002
         L     RMSGPTR,IOBERINF    GET ADDR OF SOH%R MESSAGE            07600002
         MVC   CU(TOSTAT2,ERREG2),RMSGCU(RMSGPTR)   PUT IN RECORD       07650002
         TM    DCBXCODE,ASCII      IS IT ASCII                          07700002
         BNO   NOTRANS             NO, DON'T TRANSLATE                  07750002
         LA    ERREG2,CU(ERREG2)   GET BEGIN ADDR OF 4 BYTES TO TRANS   07800002
         TR    ZERO(ADRLNGTH,ERREG2),ASCTAB   TRANSLATE TO EBCDIC       07850002
NOTRANS  EQU   *                                                        07900002
         NI    IOBCSW+L3,UE        TURN OFF EXCEPTION BIT               07950000
         NI    IOBCSW+L4,L255-IL   ALSO INCORRECT LENGTH        YA03260 08000000
         NI    IOSFLA,L255-IOSERR-IOSEX   RESET ERP FLAGS               08050002
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR   ALSO IN IOB            08100002
         OI    IOBINCAM,RMSGPROC   TURN ON BIT 5                        08150002
         L     NAMEREG,TRANSRTN    ADDR OF TRANSLATE RTN       YM02594K 08250002
         MVI   EWAIND1,EWAILD15    SET FOR TPR EXIT            YM05652K 08300000
         L     ERRETR,CVTPTR       POINT TO CVT                         08400002
         USING CVTMAP,ERRETR                                            08450002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                08500002
         DROP  ERRETR                                                   08550002
         BR    ERRETR              EXIT VIA XCTL ROUTINE                08600002
BSC2RTN  EQU   *                                                        08650002
         L     RMSGPTR,IOBERINF    GET ADDR OF S/S MSG                  08700002
         LA    ERREG2,IOBERINF     POINT TO MDR RECORD                  08750002
         ST    ERREG2,IOBERCCW     SAVE ADDR OF MDR FOR EREP            08800002
         NI    IOSFLB,L255-IOSLOG   NO RECORDING REQUIRED               08850002
         XC    ZERO(MDRLNGTH,ERREG2),ZERO(ERREG2)   CLEAR MDR AREA      08900002
         MVI   BUFRSZ(ERREG2),BUFSZ   MOVE IN BUFFER SIZE               08950002
         MVI   RCDID(ERREG2),DIALID   MOVE IN RECORD ID                 09000002
         MVI   SUBID(ERREG2),SUBIDINF   MOVE IN SUB-ID                  09050002
         MVC   CHANUNIT(LINEADDR,ERREG2),UCBCUA(UCBREG)   LINE ADDR     09100002
         MVC   TERMID(IDLENGTH,ERREG2),IOBCPA+CPAEND   TERM ID          09150002
         MVC   SS1(STATLNG,ERREG2),STATUS(RMSGPTR)   SENSE+STATUS       09200002
         TM    DCBXCODE,ASCII      IS IT ASCII ?                        09250002
         BNO   NOTRANS             NO, DON'T TRANSLATE                  09300002
         LA    ERREG2,TERMID(ERREG2)   GET ADDR OF BYTES TO TRANS       09350002
         TR    ZERO(TRANSLNG,ERREG2),ASCTAB   TRANSLATE TERM ID         09400002
         B     NOTRANS             SET UP TO XCTL                       09450002
         EJECT                                                          09500002
**********                                                              09550002
*                                                                       09600002
*        CONSTANTS                                                      09650002
*                                                                       09700002
**********                                                              09750002
         ORG   *-X'20'             SAVE 20 BYTES WITH ORG               09800002
ASCTAB   DS    0F                                                       09850002
         ORG   *+X'20'             ORG TO START OF TABLE                09900002
*                EBCDIC EQUIVALENTS     ASCII                           09950002
         DC    X'404F7F7B5B6C507D4D5D'  X'20' TO X'29'                  10000002
         DC    X'5C4E6B604B61F0F1F2F3'  X'2A' TO X'33'                  10050002
         DC    X'F4F5F6F7F8F97A5E4C7E'  X'34' TO X'3D'                  10100002
         DC    X'6E6F7CC1C2C3C4C5C6C7'  X'3E' TO X'47'                  10150002
         DC    X'C8C9D1D2D3D4D5D6D7D8'  X'48' TO X'51'                  10200002
         DC    X'D9E2E3E4E5E6E7E8E94A'  X'52' TO X'5B'                  10250002
         DC    X'6A5A5F6D'              X'5C' TO X'5F'                  10300002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE RTN  YM02594K 10350002
ERRCN8   DC    H'8'                CONSTANT                             10400002
PACHAREA DC    9C'704B'            PATCH AREA FOR MAINTENANCE           10450002
**********                                                              10500002
*                                                                       10550002
*        MISCELLANEOUS EQUATES                                          10600002
*                                                                       10650002
**********                                                              10700002
IL       EQU   X'40'               INCORRECT LENGTH IN CSW      YA03260 10710000
L255     EQU   255                 AND MASK                             10750002
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              10800002
L1       EQU   1                   LENGTH AND DISPLACEMENT              10850002
L2       EQU   2                   LENGTH AND DISPLACEMENT              10900002
L3       EQU   3                   LENGTH AND DISPLACEMENT              10950002
L4       EQU   4                   LENGTH AND DISPLACEMENT              11000002
L5       EQU   5                   LENGTH AND DISPLACEMENT              11050002
L6       EQU   6                   LENGTH AND DISPLACEMENT              11100002
L8       EQU   8                   LENGTH AND DISPLACEMENT              11150002
L12      EQU   12                  LENGTH AND DISPLACEMENT              11200002
L14      EQU   14                  LENGTH AND DISPLACEMENT              11250002
SIZE     EQU   12                  SIZE OF RECORD                       11300002
UCBCUA   EQU   4                   UCB DISP OF CUA                      11350002
TOSTAT2  EQU   4                   LENGTH OF ADDR AND STATUS BYTES      11400002
RMSGCU   EQU   4                   CU DISP IN SOH%R MSG                 11450002
LINEADDR EQU   2                   DISP OF LINE ADDR IN T RECORD        11500002
ADRLNGTH EQU   4                   LENGTH OF ADDR IN RECORD             11550002
UCBTYP   EQU   16                  DISP OF TYPE IN UCB                  11600002
MDRLNGTH EQU   14                  LENGTH OF DIAL MDR RECORD            11650002
IDLENGTH EQU   4                   LENGTH OF TERMINAL ID                11700002
CPAEND   EQU   64                  DISP PAST IOBCPA OF TERM ID          11750002
STATUS   EQU   4                   DISP OF STATUS IN S/S MSG            11800002
STATLNG  EQU   2                   NO. OF STATUS BYTES                  11850002
TRANSLNG EQU   6                   NO. OF BYTES TO TRANSLATE            11900002
ASCII    EQU   X'14'               ASCII SETTING                        11950002
UE       EQU   X'FE'               UNIT EXCEPTION BIT                   12000002
RMSGPROC EQU   X'04'               SOH%R MSG PROCESSED                  12050002
BSC2     EQU   X'90'               BSC2 FEATURE IN UCB                  12100002
DIALID   EQU   X'0B'               ID FOR DIAL IN MDR                   12150002
SUBIDINF EQU   X'83'               SUB-ID INFO FOR DIAL - TELLS         12200002
*                                  EREP THERE'S A 4-BYTE TERM ID        12250002
BUFSZ    EQU   X'0E'               BUFFER LENGTH OF MDR                 12300002
ID       EQU   3                   RECORD ID                            12350002
*                                  T RECORD                             12400002
BUFSIZE  EQU   1                   BUFFER SIZE + 1                      12450002
RECDID   EQU   5                   RECORD ID                            12500002
CUA      EQU   6                   CHANNEL/UNIT ADDR                    12550002
CU       EQU   8                   CONTROL UNIT ADDR                    12600002
RCDLNGTH EQU   12                  LENGTH OF T-RECORD                   12650002
*                                  MDR RECORD                           12700002
BUFRSZ   EQU   1                   BUFFER SIZE                          12750002
SUBID    EQU   2                   SUB-ID INFO                          12800002
RCDID    EQU   5                   RECORD ID                            12850002
CHANUNIT EQU   6                   CUA                                  12900002
TERMID   EQU   8                   TERMINAL ID                          12950002
SS1      EQU   12                  S/S1                                 13000002
**********                                                              13050002
*                                                                       13100002
*        REGISTER DEFINITIONS                                           13150002
*                                                                       13200002
**********                                                              13250002
ERREG3   EQU   0                   WORK REG                             13300002
IOSBREG  EQU   1                   IOSB BASE                            13350002
ERREG2   EQU   2                   WORK REG                             13400002
EWAREG   EQU   3                   ERP WORKAREA BASE                    13450002
UCBREG   EQU   4                   UCB BASE                             13500002
IOBRG    EQU   5                   IOB BASE                             13550002
DCBREG   EQU   6                   DCB BASE                             13600002
RMSGPTR  EQU   7                   SOH%R MSG ADDR                       13650002
BASEREG  EQU   8                   PROGRAM BASE                         13700002
ERREG1   EQU   9                   WORK REG                             13750002
ERREG6   EQU   10                  WORK REGG                            13800002
ERREG4   EQU   11                  WORK REG                             13850002
ERRLNK   EQU   12                  LINK REG                             13900002
NAMEREG  EQU   13                  LINK REG                             13950002
ERRETR   EQU   14                  LINK REG                             14000002
ERREG5   EQU   15                  WORK REG                             14050002
         EJECT                                                          14100002
         DCBD  DSORG=BX,DEVD=BS                                         14150002
         EJECT                                                          14200002
         IECDRQE                                                        14250002
         EJECT                                                          14300002
         IEZIOB                                                         14350002
         EJECT                                                          14400002
CVT      DSECT                                                          14450002
         CVT                                                            14500002
         EJECT                                                          14550002
         IECDERWA                                                       14600002
**********                                                              14650002
*                                                                       14700002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        14750002
*                                                                       14800002
**********                                                              14850002
         ORG   EWAIERP                                                  14900002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 14950002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 15000002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 15050002
EWAIND0  DS    B                   FLAG BYTE                            15100002
EWAIVISR EQU   X'10'               V=R REQUEST                          15700002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 15750002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 15800002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 15850002
EWAIND1  DS    B                   FLAG BYTE                            15900002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 15950002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 16000002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 16050002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 16060000
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 16070000
EWAIND2  DS    B                   FLAG BYTE                            16100002
EWAIND3  DS    B                   FLAG BYTE                            16150002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     16200002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  16250002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 16300002
*********  END OF BTAM LOCAL DEFINITIONS **********                     16350002
         EJECT                                                          16400002
         IECDIOSB                                                       16450002
         END                                                            16500002
./  ADD  SSI=62730018,NAME=IGE0704C
         TITLE  'IGE0704C - BSC BUS OUT ERP ROUTINE'                    00650002
IGE0704C CSECT                                                          00700002
*********************************************************************** 00750002
*                                                                     * 00800002
* MODULE NAME:                                                        * 00850002
*    IGE0704C                                                         * 00900002
*                                                                     * 00950002
* DESCRIPTIVE NAME:                                                   * 01000002
*    BTAM BSC BUS OUT ERP                                             * 01050002
*                                                                     * 01100002
* COPYRIGHT:                                                          * 01150002
*    NONE                                                             * 01200002
*                                                                     * 01250002
* STATUS:                                                             * 01300002
*    CHANGE LEVEL 000                                                 * 01350002
*                                                                     * 01400002
* FUNCTION:                                                           * 01450002
*    THIS ROUTINE RECOVERS FROM A BUS OUT ERROR WHICH OCCURRED DURING * 01500002
*    A BSC OPERATION. THE TYPE OF CCW ON WHICH THE ERROR OCCURRED     * 01550002
*    IS DETERMINED AND THE PROPER ERROR RECOVERY IS INITIATED.        * 01600002
*                                                                     * 01650002
* NOTES:                                                              * 01700002
*    DEPENDENCIES:                                                    * 01750002
*        NONE                                                         * 01800002
*    RESTRICTIONS:                                                    * 01850002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01900002
*    REGISTER CONVENTIONS:                                            * 01950002
*        SEE 'REGISTER DEFINITION' BELOW                              * 02000002
*                                                                     * 02050002
* PATCHLABEL:                                                         * 02100002
*    PACHAREA (52 BYTES)                                              * 02150002
*                                                                     * 02200002
* MODULE TYPE:                                                        * 02250002
*    PROCEDURE                                                        * 02300002
*    PROCESSOR:                                                       * 02350002
*        BAL                                                          * 02400002
*    MODULE SIZE:                                                     * 02450002
*        526 BYTES                                                    * 02500002
*    ATTRIBUTES:                                                      * 02550002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02600002
*                                                                     * 02650002
* ENTRY POINT:                                                        * 02700002
*    IGE0704C                                                         * 02750002
*    PURPOSE:                                                         * 02800002
*        SEE 'FUNCTION'                                               * 02850002
*    LINKAGE:                                                         * 02900002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02950002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 03000002
*    INPUT:                                                           * 03050002
*        REG 1 = ADDRESS OF IOSB                                      * 03100002
*    OUTPUT:                                                          * 03150002
*        ALTERED CHANNEL PROGRAM                                      * 03200002
*        SETS INDICATOR IN DECERRST FOR SHOULD NOT OCCUR ERROR          03250002
*                                                                     * 03300002
* EXITS-NORMAL:                                                       * 03350002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03450002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03500002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03550002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03600002
*        LOADS ARE 1000 GREATER.                                      * 03650002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03700002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03750002
*                                                                     * 03800002
* EXITS-ERROR:                                                        * 03850002
*    NONE                                                             * 03900002
*                                                                     * 03950002
* EXTERNAL REFERENCES:                                                * 04000002
*    ROUTINES:                                                        * 04050002
*        NONE                                                         * 04100002
*    DATA AREAS                                                       * 04200002
*        IOB (MAPPED BY IEZIOB)                                       * 04250002
*        VIRTUAL CHANNEL PROGRAM                                      * 04300002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04350002
*    CONTROL BLOCKS                                                   * 04400002
*        UCB                                                          * 04450002
*        DCB                                                          * 04500002
*        DECB                                                         * 04550002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04600002
*        CVT          (MAPPED BY CVT)                                 * 04650002
*        IOB          (MAPPED BY IEZIOB)                              * 04700002
*        RQE          (MAPPED BY IECDRQE)                             * 04750002
*                                                                     * 04800002
* TABLES-WORKAREAS:                                                   * 04850002
*    ERP WORKAREA                                                     * 04900002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04950002
*                                                                     * 05000002
* MACROS:                                                             * 05050002
*    NONE                                                             * 05100002
*                                                                     * 05150002
* CHANGE ACTIVITY:                                                    * 05200002
*    YM02595K (9/20/73)                                               * 05250002
*    YM02594K (9/24/73)                                               * 05260002
*    YM05652K (1/24/74)                                               * 05270000
*    ZA02812  (01/10/75)          AZ03976  (04/24/75)                 * 05280000
*    AZ13205  (09/23/76)                                              * 05290000
*                                                                     * 05300002
*********************************************************************** 05350002
         EJECT                                                          05400002
         USING *,BASEREG                                                05450002
         LR    BASEREG,ERREG5      SET BASE REG                         05500002
         USING RQE,ERREG5                                               05550002
         USING IECTDECB,DECBRG                                          05600002
         USING IHADCB,DCBREG                                            05650002
         USING IOSB,IOSBREG                                             05700002
         USING IOBSTDRD,IOBRG                                           05750002
         USING EWA,EWAREG                                               05800002
         B     BEGIN               BRANCH AROUND ID         LD @ZA02812 05810000
         DC    C'IGE0704C'         MODULE ID                LD @ZA02812 05820000
         DC    C'5010'             DATE LAST CHANGE         LD @ZA02812 05830000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY       LD @ZA02812 05840000
BEGIN    DS    0H                                           LD @ZA02812 05842000
         L     ERREG5,IOSUSE       BASE RQE                             05850002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05900002
         L     IOBRG,RQEIOB        BASE IOB                             05950002
         L     DECBRG,IOBECBPT     BASE DECB                            06000002
         L     DCBREG,IOBDCBPT     BASE DCB                             06050002
         L     UCBREG,IOSUCB       BASE UCB                             06100002
         DROP  ERREG5                                                   06150002
         L     CCWREG,IOBFL3       GET IOB CSW                          06200002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06250002
         SH    CCWREG,ERRCN8       POINT TO FAILING CCW IN IOB          06300002
         XC    IOBERCCW(L16),IOBERCCW   CLEAR ERP CCW AREA              06350002
         TM    IOBSENS0,BUSOUT     IS THIS A BUSOUT CHECK               06400002
         BO    BSCBO00B            YES BRANCH INTO ROUTINE              06450002
         CLI   ZERO(CCWREG),CCWREAD   DID ERROR OCCUR ON A READ         06500002
         BNE   BSCOR03             NO, GO SET SHOULD NOT OCCUR          06550002
         CLI   IOBWORK,TPOPRENQ    IS THIS READ ENQUIRY                 06600002
         BE    BSCOR06             YES, GO TO RESTART CHAN.PROG.        06650002
         CLI   IOBWORK,TPRDRENQ    IS THIS READ RESP TO ENQ             06700002
         BE    BSCOR04             YES, RESTART W/ PREVIOUS CCW         06750002
         CLI   IOBWORK,TPOPRREN    IS THIS READ RESP TO TEXT            06800002
         BE    BSCOR05             YES, RESTART W/ READ ENQ CCW         06850002
         CLI   IOBWORK,TPOPRTXT    IS THIS READ TEXT                    06900002
         BNE   BSCOR03             NO, GO SET SHOULD NOT OCCUR          06950002
         CLI   L5(DECBRG),DECCONV   CONVERSATIONAL WRITE ?              07000002
         BNL   BSCCCC                                                   07050002
         TM    L4(DECBRG),AUTOPOLL USING AUTOPOLL ?         LD @ZA02812 07060000
         BZ    TSTDB               NO, CHECK DYN. BUFF.     LD @ZA02812 07070000
         CLI   L5(DECBRG),DECTYP1  IS READ INIT ?           LD @ZA02812 07080000
         BNE   TSTDB               NO, CHECK DYN. BUFF.     LD @ZA02812 07090000
         LR    ERREG2,CCWREG       GET READ TXT ADDR           @ZA03976 07090200
         SH    ERREG2,EIGHT        BACK UP TO RD INDEX         @ZA03976 07090400
         L     ERREG4,ZERO(ERREG2) LOAD DATA ADDR              @ZA03976 07090600
         AH    ERREG4,ONE           ADD ONE                    @ZA03976 07090800
         C     ERREG4,ZERO(CCWREG)  ADDR PREV ADJUSTED?        @ZA03976 07091000
         BE    TSTDB                YES, DONT ADJUST AGAIN     @ZA03976 07091200
*        ONE LINE OF CODE DELETED BY APAR ---------------->    @ZA13205 07096000
         ST    ERREG4,ZERO(CCWREG) RESTORE CORRECT DATA...  LD @ZA02812 07098000
*                                  ...ADDR IN READ TXT.     LD @ZA02812 07098400
         LH    ERREG4,L6(CCWREG)   GET CCW BYTE COUNT       LD @ZA02812 07098800
         LA    ERREG4,L1(ERREG4)   ADD ONE                  LD @ZA02812 07099200
         STH   ERREG4,L6(CCWREG)   RESTORE COUNT TO CCW     LD @ZA02812 07099600
TSTDB    TM    DCBBFTEK,BSCDYBUF   WAS DYNAMIC BUFFERING EMPLOYED       07100002
         BO    BSCOR02             YES, INDICATE PERMANENT ERROR        07150002
BSCOR00  LA    ERREG4,DCBBSNAK     ADDRESS OF NAK SPECIAL CHAR.         07200002
         ST    ERREG4,IOBERCCW     STORE ADDRESS IN ERP CCW AREA        07250002
BSCOR00A MVI   IOBERCCW,OPCODWRT   COMMAND CODE INTO ERP CCW            07300002
         MVI   IOBERCCW+L4,FLAG                                         07350002
         MVI   IOBERCCW+L7,COUNTONE   COUNT OF 1 FOR WRITE NAK CCW      07400002
         ST    CCWREG,IOBERCCW+L8   READ TEXT CCW ADDRESS IN TIC        07450002
         MVI   IOBERCCW+L8,BSCTICCC   TIC COMMAND CODE INTO ERP CCW     07500002
         LA    ERREG4,IOBERCCW     GET ADDRESS OF ERP CHANNEL PROG      07600002
         ST    ERREG4,IOBSTART     STORE ADDRESS IN IOB FIELD           07650002
BSCOR01  CLI   IOBERRCT,ERRMAX     RETRY COUNT AT MAXIMUM               07800002
         BNL   BSCOR02             INDICATE PERMANENT ERROR             07850002
         IC    ERREG4,IOBERRCT     UPDATE RETRY COUNT                   07900002
         LA    ERREG4,L1(ERREG4)   TO NEW COUNT                         07950002
         STC   ERREG4,IOBERRCT     STORE IN COUNT FIELD                 08000002
         B     RETRY               ISSUE ERROR EXCP                     08050002
BSCOR02  NI    IOSFLA,L255-IOSERR  INDICATE PERMANENT ERROR             08100002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     08110002
         LA    NAMEREG,ERLOD25     GET ERROR ROUTINE ADDRESS            08150002
XCTLOUT  EQU   *                                                        08200002
         L     ERRETR,CVTPTR       POINT TO CVT                         08250002
         USING CVTMAP,ERRETR                                            08300002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                08350002
         DROP  ERRETR                                                   08400002
         BR    ERRETR              XCTL                                 08450002
BSCOR03  OI    DECERRST,DECBSNO    SET SHOULD-NOT-OCCUR FLAG            08500002
         B     BSCOR02             INDICATE PERMANENT ERROR & EXIT      08550002
BSCOR04  SH    CCWREG,ERRCN8       BACK UP TO PREVIOUS CCW              08600002
BSCOR06  ST    CCWREG,IOBSTART     STORE CPA ADDRESS IN DCB FIELD       08650002
         B     BSCOR01                                                  08750002
BSCCCC   SH    CCWREG,ERRCN8       BACK UP TO RD RESP TO TEXT           08800002
         B     TSTDB                                                    08850002
BSCOR05  EQU   *                                                        08900002
         LA    ERREG4,DCBBSENQ     GET ADDRESS OF ENQ CHARACTER         08950002
         ST    ERREG4,IOBERCCW     STORE ENQ ADDRESS IN CCW             09000002
         MVI   IOBERCCW+L5,TPOPWENQ   MOVE IN WRITE TQ TP CODE          09050002
         B     BSCOR00A            GO FINISH CCW AND EXCP               09100002
BSCBO00B EQU   *                                                        09150002
         CLI   ZERO(CCWREG),CCWREAD   WAS CCW FOR A READ OPERATION      09200002
         BE    BSCBO02             CHK. CT. AND RETRY IF POSSIBLE       09250002
         CLI   ZERO(CCWREG),CCWDIAL   CCW FOR A DIAL COMMAND            09300002
         BE    BSCBO03             DISABLE LINE AND DIAL AGAIN          09350002
         CLI   ZERO(CCWREG),CCWPOLL   CCW FOR A POLL COMMAND            09400002
         BE    BSCBO04             RE-EXECUTE CHANNEL PROGRAM           09450002
         CLI   ZERO(CCWREG),CCWRITE   CCW FOR A WRITE COMMAND           09500002
         BNE   BSCBO00             NO, RETRY FAILING COMMAND            09550002
         TM    TPOPCODE(CCWREG),PRIORTXT   CCW PRIOR TO TEXT TRANSFER   09650002
         BZ    BSCBO05             YES, CHECK FOR WRITE EOT CCW         09700002
         TM    TPOPCODE(CCWREG),DURINTXT   CCW DURING TEXT TRANSFER     09750002
         BO    BSCBO02             YES, RETRY FAILING CCW IF CAN        09800002
         TM    TPOPCODE(CCWREG),LASTCOMD   CCW LAST ONE IN CHAN.PROGRAM 09850002
         BZ    BSCBO06             NO, RESTART WITH NEXT CCW            09900002
BSCBO00  ST    CCWREG,IOBSTART     ADDR. OF FAILING CCW IN IOBSTAR      09950002
BSCBO00A CLI   IOBERRCT,ERRMAX     RETRY COUNT AT MAXIMUM               10050002
         BNL   BSCBO01             YES, GO INDICATE A PERM. ERROR       10100002
         IC    ERREG4,IOBERRCT     NO, UPDATE RETRY COUNT BY ONE        10150002
         LA    ERREG4,L1(ERREG4)   AND ISSUE EXCP TO RESTART            10200002
         STC   ERREG4,IOBERRCT     WITH THE FAILING CCW                 10250002
RETRY    EQU   *                                                        10300002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 10350000
         L     NAMEREG,TRANSRTN    LOAD NAME                            13000002
         B     XCTLOUT             XCTL                                 13050002
BSCBO02  CLC   COUNT(L2,CCWREG),IOBCSW+L5   RESIDUAL COUNT = ORIGINAL   13300002
         BE    BSCBO00             YES, RETRY FAILING COMMAND           13350002
BSCBO01  NI    IOSFLA,L255-IOSERR  SET PERMANENT ERROR FLAGS            13400002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO ON IOB                     13450002
         LA    NAMEREG,ERLOD25     ADDRESS OF ERROR POST                13500002
         B     XCTLOUT             BRANCH TO XCTL ROUTINE               13550002
BSCBOSNO OI    DECERRST,DECBSNO    SET PERMANENT ERROR FLAG             13600002
         B     BSCBO01             GO TO ERRPOST VIA XCTL ROUTINE       13650002
BSCBO03  XC    IOBERCCW(L12),IOBERCCW   CLEAR OUT NEEDED CCW AREA       13700002
         MVI   IOBERCCW,DISABLE    MOVE DISABLE COMMAND CODE            13750002
         MVI   IOBERCCW+L5,TPDISAB   DSABLE TP CODE IN CCW              13800002
         MVI   IOBERCCW+L7,DISABCNT   COUTN IN CCW                      13850002
         MVI   IOBERCCW+L4,FLAGS   CC & SLI FLAGS INTO CCW              13900002
         ST    CCWREG,IOBERCCW+L8   USER CCW ADDR IN TIC COMMAND        13950002
         MVI   IOBERCCW+L8,TICCOMMD   TIC COMMAND CODE IN CCW           14000002
BSCBO04  LA    ERREG2,IOBCPA       UPDATE IOBSTART TO POINT TO          14050002
         ST    ERREG2,IOBSTART     START OF USER CHANNEL PROG.          14100002
         L     ERREG4,IOBCPA+L8    ADDR. OF USER POLLING ENTRY          14150002
         MVC   IOBCPA+L9(L3),DECENTRY+L1   FAILING ENTRY ADDR TO CCW    14200002
         L     ERREG2,IOBCPA+L8    ADDR. OF FAILING POLL CCW            14250002
         SR    ERREG4,ERREG2       COUNT BETWEEN USER AND FAILED        14300002
         AH    ERREG4,IOBCPA+L14   ADD TOTAL COUNT FROM USER ENTRY      14350002
         STH   ERREG4,IOBCPA+L14   STORE NEW COUNT IN POLL CCW          14400002
         B     BSCBO00A            GO EXECUTE                           14500002
BSCBO05  CLI   IOBWORK,WRITEOT     WRITE EOT CCW                        14550002
         BE    BSCBO00                                                  14600002
BSCBO06  LA    CCWREG,NEXTCCW(CCWREG)   ADDRESS OF NEXT CCW             14650002
         ST    CCWREG,IOBSTART                                          14700002
         B     BSCBO00A                                                 14800002
         EJECT                                                          15450002
**********                                                              15500002
*                                                                       15550002
*        CONSTANTS                                                      15600002
*                                                                       15650002
**********                                                              15700002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       15750002
EIGHT    EQU   *                                               @ZA03976 15770000
ERRCN8   DC    H'08'               NO BYTES IN ONE CCW                  15800002
ONE      DC    H'01'                                           @ZA03976 15820000
PACHAREA DC    13C'704C'           PATCH AREA FOR MAINTENANCE           15850002
**********                                                              15900002
*                                                                       15950002
*        MISCELLANEOUS EQUATES                                          16000002
*                                                                       16050002
**********                                                              16100002
TPOPCODE EQU   5                   LOCATION OF TP CODE IN CCW           16200002
L255     EQU   X'FF'               AND MASK                             16250002
DECCONV  EQU   X'0D'               CONVERSATIONAL WRITE                 16300002
CCWREAD  EQU   X'02'               COMMAND CODE FOR READ CCW            16350002
CCWDIAL  EQU   X'29'               COMMAND CODE FOR DIAL                16400002
CCWPOLL  EQU   X'09'               COMMAND CODE FOR POLL                16450002
CCWRITE  EQU   X'01'               COMMAND CODE FOR WRITE               16500002
PRIORTXT EQU   X'F0'               MASK TO SEE IF CCW PRIOR TO TXT      16550002
DURINTXT EQU   X'10'               CCW DURING TEXT TRANSFER             16600002
LASTCOMD EQU   X'80'               LAST CCW IN CHANNEL PROGRAM          16650002
ERRMAX   EQU   7                   MAXIMUM NO RETRIES ALLOWED           16700002
COUNT    EQU   6                                                        16750002
DISABLE  EQU   X'27'               COMMAND CODE FOR DISABLE CCW         16800002
TPDISAB  EQU   X'01'               TP CODE FOR DISABLE CCW              16850002
DISABCNT EQU   X'01'               COUNT FOR DISABLE CCW                16900002
FLAGS    EQU   X'60'               FLAGS FOR DISABLE CCW                16950002
TICCOMMD EQU   X'08'               COMMAND CODE FOR TIC COMMAND         17000002
WRITEOT  EQU   X'02'               TP CODE FOR WRITE EOT                17050002
NEXTCCW  EQU   X'08'                                                    17100002
ERLOD25  EQU   2043                                                     17150002
BUSOUT   EQU   X'20'               BUS OUT BIT IN SENSE BYTE            17350002
DECBSNO  EQU   X'40'               SHOULD NOT OCCUR FLAG IN DECB        17400002
TPOPRENQ EQU   X'0B'               TP CODE FOR READ ENQ                 17450002
TPRDRENQ EQU   X'0C'               TP CODE FOR READ-RESPONSE-ENQ        17500002
TPOPRREN EQU   X'25'               TP OP CODE FOR RD RESP TO TEXT       17550002
TPOPRTXT EQU   X'11'               TP CODE FOR READ TEXT                17600002
BSCDYBUF EQU   X'08'               DYNAMIC BUFFERING FLAG               17650002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              17700002
L1       EQU   1                   LENGTH AND DISPLACEMENT              17750002
L2       EQU   2                   LENGTH AND DISPLACEMENT              17800002
L3       EQU   3                   LENGTH AND DISPLACEMENT              17850002
L4       EQU   4                   LENGTH AND DISPLACEMENT              17900002
L5       EQU   5                   LENGTH AND DISPLACEMENT              17950002
L6       EQU   6                   LENGTH AND DISPLACEMENT              18000002
L7       EQU   7                   LENGTH AND DISPLACEMENT              18050002
L8       EQU   8                   LENGTH AND DISPLACEMENT              18100002
L9       EQU   9                   LENGTH AND DISPLACEMENT              18150002
L12      EQU   12                  LENGTH AND DISPLACEMENT              18200002
L14      EQU   14                  LENGTH AND DISPLACEMENT              18250002
L16      EQU   16                  LENGTH AND DISPLACEMENT              18300002
COUNTONE EQU   X'01'               COUNT FOR WRITE NAK & ENQ CCWS       18350002
OPCODWRT EQU   X'01'               OP-CODE FOR A WRITE COMMAND          18400002
BSCTICCC EQU   X'08'               OP-CODE FOR TIC COMMAND              18450002
TPOPWENQ EQU   X'03'                                                    18500002
FLAG     EQU   X'60'                                                    18550002
AUTOPOLL EQU   X'80'               AUTOPOLL FLG IN DECB     LD @ZA02812 18600000
DECTYP1  EQU   X'01'               READ INIT. OP TYPE...    LD @ZA02812*18650000
                                   ...IN DECB               LD @ZA02812 18660000
**********                                                              18700002
*                                                                       18750002
*        REGISTER DEFINITION                                            18800002
*                                                                       18850002
**********                                                              18900002
ERREG3   EQU   0                   WORK REG                             18950002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              19000002
ERREG2   EQU   2                   WORK REG                             19050002
EWAREG   EQU   3                   ERP WORKAREA BASE                    19100002
CCWREG   EQU   4                   CCW ADDRESS REG                      19150002
DECBRG   EQU   5                   DECB BASE                            19200002
DCBREG   EQU   6                   DCB BASE                             19250002
UCBREG   EQU   7                   UCB BASE                             19300002
BASEREG  EQU   8                   PROGRAM BASE                         19350002
ERREG1   EQU   9                   WORK REG                             19400002
IOBRG    EQU   10                  IOB BASE                             19450002
ERREG4   EQU   11                  WORK REG                             19500002
ERRLNK   EQU   12                  LINK REG                             19550002
NAMEREG  EQU   13                  LINK REG                             19600002
ERRETR   EQU   14                  LINK REG                             19650002
ERREG5   EQU   15                  LINK REG/WORK REG                    19700002
         EJECT                                                          19750002
         IECTDECB                                                       19800002
         EJECT                                                          19850002
         DCBD  DSORG=BX,DEVD=BS                                         19900002
         EJECT                                                          19950002
         IECDRQE                                                        20000002
         EJECT                                                          20050002
         IEZIOB                                                         20100002
         EJECT                                                          20150002
CVT      DSECT                                                          20200002
         CVT                                                            20250002
         EJECT                                                          20300002
         IECDERWA                                                       20350002
**********                                                              20400002
*                                                                       20450002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        20500002
*                                                                       20550002
**********                                                              20600002
         ORG   EWAIERP                                                  20650002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 20700002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 20750002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 20800002
EWAIND0  DS    B                   FLAG BYTE                            20850002
EWAIVISR EQU   X'10'               V=R REQUEST                          21450002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 21500002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 21550002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 21600002
EWAIND1  DS    B                   FLAG BYTE                            21650002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 21700002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 21750002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 21800002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 21810000
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 21820000
EWAIND2  DS    B                   FLAG BYTE                            21850002
EWAIND3  DS    B                   FLAG BYTE                            21900002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     21950002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  22000002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 22050002
*********  END OF BTAM LOCAL DEFINITIONS **********                     22100002
         EJECT                                                          22750002
         IECDIOSB                                                       22800002
         END                                                            22850002
./  ADD  SSI=40240782,NAME=IGE0804A
         TITLE 'IGE0804A - BTAM ERP STATUS CHECK MODULE'                00070002
IGE0804A CSECT                                                          00120002
*********************************************************************** 00170002
*                                                                     * 00220002
* MODULE NAME:                                                        * 00270002
*    IGE0804A                                                         * 00320002
*                                                                     * 00370002
* DESCRIPTIVE NAME:                                                   * 00420002
*    BTAM STATUS CHECK ERP                                            * 00470002
*                                                                     * 00520002
* COPYRIGHT:                                                          * 00570002
*    NONE                                                             * 00620002
*                                                                     * 00670002
* STATUS:                                                             * 00720002
*    CHANGE LEVEL 000                                                 * 00770002
*                                                                     * 00820002
* FUNCTION:                                                           * 00870002
*    CHECKS FOR THE FOLLOWING CINDITIONS AND XCTLS TO THE             * 00920002
*    PROPER ROUTINE.                                                  * 00970002
*        1. CHAIN CHECK                                               * 01020002
*        2. PROGRAM CHECK                                             * 01070002
*        3. PROTECTION CHECK                                          * 01120002
*        4. UNIT EXCEPTION                                            * 01170002
*                                                                     * 01220002
* NOTES:                                                              * 01270002
*    DEPENDENCIES:                                                    * 01320002
*        NONE                                                         * 01370002
*    RESTRICTIONS:                                                    * 01420002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01470002
*    REGISTER CONVENTIONS:                                            * 01520002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01570002
*                                                                     * 01620002
* PATCHLABEL:                                                         * 01670002
*    PACHAREA (12 BYTES)                                              * 01720002
*                                                                     * 01770002
* MODULE TYPE:                                                        * 01820002
*    PROCEDURE                                                        * 01870002
*    PROCESSOR:                                                       * 01920002
*        BAL                                                          * 01970002
*    MODULE SIZE:                                                     * 02020002
*        130 BYTES                                                    * 02070002
*    ATTRIBUTES:                                                      * 02120002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02170002
*                                                                     * 02220002
* ENTRY POINT:                                                        * 02270002
*    IGE0804A                                                         * 02320002
*    PURPOSE:                                                         * 02370002
*        SEE 'FUNCTION'                                               * 02420002
*    LINKAGE:                                                         * 02470002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02520002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02570002
*    INPUT:                                                           * 02620002
*        REG 1 = ADDRESS OF IOSB                                      * 02670002
*    OUTPUT:                                                          * 02720002
*        SETS INDICATOR IN DECERRST FOR NOT SHOULD NOT OCCUR ERROR    * 02770002
*                                                                     * 02820002
* EXITS-NORMAL:                                                       * 02870002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 02920002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 02970002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03020002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03070002
*        LOADS ARE 1000 GREATER.                                      * 03120002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03170002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03220002
*                                                                     * 03270002
* EXITS-ERROR:                                                        * 03320002
*    NONE                                                             * 03370002
*                                                                     * 03420002
* EXTERNAL REFERENCES:                                                * 03470002
*    ROUTINES:                                                        * 03520002
*        NONE                                                         * 03570002
*    DATA AREAS                                                       * 03620002
*        IOB (MAPPED BY IEZIOB)                                       * 03670002
*    CONTROL BLOCKS                                                   * 03720002
*        UCB                                                          * 03770002
*        DECB                                                         * 03820002
*        IOSB         (MAPPED BY IECDIOSB)                            * 03870002
*        CVT          (MAPPED BY CVT)                                 * 03920002
*        IOB          (MAPPED BY IEZIOB)                              * 03970002
*        RQE          (MAPPED BY IECDRQE)                             * 04020002
*                                                                     * 04070002
* TABLES-WORKAREAS:                                                   * 04120002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04170002
*                                                                     * 04220002
* MACROS:                                                             * 04270002
*    NONE                                                             * 04320002
*                                                                     * 04370002
* CHANGE ACTIVITY:                                                    * 04420002
*    YM05652K  (1/25/74)                                              * 04470002
*                                                                     * 04520002
*********************************************************************** 04570002
         EJECT                                                          04620002
         USING *,BASEREG                                                04670002
         LR    BASEREG,ERREG5      SET BASE REG                         04720002
         USING RQE,ERREG5                                               04770002
         USING IOSB,IOSBREG                                             04820002
         USING IOBSTDRD,IOBRG                                           04870002
         USING EWA,EWAREG                                               04920002
         L     ERREG5,IOSUSE       BASE RQE                             04970002
         L     IOBRG,RQEIOB        BASE IOB                             05020002
         L     DECBRG,IOBECBPT     BASE DECB                            05070002
         L     UCBREG,IOSUCB       BASE UCB                             05120002
         DROP  ERREG5                                                   05170002
         TM    IOBSTBYT+L1,CSWCHAIN   CHAINING CHECK                    05220002
         BO    ERRSCR06            YES                                  05270002
         TM    IOBSTBYT+L1,CSWPROG   PROGRAM CHECK                      05320002
         BO    ERRSCR06            YES                                  05370002
         TM    IOBSTBYT+L1,CSWPROT   PROTECTION CHECK                   05420002
         BO    ERRSCR06            YES                                  05470002
         TM    IOBSTBYT,CSWUE      UNIT EXCEPTION                       05520002
         BNO   ERRSCR05            NO, NONE OF THE ABOVE                05570002
ERRSCR04 LA    NAMEREG,ERLOD13     ADDRESS OF UNIT EXCEPTION RTN        05620002
         B     ERRLINK1            EXIT ROUTINE                         05670002
ERRSCR05 OI    DECERRST(DECBRG),CSWSNO   SET SHOULD NOT OCCUR ERROR     05720002
ERRSCR06 TM    UCBTYP+L1(UCBREG),SWLINE   IS A DISABLE REQUIRED         05770002
         BZ    ERRSCR07            NO GO TO OBR ROUTINE                 05820002
         MVI   IOBERRCT+L1,MASK15   SPECIAL ENTRY INDICATOR             05870002
         L     NAMEREG,ERLOD9      ADDRESS OF DISABLE ROUTINE           05920002
ERRLINK1 EQU   *                                                        05970002
         L     ERRETR,CVTPTR       POINT TO CVT                         06020002
         USING CVTMAP,ERRETR                                            06070002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                06120002
         DROP  ERRETR                                                   06170002
         BR    ERRETR              XCTL                                 06220002
ERRSCR07 OI    IOSFLB,IOSLOG       INDICATE OUTBOARD RECORDING          06270002
         LH    NAMEREG,ERLOD5      ADDRESS OF POST ROUTINE              06420002
         B     ERRLINK1            EXIT                                 06470002
         EJECT                                                          06520002
**********                                                              06570002
*                                                                       06620002
*        CONSTANTS                                                      06670002
*                                                                       06720002
**********                                                              06770002
ERLOD9   DC    F'9041'                                                  06820002
ERLOD5   DC    H'5041'                                                  06870002
PACHAREA DC    3C'804A'            PATCH AREA FOR MAINTENANCE           06920002
**********                                                              06970002
*                                                                       07020002
*        MISCELLANEOUS EQUATES                                          07070002
*                                                                       07120002
**********                                                              07170002
CSWCHAIN EQU   X'01'               CHAINING CHECK                       07220002
CSWPROG  EQU   X'20'               PROGRAM CHECK                        07270002
CSWPROT  EQU   X'10'               PROTECTION CHECK                     07320002
CSWUE    EQU   X'01'               UNIT EXCEPTION                       07370002
L1       EQU   1                   LENGTH AND DISPLACEMENT              07420002
L255     EQU   255                 AND MASK                             07470002
DECERRST EQU   29                                                       07520002
CSWSNO   EQU   X'40'                                                    07570002
UCBTYP   EQU   16                                                       07620002
SWLINE   EQU   X'90'                                                    07670002
MASK15   EQU   X'0F'                                                    07720002
ERLOD13  EQU   3042                                                     07770002
**********                                                              07820002
*                                                                       07870002
*        REGISTER DEFINITION                                            07920002
*                                                                       07970002
**********                                                              08020002
ERREG3   EQU   0                   WORK REG                             08070002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              08120002
ERREG2   EQU   2                   WORK REG                             08170002
EWAREG   EQU   3                   ERP WORKAREA BASE                    08220002
CCWREG   EQU   4                   CCW ADDRESS REG                      08270002
DECBRG   EQU   5                   DECB BASE                            08320002
DCBREG   EQU   6                   DCB BASE                             08370002
UCBREG   EQU   7                   UCB BASE                             08420002
BASEREG  EQU   8                   PROGRAM BASE                         08470002
ERREG1   EQU   9                   WORK REG                             08520002
IOBRG    EQU   10                  IOB BASE                             08570002
ERREG4   EQU   11                  WORK REG                             08620002
ERRLNK   EQU   12                  LINK REG                             08670002
NAMEREG  EQU   13                  LINK REG                             08720002
ERRETR   EQU   14                  LINK REG                             08770002
ERREG5   EQU   15                  LINK REG/WORK REG                    08820002
         EJECT                                                          08870002
         IECDRQE                                                        08920002
         EJECT                                                          08970002
         IEZIOB                                                         09020002
         EJECT                                                          09070002
CVT      DSECT                                                          09120002
         CVT                                                            09170002
         EJECT                                                          09220002
         IECDERWA                                                       09270002
**********                                                              09320002
*                                                                       09370002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        09420002
*                                                                       09470002
**********                                                              09520002
         ORG   EWAIERP                                                  09570002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 09620002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 09670002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 09720002
EWAIND0  DS    B                   FLAG BYTE                            09770002
EWAIVISR EQU   X'10'               V=R REQUEST                          10370002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 10420002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 10470002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 10520002
EWAIND1  DS    B                   FLAG BYTE                            10570002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 10620002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 10670002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 10720002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 10730002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 10740002
EWAIND2  DS    B                   FLAG BYTE                            10770002
EWAIND3  DS    B                   FLAG BYTE                            10820002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     10870002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  10920002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 10970002
*********  END OF BTAM LOCAL DEFINITIONS **********                     11020002
         EJECT                                                          11070002
         IECDIOSB                                                       11120002
         END                                                            11170002
./  ADD  SSI=81790097,NAME=IGE0804B
         TITLE 'IGE0804B - BTAM ERP CHANNEL CHECK RECOVERY ROUTINE'     00350002
IGE0804B CSECT                                                          00400002
*********************************************************************** 00450002
*                                                                     * 00500002
* MODULE NAME:                                                        * 00550002
*    IGE0804B                                                         * 00600002
*                                                                     * 00650002
* DESCRIPTIVE NAME:                                                   * 00700002
*    BTAM CHANNEL CHECK ERP                                           * 00750002
*                                                                     * 00800002
* COPYRIGHT:                                                          * 00850002
*    NONE                                                             * 00900002
*                                                                     * 00950002
* STATUS:                                                             * 01000002
*    CHANGE LEVEL 000                                                 * 01050002
*                                                                     * 01100002
* FUNCTION:                                                           * 01150002
*    THIS ROUTINE IS ENTERED FROM IGE0004A FOR A CHANNEL CONTROL      * 01200002
*    CHECK, CHANNEL DATA CHECK, OR INTERFACE CONTROL CHECK. THE       * 01250002
*    ERPIB IS LOCATED AND ANALYZED.  IF POSSIBLE, RECOVERY IS         * 01300002
*    ATTEMPTED.  IF NOT, CONTROL IS PASSED TO THE MESSAGE WRITER      * 01350002
*    MESSAGE WRITER MODULE AND PERMANENT ERROR IS SET.                * 01400002
*                                                                     * 01450002
* NOTES:                                                              * 01500002
*    DEPENDENCIES:                                                    * 01550002
*        NONE                                                         * 01600002
*    RESTRICTIONS:                                                    * 01650002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01700002
*    REGISTER CONVENTIONS:                                            * 01750002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01800002
*                                                                     * 01850002
* PATCHLABEL:                                                         * 01900002
*    PACHAREA (64 BYTES)                                              * 01950002
*                                                                     * 02000002
* MODULE TYPE:                                                        * 02050002
*    PROCEDURE                                                        * 02100002
*    PROCESSOR:                                                       * 02150002
*        BAL                                                          * 02200002
*    MODULE SIZE:                                                     * 02250002
*        630 BYTES                                                    * 02300002
*    ATTRIBUTES:                                                      * 02350002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02400002
*                                                                     * 02450002
* ENTRY POINT:                                                        * 02500002
*    IGE0804B                                                         * 02550002
*    PURPOSE:                                                         * 02600002
*        SEE 'FUNCTION'                                               * 02650002
*    LINKAGE:                                                         * 02700002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02750002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02800002
*    INPUT:                                                           * 02850002
*        REG 1 = ADDRESS OF IOSB                                      * 02900002
*    OUTPUT:                                                          * 02950002
*        ALTERED CHANNEL PROGRAM                                      * 03000002
*                                                                     * 03050002
* EXITS-NORMAL:                                                       * 03100002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03200002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03250002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03300002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03350002
*        LOADS ARE 1000 GREATER.                                      * 03400002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03450002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03500002
*                                                                     * 03550002
* EXITS-ERROR:                                                        * 03600002
*    NONE                                                             * 03650002
*                                                                     * 03700002
* EXTERNAL REFERENCES:                                                * 03750002
*    ROUTINES:                                                        * 03800002
*        NONE                                                         * 03850002
*    DATA AREAS                                                       * 03950002
*        IOB (MAPPED BY IEZIOB)                                       * 04000002
*        VIRTUAL CHANNEL PROGRAM                                      * 04050002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04100002
*    CONTROL BLOCKS                                                   * 04150002
*        UCB                                                          * 04200002
*        DCB                                                          * 04250002
*        DECB                                                         * 04300002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04350002
*        CVT          (MAPPED BY CVT)                                 * 04400002
*        IOB          (MAPPED BY IEZIOB)                              * 04450002
*        RQE          (MAPPED BY IECDRQE)                             * 04500002
*                                                                     * 04650002
* TABLES-WORKAREAS:                                                   * 04700002
*    ERP WORKAREA                                                     * 04750002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04800002
*                                                                     * 04850002
* MACROS:                                                             * 04900002
*    NONE                                                             * 04950002
*                                                                     * 05000002
* CHANGE ACTIVITY:                                                    * 05050002
*    YM02595K (9/20/73)                                               * 05100002
*    YM02594K (9/24/73)                                               * 05110002
*    YM05652K (1/24/74)                                               * 05120002
*    YA03263  (2/4/74)                                                * 05130000
*    ZA12164  (09/07/76)                                              * 05136000
*    ZA12165  (09/07/76)                                              * 05142000
*    ZA20121  (05/26/77)                                              * 05150000
*    ZA20123  (06/07/77)                                              * 05170000
*    ZA28820  (12/08/77)                                              * 05180000
*    ZA29881  (01/31/78)                                              * 05190000
*    ZA32894  (05/11/78)                                              * 05195000
*********************************************************************** 05200002
         EJECT                                                          05250002
         USING *,BASEREG                                                05300002
         LR    BASEREG,ERREG5      SET BASE REG                         05350002
         USING RQE,ERREG5                                               05400002
         USING IOSB,IOSBREG                                             05450002
         USING IOBSTDRD,IOBRG                                           05500002
         USING EWA,EWAREG                                               05550002
         L     ERREG5,IOSUSE       BASE RQE                             05600002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05650002
         L     IOBRG,RQEIOB        BASE IOB                             05700002
         L     UCBREG,IOSUCB       BASE UCB                             05750002
         DROP  ERREG5                                                   05800002
         L     CCWREG,IOBFL3       POINT TO CCW                         05850002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                05900002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                05950002
         BP    OKCSW               CSW-CCW IS OK               @ZA29881 05960000
         L     CCWREG,IOBSTART     NO  GET GOOD CCW ADDR       @ZA29881 05970000
         STCM  CCWREG,7,IOBCSW     STORE IN IOBCSW             @ZA29881 05980000
         B     POST                POST                        @ZA29881 05990000
OKCSW    OI    EWASTUP+L1,X01      SET CH CHK FOR STAT UPDATE  @ZA29881 06000000
         MVC   IOBRESTR(L4),EWAERPIB+L4   SAVE PERTINENT DATA IN IOB    06050002
         XC    EWAERPIB+L1(L7),EWAERPIB+L1  CLEAR LAST 7 BYTES @ZA12165 06100000
         TM    IOBRESTR,RETRY1     IS NO-RETRY FLAG SET                 06150002
         BO    POST                YES                                  06200002
         TM    IOBRESTR,CSWSTORD   VALID CSW STORED (SIO OR INTERRUPT)  06250002
         BNZ   CHKRETRY            YES, CHECK THE RETRY CODE            06300002
         TM    IOBRESTR,HALTIO     DID A HIO CAUSE INTERRUPT            06350002
         BZ    POST                                                     06400002
         BAL   ERRLNK,CCWADD       VERIFY CCW ADDRESS                   06450002
         B     FINDVAL             INVALID, TRY TO FIND VALID CCW       06500002
SETCCW   LA    CCWREG,L8(CCWREG)   ADD 8 TO INITIALIZE.                 06550002
         ST    CCWREG,EWAISAVE     SET FOR CHANNEL END                  06600002
         MVC   IOBCSW(L3),EWAISAVE+L1   STORE ADDR IN CSW               06650002
         MVC   IOBCSW+L3(L2),CEDEUX   SET CHANNEL END, DEVICE END,      06700002
*                                  UNIT EXCEPTION                       06750002
         NI    IOSFLA,L255-IOSEX-IOSERR   INDICATE ERROR CORRECTED      06900002
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR   ALSO IN IOB            06910002
         B     ERRCHK05            EXIT                                 06950002
FINDVAL  LA    CCWREG,IOBCPA                                            07000002
LOOPAGIN CLI   ZERO(CCWREG),X06    IS CCW A PREPARE                     07050002
         BE    SETCCW              YES, GO SET UP FOR CHANNEL END       07100002
         CLI   ZERO(CCWREG),X27    IS CCW AN ENABLE                     07150002
         BE    SETCCW              YES, GO SET UP FOR CHANNEL END       07200002
         CLI   ZERO(CCWREG),X0A    IS CCW AN INHIBIT                    07250002
         BE    SETCCW              YES, GO SET UP FOR CHANNEL END       07300002
         TM    L5(CCWREG),CCWLAST   IS LAST CCW IN CHANNEL PGM          07350002
         BO    POST                YES                                  07400002
         LA    CCWREG,L8(CCWREG)   STEP POINTER TO NEXT CCW             07450002
         B     LOOPAGIN            LOOP THRU ONCE AGAIN                 07500002
CHKRETRY BAL   ERRLNK,CCWADD       VERIFY CCW ADDRESS VALIDITY          07550002
         B     POST                                                     07600002
         TM    IOBRESTR+L2,RETRYCDE   IS RETRY CODE VALID               07650002
         BZ    POST                                                     07700002
         LA    ERREG2,L3           PLACE CONTROL UNIT TYPE IN           07750002
         N     ERREG2,UNITTYPE(UCBREG)   REGISTER                       07800002
*                                            2701 = 2 = X'0010'         07850002
*                                            2702 = 1 = X'0001'         07900002
*                                            2703 = 3 = X'0011'         07950002
         BCTR  ERREG2,ZERO         DECREMENT BY ONE                     08000002
         SLL   ERREG2,L2           MULTIPLY BY FOUR                     08050002
*                                  REGISTER NOW CONTAINS FOR            08100002
*                                            2701 = 4                   08150002
*                                            2702 = 0                   08200002
*                                            2703 = 8                   08250002
         LA    ERREG7,L7           INITIALIZE FOR RETRY CODE            08300002
         N     ERREG7,IOBRESTR     ONLY VALID RETRY CODE REMAINS        08350002
         LA    ERREG6,L1           SET UP INCREMENT FOR BXLE'S          08400002
         SR    ERREG4,ERREG4       INITIALIZE FIRST BXLE OPERAND        08450002
         MVI   IOBRESTR+L1,XC0                                          08500002
         NC    IOBRESTR+L1(L1),IOBRESTR+L3                              08550002
         CLI   IOBRESTR+L1,X40     TERMINATION CODE = CONDITION CODE    08600002
*                                            X'00'            4 - LOW   08650002
*                                            X'01'            8 - EQUAL 08700002
*                                            X'02'            2 - HIGH  08750002
         BXLE  ERREG4,ERREG6,CODE001   BRANCH IF RETRY CODE NOT X'000'  08800002
         B     POST                                                     08850002
CODE001  BXLE  ERREG4,ERREG6,CODE010   BRANCH IF RETRY CODE NOT X'001'  08900002
         BH    RETRY               BRANCH IF TERMINATION CODE IS 2      08950002
         BE    CK00A(ERREG2)       BRANCH TERMINATION CODE 1            09000002
         B     CK00B(ERREG2)       BRANCH TERMINATION CODE 2            09050002
CODE010  BXLE  ERREG4,ERREG6,CODE011   BRANCH IF RETRY CODE NOT X'010'  09100002
         BH    RETRY               BRANCH TERMINATION CODE 2            09150002
         BL    CK00B(ERREG2)       BRANCH TERMINATION CODE 0            09200002
         B     CK00C(ERREG2)       BRANCH TERMINATION CODE 1            09250002
CODE011  BXLE  ERREG4,ERREG6,CODE100   BRANCH IF RETRY CODE NOT X'011'  09300002
C02C011  BH    POST                REQUIRES A SIO TO ALLOW AN           09350002
*                                  EQUIPMENT CHECK INTERRUPT THEN       09400002
*                                  ATTEMPT RECOVERY.                    09450002
         BE    LOSTD               BRANCH TERMINATION CODE 1            09500002
         B     *+L4(ERREG2)        DETERMINE CONTROL UNIT TYPE          09550002
         B     LOSTD               2702                                 09600002
         B     SNO                 2701                                 09650002
LOSTD    EQU   *                   2703                                 09700002
         CLI   ZERO(CCWREG),X29    FAILING CCW A DIAL                   09750002
         BNE   CHKSNS              NO, CHECK FOR A READ                 09800002
         B     RETRY               YES, BRANCH TO RETRY CH PGM          09850002
CODE100  BXLE  ERREG4,ERREG6,CODE101   BRANCH IF RETRY CODE NOT X'100'  09900002
         BE    SNO                 BRANCH IF TERMINATION CODE 1         09950002
         BH    RETRY               BRANCH IF TERMINATION CODE 2         10000002
         B     CK00B(ERREG2)       BRANCH IF TERMINATION CODE 0         10050002
CODE101  BXLE  ERREG4,ERREG6,POST   BRANCH IF RETRY CODE NOT X'101'     10100002
         LTR   ERREG2,ERREG2       IS CONTROL UNIT A 2702               10150002
         BNZ   CHKSNS              BRANCH IF NOT A 2702                 10200002
         CLI   IOBRESTR+L1,X40     RESET THE CONDITION CODE             10250002
         B     C02C011             BRANCH, 2702 - USE CODE 011          10300002
CHKSNS   EQU   *                                                        10350002
         CLI   IOBSENS0,ZERO       IS SENSE BYTE 0                      10400002
         BNE   CHEQCK                                                   10450002
         TM    IOBCSW+L4,L8        IS CHANNEL DATA CHECK                10500002
         BO    CKDIAL                                                   10550002
         B     SNO                 ELSE, BRANCH TO SHOULD NOT OCCUR     10600002
CHEQCK   TM    IOBSENS0,X10        IS EQUIPMENT CHECK SET               10650002
         BO    CKDIAL                                                   10700002
         CLI   0(CCWREG),X'29'     FAILING CCW DIAL?           @ZA28820 10750000
         BE    RETRY               YES, BR RETRY CH PGM        @ZA28820 10780000
         TM    IOBSENS0,X08        IS DATA CHECK SET                    10850002
         BNO   CHKMORE             NO, BRANCH                           10900002
         LA    NAMEREG,DATACHK     GET NAME OF DATA CHK ERP MOD         10950002
ERRLINK1 EQU   *                                                        11000002
         L     ERRETR,CVTPTR       POINT TO CVT                         11050002
         USING CVTMAP,ERRETR                                            11100002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                11150002
         DROP  ERRETR                                                   11200002
         BR    ERRETR              XCTL FOR RETRIES                     11250002
CHKMORE  TM    IOBSENS0,X01        IS TIME OUT SET                      11300002
         BNO   SNO                 NO, GO TO SHOULD NOT OCCUR           11350002
         LA    NAMEREG,TIMEOUT     GET NAME OF TIME OUT ERP MOD         11400002
         B     ERRLINK1            XCTL FOR RETRIES                     11450002
CK00C    B     RETRY               2702 ENTRY                           11500002
         B     RETRY               2701 ENTRY                           11550002
CK00A    B     SNO                 2702 ENTRY FROM CK00A BRANCH &       11600002
*                                  2701 ENTRY FROM CK00C BRANCH         11650002
         B     SNO                 2701 ENTRY FROM CK00A BRANCH &       11700002
*                                  2703 ENTRY FROM CK00C BRANCH         11750002
CK00B    B     RETRY               2703 ENTRY FROM CK00A BRANCH &       11800002
*                                  2702 ENTRY FROM CK00B BRANCH         11850002
         B     SNO                 2701 ENTRY                           11900002
         B     RETRY               2703 ENTRY                           11950002
SNO      L     ERRLNK,IOBECBPT     POINT TO DECB                        12000002
         OI    L29(ERRLNK),CSWSNO   INDICATE SHOULD NOT OCCUR ERROR     12050002
CKDIAL   TM    L17(UCBREG),SWLINE   IS DISABLE REQUIRED                 12100002
         BZ    POST                NO, GO TO ERROR POST                 12150002
         MVI   IOBERRCT+L1,MASK3   INDICATE SPECIAL ENTRY               12200002
         LA    NAMEREG,ERLOD3      DISABLE CHECK ROUTINE ADDRESS        12250002
         B     ERRLINK1                                                 12300002
POST     EQU   *                                                        12310000
         OI    IOSFLB,IOSLOG       SET OBR RECORDING FLAG               12320000
         TM    L19(UCBREG),BISYNC   BSC DEVICE                  YA03263 12330000
         BNO   POSTA               NO, GO TO START STOP         YA03263 12340000
         MVI   IOBERRCT,X'07'      SET ERR RETRY COUNT TO 7     ZA20123 12342000
         MVC   IOBERCCW+L17(7),IOBCSW   SET ORIG CSW FOR 204C  @ZA32894 12342500
         LH    NAMEREG,ERLOD4      BSC ERROR POST               YA03263 12343000
         B     ERRLINK1            EXIT                         YA03263 12344000
POSTA    EQU   *                                                YA03263 12346000
         LH    NAMEREG,ERLOD5      ADDRESS OF ERROR POST ROUTINE        12350000
         B     ERRLINK1                                                 12450002
RETRY    CLI   IOBERRCT,L2         HAVE WE TRIED THREE TIMES            12500002
         BE    CKDIAL                                                   12550002
         SR    ERREG2,ERREG2                                            12600002
         IC    ERREG2,IOBERRCT     PICK UP RETRY COUNT                  12650002
         LA    ERREG2,L1(ERREG2)   ADD ONE                              12700002
         STC   ERREG2,IOBERRCT     STORE BACK                  @ZA20121 12750000
         CLI   ZERO(CCWREG),X27    IS FAILING CCW A DIAG, ENABLE,       12800002
*                                  OR DISABLE                           12850002
         BL    EREXCP              NO, RESTART WITH FAILING CCW         12900002
FIRST    LA    CCWREG,IOBCPA       YES, RESTART WITH DISABLE            12950002
EREXCP   ST    CCWREG,IOBSTART     INITIALIZE START ADDRESS             13000002
ERRCHK05 EQU   *                                                        13500002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 13550002
         L     NAMEREG,TRANSRTN    LOAD NAME                            15150002
         B     ERRLINK1            XCTL                                 15200002
**********                                                              18300002
*        THE FOLLOWING SUBROUTINE CHECKS THE VALIDITY OF THE CCW        18350002
*        ADDRESS IN THE CSW. IF THE CCW ADDRESS IS VALID, THE ENDING    18400002
*        CCW ADDRESS+8 WILL BE PLACED IN CCWREG, RETURN IS TO NSI+4.    18450002
*        IF THE CCW ADDRESS IS INVALID, RETURN IS MADE TO NSI WITH      18500002
*        THE INVALID ADDRESS IN CCWREG.                                 18550002
**********                                                              18600002
CCWADD   L     CCWREG,IOBSTART     LAST CCW                             18650002
         TM    IOBRESTR,X80        DID A SIO STORE A CSW                18700002
         BO    L4(ERRLNK)          BRANCH YES TO VALID RETURN           18750002
         L     CCWREG,IOBFL3       CCW ADDRESS STORED IN CSW            18800002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                18850002
         SH    CCWREG,ERRCN8       BACK UP 8 BYTES                      18900002
         TM    IOBRESTR+L2,L4      IS IT VALID                          18950002
         BO    L4(ERRLNK)          BRANCH YES TO VALID RETURN  @ZA12164 19000000
         BR    ERRLNK              BRANCH NOT VALID                     19050002
         EJECT                                                          19100002
**********                                                              19150002
*                                                                       19200002
*        CONSTANTS                                                      19250002
*                                                                       19300002
**********                                                              19350002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       19400002
ERLOD4   DC    H'2043'                                          YA03263 19410000
ERLOD5   DC    H'5041'                                                  19450002
CEDEUX   DC    X'0D00'                                                  19500002
ERRCN8   DC    H'8'                                                     19550002
PACHAREA DC    16C'804B'           PATCH AREA FOR MAINTENANCE           19600002
**********                                                              19650002
*                                                                       19700002
*        MISCELLANEOUS EQUATES                                          19750002
*                                                                       19800002
**********                                                              19850002
RETRY1   EQU   1                                                        19900002
CSWSTORD EQU   X'C0'                                                    19950002
HALTIO   EQU   X'10'                                                    20000002
CCWLAST  EQU   X'80'                                                    20050002
RETRYCDE EQU   X'10'                                                    20100002
UNITTYPE EQU   16                                                       20150002
SWLINE   EQU   X'90'                                                    20200002
MASK3    EQU   X'F0'                                                    20250002
CSWSNO   EQU   X'40'                                                    20300002
TIMEOUT  EQU   2041                                                     20350002
DATACHK  EQU   1041                                                     20400002
ERLOD3   EQU   3041                                                     20450002
L255     EQU   255                 AND MASK                             20600002
X06      EQU   X'06'               PREPARE MASK                         20650002
X27      EQU   X'27'               ENABLE MASK                          20700002
X0A      EQU   X'0A'               INHIBIT MASK                         20750002
XC0      EQU   X'C0'               MASK                                 20800002
X40      EQU   X'40'               TERMINATION MASK                     20850002
X29      EQU   X'29'               DIAL MASK                            20900002
X10      EQU   X'10'               EQUIPMENT CHECK MASK                 20950002
X08      EQU   X'08'               DATA CHECK MASK                      21000002
X01      EQU   X'01'               TIMEOUT MASK                         21050002
X80      EQU   X'80'               SIO STORE MASK                       21100002
L1       EQU   1                   LENGTH AND DISPLACEMENT              21150002
L2       EQU   2                   LENGTH AND DISPLACEMENT              21200002
L3       EQU   3                   LENGTH AND DISPLACEMENT              21250002
L4       EQU   4                   LENGTH AND DISPLACEMENT              21300002
L5       EQU   5                   LENGTH AND DISPLACEMENT              21350002
L6       EQU   6                   LENGTH AND DISPLACEMENT              21400002
L7       EQU   7                   LENGTH AND DISPLACEMENT              21450002
L8       EQU   8                   LENGTH AND DISPLACEMENT              21500002
L17      EQU   17                  LENGTH AND DISPLACEMENT              21550002
L19      EQU   19                  LENGTH AND DISPLACEMENT      YA03263 21560000
L29      EQU   29                  LENGTH AND DISPLACEMENT              21600002
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              21650002
BISYNC   EQU   X'90'               UCB TYPE FOR BSC DEVICE      YA03263 21660000
**********                                                              21700002
*                                                                       21750002
*        REGISTER DEFINITION                                            21800002
*                                                                       21850002
**********                                                              21900002
ERREG3   EQU   0                   WORK REG                             21950002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              22000002
UCBREG   EQU   2                   UCB BASE                             22050002
IOBRG    EQU   3                   IOB BASE                             22100002
CCWREG   EQU   4                   CCW ADDRESS                          22150002
ERREG1   EQU   5                   WORK REG                             22200002
BASEREG  EQU   6                   PROGRAM BASE                         22250002
EWAREG   EQU   7                   ERP WORKAREA BASE                    22300002
ERREG2   EQU   8                   WORK REG                             22350002
ERREG4   EQU   9                   WORK REG                             22400002
ERREG6   EQU   10                  WORK REG                             22450002
ERREG7   EQU   11                  WORK REG                             22500002
ERRLNK   EQU   12                  LINK REG                             22550002
NAMEREG  EQU   13                  LINK REG                             22600002
ERRETR   EQU   14                  LINK REG                             22650002
ERREG5   EQU   15                  LINK REG/WORK REG                    22700002
         EJECT                                                          22850002
         IECDRQE                                                        22900002
         EJECT                                                          22950002
         IEZIOB                                                         23000002
         EJECT                                                          23050002
CVT      DSECT                                                          23100002
         CVT                                                            23150002
         EJECT                                                          23200002
         IECDERWA                                                       23250002
**********                                                              23300002
*                                                                       23350002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        23400002
*                                                                       23450002
**********                                                              23500002
         ORG   EWAIERP                                                  23550002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 23600002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 23650002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 23700002
EWAIND0  DS    B                   FLAG BYTE                            23750002
EWAIVISR EQU   X'10'               V=R REQUEST                          24350002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 24400002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 24450002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 24500002
EWAIND1  DS    B                   FLAG BYTE                            24550002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 24600002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 24650002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 24700002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 24710002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 24720002
EWAIND2  DS    B                   FLAG BYTE                            24750002
EWAIND3  DS    B                   FLAG BYTE                            24800002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     24850002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  24900002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 24950002
*********  END OF BTAM LOCAL DEFINITIONS **********                     25000002
         EJECT                                                          25750002
         IECDIOSB                                                       25800002
         END                                                            25850002
./  ADD  SSI=60410459,NAME=IGE0804C
      TITLE 'IGE0804C - BSC ERP EQUIPMENT CHECK/COMMAND REJECT MODULE'  00450002
IGE0804C CSECT                                                          00500002
*********************************************************************** 00550002
*                                                                     * 00600002
* MODULE NAME:                                                        * 00650002
*    IGE0804C                                                         * 00700002
*                                                                     * 00750002
* DESCRIPTIVE NAME:                                                   * 00800002
*    BTAM BSC EQUIPMENT CHECK/COMMAND REJECT ERP                      * 00850002
*                                                                     * 00900002
* COPYRIGHT:                                                          * 00950002
*    NONE                                                             * 01000002
*                                                                     * 01050002
* STATUS:                                                             * 01100002
*    CHANGE LEVEL 000                                                 * 01150002
*                                                                     * 01200002
* FUNCTION:                                                           * 01250002
*    THIS ROUTINE ATTEMPTS RECOVERY OF EQUIPMENT CHECK AND CHANNEL    * 01300002
*    DATA CHECK ERRORS DURING OS/BTAM BINARY SYNCHRONOUS              * 01350002
*    COMMUNICATIONS OPERATION.                                        * 01400002
*                                                                     * 01450002
* NOTES:                                                              * 01500002
*    DEPENDENCIES:                                                    * 01550002
*        NONE                                                         * 01600002
*    RESTRICTIONS:                                                    * 01650002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01700002
*    REGISTER CONVENTIONS:                                            * 01750002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01800002
*                                                                     * 01850002
* PATCHLABEL:                                                         * 01900002
*    PACHAREA (60 BYTES)                                              * 01950002
*                                                                     * 02000002
* MODULE TYPE:                                                        * 02050002
*    PROCEDURE                                                        * 02100002
*    PROCESSOR:                                                       * 02150002
*        BAL                                                          * 02200002
*    MODULE SIZE:                                                     * 02250002
*        606 BYTES                                                    * 02300002
*    ATTRIBUTES:                                                      * 02350002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02400002
*                                                                     * 02450002
* ENTRY POINT:                                                        * 02500002
*    IGE0804C                                                         * 02550002
*    PURPOSE:                                                         * 02600002
*        SEE 'FUNCTION'                                               * 02650002
*    LINKAGE:                                                         * 02700002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02750002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02800002
*    INPUT:                                                           * 02850002
*        REG 1 = ADDRESS OF IOSB                                      * 02900002
*    OUTPUT:                                                          * 02950002
*        ALTERED CHANNEL PROGRAM                                      * 03000002
*        SETS INDICATOR IN DECERRST FOR SHOULD NOT OCCUR ERROR        * 03050002
*                                                                     * 03100002
* EXITS-NORMAL:                                                       * 03150002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03250002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03300002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03350002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03400002
*        LOADS ARE 1000 GREATER.                                      * 03450002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03500002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03550002
*                                                                     * 03600002
* EXITS-ERROR:                                                        * 03650002
*    NONE                                                             * 03700002
*                                                                     * 03750002
* EXTERNAL REFERENCES:                                                * 03800002
*    ROUTINES:                                                        * 03850002
*        NONE                                                         * 03900002
*    DATA AREAS                                                       * 04000002
*        IOB (MAPPED BY IEZIOB)                                       * 04050002
*        VIRTUAL CHANNEL PROGRAM                                      * 04100002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04150002
*    CONTROL BLOCKS                                                   * 04200002
*        DCB                                                          * 04300002
*        DECB                                                         * 04350002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04400002
*        CVT          (MAPPED BY CVT)                                 * 04450002
*        IOB          (MAPPED BY IEZIOB)                              * 04500002
*        RQE          (MAPPED BY IECDRQE)                             * 04550002
*                                                                     * 04700002
* TABLES-WORKAREAS:                                                   * 04750002
*    ERP WORKAREA                                                     * 04800002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04850002
*                                                                     * 04900002
* MACROS:                                                             * 04950002
*    NONE                                                             * 05000002
*                                                                     * 05050002
* CHANGE ACTIVITY:                                                    * 05100002
*    YM02595K (9/20/73)                                               * 05150002
*    YM02594K (9/24/73)                                               * 05160002
*    YA02142  (11/5/73)                                               * 05170002
*    YM05652K (1/25/74)                                               * 05180002
*    AZ08059  (01/26/76)   *                                          * 05190000
*                                                                     * 05200002
*********************************************************************** 05250002
         EJECT                                                          05300002
         USING *,BASEREG                                                05350002
         LR    BASEREG,ERREG5      SET BASE REG                         05400002
         USING RQE,ERREG5                                               05450002
         USING IECTDECB,DECBRG                                          05500002
         USING IHADCB,DCBREG                                            05550002
         USING IOSB,IOSBREG                                             05600002
         USING IOBSTDRD,IOBRG                                           05650002
         USING EWA,EWAREG                                               05700002
         B     AROUND                                                   05708000
         DC    C'IGE0804C'                                              05716000
         DC    C'** MVS *'                                              05724000
         DC    C'&SYSDATE'                                              05732000
         DS    0F                                                       05740000
AROUND   L     ERREG5,IOSUSE       BASE RQE                             05750000
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05800002
         L     IOBRG,RQEIOB        BASE IOB                             05850002
         L     DECBRG,IOBECBPT     BASE DECB                            05900002
         L     DCBREG,IOBDCBPT     BASE DCB                             05950002
         L     UCBREG,IOSUCB        BASE UCB                   @ZA08059 06000000
         DROP  ERREG5                                                   06050002
         L     CCWREG,IOBFL3       GET IOB CSW                          06100002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06150002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW IN IOB         06200002
         MVC   IOBWORK(L1),TPOPCODE(CCWREG)   INITIALIZE WORK AREA      06250002
         NI    IOBWORK,L255-HIBIT   CLEAR UNUSED BITS                   06300002
         TM    IOBSENS0,CSWCDREJ   THIS CMD REJECT                      06350002
         BO    BSCEC03             YES GET NEXT LOAD                    06400002
         TM    IOBCSW+L4,CHNDATCK   CHANNEL DATA CHECK                  06450002
         BO    BSCDC00             YES CONTINUE FLOW                    06500002
         TM    IOBWORK,TPOPDTXT    ERROR DURING TEXT                    06550002
         BNO   BSCEC00E            NO ALL SET FOR RETRY                 06600002
         TM    DCBBFTEK,DYNBUF     THIS DYNAMIC BUFFERING               06650002
         BO    BSCEC02             YES SET PERM ERROR                   06700002
         TM    IOBWORK,TPOPDTXT    ERROR ON WRITE DLE-ETX               06750002
         BO    BSCEC00D            YES, RETRY CCW                       06800002
BSCEC00F CLI   IOBWORK+L4,ZERO     CHECK FOR RD OR SND ENQ              06850002
         BE    BSCEC01             READ ENQ                             06900002
         LA    ERRLNK,CCWWRITE     SET TO GENERATE CHAN PROG            06950002
BSCEC00  LA    ERREG4,CCWTIC       2ND COMMAND CODE                     07000002
BSCEC00A LA    ERREG2,DCBBSENQ     DATA AREA                            07050002
BSCEC00B LA    ERREG1,L1           DATA COUNT                           07100002
BSCEC00C ST    ERREG2,IOBERCCW     CONSTRUCT 1ST CCW DATA ADDR          07150002
         STC   ERRLNK,IOBERCCW     PUT IN COMMAND                       07200002
         ST    ERREG1,IOBERCCW+L4   STORE COUNT                         07250002
         MVI   IOBERCCW+L4,CHAINCDE   SET CCW FLAGS                     07300002
         ST    CCWREG,IOBERCCW+L8   SET TO RETRY CCW ADDRESS            07350002
         STC   ERREG4,IOBERCCW+L8   SET TIC OR NOP COMMAND              07400002
         ST    ERREG1,IOBERINF+L4                               YA02142 07410002
         LA    CCWREG,IOBERCCW     NEW CCW ADDRESS                      07450002
BSCEC00D ST    CCWREG,IOBSTART     SET CCW POINTER TO CHAN RESTART      07550002
BSCEC00E CLI   IOBERRCT,ERRMAXCT   RETRY COUNT AT MAX                   07650002
         BNL   BSCEC02             YES SET PERM ERROR INDICATOR         07700002
         IC    ERREG1,IOBERRCT     PICK UP OLD COUNT                    07750002
         LA    ERREG1,L1(ERREG1)   BUMP TO NEW COUNT                    07800002
         STC   ERREG1,IOBERRCT     STORE NEW COUNT                      07850002
         MVI   EWAIND1,EWAISVCF    EXIT TO SVC 15              YM05652K 07860002
         B     RETRY               ERROR EXCP                           07900002
BSCEC01  CLI   ZERO(CCWREG),CCWREAD   THIS A READ FAILURE               07950002
         BNE   BSCEC01A            NO, SET UP READ ENQ                  08000002
         CLI   IOBCPA,CCWAPOLL     POLLING OPERATION                    08050002
         BNE   BSCEC01A            NO NORMAL READ                       08100002
         L     ERREG1,IOBCPA+L48   READ TEXT CCW                        08150002
         BCTR  ERREG1,ZERO         REDUCE BY ONE                        08200002
         ST    ERREG1,IOBCPA+L48   RESTORE NEW AREA AND COMMAND         08250002
         LH    ERREG1,IOBCPA+L54   PICK UP COUNT                        08300002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE                          08350002
         STH   ERREG1,IOBCPA+L54   PUT NEW COUNT IN CCW                 08400002
         LA    CCWREG,IOBCPA+L48   ADDRESS OF FAILING COMMAND           08500002
BSCEC01A LA    ERREG2,IOBWORK+L2   DATA AREA                            08550002
BSCEC01B LA    ERREG4,CCWNOP       2ND COMMAND                          08600002
         LA    ERRLNK,CCWREAD      GENERATE CHAN PROG 1ST COMMAND       08650002
         MVI   IOBWORK+L1,RTRNCDE0   SPECIAL ROUTIN IND                 08700002
         MVI   IOBERRCT+L1,RTRNSPCD   SET FOR SPECIAL RETURN            08750002
         LA    ERREG1,L2           DATA COUNT                           08800002
         B     BSCEC00C                                                 08850002
BSCDC00  CLI   ZERO(CCWREG),CCWWRITE   ERROR ON A WRITE                 08900002
         BNE   BSCDC01             NO CHECK FURTHER                     08950002
         CLI   IOBWORK,TPOPDTXT    DURING TEXT                          09000002
         BE    BSCEC02             YES SET PERM ERROR                   09050002
         ST    CCWREG,IOBSTART     SET TO RETRY CHAN PROG               09100002
         B     BSCEC00E            CHECK RETRIES                        09200002
BSCDC01  CLI   IOBWORK,TPOPDTXT    DURING TEXT                          09250002
         BNE   BSCDC02             NO CHK FURTHER                       09300002
         TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFERING                    09350002
         BO    BSCEC02             SET PERM ERROR                       09400002
         LA    ERREG2,DCBBSNAK     ADDRESS OF NAK CHARS                 09450002
         LA    ERREG4,CCWTIC       2ND COMMAND                          09500002
         LA    ERRLNK,CCWWRITE     1ST COMMAND                          09550002
         B     BSCEC00B            GENERATE CHAN PROGRAM                09600002
BSCDC02  CLI   IOBWORK,TPOPRENQ    READ ENQ                             09650002
         BE    BSCEC00D            YES RETRY CHAN PROG                  09700002
         B     BSCEC00F            CHECK SEND OR RCV ENQ                09750002
BSCEC02  NI    IOSFLA,L255-IOSERR   INDICATE PERM ERROR                 09800002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     09810002
         LA    NAMEREG,ERLOD25     ADDRESS OF ERROR POST                09850002
XCTLOUT  EQU   *                                                        09900002
         MVC   EWACHA(L2),L4(UCBREG) MOVE UNIT ADDR TO WK AREA @ZA08059 09920000
         L     ERRETR,CVTPTR       POINT TO CVT                         09950002
         USING CVTMAP,ERRETR                                            10000002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                10050002
         DROP  ERRETR                                                   10100002
         BR    ERRETR              XCTL                                 10150002
BSCEC03  SR    ERREG1,ERREG1       CLEAR LINKAGE REGISTER               10200002
         CLI   IOBERRCT+L1,NORMRET   SPECIAL RETURN                     10250002
         BNE   BSCCR02             YES, CHK FOR GOOD WRT DLE            10300002
         CLI   ZERO(CCWREG),CCWRDCMD   READ COMMAND                     10350002
         BNE   BSCCR03             NO,  INDICATE SNO ERR                10400002
         CLI   DECTPCOD,RDRESPOP   READ RESP AFTER TEXT                 10450002
         BNE   BSCCR03             NO,  INDICATE SNO ERR                10500002
         MVC   IOBWORK+L2(L1),DCBBSDLE   PICK UP DLE CHAR               10550002
         MVC   IOBWORK+L3(L1),DCBBSENQ   PICK UP ENQ CHAR               10600002
         LA    ERREG2,IOBWORK+L2   ADDRESS OF AREA                      10650002
         LA    ERRLNK,CCWWRTCD     FIRST COMMAND CODE                   10700002
         LA    ERREG4,NOOP         SECOND COMMAND                       10750002
         LA    ERREG1,L2           COUNT                                10800002
         ST    ERREG2,IOBERCCW     SET UP AREA IN CCW                   10850002
         STC   ERRLNK,IOBERCCW     PUT IN COMMAND                       10900002
         STH   ERREG1,IOBERCCW+L6   PUT IN COUNT                        10950002
         MVI   IOBERCCW+L4,CHAINCDE   SET CHAINING                      11000002
         ST    CCWREG,IOBERCCW+L8   RESTART ADDRESS                     11050002
         STC   ERREG4,IOBERCCW+L8   SECOND COMMAND                      11100002
         ST    ERREG1,IOBERCCW+L12   COUNT IN SECOND CCW                11150002
         MVI   IOBERRCT+L1,SPECRET   SPECIAL RETURN SET                 11200002
         CLI   IOBERRCT,ERRMAXCT   RETRIES EXHAUSTED                    11300002
         BE    BSCCR03             YES,  SET PERM ERROR                 11350002
         IC    ERREG1,IOBERRCT     UPDATE RETRY COUNT                   11400002
         LA    ERREG1,L1(ERREG1)   TO NEW VALUE                         11450002
         STC   ERREG1,IOBERRCT     STORE IN COUNT FIELD                 11500002
         LA    CCWREG,IOBERCCW     CHAN START                           11550002
         ST    CCWREG,IOBSTART     SET RESTART ADDRESS                  11600002
         MVI   EWAIND1,EWAISVCF    EXIT TO SVC 15              YM05652K 11650002
         B     RETRY               ERROR EXCP                           11700002
BSCCR03  NI    IOSFLA,L255-IOSERR   INDICATE PERM ERROR                 11750002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     11760002
         MVI   IOBERRCT,ERRMAXCT   INDICATE NO RETRIES                  11800002
         LA    NAMEREG,ERLOD25     ADDRESS OF ERROR POST                11850002
         B     XCTLOUT             EXIT                                 11900002
BSCCR02  TM    IOBCSW+L3,L255-CSWCDE   ANY COND BUT CE-DE               11950002
         BM    BSCCR03             YES, PERMANENT ERROR                 12000002
         TM    IOBCSW+L3,CSWCDE    CHAN END AND DEV END                 12050002
         BNO   BSCCR03             NO,  PERMANENT ERROR                 12100002
         CLI   IOBCSW+L4,ZERO      ANY STATUS IN BYTE 2                 12150002
         BNE   BSCCR03             YES, PERMANENT ERROR                 12200002
         MVC   IOBSTART+L1(L3),IOBERCCW+L9   WRT DLE-ENQ WAS GOOD       12250002
         MVI   IOBERRCT+L1,NORMRET   NORMAL RETURN, RETRY FAILING CCW   12350002
         MVI   EWAIND1,EWAISVCF    EXIT TO SVC 15              YM05652K 12360002
RETRY    EQU   *                                                        12400002
         L     NAMEREG,TRANSRTN    LOAD NAME                            14050002
         B     XCTLOUT             XCTL                                 14100002
         EJECT                                                          18100002
**********                                                              18150002
*                                                                       18200002
*        CONSTANTS                                                      18250002
*                                                                       18300002
**********                                                              18350002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       18400002
ERRCN8   DC    H'8'                                                     18450002
PACHAREA DC    15C'804C'           PATCH AREA FOR MAINTENANCE           18500002
**********                                                              18550002
*                                                                       18600002
*        MISCELLANEOUS EQUATES                                          18650002
*                                                                       18700002
**********                                                              18750002
CSWCDREJ EQU   X'80'                                                    18900002
RTRNCDE0 EQU   X'80'                                                    19000002
CCWNOP   EQU   3                                                        19050002
TPOPDTXT EQU   X'11'                                                    19100002
CHAINCDE EQU   X'60'                                                    19150002
CHNDATCK EQU   X'08'                                                    19200002
TPOPCODE EQU   5                                                        19250002
L255     EQU   X'FF'               AND MASK                             19300002
CCWREAD  EQU   X'02'                                                    19350002
HIBIT    EQU   X'C0'                                                    19400002
ERRMAXCT EQU   7                                                        19450002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              19500002
L1       EQU   1                   LENGTH AND DISPLACEMENT              19550002
L2       EQU   2                   LENGTH AND DISPLACEMENT              19600002
L3       EQU   3                   LENGTH AND DISPLACEMENT              19650002
L4       EQU   4                   LENGTH AND DISPLACEMENT              19700002
L5       EQU   5                   LENGTH AND DISPLACEMENT              19750002
L6       EQU   6                   LENGTH AND DISPLACEMENT              19800002
L7       EQU   7                   LENGTH AND DISPLACEMENT              19850002
L8       EQU   8                   LENGTH AND DISPLACEMENT              19900002
L9       EQU   9                   LENGTH AND DISPLACEMENT              19950002
L12      EQU   12                  LENGTH AND DISPLACEMENT              20000002
L48      EQU   48                  LENGTH AND DISPLACEMENT              20050002
L54      EQU   54                  LENGTH AND DISPLACEMENT              20100002
TPOPRENQ EQU   X'0B'                                                    20250002
DYNBUF   EQU   X'08'                                                    20300002
CCWAPOLL EQU   X'09'                                                    20350002
CCWWRITE EQU   X'01'                                                    20400002
CCWTIC   EQU   X'08'                                                    20450002
ERLOD25  EQU   2043                                                     20600002
RTRNSPCD EQU   X'14'                                                    20650002
CCWRDCMD EQU   X'02'               READ COMMAND CODE                    20700002
CCWWRTCD EQU   X'01'               WRITE COMMAND CODE                   20750002
CSWCDE   EQU   X'0C'               CHAN-DEVICE END                      20800002
NOOP     EQU   X'03'                                                    20850002
NORMRET  EQU   X'00'               NORMAL RETURN                        20900002
RDRESPOP EQU   X'25'               BSC RD RESP AFTER TXT                20950002
SPECRET  EQU   X'04'               SPECIAL RETURN CMDREJ                21000002
**********                                                              21100002
*                                                                       21150002
*        REGISTER DEFINITIONS                                           21200002
*                                                                       21250002
**********                                                              21300002
ERREG3   EQU   0                   WORK REG                             21350002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              21400002
ERREG2   EQU   2                   WORK REG                             21450002
EWAREG   EQU   3                   ERP WORKAREA BASE                    21500002
CCWREG   EQU   4                   CCW ADDRESS REG                      21550002
DECBRG   EQU   5                   DECB BASE                            21600002
DCBREG   EQU   6                   DCB BASE                             21650002
UCBREG   EQU   7                   UCB BASE                             21700002
BASEREG  EQU   8                   PROGRAM BASE                         21750002
ERREG1   EQU   9                   WORK REG                             21800002
IOBRG    EQU   10                  IOB BASE                             21850002
ERREG4   EQU   11                  WORK REG                             21900002
ERRLNK   EQU   12                  LINK REG                             21950002
NAMEREG  EQU   13                  LINK REG                             22000002
ERRETR   EQU   14                  LINK REG                             22050002
ERREG5   EQU   15                  LINK REG/WORK REG                    22100002
         EJECT                                                          22150002
         DCBD  DSORG=BX,DEVD=BS                                         22200002
         EJECT                                                          22250002
         IECTDECB                                                       22300002
         EJECT                                                          22450002
         IECDRQE                                                        22500002
         EJECT                                                          22550002
         IEZIOB                                                         22600002
         EJECT                                                          22650002
CVT      DSECT                                                          22700002
         CVT                                                            22750002
         EJECT                                                          22800002
         IECDERWA                                                       22850002
**********                                                              22900002
*                                                                       22950002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        23000002
*                                                                       23050002
**********                                                              23100002
         ORG   EWAIERP                                                  23150002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 23200002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 23250002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 23300002
EWAIND0  DS    B                   FLAG BYTE                            23350002
EWAIVISR EQU   X'10'               V=R REQUEST                          23950002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 24000002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 24050002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 24100002
EWAIND1  DS    B                   FLAG BYTE                            24150002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 24200002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 24250002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 24300002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 24310002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 24320002
EWAIND2  DS    B                   FLAG BYTE                            24350002
EWAIND3  DS    B                   FLAG BYTE                            24400002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     24450002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  24500002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 24550002
*********  END OF BTAM LOCAL DEFINITIONS **********                     24600002
         EJECT                                                          25350002
         IECDIOSB                                                       25400002
         END                                                            25450002
./  ADD  SSI=70700224,NAME=IGE0904A
         TITLE 'IGE0904A - BTAM ERP CONTROL LOAD TWO MODULE'            00650002
IGE0904A CSECT                                                          00700002
*********************************************************************** 00750002
*                                                                     * 00800002
* MODULE NAME:                                                        * 00850002
*    IGE0904A                                                         * 00900002
*                                                                     * 00950002
* DESCRIPTIVE NAME:                                                   * 01000002
*    BTAM ERP CONTROL, LOAD 2                                         * 01050002
*                                                                     * 01100002
* COPYRIGHT:                                                          * 01150002
*    NONE                                                             * 01200002
*                                                                     * 01250002
* STATUS:                                                             * 01300002
*    CHANGE LEVEL 000                                                 * 01350002
*                                                                     * 01400002
* FUNCTION:                                                           * 01450002
*    THIS MODULE IS ENTERED FOR EQUIPMENT CHECK ERRORS. IT DETERMINES * 01500002
*    IF A SPECIAL ENTRY IS REQUIRED FOR EXECUTING DISABLE. IF         * 01550002
*    REQUIRED THE FAILING CHANNEL PROGRAM IS RETRIED.                 * 01600002
*                                                                     * 01650002
* NOTES:                                                              * 01700002
*    DEPENDENCIES:                                                    * 01750002
*        NONE                                                         * 01800002
*    RESTRICTIONS:                                                    * 01850002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01900002
*    REGISTER CONVENTIONS:                                            * 01950002
*        SEE 'REGISTER DEFINITION' BELOW                              * 02000002
*                                                                     * 02050002
* PATCHLABEL:                                                         * 02100002
*    PACHAREA (28 BYTES)                                              * 02150002
*                                                                     * 02200002
* MODULE TYPE:                                                        * 02250002
*    PROCEDURE                                                        * 02300002
*    PROCESSOR:                                                       * 02350002
*        BAL                                                          * 02400002
*    MODULE SIZE:                                                     * 02450002
*        292 BYTES                                                    * 02500002
*    ATTRIBUTES:                                                      * 02550002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02600002
*                                                                     * 02650002
* ENTRY POINT:                                                        * 02700002
*    IGE0904A                                                         * 02750002
*    PURPOSE:                                                         * 02800002
*        SEE 'FUNCTION'                                               * 02850002
*    LINKAGE:                                                         * 02900002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02950002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 03000002
*    INPUT:                                                           * 03050002
*        REG 1 = ADDRESS OF IOSB                                      * 03100002
*    OUTPUT:                                                          * 03150002
*        SETS INDICATOR IN DECERRST FOR SHOULD NOT OCCUR ERROR        * 03200002
*        ALTERED CHANNEL PROGRAM                                      * 03250002
*                                                                     * 03300002
* EXITS-NORMAL:                                                       * 03350002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03450002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03500002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03550002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03600002
*        LOADS ARE 1000 GREATER.                                      * 03650002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03700002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03750002
*                                                                     * 03800002
* EXITS-ERROR:                                                        * 03850002
*    NONE                                                             * 03900002
*                                                                     * 03950002
* EXTERNAL REFERENCES:                                                * 04000002
*    ROUTINES:                                                        * 04050002
*        NONE                                                         * 04100002
*    DATA AREAS                                                       * 04200002
*        IOB (MAPPED BY IEZIOB)                                       * 04250002
*        VIRTUAL CHANNEL PROGRAM                                      * 04300002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04350002
*    CONTROL BLOCKS                                                   * 04400002
*        UCB                                                          * 04450002
*        DCB                                                          * 04500002
*        DECB                                                         * 04550002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04600002
*        CVT          (MAPPED BY CVT)                                 * 04650002
*        IOB          (MAPPED BY IEZIOB)                              * 04700002
*        RQE          (MAPPED BY IECDRQE)                             * 04750002
*                                                                     * 04900002
* TABLES-WORKAREAS:                                                   * 04950002
*    ERP WORKAREA                                                     * 05000002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 05050002
*                                                                     * 05100002
* MACROS:                                                             * 05150002
*    NONE                                                             * 05200002
*                                                                     * 05250002
* CHANGE ACTIVITY:                                                    * 05300002
*    YM02595K (9/20/73)                                               * 05350002
*    YM02594K (9/24/73)                                               * 05360002
*    YM05652K (1/25/74)                                               * 05370002
*    ZA14045  (09/28/76)                                              * 05380000
*                                                                     * 05400002
*********************************************************************** 05450002
         EJECT                                                          05500002
         USING *,BASEREG                                                05550002
         LR    BASEREG,ERREG5      SET BASE REG                         05600002
         USING RQE,ERREG5                                               05650002
         USING IOSB,IOSBREG                                             05700002
         USING IOBSTDRD,IOBRG                                           05750002
         USING EWA,EWAREG                                               05800002
         L     ERREG5,IOSUSE       BASE RQE                             05850002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05900002
         L     IOBRG,RQEIOB        BASE IOB                             05950002
         L     DECBRG,IOBECBPT     BASE DECB                            06000002
         L     DCBREG,IOBDCBPT     BASE DCB                             06050002
         L     UCBREG,IOSUCB       BASE UCB                             06100002
         DROP  ERREG5                                                   06150002
         L     CCWREG,IOBFL3       POINT TO CCW                         06200002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                06250002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                06300002
         CLI   IOBERRCT+L1,MASK15   SPECIAL ENTRY                       06350002
         BE    ERRTOVR5            YES                                  06400002
         OC    EWASTUP(L1),IOBSENS0   PUT SENSE DATA INTO TABLE         06450002
         CLI   IOBERRCT,ERTRYCT    RETRY COUNT 2                        06500002
         BE    ERRTOVR             YES POST COMPLETE                    06550002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  06600002
         LA    ERREG1,L1(ERREG1)   UPDATE COUNT                         06650002
         STC   ERREG1,IOBERRCT     STORE IN COUNT FIELD                 06700002
         ST    CCWREG,IOBSTART     START PTR TO FAILING CCW             06750002
         B     RETRY               EXIT                                 07250002
ERRTOVR  TM    IOBCSW+L3,CSWASCB   SHOULD NOT OCCUR ERROR               07300002
         BNZ   ERRTOVR1            YES SNO MSG REQ                      07350002
         TM    IOBCSW+L3,CSWUCK    UNIT CHECK                           07400002
         BZ    ERRTOVR1            NO INDICATE SNO ERROR                07450002
         TM    IOBSENS0,CSWCRBO    CMD REJ OR BUSS OUT                  07500002
         BNZ   ERRTOVR2            YES-BYPASS SNO MESSAGE               07550002
ERRTOVR1 OI    DECERRST(DECBRG),CSWSNO   INDICATE SNO ERROR             07600002
ERRTOVR2 TM    IOBSIOCC,IOBCCODE     SIO COND CODE 1                    07650002
         BZ    ERRTOVR3            NO CONTINUE                          07700002
         LA    ERREG1,ERRCN08      BUMP CONSTANT                        07750002
         MVC   IOBCSW(L3),IOBSTART+L1   RESET CSW                       07800002
ERRTOVR4 L     ERREG2,IOBFL3       FIRST WORD OF CSW                    07850002
         LA    ERREG2,ZERO(ERREG2)   CLEAR OUT FLAG BYTE                07900002
         AR    ERREG2,ERREG1       ADJUST TO FAILING CCW                07950002
         ST    ERREG2,EWAISAVE     STORE IN EWA                         08000002
         MVC   IOBCSW(L3),EWAISAVE+L1   STORE IN CSW                    08050002
         NI    IOBSIOCC,L255-IOBCCODE   TURN OF SIO COND CODE           08150002
         NI    IOSCC,L255-IOBCCODE   DO SAME IN IOSB                    08200002
ERRTOVR3 MVI   IOBERRCT+L1,TERMPASS   INDICATE TERM ID BYPASS           08250002
         OI    IOSFLB,IOSLOG       INDICATE LOG OUT                     08300002
         LH    NAMEREG,ERLOD5      ADDRESS OF  POST ROUTINE             08350002
XCTLOUT  EQU   *                                                        08400002
         L     ERRETR,CVTPTR       POINT TO CVT                         08450002
         USING CVTMAP,ERRETR                                            08500002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                08550002
         DROP  ERRETR                                                   08600002
         BR    ERRETR              XCTL                                 08650002
ERRTOVR5 TM    UCBTYP+L1(UCBREG),SWLINE   DISABLE REQUIRED              08700002
         BZ    ERRTOVR3            NO, WTO                              08750002
         MVC   IOBERINF+L8(L8),ZERO(CCWREG)   SAVE FAILING CCW          08800002
         MVC   IOBERINF(L1),IOBSENS0   SAVE SENSE DATA                  08850002
         MVC   IOBERINF+L1(L7),IOBCSW   SAVE CSW DATA                   08900002
         MVI   IOBERRCT+L1,DISABIND   INDICATE DISABLE EXECUTED         08950002
         OI    IOSFLB,IOSLOG       INDICATE LOG OUT                     09000002
         MVC   IOBERCCW(L8),DISABCMD   GENERATE CCW                     09050002
         LA    ERREG1,IOBERCCW     CHANNEL PROGRAM START                09100002
         ST    ERREG1,IOBSTART     MAKE IOBSTART = IOBERCCW    @ZA14045 09170000
RETRY    EQU   *                                                        09250002
         MVI   EWAIND1,EWAISVCF    SVC 15/SVC 3                YM05652K 09300002
         L     NAMEREG,TRANSRTN    LOAD NAME                            10900002
         B     XCTLOUT             XCTL                                 10950002
         EJECT                                                          14050002
**********                                                              14100002
*                                                                       14150002
*        CONSTANTS                                                      14200002
*                                                                       14250002
**********                                                              14300002
         DS    0D                                                       14350002
DISABCMD DC    X'2F00000020300001'                                      14400002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       14450002
ERRCN8   DC    H'8'                                                     14500002
ERLOD5   DC    H'5041'                                                  14600002
PACHAREA DC    7C'904A'            PATCH AREA FOR MAINTENANCE           14650002
**********                                                              14700002
*                                                                       14750002
*        MISCELLANEOUS EQUATES                                          14800002
*                                                                       14850002
**********                                                              14900002
IOBCCODE EQU   X'10'               SIO CC = 1                           14910002
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              14950002
L1       EQU   1                   LENGTH AND DISPLACEMENT              15000002
L2       EQU   2                   LENGTH AND DISPLACEMENT              15050002
L3       EQU   3                   LENGTH AND DISPLACEMENT              15100002
L4       EQU   4                   LENGTH AND DISPLACEMENT              15150002
L5       EQU   5                   LENGTH AND DISPLACEMENT              15200002
L6       EQU   6                   LENGTH AND DISPLACEMENT              15250002
L7       EQU   7                   LENGTH AND DISPLACEMENT              15300002
L8       EQU   8                   LENGTH AND DISPLACEMENT              15350002
CSWASCB  EQU   X'F0'                                                    15400002
CSWCRBO  EQU   X'A0'                                                    15450002
CSWSNO   EQU   X'40'                                                    15500002
CSWUCK   EQU   X'02'               UNIT CHECK                           15550002
DECERRST EQU   29                                                       15600002
DISABIND EQU   X'80'                                                    15650002
ERRCN08  EQU   8                                                        15700002
ERTRYCT  EQU   X'02'                                                    15750002
L255     EQU   255                 AND MASK                             15900002
MASK15   EQU   X'0F'                                                    15950002
SWLINE   EQU   X'90'                                                    16050002
TERMPASS EQU   X'40'                                                    16100002
UCBTYP   EQU   16                  DEVICE TYPE CODE                     16150002
**********                                                              16200002
*                                                                       16250002
*        REGISTER DEFINITION                                            16300002
*                                                                       16350002
**********                                                              16400002
ERREG3   EQU   0                   WORK REG                             16450002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              16500002
ERREG2   EQU   2                   WORK REG                             16550002
EWAREG   EQU   3                   ERP WORKAREA BASE                    16600002
CCWREG   EQU   4                   CCW ADDRESS REG                      16650002
DECBRG   EQU   5                   DECB BASE                            16700002
DCBREG   EQU   6                   DCB BASE                             16750002
UCBREG   EQU   7                   UCB BASE                             16800002
BASEREG  EQU   8                   PROGRAM BASE                         16850002
ERREG1   EQU   9                   WORK REG                             16900002
IOBRG    EQU   10                  IOB BASE                             16950002
ERREG4   EQU   11                  WORK REG                             17000002
ERRLNK   EQU   12                  LINK REG                             17050002
NAMEREG  EQU   13                  LINK REG                             17100002
ERRETR   EQU   14                  LINK REG                             17150002
ERREG5   EQU   15                  WORK REG/LINK REG                    17200002
         EJECT                                                          17250002
         IECDRQE                                                        17400002
         EJECT                                                          17450002
         IEZIOB                                                         17500002
         EJECT                                                          17550002
CVT      DSECT                                                          17600002
         CVT                                                            17650002
         EJECT                                                          17700002
         IECDERWA                                                       17750002
**********                                                              17800002
*                                                                       17850002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        17900002
*                                                                       17950002
**********                                                              18000002
         ORG   EWAIERP                                                  18050002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 18100002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 18150002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 18200002
EWAIND0  DS    B                   FLAG BYTE                            18250002
EWAIVISR EQU   X'10'               V=R REQUEST                          18850002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 18900002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 18950002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 19000002
EWAIND1  DS    B                   FLAG BYTE                            19050002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 19100002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 19150002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 19200002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 19210002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 19220002
EWAIND2  DS    B                   FLAG BYTE                            19250002
EWAIND3  DS    B                   FLAG BYTE                            19300002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     19350002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  19400002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 19450002
*********  END OF BTAM LOCAL DEFINITIONS **********                     19500002
         EJECT                                                          20250002
         IECDIOSB                                                       20300002
         END                                                            20350002
./  ADD  SSI=72580076,NAME=IGE0904B
         TITLE 'IGE0904B - BTAM ERP TRANSLATE MODULE'                   00600002
IGE0904B CSECT                                                          00650002
*********************************************************************** 00700002
*                                                                     * 00750002
* MODULE NAME:                                                        * 00800002
*    IGE0904B                                                         * 00850002
*                                                                     * 00900002
* DESCRIPTIVE NAME:                                                   * 00950002
*    BTAM ERROR RECOVERY TRANSLATE PROCEDURE                          * 01000002
*                                                                     * 01050002
* COPYRIGHT:                                                          * 01100002
*    NONE                                                             * 01150002
*                                                                     * 01200002
* STATUS:                                                             * 01250002
*    CHANGE LEVEL 001                                                 * 01300002
*                                                                     * 01350002
* FUNCTION:                                                           * 01400002
*    MAKE CORRESPONDING CHANGES TO REAL CCWS AFTER VIRTUAL ONES       * 01450002
*    HAVE BEEN ALTERED.                                               * 01500002
*                                                                     * 01550002
* NOTES:                                                              * 01600002
*    DEPENDENCIES:                                                    * 01650002
*        NONE                                                         * 01700002
*    RESTRICTIONS:                                                    * 01750002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01800002
*    REGISTER CONVENTIONS:                                            * 01850002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01900002
*                                                                     * 01950002
* PATCHLABEL:                                                         * 02000002
*    PACHAREA                                                         * 02050000
*                                                                     * 02100002
* MODULE TYPE:                                                        * 02150002
*    PROCEDURE                                                        * 02200002
*    PROCESSOR:                                                       * 02250002
*        BAL                                                          * 02300002
*    ATTRIBUTES:                                                      * 02450002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, LOCAL LOCKS     * 02500002
*        HELD AROUND TRANSLATOR CALLS                                 * 02550002
*                                                                     * 02600002
* ENTRY POINT:                                                        * 02650002
*    IGE0904B                                                         * 02700002
*    PURPOSE:                                                         * 02750002
*        SEE 'FUNCTION'                                               * 02800002
*    LINKAGE:                                                         * 02850002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02900002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02950002
*    INPUT:                                                           * 03000002
*        REG 1 = ADDRESS OF IOSB                                      * 03050002
*    OUTPUT:                                                          * 03100002
*        REAL CHANNEL PROGRAM FOR RETRY.                              * 03150000
*                                                                     * 03200002
* EXITS-NORMAL:                                                       * 03250002
*    SUPERVISOR VIA SVC 3                                             * 03300002
*    LINKAGE TO TP RECORDER (IGE0625F)                                * 03302000
*    LINKAGE TO STAT. UPDATE ROUTINE (IGE0025D)                       * 03304000
*    LINKAGE TO WTO ROUTINE (IGE0025C)                                * 03306000
*                                                                     * 03350002
* EXITS-ERROR:                                                        * 03400002
*    NONE                                                             * 03450002
*                                                                     * 03500002
* EXTERNAL REFERENCES:                                                * 03550002
*    ROUTINES:                                                        * 03600002
*        ESTAE                                                        * 03650002
*        SETLOCK                                                      * 03700002
*        SETRP                                                        * 03750002
*        GETMAIN                                                      * 03800002
*        FREEMAIN                                                     * 03850002
*        SVC 15 ERROR EXCP                                            * 03900002
*        IOS CCW TRANSLATOR                                           * 03950002
*    DATA AREAS                                                       * 04000002
*        IOB (MAPPED BY IEZIOB)                                       * 04050002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04100002
*    CONTROL BLOCKS                                                   * 04150002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04200002
*        CVT          (MAPPED BY CVT)                                 * 04250002
*        IOB          (MAPPED BY IEZIOB)                              * 04300002
*        RQE          (MAPPED BY IECDRQE)                             * 04350002
*        TCCW         (MAPPED BY IECDTCCW)                            * 04400002
*        SDWA         (MAPPED BY IHASDWA)                             * 04450002
*                                                                     * 04500002
* TABLES-WORKAREAS:                                                   * 04550002
*    ERP WORKAREA                                                     * 04600002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04650002
*    ERP EXTENSION TO IOB                                             * 04660000
*                                                                     * 04700002
* MACROS:                                                             * 04750002
*    FREEMAIN                                                         * 04800002
*    GETMAIN                                                          * 04850002
*    ESATE                                                            * 04900002
*    SETLOCK                                                          * 04950002
*    SETRP                                                            * 05000002
*                                                                     * 05050002
* CHANGE ACTIVITY:                                                    * 05100002
*    YM02595K (9/20/73)                                               * 05150002
*    YM02594K (9/24/73)   (COMPLETE REWRITE)                          * 05200002
*    YM04094K (11/9/73)                                               * 05210002
*    YM05673K (1/7/74)                                                * 05220002
*    YM05652K (1/25/74)                                               * 05230002
*    YM05680K (1/25/74)                                               * 05240002
*    YM05697K (2/12/74)                                               * 05242000
*    YM07715K (4/10/74)                                               * 05244000
*    ZA03207 (03/24/75)                                               * 05246003
*    ZA04156 (04/29/75)          AZ04166 (08/25/75)                   * 05248003
*    AZ04853 (08/27/75)          AZ04874 (09/23/75)                     05248403
*    AZ07662 (11/25/75)          AZ07668 (01/23/76)                   * 05248803
*    AZ08475 (01/14/76)          AZ08084 (06/21/76)                     05249203
*    AZ12160  (08/06/76)         AZ13203 (09/08/76)                   * 05249600
*    AZ14034  (09/14/76)         AZ14061 (10/11/76)                   * 05250000
*    AZ14136  (10/26/76)         AZ15404 (11/23/76)                   * 05270000
*    AZ17698  (04/04/77)         AZ20113 (09/14/77)                   * 05275000
*********************************************************************** 05300002
         EJECT                                                          05350002
         USING *,BASEREG                                                05400002
         LR    BASEREG,ERREG5      BASE MODULE                          05450002
         USING RQE,RQEREG                                               05500002
         USING IOSB,IOSBREG                                             05550002
         USING IOBSTDRD,IOBRG                                           05600002
         USING EWA,EWAREG                                               05650002
         B     BEGIN               BRANCH AROUND ID            @ZA12160 05651000
         DC    C'IGE0904B'         MODULE ID                   @ZA12160 05652000
         DC    CL8'&SYSDATE'       ASSEMBLY DATE               @ZA12160 05653000
         DC    C'UZ14366'                                      @ZA20133 05654000
         DS    0H                                              @ZA12160 05655000
BEGIN    LR    IOSBREG,PARMREG     BASE IOSB                   @ZA12160 05658000
         L     RQEREG,IOSUSE       BASE RQE                             05750002
         L     EWAREG,IOSERP       BASE ERP WORK AREA                   05800002
         L     IOBRG,RQEIOB        BASE IOB                             05850002
         LA    IOBRG,ZERO(IOBRG) CLEAR HI ORDER BYTE           @ZA03207 05860003
         MVC   EWAIEXIT(L16),EXITADDR   MOVE ESTAE LIST TO ERP WA       05900002
         LA    PARMREG,EWAIEXIT    POINT TO ESTAE LIST                  05950002
*            ONE LINE REMOVED BY------------------------------>@ZA15404 06000000
         MVI   IOBSENS1,ZERO       CLEAR UNUSED SENSE BYTE     YM04094K 06010002
         MVC   IOSSNS(L2),IOBSENS0   MOVE SENSE TO IOSB                 06050002
*                                                                       06100002
*                                  THE FOLLOWING MOVE IS FOR THE WHOLE  06150002
*                                  CSW IN AN ATTEMPT TO FAKE EXCP       06200002
*                                  COMPATIBILITY INTERFACE IOB MAPPING  06250002
*                                  ON FINAL EXIT TO APPENDAGE. THIS     06300002
*                                  WILL HAVE TO BE CHANGED WHEN EXCP    06350002
*                                  STARTS TO VALIDITY CHECK THE CSW     06400002
*                                  CONTENTS.                            06450002
*                                                                       06500002
         MVC   IOSCSW(L7),IOBIOCSW   MOVE CSW COMPLETELY                06600002
START    EQU   *                                                        06650002
         L     ERREG1,RQEUCB       SET UP UCB ADDRESSABILITY   @ZA08084 06650303
         TM    L19(ERREG1),NINETY  BISYNC DEVICE               @ZA08084 06650603
         BO    START1              YES,CHECK V=R               @ZA08084 06650903
         L     ERREG1,IOBECBPT     SET UP DECB ADDRESSABILITY  @ZA08084 06651203
         CLI   L5(ERREG1),READTI   IS THIS A READ INITIAL      @ZA08084 06651503
         BE    START0              BRANCH, YES                 @ZA20113 06651600
         CLI   L5(ERREG1),READTIR  IS THIS READ TIR            @ZA20113 06651700
         BNE   START1              NO,CHECK V=R                @ZA08084 06651803
START0   L     ERREG1,IOBSTART     GET CCW START ADDRESS PTR   @ZA20113 06652100
         CLI   L16(ERREG1),L8      IS THIS A TIC               @ZA08084 06652403
         BNE   START1              NO,CHECK V=R                @ZA08084 06652703
         CLI   L22(ERREG1),L2      SPEC. ERROR COUNT=02        @ZA08084 06653003
         BE    START1              YES,CHECK V=R               @ZA08084 06653303
         CLI   L22(ERREG1),ZERO    SPEC. ERROR COUNT=0         @ZA08084 06653603
         MVI   L22(ERREG1),L1      SET TO 1                    @ZA08084 06653903
         BE    EXCPCOND            YES,CHECK FOR EXCP. COND.   @ZA08084 06654203
         MVI   L22(ERREG1),L2      SET TO 2                    @ZA08084 06654503
EXCPCOND TM    IOBFLAG1,L4         EXCEPTIONAL CONDITION ON    @ZA08084 06654803
         BNO   START1              NO,CHECK V=R                @ZA08084 06655103
         TM    IOBFLAG1,L2         ERP IN CONTROL              @ZA08084 06655403
         BNO   START1              NO,CHECK V=R                @ZA08084 06655703
         CLI   EWAIND1,EWAIWTOL    WTO BIT ON                  @ZA08084 06656003
         BE    START1              YES,CHECK V=R               @ZA08084 06656303
         NI    IOSFLA,L255-IOSEX-IOSERR  SET NORM COMP IN IOSB @ZA08084 06656603
         NI    IOBFLAG1,L255-IOSEX-IOSERR  ALSO IN IOB         @ZA08084 06656903
         MVI   IOBWORK+L1,SPMBFLAG SET SPEC FLAG FOR MB        @ZA08084 06657203
         MVI   EWAIND1,EWAISVCF    SET UP FOR SVC 15           @ZA08084 06657503
START1   TM    RQETYPE,RQE1TO1        DOES V EQUAL R ?         @ZA08084 06660003
         BO    RESET1                 YES SKIP TRANSLATION     @ZA04166 06670003
         TM    IOBFLAG1,IOBERRTN+IOBIOERR   IS THIS A RETRY SITUATION   06700002
         BO    RETRY               YES                                  06750002
         TM    EWAIND0,EWAIPMAP    ANY PARALLEL MAPPING DONE            06800002
         BNO   RESET               NO                                   06850002
         L     PARMREG,EWAITCCW    ADDR OF TCCW             L5 @ZA04156 06900003
         BAL   ERREG7,CHANGE1      DO THE UNFIX             L5 @ZA04156 06940003
RESET    EQU   *                                                        07800002
         BAL   ERREG1,ERPEXT  GET ADDR OF CURR EXT ENTRY    L5 @ZA04156 07857003
         CLC   ZERO(L4,ERRETR),FULL0  ENTRY EXIST?          L5 @ZA04156 07864003
         BE    RESET1                 NO,NOTHING TO UNFIX   L5 @ZA04156 07871003
         L     PARMREG,ZERO(ERRETR)   ADDR OF TCCW          L5 @ZA04156 07878003
         BAL   ERREG7,CHANGE1         UNFIX IT              L5 @ZA04156 07885003
RESET1   EQU   *                                            L5 @ZA04156 07892003
*        ONE LINE OF CODE DELETED BY APAR ---------->          @ZA07668 07892600
         L     ERREG4,IOBSTART     GET RESTART CCW ADDRESS     @ZA13203 07892700
         TM    IOBFLAG1,IOBERRTN+IOBIOERR  RETRY SITUATION?    @ZA13203 07892800
         BO    STOREIT                     YES                 @ZA13203 07892900
         XC    EWAITCCW(L4),EWAITCCW CLEAR OUR TCCW ADDRESS    @ZA13203 07893000
         L     ERREG4,EWAIOVST     GET ORIGINAL IOSVST                  07900002
STOREIT  ST    ERREG4,IOSVST       UPDATE IOSVST FIELD         @ZA13203 07950000
         LRA   ERREG4,ZERO(ERREG4)   GET REAL EQUIVALENT                08000002
         ST    ERREG4,IOSRST       UPDATE IOSRST FIELD                  08050000
CLEANUP  EQU   *                                                        08100002
*              ONE LINE REMOVED BY---------------------------->@ZA15404 08150000
         LR    PARMREG,IOSBREG     RESTORE IOSB AS PARAMETER            08200002
*                                                                       08250002
*                                  EXIT TO IOS WTO MUST BE MADE BEFORE  08300002
*                                  EXIT TO STAT UPDATE. WTO GOES TO     08350002
*                                  STAT UPDATE, BUT STAT UPDATE DOES    08400002
*                                  NOT GO TO WTO.                       08450002
*                                  ERROR LOAD 15 IS AN IOS MODULE.      08500002
*                                  EXIT TO IGE0004C MUST BE MADE AS     08550002
*                                  IF A NEW ENTRY CONDITION BUT         08600002
*                                  MUST BE SELF CONTAINED.              08650002
*                                                                       08700002
*                                  PREPARE FOR POSSIBLE OPERATOR MSG    08702002
         OI    EWAFLG1,EWADDMSG    TP SIZED MESSAGE                     08710002
         CLI   EWAIND1,EWAILD15   EXIT TO LOAD 15 TP RECORDER  @ZA14136 08713000
         BE    EXIT15              YES                         @ZA14136 08716000
         MVC   EWAITRAN(L2),IOBSENS0   MOVE SENSE FOR MESSAGE  @ZA12160 08720000
         MVC   EWTCTID(L2),IOBRESTR+L2  MOVE TERM ID FOR MSG   @ZA08475 08730003
*        ONE LINE OF CODE DELETED BY APAR ------------------>  @ZA14034 08732000
         CLI   EWAIND1,EWAIWTOL    EXIT TO IOS WTO             YM05652K 08950002
         BE    WTOEXIT             YES                         YM05652K 09000002
         CLI   EWAIND1,EWAISTAT    EXIT TO STAT UPDATE         YM05652K 09050002
         BNE   IOSEXIT             NO, GO TO SVC 15 AND SVC 3  YM05652K 09100002
*                                  EWASTUP ALREADY SET BY OTHER LOADS   09150002
         LA    NAMEREG,STATUP      LOAD ROUTINE NAME                    09200002
         B     XCTLOUT             XCTL                        @ZA07662 09250003
EXIT15   EQU   *                                                        09300002
         MVI   EWAIND1,ZERO         RESET FLAG                 YM05652K 09350002
         OI    EWAFLG2,EWAMDR       MDR RECORDING REQUESTED    YM05673K 09360002
         NI    IOSFLB,L255-IOSLOG   NO OBR WANTED              YM05673K 09370002
         MVC   EWAIBUFF(L4),IOBERCCW   MOVE POINTER TO EWA     YM05673K 09380002
         LH    NAMEREG,ERLOD15     GET MODULE NAME                      09400002
         B     XCTLOUT             GO TO IT                    @ZA07662 09450003
WTOEXIT  EQU   *                                                        09700002
         MVC   EWTCTPL(L2),IOBRESTR  MOVE IN TP OP CODE AND    @ZA14034 09710000
*                               MOVE IN DECFLAGS FOR MESG      @ZA14034 09720000
         L     NAMEREG,IOSUCB      SET UP UCB ADDRESSIBILITY   @ZA14061 09730000
         MVC   EWACHA(L2),L4(NAMEREG) MOVE UNIT ADDR FOR MESG. @ZA14061 09740000
         MVI   EWAIND1,ZERO        RESET FLAG                  YM05652K 09750002
         LA    NAMEREG,WTORTN      GET NAME OF IOS WTO                  09800002
XCTLOUT1 NI    IOSFLA,L255-IOSERR  TURN OFF IOSB ERP IN CNTRL  @ZA04874 09810003
         NI    IOBFLAG1,L255-IOBERRTN    ALSO IN IOB           @ZA04874 09820003
XCTLOUT  EQU   *                                                        09850002
         USING CVTMAP,ERRETR                                            09900002
         L     ERRETR,CVTPTR       POINT TO CVT                         09950002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                10000002
         BR    ERRETR              GO TO IT                             10050002
         DROP  ERRETR                                                   10100002
IOSEXIT  EQU   *                                                        10150002
         CLI   EWAIND1,EWAISVCF    SVC 15 FLAG SET             YM05652K 10160002
         BNE   IOSEXIT1            NO, FORCE PERM ERROR        YM05652K 10170002
*                                  THIS IS AN ERP ERROR        YM05652K 10172002
IOSEXIT2 EQU   *                                               YM05652K 10180002
         MVI   EWAIND1,ZERO        CLEAR FLAG                  YM05652K 10190002
         SVC   15                  ERROR EXCP                           10200002
         SVC   3                   RETURN TO IOS                        10250002
IOSEXIT1 EQU   *                                               YM05652K 10260002
         NI    IOSFLA,L255-IOSERR  TURN OFF IOSB ERP IN CNTRL  @ZA04874 10270003
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB            @ZA04874 10275003
         B     IOSEXIT2            ISSUE SVC                   YM05652K 10280002
RETRY    EQU   *                                                        10300002
         TM    EWAIND0,EWAIPMAP    PARALLEL MAPPING DONE                10400002
         BNO   CHANGE              NO,NOTHING TO UNFIX      L5 @ZA04156 10450003
         L     PARMREG,EWAITCCW    ADDR OF TCCW             L5 @ZA04156 10460003
         BAL   ERREG7,CHANGE1      DO UNFIX                 L5 @ZA04156 10470003
CHANGE   EQU   *                                                        10500002
         BAL   ERREG1,ERPEXT  GET ADR OF CURR EXT ENTRY     L5 @ZA04156 10510003
         CLC   ZERO(L4,ERRETR),FULL0         ENTRY EXIST?   L5 @ZA04156 10515003
         BE    CHANGE3             NO,NOTHING TO UNFIX      L5 @ZA04156 10520003
         L     PARMREG,ZERO(ERRETR)          ADR OF TCCW    L5 @ZA04156 10525003
         BAL   ERREG7,CHANGE1      DO UNFIX                 L5 @ZA04156 10530003
CHANGE3  EQU   *                                            L5 @ZA04156 10535003
         OI    EWAIND0,EWAIGPRO    GETMAIN IN PROCESS                   10550002
         L     ERREG3,GET480       LD PARMS                 L5 @ZA04156 10600003
         GETMAIN    R,LV=(0)                                L5 @ZA04156 10610003
         NI    EWAIND0,L255-EWAIGPRO   RESET FLAG                       10650002
         ST    PARMREG,EWAITCCW    STORE NEW TCCW                       10700002
         USING TCCW,PARMREG                                             10750002
         XC    ZERO(L160,PARMREG),ZERO(PARMREG)   ZERO TCCW             10800002
         LA    ERREG7,L160(PARMREG)   POINT TO BEB                      10850002
         XC    ZERO(L160,ERREG7),ZERO(ERREG7)   CLEAR BEB               10900002
         ST    ERREG7,TCCWBEB      STORE BEB ADDR IN TCCW               10950002
         LA    ERREG7,L160(ERREG7)   POINT TO FIXLIST                   11000002
         XC    ZERO(L160,ERREG7),ZERO(ERREG7)   CLEAR FIXLIST           11050002
         ST    ERREG7,TCCWFIX      STORE FIXLIST ADDR IN TCCW           11100002
         MVC   TCCWUCB(L3),IOSUCB+L1   UCB ADDR TO TCCW                 11150002
         MVC   TCCWTCB(L4),RQETCB   TCB ADDR TO TCCW                    11200002
         OI    EWAIND0,EWAIPMAP    MAPPING DONE                         11250002
         L     ERREG7,IOBSTART     TRANSLATE FROM IOBSTART , THIS WILL  11300002
*                                  BE IOBERCCW IF BUILT                 11350002
         LA    ERREG7,ZERO(ERREG7)   CLEAR OUT FLAGS                    11400002
         ST    ERREG7,TCCWFVC      FIRST VIRT CCW ADDR TO TCCW          11450002
         LR    ERREG3,ERREG7       SET AS PARAMETER                     11500002
         SR    ERREG6,ERREG6       CLEAR REGISTER              @ZA04853 11530003
*            2 LINES DELETED BY THE FOLLOWING APAR             @ZA03207 11560003
RETCCW   EQU   *                                                        11650002
GETLOCK2 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        X11700002
               RELATED=(ERP,IGE0904B(FREELOC2))                         11750002
         CH    ERREG6,HALF12       MORE CORE NEED ?            @ZA04853 11753003
         BE    RETXLAT        YES BRANCH TO TRANSLATOR         @ZA04853 11756003
         MVI   TCCWOPTN,TCCWXLAT TRANSLATE AND FIX             @ZA03207 11760003
RETXLAT  L     ERREG5,EWAITRAN     POINT TO TRANSLATOR         @ZA04853 11800003
         BALR  ERRETR,ERREG5       GO TO HIM                            11850002
         LR    ERREG6,ERREG5       SAVE RETURN CODE            @ZA04853 11851003
         BAL   ERREG1,ERPEXT     GET ADDR OF CURRENT ERP       @ZA03207 11852003
*                                EXT ENTRY                     @ZA03207 11854003
         MVC   ZERO(L4,ERRETR),EWAITCCW  PUT TCCW ADDR INTO    @ZA03207 11856003
*                           ERP EXT ENTRY FOR THIS IOB         @ZA03207 11858003
FREELOC2 SETLOCK RELEASE,TYPE=LOCAL,RELATED=(ERP,IGE0904B(GETLOCK2))    11900002
         CH    ERREG6,HALF12       RETURN FOR MORE CORE        @ZA03207 11950003
         BE    CHANGE0             YES, DO GETMAIN                      12000002
         L     NAMEREG,TCCWFRC     GET FIRST REAL CCW ADDR     YM05697K 12010000
         LRA   NAMEREG,ZERO(NAMEREG)    REAL ADDR OF REAL CCW  YM05697K 12020000
         ST    NAMEREG,IOSRST      STORE 1ST REAL CCW ADDRESS  YM05697K 12050000
         B     CLEANUP             EXIT                                 12100002
         DROP  PARMREG                                                  12150002
CHANGE0  EQU   *                                                        12200002
         OI    EWAIND0,EWAIGPRO    GETMAIN IN PROCESS                   12250002
         L     ERREG3,GET160       LD PARMS                 L5 @ZA04156 12300003
         GETMAIN  R,LV=(0)                                  L5 @ZA04156 12310003
         NI    EWAIND0,L255-EWAIGPRO   RESET FLAG                       12350002
         XC    ZERO(L160,PARMREG),ZERO(PARMREG)   CLEAR CORE            12400002
         LR    ERREG3,PARMREG      PUT IN PARAMETER REG                 12450002
         L     PARMREG,EWAITCCW    POINT TO TCCW                        12500002
         B     RETCCW              GO TO TRANSLATOR AGAIN               12550002
CHANGE1  EQU   *                                                        12600002
GETLOCK3 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        X12650002
               RELATED=(ERP,IGE0904B(FREELOC3))                         12700002
         SR    ERREG3,ERREG3       CLEAR OUT PARM REG                   12750002
         USING TCCW,PARMREG                                             12850002
         MVI   TCCWOPTN,TCCWUNFX   CLEAR OPTIONS FIELD         @ZA03207 12900003
         DROP  PARMREG                                                  13000002
         L     ERREG5,EWAITRAN     GET ADDRESS OF TRANSLATOR            13050002
         BALR  ERRETR,ERREG5       GO TO HIM                            13100002
         BAL   ERREG1,ERPEXT     GET ADDR OF CURRENT ERP       @ZA03207 13110003
*                                EXTENSION ENTRY               @ZA03207 13120003
         XC    ZERO(L4,ERRETR),ZERO(ERRETR) CLEAR OUT THE      @ZA03207 13130003
*                           ERP EXT ENTRY (TCCW ADDR)          @ZA03207 13140003
FREELOC3 SETLOCK RELEASE,TYPE=LOCAL,RELATED=(ERP,IGE0904B(GETLOCK3))    13150002
CHANGE2  EQU   *                                                        13200002
         LTR   PARMREG,PARMREG     END OF CHAIN                         13250002
         BCR   8,ERREG7            YES,RETURN               L5 @ZA04156 13300003
         L     ERREG2,ZERO(PARMREG)   SAVE LINK POINTER                 13350002
         BAL   ERRETR,FREERTN      FREEMAIN ONE BLOCK                   13400002
         LR    PARMREG,ERREG2      RESET CHAIN BASE                     13450002
         B     CHANGE2             TEST FOR END                         13500002
FREERTN  EQU   *                                                        13550002
         LR    ERREG6,ERRETR       SAVE RETURN ADDRESS                  13600002
         OI    EWAIND0,EWAIFPRO    FREEMAIN IN PROGRESS                 13650002
         L     ERREG3,GET160       LD PARMS                 L5 @ZA04156 13700003
         FREEMAIN  R,LV=(0),A=(1)                           L5 @ZA04156 13710003
         NI    EWAIND0,L255-EWAIFPRO   RESET FLAG                       13750002
         BR    ERREG6              RETURN TO CALLER                     13800002
*                                                                       13810003
*       THIS SUBROUTINE WILL LOCATE THE ADDRESS OF THE CURRENT          13820003
*       ERP EXTENSION ENTRY AND PASS IT BACK TO THE CALLER IN           13830003
*       REG ERRETR.                                                     13840003
*                                                                       13842003
ERPEXT   L     NAMEREG,IOBDCBPT  GET DCB ADDR                  @ZA03207 13844003
         USING IHADCB,NAMEREG    DCB DSECT ADDRESSABILITY      @ZA03207 13846003
         L     ERRETR,DCBIOBAD   GET 1ST IOB ADDR MINUS LENGTH @ZA03207 13848003
         SR    ERREG2,ERREG2     CLEAR REG FOR IOB SIZE        @ZA03207 13848403
         IC    ERREG2,DCBEIOBX   GET IOB SIZE                  @ZA03207 13848803
         SR    ERREG5,ERREG5     IOB RLN INDICATOR             @ZA03207 13849203
NOTFOUND LA    ERRETR,ZERO(ERREG2,ERRETR)  IOB ADDR            @ZA03207 13849603
         LA    ERREG5,L1(ERREG5)  INCREMENT RLN INDICATOR      @ZA03207 13849703
         CR    ERRETR,IOBRG      IS THIS THE IOB FOR ERP       @ZA03207 13849803
         BNE   NOTFOUND          NO, ADDR NEXT IOB             @ZA03207 13849903
         SLL   ERREG5,L2         MULT INDEX BY 4 TO GET        @ZA03207 13878603
*                                DISPLACEMENT INTO ERP EXT     @ZA03207 13880603
         L     ERRETR,DCBIOBAD   1ST IOB ADDR MINUS LENGTH     @ZA03207 13882603
         L     NAMEREG,DCBDEBAD  ADDR OF DEB                   @ZA03207 13883003
         DROP  NAMEREG           DROP DCB ADDRESSABILITY       @ZA03207 13883103
         USING DEBBASIC,NAMEREG  DEB DSECT ADDRESSABILITY      @ZA03207 13883203
         IC    NAMEREG,DEBNMEXT  NUMBER OF IOB'S               @ZA03207 13888803
         DROP  NAMEREG           DROP DEB ADDRESSABILITY       @ZA03207 13890803
         N     NAMEREG,FULL255   CLEAR BYTES 0,1, AND 2        @ZA03207 13892803
NEXT     LA    ERRETR,ZERO(ERREG2,ERRETR) IOB ADDR             @ZA03207 13893203
         BCT   NAMEREG,NEXT      FALL THRU WHEN ERRETR POINTS  @ZA03207 13893603
*                                TO THE LAST IOB               @ZA03207 13894003
         LA    ERRETR,ZERO(ERREG2,ERRETR) ADDR ERP EXT         @ZA03207 13894103
         MVC   0(4,ERRETR),EWAITRAN       ADDR OF TRANSLATOR   @ZA03207 13895503
*                                  IN 0TH ENTRY OF ERP EXT     @ZA03207 13897503
         AR    ERRETR,ERREG5     ADDR CURRENT ENTRY IN THE     @ZA03207 13898603
*                                ERP EXTENSION                 @ZA03207 13900003
         BR    ERREG1            RETURN TO CALLER              @ZA03207 13908203
*                                                                       13918203
*                                                                       13920203
*                                                                       13920603
EXITEXIT EQU   *                                                        13922203
         DROP  BASEREG                                                  13936103
         BALR  BASEREG,ZERO                                             13950002
         USING *,BASEREG                                                14000002
         LR    ERREG7,ERRETR       SAVE RETURN ADDRESS                  14050002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(ERP,IGE0904B(GETLOCK))     14100002
*                                  PROCEED WITH ABEND                   14150002
         SETRP                                                          14200002
         LR    ERRETR,ERREG7       RESET RETURN REG FOR RTM             14250002
         BR    ERREG7              RETURN TO TASK RECOVERY              14300002
         EJECT                                                          14350002
**********                                                              14400002
*                                                                       14450002
*        CONSTANTS                                                      14500002
*                                                                       14550002
**********                                                              14600002
EXITADDR ESTAE EXITEXIT,MF=L                                            14650002
ERLOD15  DC    H'6256'             TP RECORDER                          14700002
HALF12   DC    H'12'               CONSTANT FOR RETURN CODE CHECK       14750002
FULL255  DC    F'255'            FULL WORD OF 255              @ZA03207 14760003
GET160   DC    X'FD0000A0'                                  L5 @ZA17698 14770000
GET480   DC    X'FD0001E0'                                  L5 @ZA17698 14777000
FULL0    DC    F'0'                                         L5 @ZA04156 14784003
PACHAREA DC    40C'904B'           PATCH AREA FOR MAINTENANCE           14800003
         SPACE 2                                                        14850002
**********                                                              14900002
*                                                                       14950002
*        MISCELLANEOUS EQUATES                                          15000002
*                                                                       15050002
**********                                                              15100002
STATUP   EQU   254                 STATISTICS UPDATE ROUTINE NAME       15150002
WTORTN   EQU   253                 NAME OF IOS WTO ROUTINE              15200002
ERLOD00  EQU   43                  NAME OF 004C ERP                     15250002
SPMBFLAG EQU   X'9F'                                           @ZA08084 15270003
READTI   EQU   X'01'                                           @ZA08084 15290003
READTIR  EQU   X'81'                                           @ZA20113 15296000
NINETY   EQU   X'90'                                           @ZA08084 15310003
*                                                                       15350002
*                                                                       15400002
* SUBPOOL WAS 245 BUT NEED SOMETHING TCB RELATED, NOT RCT RELATED       15450002
*                                                                       15500002
*                                                                       15550002
L255     EQU   255                 AND MASK                             15600002
ZERO     EQU   0                   LENGTH AND DISPLACEMENT              15650002
L1       EQU   1                   LENGTH AND DISPLACEMENT              15700002
L2       EQU   2                   LENGTH AND DISPLACEMENT              15750002
L3       EQU   3                   LENGTH AND DISPLACEMENT              15800002
L4       EQU   4                   LENGTH AND DISPLACEMENT              15850002
L5       EQU   5                   LENGTH AND DISPLACEMENT              15900002
L6       EQU   6                   LENGTH AND DISPLACEMENT              15950002
L7       EQU   7                   LENGTH AND DISPLACEMENT              16000002
L8       EQU   8                   LENGTH AND DISPLACEMENT              16050002
L16      EQU   16                  LENGTH AND DISPLACEMENT              16100002
L19      EQU   19                                              @ZA08084 16110003
L22      EQU   22                                              @ZA08084 16120003
L160     EQU   160                 LENGTH AND DISPLACEMENT              16150002
         SPACE 2                                                        16250002
**********                                                              16300002
*                                                                       16350002
*        REGISTER DEFINITION                                            16400002
*                                                                       16450002
**********                                                              16500002
ERREG3   EQU   0                   WORK REG                             16550002
PARMREG  EQU   1                   PARAMETER REG                        16600002
ERREG2   EQU   2                   WORK REG                             16650002
EWAREG   EQU   3                   ERP WORKAREA BASE                    16700002
ERREG7   EQU   4                   CCW ADDRESS REG                      16750002
IOSBREG  EQU   5                   IOSB BASE                            16800002
RQEREG   EQU   6                   RQE BASE                             16850002
ERREG6   EQU   7                   WORK REG                             16900002
BASEREG  EQU   8                   PROGRAM BASE                         16950002
ERREG1   EQU   9                   WORK REG                             17000002
IOBRG    EQU   10                  IOB BASE                             17050002
ERREG4   EQU   11                  WORK REG                             17100002
ERRLNK   EQU   12                  LINK REG                             17150002
NAMEREG  EQU   13                  LINK REG                             17200002
ERRETR   EQU   14                  LINK REG/RETURN REG                  17250002
ERREG5   EQU   15                  LINK REG/WORK REG                    17300002
         EJECT                                                 @ZA03207 17310003
         DCBD DSORG=BX,DEVD=BS                                 @ZA03207 17320003
         EJECT                                                 @ZA03207 17330003
         IEZDEB LIST=YES                                       @ZA03207 17340003
         EJECT                                                          17350002
         IHAPSA                                                         17400002
         EJECT                                                          17450002
         IHASDWA                                                        17500002
         EJECT                                                          17550002
         IECDTCCW                                                       17600002
         EJECT                                                          17650002
         IECDRQE                                                        17700002
         EJECT                                                          17750002
         IEZIOB                                                         17800002
         EJECT                                                          17850002
CVT      DSECT                                                          17900002
         CVT                                                            17950002
         EJECT                                                          18000002
         IECDERWA  EWTC                                        @ZA08475 18050003
**********                                                              18100002
*                                                                       18150002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        18200002
*                                                                       18250002
**********                                                              18300002
         ORG   EWAIERP                                                  18350002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 18400002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 18450002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 18500002
EWAIND0  DS    B                   FLAG BYTE                            18550002
EWAIVISR EQU   X'10'               V=R REQUEST                          19150002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 19200002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 19250002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 19300002
EWAIND1  DS    B                   FLAG BYTE                            19350002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 19400002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 19450002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 19500002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 19510002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 19520002
EWAIND2  DS    B                   FLAG BYTE                            19550002
EWAIND3  DS    B                   FLAG BYTE                            19600002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     19650002
EWAIBUFF EQU   EWAIAREA+X'18'      MDR RECORD POINTER AT X'48' YM05673K 19660002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  19700002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 19750002
*********  END OF BTAM LOCAL DEFINITIONS **********                     19800002
         EJECT                                                          19850002
         IECDIOSB                                                       19900002
         END                                                            19950002
./  ADD  SSI=80090036,NAME=IGE0904C
         TITLE 'IGE0904C - BSC UNIT EXCEPTION ERP ROUTINE'              00250002
IGE0904C CSECT                                                          00300002
*********************************************************************** 00350002
*                                                                     * 00400002
* MODULE NAME:                                                        * 00450002
*    IGE0904C                                                         * 00500002
*                                                                     * 00550002
* DESCRIPTIVE NAME:                                                   * 00600002
*    BTAM BSC UNIT EXCEPTION ERP                                      * 00650002
*                                                                     * 00700002
* COPYRIGHT:                                                          * 00750002
*    NONE                                                             * 00800002
*                                                                     * 00850002
* STATUS:                                                             * 00900002
*    CHANGE LEVEL 000                                                 * 00950002
*                                                                     * 01000002
* FUNCTION:                                                           * 01050002
*    THIS ROUTINE ATTEMPTS RECOVERY FROM ALL ERRORS THAT DO NOT       * 01100002
*    NORMALLY SET AN ERROR INDICATION. IT ALSO CHECKS VALID ERRORS,   * 01150002
*    SUCH AS  RECOVERY FROM FAILURE TO END TRANSPARENCY, AND FROM     * 01200002
*    CONTENTION SITUATIONS.                                           * 01250002
*                                                                     * 01300002
* NOTES:                                                              * 01350002
*    DEPENDENCIES:                                                    * 01400002
*        NONE                                                         * 01450002
*    RESTRICTIONS:                                                    * 01500002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01550002
*    REGISTER CONVENTIONS:                                            * 01600002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01650002
*                                                                     * 01700002
* PATCHLABEL:                                                         * 01750002
*    PACHAREA (104 BYTES)                                             * 01800002
*                                                                     * 01850002
* MODULE TYPE:                                                        * 01900002
*    PROCEDURE                                                        * 01950002
*    PROCESSOR:                                                       * 02000002
*        BAL                                                          * 02050002
*    ATTRIBUTES:                                                      * 02200002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02250002
*                                                                     * 02300002
* ENTRY POINT:                                                        * 02350002
*    IGE0904C                                                         * 02400002
*    PURPOSE:                                                         * 02450002
*        SEE 'FUNCTION'                                               * 02500002
*    LINKAGE:                                                         * 02550002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02600002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02650002
*    INPUT:                                                           * 02700002
*        REG 1 = ADDRESS OF IOSB                                      * 02750002
*    OUTPUT:                                                          * 02800002
*        ALTERED CHANNEL PROGRAM                                      * 02850002
*        SETS ERROR INDICATORS IN DECERRST                            * 02900002
*                                                                     * 02950002
* EXITS-NORMAL:                                                       * 03000002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03100002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004C.       * 03150000
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03200002
*        LOAD.                                                        * 03250000
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03350002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03400002
*                                                                     * 03450002
* EXITS-ERROR:                                                        * 03500002
*    NONE                                                             * 03550002
*                                                                     * 03600002
* EXTERNAL REFERENCES:                                                * 03650002
*    ROUTINES:                                                        * 03700002
*        NONE                                                         * 03750002
*    DATA AREAS                                                       * 03850002
*        IOB (MAPPED BY IEZIOB)                                       * 03900002
*        VIRTUAL CHANNEL PROGRAM                                      * 03950002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 04000002
*    CONTROL BLOCKS                                                   * 04050002
*        UCB                                                          * 04100002
*        DCB                                                          * 04150002
*        DECB                                                         * 04200002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04250002
*        CVT          (MAPPED BY CVT)                                 * 04300002
*        IOB          (MAPPED BY IEZIOB)                              * 04350002
*        RQE          (MAPPED BY IECDRQE)                             * 04400002
*                                                                     * 04450002
* TABLES-WORKAREAS:                                                   * 04500002
*    ERP WORKAREA                                                     * 04550002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04600002
*                                                                     * 04650002
* MACROS:                                                             * 04700002
*    NONE                                                             * 04750002
*                                                                     * 04800002
* CHANGE ACTIVITY:                                                    * 04850002
*    YA01232  (IN BASE)                                               * 04860002
*    YM02595K (9/20/73)                                               * 04866003
*    YM02594K (9/24/73)                                               * 04872003
*    YA02454  (11/1/73)                                               * 04878003
*    YM05652K (1/25/74)                                               * 04884003
*    ZA00519  (7/15/74)                                               * 04890003
*    ZA02314  (11/18/74)                                              * 04900003
*    ZA02316  (11/18/74)                                              * 04902003
*    ZA02846  (03/03/75)                                              * 04904003
*    ZA02847  (03/03/75)                                              * 04906003
*    ZA02849  (03/03/75)                                              * 04908003
*    ZA03556  (03/05/75)                                              * 04910003
*    AZ03974  (04/24/75)          AZ03989  (04/24/75)                 * 04915003
*    AZ04185  (10/01/75)          AZ04866  (08/26/75)                 * 04920003
*    AZ06368  (09/09/75)          AZ06383  (10/01/75)                 * 04925003
*    AZ07662  (11/25/75)          AZ07674  (12/04/75)                 * 04930003
*    AZ11416  (06/08/76)          AZ11424  (06/08/76)                 * 04932003
*    AZ13172  (09/14/76)          AZ13180  (09/13/76)                 * 04935000
*    AZ13206  (09/13/76)          AZ13207  (09/23/76)                 * 04940000
*    AZ17702  (02/15/77)          AZ29189  (01/06/78)                 * 04945000
*    AZ29193  (01/06/78)                                              * 04955000
*                                                                     * 04965000
*********************************************************************** 05000002
         EJECT                                                          05050002
         USING *,BASEREG                                                05100002
         LR    BASEREG,ERREG5      SET BASE REG                         05150002
         USING RQE,ERREG5                                               05200002
         USING IECTDECB,DECBRG                                          05250002
         USING IHADCB,DCBREG                                            05300002
         USING IOSB,IOSBREG                                             05350002
         USING IOBSTDRD,IOBRG                                           05400002
         USING EWA,EWAREG                                               05450002
         B     BEGIN               BRANCH AROUND ID         LD @ZA00519 05460000
         DC    C'IGE0904C'         MODULE ID                LD @ZA00519 05470000
         DC    C' UZ16243'         PTF NUMBER                           05476000
         DC    C'&SYSDATE'         ASSEMBLY DATE            LD @ZA00519 05482000
BEGIN    DS    0H                                           LD @ZA00519 05490000
         L     ERREG5,IOSUSE       BASE RQE                             05500002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05550002
         L     IOBRG,RQEIOB        BASE IOB                             05600002
         L     DECBRG,IOBECBPT     BASE DECB                            05650002
         L     DCBREG,IOBDCBPT     BASE DCB                             05700002
         L     UCBREG,IOSUCB       BASE UCB                             05750002
         DROP  ERREG5                                                   05800002
         L     CCWREG,IOBFL3       GET CSW FORM IOB                     05850002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT FLAG BYTE                05900002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW IN IOB         05950002
         CLI   ZERO(CCWREG),CCWWRITE   ERROR ON A WRITE OPERATION       06000002
         BE    BSCUE02             YES CHECK FURTHER                    06050002
         CLI   ZERO(CCWREG),CCWAPOLL   ERROR ON A POLL                  06100002
         BE    BSCUE01             YES SET NEW POLL                     06150002
         CLI   ZERO(CCWREG),CCWREAD   FAILURE ON READ (CEA END ERROR)   06200002
         BNE   BSCUE00A            NO SET SNO AND PERM ERROR            06250002
         TM    DECFLAGS,RVIRCV     2 RVI'S RECEIVED IN ORDER            06300002
         BO    BSCUET0A            YES, POST IN ERROR                   06350002
         CLC   DECRESPN(L1),DCBBSENQ  TEST FOR ENQ CHAR.       @ZA06383 06360003
         BNE   BSCCT003            IF NOT, BRANCH           LD @ZA02316 06370003
         CLI   L5(CCWREG),L6       TP-OP CODE OF 06         LD @ZA02316 06380003
         BNE   BSCCT003            IF NOT, BRANCH           LD @ZA02316 06390003
         SH    CCWREG,SIXTEEN      BACK UP 2 CCW'S          LD @ZA02316 06392003
         B     BSCUETA7            UPDATE IOBSTART AND...   LD @ZA02316 06394003
*                                  ...CHECK RETRIES         LD @ZA02316 06396003
BSCCT003 EQU   *                                            LD @ZA02316 06398003
         CLI   IOBWORK,TPOPRENQ    READ ENQ                             06400002
         BNE   BSCUE000            NO CHECK FURTHER                     06450002
         CLC   DECRESPN(L1),DCBBSEOT   EOT RECEIVED                     06500002
         BE    BSCUET0A            YES POST WITH ERROR                  06550002
         SH    CCWREG,ERRCN8       BACK UP ONE CCW                      06600002
         B     BSCUETA7            RETRY PREPARE                        06650002
BSCCT004 NI    IOSFLA,L255-IOSERR-IOSEX   TURN OFF ERP CONTROL INDS.    06700002
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR   ALSO IN IOB            06710002
         MVI   IOBSENS0,ZERO                                            06750002
****           ONE LINE OF CODE DELETED BY APAR --------->     @ZA07662 06760003
         NI    EWASTUP,FIRSTBIT    TURN OFF AND TEST X'80'              06800002
         BZ    BSCUET10            POST OPERATION COMPLETE              06810002
         OI    IOSFLB,IOSLOG       SET STAT UPDATE NEEDED               06850002
         MVI   EWAIND1,EWAISTAT    EXIT TO STAT UPDATE         YM05652K 06860002
         B     STATRTN             EXIT TO STAT RTN            @ZA13180 06900000
BSCUE000 EQU   *                                                        06950002
         CLI   IOBWORK,TPOPRREN    READ RESP TO ENQ                     07000002
         BE    BSCUECON            YES CHECK FOR CONTENTION    @ZA13206 07050000
         CLI   IOBWORK,TPOPRTXT    READ TEXT                            07100000
         BE    BSCUE03             YES CHECK FURTHER                    07150002
         CLI   IOBWORK,TPOPRRID    RD ID SEQUENCE                       07200002
         BNE   BSCUE0BB                                                 07250002
         TM    DECFLAGS,INVALID    WAS INVALID ID                       07300002
         BZ    BSCUEVID            IF NOT, BRANCH                       07350002
         CLI   DECTYPE+L1,WRTCON   IS OPERATION WRITE TC                07400002
         BNE   BSCUERTC            NO, BRANCH                           07450002
BSCUECCW EQU   *                                                        07550002
         SH    CCWREG,ERRCN8       BACK UP ONE CCW                      07600002
         B     BSCUETA7            RETRY WRITE ID ENQ                   07650002
BSCUECON TM    DCBXCODE,DCBMASTR   MASTER STATION ?            @ZA13206 07658000
         BNO   BSCUECCW            YES - DO RETRY              @ZA13206 07666000
         TM    DECFLAGS,CONTETON   IS CONTENTION ON ?          @ZA13206 07674000
         BO    BSCUET09            YES, POST PERMANENT         @ZA13206 07682000
         B     BSCUECCW            NO, DO RETRY                @ZA13206 07690000
BSCUERTC EQU   *                                                        07700002
         CLI   DECTYPE+L1,RCONTONE   IS THIS READ TCW                   07750002
         BE    BSCUETA7                                                 07800002
         CLI   DECTYPE+L1,RDCON    IS OPERATION READ TC                 07850002
         BNE   BSCUE00A            NO, SET SHOULD NOT OCCUR             07900002
         B     BSCUETA7            RETRY READ ID ENQ                    07950002
BSCUEVID EQU   *                                                        08000002
         LH    ERREG2,L6(CCWREG)   PICK UP ORIGINAL COUNT               08050002
         SH    ERREG2,IOBCSW+L5    SUBTRACT RESIDUAL COUNT              08100002
         BCTR  ERREG2,ZERO                                              08150002
         A     ERREG2,ZERO(CCWREG)   POINT TO LAST CHARACTER            08200002
         CLC   ZERO(L1,ERREG2),DCBBSNAK   WAS NAK RECEIVED              08250002
         BNE   BSCUE00A            NO, SET SHOULD NOT OCCUR             08300002
         B     BSCUECCW                                                 08350002
BSCUE0BB EQU   *                                                        08400002
         CLI   IOBWORK,TPOPRRTX    READ RESP TO TEXT                    08450002
         BNE   BSCUE00A            NO, SET SHOULD NOT OCCUR             08500002
         L     ERREG2,ZERO(CCWREG)   GET PTR TO RESPONSE                08550002
         CLC   ZERO(L1,ERREG2),DCBBSNAK   WAS RESPONLE NAK              08600002
         BE    BSCUET11            YES, CHECK DYN BUFFERING             08650002
         TM    L17(UCBREG),MULTIPNT   MULTIPOINT ?             @ZA11416 08760000
         BO    BSCUETQ               YES, CHECK ENQ            @ZA11416 08770000
         CLC   ZERO(L1,ERREG2),DCBBSEOT  EOT RECEIVED          @ZA11416 08780003
         BE    BSCUE00A                  YES,SET PERM ERROR    @ZA11416 08790003
BSCUETQ  CLC   ZERO(L1,ERREG2),DCBBSENQ WAS RESPONSE ENQ?      @ZA13172 08800000
         BNE   BSCUE01B            NO, GENERATE WRITE ENQ      @ZA13172 08810000
         CLI   DECTYPE+L1,WTTVX WR CONT CONVERSATIONAL TRANSP? @ZA13172 08820000
         BE    BSCUET11            SET UP TO RETRY WR TEXT     @ZA13172 08830000
         CLI   DECTYPE+L1,WRITTQ   IS THIS A WR INQUIRY?       @ZA13172 08840000
         BNE   BSCUE01B            NO, GENERATE WRITE ENQ      @ZA13172 08850000
         OI    DECFLAGS,SLVCONT    INDICATE CONTENTION                  08900002
         MVC   IOBCSW(L7),IOBERCCW+L17   RESTORE FAILING DATA           08950002
         NI    IOSFLA,L255-IOSERR TURN OFF ERP IN CONTROL IN IOSB       09050003
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     09060002
***      ONE LINE OF CODE DELETED BY APAR----------------->    @ZA07662 09065003
         B     BSCUET10            EXIT VIA IOS                         09100002
BSCUET11 TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFERING                    09150002
         BO    BSCUET0A            YES, POST WITH ERROR                 09200002
         SH    CCWREG,ERRCN8       BACK UP ONE CCW                      09250003
         CLI   TPOPCODE(CCWREG),TPOPRTXT   READ TEXT                    09300002
         BE    BSCUETA7            RETRY WRITE  TEXT                    09350003
         CLI   TPOPCODE(CCWREG),TPOPWENQ  WRITE ENQ ? IF SO    @ZA04866 09360003
*                                     DON'T BACK UP ANY MORE   @ZA04866 09370003
         BE    BSCUETA7            RETRY WRITE TEST            @ZA04866 09380003
         SH    CCWREG,ERRCN8       TRANSPART,  BACK ONE MORE            09400002
         B     BSCUETA7            RETRY WRITE TEXT                     09450002
BSCUE01  LA    ERREG1,IOBCPA       START OF CHAN PROG                   09500002
         CR    ERREG1,CCWREG       FAILING CCW FIRST ONE                09550002
         BE    BSCUERC8       INDICATE INTERNAL ROUTINE 88     @ZA13180 09650000
BSCUE01A EQU   *                                                        09700002
         LA    CCWREG,IOBCPA       RESTART ADDRESS                      09750002
         L     ERREG1,IOBCPA+L8    ADDR OF POLLING ENTRY                09800002
         MVC   IOBCPA+L9(L3),DECENTRY+L1   FAILING ENTRY ADDR           09850002
         L     ERREG3,IOBCPA+L8    SAME ADDR                            09900002
         SR    ERREG1,ERREG3       DIFFERENCE                           09950002
         AH    ERREG1,IOBCPA+L14   TOTAL COUNT                          10000002
         STH   ERREG1,IOBCPA+L14   STORED IN CCW                        10050002
BSCUETA7 ST    CCWREG,IOBSTART                                          10150002
BSCUET08 CLI   IOBERRCT,ERRMAXCT   RETRIES EXHAUSTED                    10250002
         BNL   BSCUET09            YES SET PERM ERROR                   10300002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  10350002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE                          10400002
         STC   ERREG1,IOBERRCT     RESTORE NEW COUNT                    10450002
         NI    DECFLAGS,XBF        RESET BIT 1 IN DECB FLAGS            10460002
BSCUET10 EQU   *                                                        10500002
         MVI   EWAIND1,EWAISVCF    SET SVC 15 RETRY FLAG       @ZA07662 11300003
STATRTN  L     NAMEREG,TRANSRTN    LOAD NAME                   @ZA13180 12200000
         B     XCTLOUT             XCTL                                 12250002
BSCUE00A OI    DECERRST,DECSNO     SET SHOULD NOT OCCUR                 12500002
BSCUET09 NI    IOSFLA,L255-IOSERR  INDICATE PERM ERROR                  12550002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     12560002
         CLI   DECTYPE+L1,WRTCON   IS OPERATION WRITE TC                12600002
         BNE   BSCUENOW                                                 12650002
         TM    DECFLAGS,IMPRESP    WAS THE RESPONSE A NAK               12700002
         BZ    BSCUEID                                                  12750002
         MVI   IOBCPA+L5,CONNECT   INDICATE LINE CONNECTION             12800002
         B     BSCCT004            POST NORMALLY                        12850002
BSCUEID  EQU   *                                                        12900002
         TM    DECFLAGS,INVALID    WAS IT AN INVALID ID                 12950002
         BZ    BSCUET0A                                                 13000002
         MVC   IOBERCCW(L16),DLEOTCCW   WRITE DLE EOT , DISABLE         13050002
         LA    ERREG1,DCBBSDLE     GET ADDRESS OF DLE EOT               13100002
         ST    ERREG1,IOBERCCW     STORE ADDRESS IN CCW                 13150002
         MVI   IOBERCCW,CCWWRITE   MOVE IN WRITE COMMAND                13200002
         B     BSCUERST                                                 13300002
BSCUENOW EQU   *                                                        13350002
         CLI   DECTYPE+L1,RCONTONE   IS OPERATION READ TCW              13400002
         BE    BSCUETCW                                                 13450002
         CLI   DECTYPE+L1,RDCON    IS OPERATION READ TC                 13500002
         BNE   BSCUET0A                                                 13550002
BSCUETCW EQU   *                                                        13600002
         TM    DECFLAGS,INVALID    WAS IT AN INVALID ID                 13650002
         BZ    BSCUET0A                                                 13700002
         MVC   IOBERCCW(L8),DISABCCW   MOVE IN DISABLE CCW              13750002
BSCUERST EQU   *                                                        13800002
         LA    CCWREG,IOBERCCW                                          13850002
         ST    CCWREG,IOBSTART                                          13900002
         MVI   IOBERRCT,ZERO       SET ERROR COUNT TO ZERO              14600002
         OI    IOSFLA,IOSERR   TURN ON ERP IN CONTROL IN IOSB           14650003
         OI    IOBFLAG1,IOBERRTN   ALSO IN IOB                          14660002
****           ONE LINE OF CODE DELETED BY APAR ------------>  @ZA07662 14670003
         B     BSCUET10                                                 14700002
BSCUET0A LA    NAMEREG,BSCLOD2     ADDRESS OF ERROR POST                14750002
         MVC   EWACHA(L2),L4(UCBREG) MOVE UNIT ADDR TO WK AREA @ZA03989 14770003
XCTLOUT  EQU   *                                                        14800002
         L     ERRETR,CVTPTR       POINT TO CVT                         14850002
         USING CVTMAP,ERRETR                                            14900002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUTINE                14950002
         DROP  ERRETR                                                   15000002
         BR    ERRETR              XCTL OUT                             15050002
BSCUE01B MVI   IOBWORK+L1,RTRNCDE6   INDICATE INTERNAL ROUTINE          15100002
         LA    ERRLNK,DCBBSENQ     ADDRESS OF ENQ CHAR                  15150000
BSCUET02 LA    ERREG2,CCWWRITE     1ST COMMAND                          15200002
         LA    ERREG5,CCWTIC       2ND COMMAND                          15250000
BSCUET05 ST    ERRLNK,IOBERCCW     STORE DATA ADDR IN CHAN PROG         15300002
         STC   ERREG2,IOBERCCW     STORE COMMAND IN 1ST CCW             15350002
         ST    ERREG2,IOBERCCW+L4   PUT COUNT IN CCW                    15400000
         CLI   IOBWORK+L1,ZERO    HAS SPECIAL INTERNAL RETURN           15430000
*                                 CODE BEEN SET?                        15460000
         BE    BSCUETA6       NO, DON'T SET FLAG FOR 004C               15500000
         MVI   IOBERRCT+L1,RTRNSPCD  SET BRANCHING FLAG FOR             15530000
*                                    SPECIAL RETURN MODULE              15560000
BSCUETA6 EQU   *                                                        15600002
         ST    CCWREG,IOBERCCW+L8  STORE TIC ADDR                       15650002
         MVI   IOBERCCW+L4,CHAINCDE   COM CH, SLI                       15700002
         CLI   IOBWORK+L1,RTRNCDE8   SPEC RETURN OF 88                  15750002
         BNE   BSCUE040           NO,DONT SET COM CH        L5 @ZA03556 15800003
         MVI   IOBERCCW+L4,X70     COM CH, SLI, SKIP                    15850002
         B     BSCUE02F                BUILD 2ND RETRY CCW  L5 @ZA03556 15860003
BSCUE040 CLI   IOBWORK+L1,RTRNCDE0     SPEC RETURN OF 80    L5 @ZA03556 15870003
         BNE   BSCUE02F             NO,BUILD 2ND RETEY CCW  L5 @ZA03556 15880003
         CLI   IOBWORK,TPOPWREN  TP OP CODE OF 08(WT ENQ)   L5 @ZA03556 15890003
         BNE   BSCUE02F              NO,BUILD 2ND RETRY CCW L5 @ZA03556 15892003
         MVI   IOBERCCW+L8,CCWREAD  MAKE 2ND CCW A READ     L5 @ZA03556 15894003
         MVI   IOBERCCW+L12,SLISKIP  SUPRESS INCORRECT      L5 @ZA03556 15896003
*            LENGTH AND TRANSFER TO STORAGE ON 2ND CCW      L5 @ZA03556 15898003
         MVI   IOBERCCW+L4,CDSLI       DATA CHAING AND      L5 @ZA03556 15898103
*                                      SUPP LEN IN FST CCW  L5 @ZA03556 15898203
         MVI   IOBERCCW+L15,L255  MAKE 2ND CCW LENGTH          @ZA03556 15898403
*                                  FIELD EQU FF                @ZA03556 15898803
         B     BSCUE02G                GET RESTART ADDR     L5 @ZA03556 15899203
BSCUE02F STC   ERREG5,IOBERCCW+L8   STORE COMMAND IN 2ND CCW            15900002
         ST    ERREG2,IOBERCCW+L12   PUT COUNT IN CCW                   15950002
BSCUE02G EQU   *                                            L5 @ZA03556 15960003
         LA    CCWREG,IOBERCCW     ADDR OF NEW CHAN PROG                16000002
         B     BSCUETA7            RETRY ERROR                          16100002
BSCUE02  CLI   IOBWORK,TPOPWENQ    THIS WRITE ENQ                       16150002
         BE    BSCUE02C            YES GENERATE RD ENQ                  16200002
         CLI   IOBWORK,TPOPWREN    WRITE RESP TO ENQ                    16250002
         BE    BSCUET2D            YES SET UP READ ENQ         @ZA13180 16300000
         CLI   IOBWORK,TPOPWRTT    WRITE WACK OR            LD @ZA00519*16310000
                                   WRITE RESP TO TEXT       LD @ZA00519 16320000
         BL    BSCUET2D            IOBWORK = WRITE WACK     LD @ZA00519 16330000
         BE    BSCUERC8            IOBWORK = WRITE          LD @ZA00519*16340000
                                   RESP TO TEXT             LD @ZA00519 16342000
         CLI   IOBWORK,TPOPDTXT    ERROR DURING TEXT                    16350002
         BNE   BSCUE002            NO CHECK FURTHER                     16400002
BSCUERC8 EQU   *                                                        16450002
         MVI   IOBWORK+L1,RTRNCDE8   INDICATE INTERNAL ROUTINE          16500002
         B     BSCUET2A            CONTINUE GENERATION                  16550002
*        SIXTEEN LINES OG CODE DELETED BY APAR ------------->  @ZA13180 16560000
BSCUET2D EQU   *                                                        16633303
         MVI   IOBWORK+L1,RTRNCDE0   INDICATE INTERNAL ROUTINE          16650002
BSCUET2A LA    ERREG5,CCWNOP       SET 2ND COMMAND FOR NO-OP            16700002
         LA    ERRLNK,IOBWORK+L2   DATA ADDRESS                         16750000
         LA    ERREG2,CCWREAD      SET IS COMMAND FOR READ              16800002
         B     BSCUET05            COMPLETE CHAN PROG                   16850002
BSCUETRY OI    DECFLAGS,IMPRESP    IMPROPER RESPONSE                    16900002
         SH    CCWREG,ERRCN8       BACK UP ONE CCW                      16950002
         B     BSCUETA7            RETRY                                17000002
BSCUE02C CLC   DECRESPN(L1),DCBBSNAK   NAK RECEIVED                     17050002
         BE    BSCUETRY            YES, BRANCH TO IMPROPER              17100002
         CLC   DECRESPN(L2),DCBBSRVI   RVI RECEIVED                     17150002
         BE    BSCUETRY            YES, BRANCH TO IMPROPER              17200002
         SH    CCWREG,ERRCN8       BACK UP ONE CCW                      17250002
         CLI   L5(CCWREG),TPOPRDID   IS PREV CCW READ ID                17300002
         LA    CCWREG,L8(CCWREG)   RESET CCW REG                        17350002
         BE    BSCUET2D            BRANCH IF READ ID PREV               17400002
         MVI   IOBWORK+L1,RTRNCDE4   SET SPECIAL RETURN CODE            17450002
         B     BSCUET2A            GENERATE CHAN PROG                   17500002
BSCUE03  EQU   *                                                        17505000
         TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFERING ?         @Z29189  17510000
         BNO   BSCUE031            NO, BRANCH                  @Z29189  17515000
         OI    DECERRST,DECSNO     SET SHOULD NOT OCCUR        @Z29189  17520000
         NI    IOSFLA,L255-IOSERR  INDICATE PERM ERROR         @Z29189  17525000
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB            @Z29189  17530000
         B     BSCUET0A            POST PERM ERROR             @Z29189  17535000
BSCUE031 EQU   *                                               @Z29189  17540000
         LH    ERREG2,L6(CCWREG)   PICK UP ORIG CT             @Z29189  17550000
         BCTR  ERREG2,ZERO         SUBTRACT ONE                         17600002
         CH    ERREG2,IOBCSW+L5    THIS COUNT=RESIDUAL COUNT            17650002
         BE    BSCUE03B            YES CHECK FOR ENQ                    17700002
         L     ERREG1,IOBERINF                                          17750002
         CLC   ZERO(L2,ERREG1),DCBBSONL   SOH % MESSAGE RECEIVED?       17800002
         BE    BSCUET0A            YES, GO TO ERROR POST                17850002
         SH    ERREG2,IOBCSW+L5    FIND DIFFERENCE                      17900002
         A     ERREG2,ZERO(CCWREG)   LAST CHAR ADDRESS         @ZA04185 17950003
         CLC   ZERO(L1,ERREG2),DCBBSENQ   THIS ENQ CHARACTER            18000002
         BE    BSCUE03I             INDICATE ENQ               @ZA04185 18001003
         CLC   ZERO(L1,ERREG2),DCBBSEOT IS LAST CHAR AN EOT    @ZA04185 18002003
         BNE   BSCUE00A            NO SET SNO                  @ZA04185 18003003
*              THE FOLLOWING TEST WILL DETERMINE IF GARBLED    @ZA04185 18004003
*              SYN CHARACTORS PRECEEDED THE EOT                @ZA04185 18005003
         TM    L17(UCBREG),X40      MULTI-POINT BSC3 LINE      @ZA04185 18006003
         BNO   BSCUE00A            SET SNO                     @ZA04185 18007003
         LA    ERRLNK,DECAREA      INPUT AREA ADDR             @ZA04185 18008003
         CLI   IOBCPA,CCWAPOLL     MULTI-POINT RD INIT         @ZA04185 18009003
         BNE   BSCUE03A              NO                        @ZA04185 18010003
         LA    ERRLNK,L1(ERRLNK)   SKIP OVER INDEX BYTE        @ZA04185 18011003
BSCUE03A CLC   ZERO(L1,ERRLNK),DCBBSSTX  FIRST BYTE STX        @ZA04185 18012003
         BE    BSCUE00A             YES, POST SNO              @ZA04185 18013003
         CLC   ZERO(L1,ERRLNK),DCBBSONL  FIRST BYTE SOH        @ZA04185 18014003
         BE    BSCUE00A             YES, POST SNO              @ZA04185 18015003
         CLC   ZERO(L1,ERRLNK),DCBBSRSV  FIRST BYTE DLE...     @ZA04185 18016003
*                             INDICATING TRANSPARENT MODE      @ZA04185 18017003
         BE    BSCUE00A             YES, POST SNO              @ZA04185 18018003
         CLI   IOBCPA,CCWAPOLL     MULTI-POINT RD TI           @ZA04185 18019003
         BE    BSCUE03D                                        @ZA04185 18020003
         MVI   IOBWORK+L1,RTRNCDED  INDICATE INTERNAL ROUTINE  @ZA04185 18021003
         B     BSCUE03G        WRITE NAK, TIC TO RD TXT        @ZA04185 18022003
BSCUE03D MVI   IOBWORK+L1,RTRNCDE2                             @ZA04185 18023003
         L     ERRLNK,ZERO(CCWREG)   FIND RD TXT               @ZA04185 18024003
         BCTR  ERRLNK,ZERO         DECREMENT BY ONE            @ZA04185 18025003
         STCM  ERRLNK,L7,L1(CCWREG) UPDATE INPUT AREA ADDR     @ZA04185 18026003
         LH    ERRLNK,L6(CCWREG)    ORGINAL LENGTH             @ZA04185 18027003
         LA    ERRLNK,L1(ERRLNK) ADJUST INPUT AREA ADDR BY ONE @ZA04185 18028003
         STH   ERRLNK,L6(CCWREG)    UPDATE LENGTH              @ZA04185 18029003
         B     BSCUE03G                                        @ZA04185 18030003
BSCUE03I EQU   *                                               @ZA04185 18031003
         OI    DECFLAGS,STXENQ     MSG ENDING IN ENQ RCVD   LD @ZA02314 18060003
         BCTR  ERREG2,ZERO         BACK UP ONE CHARACTER                18100002
         CLC   ZERO(L1,ERREG2),DCBBSSTX   IS THIS CHARACTER STX         18150002
         BNE   BSCUE03C            NO, NOT ABORT SEQUENCE               18200002
*        ONE LINE OF CODE DELETED BY APAR ------------->       @ZA13180 18300000
         MVI   IOBWORK+L1,RTRNCDE9   SET SPECIAL RETURN CODE            18350002
BSCUE03C EQU   *                                                        18400002
         TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFERING                    18450002
         BO    BSCUET0A            YES POST WITH ERROR                  18500002
         CLI   IOBCPA,CCWAPOLL         MULTIPOINT RD INIT?  L5 @ZA02846 18510003
         BNE   BSCUE03G                NO,WRITE NAK         L5 @ZA02846 18520003
         L     ERREG2,0(CCWREG)        RD TXT DATA ADDR     L5 @ZA02846 18530003
         SH    CCWREG,ERRCN8           BACK UP 1 CCW        L5 @ZA02846 18540003
         C     ERREG2,0(CCWREG)        ADDR  MODIFIED?      L5 @ZA02846 18542003
         BNE   BSCUE03H                NO                   L5 @ZA02846 18546003
         LA    CCWREG,8(CCWREG)        RESTART NEXT CCW     L5 @ZA02846 18548003
         B     BSCUE03G                                     L5 @ZA02846 18548403
BSCUE03H BCTR  ERREG2,0                BACK UP 1 CHAR       L5 @ZA02846 18548803
         B     BSCUE03J                SET UP NEW RD ADDR   L5 @ZA02846 18549203
BSCUE03G EQU   *                                            L5 @ZA02846 18549603
         LA    ERRLNK,DCBBSNAK     SET ADDR TO NAK                      18550002
         B     BSCUET02            GO COMPLETE CHAN PROG                18600002
BSCUE03B L     ERREG2,ZERO(CCWREG)   ENQ POINTER                        18650002
         CLC   ZERO(L1,ERREG2),DCBBSENQ   ENQ RECEIVED                  18700002
         BE    BSCUE03E            YES,CONTINUE                         18750002
         CLC   ZERO(L1,ERREG2),DCBBSEOT   EOT RECEIVED?                 18800002
         BNE   BSCUE00A            NO ,POST WITH ERROR         @ZA13207 18850000
*        TWO LINES OF CODE DELETED BY APAR ---------------->   @ZA13207 18860000
         L     ERREG2,DECAREA      GET BUFFER ADDRESS          @Z29193  18868000
         CLC   0(1,ERREG2),DCBBSDLE IS FIRST CHAR DLE          @Z29193  18876000
         BE    BSCUE00A            YES, POST WITH ERROR        @Z29193  18884000
         L     ERREG2,ZERO(CCWREG) LOAD DATA ADDRESS           @Z29193  18892000
         MVC   IOBERCCW+L17(L7),IOBCSW  SAVE NEW CSW                    18900002
         TM    DECFLAGS,STXENQ     ABORT SITUATION?                     18950002
         BNO   BSCUE03F                                                 19000002
         MVI   IOBECBCC,ERRCODE    SET 41 COMPLETION                    19050002
BSCUE03F EQU   *                                                        19100002
         CLI   IOBCPA,CCWAPOLL     MULTIPOINT READ INITIAL?             19150002
         BNE   BSCCT004            POST NORMAL                  YA02454 19200002
         SH    CCWREG,ERRCN8       BACK UP TO READ INDEX CCW            19250002
         C     ERREG2,ZERO(CCWREG)   HAS ADDRESS BEEN MODIFIED?         19300002
         BNE   BSCUE00A            NO, SET SHOULD NOT OCCUR             19350002
         LH    ERREG2,IOBERCCW+L22   GET RESIDUAL COUNT                 19400002
         BCTR  ERREG2,ZERO         SUBTRACT FOR INDEX BYTE              19450002
         STH   ERREG2,IOBERCCW+L22   STORE CORRECTED COUNT              19500002
         B     BSCUET0A                                                 19600002
BSCUE03E EQU   *                                                        19650002
         TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFERING                    19700002
         BO    BSCUET0A            YES POST WITH ERROR                  19750002
         SH    CCWREG,ERRCN8       BACK UP TO NEXT CCW                  19800002
         CLI   L5(CCWREG),TPOPWRTX   THIS WRT RESP TO TEXT              19850002
         BNE   BSCUE03N             NO, CHECK CONV. WRITE      @ZA17702 19900000
         MVI   IOBWORK+L1,RTRNCDE1     SET RETURN CODE 81      @ZA17702 19910000
         MVI   IOBERRCT+L1,RTRNSPCD    SET SPECIAL RETURN CODE @ZA17702 19920000
         MVI   IOBWORK+L3,CON9A        SET INDICATOR           @ZA17702 19930000
         BE    BSCUETA7                                        @ZA17702 19940000
BSCUE03N CLI   L5(CCWREG),TPOPRRTX   THIS A CONV WRITE         @ZA17702 19950000
         BE    BSCUE03C            GEN WRT NAK CHAN PROGRAM             20000002
         CLI   IOBCPA,CCWAPOLL     POLLING SEQUENCE                     20050002
         BNE   BSCUE00A            NO, SET SNO                          20100002
         L     ERRLNK,DECAREA      GET I/O AREA ADDR           @ZA03974 20103003
         LA    ERRLNK,L1(ERRLNK)   PT TO INPUT AREA + ONE      @ZA03974 20106003
         LA    ERREG2,ZERO(ERREG2) CLEAR HI BYTE-THIS REG      @ZA03974 20109003
*                   CONTAINS CURRENT INPUT AREA ADDR FROM CCW  @ZA03974 20112003
         CR    ERRLNK,ERREG2       HAS READ TXT CCW BEEN       @ZA03974 20115003
*                              ALTERED (READ TI POLLING)       @ZA03974 20118003
         BNE   BSCUE03K            NO, CONTINUE NORMALLY       @ZA03974 20121003
         MVI   IOBWORK+L1,RTRNCDE2  SET INTERNAL CODE          @ZA03974 20124003
         MVI   IOBERCCW+L16,TIMEOUT  SET T.O. SENSE            @ZA03974 20127003
         NI    IOBERCCW+L20,XFE     TURN OFF UNIT EXCEPTION    @ZA03974 20130003
         OI    IOBERCCW+L20,UNITCHK SET U.C. STATUS            @ZA03974 20133003
         LA    CCWREG,L8(CCWREG)     POINT TO FAILING CCW      @ZA03974 20136003
         B     BSCUE03G              GO BUILD RETRY CHAN PGM   @ZA03974 20139003
BSCUE03K EQU   *                                                        20142003
         BCTR  ERREG2,ZERO         ADDRESS OF BEGINNING TEXT            20150002
         CLC   ZERO(L1,ERREG2),DCBBSSTX   STX PRECEDING ENQ ?           20200002
         BNE   BSCUE00A            NO, SET SNO                          20250002
         OI    DECFLAGS,STXENQ         INDICATE ENQ RECVD   L5 @ZA02846 20260003
         MVI   IOBWORK+1,RTRNCDE9      SET SPEC RETURN      L5 @ZA02846 20270003
BSCUE03J EQU   *                                            L5 @ZA02846 20280003
         STCM  ERREG2,L7,L9(CCWREG) SET UP NEW READ IN AREA    @ZA07674 20300003
         STCM  ERREG2,L7,L1(CCWREG) MODIFY AREA ADDRESS        @ZA07674 20350003
         LA    CCWREG,L8(CCWREG)   BACK TO PROPER CCW                   20400002
         LH    ERREG2,L6(CCWREG)   INCRIMENT                            20450002
         LA    ERREG2,L1(ERREG2)   COUNT                                20500002
         STH   ERREG2,L6(CCWREG)   FOR READ                             20550002
         B     BSCUE03G         SET SP RTN - GEN CHAN PROG  L5 @ZA02846 20650003
BSCUE002 CLI   IOBWORK,TPOPRSET    THIS A RESET OPERATION               20700002
         BNE   BSCUE00A            NO SET SNO ERROR                     20750002
         CLI   L13(CCWREG),X8B     WRITE RESET CHAN PROGRAM             20800002
         BNE   BSCUE0X2            NO, CONTINUE                         20900002
         LA    CCWREG,L8(CCWREG)   YES, RESTART AT NEXT CCW             20950002
         B     BSCUETA7                                                 21000002
BSCUE0X2 MVI   IOBWORK+L1,RTRNCDE7   INDICATE INTERNAL ROUTINE          21050002
         B     BSCUET2A            GENERATE CHAN PROGRAM                21100002
         EJECT                                                          21150002
**********                                                              21200002
*                                                                       21250002
*        CONSTANTS                                                      21300002
*                                                                       21350002
**********                                                              21400002
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       21450002
FOURTY   DC    AL4(40)                                      L5 @ZA02847 21460003
DLEOTCCW DC    X'0100000060210002'                                      21500002
DISABCCW DC    X'2F00000020010001'    DISABLE CCW                       21550002
ERRCN8   DC    H'8'                                                     21600002
SIXTEEN  DC    H'16'                                        LD @ZA02316 21610003
PACHAREA DC    26C'0000'           PATCH AREA FOR MAINTENANCE           21650000
**********                                                              21700002
*                                                                       21750002
*        MISCELLANEOUS EQUATES                                          21800002
*                                                                       21850002
**********                                                              21900002
TPOPRRTX EQU   X'25'                                                    22000002
DECSNO   EQU   X'40'                                                    22050002
XFE      EQU   X'FE'                                           @ZA03974 22070003
L255     EQU   X'FF'               AND MASK                             22100002
BSCLOD2  EQU   2043                BSC ERROR POST IDENT                 22200002
ERRCN2   EQU   8                                                        22250002
FIRSTBIT EQU   X'7F'               AND MASK FOR X'80'                   22300002
NORMCOND EQU   X'0D'               CE,DE,UE FLAGS ON                    22350002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              22400002
L1       EQU   1                   LENGTH AND DISPLACEMENT              22450002
L2       EQU   2                   LENGTH AND DISPLACEMENT              22500002
L3       EQU   3                   LENGTH AND DISPLACEMENT              22550002
L4       EQU   4                   LENGTH AND DISPLACEMENT              22600002
L5       EQU   5                   LENGTH AND DISPLACEMENT              22650002
L6       EQU   6                   LENGTH AND DISPLACEMENT              22700002
L7       EQU   7                   LENGTH AND DISPLACEMENT              22750002
L8       EQU   8                   LENGTH AND DISPLACEMENT              22800002
L9       EQU   9                   LENGTH AND DISPLACEMENT              22850002
L12      EQU   12                  LENGTH AND DISPLACEMENT              22900002
L13      EQU   13                  LENGTH AND DISPLACEMENT              22950002
L14      EQU   14                  LENGTH AND DISPLACEMENT              23000002
L15      EQU   15                  LENGTH AND DISPLACEMENT  L5 @ZA03556 23010003
L16      EQU   16                  LENGTH AND DISPLACEMENT              23050002
L17      EQU   17                  LENGTH AND DISPLACEMENT              23100002
L20      EQU   20                                              @ZA03974 23120003
L22      EQU   22                  LENGTH AND DISPLACEMENT              23150002
X40      EQU   X'40'                                           @ZA04185 23170003
X70      EQU   X'70'                                                    23200002
X8B      EQU   X'8B'                                                    23250002
XBF      EQU   X'BF'               DECB FLAGS AND MASK                  23300002
WLR      EQU   X'40'               SLI FLAG                             23350002
TIMEOUT  EQU   X'01'          TIME OUT SENSE BYTE              @ZA03974 23360003
UNITCHK  EQU   X'02'          UNIT CHECK STATUS                @ZA03974 23370003
TPOPWENQ EQU   X'03'                                                    23400002
TPOPDTXT EQU   X'11'                                                    23450002
CCWNOP   EQU   3                                                        23500002
TPOPWRTX EQU   X'08'                                                    23550002
TPOPCODE EQU   5                                                        23600002
WRITTQ   EQU   X'16'                                                    23650002
WTTVX    EQU   X'1F'                                           @ZA13172 23670000
SLVCONT  EQU   X'10'                                                    23700002
CCWWRITE EQU   1                                                        23750002
CCWAPOLL EQU   X'09'                                                    23800002
TPOPWRTT EQU   X'02'               TP-OP WRITE RESP TO TEXT LD @ZA00519 23810000
TPOPWREN EQU   X'08'                                                    23850002
CCWREAD  EQU   2                                                        23900002
TPOPRENQ EQU   X'0B'                                                    23950002
TPOPRREN EQU   X'0C'                                                    24000002
TPOPRTXT EQU   X'11'                                                    24050002
STXENQ   EQU   X'01'                                                    24100002
IMPRESP  EQU   X'40'                                                    24150002
CONNECT  EQU   X'DD'                                                    24200002
TPOPRRID EQU   X'07'                                                    24250002
WRTCON   EQU   X'1C'                                                    24300002
RDCON    EQU   X'11'                                                    24350002
RCONTONE EQU   X'1E'                                                    24400002
INVALID  EQU   X'10'                                                    24450002
ERRCODE  EQU   X'41'                                                    24500002
ERRMAXCT EQU   X'07'                                                    24550002
RTRNCDE1 EQU   X'81'          RETURN CODES                     @ZA17702 24560000
RTRNCDE2 EQU   X'82'                                           @ZA03974 24570003
RTRNCDE4 EQU   X'84'                                                    24600002
RTRNCDE6 EQU   X'86'                                                    24650002
RTRNCDE0 EQU   X'80'                                                    24700002
RTRNCDE7 EQU   X'87'                                                    24750002
RTRNCDE8 EQU   X'88'                                                    24800002
RTRNCDE9 EQU   X'89'                                                    24850002
RTRNCDED EQU   X'8D'                                           @ZA04185 24870003
TPOPRSET EQU   X'21'                                                    24900002
TPOPRDID EQU   X'07'                                                    24950002
RTRNSPCD EQU   X'14'                                                    25000002
CHAINCDE EQU   X'60'                                                    25050002
CCWTIC   EQU   X'08'                                                    25100002
RVIRCV   EQU   X'42'               RVI RECEIVED ; DEFLAG SETTING        25150002
DYNBUF   EQU   X'08'                                                    25250002
X08      EQU   X'08'                                                    25260002
SIX      EQU   6       RD SKIP CCW LEN FIELD                L5 @ZA03556 25262003
CDSLI    EQU   X'A0'   DATA CHAINING AND SUPRESS            L5 @ZA03556 25264003
*                      INCORRECT LENGTH                                 25266003
SLISKIP  EQU   X'30'   SUPPRESS INCORRECT LENGTH AND        L5 @ZA03556 25268003
*                      TRANSFER TO STORAGE                              25268403
RLN0A    EQU   X'0A'                   RELATIVE LINE TEN    L5 @ZA02847 25270003
MULTIPNT EQU   X'40'                                           @ZA11416 25280003
CONTETON EQU   X'10'       CONTENTION CHECK                    @ZA13206 25286000
DCBMASTR EQU   X'80'        REMOTE STATION                     @ZA13206 25292000
CON9A    EQU   X'9A'        SPECIAL CODE                       @ZA17702 25296000
**********                                                              25300002
*                                                                       25350002
*        REGISTER DEFINITION                                            25400002
*                                                                       25450002
**********                                                              25500002
ERREG3   EQU   0                   WORK REG                             25550002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              25600002
ERREG2   EQU   2                   WORK REG                             25650002
EWAREG   EQU   3                   ERP WORKAREA BASE                    25700002
CCWREG   EQU   4                   CCW ADDRESS REG                      25750002
DECBRG   EQU   5                   DECB BASE                            25800002
DCBREG   EQU   6                   DCB BASE                             25850002
UCBREG   EQU   7                   UCB BASE                             25900002
BASEREG  EQU   8                   PROGRAM BASE                         25950002
ERREG1   EQU   9                   WORK REG                             26000002
IOBRG    EQU   10                  IOB BASE                             26050002
ERREG4   EQU   11                  WORK REG                             26100002
ERRLNK   EQU   12                  LINK REG                             26150002
NAMEREG  EQU   13                  LINK REG                             26200002
ERRETR   EQU   14                  LINK REG                             26250002
ERREG5   EQU   15                  LINK REG/WORK REG                    26300002
         EJECT                                                          26350002
         IECTDECB                                                       26400002
         EJECT                                                          26450002
         DCBD  DSORG=BX,DEVD=BS              DCB DESECT MACRO           26500002
         EJECT                                                          26550002
         IECDRQE                                                        26600002
         EJECT                                                          26650002
         IEZIOB                                                         26700002
         EJECT                                                          26750002
CVT      DSECT                                                          26800002
         CVT                                                            26850002
         EJECT                                                          26900002
         IECDERWA                                                       26950002
**********                                                              27000002
*                                                                       27050002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        27100002
*                                                                       27150002
**********                                                              27200002
         ORG   EWAIERP                                                  27250002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 27300002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 27350002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 27400002
EWAIND0  DS    B                   FLAG BYTE                            27450002
EWAIVISR EQU   X'10'               V=R REQUEST                          28050002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 28100002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 28150002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 28200002
EWAIND1  DS    B                   FLAG BYTE                            28250002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 28300002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 28350002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 28400002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 28410002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 28420002
EWAIND2  DS    B                   FLAG BYTE                            28450002
EWAIND3  DS    B                   FLAG BYTE                            28500002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     28550002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  28600002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 28650002
*********  END OF BTAM LOCAL DEFINITIONS **********                     28700002
         EJECT                                                          29350002
         IECDIOSB                                                       29400002
         END                                                            29450002
./  ADD  SSI=33530073,NAME=IGG019LP
 TITLE 'IGG019LP - START I/O AND PAGE FIX APPENDAGES'                   00100002
*********************************************************************** 00300002
*                                                                     * 00400002
* MODULE NAME: IGG019LP   (OS/VS)                                     * 00450002
*                                                                     * 00460002
* DESCRIPTIVE NAME: BTAM START I/O AND PAGE FIX APPENDAGE             * 00470002
*                                                                     * 00480002
* COPYRIGHT: NONE                                                     * 00490002
*                                                                     * 00492002
* STATUS: RELEASE 2                                                   * 00494002
*                                                                     * 00496002
* FUNCTIONS:        1. START I/O APPENDAGE                            * 00700002
*                   THIS IS A NOP IN THAT CONTROL IS                  * 00750002
*                   IMMEDIATELY RETURNED TO IOS VIA REGISTER          * 00760002
*                   14. THE 'EXTEND PARAMETER LIST' INTERFACE         * 00762002
*                   (WHICH WAS A LIST OF CCW STRINGS FOR              * 00770002
*                   AUTOPOLL AND/OR DYNAMIC BUFFERING                 * 00780002
*                   THAT IOS SHOULD FIX AND TRANSLATE)                * 00790002
*                   IS NO LONGER NEEDED.                              * 00792002
*                                                                     * 01800002
*                   2. PAGE FIX APPENDAGE                             * 01900002
*                   CONSTRUCTS THE 'PAGE FIX PARAMETER LIST'          * 02000002
*                   TO CONTAIN THE BUFFER CONTROL BLOCK, THE          * 02050002
*                   BUFFER POOL, AND BOTH INDIRECT ADDRESSING         * 02060002
*                   LISTS AND THEN USES THE BRANCH ENTRY              * 02070002
*                   INTERFACE OF PAGE SERVICES TO FIX THE             * 02080002
*                   ABOVE AREAS IN REAL STORAGE FOR THE               * 02090002
*                   DURATION OF THE I/O REQUEST.                      * 02092002
*                                                                     * 02400002
* ENTRY POINTS:     SIOPF01  -  ENTRY POINT TO SIO APPENDAGE          * 02500002
*                                                                     * 02600002
*                   SIOPF02  -  ENTRY POINT TO PAGE FIX APPENDAGE     * 02700002
*                                                                     * 02800002
* INPUT:            1. START I/O APPENDAGE                            * 02900002
*                                                                     * 03000002
*                   REGISTER  2  -  IOB ADDRESS                       * 03100002
*                   REGISTER  3 -  DEB ADDRESS                        * 03200002
*                   REGISTER  4 -  DCB ADDRESS                        * 03300002
*                   REGISTER  7 -  UCB ADDRESS                        * 03400002
*                   REGISTER 14 -  RETURN ADDRESS                     * 03500002
*                                                                     * 03600002
*                   PAGE FIX APPENDAGE  -                             * 03700002
*                                                                     * 03800002
*                   REGISTER  2  -  IOB ADDRESS                       * 03900002
*                   REGISTER  3  -  DEB ADDRESS                       * 04000002
*                   REGISTER  4  -  DCB ADDRESS                       * 04100002
*                   REGISTER  7  -  UCB ADDRESS                       * 04200002
*                   REGISTER 14  -  RETURN ADDRESS                    * 04400002
*                                                                     * 04500002
* OUTPUT:           START I/O APPENDAGE  -                            * 04600002
*                                                                     * 04700002
*                   REGISTER 14  -  RETURN ADDRESS                    * 04800002
*                                                                     * 04850002
*                   PAGE FIX APPENDAGE  -                             * 07200002
*                                                                     * 07300002
*                   REGISTER 9  -  ADDRESS OF VIRTUAL SUBAREA         * 07400002
*                                   LIST                              * 07450002
*                                                                     * 07600002
*                    FORMAT OF VIRTUAL SUBAREA LIST ENTRIES:          * 07700002
*                                                                     * 07800002
*                   ************************************              * 07900002
*                   *         *                        *              * 08000002
*                   *    0    *        ADDR1           *              * 08100002
*                   *         *                        *              * 08200002
*                   ************************************              * 08300002
*                   *         *                        *              * 08400002
*                   *    0    *        ADDR2           *              * 08500002
*                   *         *                        *              * 08600002
*                   ************************************              * 08700002
*                                                                     * 08800002
*                   EACH ENTRY IS ONE DOUBLEWORD.  BITS 8 THRU 31     * 08900002
*                   OF AN ENTRY (ADDR1) CONTAIN THE STARTING          * 09000002
*                   ADDRESS OF AN AREA TO BE FIXED. BITS 40 THRU 63   * 09100002
*                   (ADDR2) CONTAIN THE ENDING ADDRESS PLUS           * 09200002
*                   ONE OF THE AREA TO BE FIXED. BIT 1 IS ON          * 09250002
*                   IN THE FIRST ENTRY TO INDICATE THAT THE           * 09260002
*                   AREAS ARE TO BE FIXED. BIT 32 IS ON IN            * 09270002
*                   THE LAST ENTRY TO INDICATE THAT IT IS             * 09272002
*                   THE LAST.                                         * 09280002
*                                                                     * 09500002
* EXTERNAL ROUTINES: NONE                                             * 09600002
*                                                                     * 09700002
* EXITS:            START I/O APPENDAGE - CONTROL IS RETURNED         * 09800002
*                   TO IOS VIA THE ADDRESS IN REGISTER 14.            * 09850002
*                                                                     * 10300002
*                   PAGE FIX APPENDAGE  -  CONTROL IS RETURNED TO     * 10400002
*                   IOS VIA THE ADDRESS IN REGISTER 14.               * 10500002
*                                                                     * 10600002
* OPERATION:        TO BE COMPLETED                                   * 10700002
*                                                                     * 10800002
*                                                                     * 10900002
* ATTRIBUTES:       THE START I/O APPENDAGE IS REENTERANT,            * 11000002
*                   ENABLED, AND OPERATES IN SUPERVISOR               * 11050002
*                   STATE WITH THE LOCAL LOCK HELD BY IOS.            * 11060002
*                                                                     * 11200002
*                   THE PAGE FIX APPENDAGE IS REENTRANT,              * 11300002
*                   ENABLED, AND OPERATES IN SUPERVISOR               * 11350002
*                   STATE WITH THE LOCAL LOCK HELD BY IOS.            * 11360002
*                                                                     * 11400002
* CHANGE ACTIVITY AS FOLLOWS:                                         * 11450002
*                                              PTMS                   * 11460002
*                                          YM5663  (12/11/73) PROLOG  * 11470002
*                                                                     * 11480002
*********************************************************************** 11500002
         EJECT                                                          11600002
IGG019LP START                                                          11650002
         SPACE 5                                                        11660002
ZEROREG  EQU   0                                                        11700002
RQEREG   EQU   1                                                        11800002
IOBREG   EQU   2                                                        11900002
DEBREG   EQU   3                                                        12000002
DCBREG   EQU   4                                                        12100002
TCBREG   EQU   5               TCB ADDR                          Y02947 12200002
VSLREG   EQU   6                VIRTUAL SUBAREA LIST             Y02947 12300002
*                                          ADDRESS               Y02947 12350002
UCBREG   EQU   7                                                        12400002
DBEXTREG EQU   8                ADDRESS OF DYNAMIC BUFFERING     Y02947 12500002
*                                EXTENSION IN THE IOB            Y02947 12550002
PARMREG  EQU   9                ADDRESS OF VIRTUAL SUBAREA       Y02947 12700002
*                                LIST ENTRY                      Y02947 12750002
WREGA    EQU   10               STARTING ADDRESS OF AREA         Y02947 12760002
*                                TO BE FIXED                     Y02947 12770002
WREGB    EQU   11               ENDING ADDRESS + 1 OF AREA       Y02947 12800002
*                                TO BE FIXED                     Y02947 12850002
BASEREG  EQU   12               BASE REGISTER                    Y02947 12900002
SAVEREG  EQU   13               SAVE AREA ADDRESS                Y02947 13000002
RETREG   EQU   14                                                       13100002
BRREG    EQU   15              BRANCH REGISTER                   Y02947 13200002
         USING *,BASEREG                                                13300002
         USING IECTDEB+36,DEBREG                                        13400002
         USING IECTIOB,IOBREG                                           13500002
         USING IHADCB,DCBREG                                            13600002
         EJECT                                                          13700002
SIOPF01  EQU   *                   ENTRY TO SIO APPENDAGE        Y02947 13750002
         BR    RETREG              RETURN                        Y02947 13800002
         CNOP  0,4                                               Y02947 13850002
         SPACE 2                                                        13900002
SIOPF02  EQU   *                  ENTRY TO PAGE FIX APPENDAGE           14000002
         STM   RETREG,BASEREG,DISP0(SAVEREG) SAVE REGISTERS      Y02947 14110002
         LR    BASEREG,BRREG      ESTABLISH ADDRESSABILITY       Y02947 14120002
         B     AROUND             BRANCH AROUND ID               Y02947 14130002
         DC    C'IGG019LP'                                       Y02947 14140002
         DC    C',VS2/R2, DEC  73'                               Y02947 14142002
         DS    0F                                                Y02947 14144002
PATCH    DC    XL40'00'            PATCH AREA                    Y02947 14146002
AROUND   L     TCBREG,DEBTCBAD-ONE     LOAD TCB ADDR             Y02947 14150002
         USING TCB,TCBREG              ESTABLISH TCB ADDR        Y02947 14160002
         TM    TCBFLGS6,TCBRV          VIRTUAL = REAL            Y02947 14170002
         BO    EXIT                    YES, EXIT                 Y02947 14180002
CKOLT    TM    IOBINCAM,ONLTT          ONLINE TEST IN CONTROL           15400002
         BO    EXIT                                                     15500002
CKDB0    TM    DCBBFTEK,DYNBUF         DYNAMIC BUFFERING                20100002
         BNO   EXIT                                                     20200002
*                                                                Y02947 20202002
*       TO REACH THIS POINT, WE ARE RUNNING VIRTUAL = VIRTUAL    Y02947 20210002
*       AND DYNAMIC BUFFERING IS SPECIFIED IN THE DCB. A         Y02947 20220002
*       VIRTUAL SUBAREA LIST WILL BE CREATED WHICH WILL          Y02947 20230002
*       CONTAIN THE AREAS TO BE FIXED FOR THIS I/O REQUEST.      Y02947 20240002
*       THEY ARE:                                                Y02947 20242002
*          1. BUFFER CONTROL BLOCK                               Y02947 20244002
*          2. THE ENTIRE BUFFER POOL                             Y02947 20246002
*               THE BCB AND THE BUFFER POOL MUST BE IN           Y02947 20248002
*               CONTIGUOUS CORE LOCATIONS                        Y02947 20248402
*          3. BOTH INDIRECT ADDRESSING LISTS  WHICH ALSO MUST    Y02947 20248802
*               BE IN CONTIGUOUS CORE LOCATIONS                  Y02947 20249202
*                                                                Y02947 20249602
         SR    VSLREG,VSLREG       CLEAR REGISTER                Y02947 20250002
         IC    VSLREG,DCBEIOBX     IOB SIZE                      Y02947 20260002
         LR    DBEXTREG,IOBREG     IOB ADDRESS                   Y02947 20270002
         AR    DBEXTREG,VSLREG     POINT TO END OF IOB           Y02947 20280002
         SH    DBEXTREG,HALF8      POINT TO DYN BUF EXT          Y02947 20290002
         L     VSLREG,DISP4(DBEXTREG)  LOAD VSL ADDR             Y02947 20292002
         LA    PARMREG,DISP8(VSLREG) POINT TO VSL ENTRIES        Y02947 20294002
         SPACE 1                                                        21300002
BUFPOOL  L     WREGA,DCBBUFCB          BCB ADDRESS                      21400002
         LA    WREGA,0(WREGA)          CLEAR HIGH BYTE                  21500002
         SR    WREGB,WREGB             CLEAR IC REG                     21600002
         IC    WREGB,DCBBUFNO          NUMBER OF BUFFERS                21700002
         MH    WREGB,DCBBUFL           TOTAL SIZE OF BUFFERS            21800002
         LA    WREGB,7(WREGA,WREGB)    ENDING ADDRESS                   21900002
         ST    WREGA,DISP0(PARMREG) BUFFER START ADDRESS         Y02947 21950002
         OI    DISP0(PARMREG),PGFIX INDICATE PAGE FIX FUNCTION   Y02947 22000002
         ST    WREGB,DISP4(PARMREG) BUFFER END ADDR + 1          Y02947 22050002
         L     WREGA,DISP0(VSLREG) 1ST IDAL ADDR                 Y02947 22100002
         LA    WREGA,DISP0(WREGA)  CLEAR HIGH ORDER BYTE         Y02947 22150002
         LR    WREGB,WREGA         LOAD 1ST IDAL ADDR            Y02947 22200002
         AH    WREGB,THREE20       ADD LENGTH OF BOTH IDALS      Y02947 22250002
         ST    WREGA,DISP8(PARMREG) 1ST IDAL START ADDR          Y02947 22300002
         ST    WREGB,DISP12(PARMREG) 2ND IDAL END ADDR + 1       Y02947 22350002
         OI    DISP12(PARMREG),LASTVSL SET LAST VSL ENTRY        Y02947 22400002
         L     WREGA,SIXT          LOAD CVT ADDR                 Y02947 22450002
         USING CVT,WREGA           ESTABLISH CVT ADDR            Y02947 22500002
         L     BRREG,CVTVPSIB      LOAD PAGE SERVICES ADDR       Y02947 22550002
         DROP  WREGA               DROP CVT ADDR                 Y02947 22600002
         MVI   DISP0(DBEXTREG),ON  SET COMP CODE = X'00'         Y02947 22610002
         EJECT                                                          22610402
*                                                                Y02947 22612002
*      FOR THE BRANCH INTERFACE TO PAGE SERVICES (PGFIX), THE    Y02947 22620002
*      FOLLOWING REGISTERS MUST CONTAIN:                         Y02947 22630002
*              REG0 = ECB ADDRESS                                Y02947 22640002
*              REG1 = VIRTUAL SUBAREA LIST ADDRESS               Y02947 22642002
*              REG4 = TCB ADDRESS                                Y02947 22644002
*                                                                Y02947 22646002
         LR    ZEROREG,DBEXTREG    LOAD ECB ADDR                 Y02947 22650002
         LR    RQEREG,PARMREG      LOAD VSL ENTRY ADDR           Y02947 22750002
         O     RQEREG,INDLIST1     SET LIST FLAG                 Y02947 22800002
         LR    DCBREG,TCBREG       LOAD TCB ADDR                 Y02947 22900002
         BALR  RETREG,BRREG        LINK TO PAGE SERVICES         Y02947 23050002
EXIT     EQU   *                                                        30100002
         LM    RETREG,BASEREG,DISP0(SAVEREG) RESTORE REGISTERS   Y02947 30150002
         BR    RETREG                  RETURN                           30600002
         EJECT                                                          30700002
         DS    0F                                                Y02947 30750002
INDLIST1 DC    X'80000000'                                              45000002
HALF8    DC    H'8'                                                     45500002
THREE20  DC    H'320'              LENGTH OF 2 IDALS             Y02947 45710002
ON       EQU   X'00'                                             Y02947 45770002
SIXT     EQU   X'10'               CVT ADDRESS                   Y02947 45790002
PGFIX    EQU   X'40'               PAGE FIX FLAG                 Y02947 45792002
LASTVSL  EQU   X'80'               LAST VSL ENTRY FLAG           Y02947 45794002
DYNBUF   EQU   X'08'                                                    47500002
ONLTT    EQU   X'01'                                                    47700002
ONE      EQU   1                   CONSTANT OF 1                 Y02947 48650002
DISP0    EQU   0                   DISPLACEMENT OF 0             Y02947 49550002
DISP3    EQU   3                   DISPLACEMENT OF 3             Y02947 49552002
DISP4    EQU   4                   DISPLACEMENT OF 4             Y02947 49560002
DISP8    EQU   8                   DISPLACEMENT OF 8             Y02947 49570002
DISP12   EQU   12                  DISPLACEMENT OF 12            Y02947 49580002
         EJECT                                                          49600002
         IECTIOBX                                                       49700002
WORKBYTE EQU   IOBCSW+7                                                 49750002
         EJECT                                                          49800002
         IECTDEBX                                                       49900002
         EJECT                                                          50000002
         DCBD  DSORG=BX,DEVD=BS                                         50100002
         EJECT                                                   Y02947 50110002
         IKJTCB DSECT=YES,LIST=YES                               Y02947 50150002
         EJECT                                                   Y02947 50160002
CVT      DSECT                                                   Y02947 50170002
         CVT   LIST=NO                                           Y02947 50180002
         END                                                            50200002
./  ADD  SSI=70830294,NAME=IGG019MA
         TITLE 'IGG019MA - BTAM READ/WRITE ROUTINE'                     00100013
*********************************************************************** 00250002
*                                                                     * 00300002
* MODULE NAME: IGG019MA   (OS/VS)                                     * 00350002
*                                                                     * 00400002
* DESCRIPTIVE NAME: BTAM READ/WRITE ROUTINE                           * 00450002
*                                                                     * 00460002
* COPYRIGHT: NONE                                                     * 00480002
*                                                                     * 00490002
* STATUS: RELEASE 3                                                   * 00500003
*                                                                     * 00600002
* FUNCTION:         GENERATE TELECOMMUNICATION CHANNEL PROGRAMS       * 00700002
*                                                                     * 00800002
* ENTRY POINT:      ENTRY IS TO 1ST EXECUTABLE INSTRUCTION FROM USER  * 00900002
*                   PROGRAM READ/WRITE MACRO OR QTAM OR ERP           * 01000002
*                                                                     * 01100002
* INPUT:            REGISTER  1 - ADDRESS OF DECB                     * 01200002
*                   REGISTER 14 - RETURN ADDRESS                      * 01300002
*                                                                     * 01400002
* OUTPUT:           1.  UPDATED IOB AND DECB FIELDS                   * 01500002
*                   2.  GENERATED CHANNEL PROGRAM                     * 01600002
*                   3.  RETURN CODE IN REGISTER 15                    * 01700002
*                       0 - NORMAL RETURN                             * 01800002
*                       4 - CHANNEL BUSY                              * 01900002
*                       8 - INVALID RELATIVE LINE NUMBER              * 02000002
*                       C - INVALID COMMAND                           * 02100002
*                      10 - ALL TERMINALS SKIP BIT ON                 * 02200002
*                      14 - LINE ERROR                                * 02300002
*                      18 - NO BUFFER AVAILABLE                       * 02400002
*                      1C - NO BUFFER POOL                            * 02500002
*                      20 - NO BUFFER ROUTINE                         * 02600002
*                      24 - READ FROM POSITION WITH NO SBA            * 02620002
*                      28 - INVALID CONTROL BLOCK FOUND               * 02640002
*                      2C - OLTEP IS EXECUTING                        * 02660002
*                                                                     * 02700002
* EXTERNAL ROUTINES: 1.  REQUEST/RELEASE BUFFER ROUTINE (IGG019MS)    * 02800002
*                    2.  DEVICE I/O MODULE FOR SPECIFIED DEVICE       * 02900002
*                    3.  IOS SVC 0 ROUTINE (EXECUTE CHANNEL PROGRAM)  * 03000002
*                                                                     * 03100002
* EXIT:             RETURN TO CALLING PROGRAM ADDRESS IN REGISTER 14  * 03200002
*                                                                     * 03300002
* IN LINE ROUTINES: THE READ/WRITE ROUTINE FINDS THE IOB, FINDS THE   * 03400002
*                   DEVICE I/O MODULE, OBTAINS THE AREA ADDRESS AND   * 03500002
*                   LENGTH, LOOPS ON THE CCW COUNT UNTIL ALL CCWS     * 03600002
*                   HAVE BEEN MOVED AND COMPLETED IN THE CHANNEL      * 03700002
*                   PROGRAM AREA OF THE IOB, AND ISSUES EXCP.         * 03800002
*                                                                     * 03900002
*                   THE CCW'S IN THE DEVICE I/O MODULE ARE COMPLETE   * 04000002
*                   EXCEPT FOR AREA ADDRESS AND COUNT.  AN INDEX IN   * 04100002
*                   THE 2ND AND 7TH BYTES OF THE CCW DETERMINES WHICH * 04200002
*                   SUBROUTINE IS BRANCHED TO TO COMPLETE THE AREA    * 04300002
*                   ADDRESS AND COUNT RESPECTIVELY.  WHERE OFFSETS    * 04400002
*                   TO THE NORMAL ADRS OR COUNT OCCUR THEY ALREADY    * 04500002
*                   EXIST IN THE CCW. THE SUB-ROUTINES ARE-           * 04600002
*                                                                     * 04700002
*                        A.  DATAREA - COMPLETES THE AREA ADDRESS FOR * 04800002
*                                      A READ/WRITE DATA OR READ RESP.* 04900002
*                                      INTO AREA COMMAND.             * 05000002
*                                                                     * 05100002
*                        B.  RESPAREA - PROVIDES THE RESPONSE ADDRESS * 05200002
*                                       IN THE DECB.                  * 05300002
*                                                                     * 05400002
*                        C.  SPECCHAR - PROVIDES THE CONTROL CHAR.    * 05500002
*                                       ADDRESS.  THE CONTROL CHARAC- * 05600002
*                                       TERS ARE DEFINED AS CONSTANTS * 05700002
*                                       AT THE END OF THE DEVICE I/O  * 05800002
*                                       MODULE.                       * 05900002
*                                                                     * 06000002
*                        D.  LIST - PROVIDES THE ADDRESS OF THE DIAL  * 06100002
*                                   DIGITS AND THEIR COUNT            * 06200002
*                                                                     * 06300002
*                        E.  PA1050D - SEE PALIST                     * 06400002
*                                                                     * 06500002
*                        F.  PALIST - FINDS THE 1ST NONSKIP POLLING   * 06600002
*                                     OR ADDRESSING ENTRY AND PLACES  * 06700002
*                                     ITS ADDRESS IN THE CCW.         * 06800002
*                                                                     * 06900002
*                        G.  TWXIDENT - PROVIDES THE ADDRESS AND      * 07000002
*                                       COUNT OF THE TWX OR BSC       * 07100002
*                                       IDENTIFICATION CHARACTERS.    * 07200002
*                                                                     * 07300002
*                        H.  DISABLE - DETERMINES TYPE OF DIALING     * 07400002
*                                       LIST AND INSERTS ENABLE       * 07500002
*                                       COMMAND IF IT IS AN ANSWER    * 07600002
*                                       LIST.                         * 07650002
*                                                                     * 07700002
*                        I.  DATALNG -  FOR READ/WRITE DATA IT        * 07800002
*                                       OBTAINS THE AREA LENGTH FROM  * 07900002
*                                       THE DECB.                     * 07950002
*                                                                     * 08000002
*                        J.  AUTOPOLL - SETS UP CHANNEL PROGRAMS      * 08003002
*                                       FOR AUTOPOLL OPERATIONS       * 08006002
*                                                                     * 08009002
*                        K.  BSCCHARS - PROVIDES THE CONTROL          * 08012002
*                                       CHARACTER ADDRESS.  THE       * 08015002
*                                       CONTROL CHARACTERS ARE IN     * 08018002
*                                       THE DCB.                      * 08020002
*                                                                     * 08021002
*                        L.  BSCDIAL - PROVIDES THE ADDRESS AND COUNT * 08024002
*                                      OF DIAL CHARACTERS FOR BSC.    * 08027002
*                                                                     * 08030002
*                        M.  BSCIDENT - PROVIDES THE ADDRESS AND      * 08033002
*                                       COUNT OF THE TERMINAL ID      * 08036002
*                                       CHARACTERS.                   * 08038002
*                                                                     * 08039002
*                        N.  BSCRESP - PROVIDES THE ADDRESS OF THE    * 08042002
*                                      PROPER RESPONSE FOR BSC.       * 08045002
*                                                                     * 08048002
*                        O.  BSCWAREA - COMPLETES THE AREA ADDRESS    * 08051002
*                                       FOR WRITE DATA FROM THE WRITE * 08054002
*                                       AREA.                         * 08056002
*                                                                     * 08057002
*                        P.  BSCGRAPH - PROVIDES THE ADDRESS OF       * 08060002
*                                       LEADING GRAPHICS FOR BSC.     * 08063002
*                                                                     * 08066002
*                        Q.  BSCWLNG - OBTAINS THE WRITE AREA LENGTH  * 08069002
*                                      FROM THE DECB.                 * 08072002
*                                                                     * 08072202
*                        R.  WTTAWRU - PROVIDES THE ADDRESS OF A WRU  * 08072402
*                                      BYTE IF WRU IS CODED YES IN    * 08072602
*                                      THE DCB, OTHERWISE THE ADDRESS * 08072802
*                                      OF A LETTER SHIFT CHARACTER    * 08073002
*                                      FOR WTTA.                      * 08073102
*                                      PROVIDES THE PAD CHARACTERS    * 08073202
*                                      ADDR AND THE COUNT IF IT IS A  * 08073402
*                                      WRITE PAD CHARACTERS.          * 08073602
*                                                                     * 08073802
*                        S.  WTTASNS - PUT X'FF' IN THE RESPONSE      * 08074002
*                                      FIELD OF THE DECB, WHEN A READ * 08074202
*                                      INITIAL OPERATION IS INDICATED * 08074402
*                                      FOR WTTA.                      * 08074802
*                                                                     * 08075002
*                        T.  CNTCHARS- POINTS DATA FIELD OF           * 08077002
*                                      WRITE FRAME CHANGE CCW TO      * 08079002
*                                      AREA POINTED TO BY ENTRY       * 08081002
*                                      FIELD OF DECB.                 * 08083002
*                                                                     * 08085002
*                        U.  FRAMECH - POINTS DATA AREA FIELD OF      * 08087002
*                                      WRITE FRAME CHANGE CCW PAST    * 08089002
*                                      DIAL CHARS IN TERMINAL LIST    * 08091002
*                                      TO POINT TO FRAME CHANGE       * 08093002
*                                      CHARACTERS.                    * 08095002
*                                                                     * 08097002
*                   DBDATA - THIS ROUTINE IS ENTERED FROM 'DATAREA'   * 08100002
*                   WHEN DYNAMIC BUFFERING IS SPECIFIED.  IT PROVIDES * 08200002
*                   THE ADDITIONAL CCW'S NEEDED AND MODIFIES THE      * 08300002
*                   APPROPIATE FIELDS (AREA ADDRESS, FLAGS, TP/OP     * 08400002
*                   CODE, COUNT).                                     * 08500002
*                                                                     * 08505002
*                        V.   SWIDREC - PUTS THE ADDRESS OF THE       * 08510002
*                                       READ-IN-AREA FIELD OF THE     * 08515002
*                                       SWLST TERMINAL LIST IN THE    * 08520002
*                                       AREA FIELD OF THE CCW AND     * 08525002
*                                       THE READ-IN-AREA WIDTH IN     * 08530002
*                                       THE COUNT FIELD OF THE CCW.   * 08535002
*                                                                     * 08540002
*                        W.   SWIDSENT- PUTS THE ADDRESS OF THE       * 08545002
*                                       IDSENT FIELD OF THE SWLST     * 08550002
*                                       TERMINAL LIST IN THE AREA     * 08555002
*                                       FIELD OF THE CCW AND THE      * 08560002
*                                       IDCOUNT IN THE COUNT FIELD    * 08565002
*                                       OF THE CCW.                   * 08570002
*                                                                     * 08575002
*                        X.   SWLSTTIC- PUTS THE ADDRESS OF CCW 1.    * 08580002
*                                       IN THE AREA FIELD OF THE      * 08585002
*                                       CCW.                          * 08590002
*                        Y.  RDFRPOS - USED FOR READ BUFFER FROM      * 08592002
*                                      POSITION AND READ MODIFIED     * 08594002
*                                      FROM POSITION. TESTS FOR       * 08596002
*                                      AN SBA ORDER.                  * 08598002
*                                                                     * 08648002
* ATTRIBUTES:       THIS ROUTINE IS REENTRANT                         * 08700002
*                                                                     * 08750002
* CHANGE ACTIVITY AS FOLLOWS:                                         * 08760002
*********************************************************************** 08765000
*            APARS                          PTMS                      * 08770002
*        YA01260  (10/19/73)            YM4057  (10/3/73) NO CODE     * 08780002
*        YA01016  (10/19/73)            YM4072  (10/15/73) DELETE     * 08790002
*        YA01028  (10/19/73)            YM5663  (12/11/73) PROLOG     * 08792002
*        YA01029  (10/19/73)            YM7701  (2/20/74)             * 08794000
*        YA01018  (10/19/73)                                          * 08796002
*        YA01856  (10/22/73)                                          * 08798002
*        YA02057  (10/22/73)                                          * 08798402
*        YA02153  (10/22/73)                                          * 08798802
*        YA02462  (10/22/73) FIX 1856                                 * 08799202
*        YA02128  (10/22/73)                                          * 08799602
*        YA03267  (2/4/74)                                            * 08809600
*        YA03268  (2/4/74)                                            * 08819600
*        YA03952  (3/19/74)                                           * 08819700
*        YA00542  (10/30/74)                                          * 08819803
*        YA02302  (10/30/74)                                          * 08819903
*        ZA02800  (12/20/74)          AZ04152  (09/24/75)             * 08823203
*        AZ07653  (12/08/75)          AZ07657  (12/08/75)             * 08824003
*        AZ07658  (12/09/75)          AZ09336  (03/11/76)             * 08824903
*        AZ10035  (05/10/76)          AZ11032  (05/11/76)             * 08825800
*        AZ11036  (05/12/76)          AZ11038  (07/23/76)             * 08827800
*********************************************************************** 08830002
         EJECT                                                          08840013
IGG019MA CSECT                                                          08850002
         SPACE 5                                                        08860002
CCWTBLRG EQU   0                        ADDRESS OF TBL OF ALL CCW'S     08900013
PARMREG0 EQU   0                        PARAMETER FOR SVC       YA02128 08910002
REG0     EQU   0                   USED IN BCTR FOR NO BRANCH    Y02947 08950002
DECBREG  EQU   1                        PTR TO DEC                      09000013
PARMREG1 EQU   1                        PARAMETER FOR SVC       YA02128 09050002
IOBREG   EQU   2                        PTR TO IOB                      09100013
AREAREG  EQU   3                        ADDRESS OF READ-WRITE AREA      09200013
TCBREG   EQU   3                        PTR TO TCB               Y02947 09250002
DCBREG   EQU   4                        PTR TO DCB                      09300013
CCWREG   EQU   5                        PTR TO CHANNEL COMMAND WORDS    09400013
CHPRGREG EQU   6                        ADDRESS OF MODEL CHNL PROGRAM   09500013
ZEROREG  EQU   7                        COUNT OF CCW'S COMPLETED.       09600013
DEBREG   EQU   7                        PTR TO DEB               Y02947 09650002
ICSREG   EQU   8                        WORK REGISTER                   09700013
ICREG    EQU   9                        1 CHARACTER WORK REGISTER       09800013
ONEREG   EQU   10                       CONTAINS 1 FOR COUNT            09900013
UCBPTREG EQU   10                                                Y02947 09950002
UCBREG   EQU   11                       PTR TO UCB               Y02947 09960002
TOTREG   EQU   11                       CONTAINS NO OF CCW'S IN CHNL PG 10000013
BASEREG  EQU   12                       BASE REGISTER                   10100013
SAVEREG  EQU   13                       SAVE REGISTER                   10200013
RETREG   EQU   14                       RETURN REGISTER                 10300013
BRREG    EQU   15                                                       10400013
         EJECT                                                   Y02947 10450002
L0       EQU   0                                               @ZA10035 10451000
L1       EQU   1                                               @ZA10035 10452000
L3       EQU   3                                               @ZA10035 10453000
L6       EQU   6                                               @ZA11038 10454000
L7       EQU   7                                               @ZA10035 10455000
L8       EQU   8                                               @ZA11038 10456000
L15      EQU   15                                              @ZA06399 10460003
L16      EQU   16                                              @ZA06399 10470003
L23      EQU   23                                                       10480003
L24      EQU   24                                                       10490003
NMEXT    EQU   16                  OFFSET TO NO. OF RLNS                10500002
BTAMSVC  EQU   116                 SVC FOR IECTSVC              YA02128 10550002
ERROR8   EQU   8                   BAD RETURN CODE              YA02128 10560002
MASKALL  EQU   X'FF'                                                    10600013
ERP      EQU   X'24'                                                    10700013
SADEN    EQU   X'80'                                                    10800013
BUSY     EQU   X'40'                    BUSY BIT                        10900013
CCFLAG   EQU   X'40'                                               000B 10920014
ZERO     EQU   X'00'                                               000B 10940014
ANDOFF   EQU   X'10'                                             A32468 10946020
WRTMASK  EQU   X'0D'                                               000H 10952018
ONLTST   EQU   X'40'                                               000H 10955018
ANSLST   EQU   X'7F'                                               000H 10958018
WTLIST   EQU   X'80'                                               000H 10961018
MASKBITS EQU   X'0F'                                               000H 10964018
EOTWTFLG EQU   X'04'                    WTTA EOT FLAG              000G 10970017
WRUWTFLG EQU   X'40'                    WTTA WRU FLAG              000G 10980017
RLNGTH   EQU   1                   RLN IS 1 BYTE LONG                   10980202
SAVE15   EQU   19                  DISP OF REG 15 IN SAVE AREA          10980402
OLTEPROG EQU   X'2C'               OLTEP IN PROGRESS CODE               10980602
TWOBITS  EQU   2                   USED IN SLA TO MULT BY 4             10980802
PREFIX   EQU   28                  LENGTH OF DEB PREFIX                 10981002
INVALCB  EQU   X'28'               INVALID CTL BLOCK CODE               10981202
NOSBA    EQU   X'24'               NO SBA ORDER CODE                    10981402
GOODRTN  EQU   X'00'               GOOD RETURN CODE                     10981602
NEXTNTRY EQU   4                   DISP OF NEXT ADDR IN UCB LIST        10982002
POLPTLNG EQU   4                   LENGTH OF DECPOLPT FIELD             10982202
ECBPT    EQU   4                   DISP OF ECB ADDR IN IOB              10982402
ECBPTLNG EQU   4                   LENGTH OF ECB ADDR                   10982602
CPAPT    EQU   64                  DISP OF CHAN PGM IN IOB              10982802
CPALNG   EQU   24                  LENGTH OF BSC3 CHAN PGM              10983002
STARTPT  EQU   16                  DISP OF START IN IOB                 10983202
FLAG1LNG EQU   1                   LENGTH OF IOBFLAG1 FIELD             10983402
CC       EQU   X'40'                    COMMAND CHAINING FLAG      000G 10990017
SWLST    EQU   X'FF'                                               000L 10995019
GCB      EQU   27                  OFFSET IN UCB TO ATTN HANDLING FLAGS 10995302
GRAF     EQU   X'1C'               OFFSET TO GRAPHIC STATUS     YA02128 10995402
ATTN     EQU   X'01'               ATTENTION BIT                        10995602
OLTEPSKP EQU   X'82'               OLTEP EXECUTING, SKIP BITS           10995902
READRLN  EQU   36                  OFFSET IN UCB OF RLN OF DVC TO BE RD 10996202
OLTEP    EQU   X'80'               UCB GCB OLTEP FLAG                   10996502
RDINIT   EQU   X'01'               CMD CODE FOR READ INIT               10997402
LCL3270  EQU   X'FE'               FIRST BYTE OF LOCAL 3270 @ IN        10997702
XFE      EQU   X'FE'               MASK FOR HEX FE           LD YA03952 10997800
*                                   DVC I/O MODULE                      10998002
RDTI     EQU   X'08'               READ INITIAL ACTIVE      LD @ZA02800 10998100
*                                                                       11010800
*        THE ABOVE CHANGE WILL AFFECT INSTRUCTION IN SEQ # 457148       11020800
*                                                                       11022800
RDYBIT   EQU   X'20'               DEVICE HAS COME READY        YA02128 11023802
RDYDEVIC EQU   X'F0'               DECFLAGS FOR READY DEVICE    YA02128 11036502
SBA      EQU   X'11'               HEX VALUE OF SBA ORDER               11049202
SBABYTE  EQU   1                   SBA SHOULD BE BYTE1 OF 4 BYTE DATA   11061902
*                                   AREA (RD FROM POSITION INSTR'S)     11074602
         EJECT                                                          11087313
         SR    BRREG,BRREG                                              11100013
         STM   RETREG,BASEREG,12(SAVEREG) SAVE REGISTERS                11200013
         BALR  BASEREG,0                                                11300013
         USING *,BASEREG                                                11400013
         USING IECTDECB,DECBREG                                         11500013
         USING IECTIOB,IOBREG                                           11600013
         USING IHADCB,DCBREG                                            11700013
         B     LOADCBAD                                                 11800013
         SPACE 3                                                        11900013
IOD      DS    0F                                                       12000013
         DC    34F'0'                   ADDRESSES OF DEVICE I/O MODULES 12100002
         DC    X'FF'                    END OF DEVICE I/O ADDRESSES000A 12200013
         DC    C'IGG019MA'                                       Y02947 12250002
         DC    C'** MVS *'                                              12260000
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY                   12264002
         DS    0F                                                Y02947 12270002
PATCH    DC    XL150'00'           PATCH AREA                    Y02947 12280000
         SPACE 3                                                        12300013
*                                       MAIN ROUTINE                    12400013
         SPACE 2                                                        12500013
LOADCBAD EQU   *                                            LD @ZA02302 12650003
         CLI   DISP4(DECBREG),XFF    DUMMY DECB ?           LD @ZA02302 12660003
         BNE   BTAMDECB            NO, CONTINUE             LD @ZA02302 12670003
         L     DECBREG,DISP4(DECBREG)  GET BTAM DECB        LD @ZA02302 12680003
         LA    DECBREG,DISP0(DECBREG)  CLEAR HI BYTE        LD @ZA02302 12690003
BTAMDECB EQU   *                                            LD @ZA02302 12692003
         L     DCBREG,DECDCBAD     LOAD DCB ADDR            LD @ZA02302 12694000
         LA    DCBREG,ZERO(DCBREG)   CLEAR HIGH BYTE           @ZA09336 12697003
         L     AREAREG,DCBDEBAD         LOAD ADDRESS OF DEB             12700013
         CLC   NMEXT(RLNGTH,AREAREG),DECRLN IS RLN GOOD                 12800002
         BL    BADRLN                   IF NOT, BRANCH                  12900013
         CLI   DECRLN,X'00'             IS RLN ZERO                2064 12930014
         BE    BADRLN                   IF SO, BRANCH              2064 12960014
         SR    IOBREG,IOBREG            CALCULATE PTR TO IOB            13000013
         IC    IOBREG,DCBEIOBX          SIZE                            13100013
         SR    ICSREG,ICSREG            CLEAR WORK REGISTER             13160018
         SR    ICREG,ICREG              CLEAR WORK REGISTER             13200018
         IC    ICREG,DECRLN             PICK UP REL LINE NUMBER         13240018
         MR    ICSREG,IOBREG            IOB SIZE TIMES RLN              13280018
         LR    IOBREG,ICREG             RESULT IN IOBREG                13340018
         A     IOBREG,DCBIOBAD          PTR TO 1ST IOB                  13400013
         LA    IOBREG,DISP0(IOBREG)     CLEAR HI ORDER BYTE     YA01856 13450002
         USING IECTDEB+X24,AREAREG      DEB ADDRESSABILITY     @ZA11032 13452000
         L     UCBREG,DEBUCBAD          GET 1ST. UCB ADDR      @ZA11032 13454000
         DROP  AREAREG                                         @ZA11032 13456000
         NI    DECCMCOD,X00  RESET CMD CODE / SWLST FLAG       @ZA11032 13458000
         TM    X13(UCBREG),X90  IS IT BSC                      @ZA11032 13460000
         BNO   NOTSWLST         NO BRANCH                      @ZA11032 13462000
         TM    X10(UCBREG),X07    IS IT BSC3                   @ZA11032 13464000
         BO    NOTSWLST           YES BRANCH                   @ZA11032 13466000
         TM    X10(UCBREG),X06    IS IT BCS2                   @ZA11032 13468000
         BNO   NOTSWLST           BRANCH NOT BCS2              @ZA11032 13470000
         L     AREAREG,DECENTRY   GET LIST ADDRESS             @ZA11032 13472000
         LA    AREAREG,ZERO(AREAREG)  CLEAR HIGH BYTE          @ZA11032 13474000
         LTR   AREAREG,AREAREG       IF NO ADDRESS             @ZA11032 13476000
         BZ    NOTSWLST              NO TERMINAL LIST          @ZA11032 13478000
         CLI   ZERO(AREAREG),SWLST   IS THIS SWLST             @ZA11032 13480000
         BNE   NOTSWLST              NO                        @ZA11032 13482000
         OI    DECCMCOD,XF0       SET SWLST FLAG               @ZA11032 13484000
NOTSWLST EQU   *                                               @ZA11032 13486000
         TM    IOBINCAM,BUSY            IS THE LINE BUSY                13500013
         BZ    SADTEST                  IF NOT, GO TO NEXT TEST         13600013
         TM    IOBFLAG1,ERP             IS ERP IN PROCESS               13700013
         BNO   CHPBUSY             IF NOT, EXIT                         13800002
         TM    IOBINCAM,X'08'           ERP FLAG ON              A23900 13830018
         BNO   CHPBUSY             NO, EXIT WITH BUSY                   13860002
SADTEST  TM    IOBINCAM,SADEN           WAS SAD OR ENABLE COMPLETED     13900013
         BZ    TESTOLT                  NO BRANCH             LD YM7701 13950000
         CLI   DECTYPE+ONE,RDINIT       READ INITIAL?         LD YM7701 14000000
         BNE   SADENER                  NO SET C. C. 14       LD YM7701 14050000
*        THREE LINES OF CODE DELETED BY APAR --------->        @ZA11032 14080000
         CLI   UCBTBYT3(UCBREG),UCB3DISP IS IT 3270?          LD YM7701 14090000
         BNE   SADENER                  NO SET C.C. 14        LD YM7701 14094000
TESTOLT  EQU   *                                              LD YM7701 14096000
         OI    IOBINCAM,BUSY            SET BUSY BIT                    14100013
         TM    IOBINCAM,ONLT            IS ONLT IN CONTROL         000D 14130016
         BO    DEVMOD                                              000D 14160016
         NI    IOBFLAG2,X'FE'           TURN OFF RESET FLAG             14200013
DEVMOD   SR    ICSREG,ICSREG            RESET REG                  000D 14300016
         IC    ICSREG,DCBDEVTP          LOAD DEVICE TYPE                14400013
         SLA   ICSREG,2                 MULTIPLY BY 4                   14500013
         L     CHPRGREG,IOD(ICSREG)     ADD TO DIRECTORY BASE AND LOAD  14600013
         LA    CCWREG,0(CHPRGREG)       SAVE ADRS OF START OF MODULE    14700013
         IC    ICSREG,DECTYPE+1         LOAD TYPE I/O OPERATION         14800013
         N     ICSREG,OFFMSK            AND OFF RST & INIBIT BITS (3F)  14900013
         IC    ICSREG,0(CHPRGREG,ICSREG) LOAD CHNL PROG OFFSET          15000013
         CH    ICSREG,FFCODE            IS IT VALID                     15100013
         BE    INVALID                  NO                              15200013
         SR    ICREG,ICREG             CLEAR WORK REG           YA01260 15210002
         IC    ICREG,DCBEIOBX          IOB SIZE                 YA01260 15220002
         LR    ONEREG,IOBREG           ADR OF IOB               YA01260 15230002
         AR    ONEREG,ICREG            POINT TO END OF IOB      YA01260 15240002
*        13   LINES OF CODE DELETED   BY APAR ---------------> @ZA11036 15253200
         BCTR  ONEREG,0                BACK UP ONE BYTE                 15263200
         MVI   0(ONEREG),X'00'         CLEAR TOTAL CNT OF CHARS         15273200
         AR    CHPRGREG,ICSREG          ADD OFFSET; REG ADRS=CHAL PROG  15300013
*        ONE   LINE OF CODE DELETED BY APAR -------------->    @ZA11032 15400000
         STC   BRREG,DECTPCOD           RESET TP-OP CODE                15500013
         STC   BRREG,DECERRST           RESET ERROR STATUS              15600013
         ST    DECBREG,IOBECBPT         ST DECB PTR IN IOB              15700013
         TM    DECTYPE,X'02'            IS 'S' AREA SPECIFIED           15800013
         BZ    AREAOK                   NO                     @ZA11036 15900000
         NI    DECTYPE,X'FD'            AND OFF 'S' AREA BIT            16000013
         OI    DECTYPE,X'01'            OR ON 'S' LENGTH        YA01018 16010002
         CLI   DECTYPE+1,RCONTONE       IS THIS READ TCW           000L 16030019
         BE    LOAD                                                000L 16060019
         TM    DECTYPE+1,X'01'          IS COMMAND READ                 16100013
         BZ    AREAOK                   NO                              16200013
LOAD     EQU   *                                                   000L 16250019
*        11    LINES OF CODE DELETED BY APAR ------------>     @ZA11036 16299200
         L     CCWTBLRG,REQONE        LOAD REQ COUNT IN REG 0           16359200
         LR    DECBREG,DCBREG         LOAD DCB PTR INTO REG 1           16419200
         REQBUF (1),AREAREG,(0)         REQUEST DESIRED NUMBER   Y02947 16500002
*                                       OF BUFFERS               Y02947 16550002
         LTR   BRREG,BRREG              TEST IF BUFFER GRANTED          16600013
         BZ    BUFOK                    O.K.                            16700013
         LA    BRREG,16(BRREG)          ADD 16 TO RETURN CODE           16800013
         B     NOBUF                    RETURN                          16900013
*        30    LINES OF CODE DELETED BY APAR -------------->   @ZA11036 17087700
         B     AREAOK                                                   17088300
BUFOK    L     DECBREG,24(SAVEREG)      RESTORE DECB ADDRESS            17088902
         ST    AREAREG,DECAREA          STORE BUFFER ADRS IN DECB       17100013
AREAOK   TM    DECTYPE,X'01'            TEST FOR 'S' LENGTH             17200013
         BZ    LNGOK                    NO                              17300013
         NI    DECTYPE,X'FE'            AND OFF 'S' LENGTH BIT          17400013
         MVC   DECLNGTH(2),DCBBUFL      MOVE LENGTH FROM DCB TO DECB    17500013
LNGOK    MVC   DECRESPN(2),FULL4        RESET RESPONSE FIELD TO ZERO    17600013
         SR    CCWTBLRG,CCWTBLRG        RESET REGISTER                  17700013
         IC    CCWTBLRG,24(CCWREG)      INSERT OFFSET TO CCW'S     000B 17800014
         AR    CCWTBLRG,CCWREG          ADD MODULE START ADRS           17900013
         LA    CCWREG,IOBCPA            LOAD ADRS OF CHANNEL PROG AREA  18000013
         ST    CCWREG,IOBSTART                                          18100013
         SR    TOTREG,TOTREG                                            18200013
         SR    ICREG,ICREG                                              18300013
         LA    ONEREG,1                 LOAD CONSTANT 1                 18400013
         BAL   RETREG,RSTENTRY                                          18500013
         B     ENDCCW                                                   18600013
RSTENTRY LR    ZEROREG,ONEREG           RESET REGISTERS                 18700013
         IC    TOTREG,0(CHPRGREG)       LOAD COUNT OF CCW'S IN CHNL PRG 18800013
         N     TOTREG,OFFMSK            AND OF RESET BIT IF PRESENT     18900013
         CLI   DECTYPE+1,WCON           IS THIS A WRITE CONNECT    000L 18910019
         BNE   MOVECCW                                             000L 18920019
         CLI   IOBCPA+5,CONNECT         IS THE LINE CONNECTED      000L 18930019
         BNE   MOVECCW                                             000L 18940019
         MVI   IOBCPA+5,DISCON          RESET TP OP CODE           000L 18950019
         LA    CCWREG,8(CCWREG)         POINT TO SECOND CCW        000L 18960019
         ST    CCWREG,IOBSTART          STORE ADDRESS              000L 18970019
         B     SETLAST2                                            000L 18980019
MOVECCW  SR    ICSREG,ICSREG                                            19000013
         IC    ICSREG,0(ZEROREG,CHPRGREG) LOAD OFFSET TO CCW WANTED     19100013
         SLA   ICSREG,3                 MULTIPLY BY SIZE OF CCW'S       19200013
         AR    ICSREG,CCWTBLRG          ADD TABLE STARTING ADDRESS      19300013
         MVC   0(8,CCWREG),0(ICSREG)    MOVE CCW TO CHNL PROS AREA      19400013
         SR    ICREG,ICREG              CLEAR REG FOR IC INSTR  YA03267 19450000
         IC    ICREG,1(CCWREG)          LOAD AREA INDEX                 19500013
         MVI   1(CCWREG),X'00'          ZERO INDEX IN CCW               19600013
         L     AREAREG,DECENTRY                                         19700013
         B     BTBL1(ICREG)             GO TO AREA ROUTINE              19800013
TESTLNG  IC    ICREG,6(CCWREG)          LOAD LNGTH INDEX                19900013
         CLI   DECTYPE+1,RDCON          IS THIS READ CONNECT       000L 19912019
         BE    SWLSTTST                                          A38568 19916002
         CLI   DECTYPE+1,RCONTONE       IS THIS A READ TCW         000L 19920019
         BE    SWLSTTST                                          A38568 19924002
         CLI   DECTYPE+DISP1,WINIT      WRITE INITIAL          @ZA04152 19925003
         BE    TESTLNGA                 YES CK SWLST           @ZA04152 19926003
         CLI   DECTYPE+1,WCON           IS THIS WRITE CONNECT      000L 19928019
         BNE   NOSWLST                  NO                         000L 19932019
TESTLNGA TM    DECCMCOD,XF0            IS THIS A SWLIST?       @ZA10032 19932300
         BNO   NOSWLST                   NO                    @ZA11032 19932600
         CLI   7(AREAREG),ZERO          IS THIS AN AUTO-DIAL LIST  000L 19936019
         BE    NOAD                                                000L 19940019
         MVI   0(CCWREG),DIAL           PUT DIAL COMMAND IN CCW    000L 19944019
         MVC   7(1,CCWREG),7(AREAREG)   MOVE DIAL COUNT TO CCW     000L 19948019
         SR    ICSREG,ICSREG            CLEAR REGISTER             000L 19952019
         IC    ICSREG,6(AREAREG)        GET READ-IN-AREA LENGTH    000L 19956019
         LA    AREAREG,7(AREAREG)                                  000L 19960019
         AR    AREAREG,ICSREG           POINT TO DIAL CHARACTERS   000L 19964019
         A     AREAREG,0(CCWREG)        ADD COMMAND AND OFFSET     000L 19968019
         ST    AREAREG,0(CCWREG)        STORE IN CCW               000L 19972019
         TM    DECCMCOD,XF0             IS THIS SWLIST         @ZA11032 19972300
         BO    TESTLAST           YES                          @ZA11032 19972600
NOAD     EQU   *                                                   000L 19976019
         LA    ZEROREG,3(ZEROREG)       SKIP UNUSED CCWS           000L 19980019
         B     UPDATE                                              000L 19984019
SWLSTTST EQU   *                                            LD @ZA00542 19985003
         SR    ICSREG,ICSREG       CLEAR REGISTER              @ZA07653 19985103
         IC    ICSREG,DCBDEVTP  LOAD INDEX TO DEVICE I/O TABLE @ZA07653 19985803
         SLA   ICSREG,TWOBITS         MULTIPLY BY 4            @ZA07653 19986503
         LA    ICSREG,IOD(ICSREG)     GET ADDRESS OF TABLE     @ZA07653 19987203
         CLI   ZERO(ICSREG),LCL3270    LOCAL 3270?             @ZA07653 19987903
         BE    NOSWLST                                         @ZA07653 19988603
         TM    DECCMCOD,XF0        IS THIS A SWLIST?           @ZA11032 19988800
         BO    TESTLAST       GO CHECK FOR LAST CCW            @ZA11032 19989000
NOSWLST  EQU   *                                                   000L 19996519
         B     BTBL2(ICREG)             GO TO LENGTH ROUTINE            20000013
SETRC    SR    BRREG,BRREG              SET RETURN CODE = ZERO  YA02153 20050002
         BR    RETREG                   RETURN                  YA02153 20060002
TESTLAST BXH   ZEROREG,ONEREG,SETRC IS CHANNEL PROGRAM COMPLETE YA02153 20100002
         LA    CCWREG,8(CCWREG)         INCREMENT CCW ADDRESS           20200013
         B     MOVECCW                  GO TO MOVE IN NEXT CCW          20300013
TSTOLTEP EQU   *                                                        20320002
         NI    IOBINCAM,MASKALL-BUSY  TURN OFF IOB BUSY FLAG            20340002
         MVI   SAVE15(SAVEREG),OLTEPROG SET OLTEP IN PROGRESS           20360002
         B     RESTREG             RESTORE & RETURN TO USER             20380002
         EJECT                                                          20400013
CHPBUSY  MVI   19(SAVEREG),X'04'        SET CHANNEL BUSY CODE           20500013
         B     RESTREG                                                  20600013
BADRLN   MVI   19(SAVEREG),X'08'        SET CODE FOR TOO HIGH RLN       20700013
         B     RESTREG                                                  20800013
INVALID  MVI   19(SAVEREG),X'0C'        SET INVALID COMMAND CODE        20900013
         B     RST                                                      21000013
FULLUSE  EQU   *                                                 A43797 21050002
         NI    DECTYPE,X'FF'-AP TURN OFF AUTOPOLL IN PROGRESS    A43797 21100002
INVALADR EQU   *                                                 A43797 21150002
ALLSKIP  MVI   19(SAVEREG),X'10'        SET ALL DEVICES SKIP CODE       21200013
         B     RST                                                      21300013
SADENER  MVI   19(SAVEREG),X'14'        SET SAD ENABLE ERROR            21400013
         B     RESTREG                                                  21500017
NOBUF    STC   BRREG,19(SAVEREG)        SET NO BUFFER CODE              21600013
         B     RST                                                      21700013
ENDCCW   TM    DECTYPE+1,X'80'          IS RESET SPECIFIED              21800013
         BZ    SETLAST                  NO                              21900013
         AR    CHPRGREG,ZEROREG         RESET TO START OF RESET PROGRAM 22000013
         TM    0(CHPRGREG),X'80'        TEST TO SEE IF RESET POSSIBLE   22100013
         BZ    SETLAST                  BRANCH IF NOT                   22200013
         CLI   5(CCWREG),X'25'          THIS A READ RESP           000C 22230015
         BE    SETLAST1                 BYPASS SETTING CC FLAG     000C 22260015
         OI    4(CCWREG),X'40'          SET CC FLAG IN CCW              22300013
SETLAST1 EQU   *                                                   000C 22350015
         LA    CCWREG,8(CCWREG)         STEP CCW REGISTER               22400013
         BAL   RETREG,RSTENTRY                                          22500013
SETLAST  OI    5(CCWREG),X'80'          SET LAST CCW BIT IN TP OP CODE  22600013
SETLAST2 EQU   *                                                   000L 22650019
         TM    IOBFLAG1,ERP             TEST FOR ERROR RCVY IN PROCESS  22700013
         BO    RESTREG                                                  22800013
         NI    DECTYPE,X'F7'            RESET WRITE ENQ FLAG     A38557 22820020
         NI    DECFLAGS,X'00'          RESET FLAGS               A26916 22850019
         SR    ICSREG,ICSREG       RESET REG                            22851002
         IC    ICSREG,DCBDEVTP     LOAD INDEX TO DEVICE I/O TABLE       22852002
         SLA   ICSREG,TWOBITS      MULTIPLY BY 4                        22853002
         LA    ICSREG,IOD(ICSREG)  GET @ OF TABLE                       22854002
         CLI   0(ICSREG),LCL3270   IS IT A LOCAL 3270                   22855002
         BNE   EXCP                NO, EXCP                             22856002
         L     DEBREG,DCBDEBAD     GET ADDR OF DEB                      22857002
         L     DEBREG,PREFIX(DEBREG) POINT PAST PREFIX                  22858002
         USING IECTDEB,DEBREG                                           22859002
         SR    ICSREG,ICSREG       CLEAR REGISTER                       22859102
         IC    ICSREG,IOBUCBX      GET UCB INDEX FROM IOB               22859202
         SLA   ICSREG,TWOBITS      & MULTIPLY BY FOUR                   22859302
         L     UCBREG,DEBUCBAD(ICSREG) GET ADDRESS OF UCB BY            22859402
*                                  INDEXING INTO DEB UCB TABLE          22859502
         TM    GCB(UCBREG),OLTEP   OLTEP EXECUTING ON DEVICE            22859602
         BO    TSTOLTEP            YES, EXIT AFTER SETTING RC           22859702
         CLI   DECTYPE+1,RDINIT    WAS COMMAND A READ INITIAL           22860002
         BNE   RESETATN            NO, RESET ATTENTION FLAGS            22861002
         MVI   DECSDECB,ZERO       CLEAR COMP CODE              YA02128 22871002
         CLC   IOBDCBPT+DISP1(LEN3),DEBDCBAD ARE CHAINS GOOD    YA02128 22871402
         BNE   DEBBAD              NO, ERROR                    YA02128 22871802
         LR    PARMREG1,UCBREG     YES, SET FOR SVC             YA02128 22872202
         SR    PARMREG0,PARMREG0   CLEAR REG 0                  YA02128 22872302
         SR    BRREG,BRREG         ROUTE CODE FOR READ TI       YA02128 22872402
         SVC   BTAMSVC             TO IECTSVC                   YA02128 22879402
SVCDONE  B     BTBL3(BRREG)        BRANCH ON RETURN CODE        YA02128 22888002
DEBBAD   LA    BRREG,ERROR8        SET ERROR RETURN CODE        YA02128 22890002
         B     BADCB               READY FOR RETURN             YA02128 22892002
RESETATN SR    UCBREG,UCBREG       CLEAR REG                            22895002
         IC    UCBREG,IOBUCBX      GET UCB INDEX                        22902002
         SLL   UCBREG,2            MULTIPLY BY 4                        22909002
         L     UCBREG,DEBUCBAD(UCBREG) GET UCB ADDRESS                  22916002
         LR    PARMREG1,UCBREG     SET FOR SVC                  YA02128 22923002
         SR    PARMREG0,PARMREG0   CLEAR REG 0                  YA02128 22930002
         LA    BRREG,ONE           SET ROUTING FOR ATNR         YA02128 22937002
         SVC   BTAMSVC             TO IECTSVC                   YA02128 22951002
         B     BTBL4(BRREG)            CK RETURN CODE       L5 @ZA03567 22958003
BTBL4    B     EXCP              IF X'0',EXCP               L5 @ZA03567 22965003
         B     INVALUCB     IF X'04' INVALID ICB            L5 @ZA03567 22967003
         B     FINDRDY      IF X'08' DEV RDY                L5 @ZA03567 22969003
INVALUCB MVI   SAVE15(SAVEREG),INVALCB  SET INVALID UCB CODE            22972002
         B     RESTREG             RESET AND RETURN TO USER             22979002
EXCP     EQU   *                                                        22986002
         LR    DECBREG,IOBREG                                           22993002
         EXCP  (1)                      EXECUTE CHANNEL PROGRAM         23000013
         B     LOADM                                             A26916 23100019
RST      NI    IOBINCAM,MASKALL-BUSY    TURN OFF BUSY BIT               23200013
RESTREG  EQU   *                                                        23240018
         L     DECBREG,24(SAVEREG)     RESTORE DECB ADDRESS             23280018
         NI    DECSDECB,X'80'      CLEAR COMPLETION CODE        YA01028 23290002
         NI    DECTYPE,X'F7'            RESET WRITE ENQ FLAG     A38557 23300020
         NI    DECFLAGS,X'00'          RESET FLAGS                      23320018
LOADM    L     DECBREG,L24(SAVEREG)     RESTORE DECB ADDRESS   @ZA11032 23330000
         NI    DECCMCOD,X00          RESET SWLST FLAG          @ZA11032 23340000
         LM    RETREG,BASEREG,12(SAVEREG)   RESTORE REGISTERS    A26916 23360000
         BR    RETREG                   RETURN TO USER                  23400013
         EJECT                                                          23500013
*                                       BRANCHING TABLE                 23600013
         SPACE 2                                                        23700013
BTBL1    B     TESTLNG               00 NO AREA, PRESET ADDRESS         23800013
         B     DATAREA               04 I/0 TO/FM DATA AREA + INCREMENT 23900013
         B     RESPAREA              08 READ INTO FIRST DATA AREA BYTE  24000013
         B     SPECCHAR              0C WRITE SPECIAL CHARACTER(S)      24100013
         B     LIST                  10 WRITE DIAL LIST                 24200013
         B     PALIST                14 WRITE POLLING CHARACTERS        24300013
         B     TWXIDENT              18 WRITE TWX IDENT                 24400013
         B     PA1050D               1C WRITE 1050 DIAL ADRS CHARACTERS 24500013
         B     DISABLE               20 DISABLE LINE                    24600013
         B     AUTOPOLL              24 AUTOPOLL                   000A 24700013
         B     BSCCHARS              28 WRITE BSC CHARS            000B 24710014
         B     BSCDIAL               2C BSC DIAL                   000B 24720014
         B     BSCIDENT              30 BSC IDENT                  000B 24730014
         B     BSCRESP               34 WRITE BSC RESPONSE         000B 24740014
         B     BSCWAREA              38 I/O TO/FM WAREA            000B 24750014
         B     BSCGRAPH              3C WRITE LEADING GRAPHICS     000B 24760014
         B     BSCADRS               40 RESPONSE TO BSC ADDRS      000B 24770014
         B     WTTAWRU               44 WRITE WRU OR NOT (WTTA)    000G 24780017
         B     WTTASNS               48 PUT X'FF' IN THE RESPN FIELD00G 24790017
         B     WRITTONE              4C WRITE TONE CCW FOR W.T.    000H 24795018
         B     CNTCHARS              50 WRITE FRAME CHANBE         000K 24796018
         B     FRAMECH               54 FRAME CHANGE DFTRMLST      000K 24797018
         B     SWIDREC               58 READ ID SEQUENCE           000L 24797719
         B     SWIDSENT              5C WRITE ID SEQUENCE          000L 24798419
         B     SWLSTTIC              60 TIC TO FIRST CCW           000L 24799119
         B     RDFRPOS               64 READ FROM POSITION              24799502
         SPACE 3                                                        24800013
BTBL2    B     TESTLAST              00 NO ADDITIONAL COUNT NEEDED      24900013
         B     DATALNG               04 GET LENGTH FROM DECB            25000013
         B     BSCWLNG               08 GET WLENGTH FROM DECB      000B 25050014
         B     CONVLENG                                                 25070018
BTBL3    B     FINDATTN              00 CHECK UCB'S FOR ATTN            25090002
         B     NOATTN                04 TURN ON BUSY BITS               25093002
         B     BADCB                 08 INVALID CONTROL BLOCK           25096002
         B     FINDRDY               0C READY INTERCEPTED       YA02128 25098002
         EJECT                                                          25100013
*                                       AREA ROUTINES                   25200013
         SPACE 2                                                        25300013
BSCWAREA L     ICSREG,DECWAREA          LOAD ADDRESS OF I/O AREA   000B 25350014
         B     CNTAREA                  BRANCH                     000B 25400014
DATAREA  L     ICSREG,DECAREA           LOAD ADDRESS OF I/O AREA   000B 25450014
         CLI   DECTYPE+1,X'16'          THIS WRITE ENQ           A38557 25453020
         BNE   CNTAREA                  NO, BRANCH               A38557 25456020
         CLI   0(CCWREG),X'01'                                   A44965 25457002
         BE    CNTAREA                                           A44965 25458002
         TM    DECTYPE,X'08'            DECAREA/LENGTH SPECIFIED A38557 25459020
         BZ    RESPAREA                 NO, BRANCH               A38557 25462020
         LH    AREAREG,DECLNGTH         LOAD DECB LENGTH         A38557 25465020
         CH    AREAREG,K2+2             IS IT GREATER THAN 2     A38557 25468020
         BNH   RESPAREA                 NO, BRANCH               A38557 25471020
CNTAREA  LA    ICSREG,0(ICSREG)         CLEAR HIGH ORDER BYTE      000F 25480017
         CLI   L7(CCWREG),XFF      2740 READ REPEAT AUTO POLL  @ZA10035 25482000
         BNE   CNTAREA2             BRANCH NO                  @ZA10035 25484000
         TM    IOBFLAG1,X20         ERP IN CONTROL             @ZA10035 25486000
         BO    CNTAREA1            BRANCH YES                  @ZA10035 25488000
         MVI   L7(CCWREG),X00      CLEAR FF IN REPEAT CCW      @ZA10035 25490000
         B     CNTAREA2                                        @ZA10035 25492000
CNTAREA1 CLI   IOBWORK+L1,X01      LAST OPERATION RD TI        @ZA10035 25494000
         BNE   CNTAREA2               BRANCH NO                @ZA10035 25496000
         MVI   L3(CCWREG),X01        YES INCREASE ADDR BY ONE  @ZA10035 25498000
CNTAREA2 L     AREAREG,L0(CCWREG)    LOAD CMND CODE AND OFFSET @ZA10035 25500000
         AR    AREAREG,ICSREG           ADD ADDRESS                000B 25550014
         TM    DCBBFTEK,X'08'           TEST FOR DYNAMIC BUFFERING      25600013
         BO    DBDATA                   YES, G0 SET UP ADDITIONAL CCW'S 25700013
         ST    AREAREG,0(CCWREG)        STORE IN CCW                    25706017
         TM    DECCMCOD,XF0             IS THIS A SWLST ?      @ZA11032 25706200
         BNO   TESTLNG               NO                        @ZA11032 25706400
         MVC   SIX(TWO,CCWREG),DECLNGTH  MOVE LENGTH           @ZA04152 25710203
         B     TESTLAST           CHECK FOR LAST CCW           @ZA04152 25711203
RDFRPOS  EQU   *                                                        25712502
         CLI   SBABYTE(AREAREG),SBA  IS THERE  AN SBA ORDER             25713002
         BE    SBAOK               YES, CCW DATA @ = DECENTRY           25713502
         MVI   SAVE15(SAVEREG),NOSBA SET NO SBA CODE                    25714002
         B     RESTREG             RESET AND RETURN TO USER             25714502
SBAOK    LA    AREAREG,0(AREAREG)  CLEAR HIGH ORDER BYTE                25715002
         L     ICSREG,0(CCWREG)    LOAD CMD CODE AND OFFSET             25715502
         AR    ICSREG,AREAREG      ADD ADDRESS (DECENTRY)               25716002
         ST    ICSREG,0(CCWREG)    STORE IN CCW                         25716502
         B     TESTLAST            BYTE COUNT IN CCW CORRECT            25717002
         SPACE 3                                                   000G 25718017
WTTAWRU  EQU   *                                                   000G 25724017
         LR    AREAREG,CCWTBLRG         LOAD BASE ADDR OF CONSTANT 000G 25730017
         A     AREAREG,0(CCWREG)        ADD CMND CODE AND OFFSET   000G 25736017
         CLI   6(CCWREG),X'0C'          IS WRITE PAD CHARACTERS    000G 25742017
         BE    MOTORON                  BRANCH IF YES              000G 25748017
         CLI   3(CCWREG),X'69'          IS A WRITE WRU             000G 25754017
         BNE   WTTAID                   BRANCH IF NOT              000G 25760017
         TM    DCBBQFLG,WRUWTFLG        IS WRU CODED YES IN THE DCB000G 25766017
         BO    CNTWTTA1                 BRANCH IF YES            A25043 25772002
         BCTR  AREAREG,0                DECREMENT BY 1 TO POINT ON A00G 25778017
*                                       PAD CHARACTER.             000G 25784017
         B     CNTWTTA1                                          A25043 25790002
MOTORON  EQU   *                                                   000G 25796017
         NI    6(CCWREG),X'00'          ZERO SUBROUTINE INDEX      000G 25802017
         ST    AREAREG,0(CCWREG)        STORE IN CCW               000G 25808017
         TM    DECFLAGS,EOTWTFLG       IS THE PREVIOUS MSG ENDED        25814018
         BNO   TESTLAST                 BY EOT, BRANCH IF NOT      000G 25820017
         SR    AREAREG,AREAREG          RESET REGISTER             000G 25826017
         IC    AREAREG,DCBWTPAD         INSERT THE MARK-CHARS COUNT000G 25832017
         LA    AREAREG,1(AREAREG)       INCREMENT AREAREG BY 1     000G 25838017
         B     CNTWTTA3                 IF YES, BR TO STORE CNT  A25043 25844002
         SPACE 3                                                   000G 25850017
WTTASNS  EQU   *                                                   000G 25856017
         MVI   DECRESPN,X'FF'           PUT X'FF' IN THE RESPN FIELD00G 25862017
         B     RESPAREA                                            000G 25868017
         SPACE 3                                                   000G 25874017
WTTAID   EQU   *                                                   000G 25880017
         L     AREAREG,DECENTRY         LOAD TERMINAL LIST ADDRESS 000G 25886017
         CLI   5(CCWREG),X'04'          IS A WRITE CPU ID          000G 25892017
         BE    WTTACPU                  BRANCH IF YES              000G 25898017
         TM    DCBBQFLG,WRUWTFLG        IS WRU CODED YES IN THE DCB000G 25904017
         BO    WTTATERM                 BRANCH IF YES              000G 25910017
         SH    CCWREG,EIGHT             DECREMENT CCWREG BY 8      000G 25916017
         B     TESTLAST                 TO IGNORE THE READ TERM ID.000G 25922017
WTTATERM LA    AREAREG,1(AREAREG)       ADDR TO LIST ADDRESS       000G 25928017
         IC    ICREG,0(AREAREG)         INSERT COUNT OF ID CHARS   000G 25934017
         BCTR  ICREG,0                  DECREMENT IT BY 1          000G 25940017
         STH   ICREG,6(CCWREG)          AND STORE INTO CCW COUNT   000G 25946017
         B     CNTWTTA2                                          A25043 25952002
WTTACPU   EQU   *                                                  000G 25958017
         TM    DCBBQFLG,WRUWTFLG        IS WRU CODED YES IN THE DCB000G 25964017
         BO    BSCIDENT                 BRANCH IF YES              000G 25970017
         B     TWXIDENT                 BRANCH IF NOT              000G 25976017
         SPACE 3                                                        26000013
BSCADRS  SR    BRREG,BRREG              CLEAR REGISTER             000B 26050014
RESPAREA LA    AREAREG,DECRESPN         LOAD RESPONSE AREA ADDRESS      26100013
         A     AREAREG,0(CCWREG)        ADD CCW COMMAND                 26200013
STRESP   ST    AREAREG,0(CCWREG)        STORE IN CCW                    26300013
         TM    DECCMCOD,XF0             IS THIS A SWLST ?      @ZA11032 26306000
         BO    TESTLAST                 GO PROCESS LIST        @ZA11032 26312000
         LTR   BRREG,BRREG              IS WREG EMPTY                   26400013
         BZ    TESTLNG                  YES, POLL/ADRS DOES NOT PRECEDE 26500013
         TM    0(BRREG),X'80'           NO, IS POLL/ADRS TERM LAST      26600013
         BZ    RSTBRREG                 NO                              26700013
         CLI   5(CCWREG),X'06'          IS TP OP CODE 06           000H 26730018
         BNE   SETCC                    NO, SET COMMAND CHAINING   000H 26760018
         CLI   7(CCWREG),X'02'          IS CCW COUNT TWO           000H 26790018
         BE    RSTBRREG                 YES, DON'T SET COMMAND CHAIN 0H 26820018
SETCC    OI    4(CCWREG),X'40'          SET COMMAND CHAIN IN CCW   000H 26850018
RSTBRREG SR    BRREG,BRREG              RESET REGISTER                  26900013
         B     TESTLNG                                                  27000013
         SPACE 3                                                        27100013
BSCRESP  SR    AREAREG,AREAREG          RESET REGISTER             000B 27110014
         IC    AREAREG,IOBSNDPT         INSERT ACK POINTER         000B 27120014
         AR    AREAREG,DCBREG           ADD DCB ADDRESS            000B 27130014
         B     CNTCHARS                 BRANCH                     000B 27140014
BSCCHARS LR    AREAREG,DCBREG           LOAD ADDRESS OF DCB        000B 27150014
         CLI   DECTYPE+1,WRRESET        IS THIS WR RESET         A32466 27152020
         BE    RESETACK                 YES, RESET ACK PTRS      S99245 27154002
         CLI   DECTYPE+1,WRRSTMON  IS THIS WR RESET MONITOR?     S99245 27154402
         BNE   CNTCHARS            NO, BRANCH TO CONTROL CHARS   S99245 27154802
RESETACK EQU   *                                                 S99245 27155202
         MVI   IOBRCVPT,X'00'           RESET RCV ACK POINTER    A32466 27156020
         MVI   IOBSNDPT,X'00'           RESET SEND ACK POINTER   A32466 27158020
         B     CNTCHARS                 BRANCH                     000B 27160014
SPECCHAR LR    AREAREG,CCWTBLRG         LOAD BASE ADDRESS OF CONSTANTS  27200013
         A     AREAREG,0(CCWREG)       POINT TO SPECIAL CHARS   YA01260 27202002
         LA    AREAREG,0(AREAREG)      CLEAR HIGH ORDER BYTE    YA01260 27204002
         SR    ICREG,ICREG             CLEAR WORKING REG        YA01260 27206002
         IC    ICREG,DCBEIOBX          GET IOB SIZE             YA01260 27210002
         LR    ICSREG,IOBREG           ADR OF IOB               YA01260 27212002
         AR    ICSREG,ICREG            POINT TO END OF IOB      YA01260 27214002
*        15    LINES OF CODE DELETED BY APAR -------------->   @ZA11036 27225500
         LA    ICREG,L24               POINT TO IOB AREA FOR            27226500
         SR    ONEREG,ONEREG           CLEAR WORK REG                   27227500
         SR    ICSREG,ICREG            START STOP SPEC CHARS    YA01260 27229702
         IC    ONEREG,L23(ICSREG)       PICK UP TOTAL CNT       YA01260 27234003
         SR    ICREG,ICREG             CLEAR WORK REG           YA01260 27238302
         IC    ICREG,7(CCWREG)         # SPEC CHARS THIS CCW    YA01260 27242602
         AR    ICSREG,ONEREG           UPDATE POINTER           YA01260 27246902
         BCTR  ICREG,0                 DECREMENT FOR EXECUTE    YA01260 27251202
         EX    ICREG,MOVER                                      YA01260 27255502
         B     AROUND                                           YA01260 27259802
MOVER    MVC   0(0,ICSREG),0(AREAREG)  MOVE SPEC CHARS FROM     YA01260 27264102
*                                      I/O DEVICE TO IOB        YA01260 27268402
AROUND   AR    ICREG,ONEREG            GET NEW TOTAL OF CHARS   YA01260 27272702
         LA    ICREG,1(ICREG)          ADD ONE FROM EX DECR.    YA01260 27277002
         LR    AREAREG,ICSREG          PT TO IOB AREA OF CHARS  YA01260 27281302
         SR    ICSREG,ONEREG           PT BACK TO BEGIN OF AREA YA01260 27285602
         STC   ICREG,L23(ICSREG)        INSERT NEW TOTAL        YA01260 27289903
         L     ONEREG,0(CCWREG)        PICK UP                  YA01260 27294202
         N     ONEREG,OPCODE           ONLY OP CODE             YA01260 27298502
         AR    AREAREG,ONEREG          OP CODE + DATA ADR       YA01260 27302802
         LA    ONEREG,1                SET BACK TO ONE          YA01260 27307102
         B     CNTWTTA1                CONTINUE                 YA01260 27311402
CNTCHARS LA    AREAREG,0(AREAREG)      CLEAR HIGH ORDER BYTE     A28611 27315702
         A     AREAREG,0(CCWREG)       ADD CMND CODE AND OFFSET  A28611 27320019
CNTWTTA1 ST    AREAREG,0(CCWREG)        STORE IN CCW             A25043 27400002
         B     TESTLAST                                                 27500013
WRITTONE EQU   *                                                   000L 27502019
         CLI   DECTYPE+1,RCONTONE       IS THIS A READ TCW         000L 27504019
         BE    BSCGRAPH                                            000L 27506019
         IC    ICREG,1(AREAREG)         COUNT OF RIDSEQ CHARACTERS      27508019
         SLL   ICREG,1                  MULTIPLY BY TWO            000H 27512018
         LA    AREAREG,2(ICREG,AREAREG) ADD TO LIST ADDRESS        000H 27518018
         IC    ICREG,0(AREAREG)         COUNT OF TIDSEQ CHARACTERS 000H 27524018
         LA    AREAREG,1(ICREG,AREAREG) ADD TO LIST ADDRESS        000H 27530018
         MVC   6(2,CCWREG),0(AREAREG)   MOVE 'TONE' COUNT TO CCW   000H 27536018
         MVC   1(3,CCWREG),2(AREAREG)   MOVE 'TONE' ADDRESS TO CCW 000H 27542018
         B     TESTLAST                                            000H 27548018
         SPACE 3                                                        27554018
BSCDIAL  TM    0(AREAREG),ANSLST                                   000H 27560018
         BNZ   LIST                                                000H 27566018
         TM    DECTYPE,ONLTST                                      000H 27572018
         BO    MOVEIN                                              000H 27578018
         MVC   IOBWORK+1(1),DECTYPE+1  MOVE DECTYPE TO WORK      A26887 27584019
         NI    IOBWORK+1,MASKALL-ANDOFF AND OFF UNUSED BIT       A26887 27590019
         CLI   IOBWORK+1,X'0C'          THIS WRITE TIE           A32468 27592020
         BE    INVALID                  YES, BRANCH              A32468 27594020
         XI    IOBWORK+1,WRTMASK       IS OPERATION WRITE INIT   A26887 27596019
         TM    IOBWORK+1,MASKBITS      IF NOT ANSLST IS VALID    A26887 27602019
         BM    MOVEIN                  SO MOVE IN ENABLE         A26887 27608019
         B     INVALID                                             000H 27614018
MOVEIN   EQU   *                                                   000H 27620018
         MVC   0(8,CCWREG),ENABLCCW     MOVE IN ENABLE CCW         000B 27630014
         OI    4(CCWREG),CCFLAG         SET ON COMMAND CHAIN       000B 27640014
         TM    DECTYPE,ONLTST          IS THIS ON-LINE-TEST        000H 27643018
         BO    TESTLAST                 YES, GO FINIST CHANNEL PGM 000H 27646018
         TM    0(AREAREG),WTLIST        IS ENTRY A WORLD TRADE LIST000H 27649018
         BZ    ANSWER                   NO, REGULAR ANSWER LIST    000H 27652018
         CLI   DECTYPE+1,X'02'         IS THIS A WRITE INITIAL   A29563 27653019
         BE    TESTLAST                IF SO, FINISH CHAN PROG   A29563 27654019
         LA    ZEROREG,11(ZEROREG)      YES, SKIP UNUSED CCWS      000H 27655018
         B     UPDATE                                              000H 27658018
ANSWER   LA    ZEROREG,7(ZEROREG)       SKIP UNUSED CCWS           000H 27661018
UPDATE   IC    TOTREG,0(ZEROREG,CHPRGREG) UPDATE CCW COUNT         000H 27664018
         B     TESTLAST                                            000B 27664803
LIST     EQU   *                   DIAL CCW                     YA01029 27665603
         CLI   DECTYPE+1,WINIT     WRITE TI?                    YA01029 27666403
         BNE   LIST1               NO, DO NORMAL DIAL           YA01029 27667203
         TM    DECCMCOD,XF0        IS THIS A SWLST ?           @ZA11032 27667400
         BO    TESTLNG             GO PROCESS LIST             @ZA11032 27667600
         CLI   1(AREAREG),FE       ANSWER LIST?                 YA01029 27674002
         BNE   LIST1               NO, DO NORMAL DIAL           YA01029 27675002
         SR    ICSREG,ICSREG       CLEAR                        YA01029 27676002
         IC    ICSREG,DCBDEVTP     DISPLACE TO IOD              YA01029 27677002
         SLL   ICSREG,2            MAKE IT WORDS                YA01029 27678002
         LA    ICSREG,IOD(ICSREG)  DISPLACE INTO IOD            YA01029 27679002
         CLI   0(ICSREG),MXTYPE    2740 WITH RC AND DIAL?       YA01029 27680002
         BNE   LIST1               NO, DO NORMAL DIAL           YA01029 27681002
         MVI   0(CCWREG),ENABLE    SET DIAL OP TO ENABLE        YA01029 27682002
         MVI   3(CCWREG),OHH       CLEAR DATA ADR               YA01029 27683002
         MVI   7(CCWREG),ONE       SET LENGTH TO ONE            YA01029 27684002
         B     TESTLNG             GO PROCESS LIST              YA01029 27685002
LIST1    EQU   *                                                YA01029 27686002
         MVC   7(1,CCWREG),0(AREAREG)   MOVE DIAL COUNT TO COUNT FIELD  27700002
         A     AREAREG,0(CCWREG)        ADD COMMAND AND ADRS OFFSET     27800013
         ST    AREAREG,0(CCWREG)                                        27900013
         B     TESTLNG                                                  28000013
         SPACE 2                                                        28010018
FRAMECH  MVC   3(1,CCWREG),0(AREAREG)   MOVE DIAL COUNT FOR ADD    000K 28020018
         LA    AREAREG,1(AREAREG)       BUMP POINTER PAST DIAL CT  000K 28030018
         B     CNTCHARS                 GO BUMP DATA ADDRESS       000K 28040018
*                                        PAST DIAL CHARS TO POINT  000K 28050018
*                                        TO FRAME CHANGE CHARS     000K 28060018
         EJECT                                                          28100013
PA1050D  IC    ICREG,0(AREAREG)         INSERT COUNT OF DIAL CHARACTERS 28200013
         LA    AREAREG,1(ICREG,AREAREG) ADD TO ADRS FOR POLL/ADRS CHAR  28300013
         B     LODCNT                                                   28400013
         SPACE 3                                                        28500013
PALIST   TM    DECTYPE,X'04'            TEST FOR 'S' OPERAND            28600013
         BZ    LODCNT                   IF NOT, BRANCH                  28700013
         IC    ICREG,2(CCWREG)          LOAD POLL OR ADRS OFFSET        28800013
         C     BRREG,DECADRPT(ICREG)    IS PTR ZERO (1ST TIME ONLY)     28900013
         BE    LODCNT                   IF SO, BRANCH                   29000013
         L     AREAREG,DECADRPT(ICREG)  LOAD POLL/ADRS ADDRESS          29100013
LODCNT   CLI   7(CCWREG),X'00'          IS CCW COUNT ZERO          000F 29110017
         BE    CONTINUE                 IF SO, BRANCH              000F 29120017
         IC    ICREG,7(CCWREG)          GET COUNT OF ADDRESS CHARS 000F 29130017
         AR    AREAREG,ICREG            ADD TO TERMINAL ADDRESS    000F 29140017
         B     SETSNS                                              000F 29150017
CONTINUE LA    ICREG,1                  SET COUNT TO ONE           000F 29160017
         LA    ICSREG,8                 SET MAX COUNT TO EIGHT     000F 29170017
LOOP     CLC   0(1,AREAREG),DCBBSENQ    IS THIS CHAR INQUIRY       000F 29180017
         BE    FOUND                   IF SO, BRANCH               000F 29190017
         LA    ICREG,1(ICREG)           STEP COUNT BY ONE          000F 29200017
         LA    AREAREG,1(AREAREG)       STEP ADDRESS BY ONE        000F 29210017
         BCT   ICSREG,LOOP              MAXIMUM CHARACTERS CHECKED 000F 29220017
         B     INVALADR                IF SO, BAD TERM LIST        000F 29230017
FOUND    STC   ICREG,7(CCWREG)          STORE COUNT IN CCW         000F 29240017
         LA    AREAREG,1(AREAREG)       ADD ONE TO ADDRESS         000F 29250017
SETSNS   MVI   IOBSENS0,X'00'                                      000F 29260017
TESTSKIP TM    0(AREAREG),X'40'         TEST SKIP BIT                   29400013
         BZ    PAOK                     NOT SKIP                        29500013
         TM    0(AREAREG),X'80'         TEST END OF LIST BIT            29600013
         BO    ALLSKIP                  END OF LIST                     29700013
         TM    0(AREAREG),X'20'         TEST FORMAT BIT                 29800013
         BZ    PASTEP                   NOT ON                          29900013
         CLI   IOBSENS0,X'00'           IS THIS 2ND TIME THRU LIST 2064 30000014
         BNE   ALLSKIP                  IF SO, BRANCH              2064 30100014
         MVC   IOBSENS0(2),1(AREAREG)   MOVE DECREMENT OF LIST COUNT    30200013
         AH    AREAREG,IOBSENS0         RESET ADDRESS TO START OF LIST  30300013
PASTEP   LA    AREAREG,1(ICREG,AREAREG) STEP TO NEXT CONTROL BYTE       30400013
         B     TESTSKIP                                                 30500013
PAOK     IC    ICREG,2(CCWREG)          LOAD POLL-ADRS OFFSET           30600013
         MVI   2(CCWREG),X'00'          ZERO OFFSET                     30700013
         LR    BRREG,AREAREG            SAVE ADRS OF CONTROL BYTE       30800013
         SH    AREAREG,6(CCWREG)        SUBTRACT TO GET ADRS OF P/A CHR 30900013
         A     AREAREG,0(CCWREG)        ADD AREA INCREMENT & CCW COMMND 31000013
         ST    AREAREG,0(CCWREG)        PLACE RESULT IN CCW             31100013
         LA    AREAREG,0(AREAREG)       ZERO OUT COMMAND CODE           31200013
         ST    AREAREG,DECADRPT(ICREG)  UPDATE CURRENT POLL/ADRS PTR    31300013
         B     TESTLAST                                                 31400013
SWIDREC  EQU   *                                                   000L 31404019
         MVC   7(1,CCWREG),6(AREAREG)   MOVE IN COUNT              000L 31408019
         LA    AREAREG,8(AREAREG)       GET ADDRESS OF READ-IN-AREA000L 31412019
         A     AREAREG,0(CCWREG)        ADD COMMAND AND OFFSET     000L 31416019
         ST    AREAREG,0(CCWREG)        STORE IN CCW               000L 31420019
         B     TESTLAST                                            000L 31424019
SWIDSENT EQU   *                                                   000L 31428019
         SR    ICSREG,ICSREG            CLEAR WORK REGISTER        000L 31432019
         IC    ICSREG,6(AREAREG)        GET READ-IN-AREA LENGTH    000L 31436019
         IC    ICREG,7(AREAREG)         GET DIAL COUNT             000L 31440019
         AR    ICREG,ICSREG                                        000L 31444019
         LA    AREAREG,8(AREAREG)                                  000L 31448019
         AR    AREAREG,ICREG            POINT TO ID COUNT          000L 31452019
MVCOUNT  EQU   *                                                        31456019
         MVC   7(1,CCWREG),0(AREAREG)   MOVE COUNT TO CCW               31460019
         LA    AREAREG,1(AREAREG)       POINT TO IDSENT            000L 31464019
         A     AREAREG,0(CCWREG)        ADD TO COMMAND             000L 31468019
         ST    AREAREG,0(CCWREG)        STORE IN CCW               000L 31472019
         B     TESTLAST                                            000L 31476019
SWLSTTIC EQU   *                                                   000L 31480019
         LA    AREAREG,IOBCPA           POINT TO ENABLE CCW        000L 31484019
         A     AREAREG,0(CCWREG)        ADD TO COMMAND             000L 31488019
         ST    AREAREG,0(CCWREG)        STORE IN CCW               000L 31492019
         B     TESTLAST                                            000L 31496019
         EJECT                                                          31500013
*                                                                  000A 31600013
AUTOPOLL DS    0H                                                  000A 31700013
         OI    DECTYPE,AP                                          000A 31800013
         MVI   IOBSNDPT,X'00'           INITIALIZE SEND ACK PTR    000B 31850014
         MVI   IOBRCVPT,X'02'    INITIALIZE RECEIVE ACK PTR             31860002
*                             TEST FOR 'S' OPERAND.                000A 31900013
STEST    TM    DECTYPE,X'04'                                       000A 32000013
         BZ    AP1COMP                                             000A 32100013
*                             'S' OPERAND - IS PTR=0 -1ST TIME ONLY000A 32200013
         C     BRREG,DECPOLPT                                      000A 32300013
         BE    AP1COMP                                             000A 32400013
*                             USE LAST INDEX/ADDRESS               000A 32500013
         L     AREAREG,DECPOLPT                                    000A 32600013
         SH    AREAREG,HDRLN                                       000A 32700013
         MVC   INDEX(1),DECPOLPT                                   000A 32800013
         B     AP1ONLT                                             000D 32900016
*                                                                  000A 33000013
*                             SCAN FOR SCAN STOP BYTE (FE)         000A 33100013
AP1STEP  AR    AREAREG,ONEREG                                      000A 33200013
AP1COMP  CLI   0(AREAREG),FE                                       000A 33300013
         BNE   AP1STEP                                             000A 33400013
*                                                                  000A 33500013
*                             POINT TO HEAD OF LIST                000A 33600013
         MVC   OFFSET(2),1(AREAREG)                                000A 33700013
         SH    AREAREG,OFFSET                                      000A 33800013
         AR    AREAREG,ONEREG                                      000A 33900013
*                                                                  000A 34000013
*                             GET INDEX BYTE                       000A 34100013
         IC    ICREG,2(AREAREG)                                    000A 34200013
         SRL   ICREG,5                                             000A 34300013
         CR    ICREG,ONEREG        IF POLLING LIST ENTRY IS     YA01016 34320002
         BH    *+8                 0 OR 1, THE TRUE LENGTHS ARE YA01016 34340002
         LA    ICREG,8(ICREG)      8 OR 9 RESPECTIVELY          YA01016 34360002
         L     ICSREG,DECENTRY                                     000A 34400013
         AR    ICSREG,ICREG                                        000A 34500013
         SR    ICSREG,ONEREG                                       000A 34600013
         MVC   INDEX(1),0(ICSREG)                                  000A 34700013
*                                                                  000A 34800013
AP1ONLT  EQU   *                                                   000D 34900016
*                             TEST FOR ON LINE TERM TEST RE-START  000D 35000016
         TM    IOBINCAM,ONLT                                       000D 35100016
         BO    FAEAD                                               000D 35200016
*                             TEST FOR ERP                         000A 35400013
         TM    IOBFLAG1,ERP                                        000A 35500013
         BO    FAEAD                                               000A 35600013
*                             CHECK HEADER                         000D 35610016
AP1HDRC  CLI   1(AREAREG),0                                        000D 35620016
         BE    ALLSKIP                                             000D 35630016
         CLI   7(CCWREG),X'00'         IS THIS START STOP?       A41109 35631002
         BE    AP1USECK                YES, PROCEED              A41109 35632002
         CLI   1(AREAREG),1            ONE ENTRY                 A26909 35633019
         BNE   AP1USECK                NO, CHECK USAGE COUNT     A26909 35636019
         CLC   3(1,AREAREG),DCBBSEOT   IS ENTRY EOT              A26909 35639019
         BE    ALLSKIP                 YES, TURN ON SKIP BIT     A26909 35642019
AP1USECK TM    2(AREAREG),X'0F'        FULL USAGE                A26909 35645019
         BO    FULLUSE                                             000D 35650016
*                             INCREMENT USER COUNT                 000A 35700013
         IC    ICREG,2(AREAREG)                                    000A 35800013
         AR    ICREG,ONEREG                                        000A 35900013
         STC   ICREG,2(AREAREG)                                    000A 36000013
*                                                                  000A 36100013
*                             SAVE 1ST ENTRY ADDRESS               000A 36200013
FAEAD    XC    DECPOLPT+1(3),DECPOLPT+1                            000A 36300013
         LA    ICSREG,HDR(AREAREG)                                 000A 36400013
         O     ICSREG,DECPOLPT                                     000A 36500013
         ST    ICSREG,DECPOLPT                                     000A 36600013
*                                                                  000A 36700013
*                             MOVE IN TIC COMMAND                  000A 36800013
         MVC   8(8,CCWREG),APTIC                                   000A 36900013
         LA    ICSREG,24(CCWREG)                                   000A 37000013
         O     ICSREG,8(CCWREG)                                    000A 37100013
         ST    ICSREG,8(CCWREG)                                    000A 37200013
*                             TEST FOR WRAP BIT                    000A 37300013
         TM    2(AREAREG),X'10'                                    000A 37400013
         BZ    APOPEN                                              000A 37500013
*                             MOVE IN TIC COMMAND                  000A 37600013
         MVC   16(4,CCWREG),APTIC                                  000A 37700013
         ST    BRREG,20(CCWREG)                                    000A 37800013
         LA    ICSREG,40(CCWREG)                                   000A 37900013
         O     ICSREG,16(CCWREG)                                   000A 38000013
         ST    ICSREG,16(CCWREG)                                   000A 38100013
         MVC   24(16,CCWREG),0(CCWREG)                             000A 38200013
         MVC   25(3,CCWREG),DECPOLPT+1                             000A 38300013
*        ONE LINE DELETED BY FOLLOWING PTM                       YM4072 38350002
         B     AP1SCAN                                             000A 38400013
*                             OPEN LIST - CHANGE TIC TO I/O NOP    000A 38500013
APOPEN   MVI   8(CCWREG),NOOP                                      000A 38600013
*                                                                  000A 38700013
*                                                                  000A 38800013
*                             SCAN FOR INDEX BYTE                  000A 38900013
AP1SCAN  SR    ICSREG,ICSREG                                       000A 39000013
         IC    ICSREG,1(AREAREG)                                   000A 39100013
         STC   ICSREG,AE                                           000A 39200013
         IC    ICREG,2(AREAREG)                                    000A 39300013
         SRL   ICREG,5                                             000A 39400013
         CR    ICREG,ONEREG        IF POLLING LIST ENTRY IS     YA01016 39420002
         BH    AP2STEP             0 OR 1, THE TRUE LENGTHS ARE YA01016 39440002
         LA    ICREG,8(ICREG)      8 OR 9 RESPECTIVELY          YA01016 39460002
AP2STEP  AR    AREAREG,ICREG                                       000A 39500013
         TM    DISP2(AREAREG),FORTY                             YA03268 39550000
         BO    AP3CONT                                          YA03268 39560000
         CLC   2(1,AREAREG),INDEX                                  000A 39600013
         BNL   AP3CONT                                             000A 39700013
         BCT   ICSREG,AP2STEP                                      000A 39800013
         L     AREAREG,DECPOLPT                                    000A 39900013
         LA    AREAREG,0(AREAREG)  ZERO HIGH ORDER BYTE          A43772 39920002
         B     AP3ACONT                                          A33975 39950020
*                                                                  000A 40000013
*                             PUT STARTING ADDRESS INTO POLL       000A 40100013
AP3CONT  SR    AREAREG,ICREG                                       000A 40200013
         LA    AREAREG,HDR(AREAREG)                                000A 40300013
AP3ACONT EQU   *                                                 A33975 40350020
         O     AREAREG,0(CCWREG)                                   000A 40400013
         ST    AREAREG,0(CCWREG)                                   000A 40500013
*                             FIND TOTAL LENGTH                    000A 40600013
*                                       TEST FOR SINGLE ENTRY           40610016
*                                            (FOR RJE  REMOVE REL 18)   40620016
         CLI   AE,1                                                     40630016
         BNE   APTLEN                                                   40640016
         XC    6(2,CCWREG),6(CCWREG)                                    40650016
APTLEN   EQU   *                                                        40660016
         CLI   7(CCWREG),X'00'         IS THIS START STOP          000J 40665018
         BE    AP1EOT                   YES  PROCEED               000J 40670018
         SR    ICREG,ONEREG             DECREMENT TO GET LAST      000J 40675018
         STH   ICREG,6(CCWREG)         >AVE IN CCW                 000J 40680018
         AR    ICREG,ONEREG            GET BACK AS WAS             000J 40685018
AP1EOT   EQU   *                                                   000J 40690018
         IC    ICSREG,AE                                           000A 40700013
         MR    ICSREG,ICSREG                                       000A 40800013
         SH    ICREG,6(CCWREG)                                          40850016
         STH   ICREG,30(CCWREG)                                    000A 40900013
*                             FIND LENGTH FOR FIRST POLL           000A 41000013
         SR    ICREG,AREAREG                                       000A 41100013
         L     ICSREG,DECPOLPT      LOAD POLLING POINTER       @ZA07658 41130003
         LA    ICSREG,ZERO(ICSREG)   CLEAR HI BYTE             @ZA07658 41160003
         AR    ICREG,ICSREG                                    @ZA07658 41200003
         STH   ICREG,6(CCWREG)                                     000A 41300013
         SR    ICREG,ICREG                                         000A 41400013
*                                                                  000A 41500013
*                             INCREMENT CCWREG FOR NEXT OPERATION  000A 41600013
         LA    CCWREG,8(CCWREG)                                    000A 41700013
         LR    AREAREG,ICSREG                                  @ZA07658 41800003
         SH    AREAREG,HDRLN                                       000A 41900013
         TM    2(AREAREG),X'10'                                    000A 42000013
         BZ    AP2OPEN                                             000A 42100013
         LA    CCWREG,24(CCWREG)                                   000A 42200013
AP2OPEN  EQU   *                                                   000A 42300013
*                             CLEAR WORKAREA                       000A 42400013
         XC    INDEX(4),INDEX                                      000A 42500013
         B     TESTLAST                                            000A 42600013
*                                                                  000A 42700013
*                             CONSTANTS AND SYMBOLS                000A 42800013
FE       EQU   X'FE'                                               000A 42900013
HDR      EQU   3                                                   000A 43000013
NOOP     EQU   X'03'                                               000A 43100013
ONLT     EQU   X'01'                                               000D 43150016
AP       EQU   X'80'                                               000A 43200013
PCI      EQU   X'08'                                                    43250002
HDRLN    DC    H'3'                                                000A 43300013
APTIC    DC    X'0800000020090001'                                 000A 43400013
         DS    0F                                                       43450003
         EJECT                                                          43500013
BSCIDENT EQU   *                                               @ZA04152 43502003
         TM    DECCMCOD,XF0             IS THIS SWITCHLIST     @ZA11032 43502600
         BO    BIDENT                   YES                    @ZA11032 43503200
         IC    ICREG,ZERO(AREAREG) INSERT COUNT OF DIAL CHARS  @ZA04152 43504000
         N     ICREG,DIALMASK                                      000H 43504200
         LA    AREAREG,1(ICREG,AREAREG) ADD TO LIST ADDRESS        000B 43504400
         CLI   0(AREAREG),FE            IS THIS THE END OF THE LIST000J 43504600
         BNE   IDENT1                                              000J 43504800
         SH    CCWREG,EIGHT             POINT TO THE PREVIOUS CCW  000J 43505000
         CLI   0(CCWREG),DIAL           WAS LAST COMMAND DIAL      000J 43505200
         BNE   ANSER                                               000J 43505400
         AH    CCWREG,EIGHT             POINT TO THE PRESENT CCW   000J 43505600
         MVI   7(CCWREG),ONE            PUT COUNT OF 1 IN CCW      000J 43505800
         LR    AREAREG,DCBREG           LOAD ADDRESS OF DCB        000J 43506000
         MVI   3(CCWREG),FORTY4         SET DCB OFFSET             000J 43506200
         B     CNTCHARS                                            000J 43506400
BIDENT   SR    ICSREG,ICSREG            CLEAR REGISTER         @ZA11038 43506600
         SR    ICREG,ICREG              CLEAR REGISTER         @ZA11038 43506800
         IC    ICSREG,L6(AREAREG)  GET READ IN AREA LENGTH     @ZA11038 43507000
         IC    ICREG,L7(AREAREG)     GET DIAL COUNT            @ZA11038 43507200
         AR    ICSREG,ICREG      READ AREA LNG + DIAL CNT      @ZA11038 43507400
         AR    AREAREG,ICSREG RD AREA LNG + DIAL CNT +LIST ADR @ZA11038 43507600
         LA    AREAREG,L8(AREAREG)   GET ID COUNT-SWLST        @ZA11038 43507800
         MVC   L7(L1,CCWREG),L0(AREAREG)  MOVE ID COUNT TO CCW @ZA11038 43508000
         LA    AREAREG,L1(AREAREG)      POINT TO ID SENT       @ZA11038 43508200
         L     ICSREG,L0(CCWREG)        LOAD CMD CODE          @ZA11038 43508400
         N     ICSREG,OPCODE            ZERO ADDR AREA         @ZA11038 43508600
         AR    AREAREG,ICSREG           ADD ADDRESS            @ZA11038 43508800
         ST    AREAREG,DISP0(CCWREG)                           @ZA04152 43509200
         B     TESTLAST                                        @ZA04152 43509400
ANSER    AH    CCWREG,EIGHT             POINT TO THE PRESENT CCW   000J 43526003
         MVI   5(CCWREG),TP08           MOVE IN TP OP CODE         000J 43526518
         MVI   7(CCWREG),TWO            PUT COUNT OF 2 IN CCW      000J 43527018
         LR    AREAREG,DCBREG           LOAD ADDRESS OF DCB        000J 43527518
         MVI   3(CCWREG),FORTY          SET DCB OFFSET             000J 43528018
         B     CNTCHARS                                            000J 43528518
IDENT1   EQU   *                                                   000J 43529018
         IC    ICREG,0(AREAREG)         INSERT COUNT OF ID CHARS   000B 43530014
         SLL   ICREG,1                  MULTIPLY BY TWO            000B 43540014
         LA    AREAREG,1(ICREG,AREAREG) ADD TO ADDRESS             000B 43550014
         B     CNTINID                                             000B 43560014
TWXIDENT EQU   *                                               @ZA04152 43562000
         TM    DECCMCOD,XF0             IS THIS SWITCHLIST     @ZA11032 43564000
         BO    TIDENT                   YES, UPDATE CCW        @ZA11032 43566000
         IC    ICREG,ZERO(AREAREG)  INSERT CNT OF DIAL CHARS   @ZA04152 43600003
         N     ICREG,DIALMASK                                      000H 43650018
         LA    AREAREG,1(ICREG,AREAREG) ADD TO LIST ADRS                43700013
         CLI   0(AREAREG),FE            IS THIS THE END OF THE LIST000J 43705018
         BNE   CNTINID                                             000J 43710018
         SH    CCWREG,EIGHT             POINT TO PREVIOUS CCW      000J 43715018
         CLI   0(CCWREG),ENABLE         WAS IT AN ENABLE COMMAND   000J 43720018
         BNE   CALL                                                000J 43725018
         AH    CCWREG,EIGHT             POINT TO PRESENT CCW       000J 43730018
         MVI   5(CCWREG),TP0B            MOVE IN TP OP CODE        000J 43735018
         B     LDRESPN                                             000J 43740018
TIDENT   LA    AREAREG,SIX(AREAREG)   ADDR OF READ IN COUNT    @ZA04152 43740703
         MVC   C7(ONE,CCWREG),ZERO(AREAREG) MOVE IN COUNT      @ZA04152 43741403
         LA    AREAREG,ONE(AREAREG)     BUMP TO READ IN AREA   @ZA11038 43742100
         A     AREAREG,ZERO(CCWREG)   ADD CMD CODE AND OFFSET  @ZA04152 43742803
         ST    AREAREG,ZERO(CCWREG)    STORE IN CCW            @ZA04152 43743503
         B     TESTLAST                 GO CHECK NEXT CCW      @ZA04152 43744203
CALL     EQU   *                                                   000J 43745018
         AH   CCWREG,EIGHT              POINT TO PRESENT CCW       000J 43750018
         MVI   5(CCWREG),TP0C           MOVE IN TP OP CODE         000J 43755018
LDRESPN  EQU   *                                                   000J 43760018
         MVI   7(CCWREG),TWO            PUT A COUNT OF 2 IN CCW    000J 43765018
         LA    AREAREG,DECRESPN         LOAD RESPONSE AREA ADDRESS 000J 43770018
         MVI   3(CCWREG),ZERO           ZERO OUT DCB OFFSET        000J 43775018
         A     AREAREG,0(CCWREG)        ADD CCW COMMAND            000J 43780018
         ST    AREAREG,0(CCWREG)        STORE IN CCW               000J 43785018
         B     TESTLAST                                            000J 43790018
CNTINID  MVC   7(1,CCWREG),0(AREAREG)   MOVE COUNT OF ID TO CCW    000B 43800014
CNTWTTA2 A     AREAREG,0(CCWREG)        ADD COMMAND AND OFFSET   A25043 43900002
         ST    AREAREG,0(CCWREG)        STORE IN CCW                    44000013
         B     TESTLAST                                                 44100013
         SPACE 3                                                        44200013
DISABLE  CLI   0(AREAREG),X'00'         IS LIST AN ANSWER LIST          44300013
         BNE   TESTLAST                 NO,O.K. TO SET UP DIAL CCW      44400013
         BXH   ZEROREG,ONEREG,0(RETREG) YES, STEP CNTR OMITTING DIAL    44500013
         LA    CCWREG,8(CCWREG)         STEP CCW REGISTER               44600013
         MVC   0(8,CCWREG),ENABLCCW     USE ENABLE CCWVS. DIAL          44700013
         B     TESTLAST                                                 44800013
         SPACE 3                                                        44900013
BSCGRAPH L     ICSREG,DECWAREA          LOAD ADDRESS I/O AREA      000B 44910014
         L     AREAREG,0(CCWREG)        LOAD CMND CODE AND OFFSET  000B 44920014
         AR    AREAREG,ICSREG           ADD AREA ADDRESS           000B 44930014
         ST    AREAREG,0(CCWREG)        STORE IN CCW               000B 44940014
         CLI   DECTYPE+1,RCONTONE       IS THIS A READ TCW         000L 44943019
         BE    BSCWLNG                                             000L 44946019
         B     TESTLNG                                             000B 44950014
         SPACE 3                                                        44960014
*                                       LENGTH ROUTINES                 45000013
         SPACE 2                                                        45100013
BSCWLNG  NI    6(CCWREG),ZERO           ZERO SUBROUTINE INDEX      000B 45120014
         LH    AREAREG,DECWLNG          LOAD WLENGTH FROM DECB     000B 45140014
         B     CNTNLNG                                             000B 45160014
DATALNG NI     6(CCWREG),X'00'          ZERO SUB-ROUTINE INDEX          45200013
         CLI   L7(CCWREG),XFF     2740 READ REPEAT AUTO POLL   @ZA10035 45210000
         BNE   DATALNG1            BRANCH NO                   @ZA10035 45220000
         MVI   L7(CCWREG),X00    CLEAR FF IN REPEAT CCW        @ZA10035 45230000
         CLI   IOBWORK+L1,X01      LAST OPERATION RD TI        @ZA10035 45240000
         BNE   DATALNG1            BRANCH NO                   @ZA10035 45250000
         MVI   L7(CCWREG),X01  PREPARE TO DECREASE CNT BY ONE  @ZA10035 45260000
DATALNG1 LH    AREAREG,DECLNGTH         LOAD LENGTH FROM DECB  @ZA10035 45270000
CNTNLNG  SH    AREAREG,6(CCWREG)        SUBTRACT OFFSET            000B 45400014
CNTWTTA3 STH   AREAREG,6(CCWREG)        STORE IN CCW             A25043 45500002
         B     TESTLAST                                                 45600013
CONVLENG MVI   6(CCWREG),X'00'          CLEAR OUT OFFSET                45610018
         LH    ICSREG,DECLNGTH          GET USER'S LENGTH AND COUNT     45620018
         CLI   DECTYPE+1,X'16'          THIS WRITE ENQ           A38557 45622020
         BNE   CNVLENG1                 NO, BRANCH               A38557 45624020
         TM    DECTYPE,X'08'            DECAREA/LENGTH SPECIFIED A38557 45626020
         BO    CNVLENG1                 YES, BRANCH              A38557 45628020
         MVI   7(CCWREG),X'02'          SET LENGTH TO TWO        A38557 45630020
         B     CNVLENG2                 BRANCH TO SET LAST CCW   A38557 45632020
CNVLENG1 EQU   *                                                 A38557 45634020
         CH    ICSREG,LENG20            IS USER'S LENGTH MORE THAN 20   45637018
         BH    TESTLAST                 YES, GO BUILD NEXT CCW          45640018
         STH   ICSREG,6(CCWREG)              STORE IN CCW               45650018
CNVLENG2 EQU   *                                                 A32454 45655020
         OI    5(CCWREG),X'80'          TURN ON LAST CCW BIT            45660018
         NI    4(CCWREG),X'3F'          TURN OFF CHAIN BIT              45670018
         B     0(RETREG)                GET OUT                         45680018
*                                       DYNAMIC BUFFERING ROUTINE       45690018
         EJECT                                                          45700013
*                                  ACTIONS BASED ON RETURN FROM         45701002
*                                        IECTRDTI                       45702002
BADCB    EQU   *                   X'08' - INVALID CONTROL BLOCK        45703002
         MVI   SAVE15(SAVEREG),INVALCB  SET INVALID UCB CODE            45704002
         B     RESTREG             RESET AND RETURN TO USER             45705002
NOATTN   EQU   *                   X'04' - NO OUTSTANDING ATTN FOUND    45706002
         L     IOBREG,DCBIOBAD     LOAD INITIAL IOB BASE                45707002
         SR    ICREG,ICREG         CLEAR LOOP REG                       45708002
         IC    ICREG,DEBNMEXT      INSERT # OF RLN'S (LOOP COUNT)       45709002
         SR    ICSREG,ICSREG       CLEAR INCREMENT REG                  45710002
         IC    ICSREG,DCBEIOBX     INSERT SIZE OF IOB                   45711002
ATTNON   LA    IOBREG,0(ICSREG,IOBREG) POINT TO EACH IOB                45712002
         OI    IOBINCAM,BUSY       TURN ON BUSY BIT                     45713002
         NI    IOBFLAG2,XFE       TURN OFF RESETPL BIT      LD YA03952  45713400
         BCT   ICREG,ATTNON        LOOP UNTIL EVERY IOB BUSY BIT SET    45714002
         L     ICREG,DEBUCBAD      GET ADDRESS OF MSTR UCB      YA02057 45714402
         TM    GCB(ICREG),RDTI     IS READ TI ON?               YA02057 45714802
         BZ    BUSYOFF             NO, TURN OFF BUSY BITS       YA02057 45714902
RETURN   MVI   SAVE15(SAVEREG),GOODRTN  SET GOOD CODE           YA02057 45715002
         B     LOADM               EXIT                     LD @ZA02800 45716000
BUSYOFF  EQU   *                                                YA02057 45716402
         L     IOBREG,DCBIOBAD     GET DCB IOB ADDRESS          YA02057 45716802
         SR    ICREG,ICREG         CLEAR LOOP REG               YA02057 45716902
         IC    ICREG,DEBNMEXT      INSERT NUM OF RLNS           YA02057 45717802
BUSYLOOP LA    IOBREG,DISP0(ICSREG,IOBREG) POINT TO EACH IOB    YA02057 45719802
         NI    IOBINCAM,MASKALL-BUSY TURN OFF BUSY              YA02057 45720202
         BCT   ICREG,BUSYLOOP      LOOP                         YA02057 45720602
*                                  UNTIL ALL BITS ARE OFF       YA02057 45720702
         B     RETURN              SET RC=0 AND RETURN          YA02057 45720802
FINDATTN EQU   *                   X'00' - ATTENTION WAS FOUND          45721002
         L     DECBREG,IOBECBPT    GET ADDRESS OF DECB                  45721602
         SR    ICREG,ICREG         CLEAR RLN REG                        45722502
         IC    ICREG,DECRLN        GET RLN                              45723402
         BCTR  ICREG,REG0          DECR RLN BY ONE                      45724302
         SR    ICSREG,ICSREG       CLEAR REG                            45725202
         IC    ICSREG,DEBNMEXT     GET MAX # OF UCB'S TO CHECK          45726102
         SR    ICSREG,ICREG        ADJUST FOR STARTING POINT            45727002
*                                                                       45727902
         SLL   ICREG,2             CONVERT RLN TO DISP INTO UCB LIST    45728802
*                                   BY MULTIPLYING BY 4                 45729702
         LA    UCBPTREG,DEBUCBAD(ICREG) GET PTR TO STARTING LOC IN LIST 45730602
LPONE    L     UCBREG,0(UCBPTREG)  GET ADDRESS OF UCB                   45731502
         TM    GCB(UCBREG),ATTN    WAS ATTENTION RECEIVED               45732402
         BNO   LPONECHK            NO, CHECK OTHERS                     45733302
         TM    GCB(UCBREG),OLTEPSKP OLTEP EXECUTING OR SKIP FLAG SET    45734202
         BZ    ATNFND              NO, ATTENTION FOUND                  45735102
*                                                                       45736002
LPONECHK LA    UCBPTREG,NEXTNTRY(UCBPTREG) INCR TO NEXT ENTRY           45736902
*                                  IN UCB LIST                          45737802
         BCT   ICSREG,LPONE        BR IF MORE TO CHECK                  45738702
         LTR   ICREG,ICREG         IF 0, ENTIRE LIST WAS SEARCHED BY    45739602
         BZ    ALLSKIP              1ST LOOP AND NO ATTN FOUND          45740502
         SRL   ICREG,2             RESTORE TO RLN                       45741402
         LA    UCBPTREG,DEBUCBAD   GET START OF UCB LIST                45742302
LPTWO    L     UCBREG,0(UCBPTREG)  GET ADDRESS OF UCB                   45743202
         TM    GCB(UCBREG),ATTN    WAS ATTENTION RECEIVED               45744102
         BNO   LPTWOCHK            NO, CHECK OTHERS                     45745002
         TM    GCB(UCBREG),OLTEPSKP OLTEP EXECUTING OR SKIP FLAG SET    45745902
         BZ    ATNFND              NO, ATTENTION FOUND                  45746802
LPTWOCHK LA    UCBPTREG,NEXTNTRY(UCBPTREG) INCR TO NEXT UCB ADDR        45747702
         BCT   ICREG,LPTWO         BR IF MORE TO CHECK                  45748602
*                                                                       45749502
         B     ALLSKIP             GO SET ALL DEVICES SKIP CODE         45750402
*                                                                       45751302
ATNFND   XC    DECPOLPT(POLPTLNG),DECPOLPT CLEAR DECPOLPT               45752202
         MVC   DECPOLPT+3(RLNGTH),READRLN(UCBREG)   MOVE RLN OF         45753102
*                                  DVC FROM UCB TO DECB                 45754002
         SPACE 1                                                YA02128 45754102
*                           RESET ATTENTION AND UPDATE COUNT    YA02128 45754202
         LR    PARMREG1,UCBREG     SET FOR SVC                  YA02128 45754502
         SR    PARMREG0,PARMREG0   CLEAR REG 0                  YA02128 45754602
         LA    BRREG,ONE           ROUTE CODE FOR ATNR          YA02128 45756102
         SVC   BTAMSVC             TO IECTSVC                   YA02128 45758702
         B     BTBL5(BRREG)        CHK RET CODE             L5 @ZA03567 45760003
BTBL5    B     PREEXCP                 IF 0 DO EXCP         L5 @ZA03567 45762003
         B     INVALUCB                IF 4 BAD UCB         L5 @ZA03567 45764003
         B     FINDRDY                 IF 8 DEV RDY         L5 @ZA03567 45766003
PREEXCP  EQU   *                                            L5 @ZA03567 45768003
         SR    ICSREG,ICSREG       CLEAR REG                 LD YA03952 45769203
         IC    ICSREG,DCBEIOBX     GET LENGTH OF IOB         LD YA03952 45771203
         L     ICREG,DCBIOBAD      GET ORIGIN OF IOB         LD YA03952 45773203
         LA    ICREG,ZERO(ICREG,ICSREG) IOB FOR RLN 1        LD YA03952 45775203
         NI    IOBFLAG2-IECTIOB(ICREG),XFE TURN OFF RESETPL  LD YA03952 45777203
*                                  BIT IN RLN 1ST IOB        LD YA03952 45779203
         L     DECBREG,IOBECBPT    HET ADDR OF DECB                     45781203
         CLC   DECRLN(RLNGTH),DECPOLPT+3   RLN SPECD = THAT FOR         45783203
         BNE   CPYIOB              DVC TO BE READ, USE EXIST IOB        45785203
         B     EXCP                START I/O                            45787203
*                                                                       45789203
CPYIOB   EQU   *                                                        45791203
*        2 LINES DELETED                                     LD YA03952 45793203
*                                                                       45795203
         MH    ICSREG,DECPOLPT+2   MULTIPLY BY DECPOLPT                 45797203
         L     ICREG,DCBIOBAD      GET BASE FOR IOB POOL                45799203
         LA    ICREG,0(ICREG,ICSREG) ADD DISP TO GET ADDR OF IOB TO BE  45801203
*                                     INITIALIZED                       45803203
         MVC   ECBPT(ECBPTLNG,ICREG),IOBECBPT COPY PTR TO ECB           45805203
         MVC   CPAPT(CPALNG,ICREG),IOBCPA COPY CHANNEL PGM              45807203
         LA    ICSREG,CPAPT(ICREG) COMPUTE ADDR OF CPA                  45809203
         ST    ICSREG,STARTPT(ICREG) AND STORE IN START ADDR            45811203
         MVC   ZERO(TWO,ICREG),IOBFLAG1 COPY IOBFLAG1 AND 2  LD YA03952 45813203
         LR    IOBREG,ICREG        ADDR OF IOB TO BE USED TO IOB BASE   45815203
         OI    IOBINCAM,BUSY       TURN ON IOB BUSY FLAG                45817203
         B     EXCP                START I/O                            45819203
FINDRDY  EQU   *                   X'0C' - READY DEVICE FOUND   YA02128 45821203
         L     DECBREG,IOBECBPT    GET ADDRESS OF DECB          YA02128 45823203
         SR    ICREG,ICREG         CLEAR RLN REG                YA02128 45825203
         IC    ICREG,DECRLN        GET RLN                      YA02128 45827203
         BCTR  ICREG,REG0          REDUCE RLN BY ONE            YA02128 45829203
         SR    ICSREG,ICSREG       CLEAR INDEX REG              YA02128 45831203
         IC    ICSREG,DEBNMEXT     GET MAX NUM UCB'S            YA02128 45833202
         SR    ICSREG,ICREG        ADJUST FOR STARTING POINT    YA02128 45843202
         SLL   ICREG,DISP2         CONVERT RLN TO DISPLACEMENT  YA02128 45853202
*                                  INTO UCB LIST                YA02128 45863202
         LA    UCBPTREG,DEBUCBAD(ICREG) POINT TO TOP OF LIST    YA02128 45865202
RDYLPONE EQU   *                   LOOK FOR READY FLAG          YA02128 45865602
         L     UCBREG,DISP0(UCBPTREG) UCB ADDRESS               YA02128 45866002
         TM    GRAF(UCBREG),RDYBIT THIS DEVICE COME READY?      YA02128 45866402
         BNO   RDYLPCHK            NO, CHECK NEXT               YA02128 45866502
         TM    GCB(UCBREG),OLTEP   OLTEP EXECUTING?             YA02128 45866602
         BZ    RDYFND              NO, READY FOUND              YA02128 45877702
RDYLPCHK EQU   *                   CHECK NEXT UCB               YA02128 45887702
         LA    UCBPTREG,NEXTNTRY(UCBPTREG) INCR TO NEXT ENTRY   YA02128 45888102
*                                  IN UCB LIST                  YA02128 45888502
         BCT   ICSREG,RDYLPONE     BR IF MORE TO CHECK          YA02128 45888602
         LTR   ICREG,ICREG         IF 0, NO READY FOUND OR      YA02128 45888702
         BZ    NOATTN              ONLY READY IS ON DEVICE      YA02128 45888802
*                                  WITH OLTEP EXECUTING         YA02128 45892502
         SRL   ICREG,DISP2         RESTORE RLN                  YA02128 45894502
         LA    UCBPTREG,DEBUCBAD   GET START OF UCB LIST        YA02128 45894902
RDYLPTWO EQU   *                   CHECK REST OF UCB'S          YA02128 45895302
         L     UCBREG,DISP0(UCBPTREG) UCB ADDRESS               YA02128 45895702
         TM    GRAF(UCBREG),RDYBIT THIS DEVICE COME READY?      YA02128 45896102
         BNO   RDY2CHK             NO, CHECK NEXT               YA02128 45896202
         TM    GCB(UCBREG),OLTEP   OLTEP EXECUTING?             YA02128 45922102
         BZ    RDYFND              NO, READY FOUND              YA02128 45932102
RDY2CHK  EQU   *                   CHECK NEXT UCB               YA02128 45942102
         LA    UCBPTREG,NEXTNTRY(UCBPTREG) INCR TO NEXT UCB     YA02128 45944102
         BCT   ICREG,RDYLPTWO      BR OF MORE TO DO             YA02128 45946102
         B     NOATTN              NO READY EXCEPT WHERE        YA02128 45948102
*                                  OLTEP EXECUTING              YA02128 45956702
*                                                               YA02128 45958702
RDYFND   EQU   *                   DEVICE HAS COME READY        YA02128 45960702
         XC    DECPOLPT(POLPTLNG),DECPOLPT CLEAR DECPOLPT       YA02128 45962702
         MVC   DECPOLPT+DISP3(RLNGTH),READRLN(UCBREG) MOVE      YA02128 45964702
*                                  RLN FROM UCB TO DECB         YA02128 45965102
         LR    PARMREG0,DECBREG    PUT DECB ADDRESS IN REG 0    YA02128 45965202
         LR    PARMREG1,UCBREG     PUT UCB ADDRESS IN REG 1     YA02128 45965302
         LA    BRREG,ONE           ROUTE CODE FOR ATNR          YA02128 45965402
         SVC   BTAMSVC             TO IECTSVC                   YA02128 45974002
         LTR   BRREG,BRREG         TEST RETURN CODE             YA02128 45976002
         BNZ   INVALUCB            X'04' - SET INVALID UCB      YA02128 45978002
         L     DECBREG,IOBECBPT    RESTORE DECB ADDRESS         YA02128 45980002
         NI    IOBINCAM,MASKALL-BUSY TURN OFF BUSY              YA02128 45982002
         MVI   SAVE15(SAVEREG),GOODRTN SET GOOD RETURN          YA02128 45982402
         MVC   DECPOLPT(RLNGTH),DECPOLPT+DISP3 PLUG RLN         YA02128 45982502
         MVI   DECFLAGS,RDYDEVIC   SAY CAME READY               YA02128 45982602
         B     LOADM               RETURN TO CALLER             YA02128 45982702
         SPACE 4                                                YA02128 46006102
*                                       DYNAMIC BUFFERING ROUTINE       46029802
         SPACE 2                                                        46053202
DBDATA   TM    6(CCWREG),X'0C'          READ RESPONSE OR READ DATA 000C 46076602
         BM    DATA                     BRANCH IF READ DATA      A29597 46100020
         AH    AREAREG,FULL4+2          INCREMENT AREA ADDRESS          46200013
         B     STRESP                                                   46300013
DATA     OI    4(CCWREG),X'88'          SET ON DATA CHAIN & PCI BIT     46400013
         A     AREAREG,FULL4            INCREMENT AREA ADRS BY SIZE LNK 46500013
         ST    AREAREG,0(CCWREG)        STORE IN CCW AREA               46600013
         MVI   6(CCWREG),X'00'          ZERO COUNT FIELD INDEX          46700013
         LR    AREAREG,ICSREG           PUT AREA ADDRESS IN AREARG 000B 46750014
         LH    ICSREG,DCBBUFL           LOAD BUFFER LENGTH FROM DCB     46800013
         MVI   0(AREAREG),X'00'         SET COMPLETION CODE TO O IN BFR 47000013
         CLI   0(CCWREG),X'02'          IS COMMAND READ                 47100013
         BE    READ                     YES                             47200013
         MVC   8(8,CCWREG),DBWRITE      MOVE TIC COMMAND TO 2ND CCW     47300013
         CLC   1(3,AREAREG),FULL4       IS LINK FIELD ZERO              47400013
         BNE   WRITE                    NO,MSG MORE THAN 1 BFR          47500013
         NI    4(CCWREG),X'77'          TURN OFF DC AND PCI FLAGS       47600013
         TM    DECTYPE+1,X'0D'                                     000B 47630014
         BO    WRWL                                                000B 47660014
         LH    ICSREG,DECLNGTH          USE BUFFER LENGTH IN DECB       47700013
WRL      SH    ICSREG,FULL4+2           SUBTRACT LINK LENGTH       000B 47800014
         SH    ICSREG,6(CCWREG)         SUBTRACT OFFSET                 47900013
         STH   ICSREG,6(CCWREG)         STORE COUNT IN CCW              48000013
         B     TESTLAST                                                 48100013
WRWL     LH    ICSREG,DECWLNG                                      000B 48130014
         B     WRL                                                 000B 48160014
READ     MVC   8(8,CCWREG),DBREAD       MOVE READ-SKIP CMND TO 2ND CCW  48200013
         MVI   4(AREAREG),X'00'         ZERO 1ST BYTE OF DATA AREA      48300013
WRITE    MVC   16(8,CCWREG),0(CCWREG)   MOVE 1ST CCW TO 3RD CCW         48400013
         MVC   24(8,CCWREG),8(CCWREG)   MOVE 2ND CCW TO 4TH CCW         48500013
         MVC   17(3,CCWREG),1(AREAREG)  MOVE ADRS OF NEXT BFR TO CCW    48600013
         L     AREAREG,16(CCWREG)       INCREMENT BY FOUR TO 1ST DATA   48700013
         A     AREAREG,FULL4                 BYTE                       48800013
         ST    AREAREG,16(CCWREG)                                       48900013
         OI    5(CCWREG),X'40'          SETON 1ST PCI BIT IN 1ST R/W    49000013
         SH    ICSREG,FULL4+2           SUBTR ACT 4                     49100013
         STH   ICSREG,22(CCWREG)        STROE IN 2ND READ/WRITE CCW     49200013
         O     CCWREG,24(CCWREG)        PLACE ADRS OF 1ST IN 4TH CCW    49300013
         ST    CCWREG,24(CCWREG)                                        49400013
         LR    AREAREG,CCWREG           SAVE ADRESS OF 1ST CCW          49500013
         AH    CCWREG,SIXTEEN           ADD 16 TO CCW REG               49600013
         ST    CCWREG,8(AREAREG)        PLACE ADDRESS OF 3RD IN 2ND CCW 49700013
         CLI   0(AREAREG),X'02'         IS THIS A READ                  49800013
         BNE   WRITE1                   IF NOT, BRANCH.            000B 49840014
         AH    ICSREG,DECLNGTH          IF THIS IS A READ, ADD     000B 49880014
         SH    ICSREG,DCBBUFL      DECLNGTH AND SUBTRACT DCBBUFL   000B 49920014
         B     READS               TO GET LENGTH OF INPUT AREA     000B 49960014
*                                  MINUS 4.                        000B 50000014
WRITE1   OI    11(AREAREG),X'01'        INVALIDATE ADDR IN 1ST TIC 000B 50040014
READS    SH    ICSREG,6(AREAREG)        SUBTRACT PRESET OFFSET          50100013
         STH   ICSREG,6(AREAREG)        STORE COUNT IN 1ST CCW          50200013
         LA    CCWREG,8(CCWREG)         STEP CCW REG TO 4TH CCW         50300013
*        16    LINES OF CODE DELETED BY APAR ------------>     @ZA11036 50549900
         B     TESTLAST                                                 50559900
         EJECT                                                          50583302
FULL4    DC    F'4'                                                     50600013
K2       DC    F'2'                                              A38557 50650000
OPCODE   DC    X'FF000000'             SAVE THE OP CODE         YA01260 50670002
REQONE   DC    X'01000000'                                              50700013
OFFMSK   DC    X'0000003F'                                              50800013
DIALMASK DC    X'0000007F'                                         000H 50850018
DBREAD   DC    X'02000000381200C0'      READ SKIP MASK           A32459 50920020
DBWRITE  DC    X'0800000028120000'      TIC FOR WRITE COMMAND MASK      51000013
ENABLCCW DC    X'2700000020010001'   14 ENABLE          SLI, L=1        51100013
FFCODE   DC    X'00FF'                                                  51200013
SIXTEEN  DC    H'16'                                                    51300013
EIGHT    DC    H'8'                                                     51330017
CONNECT  EQU   X'DD'                                               000L 51338019
DISCON   EQU   X'01'                                               000L 51342019
RDCON    EQU   X'11'                    READ CONNECT               000L 51346019
WCON     EQU   X'1C'                    WRITE CONNECT              000L 51350019
RCONTONE EQU   X'1E'                                               000L 51354019
WRRESET  EQU   X'0A'                    WRITE RESET              A32466 51358020
WRRSTMON EQU   X'0B'               WRITE RESET MONITOR           S99245 51360002
ENABLE   EQU   X'27'                    ENABLE COMMAND             000J 51363018
DIAL     EQU   X'29'                    DIAL COMMAND               000J 51366018
WINIT    EQU   X'02'               WRITE INITIAL                YA01029 51367002
ONE      EQU   X'01'                    THE CONSTANT 1             000J 51369018
TWO      EQU   X'02'                    THE CONSTANT TWO           000J 51372018
FORTY    EQU   X'40'                    DECIMAL 64                 000J 51375018
FORTY4   EQU   X'44'                    DECIMAL 68                 000J 51378018
TP0B     EQU   X'0B'                    TP OP CODE 0B              000J 51381018
TP0C     EQU   X'0C'                    TP OP CODE 0C              000J 51384018
TP08     EQU   X'08'                    TP OP CODE 08              000J 51384200
X00      EQU   X'00'                                           @ZA10035 51384400
X01      EQU   X'01'                                           @ZA10035 51384600
X06      EQU   X'06'                                           @ZA11032 51384800
X07      EQU   X'07'                                           @ZA11032 51385000
X10      EQU   X'10'                                           @ZA11032 51385200
X13      EQU   X'13'                                           @ZA11032 51385400
X20      EQU   X'20'                                           @ZA10035 51385600
X90      EQU   X'90'                                           @ZA10032 51385800
XF0      EQU   X'F0'                                           @ZA10032 51386000
OHH      EQU   X'00'               NULL BYTE                    YA01029 51388002
MXTYPE   EQU   X'07'               2740 WITH DIAL AND RC        YA01029 51389002
UCB3DISP EQU   X'10'               GRAPHICS DEVICE CLASS      LD YM7701 51390900
UCBTBYT3 EQU   18                  DISPL. OF DEV. CLASS FIELD LD YM7701 51391300
X24      EQU   X'24'                                          LD YM7701 51391700
XFF      EQU   X'FF'                                        LD @ZA02302 51391803
LENG20   DC    H'20'                                                    51391902
DISP0    EQU   0                   DISPLACEMENT OF 0                    51392200
DISP1    EQU   1                   DISPLACEMENT OF 1             Y02947 51392502
DISP2    EQU   2                   DISPLACEMENT OF 2             Y02947 51392902
DISP3    EQU   3                   DISPLACEMENT OF 3            YA02128 51393002
DISP4    EQU   4                   DISPLACEMENT OF 4        LD @ZA02302 51393103
SIX      EQU   6                                               @ZA04152 51393203
C7       EQU   7                                               @ZA04152 51393603
C17      EQU   17                                              @ZA04152 51396203
LEN3     EQU   3                   LENGTH OF 3                   Y02947 51398802
         CNOP  0,8                                                      51400013
         EJECT                                                          51500013
         IECTDECB                                                       51600013
         EJECT                                                          51700013
         IECTIOBX                                                       51800013
         EJECT                                                          51802002
         IECTDEBX                                                       51810002
*                                                                  000A 51900013
*                                                                  000A 52000013
*                             TEMP WORK AREA                       000A 52100013
INDEX    EQU   IOBERINF                                            000D 52200016
AE       EQU   INDEX+1                                             000A 52300013
OFFSET   EQU   INDEX+2                                             000A 52400013
         EJECT                                                          52500013
         DCBD  DSORG=BX,DEVD=(BS,WT)                               000G 52600017
         EJECT                                                          52650002
         IKJTCB DSECT=YES,LIST=YES                                      52660002
         END                                                            52700013
./  ADD  SSI=80930419,NAME=IGG019MB
         TITLE 'IGG019MB - BTAM CHANNEL END/ABNORMAL END APPENDAGE'     00030000
*********************************************************************** 00150000
*                                                                     * 00200000
* MODULE NAME: IGG019MB   (OS/VS)                                     * 00450000
*                                                                     * 00470000
* DESCRIPTIVE NAME: BTAM CHANNEL END/ABNORMAL END APPENDAGE           * 00490000
*                                                                     * 00510000
* COPYRIGHT: NONE                                                     * 00530000
*                                                                     * 00550000
* STATUS: RELEASE 2                                                   * 00570000
*                                                                     * 00590000
* FUNCTION:         SERVICE BTAM DEPENDENT I/O INTERRUPTS             * 00610000
*                        1.  PROVIDE CHANNEL PROGRAM RESTARTS         * 00630000
*                        2.  POST BUFFERS FOR DYNAMIC BUFFERING       * 00650000
*                        3.  UPDATE THE USER'S DECB                   * 00670000
*                                                                     * 00690000
* ENTRY POINT:      ENTRY IS TO 1ST EXECUTABLE INSTRUCTION FROM IOS   * 00710000
*                                                                     * 00730000
* INPUT:            REGISTER  2 - ADDRESS OF THE IOB                  * 00750000
*                   REGISTER  3 - ADDRESS OF THE DEB                  * 00770000
*                   REGISTER  4 - ADDRESS OF THE DCB                  * 00790000
*                   REGISTER  7 - ADDRESS OF THE UCB                  * 00810000
*                   REGISTER 14 - RETURN ADDRESS                      * 00830000
*                                                                     * 00850000
* OUTPUT:           1.  CHANNEL PROGRAM RESTARTS - UPDATED DECB AND   * 00870000
*                        IOB FIELDS.                                  * 00890000
*                   2.  BUFFER POSTS - COMPLETION CODE IN THE BUFFER. * 00910000
*                   3.  UPDATED SENSE, COMMAND AND STATUS FIELDS IN   * 00930000
*                        THE DECB                                     * 00950000
*                                                                     * 00970000
* EXTERNAL ROUTINES:1.  REQUEST-RELEASE BUFFER ROUTINE                * 00990000
*                   2.  SUPERVISOR POST ROUTINE                       * 01010000
*                   3.  PAGE SERVICES ROUTINE (DYNAMIC                * 01030000
*                       BUFFERING ONLY)                               * 01050000
*                                                                     * 01070000
* EXIT:             RETURN TO IOS VIA REGISTER 14+0 NORMALLY,         * 01090000
*                                                +4 FOR ON-LINE TEST  * 01110000
*                                                   OR WHEN A SAD OR  * 01130000
*                                                   ENABLE ERROR      * 01150000
*                                                   OCCURS            * 01170000
*                                                +8 FOR RESTART OF CP * 01190000
*                                                                     * 01210000
* IN LINE ROUTINES: THE TP OP CODE IS USED AS AN INDEX TO BRANCH TO   * 01230000
*                        THE APPROPIATE ROUTINE WITHIN THE CHANNEL    * 01250000
*                        END APPENDAGE.  THE SEQUENCE OF PROCESSING   * 01270000
*                        IS INITIALIZATION AND CHECKING FOR ANY       * 01290000
*                        ERRORS, TP OP CODE ROUTINE, AND THEN EXITING.* 01310000
*                        THE VARIOUS ROUTINES ARE -                   * 01330000
*                        1.  POLLING RESTART - TO RESTART POLLING     * 01350000
*                             AFTER A NEGATIVE RESPONSE.              * 01370000
*                        2.  ADDRESSING RESTART - TO RESTART          * 01390000
*                             ADDRESSING AFTER A NEGATIVE RESPONSE.   * 01410000
*                        3.  READ OR WRITE DATA - TO RELEASE A BUFFER * 01430000
*                             OR PURGE A BUFFER REQUEST ON A READ     * 01450000
*                             WITH DYNAMIC BUFFERING, AND POST THE    * 01470000
*                             LAST BUFFER FOR READS AND WRITES.       * 01490000
*                        4.  ENABLE COMPLETE - TO RESTART THE CHANNEL * 01510000
*                             PROGRAM AFTER AN ENABLE HAS COMPLETED.  * 01530000
*                        5.  COMPARE TWX IDENT - TO CHECK THE TWX     * 01550000
*                             IDENTIFICATION.                         * 01570000
*                        6.  READ SKIP - TO SET APPROPRIATE ERROR     * 01590000
*                             INDICATION FOR LOST DATA.               * 01610000
*                        7.  READ RESPONSE, RESET - TO ASSURE THAT    * 01630000
*                             THE LAST BUFFER WAS POSTED.             * 01650000
*                        8.  TPXX - TO FIND THE DATA CCW.             * 01670000
*                        9.  POST BUFFER ROUTINE - TO SET UP THE      * 01690000
*                             PARAMETERS TO POST AND LINK TO THE      * 01710000
*                             SUPERVISOR POST ROUTINE.                * 01730000
*                       10.  READ INQUIRY - RESTART CHANNEL PROGRAM   * 01750000
*                             WHEN INQ IS RECEIVED.  RESET ACK        * 01770000
*                             POINTERS.                               * 01790000
*                       11.  READ RESPONSE TO INQUIRY - RESTART       * 01810000
*                             CHANNEL PROGRAM AND RESET ACK POINTERS. * 01830000
*                       12.  READ RESPONSE TO TEXT - TEST FOR PROPER  * 01850000
*                             RESPONSE AND UPDATE ACK POINTERS.       * 01870000
*                                                                     * 01890000
* ATTRIBUTES:       THIS ROUTINE IS REENTERANT, ENABLED, AND          * 01910000
*                   RUNS IN SUPERVISOR STATE WITH THE LOCAL           * 01930000
*                   LOCK HELD BY IOS.                                 * 01950000
*                                                                     * 01970000
* CHANGE ACTIVITY AS FOLLOWS:                                         * 01990000
*            APARS                           PTMS                     * 02010000
*       YA02157  (10/1/73)               YM4057  (10/3/73) NO CODE    * 02030000
*       YA02469  (10/1/73)               YM4063  (10/3/73)            * 02050000
*       YA01017  (10/19/73)              YM5663  (12/11/73) PROLOG    * 02070000
*       YA01019  (10/19/73)                                           * 02090000
*       YA01020  (10/19/73)                                           * 02110000
*       YA01026  (10/19/73)                                           * 02130000
*       YA01027  (10/19/73)                                           * 02150000
*       YA01030  (10/19/73)                                           * 02170000
*       YA01239  (10/19/73)                                           * 02190000
*       YA01275  (10/22/73)                                           * 02210000
*       YA01553  (10/22/73)                                           * 02230000
*       YA02161  (10/22/73)                                           * 02250000
*       YA02162  (10/23/73)                                           * 02270000
*       YA02163  (10/23/73)                                           * 02290000
*       YA02164  (10/23/73)                                           * 02310000
*       YA02165  (10/23/73)                                           * 02330000
*       YA02448  (10/23/73)                                           * 02350000
*       YA02453  (10/23/73)                                           * 02370000
*       YA02472  (10/24/73)                                           * 02390000
*       YA03238  (2/2/74)                                             * 02410000
*       YA03243  (2/2/74)                                             * 02430000
*       YA03266  (2/4/74)                                             * 02450000
*       YA03275  (2/7/74)                                             * 02470000
*                                                                     * 02490000
*       ZA00529  (11/14/74) REMOVED BY AZ03588                        * 02510000
*       ZA00536  (11/14/74)                                           * 02530000
*       ZA02312  (11/14/74)                                           * 02550000
*       ZA02313  (11/14/74)                                           * 02570000
*       ZA02314  (11/14/74)                                           * 02590000
*       ZA02315  (11/14/74)                                           * 02610000
*       ZA02316  (11/14/74)                                           * 02630000
*       ZA02317  (11/14/74)                                           * 02650000
*       ZA02318  (11/14/74)                                           * 02670000
*       ZA02319  (11/14/74)                                           * 02690000
*       ZA02320  (11/14/74)                                           * 02710000
*       ZA02321  (11/14/74)                                           * 02730000
*       ZA02322  (11/14/74)                                           * 02750000
*       ZA02323  (11/14/74)                                           * 02770000
*       ZA02324  (11/14/74)                                           * 02790000
*       ZA02325  (11/14/74)                                           * 02810000
*       ZA02327  (11/14/74)                                           * 02830000
*       ZA02339  (11/22/74)                                           * 02850000
*       ZA02814  (01/16/75)                                           * 02870000
*       ZA02845  (02/28/75)                                           * 02890000
*       AZ03588  (07/02/75)                                           * 02910000
*       AZ03598  (04/30/75)                                           * 02930000
*       AZ03966  (04/09/75)                                           * 02950000
*       AZ03967  (04/09/75)                                           * 02970000
*       AZ04157  (07/15/75)                                           * 02990000
*       AZ04190  (07/02/75)                                           * 03010000
*       AZ04192  (07/15/75)                                           * 03030000
*       AZ04195  (07/15/75)                                           * 03050000
*       AZ04196  (07/16/75)                                           * 03070000
*       AZ04650  (07/14/75)                                           * 03090000
*       AZ04679  (10/20/75)                                           * 03110000
*       AZ04852  (10/21/75)                                           * 03130000
*       AZ04873  (10/21/75)                                           * 03150000
*       AZ04877  (10/21/75)                                           * 03170000
*       AZ06398  (11/05/75)                                           * 03190000
*       AZ06404  (10/21/75)                                           * 03210000
*       AZ07638  (11/05/75)                                           * 03230000
*       AZ08045  (03/10/76)        AZ11419  (07/21/76)                * 03250000
*       AZ14067  (11/01/76)        AZ14068  (11/01/76)                * 03270000
*       AZ14069  (11/01/76)        AZ14070  (11/01/76)                * 03290000
*       AZ14071  (11/01/76)        AZ13190  (11/01/76)                * 03310000
*       AZ14130  (11/01/76)        AZ15402  (05/03/77)                * 03330000
*       AZ15430  (11/30/76)        AZ24728  (09/27/77)                * 03350000
*       AZ31078  (03/16/78)        AZ31183  (04/03/78)                * 03370000
*********************************************************************** 03390000
         EJECT                                                          03410000
IGG019MB CSECT                                                          03430000
         SPACE 5                                                        03450000
ZREG     EQU   0                        PARAMTER REGISTER               03470000
ICREG    EQU   1                        SINGLE BYTE WORK REGISTER       03490000
VSLREG   EQU   1                   VIRTUAL SUBAREA LIST ADDR     Y02947 03510000
IOBREG   EQU   2                        INPUT/OUTPUT BLOCK ADDRESS      03530000
DEBREG   EQU   3                        DATA EXTENT BLOCK ADDRESS       03550000
DCBREG   EQU   4                        DATA CONTROL BLOCK ADDRESS      03570000
CCWREG   EQU   5                        CHANNEL COMMAND WORD ADDRESS    03590000
CCW2REG  EQU   6                        CHANNEL COMMAND WORD ADDRESS    03610000
UCBREG   EQU   7                        UNIT CONTROL BLOCK ADDRESS      03630000
WREG     EQU   8                        ADDRESS WORK REGISTER           03650000
TCBREG   EQU   8                        TCB ADDR                 Y02947 03670000
W2REG    EQU   9                        ADDRESS WORK REGISTER           03690000
ECBREG   EQU   10                       EVENT CONTROL BLOCK ADDRESS     03710000
BUFREG   EQU   11                       BUFFER ADDRESS                  03730000
SAVEREG  EQU   11                       WORK REGISTER                   03750000
BASEREG  EQU   12                       BASE REGISTER                   03770000
SAVEAREA EQU   13                       SAVE AREA ADDRESS        Y02947 03790000
RETREG   EQU   14                       RETURN ADDRESS                  03810000
BAS2REG  EQU   14                       SECOND BASE              Y02947 03830000
BRREG    EQU   15                       ENTRY POINT ADDRESS             03850000
         SPACE 3                                                        03870000
         USING IECTDECB,ECBREG                                          03890000
         USING IECTIOB,IOBREG                                           03910000
         USING IHADCB,DCBREG                                            03930000
         USING *,BASEREG,BAS2REG                                        03950000
         STM   RETREG,SAVEAREA,DISP0(SAVEAREA)  SAVE REGISTERS   Y02947 03970000
         LR    BASEREG,BRREG                                            03990000
         LA    BAS2REG,2048(BASEREG)    SET UP SECOND                   04010000
         LA    BAS2REG,2048(BAS2REG)         BASE REGISTER              04030000
         B     LOADECB                                                  04050000
         DC    C'IGG019MB'                                       Y20947 04070000
         DC    C',VS2/R2, '                                     YA03243 04090000
         DC    XL3'017827'              PTF NUMBER                      04110000
         DC    CL8'&SYSDATE'                                            04130000
         DS    0F                                                Y02947 04150000
PATCH    DC    XL250'00'           PATCH AREA                    Y02947 04170000
FOURK    DC    F'4096'                                           Y02947 04190000
LOADECB  DS    0H                                                       04210000
         L     ECBREG,IOBECBPT          LOAD ADDRESS OF DECB            04230000
         LA    ECBREG,0(ECBREG)         CLEAR HI ORDER BYTE    @ZA08045 04250000
         LTR   ECBREG,ECBREG            IS THERE A DECB        @ZA08045 04270000
         BZ    EXITREST                 NO                     @ZA08045 04290000
         CLI   DECTYPE,XFF              IS IT A DUMMY DECB     @ZA08045 04310000
         BNE   DECBOK                   NO                     @ZA08045 04330000
         L     ECBREG,DISP4(ECBREG)      GET REAL DECB         @ZA08045 04350000
         LA    ECBREG,0(ECBREG)         CLEAR HI ORDER BYTE    @ZA08045 04370000
DECBOK   L     CCWREG,IOBCSW            LOAD CCW ADDRESS       @ZA08045 04390000
         LA    CCWREG,0(CCWREG)         INSURE VALID ADDRESS     A33189 04410000
         TM    IOBFLAG1,IOBEXE          IS ERP IN CONTROL          000B 04430000
         BO    EXITREST                 RETURN TO IOS              000B 04450000
         TM    IOBINCAM,X'80'           SAD OR ENABLE ERROR OCCUR       04470000
         BO    ERREXIT                  YES, EXIT                       04490000
         TM    IOBINCAM,SENSTA          HAS 3270 SENSE/STATUS  @ZA14130 04510000
*     MESSAGE BEEN PROCESSED? (SOH % R)                        @ZA14130 04530000
         BO    SOHRCOMP            YES, GO TURN OFF BIT AND             04550000
*                                  GET OUT                              04570000
         CLI   IOBWORK+ONE,SPFLAG  CHECK SPCAL FLAG FROM 504C  @ZA04679 04590000
         BNE   SUBTR8                   NOT ON SO BRANCH       @ZA04679 04610000
         MVI   IOBWORK+ONE,K0           ZERO OUT SPECIAL FLAG  @ZA04679 04630000
         B     REXIT1                                          @ZA04679 04650000
*                                                                       04670000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04690000
*                                                                    *  04710000
*  THIS ROUTINE IS USED TO RESET THE UCBINHIO BIT IN THE UCB COMMON  *  04730000
*  EXTENTION X'05', WHICH INHIBITS HIO WHEN IN RECEIVE MODE.         *  04750000
*                                                                    *  04770000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04790000
*                                                                       04810000
SUBTR8   TM    IOBINCAM,ONLTT          IS ONLINE TEST IN USE   @ZA24728 04830000
         BO    NOCLR                   YES DO NOT CLEAR        @ZA24728 04850000
         XC    IOBERINF(4),IOBERINF    CLEAR WORK AREA         @ZA24728 04870000
NOCLR    EQU   *                                               @ZA24728 04890000
         L     W2REG,UCBEXTPT(UCBREG)  GET ADDRESS OF UCB EXT  @ZA15402 04910000
         TM    5(W2REG),X'10'          IS UCBINHIO BIT ON?     @ZA15402 04930000
         BNO   NOHIOBIT                NO, BRANCH              @ZA15402 04950000
         L     WREG,4(W2REG)           GET 4 BYTES OF UCB EXT  @ZA15402 04970000
TRYRESET LR    IOBREG,WREG             LOAD SAME 4 BYTES       @ZA15402 04990000
         N     IOBREG,RESETMSK         RESET THE UCBHINHIO BIT @ZA15402 05010000
         CS    WREG,IOBREG,4(W2REG)    RESET BIT, IF OK        @ZA15402 05030000
         BNE   TRYRESET                IF NOT, TRY AGAIN       @ZA15402 05050000
         L     IOBREG,DISP16(SAVEAREA) RESTORE IOBREG          @ZA15402 05070000
*                                                                       05090000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  05110000
*                                                                       05130000
NOHIOBIT SH    CCWREG,K8               SUBTRACT 8 TO LAST CCW  @ZA15402 05150000
         BP    LDTP                                                     05170000
         TM    IOBSIOCC,X'30'           TEST FOR OPERATIONAL SIO        05190000
         BO    SIOCC1                   IF NOT, BRANCH                  05210000
         OI    DECERRST,SNO             SET ON SHOULD NOT OCCUR BIT     05230000
         B     CSWADR                                              000A 05250000
LDTP     IC    ICREG,5(CCWREG)          LOAD TPOP CODE                  05270000
         N     ICREG,TPMSK              AND OF BITS 0-3                 05290000
         SLL   ICREG,3                  MULTIPLY BY 8                   05310000
         TM    IOBCSW+4,X'F2'           TEST FOR ERROR IN CSW STATUS    05330000
         BNZ   SIOCC                    BRANCH IF SO                    05350000
         TM    IOBCSW+5,X'3F'           TEST CSW STATUS, 2ND BYTE       05370000
         BZ    NORMAL                   BRANCH IF NO ERRORS             05390000
SIOCC    TM    IOBSIOCC,X'30'           TEST SIO COMPLETION CODE        05410000
         BNO   SIOCC10                  BRANCH IF OPERATIONAL SIO       05430000
SIOCC1   OI    DECERRST,X'80'           SET ON BIT 0 IN ERROR STATUS    05450000
         B     CSWADR                                                   05470000
SIOCC10  TM    IOBSIOCC,X'10'           TEST FOR CSW STORED             05490000
         BZ    ABNORMAL                 BRANCH IF NOT                   05510000
CSWADR   MVC   IOBCSW+1(3),IOBSTART+1   MOVE START ADDRESS              05530000
         L     WREG,IOBCSW              LOAD IT,                        05550000
         AH    WREG,K8                  ADD 8                           05570000
         ST    WREG,IOBCSW              AND STORE                       05590000
         L     CCWREG,IOBSTART                                          05610000
         B     TPXX                                                     05630000
ABNORMAL AH    ICREG,K4                 ADD 4 FOR ABNORMAL ENTRIES      05650000
NORMAL   TM    5(CCWREG),X'30'          DETERMINE BRANCH TABLE FOR      05670000
         BZ    TP0X(ICREG)              NORMAL ENTRIES                  05690000
         BO    BSC2ONLT              3X TP FOR ERROR RECOVERY   YA02472 05710000
*                                    AND 3275 DIAL ON-LINE TEST YA02472 05730000
         TM    5(CCWREG),X'20'                                          05750000
         BZ    TP1X(ICREG)                                              05770000
         B     TP2X(ICREG)                                              05790000
         EJECT                                                          05810000
TP0X     B     TP00                               00                    05830000
         B     TP00AB                   MAL                             05850000
         B     TP01           DIS,DIAL,ENABLE     01                    05870000
         B     TPXX                ABNORMAL                             05890000
         B     TP02           EOT SEQUENCE        02               000A 05910000
         B     TP02AB              ABNORMAL                        000A 05930000
         B     TP03           POLL,ADRS CHAR      03               000A 05950000
         B     TP03AB              ABNORMAL                        000A 05970000
         B     TPXX           SPACE,SHIFT,ETC     04                    05990000
         B     TPXX                ABNORMAL                             06010000
         B     TP05           RD RESPONSE TO POLL 05                    06030000
         B     TP05AB              ABNORMAL                             06050000
         B     TP06           RD RESPONSE TO ADRS 06                    06070000
         B     TPXX                ABNORMAL                             06090000
         B     TP07           RD TWX              07                    06110000
         B     TPXX                ABNORMAL                             06130000
         B     TPXX           EOA CHARACTER       08                    06150000
         B     TPXX                ABNORMAL                             06170000
         B     TP09           AUTOPOLL NOP        09               000A 06190000
         B     TP09AB              ABNORMAL                        000A 06210000
         B     TP0A           AUTOPOLL READ INDEX 0A             A25689 06230000
         B     TP0AAB                   ABNORMAL                   000C 06250000
         B     TP0B           RD RESPONSE TO PREP 0B               000B 06270000
         B     TPXX                ABNORMAL                    @ZA14130 06290000
         B     TP0C           RD RESPONSE TO ENQ  0C               000B 06310000
         B     TPXX                          ABNORMAL              000B 06330000
TP1X     B     TP10           LINE ADDRESS        10                    06350000
         B     TP10AB              ABNORMAL                             06370000
         B     TP10           TEXT                11                    06390000
         B     TP10AB              ABNORMAL                             06410000
         B     TP12           READ SKIP           12                    06430000
         B     TP12AB              ABNORMAL                             06450000
         B     TPXX           WRT END XPARENT BLK 13               000B 06470000
         B     TPXX                ABNORMAL                        000B 06490000
         B     EXIT                  RESERVED    14            @ZA14130 06510000
         B     EXIT                  RESERVED    14            @ZA14130 06530000
TP2X     B     TP2A           READ RESPONSE       20                    06550000
         B     TP2A                ABNORMAL                             06570000
         B     TP2A           RESET               21                    06590000
         B     TP21AB              ABNORMAL                        000A 06610000
         B     EXIT           READ SKIP           22                    06630000
         B     EXIT                ABNORMAL                             06650000
         B     BRKTST        BREAK                23               000I 06670000
         B     BRKTST              ABNORMAL                        000I 06690000
         B     EXIT           SAD, DISABLE        24                    06710000
         B     EXIT                ABNORMAL                             06730000
         B     TP25           RD RESPONSE TO TXT  25               000B 06750000
         B     TP25                ABNORMAL                        000B 06770000
         EJECT                                                          06790000
*                             TP OP CODE = 00     ON LINE TERMINAL TEST 06810000
         SPACE 3                                                        06830000
TP00     TM    UCBTYP+3(UCBREG),BISYNCH IS THIS BISYNCH            000D 06850000
         BO    TSTOLT                  CHECK FOR ONLINE TEST     A43784 06870000
         TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION FLAG ON   000D 06890000
         BZ    EXITONLT                                            000D 06910000
         TM    IOBCSW+4,CSWUE          IS UNIT EXCEPTION STATUS ON      06930000
         BZ    RSTEX                                                    06950000
         CLI   0(CCWREG),READ          IS FAILING CCW A READ            06970000
         BE    RSTEX                                                    06990000
TP00AB   TM    UCBTYP+3(UCBREG),BISYNCH IS THIS BISYNCH            000D 07010000
         BO    TSTOLT                  CHECK FOR ONLINE TEST     A43784 07030000
         TM    IOBINCAM,ONLTT           IS THIS ONLINE TEST        000D 07050000
         BZ    SETERRCC                                                 07070000
         CLI   IOBERRCT,RETRYCNT       DOES RETRY COUNT EQUAL MAXIMUM   07090000
         BE    SETERRCC                 IF SO, BRANCG                   07110000
         IC    ICREG,IOBERRCT          IF NOT , LOAD COUNT              07130000
         LA    ICREG,1(ICREG)          ADD U,                           07150000
         STC   ICREG,IOBERRCT          STORE                            07170000
         B     EXITONLT                                            000D 07190000
TSTOLT   TM    IOBINCAM,ONLTT          IS ONLINE TEST IN CTL?    A43784 07210000
         BO    EXITONLT                YES                       A43784 07230000
         TM    DECDCBAD,ONLTRFT        ONLINE TEST MACRO ISSUED? A49681 07250000
         BO    EXITONLT                YES                       A49681 07270000
         OI    DECERRST,SNO            SET SHOULD NOT OCCUR      A43784 07290000
         MVI   IOBECBPT,CCPER          INDICATE PERM ERROR       A43784 07310000
         B     EXIT                                             YA03243 07330000
         SPACE                                                          07350000
SETERRCC MVI   IOBECBPT,CCPER                                           07370000
RSTEX    L     ICREG,IOBCPA             DATA ADDRESS OF FIRST CCW  000K 07390000
         CLC   0(3,ICREG),DPREO         WRITE TO 2760              000K 07410000
         BE    EXITONLT                 YES,UE IS GOOD             000K 07430000
         NI    IOBFLAG1,MASKALL-IOBEX                              000K 07450000
         B     EXIT                                             YA03243 07470000
         SPACE 3                                                        07490000
*                           TP OP CODE # 02     EOT SEQUENCE       000A 07510000
*                                        OR                        000A 07530000
*                                       #03     POLL COMMAND -     000A 07550000
*                                          NORMAL ENTRY ONLY       000A 07570000
         SPACE 1                                                        07590000
TP02     EQU   *                                                   000A 07610000
TP02AB   EQU   *                                                   000A 07630000
TP03     TM    DECTYPE,AUTOPOLL         AUTOPOLL COMPLETION?       000A 07650000
         BZ    TPXX                IF NOT, EXIT.                   000A 07670000
         CLI   0(CCWREG),POLL           DID OPERATION TERMINATE ON 000A 07690000
         BNE   TP03NEXT            POLL COMMAND?  IF NOT, BRANCH.  000A 07710000
         CLI   5(CCWREG),X'03'          IS THE TPOP CODE 3         000E 07730000
         BNE   TP03NEXT                 IF NOT, BRANCH             000E 07750000
         L     CCW2REG,0(CCWREG)   IF SO, LOAD ENTRY ADDRESS FROM  000A 07770000
         B     TP03UPDT            POLL COMMAND AND BRANCH.        000A 07790000
TP03NEXT CLI   8(CCWREG),POLL           IS THE NEXT COMMAND A POLL 000A 07810000
         BNE   TPXX                COMMAND?  IF NOT, EXIT.  IF SO, 000A 07830000
         L     CCW2REG,8(CCWREG)   OPERATION TERMINATED ON WRITE   000A 07850000
*    COMMAND.  LOAD ENTRY ADDRESS FROM POLL COMMAND AND PROCEED.   000A 07870000
*                                                                  000A 07890000
TP03UPDT L     WREG,DECPOLPT            LOAD ADDRESS OF FIRST      000A 07910000
         BCTR  WREG,0         ENTRY IN LIST AND ADJUST TO FLAG     000A 07930000
         IC    ICREG,0(WREG)  BYTE.  THEN GET FLAG BYTE AND SHIFT  000A 07950000
         SRL   ICREG,5        OUT ALL BUT ENTRY WIDTH.             000A 07970000
         CH    ICREG,K1            IF NNN IS 0 OR 1, THAT MEANS YA01016 07990000
         BH    TP03STOR            8 OR 9, ADD 8 TO MAKE IT     YA01016 08010000
         LA    ICREG,8(ICREG)      CORRECT                      YA01016 08030000
TP03STOR EQU   *                                                 A35727 08050000
         TM    UCBTYP+DISP3(UCBREG),BISYNCH TEST FOR BSC    LD @ZA02319 08070000
         BNO   TP03STOE            BR NOT BSC               LD @ZA02319 08090000
         CLC   0(1,CCW2REG),DCBBSEOT                                    08110000
         BNE   TP03STOE                                                 08130000
TP03STPP EQU   *                                                 A35727 08150000
         L     CCW2REG,DECPOLPT                                         08170000
TP03STOE   EQU   *                                                      08190000
         BCTR  ICREG,0                 DECREMENT ENTRY WIDTH BY  A35727 08210000
*   ONE TO GET THE NUMBER OF POLLING CHARACTERS PER ENTRY        A35727 08230000
         IC    ICREG,0(ICREG,CCW2REG)   GET INDEX BYTE FROM LIST   000A 08250000
         STC   ICREG,DECPOLPT      ENTRY AND STORE IN DECPOLPT.    000A 08270000
         ST    CCW2REG,DECENTRY         STORE LIST ENTRY ADDRESS   000A 08290000
*                                  IN DECENTRY.                    000A 08310000
         SPACE 1                                                        08330000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 08350000
         MVI   EXITAP+1,BRANCH          CHANGE NOP TO AN           000A 08370000
*    UNCONDITIONAL BRANCH TO BYPASS UPDATING DECENTRY AND POLPT.   000A 08390000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 08410000
         SPACE 1                                                        08430000
         B     TPXX                                                000A 08450000
         SPACE 3                                                        08470000
*                           TP OP CODE # 03     POLL COMMAND -     000A 08490000
*                                          ABNORMAL ONLY           000A 08510000
         SPACE 1                                                        08530000
TP03AB   TM    DECTYPE,AUTOPOLL         AUTOPOLL COMPLETION?       000A 08550000
         BZ    TPXX                IF NOT, EXIT.                   000A 08570000
         SR    ICREG,ICREG         CLEAR REG                LD @ZA02814 08590000
         L     WREG,DECPOLPT            LOAD ADDRESS OF FIRST      000A 08610000
         BCTR  WREG,0         ENTRY IN LIST AND ADJUST TO FLAG     000A 08630000
         IC    ICREG,0(WREG)  BYTE.  THEN GET FLAG BYTE AND SHIFT  000A 08650000
         SRL   ICREG,5        OUT ALL BUT ENTRY WIDTH.             000A 08670000
         CH    ICREG,K1            IF NNN IS 0 OR 1, THAT MEANS YA01016 08690000
         BH    TP03AB1             8 OR 9, SO ADD 8 TO MAKE IT  YA01016 08710000
         LA    ICREG,8(ICREG)      CORRECT                      YA01016 08730000
TP03AB1  EQU   *                                                YA01016 08750000
         BCTR  WREG,DISP0          GET # OF ACT. ENTRY      LD @ZA02814 08770000
         SR    SAVEREG,SAVEREG     CLEAR REG                LD @ZA02319 08790000
         IC    SAVEREG,DISP0(WREG) TOTAL ACTIVE ENTRIES        @ZA14130 08810000
         L     W2REG,DISP0(CCWREG) LOAD ENTRY ADDR          LD @ZA02814 08830000
*                                  FROM POLL                LD @ZA02319 08850000
         LR    CCW2REG,W2REG       LOAD REG                 LD @ZA02814 08870000
         AH    CCW2REG,DISP6(CCWREG) ADD ORIG COUNT         LD @ZA02319 08890000
         SH    CCW2REG,IOBCSW+DISP6 SUB RESIDUAL CT.        LD @ZA02814 08910000
TP03AB2  EQU   *                                            LD @ZA02814 08930000
         SR    CCW2REG,W2REG       SUB ENTRY ADDRESS        LD @ZA02814 08950000
         CR    CCW2REG,ICREG       IS DIFF. GR OR EQ WIDTH  LD @ZA02814 08970000
         BH    TP03AB3             BR HIGH                  L5 @ZA02845 08990000
         B     TP03AB4             BR ON LOW OR EQUAL          @ZA14130 09010000
TP03AB3  EQU   *                                            LD @ZA02814 09030000
         AR    CCW2REG,W2REG       RESTORE REG              LD @ZA02814 09050000
         AR    W2REG,ICREG         ADD WIDTH                LD @ZA02814 09070000
         BCT   SAVEREG,TP03AB2     LOOP UNTIL FINISH        LD @ZA02814 09090000
         B     TP03STPP            NO COMPARE-USE DECPOLPT  LD @ZA02814 09110000
TP03AB4  EQU   *                                            LD @ZA02814 09130000
         TM    UCBTYP+DISP3(UCBREG),BISYNCH  TEST FOR BSC   LD @ZA02814 09150000
         BNO   TP03AB5             BR NOT BSC               LD @ZA02814 09170000
         CLC   DISP0(ONE,W2REG),DCBBSEOT  IS CHAR EOT       LD @ZA02814 09190000
         BNE   TP03AB5             CONTINUE                 LD @ZA02814 09210000
         SR    W2REG,ICREG         USE LAST NON EOT ENTRY   LD @ZA02814 09230000
TP03AB5  EQU   *                                            LD @ZA02814 09250000
         LR    CCW2REG,W2REG       RESTORE REG              LD @ZA02814 09270000
         B     TP03STOE                                     LD @ZA02814 09290000
         EJECT                                                          09310000
*                                                                       09330000
*                           TP OP CODE = 05     POLLING RESTART         09350000
         SPACE 3                                                        09370000
TP05     SH    CCWREG,K8                BACK UP 1 CCW                   09390000
         CLI   5(CCWREG),TPWPA          IS THIS WRITE POLLING CHARACTER 09410000
         BNE   TP05                     IF NOT, LOOP                    09430000
         LH    ICREG,6(CCWREG)          LOAD COUNT OF POLLING CHARACTER 09450000
         L     WREG,0(CCWREG)           LOAD CURRENT POLLING ADDRESS    09470000
         LA    WREG,0(WREG,ICREG)       INCREMENT TO THE CONTROL BYTE   09490000
         MVC   WA,ZERO                  RESET POLLING WRAP DECREMENT    09510000
TPL      TM    0(WREG),FORMAT+EOL       ARE FORMAT & EOL BITS ON        09530000
         BZ    TPR                      IF NOT, BRANCH                  09550000
         TM    0(WREG),FORMAT           TEST FORMAT BIT                 09570000
         BO    TPF                      IF ON, BRANCH                   09590000
         B     POST1ER                  IF NOT THIS IS EOL, GO POST     09610000
TPR      TM    IOBFLAG2,RESETPL         TEST RESET P/L                  09630000
         BO    POST0ER                  IF ON, BRANCH TO POST           09650000
STEP1    LA    WREG,1(WREG,ICREG)       STEP TO NEXT ENTRY CONTROL BYTE 09670000
         TM    0(WREG),SKIP             TEST SKIP BIT                   09690000
         BO    TPL                      IF ON, GO TEST EOL & FORMAT     09710000
         SR    WREG,ICREG               BACK UP TO POLLING CHARACTERS   09730000
         ST    WREG,0(CCWREG)           ST ADDRESS IN CCW               09750000
         MVI   0(CCWREG),WRITE          RESTORE WRITE COMMAND           09770000
         ST    WREG,DECPOLPT            UPDATE DECB                     09790000
         CLI   19(UCBREG),TWNTY260      IS DEVICE A 2260                09810000
         BNE   REXIT                    IF NOT, RESTART NOW             09830000
         SH    CCWREG,K8                IF SO, BACK UP TO WRITE CRCLE C 09850000
         B     REXIT                    GO TO RESTART EXIT              09870000
POST0ER  LA    WREG,1(WREG,ICREG)       STEP TO NEXT ENTRY              09890000
POST1ER  SR    WREG,ICREG               BACK UP TO POLLING CHARACTERS   09910000
         TM    17(UCBREG),X'90'         IS THIS DIAL LINE        A25694 09930000
         BNZ   POST2ER                  YES, DON'T UPDATE        A25694 09950000
         MVC   DECENTRY+1(3),DECPOLPT+1 IF NOT, UPDATE                  09970000
POST2ER  ST    WREG,DECPOLPT            UPDATE CURRENT POLLING ADDRESS  09990000
         OI    DECFLAGS,NEGRESPN        SET ON NEGATIVE RESPONSE BIT    10010000
         NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      10030000
         B     TPXX                                                     10050000
TPF      CLC   WA,ZERO                  IS WORK AREA ZERO               10070000
         BNE   POST1ER                  IF NOT, ALL ENTRIES ARE SKIP    10090000
         LR    W2REG,WREG               SAVE THIS ENTRY ADRS            10110000
         MVC   WA,1(WREG)               MOVE LIST DECREMENT TO WA       10130000
         AH    WREG,WA                  SET ADDRESS TO START OF LIST -1 10150000
         TM    0(W2REG),EOL             WAS LAST ENTRY EOL              10170000
         BO    POST0ER                  IF SO, GO POST                  10190000
         TM    IOBFLAG2,RESETPL         IF NOT, WAS RESET P/L ON        10210000
         BO    POST0ER                  IF SO, GO POST                  10230000
         B     STEP1                    LOOP                            10250000
TP05AB   TM    17(UCBREG),X'90'         IS THIS DIAL LINE        A25694 10270000
         BNZ   TPXX                     YES, DON'T UPDATE        A25694 10290000
         MVC   DECENTRY+1(3),DECPOLPT+1 UPDATE DECENTRY                 10310000
         B     TPXX                                                     10330000
         EJECT                                                          10350000
*                             TP OP CODE = 06     ADDRESSING RESTART    10370000
         SPACE                                                          10390000
TP06     CLI   0(CCWREG),X'03'          IS THIS ENTRY FROM ERP     1263 10410000
         BNE   CHK2740                  NO, CHECK FOR A 2740       1263 10430000
         MVI   0(CCWREG),X'02'          CHANGE NOP TO READ         1263 10450000
         MVI   IOBECBPT,CCPER          INDICATE PERM ERROR       A41139 10470000
         OI    IOBCSW+4,X'01'           SET ON UNIT EXCEPTION      1263 10490000
         B     NOT2740                                             1263 10510000
CHK2740  TM    UCBTYP+3(UCBREG),X'E0'   IS THIS TYPE I ADAPTER     1263 10530000
         BNZ   NOT2740                  NO, CAN'T BE 2740          1263 10550000
         TM    UCBTYP(UCBREG),X'09'    IS THIS 2740B               00MC 10570000
         BO    A2740                   YES, TREAT AS 2740          00MC 10590000
         TM    UCBTYP(UCBREG),X'0B'     IS THIS 2740 TERMINAL      1263 10610000
         BNZ   NOT2740                  NO, NOT A 2740             1263 10630000
A2740    EQU   *                                                   00MC 10650000
         CLI   DECRESPN,X'76'           IS THIS A CIRCLE Y         1263 10670000
         BE    REXITB                   YES, RESTART CHANNEL PROGRA1263 10690000
         CLI   DECRESPN,X'40'           THIS A CIRCLE N            1263 10710000
         BE    NOT2740                  YES, NORMAL PROCESSING     1263 10730000
         CLC   DECRESPN(2),SPACEY       THIS A SPACE + CR Y        1263 10750000
         BE    REXITB                   YES, RESTART CHANNEL PROG  1263 10770000
         CLC   DECRESPN(2),SPACEN       THIS A SPACE + CR N        1263 10790000
         BE    NOT2740                  YES, NORMAL PROCESSING     1263 10810000
         CLI   DECRESPN+1,X'40'         CIRCLE N RESPONSE        A27619 10830000
         BNE   NOTACK0                  NO, WRITE ERROR MESSAGE  A27619 10850000
         TM    DECRESPN,X'F0'           IS STATUS 1, 2, OR 4     A27619 10870000
         BZ    NOT2740                  YES, NO MESSAGE REQUIRED A27619 10890000
         B     NOTACK0                  NO, WRITE ERROR MESSAGE    1263 10910000
NOT2740  TM    IOBCSW+4,X'01'           IF UNIT EXCEPTION          1263 10930000
         BZ    NOTUNEX                  NO, BRANCH TO BISYNC    YA03266 10950000
         TM    UCBTYP+3(UCBREG),BISYNCH  TEST FO BSC           @ZA03598 10970000
         BO    BSCEOT               BRANCH IF BSC              @ZA03598 10990000
* TWENTY TWO INSTRUCTIONS REMOVED BY APAR OZ11419              @ZA11419 11010000
         B     POST2                                           @ZA03598 11030000
BSCEOT   CLC   DECRESPN(1),DCBBSEOT       BSC EOT              @ZA03598 11050000
         BE    NOIQE                    YES, SHOULD NOT OCCUR   YA03266 11070000
         B     POST2                                        LD @ZA02327 11090000
NOTUNEX  EQU   *                                                YA03266 11110000
         TM    UCBTYP+3(UCBREG),BISYNCH TEST FOR BSC               000B 11130000
         BO    BSCADRS                                             000B 11150000
         LR    CCW2REG,CCWREG           SAVE ADDRESS OF READ RESP  000B 11170000
TPA8     SH    CCWREG,K8                STEP BACK 1 CCW                 11190000
         CLI   5(CCWREG),X'03'          IS THIS WRITE ADDRESSING CHAR   11210000
         BNE   TPA8                     NO, LOOP                        11230000
         LH    ICREG,6(CCWREG)          LOAD COUNT OF ADDRESSING CHAR   11250000
         L     WREG,0(CCWREG)           LOAD ADRS OF ADDRESSING CHAR    11270000
         AR    WREG,ICREG               STEP TO CONTROL BYTE            11290000
STEP2    LA    WREG,1(WREG,ICREG)       STEP TO NEXT ENTRY'S CONTROL    11310000
         TM    0(WREG),X'40'            TEST SKIP BIT                   11330000
         BZ    TPL2                     IF OFF, GO SETUP ADRS RESTART   11350000
         TM    0(WREG),X'80'            TEST END OF LIST BIT            11370000
         BZ    STEP2                    IF OFF LOOP TO NEXT ENTRY       11390000
         L     CCWREG,IOBCSW            RESTART CHNL PROG - WRITE DATA  11410000
         B     REXIT                                                    11430000
BSCADRS  CLC   DECRESPN(1),DCBBSNAK     WAS RESPONSE NAK           000B 11450000
         BE    POST2                    IF YES, BRANCH             000B 11470000
         CLC   DECRESPN(2),DCBBSSAK     WAS RESPONSE A WACK             11490000
         BE    ISWACK                                                   11510000
         CLC   DECRESPN(2),DCBBSRVI     WAS RESPONSE RVI           000M 11530000
         BE    BSCADRS1            YES INDICATE RVI RECVD   LD @ZA02316 11550000
         CLC   DECRESPN(1),DCBBSENQ   TEST FOR ENQ CHAR.    LD @ZA13190 11570000
         BNE   CHACK               IF NOT, CHECK FOR ACK    LD @ZA02316 11590000
BSCADRS1 EQU   *                                            LD @ZA02316 11610000
         NI    DECFLAGS,NEGRESPN   TURN OFF EVERYTHING,     LD @ZA02316 11630000
*                                  EXCEPT NEG. RESP. FLAG.  LD @ZA02316 11650000
         OI    DECERRST,SNO        SET SHOULD NOT OCCUR     LD @ZA02316 11670000
         OI    DECFLAGS,RVIRCV          INDICATE RVI RECEIVED      000M 11690000
         NI    IOBFLAG1,MASKALL-IOBEX   TURN OFF IOB EXCEPTION     000M 11710000
         B     EXIT                                                     11730000
CHACK    EQU   *                                                        11750000
         CLC   DECRESPN(2),DCBBSAK0     WAS RESPONSE ACK0          000B 11770000
         BNE   NOTACK0                  BRANCH IF NOT ACK0         000B 11790000
         MVI   IOBRCVPT,ACK1PT          RESET RCV ACK PTR          000B 11810000
         MVI   IOBSNDPT,ACK0PT          RESET SND ACK PTR          000B 11830000
         B     REXITA                   RESTART CHANNEL PROGRAM    000B 11850000
NOTACK0  OI    IOBCSW+4,CSWUE           SET ON UNIT EXCEPTION      000B 11870000
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION       000B 11890000
         B     EXIT                                                000B 11910000
TPL2     SR    WREG,ICREG               GET ADDRESS OF ADRS CHARACTERS  11930000
         ST    WREG,0(CCWREG)           STORE IN CCW                    11950000
         MVI   0(CCWREG),X'01'          RESTORE WRITE COMMAND           11970000
         ST    WREG,DECADRPT            UPDATE POINTER IN DECB          11990000
         AR    WREG,ICREG               ADD BACK FOR CONTROL BYTE       12010000
         TM    0(WREG),X'80'            TEST END OF LIST BIT            12030000
         BO    TPCC                     IF ON                           12050000
STEP2A   LA    WREG,1(WREG,ICREG)       STEP TO NEXT ENTRY CTRL BYTE    12070000
         TM    0(WREG),X'40'            TEST SKIP BIT                   12090000
         BZ    REXIT                    IF OFF, EXIT                    12110000
         TM    0(WREG),X'80'            TEST END OF LIST BIT            12130000
         BZ    STEP2A                   IF OFF, LOOP TO NEXT ENTRY      12150000
TPCC     TM    UCBTYP+3(UCBREG),BISYNCH TEST FOR BSC               000B 12170000
         BO    REXIT1                   IF SO, EXIT                000B 12190000
         OI    4(CCW2REG),X'40'         SET ON CC FLAG             000B 12210000
         B     REXIT                                                    12230000
POST2    OI    DECFLAGS,NEGRESPN        SETON NEG RESPONSE BIT          12250000
         NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      12270000
         B     TPXX                                                     12290000
ISWACK   EQU   *                                                        12310000
         OI    DECFLAGS,WACKRCV         INDICATE WACK WAS RECEIVED      12330000
         B     TPXX                                                     12350000
         SPACE 3                                                        12370000
*                           TP OP CODE # 09     AUTOPOLL NOP       000A 12390000
TP09AB   EQU   *                                                   000A 12410000
TP09     LR    CCW2REG,CCWREG                                      000A 12430000
         SH    CCW2REG,K8               SUBTRACT 8 TO GET ADDRESS  000A 12450000
         L     WREG,0(CCW2REG)     OF POLL COMMAND AND LOAD POLL   000A 12470000
*                                  ADDRESS.                        000A 12490000
         AH    WREG,6(CCW2REG)          ADD COUNT FROM POLL        000A 12510000
*    COMMAND - WREG WILL NOW POINT AT THE BYTE FOLLOWING THE LAST  000A 12530000
*    ACTIVE ENTRY IN THE LIST.                                     000A 12550000
         L     W2REG,DECPOLPT           LOAD POLLING LIST ADDRESS. 000A 12570000
         BCTR  W2REG,0                  SUBTRACT ONE TO POINT AT   000A 12590000
*                                  FLAG BYTE.                      000A 12610000
         IC    ICREG,0(W2REG)           PICK UP FLAG BYTE AND      000A 12630000
         SRL   ICREG,5             SHIFT OUT ALL BUT ENTRY WIDTH.  000A 12650000
         CH    ICREG,K1            IF NNN IS 0 OR 1, THAT MEANS YA01016 12670000
         BH    TP09AB1             8 OR 9, SO ADD 8 TO MAKE IT  YA01016 12690000
         LA    ICREG,8(ICREG)      CORRECT                      YA01016 12710000
TP09AB1  EQU   *                                                YA01016 12730000
         SR    WREG,ICREG               SUBTRACT ENTRY WIDTH TO    000A 12750000
*                             GET ADDRESS OF LAST ENTRY IN LIST.   000A 12770000
         TM    UCBTYP+3(UCBREG),BISYNCH  TEST FOR BSC            000J   12790000
         BNO   TP09BA                         NO,  PROCEED         000J 12810000
         BCTR  WREG,0                    SUBTRACT ONE TO ALLOW FOR 000J 12830000
*            EOT OF DUMMY ENTRY  // PTS TO LAST ACTIVE ENTRY       000J 12850000
TP09BA   EQU   *                                                   000J 12870000
         ST    WREG,DECENTRY            UPDATE DECENTRY.           000A 12890000
         BCTR  ICREG,0                  DECREMENT ENTRY WIDTH TO   000A 12910000
*                             GET NUMBER OF POLLING CHARACTERS.    000A 12930000
         TM    UCBTYP+3(UCBREG),BISYNCH  TEST FOR BSC          @ZA14130 12950000
         BNO   TP09ABC                   NOT BSC, BRANCH       @ZA14130 12970000
         L     WREG,DECPOLPT                                            12990000
TP09ABC   EQU   *                                                       13010000
         IC    ICREG,0(ICREG,WREG)      GET INDEX BYTE AND SAVE IN 000A 13030000
         STC   ICREG,DECPOLPT      HIGH ORDER BYTE OF DECPOLPT.    000A 13050000
         OI    DECFLAGS,NEGRESPN   SET ON NEGATIVE RESPONSE BIT.   000A 13070000
         SPACE 1                                                        13090000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 13110000
         MVI   EXITAP+1,BRANCH          CHANGE NOP TO AN           000A 13130000
*    UNCONDITIONAL BRANCH TO BYPASS UPDATING DECENTRY AND POLPT.   000A 13150000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 13170000
         SPACE 1                                                        13190000
         B     TPXX                                                000A 13210000
         SPACE 2                                                        13230000
*                                       TP OP CODE = 0A READ INDEX      13250000
TP0A     EQU   *                                                 A25689 13270000
         SPACE 2                                                        13290000
TP0AAB   L     WREG,0(CCWREG)           LOAD ADDRESS OF MESSAGE    000C 13310000
         MVC   DECPOLPT(1),0(WREG)      SAVE INDEX BYTE            000C 13330000
         B     TPXX                                                000C 13350000
         EJECT                                                          13370000
*                             TP OP CODE = 0B READ INQUIRY              13390000
         SPACE 1                                                        13410000
TP0B     CLC   DECRESPN(1),DCBBSENQ     TEST FOR INQ CHAR          000B 13430000
         BNE   RESETST                  IF NOT, BRANCH             000B 13450000
         CLI   DECTYPE+1,RDINQ          OPERATION READ INQUIRY     000B 13470000
         BE    ACKSET                YES, SET ACKS AND EXIT    @ZA04196 13490000
         CLI   DECTYPE+1,RDINQMON       RD INQUIRY MONITOR       S99245 13510000
         BE    ACKSET                YES, SET ACKS AND EXIT    @ZA04196 13530000
         CLI   DECTYPE+1,WRWBT          WRITE WAIT BEFORE XMIT     000B 13550000
         BE    EXIT                     IF SO, EXIT                000B 13570000
         MVI   IOBRCVPT,ACK1PT          RESET RCV ACK POINTER      000B 13590000
         MVI   IOBSNDPT,ACK0PT          RESET SND ACK POINTER      000B 13610000
         NI    11(CCWREG),FULWORD      CCW ADDRES S TO ACK-0       000B 13630000
         CLI   DECTYPE+1,RDININQ        OPERATION READ INIT INQ    000B 13650000
         BE    EXIT                     IF SO, EXIT                000B 13670000
         CLI   DECTYPE+1,WRRST                                     000B 13690000
         BNE   NOWRRST                  NO, CONTINUE            YA02453 13710000
         NI    IOBINCAM,STRVIRPT        RESET RVI SWITCH        YA02453 13730000
         B     EXIT                     EXIT                    YA02453 13750000
ACKSET   EQU   *                                               @ZA04196 13770000
         TM    UCBTYP+ONE(UCBREG),BSC2      BSC2 ?             @ZA04196 13790000
         BNO   EXIT                     EXIT                   @ZA04196 13810000
         MVI   IOBRCVPT,ACK1PT         RESET RCV ACK           @ZA04196 13830000
         MVI   IOBSNDPT,ACK0PT          RESET SEND ACK         @ZA04196 13850000
         B     EXIT                     EXIT                   @ZA04196 13870000
NOWRRST  EQU   *                                                YA02453 13890000
         CLI   DECTYPE+1,WRRSTMON       WRT RESET MONITOR        S99245 13910000
         BE    EXIT                     IF SO, EXIT              S99245 13930000
*                                                                       13950000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  13970000
*                                                                    *  13990000
*  THIS ROUTINE IS USED TO SET THE UCBINHIO BIT IN THE UCB COMMON    *  14010000
*  EXTENTION X'05', WHICH INHIBITS HIO WHEN IN RECEIVE STATUS        *  14030000
*                                                                    *  14050000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  14070000
*                                                                       14090000
RSTRT    EQU   *                                                 Y02947 14110000
         L     W2REG,UCBEXTPT(UCBREG)   GET ADD OF UCB EXT     @ZA15402 14130000
         L     WREG,4(W2REG)            GET 4 BYTES OF UCB EXT @ZA15402 14150000
TRYSET   LR    IOBREG,WREG              GET SAME 4 BYTES       @ZA15402 14170000
         O     IOBREG,SETMSK            SET MSK UCBINHIO BIT   @ZA15402 14190000
         CS    WREG,IOBREG,4(W2REG)     SET UCBINHIO BIT IF OK @ZA15402 14210000
         BNE   TRYSET                   TRY AGAIN              @ZA15402 14230000
         L     IOBREG,DISP16(SAVEAREA)  RESTORE IOBREG         @ZA15402 14250000
*                                                                    *  14270000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  14290000
*                                                                       14310000
         B     REXITA                                              000B 14330000
RESETST  EQU   *                                                        14350000
         CLI   DECTYPE+1,RDINQMON       RD INQ. MON. (TQM)     @ZA15430 14370000
         BE    RESETST1                 YES, CHECK EOT RESP.   @ZA15430 14390000
         CLI   DECTYPE+1,RDINQ          READ INQ.  (TQ)        @ZA15430 14410000
         BE    RESETST1                 YES, CHECK EOT RESP.   @ZA15430 14430000
         CLI   DECTYPE+1,WRWBT                                   A26901 14450000
         BE    RESETST1                                          A26901 14470000
         CLI   DECTYPE+1,WRRSTMON       WRT RESET MONITOR        S99245 14490000
         BE    RESETST1                 YES, CHECK FOR RESP      S99245 14510000
         CLI   DECTYPE+1,WRRST                                   A26901 14530000
         BNE   SETINQER                                          A26901 14550000
RESETST1 NI    IOBFLAG1,MASKALL-IOBEX  SET OFF IOB EXCEPTION     A26901 14570000
         CLC   DECRESPN(1),DCBBSEOT     WAS EOT RECEIVED IN RESP   000B 14590000
         BNE   DLEEOTST                 IF NOT, BRANCH             000B 14610000
         MVI   IOBRCVPT,ACK0PT          RESET RECEIVE ACK POINTER  000B 14630000
         MVI   IOBSNDPT,ACK0PT          RESET SEND ACK POINTER     000B 14650000
         B     EXIT                                                000B 14670000
DLEEOTST CLC   DECRESPN(2),DCBBSDLE                                000B 14690000
         BE    EXIT                                                000B 14710000
SETINQER OI    IOBCSW+4,CSWUE           SET ON UNIT EXCEPTION      000B 14730000
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION       000B 14750000
         B     EXIT                                                000B 14770000
         SPACE 2                                                        14790000
*   TWO LINES OF CODE REMOVED BY APAR------------------------->@ZA14130 14810000
         SPACE 3                                                        14830000
*                             TP OP CODE = 0C READ RESP TO INQ          14850000
         SPACE 1                                                        14870000
TP0C     CLC   DECRESPN(2),DCBBSAK0     TEST FOR ACK0              000B 14890000
         BNE   AORESP                   IF NOT, BRANCH             000B 14910000
         NI    IOBINCAM,STRVIRPT        RESET RVI SWITCH                14930000
         MVI   IOBRCVPT,ACK1PT          RESET RCV ACK POINTER      000B 14950000
         MVI   IOBSNDPT,ACK0PT          RESET SND ACK POINTER      000B 14970000
         TM    5(CCWREG),X'80'          IS THIS LAST CCWIN CH.PGM  000H 14990000
         BO    EXIT                     YES, EXIT TO POST          000H 15010000
         B     REXITA                   RESTART THE NXT CCW    @ZA14130 15030000
AORESP   CLC   DECRESPN(2),DCBBSSAK     CHECK FOR WACK                  15050000
         BE    SETIMPRP                                            000B 15070000
         CLC   DECRESPN(1),DCBBSEOT     CHECK FOR EOT              000B 15090000
         BE    EOTRESP                                             000B 15110000
         CLC   DECRESPN(1),DCBBSENQ    CHECK FOR ENQ             A43796 15130000
         BE    ENQON                                             A43796 15150000
NOENQ    OI    IOBCSW+4,CSWUE          SET ON UNIT EXCEPTOON     A43796 15170000
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION       000B 15190000
         B     EXIT                                                000B 15210000
ENQON    TM    DCBXCODE,DCBMASTA       THIS THE MASTER STATION?  A43796 15230000
         BNO   NOENQ                                             A43796 15250000
         OI    DECFLAGS,SLVCONT        INDICATE CONTENTION       A43796 15270000
         MVI   IOBECBPT,CCPER                                    A43796 15290000
         B     NOENQ                                             A43796 15310000
EOTRESP  NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION      000B 15330000
SETIMPRP OI    DECFLAGS,WACKRCV         INDICATE WACK RECEIVED          15350000
         B     EXIT                     EXIT                       000B 15370000
         EJECT                                                          15390000
*                             TP OP CODE = 10,11  READ OR WRITE DATA    15410000
         SPACE                                                          15430000
TP10     CLI   0(CCWREG),X'01'          IS COMMAND WRITE                15450000
         BNE   NOTWRT                   NO, BRANCH             @ZA14130 15470000
         TM    UCBTYP+3(UCBREG),X'E0'   ADAPTER TYPE I           A26916 15490000
         BNZ   WRITDATA                 NO, BRANCH             @ZA14130 15510000
         TM    UCBTYP(UCBREG),X'04'     IS IT A 2740 OR 2741?  @ZA14130 15530000
         BZ    WRITDATA                 NO, BRANCH             @ZA14130 15550000
         TM    UCBTYP(UCBREG),X'03'     IS IT A 2740?          @ZA14130 15570000
         BNM   WRITDATA                 NO ITS A 2741, BRANCH  @ZA14130 15590000
         TM    IOBCSW+4,X'01'           UNIT EXCEPTION           A26916 15610000
         BZ    WRITDATA                                          A26916 15630000
         NI    IOBINCAM,MASKALL-BUSY    SET OFF BUSY BIT         A26916 15650000
         MVI   IOBECBPT,CCPER           SET ERROR COMPLETION     A26916 15670000
         NI    IOBFLAG1,MASKALL-IOBEX   TURN OFF IOB EXCEPTION   A26916 15690000
         OI    DECFLAGS,X'02'                                    A26916 15710000
         B     EXIT                                              A26916 15730000
NOTWRT   EQU   *                                                 A26916 15750000
         NI    IOBFLAG1,X'FB'           AND OFF IOB EXCEPTION FLAG      15770000
TP10AB   EQU   *                                                   000I 15790000
*                                       TEST FOR 2741              000I 15810000
         TM    UCBTYP+3(UCBREG),X'E0'   ADAPTER TYPE 1?                 15830000
         BNZ   BSCTST                   NO, BRANCH             @ZA14130 15850000
*                                                           LD @ZA02322 15870000
*              2 LINES REMOVED FOR ----->                   LD @ZA02322 15890000
*                                                           LD @ZA02322 15910000
         TM    UCBTYP(UCBREG),X'04'     IS IT A 2740 OR 2741?  @ZA14130 15930000
         BZ    BSCTST                   NO, BRANCH             @ZA14130 15950000
         TM    UCBTYP(UCBREG),X'03'     IS IT A 2740?          @ZA14130 15970000
         BNM   BSCTST                   NO ITS A 2741,BRANCH   @ZA14130 15990000
         TM    IOBSENS0,X'40'           INTERVENTION REQUIRED      000I 16010000
         BO    EXITBRK                  SCHEDULE 2741 BREAK ROUTINE000I 16030000
*                                                                  000I 16050000
BSCTST   EQU   *                                                   000I 16070000
         CLI   0(CCWREG),X'01'          IS COMMAND WRITE           000I 16090000
         BE    TPXX                                                000I 16110000
         TM    UCBTYP+3(UCBREG),BISYNCH TEST FOR BSC               000B 16130000
         BNO   TSTDYNBF                 IF NOT, BRANCH             000B 16150000
         LH    W2REG,6(CCWREG)          GET ORIGINAL CCW COUNT          16170000
         CH    W2REG,IOBCSW+6           COMPARE TO RESIDUAL COUNT       16190000
         BE    CKENDETX                                          A30765 16210000
BSCTST1  L     WREG,DECAREA            LOAD THE AREA ADDRESS     A43780 16230000
         TM    DCBBFTEK,DYNBF           TEST FOR DYNAMIC BUFFERING 0143 16250000
         BZ    CHKEOT                                              0143 16270000
         AH    WREG,K4                  ADD FOUR                   0143 16290000
CHKEOT   CLI   IOBCPA,POLL             MULTIPOINT RD INITIAL?    A38573 16310000
         BE    CHKEOT1                 YES, CHECK FOR EOT        A38573 16330000
         CLC   0(1,WREG),DCBBSEOT      IS 1ST CHARACTER EOT?     A38573 16350000
         BE    EOTRCV                  IF SO, BRANCH               0143 16370000
         CLC   0(2,WREG),DCBBSDLE       ARE FIRST CHARS DLE-EOT    0143 16390000
         BE    EOTRCV                   IF SO, BRANCH              0143 16410000
IBCTEST  EQU   *                                                YA01239 16430000
         TM    DCBBFTEK,DYNBF           DYNAMIC BUFFERING?      YA01239 16450000
         BZ    NOTEOT                   BRANCH AROUND IBC TEST  YA01239 16470000
         TM    DCBXMODE,INTBLCHK        IBC MODE?               YA01239 16490000
         BZ    NOTEOT                   NO, BRANCH OUT          YA01239 16510000
         BCTR  W2REG,0                  SUBTRACT ONE            YA01239 16530000
         CH    W2REG,IOBCSW+6           ARE COUNTS EQUAL?       YA01239 16550000
         BE    CKENDETX                 YES, CHECK FOR END      YA01239 16570000
NOTEOT   EQU   *                                                   000M 16590000
         BAL   W2REG,FINDADDR           FIND RESPONSE ADDR         0143 16610000
         TM    DCBXMODE,INTBLCHK        INTERMED BLOCK CHK         0143 16630000
         BZ    CHKETB                   NO, BRANCH                 0143 16650000
         BCTR  WREG,0                   BACK UP ONE BYTE           0143 16670000
CHKETB   CLC   1(1,WREG),DCBBSETB       ENDING CHAR ETB            0143 16690000
         BE    UPDACK                   YES, UPDATE ACK POINTERS   0143 16710000
         CLC   1(1,WREG),DCBBSETX       ENDING CHAR ETX            0143 16730000
         BE    UPDACK                   YES, UPDATE ACK POINTERS   0143 16750000
CNTERR   OI    IOBCSW+4,CSWUE           SET ON UNIT EXCEPTION           16770000
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION       000B 16790000
         B     TSTDYNBF                                            000B 16810000
CHKEOT1  CLC   1(1,WREG),DCBBSEOT      2ND BYTE EOT?             A38573 16830000
         BNE   IBCTEST                  NO, CONTINUE            YA01239 16850000
EOTRCV   MVI   IOBRCVPT,ACK0PT          RESET RCV ACK POINTER      000B 16870000
         MVI   IOBSNDPT,ACK0PT          RESET SND ACK POINTER      000B 16890000
         B     TSTDYNBF                                            000B 16910000
CKENDETX EQU   *                   END OF READ TEST             YA01026 16930000
         LR    W2REG,CCWREG        GET CCW ADDR                 YA02164 16950000
         TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFERING?           YA01026 16970000
         BO    DYNBFETX            YES, GOHECK OPERATION        YA01026 16990000
         SH    W2REG,K8            BACK UP ONE CCW              YA01026 17010000
         CLI   5(W2REG),RDRESP     READ RESPONSE                YA01026 17030000
         BE    SEEIFETX            YES, NOW CHECK FOR ETX       YA01026 17050000
         AH    W2REG,K8            RESTORE CCW PTR              YA01026 17070000
         B     CNTERR              GO SET ERROR FLAGS           YA01026 17090000
DYNBFETX EQU   *                   DYNAMIC BUFFERING            YA01026 17110000
         CLI   5(W2REG),RDTEXT1    FIRST READ TEXT              YA01026 17130000
         BNE   NORMDNBF            NO, PROCESS NORMALLY         YA01026 17150000
         SH    W2REG,K8            YES, BACK UP ONE CCW         YA01026 17170000
         CLI   5(W2REG),RDRESP     READ RESPOSE?                YA01026 17190000
         BE    SEEIFETX            YES, GO SEE IF ETX           YA01026 17210000
*                        ONE LINE OF CODE REMOVED BY---------->@ZA14130 17230000
NORMDNBF EQU   *                   NOT READ RESPONSE            YA01026 17250000
         L     W2REG,8(CCWREG)     ADR OF PREVIOUS              YA01026 17270000
SEEIFETX EQU   *                   CHECK FOR ETX                YA01026 17290000
         LH    WREG,6(W2REG)           COUNT OF PREVIOUS CCW     A30765 17310000
         L     W2REG,0(W2REG)          ADDRESS OF PREVIOUS BUFFERA30765 17330000
         AR    W2REG,WREG              ADJUST TO END OF BUFFER   A30765 17350000
         BCTR  W2REG,0                 POINT TO LAST CHARACTER   A30765 17370000
         TM    DCBXMODE,INTBLCHK       INTERMEDIATE BL CHECK     A30765 17390000
         BZ    CKEDETX2                                          A30765 17410000
         BCTR  W2REG,0                 YES, ADJUST POINTER       A30765 17430000
CKEDETX2 CLC   0(1,W2REG),DCBBSETX     ETX IS LAST               A30765 17450000
         BE    UPDACK                  UPDATE ACK POINTER        A30765 17470000
         CLC   0(1,W2REG),DCBBSETB     ETB IS LAST               A30765 17490000
         BNE   CNTERR                  NO, ERROR                 A30765 17510000
UPDACK   TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON        000F 17530000
         BO    TSTDYNBF                 YES, BRANCH                000F 17550000
         XI    IOBSNDPT,FLIP            UPDATE ACK POINTER         000F 17570000
         NI    DECFLAGS,FOXE       TURN OFF STX-ENQ IF ON   LD @ZA02314 17590000
         CLI   DECTYPE+1,X'16'          WRITE INQUIRY ?        @ZA31183 17592000
         BE    FLIPRCV                  UPDATE ACK POINTER     @ZA31183 17594000
         TM    DECTYPE+1,WRTIV          WRITE INITIAL CONVERS      000B 17610000
         BNO   TSTDYNBF                 IF NOT, BRANCH             000B 17630000
FLIPRCV  EQU   *                                                        17650000
         XI    IOBRCVPT,FLIP            UPDATE ACK POINTER         000B 17670000
FLAGOFF  NI    DECFLAGS,OKACK           TURN OFF WRONG RESP      A38550 17690000
TSTDYNBF TM    DCBBFTEK,DYNBF           TEST DYNAMIC BUFFERING     000B 17710000
         BZ    CHKONLT                  IF NOT, CHECK ONLINE TEST  000D 17730000
         IC    ICREG,DEBNMEXT(DEBREG)   LOCATE POINTER TO BUFFER ROUT   17750000
         SLL   ICREG,2                                                  17770000
         LA    BRREG,DEBUCBAD(ICREG,DEBREG) GET BUFFER ROUTINE @ZA14130 17790000
*                           ADDRESS FROM DEB                   @ZA14130 17810000
         SR    ICREG,ICREG                                         000B 17830000
         CLI   8(CCWREG),READ           HAS NEXT BUFFER BEEN       000B 17850000
         BE    TPPR                ASSIGNED?  IF NOT, BRANCH.      000B 17870000
         CLI   8(CCWREG),TICCMND        IS CCW TIC COMMAND       A27615 17890000
         BNE   CHKONLT                  CK FOR ONLINE TST      12121212 17910000
         L     BRREG,0(BRREG)           LOAD ADRS OF BUFFER ROUTINE     17930000
         L     CCW2REG,8(CCWREG)        IF SO RELEASE THE BUFFER        17950000
         CLC   1(3,CCW2REG),K4-1        HAS BUFFER ALREADY BEEN RELEASD 17970000
         BE    CHKONLT                  TST FOR ONLINE TST     12121212 17990000
         L     ZREG,0(CCW2REG)          LOAD THE BUFFER ADDRESS         18010000
         MVC   1(3,CCW2REG),K4-1        MOVE 4 OTHER CCW RD ADRS        18030000
         N     ZREG,MASKDB                                              18050000
         SH    ZREG,K4                                                  18070000
         LR    ICREG,DCBREG             LOAD DCB ADRE INTO REG 1        18090000
         LR    WREG,SAVEAREA            SAVE IOS SAVEAREA ADDR   YM4063 18110000
         LA    SAVEAREA,SAVE19MS        SAVE AREA ADDR FOR 19MS  YM4063 18130000
         BALR  RETREG,BRREG             LINK TO RELEASE BUFFER ROUTINE  18150000
         LR    SAVEAREA,WREG         RESTORE IOS SAVEAREA ADDR   YM4063 18170000
         L     BAS2REG,DISP4(SAVEAREA)  RESTORE                  Y02947 18190000
         A     BAS2REG,FOURK                    SECOND BASE      Y02947 18210000
         SR    ICREG,ICREG                                         000A 18230000
         B     CHKONLT                  TST FOR ONLINE TST     12121212 18250000
WRITDATA TM    4(CCWREG),PCI            IS THERE A WRITE TIC LOOP  3712 18270000
         BZ    TPXX                     IF NOT, GO POST            3712 18290000
         LR    CCW2REG,CCWREG           SAVE CCW POINTER           3712 18310000
         SH    CCW2REG,K16              POINT BACK TWO CCWS        3712 18330000
         CLI   8(CCW2REG),TICCMND       IS CCW A TIC               3712 18350000
         BE    CHKOTHER                 IF SO, BRANCH              3712 18370000
         TM    29(CCWREG),TPEOCP        END OF CHANNEL PROGRAM     3712 18390000
         BO    TPXX                     IF SO, POST                3712 18410000
         B     LOADCCW                                             3712 18430000
CHKOTHER TM    13(CCWREG),TPEOCP        END OF CHANNEL PROGRAM     3712 18450000
         BO    TPXX                     IF SO, POST                3712 18470000
LOADCCW  L     CCWREG,8(CCWREG)         GET ADDRESS OF CCW         3712 18490000
         B     REXIT                    POST FROM LAST CCW         3712 18510000
TPPR     L     WREG,8(CCWREG)           LOAD ADRS OF NEXT RD COMMAND    18530000
         C     WREG,4(BRREG)            IS IT 1ST IN QUEUE              18550000
         BNE   NOT1ST                                                   18570000
         MVC   4(4,BRREG),0(WREG)       IF SO, PLACE NEXT RD AS 1ST     18590000
         B     TP4POST                                                  18610000
NOT1ST   L     W2REG,4(BRREG)           IF NOT 1ST, LOAD ADRS OF 1ST    18630000
NXTCMP   C     W2REG,ZERO               IS IT ZERO                      18650000
         BNE   NXTCMP1             IF NOT, BRANCH.                 1838 18670000
         TM    5(CCWREG),TPFPCI         FIRST TIME PCI ON          3712 18690000
         BZ    NXTCMP2                  NO, BRANCH               A32477 18710000
         TM    IOBINCAM,ONLTT           ONLTT REQUESTED          A32477 18730000
         BZ    TP4POST                  NO, BRANCH               A32477 18750000
NXTCMP2  EQU   *                                                 A32477 18770000
         TM    15(CCWREG),X'01'        CHECK FOR PREVIOUS PCI      1265 18790000
         BO    TP4POST                 IF SO, DO NOT POST BUFFER   1265 18810000
         LR    CCW2REG,CCWREG           SAVE CCW ADDRESS           3712 18830000
         L     CCWREG,8(CCW2REG)        LOAD ADDRESS PREVIOUS READ 3712 18850000
         BAL   UCBREG,BFRPOST           POST BUFFER                3712 18870000
         LR    CCWREG,CCW2REG           RESTORE CCW ADDRESS        3712 18890000
         L     WREG,8(CCWREG)           ADDRESS OF NEXT READ       3712 18910000
         B     TP4POST                                             3712 18930000
NXTCMP1  C     WREG,0(W2REG)            IS NEXT ENRY MATCH         1838 18950000
         BE    FOUND                    IF SO, BRANCH                   18970000
         L     W2REG,0(W2REG)           IF NOT, LOAD THE NEXT ENTRY     18990000
         B     NXTCMP                   CONTINUE LOOP                   19010000
FOUND    MVC   0(4,W2REG),0(WREG)       REMOVE ENTRY FROM QUEUE         19030000
         C     WREG,8(BRREG)            WAS IT LAST ENTRY               19050000
         BNE   TP4POST                  IF NOT, BRANCH                  19070000
         ST    W2REG,8(BRREG)           IF SO, UPDATE LAST ENTRY ADRS   19090000
TP4POST  MVC   1(3,WREG),K4-1           MOVE 4 TO OTHER CCW RD ADRS     19110000
         L     UCBREG,IOBCSW           LOAD CSW                  A32477 19130000
         SH    UCBREG,K8               BACK UP TO FAILING CCW    A32477 19150000
         TM    5(UCBREG),X'12'         IS THIS READ SKIP CCW     A32477 19170000
         BNO   CHKONLT                 NO TST FOR ONLINE TST   @ZA14130 19190000
*                ONE LINE DELETED BY-------------------------->@ZA14130 19210000
TP3POST1 BAL   UCBREG,BFRPOST           POST CURRENT BUFFER    @ZA14130 19230000
         TM    IOBCSW+4,X'F2'           ANY ERRORS                 3712 19250000
         BNZ   ABNORM                   IF SO, BRANCH              3712 19270000
         TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON        000D 19290000
         BO    EXIT                     IF SO, EXIT                000D 19310000
         TM    DECTYPE+1,RESET          WAS RESET SPECIFIED        000D 19330000
         BZ    EXIT                                              A32477 19350000
DIS      LA    CCWREG,8(CCWREG)        STEP TO NEXT CCW                 19370000
         TM    5(CCWREG),TPRESET       IS THIS A RESET COMMAND          19390000
         BO    TESTEOT                 YES, BRANCH TO TEST FOR EOT      19410000
         TM    5(CCWREG),X'80'          IS THIS LAST CCW                19430000
         BO    EXIT                     YES, EXIT                       19450000
         B     DIS                                                      19470000
TESTEOT  TM    IOBCSW+4,CSWUE          WAS AN EOT RECEIVED              19490000
         BZ    REXIT                   NO, BRANCH TO RESTART            19510000
         TM    5(CCWREG),TPEOCP        IS THIS LAST CCW                 19530000
         BO    EXIT                    YES, EXIT                        19550000
         LA    CCWREG,8(CCWREG)        STEP TO NEXT CCW (DISABLE        19570000
         B     REXIT                   COMMAND), AND BRANCH TO RESTART  19590000
ABNORM   OI    IOBFLAG1,IOBEX          SET ON IOB EXCEPTION        3712 19610000
         B     EXIT                                                3712 19630000
         SPACE 3                                                        19650000
*                             TP OP CODE = 01     ENABLE COMPLETE       19670000
         SPACE                                                          19690000
TP01     TM    UCBTYP+3(UCBREG),BISYNCH IS IT BSC OPERATION        000B 19710000
         BO    TPXX                    YES, EXIT                   000B 19730000
         CLI   0(CCWREG),X'27'          ENABLE CCW                 000B 19750000
         BNE   TPXX                     IF NOT, BRANCH                  19770000
         CLI   IOBECBCC,X'48'           IS INTERRUPT FROM HIO           19790000
         BNE   HIO                      NO, RESTART CHANNEL PROGRAM     19810000
         B     TPXX                     POST BUFFER                     19830000
HIO      EQU   *                                                 Y02947 19850000
         LA    CCWREG,8(CCWREG)                                         19870000
         B     REXIT                                                    19890000
*---------------------------------------------------------------------  19910000
         SPACE 3                                                        19930000
*                             TP OP CODE = 07     COMPARE TWX IDENT     19950000
         SPACE                                                          19970000
TP07     LH    ICREG,6(CCWREG)          LOAD IDENT COUNT                19990000
         L     WREG,0(CCWREG)           LOAD ADDRESS OF IDENT CHAR      20010000
         L     SAVEREG,DECENTRY         LOAD LIST ADDRESS          000L 20030000
         L     UCBREG,REG7(SAVEAREA)  PRIME UCB REG              Y02947 20050000
         TM    UCBTYP+THREE(UCBREG),BISYNCH     BSC ?          @ZA04195 20070000
         BNO   NOACKSET                 NO DON'T SET ACKS      @ZA04195 20090000
         MVI   IOBRCVPT,ACK1PT          RESET RCV ACK          @ZA04195 20110000
         MVI   IOBSNDPT,ACK0PT          RESET SEND ACK         @ZA04195 20130000
NOACKSET EQU   *                                               @ZA04195 20150000
         CLI   0(SAVEREG),SWLST         IS THIS A SWLST            000L 20170000
         BE    SWITCH                                              000L 20190000
         CLI   0(SAVEREG),FOXE                                     000L 20210000
         BNE   NOTSW                                               000L 20230000
         MVI   0(SAVEREG),SWLST                                    000L 20250000
         B     TURNON                                              000L 20270000
SWITCH   EQU   *                                                   000L 20290000
         SR    SAVEREG,SAVEREG          CLEAR REGISTER             000L 20310000
         SH    WREG,K8                  SUBTRACT 8 FROM AREA ADDR  000L 20330000
         MVC   1(3,WREG),ZERO3          RESET ADDRESS FIELD        000L 20350000
         LA    W2REG,8(WREG,ICREG)      POINT TO DIAL DIGITS       000L 20370000
         IC    ICREG,7(WREG)            GET DIAL COUNT             000L 20390000
         AR    W2REG,ICREG              ADD TO LENGTH OF HEADER    000L 20410000
         IC    ICREG,0(W2REG)           GET ID COUNT               000L 20430000
         LA    W2REG,1(ICREG,W2REG)     POINT TO AUTHORIZED SEQ    000L 20450000
         SH    CCWREG,K8                POINT TO PREVIOUS CCW      000L 20470000
         CLI   5(CCWREG),TPWIDENQ       IS THIS WRITE ID ENQ       000L 20490000
         BE    WRTC                                                000L 20510000
         AH    CCWREG,K8                POINT BACK TO CURRENT CCW  000L 20530000
         IC    SAVEREG,4(WREG)          GET NO. OF LIST ENTRIES    000L 20550000
COMPR    EQU   *                                                   000L 20570000
         LH    ICREG,6(CCWREG)          LOAD RD-IN-AREA LENGTH     000L 20590000
         SH    ICREG,IOBCSW+6           SUBTRACT RESIDUAL COUNT    000L 20610000
         BCTR  ICREG,0                  SUBTRACT ONE FROM COUNT    000L 20630000
         EX    ICREG,COMSEQ             COMPARE SEQUENCES          000L 20650000
         BE    GOODID                                              000L 20670000
         IC    ICREG,5(WREG)            GET ENTRY LENGTH           000L 20690000
         LA    W2REG,0(ICREG,W2REG)     POINT TO NEXT SEQUENCE     000L 20710000
         BCT   SAVEREG,COMPR                                       000L 20730000
         CLC   8(1,WREG),DCBBSENQ       WAS ENQ RECEIVED           000L 20750000
         BE    EXIT                                                000L 20770000
DLEEOTCK EQU   *                                                   000L 20790000
         CLC   8(2,WREG),DCBBSDLE       WAS DLEEOT RECEIVED        000L 20810000
         BE    ISDLEEOT                                            000L 20830000
         OI    DECFLAGS,NOCOMPAR        INDICATE INVALID ID        000L 20850000
         B     NOMATCH                                             000L 20870000
ISDLEEOT EQU   *                                                   000L 20890000
         OI    DECFLAGS,EOTRCVD         INDICATE DLE EOT RECEIVED  000L 20910000
         CLI   DECTYPE+ONE,WRTTC        WRITE CONNECT ?        @ZA04190 20930000
         BNE   TPXX                     NO ,BRANCH             @ZA04190 20950000
         NI    IOBFLAG1,MASKALL-IOBEX   TURN OFF IOB EXECPTION @ZA04190 20970000
         B     TPXX                                                000L 20990000
COMSEQ   CLC   8(0,WREG),0(W2REG)                                  000L 21010000
GOODID   EQU   *                                                   000L 21030000
         ST    W2REG,0(WREG)            STORE ENTRY ADDRESS        000L 21050000
         MVI   0(WREG),SWLST            INDICATE SWLST             000L 21070000
         BAL   SAVEREG,IDMOVE           SAVE ID OF BSC2        @ZA04192 21090000
***         FIVE LINES OF CODE DELETED                         @ZA04192 21110000
         IC    ICREG,5(WREG)            GET ENTRY LENGTH           000L 21130000
         BCTR  ICREG,0                  SUBTRACT ONE FROM LENGTH   000L 21150000
         LA    W2REG,0(ICREG,W2REG)     POINT TO CONTROL BYTE      000L 21170000
         CLI   0(W2REG),ONE             IS CONTROL BYTE 1          000L 21190000
         BNE   NOTONE                                              000L 21210000
         MVC   1(3,WREG),ZERO3          ZERO OUT ADDRESS FIELD     000L 21230000
***           TWO LINES REMOVED BY---------------------------->@ZA14130 21250000
         LA    CCWREG,24(CCWREG)        DISCONNECT LINE            000L 21270000
         B     REXIT                                               000L 21290000
NOTONE   EQU   *                                                   000L 21310000
         CLI   0(W2REG),TWO             IS CONTROL BYTE VALUE 2    000L 21330000
         BNE   REXITB                                              000L 21350000
         B     EXIT                                                000L 21370000
WRTC     EQU   *                                                   000L 21390000
         AH    CCWREG,K8                POINT BACK TO PRESENT CCW  000L 21410000
         CLC   8(2,WREG),DCBBSSAK       WAS WACK RECEIVED          000L 21430000
         BNE   NOTWACK                  IF NOT, BRANCH             000L 21450000
         OI    DECFLAGS,WACKRCV         INDICATE WACK              000L 21470000
TURNON   EQU   *                                                   000L 21490000
         MVI   IOBCPA+5,CONNECT         INDICATE LINE CONNECTION   000L 21510000
         B     TPXX                                                000L 21530000
NOTWACK  EQU   *                                                   000L 21550000
         CLC   8(2,WREG),DCBBSAK0       WAS ACK0 RECEIVED          000L 21570000
         BNE   NOACK0                                              000L 21590000
*           TWO LINES OF CODE DELETED                          @ZA04195 21610000
         B     EXIT                                                000L 21630000
NOACK0   EQU   *                                                   000L 21650000
         CLC   8(1,WREG),DCBBSNAK       WAS NAK RECEIVED           000L 21670000
         BNE   NOTNAK                                              000L 21690000
         OI    DECFLAGS,IMPRESP         INDICATE NOT ACK           000L 21710000
         B     TURNON                                              000L 21730000
NOTNAK   EQU   *                                                   000L 21750000
         LA    CCW2REG,8(WREG)          GET ADDR OF READ-IN-AREA   000L 21770000
         AH    CCW2REG,6(CCWREG)        ADD ORIGINAL COUNT         000L 21790000
         SH    CCW2REG,IOBCSW+6         SUBTRACT RESIDUAL COUNT    000L 21810000
         BCTR  CCW2REG,0                SUBTRACT ONE TO PT TO CHAR 000L 21830000
         CLC   0(1,CCW2REG),DCBBSNAK    IS THIS ID-NAK             000L 21850000
         BE    IDNAK                                               000L 21870000
         BCTR  CCW2REG,0                                           000L 21890000
         CLC   0(2,CCW2REG),DCBBSAK0    IS THIS ID-ACK0 SEQUENCE   000L 21910000
         BNE   DLEEOTCK                                            000L 21930000
IDNAK    EQU   *                                                   000L 21950000
         LA    ICREG,8(WREG)            GET ADDR OF READ-IN-AREA   000L 21970000
       SR      CCW2REG,ICREG            GET LENGTH OF ID           000L 21990000
         BCTR  CCW2REG,0                SUBTRACT ONE               000L 22010000
         SR    ICREG,ICREG              CLEAR REGISTER             000L 22030000
*             5 LINES DELETED FOR THE FOLLOWING APAR            YA02448 22050000
         IC    SAVEREG,4(WREG)          GET NO. OF LIST ENTRIES    000L 22070000
COMPAGIN EQU   *                                                   000L 22090000
         EX    CCW2REG,COMSEQ           COMPARE SEQUENCES          000L 22110000
         BE    GOODSEQ                                             000L 22130000
         IC    ICREG,5(WREG)            GET ENTRY LENGTH           000L 22150000
         LA    W2REG,0(ICREG,W2REG)     POINT TO NEXT SEQUENCE     000L 22170000
         BCT   SAVEREG,COMPAGIN                                    000L 22190000
         OI    DECFLAGS,NOCOMPAR                                   000L 22210000
NOMATCH  OI    IOBCSW+4,CSWUE           SET UNIT EXCEPTION         000L 22230000
         OI    IOBFLAG1,IOBEX          SET IOB EXCEPTION           000L 22250000
         B     TPXX                                                000L 22270000
GOODSEQ  LA    SAVEREG,DONTSAVE         SET RET REG            @ZA04192 22290000
IDMOVE   TM    UCBTYP+DISP1(UCBREG),BSC2 IS THIS BSC2?         @ZA04192 22310000
         BNO   NOSAVE                   NO, DO NOT SAVE ID     @ZA04192 22330000
         SR    UCBREG,UCBREG            CLEAR WORK REG         @ZA04192 22350000
         IC    UCBREG,DCBEIOBX          GET IOB LENGTH         @ZA04192 22370000
         SH    UCBREG,K8                DISP FOR SAVE AREA     @ZA04192 22390000
         AR    UCBREG,IOBREG            ID SAVE AREA           @ZA04192 22410000
         MVC   K0(ID4BYTES,UCBREG),IDDISP(WREG)                @ZA04192 22430000
*                     SAVE 1ST 4 CHARACTERS OF TERMINAL ID     @ZA04192 22450000
         L     UCBREG,REG7(SAVEAREA)    RESTORE UCB REG        @ZA04192 22470000
NOSAVE   BR    SAVEREG                 RETURN                  @ZA04192 22490000
DONTSAVE EQU   *                                                YA02448 22510000
         ST    W2REG,0(WREG)            STORE ADDRESS OF ENTRY     000L 22530000
         MVI   0(WREG),SWLST            INDICATE SWLST             000L 22550000
         LA    W2REG,8(WREG)            LOAD ADDRESS OF RD-IN-AREA 000L 22570000
         AR    CCW2REG,W2REG                                       000L 22590000
         LA    CCW2REG,1(CCW2REG)                                  000L 22610000
         CLC   0(1,CCW2REG),DCBBSNAK    WAS IT ID-NAK              000L 22630000
         BE    GETLEN                                              000L 22650000
         MVI   IOBRCVPT,ACK1PT          RESET RCV ACK POINTER      000L 22670000
         MVI   IOBSNDPT,ACK0PT          RESET SND ACK POINTER      000L 22690000
         B     EXIT                                                000L 22710000
GETLEN   EQU   *                                                   000L 22730000
         OI    DECFLAGS,IMPRESP         INDICATE NOT ACK           000L 22750000
         IC    ICREG,5(WREG)            GET ENTRY LENGTH           000L 22770000
         BCTR  ICREG,0                  SUBTRACT ONE               000L 22790000
         LA    W2REG,0(ICREG,W2REG)     POINT TO CONTROL BYTE      000L 22810000
         CLI   0(W2REG),ONE             IS CONTROL BYTE VALUE 1    000L 22830000
         BNE TURNON                     IF NOT ,ASSUME 0           000L 22850000
         MVI   0(WREG),FOXE                                        000L 22870000
         B     NOMATCH                                             000L 22890000
NOTSW    EQU   *                                                   000L 22910000
         LA    W2REG,0(WREG,ICREG)      LOAD ADDRESS OF COMPARE CHAR    22930000
         BCTR  ICREG,0                  SUB 1 FROM COUNT                22950000
         EX    ICREG,IDCMP              COMPARE IDENTIFICATION          22970000
         BE    IDGOOD                   IF GOOD, BRANCH            000B 22990000
NOT      OI    DECFLAGS,NOCOMPAR        SET FLAG INDICATING TWX    000B 23010000
         B     TPXX                ID DID NOT COMPARE.             000B 23030000
IDCMP    CLC   0(0,WREG),0(W2REG)       COMPARE IDENT INSTRUCTION       23050000
IDGOOD   NI    DECFLAGS,MASKALL-NOCOMPAR                           000B 23070000
         TM    UCBTYP+3(UCBREG),BISYNCH TEST FOR BSC               000B 23090000
         BNO   REXITA                   IF NOT, EXIT               000B 23110000
         TM    UCBTYP+1(UCBREG),BSC2    IS IT BSC2?              S99245 23130000
         BNO   SAVENOT                  NO, DON'T SAVE ID        S99245 23150000
         SR    SAVEREG,SAVEREG            CLEAR REGISTER       @ZA04192 23170000
         IC    SAVEREG,DCBEIOBX      GET IOB LENGTH            @ZA04192 23190000
         SH    SAVEREG,K8                SAVE AREA DISP        @ZA04192 23210000
         AR    SAVEREG,IOBREG          POINT TO ID SAVE AREA   @ZA04192 23230000
         MVC   K0(ID4BYTES,SAVEREG),DISPID(WREG)               @ZA04192 23250000
*                                SAVE 1ST 4 CHARS OF TERM ID   @ZA04192 23270000
SAVENOT  EQU   *                                                 S99245 23290000
*                TWO LINES OF CODE DELETED                     @ZA04195 23310000
         TM    5(CCWREG),TPEOCP         CHK FOR LAST CCW                23330000
         BO    EXIT                     IF SO, DON'T RESTART            23350000
         B     REXITA                                              000B 23370000
         EJECT                                                          23390000
         SPACE 3                                                        23410000
*                             TP OP CODE = 12     READ SKIP             23430000
         SPACE                                                          23450000
TP12AB   TM    4(CCWREG),X'10'         TEST SKIP BIT                    23470000
         BO    TP12ALL                  IF ON, THIS IS READ-SKIP        23490000
         TM    DISP3(CCWREG),TICBIT INVALID TIC ADDR ?      LD @ZA02320 23510000
         BO    POSTBUFR            YES, PCI APP HAS NOT SET LD @ZA02320 23530000
*                                  UP NEXT WRITE YET        LD @ZA02320 23550000
         TM    IOBCSW+DISP5,PROGCHK  PROG. CHECK ?          LD @ZA02320 23570000
         BZ    TP12AC              BR IF NOT                LD @ZA02320 23590000
         CLI   DISP0(CCWREG),TICCMND  TIC COMMAND           LD @ZA02320 23610000
         BNE   TP12AC              BR IF NOT TIC            LD @ZA02320 23630000
         L     CCWREG,DISP0(CCWREG)  GET NEXT CCW           LD @ZA02320 23650000
         LA    CCWREG,DISP0(CCWREG)  CLEAR HI BYTE          LD @ZA02320 23670000
         B     REXIT               RESTART CHANNEL PROGRAM  LD @ZA02320 23690000
TP12AC   EQU   *                                            LD @ZA02320 23710000
         TM    IOBCSW+DISP4,MASKALL  ANY STATUS BUT PCI/CPC LD @ZA02320 23730000
         BNZ   POSTBUFC            YES, POST IT             LD @ZA02320 23750000
         TM    IOBCSW+DISP5,X1F    ANY STATUS BUT PCI/CPC   LD @ZA02320 23770000
         BNZ   POSTBUFC            YES, POST IT             LD @ZA02320 23790000
         L     CCWREG,DISP0(CCWREG)  SET UP RESTART ON WRT  LD @ZA02320 23810000
         B     REXIT               GO TO CHANNEL RESTART    LD @ZA02320 23830000
POSTBUFR EQU   *                                            LD @ZA02320 23850000
         MVI   CODEMSK,CCNORM      GOOD COMPLETION FOR BUFS LD @ZA02320 23870000
         SH    CCWREG,K8           BACK UP ONE CCW          LD @ZA02320 23890000
         TM    DISP5(CCWREG),WRT1ST  FIRST WRITE ?          LD @ZA02320 23910000
         BO    POSTBUF1            YES, POST BUFFER         LD @ZA02320 23930000
         LA    CCWREG,DISP16(CCWREG)  BUMP TWO CCW          LD @ZA02320 23950000
         CLI   DISP5(CCWREG),WRTTEXT  WRITE TEXT ?          LD @ZA02320 23970000
         BE    POSTBUF1            YES, POST IT             LD @ZA02320 23990000
         SH    CCWREG,K32          GO BACK 4 CCW'S          LD @ZA02320 24010000
POSTBUF1 EQU   *                                            LD @ZA02320 24030000
         CLC   DISP1(THREE,CCWREG),K4-ONE IS A BUF ADDR     LD @ZA02320 24050000
         BE    POSTBUF2            YES,DON'T POST           LD @ZA02320 24070000
         BAL   UCBREG,OKPOST       POST IT                  LD @ZA02320 24090000
         MVC   DISP1(THREE,CCWREG),K4-ONE WIPE OUT BUF ADDR LD @ZA02320 24110000
POSTBUF2 EQU   *                                            LD @ZA02320 24130000
         L     CCWREG,DISP8(CCWREG)  ADDRESS OF NEXT WRT    LD @ZA02320 24150000
         N     CCWREG,MASKDB       ADJUST TO BEGINNING      LD @ZA02320 24170000
POSTBUF4 EQU   *                                            LD @ZA02320 24190000
         CLC   DISP3(THREE,CCWREG),K4-ONE IS A BUF ADDRSS   LD @ZA02320 24210000
         BE    POSTBUF3            YES, DON'T POST          LD @ZA02320 24230000
         BAL   UCBREG,OKPOST       POST IT                  LD @ZA02320 24250000
POSTBUF3 EQU   *                                            LD @ZA02320 24270000
         LA    CCWREG,DISP16(CCWREG)  BUMP 2 CCW'S             @ZA04650 24290000
         CLI   DISP5(CCWREG),A0     TP-OP OF LAST CCW          @ZA04650 24310000
         BE    REXIT                 YES, RESTART ON NEXT CCW  @ZA04650 24330000
         OI    IOBFLAG1,IOBEX      SET ABNORMAL COMP        LD @ZA02320 24350000
         MVI   IOBECBPT,CCPER      COMPLETION CODE          LD @ZA02320 24370000
         B     EXIT                                         LD @ZA02320 24390000
POSTBUFC EQU   *                                            LD @ZA02320 24410000
         MVI   CODEMSK,CCNORM      GOOD COMPLETION CODE     LD @ZA02320 24430000
         SH    CCWREG,K8           ONLY PREVIOUS BUFFER     LD @ZA02320 24450000
*                                  SHOULD BE POSTED         LD @ZA02320 24470000
         B     POSTBUF4            POST IT                  LD @ZA02320 24490000
TP12     NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      24510000
TP12ALL  TM    4(CCWREG),X'08'          TEST FOR PCI BIT                24530000
         BO    RS1                      IF ON, THIS IS 1ST R-S COMMAND  24550000
         SH    CCWREG,K8                IF NOT BACK UP 1 CCW            24570000
         B     RSERR                                                    24590000
RS1      CLC   IOBCSW+6(2),6(CCWREG)    DOES RESIDUAL COUNT = CCW COUNT 24610000
         BE    RSP                      IF SO, NO DATA WAS LOST         24630000
RSERR    OI    DECFLAGS,X'08'           SET ERROR BIT FOR LOST DATA     24650000
RSP      SH    CCWREG,K8                BACK UP TO READ DATA CCW        24670000
RSP1     CLI   0(CCWREG),X'02'     IS THIS A READ COMMAND        A41134 24690000
         BNE    NOTREAD                NO, BRANCH OUT              2725 24710000
         L     UCBREG,8(CCWREG)        POINT TO NEXT READ DATA     2725 24730000
         CLC   1(3,UCBREG),K4-1        TEST IF BUFF REQ PURGED     2725 24750000
         BNE   PURGE                                               2725 24770000
NOTREAD  BAL   UCBREG,BFRPOST          GO TO POST BUFFER           2725 24790000
         B     EXIT                                                1838 24810000
         SPACE 3                                                        24830000
PURGE    IC    ICREG,DEBNMEXT(DEBREG)  PTR TO BUFFER ROUTINE       2725 24850000
         SLL   ICREG,2                                             2725 24870000
         LA    BRREG,DEBUCBAD(ICREG,DEBREG)                        2725 24890000
         B     TPPR                                                2725 24910000
         SPACE   2                                                      24930000
*                             TP OP CODE = 20,21  RD RESPONSE, RESET    24950000
         SPACE                                                          24970000
TP2A     TM    DCBBFTEK,X'08'           TEST FOR DYNAMIC BUFFERING      24990000
         BZ    CHKONLTS                 IF NOT, EXIT               000D 25010000
         LA    UCBREG,EXIT              SET UP E/                  1838 25030000
TP2AA    EQU   *                                                 A32454 25050000
         LA    CCWREG,0(CCWREG)         CLEAR 1ST BYTE OF REGISTER      25070000
         LA    CCW2REG,IOBCPA           LOAD ADRS OF START OF CHNL PROG 25090000
BKP      CR    CCW2REG,CCWREG           ARE WE BACKED UP TO START OF CP 25110000
         BL    BACKUP                   NO, BACKUP 0NE CCW     @ZA06404 25130000
         CLI   0(CCWREG),X'01'          IS THIS WRITE CIRCLE C   A30746 25150000
         BNE EXIT                       IF NOT, EXIT             A30746 25170000
         CLI   IOBECBCC,X'48'           IS INTERRUPT FROM HIO    A30746 25190000
         BE    FINDRW                   YES, POST RD TEXT BUFFER A30746 25210000
         CLI   IOBECBCC,X'41'           IS ECB POSTED WITH ERROR A30746 25230000
         BE    FINDRW                   YES, POST RD TEXT BUFFER A30746 25250000
         B     EXIT                     IF NOT, EXIT             A30746 25270000
BACKUP   SH    CCWREG,K8                BACK UP ONE CCW          A30746 25290000
         CLI   5(CCWREG),X'11'          IS THIS DATA CCW                25310000
         BNE   BKP                      IF NOT, LOOP                    25330000
         CLI   0(CCWREG),X'02'          IS COMMAND READ                 25350000
         BE    EXIT                     IF SO, EXIT                     25370000
         TM    4(CCWREG),DATAC          IS THIS LAST WRITE CCW          25390000
         BZ    RRR                      IF SO, DATA CHAINING BIT IS OFF 25410000
         SH    CCWREG,K16               IF NOT, BACK UP 2 MORE CCW'S    25430000
RRR      SH    ICREG,K8                 SUBTRACT 8 FROM MULTIPLIED OFST 25450000
         BM    BFRPOST                  IF MINUS THIS IS READ RESPONSE  25470000
         MVI   CODEMSK,X'7F'            IF NOT, POST WITH 7F            25490000
         B     BFRPOSTA                                                 25510000
TP21AB   CLI   DECTYPE+1,OPTPWTN        WRITE TN?  IF NOT,         000A 25530000
         BE    CHKEOCP                  DO NOT BRANCH              000C 25550000
         CLI   DECTYPE+1,OPTPWTD        WRITE TD    IF NOT,        000C 25570000
         BNE   TP2A                BRANCH.                         000A 25590000
CHKEOCP  TM    5(CCWREG),TPEOCP         END OF CHANNEL PROGRAM     000C 25610000
         BO    TP2A                IF SO, BRANCH.  IF NOT, GET     000A 25630000
         LA    CCWREG,8(CCWREG)    ADDRESS OF NEXT CCW AND GO TO   000A 25650000
         B     REXIT               RESTART CHANNEL PROGRAM ON NEXT 000A 25670000
*                                  CCW (DISABLE COMMAND).          000A 25690000
*              ONE LINE DELETED BY---------------------------->@ZA14130 25710000
*        SPACE 3                                                        25730000
*              TP OP CODE = 23  WRITE BREAK OR 2740 BREAK TEST          25750000
         SPACE 2                                                   000I 25770000
*                                                                  000I 25790000
BRKTST   CLI   0(CCWREG),PREP           2741 BREAK TEST            000I 25810000
         BNE   EXIT                     NO                         000I 25830000
PWROFF   NI    IOBFLAG1,MASKALL-IOBEX   TURN OFF IOBEXCEPTION      000I 25850000
         NI    IOBINCAM,MASKALL-BUSY    SET OFF BUSY BIT           000I 25870000
         MVI   IOBECBPT,CCPER           SET ERROR RETURN CODE      000I 25890000
         TM    IOBCSW+4,CSWUC                                      000I 25910000
         BZ    BREAK                                               000I 25930000
         OI    DECFLAGS,X'04'                                      000I 25950000
         B     EXITREST                                            000I 25970000
BREAK    OI    DECFLAGS,X'02'                                      000I 25990000
         B     EXITREST                                            000I 26010000
         SPACE 2                                                   000I 26030000
*                             TP OP CODE = 25  READ RESP TO TEXT        26050000
         SPACE 1                                                        26070000
TP25     SR    ICREG,ICREG              CLEAR REGISTER             000B 26090000
         NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLG  000B 26110000
         LA    WREG,DECRESPN            LOAD ADDR OF RESP FIELD    000B 26130000
         LH    W2REG,6(CCWREG)         GET ORIGINAL COUNT         23134 26150000
*                                                                       26170000
*        5 LINES REMOVED FOR ----->                         LD @ZA02317 26190000
*                                                                       26210000
         CH    W2REG,IOBCSW+DISP6  IS COUNT GREATER THAN 2  LD @ZA02317 26230000
         BE    SETUE                                        LD @ZA02317 26250000
         IC    ICREG,IOBRCVPT                               LD @ZA02317 26270000
         LA    ICREG,DCBBSAK0(ICREG)                        LD @ZA02317 26290000
         CH    W2REG,K2+TWO                                 LD @ZA02317 26310000
         BH    MOVERESP            MOVE RESP TO DECRESPN    LD @ZA02317 26330000
         CLI   IOBCSW+DISP7,ONE    1 BYTE RCVD IF CNT 1     LD @ZA02317 26350000
         BNE   DECRRESP            MUST BE TWO BYTES        LD @ZA02317 26370000
         B     NOTACK                                       LD @ZA02317 26390000
MOVERESP EQU   *                                            LD @ZA02317 26410000
         SH    W2REG,IOBCSW+RESIDCNT  SUBTRACT RSIDUAL COUNT    YA02162 26430000
         CH    W2REG,K1                 IS COUNT = 1?           YA02162 26450000
         BH    GETADDR                  NO, BRANCH              YA02162 26470000
         L     WREG,DECAREA           ADDR OF READ IN AREA  LD @ZA02317 26490000
         TM    DCBBFTEK,DYNBF           DYNAMIC BUFFERING?      YA02162 26510000
         BZ    CLRRESP                  NO, BRANCH              YA02162 26530000
         AH    WREG,K4                  INCR FOR BUFFER LINK    YA02162 26550000
CLRRESP  EQU   *                                                YA02162 26570000
         XC    DECRESPN(RESPNLNG),DECRESPN CLEAR RESP FIELD     YA02162 26590000
         MVC   DECRESPN(ONECHAR),DISP0(WREG) MOVE IN RESP       YA02162 26610000
*                                                                       26630000
*        3 LINES REMOVED FOR ----->                         LD @ZA02317 26650000
*                                                                       26670000
         B     NOTACK                                       LD @ZA02317 26690000
GETADDR  EQU   *                                                YA02162 26710000
         BAL   W2REG,FINDADDR           FIND ADDR OF RESP FIELD    000B 26730000
*                                                                       26750000
*        2 LINES DELETED FOR ----->                         LD @ZA02317 26770000
*                                                                       26790000
         MVC   DECRESPN(2),0(WREG)      PUT RESPONSE IN RESP FIELD 000F 26810000
DECRRESP EQU   *                                            LD @ZA02317 26830000
*                2 LINES DELETED BY THE FOLLOWING APAR          YA02161 26850000
*        1 LINE DELETED FOR ----->                          LD @ZA02317 26870000
*                                                                       26890000
         CLC   0(2,WREG),0(ICREG)       TEST FOR PROPER RESP       000E 26910000
         BE    RCVFLIP                  BRANCH IF SO               000F 26930000
         CLC   0(2,WREG),DCBBSSAK       CHECK FOR WACK             000J 26950000
         BNE   CHKRVI                   IF NOT, BRANCH             000F 26970000
         OI    DECFLAGS,WACKRCV         INDICATE WACK     RECVD    000J 26990000
         B     TP25A                    GO CHECK FOR CONVERSAT   A32454 27010000
CHKRVI   CLC   0(2,WREG),DCBBSRVI       CHECK FOR REVERSE INTERRUPT000F 27030000
         BNE   CHKACK                   IF NOT, CHECK OTHER ACK    000F 27050000
         OI    DECFLAGS,RVIRCV          INDICATE REVERSE INTERRUPT 000F 27070000
         XI    IOBINCAM,CKRVIRPT   TURN ON SWITCH IF PROPER RVI;   000J 27090000
*   SWITCH WAS TURNED OFF BY "RCVFLIP";  TURN OFF IF INPROPER      000J 27110000
         TM    IOBINCAM,CKRVIRPT   PROPER RVI? PROPER ONLY IF      000J 27130000
*                                        INTERVENING  ACK0-1       000J 27150000
         BO    RCVFLIP1            IN PLACE OF ACK PTR             000J 27170000
         B     SETUE               NO, SET UE FOR ERP              000J 27190000
RCVFLIP  NI    IOBINCAM,STRVIRPT   TURN OFF RVI SWITCH; PROPER     000J 27210000
         NI    DECFLAGS,OKACK                                      000J 27230000
RCVFLIP1 XI    IOBRCVPT,FLIP       UPDATE ACK POINTER              000J 27250000
         NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION      000E 27270000
         TM    5(CCWREG),TPEOCP         IS THIS LAST CCW           000E 27290000
         BO    CHKONLT1                 COMPLETE PROCESSING        000F 27310000
         TM    13(CCWREG),TPRESET       IS NEXT CCW RESET OPERATION000F 27330000
         BO    REXITB                   YES, EXECUTE               000F 27350000
CHKONLT1 TM    DECDCBAD,ONLTRFT        WAS ONLTST MACRO USED     A28612 27370000
         BZ    TP25A                    IF NOT, BRANCH           A32454 27390000
         L     WREG,DECAREA             GET ADDR OF TEXT AREA      000D 27410000
         TM    DCBBFTEK,DYNBF           IS DYNAMIC BUFFERING USED  000D 27430000
         BZ    STOREREG                 NO, STORE ADDR IN IOB      000D 27450000
         AH    WREG,K4                  INCREMENT FOR BUFFER LINK  000D 27470000
STOREREG ST    WREG,IOBERINF                                       000D 27490000
         TM    DECTYPE+1,ONLTTSTW       IS THE OPERATION WR TI     000D 27510000
         BZ    EXITONLT                 IF SO, GO SCHEDULE ONLT    000D 27530000
         NI    DECDCBAD,MASKALL-ONLTRFT   TURN ONLTST BIT OFF    A28612 27550000
         B     TP25A                    GO CHECK FOR CONVERSAT   32454  27570000
CHKACK   X     ICREG,K2                 POINT TO OTHER ACK         000B 27590000
         CLC   0(2,WREG),0(ICREG)       TEST FOR WRONG ACK         000E 27610000
         BNE   NOTACK                   IF NOT, IT'S SOMETHING ELSE000B 27630000
         OI    DECFLAGS,WRONGACK        SETON WRONG ACK BIT        000B 27650000
         B     SETUE                                               000B 27670000
*                                                                       27690000
*        2 LINES DELETED FOR ----->                         LD @ZA02317 27710000
*                                                                       27730000
NOTACK   EQU   *                                            LD @ZA02317 27750000
         OI    DECFLAGS,IMPRESP         SET NO ACK RECEIVED BIT YA02161 27770000
         CLC   0(1,WREG),DCBBSEOT       CHECK FOR EOT              000B 27790000
         BNE   TP25CONV                 BRANCH IF NOT            A32454 27810000
RESETACK EQU   *                                                 A32454 27830000
         NI    IOBRCVPT,ACK0PT          RESET ACK POINTER        A25664 27850000
         B     TP25A                                             A32454 27870000
TP25CONV CLC   1(1,WREG),DCBBSEOT       CHECK EOT ON CONVERSAT   A32454 27890000
         BE    RESETACK                 BRANCH IF YES            A32454 27910000
         TM    DCBXMODE,INTBLCHK        INTERMEDIATE BLOCK CHECK A32454 27930000
         BZ    CKETXETB                 NO, BRANCH               A32454 27950000
         BCTR  WREG,0                   YES, ADJUST POINTER      A32454 27970000
CKETXETB CLC   1(1,WREG),DCBBSETX       CHECK FOR ETX            A32454 27990000
         BE    TP25A                    YES, BRANCH              A32454 28010000
         CLC   1(1,WREG),DCBBSETB       CHECK FOR ETB            A32454 28030000
         BE    TP25A                    YES, BRANCH              A32454 28050000
SETUE    OI    IOBCSW+4,CSWUE           SET ON UNIT EXCEPTION      000B 28070000
         OI    IOBFLAG1,IOBEX           SET IOB EXCEPTION          000B 28090000
TP25A    EQU   *                                                 A32454 28110000
         CLI   DECTYPE+DISP1,X84   WRT CONT RESET(TTR)      LD @ZA02321 28130000
         BE    TP25B                                        LD @ZA02321 28150000
         CLI   DECTYPE+DISP1,X82   WRT INIT RESET(TIR)      LD @ZA02321 28170000
         BE    TP25B                                        LD @ZA02321 28190000
TP25C    EQU   *                                            LD @ZA02321 28210000
         CLI   DECTYPE+1,X'16'          WRITE ENQ                A32454 28230000
         BE    TP25CC                   YES, BRANCH            @ZA04852 28250000
         TM    DECTYPE+1,WRTIV          WRITE CONVERSATIONAL     A32454 28270000
         BNO   TP2A                                              A32454 28290000
SNDFLIP  CLC   DISP0(TWO,WREG),DCBBSSAK  WAS WACK RECEIVED?    @ZA04852 28310000
         BE    CHKDB               YES, DON'T UPDATE ACK PTRS   YA01027 28330000
*               ONE LINE DELETED FOR THE FOLLOWING APAR         YA02163 28350000
         CLC   ONE(ONE,WREG),DCBBSETX    CHECK FOR ETX         @ZA07638 28370000
         BNE   CHKDB            NO BRANCH                      @ZA07638 28390000
         XI    IOBSNDPT,FLIP         UPDATE SND ACK PRT        @ZA07638 28410000
         XI    IOBRCVPT,FLIP         UPDATE RCV ACK PRT        @ZA07638 28430000
CHKDB    EQU   *                                                YA01027 28450000
         TM    DCBBFTEK,X'08'      DYNAMIC BUFFER                A32454 28470000
         BZ    CHKONLTS                 NO, BRANCH               A32454 28490000
         LA    UCBREG,TP25AA                                     A32454 28510000
         B     TP2AA                                             A32454 28530000
TP25CC   LH    W2REG,DISP6(CCWREG) GET ORG COUNT 2 OR 20       @ZA04852 28550000
         CH    W2REG,IOBCSW+DISP6  IS COUNT GREATER THAN 2     @ZA04852 28570000
         BNH   TPXX                                            @ZA04852 28590000
* WREG POINTS TO END OF DATA-2 ( OR DATA-3 IF ITB)             @ZA04852 28610000
         CLC   ONE(ONE,WREG),DCBBSETX    ETX ?                 @ZA04852 28630000
         BE    SNDFLIP                                         @ZA04852 28650000
         CLC   ONE(ONE,WREG),DCBBSETB        ETB ?             @ZA04852 28670000
         BE    SNDFLIP                                         @ZA04852 28690000
         B     TPXX                                            @ZA04852 28710000
TP25B    EQU   *                                            LD @ZA00536 28730000
         SR    ICREG,ICREG         CLEAR REG                L5 @ZA03966 28750000
         IC    ICREG,IOBRCVPT      GET ACK POINTER          L5 @ZA03966 28770000
         LA    ICREG,DCBBSAK0(ICREG)  GET EXPECTED ACK      L5 @ZA03966 28790000
         CLC   0(2,WREG),0(ICREG)  CORRECT ACK              L5 @ZA03966 28810000
         BE    TP25BA              YES,CHECK FOR RESET      L5 @ZA03966 28830000
         B     CHKDB               NO, DON'T WRITE EOT      L5 @ZA03966 28850000
TP25BA   EQU   *                                            L5 @ZA03966 28870000
         TM    DISP13(CCWREG),TPRESET  IS NXT CCW RESET OP  LD @ZA00536 28890000
         BO    REXITB              YES                      LD @ZA02321 28910000
         B     TP25C               NO, CHK WRT ENQ          LD @ZA02321 28930000
TP25AA   EQU   *                                                 A32454 28950000
         L     CCWREG,IOBCSW            LOAD CCW ADDRESS         A32454 28970000
         SH    CCWREG,K8                ADJUST TO PROPER CCW     A32454 28990000
         B     TPXX                     BRANCH TO POST RD BUFFER A32454 29010000
         SPACE 3                                                        29030000
FINDADDR L     WREG,0(CCWREG)           LOAD ADDRESS OF I/O AREA   000B 29050000
         AH    WREG,6(CCWREG)           ADD MESSAGE LENGTH         000B 29070000
         SH    WREG,IOBCSW+6            SUBTRACT RESIDUAL COUNT    000B 29090000
         SH    WREG,K2+2                SUBTRACT TWO               000B 29110000
         BR    W2REG                    RETURN                     000B 29130000
         SPACE 3                                                        29150000
TPXX     TM    DCBBFTEK,X'08'           TEST FOR DYNAMIC BUFFERING      29170000
         BZ    EXIT                     NO                              29190000
         LA    UCBREG,EXIT                                         1838 29210000
FINDRW   TM    5(CCWREG),X'10'          FIND 1ST R/W DATA COMMAND       29230000
         BO    BFRPOST                  IF 1ST PCI BIT FOUND            29250000
         TM    5(CCWREG),TPEOCP         TEST FOR END OF CHNL PROGRAM    29270000
         BO    EXIT                     IF SO, EXIT                     29290000
         LA    CCWREG,8(CCWREG)         STEP TO NEXT CCW                29310000
         B     FINDRW                                                   29330000
         EJECT                                                          29350000
         SPACE 3                                                        29370000
*                             POST BUFFER ROUTINE                       29390000
         SPACE                                                          29410000
BFRPOST  MVC   CODEMSK(1),IOBECBPT                                      29430000
BFRPOSTA TM    IOBFLAG1,X'04'           IS IOB EXCEPTION FLAG ON        29450000
         BZ    OKPOST                   IF NOT, BRANCH TO POST          29470000
         CLI   IOBECBPT,X'7F'           CHECK FOR NOMRAL COMPLETION     29490000
         BE    EXIT                                                     29510000
         CLI   5(CCWREG),X'13'          IS THIS WR DLE STX       A32465 29530000
         BNE   OKPOST                   NO, BRANCH               A32465 29550000
         TM    DCBBFTEK,X'08'           DYNAMIC BUFFERING        A32465 29570000
         BZ    WRTEXT1                  NO, BRANCH               A32465 29590000
         LA    CCWREG,0(CCWREG)         ZERO HI-ORDER BYTE       A32465 29610000
         LR    BUFREG,CCWREG            LOAD INTO BUFREG         A32465 29630000
WRTEXT   SH    BUFREG,K8                BACKUP TO PREV CCW       A32465 29650000
         L     UCBREG,0(BUFREG)         LOAD DATA AREA           A32465 29670000
         LA    UCBREG,0(UCBREG)         ZERO HI-ORDER BYTE       A32465 29690000
         CR    UCBREG,CCWREG            IS THIS TIC CCW          A32465 29710000
         BNE   WRTEXT                   NO, BRANCH               A32465 29730000
         LR    CCWREG,BUFREG            LOAD WR DATA CCW         A32465 29750000
         LA    UCBREG,EXIT              LOAD EXIT REG            A32465 29770000
WRTEXT1  SH    CCWREG,K8                BACK UP TO WR TEXT       A32465 29790000
OKPOST   L     BUFREG,0(CCWREG)         LOAD BUFFER ADDRESS             29810000
         LA    BUFREG,0(BUFREG)        CLEAR OUT HIGH ORDER BYTE A27621 29830000
         LTR   BUFREG,BUFREG           TEST FOR ADDRESS OF ZERO  A27621 29850000
         BCR   8,UCBREG                BRANCH IF YES             A27621 29870000
         SH    CCWREG,K8           SUB 8 PREV CCW           LD @ZA02312 29890000
         TM    DISP5(CCWREG),RDRESP CHK RD RESP TXT OP-CODE LD @ZA02312 29910000
         BNO   NOT25               IF NOT BRANCH            LD @ZA02312 29930000
         L     BUFREG,DISP8(CCWREG)  LOAD DATA RD TXT       LD @ZA02312 29950000
         SH    BUFREG,TWENTY       SUB CNT RD RESP CCW      LD @ZA02312 29970000
         CL    BUFREG,0(CCWREG)    EQ DATA ADD OF RESP      LD @ZA04157 29990000
         BNE   NOT25               TEST CCW ? IF NOT BR     LD @ZA02312 30010000
         AH    CCWREG,K8           RESTORE CCWREG           LD @ZA02312 30030000
         B     TWENTY5             AND CONTINUE             LD @ZA02312 30050000
NOT25    EQU   *                                            LD @ZA02312 30070000
         AH    CCWREG,K8                                    LD @ZA02312 30090000
         L     BUFREG,0(CCWREG)        LOAD BUFFER ADDRESS       A27621 30110000
TWENTY5  EQU   *                                            LD @ZA02312 30130000
         N     BUFREG,MASKDB            AND TO WORD BOUNDARY            30150000
         SH    BUFREG,K4                SUB TO LINK FIELD               30170000
         TM    15(CCWREG),X'01'        CHECK FOR PREVIOUS PCI      1265 30190000
         BO    ECBREG0                 YES, DON'T POST AGAIN       1265 30210000
         CLI   0(CCWREG),WRITE                                          30230000
         BNE   NORMPOST                                                 30250000
         TM    4(CCWREG),DATAC                                          30270000
         BO    NORMPOST                                                 30290000
ECBREG0  L     ECBREG,ZERO                                         1265 30310000
         B     ORCC                                                     30330000
NORMPOST L     ECBREG,8(CCWREG)         LOAD NEXT TEXT CCW       A38543 30350000
         N     ECBREG,MASKDB            AND TO WORD BOUNDARY            30370000
         L     ECBREG,0(ECBREG)         LOAD ADDRESS OF NEXT BUF A38543 30390000
         SH    ECBREG,K4                SUB TO LINK FIELD        A38543 30410000
         N     ECBREG,MASKDB            AND OFF COMMAND CODE            30430000
ORCC     O     ECBREG,CODEMSK           OR IN COMPLETION CODE           30450000
         LR    ZREG,BASEREG             SAVE BASE REGISTER.        000B 30470000
         LR    ICREG,BAS2REG           SAVE 2ND BASE REGISTER    A41115 30490000
         L     BASEREG,DEBTCBAD(DEBREG) LOAD ADDRESS OF TCB        000D 30510000
         L     WREG,SIXT                LOAD OFFSET TO POST ROUTINE     30530000
         USING CVT,WREG                 ESTABLISH CVT ADDR       Y02947 30550000
         L     BRREG,CVT0PT01           ADRS OF SUPVR POST RT    Y02947 30570000
         DROP  WREG                     DROP CVT ADDRESSABILITY  Y02947 30590000
         BALR  RETREG,BRREG             LINK TO POST ROUTINE            30610000
         LR    BASEREG,ZREG             RESTORE BASE REGISTER.     000B 30630000
         LR    BAS2REG,ICREG           RESTORE 2ND BASE REGISTER A41115 30650000
         L     ECBREG,IOBECBPT          RESTORE ADDRESS OF DECB         30670000
         BR    UCBREG                                              1838 30690000
         EJECT                                                          30710000
CHKONLT  EQU   *                                                   000L 30730000
         CLI   DECTYPE+1,RCONTONE       READ CONNECT WITH TONE     000L 30750000
         BE    LDUCB                                               000L 30770000
         TM    DECTYPE+1,X'01'          IS OPERATION READ        A24931 30790000
         BNO   EXIT2                    NO,EXIT                  A32477 30810000
LDUCB    EQU   *                                                   000L 30830000
         L     UCBREG,REG7(SAVEAREA)    PRIME UCB REGISTER       Y02947 30850000
         TM    UCBTYP+3(UCBREG),BISYNCH IS THIS BI-SYNCH           000D 30870000
         BNO   CHKONLTS                 CHECK START STOP           000D 30890000
         L     WREG,DECAREA             LOAD ADDRESS OF AREA       000M 30910000
         TM    DCBBFTEK,DYNBF           DYNAMIC BUFFERING SPECIFIED 00M 30930000
         BZ    NODYNBF                  NO, BRANCH                 000M 30950000
         LA    WREG,4(WREG)             INCREMENT PAST LINK FIELD  000M 30970000
NODYNBF  TM    UCBTYP+1(UCBREG),X'40'   MULTIPOINT LINE            000M 30990000
         BZ    PONTPT                   NO, BRANCH                 000M 31010000
         TM    DECTYPE+1,ONLTTSTR       IS THIS READ INITIAL       000M 31030000
         BNZ   PONTPT                   NO, BRANCH                 000M 31050000
         LA    WREG,1(WREG)             INCREMENT PAST INDEX BYTE  000M 31070000
PONTPT   CLC   0(2,WREG),DCBBSONL       ARE FIRST 2 CHARS SOH %    000M 31090000
         BNE   EXIT2                    NO, BYPASS               A32477 31110000
         TM    DCBXCODE,X'0C'           EBCDIC TRANSMISSION        000M 31130000
         BNZ   CHKASCII                 NO, CHECK UNASCII          000M 31150000
         CLI   MSGTYPE(WREG),EBSLASH    IS THIRD CHAR / ?               31170000
         BE    SETRVI                   GO SET UP TO CLEAR GEN POLL     31190000
         CLI   MSGTYPE(WREG),EBR        IS THIRD CHAR R ?               31210000
         BE    RMSGEBA             SENSE/STATUS MSG RCVD       @ZA14067 31230000
         CLC   2(1,WREG),EBS            THIRD CHAR S ?             000M 31250000
         BNE   CHKEC                    NO, CHECK FURTHER          000M 31270000
SETSTMSG OI    DECFLAGS,SMSG            SET ON STATUS MSG BIT      000M 31290000
         B     EXIT2                    BRANCH OUT               A32477 31310000
CHKEC    EQU   *                                                   000M 31330000
         CLC   2(1,WREG),EBE            THIRD CHARACTER E          000M 31350000
         BE    ERRMSG                   ERROR MESSAGE RECEIVED     000M 31370000
         CLC   2(1,WREG),EBC            CHARACTER C                000M 31390000
         BE    ERRMSG                   YES, HANDLE            @ZA04877 31410000
         TM    MSGTYPE(WREG),XF0       EBCDIC NUMERIC ?        @ZA04877 31430000
         BNO   EXIT2  NO, CAN'T BE AN RFT OR RECOGNIZED SENSE/ @ZA04877 31450000
*                        STATUS MESSAGE, SO TREAT AS DATA      @ZA04877 31470000
         B     TSTONLT                 YES, BRANCH             @ZA04877 31490000
CHKASCII TM    DCBXCODE,X'04'           USASCII TRANSMISSION       000M 31510000
         BNO   TSTONLT                  6-BIT, CHECK ONLT          000M 31530000
         CLI   MSGTYPE(WREG),USSLASH    IS THIRD CHAR / ?               31550000
         BE    SETRVI                   GO SET UP TO CLEAR GEN POLL     31570000
         CLI   MSGTYPE(WREG),USR        IS THIRD CHAR R ?               31590000
         BE    RMSGASC             SENSE/STATUS MSG RCVD                31610000
         CLC   2(1,WREG),USS           THIRD CHAR S?               000M 31630000
         BE    SETSTMSG                                                 31650000
CHKUCE   CLC   2(1,WREG),USE           THIRD CHAR E?               000M 31670000
         BE    ERRMSG                  YES, INDICATE ERROR MSG REC'D    31690000
         CLC   2(1,WREG),USC            ERROR MSG                  000M 31710000
*                               ONE LINE CODE DELETED BY------>@ZA14068 31730000
         BE    ERRMSG                   YES, HANDLE            @ZA04877 31750000
         TM    MSGTYPE(WREG),X30      ASCII NUMERIC ?          @ZA04877 31770000
         BNO   EXIT2 NO CAN'T BE AN RFT OR RECOGNIZED AS SENSE @ZA04877 31790000
*                 /STATUS MESSAGE, SO TREAT AS DATA.           @ZA04877 31810000
         B     TSTONLT                 YES, BRANCH             @ZA04877 31830000
ERRMSG   ST    WREG,IOBERINF            STORE AREA ADDRESS         000M 31850000
         OI    IOBCSW+4,CSWUE           SET ON UNIT EXCEPTION      000M 31870000
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION       000M 31890000
         B     EXIT2                                             A32477 31910000
TSTONLT  EQU   *                                                   000M 31930000
         TM    DCBERROP,ONLT            ARE TERMINAL TESTS SPEC'D  000D 31950000
         BZ    EXIT2                    IF NOT, DON'T TEST RFT   A32477 31970000
         B     TSTONLT2                 CHECK OPERATIONS         S99245 31990000
DIAL3270 EQU   *                                                 S99245 32010000
         MVC   MSGTYPE(DLRFTLNG,WREG),MSGSTART(WREG)             S99245 32030000
*                            CONVERT 3270 DIAL RFT TO BTAM STD   S99245 32050000
TSTONLT2 EQU   *                                                        32070000
         CLI   DECTYPE+1,RDINIT         IS THIS A READ INITIAL?         32090000
         BE    SETONLT                                                  32110000
         CLI   DECTYPE+1,RDCONECT       IS THIS A READ CONNECT          32130000
         BE    SETONLT                                                  32150000
         CLI   DECTYPE+1,RDCONT         IS THIS A READ CONTINUE ?       32170000
         BE    SETONLT             YES,CONTINUE OLT SET UP      YA01030 32190000
         CLI   DECTYPE+1,RCONTONE       READ CONNECT WITH TONE          32210000
         BNE   EXIT2                                             A32477 32230000
         B     SETONLT                                             000M 32250000
SETRVI   EQU   *                                                        32270000
         TM    DCBERROP,ONLT       ARE TERM TESTS SPEC'D                32290000
         BZ    EXIT2               NO  DON'T CONVERT                    32310000
         OI    IOBINCAM,RFTBIT     SET RFT REC'D FROM GEN POL CU        32330000
         TM    UCBTYP+1(UCBREG),BSC2    IS THIS BSC2?            S99245 32350000
         BO    DIAL3270          YES, GO CONVERT DIAL 3270 RFT   S99245 32370000
         MVC   MSGTYPE(MSGLNGTH,WREG),MSGSTART(WREG)  CONVERT           32390000
*                                       TO STANDARD BTAM RFT            32410000
         B     TSTONLT2                 CONTINUE CHECKING               32430000
RMSGEBA  EQU   *                                            LD @ZA02315 32450000
         TM    UCBTYP+ONE(UCBREG),BSC2  IS THIS BSC2 ?      LD @ZA02315 32470000
         BNO   RMSGEBC             BR IF NOT                LD @ZA02315 32490000
         NI    DECFLAGS,SOHRBIT1                            LD @ZA02315 32510000
         OI    DECFLAGS,SOHRBIT2                            LD @ZA02315 32530000
         CLC   DISP4(STATLNG,WREG),DEEBC  DVC END ALONE     LD @ZA02315 32550000
         BE    EXIT2               PROCESS NORMALLY         LD @ZA02315 32570000
         CLC   DISP4(TWO,WREG),DBEBC  DVC BUSY ALONE        LD @ZA02315 32590000
         BE    EXIT2               PROCESS NORMALLY         LD @ZA02315 32610000
         CLC   DISP4(TWO,WREG),DBOCEBC OP CK AND BUSY ALONE LD @ZA02315 32630000
         BNE   ERRMSG              NO,SCHEDULE ERP          LD @ZA02315 32650000
         B     EXIT2               PROCESS NORMALLY         LD @ZA02315 32670000
RMSGEBC  EQU   *                                                        32690000
         NI    DECFLAGS,SOHRBIT1   INDICATE SOH%R MSG RCVD              32710000
         OI    DECFLAGS,SOHRBIT2                                        32730000
         CLC   STAT(STATLNG,WREG),DEEBC DVC END ALONE                   32750000
         BE    EXIT2               YES, PROCESS NORMALLY                32770000
         CLC   STAT(STATLNG,WREG),DBEBC DVC BUSY ALONE                  32790000
         BE    EXIT2               YES, PROCESS NORMALLY                32810000
         CLC   STAT(STATLNG,WREG),DBOCEBC OP CHECK AND BUSY ALONE       32830000
         BNE   ERRMSG              NO, SCHEDULE ERP                     32850000
         B     EXIT2               PROCESS NORMALLY                     32870000
RMSGASC  EQU   *                                                        32890000
         NI    DECFLAGS,SOHRBIT1   INDICATE SOH%R RCVD                  32910000
         OI    DECFLAGS,SOHRBIT2                                        32930000
         CLC   STAT(STATLNG,WREG),DEASC DVC END ALONE                   32950000
         BE EXIT2                  YES,PROCESS NORMALLY                 32970000
         CLC   STAT(STATLNG,WREG),DBASC DVC BUSY ALONE                  32990000
         BE    EXIT2               YES, PROCESS NORMALLY                33010000
         CLC   STAT(STATLNG,WREG),DBOCASC OP CHECK AND BUSY ALONE       33030000
         BNE   ERRMSG              NO,SCHEDULE ERP                      33050000
         B     EXIT2               PROCESS NORMALLY                     33070000
CHKONLTS TM    DCBERROP,ONLT            ARE TERMINAL TESTS SPEC'D  000D 33090000
         BZ    EXIT2                    IF NOT, BYPASS ONLT TESTSA32477 33110000
         CLI   DECTYPE+1,RDINIT        IS THIS A READ INITIAL     M3962 33130000
         BE    CHKDECAR                YES, BRANCH                M3962 33150000
         TM    3(UCBREG),X'02'         IS DEVICE A 2740 CONSOLE         33170000
         BO    CHKDECAR                YES, ACCEPT ONLINE TEST          33190000
         CLI   DECTYPE+1,RDCONV        IS THIS A READ CONVERSATIONM3962 33210000
         BNE   EXIT2                    NO, BRANCH TO EXIT       A32477 33230000
CHKDECAR EQU   *                                                  M3962 33250000
         L     WREG,DECAREA             GET ADDRESS OF 1ST DATA    000D 33270000
         TM    DCBBFTEK,DYNBF           TEST FOR DYNAMIC BFR       000D 33290000
         BZ    CHK2260                                             000D 33310000
         AH    WREG,K4                  ADD 4 IF D.B. FOR LINK FLD 000D 33330000
CHK2260  CLI   19(UCBREG),TWNTY260      TEST FOR 2260              000D 33350000
         BNE   CHKCORR                                             000I 33370000
         CLC   2(5,WREG),NINE2260       COMPARE FOR 5 USASCII 9'S  000D 33390000
         BNE   EXIT2                    IF NOT, BRANCH OUT       A32477 33410000
         LA    WREG,2(WREG)            POINT TO FIRST CHAR OF MESSG     33430000
         B     SETONLT                                             000I 33450000
CHKCORR  CLI   16(UCBREG),C2741         TEST MODEL CODE            000I 33470000
         BNE   CHKNINE                                             000I 33490000
         CLC   0(5,WREG),CNINES         TEST FOR RFT (99999)       000I 33510000
         BE    SETONLT                                             000I 33530000
         B     EXIT2                                             A32477 33550000
CHKNINE  CLC   0(5,WREG),NINES          COMPARE FOR FIVE NINES     000D 33570000
         BE    SETONLT                  IF EQUAL, GO SET ONLT BIT  000D 33590000
         CLI   0(WREG),CIRCLED         IS FIRST CHAR CIRCLE D    A28625 33610000
         BE    CHK5NINE                YES, CHECK FOR 5 9'S      A28625 33630000
         TM    UCBTYP+1(UCBREG),AUTOPOL IS THIS AUTOPOLL         A28625 33650000
         BNO   EXIT2                    IF NO EXIT NO ONLT       A32477 33670000
CHK5NINE LA    WREG,1(WREG)            ADD 1 TO WORK REG         A28625 33690000
         CLC   0(5,WREG),NINES          CHECK POSITIONS 1 THRU 6   000D 33710000
         BE    SETONLT                 IF YES, SET ONLT           M2925 33730000
         TM    19(UCBREG),X'20'        TEST ADAPTER FOR 1030            33750000
         BNO   EXIT2                    IF NOT, EXIT             A32477 33770000
         TM    16(UCBREG),X'01'        TEST MODEL FOR 1030              33790000
         BNO   EXIT2                    IF NOT, EXIT             A32477 33810000
         LA    WREG,1(WREG)            ADD 1 TO WORK REG          M2925 33830000
         CLC   0(5,WREG),NINES         CHECK POSITIONS 2 THRU 7   M2925 33850000
         BNE   EXIT2                    NOT 1030 ONLT REQUEST    A32477 33870000
SETONLT  EQU   *                                                 A35733 33890000
         TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON ?    A35733 33910000
         BO    EXIT2                    YES, BRANCH              A35733 33930000
         OI    IOBINCAM,ONLTT           SETON ONLT IN PROGRESS   A35733 33950000
         ST    WREG,IOBERINF            STORE AREA ADDRESS         000D 33970000
*                ONE LINE DELETED BY-------------------------->@ZA14130 33990000
EXIT2    EQU   *                                                 A32477 34010000
         TM    DCBBFTEK,DYNBUF          DYN BUF SPECIFIED        A32477 34030000
         BZ    EXIT                     NO, EXIT                 A32477 34050000
         TM    IOBINCAM,ONLTT           ONLT IN PROGRESS         A32477 34070000
         BO    EXIT3                    YES,BRANCH               A32477 34090000
         TM    5(CCWREG),X'2E'         TP OPCODE NOT ''11'       A32477 34110000
         BNZ   EXIT                     NO, EXIT                 A32477 34130000
         TM    5(CCWREG),X'10'          TP OPCODE 10 OR 11       A32477 34150000
         BO    TP3POST1                 YES, POST BUFFER         A32477 34170000
         B     EXIT                     NO, EXIT                 A32477 34190000
EXIT3    EQU   *                                                        34210000
         TM    IOBCSW+4,X'F2'           ANY ERRORS               A32477 34230000
         BNZ   NOTONLT1                 IF SO, BRANCH            A32477 34250000
         TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON      A32477 34270000
         BO    NOTONLT1                 YES, BRANCH              A32477 34290000
         TM    DECTYPE+1,RESET          WAS RESET SPECIFIED      A32477 34310000
         BO    NOTONLT1                 YES, BRANCH              A32477 34330000
         B     EXIT                                              A32477 34350000
NOTONLT1 EQU   *                                                 A32477 34370000
         NI    IOBINCAM,X'FE'           TURN OFF ONLT BIT        A32477 34390000
         B     TP3POST1                                          A32477 34410000
BSC2ONLT EQU   *                   CHECK 3X TP OP CODE FOR ONLT  S99245 34430000
         TM    UCBTYP+3(UCBREG),BISYNCH  IS THIS BSC2?         @ZA06398 34450000
         BNO   EXIT                     NO, BRANCH               S99245 34470000
         TM    IOBINCAM,ONLTT      IS ON-LINE TEST IN PROGRESS   S99245 34490000
         BO    EXITONLT                 YES, SCHED ON-LINE TEST  S99245 34510000
         EJECT                                                          34530000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 34550000
*                TWO LINES DELETED BY------------------------->@ZA14130 34570000
EXIT     TM    DECTYPE,AUTOPOLL         IS THIS AN AUTOPOLL    @ZA14130 34590000
         BZ    BYPASS1             COMPLETION?  IF NOT, BRANCH.    000A 34610000
         L     WREG,DECPOLPT            LOAD POLLING LIST ADDRESS  000A 34630000
         LA    WREG,0(WREG)             CLEAR HIGH ORDER BYTE.     000A 34650000
         SH    WREG,K2+2                SUBTRACT TWO TO POINT AT   000B 34670000
*                                  NUMBER OF ACTIVE ENTRIES.       000A 34690000
         SR    ICREG,ICREG                                         000C 34710000
         IC    ICREG,1(WREG)            PICK UP FLAG BYTE.         000A 34730000
         TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON?       000A 34750000
         BZ    UPDATCNT            IF NOT, UPDATE USER COUNT.      000A 34770000
         CLI   IOBECBPT,CCNORM          NORMAL COMPLETION CODE?    000A 34790000
         BE    EXITAP              IF SO, BYPASS UPDATING USER     000A 34810000
UPDATCNT TM    IOBINCAM,ONLTT                                      000D 34830000
         BO    APOFF                                               000D 34850000
*    COUNT UNTIL THE ERROR ROUTINES HAVE COMPLETED THEIR RECOVERY  000A 34870000
*    PROCEDURES.                                                   000A 34890000
         TM    1(WREG),X'0F'       IF ALREADY 0                 YA01017 34910000
         BZ    APOFF               DON'T MAKE 15                YA01017 34930000
         BCTR  ICREG,0                  SUBTRACT ONE FROM FLAG     000D 34950000
         STC   ICREG,1(WREG)       BYTE AND STORE WITH DECREMENTED 000A 34970000
*                                  USER COUNT.                     000A 34990000
APOFF    NI    DECTYPE,MASKALL-AUTOPOLL TURN OFF AUTOPOLL          000D 35010000
*                                  OPERATION IN PROGRESS' FLAG.    000A 35030000
EXITAP   NOP   BYPASS              THIS IS A NOP/BRANCH SWITCH -   000A 35050000
*    IT WILL BE A NOP UNLESS THE CURRENT OPERATION IS AN AUTOPOLL  000A 35070000
*    OPERATION WHICH TERMINATED PRIOR TO THE READ INDEX COMMAND.   000A 35090000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 35110000
         SPACE 2                                                        35130000
         L     CCWREG,DECAREA           LOAD ADDRESS OF MESSAGE.   000A 35150000
         TM    DCBBFTEK,DYNBUF          IS DYNAMIC BUFFERING       000A 35170000
         BO    UPDAT1              SPECIFIED?  IF SO, BYPASS       000A 35190000
*    MOVING THE INDEX BYTE FROM THE MESSAGE AREA INTO DECPOLPT.    000A 35210000
*    THE PCI APPENDAGE(IGG019MC) WILL PERFORM THIS FUNCTION ON THE 000A 35230000
*    FIRST PCI INTERRUPT.                                          000A 35250000
*                                                                       35270000
         CLI   IOBCPA+8,POLL            IS THIS AN AUTOPOLL        000A 35290000
         BNE   UPDAT1              OPERATION?  IF NOT, BRANCH.     000A 35310000
*    IT COULD BE A READ REPEAT OPERATION INITIATED BY THE ERROR    000A 35330000
*    RECOVERY ROUTINES.                                            000A 35350000
         MVC   DECPOLPT(1),0(CCWREG)    SAVE INDEX BYTE.           000A 35370000
UPDAT1   EQU   *                                                        35390000
         SRL   ICREG,5                  SHIFT OUT ALL BUT ENTRY    000A 35410000
*                                  WIDTH FROM FLAG BYTE.           000A 35430000
         SR    UCBREG,UCBREG                                       000A 35450000
         IC    UCBREG,0(WREG)           PICK UP NUMBER OF ACTIVE   000A 35470000
*                                  ENTRIES TO USE AS MULTIPLICAND. 000A 35490000
         MR    CCW2REG,ICREG            MULTIPLY ENTRY WIDTH BY    000A 35510000
*                                  NUMBER OF ACTIVE ENTRIES.       000A 35530000
         LA    WREG,1(WREG)             ADJUST PNTR. TO FLAG BYTE. 000A 35550000
         LR    CCW2REG,WREG             LOAD FLAG BYTE ADDRESS     000A 35570000
         AR    CCW2REG,UCBREG      AND ADD ACTIVE ENTRIES BYTE     000A 35590000
*    COUNT TO POINT AT INDEX BYTE IN LAST ACTIVE ENTRY.            000A 35610000
         LR    CCWREG,WREG              LOAD ADDRESS OF FLAG BYTE. 000A 35630000
         IC    W2REG,DECPOLPT           PICK UP INDEX BYTE.        000A 35650000
LOOPINDX CR    WREG,CCW2REG        END OF ACTIVE ENTRY LIST?       000A 35670000
         BE    UPDAT2              IF SO, BRANCH.                  000A 35690000
         AR    CCWREG,ICREG             ADJUST INDEX POINTER TO    000A 35710000
*                                  NEXT INDEX BYTE.                000A 35730000
         EX    W2REG,COMPARE            COMPARE INDEX TO ENTRY     000A 35750000
         BE    STORE               INDEX.  IF EQUAL, BRANCH.       000A 35770000
         AR    WREG,ICREG               ADJUST 'ENTRY MINUS ONE'   000A 35790000
*                                  POINTER TO NEXT ENTRY MINUS ONE.000A 35810000
         B     LOOPINDX                                            000A 35830000
COMPARE  CLI   0(CCWREG),0                                         000A 35850000
UPDAT2   OI    DECFLAGS,NOCOMPAR        SET FLAG INDICATING THAT   000A 35870000
*    THE INDEX DID NOT EQUAL THE INDEX BYTE IN ANY OF THE          000A 35890000
*    ACTIVE ENTRIES IN THE LIST.  THIS COULD BE CAUSED BY A CONTROL000A 35910000
*    UNIT FAILURE WHICH GARBLED THE INDX, OR BY A PROGRAM ERROR    000A 35930000
*    WHICH CLOBBERED THE LIST ADDRESS(DECPOLPT), THE INDEX ITSELF  000A 35950000
*    (THE MESSAGE AREA), OR WHICH SPECIFIED AN INVALID LIST(E.G.,  000A 35970000
*    THE WRONG NUMBER OF POLLING CHARACTERS PER ENTRY).            000A 35990000
*                                                                  000A 36010000
         B     BYPASS1                                             000A 36030000
STORE    LA    WREG,1(WREG)             ADJUST 'ENTRY MINUS ONE'   000A 36050000
*                                  TO BEGINNING OF ENTRY.          000A 36070000
         ST    WREG,DECENTRY            UPDATE DECENTRY.           000A 36090000
         NI    DECFLAGS,MASKALL-NOCOMPAR                           000B 36110000
BYPASS   MVI   EXITAP+1,NOP             CHANGE BRANCH TO A NOP.    000A 36130000
BYPASS1  TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON?       000A 36150000
         BO    EXIT0                    IF SO, EXIT                     36170000
         TM    IOBINCAM,ONLTT           IS ONLINE TEST FLAG ON     000D 36190000
         BO    EXITONLT                                            000D 36210000
         TM    DCBERROP,LERCNT          ARE LINE ERROR COUNTS SPECIFIED 36230000
         BZ    EXIT1                    IF NOT, EXIT                    36250000
         SR    ICREG,ICREG              RESET REGISTER 1                36270000
         IC    ICREG,IOBUCBX            LOAD LINE NUMBER                36290000
         LA    W2REG,20                 MULTIPLY BY SIZE OF ERROR BLK   36310000
         MR    WREG,ICREG                                               36330000
         A     W2REG,DCBLERB            ADD ERROR BLOCK START ADDRESS   36350000
         IC    ICREG,CNT(W2REG)         LOAD TRANSMISSION COUNT         36370000
         LA    ICREG,1(ICREG)           ADD 1                           36390000
         STC   ICREG,CNT(W2REG)         UPDATE TRANSMISSION COUNT       36410000
         SR    WREG,WREG                CLEAR W REG.          @ZA14069  36430000
         IC    WREG,CNTT(W2REG)                                         36450000
         CR    ICREG,WREG               COMPARE TO THRESHHOLD COUNT     36470000
         BNE   EXIT1                                                    36490000
         A     WREG,CTNT(W2REG)         IF EQUAL, UPDATE TOTALS         36510000
         ST    WREG,CTNT(W2REG)                                         36530000
         SR    WREG,WREG                                                36550000
         IC    WREG,CDC(W2REG)          UPDATE TOTAL DATA CHECKS,       36570000
         SLL   WREG,16                                                  36590000
         IC    WREG,CIR(W2REG)                       INTERVENTIONS REQ, 36610000
         A     WREG,CTDC(W2REG)                                         36630000
         ST    WREG,CTDC(W2REG)                                         36650000
         SR    WREG,WREG                                                36670000
         IC    WREG,CTO(W2REG)                       TIME OUTS          36690000
         AH    WREG,CTTO(W2REG)                                         36710000
         STH   WREG,CTTO(W2REG)                                         36730000
         XC    CNT(4,W2REG),CNT(W2REG)               RESET COUNTERS     36750000
         B     EXIT1                                                    36770000
*                47 LINES DELETED BY (D/B V=V)---------------->@ZA14130 36790000
SOHRCOMP EQU   *                                                        36810000
         TM    DECTYPE,AUTOPOLL    AUTOPOLL OPERATION?          YA01020 36830000
         BZ    GOONOUT             NO, NO USER COUNT            YA01020 36850000
         L     WREG,DECPOLPT       LOAD POLLING LIST ADR        YA01020 36870000
         LA    WREG,0(WREG)        CLEAR HIGH BYTE              YA01020 36890000
         SH    WREG,K2+2           SUB 2 TO POINT AT            YA01020 36910000
*                                  NUMBER OF ACTIVE ENTRIES     YA01020 36930000
         SR    ICREG,ICREG         CLEAR A WORK REG             YA01020 36950000
         IC    ICREG,1(WREG)       PICK UP FLAG BYTE            YA01020 36970000
         TM    1(WREG),X'0F'       IF ALREADY ZERO,             YA01020 36990000
         BZ    GOONOUT             DON'T MAKE IT NEGATIVE       YA01020 37010000
         TM    IOBFLAG1,IOBEX      IOB EXCEPTION?               YA01020 37030000
         BZ    SOHRCMP1            NO, GO AHEAD AND DECREMENT   YA01020 37050000
         CLI   IOBECBPT,CCNORM     NORMAL COMPLETION?           YA01020 37070000
         BE    GOONOUT             YES, NO NEED TO DECREMENT    YA01020 37090000
SOHRCMP1 EQU   *                   DECREMENT USER COUNT         YA01020 37110000
         BCTR  ICREG,0             SUB 1 FROM FLAG              YA01020 37130000
         STC   ICREG,1(WREG)       BYTE AND STORE WITH          YA01020 37150000
*                                  DECREMENTED USER COUNT       YA01020 37170000
GOONOUT  EQU   *                                                YA01020 37190000
         NI    IOBINCAM,SOHRBUSY   TURN OFF SOH%R PROCESSING            37210000
*                                  COMPLETE AND BUSY BITS               37230000
         NI    DECTYPE,X'FF'-AUTOPOLL TURN OFF DECB AUTOPOLL    YA03238 37250000
         TM    UCBTYP+DISP1(UCBREG),BSC2 IS THIS DIAL (BSC2)?   YA01275 37270000
         BNO   EXIT1                    NO, RETURN              YA01553 37290000
         L     WREG,DECAREA             GET ADDR OF SOH%R MSG   YA01275 37310000
         ST    WREG,IOBERINF            SAVE IN IOB             YA01275 37330000
         B     EXIT1                    GO CLEAN UP & RETURN    YA01553 37350000
EXIT0    CLI   IOBECBPT,CCNORM          TEST FOR NAMAL COMPLETION       37370000
         BE    EXITREST                 IF NORMAL, BRANCH               37390000
EXIT1    NI    IOBINCAM,MASKALL-BUSY    SET OFF BUSY BIT                37410000
         L     CCWREG,IOBCSW            LOAD ADDRESS INTO REG           37430000
         SH    CCWREG,K8                SUBTRACT 8                      37450000
         MVC   DECCMCOD,0(CCWREG)       MOVE COMMAND CODE,              37470000
         MVC   DECTPCOD,5(CCWREG)            TP OP CODE,                37490000
         MVC   DECSENS0(2),IOBSENS0          SENSE BYTES,               37510000
         MVC   DECCOUNT(2),IOBCSW+6          RESIDUAL COUNT AND         37530000
*              TEN LINES OF CODE REMOVED BY AZ03588            @ZA03588 37550000
*              THE CODE REMOVED WAS FOR ZA00529                @ZA03588 37570000
EXITBRK1 MVC   DECCSWST(2),IOBCSW+4          CSW STATUS TO DECB         37590000
         MVI   DECDCBAD,X'00'           RESET BUFFER COUNTER            37610000
         L     WREG,REG7(SAVEAREA)      GET ADDRESS OF UCB       Y02947 37630000
         CLI   DECTYPE+1,WRRSTMON       WRT RESET MONITOR ?    @ZA31078 37650000
         BNE   EXITREST                 IF NOT BRANCH          @ZA31078 37670000
         CLI   5(CCWREG),X'08'          WRT EOT CCW ?          @ZA31078 37690000
         BNE   EXITREST                 IF NOT BRANCH          @ZA31078 37710000
         LA    CCWREG,8(CCWREG)         GET ADD OF NEXT CCW    @ZA31078 37730000
         ST    CCWREG,IOBSTART          STORE CCW START ADD    @ZA31078 37750000
         TM    IOBFLAG2,RESETPL         RESETPL ISSUED ?       @ZA31078 37770000
         BNO   REXIT                    CONTINUE CHANNEL PROG  @ZA31078 37790000
         MVI   IOBECBPT,X'48'           INDICATE HIO COMP CODE @ZA31078 37810000
*                 6 LINES REMOVED BY-------------------------->@ZA14070 37830000
EXITREST LM    RETREG,SAVEAREA,DISP0(SAVEAREA) RESTORE REGS      Y02947 37850000
         BR    RETREG                   RETIRN TO IOS                   37870000
         SPACE 3                                                        37890000
REXITA   XC    DECRESPN(2),DECRESPN     CLEAR DECB RESPONSE FIELD  000E 37910000
REXITB   LA    CCWREG,8(CCWREG)         UPDATE CCW POINTER         000E 37930000
REXIT    ST    CCWREG,IOBSTART          STORE CCW START ADDRESS         37950000
REXIT1   NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      37970000
         LM    RETREG,SAVEAREA,DISP0(SAVEAREA)  RESTORE REGS     Y02947 37990000
         B     8(RETREG)                RETURN TO IOS+8                 38010000
ERREXIT  LM    RETREG,SAVEAREA,DISP0(SAVEAREA)  RESTORE REGS     Y02947 38030000
         B     4(RETREG)                RETURN TO IOS + 4               38050000
EXITONLT L     UCBREG,DEBIRBAD(DEBREG)  GET ADDRS OF POINTER TO IRB000E 38070000
         L     UCBREG,0(UCBREG)         GET ONLT IRB ADDRESS       000E 38090000
         BAL   WREG,IQESETUP            BRANCH TO SET UP IQE'S     000E 38110000
         B     ONLTEXIT                 ASYNCH                     000E 38130000
*                    4 LINES REMOVED BY----------------------->@ZA14070 38150000
NOIQE    OI    DECERRST,SNO            SET SHOULD NOT OCCUR      A43784 38170000
         MVI   IOBECBPT,CCPER          INDICATE PERM ERROR       A43784 38190000
*                   2 LINES REMOVED BY------------------------>@ZA14070 38210000
         B     EXIT1                                             A43784 38230000
IQESETUP EQU   *                                                 A43784 38250000
*             TWO LINES DELETED FOR THE FOLLOWING APAR          YA02165 38270000
         L     ICREG,96(UCBREG)        LOAD 1ST IQE ADDRESS      A43784 38290000
         LA    ICREG,0(ICREG)           CLEAR HIGH ORDER BYTE  @ZA14071 38310000
         LTR   ICREG,ICREG             IS THERE AN IQE ADDR?    YA02165 38330000
         BZ    NOIQE                   NO, FLAG AS AN ERROR     YA02165 38350000
         MVC   96(4,UCBREG),0(ICREG)    DEQUEUE                    000E 38370000
         XC    0(4,ICREG),0(ICREG)      ZERO LINK FIELD            000D 38390000
         ST    IOBREG,4(ICREG)          STORE IOB ADRS AS PARM     000D 38410000
*                 1 LINE REMOVED BY--------------------------->@ZA14071 38430000
         LCR   ICREG,ICREG              COMPLEMENT THE ADDRESS     000D 38450000
         L     BRREG,SIXT               LOAD CVT ADDRESS           000D 38470000
         USING CVT,BRREG                ESTABLISH CVT ADDR       Y02947 38490000
         L     BRREG,CVT0EF00           LOAD ASYNCH RT ADDRESS   Y02947 38510000
         DROP  BRREG                  DROP CVT ADDRESSABILITY    Y02947 38530000
         BALR  RETREG,BRREG             LINK TO SCHEDULE ROUTINE   000E 38550000
         L     BAS2REG,DISP4(SAVEAREA) RESTORE                   Y02947 38570000
         A     BAS2REG,FOURK                   SECOND BASE       Y02947 38590000
         BR    WREG                                                000E 38610000
*                                                                  000I 38630000
EXITBRK  EQU   *                                                   000I 38650000
         CLI   0(CCWREG),X'01'          IS COMMAND WRITE           000I 38670000
         BNE   PWROFF                                              000I 38690000
         MVC   DECCMCOD,0(CCWREG)       MOVE COMMAND CODE,       A33942 38710000
         MVC   DECTPCOD,5(CCWREG)       TP OP CODE,              A33942 38730000
         MVC   DECSENS0(2),IOBSENS0     SENSE BYTES,             A33942 38750000
         MVC   DECCOUNT(2),IOBCSW+6     RESIDUAL COUNT,          A33942 38770000
         MVC   DECCSWST(2),IOBCSW+4     AND CSW STATUS TO DECB   A33942 38790000
         L     UCBREG,DEBIRBAD(DEBREG)  GET ADDRS OF POINTER TO IRB     38810000
         LA    UCBREG,DISP0(UCBREG)  CLEAR HI BYTE          LD @ZA02324 38830000
         LTR   UCBREG,UCBREG       TEST FOR ZERO ADDRESS    LD @ZA02324 38850000
         BZ    NOIQE               BR IF ZERO ADDRESS       LD @ZA02324 38870000
         L     UCBREG,8(UCBREG)         GET 2741 BREAK IRB ADDRESS      38890000
         BAL   WREG,IQESETUP            BRANCH TO SET UP IQE'S          38910000
*                                                                  000I 38930000
ONLTEXIT LM    RETREG,SAVEAREA,DISP0(SAVEAREA)  RESTORE REGS     Y02947 38950000
         B     4(RETREG)                RETURN TO IOS + 4          000D 38970000
         EJECT                                                          38990000
K2       DC    F'2'                     TWO                        000B 39010000
CODEMSK  DC    F'0'                                                     39030000
MASKDB   DC    X'00FFFFFC'                                              39050000
TPMSK    DC    X'0000000F'                                              39070000
SETMSK   DC    X'00100000'                                     @ZA15402 39090000
RESETMSK DC    X'FFEFFFFF'                                     @ZA15402 39110000
ZERO     DC    F'0'                                                     39130000
ZERO3    DC    X'000000'                                           000L 39150000
K4       DC    H'4'                     MUST FOLLOW A ZERO FIELD        39170000
K1       DC    H'1'                     ONE                        000B 39190000
WA       DC    H'0'                                                     39210000
K8       DC    H'8'                                                     39230000
K16      DC    H'16'                                                    39250000
K32      DC    H'32'                                        LD @ZA02320 39270000
NINES    DC    5X'13'                   CODE FOR NINES             000D 39290000
TWENTY   DC    H'20'                                        LD @ZA02312 39310000
NINE2260 DC    5X'59'                   2260 CODE FOR NINES        000D 39330000
SPACEY   DC    X'0176'                                             1263 39350000
SPACEN   DC    X'0140'                                             1263 39370000
CNINES   DC    X'1616161616'            CORRESPONDENCE CODE        000I 39390000
C2741    EQU   X'55'                    2741 CORRS                 000I 39410000
DPREO    DC    X'163E4C'                CIRCLE D PRE O (2760)      000K 39430000
         DS    0F                                               YA03265 39450000
LIST     DC    X'80000000'              LIST FORM                Y02947 39470000
THREE20  DC    H'320'                   LENGTH OF BOTH IDALS     Y02947 39490000
SAVE19MS DC    18F'0'                   SAVEAREA FOR BUFFER      YM4063 39510000
*                                       ROUTINE (IGG019MS)       YM4063 39530000
A0       EQU   X'A0'                                           @ZA04650 39550000
SPFLAG   EQU   X'9F'          SPECIAL FLAG SET BY 504C         @ZA04679 39570000
DEBIRBAD EQU   8                        OFSET TO IRB ADDRESS       000D 39590000
DEBTCBAD EQU   0                        OFFSET TO TCB ADDRESS      000D 39610000
DEBNMEXT EQU   16                                                       39630000
DEBUCBAD EQU   32                                                       39650000
UCBFL1   EQU   6                        UCB FLAG 1                      39670000
CTNT     EQU   0                        TOTAL NUMBER TRANSMISSIONS      39690000
CTDC     EQU   4                        TOTAL NUMBER DATA CHECKS        39710000
CTIR     EQU   6                        TOTAL NUMBER INTERVENTIONS REQ  39730000
CTTO     EQU   8                        TOTAL NUMBER TIME OUTS          39750000
CNT      EQU   10                       NUMBER TRANSMISSIONS            39770000
CDC      EQU   11                       DATA CHECKS                     39790000
CIR      EQU   12                       INTERVENTIONS REQUIRED          39810000
CTO      EQU   13                       TIME OUTS                       39830000
CNTT     EQU   14                       THRESHHOLD TOTAL                39850000
FOXE     EQU   X'FE'                                                    39870000
CONNECT  EQU   X'DD'                                               000L 39890000
K0       EQU   X'00'                                               000L 39910000
RDINIT   EQU   X'01'                                               000L 39930000
RDCONV   EQU   X'05'                                              M3962 39950000
TPWIDENQ EQU   X'03'                                               000L 39970000
ONE      EQU   X'01'                                               000L 39990000
TWO      EQU   X'02'                                               000L 40010000
SWLST    EQU   X'FF'                                               000L 40030000
RCONTONE EQU   X'1E'                                               000L 40050000
RDCONECT EQU   X'11'                                                    40070000
OPTPWTD  EQU   X'10'                                               000C 40090000
BRANCH   EQU   X'F0'                                               000A 40110000
NOP      EQU   X'00'                                               000A 40130000
AUTOPOLL EQU   X'80'                                               000A 40150000
DYNBUF   EQU   X'08'                                               000A 40170000
ARMSEEK  EQU   X'02'                    ARM SEEKING FLAG                40190000
SIXT     EQU   X'10'                                                    40210000
RESETPL  EQU   X'01'                    RESET P/L BIT IN IOB FLAG 2     40230000
WRITE    EQU   X'01'                    WRITE COMMAND CODE              40250000
EOTRCVD  EQU   X'40'                                                    40270000
RVIRCV   EQU   X'42'                                                    40290000
WACKRCV  EQU   X'C0'                                                    40310000
POLL     EQU   X'09'                                               000A 40330000
TPWPA    EQU   X'03'                    TP OP CODE FOR WRITE POLL/ADRS  40350000
NOCOMPAR EQU   X'10'                                               000A 40370000
SLVCONT  EQU   X'10'                                           @ZA04873 40390000
DCBMASTA EQU   X'80'                                             A43796 40410000
NEGRESPN EQU   X'04'                    NEGATIVE RESP OR ALL ENTRYS SKP 40430000
FORMAT   EQU   X'20'                    FORMAT IN LIST CONTROL BYTE     40450000
DISABLE  EQU   X'2F'                    DISABLE COMMAND CODE            40470000
SKIP     EQU   X'40'                    SKIP BIT IN TERM LIST CTRL BYTE 40490000
EOL      EQU   X'80'                    EOL BIT IN TERM LIST CTRL BYTE  40510000
SNO      EQU   X'40'                    SHOULD NOT OCCUR ERROR          40530000
BUSY     EQU   X'40'                    BUSY BIT                        40550000
LERCNT   EQU   X'08'                                                    40570000
CCNORM   EQU   X'7F'                    NORMAL COMPLETION CODE          40590000
IOBEX    EQU   X'04'                    IOB EXCEPTION FLAG              40610000
IOBEXE   EQU   X'24'                                                    40630000
SENSTA   EQU   X'04'                    SENSE STATUS DONE      @ZA14130 40650000
WRWBT    EQU   X'1A'                                               000B 40670000
CSWUE    EQU   X'01'                    UNIT EXCEPTION STATUS           40690000
READ     EQU   X'02'                    READ COMMAND CODE               40710000
ONLTT    EQU   X'01'                    ON-LINE TERMINAL TEST BIT       40730000
AUTOPOL  EQU   X'40'                                             A28625 40750000
CIRCLED  EQU   X'16'                                             A28625 40770000
PCI      EQU   X'08'                                                    40790000
PCIPC    EQU   X'A0'                                                    40810000
TICCMND  EQU   X'08'                                               3712 40830000
RETRYCNT EQU   2                        MAXIMUM RETRY COUNT             40850000
MASKALL  EQU   X'FF'                    ALL 1'S                         40870000
CCPER    EQU   X'41'                    PERMANENT ERROR COMPLETION CODE 40890000
TPRESET  EQU   X'21'                    TP-OP CODE FOR ALL RESET CCW'S  40910000
TPFPCI   EQU   X'40'                    TP-OP CODE FOR FIRST PCI   1838 40930000
TPEOCP   EQU   X'80'                   TP-OP CODE FOR END OF  CHANNEL   40950000
UCBTYP   EQU   16                                                  000B 40970000
UCBEXTPT EQU   X'14'                                           @ZA15402 40990000
INTBLCHK EQU   X'40'                                               000B 41010000
FLIP     EQU   X'02'                                               000B 41030000
DYNBF    EQU   X'08'                                               000B 41050000
IMPRESP  EQU   X'40'                                               000B 41070000
BISYNCH  EQU   X'90'                                               000B 41090000
LSTCCW   EQU   X'80'                                               000B 41110000
WRRST    EQU     X'0A'                                             000B 41130000
ACK0PT   EQU   X'00'                                               000B 41150000
ACK1PT   EQU   X'02'                                               000B 41170000
FULWORD  EQU   X'FC'                                               000B 41190000
RDIDENT  EQU   X'03'                                               000B 41210000
WRTIV    EQU   X'0D'                                               000B 41230000
RDINQ    EQU   X'15'                                               000B 41250000
RDININQ  EQU   X'19'                                               000B 41270000
RDCONT   EQU   X'03'                    READ CONTINUE                   41290000
RDRESP   EQU   X'25'               READ RESPONSE TP CODE        YA01026 41310000
RDTEXT1  EQU   X'51'               FIRST READ TEXT TP CODE      YA01026 41330000
WRONGACK EQU   X'20'                                               000B 41350000
OKACK    EQU   X'9F'                                               000B 41370000
*                                  PROGRAM                              41390000
OPTPWTN  EQU   X'0A'                    WRITE TN TYPE CODE         000A 41410000
TWNTY260 EQU   X'82'                    2260 DEVICE CODE                41430000
DATAC    EQU   X'80'                    CHANNEL PROGRAM DATA CHAINING   41450000
INLTTSTW EQU   X'1D'                    MASKALL-WRITE TI OPER      000D 41470000
ONLT     EQU   X'10'                                               000D 41490000
ONLTRFT  EQU   X'80'                                             A28612 41510000
ONLTTSTR EQU   X'1E'                    MASKALL-READ TI            000D 41530000
ONLTTSTW EQU   X'0D'                    MASKALL-WRITE TI OPER      000D 41550000
CKRVIRPT EQU   X'20'               BIT 2                           000J 41570000
STRVIRPT EQU   X'DF'               ALL BITS ON EXCEPT BIT 2        000J 41590000
RESET    EQU   X'80'                    RESET BIT                  000D 41610000
PREP     EQU   X'06'                                               000I 41630000
CSWUC    EQU   X'02'                                               000I 41650000
EBC      DC    X'C3'                   EBCDIC C                    000M 41670000
EBE      DC    X'C5'                   EBCDIC E                    000M 41690000
EBS      DC    X'E2'                   EBCDIC S                    000M 41710000
USC      DC    X'43'                   USASCII C                   000M 41730000
USE      DC    X'45'                   USASCII E                   000M 41750000
USS      DC    X'53'                   USASCII S                   000M 41770000
EBSLASH  EQU   X'61'                    EBCDIC /                        41790000
EBR      EQU   X'D9'                    EBCDIC R                        41810000
USSLASH  EQU   X'2F'                    USASCII /                       41830000
USR      EQU   X'52'                    USASCII R                       41850000
SMSG     EQU   X'80'                    3270 STATUS MSG FLAG            41870000
RFTBIT   EQU   X'10'                    RFT RCVD FROM GEN POLL CU       41890000
SOHRBIT1 EQU   X'BF'                    THESE 2 BITS INDICATE AN        41910000
SOHRBIT2 EQU   X'02'                    SOH%R MSG WAS RCVD              41930000
DBOCEBC  DC    X'C8C1'             BUSY, OP CHECK                       41950000
DBEBC    DC    X'C840'             DEVICE BUSY                          41970000
DEEBC    DC    X'C240'             DEVICE END                           41990000
SOHRBUSY EQU   X'BB'               SOH%R PROCESSING COMPLETE            42010000
TIMEOUT  EQU   X'01'               TIMEOUT                      YA01019 42030000
MSGTYPE  EQU   2                        DISP IN SOH% MSGS OF TYPE       42050000
MSGLNGTH EQU   10                       LENGTH OF STD 3270 RFT  YA02157 42070000
*                                       MINUS HEADER            YA02157 42090000
MSGSTART EQU   4                        LENGTH OF 3270 RFT HEADER       42110000
STAT     EQU   6                        DISP OF S/S IN SOH%R MSG        42130000
STATLNG  EQU   2                        # OF S/S BYTES IN SOH%R MSG     42150000
*                                  AND BUSY BITS                        42170000
DBOCASC  DC    X'4841'             BUSY OP CHECK                        42190000
DBASC    DC    X'4820'             DEVICE BUSY                          42210000
DEASC    DC    X'4220'             DEVICE END                           42230000
DISP0    EQU   0                   DISPLACEMENT OF 0             Y02947 42250000
DISP1    EQU   1                   DISPLACEMENT OF 1             Y02947 42270000
DISP3    EQU   3                   DISPLACEMENT OF 3        LD @ZA02319 42290000
DISP4    EQU   4                   DISPLACEMENT OF 4             Y02947 42310000
DISP5    EQU   5                   DISPLACEMENT OF 5        LD @ZA02320 42330000
DISP6    EQU   6                   DISPLACEMENT OF 6        LD @ZA02319 42350000
DISP7    EQU   7                   DISPLACEMENT OF 7             Y02947 42370000
DISP8    EQU   8                   DISPLACEMENT OF 8             Y02947 42390000
DISP12   EQU   12                  DISPLACEMENT OF 12            Y02947 42410000
DISP13   EQU   13                  DISPLACEMENT OF 13       LD @ZA00536 42430000
DISP16   EQU   16                  DISPLACEMENT OF 16       LD @ZA02320 42450000
PGFREE   EQU   X'20'               PAGE FREE FUNCTION            Y02947 42470000
LASTVSL  EQU   X'80'               LAST VSL ENTRY                Y02947 42490000
REG7     EQU   36                  DISP INTO SAVE AREA OF REG 7  S99245 42510000
BSC2     EQU   X'90'               BSC2 FEATURE IN UCB           S99245 42530000
IDBEGIN  EQU   64             DISP PAST IOBCPA OF BSC2 TERM ID   S99245 42550000
ID4BYTES EQU   4                   LENGTH OF BSC2 TERM ID SAVED  S99245 42570000
IDDISP   EQU   8                   DISP INTO SWLIST OF TERM ID   S99245 42590000
DISPID   EQU   0                   DISP INTO NON-SWLIST OF ID    S99245 42610000
DLRFTLNG EQU   7               # OF PARMS IN DIAL 3270 RFT  LD @ZA02313 42630000
RDINQMON EQU   X'09'               READ INQUIRY MONITOR          S99245 42650000
WRRSTMON EQU   X'0B'               WRITE RESET MONITOR           S99245 42670000
RESIDCNT EQU   6                  DISP INTO CCW OF RESIDUAL CNT YA02162 42690000
RESPNLNG EQU   2                   LENGTH OF DECRESPN           YA02162 42710000
ONECHAR  EQU   1                   ONE CHAR RESPONSE LENGTH     YA02162 42730000
DISP20   EQU   20                  DISPLACEMENT OF 20            Y02947 42750000
EOTCHAR  EQU   X'37'               EOT CHARACTER                YA03266 42770000
CHKMOD   EQU   X'01'                                           @ZA03598 42790000
CKWTTA   EQU   X'60'                                           @ZA03598 42810000
CK115A   EQU   X'40'                                           @ZA03598 42830000
X10      EQU   X'10'                                        LD @ZA02319 42850000
X30      EQU   X'30'                                           @ZA04877 42870000
X82      EQU   X'82'                                        LD @ZA02321 42890000
X84      EQU   X'84'                                        LD @ZA02321 42910000
X1F      EQU   X'1F'                                        LD @ZA02320 42930000
XF0      EQU   X'F0'                                           @ZA04877 42950000
THREE    EQU   3                                            LD @ZA02320 42970000
TEN      EQU   10                                           LD @ZA02319 42990000
TICBIT   EQU   X'01'                                        LD @ZA02320 43010000
PROGCHK  EQU   X'20'                                        LD @ZA02320 43030000
WRT1ST   EQU   X'40'                                        LD @ZA02320 43050000
WRTTEXT  EQU   X'11'                                        LD @ZA02320 43070000
WRTTC    EQU   X'1C'               WRITE CONNECT               @ZA04190 43090000
XFF      EQU   X'FF'                                           @ZA08045 43110000
         CNOP  0,8                                                      43130000
         EJECT                                                          43150000
         IECTDECB                                                       43170000
         EJECT                                                          43190000
         IECTIOBX                                                       43210000
         EJECT                                                          43230000
         DCBD  DSORG=BX,DEVD=BS                                    000B 43250000
         EJECT                                                          43270000
         IKJTCB DSECT=YES,LIST=YES                                      43290000
         EJECT                                                          43310000
CVT      DSECT                                                          43330000
         CVT    LIST=NO                                                 43350000
         END                                                            43370000
./  ADD  SSI=62660452,NAME=IGG019MC
 TITLE 'IGG019MC - BTAM PCI APPENDAGE'                                  00200013
*********************************************************************** 00250002
*                                                                     * 00300002
* MODULE NAME: IGG019MC   (OS/VS)                                     * 00350002
*                                                                     * 00400002
* DESCRIPTIVE NAME: BTAM PCI APPENDAGE                                * 00450002
*                                                                     * 00500002
* COPYRIGHT: NONE                                                     * 00550002
*                                                                     * 00600002
* STATUS: RELEASE 2                                                   * 01200002
*                                                                     * 01400002
* FUNCTION:         THE PROGRAM CONTROLLED INTERRUPT IS USED TO       * 01800002
*                   PROVIDE DYNAMIC BUFFERING (*) BY ASSIGNING BUFFER * 02000002
*                   N+1  DURING THE TIME BUFFER N IS BEING READ INTO  * 02200002
*                   OR WRITTEN FROM.  ONLY THE CURRENT BUFFER AND 1   * 02400002
*                   SUCCEEDING BUFFER CAN BE MADE AVAILABLE AT ANY    * 02600002
*                   ONE TIME.                                         * 02800002
*                                                                     * 03000002
*                   *  SEE NOTE BELOW FOR BRIEF DESCRIPTION OF        * 03200002
*                      DYNAMIC BUFFERING.                             * 03400002
*                                                                     * 03600002
* ENTRY POINT:      ENTRY IS 1ST EXECUTIVE INSTRUCTION                * 04000002
*                                                                     * 04200002
* INPUT:            REGISTER 2 CONTAINS A POINTER TO THE PERTINENT    * 04600002
*                              IOB                                    * 04650002
*                   REGISTER 15 CONTAINS THE BASE ADDRESS             * 04800002
*                                                                     * 05000002
* OUTPUT:           NONE                                              * 05400002
*                                                                     * 05600002
* EXTERNAL ROUTINE: THE REQUEST-RELEASE BUFFER ROUTINE IS USED TO     * 06000002
*                   GET OR RELEASE BFRS FROM OR TO THE BUFFER POOL.   * 06200002
*                                                                     * 06400002
* EXIT:             RETURN IS TO IOS AFTER ASSIGNING A BUFFER OR      * 06800002
*                   QUEUING A REQUEST FOR ONE                         * 07000002
*                                                                     * 07200002
* IN LINE ROUTINES: THE PCI OCCURS FOR ALL READ OR WRITE CHANNEL      * 07600002
*                   COMMANDS SET UP FOR DYNAMIC BUFFERING.            * 07800002
*                   READ                                              * 08000002
*                        READ OR READ-SKIP                            * 08200002
*                        READ                                         * 08400002
*                           AN ATTEMPT IS MADE TO ASSIGN A BUFFER     * 08600002
*                           TO THE NEXT READ CCW WHICH IS BLOCKED BY  * 08800002
*                           A READ-SKIP CCW UNTIL THE BFR IS ASSIGNED * 09000002
*                           IF A BUFFER IS ASSIGNED THE READ-SKIP IS  * 09200002
*                           ALTERED TO A TIC TO THE BLOCKED READ CCW. * 09400002
*                           AND THIS READ IS IN TURN BLOCKED BY ALTER * 09600002
*                           ING THE FOLLOWING TIC CCW TO READ-SKIP    * 09800002
*                           IF NO BUFFER IS AVAILABLE TO BE ASSIGNED  * 10000002
*                           A REQUEST IS ADDED TO THE REQUEST QUEUE.  * 10200002
*                           POINTERS TO THE 1ST AND LAST ENTRIES IN   * 10400002
*                           THIS QUEUE ARE STORED IN THE DATA EXTENT  * 10600002
*                           BLOCK ASSOCIATED WITH THIS IOB.  THE      * 10800002
*                           CHAINING POINTERS ARE STORED IN THE READ  * 11000002
*                           CCW'S IN PLACE OF THE BUFFER ADDRESSES.   * 11200002
*                                                                     * 11400002
*                        READ-SKIP                                    * 11600002
*                           A BUFFER NEVER DID GET ASSIGNED.  THE     * 11800002
*                           PCI ON THE PREVIOUS READ WAS EITHER LOST  * 12000002
*                           OR HANDLED.  IF IT WAS LOST THE TWO       * 12200002
*                           PREVIOUS READ BUFFERS MUST BE POSTED,     * 12400002
*                           THE MOST RECENT WITH AN ERROR INDICATION, * 12600002
*                           AND ANOTHER READ-SKIP COMMAND OVERLAYED   * 12800002
*                           IN THE NEXT CCW TO PERMIT COMPLETION OF   * 13000002
*                           THE READ.  IF THE PCI ON THE PREVIOUS     * 13200002
*                           READ WERE HANDLED THE BUFFER REQUEST WAS  * 13400002
*                           QUEUED.  THIS REQUEST MUST BE PURGED      * 13600002
*                           FROM THE QUEUE AND THE PREVIOUS READ      * 13800002
*                           BUFFER POSTED.  ANOTHER READ-SKIP COMMAND * 14000002
*                           PLACED IN THE NEXT CCW TO ALLOW COMPLE-   * 14200002
*                           TION OF THE READ.                         * 14400002
*                           IF A BUFFER WERE ASSIGNED PRIOR TO HAND-  * 14600002
*                           LING THIS INTERRUPT, BUT AFTER FETCHING   * 14800002
*                           THE CCW COMMAND CODE IN STORAGE WILL      * 15000002
*                           BE A TIC.  IN THIS CASE THE BFR WILL BE   * 15200002
*                           RELEASED AND THE READ BFR WILL BE POSTED. * 15400002
*                           IN EITHER CASE DATA WILL HAVE BEEN LOST   * 15600002
*                           AND THE POSTING WILL SO INDICATE.         * 15800002
*                   WRITE                                             * 16000002
*                        THE BUFFER CHAIN ADDRESS IS TESTED FOR 0 TO  * 16200002
*                        SEE IF THIS IS THE LAST BUFFER IN THE WRITE  * 16400002
*                        CHAIN.  IF IT IS THE BUFFER IS POSTED.  IF   * 16600002
*                        NOT THE NEXT BUFFER ADDRESS IS PLACED IN THE * 16800002
*                        NEXT WRITE CCW, THE FOLLOWING TIC IS MADE    * 17000002
*                        VALID AND THE TIC TO THE CURRENT WRITE CCW   * 17200002
*                        IS INVALIDATED BY ORRING A 1 TO ITS TRANSFER * 17400002
*                        ADDRESS.  SHOULD THE INVALID TIC ADDRESS BE  * 17600002
*                        FETCHED AN ABNORMAL END WOULD OCCUR.         * 17800002
*                                                                     * 18000002
*                   CCW 1 ----------------------------------------    * 18200002
*                        IRD/WR CMD*   B U F F E R   A D D R E S S    * 18400002
*                        I---------------------------------------I    * 18600002
*                        I FLAGS   *T/P OP CD*    C O U N T      I    * 18800002
*                        -----------------------------------------    * 19000002
*                                                                     * 19200002
*                   CCW 2-----------------------------------------    * 19400002
*                        IR-S / TIC* A D D R E S S  OF  C C W  3 I    * 19600002
*                        I---------------------------------------I    * 19800002
*                        I FLAGS   *T/P OP CD*    C O U N T      I    * 20000002
*                        -----------------------------------------    * 20200002
*                                                                     * 20400002
*                   CCW 3-----------------------------------------    * 20600002
*                        IRD/WR CMD*  B U F F E R   A D D R E S S     * 20800002
*                        I---------------------------------------I    * 21000002
*                        I FLAGS   *T/P OP CD*    C O U N T      I    * 21200002
*                        -----------------------------------------    * 21400002
*                                                                     * 21600002
*                   CCW 4-----------------------------------------    * 21800002
*                        IR-S / TIC* A D D R E S S  OF  C C W 1  I    * 22000002
*                        I---------------------------------------I    * 22200002
*                        I FLAGS   *T/P OP CD*    C O U N T      I    * 22400002
*                        -----------------------------------------    * 22600002
*                                                                     * 22800002
* ATTRIBUTES:       THIS ROUTINE IS RUN IN SUPERVISOR MODE, DISABLED  * 23200002
*                                                                     * 23400002
* NOTE:             'DYNAMIC BUFFERING' IS DEFINED AS THE ABILITY TO  * 23800002
*                   PROVIDE I/O BUFFERS JUST PRECEDING AN IMPENDING   * 24000002
*                   I/O OPERATION TO PERMIT MORE FLEXIBLE USE OF      * 24200002
*                   LIMITED STORAGE SPACE.                            * 24400002
*                                                                     * 24600002
* CHANGE ACTIVITY AS FOLLOWS:                                         * 24650002
*            APARS                          PTMS                      * 24700002
*        YA02154  (10/17/73)            YM4064  (10/3/73)             * 24750002
*        YA02155  (10/17/73)            YM4072  (10/15/73)            * 24752002
*        YA02156  (10/17/73)            YM5663  (12/11/73) PROLOG     * 24754002
*        ZA02312  (11/18/74)            YM5662  (12/11/73) DELETE     * 24756003
*        ZA02335  (11/18/74)                                          * 24758003
*        AZ04150  (04/29/75)                                          * 24758500
*        AZ04157  (07/15/75)                                          * 24759000
*        AZ04188  (10/08/75)                                          * 24759500
*        AZ11431  (06/10/76)                                          * 24759700
*        AZ13192  (09/15/76)                                          * 24760000
*********************************************************************** 24770002
         EJECT                                                          24800013
IGG019MC CSECT                                                          24850002
         SPACE 5                                                        24852002
DEVTYPE  EQU   16                                                  000C 24860015
DCBBSENQ EQU   68                                                A27624 24930019
ZEROREG  EQU   0                        REGISTER ZERO                   25000013
PARREG   EQU   1                        PARAMETER REGISTER              25200013
RQEREG   EQU   1                        RQE ADDRESS              Y02947 25250002
IOBREG   EQU   2                        PTR TO INPUT OUTPUT BLOCK       25400013
WKRG2    EQU   2                   WORK REG FOR ALTERCCW RTN     Y02947 25450002
DEBREG   EQU   3                        PTR TO DATA EXTENT BLOCK        25600013
WKRG3    EQU   3                   WORK REG FOR ALTERCCW RTN     Y02947 25650002
DCBREG   EQU   4                        PTR TO DATA CONTROL BLOCK       25800013
WKRG4    EQU   4                   WORK REG FOR ALTERCCW RTN     Y02947 25850002
TCBREG   EQU   5                   PTR TO TASK CONTROL BLOCK     Y02947 26050002
QREG     EQU   6                        PTR TO REQ-REL BFR & REQ QUEUE  26200013
BUFREG   EQU   7                        PTR TO BUFFER                   26400013
BUF2REG  EQU   8                        PTR TO NEXT BUFFER              26600013
CCWREG   EQU   9                        PTR TO CHANNEL COMMAND WORD     26800013
CCW2REG  EQU   10                       PTR TO NEXT CH COMMAND WORD     27000013
WORKREG  EQU   11                       WORK REGISTER                   27200013
UCBREG   EQU   11                       UCB ADDRESS             YA02155 27250002
BASEREG  EQU   12                       BASE REGISTER                   27400013
SAVEREG  EQU   13                       PTR TO SAVE AREA                27600013
RETREG   EQU   14                       RETURN ADDRESS REGISTER         27800013
BRREG    EQU   15                       PTR TO REQUESTED BFR OR ER IND  28000013
RCCWREG  EQU   15                  ADDRESS OF REAL CCW           Y02947 28050002
         EJECT                                                   Y02947 28150002
DEBNMEXT EQU   16                                                       28200013
DEBUCBAD EQU   32                                                       28400013
SIXTEEN  EQU   16                                                       28800013
DCBXMODE EQU   X'38'                                            YA02154 28850002
DCBBSETX EQU   X'3F'                                            YA02154 28900002
DCBBSETB EQU   X'46'                                            YA02154 28950002
INTBLCHK EQU   X'40'                                            YA02154 28960002
DCBBUFCB EQU   20                       OFFSET TO BCB ADDRESS           29000013
IOBECBPT EQU   4                        OFFSET TO ECB POINTER           29200013
DEBTCBAD EQU   0                        OFFSET TO TCB ADDRESS           29400013
DECTYPE  EQU   4                                                   000A 29600013
DECLNGTH EQU   6                        OFFSET TO LAST BFR LENGTH       29800013
DECAREA  EQU   12                                                  000A 30000013
DECPOLPT EQU   36                                                  000A 30200013
DECWLNG  EQU   42                                                  000B 30300014
DCBBUFCT EQU   34                                                  7752 30330017
DECBUFCT EQU   8                                                   7752 30360017
INVTIC   EQU   X'01'               INVALID TIC DATA ADDR         Y02947 30370002
IDAWFLAG EQU   X'04'               CCW IDAW FLAG                 Y02947 30380002
DCBEIOBX EQU   X'24'               DISP IN DCB OF IOB SIZE       Y02947 30390002
DATACHN  EQU   X'80'               CCW DATA CHAINING FLAG        Y02947 30392002
PCIOFF   EQU   X'BF'               TURN OFF 1ST TIME PCI         Y02947 30394002
IDAWOFF  EQU   X'FB'               TURN OFF CCW IDAW FLAG        Y02947 30396002
TWOBITS  EQU   2                                                 Y02947 30398002
TWO      EQU   2                                                 Y02947 30398402
IOBUCBX  EQU   32                  IOB DISP TO UCB INDEX         Y02947 30399202
IOBCPA   EQU   64                  IOB DISP TO CHANNEL PROGRAM   Y02947 30399602
*                                  AREA                          Y02947 30399702
LEN8     EQU   8                   LENGTH OF 8                   Y02947 30399802
LEN16    EQU   16                  LENGTH OF 16                  Y02947 30399902
AUTOPOLL EQU   X'80'                                               000A 30400013
FIRSTPCI EQU   X'40'                    FIRST TIME PCI FLAG        3712 30440016
RDCMND   EQU   X'02'                    READ COMMAND               3712 30480016
RSTICOP  EQU   X'12'                    READ SKIP/TIC TP OP CODE   3712 30520016
RDRESP   EQU   X'25'               READ RESP TO TXT OP CODE LD @ZA02312 30530003
TICCMND  EQU   X'08'                    TIC COMMAND                3712 30560016
SKIP     EQU   X'10'                    SKIP FLAG                       30600013
PC       EQU   X'20'                   PROGRAM CHECK BIT                30800013
RRTXT    EQU   X'20'               READ RESO TO TEXT CODE   LD @ZA02335 30802003
HEX21    EQU   X'21'                                        LD @ZA02335 30804003
HEXA1    EQU   X'A1'                                        LD @ZA02335 30806003
FORTY    EQU   X'40'               CCW COMMAND CHAINING FLAG    YA02156 30810002
BF       EQU   X'BF'               MASK TO RESET CCW COMMAND    YA02156 30820002
*                                  CHAINING FLAG                YA02156 30830002
DISP0    EQU   0                   DISPLACEMENT OF 0             Y02947 30850002
DISP1    EQU   1                   DISPLACEMENT OF 1             Y02947 30860002
DISP2    EQU   2                   DISPLACEMENT OF 2             Y02947 30900002
DISP3    EQU   3                   DISPLACEMENT OF 3             Y02947 30902002
DISP4    EQU   4                   DISPLACEMENT OF 4             Y02947 30910002
DISP5    EQU   5                   DISPLACEMENT OF 5             Y02947 30950002
DISP6    EQU   6                   DISPLACEMENT OF 6             Y02947 30960002
DISP8    EQU   8                   DISPLACEMENT OF 8             Y02947 30970002
DISP11   EQU   11                  DISPLACEMENT OF 11            Y02947 30980002
DISP12   EQU   12                  DISPLACEMENT OF 12            Y02947 30990002
DISP13   EQU   13                  DISPLACEMENT OF 13            Y02947 30990402
DISP16   EQU   16                  DISPLACEMENT OF 16            Y02947 30992002
DISP17   EQU   17                  DISPLACEMENT OF 17            Y02947 30992402
DISP19   EQU   19                  DOSPLACEMENT OF 19           YA02155 30992802
DISP20   EQU   20                  DISPLACEMENT OF 20            Y02947 30994002
DISP24   EQU   24                  DISPLACEMENT OF 24            Y02947 30994102
LEN2     EQU   2                   LENGTH OF 2                   Y02947 30994402
ELEVEN   EQU   11                  NUMBER OF BITS IN 2K          Y02947 30994802
         SPACE 5                                                 Y02947 30996002
         USING *,BASEREG                                                31000013
         USING TCB,TCBREG                                        Y02947 31050002
         STM   RETREG,CCWREG,DISP0(SAVEREG)      SAVE REGISTERS  Y02947 31200002
         LR    BASEREG,BRREG                                            31400013
         B     AROUND                                            Y02947 31410002
         DC    C'IGG019MC'                                       Y02947 31420002
         DC    C',VS2/R2, DEC  73'                               Y02947 31430002
         DS    0F                                                Y02947 31440002
PATCH    DC    XL86'00'         PATCH AREA                       Y02947 31442002
AROUND   L     CCWREG,DISP8(IOBREG)  LOAD CCW ADDR FROM IOBCSW   Y02947 31450002
         LA    CCWREG,DISP0(CCWREG)  CLEAR HIGH ORDER BYTE       Y02947 31500002
         SH    CCWREG,EIGHT        BACK UP TO INTERRUPTED CCW    Y02947 31550002
         L     TCBREG,DEBTCBAD(DEBREG) LOAD TCB ADDR             Y02947 31600002
         TM    TCBFLGS6,TCBRV        VIRTUAL = REAL              Y02947 31650002
         BO    TESTSTS               YES, CHECK PCI ALONE        YM4072 31700002
         TM    DISP5(CCWREG),FIRSTPCI FIRST TIME PCI             Y02947 31750002
         BNO   TESTSTS               NO, CHECK PCI ALONE         YM4072 31800002
         NI    DISP5(CCWREG),PCIOFF  TURN OFF 1ST TIME PCI       Y02947 31802002
         B     EXIT                  RETURN                      Y02947 31804002
*     APPROXIMATELY 32 LINES DELETED BY THE FOLLOWING PTM:       YM5662 31806002
TESTSTS  EQU   *                                                        32145002
         CLC   DISP12(LEN2,IOBREG),STATUS IS STATUS PCI ONLY     Y02947 32172502
         BE    CHKWRT                                            A49691 32200002
         CLI   0(CCWREG),RDCMND         IS COMMAND READ            3712 32400016
         BNE   PROGCK                  IF NO, IS THERE PROG CK   A28629 32460019
         CLI   5(CCWREG),RDPCI         IS THIS FIRST PCI         A28629 32520019
         BNE   EXIT                    IF NOT, EXIT              A28629 32580019
         TM    DISP12(IOBREG),UCORUE   UNIT CHECK OR UNIT EXCP   Y02947 32760002
         BNZ   EXIT                    IF SO, EXIT               A28629 32820019
         B     MOVEIND                 CHECK FOR AUTOPOLL        A28629 32880019
PROGCK   TM    DISP13(IOBREG),PC       WAS THERE PROG CHECK      Y02947 32940002
         BZ    WRTIC                    IF NOT, GO TO WRITE ROUTINE3712 33000016
         TM    5(CCWREG),RSTICOP        IS TIC TPOP CODE PRESENT   3712 33200016
         BNO   EXIT                     IF NOT, EXIT               3712 33400016
         CLI   0(CCWREG),TICCMND        AND IS COMMAND TIC         3712 33600016
         BNE   EXIT                     IF NOT, EXIT               3712 33800016
         SH    CCWREG,EIGHT             IF SO BACK UP TO WRITE CMND3712 34000016
         B     WRTIC                    GO POST PREVIOUS BUFFER    3712 34200016
CHKWRT   EQU   *                                                 A49691 34220002
         CLI   0(CCWREG),TICCMND                                 A49691 34240002
         BNE   LBCB                                              A49691 34260002
         TM    3(CCWREG),X'01'                                   A49691 34280002
         BNO   EXIT                                              A49691 34300002
         CLI   DISP5(CCWREG),HEX21 TP OP CODE, ALL RESET    LD @ZA02335 34310003
         BE    EXIT                YES, EXIT                LD @ZA02335 34312003
         CLI   DISP5(CCWREG),HEXA1 TP OP CODE, ALL RESET    LD @ZA02335 34314003
         BE    EXIT                YES, EXIT                LD @ZA02335 34316003
         SH    CCWREG,EIGHT                                      A49691 34320002
         B     WRTIC                                             A49691 34340002
LBCB     EQU   *                                                 Y02947 34400002
         CLI   DISP5(CCWREG),RRTXT RD RESP TO TXT (STR/STP) LD @ZA02335 34450003
         BE    EXIT                YES, EXIT                LD @ZA02335 34500003
         SR    WORKREG,WORKREG          COMPUTE PTR TO REQUEST BFR Q    34600013
         IC    WORKREG,DEBNMEXT(DEBREG)                                 34800013
         SLL   WORKREG,2                                                35000013
         LA    QREG,DEBUCBAD(WORKREG,DEBREG)                            35200013
         MVC   BYTE(1),5(CCWREG)        IS T/P OP CODE READ-SKIP OR TIC 35400013
         NI    BYTE,X'3F'               TEST BITS 2-7 ONLY              35600013
         CLI   BYTE,X'12'               IS TP OP CODE 22                35800013
         BE    READSKIP                 YES                             36000013
WRTIC    L     CCW2REG,8(CCWREG)        LOAD ADRS OF PREVIOUS CCW       36200013
         N     CCW2REG,TICMASK          VALIDATE TIC ADDRESS IN REG     36400013
         MVC   SAVEBFR+1(3),1(CCW2REG)  SAVE ADRS OF PREVIOUS BUFFER    36600013
         L     BUFREG,0(CCWREG)         LOAD PTR TO THIS CCW BUFFER     36800013
         N     BUFREG,BUFMSK            ADJUST TO 1ST BYTE OF BFR       37000013
         SH    BUFREG,FOUR                                              37200013
         CLI   0(CCWREG),X'01'          IS COMMAND WRITE                37400013
         BE    WRPCI                    YES                             37600013
*                                                                       37602002
*              2 LINES DELETED FOR ----->                   LD @ZA02312 37602403
*                                                                       37602802
         SH    CCW2REG,EIGHT       PREV CCW                 LD @ZA02312 37604803
         TM    DISP5(CCW2REG),RDRESP CK RD RESP TO TXT(BSC) LD @ZA02312 37606803
         BNO   NOT25               IF NOT BRANCH            LD @ZA02312 37608803
         L     WORKREG,DISP8(CCW2REG)  LOAD DATA ADDR...    LD @ZA02312 37609203
*                                      FOR READ TEXT        LD @ZA02312 37609603
         SH    WORKREG,TWENTY      SUB CNT OF RD RESP CCW   LD @ZA02312 37609703
         CL    WORKREG,0(CCW2REG)  EQ DATA AREA OF RD RESP? LD @ZA04157 37609800
         BNO   NOT25               IF NOT BRANCH            LD @ZA02312 37609903
         LA    WORKREG,DISP0(WORKREG)  CLEAR HI ORDER BYTE  LD @ZA02312 37613203
         ST    WORKREG,SAVEBFR     STORE AS BUFFER PTR      LD @ZA02312 37615203
NOT25    EQU   *                                            LD @ZA02312 37615603
         AH    CCW2REG,EIGHT       RESTORE CCW              LD @ZA02312 37616003
         L     PARREG,DISP12(SAVEREG)   RQE ADDRESS              Y02947 37616702
         USING RQE,PARREG         ESTABLISH RQE ADDRESSABILITY   Y02947 37620002
         L     PARREG,RQEUCB      LOAD UCB ADDRESS               Y02947 37630002
         DROP  PARREG             DROP RQE ADDRESSABILITY        Y02947 37632002
         SR    WORKREG,WORKREG                                     000C 37640015
         IC    WORKREG,DEVTYPE+3(PARREG)                           000C 37660015
         SRL   WORKREG,4                                           000C 37680015
         EX    WORKREG,COMPARE                                     000C 37700015
         BNE   READPCI                                             000C 37720015
         CLC   4(1,BUFREG),DCBBSENQ(DCBREG)                        000C 37740015
         BE    CKEXIT            CK FOR USASCII CODE           @ZA04188 37760000
         CLC   5(1,BUFREG),DCBBSENQ(DCBREG)                      A46838 37766002
         BE    EXIT                                              A46838 37772002
         B     READPCI          CHAR IS NOT AN ENQ             @ZA04188 37772800
CKEXIT   EQU   *                       CK USASCII CODE         @ZA04188 37773600
         L     PARREG,IOBECBPT(IOBREG)   DECB POINTER          @ZA04188 37774400
         TM    DCBXCODE(DCBREG),USASCII   USASCII CODE ?       @ZA04188 37775200
         BNO   EXIT                   CHAR IS AN ENQ           @ZA04188 37776000
         CLI   DECTYPE+1(PARREG),RDTI    READ INITIAL          @ZA04188 37776800
         BNE   EXIT                   NO, CHAR IS AN ENQ       @ZA04188 37777600
*              CHARACTER IS AN INDEX BYTE                      @ZA04188 37778400
READPCI  EQU   *                                                   000C 37780015
         SR    UCBREG,UCBREG            CLEAR REGISTER          YA02155 37830002
         IC    UCBREG,IOBUCBX(IOBREG)   UCB INDEX FOR LINE      YA02155 37840002
         SLL   UCBREG,DISP2             MULT INDEX BY 4         YA02155 37842002
         L     UCBREG,IOBUCBX(DEBREG,UCBREG) UCB ADDR FOR LINE  YA02155 37844002
         TM    DISP19(UCBREG),BISYNC    BSC LINE?               YA02155 37846002
         BNO   CONTINU                  NO, START STOP          YA02155 37848002
         CLI   5(CCWREG),RDPCI          IS THIS FIRST PCI ?    @ZA13192 37848100
         BE    CONTINU                  YES CONTINUE           @ZA13192 37848200
         LH    WORKREG,DISP6(CCW2REG)   COUNT OF PREVIOUS CCW   YA02154 37848402
         A     WORKREG,DISP0(CCW2REG)   ADD ADDR OF PREV. CCW   YA02154 37848802
         BCTR  WORKREG,DISP0            POINT TO LAST CHARACTER YA02154 37849202
         TM    DCBXMODE(DCBREG),INTBLCHK INT BLK CHECK USED?    YA02154 37849602
         BZ    CHKETX                   NO                      YA02154 37849702
         BCTR  WORKREG,DISP0            POINT TO NEXT TO LAST   YA02154 37849802
*                                       CHARACTER               YA02154 37849902
CHKETX   CLC   DISP0(DISP1,WORKREG),DCBBSETX(DCBREG) ETX?       YA02154 37866602
         BE    EXIT                     YES, DON'T GET ANOTHER  YA02154 37876602
*                                       BUFFER                  YA02154 37878602
         CLC   DISP0(DISP1,WORKREG),DCBBSETB(DCBREG) ETB?       YA02154 37880602
         BE    EXIT                     YES, DON'T GET ANOTHER  YA02154 37882602
*                                       BUFFER                  YA02154 37883002
CONTINU  EQU   *                                                YA02155 37883102
         L     BUF2REG,DCBBUFCB(DCBREG) LOAD POINTER TO BCB      Y02947 37883302
         CLI   DISP5(BUF2REG),DISP0 ARE ANY BUFFERS AVAILABLE    Y02947 37900002
         BE    QUEUE                    NO                              38000013
         L     PARREG,IOBECBPT(IOBREG)  GET POINTER TO DECB        7752 38020017
         CLC   DECBUFCT(1,PARREG),DCBBUFCT(DCBREG) ALL BUFFERS USED7752 38040017
         BNL   QPCI                     IF SO, BRANCH              7752 38060017
         SR    RETREG,RETREG            CLEAR REGISTER           Y02947 38070002
         IC    RETREG,DCBEIOBX(DCBREG)  IOB SIZE                 Y02947 38072002
         LR    WORKREG,IOBREG           IOB ADDRESS              Y02947 38074002
         AR    WORKREG,RETREG           POINT TO END OF IOB      Y02947 38076002
         SH    WORKREG,EIGHT            POINT TO DYN BUF EXT     Y02947 38078002
         IC    WORKREG,DECBUFCT(PARREG) PICKUP BUFFER COUNT        7752 38080017
         LA    WORKREG,1(WORKREG)       BUMP BY ONE                7752 38100017
         STC   WORKREG,DECBUFCT(PARREG) STORE BUFFER COUNT         7752 38120017
         L     ZEROREG,ZEROE            SETUP PARAM TO REQUEST 1 BUFFER 38200013
         LR    PARREG,DCBREG            LOAD PTR TO DCB INTO REG 1      38400013
         L     BRREG,0(QREG)            LOAD PTR TO REQ BFR ROUTINE     38600013
         LR    WORKREG,SAVEREG          SAVE IOS SAVEAREA ADDR   YM4064 38650002
         LA    SAVEREG,SAVEAREA         SAVEAREA ADDR FOR 19MS   YM4064 38700002
         BALR  RETREG,BRREG             LINK TO REQUEST BUFFER ROUTINE  38800013
         LR    SAVEREG,WORKREG       RESTORE IOS SAVEAREA ADDR   YM4064 38850002
         LA    BRREG,4(BRREG)           INCR BY 4 TO 1ST DATA BYTE      39000013
         ST    BRREG,0(CCW2REG)         STORE BUFFER ADRS IN CCW        39200013
         LH    WORKREG,DISP6(BUF2REG)        LOAD BFR LENGTH     Y02947 39400002
         SH    WORKREG,FOUR                                             39600013
         STH   WORKREG,6(CCW2REG)       STORE AS COUNT                  39800013
         MVI   0(CCW2REG),X'02'         RESTORE READ COMMAND CODE       40000013
         MVI   8(CCW2REG),X'02'         MAKE TIC COMMAND A READ SKIP    40200013
         SPACE 2                                                   000A 40400013
         BCR   15,0                     THIS INSTRUCTION IS        000A 40600013
*    REQUIRED FOR MODEL 91 SUPPORT TO ENSURE THAT THE FOLLOWING    000A 40800013
*    INSTRUCTION (WHICH CHANGES THE READ-SKIP TO A TIC) WILL BE    000A 41000013
*    EXECUTED IN SEQUENCE.                                         000A 41200013
         MVI   8(CCWREG),X'08'          MAKE THIS READ-SKIP A TIC       41400013
         TM    TCBFLGS6,TCBRV           VIRTUAL = REAL           Y02947 41410002
         BO    QPCI                     YES, DO NOT ALTER CCWS   Y02947 41420002
         SPACE 1                                                        41450002
         BAL   RETREG,BLDPARM     BUILD ENTRIES IN PCI PARM LIST        41500002
         BAL   RETREG,ALTERCCW          ALTER REAL CCWS          Y02947 41510002
         B     QPCI                                                     41800013
         SPACE 2                                                 Y02947 41850002
READSKIP SR    ZEROREG,ZEROREG          CLEAR REGISTER TO        Y02947 41900002
*                          INDICATE THAT IT IS NOT NECCESSARY    Y02947 41950002
*                          TO POST A BUFFER.                     Y02947 41960002
         CLI   0(CCWREG),X'08'          IS THE CMND CODE TIC            42000002
         BE    TIC                      YES                             42200013
         L     CCWREG,0(CCWREG)         LOAD PTR TO NEXT READ CCW       42400013
         C     CCWREG,4(QREG)           IS CCW TO BE PURGED 1ST         42600013
         BNE   NOT1ST                                                   42800013
         MVC   4(4,QREG),0(CCWREG)      MAKE 2ND CCW 1ST NOW            43000013
         B     SETUPRS                                                  43200013
NOT1ST   L     CCW2REG,4(QREG)          LOAD PTR TO 1ST INTO REG        43400013
NXTCMP   C     CCW2REG,ZERO             IS THIS THE END OF THE QUEUE    43600013
         BE    NOTINQ                   YES, NOT IN QUEUE               43800013
         C     CCWREG,0(CCW2REG)        COMPARE CCW PTR TO NEXT CCW PTR 44000013
         BE    FOUND                                                    44200013
         L     CCW2REG,0(CCW2REG)       LOAD PTR TO NEXT CCW PTR IN CHN 44400013
         B     NXTCMP                                                   44600013
FOUND    MVC   0(4,CCW2REG),0(CCWREG)   CHAIN FRONT & BACK BFRS TOGETHR 44800013
LAST     C     CCWREG,8(QREG)           IS PURGED CCW LAST ONE IN QUEUE 45000013
         BNE   SETUPRS                                                  45200013
         ST    CCW2REG,8(QREG)          UPDATE PTR TO LAST CCW IN CHAIN 45400013
         B     SETUPRS                                                  45600013
NOTINQ   L     CCW2REG,8(CCWREG)        LOAD PTR TO PREVIOUS READ       45800013
         TM    5(CCW2REG),X'40'         IS THIS FIRST PCI               46000013
         BZ    NOTINQ1                  IF NOT, BRANCH             000A 46200013
         L     PARREG,IOBECBPT(IOBREG)  LOAD PTR TO DECB           000A 46400013
         TM    DECTYPE(PARREG),AUTOPOLL IS AN AUTOPOLL OPERATION   000A 46600013
         BZ    SETUPRS    IN PROGRESS.  IF NOT, BRANCH             000C 46800015
         L     WORKREG,DECAREA(PARREG)  LOAD BUFFER ADDRESS        000A 47000013
         MVC   DECPOLPT(1,PARREG),4(WORKREG) MOVE INDEX BYTE FROM  000A 47200013
*    INPUT AREA TO HIGH ORDER BYTE OF DECPOLPT.                    000A 47400013
         B     SETUPRS                                             000A 47600013
NOTINQ1  EQU   *                                                 Y02947 47800002
         LA    ZEROREG,DISP4            SET NON ZERO VALUE TO    Y02947 47850002
*                            INDICATE A BUFFER MUST BE POSTED.   Y02947 47900002
         L     DEBREG,0(CCWREG)     LOAD PTR TO COMPLETED BFR    Y02947 48200002
         N     DEBREG,BUFMSK        ADJUST TO 1ST BYTE OF BFR    Y02947 48400002
         SH    DEBREG,FOUR                                       Y02947 48600002
         L     BUFREG,0(CCW2REG)      SET UP PARM FOR SV POST    Y02947 48700002
         N     BUFREG,BUFMSK          ADJUST TO 1ST BYTE OF BFR  Y02947 48800002
         SH    BUFREG,FOUR              BACK UP TO LINK FIELD    Y02947 48900002
         O     BUFREG,POSTMSK           OR IN COMPLETION CODE    Y02947 49000002
SETUPRS  MVC   1(3,CCWREG),RS2+1        MOVE ADRS OF 4 TO READ CCW 0583 50400013
         L     CCW2REG,8(CCWREG)        LOAD PTR TO PREVIOUS READ       50600013
         MVC   16(8,CCW2REG),RS2        OVERLAY R-S IN CCW 3 OR 5       50800013
*        CONSTRUCT A PCI MODIFY ENTRY FOR THE ALTERED CCW               50806002
         OI    12(CCW2REG),X'80'        TURN ON DATA CHAIN BIT   A32459 50830020
         L     PARREG,IOBECBPT(IOBREG)  GET POINTER TO DECB      A32452 50860020
         CLC   DECBUFCT(1,PARREG),DCBBUFCT(DCBREG) ALL BUFS USED A32452 50890020
         BL    CHECK                    IF NOT, BRANCH           Y02947 50920002
         MVC   22(2,CCW2REG),CCWCOUNT   MAKE COUNT 'C0'          A32452 50950020
CHECK    TM    TCBFLGS6,TCBRV           VIRTUAL = REAL           Y02947 50960002
         BO    EXIT1                    YES, CHECK FOR BUFFER    Y02947 50970002
*                                     POSTING.                   Y02947 50972002
         BAL   RETREG,BLDPARM           GET ADDR OF REAL CCWS    Y02947 50980002
         OI    DISP12(RCCWREG),DATACHN  TURN ON DATA CHAIN       Y02947 50990002
*                           IN REAL CCW                          Y02947 50992002
         L     WORKREG,DISP16(RCCWREG) LOAD VIRT DATA ADDR       Y02947 50994002
         LA    WORKREG,DISP0(WORKREG)  CLEAR HIGH ORDER BYTE     Y02947 50996002
         LRA   WORKREG,DISP0(WORKREG)  LOAD REAL DATA ADDR AND   Y02947 50998002
         STCM  WORKREG,7,DISP17(RCCWREG) STORE IN REAL CCW       Y02947 50998402
EXIT1    LTR   ZEROREG,ZEROREG          ANY BUFFERS TO BE        Y02947 51048402
*                                       POSTED?                  Y02947 51098402
         BZ    EXIT                     NO, PREPARE TO RETURN    Y02947 51148402
         LR    CCWREG,DEBREG            LOAD ECB ADDRESS         Y02947 51198402
         LR    CCW2REG,BUFREG           LOAD POST CODE           Y02947 51198802
EXIT2    EQU   *                                                 Y02947 51199202
*        IT IS NOT NECESSARY TO RESTORE REGISTERS 10,11,12,      Y02947 51199302
*        AND 13 BEFORE RETURNING TO IOS.                         Y02947 51199402
         LM    RETREG,BUF2REG,DISP0(SAVEREG) RESTORE REGISTERS   Y02947 51199602
*                     SO THAT SAVE AREA CAN BE USED BY PCIPOST   Y02947 51199702
         LR   IOBREG,BASEREG            REG 2 IS NOW THE BASE    Y02947 51199802
         DROP BASEREG                   DROP REG 12 ADDR         Y02947 51204802
         USING IGG019MC,IOBREG          REG 2 ADDRESSABILITY     Y02947 51206802
         PCIPOST ECB=(CCWREG),SVAREA=(SAVEREG),RQE=(RQEREG),CODE=(CCW2R-51209902
               EG)                                               Y02947 51214902
         DROP  IOBREG                   DROP REG 2 ADDR          Y02947 51215302
         USING IGG019MC,BASEREG         REG 12 ADDRESSABILITY    Y02947 51215702
*                                REG 12 RESTORED BY MACRO        Y02947 51216102
         L     IOBREG,RQEIOB-RQE(RQEREG)    RESTORE IOB ADDRESS  Y02947 51216902
         LA    IOBREG,DISP0(IOBREG)     CLEAR HIGH ORDER BYTE    Y02947 51218902
*       IF REGISTER 9 IS NOT RESTORED TO ITS ORIGINAL VALUE,     Y02947 51219802
*       IT MUST BE ZEROED BEFORE RETURNING TO IOS.               Y02947 51223102
         SR    CCWREG,CCWREG            CLEAR REGISTER BEFORE    Y02947 51226602
*                                       RETURNING TO IOS         Y02947 51229902
         BR    RETREG                   RETURN TO IOS            Y02947 51239902
         SPACE 2                                                        51246602
QUEUE    L     CCW2REG,8(CCWREG)        LOAD PTR TO NEXT CCW            51253302
         OI    15(CCWREG),X'01'        TURN ON PCI ENTRANCE BIT    1265 51260018
         NI    15(CCW2REG),X'FE'       TURN OFF PREVIOUS PCI     A27624 51330019
         L     WORKREG,4(QREG)          LOAD PTR TO 1ST CCW IN QUEUE    51400013
         C     WORKREG,ZERO             IS THIS FIRST ENTRY TO QUEUE    51600013
         BE    QIST                                                     51800013
         L     WORKREG,8(QREG)          LOAD PTR TO LAST CCW IN QUEVE   52000013
         ST    CCW2REG,0(WORKREG)       STORE CHAIN ADRS IN LAST ENTRY  52200013
         B     STLAST                                                   52400013
QIST     ST    CCW2REG,4(QREG)                                          52600013
STLAST   ST    CCW2REG,8(QREG)          ST PTR OF CCW AS LAST IN QUEUE  52800013
         MVC   0(4,CCW2REG),ZERO        ZERO IN CCW                     53000013
QPCI     TM    5(CCWREG),X'40'          IS T/P OP CODE 2ND PCI          53200013
         BZ    POSTBUF                  YES                             53400013
         NI    5(CCWREG),X'BF'          CHANGE T/P OP CODE PCI BIT      53600013
MOVEIND  L     PARREG,IOBECBPT(IOBREG) LOAD PTR TO DECB          A28629 53800019
         TM    DECTYPE(PARREG),AUTOPOLL IS AN AUTOPOLL OPERATION   000A 54000013
         BZ    EXIT                IN PROGRESS?  IF NOT, BRANCH    000A 54200013
         L     WORKREG,DECAREA(PARREG)  LOAD BUFFER ADDRESS        000A 54400013
         MVC   DECPOLPT(1,PARREG),4(WORKREG) MOVE INDEX BYTE FROM  000A 54600013
*    INPUT AREA TO HIGH ORDER BYTE OF DECPOLPT                     000A 54800013
         B     EXIT                                                     55000013
TIC      L     CCWREG,0(CCWREG)         LOAD ADRS OF NEXT READ CCW 0583 55200013
         L     BUFREG,0(CCWREG)         LOAD PTR TO BUFFER              55400013
         N     BUFREG,BUFMSK            ADJUST TO 1ST BYTE OF BFR       55600013
         SH    BUFREG,FOUR                                              55800013
         LA    ZEROREG,0(BUFREG)        PLACE BFR PTR IN REG 0          56000013
         LR    PARREG,DCBREG            LOAD PTR TO DCB INTO REG 1      56200013
         L     BRREG,0(QREG)            LOAD PTR TO RELEASE BFR ROUTINE 56400013
         LR    WORKREG,SAVEREG          SAVE IOS SAVEAREA ADDR   YM4064 56450002
         LA    SAVEREG,SAVEAREA         SAVEAREA ADDR FOR 19MS   YM4064 56500002
         BALR  RETREG,BRREG             LINK TO RELEASE BFR             56600013
         LR    SAVEREG,WORKREG       RESTORE IOS SAVEAREA ADDR   YM4064 56610002
         SR    ZEROREG,ZEROREG          CLEAR REGISTER TO        Y02947 56650002
*                             INDICATE NO BUFFER POSTING         Y02947 56700002
         B     SETUPRS                  GO TO SETUP READ-SKIP      0583 56800013
WRPCI    CLC   1(3,BUFREG),ZERO+1       IS CHAIN ADRS IN BFR ZERO       57000013
         BE    LASTWR                   YES, LAST BUFFER, POST ONLY     57200013
         OI    11(CCW2REG),X'01'        INVALIDATE FOLLOWING TIC ADRS   57400013
         TM    5(CCWREG),FIRSTPCI       IS THIS FIRST PCI INT      3712 57470016
         BZ    WRB                      IF NOT, BRANCH             3712 57540016
         L     BUF2REG,16(CCWREG)       LOAD NEXT BUFFER ADDRESS   3712 57610016
         SH    BUF2REG,FOUR             BACK UP TO LONK FIELD      3712 57680016
         B     WRC                                                 3712 57750016
WRB      L     BUF2REG,0(BUFREG)        LOAD NEXT BUFFER ADDRESS   3712 57820016
WRC      CLC   1(3,BUF2REG),ZERO+1      IS THE NEXT BUFFER THE LAST3712 57890016
         BNE   QWPCI                                                    58000013
         L     PARREG,IOBECBPT(IOBREG)  LOAD PTR TO ECB                 58200013
         TM    DECTYPE+1(PARREG),X'0D'  IS OPERATION CONVERSATIONAL000B 58260014
         BO    WRWL                     YES, BRANCH                000B 58320014
         LH    WORKREG,DECLNGTH(PARREG) LOAD LAST BFR COUNT             58400013
WRL      SH    WORKREG,FOUR             ADJUST COUNT               000B 58600014
         STH   WORKREG,6(CCW2REG)       STORE IN CCW                    58800013
         LA    CCWREG,0(CCWREG)         CLEAR HIGH BYTE        @ZA11431 58820000
         LA    CCW2REG,0(CCW2REG)       CLEAR HIGH BYTE        @ZA11431 58840000
         LR    WORKREG,CCWREG                                  @ZA04150 58860000
         AR    WORKREG,CCW2REG                                 @ZA04150 58880000
*****THE FOLLOWING INST DELETED BY AZ04150.******              @ZA04150 58900000
******   LA    WORKREG,0(CCWREG,CCW2REG) ADD TWO WRITE ADRS TOGETHER    58920000
         SRL   WORKREG,1                DIVIDE BY 2, RESULT = 1ST TIC   59200013
         NI    DISP4(CCW2REG),BF        SUPPRESS COMMAND        YA02156 59250002
*                                                    CHAINING   YA02156 59300002
         TM    21(WORKREG),X'80'        IS NEXT TIC CMND LAST CCW       59400013
         BO    NODC                     IF SO, BYPASS SET UP CHAINING   59600013
         OI    DISP4(CCW2REG),FORTY     INVOKE COMMAND CHAINING YA02156 59650002
         A     WORKREG,TICCHN           ADD CMND AND DIFFERENCE TO CCW  59800013
         ST    WORKREG,8(CCW2REG)           BEYOND 2ND TIC AND STORE    60000013
         OI    4(CCW2REG),X'20'         LEAVE SLI FLG ON           3712 60200016
NODC     NI    4(CCW2REG),X'7F'                                  A49689 60400002
QWPCI    TM    5(CCWREG),X'40'          IS T/P OP CODE FOR 2ND PCI      60600013
         BZ    MOVEPTR                                                  60800013
         NI    5(CCWREG),X'BF'          ZERO T/P OP CODE BIT  1         61000013
         SPACE 2                                                   000A 61200013
         BCR   15,0                     THIS INSTRUCTION IS        000A 61400013
*    REQUIRED FOR MODEL 91 SUPPORT TO ENSURE THAT THE FOLLOWING    000A 61600013
*    INSTRUCTION (WHICH VALIDATES THE ADDRESS IN THE NEXT TIC      000A 61800013
*    COMMAND) WILL BE EXECUTED IN SEQUENCE.                        000A 62000013
         NI    11(CCWREG),X'FE'         VALIDATE NEXT TIC ADDRESS  000A 62200013
         SPACE 1                                                        62250002
         BAL   RETREG,BLDPARM     BUILD ENTRIES IN PCI PARM LIST        62300002
         BAL   RETREG,ALTERCCW         ALTER REAL CCWS           Y02947 62310002
         B     EXIT                                                     62600013
         SPACE 2                                                 Y02947 62650002
WRWL     LH    WORKREG,DECWLNG(PARREG)  LOAD COUNT                 000B 62660014
         B     WRL                                                 000B 62720014
MOVEPTR  MVC   1(3,CCW2REG),1(BUFREG)   MOVE PTR TO NXT BFR TO CCW      62800013
         L     WORKREG,0(CCW2REG)       ADD 4 TO CCW BFR ADRS FOR       63000013
         AH    WORKREG,FOUR                                             63200013
         ST    WORKREG,0(CCW2REG)                                       63400013
         SPACE 2                                                   000A 63600013
         BCR   15,0                     THIS INSTRUCTION IS        000A 63800013
*    REQUIRED FOR MODEL 91 SUPPORT TO ENSURE THAT THE FOLLOWING    000A 64000013
*    INSTRUCTION (WHICH VALIDATES THE ADDRESS IN THE NEXT TIC      000A 64200013
*    COMMAND) WILL BE EXECUTED IN SEQUENCE.                        000A 64400013
         NI    11(CCWREG),X'FE'         VALIDATE NEXT TIC ADDRESS  000A 64600013
         SPACE 1                                                        64660002
         BAL   RETREG,BLDPARM     BUILD ENTRIES IN PCI PARM LIST        64720002
         BAL   RETREG,ALTERCCW         ALTER REAL CCWS           Y02947 64770002
         B     ZEROCC                                                   65000013
         SPACE 2                                                        65010002
*        CONSTRUCT ENTRIES IN THE PCI MODIFY PARAMETER LIST             65020002
         SPACE 1                                                        65030002
BLDPARM  DS    0H                                                       65040002
         TM    TCBFLGS6,TCBRV           VIRTUAL = REAL           Y02947 65050002
         BO    RETURN0                  YES, NO VIRTUAL CCW'S    Y02947 65060002
         L     WORKREG,DISP12(SAVEREG)  LOAD RQE ADDRESS         Y02947 65090002
         USING RQE,WORKREG          ESTABLISH RQE ADDR           Y02947 65118002
         L     BUF2REG,RQETCCW     LOAD TCCW ADDR (TRANSLATED)   Y02947 65118402
         DROP  WORKREG              DROP RQE ADDRESSABILITY      Y02947 65118802
         USING TCCW,BUF2REG         ESTABLISH TCCW ADDR          Y02947 65119202
         LR    RCCWREG,CCW2REG      VIRT ADDR OF DESIRED CCW     Y02947 65119602
         S     RCCWREG,IOBCPA(IOBREG) GET CCW OFFSET FROM        Y02947 65119702
*                        BEGINNING OF CHANNEL PROGRAM AREA       Y02947 65119802
         L     WORKREG,TCCWFRC GET ADDR OF FIRST REAL CCW        Y02947 65119902
         AR    RCCWREG,WORKREG    GET REAL ADDR OF DESIRED CCW   Y02947 65123202
         DROP  BUF2REG            DROP TCCW ADDRESSABILITY       Y02947 65125202
RETURN0  BR    RETREG                                                   65126702
         SPACE 1                                                        65130002
LASTWR   TM    13(CCWREG),X'80'         IS NEXT CWW THE LAST            65200013
         BO    ZEROCC                   IF SO, NO SWEAT, ADRS O.K.      65400013
         TM    21(CCWREG),X'2E'        IS FOLLOWING CCW DATA     A26889 65460019
         BNZ   SUB32                   NO, BRANCH                A26889 65520019
         TM    21(CCWREG),X'10'         IS FOLLOWING CCW A DATA CCW     65600013
         BO    MVCSAVE                  IF SO, BRANCH                   65800013
SUB32    SH    CCWREG,THIRTY2          SUBTRACT 32               A26889 66000019
MVCSAVE  MVC   SAVEBFR+1(3),17(CCWREG)  MOVE BUFFER ADRS TO SAVE AREA   66200013
ZEROCC   MVI   0(BUFREG),X'00'          ZERO COMPLETION CODE IN THIS BF 66400013
POSTBUF  EQU   *                                                 Y02947 66600002
         ST    BUFREG,BUFPOST           STORE BUFFER ADDRESS            67000013
         MVC   BUFPOST(1),POSTCODE      MOVE IN WRROR CODE IF ANY       67200013
         L     CCW2REG,BUFPOST       LOAD BFR ADRS AS ECB CODE   Y02947 67400002
         NI    SAVEBFR+3,X'FC'                                          67600013
         L     CCWREG,SAVEBFR        LOAD PTR TO COMPLETED BFR   Y02947 67800002
         SH    CCWREG,FOUR           ADJUST TO 1ST BYTE OF BFR   Y02947 68000002
         MVI   POSTCODE,X'7F'           RESET POSTING CODE              69000013
         B    EXIT2                     GO POST BUFFER           Y02947 69050002
EXIT     LM    RETREG,CCWREG,DISP0(SAVEREG) RESTORE REGISTERS    Y02947 69200002
         BR    RETREG                 RETURN                     Y02947 69250002
         SPACE 3                                                 Y02947 69300002
ALTERCCW TM    TCBFLGS6,TCBRV           VIRTUAL = REAL           Y02947 69350002
         BO    RETURN1                  YES, NO VIRTUAL CCW'S    Y02947 69400002
         MVC   DISP0(LEN16,RCCWREG),DISP0(CCW2REG) MOVE NEXT     Y02947 69498002
*                     R/W CCW AND FOLLOWING TIC OR RD SKIP       Y02947 69498402
         LR    BUF2REG,CCWREG      LOAD INTERRUPTED CCW ADDR     Y02947 69498802
         S     BUF2REG,IOBCPA(IOBREG) GET CCW OFFSET FROM        Y02947 69499202
*                     BEGINNING OF CHANNEL PROGRAM AREA          Y02947 69499602
         AR    BUF2REG,WORKREG     GET ADDR OF REAL CCW          Y02947 69499702
         MVC   DISP8(LEN8,BUF2REG),DISP8(CCWREG) MOVE TIC OR     Y02947 69499802
*                     RD SKIP CCW AFTER INTERRUPTED CCW          Y02947 69499902
         STCM  RCCWREG,7,DISP8(BUF2REG) MAKE REAL TIC OR         Y02947 69533202
*                     RD SKIP POINT TO NEXT CCW                  Y02947 69543202
         TM    DISP11(CCW2REG),INVTIC INVALID TIC ADDR           Y02947 69553202
         BNO   NOTON0              NO, DO NOT ALTER REAL CCW     Y02947 69563202
         OI    DISP11(RCCWREG),INVTIC MAKE REAL TIC INVALID      Y02947 69565202
NOTON0   STCM  BUF2REG,7,DISP8(RCCWREG) MAKE REAL TIC OR         Y02947 69565602
*                     RD SKIP POINT TO NEXT CCW                  Y02947 69566002
         TM    DISP11(CCWREG),INVTIC INVALID TIC ADDR            Y02947 69566402
         BNO   NOTON1              NO, DO NOT ALTER REAL CCW     Y02947 69566502
         OI    DISP11(BUF2REG),INVTIC MAKE REAL TIC CCW          Y02947 69566602
*                             ADDRESS INVALID                    Y02947 69576602
NOTON1   L     WORKREG,DISP0(RCCWREG) LOAD VIRT DATA ADDR        Y02947 69577702
         LA    WORKREG,DISP0(WORKREG) CLEAR HIGH ORDER BYTE      Y02947 69587702
         LR    WKRG3,WORKREG       VIRT DATA ADDR                Y02947 69588102
         N     WORKREG,PAGE4K      GET STARTING PAGE BOUNDARY    Y02947 69588502
         AH    WKRG3,DISP6(RCCWREG) ADD DATA LENGTH              Y02947 69588602
         N     WKRG3,PAGE4K        GET ENDING PAGE BOUNDARY      Y02947 69588702
         CR    WKRG3,WORKREG       DOES DATA CROSS PAGE BNDRY    Y02947 69588802
         BNH   GETREAL             NO, DO NOT NEED IDAL          Y02947 69592502
         SR    WORKREG,WORKREG     CLEAR REGISTER                Y02947 69594502
         IC    WORKREG,DCBEIOBX(DCBREG) IOB SIZE                 Y02947 69594902
         AR    IOBREG,WORKREG      POINT TO END OF IOB           Y02947 69595302
         SH    IOBREG,EIGHT        POINT TO DYN BUF EXT          Y02947 69595702
         L     WORKREG,DISP4(IOBREG) GET VSL ADDR                Y02947 69596102
         L     WORKREG,DISP0(WORKREG) GET 1ST IDAL ADDR          Y02947 69596202
         OI    DISP4(RCCWREG),IDAWFLAG TURN ON IDAW FLAG IN      Y02947 69646202
*                             REAL CCW                           Y02947 69648202
         CR    CCWREG,CCW2REG      USE 1ST OR 2ND IDAL           Y02947 69656202
         BL    KEEP                KEEP ADDR OF 1ST IDAL         Y02947 69666202
         L     WORKREG,DISP0(WORKREG) LOAD ADDR OF 2ND IDAL      Y02947 69676202
KEEP     LA    WORKREG,DISP8(WORKREG) ADDR IDAW ENTRIES          Y02947 69686202
         LRA   WKRG3,DISP0(WORKREG) GET REAL IDAW ADDR AND       Y02947 69688202
         STCM  WKRG3,7,DISP1(RCCWREG) STORE IN REAL CCW          Y02947 69690202
         L     WKRG3,DISP0(CCW2REG) GET VIRT DATA ADDR           Y02947 69692202
         LA    WKRG3,DISP0(WKRG3)  CLEAR HIGH ORDER BYTE         Y02947 69694202
         LR    WKRG2,WKRG3         VIRT DATA ADDR                Y02947 69694602
         N     WKRG2,PAGE2K        GET STARTING 2K ADDR          Y02947 69695002
         CLC   DISP6(LEN2,RCCWREG),TWOK LENGTH GREATER THAN 2K   Y02947 69695402
         BH    SETUP               YES, DETERMINE NUM OF IDAWS   Y02947 69695802
         LA    WKRG4,TWO           NUM OF IDAWS                  Y02947 69695902
MORE     LRA   WKRG3,DISP0(WKRG3)  REAL DATA ADDR                Y02947 69696002
         ST    WKRG3,DISP0(WORKREG) STORE REAL DATA ADDR IN      Y02947 69696102
*                             IDAW                               Y02947 69706102
         LA    WORKREG,DISP4(WORKREG) ADDR NEXT IDAW             Y02947 69712802
         A     WKRG2,FUL2K         LOAD NEXT 2K BOUNDARY         Y02947 69722802
         LR    WKRG3,WKRG2         PUT IN RIGHT REG              Y02947 69724802
         BCT   WKRG4,MORE          BRANCH UNTIL NUM OF IDAWS=0   Y02947 69726802
         B     EXIT0               PREPARE TO RETURN             Y02947 69728802
GETREAL  L     WKRG3,DISP0(RCCWREG) VIRT DATA ADDR               Y02947 69729202
         LA    WKRG3,DISP0(WKRG3)  CLEAR HIGH ORDER BYTE         Y02947 69729302
         LRA   WKRG3,DISP0(WKRG3)  GET REAL DATA ADDR AND        Y02947 69729402
         STCM  WKRG3,7,DISP1(RCCWREG) STORE IN REAL CCW          Y02947 69735002
         NI    DISP4(RCCWREG),IDAWOFF TURN OFF IDAW CCW FLAG     Y02947 69737002
         B     EXIT0               PREPARE TO RETURN             Y02947 69739002
SETUP    LH    WKRG4,DISP6(RCCWREG) GET LENGTH                   Y02947 69739402
         SRL   WKRG4,ELEVEN DIVIDE BY 2K TO GET NUM OF IDAWS     Y02947 69739802
         LA    WKRG4,DISP2(WKRG4) ADD TWO FOR START AND END      Y02947 69740202
         B     MORE                SET UP CCW                    Y02947 69740302
EXIT0    LM    IOBREG,DCBREG,DISP16(SAVEREG) RESTORE REGISTERS   Y02947 69740402
RETURN1  BR    RETREG              RETURN                        Y02947 69740502
         SPACE 5                                                 Y02947 69755302
COMPARE  CLI   NINE,0                                                   69770402
EIGHT    DC    H'8'                                                     69785202
FOUR     DC    H'4'                                                     69800013
THIRTY2  DC    H'32'                                                    70000013
TWOK     DC    H'2048'             2K (2048) BYTES               Y02947 70050002
TWENTY   DC    H'20'                                        LD @ZA02312 70100003
ZERO     DC    F'0'                                                     70200013
SAVEBFR  DC    F'0'                     PREVIOUS BUFFER ADDRESS         70400013
BUFPOST  DC    F'0'                     BUFFER AS ECB ADDRESS           70600013
         DS    0F                                                Y02947 70602002
PAGE4K   DC    X'00FFF000'         MASK TO OBTAIN 4K PG BNDRY    Y02947 70610002
PAGE2K   DC    X'00FFF800'         MASK TO OBTAIN 2K PG BNDRY    Y02947 70612002
FUL2K    DC    X'00000800'         2K (2048) BYTES               Y02947 70614002
TEXT     EQU   X'10'                                                    70620002
POLL     EQU   X'09'                                                    70640002
NOP      EQU   X'03'                                                    70660002
NOPTPCD  EQU   X'09'                                                    70680002
DYNBUF   EQU   X'08'                                                    70700002
DCBBFTEK EQU   32                                                       70720002
BISYNC   EQU   X'90'                    BSC DEVICE TYPE         YA02155 70730002
BUFFIX   EQU   X'40'                    ECB COMPLETION BIT       Y02947 70770002
RDTI     EQU   X'01'                    READ INITIAL           @ZA04188 70777000
USASCII  EQU   X'14'                    USASCII DCB CODE       @ZA04188 70784000
DCBXCODE EQU   X'39'           CONTROL STATION FLAG XMISSION   @ZA04188 70791000
BYTE     DC    X'12'                                                    70800013
POSTCODE DC    X'7F'                    POSTING CODE                    71000013
NINE     DC    X'09'                                               000C 71100015
SAVEAREA DC    18F'0'                   SAVE AREA FOR BUFFER     YM4064 71400002
*                                       ROUTINE (IGG019MS)       YM4064 71450002
POSTMSK  DC    X'7F000000'              COMPLETION CODE MASK            71600013
ZEROE    DC    X'01000000'                                              71800013
TICCHN   DC    X'08000018'                                              72000013
TICMASK  DC    X'FFFFFFFE'              TIC MASK FOR VALIDATING ADRS    72200013
BUFMSK   DC    X'00FFFFFC'                                         3712 72400016
RS2      DC    X'02'                    COMMAND - READ                  72600013
         DC    X'000004'                AREA                            72800013
         DC    X'30'                    FLAGS - SLI,SKIP                73000013
         DC    X'12'                    T/P OP CODE                     73200013
         DC    X'7FFD'                  COUNT                           73400013
CCWCOUNT DC    X'00C0'                                           A32452 73500020
STATUS   DC    X'0080'                                                  73600013
CEDEPCI  DC    X'0C80'                  CHAN/DEVICE END PCI        3712 73700016
R10DISP  EQU   48                                                       73710002
RDPCI    EQU   X'51'                                             A28629 73730019
UCORUE   EQU   X'03'                                             A28629 73760019
         EJECT                                                   Y02947 73762002
CVT      DSECT                                                   Y02947 73770002
         CVT   LIST=NO                                           Y02947 73780002
         EJECT                                                   Y02947 73790002
         IKJTCB DSECT=YES,LIST=YES                               Y02947 73792002
         EJECT                                                   Y02947 73794002
         IECDRQE                                                 Y02947 73796002
         EJECT                                                   Y02947 73798002
         IECDTCCW                                                Y02947 73798402
         EJECT                                                   Y02947 73798802
         IHASRB                                                  Y02947 73799202
         EJECT                                                   Y02947 73799602
         IHAASVT                                                 Y02947 73799702
         EJECT                                                   Y02947 73799802
         IECDIOSB                                                Y02947 73799902
         CNOP  0,8                                                      73800013
         END                                                            74000013
./  ADD  SSI=13160032,NAME=IGG019MD
         TITLE 'IGG019MD - IBM 1050 NON-SWITCHED DEVICE I/O MODULE'     00020000
IGG019MD CSECT                                                          00040000
         SPACE 2                                                        00060014
* STATUS -          CHANGE LEVEL  002   AUGUST  5,1969             000M 00080019
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    AL1(RC-A)                READ CONTINUE                   00740000
         DC    AL1(WC-A)                WRITE CONTINUE                  00760000
         DC    X'FF'                                                    00780000
         DC    X'FF'                                                    00800000
         DC    AL1(RR-A)                READ REPEAT                     00820000
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           00880000
         DC    X'FF'                                                    00900000
         DC    X'FF'                                                    00920000
         DC    X'FF'                                                    00940000
         DC    X'FF'                                                    00960000
         DC    AL1(WTTV-A)           0F WRITE CONTINUE CONVERSATION000M 00966019
         DC    AL1(WCT-A)               WRITE CONTROL            A27629 00970019
         DC    7X'FF'                                            A27629 00974019
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
RI       DC    X'040005070B810E'        READ INITIAL                    01040000
WI       DC    X'06000608020C098101'    WRITE INITIAL                   01060000
RC       DC    X'02030A810E'            READ CONTINUE                   01080000
WC       DC    X'020C098101'            WRITE CONTINUE                  01100000
RR       DC    X'02040A810E'            READ REPEAT                     01120000
WA       DC    X'010E'                  WRITE ACKNOWLEDGE               01140000
RS       DC    X'010D'                  READ SKIP                       01160000
WN       DC    X'0101'                  WRITE NEG-ACKNOWLEDGE           01180000
WTTV     DC    X'06100F0005070B'        WRITE CONTINUE CONVERSATION000M 01190019
WCT      DC    X'021112'                WRITE CONTROL            A27629 01195019
         SPACE 3                                                        01200000
*                   C C W 'S               I/O      F L A G S    LENGTH 01220000
*                                       OPERATION CD   CC   SLI    =    01240000
C        DC    X'010C009980020003'      WR CCC    X                3    01260019
         DC    X'010C009920210003'      WR CCC              X      3    01280019
         DC    X'010C009880080001'      WR D      X                1    01300019
         DC    X'010C009C60020001'      WR Y           X    X      1    01320019
         DC    X'010C009D60020001'      WR N           X    X      1    01340019
         DC    X'0114040060030002'      WR POLL        X    X      2    01360000
         DC    X'0114000060030002'      WR ADRS        X    X      2    01380000
         DC    X'0204000080050002'      RD RESP   X                2    01400000
         DC    X'0208000000060001'      RD RESP                    1    01420000
         DC    X'0208000100200001'      RD RESP                    1    01440000
         DC    X'0204000020110400'      RD DATA             X      N    01460000
         DC    X'0204000220110402'      RD DATA             X      N-2  01480000
         DC    X'0104000060110400'      WR DATA        X    X      N    01500000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01520000
         DC    X'010C009820210004'      WR DCCC             X      4    01530019
         DC    X'0208000160200001'      RD RESP        X   X     1 000M 01540019
         DC    X'0138000060110800'      WR DATA        X    X   N  000M 01550019
         DC    X'2F00000060010001'      DISABLE        X    X      1    01553019
         DC    X'2700000020240001'      ENABLE              X      1    01556019
         SPACE 2                                                        01560000
CC       EQU   *-C                      SPECIAL CHARACTER OFFSET   000M 01570019
         DC    X'16'                    CIRCLE D                        01580000
         DC    X'1F1F1F'                CIRCLE C                        01600000
         DC    X'76'                    CIRCLE Y                        01620000
         DC    X'40'                    CIRCLE N                        01640000
         CNOP  0,8                                                      01660000
         END                                                            01680000
./  ADD  SSI=13160033,NAME=IGG019ME
         TITLE 'IGG319ME - 1050 NON-SWITCHED WITH AUTOPOLL I/O MODULE'  01000013
IGG019ME CSECT                                                          02000013
* STATUS -              CHANGE LEVEL   001,     AUGUST 3,1967           03000014
         SPACE 2                                                        04000013
         SPACE                                                          05000013
*FUNCTION -                                                             06000013
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       07000013
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        08000013
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        09000013
*              CHANNEL PROGRAMS.                                        10000013
         SPACE 2                                                        11000013
*              EACH OF THE FIRST 16 BYTES CONTAINS AN OFFSET TO THE     12000013
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        13000013
*              OPERATION.                                               14000013
         SPACE 2                                                        15000013
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       16000013
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       17000013
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  18000013
         SPACE 4                                                        19000013
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  20000013
         SPACE                                                          21000013
*                   DC   X'0403050906820008'                            22000013
         SPACE                                                          23000013
*                        04 = COUNT OF CCW'S                            24000013
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  25000013
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  26000013
*                             INDICATES RESET)                          27000013
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  28000013
         SPACE 4                                                        29000013
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         30000013
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     31000013
*        AT OPEN TIME.                                                  32000013
         EJECT                                                          33000013
A        DC    X'FF'                                                    34000013
         DC    AL1(RI-A)                READ INITIAL                    35000013
         DC    AL1(WI-A)                WRITE INITIAL                   36000013
         DC    AL1(RC-A)                READ CONTINUE                   37000013
         DC    AL1(WC-A)                WRITE CONTINUE                  38000013
         DC    X'FF'                                                    39000013
         DC    X'FF'                                                    40000013
         DC    AL1(RR-A)                READ REPEAT                     41000013
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               42000013
         DC    AL1(RS-A)                READ SKIP                       43000013
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           44000013
         DC    X'FF'                                                    45000013
         DC    X'FF'                                                    46000013
         DC    X'FF'                                                    47000013
         DC    X'FF'                                                    48000013
         DC    9X'FF'                                                   48500014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 49000013
         DC    7X'FF'                                                   49500014
         SPACE 2                                                        50000013
*                   CHANNEL PROGRAMS                                    51000013
RI       DC    X'040F05070B810E'        READ INITIAL                    52000013
WI       DC    X'06000608020C098101'    WRITE INITIAL                   53000013
RC       DC    X'02030A810E'            READ CONTINUE                   54000013
WC       DC    X'020C098101'            WRITE CONTINUE                  55000013
RR       DC    X'02040A810E'            READ REPEAT                     56000013
WA       DC    X'010E'                  WRITE ACKNOWLEDGE               57000013
RS       DC    X'010D'                  READ SKIP                       58000013
WN       DC    X'0101'                  WRITE NEG-ACKNOWLEDGE           59000013
         SPACE 3                                                        60000013
*                   C C W 'S               I/O      F L A G S    LENGTH 61000013
*                                       OPERATION CD   CC   SLI    =    62000013
C        DC    X'010C008180020003'      WR CCC    X                3    63000013
         DC    X'010C008120210003'      WR CCC              X      3    64000013
         DC    X'010C008080080001'      WR D      X                1    65000013
         DC    X'010C008460020001'      WR Y           X    X      1    66000013
         DC    X'010C008560020001'      WR N           X    X      1    67000013
         DC    X'0924000060030000'      WR POLL        X    X     LIST  68000013
         DC    X'0114000060030002'      WR ADRS        X    X      2    69000013
         DC    X'02040000800A0002'      RD INDX   X                2    70000013
         DC    X'0208000000060001'      RD RESP                    1    71000013
         DC    X'0208000100200001'      RD RESP                    1    72000013
         DC    X'0204000020110400'      RD DATA             X      N    73000013
         DC    X'0204000220110402'      RD DATA             X      N-2  74000013
         DC    X'0104000060110400'      WR DATA        X    X      N    75000013
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    76000013
         DC    X'010C008020210004'       WR DCCC            X      4    77000013
         DC    X'010C008160020003'      WR CCC         X    X      3    78000013
         SPACE 2                                                        79000013
         DC    X'16'                    CIRCLE D                        80000013
         DC    X'1F1F1F'                CIRCLE C                        81000013
         DC    X'76'                    CIRCLE Y                        82000013
         DC    X'40'                    CIRCLE N                        83000013
         CNOP  0,8                                                      84000013
         END                                                            85000013
./  ADD  SSI=13160034,NAME=IGG019MF
         TITLE 'IGG019MF - 1050 SWITCHED DEVICE I/O MODULE'             00020000
IGG019MF CSECT                                                          00040000
         SPACE 2                                                        00050014
* STATUS -          CHANGE LEVEL  002   AUGUST  5,1969             000M 00060019
         SPACE                                                          00080000
*FUNCTION -                                                             00100000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00120000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00140000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00160000
*              CHANNEL PROGRAMS.                                        00180000
         SPACE 2                                                        00200000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00220014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00240000
*              OPERATION.                                               00260000
         SPACE 2                                                        00280000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00300000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00320000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00340000
         SPACE 4                                                        00360000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00380000
         SPACE                                                          00400000
*                   DC   X'0403050906820008'                            00420000
         SPACE                                                          00440000
*                        04 = COUNT OF CCW'S                            00460000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00480000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00500000
*                             INDICATES RESET)                          00520000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00540000
         SPACE 4                                                        00560000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00580000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00600000
*        AT OPEN TIME.                                                  00620000
         EJECT                                                          00640000
A        DC    X'FF'                 00                                 00660000
         DC    AL1(RI-A)             01 READ INITIAL                    00680000
         DC    AL1(WI-A)             02 WRITE INITIAL                   00700000
         DC    AL1(RC-A)             03 READ CONTINUE                   00720000
         DC    AL1(WC-A)             04 WRITE CONTINUE                  00740000
         DC    AL1(RV-A)             05 READ CONVERSATIONAL             00760000
         DC    AL1(WV-A)             06 WRITE CONVERSATIONAL            00780000
         DC    AL1(RR-A)             07 READ REPEAT                     00800000
         DC    AL1(WA-A)             08 WR ACKNOWLEDGE                  00820000
         DC    AL1(RS-A)             09 READ-SKIP                       00840000
         DC    AL1(WN-A)             0A WR NEG-ACKNOWLEDGE              00860000
         DC    X'FF'                 0B                                 00880000
         DC    X'FF'                 0C                                 00900000
         DC    X'FF'                 0D                                 00920000
         DC    X'FF'                 0E                                 00940000
         DC    AL1(WTTV-A)           0F WRITE CONTINUE CONVERSATION000M 00946019
         DC    8X'FF'                                              000M 00952019
         DC    AL1(C-A)                                                 00960000
         DC    7X'FF'                                              000B 00970014
         SPACE 2                                                        00980000
*                   CHANNEL PROGRAMS                                    01000000
RI       DC    X'070A0907010C0E1182030B'         READ INITIAL           01020000
WI       DC    X'090A0907010D0F04131082000B'     WRITE INITIAL          01040000
RC       DC    X'02061282030B'                   READ CONTINUE          01060000
WC       DC    X'02131082000B'                   WRITE CONTINUE         01080000
RV       DC    X'04010C0E1182030B'               READ CONVERSATION      01100000
WV       DC    X'06020D0F04131082000B'           WRITE CONVERSATION     01120000
RR       DC    X'02051282030B'                   READ REPEAT            01140000
WA       DC    X'02030B'                         WRITE ACKNOWLEDGE      01160000
WN       DC    X'02000B'                         WRITE NEG-ACKNOWLEDGE  01180000
RS       DC    X'0114'                            READ SKIP             01200000
WTTV     DC    X'061615010C0E11'        WRITE CONTINUE CONVERSATION000M 01210019
         SPACE  3                                                       01220000
*                   C C W 'S               I/O      F L A G S           01240000
*                                       OPERATION CD   CC   SLI  L=     01260000
C        DC    X'010C00B960210001'      WR   C         X    X   1  000M 01280019
         DC    X'010C00B980020003'      WR CCC   X               3 000M 01300019
         DC    X'010C00B880020004'      WR DCCC   X                000M 01320019
         DC    X'010C00B860210002'      WR DC          X    X    I 000M 01340019
         DC    X'010C00B880080001'      WR D     X               1 000M 01360019
         DC    X'010C00BC60020001'      WR N           X    X    1 000M 01380019
         DC    X'010C00BD60020001'      WR Y           X    X    1 000M 01400019
         DC    X'010C00BE6001000F'      WR PAD        X    X   15  000M 01420019
         DC    X'2700000020010001'      ENABLE              X    1      01440000
         DC    X'2910000160010000'      DIAL           X    X    N      01460000
         DC    X'2F20000060010001'      DISABLE        X    X    1      01480000
         DC    X'2F00000020210001'      DISABLE             X    1      01500000
         DC    X'011C040060030002'      WR POLL       X    X    2       01520000
         DC    X'011C000060030002'      WR ADRS       X    X    2       01540000
         DC    X'0204000080050002'      RD RESP   X              2      01560000
         DC    X'0208000000060001'      RD RESP                  1      01580000
         DC    X'0208000100200001'      RD RESP                  1      01600000
         DC    X'0204000220110402'      RD DATA             X    N-2    01620000
         DC    X'0204000020110400'      RD DATA             X    N      01640000
         DC    X'0104000060110400'      WR DATA        X    X   N       01660000
         DC    X'0200000030220400'      RD-SKIP   SKIP FLAG X    N      01680000
         DC    X'0208000160200001'      RD RESP        X   X     1 000M 01684019
         DC    X'0138000060110800'      WR DATA        X    X   N  000M 01688019
         SPACE 2                                                   000M 01692019
CC       EQU   *-C                      SPECIAL CHARACTER OFFSET   000M 01696019
         DC    X'16'                    CIRCLE D                        01700000
         DC    X'1F1F1F'                CIRCLE C                        01720000
         DC    X'40'                    CIRCLE N                        01740000
         DC    X'76'                    CIRCLE Y                        01760000
         DC    15X'DF'                  PAD CHARACTER                   01780000
         CNOP  0,8                                                      01800000
         END                                                            01820000
./  ADD  SSI=13160035,NAME=IGG019MI
         TITLE 'IGG019MI - IBM 1060 DEVICE I/O MODULE'                  00020000
IGG019MI CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    AL1(RC-A)                READ CONTINUE                   00740000
         DC    X'FF'                                                    00760000
         DC    X'FF'                                                    00780000
         DC    X'FF'                                                    00800000
         DC    AL1(RR-A)                READ REPEAT                     00820000
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           00880000
         DC    X'FF'                                                    00900000
         DC    X'FF'                                                    00920000
         DC    X'FF'                                                    00940000
         DC    X'FF'                                                    00960000
         DC    9X'FF'                                              000B 00970014
         DC    AL1(C-A)                 OFFSETS TO CCW'S                00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
RI       DC    X'040005070A8102'        READ INITIAL                    01040000
WI       DC    X'060006080D0B098101'    WRITE INITIAL                   01060000
RC       DC    X'040305070A8102'        READ CONTINUE                   01080000
RR       DC    X'040405070A8102'        READ REPEAT                     01100000
WA       DC    X'0102'                  WRITE ACKNOWLEDGE               01120000
RS       DC    X'010C'                  READ SKIP                       01140000
WN       DC    X'0101'                  WRITE NEG-ACKNOWLEDGE           01160000
         SPACE 3                                                        01180000
*                   C C W 'S               I/O      F L A G S    LENGTH 01200000
*                                       OPERATION CD   CC   SLI    =    01220000
C        DC    X'010C007180020003'      WR CCC    X                3    01240000
         DC    X'010C007120210003'      WR CCC              X      3    01260000
         DC    X'010C007420210004'      WR YCCC             X      4    01280000
         DC    X'010C007480020004'      WR YCCC   X                1    01300000
         DC    X'010C007880020004'      WR NCCC   X                4    01320000
         DC    X'0114040060030002'      WR POLL        X    X      2    01340000
         DC    X'0114000060030002'      WR ADRS        X    X      2    01360000
         DC    X'0204000080050002'      RD RESP   X                2    01380000
         DC    X'0208000000060001'      RD RESP                    1    01400000
         DC    X'0208000120200001'      RD RESP             X      1    01420000
         DC    X'0204000220110402'      RD DATA             X      N-2  01440000
         DC    X'0104000060110400'      WR DATA        X    X      N    01460000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01480000
         DC    X'010C007080080001'     WR D       X                1    01500000
         SPACE 2                                                        01520000
         DC    X'16'                    CIRCLE D                        01540000
         DC    X'1F1F1F'                CIRCLE C'S                      01560000
         DC    X'761F1F1F'              CIRCLE Y                        01580000
         DC    X'401F1F1F'              CIRCLE N                        01600000
         CNOP  0,8                                                      01620000
         END                                                            01640000
./  ADD  SSI=13160036,NAME=IGG019MJ
         TITLE 'IGG019MJ - IBM 1030 DEVICE I/O MODULE'                  00020000
IGG019MJ CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    AL1(RC-A)                READ CONTINUE                   00740000
         DC    AL1(WC-A)                WRITE CONTINUE                  00760000
         DC    X'FF'                                                    00780000
         DC    X'FF'                                                    00800000
         DC    AL1(RR-A)                READ REPEAT                     00820000
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           00880000
         DC    X'FF'                                                    00900000
         DC    X'FF'                                                    00920000
         DC    X'FF'                                                    00940000
         DC    X'FF'                                                    00960000
         DC    9X'FF'                                              000B 00970014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
RI       DC    X'040006080B8103'        READ INITIAL                    01040000
WI       DC    X'0702070509100C0A8101'  WRITE INITIAL                   01060000
RC       DC    X'040F06080B8103'        READ CONTINUE                   01080000
WC       DC    X'020D0A8101'            WRITE CONTINUE                  01100000
RR       DC    X'040406080B8103'        READ REPEAT                     01120000
WA       DC    X'0103'                 WRITE ACKNOWLEDGE                01140000
RS       DC    X'010E8103'              READ SKIP                       01160000
WN       DC    X'0101'                  WRITE NEG-ACKNOWLEDGE           01180000
         SPACE 3                                                        01200000
*                   C C W 'S               I/O      F L A G S    LENGTH 01220000
*                                       OPERATION CD   CC   SLI    =    01240000
C        DC    X'010C008980020003'      WR CCC    X                3    01260000
         DC    X'010C008920210003'      WR CCC              X      3    01280000
         DC    X'010C008980020004'      WR CCCS   X                4    01300000
         DC    X'010C008D20210004'      WR YCCC             X      4    01320000
         DC    X'010C008880020004'      WR NCCC   X                4    01340000
         DC    X'010C009160040001'      WR 1           X    X      1    01360000
         DC    X'0114040060030001'      WR POLL        X    X      1    01380000
         DC    X'0114000080030001'      WR ADRS        X    X      1    01400000
         DC    X'0204000080050002'      RD RESP   X                2    01420000
         DC    X'0208000040060001'      RD RESP        X           1    01440000
         DC    X'0208000100200001'      RD RESP             0      1    01460000
         DC    X'0204000220110402'      RD DATA             X      N-2  01480000
         DC    X'0104000060110400'      WR DATA        X    X      N    01500000
         DC    X'0104000060110400'      WR DATA        X    X      N    01520000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01540000
         DC    X'010C008D80020004'     WR YCCC    X                4    01560000
         DC    X'010C009280080001'     WR D       X                1    01580000
         SPACE 2                                                        01600000
         DC    X'40'                    CIRCLE N                        01620000
         DC    X'1F1F1F'                CIRCLE C'S                      01640000
         DC    X'37'                    CIRCLE S                        01660000
         DC    X'761F1F1F'              CIRCLE Y                        01680000
         DC    X'02'                    CIRCLE 1                        01700000
         DC    X'16'                   CIRCLE D                         01720000
         CNOP  0,8                                                      01740000
         END                                                            01760000
./  ADD  SSI=13160037,NAME=IGG019MK
         TITLE 'IGG019MK - IBM 1030 WITH AUTOPOLL DEVICE I/O MODULE'    01000013
IGG019MK CSECT                                                          02000013
* STATUS  -             CHANGE LEVEL   001    AUGUST 3, 1967       000B 04000014
         SPACE                                                          06000013
*FUNCTION -                                                             07000013
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       08000013
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        09000013
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        10000013
*              CHANNEL PROGRAMS.                                        11000013
         SPACE 2                                                        12000013
*              EACH OF THE FIRST 16 BYTES CONTAINS AN OFFSET TO THE     13000013
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        14000013
*              OPERATION.                                               15000013
         SPACE 2                                                        16000013
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       17000013
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       18000013
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  19000013
         SPACE 4                                                        20000013
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  21000013
         SPACE                                                          22000013
*                   DC   X'0403050906820008'                            23000013
         SPACE                                                          24000013
*                        04 = COUNT OF CCW'S                            25000013
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  26000013
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  27000013
*                             INDICATES RESET)                          28000013
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  29000013
         SPACE 4                                                        30000013
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         31000013
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     32000013
*        AT OPEN TIME.                                                  33000013
         EJECT                                                          34000013
A        DC    X'FF'                                                    35000013
         DC    AL1(RI-A)                READ INITIAL                    36000013
         DC    AL1(WI-A)                WRITE INITIAL                   37000013
         DC    AL1(RC-A)                READ CONTINUE                   38000013
         DC    AL1(WC-A)                WRITE CONTINUE                  39000013
         DC    X'FF'                                                    40000013
         DC    X'FF'                                                    41000013
         DC    AL1(RR-A)                READ REPEAT                     42000013
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               43000013
         DC    AL1(RS-A)                READ SKIP                       44000013
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           45000013
         DC    X'FF'                                                    46000013
         DC    X'FF'                                                    47000013
         DC    X'FF'                                                    48000013
         DC    X'FF'                                                    49000013
         DC    9X'FF'                                              000B 49500014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 50000013
         DC    7X'FF'                                              000B 50500014
         SPACE 2                                                        51000013
*                   CHANNEL PROGRAMS                                    52000013
RI       DC    X'040006080B8103'        READ INITIAL                    53000013
WI       DC    X'0702070509100C0A8101'  WRITE INITIAL                   54000013
RC       DC    X'040F06080B8103'        READ CONTINUE                   55000013
WC       DC    X'020D0A8101'            WRITE CONTINUE                  56000013
RR       DC    X'040406080B8103'        READ REPEAT                     57000013
WA       DC    X'0103'                 WRITE ACKNOWLEDGE                58000013
RS       DC    X'010E8103'              READ SKIP                       59000013
WN       DC    X'0101'                  WRITE NEG-ACKNOWLEDGE           60000013
         SPACE 3                                                        61000013
*                   C C W 'S               I/O      F L A G S    LENGTH 62000013
*                                       OPERATION CD   CC   SLI    =    63000013
C        DC    X'010C008960020003'      WR CCC         X    X      3    64000013
         DC    X'010C008920210003'      WR CCC              X      3    65000013
         DC    X'010C008980020004'      WR CCCS   X                4    66000013
         DC    X'010C008D20210004'      WR YCCC             X      4    67000013
         DC    X'010C008860020004'      WR NCCC        X    X      4    68000013
         DC    X'010C009160040001'      WR 1           X    X      1    69000013
         DC    X'0924000060030000'      WR POLL        X    X     LIST  70000013
         DC    X'0114000080030001'      WR ADRS        X    X      1    71000013
         DC    X'02040000800A0002'      RD INDX   X                2    72000013
         DC    X'0208000040060001'      RD RESP        X           1    73000013
         DC    X'0208000100200001'      RD RESP             0      1    74000013
         DC    X'0204000220110402'      RD DATA             X      N-2  75000013
         DC    X'0104000060110400'      WR DATA        X    X      N    76000013
         DC    X'0104000060110400'      WR DATA        X    X      N    77000013
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    78000013
         DC    X'010C008D60020004'     WR YCCC        X    X       4    79000013
         DC    X'010C009280080001'     WR D       X                1    80000013
         SPACE 2                                                        81000013
         DC    X'40'                    CIRCLE N                        82000013
         DC    X'1F1F1F'                CIRCLE C'S                      83000013
         DC    X'37'                    CIRCLE S                        84000013
         DC    X'761F1F1F'              CIRCLE Y                        85000013
         DC    X'02'                    CIRCLE 1                        86000013
         DC    X'16'                   CIRCLE D                         87000013
         CNOP  0,8                                                      88000013
         END                                                            89000013
./  ADD  SSI=13160038,NAME=IGG019ML
         TITLE 'IGG019ML - AMER TEL AND TEL 83B3 DEVICE I/O MODULE'     00020000
IGG019ML CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    AL1(WB-A)                WRITE BREAK                     00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    X'FF'                                                    00740000
         DC    X'FF'                                                    00760000
         DC    X'FF'                                                    00780000
         DC    X'FF'                                                    00800000
         DC    X'FF'                                                    00820000
         DC    X'FF'                                                    00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    X'FF'                                                    00880000
         DC    X'FF'                                                    00900000
         DC    X'FF'                                                    00920000
         DC    X'FF'                                                    00940000
         DC    X'FF'                                                    00960000
         DC    9X'FF'                                              000B 00970014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
         SPACE                                                          01040000
WB       DC    X'0100'                  WRITE BREADK                    01060000
RI       DC    X'0401040608'            READ INITIAL                    01080000
WI       DC    X'0501050307098102'      WRITE INITIAL                   01100000
RS       DC    X'010A'                  READ SKIP                       01120000
         SPACE 3                                                        01140000
*                   C C W 'S               I/O      F L A G S    LENGTH 01160000
*                                       OPERATION CD   CC   SLI    =    01180000
C        DC    X'0D00000020230400'      WR BREAK            X      N    01200000
         DC    X'010C005880020003'      WR F H L X                 3    01220000
         DC    X'010C005820210009'      WR F H L            X      9    01240000
         DC    X'010C005A60040001'      WR LTRS        X    X      1    01260000
         DC    X'0114040060030002'      WR POLL        X    X      2    01280000
         DC    X'0114000080030002'      WR ADRS        X    X      2    01300000
         DC    X'0204000080050002'      RD RESP   X                2    01320000
         DC    X'0208000000060001'      RD RESP                    1    01340000
         DC    X'0204000220110402'      RD DATA             X      N-2  01360000
         DC    X'0104000020110400'      WR DATA             X      N    01380000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01400000
         SPACE 2                                                        01420000
         DC    X'1B051F1F1F1F1F1F1F'    FIGS H LETTERS (7)              01440000
         CNOP  0,8                                                      01460000
         END                                                            01480000
./  ADD  SSI=13160039,NAME=IGG019MN
         TITLE 'IGG019MN - WESTERN UNION 115A DEVICE I/O MODULE'        00020000
IGG019MN CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    AL1(WB-A)           00   WRITE BREAK                     00680000
         DC    AL1(RI-A)           01   READ INITIAL                    00700000
         DC    AL1(WI-A)           02   WRITE INITIAL                   00720000
         DC    X'FF'               03                                   00740000
         DC    X'FF'               04                                   00760000
         DC    X'FF'               05                                   00780000
         DC    X'FF'               06                                   00800000
         DC    X'FF'               07                                   00820000
         DC    X'FF'               08                                   00840000
         DC    X'FF'               09                                   00860000
         DC    AL1(RS-A)           0A   READ SKIP                       00880000
         DC    X'FF'               0B                                   00900000
         DC    X'FF'               0C                                   00920000
         DC    X'FF'               0D                                   00940000
         DC    X'FF'               0E                                   00960000
         DC    9X'FF'                                              000B 00970014
         DC    AL1(C-A)            0F   OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 3                                                        01000000
WB       DC    X'0100'                  WRITE BREAK                     01020000
RI       DC    X'0401030507'            READ INITIAL                    01040000
WI       DC    X'04010406088102'        WRITE INITIAL                   01060000
RS       DC    X'0109'                  READ SKIP                       01080000
         SPACE 2                                                        01100000
*                                         I/O       F L A G S    LENGTH 01120000
*                                       OPERATION CD   CC   SLI    =    01140000
C        DC    X'0D00000020230400'      WR BREAK            X      N    01160000
         DC    X'010C005080020003'      WR F H L  X                3    01180000
         DC    X'010C005020210009'      WR F H L            X      9    01200000
         DC    X'0114040060030002'      WR POLL        X    X      2    01220000
         DC    X'0114000060030002'      WR ADRS        X    X      2    01240000
         DC    X'0204000080050002'      RD RESP   X                2    01260000
         DC    X'0208000000060001'      RD RESP                    1    01280000
         DC    X'0204000220110402'      RD DATA             X      N-2  01300000
         DC    X'0104000020110400'      WR DATA             X      N    01320000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01340000
         SPACE 2                                                        01360000
         DC    X'1B051F1F1F1F1F1F1F'    FIGS H LTRS                     01380000
         CNOP  0,8                                                      01400000
         END                                                            01420000
./  ADD  SSI=20320420,NAME=IGG019MP
         TITLE 'IGG019MP AMER TEL AND TEL MODEL 33/35 DEVICE I/O MODUL' 00020000
IGG019MP CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    X'FF'                                                    00740000
         DC    X'FF'                                                    00760000
         DC    AL1(RC-A)                READ CONVERSATIONAL             00780000
         DC    AL1(WC-A)                WRITE CONVERSATIONAL            00800000
         DC    X'FF'                                                    00820000
         DC    X'FF'                                                    00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           00880000
         DC    X'FF'                                                    00900000
         DC    X'FF'                                                    00920000
         DC    X'FF'                                                    00940000
         DC    X'FF'                                                    00960000
         DC    9X'FF'                                              000B 00970014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
RI       DC    X'0503010A0607820004'    READ INITIAL                    01040000
WI       DC    X'0403020508820004'      WRITE INITIAL                   01060000
RC       DC    X'020607820004'          READ CONVERSATIONAL             01080000
WC       DC    X'0108820004'            WRITE CONVERSATIONAL            01100000
RS       DC    X'0109'                  READ SKIP                       01120000
WN       DC    X'020004'                WRITE NEG-ACKNOWLEDGE           01140000
         SPACE 3                                                        01160000
*                   C C W 'S               I/O      F L A G S    LENGTH 01180000
*                                       OPERATION CD   CC   SLI    =    01200000
C        DC    X'010C005860210001'      WR EOT         X    X      1    01220000
         DC    X'2700000020010001'      ENABLE              X      1    01240000
         DC    X'2910000160010000'      DIAL           X    X      N    01260000
         DC    X'2F20000060010001'      DISABLE        X    X      1    01280000
         DC    X'2F00000020210001'      DISABLE             X      1    01300000
         DC    X'0218000100070000'      RD I D                     N    01320000
         DC    X'0118000160030000'      WR I D         X    X      N    01340000
         DC    X'0204000020110400'      RD DATA             X      N    01360000
         DC    X'0104000020110400'      WR DATA             X      N    01380000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01400000
         DC    X'010C00598001000F'      WR PAD    X               15    01420000
         SPACE 2                                                        01440000
         DC    X'21'                    EOT                             01460000
         DC    15X'DF'                 15 PAD CHARACTERS                01480000
         CNOP  0,8                                                      01500000
         END                                                            01520000
./  ADD  SSI=60130370,NAME=IGG019MR
         TITLE  'IGG019MR - ON-LINE-TERMINAL-TEST CONTROL MODULE'       00100016
IGG019MR START                                                          00200016
*********************************************************************** 00300016
*                                                                     * 00400016
* STATUS -                                                            * 00500002
*                                                                     * 00600016
* FUNCTION -          TO SERVICE ON-LINE-TEST REQUESTS - CALL SVC 66, * 00700016
*                     TO SERVICE I/O INTERRUPTS WHILE IN TEST, FOR    * 00800016
*                     START-STOP, TO FREE PATTERN AREA IF CURRENTLY   * 00900016
*                     UTILIZED.                                       * 01000016
*                                                                     * 01100016
* ENTRY POINT -       ENTRY IS TO FIRST EXECUTABLE INSTRUCTION VIA    * 01200016
*                     THE ASYNCHRONOUS EXIT EFFECTOR SCHEDULED BY     * 01300016
*                     CHANNEL END.                                    * 01400016
*                                                                     * 01500016
* INPUT -             REGISTER 1 - ADDRESS OF IOB                     * 01600016
*                     IOBERINF - CONTAINS ADDRESS OF START OF RFT     * 01700016
*                        INSERTED BY CHANNEL END.                     * 01800016
*                                                                     * 01900016
* OUTPUT -            1. PRINTABLE MODULE NAME BUILT IN IOB           * 02000016
*                     2. ON-LINE-TEST MESSAGE ON CONSOLE AT           * 02100016
*                        COMPLETION OF TEST (FOR BI-SYNCH)            * 02200016
*                                                                     * 02300016
* EXTERNAL ROUTINES - 1. SVC 58 - RELEASE BUFFER ROUTINE.             * 02400016
*                     2. SVC 66 - ON-LINE-TERMINAL TEST               * 02500016
*                     3. SVC 0  - EXECUTE CHANNEL PROGRAM ROUTINE     * 02600016
*                     4. WTO    - WRITE TO OPERATOR ROUTINE           * 02700016
*                     5. SVC 2  - POST ROUTINE                        * 02800016
*                     6. IGG019MA - BTAM READ-WRITE ROUTINE           * 02900016
*                     7. FREEMAIN - TO FREE PATTERN AREA              * 03000016
*                                                                     * 03100016
* EXIT -              SVC 66 - TO BUILD ON-LINE-TEST CH. PROGRAM      * 03200016
*                     SVC 3  - RETURN TO SUPERVISOR                   * 03300016
*                                                                     * 03400016
* IN LINE ROUTINES -  1. SETUCB - SET UP UCB ADDRESSABILITY AND       * 03500016
*                        DETERMINE WHETHER START-STOP OR BI-SYNCH     * 03600016
*                        AND ISSUE SVC 66 IF BI-SYNCH.                * 03700016
*                                                                     * 03800016
*                     2. TSTSRT - DETERMINE TYPE OF CCW INTERRUPTED,  * 03900016
*                        ACCESS BRANCH TABLE TO APPROPRIATE ROUTINE.  * 04000016
*                                                                     * 04100016
*                     3. RRFTWRR - END TEST                           * 04200016
*                                                                     * 04300016
*                     4. SRFTNOP - RESTART ON NEXT CCW                * 04400016
*                                                                     * 04500016
*                     5. RRFTRDT - RESTART ON NEXT CCW                * 04600016
*                                                                     * 04700016
*                     6. SRFTEOT - RESTART ON NEXT CCW                * 04800016
*                                                                     * 04900016
*                     7. RRFTWRI - RESTART ON NEXT CCW                * 05000016
*                                                                     * 05100016
*                     8. SRFTPRE - RESTART SAME CCW (PREPARE)         * 05200016
*                                                                     * 05300016
*                     9. RRFTRDR - CHECKS FOR ERROR BIT ON IN         * 05400016
*                        IOBINCAM.  IF NOT, RESTARTS ON NEXT CCW.     * 05500016
*                        IF SO, TURNS OFF ERROR BIT AND ENDS TEST.    * 05600016
*                                                                     * 05700016
*                     10. SRFTRDI - RESTART ON NEXT CCW               * 05800016
*                                                                     * 05900016
*                     11. TESTMSG - ENTERED ON TEXT OR RESPONSE TO    * 06000016
*                         TEST CCW. CHECKS WHETHER SENDING OR         * 06100016
*                         RECEIVING MSGS. IF SENDING, GOES TO         * 06200016
*                         SNDTST. CHECKS FOR EOT RECEIVED, IF SO      * 06300016
*                         BRANCH TO CHKDIS. SETS UP TO RESTART.       * 06400016
*                         CHECKS ERRORS - IF ANY GO TO RCVERR.        * 06500016
*                                                                     * 06600016
*                     12. CHKDIS - SETS UP DISABLE COMMAND FOR        * 06700016
*                         DIAL LINE, OR PUTS UP READ INITIAL FOR      * 06800016
*                         NON-DIAL.                                   * 06900016
*                                                                     * 07000016
*                     12. RCVERR - CHECKS FOR TYPE OF ERROR           * 07100016
*                         ENCOUNTERED AND UPDATES COUNTER.            * 07200016
*                                                                     * 07300016
*                     13. SNDTST - CHECKS FOR WACK,NAK,OR TIME OUT AND* 07400020
*                                  UPDATES COUNTERS.  CONTINUES TEST  * 07500016
*                                                                     * 07600016
*                     14. CHKCNT - DECREMENTS Y COUNT AND RESTARTS    * 07700016
*                         CHANNEL PROGRAM YY NOT EQUAL TO ZERO. IF    * 07800016
*                         YY = 0, GOES TO MSG WRITER ROUTINE.         * 07900016
*                                                                     * 08000016
*                     15. FINISH - BUILDS AND PUTS OUT ON-LINE-TEST   * 08100016
*                         CONSOLE MESSAGES. DETERMINE WHETHER TO      * 08200016
*                         RESTART READ OR ISSUE WRITE EOT AND         * 08300016
*                         BUILDS CHANNEL PROGRAM. GOES TO EXCP.       * 08400016
*                                                                     * 08500016
*                     16. LAST - CHECKS FOR ERRORS AND POSTS ON-LINE- * 08600016
*                         TEST ECB ACCORDINGLY.                       * 08700016
*                     17. STRTSTOP - SETS UP PARAMETERS AND ISSUES    * 08800016
*                         SVC 66. (START-STOP)                        * 08900016
*                     18. FREEAREA - FREES PATTERN AREA IF CURRENTLY  * 09000016
*                         UTILIZED. (START-STOP)                      * 09100016
*                                                                     * 09150000
*********************************************************************** 09200000
*                                                                     * 09208000
*  .... ...1  RFT ERROR BIT. EITHER- 1) AN INVALID REQUEST WAS RECEIVED 09216000
*             ON READ CONTINUE OPERATION AND BTAM COULD NOT SUCCESS-  * 09224000
*             FULLY RESET THE LINE PRIOR TO POSTING. OR 2) ON A 3275  * 09232000
*             DIAL DEVICE, THE RFT MESSAGE WAS TRANSMITTED THE        * 09240000
*             SPECIFIED NUMBER OF TIMES, FOLLOWED BY A WRITE RESET.   * 09248000
*             THE RESPONSE TO THE WRITE RESET INDICATES AN ERROR      * 09256000
*             CONDITION. REF APAR OZ06398                             * 09264000
*                                                                     * 09272000
*********************************************************************** 09280000
*                                                                     * 09288000
* ATTRIBUTES -        THIS ROUTINE IS RE-ENTRANT.                     * 09300016
*                                                                     * 09400016
* CHANGE ACTIVITY                                                     * 09450002
*            APARS                          PTMS                      * 09451000
*        YA01017  (10/19/73)            YM4056  (10/3/73)             * 09452000
*        ZA02329  (11/20/74)            YM4090  (11/2/73)             * 09453000
*        ZA02330  (11/20/74)                                          * 09454000
*        ZA02331  (11/20/74)                                          * 09455000
*        ZA02332  (11/20/74)                                          * 09456000
*        AZ03988  (04/29/75)                                          * 09457000
*        AZ04672  (09/24/75)                                          * 09460000
*        AZ06398  (11/05/75)                                          * 09466000
*        AZ06406  (11/04/75)                                          * 09472000
*                                                                     * 09480002
*********************************************************************** 09500016
         EJECT                                                          09600016
PARMREG  EQU   0                   PARAMETER REGISTER       LD @ZA02332 09650003
PARAMREG EQU   1             ADDRESS OF TERMINAL TEST PARAMETER LIST    09700016
DEBREG   EQU   2                       DEB ADDRESS REGISTER             09800016
CTRREG   EQU   2             COUNT REGISTER                             09900016
DECBREG  EQU   3             POINTER TO DECB                            10000016
BASEREG  EQU   4             MODULE BASE REGISTER                       10100016
IOBREG   EQU   5             POINTER TO IOB                             10200016
DCBREG   EQU   6             POINTER TO DCB                             10300016
CCWREG   EQU   7                                                        10400016
WREG     EQU   8                                                        10500016
ICREG    EQU   8                                                        10600016
AREAREG  EQU   9             POINTER TO PATTERN AREA USED               10700016
IOREG    EQU   9             POINTER TO IO AREA OR BUFFER DATA AREA     10800016
W1REG    EQU   10                                                       10900016
UCBREG   EQU   11                                                       11000016
W3REG    EQU   12                  WORK REGISTER            LD @ZA02330 11050003
SAVEREG  EQU   13                                                       11100016
RETREG   EQU   14            RETURN REGISTER                            11200016
W2REG    EQU   14                                                A28913 11250019
LINKREG  EQU   15            REGISTER LINKAGE TO BTAM READ-WRITE RTN.   11300016
*                                                                       11400016
         EJECT                                                          11500016
TIMEOUT EQU   X'01'                                                     11600016
LOSTDATA EQU   X'02'                                                    11700016
DATACHK  EQU   X'08'                                                    11800016
DCBBTAM  EQU   X'10'         BTAM DCB FLAG                              11900016
DCBTERMT EQU   X'10'         TERMINAL TEST SPECIFIED IN DCB ERROPT      12000016
DECTTOPR EQU   X'01'         TERMINAL TEST OPERATING FLAG               12100016
HALFBYTE EQU   X'F0'         MAXIMUM HEX VALUE IN 1/2 BYTE              12200016
TIC      EQU   X'08'                                                    12300016
MAXBITS  EQU   X'FF'         MAXIMUM HEX VALUE IN ONE BYTE              12400016
RDINIT   EQU   X'01'                    READ INITIAL OP CODE            12500016
WRD      EQU   X'10'                    WRITE DISCONNECT OP CODE   000D 12600016
READ     EQU   X'02'                                                    12700016
WRR      EQU   X'0A'                    WRITE RESET OP COCE        000D 12800016
ERP      EQU   X'24'                    ERP IN CTRL FLAGS          000D 12900016
MASKALL  EQU   X'FF'                                                    13000016
DCBDYBFR EQU   X'08'         DYNAMIC BUFFERING FLAG IN DCB              13100016
IOBEX    EQU   X'04'                    IOB EXCEPTION FLAG         000D 13200016
LEADCCW  EQU   X'40'                                               000D 13300016
RCVTST    EQU    X'C0'                                                  13400018
UNITEX   EQU   X'01'                                                    13500016
NOP      EQU   X'03'                                                    13600016
NORM   EQU   X'7F'                                                 000D 13700016
WRITE    EQU   X'01'         WRITE COMMAND CODE                         13800016
SHTWRT   EQU   X'40'                                               000D 13900016
REENTRY  EQU   X'40'                    REENTRY BIT IN DECONLTT    000K 13920018
POSITIVE EQU   X'76'                    POSITIVE RESPONSE TO EOB   000K 13940018
NOENTRY  EQU   X'BF'                    TURNS OFF REENTRY (2760)   000K 13960018
BUFREG   EQU   11                                                A32477 13962020
ECBREG   EQU   10                                                A32477 13964020
BAS1REG  EQU   12                                                A32477 13966020
ZEROREG  EQU   0                                                 A32477 13968020
SIXT     EQU   X'10'                                             A32477 13970020
ZONE     EQU   X'F0'                                             A28613 13980019
NEXTCCW  EQU   8                        DISP OF NEXT CCW IN IOBCPA      13986002
EOTLNGTH EQU   1                        LENGTH OF EOT CHARACTER         13992002
ASCII    EQU   X'14'               DCBXCODE ASCII MASK      LD @ZA02330 13994003
         EJECT                                                          14000016
         BALR  BASEREG,0                                                14100016
         SPACE                                                          14200016
         USING *,BASEREG                                                14300016
         USING IECTDECB,DECBREG                                         14400016
         USING IHADCB,DCBREG                                            14500016
         USING IECTDEB+36,DEBREG                                        14600016
         USING UCBSTART,UCBREG                                          14700016
         USING IECTIOB,IOBREG                                           14800016
         B     AROUND                   BRANCH AROUND MODULE ID  YM4056 14850002
         DC    C'IGG019MR'              MODULE ID                YM4056 14860002
         DC    C', 4324'                                    LD @ZA02330 14870003
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY       LD @ZA02330 14872003
         DS    0F                                                YM4056 14880002
         DC    XL180'00'                PATCH AREA               YM4056 14890002
AROUND   EQU   *                                                 YM4056 14892002
         SPACE 2                                                        14900016
         LA    SAVEREG,SAVE                                             15000016
         LR    IOBREG,PARAMREG                                          15100016
         L     DCBREG,IOBDCBPT                                          15200016
         L     DECBREG,IOBECBPT                                         15300016
         L     AREAREG,IOBERINF                                         15400016
         L     DEBREG,DCBDEBAD                                          15500016
         SPACE 2                                                        15600016
         SPACE                                                          15700016
         L     CCWREG,IOBCSW            LOAD CSW ADDRESS           000D 15800016
         SH    CCWREG,K8                BACK UP TO INT CCW         000D 15900016
         TM    DCBBFTEK,DYNBF           TEST FOR DYNAMIC BUFFER    000D 16000016
         BZ    SETUCB                   IF NOT, BRANCH             000D 16100016
         CLI   0(CCWREG),X'02'         INTERRUPT ON READ         A43796 16120002
         BNE   SETUCB                  NO,BRANCH                 A43796 16140002
         TM    5(CCWREG),X'11'         TEXT CCW                  A43796 16160002
         BNO   SETUCB                  NO, BRANCH                A43796 16180002
         CLI   8(CCWREG),TIC            WAS PCI HANDLED            000D 16200016
         BNE   SETUCB                   IF NOT COMMAND IS STILL R-S000D 16300016
         L     WREG,8(CCWREG)           LOAD TIC COMMAND WORD      000D 16400016
         L     WREG,0(WREG)             LOAD NEXT BFR ADDRESS           16500016
         LA    0,0(WREG)                LOAD INTO REG 0                 16600016
         LTR   0,0                      TEST FOR BFR ADDRESS       000D 16700016
         BZ    SETUCB                   IF NOT PRESENT, BRANCH     000D 16800016
         SH    0,K4                                                     16900016
         BZ    SETUCB                                                   17000016
         LR    PARAMREG,DCBREG          LOAD DCB ADDRESS           000D 17100016
         SVC   58                       RELEASE SECOND BUFFER      000D 17200016
SETUCB   SR    UCBREG,UCBREG            CLEAR REG FOR UCB BASE          17300016
         IC    UCBREG,IOBUCBX           FIND UCB INDEX                  17400016
         SLL   UCBREG,2                   X 4                           17500016
         L     UCBREG,DEBUCBAD(UCBREG)  LOAD ADDRESS FROM LIST          17600016
RCREG    EQU   15                  RETURN CODE REG                      17650002
         SPACE 2                                                        17700016
*                             MOVE SVC NAME INTO IOB (USED BY SVC 66)   17800016
         MVC   IOBNAME(8),SVCNAME                                       17900016
         SPACE 2                                                        18000016
*                             TEST FOR BSC                              18100016
         TM    UCBDEVTP+3,X'90'                                         18200016
         BNO   STRTSTOP                                                 18300016
         TM    UCBDEVTP+3,HALFBYTE-X'90'                                18400016
         BO    STRTSTOP                                                 18500016
         CLI   IOBCPA+L5,INVWREOT     WRITE EOT TP OP          @ZA06398 18501000
*                                CODE FOR INVALID RD CONT ?    @ZA06398 18502000
         BNE   TSTENQ                  NO CONTINUE             @ZA06398 18503000
         TM    IOBFLAG1,IOBEX           ANY ERRORS ?           @ZA06398 18504000
         BO    TRYRDENQ           YES SET UP RECOVERY          @ZA06398 18505000
         B     TESTMSG             PUT EOT IN BUFFER & POST    @ZA06398 18506000
TSTENQ   CLI   IOBCPA+L5,INVRDENQ  RD ENQ FOR INVALID RD TT ?  @ZA06398 18507000
         BE    CHKENQ             YES CHECK RESPONSE           @ZA06398 18508000
         TM    IOBINCAM,MASKALL-RFTBIT  IS THIS A 3270 DVC?      S99245 18510002
         BNO   TSTOLT                   NO,BRANCH                S99245 18520002
         TM    UCBDEVTP+1,DIAL          DIAL?                    S99245 18530002
         BNO   TSTOLT                   NO,BRANCH                S99245 18540002
         CLI   IOBCPA+45,WRTEOT         WRITE RESET TP OP CODE   S99245 18550002
         BE    HANDLETR                 YES,HANDLE               S99245 18560002
TSTOLT   EQU   *                                                 S99245 18570002
         EJECT                                                          18600016
         TM    5(CCWREG),X'3F'          TEST FOR ONLT CCW          000D 18700016
         BZ    TSTSTRT                  IF ZERO, THIS IS ONLT CCW  000D 18800016
         TM    IOBINCAM,MASKALL-RFTBIT  IS IT A 2370        LD @ZA02330 18850003
         BZ    NO3270              NO,BRANCH                LD @ZA02330 18860003
         TM    UCBDEVTP+DISP1,DIAL  3270 DIAL ?             LD @ZA02330 18870003
         BO    NO3270              YES, BRANCH              LD @ZA02330 18880003
         SR    W1REG,W1REG         CLEAR REG                LD @ZA02330 18890003
         LA    ICREG,DISP4         PUT ADDR.CNT IN ICREG    LD @ZA02330 18892003
         LA    W3REG,DISP7(AREAREG)  GET ADDR. OF ADDRESS   LD @ZA02330 18894003
         TM    DCBXCODE,ASCII      IS IT ASCII ?            LD @ZA02330 18896003
         BO    ASCI                YES,BRANCH               LD @ZA02330 18898003
         CLI   DISP6(AREAREG),XF4  IS NO. OF CHAR VALID     LD @ZA02330 18898403
         BNE   END                 NO, INVALID TEST REQ.    LD @ZA02330 18898803
LOOP     EQU   *                                            LD @ZA02330 18899203
         LA    W2REG,XLTTABLE      GET ADDR OF XLATE TABLR  LD @ZA02330 18899603
         TM    DISP0(W3REG),ZONE   IT IS NUMERIC            LD @ZA02330 18899703
         BNO   ALPHA               NO, BRANCH               LD @ZA02330 18899803
         NI    DISP0(W3REG),ZONEOFF STRIP OFF ZONE          LD @ZA02330 18949803
         B     ENDNUM              BRANCH                   LD @ZA02330 18959803
ALPHA    EQU   *                                            LD @ZA02330 18961803
         OI    DISP0(W3REG),X40    CONVERT LOWER TO UPPER   LD @ZA02330 18963803
         CLI   DISP0(W3REG),XC6    IS CHAR. TOO LARGE       LD @ZA02330 18965803
         BH    END                 YES INVALID DEV. ADDR.   LD @ZA02330 18966203
         NI    DISP0(W3REG),ZONEOFF AND OFF ZONE            LD @ZA02330 18976203
         IC    W1REG,DISP0(W3REG) GET INDEX TO XLATE TABLE  LD @ZA02330 18986203
         AR    W2REG,W1REG         ADD INDES TO BASE        LD @ZA02330 18988203
         MVC   DISP0(L1,W3REG),DISP0(W2REG)  MOVE CHAR...   LD @ZA02330 18988603
*                                  ...INTO AREA             LD @ZA02330 18988703
ENDNUM   EQU   *                                            LD @ZA02330 18988803
         LA W3REG,DISP1(W3REG)  BUMP TO NEXT CHAR.          LD @ZA02330 18992503
         BCT   ICREG,LOOP          LOOP UNTIL FINISH        LD @ZA02330 18994503
         B     BUILDADR            FINISH BUILDING ADDR.    LD @ZA02330 18994903
ASCI     EQU   *                                            LD @ZA02330 18995303
         CLI   DISP6(AREAREG),X34  IS NO. CHAR. VALID ?     LD @ZA02330 18995703
         BNE   END                 NO, INVALID REQ.         LD @ZA02330 18996103
LOOPASCI EQU   *                                            LD @ZA02330 18996203
         LA    W2REG,XLTTABLE      GET ADDR OF XLATE TABLE  LD @ZA02330 19022103
         TM    DISP0(W3REG),ASCZONE  IS CHAR. NUMERIC       LD @ZA02330 19032103
         BNO   ALPHAASC            NO, GO TO ALPHAASC       LD @ZA02330 19044103
         TM    DISP0(W3REG),ALFAZONE IT IS LOWER CASE       LD @ZA02330 19046103
         BO    END                 YES,INVALID DEV. ADDR.   LD @ZA02330 19048103
         NI    DISP0(W3REG),ZONEOFF  STIP OFF ZONE          LD @ZA02330 19056703
         B     ENDNUMAS            GO LOOP BACK AROUND      LD @ZA02330 19058703
ALPHAASC EQU   *                                            LD @ZA02330 19060703
         OI    DISP0(W3REG),X20    CONVERT UPPER TO LOWER   LD @ZA02330 19062703
         CLI   DISP0(W3REG),X66    IS THE CHAR. TOO LARGE   LD @ZA02330 19064703
         BH    END                 YES, INVALID ADDR.       LD @ZA02330 19065103
         NI    DISP0(W3REG),ZONEOFF  AND OFF ZONE           LD @ZA02330 19065203
         IC    W1REG,DISP0(W3REG)  GET INDEX TO XLATE TABLE LD @ZA02330 19065303
         AR    W2REG,W1REG         ADD INDEX TO THE BASE    LD @ZA02330 19065403
         MVC   DISP0(L1,W3REG),DISP0(W2REG)  MOVE CHAR...   LD @ZA02330 19075503
*                                  ...INTO AREA             LD @ZA02330 19078003
ENDNUMAS EQU   *                                            LD @ZA02330 19080003
         LA    W3REG,L1(W3REG)     BUMP TO NEXT CHAR.       LD @ZA02330 19082003
         BCT   ICREG,LOOPASCI      LOOP UNTIL FINISH        LD @ZA02330 19082403
BUILDADR EQU   *                                            LD @ZA02330 19082503
         LA    W2REG,DISP7(AREAREG)  POINT TO ADDR CHAR.    LD @ZA02330 19082603
         LA    W1REG,L2            PUT LOOP CNT IN REG      LD @ZA02330 19082703
LOOP1    EQU   *                                            LD @ZA02330 19106103
         IC    ICREG,DISP0(W2REG)  GET FIRST CHAR. ADDR     LD @ZA02330 19116103
         SLL   ICREG,L4            SHIFT IT 4 BITS          LD @ZA02330 19126103
         STC   ICREG,DISP0(W2REG)  STORE IT BACK            LD @ZA02330 19128103
         OC    DISP0(L1,W2REG),DISP1(W2REG) OR THEM         LD @ZA02330 19128503
         MVC   DISP1(L1,W2REG),DISP0(W2REG) MOVE INTO 2ND B LD @ZA02330 19128903
         LA    W2REG,DISP2(W2REG)  BUMP TO DEV ADDR.        LD @ZA02330 19129703
         BCT   W1REG,LOOP1         LOOP UNTIL FINISH        LD @ZA02330 19137503
NO3270   EQU   *                                            LD @ZA02330 19139503
         SVC   66                                                  000D 19145402
         B     EXIT                                                000D 19153202
TSTSTRT  CLI   0(CCWREG),NOP           WAS LAST CCW A NO-OP        000D 19176600
         BE    TESTRDTT           GO SEE IF INVALID RD TT      @ZA06398 19236600
         TM    5(CCWREG),LEADCCW       TEST FOR SETUP CCW          000D 19300016
         BZ    TESTMSG                  IF ZERO, THIS IS NOT SETUP      19400016
         LA    WREG,IOBCPA                                         000D 19500016
         LR    W1REG,CCWREG                                        000D 19600016
         SR    W1REG,WREG                                          000D 19700016
         TM    DECDCBAD,RCVTST         CHK FOR SENDING/RECEIVING        19800018
         BM    BR                       IF SENDING, BRANCH         000D 19900016
         AH    W1REG,K4                ADD 4                       000D 20000016
BR       B     BRTBL(W1REG)             BRANCH TO A CCW ROUTINE    000D 20100016
BRTBL    B     RRFTWRR                  RCV RFT - WR RESPONSE      000D 20200016
         B     SRFTEOT                  SNT RFT - WR EOT         A27602 20300019
         B     RRFTRDT                  RCV RFT - RD TEXT (EOT)    000D 20400016
         B     SRFTPRE                  SNT RFT - PREPARE        A27602 20500019
         B     RRFTEOT                  RCV RFT - WR EOT /R NOP  A27602 20600019
         B     SRFTNOP                  SNT RFT - NO OPERATION   A27602 20700019
         B     RRFTWRI                  RCV RFT - WR INQUIRY     A27602 20800019
         B     SRFTRDI                  SNT RFT   RD INQUIRY       000D 20900016
         B     RRFTRDR                  RCV RFT - RD RESPONSE    A27602 20950019
TESTMSG  TM    DECDCBAD,RCVTST         CHK FOR SENDING/RECEIVING        21000018
         BM    SNDTST                   IF SENDING, BRANCH         000D 21100016
         L     AREAREG,IOBCPA+40       GET ADDR OF READ IN AREA    000D 21200016
         CLC   0(1,AREAREG),DCBBSEOT    CHECK FOR EOT RECEIVED     000D 21300016
         BE    CHKDIS                  IF SO, SET UP TO END TEST   000D 21400016
         CLC   0(2,AREAREG),DCBBSDLE    CHECK FOR DLE-EOT RECEIVED 000D 21500016
         BE    CHKDIS                  IF SO, SET UP TO END TEST   000D 21600016
         LA    ICREG,DCBBSAK0          GET ACK-0 ADDR FOR SENDING  000D 21700016
         ST    ICREG,IOBCPA+32         STORE IN CCW                000D 21800016
         MVI   IOBCPA+32,X'01'         RESTORE COMMAND CODE        000D 21900016
         TM    IOBFLAG1,IOBEX           WAS THERE AN ERROR         000D 22000016
         BO    RCVERR                   IF SO, GO TO ERROR ROUTINE 000D 22100016
         SH    CCWREG,K8               BACK UP TO WRITE RESP CCW   000D 22200016
         B     CHKCNT                                              000D 22300016
CHKDIS   NI    IOBCSW+4,MASKALL-UNITEXCP SET OFF UNIT EXCEPTION    000D 22400016
         CLC    IOBPARM(4),DATA        X, Y EQUAL ZERO             000D 22500016
         BNE   YCOUNT                                              000D 22600016
ZEROWORK EQU   *                                                   000D 22700016
         MVI   IOBWORK,X'00'           SET Y COUNT TO ZERO         000D 22800016
         B     FINISH2                                                  22900016
YCOUNT    EQU   *                                                  000D 23000016
         CLI   IOBWORK,ZEROY           HAS Y VALUE BEEN DECREMENTD 000D 23100016
         BNE   ZEROWORK                                            000D 23200016
DISABLE  EQU   *                                                   000D 23300016
         TM    UCBDEVTP+1,X'90'        IS THIS A DIAL LINE         000D 23400016
         BZ    END                     NO, PUT READ INITIAL UP     000D 23500016
         LA    CCWREG,IOBCPA+32        GET CHANNEL PROGRAM ADDRESS 000D 23600016
         MVC   0(16,CCWREG),DIALRST+8   MOVE IN DISABLE COMMAND    000D 23700016
         B     RESTART                 GO ISSUE COMMAND            000D 23800016
RCVERR   NI    IOBFLAG1,MASKALL-IOBEX   TURN OFF IOB EXCEPTION     000D 23900016
         TM    IOBWORK,MASKALL         IS Y COUNT ZERO             000D 24000016
         BZ     DISABLE                YES, ERRO ON READ EOT       000D 24100016
         TM    IOBCSW+4,UNITEX          CHECK FOR EOT RECEIVED     000D 24200016
         BO    FINISH                                              000D 24300016
         TM    IOBSENS0,TIMEOUT         CEHCK FOR TIME OUT         000D 24400016
         BZ    CHKLD                    IF NOT, BRANCH             000D 24500016
         IC    ICREG,IOBWORK+2          ADD 1 TO COUNT             000D 24600016
         LA    ICREG,1(ICREG)                                      000D 24700016
         STC   ICREG,IOBWORK+2                                     000D 24800016
CHKLD    TM    IOBSENS0,LOSTDATA        CHECK FOR LOST DATA        000D 24900016
         BZ    CHKDC                    IF NOT, BRANCH             000D 25000016
         IC    ICREG,IOBWORK+3          ADD 1 TO COUNT             000D 25100016
         LA    ICREG,1(ICREG)                                      000D 25200016
         STC   ICREG,IOBWORK+3                                     000D 25300016
CHKDC    TM    IOBSENS0,DATACHK         CHECK FOR DATA CHECK       000D 25400016
         BZ    CHKCNT                  IF NOT, BRANCH              000D 25500016
         IC    ICREG,IOBWORK+4          ADD 1 TO COUNT             000D 25600016
         LA    ICREG,1(ICREG)                                      000D 25700016
         STC   ICREG,IOBWORK+4                                     000D 25800016
         LA    ICREG,DCBBSNAK          GET NAK ADDR TO SEND        000D 25900016
         ST    ICREG,IOBCPA+32         STORE IN CCW                000D 26000016
         MVI   IOBCPA+32,X'01'         RESTORE COMMAND CODE        000D 26100016
         B     CHKCNT                                              000D 26200016
SNDTST   TM    IOBFLAG1,IOBEX           CHECK FOR AN ERROR         000D 26300016
         BO    SNDERR                   IF SO, GO TO ERROR ROUTINE 000D 26400016
         CLC   DECRESPN(2),DCBBSSAK     WAS WACK RECEIVED          000L 26404019
         BNE   CHKACK                                              000L 26408019
** THE LINE BELOW SHOULD HAVE BEEN DELETED BY AZ02329 **       @ZA03988 26409000
*******  IC    ICREG,IOBDCBPT           ADD ONE TO COUNT        YA01266 26410000
*                                                                       26422002
*              6 LINES DELETED FOR ----->                   LD @ZA02329 26432003
*                                                                       26434002
         TM    DECFLAGS,WACK       WAS WACK REC'D BEFOR ?   LD @ZA02329 26436003
         BNO   UPDAT1              NO, INITIALIZE CNT.      LD @ZA02329 26438003
         CLI   IOBERINF,TWENTY5    HAVE 25 WACKS BEEN REC'D LD @ZA02329 26438403
         BE    END                 YES, GET OUT             LD @ZA02329 26438803
         IC    ICREG,IOBERINF      ADD ONE TO COUNT...      LD @ZA02329 26439203
         LA    ICREG,DISP1(ICREG)  ...OF WACKS REC'D        LD @ZA02329 26439603
         STC   ICREG,IOBERINF      STORE COUNT              LD @ZA02329 26439703
         CLI   IOBERINF,TWENTY5    25 WACKS REC'D           LD @ZA02329 26439803
         BE    ZEROWORK            YES, BRANCH              LD @ZA02329 26439903
         B     FIRSTIME                                     LD @ZA02329 26443103
UPDAT1   EQU   *                                            LD @ZA02329 26445103
         LA    ICREG,L1            INIT. CNT OF WAKS TO 1   LD @ZA02329 26447103
         STC   ICREG,IOBERINF      STORE COUNT              LD @ZA02329 26447403
FIRSTIME EQU   *                                                   000L 26448002
         OI    DECFLAGS,WACK            INDICATE WACK              000L 26450419
         LA    WREG,DCBBSENQ            LOAD ADDR OF ENQ           000L 26453619
         MVC   IOBCPA(TWOCCWS),WENQ     MOVE CCWS TO IOB        YA01276 26456802
         ST    WREG,IOBCPA              STORE ADR IN CCW        YA01276 26460002
         MVI   IOBCPA,WRITECMD          MOVE COMMAND IN CCW     YA01276 26463202
         LA    WREG,0(CCWREG)           LOAD ADDRESS OF CURRENT CCW000L 26466419
         ST    WREG,IOBCPA+ONECCW       STORE ADR IN CCW        YA01276 26469602
         MVI   IOBCPA+ONECCW,TICCMD     MOVE IN COMMAND         YA01276 26472802
         LA    CCWREG,IOBCPA                                       000L 26476019
         B     RESTART                                             000L 26480019
CHKACK   EQU   *                                                   000L 26484019
         NI    DECFLAGS,NOWACK          INDICATE NO WACK           000L 26488019
         MVI   IOBERINF,X00             ZERO OUT WACK COUNT LD @ZA02329 26492003
         CLC   DECRESPN(2),DCBBSAK0     CHECK FOR ACK-0            000D 26500016
         BE    CHKCNT                   IF O.K., CONTINUE TEST     000D 26600016
         CLC   DECRESPN(1),DCBBSNAK     WAS THE RESPONSE NAK       000D 26700016
         BNE   CHKCNT                   IF NOT, GO TO ERROR ROUTINE000D 26800016
         IC    ICREG,IOBWORK+1          ADD 1 TO COUNT OF NAK'S    000D 26900016
         LA    ICREG,1(ICREG)                RECEIVED              000D 27000016
         STC   ICREG,IOBWORK+1                                     000D 27100016
         B     CHKCNT                   CONTINUE THE TEST          000D 27200016
SNDERR   EQU   *                                                   000L 27240019
         NI    DECFLAGS,NOWACK          INDICATE NO WACK           000L 27280019
         MVI   IOBERINF,X00             ZERO OUT WACK COUNT LD @ZA02329 27320003
         TM    IOBSENS0,TIMEOUT         CHK FOR TIME OUT           000L 27360019
         BZ    CHKUE                    IF NOT, BRANCH             000D 27400016
         IC    ICREG,IOBWORK+2          ADD TO 1 COUNT OF TIMEOUTS 000D 27500016
         LA    ICREG,1(ICREG)                                      000D 27600016
         STC   ICREG,IOBWORK+2                                     000D 27700016
         B     CHKCNT                                              000D 27800016
CHKUE    TM    IOBCSW+4,UNITEX          CHK FOR UNIT EXCEPTION     000D 27900016
         BZ    CHKCNT                   IF NOT, BRANCH             000D 28000016
         CLI   0(CCWREG),WRITE          IS THIS A WRITE COMMAND    000D 28100016
         BNE   FINISH                   IF NOT, EOT RECEIVED       000D 28200016
         LA    CCWREG,NEXTCCW(CCWREG) IF SO, RESTART ON NEXT CCW   000D 28300002
         B     RESTART                                             000D 28400016
TESTRDTT CLI DECTYPE+L1,RDCONT         READ TT ?               @ZA06398 28405000
         BNE   END                     NO END TEST             @ZA06398 28410000
         TM    IOBINCAM,X02             ERROR BIT ON ?         @ZA06398 28415000
         BZ    END                      NO, END TEST           @ZA06398 28420000
         MVI   IOBWORK,X00                CLEAR Y COUNT        @ZA06398 28425000
         NI    IOBINCAM,XFF-X02         CLEAR ERROR BIT        @ZA06398 28430000
         MVC   IOBCPA+L4(L4),PTPTRST+L4  MOVE IN CCW .....     @ZA06398 28435000
         LA    WREG,DCBBSEOT             .....TO WRITE EOT     @ZA06398 28440000
         O     WREG,PTPTRST              .....TO CLEAR LINE    @ZA06398 28445000
         ST    WREG,X00(CCWREG)                                @ZA06398 28450000
         MVI   TPOPCODE(CCWREG),X33      SET TP OP             @ZA06398 28455000
         MVC   IOBCPA+L12(L4),READENQ+L4    MOVE IN ......     @ZA06398 28460000
         LA    WREG,DECRESPN              .....READ ENQ CCW    @ZA06398 28465000
         O     WREG,READENQ               .....FOR RECOVERY    @ZA06398 28470000
         ST    WREG,IOBCPA+L8             .....IF NEEDED       @ZA06398 28475000
         B     RESTART                  GO START IT            @ZA06398 28480000
RRFTWRR  B     FINISH                   IF ENTERED, END TEST       000D 28500016
         SPACE 3                                                   000D 28600016
RRFTRDT  EQU   *                                                   000D 28700016
         LA    CCWREG,8(CCWREG)         STEP TO NEXT CCW           000D 28800016
         B     RESTART                  RESTART OPERATION          000D 28900016
         SPACE 3                                                   000D 29000016
RRFTWRI  EQU   RRFTRDT                                             000D 29100016
         SPACE 3                                                   000D 29200016
SRFTNOP  EQU   RRFTRDT                  RESTART ON NEXT CCW        000D 29300016
         SPACE 3                                                   000D 29400016
SRFTEOT  EQU   RRFTRDT                  RESTART ON NEXT CCW        000D 29500016
RRFTEOT  EQU   RRFTRDT                  RESTART ON NEXT CCW      A27602 29550019
         SPACE 3                                                   000D 29600016
RRFTRDR  EQU   *                                                   000D 29700016
         TM    IOBINCAM,X'02'          IS ERROR BIT SET            000D 29800016
         BZ    RRFTRDR1                                                 29900017
         MVI   IOBWORK,X'00'                                            30000016
         NI    IOBINCAM,X'FF'-X'02'      TURN OFF ERROR BIT        000D 30100016
         B     SKIPWTO                                           A28610 30200019
         SPACE   3                                                      30300016
RRFTRDR1  EQU  *                                                        30308017
         TM    IOBINCAM+1,X'F0'         FIRST TIME THROUGH         000L 30316019
         BZ    TESTTIME                                                 30324017
         B     RRFTRDT                                             000L 30326019
TESTTIME EQU   *                                                   000L 30328019
         CLC   DECRESPN(2),DCBBSAK0     WAS ACK0 RECEIVED          000L 30330019
         BNE   UPDATE                                              000L 30332019
         OI    IOBINCAM+1,X'F0'         INDICATE NOT FIRST TIME    000L 30334019
         B     RRFTRDT                                             000L 30336019
UPDATE   EQU   *                                                   000L 30338019
         TM    IOBINCAM+1,ERRMAXCT      RETRY COUNT = 7            000L 30340019
         BO    ZEROWORK                 IF SO, END TEST            000L 30342019
         SR    ICREG,ICREG              CLEAR REGISTER             000L 30344019
         IC    ICREG,IOBINCAM+1         GET RETRY COUNT            000L 30346019
         LA    ICREG,1(ICREG)           ADD ONE TO RETRY COUNT     000L 30348019
         STC   ICREG,IOBINCAM+1         STORE RETRY COUNT          000L 30350019
         SH    CCWREG,MAXLENGT                                          30364017
         B     RESTART                                                  30380017
         SPACE  2                                                       30388017
SRFTPRE  EQU   *                                                        30400016
         B     RESTART                  RESTART PREPARE            000D 30500016
         SPACE 3                                                   000D 30600016
SRFTRDI  EQU   RRFTRDT                  CHECK                      000D 30700016
CHKCNT   SR    ICREG,ICREG             ZERO OUT REGISTER           000D 30800016
         IC    ICREG,IOBWORK           LOAD TEST COUNT             000D 30900016
         BCT   ICREG,SNDMORE            DECREMENT & TEST           000D 31000016
         TM    DECDCBAD,RCVTST         SEND OR RECV               M4505 31100002
         BM    FINISH                  SEND, BRANCH               M4505 31110002
         TM    IOBCPA+36,X'40'         IS WR ACK CC               M4505 31120002
         BZ    FINISH                  NO, END TEST               M4505 31130002
         NI    IOBCPA+36,X'BF'         YES, SEND ANOTHER ACK      M4505 31140002
         B     READCONT                                           M4505 31150002
SNDMORE  STC   ICREG,IOBWORK            RESTORE COUNT              000D 31200016
         TM    IOBWORK,MASKALL                                          31300016
         BO    END                                                      31400016
LOADSTRT TM    DECDCBAD,RCVTST          SENDING OR RECEIVING     A27602 31430019
         BNM   READCONT                 BRANCH IF RECEIVING      A27602 31460019
         LA    CCWREG,IOBCPA+40         RESTART WRITE CONTINUE   A27602 31490019
         B     RESTART                                           A27602 31520019
READCONT LA    CCWREG,IOBCPA+32         RESTART READ CONTINUE    A27602 31550019
RESTART  ST    CCWREG,IOBSTART          STORE ADDRESS OF 1ST CCW   000D 31600016
EXCP   EQU   *                                                          31700016
         L     PARMREG,GETPARM     SUBPOOL AND LENGTH       LD @ZA02332 31750003
         GETMAIN R,LV=(0)          GETMAIN FOR DUMMY DECB   LD @ZA02332 31760003
         ST    DECBREG,DISP4(PARAMREG) SAVE ADDR OF DECB    LD @ZA02332 31770003
         MVI   DISP4(PARAMREG),FOXFOX  FLAG AS DUMMY        LD @ZA02332 31780003
         SR    W1REG,W1REG         CLEAR REG                LD @ZA02332 31790003
         ST    W1REG,DISP0(PARAMREG) CLEAR ECB AREA         LD @ZA02332 31792003
         STCM  PARAMREG,MASK,IOBECBPT+L1 POINT IOB TO DUMMY LD @ZA02332 31794003
         LR    W1REG,PARAMREG      SAVE ADDR OF DUMMY       LD @ZA02332 31796003
         LR    PARAMREG,IOBREG                                          31800016
*                                                                       31850002
*              1 LINE DELETE FOR ----->                     LD @ZA02332 31900003
*                                                                       31950002
         SVC   0                                                        32000016
*                                                                       32050002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 32060003
*                                                                       32070002
         STCM  DECBREG,MASK,IOBECBPT+L1 REPOINT IOB TO DECB LD @ZA02332 32100003
         L     PARMREG,GETPARM     SET FOR FREEMAIN         LD @ZA02332 32150003
         FREEMAIN R,LV=(0),A=(W1REG)  FREE THE DUMMY        LD @ZA02332 32160003
         SVC   3                                                   000D 32200016
FINISH   EQU   *                                                   000D 32300016
         STC   ICREG,IOBWORK            STORE COUNT RESULT         000D 32400016
FINISH2  MVC   MSG+12(3),13(UCBREG)     GET LINE ADDRESS           000H 32500018
         MVC   MSG+28(2),IOBPARM        CONVERT TEST TYPE          000H 32600018
         MVC   MSG+31(2),IOBPARM+2      GET TRANSMISSION COUNT     000H 32700018
         SR    WREG,WREG               ZERO OUT REGISTER           000D 32800016
         TM    DECDCBAD,RCVTST         CHK FOR SENDING/RECEIVING        32900018
         BM    MOVEIN                  IF SENDING,, BRANCH         000D 33000016
         XC    WORKAREA(8),WORKAREA     CLEAR AREA               000D   33100016
         PACK  WORKAREA+6(2),IOBPARM+2(2)  PACK ORIGINAL Y VALUE   000D 33200016
         CVB   W1REG,WORKAREA           CONVERT FOR NEXT INSTR     000D 33300016
         IC    WREG,IOBWORK            GET RESIDUAL TRANSMSN CONT  000D 33400016
         SR    W1REG,WREG              GET ACTUAL NO TRANSMSNS.    000D 33500016
         CVD   W1REG,WORKAREA          CONVERT COUNT TO DECIMAL    000D 33600016
         UNPK  MSG+31(2),WORKAREA+6(2)  UNPACK INTO MSG AREA       000H 33700018
         OI    MSG+32,X'F0'             ADJUST SIGN BITS           000H 33800018
MOVEIN    EQU   *                                                       33900016
         IC    WREG,IOBUCBX+3           GET NUMBER TIME OUTS            34000016
         CVD   WREG,WORKAREA            CONVERT TO DECIMAL              34100016
         UNPK  MSG+34(2),WORKAREA+6(2)  AND UNPACK                 000H 34200018
         OI    MSG+35,X'F0'             ADJUST SIGN BITS           000H 34300018
         TM    DECDCBAD,RCVTST         CHK FOR SENDING/RECEIVING        34400018
         BM    SENDER                    BRANCH                         34500016
RECVER   LA    WREG,X'F8'                                               34600016
         STC   WREG,MSG+9                                               34700016
         IC    WREG,IOBUCBX+4           GET LOST DATA COUNT             34800016
         CVD   WREG,WORKAREA            CONVERT TO DECIMAL              34900016
         UNPK  MSG+37(2),WORKAREA+6(2)  AND UNPACK                 000H 35000018
         OI    MSG+38,X'F0'             ADJUST SIGN BITS           000H 35100018
         IC    WREG,IOBUCBX+5           GET DATA CHECK COUNT            35200016
         CVD   WREG,WORKAREA            CONVERT TO DECIMAL              35300016
         UNPK  MSG+40(2),WORKAREA+6(2)  AND UNPACK                 000H 35400018
         OI    MSG+41,X'F0'             ADJUST SIGN BITS           000H 35500018
         LA    WREG,42                  INITIALIZE MESSAGE COUNT   000H 35600018
         B     COUNT                                                    35700016
SENDER   LA    WREG,X'F7'                                               35800016
         STC   WREG,MSG+9                                               35900016
         IC    WREG,IOBUCBX+2           GET NUMBER OF NAKS              36000016
         CVD   WREG,WORKAREA            CONVERT TO DECIMAL              36100016
         UNPK  MSG+37(2),WORKAREA+6(2)  AND UNPACK                 000H 36200018
         OI    MSG+38,X'F0'             ADJUST SIGN BITS           000H 36300018
         TM    UCBDEVTP+1,X'40'         IS THIS LINE MULTIPT            36400016
         BO    COMPX                   GO TEST X VALUE             000D 36500016
WTOPR    LA    WREG,39                  LOAD COUNT OF 39           000H 36600018
         B     COUNT                                               000D 36700016
COMPX    CLC   IOBPARM(2),DATA         IS X = ZERO                 000D 36800016
         BNE   ENTRYPT                 NO, TREAT AS USUAL MPT      000D 36900016
         SR    WREG,WREG               ZERO OUT REGISTER           000D 37000016
         L     W1REG,DECADRPT          GET TERMINAL LIST ADDR      000D 37100016
CHKAGIN  CLC   0(1,W1REG),DCBBSENQ     ARE WE AT END OF LIST     A28613 37200019
         BE    GETCHARS                YES, MOVE ADDR. CHARS IN    000D 37300016
         LA    WREG,1(WREG)            NO, INCREMENT COUNT BY ONE  000D 37400016
         LA    W1REG,1(W1REG)          INCREMENT ADDRESSS BY ONE   000D 37500016
         CH    WREG,MAXLENGT           IS ENTRY AT MAXIMUM LENGTH  000D 37600016
         BE    WTOPR                   YES, IGNORE TERM ID FIELD   000D 37700016
         B     CHKAGIN                 NO, RESUME SCAN FOR EOL     000D 37800016
         SPACE 2                                                   000D 37900016
GETCHARS SR    W1REG,WREG              MOVE BACK TO START OF ENTRY 000D 38000016
         B     EXPAND                  GO TO TRANS TO EBCDIC     A28613 38100019
         SPACE  2                                                  000D 38300016
ENTRYPT  LH    WREG,IOBCPA+30           GET WIDTH OF TERMINAL ID A27602 38400019
         BCTR  WREG,0                  GET RID OF ENQ COUNT        000D 38500016
         CH    WREG,MAXLENGT           IS TERM LIST TOO LONG     A28613 38550019
         BNL   WTOPR                   YES, IGNORE TERM ID       A28613 38600019
         LA    W1REG,IOBERINF+10       GET TERM LIST ADDRESS     A28613 38650019
EXPAND   LTR   WREG,WREG               IS COUNT ZERO OR NEG      A28613 38700019
         BNP   WTOPR                   YES, INVALID, IGNORE TID  A28613 38750019
         LA    W2REG,MSG+40            ADDR TERM ID FIELD IN MSG A28613 38800019
MOVE     MVC   1(1,W2REG),0(W1REG)     MOVE TWO 4 BIT DIGITS     A28613 38850019
         MVO   0(2,W2REG),0(2,W2REG)   EXPAND TO TWO BYTES       A28613 38900019
         OI    0(W2REG),ZONE           INSERT ZONES              A28613 38950019
         OI    1(W2REG),ZONE           INSERT ZONES              A28613 39000019
         TR    0(2,W2REG),TABLE        TRANS TO EBCDIC           A28613 39050019
         LA    W2REG,2(W2REG)          INCREMENT POINTERS        A28613 39100019
         LA    W1REG,1(W1REG)          INCREMENT POINTERS        A28613 39150019
         BCT   WREG,MOVE               LOOP IF MOVE INCOMPLETE   A28613 39200019
         LA    WREG,MSG                COMPUTE MSG COUNT         A28613 39250019
         SR    W2REG,WREG                                        A28613 39300019
         LR    WREG,W2REG                                        A28613 39350019
COUNT    STH   WREG,MSG                                                 39500016
         LR    W2REG,WREG          SAVE LENGTH              LD @ZA02332 39550003
         LA    WREG,MSG            GET BEGINNING OF MSG     LD @ZA02331 39560003
         AR    WREG,W2REG          COMPUTE MSG LENGTH       LD @ZA02331 39570003
         MVC   DISP0(L4,WREG),MSG+FIFTYSIX                     @ZA04672 39580000
*                        ADJUST DESCRIPTOR AND ROUTING CODES.  @ZA04672 39586000
PRINT    WTO   MF=(E,MSG)               WRITE MESSAGE                   39600016
SKIPWTO  CLC   IOBPARM(4),DATA         X, Y EQUAL 0              A28610 39700019
         BE    DISABLE                 BRANCH IF YES TO DISABLE  A27627 39800019
         CLI   IOBWORK,ZEROY           HAS Y VALUE BEEN DECREMENTD 000D 39900016
         BH    END                     NO, RESTART READ INITIAL    000D 40000016
         TM    DECDCBAD,RCVTST         CHK FOR SENDING/RECEIVING        40100018
         BM    SNTTST                    BRANCH IF SENDING TESTS   000D 40200016
         L     WREG,IOBCPA+40          GET AREA ADDRESS            000D 40300016
         MVC  0(1,WREG),DCBBSEOT       MOVE IN EOT CHARACTER       000D 40400016
         B     LOADSTRT                                            000D 40500016
SNTTST   LA    CCWREG,IOBCPA+40         LOAD START CCW ADDRESS   A27602 40600019
         TM    UCBDEVTP+1,X'90'        TEST FOR DIAL DEVICE        000D 40700016
         BZ    PTPT                     IF NOT, BRANCH             000D 40800016
         TM    IOBINCAM,MASKALL-RFTBIT  IS THIS A 3270 RFT ?     S99245 40805002
         BNO   NOT3270                  NO, BRANCH               S99245 40810002
         CLI   DECTYPE+1,RDCONT    WAS OPERATION A READ TT ?     S99245 40815002
         BNE   NOT3270             NO, BRANCH                    S99245 40820002
         MVC   CCWFLAGS(FIVEWORD,CCWREG),WRTRESET  MOVE IN WRT   S99245 40825002
*                                  RESET CHANNEL PGM             S99245 40830002
         LA    WREG,DCBBSEOT       LOAD ADDR OF EOT              S99245 40835002
         O     WREG,DIALRST             OR IN WRITE COMMAND      S99245 40840002
         ST    WREG,0(CCWREG)           STORE WRITE EOT IN CCW   S99245 40845002
         LA    WREG,DECRESPN            GET ADDR OF RESPONSE     S99245 40850002
         O     WREG,WRTRESET+RDCMD      OR IN READ COMMAND       S99245 40855002
         ST    WREG,RDEOTCCW(CCWREG)    STORE READ RESP          S99245 40860002
         MVI   IOBSNDPT,RESETACK        RESET ACK POINTERS       S99245 40865002
         MVI   IOBRCVPT,RESETACK                                 S99245 40870002
         XC    IOBINCAM+1(CNTLNG),IOBINCAM+1  CLEAR RETRY COUNT  S99245 40875002
         B     RESTART                  START CHAN PGM           S99245 40880002
NOT3270  EQU   *                                                 S99245 40885002
         MVC   4(20,CCWREG),DIALRST+4                              000D 40900016
         LA    WREG,DCBBSDLE            LOAD ADRS OF DLE-EOT       000D 41000016
         O     WREG,DIALRST             OR IN COMMAND              000D 41100016
         ST    WREG,0(CCWREG)           STORE IN CCW               000D 41200016
         B     RESTART                                                  41300016
PTPT     MVC   4(4,CCWREG),PTPTRST+4   MOVE CCW TO IOB             000D 41400016
         LA    WREG,DCBBSEOT            LOAD ADDRESS OF EOT        000D 41500016
         O     WREG,PTPTRST             OR IN COMMAND              000D 41600016
         ST    WREG,0(CCWREG)           STORE IN CCW               000D 41700016
         B     RESTART                                             000D 41707000
TRYRDENQ LA    CCWREG,IOBCPA+L8   POINT TO READ ENQ            @ZA06398 41714000
         CLI   IOBINCAM+L1,ERRMAXCT  RETRY COUNT 7 ?           @ZA06398 41721000
         BE    DIALERR             YES, SET ERROR              @ZA06398 41728000
         SR    ICREG,ICREG         CLEAR REG                   @ZA06398 41735000
         IC    ICREG,IOBINCAM+L1   GET RETRY COUNT             @ZA06398 41742000
         LA    ICREG,INCRE(ICREG)  ADD ONE                     @ZA06398 41749000
         STC   ICREG,IOBINCAM+L1   STORE BACK                  @ZA06398 41756000
         B     RESTART              TRY READ ENQ               @ZA06398 41763000
CHKENQ   CLC   DECRESPN(L1),DCBBSENQ   ENQ READ ?              @ZA06398 41770000
         BNE   DIALERR             NO SET ERROR                @ZA06398 41777000
         LA    CCWREG,IOBCPA       POINT TO WRT EOT            @ZA06398 41784000
         B     RESTART                                         @ZA06398 41791000
HANDLETR EQU   *                                                 S99245 41802002
         CLI   0(CCWREG),NOP            LAST CCW?                S99245 41804002
         BE    END                      YES,CHECK FOR ENQ        S99245 41806002
         CLI   TPOPCODE(CCWREG),WRTEOT WRITE EOT                 S99245 41808002
         BE    OTHER                    YES,RETRY                S99245 41810002
         CLI   TPOPCODE(CCWREG),RDRESP READ RESP TO EOT          S99245 41812002
         BNE   DIALERR                  NO,SHOULD NOT OCCUR      S99245 41814002
         TM    IOBSENS0,TIMEOUT    TIMEOUT ERROR ?               S99245 41816002
         BO    RETRYTO             YES, GO RETRY                 S99245 41818002
         CLC   DECRESPN(DLEOTLNG),DCBBSDLE  DLE EOT RECEIVED ?   S99245 41820002
         BNE   OTHER               NO. SOMETHING ELSE            S99245 41822002
         L     WREG,IOBERINF       GET ADDR OF USER'S BUFFER     S99245 41824002
         MVC   0(DLEOTLNG,WREG),DCBBSDLE  MOVE DLE EOT TO BUF    S99245 41826002
         XC    IOBWORK+1(ERRWORD),IOBWORK+1  CLEAR ERROR WORD    S99245 41828002
*                                  TO INDICATE NRM COMPLETION    S99245 41830002
GOPOST   EQU   *                                                 S99245 41832002
         OI    DECDCBAD,POSTBIT    INDICATE POSTING              S99245 41834002
         B     END                 GO POST                       S99245 41836002
RETRYTO  EQU   *                   RETRY TIMEOUT CONDITION       S99245 41838002
         CLI   IOBINCAM+1,RETRY25  RETRY COUNT = 25 ?            S99245 41840002
         BE    DIALERR             YES, POST WITH X'41'          S99245 41842002
         B     TRYAGAIN            GO RETRY                      S99245 41844002
OTHER    EQU   *                                                 S99245 41846002
         CLI   IOBINCAM+1,ERRMAXCT  RETRY COUNT = 7              S99245 41848002
         BE    DIALERR             YES, POST WITH X'41'          S99245 41850002
TRYAGAIN EQU   *                                                 S99245 41852002
         SR    ICREG,ICREG         CLEAR REG                     S99245 41854002
         IC    ICREG,IOBINCAM+1    GET RETRY COUNT               S99245 41856002
         LA    ICREG,INCRE(ICREG)  INCREMENT COUNT               S99245 41858002
         STC   ICREG,IOBINCAM+1    STORE COUNT                   S99245 41860002
         B     RESTART             RETRY                         S99245 41862002
DIALERR  EQU   *                                                 S99245 41864002
         MVC   DECSENS0(SENSELNG),IOBSENS0  MOVE SENSE TO DECB   S99245 41866002
         MVC   DECCOUNT(RESIDCNT),IOBCSW+6  RESIDUAL COUNT       S99245 41868002
         MVI   DECTPCOD,RDTEXT     SET TP OP CODE                S99245 41870002
         MVC   DECCSWST(STATLNG),IOBCSW+4  MOVE STATUS TO DECB   S99245 41872002
         OI    IOBWORK+1,MASKALL   INDICATES ERROR - POST '41'   S99245 41874002
         OI    DECERRST,RFTERROR   INDICATE RFT ERROR          @ZA06398 41876000
         B     GOPOST              GO POST                       S99245 41878002
END      EQU   *                                                        41900016
         TM    DCBBFTEK,DCBDYBFR        TEST FOR DYN BUFFERING   A32477 41910020
         BZ    END1                     NO, BRANCH               A32477 41920020
         L     WREG,IOBERINF            GET BUFFER ADDRESS       A32477 41930020
         N     WREG,MASKDB              ADD TO FULL WORD         A32477 41940020
         SH    WREG,K4                  BACK UP TO BUF POINTER   A32477 41950020
         ST    WREG,DECAREA             STORE IN DECB            A32477 41960020
         XC    1(3,WREG),1(WREG)        ZERO POINTER             A32477 41970020
END1     EQU   *                                                 A32477 41980020
         NI    IOBINCAM,MASKALL-BUSY   TURN OFF BUSY BIT           000D 42000016
         NI    IOBINCAM,MASKALL-ONLT    TURN OFF ONLT IN CTRL      000D 42100016
         NI    IOBINCAM+1,X'00'                                    000L 42150019
         CLI   DECTYPE+1,RDCONT    WAS OPERATION A READ CONTINUE        42160002
         BNE   NOTRDTT             NO, BRANCH                    S99245 42170002
         TM    UCBDEVTP+1,DIAL     DIAL ?                        S99245 42172002
         BNO   SETEOT              NO, SET UP EOT AND POST       S99245 42174002
         MVI   IOBCPA+45,ZEROTP    RESET TP OP CODE              S99245 42176002
         CLI   0(CCWREG),NOP       WAS LAST CCW A NOP ?          S99245 42178002
         BNE   NOTRDTT             NO, BRANCH                    S99245 42180002
         CLC   DECRESPN(ENQLNG),DCBBSENQ  WAS ENQ REC'D ?        S99245 42182002
         BNE   DIALERR             NO, POST WITH X'41'           S99245 42184002
         NI    IOBINCAM,RFTBIT     TURN OFF 3270 RFT BIT         S99245 42186002
         MVI   DECDCBAD,RESETBUF   RETURN BUFFER COUNT TO ZERO   S99245 42188002
         B     SETSTART            RESET IOBSTART                S99245 42190002
NOTRDTT  EQU   *                                                 S99245 42192002
         TM    DECDCBAD,X'80'          SHOULD WE POST OR DO READ TI     42200018
         BO    LAST                     IF ONE, GO POST            000D 42300016
         MVI   DECDCBAD,X'00'          RETURN BUFFER COUNT TO ZERO      42370018
         MVI   IOBSNDPT,X'00'          RESET ACK POINTER         A27626 42470019
SETSTART EQU   *                                                 S99245 42520002
         MVI   IOBERINF,X00                                 LD @ZA02329 42570003
*                                                                       42620002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 42670003
*                                                                       42720002
         L     DEBREG,DCBDEBAD         LOAD DEB ADDRESS          YM4090 42910002
         L     BAS1REG,DEBNMSUB        LOAD TCB ADDRESS          YM4056 42926002
         USING TCB,BAS1REG             TCB ADDRESSABILITY        YM4056 42928002
         MODESET EXTKEY=TCB,WORKREG=15 USER'S KEY                YM4056 42928402
         DROP  BAS1REG                 DROP TCB ADDRESSABILITY   YM4056 42928802
*                                                                       42928902
*        GETMAIN X48 BYTES FOR IGG019MA SAVEAREA            LD @ZA02332 42929003
*        AND X2C BYTES FOR DUMMY DECB.                      LD @ZA02332 42929103
*                                                                       42941202
         L     ZEROREG,REGSAVE         SUBPOOL AND LENGTH        YM4056 42953702
         GETMAIN R,LV=(0)              GET SAVEAREA FOR R/W      YM4056 42965802
         LA    SAVEREG,DISP2C(PARAMREG) LOAD SAVEAREA ADDR. LD @ZA02332 42975803
         LR    WREG,PARAMREG       SAVE AREA ADDR           LD @ZA02332 42985803
         SR    W1REG,W1REG         CLEAR REGISTER           LD @ZA02332 42987803
         ST    W1REG,DISP0(PARAMREG) CLEAR DUMMY ECB AREA   LD @ZA02332 42993203
         MVC   DISP4(THIRTY6,PARAMREG),DECTYPE COPY DECB... LD @ZA02332 42995203
*                                  ...INTO DUMMY            LD @ZA02332 42995603
         MVI   DISP17(PARAMREG),FOXFOX  FLAG AS DUMMY       LD @ZA02332 42996003
         ST    DECBREG,DISP40(PARAMREG) SAVE ADDR OF DECB   LD @ZA02332 42996403
*                                                                       42996502
*              1 LINE DELETED FOR ----->                    LD @ZA02332 42998503
*                                                                       42998902
         L     LINKREG,DCBREAD         R/W ROUTINE ADDRESS       YM4056 43000002
         BALR  RETREG,LINKREG          LINK TO MA                 M1181 43020002
*                                                                       43030002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 43032003
*                                                                       43034002
         LR    PARAMREG,WREG       RESTORE ADDR OF DUMMY    LD @ZA02332 43036003
         MVC   DECTYPE(THIRTY6),DISP4(PARAMREG)  COPY...    LD @ZA02332 43038003
*                                  ...DUMMY INTO DECB       LD @ZA02332 43038803
         STCM  DECBREG,MASK,IOBECBPT+L1  POINT IOB TO DECB  LD @ZA02332 43039203
         TM    DISP0(PARAMREG),POSTBT  HAS DUMMY...         LD @ZA02332 43039603
*                                  ...BEEN POSTED           LD @ZA02332 43039703
         BZ    FREEDECB            NO, BRANCH               LD @ZA02332 43039803
         MVC   DECTYPE(THIRTY6),DISP4(PARAMREG) COPY...     LD @ZA02332 43039900
*                                  ...INTO DECB             LD @ZA02332 43043903
         L     PARMREG,DISP0(PARAMREG)  LOAD POST CODE      LD @ZA02332 43045903
         LA    PARAMREG,DISP0(DECBREG)  LOAD DECB ADDR      LD @ZA02332 43047903
         POST  (1),(0)             POST USER'S DECB         LD @ZA02332 43056503
FREEDECB EQU   *                                            LD @ZA02332 43058503
         L     ZEROREG,REGSAVE         SUBPOOL AND LENGTH        YM4056 43065602
         FREEMAIN R,LV=(0),A=(WREG)    FREE SAVEAREA        LD @ZA02332 43074203
         LA    SAVEREG,SAVE            RESTORE SAVEAREA ADDRESS  YM4056 43082802
         MODESET EXTKEY=ZERO           KEY ZERO                  YM4056 43091402
*                                                                       43101402
         MVI   DECSENS1,X00             TURN OFF DUMMY DECB    @ZA06406 43101600
*              1 LINE DELETED FOR ----->                    LD @ZA02332 43101803
*                                                                       43101902
         TM    UCBDEVTP+1,X'40'         IS AUTOPOLL SPECIFIED           43102019
         BNO   NOAUTO                   NO, DON'T RESET USAGE COUNT     43104019
         NC    DECPOLPT+1(3),DECPOLPT+1 CHECK FOR ADDRESS PRESENT       43106019
         BZ    NOAUTO                   NO, DON'T RESET USAGE COUNT     43108019
         L     AREAREG,DECPOLPT         LOAD ADDRESS TERM LIST   A23123 43110018
         BCTR  AREAREG,0                BACK UP ONE BYTE         A23123 43120018
         TM    IOBINCAM,ONLT            IF OLT FLAG IS ON,R/W   YA01017 43121002
         BO    NOAUTO                   DON'T INCR USER CNT     YA01017 43122002
         TM    0(AREAREG),X'0F'         IS USAGE COUNT ZERO             43123019
         BZ    NOAUTO                   YES, DON'T DECREMENT            43126019
         IC    ICREG,0(AREAREG)         PICK UP USAGE COUNT      A23123 43130018
         BCTR  ICREG,0                  REDUCE BY ONE            A23123 43140018
         STC   ICREG,0(AREAREG)         STORE NEW COUNT          A23123 43150018
NOAUTO   SVC   3                        RETURN                          43220019
SETEOT   EQU   *                                                        43230002
         NI    IOBINCAM,RFTBIT     TURN OFF RFT RECEIVED                43240002
*                                  CONTROL UNIT CAPABLE OF              43250002
*                                  GENERAL POLL BIT                     43260002
         L     WREG,IOBERINF       GET AREA ADDRESS                     43270002
         MVC   0(EOTLNGTH,WREG),DCBBSEOT PUT EOT IN AREA                43280002
         SR    W1REG,W1REG              CLEAR REG              @ZA06398 43284000
         LH    W1REG,DECLNGTH          GET ORGINAL COUNT       @ZA06398 43288000
         BCTR  W1REG,X00                SUBTRACT ONE           @ZA06398 43292000
         STH   W1REG,DECCOUNT      STORE IN RESIDUAL COUNT     @ZA06398 43296000
LAST     MVI   DECDCBAD,X'00'          RETURN BUFFER COUNT TO ZERO      43300018
         TM    DCBBFTEK,DCBDYBFR        TEST FOR DYN BUFFERING   A32477 43306020
         BZ    LAST2                    NO, BRANCH               A32477 43312020
         LR    BUFREG,WREG              PUT BUFFER IN BUFREG     A32477 43318020
         L     ECBREG,SEVENF           STORE COMPLETION CODE     A32477 43324020
         CLC   IOBWORK+1(4),ZERO        ANY ERRORS               A32477 43330020
         BE    LAST1                    NO, BRANCH               A32477 43336020
         L     ECBREG,FORTY1           STORE ABNORM COMPLETION   A32477 43342020
LAST1    LR    ZEROREG,BASEREG          SAVE BASE REGISTER       A32477 43348020
         L     BAS1REG,DEBNMSUB         LOAD ADDRESS OF TCB      A32477 43354020
         USING CVT,WREG                 CVT ADDRESSABILITY       YM4056 43356002
         L     WREG,SIXT                LOAD OFFSET OF CUT       A32477 43360020
         L     LINKREG,CVT0PT01         LOAD ADDR OF SUP POST    YM4056 43366002
         DROP  WREG                     DROP CVT ADDRESSABILITY  YM4056 43368002
         BALR  RETREG,LINKREG           LINK TO POST ROUTINE     A32477 43372020
         LR    BASEREG,ZEROREG          RESTORE BASE REGISTER    A32477 43378020
LAST2    EQU   *                                                 A32477 43384020
         L     0,SEVENF                                                 43400016
         CLC   IOBWORK+1(4),ZERO        CHECK FOR ANY ERRORS            43500016
         BE    POST                     IF NONE, POST 7F           000D 43600016
         L     0,FORTY1                                                 43700016
POST    EQU   *                                                         43800016
         L     1,IOBECBPT                                               43900016
         LA    PARAMREG,0(PARAMREG)                                000D 44000016
         SVC   2                                                   000D 44100016
         SVC   3                        RETURN                     000D 44200016
ZERO     DC    F'0'                                                000D 44300016
DATA     DC    X'F0F0F0F1'                                              44400019
SEVENF   DC    X'7F000000'                                              44500016
FORTY1   DC    X'41000000'                                              44600016
DIALRST  DC    X'0100000060000002'      WRITE DLE-EOT              000D 44700016
         DC    X'2F00000060800001'     DISABLE                     000D 44800016
         DC    X'0300000020800001'      NOP CCW                         44900016
WRTRESET DC    X'60310001'         WRITE RESET CHANNEL PGM       S99245 44920002
         DC    X'0200000060320002' FOR 3275 DIAL - TO SET        S99245 44940002
         DC    X'0300000020800001' UP USER'S READ CONTINUE       S99245 44960002
READENQ  DC    X'0200000020340002'                             @ZA06398 44980000
PTPTRST  DC    X'0100000020800001'      WRITE EOT                  000D 45000016
WENQ     DC    X'0100000060000001'                                 000L 45030019
TICRESP  DC    X'0800000020800001'                                 000L 45060019
XLTTABLE DC    X'000A0B0C0D0E0F'   3270 XLATE TABLE         LD @ZA02330 45070003
         DS    0D                                                       45100016
WORKAREA  DS   2F                                                  000D 45200016
MAXLENGT DC    H'08'                                                    45600016
         ORG   *-240                                               000D 45700016
TABLE    DS    0C                                                  000D 45800016
         ORG   *+240                                               000D 45900016
         DC    C'0123456789ABCDEF'                                      46000016
MSG      WTO   'IEC800I CUU ONLINE TEST XX YY TT NL ID              ', *46100019
               MF=L,ROUTCDE=(8),DESC=(4)                           000H 46200018
ZONEOFF  EQU   X'0F'               MASK TO AND OFF ZONES    LD @ZA02330 46210003
ASCZONE  EQU   X'30'               ASCII NUMERIC ZONE BITS  LD @ZA02330 46212003
ALFAZONE EQU   X'70'               ZONE FOR ASCII CHARS.    LD @ZA02330 46214003
ERRMAXCT EQU   X'07'                                               000L 46220019
NOWACK   EQU   X'3F'                                               000L 46240019
WACK     EQU   X'C0'                                               000L 46260019
TWENTY5  EQU   X'19'                                               000L 46280019
ENQCHAR  EQU   X'2D'                                               000D 46300016
CMCH     EQU   X'40'                                                    46400016
ERR      EQU   X'41'                    ERROR COMPLETION CODE      000D 46500016
BUSY     EQU   X'40'                    BUSY BIT                   000D 46600016
UNITEXCP EQU   X'01'                    UNIT EXCEPTION BIT         000D 46700016
WRL      EQU   X'40'                    WRONG LENGTH RECORD BIT         46800016
RESET    EQU   X'80'                                                    46900016
DYNBF    EQU   X'08'                                                    47000016
ONLT     EQU   X'01'                                                    47100016
TPOPERP  EQU   X'30'                                                    47200016
ZEROY    EQU   X'00'                                                    47300016
RDCONT   EQU   X'03'               READ CONTINUE                        47330002
RFTBIT   EQU   X'EF'               RFT RCVD FROM GEN POLL CU            47360002
DIAL     EQU   X'90'               BSC2 FEATURE IN UCB           S99245 47361002
TPOPCODE EQU   5                   DISP IN CCW OF TP OP CODE     S99245 47362002
WRTEOT   EQU   X'31'               TP OP CODE OF WRT EOT CCW -   S99245 47363002
*                                   DIAL 3270                    S99245 47364002
RDRESP   EQU   X'32'               RD RESP TP CODE - DIAL 3270   S99245 47365002
RETRY25  EQU   X'25'               # OF RETRIES FOR TIMEOUT      S99245 47366002
INVWREOT EQU   X'33'                                           @ZA06398 47366300
INVRDENQ EQU   X'34'               INVALID READ ENQ            @ZA06398 47366600
INCRE    EQU   1                   USED TO INCREMENT RETRY CNT   S99245 47367002
DLEOTLNG EQU   2                   # OF CHARS - DLE EOT          S99245 47368002
ERRWORD  EQU   4                   LENGTH OF ERROR COUNTER       S99245 47369002
POSTBIT  EQU   X'80'               POST INDICATOR                S99245 47370002
SENSELNG EQU   1                   LENGTH OF DECSENS0            S99245 47371002
RESIDCNT EQU   2                   LENGTH OF RESIDUAL COUNT      S99245 47372002
RDTEXT   EQU   X'11'               READ TEXT TP OP CODE          S99245 47373002
STATLNG  EQU   2                   LENGTH OF STATUS BYTES        S99245 47374002
CCWFLAGS EQU   4                   DISP INTO CCW OF FLAGS        S99245 47375002
FIVEWORD EQU   20                  # CHARS MOVED TO WR RESET     S99245 47376002
CNTLNG   EQU   1                   LENGTH OF RETRY COUNTER       S99245 47377002
ENQLNG   EQU   1                   LENGTH OF AN ENQ CHAR         S99245 47378002
RFTERROR EQU   X'01'               3275 DIAL RFT ERROR BIT       S99245 47379002
RDCMD    EQU   4                                                 S99245 47380002
RDEOTCCW EQU   8                                                 S99245 47381002
RESETACK EQU   X'00'               USED TO RESET ACK POINTERS    S99245 47382002
RESETBUF EQU   X'00'               USED TO RESET BUFFER COUNT    S99245 47383002
ZEROTP   EQU   X'00'               USED TO RESET TP OP CODE      S99245 47384002
TWOCCWS  EQU   16                       LENGTH OF 2 CCWS        YA01276 47394002
ONECCW   EQU   8                        LENGTH OF 1 CCW         YA01276 47396002
WRITECMD EQU   X'01'                    WRITE COMMAND           YA01276 47398002
TICCMD   EQU   X'08'                    TIC COMMAND             YA01276 47398402
POSTBT   EQU   X'40'               POST BIT IN ECB          LD @ZA02332 47398803
FOXFOX   EQU   X'FF'               BYTE OF ALL ONES         LD @ZA02332 47399203
MASK     EQU   7                   MASK FOR STCM            LD @ZA02332 47399603
DISP0    EQU   0                   DISPLACEMENT             LD @ZA02330 47416303
DISP1    EQU   1                   DISPLACEMENT             LD @ZA02330 47426303
DISP2    EQU   2                   DISPLACEMENT             LD @ZA02330 47428303
DISP4    EQU   4                   DISPLACEMENT             LD @ZA02330 47430303
DISP6    EQU   6                   DISPLACEMENT             LD @ZA02330 47432303
DISP7    EQU   7                   DISPLACEMENT             LD @ZA02330 47432703
DISP17   EQU   17                  DISPLACEMENT             LD @ZA02332 47432803
DISP40   EQU   40                  DISPLACEMENT             LD @ZA02332 47432903
DISP2C   EQU   X'2C'               DISPLACEMENT             LD @ZA02332 47433003
X00      EQU   X'00'                                        LD @ZA02329 47433103
X02      EQU   X'02'                                           @ZA06398 47435100
X20      EQU   X'20'                                        LD @ZA02330 47438703
X33      EQU   X'33'                                           @ZA06398 47439700
X34      EQU   X'34'                                        LD @ZA02330 47440703
X40      EQU   X'40'                                        LD @ZA02330 47442703
X66      EQU   X'66'                                        LD @ZA02330 47443103
XC6      EQU   X'C6'                                        LD @ZA02330 47443503
XF4      EQU   X'F4'                                        LD @ZA02330 47443600
XFF      EQU   X'FF'                                           @ZA06398 47443700
L1       EQU   1                                            LD @ZA02330 47444003
L2       EQU   2                                            LD @ZA02330 47444103
L4       EQU   4                                            LD @ZA02330 47444203
L5       EQU   5                                               @ZA06398 47444700
L8       EQU   8                                               @ZA06398 47445200
L12      EQU   12                                              @ZA06398 47445700
THIRTY6  EQU   36                                           LD @ZA02332 47446203
FIFTYSIX EQU   56                                           LD @ZA02331 47449803
         DS    0F                  FULL WORD ALIGNMENT      LD @ZA02332 47455403
GETPARM  DC    X'FA000008'         SUBPOOL AND LENGTH       LD @ZA02332 47466603
         EJECT                                                          47483316
         DS    0H                                                       47500016
STRTSTOP EQU   *                                                        47600016
*                                                                       47700016
         LA    WREG,PATNAME                                             47800016
         ST    WREG,PARMLIST                                            47900016
         LA    WREG,CRIDLES                                             48000016
         ST    WREG,PARMLIST+4                                          48100016
         LA    WREG,GETMAIN1                                            48200016
         ST    WREG,PATNAME                                             48300016
         TM    DECTYPE,RCVTST           IS THIS  RECEIVE TEST      1263 48320018
         BZ    CHKONCCW                 NO, CHECK FOR ONLT CCW     1263 48340018
         NI    DECTYPE,MASKALL-RCVTST   TURN FLAG OFF              1263 48360018
         B     SVC66                    GO TO TRANSIENT ROUTINE    1263 48380018
         SPACE 2                                                        48400016
CHKONCCW EQU   *                                                   1263 48450018
*                             RETURNING FROM ONLT WRITE?                48500016
         CLI   DCBERROP+2,X'21'         DEVICE A 1030             M3153 48510018
         BE    TSTCCW                   YES, BRANCH               M3153 48520018
         MVC   RCOUNT(2),IOBCSW+6       SAVE RESIDUAL COUNT       M3153 48550018
TSTCCW   TM    5(CCWREG),X'3F'          TEST FOR ONLT CCW         M3153 48580018
         BNZ   CALL                     BRANCH IF NOT              000K 48610018
         TM    DECONLTT,MASKALL         IS THIS 1030 PATTERN      M3110 48613018
         BO    FREEAREA                 YES, BRANCH TO FREE AREA  M3110 48616018
         L     WREG,IOBCPA              DATA ADDR FROM FIRST CCW   000K 48620018
         CLC   0(3,WREG),DPREO          IS TEST TO A 2760          000K 48630018
         BNE   FREEAREA                BRANCH IF NOT TO CLEANUP  A29567 48640019
         CLI   DECRESPN+1,POSITIVE      POSITIVE RESPONSE TO EOB   000K 48650018
         BE    TESTRENT                 BRANCH IF POSITIVE         000K 48660018
         NI    DECDCBAD,NOENTRY        DO NOT REENTER (2760)       000K 48670018
         B     END                      EXIT IF RESP NOT POSITIVE  000K 48680018
TESTRENT EQU   *                                                   000K 48690018
         TM    DECONLTT,REENTRY         SHOULD TEST MODULE BE      000K 48700018
*                                          REENTERED               000K 48710018
         BZ    FREEAREA                 BRANCH IF NOT TO CLEAN UP  000K 48720018
         SPACE 2                                                        48800016
*                             MOVE PARAMETER LIST POINTER INTO IOB      48900016
CALL     EQU   *                                                   00MC 48906020
         TM    UCBDEVTP+3,X'E0'         IS THIS IBM1 ADAPTER       1263 48912018
         BNZ   NOT2740C                 NO, NOT 2740              M3153 48916018
         TM    UCBDEVTP,X'09'          IS THIS 2740B               00MC 48916620
         BO    A2740                   YEX, TREAT AS 2740          00MC 48917220
         TM    UCBDEVTP,X'0B'          IS THIS 2740                00MC 48917820
         BNZ   NOT2740C                NO, CONTINUE                00MC 48918420
A2740    EQU   *                                                   00MC 48919020
         TM    UCBDEVTP+1,X'20'         IS THIS 2740 CHECKING      1263 48920018
         BNO   NOT2740C                 NO, NOT 2740 WITH CHECKING 1263 48924018
         TM    UCBDEVTP+1,X'0C'         OIU FEATURE                1263 48925018
         BO    NOT2740C                 BRANCH IF YES              1263 48926018
         OI    DECTYPE,RCVTST           SET ON RECEIVE TEST FLAG   1263 48928018
         LA    AREAREG,CRIDLES+20       PICK UP CHARACTER ADDRESS  1263 48932018
CHKEND   TM    5(CCWREG),X'80'          IS THIS LAST CCW           1263 48936018
         BO    ENDFND                   YES, LAST CCW              1263 48940018
         LA    CCWREG,8(CCWREG)         POINT TO NEXT CCW          1263 48944018
         B     CHKEND                   BRANCH TO CHECK IT         1263 48948018
ENDFND   LA    CCWREG,8(CCWREG)         POINT TO NEXT CCW          1263 48952018
         MVC   0(8,CCWREG),PTPTRST      MOVE IN CCW                1263 48956018
         ST    AREAREG,0(CCWREG)        STORE AREA ADDRESS         1263 48960018
         MVI   0(CCWREG),X'01'          SET COMMAND CODE TO WRITE  1263 48964018
         MVI   7(CCWREG),X'04'          SET COUNT TO FOUR          1263 48968018
         ST    CCWREG,IOBSTART          STORE CCW ADDRESS IN IOB   1263 48972018
         B     EXCP                     EXECUTE CHANNEL PROG       1263 48976018
NOT2740C EQU   *                                                   1263 48980018
SVC66    EQU   *                                                   1263 48984018
         LA    1,PARMLIST                                               49000016
         ST    1,IOBPARM                                                49100016
         SPACE 2                                                        49200016
*                             LOAD GEN REG 1 WITH IOB ADDRESS           49300016
         LR    1,IOBREG                 LOAD IOB ADRS AS PARAMETER 000D 49400016
         SVC   66                      FETCH TERMINAL TEST TRANSIENTS   49500016
         SPACE                                                          49600016
*        RETURN FROM TRANSIENT ROUTINES TO SEND TEST MESSAGE            49700016
         SPACE                                                          49800016
         TM    IOBINCAM,X'01'          CHECK FOR TEST NOT SET UP        49900016
         BO    CMPISON                                             000D 50000016
         SPACE                                                          50100016
*        FREE TERMINAL TEST PATTERN AREA IF AREA UTILIZED               50200016
         SPACE                                                          50300016
FREEAREA SR    AREAREG,AREAREG         CLEAR REGISTER                   50400016
         TM    DECONLTT,MAXBITS        TEST FOR AREA UTILIZED           50500016
         BZ    END                      ERO MEANS AREA NOT UTILIZED     50600016
         BO    PAT1030                 BRANCH IF 1030 SWITCH AREA       50700016
         SR    AREAREG,AREAREG         CLEAR REGISTER                   50800016
         IC    AREAREG,DECONLTT        INSERT PATTERN SELECT OFFSET     50900016
         A     AREAREG,PATRNLST        ADD POINTER TO HEAD OF LIST      51000016
         SR    CTRREG,CTRREG           CLEAR REGISTER                   51100016
         IC    CTRREG,0(AREAREG)       INSERT PATTERN USAGE COUNT       51200016
         SH    CTRREG,ONE              DECREMENT USAGE COUNT            51300016
         STC   CTRREG,0(AREAREG)       STORE CORRECT COUNT BACK         51400016
         BNZ   END                      RANCH IF AREA STILL IN USE      51500016
FNDADDR  MVI   DECONLTT,X'00'           CLEAR USAGE INDICATOR     M3152 51580018
         L     1,0(AREAREG)             LOAD ADDRESS OF AREA      M3152 51660018
         SR    WREG,WREG                CLEAR REGISTER             000D 51740016
         IC    WREG,0(1)                INSERT AREA SIZE           000D 51780016
         LA    WREG,7(WREG)             ROUND UP TO DBL WORD       000D 51820016
         ST    WREG,FA                  SET UP                     000D 51860016
         NI    FA+3,X'F8'                                          000D 51900016
         MVI   FA,X'FA'                   FOR                      000D 51940016
         L    0,FA                          SUBPOOL 255            000D 51960016
         FREEMAIN R,LV=(0),A=(1)       FREE AREA UTILIZED               52000016
         B     END                                                      52100016
FA       DC    F'0'                                                000D 52150016
*                                                                       52200016
PAT1030  IC    AREAREG,DCBEIOBX        INSERT IOB SIZE                  52300016
         NI    DECFLAGS,X'00'          CLEAR DECB STATUS FLAGS          52400016
         MH    AREAREG,DECFLAGS        MULTIPLY BY RLN                  52500016
         A     AREAREG,DCBIOBAD        ADD DCB IOB POINTER              52600016
         LA    AREAREG,36(AREAREG)     POINT TO PATTERN ADDRESS         52700016
         B     FNDADDR                 GO TO RELEASE AREA               52800016
         EJECT                                                          52900016
*                                                                       53000016
EXIT     EQU   *                                                        53100016
         SVC   3                                                        53150017
*                                                                       53200016
CMPISON  EQU   *                                                        53201016
         CLI   7(AREAREG),X'07'        1060 NOT COMPARED HERE      000D 53202016
         BE    EXCP                                                000D 53203016
         CLI   7(AREAREG),P0           2741P NOT COMPARED HERE          53203218
         BE    EXCP                                                     53203418
         CLI   7(AREAREG),C0           2741C NOT COMPARED HERE          53203618
         BE    EXCP                                                     53203818
         CLI   7(AREAREG),C4            2740C NOT COMPARED HERE    000M 53204219
         BE    EXCP                                                000M 53204619
         CLI   7(AREAREG),X'56'        2848 NOT COMPARED HERE      000M 53205019
         BE    EXCP                                                000M 53205419
         CLI   6(AREAREG),X'0B'        TEST FOR COMPARE MESSG      000D 53206016
         BNE   EXCP                    IF NOT, BRANCH              000D 53207016
*            ROUTINE TO FIND LENGTH OF MESSAGE                     000D 53208016
         LH    CTRREG,DECLNGTH         INPUT AREA LENGTH           000D 53209016
         A     CTRREG,DECAREA          - OFFSET                    000D 53210016
         SR    CTRREG,AREAREG               FROM START OF MSG      000D 53211016
         CLI   DCBERROP+2,X'21'         DEVICE A 1030             M3153 53211318
         BE    SH1030                   YES, USE RESID COUNT      M3153 53211618
         SH    CTRREG,RCOUNT            SUBTRACT RESIDUAL COUNT   M3153 53212018
         B     SH12                                               M3153 53212518
SH1030   SH    CTRREG,IOBCSW+6          SUBTRACT RESIDUAL COUNT   M3153 53213018
SH12     SH    CTRREG,H12               SUBTRACT TWELVE           M3153 53213518
         BM    NOCHAR                                              000D 53214016
         CH    CTRREG,MAXLNG           IS LENGTH TOO GREAT         000D 53215016
         BNH   FINDTXT                 NO                          000D 53216016
         LH    CTRREG,MAXLNG           YES, SUBSTITUTE MAX LENGTH  000D 53217016
FINDTXT  LA    W1REG,10(AREAREG)       POINT TO FIRST COMPARE CHAR 000D 53218016
         CLI   7(AREAREG),X'02'        REQUEST FOR 1030            000D 53219016
         BE    CMP1030                 1030 CARD READER REQUEST    000D 53220016
         LA    WREG,COMPDATA                                       000D 53221016
CMPTST   EX    CTRREG,COMPARE                                      000D 53222016
         BNE    EXCP                   BAD COMPARE, MSG SWITCH     000D 53223016
         B     LOADMSG                 GOOD, LOAD COMPARE MSSG     000D 53224016
*                                                                  000D 53225016
CMP1030  EQU   *                                                   000D 53226016
         CLI   9(AREAREG),X'20'        COMPARE 1030 ZERO           000D 53227016
         BNE    EXCP                   NOT VALID, MSG SWITCH       000D 53228016
         LTR   CTRREG,CTRREG           ANY MORE CHARS              000D 53229016
         BZ    LOADMSG                 NO,  GO GET MSG             000D 53230016
         BCTR  CTRREG,0                DECREMENT FOR EXECUTE       000D 53231016
         LA    WREG,COMPDATA+1         ADDRESS OF STORED DATA      000D 53232016
         B     CMPTST                                              000D 53233016
LOADMSG  EQU   *                                                   000D 53234016
         MVC   0(11,AREAREG),CMPVALD   MOVE COMPARE VALID MESSG    000D 53235016
         CLI   DCBERROP+2,X'21'        DEVICE A 1030              M2834 53235419
         BNE   LOADOFST                NO, BRANCH                 M2834 53235819
         LA    CTRREG,1(CTRREG)        ADD OFFSET                 M2834 53236219
LOADOFST AR    WREG,CTRREG             ADD LENGTH TO GET OFFSET   M2834 53236619
         MVC   8(1,AREAREG),0(WREG)    GET LAST CHARACTER          000D 53237016
         CLI   DCBERROP+2,X'21'         DEVICE A 1030            A24922 53238018
         BNE    EXCP                                               000D 53239016
         L     ICREG,36(IOBREG)        ADDRESS OF GETMAIN AREA     000D 53240016
         LA    CTRREG,11                                           000D 53241016
         L     UCBREG,DFDF             GET PAD CHARACTERS          000D 53242016
         IC    UCBREG,0(AREAREG)       GET MESSAGE CHARACTER       000D 53243016
         ST    UCBREG,0(ICREG)         STORE IN MESSG AREA         000D 53244016
         LA    ICREG,4(ICREG)          INCREMENT AREA POINTER      000D 53245016
         LA    AREAREG,1(AREAREG)      GET NEXT MESSG CHARACTER    000D 53246016
         BCT   CTRREG,*-16             GO STORE ANOTHER WORD       000D 53247016
        L     ICREG,36(IOBREG)         ADDRESS OF GETMAIN AREA     000D 53248016
         MVC   0(1,ICREG),GETMAIN1+3                               000D 53249016
         B     EXCP                                                000D 53250016
         SPACE  2                                                  000D 53251016
NOCHAR   MVC   0(11,AREAREG),CMPVALD                               000D 53252016
         B     EXCP                                                000D 53253016
         DS    0F                                                       53254016
COMPARE  CLC   0(0,W1REG),0(WREG)                                  000D 53255016
MAXLNG   DC    H'35'                                               000D 53256016
DFDF     DC    X'DFDFDFDF'                                              53257016
H12      DC    H'12'                                                    53258016
         EJECT                                                          53400016
*                                                                       53500016
*        PARAMETER LIST TO BE PASSED TO TRANSIENT ROUTINES              53600016
*                                                                       53700016
PARMLIST DS    0F                                                       53800016
PATRNLST DC    F'0'                    ADDRESS OF PATTERN LIST          53900016
         DC    F'0'                    ADDRESS OF NL & IDLES            54000016
NOTEST   DC    X'00'                   NO TEST SWITCH                   54100016
*                                                                       54200016
*        SPECIAL CHARACTERS AND PARAMETERS                              54300016
*                                                                       54400016
SAVE     DS    18F                                                      54500016
GETMAIN1 GETMAIN EC,LV=0,A=0,SP=250,MF=L                           000A 54600016
CRIDLES  DC    X'16'                   TERMINAL TEST                    54700016
         DC    3XL1'DF'                LINE                             54800016
         DC    X'5B'                   INITIALIZATION                   54900016
         DC    15XL1'DF'               CHARACTERS                       55000016
         DC    X'161F1F1F'             CIRCLE D AND CIRCLE C'S          55100016
         DC    X'761F1F1F37'           CIRCLE Y,CIRCLE C'S AND CIRCLE S 55200016
*                                                                       55300016
C4       EQU   X'10'                    CORRS 4 - TYPE CODE FOR 274000M 55350019
         EJECT                                                          55400016
*                                                                       55500016
*        ADDRESS OF GETMAIN PARAMETERS AND TERMINAL TEST PATTERN TABLE  55600016
*                                                                       55700016
         DS    0F                                                       55800016
PATNAME  EQU   *                                                        55900016
         DC    F'0'                    ADDRESS OF GETMAIN PARAMETERS    56000016
BTTP5TLT DC    X'00'                   1050 TILT PATTERN USAGE COUNT    56100016
BTTA5TLT DC    AL3(0)                  1050 TILT ADDRESS                56200016
BTTP5ROT DC    X'00'                   1050 ROTATE PATTERN USAGE COUNT  56300016
BTTA5ROT DC    AL3(0)                  1050 ROTATE ADDRESS              56400016
BTTP5TWS DC    X'00'                   1050 TWIST PATTERN USAGE COUNT   56500016
BTTA5TWS DC    AL3(0)                  1050 TWIST ADDRESS               56600016
BTTP5ALC DC    X'00'                   1050 ALL CHARACTERS USAGE COUNT  56700016
BTTA5ALC DC    AL3(0)                  1050 ALL CHARACTERS ADDRESS      56800016
BTTP5SLA DC    X'00'                   1050 SELECTRIC ANALYZER USAGE CT 56900016
BTTA5SLA DC    AL3(0)                  1050 SELECTRIC ANALYZER ADDRESS  57000016
         SPACE                                                          57100016
BTTP6TLT DC    X'00'                   1060 TILT PATTERN USAGE COUNT    57200016
BTTA6TLT DC    AL3(0)                  1060 TILT ADDRESS                57300016
BTTP6ROT DC    X'00'                   1060 ROTATE PATTERN USAGE COUNT  57400016
BTTA6ROT DC    AL3(0)                  1060 ROTATE ADDRESS              57500016
BTTP6TWS DC    X'00'                   1060 TWIST PATTERN USAGE COUNT   57600016
BTTA6TWS DC    AL3(0)                  1060 TWIST ADDRESS               57700016
BTTP6ALC DC    X'00'                   1060 ALL CHARACTERS USAGE COUNT  57800016
BTTA6ALC DC    AL3(0)                  1060 ALL CHARACTERS ADDRESS      57900016
BTTP6SLA DC    X'00'              1060 SELECTRIC ANALYZER USAGE COUNT   58000016
BTTA6SLA DC    AL3(0)             1060 SELECTRIC ANALYZER ADDRESS       58100016
         SPACE                                                          58200016
P0       EQU   X'15'                   PTTC 0 -- TYPE CODE FOR 2741     58230018
C0       EQU   X'13'                   CORRS 0-- TYPE CODE FOR 2741     58260018
BTTP3TLT DC    X'00'              1030 TILT PATTERN USAGE COUNT         58300016
BTTA3TLT DC    AL3(0)             1030 TILT ADDRESS                     58400016
BTTP3ROT DC    X'00'              1030 ROTATE PATTERN USAGE COUNT       58500016
BTTA3ROT DC    AL3(0)             1030 ROTATE ADDRESS                   58600016
BTTP3TWS DC    X'00'              1030 TWIST PATTERN USAGE COUNT        58700016
BTTA3TWS DC    AL3(0)             1030 TWIST ADDRESS                    58800016
BTTP3ALC DC    X'00'              1030 ALL CHARACTERS USAGE COUNT       58900016
BTTA3ALC DC    AL3(0)             1030 ALL CHARACTERS ADDRESS           59000016
BTTP3SLA DC    X'00'              1030 SELECTRIC ANALYZER USAGE COUNT   59100016
BTTA3SLA DC    AL3(0)             1030 SELECTRIC ANALYZER ADDRESS       59200016
         SPACE                                                          59300016
BTTP2TLT DC    X'00'              2848 TILT PATTERN USAGE COUNT         59400016
BTTA2TLT DC    AL3(0)             2848 TILT ADDRESS                     59500016
BTTP2ROT DC    X'00'              2848 ROTATE PATTERN USAGE COUNT       59600016
BTTA2ROT DC    AL3(0)             2848 ROTATE ADDRESS                   59700016
BTTP2TWS DC    X'00'              2848 TWIST PATTERN USAGE COUNT        59800016
BTTA2TWS DC    AL3(0)             2848 TWIST ADDRESS                    59900016
BTTP2ALC DC    X'00'              2848 ALL CHARACTERS USAGE COUNT       60000016
BTTA2ALC DC    AL3(0)             2848 ALL CHARACTERS ADDRESS           60100016
*                                                                       60200016
*                                                                       60300016
*                                                                       60400016
COMPDATA DC    X'15020407080B0D0E1013626467686B' STORED                 60500016
         DC    X'6D6E7073434546494A4C4F51522526'       COMPARISON       60600016
         DC    X'292A2C2F3132'                                   DATA   60700016
*                                                                       60800016
CMPVALD  DC    X'67494F012A466840235B1F' VALID COMPARE MESSG       000D 60900016
         DS    0F                                                       60930020
REGSAVE  DC    X'FA000074'             SUBPOOL 250 FOR...   LD @ZA02332 60940003
*                                  SAVEAREA AND DUMMY DECB  LD @ZA02332 60950003
MASKDB   DC    X'00FFFFFC'                                       A32477 60960020
K4       DC    H'4'                                                     61000016
DPREO    DC    X'163E4C'                                                61050018
K8       DC    H'8'                                                     61100016
ONE      DC    H'1'                                                     61200016
SVCNAME  DC    C'IGC0006F'                                              61300016
         SPACE                                                          61400016
*                                                                       61500016
         CNOP  0,8                                                      61600016
         EJECT                                                          61700016
         DCBD  DSORG=BX,DEVD=BS                                         61800016
         IECTDECB                                                       61900016
         IECTIOBX                                                       62000016
         SPACE 2                                                   000M 62050019
IOBNAME  EQU   IOBERCCW                                                 62100016
IOBAREA  EQU   IOBNAME+8                                                62200016
IOBPARM  EQU   IOBNAME+12                                               62300016
RCOUNT   EQU   IOBWORK+5                                                62350018
         IECTDEBX                                                       62400016
         SPACE 3                                                        62500016
UCBSTART DSECT                                                          62600016
UCBDEVTP EQU   UCBSTART+16                                              62700016
         EJECT                                                   YM4056 62750002
         IKJTCB DSECT=YES,LIST=YES                               YM4056 62760002
         EJECT                                                   YM4056 62770002
CVT      DSECT                                                   YM4056 62780002
         CVT   LIST=NO                                           YM4056 62790002
         END                                                            62800016
./  ADD  SSI=62600012,NAME=IGG019MS
 TITLE 'IGG019MS - BTAM REQUEST/RELEASE BUFFER ROUTINE'                 00009000
IGG019MS CSECT                                                          00018000
         SPACE 2                                                        00027000
*    STATUS         CHANGE LEVEL 001,   JUNE 2, 1967                    00036000
         SPACE 2                                                        00045000
* FUNCTION -                                                            00054000
*                   TO PROVIDE OR RELEASE A BUFFER FROM OR TO           00063000
*                   THE BUFFER POOL ASSOCIATED WITH A DESIGNATED DCB.   00072000
         SPACE 2                                                        00081000
* ENTRY POINT -                                                         00090000
*                   ENTRY IS TO THE 1ST EXECUTABLE INSTRUCTION          00099000
         SPACE 2                                                        00108000
* INPUT -                                                               00117000
*                   REQUEST                                             00126000
*                        REGISTER O CONTAINS THE REQUEST COUNT IN THE   00135000
*                        LEFTMOST BYTE WITH (0) IN THE RIGHT 3  BYTES   00144000
*                                                                       00153000
*                   RELEASE                                             00162000
*                        REGISTER O CONTAINS THE ADDRESS OF THE FIRST   00171000
*                        BUFFER BEING RELEASED BY THE CALLING PROGRAM.  00180000
*                                                                       00189000
*                   REGISTER 1 CONTAINS A POINTER TO THE CURRENT DCB    00198000
         SPACE 2                                                        00207000
* OUTPUT -                                                              00216000
*                   REQUEST                                             00225000
*                        REGISTER 15 WILL CONTAIN THE ADDRESS OF THE    00234000
*                        FIRST REQUESTED BUFFER IN THE THREE RIGHTHAND  00243000
*                        BYTES.                                         00252000
*                                                                       00261000
*                        THE LEFT MOST BYTE WILL CONTAIN -              00270000
*                        0 - IF ALL REQUESTED BUFFERS ARE AVAILABLE.    00279000
*                        4 - IF THE NUMBER OF AVAILABLE BUFFERS         00288000
*                            IS LESS THAN THE REQUESTED NUMBER. THOSE   00297000
*                            AVAILABLE WILL HAVE BEEN PROVIDED.         00306000
*                        8 - IF NO BUFFERS ARE AVAILABLE.               00315000
*                       12 - IF THE BUFFER CONTROL BLOCK ADDRESS IS     00324000
*                            INVALID (THE ADDRESS IS ZERO OR HAS        00333000
*                            IMPROPER BOUNDARY ALIGNMENT).              00342000
*                                                                       00351000
*                                                                       00360000
*                   RELEASE                                             00369000
*                        REGISTER 15 WILL CONTAIN ZEROS IN THE RIGHT    00378000
*                        HAND THREE BYTES.                              00387000
*                                                                       00396000
*                        THE LEFT MOST BYTE WILL CONTAIN -              00405000
*                        0 - IF ALL BUFFERS HAVE BEEN RETURNED.         00414000
*                        8 - IF NO BUFFERS WERE RETURNED BECAUSE THE    00423000
*                            THE FIRST BUFFER IN THE CHAIN HAD BEEN     00432000
*                            RETURNED PREVIOUSLY (IS THE FIRST BUFFER   00441000
*                            ON THE QUEUE OF AVAILABLE BUFFERS).        00450000
*                       12 - IF THE BUFFER CONTROL BLOCK ADDRESS IS     00500000
*                            INVALID (THE ADDRESS IS ZERO OR HAS        00509000
*                            IMPROPER BOUNDARY ALIGNMENT).              00518000
*                       20 - IF THE COUNT OF BUFFERS BEING              00527000
*                            RELEASED IS GREATER THAN THE TOTAL         00536000
*                            BUFFERS OBTAINED OR THE MAX (256)          00545000
*                                                                       00554000
         SPACE 2                                                        00563000
* EXTERNAL -                                                            00572000
*                   NONE                                                00581000
         SPACE 2                                                        00590000
* EXIT -                                                                00599000
*                   RETURN IS TO THE CALLING ROUTINE, THE RETURN        00608000
*                   ADDRESS BEING IN REGISTER 14.                       00617000
         SPACE 2                                                        00626000
* IN-LINE ROUTINES -                                                    00635000
*                   ENTRY IS FOR A REQUEST OR RELEASE OF A BUFFER.      00644000
*                   WHICH ONE IS DETERMINED BY LOOKING AT THE           00653000
*                   INPUT IN REGISTER O, (SEE INPUT ABOVE)              00662000
*                                                                       00671000
*                   RELEASE                                             00680000
*                        BUFFERS ARE RETURNED TO THE BUFFER POOL.       00689000
*                                                                       00698000
*                   REQUEST                                             00707000
*                        BUFFERS ARE ASSIGNED TO THE REQUEST IF THEY    00716000
*                        ARE AVAILABLE.  A COUNT OF THE NUMBER OF       00725000
*                        AVAILABLE BUFFERS IS MAINTAINED IN BUFFER      00734000
*                        CONTROL BLOCK...                               00743000
         SPACE 2                                                        00752000
*********************************************************************** 00761000
*          AZ11413  (05/26/76) IGG019MS MODULE WAS REWRITTEN TO CORRECT 00770000
*                   THE MVS NON-DISABLED PROBLEM OF UPDATING THE BUFFER 00779000
*                   CONTROL BLOCK (ADDRESS OF 1ST AVAIL BUFFER AND THE  00788000
*                   NUMBER OF AVAIL BUFFERS)..........................  00797000
*********************************************************************** 00806000
         EJECT                                                          00815000
*********************************************************************** 00824000
*                                                                       00833000
*         REGISTER AND MISCELLANEOUS EQUATIONS                          00842000
*                                                                       00851000
*********************************************************************** 00860000
         SPACE 2                                                        00869000
ZEROREG  EQU   0                        CNT OR PTR TO BFR PASSED AS PAR 00878000
DCBREG   EQU   1                        PTR TO DATA CONTROL BLOCK       00887000
TCBREG   EQU   2                        PTR TO TCB                      00896000
CNTREG   EQU   4                        WORK REGISTER                   00905000
BCBREG   EQU   5                        PTR TO BUFFER CONTROL BLOCK     00914000
BUFREG   EQU   7                        PTR BUFFER                      00923000
BUF2REG  EQU   8                        PTR TO NEXT BUFFER              00932000
WORKREG  EQU   11                       WORK REGISTER                   00941000
CVTREG   EQU   11                       PTR TO CVT                      00950000
BASEREG  EQU   12                       BASE REGISTER                   01000000
BRREG    EQU   15                       RETRUN DATA TO REQUESTOR        01010000
         SPACE 5                                                        01020000
DEBNMEXT EQU   16                       OFFSET TO NUMBER OF IOB         01030000
DEBUCBAD EQU   32                       OFFSET TO PTR TO UCB ADRS       01040000
DCBBUFCB EQU   20                       OFFSET TO BCB ADRS              01050000
DCBBUFNO EQU   20                       OFFSET TO NO. OF BUFFERS IN BCB 01059000
DCBBFTEK EQU   32                       OFFSET TO BUFFER TECHNIQUE CODE 01068000
DCBDEBAD EQU   44                       OFFSET TO DEB ADDRESS           01077000
DEBTCBAD EQU   0           OFFSET FROM DEB BASIC OF TCB ADDR.           01086000
ZERO     EQU   0                                                        01095000
BCB      EQU   X'03'                                                    01104000
         EJECT                                                          01113000
         USING *,BASEREG                                                01122000
         USING CVTMAP,CVTREG                                            01131000
         USING TCB,TCBREG                                               01140000
         SAVE  (14,12),,*               SAVE REGISTERS                  01149000
         LR    BASEREG,BRREG            LOAD BASE REGISTER              01158000
         SPACE 3                                                        01167000
*        IGG019MS WILL RUN UNDER THE USER'S KEY                         01176000
         SPACE 3                                                        01185000
*********************************************************************** 01194000
*                                                                     * 01203000
* PERFORM BASIC CHECKS ON BUFFER RELEASE/REQUEST. VERIFY THAT BASIC   * 01212000
* REQUEST CAN BE SERVICED UNDER PRESENT BCB CONDITIONS....            * 01221000
*                                                                     * 01230000
*********************************************************************** 01239000
         L     CVTREG,DCBDEBAD(DCBREG)  GET DEB ADDR                    01248000
         L     CVTREG,DEBTCBAD(CVTREG)  GET TCB ADDR                    01257000
         LA    TCBREG,ZERO(CVTREG)      CLEAR HI BYTE                   01266000
         DROP  CVTREG                                                   01275000
         MODESET EXTKEY=TCB,WORKREG=11   GET USER'S KEY                 01284000
         SPACE 3                                                        01293000
         SR    BRREG,BRREG              CLEAR RETURN REG                01302000
         TM    DCBBUFCB+3(DCBREG),BCB   TEST FOR VALID BCB ADDRESS      01311000
         BNZ   NOBCB                    IF NOT VALID BRANCH             01320000
         L     BCBREG,DCBBUFCB(DCBREG)   LOAD PTR TO BUFFER CTRL BLOCK  01329000
         LA    BCBREG,0(BCBREG)         CLEAR HIGH ORDER BYTE.          01338000
         LTR   BCBREG,BCBREG            TEST FOR BUFFER CONTROL BLOCK   01347000
         BZ    NOBCB               ADDRESS OF ZERO.  IF SO, EXIT.       01356000
         LR    BUFREG,ZEROREG           LOAD PTR TO BFR                 01365000
         LA    BUFREG,0(BUFREG)         ZERO OUT LEFT BYTE              01374000
         LTR   BUFREG,BUFREG            TEST BUFFER ADDRESS             01383000
         BZ    BUFREQ                   IF REQUEST                      01392000
         EJECT                                                          01401000
*********************************************************************** 01410000
*                                                                     * 01419000
* REQUEST FOR RELEASING BUFFERS BACK TO POOL. VERIFY BASIC RELEASE    * 01428000
* LIMITATIONS AND PROCEED ....                                        * 01437000
*                                                                     * 01446000
*********************************************************************** 01455000
         SR    ZEROREG,ZEROREG          GET MAX BUFR CNT FROM DCB       01500000
         ICM   ZEROREG,1,DCBBUFNO(DCBREG) ***                           01510000
         LA    CNTREG,1                 DEFAULT TO REL ONE BUFFER       01520000
         LR    BUF2REG,BUFREG           ***                             01530000
         L     WORKREG,0(BUFREG)        NXT BUF ADDR OR END             01540000
CKNXTBUF LA    WORKREG,0(WORKREG)       CLR HI ORDER BYTE               01550000
         ST    WORKREG,0(BUF2REG)       CLR HI ORDER BYTE OF BUFFER     01558000
         LTR   WORKREG,WORKREG          CHK FOR LAST BUFFER             01566000
         BZ    CHNDONE                  REL CHAIN COMPLETE              01574000
         LA    CNTREG,1(CNTREG)         INCR REL BUFR CNTR              01582000
         CR    CNTREG,ZEROREG           CK FOR BUFR LIMIT               01590000
         BNH   INLIMIT                  BUFR CNT WITHIN LIMITS          01600000
         ICM   BRREG,8,INVBUF           INVALID REL CNT ERROR           01610000
         B     EXIT                     RETURN TO REQUESTOR             01620000
INLIMIT  LR    BUF2REG,WORKREG          LOAD NXT BUFR ADDR              01630000
         L     WORKREG,0(BUF2REG)       CK FOR END OF CHAIN             01640000
         B     CKNXTBUF                 CHK INPUT CHAIN                 01650000
CHNDONE  L     WORKREG,0(BCBREG)        GET NXT ADDR FROM BCB           01660000
TRYAGAIN LA    WORKREG,0(WORKREG)       CLR HI ORDER BYTE               01670000
         ST    WORKREG,0(BUF2REG)       SETUP NEW CHAING PTR            01680000
*********************************************************************** 01690000
*                                                                     * 01700000
* THE COMPARE&SWAP WILL UPDATE THE BCB NEXT BUFFER ADDR AREA OR WILL  * 01710000
* CAUSE THE LOGIC TO START THE BCB CHAIN UPDATE OVER...               * 01720000
*                                                                     * 01730000
*********************************************************************** 01740000
         CS    WORKREG,BUFREG,0(BCBREG) UPDATE BCB CHAIN                01750000
         BNE   TRYAGAIN                 BCB ALTERED, RSTRT UPDATE       01760000
*********************************************************************** 01770000
*                                                                     * 01780000
* THE BCB AVAILABLE BUFFER COUNT MUST NOW BE UPDATED TO REFLECT THE   * 01790000
* ADDITIONAL BUFFERS ADDED TO THE CHAIN...                            * 01800000
*                                                                     * 01810000
*********************************************************************** 01820000
         L     WORKREG,4(BCBREG)        GET CURRENT BUFR CNT            01830000
         SLL   CNTREG,16                SETUP TO INCR BCB CNT           01840000
TRYCNTR  LR    BUF2REG,CNTREG           SETUP CNT IN TEMP REG           01850000
         AR    BUF2REG,WORKREG          INCR CNT IN TEMP REG            01860000
*********************************************************************** 01870000
*                                                                     * 01880000
* THE COMPARE&SWAP WILL CAUSE THE LOGIC TO UPDATE THE BCB AVAILABLE   * 01890000
* BUFFER COUNT FIELD OR START THE COUNT UPDATE OVER...                * 01900000
*                                                                     * 01910000
*********************************************************************** 01920000
         CS    WORKREG,BUF2REG,4(BCBREG) UPDATE CNT IN BCB AREA         01930000
         BNE   TRYCNTR                  CNT ALTERED, START AGAIN        01940000
         B     EXIT                     RELEASE COMPLETED, RETURN       01950000
         EJECT                                                          01960000
*********************************************************************** 01970000
*                                                                     * 01980000
* REQUEST TO OBTAIN BUFFERS FROM POOL. VALIDATE THE BASIC REQUEST AND * 01990000
* PROCESS IF VERIFIED...                                              * 02000000
*                                                                     * 02009000
*********************************************************************** 02018000
BUFREQ   LTR   ZEROREG,ZEROREG          ANY BUFFERS REQUESTED           02027000
         BZ    EXITA                    NO, NONE MADE AVAILABLE         02036000
         SRL   ZEROREG,8                SETUP REQ CNT FOR COMPARE       02045000
         L     WORKREG,4(BCBREG)        CHK BCB FOR AVAILABILITY        02054000
         C     WORKREG,GTLNGTH          ***                             02063000
         BNH   EXITA                    NO BUFFERS AVAILABLE            02072000
TRYUPDCT LR    CNTREG,WORKREG           CK REQ CNT AGAINST BCB CNT      02081000
         SR    CNTREG,ZEROREG           ***                             02090000
         BM    NOTENUF                  INSUFFICIENT BUFFERS            02099000
*********************************************************************** 02108000
*                                                                     * 02117000
* THE COMPARE & SWAP WILL ATTEMPT TO UPDATE THE BCB BUFFER COUNT      * 02126000
* FIELD WITH THE NEW COUNT AFTER SERVICING THIS GETBUFFER REQUEST...  * 02135000
*                                                                     * 02144000
*********************************************************************** 02153000
         CS    WORKREG,CNTREG,4(BCBREG) SETUP NEW BCB CNT VALUE         02162000
         BNE   TRYUPDCT                 BCB CNT ALTERED, TRY AGAIN      02171000
         SRL   ZEROREG,16               SETUP REQ CNT AS CONTROL        02180000
TRYUPBFR LR    CNTREG,ZEROREG           SETUP REQ CNT IN CTRL LOOP      02189000
         L     BUFREG,0(BCBREG)         GET FIRST BCB BUFFER ADDR       02198000
         ICM   BRREG,7,1(BCBREG)        PUT BUFR ADDR IN RC REG         02207000
         LR    BUF2REG,BUFREG           DEFAULT TO SINGLE BUFR          02216000
DECRCNTR BCT   CNTREG,NEXTBUFR          LOOP TO GET ALL BUFFERS         02225000
         L     WORKREG,0(BUF2REG)       GET BCB BUFR ADDR FOR C&S       02234000
*********************************************************************** 02243000
*                                                                     * 02252000
* THE COMPARE & SWAP WILL ATTEMP TO REMOVE THE REQUESTED BUFFERS FROM * 02261000
* THE BCB NEXT BUFFER ADDR...                                         * 02270000
*                                                                     * 02279000
*********************************************************************** 02288000
         CS    BUFREG,WORKREG,0(BCBREG) SETUP NEW BCB BUFFER ADDR       02297000
         BNE   TRYUPBFR                 BCB BUFR ALTERED,TRY AGAIN      02306000
         SR    WORKREG,WORKREG          SETUP LAST ADDR IN CHAIN        02315000
         ST    WORKREG,0(BUF2REG)       ***                             02324000
         B     EXIT                     REQUEST SERVICED, RETURN        02333000
NEXTBUFR L     BUF2REG,0(BUF2REG)       CONTINUE ALONG BUFR CHAIN       02342000
         LTR   BUF2REG,BUF2REG          TEST FOR ALL ZEROS IN BUFR PTR  02351000
         BZ    TRYUPBFR                 START OVER                      02360000
         B     DECRCNTR                 ***                             02369000
*********************************************************************** 02378000
*                                                                       02387000
* IF INSUFFICIENT BUFFERS ARE AVAILABLE FOR THIS REQUEST, THE AVAILABLE 02396000
* BUFFERS WILL BE GIVEN TO THE REQUESTOR....                            02405000
*                                                                       02414000
*********************************************************************** 02423000
NOTENUF  SR    BRREG,BRREG              CLEAR RC REG                    02432000
         C     WORKREG,GTLNGTH          ***                             02441000
         BNH   EXITA                    NO BUFFERS AVAILABLE NOW        02450000
         LR    ZEROREG,WORKREG          GET AVAILABLE BUFFER CNT        02459000
         SRL   ZEROREG,16               SETUP FOR BCB CNT ONLY          02500000
         SLL   ZEROREG,16               ***                             02510000
         ICM   BRREG,8,PARTBUF          INDICATE PARTIAL RC             02520000
         B     TRYUPDCT                 ATTEMPT TO UPDATE CNT           02530000
         EJECT                                                          02540000
NOBCB    ICM   BRREG,8,NOBCBLK          NO BUFFER CONTROL BLOCK         02550000
         B     EXIT                     RETURN TO REQUESTOR             02560000
EXITA    ICM   BRREG,8,NOBUFR           CODE NO BUFFER AVAILABLE        02570000
EXIT     EQU   *                                                        02580000
         MODESET EXTKEY=ZERO                                            02590000
         RETURN (2,12)                  RESTORE REGISTERS               02600000
         SPACE 3                                                        02610000
         DC    C'&SYSDATE'                                              02620000
PATCH    DC    20F'0'                                                   02630000
         SPACE 3                                                        02640000
*********************************************************************** 02650000
*                    PROGRAMING CONSTANTS                             * 02660000
*********************************************************************** 02670000
GTLNGTH  DC    X'0000FFFF'              TST FOR BUFR CNT EQ ZERO        02680000
PARTBUF  DC    X'04'                    RC = SOME BUFERS AVAILABLE      02690000
NOBUFR   DC    X'08'                    RC = NO BUFERS AVAILABLE        02700000
NOBCBLK  DC    X'0C'                    RC = INVALID BCB ADDR           02710000
INVBUF   DC    X'14'                    RC FOR INV BUFR REL CNT         02720000
         EJECT                                                          02730000
CVT      DSECT                                                          02740000
         CVT   LIST=YES                                                 02750000
         EJECT                                                          02760000
         IKJTCB DSECT=YES,LIST=YES                                      02770000
         SPACE 5                                                        02780000
         CNOP  0,8                                                      02790000
         END                                                            02800000
./  ADD  SSI=13160079,NAME=IGG019MT
         TITLE 'IGG019MT - IBM 2740 (BASIC) DEVICE I/O MODULE'          00020000
IGG019MT CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    X'FF'                                                    00740000
         DC    X'FF'                                                    00760000
         DC    X'FF'                                                    00780000
         DC    X'FF'                                                    00800000
         DC    X'FF'                                                    00820000
         DC    X'FF'                                                    00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    X'FF'                                                    00880000
         DC    X'FF'                                                    00900000
         DC    X'FF'                                                    00920000
         DC    X'FF'                                                    00940000
         DC    X'FF'                                                    00960000
         DC    X'FF'                                             A27629 00965019
         DC    AL1(WCT-A)               WRITE CONTROL            A27629 00970019
         DC    7X'FF'                                            A27629 00975019
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
RI       DC    X'0406020703'            READ INITIAL               000H 01040018
WI       DC    X'0201048100'            WRITE INITIAL                   01060000
RS       DC    X'0105'                  READ SKIP                       01080000
WCT      DC    X'020809'                WRITE CONTROL            A27629 01090019
         SPACE 3                                                        01100000
*                   C C W 'S               I/O      F L A G S    LENGTH 01120000
*                                       OPERATION CD   CC   SLI    =    01140000
C        DC    X'010C005020210001'      WR C                X      1    01160020
         DC    X'010C005380020010'      WR D IDLE X                16   01180019
         DC    X'0600000060010001'      PREPARE        X    X      1    01200000
         DC    X'0204000020110400'      RD DATA             X      N    01220000
         DC    X'0104000020110400'      WR DATA                         01240000
         DC    X'0200000030220000'      RD SKIP   SK                    01260000
         DC    X'010C005060210001'      WR C           X    X      1    01266020
         DC    X'0448000060040001'      SENSE          X    X      1    01272018
         DC    X'2F00000060010001'      DISABLE        X    X      1    01274019
         DC    X'2700000020240001'      ENABLE              X      1    01276019
         SPACE 2                                                        01280000
         DC    X'1F1F1F'                CIRCLE C'S                      01300000
         DC    X'16'                   CIRCLE D                         01320000
         DC    15X'5E'                 15 IDLE CHARACTERS               01340000
         CNOP  0,8                                                      01360000
         END                                                            01380000
./  ADD  SSI=13160080,NAME=IGG019MU
         TITLE 'IGG019MU - 2740 BASIC WITH DIAL FEATURE'                00020000
IGG019MU CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'          00                                        00680000
         DC    AL1(RI-A)      01        READ INITIAL                    00700000
         DC    AL1(WI-A)      02        WRITE INITIAL                   00720000
         DC    X'FF'         03                                         00740000
         DC    X'FF'         04                                         00760000
         DC    AL1(RV-A)      05        READ CONVERSATIONAL             00780000
         DC    AL1(WV-A)      06        WRITE CONVERSATIONAL            00800000
         DC    X'FF'         07                                         00820000
         DC    X'FF'         08                                         00840000
         DC    AL1(RS-A)      09        READ SKIP                       00860000
         DC    AL1(WN-A)      0A        WR NEG-ACKNOWLEDGE              00880000
         DC    X'FF'         0B                                         00900000
         DC    X'FF'         0C                                         00920000
         DC    X'FF'         0D                                         00940000
         DC    X'FF'         0E                                         00960000
         DC    9X'FF'                                              000B 00970014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 3                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
RI       DC    X'0408070A04820109'      READ INITIAL                    01040000
WI       DC    X'050807020003820109'    WRITE INITIAL                   01060000
RV       DC    X'020A04820109'          READ CONVERSATIONAL             01080000
WV       DC    X'020003820109'          WRITE CONVERSATIONAL            01100000
RS       DC    X'0105'                  READ SKIP                       01120000
WN       DC    X'020109'                WRITE NEG-ACKNOWLEDGE           01140000
         SPACE 3                                                        01160000
*                   C C W 'S               I/O      F L A G S    LENGTH 01180000
*                                       OPERATION CD   CC   SLI     =   01200000
C        DC    X'010C005880020001'      WR D      X              1      01220000
         DC    X'010C005960210001'      WR C           X    X    1      01240000
         DC    X'010C005A6001000F'      WR PAD        X    X   15       01260017
         DC    X'0104000020110400'      WR DATA             X    N      01280000
         DC    X'0204000020110400'      RD DATA             X    N      01300000
         DC    X'0200000030220400'      RD SKIP             X    N      01320000
         DC    X'2700000060010001'      ENABLE         X    X    1      01340000
         DC    X'2910000160010000'      DIAL           X    X    N      01360000
         DC    X'2F20000060010001'      DISABLE        X    X    1      01380000
         DC    X'2F00000020210001'      DISABLE             X    1      01400000
         DC    X'0600000060010001'      PREPARE        X    X    1      01420000
         DC    X'16'                    CIRCLE D                        01440000
         DC    X'1F'                    CIRCLE C                        01460000
         DC    15X'DF'                  PAD CHARACTER                   01480000
         CNOP  0,8                                                      01500000
         END                                                            01520000
./  ADD  SSI=13160081,NAME=IGG019MV
         TITLE 'IBM 2740 DIAL WITH TRANSMIT CTRL AND CHK   IGG019MV'    00020000
IGG019MV CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    AL1(RC-A)                READ CONTINUE                   00740000
         DC    AL1(WC-A)                WRITE CONTINUE                  00760000
         DC    AL1(RV-A)                READ CONVERSATIONAL             00780000
         DC    AL1(WV-A)                WRITE CONVERSATIONAL            00800000
         DC    AL1(RR-A)                READ REPEAT                     00820000
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           00880000
         DC    X'FF'                                                    00900000
         DC    X'FF'                                                    00920000
         DC    X'FF'                                                    00940000
         DC    X'FF'                                                    00960000
         DC    9X'FF'                                              000B 00970014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
RI       DC    X'06090805060B0D82010A'  READ INITIAL                    01040000
WI       DC    X'06090805000F0C82020A'  WRITE INITIAL                   01060016
RC       DC    X'02030E82010A'          READ CONTINUE                   01080000
WC       DC    X'020F0C82020A'          WRITE CONTINUE                  01100000
RV       DC    X'0411060B0D82010A'      READ CONVERSATIONAL             01120000
WV       DC    X'03120F0C82020A'        WRITE CONVERSATIONAL            01140000
RR       DC    X'02040E82010A'          READ REPEAT                     01160000
WA       DC    X'02010A'                WRITE ACKNOWLEDGE               01180000
RS       DC    X'0110'                  READ SKIP                       01200000
WN       DC    X'02020A'                WRITE NEG-ACKNOWLEDGE           01220000
         SPACE 3                                                        01240000
*                   C C W 'S               I/O      F L A G S    LENGTH 01260000
*                                       OPERATION CD   CC   SLI    =    01280000
C        DC    X'010C009880080001'      WR D      X                1    01300000
         DC    X'010C009860210002'      WR D,C         X    X      2    01320000
         DC    X'010C009960210001'      WR C           X    X      1    01340000
         DC    X'010C009C60020001'      WR Y           X    X      1    01360000
         DC    X'010C009D60020001'      WR N           X    X      1    01380000
         DC    X'010C009E6001000F'      WR PAD        X    X   15       01400017
         DC    X'010C00AD60030002'      WR SELECT      X    X      2    01420000
         DC    X'2700000020010001'      ENABLE              X      1    01440000
         DC    X'2910000160010000'      DIAL           X    X      N    01460000
         DC    X'2F20000060010001'      DISABLE        X    X      1    01480000
         DC    X'2F00000020210001'      DISABLE             X      1    01500000
         DC    X'0204000080050002'      RD RESP   X                2    01520000
         DC    X'0208000100200001'      RD RESP                    1    01540000
         DC    X'0204000220110402'      RD DATA             X      N-2  01560000
         DC    X'0204000020110400'      RD DATA             X      N    01580000
         DC    X'0104000060110400'      WR DATA        X    X      N    01600000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01620000
         DC    X'010C009980020003'      WR CCC    X                3    01640000
         DC    X'010C009880020001'     WR D       X                1    01660000
         SPACE 2                                                        01680000
         DC    X'16'                    CIRCLE D                        01700000
         DC    X'1F1F1F'                CIRCLE C                        01720000
         DC    X'76'                    CIRCLE Y                        01740000
         DC    X'40'                    CIRCLE N                        01760000
         DC    15X'DF'                  PAD CHARACTERS                  01780000
         DC    X'230180'                SLASH, SPACE, END OF LIST       01800000
         CNOP  0,8                                                      01820000
         END                                                            01840000
./  ADD  SSI=13160082,NAME=IGG019MW
         TITLE 'IGG019MW - IBM 2740  DIAL AND TRANSMIT CONTROL'         00020000
IGG019MW CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    X'FF'                                                    00740000
         DC    X'FF'                                                    00760000
         DC    AL1(RV-A)                READ CONVERSATIONAL             00780000
         DC    AL1(WV-A)                WRITE CONVERSATIONAL            00800000
         DC    X'FF'                                                    00820000
         DC    X'FF'                                                    00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           00880000
         DC    X'FF'                                                    00900000
         DC    X'FF'                                                    00920000
         DC    X'FF'                                                    00940000
         DC    X'FF'                                                    00960000
         DC    9X'FF'                                              000B 00970014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
         SPACE                                                          01040000
RI       DC    X'06050401020708820006'  READ INITIAL                    01060000
WI       DC    X'050504010B09820006'    WRITE INITIAL                   01080017
RV       DC    X'03020708820006'        READ CONVERSATIONAL             01100000
WV       DC    X'020B09820006'          WRITE CONVERSATIONAL            01120017
RS       DC    X'010A'                  READ SKIP                       01140000
WN       DC    X'020006'                WRITE NEG-ACKNOWLEDGE           01160000
         SPACE 3                                                        01180000
*                   C C W 'S               I/O      F L A G S    LENGTH 01200000
C        DC    X'010C006060210001'     WR C            X    X      1    01220017
         DC    X'010C00616001000F'  WR PAD             X    X     15    01240017
         DC    X'010C007060030002'  WR SELECT          X    X      2    01260017
         DC    X'2700000020010001'      ENABLE              X      1    01300000
         DC    X'2910000160010000'      DIAL           X    X      N    01320000
         DC    X'2F20000060010001'      DISABLE        X    X      1    01340000
         DC    X'2F00000020210001'      DISABLE             X      1    01360000
         DC    X'0204000080050002'      RD RESP   X                2    01380000
         DC    X'0204000220110402'      RD DATA             X      N-2  01400000
         DC    X'0104000020110400'      WR DATA             X      N    01420000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01440000
         DC    X'010C007380080001'  WR D          X                1    01450017
         SPACE 2                                                        01460000
         DC    X'1F'                    CIRCLE C                        01480000
         DC    15X'DF'                  PAD CHARACTERS                  01500000
         DC    X'230180'                SLASH, SPACE, END OF LIST       01520000
         DC    X'16'                   CIRCLE D                         01530017
         CNOP  0,8                                                      01540000
         END                                                            01560000
./  ADD  SSI=13160083,NAME=IGG019MX
         TITLE 'IGG019MX - IBM 2740 DIAL WITH CHECKING'                 00020000
IGG019MX CSECT                                                          00040000
         SPACE 2                                                        00060000
         SPACE 2                                                   000M 00070019
* STATUS -          CHANGE LEVEL  002   FEBURARY 20, 1969          000M 00080019
         SPACE 1                                                   000M 00090019
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    AL1(RC-A)                READ CONTINUE                   00740000
         DC    AL1(WC-A)                WRITE CONTINUE                  00760000
         DC    AL1(RV-A)                READ CONVERSATIONAL             00780000
         DC    AL1(WV-A)                WRITE CONVERSATIONAL            00800000
         DC    AL1(RR-A)                READ REPEAT                     00820000
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           00880000
         DC    4X'FF'                                              000M 00900019
         DC    AL1(WTTV-A)              WRITE CONTINUE CONVERSATION000M 00920019
         DC    8X'FF'                                              000M 00940019
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
RI       DC    X'0408060F0B820109'      READ INITIAL                    01040000
WI       DC    X'06080705000C0A820209'  WRITE INITIAL                   01060000
RC       DC    X'02030B820109'          READ CONTINUE                   01080000
WC       DC    X'020C0A820209'          WRITE CONTINUE                  01100000
RV       DC    X'030E0F0B820109'        READ CONVERSATIONAL             01120000
WV       DC    X'03000C0A820209'        WRITE CONVERSATIONAL            01140000
RR       DC    X'02040B820109'          READ REPEAT                     01160000
WA       DC    X'020109'                WRITE ACKNOWLEDGE               01180000
RS       DC    X'010D'                  READ SKIP                       01200000
WN       DC    X'020209'                WRITE NEG-ACKNOWLEDGE           01220000
WTTV     DC    X'0611120E0F100B'        WRITE CONTINUE CONVERSATION000M 01230019
         SPACE 3                                                        01240000
*                   C C W 'S               I/O      F L A G S    LENGTH 01260000
*                                       OPERATION CD   CC   SLI    =    01280000
C        DC    X'010C009880020001'      WR D      X             1  000M 01300019
         DC    X'010C009860210002'      WR D,C         X    X    2 000M 01320019
         DC    X'010C009960210001'      WR C           X    X    1 000M 01340019
         DC    X'010C009C60020001'      WR Y           X    X    1 000M 01360019
         DC    X'010C009D60020001'      WR N           X    X    1 000M 01380019
         DC    X'010C009E6001000F'      WR PAD        X    X    15 000M 01400019
         DC    X'2700000060010001'      ENABLE         X    X      1    01420000
         DC    X'2910000160010000'      DIAL           X    X      N    01440000
         DC    X'2F00000060010001'      DISABLE        X    X      1    01460000
         DC    X'2F00000020210001'      DISABLE             X      1    01480000
         DC    X'0208000100200001'      RD RESP                    1    01500000
         DC    X'0204000020110400'      RD DATA             X      N    01520000
         DC    X'0104000060110400'      WR DATA             X      N    01540000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01560000
         DC    X'010C009960020001'      WR C           X    X      1    01580020
         DC    X'0600000060010001'      PREPARE        X    X      1    01600000
         DC    X'0448000060050001'      SENSE          X    X      000M 01603019
         DC    X'0138000060110800'      WR DATA             X      000M 01606019
         DC    X'0208000160200001'      RD RESP        X    X    1 000M 01609019
         SPACE 2                                                   000M 01612019
CC       EQU   *-C                      OFFSET TO CONTROL CHARS.   000M 01615019
         SPACE 2                                                        01620000
         DC    X'16'                    CIRCLE D                        01640000
         DC    X'1F1F1F'                CIRCLE C                        01660000
         DC    X'76'                    CIRCLE Y                        01680000
         DC    X'40'                    CIRCLE N                        01700000
         DC    15X'DF'                  PAD CHARACTERS                  01720000
         CNOP  0,8                                                      01740000
         END                                                            01760000
./  ADD  SSI=13160084,NAME=IGG019MY
         TITLE 'IGG019MY - IBM 2740 WITH STN CTRL AND CHECKING'         00020000
IGG019MY CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    AL1(RC-A)                READ CONTINUE                   00740000
         DC    AL1(WC-A)                WRITE CONTINUE                  00760000
         DC    X'FF'                                                    00780000
         DC    X'FF'                                                    00800000
         DC    AL1(RR-A)                READ REPEAT                     00820000
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           00880000
         DC    X'FF'                                                    00900000
         DC    X'FF'                                                    00920000
         DC    X'FF'                                                    00940000
         DC    X'FF'                                                    00960000
         DC    9X'FF'                                              000B 00970014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
RI       DC    X'050208070A0D8101'      READ INITIAL                    01040000
WI       DC    X'070409070B000F0C8103'  WRITE INITIAL                   01060000
RC       DC    X'02050E8101'            READ CONTINUE                   01080000
WC       DC    X'020F0C8103'            WRITE CONTINUE                  01100000
RR       DC    X'02060E8101'            READ REPEAT                     01120000
WA       DC    X'0101'                  WRITE ACKNOWLEDGE               01140000
RS       DC    X'0110'                  READ SKIP                       01160000
WN       DC    X'0103'                  WRITE NOT ACKNOWLEDGE           01180000
         SPACE 3                                                        01200000
*                   C C W 'S               I/O      F L A G S    LENGTH 01220000
*                                       OPERATION CD   C   SLI     =    01240000
C        DC    X'010C008880080001'      WR D      X                1    01260000
         DC    X'010C008820210004'      WR DCCC             X      4    01280000
         DC    X'010C008980020003'      WR CCC    X                3    01300000
         DC    X'010C008920210003'      WR CCC              X      3    01320000
         DC    X'010C008980020004'      WR CCCS   X                4    01340000
         DC    X'010C008D60020001'      WR Y           X    X    1      01360000
         DC    X'010C008E60020001'      WR N           X    X      1    01380000
         DC    X'010C008F60040001'      WR SPACE       X    X      1    01400000
         DC    X'0114040080030001'      WR POLL   X                1    01420000
         DC    X'0114000080030001'      WR ADRS   X                1    01440000
         DC    X'0204000080050002'      RD RESP   X                2    01460000
         DC    X'0208000020060002'      RD RESP             X      2    01480018
         DC    X'0208000100200001'      RD RESP                    1    01500000
         DC    X'0204000220110402'      RD DATA             X      N-2  01520000
         DC    X'0204000020110400'      RD DATA             X      N    01540000
         DC    X'0104000060110400'      WR DATA        X    X      N    01560000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01580000
         SPACE 2                                                        01600000
         DC    X'16'                    CIRCLE D                        01620000
         DC    X'1F1F1F'                CIRCLE C'S                      01640000
         DC    X'37'                    CIRCLE S                        01660000
         DC    X'76'                    CIRCLE Y                        01680000
         DC    X'40'                    CIRCLE N                        01700000
         DC    X'01'                    SPACE                           01720000
         CNOP  0,8                                                      01740000
         END                                                            01760000
./  ADD  SSI=13160085,NAME=IGG019MZ
         TITLE 'IGG019MZ - IBM 2740 (STATION CONTROL)'                  00020000
IGG019MZ CSECT                                                          00040000
         SPACE 2                                                        00060000
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 00080014
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    X'FF'                                                    00740000
         DC    X'FF'                                                    00760000
         DC    X'FF'                                                    00780000
         DC    X'FF'                                                    00800000
         DC    X'FF'                                                    00820000
         DC    X'FF'                                                    00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    X'FF'                                                    00880000
         DC    X'FF'                                                    00900000
         DC    X'FF'                                                    00920000
         DC    X'FF'                                                    00940000
         DC    X'FF'                                                    00960000
         DC    9X'FF'                                              000B 00970014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAM                                     01020000
RI       DC    X'050004030608'          READ INITIAL                    01040000
WI       DC    X'06010503070B098102'    WRITE INITIAL                   01060017
RS       DC    X'010A'                  READ SKIP                       01080000
         SPACE 3                                                        01100000
*                   C C W 'S               I/O      F L A G S    LENGTH 01120000
*                                       OPERATION CD   CC   SLI    =    01140000
C        DC    X'010C006080020003'      WR CCC    X                3    01160017
         DC    X'010C006080020004'      WR CCCS   X                4    01180017
         DC    X'010C006020210003'      WR CCC              X      3    01200017
         DC    X'010C006460040001'      WR SPACE       X    X      1    01220017
         DC    X'0114040080030001'      WR POLL   X                1    01240000
         DC    X'0114000080030001'      WR ADRS   X                1    01260000
         DC    X'0204000080050002'      RD RESP   X                2    01280000
         DC    X'0208000020060002'      RD RESP             X      2    01300018
         DC    X'0204000220110402'      RD DATA             X      N-2  01320000
         DC    X'0104000020110400'      WR DATA             X      N    01340000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01360000
         DC    X'010C006580040001'      WR D      X         X      1    01370018
         SPACE 2                                                        01380000
         DC    X'1F1F1F'                CIRCLE C'S                      01400000
         DC    X'37'                    CIRCLE S                        01420000
         DC    X'01'                    SPACE                           01440000
         DC    X'16'                    CIRCLE D                        01450017
         CNOP  0,8                                                      01460000
         END                                                            01480000
./  ADD  SSI=31320030,NAME=IGG019M0
         TITLE 'IGG019M0 - IBM 2740 (CHECKING)'                         00020000
IGG019M0 CSECT                                                          00040000
* STATUS -          CHANGE LEVEL  002   FEBURARY 20, 1969          000M 00070019
         SPACE                                                          00100000
*FUNCTION -                                                             00120000
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        00180000
*              CHANNEL PROGRAMS.                                        00200000
         SPACE 2                                                        00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     00240014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        00260000
*              OPERATION.                                               00280000
         SPACE 2                                                        00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  00360000
         SPACE 4                                                        00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  00400000
         SPACE                                                          00420000
*                   DC   X'0403050906820008'                            00440000
         SPACE                                                          00460000
*                        04 = COUNT OF CCW'S                            00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  00500000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  00520000
*                             INDICATES RESET)                          00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  00560000
         SPACE 4                                                        00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     00620000
*        AT OPEN TIME.                                                  00640000
         EJECT                                                          00660000
A        DC    X'FF'                                                    00680000
         DC    AL1(RI-A)                READ INITIAL                    00700000
         DC    AL1(WI-A)                WRITE INITIAL                   00720000
         DC    AL1(RC-A)                READ CONTINUE                   00740000
         DC    AL1(WC-A)                WRITE CONTINUE                  00760000
         DC    X'FF'                                                    00780000
         DC    AL1(WV-A)                WRITE CONVERSATIONAL            00800000
         DC    AL1(RR-A)                READ REPEAT                     00820000
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               00840000
         DC    AL1(RS-A)                READ SKIP                       00860000
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           00880000
         DC    4X'FF'                                              000M 00900019
         DC    AL1(WTTV-A)              WRITE CONTINUE CONVERSATION000M 00920019
         DC    AL1(WCT-A)               WRITE CONTROL            A27629 00940019
         DC    4X'FF'                                            A33946 00948020
         DC    AL1(RBK-A)                                        A33946 00956020
         DC    AL1(WBK-A)                                        A33946 00964020
         DC    X'FF'                                             A33946 00972020
         DC    AL1(C-A)                 OFFSET TO CCW'S                 00980000
         DC    7X'FF'                                              000B 00990014
         SPACE 2                                                        01000000
*                   CHANNEL PROGRAMS                                    01020000
RI       DC    X'040B060C088101'        READ INITIAL               000H 01040018
WI       DC    X'030509078102'          WRITE INITIAL                   01060000
RC       DC    X'0203088101'            READ CONTINUE                   01080000
WC       DC    X'0209078102'            WRITE CONTINUE                  01100000
WV       DC    X'030009078102'          WRITE CONVERSATIONAL            01120000
RR       DC    X'0204088101'            READ REPEAT                     01140000
WA       DC    X'0101'                  WRITE ACKNOWLEDGE               01160000
RS       DC    X'010A'                  READ SKIP                       01180000
WN       DC    X'0102'                  WRITE NEG-ACKNOWLEDGE           01200000
WTTV     DC    X'060D0E0B060C08'        WRITE CONTINUE CONVERSATION000M 01206019
WCT      DC    X'020F10'                WRITE CONTROL            A27629 01209019
RBK      DC    X'05110B060C088101'     READ INITIAL BREAK        A33946 01210020
WBK      DC    X'0411120907'           WRITE INITIAL BREAK       A33946 01211020
         SPACE 3                                                   000M 01212019
         SPACE 3                                                        01220000
*                   C C W 'S               I/O      F L A G S    LENGTH 01240000
*                                       OPERATION CD   CC   SLI    =    01260000
C        DC    X'010C00',AL1(D-C)       WR D      X                1    01270020
         DC    X'80020001'                                              01280020
         DC    X'010C00',AL1(D-C)       WR DC               X    A32464 01290020
         DC    X'20210002'                                       A32464 01300020
         DC    X'010C00',AL1(E-C)       WR C                X    A32464 01310020
         DC    X'20210001'                                       A32464 01320020
         DC    X'010C00',AL1(F-C)       WR Y           X    X      1    01330020
         DC    X'60020001'                                              01340020
         DC    X'010C00',AL1(G-C)       WR N           X    X      1    01350020
         DC    X'60020001'                                              01360020
         DC    X'010C00',AL1(H-C)       WR D+IDLE X                16   01370020
         DC    X'80020010'                                              01380020
         DC    X'0600000060010001'      PREPARE        X    X      1    01400000
         DC    X'0208000120200002'      RD RESP             X    A33945 01420020
         DC    X'0204000020110400'      RD DATA             X      N    01440000
         DC    X'0104000060110400'      WR DATA        X    X      N    01460000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    01480000
         DC    X'010C00',AL1(E-C)       WR C           X    X    A32464 01484020
         DC    X'60020001'                                       A32464 01488020
         DC    X'0448000060040001'      SENSE          X    X      1    01492018
         DC    X'0138000060110800'      WR DATA             X      000M 01494019
         DC    X'0208000160200001'      RD RESP        X    X    1 000M 01496019
         DC    X'2F00000060010001'      DISABLE        X    X      1    01497019
         DC    X'2700000020240001'      ENABLE              X      1    01498019
         DC    X'0D0C00',AL1(H+1-C) WR BREAK                    YA01062 01498502
         DC    X'60230004'                                       A49669 01498702
         DC    X'010C00',AL1(E-C)      WR CD+IDLE X              A33946 01499020
         DC    X'80020011'                                       A33946 01499520
         SPACE 2                                                        01500000
F        DC    X'76'                   CIRCLE Y                         01520020
G        DC    X'40'                   CIRCLE N                         01540020
D        DC    X'16'                   CIRCLE D                         01560020
E        DC    X'1F'                   CIRCLE C                         01580020
H        DC    X'16',15X'5E'           CIRCLE D, 15 IDLES               01600020
         CNOP  0,8                                                      01620000
         END                                                            01640000
./  ADD  SSI=70700226,NAME=IGG019M1
         TITLE 'IGG019M1 - 2740 WITH STN CTL, CHECKING AND AUTOPOLL'    01000013
IGG019M1 CSECT                                                          02000013
* STATUS  -             LAST CHANGED           MAY 10,1976              03000000
*********************************************************************** 03600000
*APARS FIXED - AZ10035  (05/10/76)                             @ZA10035 04200000
*********************************************************************** 05000000
*FUNCTION -                                                             06000013
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       07000013
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        08000013
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        09000013
*              CHANNEL PROGRAMS.                                        10000013
         SPACE 2                                                        11000013
*              EACH OF THE FIRST 16 BYTES CONTAINS AN OFFSET TO THE     12000013
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        13000013
*              OPERATION.                                               14000013
         SPACE 2                                                        15000013
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       16000013
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       17000013
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  18000013
         SPACE 4                                                        19000013
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  20000013
         SPACE                                                          21000013
*                   DC   X'0403050906820008'                            22000013
         SPACE                                                          23000013
*                        04 = COUNT OF CCW'S                            24000013
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  25000013
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  26000013
*                             INDICATES RESET)                          27000013
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  28000013
         SPACE 4                                                        29000013
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         30000013
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     31000013
*        AT OPEN TIME.                                                  32000013
         EJECT                                                          33000013
A        DC    X'FF'                                                    34000013
         DC    AL1(RI-A)                READ INITIAL                    35000013
         DC    AL1(WI-A)                WRITE INITIAL                   36000013
         DC    AL1(RC-A)                READ CONTINUE                   37000013
         DC    AL1(WC-A)                WRITE CONTINUE                  38000013
         DC    X'FF'                                                    39000013
         DC    X'FF'                                                    40000013
         DC    AL1(RR-A)                READ REPEAT                     41000013
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               42000013
         DC    AL1(RS-A)                READ SKIP                       43000013
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           44000013
         DC    X'FF'                                                    45000013
         DC    X'FF'                                                    46000013
         DC    X'FF'                                                    47000013
         DC    X'FF'                                                    48000013
         DC    9X'FF'                                              000B 48500014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 49000013
         DC    7X'FF'                                              000B 49500014
         SPACE 2                                                        50000013
*                   CHANNEL PROGRAMS                                    51000013
RI       DC    X'0402080A0D8101'        READ INITIAL                    52000013
WI       DC    X'070409070B000F0C8103'  WRITE INITIAL                   53000013
RC       DC    X'02050E8101'            READ CONTINUE                   54000013
WC       DC    X'020F0C8103'            WRITE CONTINUE                  55000013
RR       DC    X'02060E8101'            READ REPEAT                     56000013
WA       DC    X'0101'                  WRITE ACKNOWLEDGE               57000013
RS       DC    X'0110'                  READ SKIP                       58000013
WN       DC    X'0103'                  WRITE NOT ACKNOWLEDGE           59000013
         SPACE 3                                                        60000013
*                   C C W 'S               I/O      F L A G S    LENGTH 61000013
*                                       OPERATION CD   C   SLI     =    62000013
C        DC    X'010C008880080001'      WR D      X                1    63000013
         DC    X'010C008820210004'      WR DCCC             X      4    64000013
         DC    X'010C008960020003'      WR CCC         X    X      3    65000013
         DC    X'010C008920210003'      WR CCC              X      3    66000013
         DC    X'010C008980020004'      WR CCCS   X                4    67000013
         DC    X'010C008D60020001'      WR Y           X    X    1      68000013
         DC    X'010C008E60020001'      WR N           X    X      1    69000013
         DC    X'010C008F60040001'      WR SPACE       X    X      1    70000013
         DC    X'0924000060030000'      WR POLL        X    X     LIST  71000013
         DC    X'0114000080030001'      WR ADRS   X                1    72000013
         DC    X'02040000800A0002'      RD INDX   X                2    73000013
         DC    X'0208000020060002'      RD RESP             X      2    74000018
         DC    X'0208000100200001'      RD RESP                    1    75000013
         DC    X'0204000220110402'      RD DATA             X      N-2  76000013
         DC    X'02040000201104FF'      RD DATA             X      N    77000000
         DC    X'0104000060110400'      WR DATA        X    X      N    78000013
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    79000013
         SPACE 2                                                        80000013
         DC    X'16'                    CIRCLE D                        81000013
         DC    X'1F1F1F'                CIRCLE C'S                      82000013
         DC    X'37'                    CIRCLE S                        83000013
         DC    X'76'                    CIRCLE Y                        84000013
         DC    X'40'                    CIRCLE N                        85000013
         DC    X'01'                    SPACE                           86000013
         CNOP  0,8                                                      87000013
         DC    CL8'IGG019M1'        EYE CATCHER                         87200000
         DC    CL8'** MVS *'                                            87400000
         DC    CL8'&SYSDATE'      DATE OF LAST ASSEMBLY                 87600000
         END                                                            88000013
./  ADD  SSI=13160088,NAME=IGG019M2
         TITLE 'IGG019M2 - 2740 WITH STN CTL AND AUTOPOLL MODULE'       01000013
IGG019M2 CSECT                                                          02000013
* STATUS -               CHANGE LEVEL  001      AUGUST 3,1967      000B 03000014
         SPACE 2                                                        04000013
         SPACE                                                          05000013
*FUNCTION -                                                             06000013
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       07000013
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        08000013
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        09000013
*              CHANNEL PROGRAMS.                                        10000013
         SPACE 2                                                        11000013
*              EACH OF THE FIRST 16 BYTES CONTAINS AN OFFSET TO THE     12000013
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        13000013
*              OPERATION.                                               14000013
         SPACE 2                                                        15000013
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       16000013
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       17000013
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  18000013
         SPACE 4                                                        19000013
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  20000013
         SPACE                                                          21000013
*                   DC   X'0403050906820008'                            22000013
         SPACE                                                          23000013
*                        04 = COUNT OF CCW'S                            24000013
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  25000013
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  26000013
*                             INDICATES RESET)                          27000013
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  28000013
         SPACE 4                                                        29000013
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         30000013
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     31000013
*        AT OPEN TIME.                                                  32000013
         EJECT                                                          33000013
A        DC    X'FF'                                                    34000013
         DC    AL1(RI-A)                READ INITIAL                    35000013
         DC    AL1(WI-A)                WRITE INITIAL                   36000013
         DC    X'FF'                                                    37000013
         DC    X'FF'                                                    38000013
         DC    X'FF'                                                    39000013
         DC    X'FF'                                                    40000013
         DC    X'FF'                                                    41000013
         DC    X'FF'                                                    42000013
         DC    AL1(RS-A)                READ SKIP                       43000013
         DC    X'FF'                                                    44000013
         DC    X'FF'                                                    45000013
         DC    X'FF'                                                    46000013
         DC    X'FF'                                                    47000013
         DC    X'FF'                                                    48000013
         DC    9X'FF'                                              000B 48500014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 49000013
         DC    7X'FF'                                              000B 49500014
         SPACE 2                                                        50000013
*                   CHANNEL PROGRAM                                     51000013
RI       DC    X'0400040608'            READ INITIAL                    52000013
WI       DC    X'06010503070B098102'    WRITE INITIAL                   53000017
RS       DC    X'010A'                  READ SKIP                       54000013
         SPACE 3                                                        55000013
*                   C C W 'S               I/O      F L A G S    LENGTH 56000013
*                                       OPERATION CD   CC   SLI    =    57000013
C        DC    X'010C006060020003'      WR CCC         X    X      3    58000017
         DC    X'010C006080020004'      WR CCCS   X                4    59000017
         DC    X'010C006020210003'      WR CCC              X      3    60000017
         DC    X'010C006460040001'      WR SPACE       X    X      1    61000017
         DC    X'0924000060030000'      WR POLL        X    X     LIST  62000013
         DC    X'0114000080030001'      WR ADRS   X                1    63000013
         DC    X'02040000800A0002'      RD INDX   X                2    64000013
         DC    X'0208000020060002'      RD RESP             X      2    65000018
         DC    X'0204000220110402'      RD DATA             X      N-2  66000013
         DC    X'0104000020110400'      WR DATA             X      N    67000013
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    68000013
         DC    X'010C006580040001'      WR D      X         X      1    68500018
         SPACE 2                                                        69000013
         DC    X'1F1F1F'                CIRCLE C'S                      70000013
         DC    X'37'                    CIRCLE S                        71000013
         DC    X'01'                    SPACE                           72000013
         DC    X'16'                    CIRCLE D                        72500017
         CNOP  0,8                                                      73000013
         END                                                            74000013
./  ADD  SSI=80270185,NAME=IGG019M3
         TITLE 'IGG019M3 - BTAM 2260 DEVICE I/O MODULE'                 00020000
*********************************************************************** 00040000
*                                                                     * 00050000
* MODULE NAME: IGG019M3  (OS/VS)                                      * 00060000
*                                                                     * 00070000
* DESCRIPTIVE NAME: BTAM 2260 DEVICE I/O MODULE                       * 00072000
*                                                                     * 00074000
* COPYRIGHT: NONE                                                     * 00076000
*                                                                     * 00078000
* STATUS: RELEASE 2                                                   * 00080000
*                                                                     * 00100000
* FUNCTION:    THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE     * 00140000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM      * 00160000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING      * 00180000
*              CHANNEL PROGRAMS.                                      * 00200000
*                                                                     * 00220000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE   * 00240000
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O      * 00260000
*              OPERATION.                                             * 00280000
*                                                                     * 00300000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT     * 00320000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING     * 00340000
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL            * 00360000
*              CHARACTERS.                                            * 00370000
*                                                                     * 00380000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL         * 00400000
*              PROGRAM)                                               * 00410000
*                                                                     * 00420000
*                   DC   X'0403050906820008'                          * 00440000
*                                                                     * 00460000
*                        04 = COUNT OF CCW'S                          * 00480000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE THE CHANNEL    * 00500000
*                             PROGRAM                                 * 00510000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT    * 00520000
*                             = 1 INDICATES RESET)                    * 00540000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL      * 00560000
*                             PROGRAM.                                * 00570000
*                                                                     * 00580000
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS       * 00600000
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN   * 00620000
*        AT OPEN TIME.                                                * 00640000
*                                                                     * 00642000
* CHANGE ACTIVITY AS FOLLOWS:                                         * 00642400
*            APARS                                                    * 00642800
*       YA03258  (1/31/74)                                            * 00643200
*       ZA26706  (10/03/77)                                           * 00643400
*                                                                     * 00643600
*********************************************************************** 00644000
         EJECT                                                          00646000
IGG019M3 CSECT                                                          00650000
A        DC    X'FF'          00                                        00680000
         DC    AL1(RI-A)      01        READ INITIAL                    00700000
         DC    AL1(WI-A)      02        WRITE INITIAL                   00720000
         DC    AL1(RT-A)      03        READ CONTINUE                   00740000
         DC    AL1(WT-A)      04        WRITE CONTINUE                  00760000
         DC    X'FF'          05                                        00780000
         DC    X'FF'          06                                        00800000
         DC    AL1(RP-A)      07        READ REPEAT                     00820000
         DC    AL1(WA-A)      08        WRITE ACKNOWLEDGE               00840000
         DC    AL1(RS-A)      09        READ SKIP                       00860000
         DC    AL1(WN-A)      0A        WRITE NEGATIVE ACKNOWLEDGE      00880000
         DC    AL1(RB-A)      0B        READ BUFFER                     00900000
         DC    AL1(WL-A)      0C        WRITE AT LINE ADDRESS           00920000
         DC    X'FF'          0D                                        00940000
         DC    AL1(WS-A)      0E        WRITE ERASE                     00960000
         DC    9X'FF'                                              000B 00980014
         DC    AL1(C-A)                 OFFSET TO CCW'S                 01000000
         DC    7X'FF'                                              000B 01010014
         SPACE 2                                                        01020000
*                   CHANNEL PROGRAMS                                    01040000
RI       DC    X'05000103080E8112'                                      01060000
WI       DC    X'0700020509130D108112'                           A35729 01080020
RT       DC    X'020A0F8112'                                            01100000
WT       DC    X'03130D108112'                                   A35729 01120020
RP       DC    X'020B0F8112'                                            01140000
WA       DC    X'0112'                                                  01160000
WN       DC    X'0111'                                                  01180000
RB       DC    X'05000104080E8112'                                      01200000
WL       DC    X'0700020609130C108112'                           A35729 01220020
WS       DC    X'0700020709130D108112'                           A35729 01240020
RS       DC    X'0114'                                                  01260000
         SPACE 2                                                        01280000
*                   C C W 'S               I/O      F L A G S    LENGTH 01300000
*                                       OPERATION CD   CC   SLI     =   01320000
C        DC    X'010C00AF80020010'     WR STX,EOTSX            @ZA26706 01340000
         DC    X'0114040080030002'      WR POLLING X              02    01360000
         DC    X'0114000080030002'      WR ADDRESS X               2    01380000
         DC    X'010C00A860040001'      WR CODE RD      X    X    1     01400000
         DC    X'010C00A960040001'      WR CODE RB      X    X    1     01420000
         DC    X'010C00AA60040001'      WR CODE WR      X    X    1     01440000
         DC    X'010C00AB60040001'      WR CODE WL      X    X    1     01460000
         DC    X'010C00AC60040001'      WR CODE WE      X    X    1     01480000
         DC    X'0204000080050002'      RD RESP PL X               2    01500000
         DC    X'0208000040060001'      RD RESP AD      X          1    01520000
         DC    X'010C00AD60020001'      WR ACK          X    X    1     01540000
         DC    X'010C00AE60020001'      WR NAC          X    X    1     01560000
         DC    X'0104000060100400'      WR AT LINE      X    X   LENGTH 01580000
         DC    X'0104000060110400'      WR TEXT         X    X   LENGTH 01600000
         DC    X'0204000220110402'      RD TEXT              X LENGTH-2 01620000
         DC    X'0204000020110400'      RD TEXT              X   LENGTH 01640000
         DC    X'0208000100200001'      RD RESP                    1    01660000
         DC    X'010C00B020210003'      WR EOT'S             X    3     01680000
         DC    X'010C00AF20210004'      WR STX,EOTS          X    4     01700000
         DC    X'010C00AF80080001'      WR STX     X              1     01720000
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG  X   LENGTH 01740000
         SPACE 2                                                        01760000
         DC    X'40'                    CODE FOR READ           00      01780000
         DC    X'50'                    CODE FOR READ BUFF      01      01800000
         DC    X'A0'                    CODE FOR WRITE          02      01820000
         DC    X'B0'                    CODE FOR WRITE LINE     03      01840000
         DC    X'E0'                    CODE FOR WRITE ERASE    04      01860000
         DC    X'06'                    ACK                     05      01880000
         DC    X'15'                    NAC                     06      01900000
         DC    X'02'                    STX                     07      01920000
         DC    15X'04'                 EOT SEQUENCE           08 A26881 01960019
         CNOP  0,8                                                      02000000
         END                                                            02020000
./  ADD  SSI=13160090,NAME=IGG019M4
         TITLE 'IGG019M4 - IBM 1060 WITH AUTOPOLL DEVICE I/O MODULE'    01000013
IGG019M4 CSECT                                                          02000013
* STATUS  -             CHANGE LEVEL   001,    AUGUST 3, 1967      000B 03000014
         SPACE 2                                                        04000013
         SPACE                                                          05000013
*FUNCTION -                                                             06000013
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       07000013
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        08000013
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        09000013
*              CHANNEL PROGRAMS.                                        10000013
         SPACE 2                                                        11000013
*              EACH OF THE FIRST 16 BYTES CONTAINS AN OFFSET TO THE     12000013
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        13000013
*              OPERATION.                                               14000013
         SPACE 2                                                        15000013
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       16000013
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       17000013
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  18000013
         SPACE 4                                                        19000013
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  20000013
         SPACE                                                          21000013
*                   DC   X'0403050906820008'                            22000013
         SPACE                                                          23000013
*                        04 = COUNT OF CCW'S                            24000013
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  25000013
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  26000013
*                             INDICATES RESET)                          27000013
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  28000013
         SPACE 4                                                        29000013
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         30000013
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     31000013
*        AT OPEN TIME.                                                  32000013
         EJECT                                                          33000013
A        DC    X'FF'                                                    34000013
         DC    AL1(RI-A)                READ INITIAL                    35000013
         DC    AL1(WI-A)                WRITE INITIAL                   36000013
         DC    AL1(RC-A)                READ CONTINUE                   37000013
         DC    X'FF'                                                    38000013
         DC    X'FF'                                                    39000013
         DC    X'FF'                                                    40000013
         DC    AL1(RR-A)                READ REPEAT                     41000013
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               42000013
         DC    AL1(RS-A)                READ SKIP                       43000013
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           44000013
         DC    X'FF'                                                    45000013
         DC    X'FF'                                                    46000013
         DC    X'FF'                                                    47000013
         DC    X'FF'                                                    48000013
         DC    9X'FF'                                              000B 48500014
         DC    AL1(C-A)                 OFFSETS TO CCW'S                49000013
         DC    7X'FF'                                              000B 49500014
         SPACE 2                                                        50000013
*                   CHANNEL PROGRAMS                                    51000013
RI       DC    X'040E05070A8102'        READ INITIAL                    52000013
WI       DC    X'060006080D0B098101'    WRITE INITIAL                   53000013
RC       DC    X'040305070A8102'        READ CONTINUE                   54000013
RR       DC    X'040405070A8102'        READ REPEAT                     55000013
WA       DC    X'0102'                  WRITE ACKNOWLEDGE               56000013
RS       DC    X'010C'                  READ SKIP                       57000013
WN       DC    X'0101'                  WRITE NEG-ACKNOWLEDGE           58000013
         SPACE 3                                                        59000013
*                   C C W 'S               I/O      F L A G S    LENGTH 60000013
*                                       OPERATION CD   CC   SLI    =    61000013
C        DC    X'010C007980020003'      WR CCC    X                3    62000013
         DC    X'010C007920210003'      WR CCC              X      3    63000013
         DC    X'010C007C20210004'      WR YCCC             X      4    64000013
         DC    X'010C007C60020004'      WR YCCC        X    X      1    65000013
         DC    X'010C008060020004'      WR NCCC        X    X      4    66000013
         DC    X'0924000060030000'      WR POLL        X    X     LIST  67000013
         DC    X'0114000060030002'      WR ADRS        X    X      2    68000013
         DC    X'02040000800A0002'      RD INDX   X                2    69000013
         DC    X'0208000000060001'      RD RESP                    1    70000013
         DC    X'0208000120200001'      RD RESP             X      1    71000013
         DC    X'0204000220110402'      RD DATA             X      N-2  72000013
         DC    X'0104000060110400'      WR DATA        X    X      N    73000013
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    74000013
         DC    X'010C007880080001'      WR D      X                1    75000013
         DC    X'010C007960020003'      WR CCC         X    X      3    76000013
         SPACE 2                                                        77000013
         DC    X'16'                    CIRCLE D                        78000013
         DC    X'1F1F1F'                CIRCLE C'S                      79000013
         DC    X'761F1F1F'              CIRCLE Y                        80000013
         DC    X'401F1F1F'              CIRCLE N                        81000013
         CNOP  0,8                                                      82000013
         END                                                            83000013
./  ADD  SSI=13160091,NAME=IGG019M5
         TITLE 'IGG019M5 - IBM SYSTEM/360 CPU-CPU CONTENTION'           00900014
IGG019M5 CSECT                                                          01800014
*72390104459000,549000,819000,828000,837000,846000,909000,918000        02200017
         SPACE 2                                                        02700014
* STATUS -          CHANGE LEVEL 001    FEBRUARY 27, 1968               03600017
         SPACE                                                          04500014
* FUNCTION-    THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       05400014
*              DEPENDENT VARIABLE INFORMATION NEEDED BY BTAM            06300014
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        07200014
*              CHANNEL PROGRAMS.                                        08100014
         SPACE 2                                                        09000014
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     09900014
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        10800014
*              OPERATION.                                               11700014
         SPACE 2                                                        12600014
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       13500014
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE.  SPECIAL        14400014
*              CONTROL CHARACTERS ARE LOCATED IN THE FIRST 20 BYTES     15300014
*              OF THE DCB.                                              16200014
         SPACE 4                                                        17100014
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  18000014
         SPACE                                                          18900014
*                   DC   X'0403050906820008'                            19800014
         SPACE                                                          20700014
*                        04 = COUNT OF CCW'S                            21600014
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  22500014
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  23400014
*                             INDICATES RESET)                          24300014
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  25200014
         SPACE 4                                                        26100014
*              THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE.       27000014
*              ITS ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE   27900014
*              BY OPEN AT OPEN TIME.                                    28800014
         EJECT                                                          29700014
A        DC    X'FF'                 00                                 30600014
         DC    AL1(RI-A)             01 READ INITIAL                    31500014
         DC    AL1(WI-A)             02 WRITE INITIAL(R)                32400014
         DC    AL1(RC-A)             03 READ CONTINUE                   33300014
         DC    AL1(WC-A)             04 WRITE CONTINUE(R)               34200014
         DC    X'FF'                 05                                 35100014
         DC    X'FF'                 06                                 36000014
         DC    AL1(RR-A)             07 READ REPEAT                     36900014
         DC    X'FF'                 08                                 37800014
         DC    X'FF'                 09                                 38700014
         DC    AL1(WN-A)             0A WRITE RESET(R)                  39600014
         DC    X'FF'                 0B                                 40500014
         DC    AL1(WIXB-A)           0C WRITE INIT XPARENT BLOCK        41400019
         DC    AL1(WIC-A)            0D WRITE INIT CONV                 42300014
         DC    AL1(WCXB-A)           0E WRITE CONT XPARENT BLOCK        43200019
         DC    AL1(WCC-A)            0F WRITE CONTIN CONV               44100014
         DC    X'FF'                 10                                 45000014
         DC    X'FF'                 11                                 45900018
         DC    AL1(WIX-A)            12 WRITE INIT XPARENT(R)           46800014
         DC    AL1(RCL-A)            13 READ CONT W/ LEAD GRAPH         47700014
         DC    AL1(WCX-A)            14 WRITE CONT XPARENT(R)           48600014
         DC    AL1(RQ-A)             15 READ INQUIRY                    49500014
         DC    AL1(WQ-A)             16 WRITE INQUIRY                   50400014
         DC    AL1(RRL-A)            17 READ REP W/ LEAD GRAPH          51300014
         DC    AL1(C-A)              18 OFFSET TO CCW'S                 52200014
         DC    AL1(RIQ-A)            19 READ INITIAL INQUIRY            53100014
         DC    AL1(WW-A)             1A WRITE WAIT BEFORE XMIT          54000014
         DC    AL1(RVI-A)            1B READ INTERRUPT                  54900017
         DC    X'FF'                 1C                                 55800014
         DC    AL1(WICX-A)           1D WRITE INIT CONV XPRNT           56700014
         DC    X'FF'                 1E                                 57600014
         DC    AL1(WCCX-A)           1F WRITE CONT CONV XPRNT           58500014
         SPACE 2                                                        59400014
*                   CHANNEL PROGRAMS                                    60300014
RI       DC    X'0400060309'            READ INITIAL                    61200014
WI       DC    X'0405070A0E810D'        WRITE INITIAL                   62100014
RC       DC    X'020309'                READ CONTINUE                   63000014
WC       DC    X'020A0E810D'            WRITE CONTINUE                  63900014
RR       DC    X'020409'                READ REPEAT                     64800014
WN       DC    X'010D'                  WRITE RESET                     65700014
RQ       DC    X'0106'                  READ INQUIRY                    66600014
WQ       DC    X'03050F0B'              WRITE INQUIRY            A32454 67500020
RIQ      DC    X'020006'                READ INITIAL INQUIRY            68400014
WIC      DC    X'050507100F0B'          WRITE INITIAL CONVERS           69300014
WCC      DC    X'03100F0B'              WRITE CONTIN CONVERS            70200014
RS       DC    X'021113'                READ STOP                       70600017
WIX      DC    X'0505070A0C0E810D'      WRITE INITIAL XPARENT           71100014
RCL      DC    X'03010309'              READ CONTIN W/LEAD GRAPH        72000014
WCX      DC    X'030A0C0E810D'          WRITE CONTINUE XPARENT          72900014
RRL      DC    X'03010409'              READ REPEAT W/LEAD GRAPH        73800014
WW       DC    X'03020006'              WRITE WAIT BEFORE XMIT          74700014
RVI      DC    X'021109'               READ INTERRUPT              000J 75100018
WICX     DC    X'060507100C0F0B'        WRITE INIT CONV XPARENT         75600014
WCCX     DC    X'04100C0F0B'            WRITE CONTIN CONV XPARENT       76500014
WIXB     DC    X'0505070A120E'          WRITE INIT XPARENT BLOCK        76800019
WCXB     DC    X'030A120E'              WRITE CONT XPARENT BLOCK        77100019
         SPACE 3                                                        77400014
*                   C C W 'S               I/O      F L A G S    LENGTH 78300014
*                                       OPERATION CD   CC   SLI    =    79200014
C        DC    X'0600000060010001'      PREPARE        X    X      1    80100014
         DC    X'013C000080010800'      WR GRAPH  X                N    81000014
         DC    X'0128004E60010002'     WR WACK         X    X      2 0J 81900018
         DC    X'0134004060080002'      WR RESP        X    X      2    82800017
         DC    X'0128004560080001'      WR NAK         X    X      1    83700017
         DC    X'0128004460030001'      WR INQ         X    X      1    84600017
         DC    X'02080000200B0002'      RD INQ              X      2    85500014
         DC    X'02080000200C0002'      RD RESP             X      2    86400014
         DC    X'02080000200C0002'      RD RESP             X      2    87300014
         DC    X'0204000020110400'      RD TXT              X      N    88200014
         DC    X'0104000060110400'      WR TXT         X    X      N    89100014
         DC    X'0204001420110414'      RD TXT              X     N-20  90000014
         DC    X'0128003E60130002'      WR DLEETX      X    X      2    90900017
         DC    X'0128004820210001'      WR EOT              X      1    91800017
         DC    X'0208000020250002'      RD RESP             X      2    92700014
         DC    X'02040000A0250C14'     RD RESP    X         X      200J 93600018
         DC    X'0138000060110800'      WR TXT         X    X      N    94500014
         DC    X'0128005060080002'      WR RVI         X    X      2    94900017
         DC    X'0128004A60130002'      WR DLEETB      X    X      2    95100019
         CNOP  0,8                                                      95400014
         END                                                            96300014
./  ADD  SSI=80800373,NAME=IGG019M6
         TITLE 'IGG019M6 - IBM SYSTEM/360 CPU-CPU SWITCHED'             00700000
IGG019M6 CSECT                                                          01400000
*72420014408000,488000,744000,752000,760000,768000,792000,848000,856000 02100000
         SPACE 2                                                        02800000
* STATUS -          CHANGE LEVEL 001    FEBRUARY 27, 1968               03500000
         SPACE                                                          04200000
* FUNCTION-    THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       04900000
*              DEPENDENT VARIABLE INFORMATION NEEDED BY BTAM            05600000
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        06300000
*              CHANNEL PROGRAMS.                                        07000000
         SPACE 2                                                        07700000
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     08400000
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        09100000
*              OPERATION.                                               09800000
         SPACE 2                                                        10500000
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       11200000
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE.  SPECIAL        11900000
*              CONTROL CHARACTERS ARE LOCATED IN THE FIRST 20 BYTES     12600000
*              OF THE DCB.                                              13300000
         SPACE 4                                                        14000000
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  14700000
         SPACE                                                          15400000
*                   DC   X'0403050906820008'                            16100000
         SPACE                                                          16800000
*                        04 = COUNT OF CCW'S                            17500000
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  18200000
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  18900000
*                             INDICATES RESET)                          19600000
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  20300000
         SPACE 4                                                        21000000
*              THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE.       21700000
*              ITS ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE   22400000
*              BY OPEN AT OPEN TIME.                                    23100000
         EJECT                                                          23800000
A        DC    AL1(WB-A)             00 WRITE DISABLE                   24500000
         DC    AL1(RI-A)             01 READ INITIAL                    25200000
         DC    AL1(WI-A)             02 WRITE INITIAL(R)                25900000
         DC    AL1(RC-A)             03 READ CONTINUE                   26600000
         DC    AL1(WC-A)             04 WRITE CONTINUE(R)               27300000
         DC    X'FF'                 05                                 28000000
         DC    X'FF'                 06                                 28700000
         DC    AL1(RR-A)             07 READ REPEAT                     29400000
         DC    X'FF'                 08                                 30100000
         DC    AL1(RQM-A)            09 READ INQUIRY MONITOR            30800000
         DC    AL1(WN-A)             0A WRITE RESET                     31500000
         DC    AL1(WRM-A)            0B WRITE RESET MONITOR             32200000
         DC    AL1(WIXB-A)           OC WRITE INIT XPARENT BLOCK        32900000
         DC    AL1(WIC-A)            0D WRITE INIT CONV                 33600000
         DC    AL1(WCXB-A)           0E WRITE CONT XPARENT BLOCK        34300000
         DC    AL1(WCC-A)            0F WRITE CONTIN CONV               35000000
         DC    AL1(WD-A)             10 WRITE DISCONNECT                35700000
         DC    AL1(RCON-A)           11 READ CONNECT               000L 36400000
         DC    AL1(WIX-A)            12 WRITE INIT XPARENT(R)           37100000
         DC    AL1(RCL-A)            13 READ CONT W/ LEAD GRAPH         37800000
         DC    AL1(WCX-A)            14 WRITE CONT XPARENT(R)           38500000
         DC    AL1(RQ-A)             15 READ INQUIRY                    39200000
         DC    AL1(WQ-A)             16 WRITE INQUIRY                   39900000
         DC    AL1(RRL-A)            17 READ REP W/ LEAD GRAPH          40600000
         DC    AL1(C-A)              18 OFFSET TO CCW'S                 41300000
         DC    X'FF'                 19                                 42000000
         DC    AL1(WW-A)             1A WRITE WAIT BEFORE XMIT          42700000
         DC    AL1(RVI-A)            1B READ INTERRUPT                  43400000
         DC    AL1(WCON-A)              1C WRITE CONNECT           000H 44100000
         DC    AL1(WICX-A)           1D WRITE INIT CONV XPRNT           44800000
         DC    AL1(RTCW-A)           1E READ CONNECT WITH TONE     000L 45500000
         DC    AL1(WCCX-A)           1F WRITE CONT CONV XPRNT           46200000
         SPACE 2                                                        46900000
*                   CHANNEL PROGRAMS                                    47600000
WB       DC    X'0112'                  WRITE DISABLE                   48300000
RI       DC    X'07010708050A040D'      READ INITIAL                    49000000
         DC    X'0B08070D'              READ INITIAL(ANSWER)            49700000
         DC    X'101708070D'            READ INITIAL(WORLD TRADE)  000H 50400000
WI       DC    X'050107080E13'          WRITE INITIAL                   51100000
RC       DC    X'02040D'                READ CONTINUE                   51800000
WC       DC    X'020E13'                WRITE CONTINUE                  52500000
RR       DC    X'02060D'                READ REPEAT                     53200000
WN       DC    X'021E0A'                WRITE RESET              A33954 53900000
WD       DC    X'021112'                WRITE DISCONNECT                54600000
RS       DC    X'021618'                READ STOP                       55300000
RQ       DC    X'010A'                  READ INQUIRY                    56000000
WQ       DC    X'0309140F'              WRITE INQUIRY            A32454 56700000
WIC      DC    X'0601070815140F'        WRITE INITIAL CONVERS           57400000
WCC      DC    X'0315140F'              WRITE CONTIN CONVERS            58100000
WIX      DC    X'060107080E1013'        WRITE INITIAL XPARENT           58800000
RCL      DC    X'0302040D'              READ CONTIN W/LEAD GRAPH        59500000
WCX      DC    X'030E1013'              WRITE CONTIN                    60200000
RRL      DC    X'0302060D'              READ REPEAT W/LEAD GRAPH        60900000
WW       DC    X'02030A'                WRITE WAIT BEFORE XMIT          61600000
RVI      DC    X'02160D'               READ INTERRUPT              000J 62300000
WICX     DC    X'070107081510140F'      WRITE INIT CONV XPARENT         63000000
WCCX     DC    X'041510140F'            WRITE CONTIN CONV XPARENT       63700000
WCON     DC    X'03180708'              WRITE CONNECT              000H 64400000
         DC    X'061A19'                WRITE CONNECT (SWLST)      000L 65100000
RCON     DC    X'0718191A0D111B1C'      READ CONNECT               000L 65800000
RTCW     DC    X'081817191A0D111B1C'    READ CONNECT WITH TONE     000L 66500000
WIXB     DC    X'060107080E1D13'        WRITE INIT XPARENT BLOCK        67200000
WCXB     DC    X'030E1D13'              WRITE CONT XPARENT BLOCK        67900000
RQM      DC    X'02000A'                READ INQUIRY MONITOR            68600000
WRM      DC    X'031F000A'         WRITE RESET MONITOR         @ZA31078 69300000
         SPACE 3                                                        70000000
*                   C C W 'S               I/O      F L A G S    LENGTH 70700000
*                                       OPERATION CD   CC   SLI    =    71400000
C        DC    X'0600000060010001'      PREPARE        X    X      1    72100000
         DC    X'292C000160010000'      DIAL           X    X      N    72800000
         DC    X'013C000080010800'      WR GRAPH  X                N    73500000
         DC    X'0128004E60010002'     WR WACK         X    X      2 0J 74200000
         DC    X'0134004060080002'      WR RESP        X    X      2    74900000
         DC    X'0128004860080001'      WR EOT         X    X      1    75600000
         DC    X'0128004560080001'      WR NACK        X    X      1    76300000
         DC    X'0130000160030000'      WR IDENT       X    X      N    77000000
         DC    X'0218000120070000'      RD IDENT            X      N    77700000
         DC    X'0128004460030001'      WR INQ         X    X      1    78400000
         DC    X'02080000200B0002'      RD INQ              X      2    79100000
         DC    X'02080000200C0002'      RD RESP             X      2    79800000
         DC    X'02080000200C0002'      RD RESP             X      2    80500000
         DC    X'0204000020110400'      RD TXT              X      N    81200000
         DC    X'0104000060110400'      WR TXT         X    X      N    81900000
         DC    X'0204001420110414'      RD TXT              X     N-20  82600000
         DC    X'0128003E60130002'      WR DLEETX      X    X      2    83300000
         DC    X'0128004760210002'      WR DLEEOT      X    X      2    84000000
         DC    X'2F00000020210001'      DISABLE             X      1    84700000
         DC    X'0208000020250002'      RD RESP             X      2    85400000
         DC    X'02040000A0250C14'     RD RESP    X         X      200J 86100000
         DC    X'0138000060110800'      WR TXT         X    X      N    86800000
         DC    X'0128005060080002'      WR RVI         X    X      2    87500000
         DC    X'014C000060010000'      WRITE TONE     X    X      N    88200000
         DC    X'2700000160010001'      ENABLE         X    X      1    88900000
         DC    X'0258000020070000'      RD ID SEQ           X      N 0L 89600000
         DC    X'015C000060030000'      WR ID SEQ      X    X      N 0L 90300000
         DC    X'2F00000060210001'      DISABLE        X    X      1 0L 91000000
         DC    X'0860000020090001'      TIC                 X      1 0L 91700000
         DC    X'0128004A60130002'      WR DLEETB      X    X      2    92400000
         DC    X'0128004860210001'      WR EOT         X    X      1    93100000
         DC    X'0128004820080001'      WR EOT              X      1    93150000
*                                       ABOVE LINE ADDED BY    @ZA31078 93200000
         CNOP  0,8                                                      93800000
         END                                                            94500000
./  ADD  SSI=73150933,NAME=IGG019PA
         TITLE 'IGG019PA - LOCAL 3270 CE/XCE APPENDAGE '                00200001
IGG019PA CSECT                                                          00400001
*                                                                       00450002
*********************************************************************** 00500002
*                                                                     * 00550002
* C348000,C352000-354000,A356500-357500,C358000,D362000,      LD Y02947 00560002
* D364000,C386000,C394000,C470000,C500000,C506000,A506500,    LD Y02947 00570002
* C520000,C522800,C554000,C562000,C566000,C580600,C592500,    LD Y02947 00580002
* C626000,A658500,D674000,D682000,D700000,D707000-709000,     LD Y02947 00590002
* D710000,D714500,A739500,D744000                             LD Y02947 00592002
* A372500-373700                                             LD YA02143 00592400
* A593500,A730500,A738100                                    LD YA02166 00592800
* A564500-565700,A725500-725100                              LD YA02167 00593200
* D520000-522000,A522720-522792,D522800-522830,C556000,      LD YA02451 00593600
* A586500,C592000,C593000,A593600                            LD YA02451 00593700
* A587000-587500,A694500                                     LD YA02471 00593800
* A386500,D391000-432000,A391000-394500                      LD YA03957 00593900
*        APARS FIXED                                                  * 00594000
*                                                                     * 00594600
*        ZA02332  (11/21/74)                                          * 00596002
*        ZA02342  (12/19/74)                                          * 00596400
*        ZA06371  (11/04/75)                                          * 00597200
*        ZA27950  (11/11/75)                                          * 00597900
*                                                                     * 00598600
*********************************************************************** 00600001
*                   LOCAL 3270 CHANNEL END - ABNORMAL                 * 00800001
*                         END APPENDAGE                               * 01000001
*********************************************************************** 01200001
* STATUS:                                                             * 01400001
*    CHANGE LEVEL 000                                                 * 01600000
*                                                                     * 01800001
* FUNCTION:                                                           * 02000001
*    THIS MODULE WILL BE LOADED BY THE BTAM OPEN EXECUTOR WHEN THE    * 02200001
*    APPLICATION PROGRAM OPENS A LINE GROUP DCB THAT CONTAINS A LOCAL * 02400001
*    3270 DEVICE. THE ENTRY POINT ADDRESS WILL BE PLACED INTO THE DEB * 02600001
*    ASSOCIATED WITH THE LINE GROUP. WHEN IOS IS READY TO DO CHANNEL  * 02800001
*    END OR ABNORMAL CHANNEL END PROCESSING, IT WILL GET THE ADDRESS  * 03000001
*    AND GIVE IT CONTROL.                                             * 03200001
*                                                                     * 03400001
*    THIS MODULE HAS THE FOLLOWING RESPONSIBILITIES:                  * 03600001
*    1) CONTROL BLOCK CLEAN-UP AT THE END OF AN I/O REQUEST INITIATED * 03800001
*    BY THE BTAM READ/WRITE ROUTINE (IGG019MA) FOR THE APPLICATION    * 04000001
*    PROGRAM.                                                         * 04200001
*    2) RETRY CHANNEL PROGRAMS THAT WERE NOT RETRYABLE BY THE LOCAL   * 04400001
*    DEVICE ERP'S (IGE0010E, IGE0110E).                               * 04600001
*    3) RECOGNIZE REQUEST-FOR-TEST MESSAGES AND THE ON-LINE TEST IN   * 05200001
*    PROGRESS CONDITION AND SCHEDULE THE LOCAL ON-LINE TEST CONTROL   * 05400001
*    MODULE (IGG019PI).                                               * 05600001
*    4) RECOGNIZE THE OLTEP EXECUTING CONDITION AND SET THE OLTEP     * 05800001
*    IN CONTROL FLAG.                                                 * 06000001
*                                                                     * 06400001
* ENTRY:                                                              * 06600001
*         TO THE FIRST EXECUTABLE INSTRUCTION.                        * 06800001
*                                                                     * 07000001
* INPUT:                                                              * 07200001
*    REGISTER 1 - ADDRESS OF THE RQE.                                 * 07400001
*    REGISTER 2 - ADDRESS OF THE IOB.                                 * 07600001
*    REGISTER 3 - ADDRESS OF THE DEB.                                 * 07800001
*    REGISTER 4 - ADDRESS OF THE DCB.                                 * 08000001
*    REGISTER 6 - UNIT ADDRESS OF TARGET DEVICE OF I/O REQUEST.       * 08200001
*    REGISTER 7 - ADDRESS OF UCB.                                     * 08400001
*    REGISTER 14 - RETURN ADDRESS TO IOS.                             * 08600001
*    REGISTER 15 - ENTRY POINT ADDRESS.                               * 08800001
*    DECAREA - CONTAINS THE ADDRESS OF THE REQUEST-FOR-TEST MESSAGE   * 09000001
*    IF AN RFT WAS RECEIVED. THE 3270 RFT HAS THE FOLLOWING FORMAT:   * 09200001
*          +++++++++++++++++++++++++++++++++++++  SOH%/STX = HEADER   * 09400001
*          +     +     +     +     +     +     +  XX = TEST MSG NUMBER* 09600001
*    +0    + SOH +  %  +  /  + STX +  X  +  X  +  YY = NUMBER OF TIMES* 09800001
*          +     +     +     +     +     +     +       TEST MSG TO BE * 10000001
*          +++++++++++++++++++++++++++++++++++++       SENT           * 10200001
*          +     +     +     +     +     +     +  N = 3 (# OF CHARS IN* 10400001
*    +6    +  Y  +  Y  +  N  +  C  +  U  +  U  +       ADDRESS)       * 10600001
*          +     +     +     +     +     +     +  CUU = ADDRESS OF    * 10800001
*          +++++++++++++++++++++++++++++++++++++       TARGET DEVICE  * 11000001
*                                                                     * 11200001
* OUTPUT:                                                             * 11400001
*    ALL REGISTERS ARE THE SAME AS WHEN THE CE/XCE APPENDAGE WAS      * 11600001
*    ENTERED.                                                         * 11800001
*                                                                     * 11900001
*    CONTROL BLOCKS:                                                  * 12000001
*    DECCOUNT = RESIDUAL COUNT FROM IOBCSW                            * 12200001
*    DECCSWST = STATUS BITS FROM IOBCSW                               * 12400001
*    DECSENS0 = SENSE INFORMATION FROM IOBSENS0 (IF ABNORMAL CHANNEL  * 12600001
*    AND UNIT CHECK)                                                  * 12800001
*                                                                     * 12900001
*    NORMAL COMPLETION (IOBFLAG1, BITS 2 & 5 OFF) : IOBERRCT =0,      * 13000001
*    BUSY BIT OF IOBINCAM TURNED OFF (IF A READ INITIAL, THE BUSY BIT * 13200001
*    IN EVERY IOB IS TURNED OFF).                                     * 13400001
*                                                                     * 13500001
*    PERMANENT ERROR (IOBFLAG1, BIT 2 OFF AND BIT 5 ON; AND IOBERRCT, * 13600001
*    BYTE 2, BITS 5,6,&7 = 011) : SAME OUTPUT AS NORMAL COMPLETION.   * 13800001
*                                                                     * 14000001
*    USER CORRECTABLE ERROR (IOBFLAG1, BIT 2 OFF AND BIT 5 ON; AND    * 14200001
*    IOBERRCT, BYTE 2, BITS 5,6,&7 = 110) : SAME OUTPUT AS NORMAL     * 14400001
*    COMPLETION.                                                      * 14600001
*                                                                     * 14800001
*    INTERCEPT CONDITION (IOBFLAG1, BIT 5 ON AND IOBECBCC = X'44') :  * 15000001
*    SAME OUTPUT AS NORMAL COMPLETION.                                * 15200001
*                                                                     * 16000001
*    RECONSTRUCTION REQUIRED (IOBFLAG1, BIT 5 ON; AND IOBERRCT, BYTE  * 16200001
*    2, BITS 5,6,&7 = 010) : SAME OUTPUT AS NORMAL COMPLETION.        * 16400001
*                                                                     * 16600001
*    RETRY CHANNEL PROGRAM (IOBFLAG1, BIT 2 ON; AND IOBERRCT, BYTE 2, * 16800001
*    BITS 5,6,&7 = 111) : THE FOLLOWING FIELDS ARE RESET TO ZERO --   * 17000001
*    IOBFLAG1, IOBFLAG2, IOBSENS0, IOBSENS1, IOBFLAG3, IOBCSW.        * 17200001
*    IOBECBCC IS RESET TO X'7F' AND IOBERRCT, BYTE 2, IS SET TO X'05'.* 17400001
*                                                                     * 17600001
*    RETRY FAILURE (IOBFLAG1, BIT 5 ON; AND IOBERRCT, BYTE 2, BITS    * 17800001
*    5,6,&7 = 101) : SAME OUTPUT AS NORMAL COMPLETION.                * 18000001
*                                                                     * 18200001
*    OLTEP EXECUTING (IOBINCAM, BYTE 1 = X'02') : BUSY BIT OF IOB     * 18400001
*    PASSED BY IOS TURNED ON; DECFLAGS, BIT 7 (OLTEP IN CONTROL)      * 18600001
*    TURNED ON.                                                       * 18800001
*                                                                     * 19000001
*    REQUEST FOR TEST (FIRST 3 BYTES OF USER AREA = SOH%/) : CONVERT  * 19200001
*    TO STANDARD OS BTAM RFT --                                       * 19400001
*    +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++    * 19600001
*    +     +     +     +     +     +     +     +     +     +     +    * 19800001
*    + SOH +  %  +  X  +  X  +  Y  +  Y  +  N  +  C  +  U  +  U  +    * 20000001
*    +     +     +     +     +     +     +     +     +     +     +    * 20200001
*    +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++    * 20400001
*    AND SCHEDULE ON-LINE TEST.                                       * 20600001
* PUT ADDR OF RFT IN IOBERINF, AMD SCHEDULE ON-LINE TEST.             * 20800001
*    ON-LINE TEST IN PROGRESS (IOBINCAM, BYTE 1, BIT 7 ON) : SCHEDULE * 21000001
*    ON-LINE TEST.                                                    * 21200001
*                                                                     * 21400001
* EXTERNAL REFERENCES:                                                * 21600001
*         NONE                                                        * 21800001
*                                                                     * 22000001
* EXITS, NORMAL:                                                      * 22200001
*         POST COMPLETE OR ERP REQUIRED - RETURN TO IOS.              * 22400001
*         RETRY CHANNEL PROGRAM - RETURN TO IOS+8.                    * 22600001
*                                                                     * 22800001
* EXITS, ERROR:                                                       * 23000001
*         NONE                                                        * 23200001
*                                                                     * 23400001
* TABLES/WORK AREAS:                                                  * 23600001
*         NONE                                                        * 23800001
*                                                                     * 24000001
* ATTRIBUTES:                                                         * 24200001
*    RESIDENT, ENABLED, AND SERIALLY REUSABLE.                        * 24400001
*                                                                     * 24600001
* CHARACTER CODE DEPENDENCY:                                          * 24800001
*    NONE                                                             * 25000001
*                                                                     * 25200001
*********************************************************************** 25400001
         EJECT                                                          25600001
*/*IGG019PA: CHART*/                                                    25800001
*/* E IGG019PA*/                                                        26000001
*/*LOADECB: D (YES,,NO,RETURN) IS DECB VALID*/                          26050000
*/*DECBOK: P RESIDUAL COUNT INTO DECCOUNT*/                             26200000
*/* P MOVE STATUS BITS INTO DECCSWST*/                                  26400001
*/* D (YES,,NO,TESTXCE) IOB CC X'7E'*/                                  26600000
*/* M (,RETURN) SET IOB EXCEPTION*/                                     26620000
*/*TESTXCE: D (YES,,NO,TESTABNL) IS ONLINE TEST RUNNING*/               26640000
*/* M (,SCHEDOLT) RESET IOB ERROR FLAG AND SCHEDULE OLT CONTROL*/       26660000
*/*TESTABNL: D (YES,,NO,TSTRDTI) IS IT ABNORMAL CHANNEL END*/           26680000
*/* D (YES,,NO,TSTREADY) FIRST ENTRY TO CHE/ABE*/                       26700000
*/* D (NO,TESTIOB,YES,,) UNIT CHECK IN CSW STATUS*/                     26800000
*/* P MOVE SENSE INFO INTO DECSENS0*/                                   27000001
*/*NOTUC: D (NO,,YES,TESTIOB) HAS ERP BEEN ENTERED*/                    27200001
*/* D (YES,,NO,NORETRY) CHANNEL RETRY BY CE/XCE APPENDAGE*/             27400001
*/* M (,TSTRDTI) SET PERMANENT ERROR COMPLETION CODE*/                  27600001
*/*NORETRY: M TURN ON ERP HAS BEEN ENTERED BIT*/                        27800001
*/* R RETURN TO IOS*/                                                   28000001
*/*TESTIOB: D (NO,,YES,TSTRDTI) WAS THE IOB INTERCEPTED*/               28200001
*/* D (YES,,NO,TSTRECON) IS ERROR PERMANENT*/                           28400001
*/* D (YES,,NO,TSTRDTI) OPERATIONAL SIO*/                               28600001
*/* P (,TSTRDTI) SET SIOCC=3 ERROR FLAG*/                               28800001
*/*TSTREADY: D (YES,,NO,RETURN) UNIT CHECK STATUS*/                     28840000
*/* D (YES,,NO,RETURN) INTERVENTION REQUIRED*/                          28880000
*/* D (YES,,NO,RETURN) READYQ AVAILABLE*/                               28920000
*/* P (,RETURN) SET DVC NOT RDY & READYQ*/                              28960000
*/*TSTRECON: D (NO,,YES,RECON) IS RECONSTRUCT REQUIRED*/                29000001
*/* D (YES,,NO,TSTRDTI) SHOULD REQUEST BE RETRIED*/                     29200001
*/* M RESET IOBFLAG1 FIELD TO ZERO*/                                    29400001
*/* M RESET IOBFLAG2 FIELD TO ZERO*/                                    29600001
*/* M RESET IOBFLAG3 FIELD TO ZERO*/                                    29800001
*/* M RESET IOBSENS0 AND IOBSENS1 TO ZERO*/                             30000001
*/* M RESET IOBCSW TO ZERO*/                                            30200001
*/* M SET IOBERRCT TO SHOW CE/XCE RETRY*/                               30400001
*/* M RESET IOBECBCC TO X'7F'*/                                         30600001
*/* R RETURN TO IOS+8*/                                                 30800001
*/* RECON: M SET RECONSTRUCTION REQUIRED FLAG*/                         31000001
*/*TSTRDTI: M RESET IOBERRCT FIELD TO ZERO*/                            31200001
*/* D (NO,,YES,ALLIOBS) WAS COMMAND A READ INITIAL*/                    31400001
*/* P GET ADDR OF MASTER UCB*/                                          31460001
*/* D (NO,,YES,TSTOLTEP) READ INITIAL PENDING ON LINE GROUP*/           31520001
*/* M (,TSTOLTEP) TURN OFF BUSY BIT IN IOB PASSED BY IOS*/              31600001
*/*ALLIOBS: P TURN OFF BUSY BIT IN ALL IOB'S*/                          31800001
*/*TSTOLTEP: D (YES,,NO,TSTOLT) IS OLTEP EXECUTING*/                    32000001
*/* M TURN ON BUSY BIT IN IOB PASSED BY IOS*/                           32200001
*/* M SET OLTEP IN CONTROL FLAG*/                                       32400001
*/*RESTREG: R RETURN TO IOS*/                                           32600001
*/*TSTOLT: D (NO,,YES,SCHEDOLT) IS OLT IN PROGRESS*/                    32800001
*/* D (YES,,NO,RESTREG) SOH%/ MESSAGE*/                                 33000001
*/* P CONVERT TO BTAM RFT*/                                             33200001
*/*SCHEDOLT: P SCHEDULE ON-LINE TEST*/                                  33400001
*/* R RETURN TO IOS+4*/                                                 33600001
*/*IGG019PA: END*/                                                      33800001
         EJECT                                                          34000001
         SPACE 2                                                        34200001
*        ESTABLISH ADDRESSABILITY                                       34400001
         SPACE                                                          34600001
         USING IOBSTDRD,IOBREG                                LD Y02947 34800002
         USING IHADCB,DCBREG                                            35000001
         USING DECB,ECBREG                                    LD Y02947 35200002
         USING DEB,DEBREG                                     LD Y02947 35400002
         USING *,BASEREG                                                35600001
         STM   ZEROREG,BRREG,ZEROREG(SAVEREG)  SAVE REG       LD Y02947 35610000
         LR    BASEREG,BRREG       SET UP BASE REG                      35620000
         B     BEGIN                 BRANCH AROUND ID         LD Y02947 35650000
         DC    AL1(8)                                         LD Y02947 35700002
         DC    CL8'IGG019PA'         MODULE ID                LD Y02947 35750002
         DC    C'  4322'             DATE LAST CHANCHE      LD @ZA02332 35800002
         DC    C' UZ15414'         PTF NUMBER                  @ZA27950 35820000
         DS    0H                                           LD @ZA02332 35830002
PATCH    DC    10F'0'              PATCH AREA                           35850000
         SPACE 2                                                        36600001
BEGIN    DS    0H                                                       36650000
*        ADDRESS CONTROL BLOCKS                                         36800001
         SPACE                                                          37000001
LOADECB  L     ECBREG,IOBECBPT     LOAD ADDR OF DECB                    37200001
         LA    ECBREG,ZERO(ECBREG)  CLEAR HI BYTE              @ZA06371 37210000
         LTR   ECBREG,ECBREG       IOBECBPT ZEROES ?           @ZA06371 37220000
         BZ    RETURN               YES RETURN                 @ZA06371 37230000
         CLI   DECTYPE,ALLON       IS THIS USER'S DECB       LD YA02143 37250000
         BNE   DECBOK              YES, CONTINUE             LD YA02143 37300000
         L     ECBREG,FOUR(ECBREG) NO, GET @ REAL DECB       LD YA02143 37350000
         LA    ECBREG,ZEROS(ECBREG) CLEAR 1ST. BYTE          LD YA02143 37360000
DECBOK   EQU   *                   CONTINUE                  LD YA02143 37370000
         L     DEBREG,28(DEBREG)   LOAD ADDR OF START OF DEB            37400001
         SPACE 2                                                        37600001
*        SAVE RESIDUAL COUNT AND STATUS                                 37800001
         SPACE                                                          38000001
         MVC   DECCOUNT(2),IOBCSW+5 MOVE INTO DECB - RESIDUAL           38100000
         MVC   DECCSWST(2),IOBCSW+3 COUNT AND STATUS BITS OF            38200000
*                                   LAST CCW EXECUTED                   38300001
         CLI   IOBECBCC,X'7E'      IOB COMPLETION CODE A '7E'           38400001
         BNE   TESTXCE             NO , GO CHECK FOR ABNORMAL CE        38500001
         OI    IOBFLAG1,IOBIOERR   TURN ON IOB EXCEPTION      LD Y02947 38600002
         B     RETURN              GO TO ERP'S               LD YA03957 38760002
         SPACE 2                                                        38800001
*        ABNORMAL CHANNEL END                                           39000001
         SPACE 2                                                        39050002
TESTXCE  DS    0H                  CHECK FOR ABNORMAL ENTRY  LD YA03957 39100000
         TM    IOBINCAM,OLT        IS OLT IN PROGRESS       LD @ZA02332 39110002
         BZ    TESTABNL            NO, GO TEST IOB EXCEPT.  LD @ZA02332 39120002
         NI    IOBFLAG1,ALLON-IOBIOERR TURN OFF IOBIOERR... LD @ZA02332 39130002
*                                  ...IF IT IS ON           LD @ZA02332 39140002
         B     SCHEDOLT            BRANCH TO SCHE IGG019PI  LD @ZA02332 39142002
TESTABNL EQU   *                                            LD @ZA02332 39144002
         TM    IOBFLAG1,IOBIOERR   ABNORMAL ENTRY            LD YA03957 39150000
         BNO   TSTRDTI             NO, GOOD COMPLETION       LD YA03957 39200000
         CLI   IOBECBCC,NORMAL     FIRST ENTRY               LD YA03957 39250000
         BE    TSTREADY            YES, SEE IF INT. REQ.       @ZA27950 39300000
         TM    IOBSTBYT,UNITCHK    UNIT CHECK?               LD YA03957 39330000
         BNO   TESTIOB             NO, DON'T UPDATE DECB    LD @ZA02342 39400000
         MVC   DECSENS0(ONE),IOBSENS0 YES, UPDATE DECB       LD YA03957 39450000
         SPACE 2                                                        43400001
*        INTERCEPTED IOB                                                43600001
         SPACE                                                          43800001
TESTIOB  EQU   *                                                        44000001
         CLI   IOBECBCC,INTRCEPT   WAS THE IOB INTERCEPTED              44200001
         BE    TSTRDTI             YES, TEST FOR RD INIT & CONTINUE     44400001
         SPACE 2                                                        44600001
*        TEST FOR PERMANENT ERROR FOUND BY ERP                          44800001
         SPACE                                                          45000001
         TM    IOBERRCT+1,USERCORR IS ERROR USER CORRECTABLE            45200001
         BO    TSTRECON            YES, TEST FOR RECONSTRUCTION         45400001
         TM    IOBERRCT+1,USERETRY IS ERROR PERMANENT OR USER RETRYABLE 45600001
         BNO   TSTRECON            NO, TEST FOR RECONSTRUCTION          45800001
         SPACE 2                                                        46000001
*        TEST FOR OPERATIONAL SIO                                       46200001
         SPACE                                                          46400001
         TM    IOBSIOCC,OPERSIO    TEST FOR OPERATIONAL SIO             46600001
         BNO   TSTRDTI             BRANCH IF OPERATIONAL                46800001
         OI    DECERRST,DECDIAGN   SET SIOCC=3 ERROR FL AG    LD Y02947 47000002
         B     TSTRDTI             GO TEST FOR READ INITIAL             47200001
         SPACE 2                                                        47400001
*        TEST FOR READYQ AND DEVICE NOT READY                  @ZA27950 47410000
         SPACE 2                                                        47420000
TSTREADY TM    IOBSTBYT,UNITCHK    UNIT CHECK STATUS           @ZA27950 47430000
         BZ    RETURN              NO, NORMAL ERP PROCESSING   @ZA27950 47440000
         USING UCB,UCBREG                                               47450000
         CLI   IOBSENS0,INTVREQ    INTERVENTION REQUIRED?      @ZA27950 47460000
         BNE   RETURN              NO, GO TO IOS               @ZA27950 47470000
         TM    DCBRDYQ,DCBRDYIQ    READYQ AVAILABLE            @ZA27950 47480000
         BZ    RETURN              NO, NORMAL ERP PROCESSING   @ZA27950 47490000
         OI    UCBGRAF,UCBDWNR     SET DVC NOT RDY & READYQ    @ZA27950 47500000
         B     RETURN              RETURN TO IOS FOR ERP       @ZA27950 47510000
         SPACE 2                                                        47520000
*        USER CORRECTABLE ERROR - CHECK FOR RECONSTRUCTION OR RETRY     47600001
         SPACE                                                          47800001
TSTRECON EQU   *                                                        48000001
         TM    IOBERRCT+1,NORECON  IS RECONSTRUCTION REQUIRED           48200001
         BNO   RECON               YES, SET RECON REQUIRED BIT          48400001
         TM    IOBERRCT+1,RTRYREQ  SHOULD REQUEST BE RETRIED            48600001
         BM    TSTRDTI             NO, TEST FOR READ INITIAL            48800001
         XC    IOBFLAG1(TOSENS1),IOBFLAG1   RESET IOBFLAG1, IOBFLAG2,   49000001
*                                           IOBSENS0, IOBSENS1 TO ZERO  49200001
         XC    IOBFLAG3(TOCSW),IOBFLAG3     RESET IOBFLAG3, IOBCSW TO 0 49400001
         MVI   IOBFLAG1,IOBCMDCH+IOBUNREL                    LD YA03272 49450000
         MVI   IOBERRCT+1,RETRY    SET IOBERRCT TO SHOW CE/XCE RETRY    49600001
         MVI   IOBECBCC,NORMAL     RESET IOBECBCC TO X'7F'              49800001
         LM    ZEROREG,BRREG,ZEROREG(SAVEREG) RESTORE REGS    LD Y02947 50000002
         B     8(RETREG)           RETURN TO IOS+8                      50200001
RECON    EQU   *                                                        50400001
         MVI   DECERRST,DECDIAGN   SET RECONSTRUCTION         LD Y02947 50600002
*                                      REQUIRED FLAG          LD Y02947 50650002
         SPACE 2                                                        50800001
*        CHECK FOR READ INITIAL - IF SO, TUR OFF ALL BUSY BITS. IF NOT, 51000001
*        TURN OFF BUSY BIT OF IOB PASSED BY IOS                         51200001
         SPACE 2                                                        51400002
TSTRDTI  EQU   *                                                        51600001
         XC    IOBERRCT(2),IOBERRCT RESET IOBERRCT TO ZERO              51800001
         USING UCB,UCBREG               ADDRESSABILITY                  52210001
         CLI   UCBRLN,MASTER       IS UCB MASTER UCB FOR LINE           52220001
         BE    RLNISONE            YES, BRANCH                          52230001
         L     UCBMSTR,UCBCTLNK    GET ADDR OF MASTER UCB               52240001
         B     BSYTST                                                   52250001
RLNISONE LR    UCBMSTR,UCBREG      UCB IS MASTER UCB                    52260001
         USING MSTRUCB,UCBMSTR     ADDRESSABILITY                       52270001
BSYTST   EQU   *                                             LD YA02451 52272000
*                                                                       52274002
*              2 LINES DELETED FOR ----->                   LD @ZA02332 52276002
*                                                                       52278002
         CLI   DECTYPE2,RDTI       IS OPERATION RD INITIAL   LD YA02451 52278800
         BE    TESTRFT             YES, TEST FOR RFT         LD YA02451 52279200
         TM    MTRGCB,RDTIACTV     READ INIT REQ OUTSTANDING?   YA01033 52286001
         BO    TSTOLTEP            YES, LEAVE BUSY BIT ON               52290001
         NI    IOBINCAM,BUSY       TURN OFF BUSY BIT OF IOB PASSED BY   52400001
*                                   IOS                                 52600001
         B     TSTOLTEP            GO TEST FOR OLTEP EXECUTING          52800001
ALLIOBS  L     WREG,DCBIOBAD       GET INITIAL IOB BASE                 53000001
         SR    ICREG,ICREG         CLEAR REG                            53200001
         IC    ICREG,DEBNMEXT      LOOP COUNT                           53400001
         SR    ICSREG,ICSREG       CLEAR REG                            53600001
         IC    ICSREG,DCBEIOBX     = INCREMENT                          53800001
         LA    BRREG,DEBSUCBA-FOUR GET BEGINNING OF UCB LIST  LD Y02947 53900002
NEXTIOB  LA    WREG,0(ICSREG,WREG) GET ADDR OF IOB                      54000001
         LA    BRREG,FOUR(BRREG)                                YA01031 54040001
         L     UCBMSTR,0(BRREG)    GET UCB ADR                  YA01031 54080001
         NI    MTRGCB,ALLON-RDTIACTV   SIGNAL END OF READ INIT  YA01045 54090001
         TM    6(UCBMSTR),X'E0'    OUTSTANDING I/O?             YA01031 54120001
         BNZ   ALLIOBLP                                         YA01031 54160001
         NI    INCAM(WREG),BUSY    TURN OF IOB                          54200001
ALLIOBLP BCT   ICREG,NEXTIOB       GO TO NEXT IOB               YA01031 54400001
         SPACE 2                                                        54600001
*        TEST FOR OLTEP EXECUTING                                       54800001
         SPACE                                                          55000001
TSTOLTEP EQU   *                                                        55200001
         TM    UCBGCB,UCBOLTEP     IS OLTEP EXECUTING         LD Y02947 55400002
         BNO   RESTREG             NO, RETURN                LD YA02451 55600000
         OI    DECFLAGS,DECSTXNQ   TURN ON OLTEP IN CTROL BIT LD Y02947 56200002
RESTREG  EQU   *                                                        56400001
         CLI   DECTYPE2,RDTI       READ INITIAL ?            LD YA02167 56450000
         BE    RETURN              YES, RETURN               LD YA02167 56500000
         MVC   LOCALRLN(ONE,ECBREG),RLN(ECBREG)              LD YA02167 56550000
*                                  MOVE RLN INTO DECPOLPT    LD YA02167 56560000
RETURN   EQU   *                                             LD YA02167 56570000
         LM    ZEROREG,BRREG,ZEROREG(SAVEREG) RESTORE REGS    LD Y02947 56600002
         BR    RETREG              RETURN TO IOS                        56800001
         SPACE 2                                                        57000001
*        TEST FOR RFT                                                   58400001
         SPACE                                                          58600001
TESTRFT  EQU   *                                             LD YA02451 58650000
         TM    IOBECBCC,X20        PERM. ERROR ?             LD YA02471 58700000
         BZ    ALLIOBS             YES, DO NOT CHECK BUFFER  LD YA02471 58750000
         L     WREG,DECAREA        LOAD ADDR OF AREA                    58800001
         CLC   0(3,WREG),SOHMSG    ARE FIRST 3 CHARS SOH%/              59000001
         BNE   ALLIOBS             NO, BRANCH                LD YA02451 59200000
         TM    DCBERROP,DCBERPT    TERMINAL TESTS SPECIFIED?  LD Y02947 59250002
         BZ    ALLIOBS             NO, BRANCH                LD YA02451 59300000
         CLC   DECLNGTH(CNTLNGTH),MINBUFF BUFF LONG ENOUGH   LD YA02166 59350000
         BL    ALLIOBS             NO, BRANCH                LD YA02451 59360000
         MVC   2(10,WREG),4(WREG)  CONVERT TO BTAM RFT                  59400001
         ST    WREG,IOBERINF            SAVE ADDR OF AREA               59500001
         SPACE 2                                                        59600001
*        SCHEDULE ON LINE TEST                                          59800001
         SPACE                                                          60000001
SCHEDOLT EQU   *                                                        60200001
         L     UCBREG,DEBOFLGS     GET ADDR OF PTR TO IRB               60400001
         L     UCBREG,0(UCBREG)    GET OLT IRB ADDR                     60600001
         L     ICREG,96(UCBREG)    LOAD 1ST IQE ADDR                    60800001
         MVC   96(4,UCBREG),0(ICREG) DEQUEUE                            61000001
         XC    0(4,ICREG),0(ICREG) ZERO LINK FIELD                      61200001
         ST    IOBREG,4(ICREG)     STORE IOB ADDR AS PARM               61400001
         LA    ICREG,0(ICREG)      CLEAR HIGH ORDER BYTE                61600001
         LCR   IQEREG,ICREG             COMPLEMENT ADDR & PUT IN REG1   61800001
         L     BRREG,SIXT          LOAD CVT ADDR                        62000001
         L     BRREG,CVT0EF00(BRREG)  LOAD ASYNCH RT ADDR               62200001
         BALR  RETREG,BRREG        LINK TO SCHEDULE ROUTINE             62400001
         LM    ZEROREG,BRREG,ZEROREG(SAVEREG) RESTORE REGS    LD Y02947 62600002
         B     4(RETREG)           RETURN TO IOS+4                      62800001
         SPACE 2                                                        63000001
*        REGISTER EQUATES                                               63200001
         SPACE                                                          63400001
ZERO     EQU   0                                               @ZA06371 63500000
ZEROREG  EQU   0                                                        63600001
RQEREG   EQU   1                   ADDR OF RQE ASSOC WITH I/O REQUEST   63800001
IOBREG   EQU   2                   ADDR OF IOB                          64000001
DEBREG   EQU   3                   ADDR OF DEB                          64200001
DCBREG   EQU   4                   ADDR OF DCB                          64400001
ECBREG   EQU   5                   ECB ADDR                             64600001
UNITADRG EQU   6                   UNIT ADDR OF DVC I/O REQUEST WAS FOR 64800001
UCBREG   EQU   7                   UCB ADDR                             65000001
ICSREG   EQU   8                   WORK REG                             65200001
ICREG    EQU   9                   WORK REGISTER                        65400001
WREG     EQU   10                  WORK REG                             65600001
UCBMSTR  EQU   11                  ADDR OF MASTER UCB                   65700001
BASEREG  EQU   12                  BASE REGISTER                        65800001
SAVEREG  EQU   13                  SAVEAREA REG               LD Y02947 65850002
RETREG   EQU   14                  RETURN ADDR TO IOS                   66000001
BRREG    EQU   15                  ENTRY POINT ADDRESS                  66200001
IQEREG   EQU   1                        ADDR OF IQE                     66300001
         SPACE                                                          66400001
         SPACE                                                          66600001
*        CONTROL BLOCK BIT SETTINGS                                     66800001
         SPACE                                                          67000001
ZEROS    EQU   X'00'               BYTE OF ZEROS                        67200001
ALLON    EQU   X'FF'               BYTE OF ONES                 YA01033 67300001
RECONSTR EQU   X'02'               RECONSTRUCT BUFFER IMAGE BIT         67600001
INTRCEPT EQU   X'44'               COMPLETION CODE - IOB INTERCEPTED    67800001
OPERSIO  EQU   X'30'               OPERATIONAL SIO CODE                 68000001
RETRY    EQU   X'05'               RETRY CHAN PGM SETTING               68400001
ERP      EQU   X'02'               ERP HAS BEEN ENTERED BIT             68600001
ERROR    EQU   X'41'               PERMANENT ERROR COMPLETION CODE      68800001
USERCORR EQU   X'04'               USER CORRECTABLE BIT                 69000001
USERETRY EQU   X'01'               PERMANENT OR USER RETRYABLE          69200001
*                                   ERROR BIT                           69400001
X20      EQU   X'20'               IOB PERM. ERROR BIT       LD YA02471 69450000
NORECON  EQU   X'05'               RECONSTRUCTION NOT REQUIRED SETTING  69600001
RTRYREQ  EQU   X'07'               RETRY CHAN PGM SETTING               69800001
NORMAL   EQU   X'7F'               NORMAL COMPLETION CODE               70200001
RDTI     EQU   X'01'               VALUE OF READ INITIAL                70400001
BUSY     EQU   X'FF'-X'40'         BUSY BIT                             70600001
MASTER   EQU   X'01'               MASTER UCB BIT                       70650002
RDTIACTV EQU   X'08'               READ INIT OUTSTANDING FLG    YA01033 70950001
SIXT     EQU   X'10'               CVT ADDR                             71200001
OLT      EQU   X'01'               OLT IN PROGRESS BIT                  71400001
*                                  IE. TERM TESTS SPECIFIED     YA00811 71500001
UNITCHK  EQU   X'02'               UNIT CHECK BIT            LD YA03957 71550000
INTVREQ  EQU   X'40'               INTERVENTION REQUIRED       @ZA27950 71570000
         SPACE                                                          71600001
         SPACE                                                          71800001
*        DISPLACEMENTS EQUATES                                          72000001
         SPACE                                                          72200001
TOSENS1  EQU   4                   LENGTH OF ZERO-OUT FOR RETRY         72400001
FOUR     EQU   4                   DISP INTO IOS                YA01031 72500001
ONE      EQU   1                                             LD YA02167 72550000
LOCALRLN EQU   39                  DSP OF DECPOLPT LOCAL RLN LD YA02167 72560000
RLN      EQU   25                  DSP OF DECB RLN FIELD     LD YA02167 72570000
TOCSW    EQU   8                   LENGTH OF ZERO-OUT                   72600001
INCAM    EQU   28                  DISP OF IOBINCAM                     72800001
CVT0EF00 EQU   4                   OFFSET TO ASYNCH SCHEDULER           73000001
CNTLNGTH EQU   2                                             LD YA02166 73050000
         SPACE 2                                                        73200001
*        STORAGE                                                        73400002
         SPACE                                                          73600001
SOHMSG   DC    X'016C61'           SOH HEADER SEQUENCE                  73800001
MINBUFF  DC    X'012C'             MIN BUFF LENGTH FOR RFT   LD YA02166 73810000
         EJECT                                                          73850002
         DCBD DSORG=BX,DEVD=BS                                          73950002
         EJECT                                                          73960002
         IEZDEB LIST=YES                                                73980002
         EJECT                                                          73990002
         IHADECB                                                        73994002
         EJECT                                                          73994402
         IEZIOB                                                         73998002
         EJECT                                                          73998402
UCB      DSECT                                                          73998802
         IEFUCBOB LIST=YES                                              73999202
         EJECT                                                          74000002
MSTRUCB  DSECT                                                          74050002
         ORG   MSTRUCB+24                                               74100002
         DS    H                                                        74150002
MTRATNCT DS    X                                                        74200002
MTRGCB   DS    X                                                        74250002
         DS    2F                                                       74300002
MTRRLN   DS    X                                                        74350002
         SPACE 5                                                        74400002
         END                                                            74800001
./  ADD  SSI=13160093,NAME=IGG019PB
         TITLE 'IGG019PB - BTAM WTTA DEVICE I/O MODULE'                 01000017
IGG019PB CSECT                                                          02000017
         SPACE 2                                                        03000017
* STATUS -          CHANGE LEVEL 000    MAY 10, 1968                    04000017
         SPACE                                                          05000017
*FUNCTION -                                                             06000017
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       07000017
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        08000017
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        09000017
*              CHANNEL PROGRAMS.                                        10000017
         SPACE 2                                                        11000017
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     12000017
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        13000017
*              OPERATION.                                               14000017
         SPACE 2                                                        15000017
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       16000017
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       17000017
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  18000017
         SPACE 4                                                        19000017
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  20000017
         SPACE                                                          21000017
*                   DC   X'0403050906820008'                            22000017
         SPACE                                                          23000017
*                        04 = COUNT OF CCW'S                            24000017
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  25000017
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  26000017
*                             INDICATES RESET)                          27000017
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  28000017
         SPACE 4                                                        29000017
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         30000017
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     31000017
*        AT OPEN TIME.                                                  32000017
         EJECT                                                          33000017
A        DC    X'FF'          00                                        34000017
         DC    AL1(RI-A)      01        READ INITIAL                    35000017
         DC    AL1(WI-A)      02        WRITE INITIAL                   36000017
         DC    AL1(RC-A)      03        READ CONTINUE                   37000017
         DC    AL1(WC-A)      04        WRITE CONTINUE                  38000017
         DC    X'FF'          05                                        39000017
         DC    X'FF'          06                                        40000017
         DC    AL1(RCE-A)     07        READ CONTINUE WITH              41000017
*                                       IDENTIFICATION EXCHANGE         42000017
         DC    X'FF'          08                                        43000017
         DC    X'FF'          09                                        44000017
         DC    X'FF'          0A                                        45000017
         DC    X'FF'          0B                                        46000017
         DC    X'FF'          0C                                        47000017
         DC    X'FF'          0D                                        48000017
         DC    X'FF'          0E                                        49000017
         DC    9X'FF'                                                   50000017
         DC    AL1(C-A)                 OFFSET TO CCW'S                 51000017
         DC    7X'FF'                                                   52000017
         SPACE 2                                                        53000017
*                   CHANNEL PROGRAMS                                    54000017
RI       DC    X'03000102'                                              55000017
WI       DC    X'03030607'                                              56000017
RC       DC    X'0102'                                                  57000017
WC       DC    X'020307'                                                58000017
RCE      DC    X'050304050802'                                          59000017
         SPACE 2                                                        60000017
*                   C C W 'S               I/O      F L A G S    LENGTH 61000017
*                                       OPERATION CD   CC   SLI     =   62000017
C        DC    X'060C004860010001' PREPARE              X     X      1  63000017
         DC    X'0448000060010001' SENSE                X     X      1  64000017
         DC    X'0204000020110400' READ TEXT                  X LENGTH  65000017
         DC    X'0144004860040C01' WRITE PADS CHAR.     X     X    1+M  66000017
         DC    X'0144000160040000' WRITE CPU ID.   X          X LENGTH  67000017
         DC    X'0144006960040001' WRITE WRU            X     X      1  68000017
         DC    X'010C005DA004000C' WRITE LETTERS   X          X     12  69000017
         DC    X'0104000020110400' WRITE TEXT                 X LENGTH  70000017
         DC    X'0244000120070000' READ TERM. ID.             X LENGTH  71000017
         SPACE 2                                                        72000017
         DC    X'1F'                    PAD CHARACTER                   73000017
         DC    20X'DF'                  MARK CHARACTERS                 74000017
         DC    12X'1F'                  PAD CHARACTERS                  75000017
         DC    X'32'                    WRU (OR FIG D)                  76000017
         CNOP  0,8                                                      77000017
         END                                                            78000017
./  ADD  SSI=13160094,NAME=IGG019PC
         TITLE 'IGG019PC - S/360 MOD 20  DEVICE I/O'                    00800017
IGG019PC CSECT                                                          01600017
         SPACE 2                                                        02400017
* STATUS -         CHANGE LEVEL 000    FEBRUARY 27, 1968                03200017
         SPACE                                                          04000017
* FUNCTION-    THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       04800017
*              DEPENDENT VARIABLE INFORMATION NEEDED BY BTAM            05600017
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        06400017
*              CHANNEL PROGRAMS.                                        07200017
         SPACE 2                                                        08000017
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     08800017
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        09600017
*              OPERATION.                                               10400017
         SPACE 2                                                        11200017
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       12000017
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE.  SPECIAL        12800017
*              CONTROL CHARACTERS ARE LOCATED IN THE FIRST 20 BYTES     13600017
*              OF THE DCB.                                              14400017
         SPACE 4                                                        15200017
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  16000017
         SPACE                                                          16800017
*                   DC   X'0403050906820008'                            17600017
         SPACE                                                          18400017
*                        04 = COUNT OF CCW'S                            19200017
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  20000017
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  20800017
*                             INDICATES RESET)                          21600017
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  22400017
         SPACE 4                                                        23200017
*              THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE.       24000017
*              ITS ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE   24800017
*              BY OPEN AT OPEN TIME.                                    25600017
         EJECT                                                          26400017
A        DC    X'FF'                 00                                 27200017
         DC    AL1(RI-A)             01 READ INITIAL                    28000017
         DC    AL1(WI-A)             02 WRITE INITIAL                   28800017
         DC    AL1(RC-A)             03 READ CONTINUE                   29600017
         DC    AL1(WC-A)             04 WRITE CONTINUE                  30400017
         DC    X'FF'                 05                                 31200017
         DC    X'FF'                 06                                 32000017
         DC    AL1(RR-A)             07 READ REPEAT                     32800017
         DC    X'FF'                 08                                 33600017
         DC    X'FF'                 09                                 34400017
         DC    AL1(WN-A)             0A WRITE RESET                     35200017
         DC    X'FF'                 0B                                 36000017
         DC    AL1(WIXB-A)           0C WRITE INIT XPARENT BLOCK        36800019
         DC    AL1(WIC-A)            0D WRITE INIT CONV                 37600017
         DC    AL1(WCXB-A)           0E WRITE CONT XPARENT BLOCK        38400019
         DC    AL1(WCC-A)            0F WRITE CONTIN CONV               39200017
         DC    X'FF'                 10                                 40000017
         DC    X'FF'                 11                                 40800018
         DC    AL1(WIX-A)            12 WRITE INIT XPARENT              41600017
         DC    AL1(RCL-A)            13 READ CONT W/ LEAD GRAPH         42400017
         DC    AL1(WCX-A)            14 WRITE CONTIN XPARENT            43200017
         DC    AL1(RQ-A)             15 READ INQUIRY                    44000017
         DC    AL1(WQ-A)             16 WRITE INQUIRY                   44800017
         DC    AL1(RRL-A)               17 READ REPEAT W/ LEAD GRAPH    45600018
         DC    AL1(C-A)              18 OFFSET TO CCW'S                 46400017
         DC    X'FF'                 19                                 47200017
         DC    AL1(WW-A)             1A WRITE WAIT BEFORE XMIT          48000017
         DC    AL1(RVI-A)            1B READ INTERRUPT                  48800017
         DC    X'FF'                 1C                                 49600017
         DC    AL1(WICX-A)           1D WRITE INIT CONV XPRNT           50400017
         DC    X'FF'                 1E                                 51200017
         DC    AL1(WCCX-A)           1F WRITE CONT CONV XPRNT           52000017
         SPACE 2                                                        52800017
*                   CHANNEL PROGRAMS                                    53600017
RI       DC    X'0400010203'            READ INITIAL                    54400017
WI       DC    X'0504050607088109'      WRITE INITIAL                   55200017
RC       DC    X'020A0B'                READ CONTINUE                   56000017
WC       DC    X'0207088109'            WRITE CONTINUE                  56800017
RR       DC    X'020C0B'                READ REPEAT                     57600017
WN       DC    X'0109'                  WRITE RESET                     58400017
WIC      DC    X'060405060D0E0F'        WRITE INITIAL CONVERS           59200017
WCC      DC    X'030D0E0F'              WRITE CONTIN CONVERS            60000017
WIX      DC    X'060405060710088109'    WRITE INITIAL XPARENT           61600017
RCL      DC    X'03120A0B'             READ CONTIN W/ LEAD GRAPG   000J 62400018
WCX      DC    X'030710088109'          WRITE CONTINUE XPARENT          63200017
RQ       DC    X'0113'                 READ INQUIRY                000J 64000018
WQ       DC    X'03140E0F'              WRITE INQUIRY            A32454 64800020
WW       DC    X'021513'               WRITE WAIT BEFORE XMIT      000J 65600018
RVI      DC    X'02110B'               READ INTERRUPT              000J 66400018
WICX     DC    X'070405060D100E0F8109'  WRITE INIT CONV XPARENT         67200017
WCCX     DC    X'040D100E0F'            WRITE CONTIN CONV XPARENT       68000017
WIXB     DC    X'06040506071608'        WRITE INIT XPARENT BLOCK        68100019
WCXB     DC    X'03071608'              WRITE CONT XPARENT BLOCK        68200019
RRL      DC    X'03120C0B'              READ REPEAT W/ LEAD GRAPH       68400018
         SPACE 3                                                        68800017
*                   C C W 'S               I/O      F L A G S    LENGTH 69600017
*                                       OPERATION CD   CC   SLI    =    70400017
C        DC    X'0928004860020001'     WR EOT          X    X      1 0J 71200018
         DC    X'0924000060030001'      POLL           X    X     M2642 72000019
         DC    X'02040000800A0002'      RD INDX   X                2    72800017
         DC    X'0204000220110402'      RD TXT              X     N-2   73600017
         DC    X'0128004860020001'     WR EOT          X    X      1 0J 74400018
         DC    X'0114000060030000'      WR ADRS        X    X      N    75200017
         DC    X'0240000020060002'      RD RESP             X      2    76000017
         DC    X'0104000060110400'      WR TXT         X    X      N    76800017
         DC    X'0208000020250002'      RD RESP             X      2    77600017
         DC    X'0128004820210001'      WR EOT              X      1    78400018
         DC    X'0134004060080002'      WR RESP        X    X      2    79200018
         DC    X'0204000020110400'      RD TXT              X      N    80000017
         DC    X'0128004560080001'      WR NACK        X    X      1    80800017
         DC    X'0138000060110800'      WR TXT         X    X      N    81600017
         DC    X'02040000A0250C14'      RD RESP   X         X      20   82400020
         DC    X'0204001420110414'      RD TXT              X     N-20  83200017
         DC    X'0128003E60130002'      WR DLEETX      X    X      2    84000017
         DC    X'0128005060080002'      WR RVI         X    X      2    85600017
         DC    X'013C000080010800'      WR GRAPH  X                N    87200017
         DC    X'02080000200B0002'      RD INQ              X      2    88000017
         DC    X'0128004460030001'      WR INQ         X    X      1    88800017
         DC    X'0128004E60010002'     WR WACK         X    X      2 0J 89600018
         DC    X'0128004A60130002'      WR DLEETB      X    X      2    90000019
         CNOP  0,8                                                      90400017
         END                                                            91200017
./  ADD  SSI=80310155,NAME=IGG019PD
         TITLE 'IGG019PD - CHANNEL END/ABNORMAL END APPENDAGE WTTA'     00200017
IGG019PD CSECT                                                          00400017
         SPACE 2                                                        00600017
* STATUS -          CHANGE LEVEL VS2/R3    OCT  1974                    00800003
         SPACE 2                                                        01000017
* FUNCTION -        SERVICE BTAM DEPENDENT WTTA I/O INTERRUPTS          01200017
*                   AND PCI INTERRUPTIONS.                              01400017
*                        1. GIVE CONTROL TO THE PCI APPENDAGE           01600017
*                        2. PROCESS THE LAST CHARACTER OF THE           01800017
*                           MESSAGE AND GIVE CONTROL TO THE             02000017
*                           NORMAL CHANNEL END APPENDAGE.               02200017
*                        3. PROVIDE CHANNEL PROGRAM RESTARTS            02400017
         SPACE 2                                                        02600017
* ENTRY POINT -     ENTRY IS TO 1ST EXECUTABLE INSTRUCTION FROM IOS     02800017
         SPACE 2                                                        03000017
* INPUT -           REGISTER  2 - ADDRESS OF THE IOB                    03200017
*                   REGISTER  4 - ADDRESS OF THE DCB                    03400017
*                   REGISTER  7 - ADDRESS OF THE UCB                    03600017
*                   REGISTER 14 - RETURN ADDRESS                        03800017
         SPACE 2                                                        04000017
* OUTPUT -          1.  GIVE CONTROL TO THE PCI APPENDAGE               04200017
*                   2.  GIVE CONTROL TO THE NORMAL CHANNEL END APP.     04400017
*                   3.  CHANNEL PROGRAM RESTARTS                        04600017
         SPACE 2                                                        04800017
* EXTERNAL ROUTINES                                                     05000017
*                   NONE                                                05200017
         SPACE 2                                                        05400017
* EXIT -            RETURN TO IOS VIA REGISTER 14 + 8 FOR RESTART OF CP 05600017
*                                                 + 0 WHEN THERE IS PCI 05800017
*                   INTERRUPT WITH SPECIAL CONDITIONS                   06000017
*                   GIVE CONTROL TO THE NORMAL CE APPENDAGE             06200017
*                   GIVE CONTROL TO THE PCI APPENDAGE                   06400017
         SPACE 2                                                        06600017
* IN LINE ROUTINES -THE TP OP CODE IS USED AS AN INDEX TO BRANCH TO     06800017
*                        THE APPROPRIATE ROUTINE WITHIN THE CHANNEL     07000017
*                        END APPENDAGE. THE SEQUENCE OF PROCESSING      07200017
*                        IS INITIALIZATION AND CHECKING FOR ANY         07400017
*                        ERRORS, TP OP CODE ROUTINE, AND THEN EXITING.  07600017
*                        THE VARIOUS ROUTINES ARE -                     07800017
*                        1. TP01 - A PREPARE COMMAND HAS BEEN HALTED    08000017
*                            BY A HALT I/O AS A RESULT OF A RESETPL     08200017
*                            MACRO INSTRUCTION.                         08400017
*                        2. HIOREAD - A READ COMMAND HAS BEEN HALTED    08600017
*                            BY A HALT I/O AS A RESULT OF A RESETPL     08800017
*                            MACRO INSTRUCTION.                         09000017
*                        3. TP07 - THE RECEIVED AND EXPECTED TERMINAL   09200017
*                            IDENTIFICATION ARE COMPARED.               09400017
*                            IF THE COMPARISON IS CORRECT, THE NEXT     09600017
*                            READ CCW IS STARTED, OTHERWISE THE OPERA-  09800017
*                            TION IS STOPPED AND THE CONTROL WILL       10000017
*                            RETURN TO THE USER.                        10200017
*                        4. TP11 - A MESSAGE HAS BEEN RECEIVED OR SENT  10400017
*                        5. TPXX - CONTROL IS GIVEN TO THE NORMAL       10600017
*                            CHANNEL END APPENDAGE.                     10800017
         SPACE 2                                                        11000017
* ATTRIBUTES -      THIS ROUTINE IS REENTRANT, ENABLED, RUNS IN         11200002
*                   SUPERVISOR STATE WITH THE LOCAL LOCK HELD           11250002
*                   BY IOS.                                             11300002
*                                                                       11350000
*                                                                       11360000
* CHANGE ACTIVITY                                                       11370000
*                                                                       11380000
*        ZA00533  (10/21/74)                                            11390000
*        ZA05411  (10/09/75)                                            11391000
*        ZA26199  (01/03/78)                                            11391200
*        ZA26279  (01/03/78)                                            11391400
*                                                                       11391600
*                                                                       11392000
         EJECT                                                          11400017
IOBREG   EQU   2                        INPUT/OUTPUT BLOCK ADDRESS      11600017
SAVE13   EQU   3                        REG 13 SAVE              YM4055 11650002
DCBREG   EQU   4                        DATA CONTROL BLOCK ADDRESS      11800017
UCBREG   EQU   7                        UNIT CONTROL BLOCK ADDRESS      12000017
WREG     EQU   8                        ADDRESS WORK REGISTER           12200017
W2REG    EQU   9                        ADDRESS WORK REGISTER           12400017
ECBREG   EQU   10                       EVENT CONTROL BLOCK ADDRESS     12600017
ICREG    EQU   11                       ADDRESS WORK REGISTER           12800017
BASEREG  EQU   12                       BASE REGISTER                   13000017
CCWREG   EQU   13                       CHANNEL COMMAND WORD ADDRESS    13200017
SAVEREG  EQU   13                       SAVE AREA ADDRESS        YM4055 13250002
RETREG   EQU   14                       RETURN ADDRESS                  13400017
BRREG    EQU   15                       ENTRY POINT ADDRESS             13600017
         USING IECTDECB,ECBREG                                          13800017
         USING IECTIOB,IOBREG                                           14000017
         USING IHADCB,DCBREG                                            14200017
         USING *,BASEREG                                                14400017
         STM   RETREG,W2REG,DISP0(SAVEREG) SAVE REGISTERS        YM4055 14600002
         LR    BASEREG,BRREG            LOAD BASE REGISTER     @ZA05411 14620000
         B     AROUND0             BRANCH AROUND ADCONS     LD @ZA00533 14700003
         DS    0F                  FULL WORD ALIGNMENT      LD @ZA00533 14750003
*                                                                       14800003
*        THE FOLLOWING TWO ADCONS MUST REMAIN AT OFFSETS X'0C' AND      14850003
*        X'10' SINCE BTAM OPEN (IGG0193S) MOVES IN THE ADDRESSES OF     14900003
*        THE PCI APPN AND THE CE APPN.                                  14950003
*                                                                       14960003
MCPCIAPP DC    A(0)                     PCI APPENDAGE ADDRESS           15000017
MBENDAPP DC    A(0)                     CHANNEL END APPENDAGE ADDRESS   15200017
AROUND0  EQU   *                                            LD @ZA00533 15250003
         LR    SAVE13,SAVEREG           SAVE SAVEAREA ADDRESS  @ZA05411 15320000
         B     AROUND                   BRANCH AROUND MODULE ID  YM4055 15450002
         DC    C'IGG019PD'              MODULE ID                YM4055 15500002
         DC    C'00016610'              PTF NUMBER                      15550000
         DS    0F                                                YM4055 15560002
         DC    XL60'00'                 PATCH AREA               YM4055 15570002
AROUND   EQU   *                                                 YM4055 15580002
         L     CCWREG,IOBCSW            LOAD CCW ADDRESS + 8     YM4055 15600002
         LA    CCWREG,DISP0(CCWREG)     CLEAR HIGH ORDER BYTE    YM4055 15650002
         SH    CCWREG,EIGHT             POINT TO CCW             YM4055 15800002
         CLC   IOBCSW+DISP4(LEN2),STATUS     PCI ALONE           YM4055 16000002
         BE    PCIAPP                   BRANCH IF YES                   16200017
         TM    IOBCSW+DISP5,PCI         IS PCI BIT PRESENT       YM4055 16400002
         BNO   CEAPPWT                  IF NOT, BRANCH TO CE.APP WTTA   16600017
         TM    IOBCSW+DISP5,PC          PROGRAM CHECK            YM4055 16800002
         BO    PCIAPP                   BRANCH IF YES                   17000017
         CLI   0(CCWREG),X'01'          IS A COMMAND WRITE              17200017
         BNE   WTAPP00                  BRANCH IF NOT                   17400017
         CLC   6(2,CCWREG),H1           IS CCW COUNT EQUAL AT 1         17600017
         BE    CEAPPWT                  BRANCH IF YES                   17800017
WTAPP00  EQU   *                                                        18000017
         NI    IOBCSW+DISP5,MASKALL-PCI-IL    TURN OFF PCI AND   YM4055 18200002
*                                       IL FLAGS                 YM4055 18250002
         CLC   IOBCSW+DISP6(LEN2),DISP6(CCWREG)   TEST FOR       YM4055 18400002
*                                      RESIDUAL CNT = CCW CNT    YM4055 18402002
         BNE   EXIT                     BRANCH IF UNEQUAL               18600017
         TM    5(CCWREG),X'40'          IS THE FIRST PCI                18800017
         BO    EXIT                     BRANCH IF YES                   19000017
         XC    IOBCSW+DISP6(LEN2),IOBCSW+DISP6  CLEAR RESIDUAL   YM4055 19200002
*                                                 COUNT          YM4055 19250002
         L     CCWREG,8(CCWREG)         LOAD THE PREVIOUS BUFFER ADDR   19600017
         LA    CCWREG,8(CCWREG)         INCREMENT THIS ADDR BY 8        19800017
         STCM  CCWREG,SEVEN,IOBCSW+DISP1 STORE IT IN THE CSW     YM4055 20000002
         B     EXIT                                                     20400017
PCIAPP   EQU   *                                               @ZA26279 20450000
         LR    SAVEREG,SAVE13           RESTORE SAVEAREA ADD   @ZA26279 20500000
         LM    RETREG,W2REG,DISP0(SAVEREG) RESTORE REGISTERS   @ZA26279 20550000
         L     BRREG,MCPCIAPP           LOAD PCI APPENDAGE ADD @ZA26279 20600000
         BR    BRREG                    BRANCH TO PCI APPENDAGE         20800017
         EJECT                                                          21000017
CEAPPWT  L     ECBREG,IOBECBPT          LOAD ADDRESS OF DECB            21200017
         L     CCWREG,IOBCSW            LOAD CCW ADDRESS                21400017
         SR    ICREG,ICREG              CLEAR ICREG REGISTER            21600017
         TM    IOBFLAG1,IOBEXE          IS ERP IN CONTROL               21800017
         BO    EXIT                     BRANCH IF YES                   22000017
         SH    CCWREG,EIGHT             SUBTRACT 8 TO LAST CCW          22200017
         BP    WTAPP01                                                  22400017
         TM    IOBSIOCC,X'30'           TEST FOR OPERATIONAL SIO        22600017
         BO    SIOCC1                   IF NOT,BRANCH                   22800017
         OI    DECERRST,SNO             SET ON SHOULD NOT OCCUR BIT     23000017
         B     CSWADR                                                   23200017
WTAPP01  EQU   *                                                        23400017
         TM    IOBCSW+4,X'F0'           TEST FOR ERROR IN CSW STATUS    23600017
         BNZ   SIOCC                    BRANCH IF YES                   23800017
         TM    IOBCSW+5,X'3F'           TEST CSW CHANNEL STATUS         24000017
         BZ    NORMAL                   BRANCH IF NO ERRORS             24200017
SIOCC    TM    IOBSIOCC,X'30'           TEST SIO COMPLETION CODE        24400017
         BNO   SIOCC10                  BRANCH IF OPERATIONAL SIO       24600017
SIOCC1   OI    DECERRST,X'80'           SET ON BIT 0 ERROR STATUS       24800017
         B     CSWADR                                                   25000017
SIOCC10  TM    IOBSIOCC,X'10'           TEST FOR CSW STORED             25200017
         BZ    TPXX                     BRANCH IF NOT                   25400017
CSWADR   MVC   IOBCSW+1(3),IOBSTART+1   MOVE START ADDRESS              25600017
         L     WREG,IOBCSW              LOAD IT,                        25800017
         LA    WREG,8(WREG)             ADD 8                           26000017
         ST    WREG,IOBCSW              AND STORE                       26200017
         L     CCWREG,IOBSTART          LOAD START ADDRESS              26400017
         B     TPXX                                                     26600017
NORMAL   MVC   TPCODE,5(CCWREG)         MOVE TPOP CODE                  26800017
         NI    TPCODE,TPMSK             SET OFF BITS 0-1 OF TPOP CODE   27000017
         CLI   TPCODE,X'04'             DETERMINE BRANCH TABLE FOR      27200017
         BE    TPRDWR                   NORMAL ENTRIES-DEPENDS UPON OF  27400017
         CLI   TPCODE,X'07'             IS READ TERMINAL ID             27600017
         BE    TPTERMID                 BRANCH IF YES                   27800017
         CLI   TPCODE,X'01'             THE TP CODE                     28000017
         BE    PREPASNS                                                 28200017
         CLI   TPCODE,X'11'                                             28400017
         BE    TPRDWR                                                   28600017
         CLI   TPCODE,TPBRK             IS A WRITE BREAK                28800017
         BE    TPBREAK                  BRANCH IF YES                   29000017
         B     TPXX                                                     29200017
TPBREAK  LA    ICREG,4(ICREG)           ADD 4 TO ICREG                  29400017
TPRDWR   LA    ICREG,4(ICREG)           ADD 4 TO ICREG                  29600017
TPTERMID LA    ICREG,4(ICREG)           ADD 4 TO ICREG                  29800017
PREPASNS LA    ICREG,0(ICREG)           ICREG KEEPS ITS VALUE           30000017
         B     TPOP(ICREG)                                              30200017
TPOP     B     TP01                     PREPARE-SENSE     01            30400017
         B     TP07                     READ TERM. ID.    07            30600017
         B     TP11                     READ/WRITE TEXT   11            30800017
         B     TP23                     WRITE BREAK       23            31000017
         EJECT                                                          31200017
TP01     CLI   IOBECBPT,CCHIO           IS LINE STOPPED BY HALT I/O     31400017
         BNE   TP01A                    BRANCH IF NOT                   31600017
         NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      31800017
         CLI   IOBCSW+4,CEDEUE          TEST FOR CE-DE UNIT EXCEPTION   32200017
         BNE   REXITA                   BRANCH TO RESTART               32400017
         OI    DECFLAGS,EOTWTFLG        SET ON EOT FLAG                 32600017
         NI    DECRESPN,MASKALL-MASKALL RESET DECRESPN                  32800017
         B     TP11G                                                    33000017
TP01A    TM    IOBSENS0,TIMOUT+INTREQ   IS TIME OUT OR INTERVENTION     33200017
*                                       REQUIRED PRESENT                33400017
         BM    TP11G                                                    33600017
         B     TP11E                    SHOULD NOT OCCUR                33800017
         SPACE 3                                                        34000017
HIOREAD  EQU   *                                                 YM4055 34200002
         L     ICREG,0(CCWREG)          LOAD BUFFER OR AREA ADDRESS     34400017
         AH    ICREG,6(CCWREG)          ADD CCW COUNT                   34600017
         SH    ICREG,0(CCWREG)          SUBTRACT RESIDUAL COUNT         34800017
         ST    ICREG,0(CCWREG)          AND STORE IN AREA CCW ADDRESS   35000017
         MVC   6(2,CCWREG),IOBCSW+6     MOVE RESIDUAL CNT AS CCW CNT    35200017
         B     REXIT                    BRANCH TO RESTART               35400017
         SPACE 3                                                        35600017
TP07     NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      35800017
         LH    ICREG,6(CCWREG)          LOAD IDENT COUNT                36000017
         LA    ICREG,1(ICREG)           INCREMENT BY 1                  36200017
         L     WREG,0(CCWREG)           LOAD ADDR OF IDENT CHAR         36400017
         LA    W2REG,0(WREG,ICREG)      LOAD ADDR OF COMPARE CHAR       36600017
         BCTR  ICREG,0                  DECREMENT COUNT BY 1            36800017
         BCTR  ICREG,0                  DECREMENT COUNT BY 1            37000017
         EX    ICREG,IDCMP              COMPARE IDENTIFICATION          37200017
         BE    IDGOOD                   IF GOOD, BRANCH                 37400017
         OI    DECFLAGS,NOCOMPAR        SET FLAG FOR BAD COMPARISON     37600017
         B     TPXX                                                     37800017
IDGOOD   NI    DECFLAGS,MASKALL-NOCOMPAR RESET FLAG FOR BAD COMPARISON  38000017
         B     REXITA                   EXECUTE NEXT CCW                38200017
IDCMP    CLC   0(0,WREG),0(W2REG)       COMPARE IDENT INSTRUCTION       38400017
         EJECT                                                          38600017
TP11     NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      38800017
         CLI   0(CCWREG),X'01'          IS COMMAND WRITE                39400017
         BE    WRITE                    BRANCH IF YES                   39600017
         CLC   6(2,CCWREG),IOBCSW+6     TEST FOR CCW CNT=RESIDUAL COUNT 39800017
         BE    TP11C                    BRANCH IF YES                   40000017
         L     ICREG,0(CCWREG)          LOAD BUFFER OR AREA ADDRESS     40200017
         LA    ICREG,0(ICREG)           CLEAR TOP REGISTER              40400017
         ST    ICREG,SAVEAREA           SAVE LAST BUFFER ADDRESS        40600017
         AH    ICREG,6(CCWREG)          ADD CCW COUNT                   40800017
         SH    ICREG,IOBCSW+6           SUBTRACT RESIDUAL COUNT         41000017
         BCTR  ICREG,0                  DECREMENT BY 1                  41200017
         CLI   0(ICREG),WRU             TEST FOR LAST CHAR.=WRU         41400017
         BNE   TP11B                    BRANCH IF NOT                   41600017
         TM    DCBBQFLG,IAMYES          TEST FOR IAM=YES IN DCB         41800017
         BNO   TP11B                    BRANCH IF NOT                   42000017
         OI    DECFLAGS,WRUWTFLG        SET ON WRU FLAG                 42200017
TP11A    LH    WREG,IOBCSW+6            LOAD RESIDUAL COUNT             42400017
         LA    WREG,1(WREG)             INCREMENT IT BY 1               42600017
         CH    WREG,6(CCWREG)           TEST FOR RESIDUAL CNT=CCW CNT   42800017
         BNE   TP11A1                   BRANCH IF INEQUAL               43000017
         L     ICREG,DECAREA            LOAD FIRST BUFFER ADDRESS       43200017
         TM    DCBBFTEK,DYNBF           IS DYNAMIC BUFFERING SPECIFIED  43400017
         BZ    TP11A1                   BRANCH IF NOT                   43600017
         LA    ICREG,4(ICREG)           POINT ON DATA AREA ADDRESS      43800017
         C     ICREG,SAVEAREA           IS LAST BUFFER THE 1ST BUFFER   44000017
         BE    TP11A1                   BRANCH IF YES                   44200017
         L     ICREG,SAVEAREA           LOAD THE LAST BUFFER ADDRESS    44400017
         MVI   0(ICREG),X'1F'           MOVE A LETTER SHIFT AS 1ST CHAR 44600017
         BCTR  WREG,0                   DECREMENT RESIDUAL CNT BY 1     44800017
TP11A1   EQU   *                                                        45000017
         STH   WREG,IOBCSW+6            AND STORE IN RESIDUAL COUNT     45200017
         B     TP11C                                                    45400017
TP11B    CLC   0(1,ICREG),DCBWTEOM      TEST FOR LAST CHAR.=EOM         45600017
         BE    TP11A                    BRANCH IF YES                   45800017
         CLC   0(1,ICREG),DCBWTEOT      TEST FOR LAST CHAR.=EOT         46000017
         BNE   TP11C                    BRANCH IF NOT                   46200017
         OI    DECFLAGS,EOTWTFLG        SET ON FLAG                     46400017
         B     TP11A                                                    46600017
TP11C    TM    IOBCSW+4,UC              TEST FOR UNIT CHECK             46800017
         BNO   TPXX                     BRANCH IF NOT                   47000017
         TM    IOBSENS0,TIMOUT          TEST FOR TIME OUT BIT IN SENSE  47200017
         BNO   TP11D                    BRANCH IF NOT                   47400017
         OI    DECFLAGS,EOTWTFLG        SET ON EOT FLAG                 47600017
         B     TPXX                                                     47800017
TP11D    TM    IOBSENS0,LOSTDATA        TEST FOR LOST DATA BIT IN SNS   48000017
         BNO   TP11D1                   BRANCH IF BIT ABSENT            48200017
         NI    IOBSENS0,MASKALL-LOSTDATA TURN OFF LOST DATA BIT         48400017
         B     TPXX                                                     48600017
TP11D1   TM    IOBSENS0,DATACHK+OVERRUN IS DATA CHECK OR OVERRUN BIT    48800017
         BM    TP11E+4                  BRANCH IF YES                   49000017
TP11E    OI    DECERRST,SNO             SET ON SHOULD NOT OCCUR BIT     49200017
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION FLAG       49400017
         B     TPXX                                                     49600017
         EJECT                                                          49800017
WRITE    TM    DECFLAGS,X'02'           THRESH RETURN AFTER CONTENTION  50000017
         BNO   WRITE1                   BRANCH IF NOT                   50200017
         MVI   IOBECBPT,CCNORM          YES, SET NORMAL COMPLETION      50400017
         NI    DECFLAGS,X'FD'           RESET TEMPORARY FLAG            50600017
         B     TPXX                     AND EXIT                        50800017
WRITE1   CLI   IOBECBPT,CCNORM          TEST FOR NORMAL COMPLETION      51000017
         BNE   TPXX                     BRANCH IF NOT                   51200017
         TM    IOBCSW+4,UE              TEST FOR UNIT EXCEPTION         51400017
         BNO   TP11F                    BRANCH IF NOT                   51600017
         B     TP11I                                                    51800017
TP11F    TM    IOBCSW+4,UC              TEST FOR UNIT CHECK             52000017
         BNO   TPXX                     BRANCH IF NOT                   52200017
         TM    IOBSENS0,DATACHK         TEST FOR DATA CHECK IN SENSE    52400017
         BNO   TP11E                    BRANCH IF NOT                   52600017
         B     TP11I                                                    52800017
TP11G    EQU   *                                                        53000017
         TM    DCBERROP,LERCNT          ARE LINE ERROR COUNTS SPECIFIED 53200017
         BZ    TPXX                     IF NOT, EXIT                    53400017
         SR    ICREG,ICREG              CLEAR ICREG REGISTER            53600017
         IC    ICREG,IOBUCBX            LOAD LINE NUMBER                53800017
         LA    W2REG,20                 MULTIPLY BY SIZE OF ERROR BLOCK 54000017
         MR    WREG,ICREG                                               54200017
         A     W2REG,DCBLERB            ADD ERROR BLOCK START ADDRESS   54400017
         CLI   IOBECBPT,CCHIO           IS LINE STOPPED BY HALT I/O     54600017
         BE    TP11H                    BRANCH IF YES                   54800017
         IC    ICREG,CDC(W2REG)         LOAD DATA CHECK COUNTER         55000017
         LA    ICREG,1(ICREG)           INCREMENT BY 1                  55200017
         STC   ICREG,CDC(W2REG)         AND STORE IT IN DATA CHECK CNT  55400017
         IC    WREG,CDCT(W2REG)         LOAD THRESHHOLD DATA CHECK CNT  55600017
         CR    ICREG,WREG               COMPARE THESE COUNTS            55800017
         BNE   TPXX                                                     56000017
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION FLAG       56200017
         BCTR  ICREG,0                  DECREMENT BY 1                  56400017
         STC   ICREG,CDC(W2REG)         AND STORE IT IN DATA CHECK CNT  56600017
         OI    DECFLAGS,X'02'           SET TEMPORARY FLAG              56800017
         B     TPXX                                                     57000017
TP11H    IC    ICREG,CNT(W2REG)         LOAD TRANSMISSION COUNT         57200017
         BCTR  ICREG,0                  DECREMENT BY 1                  57400017
         STC   ICREG,CNT(W2REG)         UPDATE TRANSMISSION COUNT       57600017
         SPACE 3                                                        57800017
TPXX     LR    SAVEREG,SAVE13               RESTORE SAVEAREA   @ZA26199 58000000
         LM    RETREG,W2REG,DISP0(SAVEREG)  RESTORE REGISTERS  @ZA26199 58050000
         L     BRREG,MBENDAPP           LOAD NORMAL END APPENDAGE ADDR  58200017
         BR    BRREG                    AND BRANCH                      58400017
         EJECT                                                          58600017
TP11I    EQU   *                                                        58800017
         MVC   IOBERINF(1),IOBSENS0     SAVE SENSE DATA                 59000017
         MVC   IOBERINF+1(7),IOBCSW+1   SAVE CSW DATA                   59200017
         MVC   IOBERINF+8(8),0(CCWREG)  SAVE FAILING CCW                59400017
         LA    CCWREG,IOBCPA            LOAD CHANNEL PROGRAM ADDRESS    59600017
         MVC   0(8,CCWREG),WRITEBRK     MOVE WRITE BREAK CCW            59800017
         B     REXIT                                                    60000017
         SPACE 3                                                        60200017
TP23     EQU   *                                                        60400017
         TM    IOBCSW+4,UC              TEST FOR UNIT CHECK             60600017
         BO    TP11E                    BRANCH IF PRESENT               60800017
         MVC   IOBSENS0(1),IOBERINF     RESTORE SENSE DATA              61000017
         MVC   IOBCSW+1(7),IOBERINF+1   RESTORE CSW DATA                61200017
         L     CCWREG,IOBCSW            PICK UP CCW POINTER             61400017
         SH    CCWREG,EIGHT             ADJUST TO FAILING CCW           61600017
         MVC   0(8,CCWREG),IOBERINF+8   RESTORE FAILING CCW             61800017
         OI    DECFLAGS,CONTFLG         SET ON CONTENTION FLAG          62000017
         TM    IOBCSW+4,UC              TEST FOR UNIT CHECK             62200017
         BO    TP11G                    BRANCH IF YES                   62400017
         B     TPXX                                                     62600017
         EJECT                                                          62800017
REXITA   LA    CCWREG,8(CCWREG)         UPDATE CCW POINTER              63000017
REXIT    ST    CCWREG,IOBSTART          STORE CCW START ADDRESS         63200017
         NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      63400017
         LR    SAVEREG,SAVE13           RESTORE SAVE AREA ADDR   YM4055 63450002
         LM    RETREG,W2REG,DISP0(SAVEREG)  RESTORE REGISTERS    YM4055 63600002
         B     8(RETREG)                RETURN TO IOS+8                 63800017
         SPACE 3                                                        64000017
EXIT     LR    SAVEREG,SAVE13           RESTORE SAVE AREA ADDR   YM4055 64050002
         LM    RETREG,W2REG,DISP0(SAVEREG)  RESTORE REGISTERS    YM4055 64200002
         BR    RETREG                   RETURN TO IOS                   64400017
         EJECT                                                          64600017
WRITEBRK DC    XL8'0D00000020230004'                                    64800017
SAVEAREA DC    F'0'                                                     65200017
EIGHT    DC    H'8'                                                     65400017
H1       DC    H'1'                                                     65600017
TPCODE   DC    X'00'                                                    65800017
STATUS   DC    XL2'0080'                                                66200017
PCI      EQU   X'80'                                                    66400017
IL       EQU   X'40'                    INCORRECT LENGTH                66600017
PC       EQU   X'20'                                                    66800017
UE       EQU   X'01'                                                    67000017
UC       EQU   X'02'                                                    67200017
CEDE     EQU   X'0C'                                                    67400017
CEDEUE   EQU   X'0D'                                                    67600017
CEDEUC   EQU   X'0E'                                                    67800017
COMREJ   EQU   X'80'                                                    68000017
INTREQ   EQU   X'40'                                                    68200017
BUSOUT   EQU   X'20'                                                    68400017
EQUCHK   EQU   X'10'                                                    68600017
DATACHK  EQU   X'08'                                                    68800017
OVERRUN  EQU   X'04'                                                    69000017
LOSTDATA EQU   X'02'                                                    69200017
TIMOUT   EQU   X'01'                                                    69400017
DYNBF    EQU   X'08'                                                    69600017
CNT      EQU   10                       NUMBER OF TRANSMISSIONS         69800017
CDC      EQU   11                                                       70000017
CDCT     EQU   15                                                       70200017
LERCNT   EQU   X'08'                                                    70400017
WRU      EQU   X'32'                                                    70600017
EOTWTFLG EQU   X'04'                                                    70800017
WRUWTFLG EQU   X'01'                                                    71000017
CONTFLG  EQU   X'10'                                                    71200017
TPBRK    EQU   X'23'                                                    71400017
NOCOMPAR EQU   X'10'                                                    71600017
HIOFLAG  EQU   X'80'                                                    71800017
MASKALL  EQU   X'FF'                                                    72000017
IAMYES   EQU   X'20'                                                    72200017
SNO      EQU   X'40'                                                    72400017
CCNORM   EQU   X'7F'                    NORMAL COMPLETION CODE          72600017
CCHIO    EQU   X'48'                                                    72800017
IOBEX    EQU   X'04'                                                    73000017
IOBEXE   EQU   X'24'                                                    73200017
TPMSK    EQU   X'3F'                                                    73400017
DISP0    EQU   0                        DISPLACEMENT OF 0        YM4055 73450002
DISP1    EQU   1                        DISPLACEMENT OF 1        YM4055 73500002
DISP4    EQU   4                        DISPLACEMENT OF 4        YM4055 73550002
DISP5    EQU   5                        DISPLACEMENT OF 5        YM4055 73560002
DISP6    EQU   6                        DISPLACEMENT OF 6        YM4055 73570002
DISP40   EQU   40                       DISPLACEMENT OF 40       YM4055 73580002
LEN2     EQU   2                        LENGTH OF 2              YM4055 73590002
SEVEN    EQU   7                        LENGTH FOR STCM INSTR.   YM4055 73592002
         CNOP  0,8                                                      73600017
         IECTDECB                                                       73800017
         IECTIOBX                                                       74000017
         DCBD  DSORG=BX,DEVD=WT                                         74200017
         END                                                            74400017
./  ADD  SSI=13160096,NAME=IGG019PE
         TITLE 'IGG019PE - 2741 NON-SWITCHED DEVICE I/O MODULE'         01000018
IGG019PE CSECT                                                          02000018
         SPACE 2                                                        03000018
* STATUS -     CHANGE LEVEL 000    OCTOBER 29,1968                      04000018
         SPACE                                                          05000018
* FUNCTION-    THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       06000018
*              DEPENDENT VARIABLE INFORMATION NEEDED BY BTAM            07000018
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        08000018
*              CHANNEL PROGRAMS.                                        09000018
         SPACE 2                                                        10000018
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     11000018
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        12000018
*              OPERATION.                                               13000018
         SPACE 2                                                        14000018
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       15000018
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE.  FOLLOWING      16000018
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  17000018
         SPACE 4                                                        18000018
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  19000018
         SPACE                                                          20000018
*                   DC   X'0403050906820008'                            21000018
          SPACE                                                         22000018
*                        04 = COUNT OF CCW'S                            23000018
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  24000018
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  25000018
*                             INDICATES RESET)                          26000018
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  27000018
         SPACE 4                                                        28000018
*              THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE.       29000018
*              ITS ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE   30000018
*              BY OPEN AT OPEN TIME.                                    31000018
          EJECT                                                         32000018
A        DC    X'FF'                 00                                 33000018
         DC    AL1(RI-A)             01 READ INITIAL                    34000018
         DC    X'FF'                 02                                 35000018
         DC    AL1(RC-A)             03 READ CONTINUE                   36000018
         DC    AL1(WC-A)             04 WRITE CONTINUE                  37000018
         DC    AL1(RV-A)             05 READ CONVERSATIONAL             38000018
         DC    AL1(WV-A)             06 WRITE CONVERSATIONAL            39000018
         DC    X'FF'                 07                                 40000018
         DC    X'FF'                 08                                 41000018
         DC    AL1(RS-A)             09 READ SKIP                       42000018
         DC    X'FF'                 0A                                 43000018
         DC    X'FF'                 0B                                 44000018
         DC    X'FF'                 0C                                 45000018
         DC    X'FF'                 0D                                 46000018
         DC    X'FF'                 0E                                 47000018
         DC    AL1(WTV-A)            0F WRITE CONTINUE CONVERSATIONAL   48000018
         DC    X'FF'                 10                                 49000018
         DC    X'FF'                 11                                 50000018
         DC    X'FF'                 12                                 51000018
         DC    X'FF'                 13                                 52000018
         DC    X'FF'                 14                                 53000018
         DC    X'FF'                 15                                 54000018
         DC    X'FF'                 16                                 55000018
         DC    X'FF'                 17                                 56000018
         DC    AL1(C-A)              18 OFFSET TO CCW'S                 57000018
         DC    X'FF'                 19                                 58000018
         DC    X'FF'                 1A                                 59000018
         DC    X'FF'                 1B                                 60000018
         DC    X'FF'                 1C                                 61000018
         DC    X'FF'                 1D                                 62000018
         DC    X'FF'                 1E                                 63000018
         DC    X'FF'                 1F                                 64000018
         SPACE 2                                                        65000018
*                   CHANNEL PROGRAMS                                    66000018
RI       DC    X'020004'                READ INITIAL             A35750 67000020
RC       DC    X'03010004'              READ CONTINUE            A35750 68000020
RV       EQU   RC                       READ CONVERSATIONAL      A35750 69000020
WC       DC    X'0105'                  WRITE CONTINUE                  70000018
WV       DC    X'020205'                WRITE CONVERSATIONAL            71000018
RS       DC    X'0106'                  READ SKIP                       72000018
WTV      DC    X'0403010004'            WRITE CONTINUE CONVERSATIONAL   73000018
          SPACE 3                                                       74000018
C        DS    0X                                                       75000018
*                   C C W 'S               I/O      F L A G S    LENGTH 76000018
*                                       OPERATION CD   CC   SLI    =    77000018
         DC    X'0600000060010001'   0  PREP           X    X      1    78000018
         DC    X'010C003860020001'   1  WR C           X    X      1    79000018
         DC    X'010C003980020001'   2  WR D      X                1    80000018
         DC    X'0138000060110800'   3  WR WAREA       X    X     WN    81000018
         DC    X'0A04000020110400'   4  INHIBIT             X      N    82000018
         DC    X'0104000020110400'   5  WR TEXT             X      N    83000018
         DC    X'0A00000030220400'   6  INHIBIT   SKIP FLAG X      N    84000018
         SPACE 2                                                        85000018
CC       EQU   *-C                 OFFSET TO FIRST CONTROL CHARACTER    86000018
         SPACE                                                          87000018
         DC    X'1F'                 EOT (CIRCLE C)                     88000018
         DC    X'16'                 EOA (CIRCLE D)                     89000018
         CNOP  0,8                                                      90000018
          END                                                           91000018
./  ADD  SSI=13160097,NAME=IGG019PF
         TITLE 'IGG019PF - 2741 SWITCHED DEVICE I/O MODULE'             01000018
IGG019PF CSECT                                                          02000018
         SPACE 2                                                        03000018
* STATUS -     CHANGE LEVEL 000    23 OCTOBER 1968                      04000018
         SPACE                                                          05000018
* FUNCTION-    THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       06000018
*              DEPENDENT VARIABLE INFORMATION NEEDED BY BTAM            07000018
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        08000018
*              CHANNEL PROGRAMS.                                        09000018
         SPACE 2                                                        10000018
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     11000018
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        12000018
*              OPERATION.                                               13000018
         SPACE 2                                                        14000018
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       15000018
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE.  FOLLOWING      16000018
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  17000018
         SPACE 4                                                        18000018
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  19000018
         SPACE                                                          20000018
*                   DC   X'0403050906820008'                            21000018
          SPACE                                                         22000018
*                        04 = COUNT OF CCW'S                            23000018
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  24000018
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  25000018
*                             INDICATES RESET)                          26000018
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  27000018
         SPACE 4                                                        28000018
*              THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE.       29000018
*              ITS ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE   30000018
*              BY OPEN AT OPEN TIME.                                    31000018
          EJECT                                                         32000018
A        DC    X'FF'                 00                                 33000018
         DC    AL1(RI-A)             01 READ INITIAL                    34000018
         DC    X'FF'                 02                                 35000018
         DC    AL1(RC-A)             03 READ CONTINUE                   36000018
         DC    AL1(WC-A)             04 WRITE CONTINUE                  37000018
         DC    AL1(RV-A)             05 READ CONVERSATIONAL             38000018
         DC    AL1(WV-A)             06 WRITE CONVERSATIONAL            39000018
         DC    X'FF'                 07                                 40000018
         DC    X'FF'                 08                                 41000018
         DC    AL1(RS-A)             09 READ SKIP                       42000018
         DC    AL1(WN-A)             0A WRITE DISCONNECT                43000018
         DC    X'FF'                 0B                                 44000018
         DC    X'FF'                 0C                                 45000018
         DC    X'FF'                 0D                                 46000018
         DC    X'FF'                 0E                                 47000018
         DC    AL1(WTV-A)            0F WRITE CONTINUE CONVERSATIONAL   48000018
         DC    X'FF'                 10                                 49000018
         DC    X'FF'                 11                                 50000018
         DC    X'FF'                 12                                 51000018
         DC    X'FF'                 13                                 52000018
         DC    X'FF'                 14                                 53000018
         DC    X'FF'                 15                                 54000018
         DC    X'FF'                 16                                 55000018
         DC    X'FF'                 17                                 56000018
         DC    AL1(C-A)              18 OFFSET TO CCW'S                 57000018
         DC    X'FF'                 19                                 58000018
         DC    X'FF'                 1A                                 59000018
         DC    X'FF'                 1B                                 60000018
         DC    X'FF'                 1C                                 61000018
         DC    X'FF'                 1D                                 62000018
         DC    X'FF'                 1E                                 63000018
         DC    X'FF'                 1F                                 64000018
         SPACE 2                                                        65000018
RI       DC    X'0408070004'            READ INITIAL                    66000018
RV       DC    X'03010004'              READ CONVERSATIONAL             67000018
RC       EQU   RV                       READ CONTINUE                   68000018
WC       DC    X'0105'                  WRITE CONTINUE                  69000018
WV       DC    X'020205'                WRITE CONVERSATIONAL            70000018
RS       DC    X'0106'                  READ SKIP                       71000018
WTV      DC    X'0403010004'            WRITE CONTINUE CONVERSATIONAL   72000018
WN       DC    X'0109'                  WRITE DISCONECT                 73000018
          SPACE 3                                                       74000018
C        DS    0X                                                       75000018
*                   C C W 'S               I/O      F L A G S    LENGTH 76000018
*                                       OPERATION CD   CC   SLI    =    77000018
         DC    X'0600000060010001'   0  PREP           X    X      1    78000018
         DC    X'010C005060020001'   1  WR C           X    X      1    79000018
         DC    X'010C005180020001'   2  WR D      X                1    80000018
         DC    X'0138000060110800'   3  WR WAREA       X    X     WN    81000018
         DC    X'0A04000020110400'   4  INHIBIT             X      N    82000018
         DC    X'0104000020110400'   5  WR TEXT             X      N    83000018
         DC    X'0A00000030220400'   6  INHIBIT   SKIP FLAG X      N    84000018
         DC    X'2700000060010001'   7  ENABLE         X    X       1   85000018
         DC    X'2F00000060010001'   8  DISABLE        X    X       1   86000018
         DC    X'2F00000020210001'   9  DISABLE             X       1   87000018
         SPACE 2                                                        88000018
CC       EQU   *-C                 OFFSET TO FIRST CONTROL CHARACTER    89000018
         SPACE                                                          90000018
         DC    X'1F'                 EOT (CIRCLE C)                     91000018
         DC    X'16'                 EOA (CIRCLE D)                     92000018
         CNOP   0,8                                                     93000018
         END                                                            94000018
./  ADD  SSI=40810014,NAME=IGG019PG
         TITLE 'IGG019PG - BTAM LOCAL 3270 SECOND LEVEL ATTN RTN'       00750000
IGG019PG CSECT                                                          00800000
*                                                                       00810000
* A035100,A058980-058999,D059000-060000,A064100,             LD YA02143 00820000
* C065500-069000,D069500-072000,D075000-077000,              LD YA02143 00830000
* C081000-081500,A084100,A100600-100700                      LD YA02143 00840000
* C058998,A059498                                            LD YA03270 00840400
* D064100,A065020-065200,D067600-067700                      LD YA03953 00840800
*                                                                       00842000
*********************************************************************** 00850000
*                                                                       00900000
* STATUS - CHANGE LEVEL 000                                             00950000
*                                                                       01000000
* FUNCTION - STARTS A READ OF MODIFIED DATA TO A 3270 WHICH HAS GIVEN   01050000
*    AN ATTENTION INTERRUPT. SCHEDULED BY THE FIRST LEVEL ATTENTION     01100000
*    ROUTINE IF NEEDED.  ENTERED FROM THE THIRD STAGE OF THE            01150000
*    ASYNCHRONOUS EXIT EFFECTOR (AEE3).                                 01200000
*                                                                       01250000
* ENTRY POINT - THIS ROUTINE IS ENTERED AT IGG019PG FROM AEE3.          01300000
*                                                                       01350000
* INPUT - REGISTER 1 CONTAINS THE ADDRESS OF THE UCB OF THE DEVICED     01400000
*    WHICH CAUSED AN ATTENTION INTERRUPT.                               01450000
*                                                                       01500000
* OUTPUT - AN IOB IS INITIALIZED TO DO A READ MODIFIED AND EXCP IS      01550000
*    ISSUED.  THE UCB ATTENTION HANDLING FIELDS ARE UPDATED AS NEEDED.  01600000
*                                                                       01650000
* EXTERNAL ROUTINES - EXCP (SVC 0)                                      01700000
*                                                                       01750000
* EXITS, NORMAL - WHEN FINISHED, THIS ROUTINE RETURNS TO AEE3.          01800000
*                                                                       01850000
* EXITS, ERROR - RETURN TO AEE3 WITHOUT ISSUING EXCP.                   01900000
*                                                                       01950000
* TABLES/WORK AREAS - THE UCB EXTENSIONS OF THE INTERRUPTING DEVICE     02000000
*    AND RELATIVE LINE 1 OF THE LINE GROUP.  THE IOB INITIALIZED BY     02050000
*    READ INITIAL AND THE IOB FOR THE INTERRUPTING DEVICE.              02100000
*                                                                       02150000
* ATTRIBUTES - THIS ROUTINE IS LOADED BY OPEN. IT EXECUTES ENABLED,     02200000
*    SUPERVISOR PROTECT KEY, PRIVILEDGED, AND REENTRANT.                02250000
*                                                                       02300000
*********************************************************************** 02350000
         EJECT                                                          02400000
*/*IGG019PG: CHART */                                                   02450000
*/* HEADER                                                              02500000
*/*BTAM SECOND LEVEL ATTENTION ROUTINE FOR 3270                     */  02550000
*/* E ENTRY FROM AEE3 */                                                02600000
*/* M ESTABLISH CSECT ADDRESSABILITY AND SAVE RETURN ADDR */            02650000
*/* M ESTABLISH BASES FOR DEVICE AND MASTER UCB DSECTS */               02700000
*/* M ESTABLISH ADDRESSABILITY FOR DEB AND DCB */                       02750000
*/* P OBTAIN ADDRESS OF INITIALIZED IOB */                              02800000
*/* D (YES,EXCP,NO,GETIOB) RLN OF DEVICE IS RLN OF INIALIZED IOB? */    02850000
*/*GETIOB: P OBTAIN ADDRESS OF DEVICE'S IOB */                          02900000
*/* P COPY ECB POINTER AND CHANNEL PROGRAM TO DEVICE'S IOB */           02950000
*/*EXCP: P SAVE ECB CONTENTS IN A NON-VOLATILE REGISTER */              03000000
*/* L INVOKE EXCP TO START I/O OPERATION ON DEVICE */                   03050000
*/* P CLEAR INITIALIZED RLN FIELD IN UCB */                             03100000
*/* P RESTORE PRE-EXCP STATUS OF ECB */                                 03150000
*/* P MOVE RLN OF DEVICE BEING USED TO DECPOLPT */                      03200000
*/* R RETURN TO AEE3 */                                                 03250000
*/*IGG019PG: END */                                                     03300000
         EJECT                                                          03350000
         USING MSTRUCB,MTRBASE                                          03400000
         USING UCB,UCBBASE                                              03450000
         USING DEBNMSUB,DEBREG                                          03500000
         USING IECTIOB,IOBDVC      ADDRESSABILITY FOR IOB    LD YA02143 03510000
         BALR  BASEREG,0           ESTABLISH ADDRESSABILITY FOR CSECT   03550000
         USING *,BASEREG                                                03600000
         B     A                                                        03650000
         DC    CL8'IGG019PG'       MODULE IDENTIFIER                    03700000
         DC    XL2'4072'           DATE OF REVIOSION                    03750000
PATCH    DS    CL48                PATCH AREA                           03800000
A        DS    0H                                                       03850000
         LR    SAVE14,RTRNREG      SAVE REG 14 (RETURN ADDRESS)         03900000
         LR    UCBBASE,PARMREG     GET ADDRESS OF UCB IN DSECT BASE REG 03950000
         CLI   UCBRLN,ONE          RLN = 1                              04000000
         BE    RLN1                YES, BRANCH                          04050000
         L     MTRBASE,UCBCTLNK    NO, GET ADDRESS OF MASTER UCB        04100000
         B     GETDEB              BR TO GET ADDR OF DEB                04150000
RLN1     EQU   *                                                        04200000
         LR    MTRBASE,UCBBASE                                          04250000
GETDEB   EQU   *                                                        04300000
         L     DEBREG,MTRDEBAD     GET ADDR OF DEB FROM MASTER UCB      04350000
         L     DCBREG,ZERO(DEBREG)   POINT TO TCB                       04400000
         USING TCB,DCBREG                                               04450000
         MODESET EXTKEY=TCB,WORKREG=4                           YA01891 04500000
         DROP  DCBREG                                                   04550000
         USING IHADCB,DCBREG                                            04600000
         L     DCBREG,DEBDCBAD-1   GET ADDR OF DCB FROM DEB             04650000
         L     IOBDVC,DCBIOBAD     GET BASE OF IOB POOL                 04700000
         SR    RW3,RW3                                                  04750000
         IC    RW3,DCBEIOBX        GET LENGTH OF IOB                    04800000
         SR    RODD,RODD                                                04850000
         IC    RODD,MTRINRLN       GET RLN OF INITIALIZED IOB           04900000
         MR    REVN,RW3            GET DISPLACEMENT INTO IOB POOL       04950000
         LA    IOBRDTI,0(RODD,IOBDVC)  ADD BASE TO GET ADDR OF          05000000
*                                  INITIALIZED IOB                      05050000
         CLC   UCBRLN(ONE),MTRINRLN  RLN FOR INITIALIZED IOB =          05100000
*                                  RLN OF INTERRUPTING DEVICE           05150000
         BNE   GETIOB              NO, GET ADDRESS OF OTHER IOB         05200000
         LR    IOBDVC,IOBRDTI      YES, IOB FOR DEVICE IS INITIALIZED   05250000
         B     EXCP                IOB.  START I/O                      05300000
GETIOB   EQU   *                                                        05350000
         SR    RODD,RODD           GET RLN OF INTERRUPTING DEVICE       05400000
         IC    RODD,UCBRLN                                              05450000
         MR    REVN,RW3            GET DISP INTO IOB POOL               05500000
         AR    IOBDVC,RODD         ADD BASE OF POOL TO GET ADDRESS OF   05550000
*                                  IOB                                  05600000
         MVC   ECBPT(FOUR,IOBDVC),ECBPT(IOBRDTI)  MOVE ECB ADDR         05650000
         MVC   CPA(CPALNGTH,IOBDVC),CPA(IOBRDTI)  MOVE CHANNEL PROGRAM  05700000
         LA    REVN,CPA(IOBDVC)    GET ADDR OF CPA                      05750000
         ST    REVN,START(IOBDVC)  AND STORE IN IOB                     05800000
EXCP     DS    0H                                            LD YA02143 05850000
**********                                                              05860000
*                                                                       05870000
*    NOTE-- EXCP DESTROYS THE CONTENTS OF THE ECB.  SINCE WAIT MAY      05880000
*    HAVE BEEN ISSUED, THE ECB CONTENTS MUST BE SAVED IF THE WAIT IS    05890000
*    TO BE SATISFIED. THIS IS DONE BY NOT USING THE USER'S DECB FOR     05892000
*    THE EXCP, SINCE IT COULD BE PART OF A MULTIPLE WAIT AND ANOTHER    05892400
*    EVENT MAY COMPLETE AND PROCESS THE DECB DURING THE EXCP.           05892800
*    IGG019PA AND IGG019LP HAVE BEEN CHANGED TO RECOGNIZE THIS          05893200
*    CASE AND GET ADDRESS OF REAL DECB FROM THE WORD AFTER              05893600
*    THE ECB. THIS IS RECOGNIZED BY A X'FF' IN THE FOURTH BYTE WHICH    05893700
*    IS NORMALLY THE DECTYPE FIELD.                                     05893800
*                                                                       05894000
**********                                                              05896000
         L     RZERO,GETPARM       SET SUBPOOL AND LENGTH    LD YA02143 05898000
         GETMAIN R,LV=(0)          GET 8 BYTES FOR AN ECB    LD YA02143 05898400
         LR    ECBSAVE,PARMREG     SAVE ADDRS OF NEW ECB     LD YA02143 05898800
         L     REVN,IOBECBPT       GET ADDRS OF DECB         LD YA02143 05899200
         ST    REVN,FOUR(ECBSAVE)  POINT NEW ECB TO DECB     LD YA02143 05899600
         MVI   FOUR(ECBSAVE),ALLON FLAG AS NOT A REAL DECB   LD YA02143 05899700
         STCM  ECBSAVE,MASKA,IOBECBPT+ONE    SET NEW AREA    LD YA03270 05899800
*                                            AS ECB          LD YA03270 05949800
         LR    PARMREG,IOBDVC      SET FOR EXCP              LD YA02143 05999800
         EXCP  (1)                 START I/O OPERATION                  06400000
         MODESET EXTKEY=ZERO                                    YA01891 06450000
         MVI   MTRINRLN,ZERO       CLEAR INITIALIZED RLN                06500000
         L     REG3,DEBNMSUB       LOAD TCB ADDRSS           LD YA03953 06502000
         USING TCB,REG3            ADDRESSABILITY FOR TCB    LD YA03953 06504000
         MODESET EXTKEY=TCB,WORKREG=14  ASUME USER'S KEY     LD YA03953 06506000
         STCM  REVN,MASKA,IOBECBPT+ONE REPOINT IOB TO DECB   LD YA03953 06510000
         MODESET EXTKEY=ZERO                                 LD YA03953 06520000
         TM    ZERO(ECBSAVE),POSTBIT  WAS ECB POSTED ?       LD YA02143 06550000
         BNO   NOPOST                 NO, SKIP POST          LD YA02143 06600000
         L     RZERO,ZERO(ECBSAVE) YES, REPOST USER          LD YA02143 06650000
         POST  (REVN),(RZERO)      WITH SAME POST CODE       LD YA02143 06700000
NOPOST   EQU   *                                             LD YA02143 06750000
         MODESET EXTKEY=TCB,WORKREG=3 USER KEY FOR FREEMAIN  LD YA02143 06800000
         DROP  REG3                                          LD YA02143 06810000
         L     RZERO,GETPARM       SETUP FOR FREEMAIN        LD YA02143 06850000
         FREEMAIN R,LV=(0),A=(ECBSAVE) FREE THE ECB AREA     LD YA02143 06900000
         MODESET EXTKEY=ZERO                                 LD YA02143 06950000
         XC    POLPT(FOUR,REVN),POLPT(REVN)  CLEAR POLPT FIELD          07250000
         MVC   POLPT+3(ONE,REVN),UCBRLN   MOVE RLN OF DEVICE BEING USED 07300000
*                                  INTO DECB                            07350000
         LR    RTRNREG,SAVE14      GET RETURN ADDR BACK IN REG 14       07400000
         BR    RTRNREG             RETURN TO AEE3                       07450000
         EJECT                                                          07750000
**********                                                              07800000
*                                                                       07850000
*        CONSTANTS                                                      07900000
*                                                                       07950000
**********                                                              08000000
         DS    0F                  GET ON WORD BOUNDARY         YA02050 08050000
GETPARM  DC    X'FA000008'         SUBPOOL 250 FOR 8 BYTES   LD YA02143 08100000
POSTBIT  EQU   X'40'               DEFINE BIT IN ECB         LD YA02143 08150000
**********                                                              08200000
*                                                                       08250000
*        REGISTER DEFINITIONS                                           08300000
*                                                                       08350000
**********                                                              08400000
RZERO    EQU   0                                             LD YA02143 08410000
PARMREG  EQU   1                   PARAMETER REGISTER                   08450000
REVN     EQU   2                   WORK REGISTERS- EVEN/ODD PAIR        08500000
RODD     EQU   3                       FOR MULTIPLICATION               08550000
REG3     EQU   3                   WORK REG                  LD YA02143 08560000
ECBSAVE  EQU   4                   REG TO SAVE ECB CONTENTS             08600000
RW3      EQU   4                   WORK REGISTER                        08650000
MTRBASE  EQU   5                   ADDR OF UCB FOR RLN 1                08700000
UCBBASE  EQU   6                   ADDR OF UCB FOR INTERRUPTING DEVICE  08750000
IOBDVC   EQU   7                   ADDR OF IOB FOR DEVICE               08800000
IOBRDTI  EQU   8                   ADDR OF INITIALIZED IOB              08850000
DEBREG   EQU   9                   ADDRESS OF DEB                       08900000
DCBREG   EQU   10                  ADDRESS OF DCB                       08950000
SAVE14   EQU   11                  REGISTER TO SAVE RETURN PT.          09000000
BASEREG  EQU   12                  BASE REGISTER                        09050000
RTRNREG  EQU   14                  RETURN REGISTER                      09100000
**********                                                              09150000
*                                                                       09200000
*        MISCELLANEOUS EQUATES                                          09250000
*                                                                       09300000
**********                                                              09350000
ALLON    EQU   X'FF'                                                    09400000
CPA      EQU   X'40'               DISP TO START OF CPA IN IOB          09450000
CPALNGTH EQU   24                  LENGTH OF 3270 CPA                   09500000
DCBPT    EQU   X'14'               DISP TO DCB ADDR IN IOB              09550000
ECBPT    EQU   4                   DISP TO ECB ADDR IN IOB              09600000
FOUR     EQU   4                                                        09650000
INCAM    EQU   X'1C'               DISP TO IOBINCAM                     09700000
IOBBUSY  EQU   X'40'               IOBINCAM BUSY BIT                    09750000
ONE      EQU   X'01'                                                    09800000
POLPT    EQU   36                  DISP TO DECPOLPT FIELD IN DECB       09850000
START    EQU   X'10'               DISP OF PTR TO CPA IN IOB            09900000
TWO      EQU   2                                                        09950000
UCBX     EQU   X'20'               DISP TO UCB INDEX IN IOB             10000000
ZERO     EQU   0                                                        10050000
MASKA    EQU   7                   MASK FOR ADDRS PORTION... LD YA02143 10060000
*                                  OF FULL WORD              LD YA02143 10070000
         EJECT                                                          10100000
         DCBD  DSORG=BX,DEVD=BS                                         10150000
         EJECT                                                          10200000
         IECTDEBX                                                       10250000
         EJECT                                                          10300000
         IECTIOBX                                                       10350000
         EJECT                                                          10400000
         IECTUCBX                                                       10450000
         EJECT                                                          10500000
         IKJTCB DSECT=YES,LIST=YES                              XA01891 10550000
         END                                                            10600000
./  ADD  SSI=73620090,NAME=IGG019PH
         TITLE ' IGG019PH - LOCAL 3270 DEVICE I/O MODULE '              00800000
IGG019PH CSECT                                                          01600000
*********************************************************************** 02400000
*                     LOCAL 3270 DEVICE I/O MODULE                    * 03200000
*********************************************************************** 04000000
*                                                                     * 04800000
* STATUS:                                                             * 05600000
*    CHANGE LEVEL 001         SEPT 30,1977                            * 06400000
*                                                                     * 07200000
* FUNCTION:                                                           * 08000000
*    THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE DEPENDENT     * 08800000
*    VARIABLE INFORMATION NEEDED BY BTAM READ/WRITE ROUTINE           * 09600000
*    (IGG019MA) TO PREPARE THE CHANNEL PROGRAM.                       * 10400000
*                                                                     * 11200000
*    EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE CHANNEL     * 12000000
*    COMMAND WORD OFFSETS FOR EACH TYPE OF I/O OPERATION. IF THE      * 12800000
*    OPERATION IS INVALID FOR THE LOCAL 3270, THE BYTE CONTAINS THE   * 13600000
*    VALUE X'FF'.                                                     * 14400000
*                                                                     * 15200000
*    FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT CCW'S THAT    * 16000000
*    ARE USED BY THE LOCAL 3270.                                      * 16800000
*                                                                     * 17600000
*    EXAMPLE OF CCW OFFSETS (IE. CONDENSED CHANNEL PROGRAM);          * 18400000
*    DC  X'0403050906                                                 * 19200000
*    04 - COUNT OF CCW'S                                              * 20000000
*    03,05,09,06 - CCW'S 3,5,9,6 COMPRISE CHANNEL PROGRAM             * 20800000
*                                                                     * 21600000
*    THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS ADDRESS   * 22400000
*    IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN AT OPEN TIME. * 23200000
*                                                                     * 24000000
* ENTRY:                                                              * 24800000
*         NONE                                                        * 25600000
*                                                                     * 26400000
* INPUT:                                                              * 27200000
*    NONE                                                             * 28000000
*                                                                     * 28800000
* OUTPUT:                                                             * 29600000
*    NONE                                                             * 30400000
*                                                                     * 31200000
* EXTERNAL REFERENCES:                                                * 32000000
*         NONE                                                        * 32800000
*                                                                     * 33600000
* EXITS, NORMAL:                                                      * 34400000
*         NONE                                                        * 35200000
*                                                                     * 36000000
* EXITS, ERROR:                                                       * 36800000
*         NONE                                                        * 37600000
*                                                                     * 38400000
* TABLES/WORK AREAS:                                                  * 39200000
*    NONE                                                             * 40000000
*                                                                     * 40800000
* ATTRIBUTES:                                                         * 41600000
*    RESIDENT, ONLY LOADABLE, NOT EDITABLE.                           * 42400000
*                                                                     * 43200000
* CHARACTER CODE DEPENDENCY:                                          * 44000000
*    NONE                                                             * 44800000
*                                                                     * 45600000
*********************************************************************** 46400000
         EJECT                                                          47200000
*                                                                       48000000
*    TABLE OF OFFSETS                                                   48800000
*                                                                       49600000
A        DC    X'FF'               00                                   50400000
         DC    AL1(RI-A)           01 READ INITIAL                      51200000
         DC    AL1(WI-A)           02 WRITE INITIAL                     52000000
         DC    X'FF'               03                                   52800000
         DC    X'FF'               04                                   53600000
         DC    X'FF'               05                                   54400000
         DC    AL1(WEA-A)          06 WRITE ERASE ALTERNATE     ZA25924 55200000
         DC    X'FF'               07                                   56000000
         DC    X'FF'               08                                   56800000
         DC    X'FF'               09                                   57600000
         DC    X'FF'               0A                                   58400000
         DC    AL1(RB-A)           0B READ BUFFER                       59200000
         DC    X'FF'               0C                                   60000000
         DC    X'FF'               0D                                   60800000
         DC    AL1(WE-A)           0E WRITE ERASE                       61600000
         DC    X'FF'               0F                                   62400000
         DC    X'FF'               10                                   63200000
         DC    AL1(RI-A)           11 READ MODIFIED                     64000000
         DC    AL1(WUE-A)          12 WRITE UNPROTECTED ERASE           64800000
         DC    AL1(RBP-A)          13 READ BUFFER FROM POSITION         65600000
         DC    X'FF'               14                                   66400000
         DC    X'FF'               15                                   67200000
         DC    X'FF'               16                                   68000000
         DC    X'FF'               17                                   68800000
         DC    AL1(C-A)            18 OFFSET TO CCW'S                   69600000
         DC    AL1(RMP-A)          19 READ MODIFIED FROM POSITION       70400000
         DC    X'FF'               1A                                   71200000
         DC    X'FF'               1B                                   72000000
         DC    X'FF'               1C                                   72800000
         DC    X'FF'               1D                                   73600000
         DC    X'FF'               1E                                   74400000
         DC    X'FF'               1F                                   75200000
*                                                                       76000000
*    CHANNEL PROGRAM OFFSETS                                            76800000
*                                                                       77600000
RI       DC    X'020001'           READ INITIAL/READ MODIFIED           78400000
WI       DC    X'020004'           WRITE INITIAL                        79200000
RB       DC    X'020002'           READ BUFFER                          80000000
WE       DC    X'0105'             WRITE ERASE                          80800000
WUE      DC    X'020607'           WRITE UNPROTECTED ERASE              81600000
RBP      DC    X'03000302'         READ BUFFER FROM POSITION            82400000
RMP      DC    X'03000301'         READ MODIFIED FROM POSITION          83200000
WEA      DC     X'0108'            WRITE ERASE ALTERNATE        ZA25924 84000000
*                 CCW'S              I/O               FLAGS LENGTH     84050000
*                                 OPERATION           CC SLI =          84100000
*                                                                       86400000
C        DC    X'0B04000060000001'  SELECT              X  X 1          87200000
         DC    X'0604000020000400'  RD MODIFIED            X N          87250000
         DC    X'0204000020000400'  RD BUFFER              X N          87300000
         DC    X'0164000060000004'  WRITE               X  X 4          87350000
         DC    X'0104000020000400'  WRITE                  X N          87400000
         DC    X'0504000020000400'  ERASE/WRITE            X N          87450000
         DC    X'0F00000060000001'  ERASE ALL UNPRO     X  X 1          87500000
         DC    X'0300000020000001'  NOP                    X 1          87550000
         DC    X'0D04000020000400'  WRITE ERASE ALTERNATE  X N  ZA25924 94400000
         CNOP  0,8                                                      94450000
         END                                                            94500000
./  ADD  SSI=53040100,NAME=IGG019PI
         TITLE 'IGG019PI - LOCAL ON-LINE TEST CONTROL'                  00350002
IGG019PI CSECT                                                          00400002
*                                                                       00450002
*        MAINTENANCE ACTIVITY                                           00500002
*                                                                       00600002
*        YA02451                                                        00610002
*        YA03247                                                        00620002
*        YA03248                                                        00630002
*        YA03957                                                        00640002
*        ZA02332  (11/21/74)                                            00642000
*        AZ04857  (09/30/75)                                            00643000
*                                                                       00646002
*********************************************************************** 00650002
*/*IGG019PI: CHART*/                                                    00700002
*/* E IGG019PI*/                                                        00750002
*/* D (YES,,NO,DECBSET) DUMMY DECB*/                           @ZA04857 00760000
*/* M GET REAL DECB ADDRESS */                                 @ZA04857 00770000
*/*DECBSET: D (NO,,YES,ERRTEST) IS ONLINE TEST IN PROGRESS?*/  @ZA04857 00780000
*/* D (NO,,YES,ERRTEST) IS ON-LINE TEST IN PROGRESS*/                   00800002
*/* D (YES,,NO,INVALID) ARE THE XX & YY FIELDS NUMERIC*/                00850002
*/* D (YES,,NO,INVALID) IS XX VALUE VALID (23-28)*/                     00900002
*/* D (NO,,YES,INVALID) IS YY COUNT ZERO*/                              00950002
*/* D (YES,,NO,INVALID) DOES N=3*/                                      01000002
*/* D (NO,,YES,INVALID) IS BUFFER LESS THAN 300 BYTES*/                 01050002
*/* D (YES,,NO,INVALID) WAS OPERATION A READ INITIAL*/                  01100002
*/* D (YES,,NO,INVALID) RFT TARGET ADDR FOUND IN UCB'S*/                01150002
*/* P SAVE RLNS OF REQUESTOR AND TARGET*/                               01200002
*/* D (YES,,NO,INVALID) IS DEVICE A LOCAL 3270*/                        01250002
*/* M TURN ON ON-LINE TEST IN PROGRESS BIT*/                            01300002
*/* M PUT RLN OF TARGET DEVICE IN IOBUCBX*/                             01350002
*/* P ZERO RETRY COUNT*/                                                01400002
*/* P GET NAME OF FIRST SVC LOAD*/                                      01450002
*/* L SVC 66 - GO BUILD TESTS*/                                         01500002
*/* R RETURN TO AEE*/                                                   01550002
*/*INVALID: D (NO,,YES,POST48) WAS RESETPL ISSUED*/                     01600002
*/* P SAVE THE ECB*/                                                    01650002
*/* L BALR TO READ/WRITE ROUTINE*/                                      01700002
*/* P RESTORE THE ECB*/                                                 01750002
*/* R RETURN TO AEE*/                                                   01800002
*/*POST48: P SET COMPLETION CODE TO X'48'*/                             01850002
*/* L POST*/                                                            01900002
*/* R RETURN TO AEE*/                                                   01950002
*/*ERRTEST: D (NO,,YES,EXCEPOFF) IS THE ERROR FLAG ON*/                 02000002
*/* D (NO,,YES,GOAHEAD) CHAN END, DVC END ALONE*/                       02050002
*/* D (NO,,YES,GOAHEAD) DVC END ALONE*/                                 02100002
*/* D (NO,,YES,EXCEPOFF) RETRY COUNT = 3*/                              02150002
*/* P (,STARTRFT) ADD ONE TO RETRY COUNT*/                              02200002
*/*EXCEPOFF: M TURN OFF IOB EXCEPTION BIT*/                             02250002
*/*RESTRLN: M RESTORE REQUESTOR'S RLN IN IOBUCBX*/                      02300002
*/* M (,INVALID) TURN OFF OLT IN PROGRESS BIT*/                         02350002
*/*GOAHEAD: P DECREMENT YY COUNT*/                                      02400002
*/* D (NO,,YES,RESTRLN) IS YY COUNT ZERO*/                              02450002
*/* P CLEAR RETRY COUNT*/                                               02500002
*/*STARTRFT: P SAVE THE ECB*/                                           02550002
*/* L SVC 0*/                                                           02600002
*/* P RESTORE THE ECB*/                                                 02650002
*/* R SVC 3*/                                                           02700002
*/*IGG019PI: END*/                                                      02750002
         SPACE 2                                                        02800002
*        ESTABLISH ADDRESSABILITY                                       02850002
         SPACE 1                                                        02900002
         BALR  BASEREG,0           SET UP BASE REG                      02950002
         USING *,BASEREG                                                03000002
         USING IECTIOB,IOBREG      IOB                                  03050002
         USING IHADCB,DCBREG       DCB                                  03100002
         USING UCB,UCBREG          UCB                     LD @ZA02332  03150002
         USING RFTMSG,RFTREG       REQUEST FOR TEST MSG                 03200002
         USING IECTDEB,DEBREG      DEB                                  03250002
         USING IECTDECB,DECBREG    DECB                                 03300002
         B     OLTCTL              BRANCH AROUND ID USED TO             03350002
         DC    CL8'IGG019PI'       MODULE IDENTIFIER                    03400002
         DC    XL2'4322'           REVISION DATE                        03450002
         DC    C'&SYSDATE'         DALE LAST ASSEMBLY       LD @ZA02332 03460002
PATCH    DC    12F'0'              PATCH AREA                           03500000
         DS    0F                                                       03550002
OLTCTL   L     DCBREG,IOBDCBPT     GET ADDR OF DCB                      03600002
         L     RFTREG,IOBERINF     GET ADDR OF RFT MSG                  03650002
         L     DEBREG,DCBDEBAD     GET ADDR OF DEB                      03700002
         L     DEBREG,28(DEBREG)                                        03750002
         L     DECBREG,IOBECBPT    GET ADDR OF DECB                     03800002
         CLI   FOUR(DECBREG),FOXFOX   DUMMY DECB ?             @ZA04857 03810000
         BNE   DECBSET              NO, BRANCH                 @ZA04857 03820000
         L     DECBREG,FOUR(DECBREG)   POINT TO USERS DECB     @ZA04857 03830000
         SPACE 2                                                        03850002
*        TEST FOR OLT IN PROGRESS - IF SO, NO NEED TO                   03900002
*        VALIDITY CHECK RFT                                             03950002
DECBSET  EQU   *                                               @ZA04857 03970000
         TM    IOBINCAM,ONLIN      IS OLT IN PROGRESS                   04000002
         BO    ERRTEST             YES, GO CHECK FOR ERRORS             04050002
         SPACE 2                                                        04100002
*        VALIDITY TEST THE XX, YY, AND N FIELDS OF THE RFT              04150002
         SPACE                                                          04200002
         LA    WORKREG2,4          SET CTR TO 4                         04250002
         LA    WORKREG1,TESTNUMB   GET ADDR OF XX FIELD                 04300002
NUMLOOP  TM    0(WORKREG1),NUMERIC TEST EACH BYTE OF XX&YY              04350002
*                                   FIELDS FOR NUMERIC COUNT            04400002
         BNO   INVALID             NOT NUMERIC, GET OUT                 04450002
         LA    WORKREG1,1(WORKREG1) INCREMENT POINTER                   04500002
         BCT   WORKREG2,NUMLOOP    IF NOT ALL CHECKED, LOOP             04550002
         CLC   TESTNUMB(2),TEST23  TEST = (XX) TOO LOW                  04600002
         BL    INVALID             YES, GET OUT                         04650002
         CLC   TESTNUMB(2),TEST28  TEST = TOO HIGH                      04700002
         BH    INVALID             YES, GET OUT                         04750002
         CLC   PASSCNT(2),ZERO     IS = OF TESTS (YY)   0               04800002
         BE    INVALID             NO, GET OUT                          04850002
         CLI   ADBYTCNT,THREE      DOES THE COUNT FOR = OF CHARS        04900002
*                                   IN ADDR (N) = 3                     04950002
         BNE   INVALID             NO GET OUT                           05000002
         SPACE 2                                                        05350002
*        GO TO EACH UCB AND COMPARE ADDRESS WITH ADDRESS                05400002
*        OF RFT TARGET DEVICE. IF THE ADDRESS IS FOUND AND              05450002
*        THE DEVICE IS A LOCAL 3270, CONTINUE. IF NOT, GO               05500002
*        END TEST (IE., REISSUE USER'S READ INITIAL).                   05550002
         SPACE                                                          05600002
         SR    WORKREG1,WORKREG1   CLEAR REG                            05650002
         SR    WORKREG2,WORKREG2   CLEAR REG                            05700002
         IC    WORKREG2,DEBNMEXT   GET = OF UCB ADDRS                   05750002
UCBLOOP  L     UCBREG,DEBUCBAD(WORKREG1) GET ADDR OF NEXT UCB           05800002
         CLC   UCBNAME(TRES),CUUADDR  COMPARE ADDRESSES     LD @ZA02332 05850002
         BE    UCBFOUND            IF SAME, SEE IF LOCAL 3270           05900002
         LA    WORKREG1,4(WORKREG1) POINT TO NEXT ADDR                  05950002
         BCT   WORKREG2,UCBLOOP    IF NOT ALL, GO CHECK NEXT            06000002
         B     INVALID             ADDR NOT FOUND, GET OUT              06050002
UCBFOUND MVC   IOBWORK(1),IOBUCBX    SAVE RLN OF REQUESTOR              06100002
         SR    WORKREG1,WORKREG1   CLEAR REG                            06150002
         IC    WORKREG1,DEBNMEXT   GET = OF LINES                       06200002
         SR    WORKREG1,WORKREG2   GET RLN OF RFT TARGET                06250002
         STC   WORKREG1,IOBWORK+1  SAVE RLN OF RFT TARGET               06300002
         CLI   UCBDVCLS,GRAPHIC    IS DVC A GRAPHIC         LD @ZA02332 06350002
         BNE   INVALID             NO, GET OUT                          06400002
         CLI   UCBUNTYP,A3277      IS DVC A 3277            LD @ZA02332 06450002
         BE    DVCOK               YES, SET UP FOR SVC 66               06500002
         CLI   UCBUNTYP,A3284      IS DVC A 3284            LD @ZA02332 06550002
         BE    DVCOK               YES, SET UP FOR SVC 66               06600002
         CLI   UCBUNTYP,A3286      IS DVC A 3286            LD @ZA02332 06650002
         BNE   INVALID             NO, NOT A LOCAL 3270 - GET OUT       06700002
         SPACE 2                                                        06750002
*        PREPARE TO ISSUE SVC 66                                        06800002
DVCOK    EQU   *                                             LD YA02451 06850002
         BAL   WORKREG2,GETIOB                               LD YA02451 06900002
         OI    INCAM(WORKREG1),ONLIN TURN ON OLT IN PROGRESS LD YA03248 06950000
*                                    IN MASTER IOB           LD YA03248 06960000
         SPACE                                                          07000002
         OI    IOBINCAM,ONLIN      TURN ON OLT IN PROGRESS   LD YA02451 07050002
         MVC   IOBUCBX(1),IOBWORK+1 SET UP IOB FOR TARGET DCV           07100002
         XC    IOBWORK+4(1),IOBWORK+4 ZERO RETRY COUNT                  07150002
         MVC   IOBERCCW(8),SVCNAME GET NAME OF FIRST SVC LOAD           07200002
         SPACE 2                                                        07250002
*        GET ON-LINE TEST TRANSIENTS                                    07300002
         SPACE                                                          07350002
         SVC   66                  GO BUILD TESTS                       07400002
         BR    AEEREG              RETURN TO AEE                        07450002
         SPACE 2                                                        07500002
*        ALL RFT REQUESTS (VALID AND INVALID) WILL BE       LD @ZA02332 07550000
*        POSTED COMPLETE WITH X'7F'. NO READ TI WILL BE     LD @ZA02332 07600000
*        ISSUED. FOR INVALID RFT REQUESTS, THE RESIDUAL     LD @ZA02332 07650000
*        COUNT (DECCOUNT) WILL REMAIN UNCHANGED AND THE     LD @ZA02332 07670000
*        DECPOLPT+3 BYTE WILL CONTAIN THE RLN OF THE        LD @ZA02332 07680000
*        REQUESTING DEVICE. FOR VALID RFT REQUESTS          LD @ZA02332 07690000
*        (AFTER THE TEST PATTERN HAS BEEN WRITTEN),         LD @ZA02332 07692000
*        THE RSIDUAL COUNT (DECCOUNT) WILL INDICATE THAT    LD @ZA02332 07694000
*        3 BYTES OF DATA HAD BEEN READ AND THE DECPOLPT+3   LD @ZA02332 07696000
*        BYTE WILL CONTAIN THE RLN OF THE REQUESTING        LD @ZA02332 07698000
*        DEVICE.                                            LD @ZA02332 07698400
         SPACE                                                          07700002
INVALID  EQU   *                                             LD YA02451 07750002
         L     WORKREG2,DECAREA    GET INPUT AREA ADDR      LD @ZA02332 07752000
         MVC   ZOT(L3,WORKREG2),SOHCHARS  PUT RFT...        LD @ZA02332 07754000
*                                  ...INDICATOR INTO...     LD @ZA02332 07756000
*                                  ...INPUT AREA.           LD @ZA02332 07758400
         LA    PARMREG,X7F         PUT COMP. CODE IN REG 0  LD @ZA02332 07760002
POST44   EQU   *                                            LD @ZA02332 07770002
         L     IOBREG,DCBIOBAD     GET IOB BASE ADR          LD YA02451 07800002
         SR    WORKREG2,WORKREG2   CLEAR                     LD YA02451 07850002
         IC    WORKREG2,DEBNMEXT   GET # OF DEB EXTENTS      LD YA02451 07900002
         SR    ICREG,ICREG         CLEAR                     LD YA02451 07950002
         IC    ICREG,DCBEIOBX      GET SIZE OF IOB           LD YA02451 08000002
         LA    WORKREG1,DEBUCBAD-FOUR   GET START OF UCBS    LD YA02451 08050002
NEXTIOB  LA    IOBREG,0(ICREG,IOBREG)   POINT TO EACH IOB    LD YA02451 08100002
         LA    WORKREG1,FOUR(WORKREG1)  BUMP UCBLIST PTR     LD YA02451 08150002
         L     UCBREG,0(WORKREG1)  GET NEXT UCB ADR          LD YA02451 08200002
         TM    6(UCBREG),X'E0'     OUTSTANDING I/O?          LD YA02451 08250002
         BNZ   ALLLOOP             YES, BRANCH               LD YA02451 08300002
         NI    IOBINCAM,BUSY       TURN OFF BUSY             LD YA02451 08350002
ALLLOOP  BCT   WORKREG2,NEXTIOB    LOOP UNTIL FINISHED       LD YA02451 08400002
POST     EQU   *                                            LD @ZA02332 08670002
         LR    IOBREG,DECBREG      PUT ADDR OF ECB IN REG1  LD @ZA02332 08680002
         SLL   PARMREG,TWENTY4     SHIFT TO HI ORDER BYTE   LD @ZA02332 08690002
         L     UCBREG,DEBUCBAD     GET ADDR OF MASTER UCB   LD @ZA02332 08692002
         DROP  UCBREG              DROP UCB ADDRESSABILITY  LD @ZA02332 08694002
         USING MSTRUCB,MSTREG      MSTER UCB ADDRESSABILITY LD @ZA02332 08696002
         NI    MTRGCB,READOFF      SET OFF RD ACT. & PEN.   LD @ZA02332 08698002
         DROP  MSTREG              DROP MASTER UCB ADDR.    LD @ZA02332 08698402
         USING UCB,UCBREG          UCB ADDRESSABILITY       LD @ZA02332 08698802
         POST  (1),(0)             POST THE ECB             LD @ZA02332 08699202
         BR    AEEREG              RETURN TO AEE            LD @ZA02332 08699602
         SPACE 2                                                        09600002
*        TEST THE ERROR BIT OF IOBINCAM (SET BY OLT TRANSIENTS          09650002
*        IF AN ERROR WAS FOUND). IF ON, GO END TEST.                    09700002
         SPACE                                                          09750002
         USING IECTIOB,IOBREG      IOB ADDRESSABILITY         LD YM4076 09760002
ERRTEST  EQU   *                                                        09800002
         TM    IOBINCAM,ERRORBIT   WAS AN ERROR FOUND                   09850002
         BO    EXCEPOFF            YES, GO END TEST                     09900002
         SPACE 2                                                        09950002
*        TEST IOBCSW FOR ERRORS. IF FOUND, GO TO RETRY LOGIC.           10000002
*        IF NO ERRORS, GO ON.                                           10050002
         SPACE                                                          10100002
         CLI   IOBCSW+4,CEDE       CHAN END, DVC END ALONE              10150002
         BE    GOAHEAD             YES, GO ON                           10200002
         CLI   IOBCSW+4,DE         DVC END ALONE                        10250002
         BE    GOAHEAD             YES, GO ON                           10300002
         SPACE 2                                                        10350002
*        RETRY LOGIC  RETRY UP TO THREE TIMES AND IF THERE              10400002
*        IS STILL AN ERROR, GO END TEST.                                10450002
         SPACE                                                          10500002
         SR    WORKREG1,WORKREG1   CLEAR REG                            10550002
         IC    WORKREG1,IOBWORK+4  GET RETRY COUNT                      10600002
         CH    WORKREG1,RETRY3     IS COUNT = 3                         10650002
         BE    EXCEPOFF            YES, GO END TEST                     10700002
         LA    WORKREG1,1(WORKREG1) ADD ONE TO COUNT                    10750002
         STC   WORKREG1,IOBWORK+4  RETURN NEW COUNT                     10800002
         B     STARTRFT            GO TRY AGAIN                         10850002
         SPACE 2                                                        10900002
*        TO END TEST, TURN OFF IOB EXCEPTION FLAG (IF AN ERROR          10950002
*        WAS FOUND), TURN OFF OLT IN PROGRESS FLAG, SET UP IOB          11000002
*        FOR USER'S CHANNEL PROGRAM, AND BRANCH TO READ/WRITE           11050002
*        ROUTINE.                                                       11100002
         SPACE                                                          11150002
EXCEPOFF EQU   *                                                        11200002
         NI    IOBFLAG1,IOBEXCEP   TURN OFF IOB EXCEPTION BIT           11250002
         NI    IOBINCAM,ERRBIT     TURN OFF EROR BIT                    11300002
RESTRLN  EQU   *                                                        11350002
         CLC   IOBWORK(1),IOBWORK+1 COMPARE RLN OF SOURCE AND TARGET    11400002
         BE    RESTORE             IF SAME, DON'T TURN ON INTERCEPT     11450002
         SR    WORKREG1,WORKREG1   CLEAR REG                            11500002
         IC    WORKREG1,IOBUCBX    GET RLN OF TARGET DEVICE             11550002
         SLA   WORKREG1,2          MULTIPLY BY 4 AND GET UCB ADDR       11600002
         L     UCBREG,DEBUCBAD(WORKREG1) BY INDEXING INTO DEB.          11650002
         TM    UCBFLA,UCBPST       CHECK FOR VALID IOQ       LD YA03957 11660000
*                                                                       11662002
*        SHOULD NEVER BE AN RQE, BUT CHECK TO PREVENT AN     LD YA03957 11664002
*        EXPOSURE TO SYSTEM INTEGRITY.                       LD YA03957 11666002
*                                                                       11668002
         BO    RESTORE             DON'T MESS WITH UCB IF... LD YA03957 11670002
         OI    UCBFLC,INTRCEPT     TURN ON INTRCPT BIT TO     LD YM4074 11700002
*                                  INTERCEPT NEXT REQUEST TO DVC.       11750002
RESTORE  EQU   *                                                        11800002
         MVC   IOBUCBX(1),IOBWORK  PUT REQUESTOR'S RLN BACK             11850002
         NI    IOBINCAM,ONLINOFF   TURN OFF OLT IN PROGRESS             11900002
         LH    WORKREG2,DECLNGTH   GET READ LENGTH          LD @ZA02332 11910000
         SH    WORKREG2,HALF3      SUBTRACT 3 TO MAKE       LD @ZA02332 11920000
*                                  ...IT APPEAR AS IF...    LD @ZA02332 11930000
*                                  ...ONLY 3 BYTES WERE...  LD @ZA02332 11942000
*                                  ...READ.                 LD @ZA02332 11944000
         STH   WORKREG2,DECCOUNT   UPDATE RESIDUAL COUNT    LD @ZA02332 11946000
         SR    WORKREG2,WORKREG2   CLEAR REG                LD @ZA02332 11948000
         IC    WORKREG2,IOBWORK    GET REQUESTOR RLN        LD @ZA02332 11948400
         LA    WORKREG2,ONE(WORKREG2)  ADD ONE              LD @ZA02332 11948800
         STC   WORKREG2,DECPOLPT+L3 RESTORE REUQESTOR...    LD @ZA02332*11949200
                                   ...RLN IN DECB.          LD @ZA02332 11949600
         BAL   WORKREG2,GETIOB                               LD YA02451 11950002
         NI    INCAM(WORKREG1),ONLINOFF TURN OFF OLT         LD YA02451 12000002
         NI    ONE(WORKREG1),REPLOFF  TURN OFF RESETPL      LD @ZA02332 12010000
         B     INVALID             MOVE IN SOH%/ CHAR.      LD @ZA02332 12080000
         SPACE 2                                                        12100002
*        DECREMENT YY COUNT AND IF ZERO, END TEST. OTHERWISE,           12150002
*        KEEP GOING.                                                    12200002
         SPACE                                                          12250002
GOAHEAD  EQU   *                                                        12300002
         SR    WORKREG1,WORKREG1   CLEAR REG                            12350002
         IC    WORKREG1,IOBWORK+2  GET YY COUNT                         12400002
         BCT   WORKREG1,AGAIN      IF NOT ZERO, GO AGAIN                12450002
         B     RESTORE             IF ZERO, GO END TEST     LD @ZA02332 12500002
AGAIN    STC   WORKREG1,IOBWORK+2  RETURN NEW COUNT                     12550002
         XC    IOBWORK+4(1),IOBWORK+4 CLEAR RETRY COUNT                 12600002
STARTRFT EQU   *                                                        12650002
*                                                                       12700002
*              1 LINE DELETED FOR ----->                    LD @ZA02332 12710002
*                                                                       12720002
         LR    WORKREG1,IOBREG     SAVE IOB ADDR            LD @ZA02332 12730002
         L     PARMREG,GETPARM     SET UP FOR GETMAIN       LD @ZA02332 12740002
         GETMAIN R,LV=(0)          GETMAIN FOR ECB          LD @ZA02332 12742002
         LR    WORKREG2,IOBREG     SAVE DUMMY ECB ADDR      LD @ZA02332 12744002
         LR    IOBREG,WORKREG1     RESTORE IOB ADDR         LD @ZA02332 12746002
         ST    DECBREG,FOUR(WORKREG2)  SAVE DECB ADDR       LD @ZA02332 12748002
         MVI   FOUR(WORKREG2),FOXFOX  FLAG AS DUMMY DECB    LD @ZA02332 12748402
         SR    WORKREG1,WORKREG1   CLEAR REG                LD @ZA02332 12748802
         ST    WORKREG1,DISP0(WORKREG2)   CLEAR ECB AREA    LD @ZA02332 12749202
         STCM  WORKREG2,MASK,IOBECBPT+ONE  POINT IOB...     LD @ZA02332 12749602
*                                  ...TO DUMMY              LD @ZA02332 12749702
         SVC   0                   EXCP                                 12750002
         STCM  DECBREG,MASK,IOBECBPT+ONE  REPOINT IOB...    LD @ZA02332 12760002
         L     PARMREG,GETPARM     SET UP FOR FREEMAIN      LD @ZA02332 12770002
         FREEMAIN R,LV=(0),A=(WORKREG2)  FREE DUMMY ECB     LD @ZA02332 12780002
         SVC   3                   RETURN                               12850002
*                                                                       12900002
*                                                                       12950002
GETIOB   EQU   *                                             LD YA02451 13000002
         L     WORKREG1,DCBIOBAD   GET IOB BASE ADR          LD YA02451 13050002
         LA    WORKREG1,88(WORKREG1)    ADJUST TO 1ST IOB    LD YA02451 13100002
         BR    WORKREG2            RETURN                    LD YA02451 13150002
         SPACE 2                                                        13200002
*        REGISTER EQUATES                                               13250002
         SPACE                                                          13300002
PARMREG  EQU   0                   PARAMETER REGISTER       LD @ZA02332 13310002
IOBREG   EQU   1                   ADDR OF IOB                          13350002
CVTREG   EQU   1                   ADDR OF CVT                LD YM4076 13360002
TCBREG   EQU   1                   ADDR OF TCB                LD YM4076 13370002
DUMDECB  EQU   IOBREG              ADDR OF DUMMY DECB       LD @ZA02332 13380002
DCBREG   EQU   2                   ADDR OF DCB                          13400002
UCBREG   EQU   3                   ADDR OF UCB (USED IN UCB LOOK-UP)    13450002
MSTREG   EQU   UCBREG              MASTER UCB ADDRESS       LD @ZA02332 13460002
DEBREG   EQU   4                   ADDR OF DEB                          13500002
RFTREG   EQU   5                   ADDR OF RFT MSG                      13550002
ICREG    EQU   5                   INSERT CHAR. REG          LD YA02451 13600002
WORKREG1 EQU   6                   WORK REG                             13650002
WORKREG2 EQU   7                   WORK REG                             13700002
DECBREG  EQU   8                   ADDR OF DECB                         13750002
SAVE14   EQU   11                  USED TO SAVE REG 14 CONTENTS         13800002
BASEREG  EQU   12                  BASE REGISTER                        13850002
SAVEREG  EQU   13                  ADDR OF SAVE AREA                    13900002
AEEREG   EQU   14                  ADDR OF ASYNCH EXIT EFFECTOR         13950002
RWROUT   EQU   15                  ADDR OF READ/WRITE ROUTINE           14000002
         SPACE 2                                                        14050002
*        BIT SETTINGS                                                   14100002
         SPACE                                                          14150002
ONLIN    EQU   X'01'               OLT IN PROGRESS                      14200002
NUMERIC  EQU   X'F0'               FIRST 4 BYTES OF CHARACTER           14250002
*                                   NUMBER = 'F'                        14300002
RESETPL  EQU   X'01'               RESETPL ISSUED BIT                   14350002
ERRORBIT EQU   X'02'               ERROR BIT                            14400002
CEDE     EQU   X'0C'               CHAN END, DVC END ALONE              14450002
DE       EQU   X'04'               DVC END ALONE                        14500002
IOBEXCEP EQU   X'FB'               IOB EXCEPTION BIT                    14550002
RESTART  EQU   X'FE'               RESTART FLAG                         14600002
ONLINOFF EQU   X'FE'               OLT IN PROGRESS                      14650002
REPLOFF  EQU   X'FE'               RESETPL BIT               LD YA02451 14700002
ERRBIT   EQU   X'FD'               ERROR BIT                            14750002
READOFF  EQU   X'F3'               UCBGCB-RTI ACT & PEN.    LD @ZA02332 14760002
X7F      EQU   X'7F'               COMPLETION CODE          LD @ZA02332 14770002
         SPACE 2                                                        14800002
*        DISPLACEMENTS INTO CONTROL BLOCKS                              14850002
         SPACE                                                          14900002
FSTUCB   EQU   32                  DISP OF UCB ADDRS IN DEB             14950002
OPTYPE   EQU   5                   DISP IN DECB OF OP TYPE              15000002
*        MISCELLANEOUS EQUATES                                          15050002
         SPACE                                                          15100002
THREE    EQU   X'F3'               = OF CHARS IN ADDR MUST = 3          15150002
GRAPHIC  EQU   X'10'               DEVICE CLASS - GRAPHICS              15200002
A3277    EQU   X'09'               3277 DEVIDE TYPE                     15250002
A3284    EQU   X'0A'               3284 DEVIDE TYPE                     15300002
A3286    EQU   X'0B'               3284 DEVIDE TYPE                     15350002
RDINIT   EQU   X'01'               READ INIT OPERATION VALUE            15400002
INTRCEPT EQU   X'10'               UCB IOB INTERCEPT BIT                15450002
DISP0    EQU   0                                            LD @ZA02332 15460002
TRES     EQU   3                   THREE                    LD @ZA02332 15470002
FOUR     EQU   4                   FOUR                      LD YA02451 15500002
SEVENTN  EQU   17                  OFFSET IN DUMMY DECB...  LD @ZA02332 15500402
*                                  ...FOR DUMMY ID          LD @ZA02332 15500802
TWENTY4  EQU   24                                           LD @ZA02332 15502002
THIRTY6  EQU   36                  LENGTH USED TO COPY...   LD @ZA02332 15504002
*                                  ...DUMMY DECB            LD @ZA02332 15504402
FORTY    EQU   40                  OFFSET IN DUMMY DECB...  LD @ZA02332 15504802
*                                  ...FOR DECB ADDR         LD @ZA02332 15505202
FORTY4   EQU   44                  DUMMY DECB SIZE          LD @ZA02332 15506002
ZOT      EQU   0                   ZERO                     LD @ZA02332 15508002
TWO      EQU   2                   TWO                      LD @ZA02332 15508402
L3       EQU   3                   LENGTH OF 3              LD @ZA02332 15508800
CRRNTTCB EQU   4                   OFFSET TO CURRENT TCB      LD YM5653 15510002
BUSY     EQU   X'FF'-X'40'         BUSY BIT                  LD YA02451 15550002
INCAM    EQU   28                  IOBINCAM DISP.            LD YA02451 15600002
ONE      EQU   1                   ONE                       LD YA02451 15650002
FOXFOX   EQU   X'FF'               ALL ONES                 LD @ZA02332 15660002
MASK     EQU   7                   MASK FOR STCM            LD @ZA02332 15670002
FORTY8   EQU   X'48'               RESETPL COMP. CODE       LD @ZA02332 15680002
POSTED   EQU   X'40'               POST BIT IN ECB COMP CDE LD @ZA02332 15690002
         SPACE 2                                                        15700002
*        STORAGE                                                        15750002
         DS    0F                  FULLWORD BOUNDARY        LD @ZA02332 15760002
GETPARM  DC    X'FA000008'         SUBPOOL # AND SIZE       LD @ZA02332 15770002
SOHCHARS DC    X'016C61'           SOH % / (TEST...         LD @ZA02332 15780000
*                                  ...REQUEST KEY - 3270)   LD @ZA02332 15790000
HALF3    DC    H'3'                LENGTH OF SOH%/ CHARS    LD @ZA02332 15792000
         SPACE                                                          15800002
SVCNAME  DC    C'IGC0006F'         NAME OF FIRST SVC LOAD               15850002
TEST23   DC    X'F2F3'                                                  15900002
TEST28   DC    X'F2F8'                                                  15950002
MINBUF   DC    X'012C'                                                  16000002
ZERO     DC    X'F0F0'                                                  16050002
RETRY3   DC    X'0003'             MAXIMUM NUMBER OF RETRIES            16100002
         EJECT                                                          16110002
*        CONTROL BLOCK DSECTS                                           16150002
         SPACE                                                          16200002
UCB      DSECT                                              LD @ZA02332 16210002
         IEFUCBOB                                           LD @ZA02332 16212002
         EJECT                                                          16220002
MSTRUCB  DSECT                     MASTER UCB DSECT         LD @ZA02332 16320002
MTRGCB   EQU   MSTRUCB+(UCBGCB-UCBOB)                       LD @ZA02332 16370002
         EJECT                                                          16760002
         DCBD  DSORG=BX,DEVD=BS                                         16800002
         EJECT                                                          16810002
         IECTDEBX                                                       16850002
         EJECT                                                          16860002
         IECTIOBX                                                       16900002
         EJECT                                                          16910002
         IECTDECB                                                       16950002
         EJECT                                                          16960002
CVT      DSECT                                                LD YM4076 16970002
         CVT                                                            16972002
         EJECT                                                          16974002
         IKJTCB DSECT=YES                                     LD TM4076 16976002
         EJECT                                                          16980002
RFTMSG   DSECT                                                          17000002
SOHPERC  DS    CL2                                                      17050002
TESTNUMB DS    CL2                                                      17100002
PASSCNT  DS    CL2                                                      17150002
ADBYTCNT DS    CL1                                                      17200002
CUUADDR  DS    CL3                                                      17250002
         END                                                            17300002
./  ADD  SSI=70700228,NAME=IGG019PK
         TITLE 'IGG019PK - 2741 BREAK ROUTINE '                         02000018
IGG019PK CSECT                                                          04000018
*                        ROUTINE TO TEST FOR 2741 BREAK                 06000018
*                             BY  1. ISSUING PREPARE COMMAND            08000018
*                                 2. ISSUING HALT I/O                   10000018
*                             SCHEDUALED FROM IGG019MB - CHANNEL END    12000018
*                             RESULTS ANALYZED BY CHENNEL END APPENDAGE 14000018
*********************************************************************** 14200000
*                                                                     * 14400000
*                      MAINTENANCE ACTIVITY                           * 14600000
*                                                                     * 14800000
*                      ZA08045   (02/27/76)                           * 15000000
*                                                                     * 15200000
*********************************************************************** 15400000
         USING IHADCB,DCBREG                                            16000018
         USING IECTDECB,DECBREG                                         18000018
         USING IECTIOB,IOBREG                                           20000018
         USING *,BASEREG                                                22000018
         LR    BASEREG,15                                               24000018
         B     START   BRANCH AROUND ID AND PATCH AREA                  24200000
         DC    C'IGG019PK'    TO LOCATE IN DUMP                         24400000
         DC    C'** MVS *'                                              24600000
         DC    C'&SYSDATE'    ASSEMBLY DATE                             24800000
PATCH    DC    48XL1'00'      PATCH AREA                                25000000
START    DS    0H                                                       25200000
         LR    IOBREG,PARMREG         LOAD ADDRESS OF IOB               26000000
         L     DECBREG,IOBECBPT       LOAD ADDRESS OF ECB               27000000
         L     CCWREG,IOBSTART      LOAD ADDRESS OF IOBSTART            28000000
         L     DCBREG,IOBDCBPT        LOAD ADDRESS OF DCB               29000000
         MVC   0(8,CCWREG),PREPARE  MOVE PREPARE CCW INTO IOB           30000000
         L     RZERO,GETPARM    GET 8 BYTES                    @ZA08045 31000000
         GETMAIN R,LV=(0)       GET AREA FOR DUMMY DECB        @ZA08045 32000000
         LR    ECBSAVE,PARMREG  GET ADDRESS OF DUMMY DECB      @ZA08045 33000000
         ST    DECBREG,FOUR(ECBSAVE) SAVE ECB IN DUMMY + 4     @ZA08045 34000000
         MVI   FOUR(ECBSAVE),XFF     INDICATE DUMMY            @ZA08045 35000000
         STCM  ECBSAVE,MASK7,IOBECBPT+ONE PUT DUMMY INTO IOB   @ZA08045 36000000
         LR    PARMREG,IOBREG   GET IOB ADDRESS                @ZA08045 37000000
         LR    WREG,ECBSAVE     GET ADDRESS OF DUMMY DECB      @ZA08045 38000000
         SVC   0                   EXCP                                 39300000
         STCM  DECBREG,MASK7,IOBECBPT+ONE  UPDATE DUMMY ADDR   @ZA08045 40200000
         TM    ZERO(ECBSAVE),POSTBIT   IS DUMMY POSTED?        @ZA08045 41100000
         BNO   NOPOST                      NO                  @ZA08045 42000000
         L     RZERO,ZERO(ECBSAVE)  GET ECB ADDRESS            @ZA08045 42900000
         POST  (DECBREG),(RZERO)    POST ECB                   @ZA08045 43800000
NOPOST   EQU   *                                               @ZA08045 44700000
         L     RZERO,GETPARM        RELEASE 8 BYTES            @ZA08045 45600000
         FREEMAIN  R,LV=(0),A=(ECBSAVE)  RELEASE DUMMY AREA    @ZA08045 46500000
         L     WREG,DCBDEBAD    LOAD ADDRESS OF DEB                     47400000
         SR    PARMREG,PARMREG    ZERO PARMREG                          48300000
         IC    PARMREG,IOBUCBX    PUT RLN INTO PARMREG                  49200000
         SLL   PARMREG,2      GET DISPLACEMENT INTO UCB ADD LIST        50100000
         L     PARMREG,DEBUCBAD(PARMREG,WREG) LOAD ADD OF LINE UCB      51000000
         IOHALT (1)                                                     52000018
         SVC   3                        RETURN                          54000018
*                                                                       56000018
PREPARE  DC    X'0600000020230001'                                      58000018
         DS    0F                                              @ZA08045 58300000
GETPARM  DC    X'FA000008'                                     @ZA08045 58600000
ZERO     EQU   0                                               @ZA08045 58900000
RZERO    EQU   0                                               @ZA08045 59200000
ONE      EQU   1                                               @ZA08045 59500000
PARMREG  EQU   1                                                        60000018
IOBREG   EQU   2                                                        62000018
CCWREG   EQU   3                                                        64000018
FOUR     EQU   4                                               @ZA08045 65000000
WREG     EQU   4                                                        66000018
DECBREG  EQU   5                                                        68000018
DCBREG   EQU   6                                                        70000018
ECBSAVE  EQU   7                                               @ZA08045 70600000
MASK7    EQU   7                                               @ZA08045 71300000
BASEREG  EQU   12                                                       72000018
DEBUCBAD EQU   32                                                       74000018
POSTBIT  EQU   X'40'                                           @ZA08045 74600000
XFF      EQU   X'FF'                                           @ZA08045 75300000
*                                                                       76000018
         CNOP  0,8                                                      78000018
         EJECT                                                          80000018
         DCBD  DSORG=BX                                                 82000018
         EJECT                                                          84000018
         IECTDECB                                                       86000018
         EJECT                                                          88000018
         IECTIOBX                                                       90000018
         EJECT                                                          92000018
         END                                                            94000018
./  ADD  SSI=13160099,NAME=IGG019PL
         TITLE   'IGG019PL - IBM 2740 CHECKING,OIU'                     01000018
IGG019PL CSECT                                                          02000018
*00011290013400-013800                                                  03000018
         SPACE 2                                                        04000018
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 05000018
         SPACE                                                          06000018
*FUNCTION -                                                             07000018
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       08000018
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        09000018
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        10000018
*              CHANNEL PROGRAMS.                                        11000018
         SPACE 2                                                        12000018
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     13000018
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        14000018
*              OPERATION.                                               15000018
         SPACE 2                                                        16000018
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       17000018
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       18000018
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  19000018
         SPACE 4                                                        20000018
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  21000018
         SPACE                                                          22000018
*                   DC   X'0403050906820008'                            23000018
         SPACE                                                          24000018
*                        04 = COUNT OF CCW'S                            25000018
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  26000018
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  27000018
*                             INDICATES RESET)                          28000018
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  29000018
         SPACE 4                                                        30000018
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         31000018
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     32000018
*        AT OPEN TIME.                                                  33000018
         EJECT                                                          34000018
A        DC    X'FF'                                                    35000018
         DC    AL1(RI-A)                READ INITIAL                    36000018
         DC    AL1(WI-A)                WRITE INITIAL                   37000018
         DC    AL1(RC-A)                READ CONTINUE                   38000018
         DC    AL1(WC-A)                WRITE CONTINUE                  39000018
         DC    X'FF'                                                    40000018
         DC    AL1(WV-A)                WRITE CONVERSATIONAL            41000018
         DC    AL1(RR-A)                READ REPEAT                     42000018
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               43000018
         DC    AL1(RS-A)                READ SKIP                       44000018
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           45000018
         DC    X'FF'                                                    46000018
         DC    AL1(WTIO-A)              WRITE INITIAL OPTICAL           47000018
         DC    AL1(RTTA-A)              READ CONTINUE W LEADING ACKN.   48000018
         DC    AL1(WTCO-A)              WRITE INVITATIONAL OPTICAL      49000018
         DC    9X'FF'                                                   50000018
         DC    AL1(C-A)                 OFFSET TO CCW'S                 51000018
         DC    7X'FF'                                                   52000018
         SPACE 2                                                        53000018
*                   CHANNEL PROGRAMS                                    54000018
RI       DC    X'040B060C088101'        READ INITIAL                    55000018
WI       DC    X'030509078102'          WRITE INITIAL                   56000018
RC       DC    X'0203088101'            READ CONTINUE                   57000018
WC       DC    X'0209078102'            WRITE CONTINUE                  58000018
WV       DC    X'030009078102'          WRITE CONVERSATIONAL            59000018
RR       DC    X'0204088101'            READ REPEAT                     60000018
WA       DC    X'0101'                  WRITE ACKNOWLEDGE               61000018
RS       DC    X'010A'                  READ SKIP                       62000018
WN       DC    X'0102'                  WRITE NEG-ACKNOWLEDGE           63000018
WTIO     DC    X'050D100E0F02'          WRITE TIO                       64000018
RTTA     DC    X'0411060C08'            READ CONTINUE W LEADING ACKN.   64500018
WTCO     DC    X'080D100E0F0B060C08'    WRITE TCO                       65000018
         SPACE 3                                                        66000018
*                   C C W 'S               I/O      F L A G S    LENGTH 67000018
*                                       OPERATION CD   CC   SLI    =    68000018
C        DC    X'010C009080020001'      WR D      X              1      69000018
         DC    X'010C009020210004'      WR DCCC             X    4      70000018
         DC    X'010C009120210003'      WR CCC              X    3      71000018
         DC    X'010C009460020001'      WR Y           X    X    1      72000018
         DC    X'010C009560020001'      WR N           X    X    1      73000018
         DC    X'010C009680020010'      WR D+IDLE X             16      74000018
         DC    X'0600000060010001'      PREPARE        X    X    1      75000018
         DC    X'0208000100200001'      RD RESP                  1      76000018
         DC    X'0204000020110400'      RD DATA             X    N      77000018
         DC    X'0104000060110400'      WR DATA        X    X    N      78000018
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X    N      79000018
         DC    X'010C009160210003'      WR CCC         X    X    3      80000018
         DC    X'0448000060040001'      SENSE          X    X    1      81000018
         DC    X'010C00A680020003'      WR DPRE O X              3      82000018
         DC    X'010C00A960080001'      WR B           X    X    1      83000018
         DC    X'0208000160200001'      RD RESP        X    X    1      84000018
         DC    X'0150000080110003'      WR FRAME  X              3      85000018
         DC    X'010C009060210004'      WR DCCC        X    X     4     85500018
         SPACE 2                                                        86000018
CC       EQU   *-C                      OFFSET TO CONTROL CHARS.        87000018
         DC    X'16'                    CIRCLE D                        88000018
         DC    X'1F1F1F'                CIRCLE C'S                      89000018
         DC    X'76'                    CIRCLE Y                        90000018
         DC    X'40'                    CIRCLE N                        91000018
         DC    X'165E5E5E5E5E5E5E5E5E5E5E5E5E5E5E' CIRCLE D, 15 IDLES   92000018
         DC    X'163E4C'                CIRCLE D PRE O                  93000018
         DC    X'3D'                    CIRCLE B                        94000018
         CNOP  0,8                                                      95000018
         END                                                            96000018
./  ADD  SSI=13160100,NAME=IGG019PM
         TITLE 'IGG019PM - IBM 2740 CHECKING,OIU,DIAL'                  00900018
IGG019PM CSECT                                                          01800018
         SPACE 2                                                        02700018
* STATUS -          CHANGE LEVEL  001   AUGUST 28,1967             000B 03600018
         SPACE                                                          04500018
*FUNCTION -                                                             05400018
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       06300018
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        07200018
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        08100018
*              CHANNEL PROGRAMS.                                        09000018
         SPACE 2                                                        09900018
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     10800018
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        11700018
*              OPERATION.                                               12600018
         SPACE 2                                                        13500018
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       14400018
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       15300018
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  16200018
         SPACE 4                                                        17100018
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  18000018
         SPACE                                                          18900018
*                   DC   X'0403050906820008'                            19800018
         SPACE                                                          20700018
*                        04 = COUNT OF CCW'S                            21600018
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  22500018
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  23400018
*                             INDICATES RESET)                          24300018
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  25200018
         SPACE 4                                                        26100018
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         27000018
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     27900018
*        AT OPEN TIME.                                                  28800018
         EJECT                                                          29700018
A        DC    X'FF'                                                    30600018
         DC    AL1(RI-A)                READ INITIAL                    31500018
         DC    AL1(WI-A)                WRITE INITIAL                   32400018
         DC    AL1(RC-A)                READ CONTINUE                   33300018
         DC    AL1(WC-A)                WRITE CONTINUE                  34200018
         DC    AL1(RV-A)                READ CONVERSATIONAL             35100018
         DC    AL1(WV-A)                WRITE CONVERSATIONAL            36000018
         DC    AL1(RR-A)                READ REPEAT                     36900018
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               37800018
         DC    AL1(RS-A)                READ SKIP                       38700018
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           39600018
         DC    X'FF'                                                    40500018
         DC    AL1(WTIO-A)              WRITE INITIAL OPTICAL           41400018
         DC    AL1(RTTA-A)              READ CONTINUE W LEADING ACKN.   42300018
         DC    AL1(WTCO-A)              WRITE INVITATIONAL OPTICAL      43200018
         DC    X'FF'                                                    44100018
         DC    X'FF'                                                    45000018
         DC    X'FF'                                                    45900018
         DC    AL1(WTVO-A)              WRITE CONVERSATIONAL OPT.       46800018
         DC    5X'FF'                                                   47700018
         DC    AL1(C-A)                 OFFSET TO CCW'S                 48600018
         DC    7X'FF'                                                   49500018
         SPACE 2                                                        50400018
*                   CHANNEL PROGRAMS                                    51300018
RI       DC    X'0508060F100B820109'    READ INITIAL                    52200018
WI       DC    X'06080705000C0A820209'  WRITE INITIAL                   53100018
RC       DC    X'02030B820109'          READ CONTINUE                   54000018
WC       DC    X'020C0A820209'          WRITE CONTINUE                  54900018
RV       DC    X'040E0F100B820109'      READ CONVERSATIONAL             55800018
WV       DC    X'03000C0A820209'        WRITE CONVERSATIONAL            56700018
RR       DC    X'02040B820109'          READ REPEAT                     57600018
WA       DC    X'020109'                WRITE ACKNOWLEDGE               58500018
RS       DC    X'010D'                  READ SKIP                       59400018
WN       DC    X'020209'                WRITE NEG-ACKNOWLEDGE           60300018
WTIO     DC    X'080807051113121516'    WRITE INITIAL OPTICAL           61200018
RTTA     DC    X'04010F100B'            READ CONTINUE W LEADING ACKN.   61600018
WTCO     DC    X'08111412150E0F100B'    WRITE INVITATIONAL OPTICAL      62100018
WTVO     DC    X'051114121516'          WRITE CONVERSATIONAL OPT.       63900018
         SPACE 3                                                        64800018
*                   C C W 'S               I/O      F L A G S    LENGTH 65700018
*                                       OPERATION CD   CC   SLI    =    66600018
C        DC    X'010C00B880020001'      WR D      X              1      67500018
         DC    X'010C00B860210004'      WR D,CCC       X    X    4      68400018
         DC    X'010C00B960210003'      WR CCC         X    X    3      69300018
         DC    X'010C00BC60020001'      WR Y           X    X    1      70200018
         DC    X'010C00BD60020001'      WR N           X    X    1      71100018
         DC    X'010C00C26001000F'      WR PAD        X    X    15      72000018
         DC    X'2700000060010001'      ENABLE         X    X    1      72900018
         DC    X'2910000160010000'      DIAL           X    X    N      73800018
         DC    X'2F00000060010001'      DISABLE        X    X    1      74700018
         DC    X'2F00000020210001'      DISABLE             X    1      75600018
         DC    X'0208000100200001'      RD RESP                  1      76500018
         DC    X'0204000020110400'      RD DATA             X    N      77400018
         DC    X'0104000060110400'      WR DATA             X    N      78300018
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X    N      79200018
         DC    X'010C00B960020003'      WR CCC         X    X    3      80100018
         DC    X'0600000060010001'      PREPARE        X    X    1      81000018
         DC    X'0448000060040001'      SENSE          X    X    1      81900018
         DC    X'010C00BE80020003'      WR DPRE O X              3      82800018
         DC    X'010C00C160080001'      WR B           X    X    1      83700018
         DC    X'0154000080110003'      WR FRAME  X              3      84600018
         DC    X'0150000080110003'      WR FRAME  X              3      85500018
         DC    X'0208000160200001'      RD RESP        X    X    1      86400018
         DC    X'010C00B920210003'      WR CCC              X    3      87300018
         SPACE 2                                                        89100018
CC       EQU   *-C                      OFFSET TO CONTROL CHARS.        90000018
         DC    X'16'                    CIRCLE D                        90900018
         DC    X'1F1F1F'                CIRCLE C                        91800018
         DC    X'76'                    CIRCLE Y                        92700018
         DC    X'40'                    CIRCLE N                        93600018
         DC    X'163E4C'                CIRCLE D PRE O                  94500018
         DC    X'3D'                    CIRCLE B                        95400018
         DC    15X'DF'                  PAD CHARACTERS                  96300018
         CNOP  0,8                                                      97200018
         END                                                            98100018
./  ADD  SSI=13160101,NAME=IGG019PN
         TITLE 'IGG019PN - IBM 1050 NON-SWITCHED DEVICE I/O MODULE'     01000019
IGG019PN CSECT                                                          02000019
         SPACE 2                                                        03000019
* STATUS -          CHANGE LEVEL  000   24 FEBUARY 1969                 04000019
         SPACE                                                          05000019
*FUNCTION -                                                             06000019
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       07000019
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        08000019
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        09000019
*              CHANNEL PROGRAMS.                                        10000019
         SPACE 2                                                        11000019
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     12000019
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        13000019
*              OPERATION.                                               14000019
         SPACE 2                                                        15000019
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       16000019
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       17000019
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  18000019
         SPACE 4                                                        19000019
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  20000019
         SPACE                                                          21000019
*                   DC   X'0403050906820008'                            22000019
         SPACE                                                          23000019
*                        04 = COUNT OF CCW'S                            24000019
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  25000019
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  26000019
*                             INDICATES RESET)                          27000019
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  28000019
         SPACE 4                                                        29000019
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         30000019
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     31000019
*        AT OPEN TIME.                                                  32000019
         EJECT                                                          33000019
A        DC    X'FF'                                                    34000019
         DC    AL1(RI-A)                READ INITIAL                    35000019
         DC    AL1(WI-A)                WRITE INITIAL                   36000019
         DC    AL1(RC-A)                READ CONTINUE                   37000019
         DC    AL1(WC-A)                WRITE CONTINUE                  38000019
         DC    X'FF'                                                    39000019
         DC    X'FF'                                                    40000019
         DC    AL1(RR-A)                READ REPEAT                     41000019
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               42000019
         DC    AL1(RS-A)                READ SKIP                       43000019
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           44000019
         DC    X'FF'                                                    45000019
         DC    X'FF'                                                    46000019
         DC    X'FF'                                                    47000019
         DC    X'FF'                                                    48000019
         DC    AL1(WTTV-A)           0F WRITE CONTINUE CONVERSATIONAL   49000019
         DC    8X'FF'                                                   50000019
         DC    AL1(C-A)                 OFFSET TO CCW'S                 51000019
         DC    7X'FF'                                                   52000019
         SPACE 2                                                        53000019
*                   CHANNEL PROGRAMS                                    54000019
RI       DC    X'040005070B810E'        READ INITIAL                    55000019
WI       DC    X'06000608020C098101'    WRITE INITIAL                   56000019
RC       DC    X'02030A810E'            READ CONTINUE                   57000019
WC       DC    X'020C098101'            WRITE CONTINUE                  58000019
RR       DC    X'02040A810E'            READ REPEAT                     59000019
WA       DC    X'010E'                  WRITE ACKNOWLEDGE               60000019
RS       DC    X'010D'                  READ SKIP                       61000019
WN       DC    X'0101'                  WRITE NEG-ACKNOWLEDGE           62000019
WTTV     DC    X'06100F0005070B'        WRITE CONTINUE CONVERSATIONAL   63000019
         SPACE 3                                                        64000019
*                   C C W 'S               I/O      F L A G S    LENGTH 65000019
*                                       OPERATION CD   CC   SLI    =    66000019
C        DC    X'010C008980020003'      WR CCC    X                     67000019
         DC    X'010C008920210003'      WR CCC              X      3    68000019
         DC    X'010C008880080001'      WR D      X                1    69000019
         DC    X'010C008C60020001'      WR Y           X    X      1    70000019
         DC    X'010C008D60020001'      WR N           X    X      1    71000019
         DC    X'0114040060030002'      WR POLL        X    X      2    72000019
         DC    X'0114000060030002'      WR ADRS        X    X      2    73000019
         DC    X'0A04000080050002'      RD RESP   X              2      74000019
         DC    X'0208000000060001'      RD RESP                    1    75000019
         DC    X'0208000100200001'      RD RESP                    1    76000019
         DC    X'0A04000020110400'      INHIBIT             X      N    77000019
         DC    X'0A04000220110402'      INHIBIT             X      N-2  78000019
         DC    X'0104000060110400'      WR DATA        X    X      N    79000019
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    80000019
         DC    X'010C008820210004'       WR DCCC            X      4    81000019
         DC    X'0208000160200001'      RD RESP        X   X     1 000M 82000019
         DC    X'0138000060110800'      WR DATA        X    X   N       83000019
         SPACE 2                                                        84000019
CC       EQU   *-C                      SPECIAL CHARACTER OFFSET        85000019
         DC    X'16'                    CIRCLE D                        86000019
         DC    X'1F1F1F'                CIRCLE C                        87000019
         DC    X'76'                    CIRCLE Y                        88000019
         DC    X'40'                    CIRCLE N                        89000019
         CNOP  0,8                                                      90000019
         END                                                            91000019
./  ADD  SSI=13160102,NAME=IGG019PO
         TITLE 'IGG019PO - 1050 SWITCHED DEVICE I/O MODULE'             00900019
IGG019PO CSECT                                                          01800019
         SPACE 2                                                        02700019
* STATUS -          CHANGE LEVEL  000   24 FEBUARY 1969                 03600019
         SPACE                                                          04500019
*FUNCTION -                                                             05400019
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       06300019
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        07200019
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        08100019
*              CHANNEL PROGRAMS.                                        09000019
         SPACE 2                                                        09900019
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     10800019
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        11700019
*              OPERATION.                                               12600019
         SPACE 2                                                        13500019
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       14400019
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       15300019
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  16200019
         SPACE 4                                                        17100019
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  18000019
         SPACE                                                          18900019
*                   DC   X'0403050906820008'                            19800019
         SPACE                                                          20700019
*                        04 = COUNT OF CCW'S                            21600019
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  22500019
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  23400019
*                             INDICATES RESET)                          24300019
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  25200019
         SPACE 4                                                        26100019
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         27000019
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     27900019
*        AT OPEN TIME.                                                  28800019
         EJECT                                                          29700019
A        DC    X'FF'                 00                                 30600019
         DC    AL1(RI-A)             01 READ INITIAL                    31500019
         DC    AL1(WI-A)             02 WRITE INITIAL                   32400019
         DC    AL1(RC-A)             03 READ CONTINUE                   33300019
         DC    AL1(WC-A)             04 WRITE CONTINUE                  34200019
         DC    AL1(RV-A)             05 READ CONVERSATIONAL             35100019
         DC    AL1(WV-A)             06 WRITE CONVERSATIONAL            36000019
         DC    AL1(RR-A)             07 READ REPEAT                     36900019
         DC    AL1(WA-A)             08 WR ACKNOWLEDGE                  37800019
         DC    AL1(RS-A)             09 READ-SKIP                       38700019
         DC    AL1(WN-A)             0A WR NEG-ACKNOWLEDGE              39600019
         DC    X'FF'                 0B                                 40500019
         DC    X'FF'                 0C                                 41400019
         DC    X'FF'                 0D                                 42300019
         DC    X'FF'                 0E                                 43200019
         DC    AL1(WTTV-A)           0F WRITE CONTINUE CONVERSATIONAL   44100019
         DC    8X'FF'                                                   45000019
         DC    AL1(C-A)                                                 45900019
         DC    7X'FF'                                                   46800019
         SPACE 2                                                        47700019
*                   CHANNEL PROGRAMS                                    48600019
RI       DC    X'070A0907010C0E1182030B'         READ INITIAL           49500019
WI       DC    X'090A0907010D0F04131082000B'     WRITE INITIAL          50400019
RC       DC    X'02061282030B'                   READ CONTINUE          51300019
WC       DC    X'02131082000B'                   WRITE CONTINUE         52200019
RV       DC    X'04010C0E1182030B'               READ CONVERSATION      53100019
WV       DC    X'06020D0F04131082000B'           WRITE CONVERSATION     54000019
RR       DC    X'02051282030B'                   READ REPEAT            54900019
WA       DC    X'02030B'                         WRITE ACKNOWLEDGE      55800019
WN       DC    X'02000B'                         WRITE NEG-ACKNOWLEDGE  56700019
RS       DC    X'0114'                            READ SKIP             57600019
WTTV     DC    X'061615010C0E11'        WRITE CONTINUE CONVERSATIONAL   58500019
         SPACE  3                                                       59400019
*                   C C W 'S               I/O      F L A G S           60300019
*                                       OPERATION CD   CC   SLI  L=     61200019
C        DC    X'010C00B960210001'      WR   C         X    X   1       62100019
         DC    X'010C00B980020003'      WR CCC   X               3      63000019
         DC    X'010C00B880020004'      WR DCCC   X                4    63900019
         DC    X'010C00B860210002'      WR DC          X    X    I      64800019
         DC    X'010C00B880080001'      WR D     X               1      65700019
         DC    X'010C00BC60020001'      WR N           X    X    1      66600019
         DC    X'010C00BD60020001'      WR Y           X    X    1      67500019
         DC    X'010C00BE6001000F'      WR PAD        X    X   15       68400019
         DC    X'2700000020010001'      ENABLE              X    1      69300019
         DC    X'2910000160010000'      DIAL           X    X    N      70200019
         DC    X'2F20000060010001'      DISABLE        X    X    1      71100019
         DC    X'2F00000020210001'      DISABLE             X    1      72000019
         DC    X'011C040060030002'      WR POLL       X    X    2       72900019
         DC    X'011C000060030002'      WR ADRS       X    X    2       73800019
         DC    X'0A04000080050002'      RD RESP   X              2      74700019
         DC    X'0208000000060001'      RD RESP                  1      75600019
         DC    X'0208000100200001'      RD RESP                  1      76500019
         DC    X'0A04000220110402'      INHIBIT             X      N-2  77400019
         DC    X'0A04000020110400'      INHIBIT             X    N      78300019
         DC    X'0104000060110400'      WR DATA        X    X   N       79200019
         DC    X'0200000030220400'      RD-SKIP   SKIP FLAG X    N      80100019
         DC    X'0208000160200001'      RD RESP        X   X     1 000M 81000019
         DC    X'0138000060110800'      WR DATA        X    X   N       81900019
         SPACE 2                                                        82800019
CC       EQU   *-C                      SPECIAL CHARACTER OFFSET        83700019
         DC    X'16'                    CIRCLE D                        84600019
         DC    X'1F1F1F'                CIRCLE C                        85500019
         DC    X'40'                    CIRCLE N                        86400019
         DC    X'76'                    CIRCLE Y                        87300019
         DC    15X'DF'                  PAD CHARACTER                   88200019
         CNOP  0,8                                                      89100019
         END                                                            90000019
./  ADD  SSI=13160103,NAME=IGG019PP
         TITLE 'IGG019PP - IBM 2740X(CHECKING)'                         01000019
IGG019PP CSECT                                                          02000019
         SPACE 2                                                        03000019
* STATUS -          CHANGE LEVEL  000   FEBURARY 20, 1969               04000019
         SPACE                                                          05000019
*FUNCTION -                                                             06000019
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       07000019
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        08000019
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        09000019
*              CHANNEL PROGRAMS.                                        10000019
         SPACE 2                                                        11000019
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     12000019
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        13000019
*              OPERATION.                                               14000019
         SPACE 2                                                        15000019
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       16000019
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       17000019
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  18000019
         SPACE 4                                                        19000019
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  20000019
         SPACE                                                          21000019
*                   DC   X'0403050906820008'                            22000019
         SPACE                                                          23000019
*                        04 = COUNT OF CCW'S                            24000019
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  25000019
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  26000019
*                             INDICATES RESET)                          27000019
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  28000019
         SPACE 4                                                        29000019
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         30000019
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     31000019
*        AT OPEN TIME.                                                  32000019
         EJECT                                                          33000019
A        DC    X'FF'                                                    34000019
         DC    AL1(RI-A)                READ INITIAL                    35000019
         DC    AL1(WI-A)                WRITE INITIAL                   36000019
         DC    AL1(RC-A)                READ CONTINUE                   37000019
         DC    AL1(WC-A)                WRITE CONTINUE                  38000019
         DC    X'FF'                                                    39000019
         DC    AL1(WV-A)                WRITE CONVERSATIONAL            40000019
         DC    AL1(RR-A)                READ REPEAT                     41000019
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               42000019
         DC    AL1(RS-A)                READ SKIP                       43000019
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           44000019
         DC    4X'FF'                                                   45000019
         DC    AL1(WTTV-A)              WRITE CONTINUE CONVERSATIONAL0J 46000019
         DC    8X'FF'                                              000J 47000019
         DC    AL1(C-A)                 OFFSET TO CCW'S                 48000019
         DC    7X'FF'                                                   49000019
         SPACE 2                                                        50000019
*                   CHANNEL PROGRAMS                                    51000019
RI       DC    X'040B060C088101'        READ INITIAL                    52000019
WI       DC    X'030509078102'          WRITE INITIAL                   53000019
RC       DC    X'0203088101'            READ CONTINUE                   54000019
WC       DC    X'0209078102'            WRITE CONTINUE                  55000019
WV       DC    X'030009078102'          WRITE CONVERSATIONAL            56000019
RR       DC    X'0204088101'            READ REPEAT                     57000019
WA       DC    X'0101'                  WRITE ACKNOWLEDGE               58000019
RS       DC    X'010A'                  READ SKIP                       59000019
WN       DC    X'0102'                  WRITE NEG-ACKNOWLEDGE           60000019
WTTV     DC    X'060D0E0B060C08'        WRITE CONTINUE CONVERSATION     61000019
         SPACE 3                                                        62000019
*                   C C W 'S               I/O      F L A G S    LENGTH 63000019
*                                       OPERATION CD   CC   SLI    =    64000019
C        DC    X'010C007880020001'      WR D      X              1      65000019
         DC    X'010C007820210004'      WR DCCC             X    4      66000019
         DC    X'010C007920210003'      WR CCC              X    3      67000019
         DC    X'010C007C60020001'      WR Y           X    X    1      68000019
         DC    X'010C007D60020001'      WR N           X    X    1      69000019
         DC    X'010C007E80020010'      WR D+IDLE X             16      70000019
         DC    X'0600000060010001'      PREPARE        X    X      1    71000019
         DC    X'0208000100200001'      RD RESP                    1    72000019
         DC    X'0A04000020110400'      INHIBIT             X           73000019
         DC    X'0104000060110400'      WR DATA        X    X      N    74000019
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    75000019
         DC    X'010C007960020003'      WR CCC         X    X    3      76000019
         DC    X'0448000060050001'      SENSE          X    X           77000019
         DC    X'0138000060110800'      WR DATA             X      N    78000019
         DC    X'0208000160200001'      RD RESP        X    X    1      79000019
         SPACE 2                                                        80000019
CC       EQU   *-C                      OFFSET TO CONTROL CHARS.        81000019
         DC    X'16'                    CIRCLE D                        82000019
         DC    X'1F1F1F'                CIRCLE C'S                      83000019
         DC    X'76'                    CIRCLE Y                        84000019
         DC    X'40'                    CIRCLE N                        85000019
         DC    X'165E5E5E5E5E5E5E5E5E5E5E5E5E5E5E' CIRCLE D, 15 IDLES   86000019
         CNOP  0,8                                                      87000019
         END                                                            88000019
./  ADD  SSI=13160104,NAME=IGG019PQ
         TITLE 'IGG019PQ - IBM 2740X DIAL WITH CHECKING'                01000019
IGG019PQ CSECT                                                          02000019
         SPACE 2                                                        03000019
* STATUS -          CHANGE LEVEL  000   FEBURARY 20, 1969               04000019
         SPACE                                                          05000019
*FUNCTION -                                                             06000019
*              THE DEVICE INPUT/OUTPUT MODULE PROVIDES THE DEVICE       07000019
*              DEPENDENT VARIABLE INFORMATION NEEDED BY THE BTAM        08000019
*              READ/WRITE ROUTINE TO PREPARE THE TELE-PROCESSING        09000019
*              CHANNEL PROGRAMS.                                        10000019
         SPACE 2                                                        11000019
*              EACH OF THE FIRST 32 BYTES CONTAINS AN OFFSET TO THE     12000019
*              CHANNEL COMMAND WORD OFFSETS FOR EACH TYPE OF I/O        13000019
*              OPERATION.                                               14000019
         SPACE 2                                                        15000019
*              FOLLOWING THE CCW OFFSETS ARE ALL OF THE DIFFERENT       16000019
*              CCW'S THAT ARE USED BY THIS DEVICE TYPE. FOLLOWING       17000019
*              THE CCW'S ARE THE NECESSARY SPECIAL CONTROL CHARACTERS.  18000019
         SPACE 4                                                        19000019
*              EXAMPLE OF CCW OFFSETS (I.E. CONDENSED CHANNEL PROGRAM)  20000019
         SPACE                                                          21000019
*                   DC   X'0403050906820008'                            22000019
         SPACE                                                          23000019
*                        04 = COUNT OF CCW'S                            24000019
*               03,05,09,06 = CCW'S 3,5,9 & 6 COMPRISE CHANNEL PROGRAM  25000019
*                        82 = COUNT OF RESET FUNCTION CCW'S (0 BIT = 1  26000019
*                             INDICATES RESET)                          27000019
*                     00,08 = CCW'S 0 & 8 COMPRISE RESET CHANNEL PROG.  28000019
         SPACE 4                                                        29000019
*        THE DEVICE I/O MODULE CONTAINS NO EXECUTABLE CODE. ITS         30000019
*        ADDRESS IS LOADED INTO THE BTAM READ/WRITE ROUTINE BY OPEN     31000019
*        AT OPEN TIME.                                                  32000019
         EJECT                                                          33000019
A        DC    X'FF'                                                    34000019
         DC    AL1(RI-A)                READ INITIAL                    35000019
         DC    AL1(WI-A)                WRITE INITIAL                   36000019
         DC    AL1(RC-A)                READ CONTINUE                   37000019
         DC    AL1(WC-A)                WRITE CONTINUE                  38000019
         DC    AL1(RV-A)                READ CONVERSATIONAL             39000019
         DC    AL1(WV-A)                WRITE CONVERSATIONAL            40000019
         DC    AL1(RR-A)                READ REPEAT                     41000019
         DC    AL1(WA-A)                WRITE ACKNOWLEDGE               42000019
         DC    AL1(RS-A)                READ SKIP                       43000019
         DC    AL1(WN-A)                WRITE NEG-ACKNOWLEDGE           44000019
         DC    4X'FF'                                                   45000019
         DC    AL1(WTTV-A)              WRITE CONTINUE CONVERSATIONAL0J 46000019
         DC    8X'FF'                                                   47000019
         DC    AL1(C-A)                 OFFSET TO CCW'S                 48000019
         DC    7X'FF'                                                   49000019
         SPACE 2                                                        50000019
*                   CHANNEL PROGRAMS                                    51000019
RI       DC    X'0508060F100B820109'    READ INITIAL                    52000019
WI       DC    X'06080705000C0A820209'  WRITE INITIAL                   53000019
RC       DC    X'02030B820109'          READ CONTINUE                   54000019
WC       DC    X'020C0A820209'          WRITE CONTINUE                  55000019
RV       DC    X'040E0F100B820109'      READ CONVERSATIONAL             56000019
WV       DC    X'03000C0A820209'        WRITE CONVERSATIONAL            57000019
RR       DC    X'02040B820109'          READ REPEAT                     58000019
WA       DC    X'020109'                WRITE ACKNOWLEDGE               59000019
RS       DC    X'010D'                  READ SKIP                       60000019
WN       DC    X'020209'                WRITE NEG-ACKNOWLEDGE           61000019
WTTV     DC    X'0611120E0F100B'        WRITE CONTINUE CONVERSATION     62000019
         SPACE 3                                                        63000019
*                   C C W 'S               I/O      F L A G S    LENGTH 64000019
*                                       OPERATION CD   CC   SLI    =    65000019
C        DC    X'010C009880020001'      WR D      X             1       66000019
         DC    X'010C009860210002'      WR D,C         X    X    2      67000019
         DC    X'010C009960210001'      WR C           X    X    1      68000019
         DC    X'010C009C60020001'      WR Y           X    X    1      69000019
         DC    X'010C009D60020001'      WR N           X    X    1      70000019
         DC    X'010C009E6001000F'      WR PAD        X    X    15      71000019
         DC    X'2700000060010001'      ENABLE         X    X      1    72000019
         DC    X'2910000160010000'      DIAL           X    X      N    73000019
         DC    X'2F00000060010001'      DISABLE        X    X      1    74000019
         DC    X'2F00000020210001'      DISABLE             X      1    75000019
         DC    X'0208000100200001'      RD RESP                    1    76000019
         DC    X'0A04000020110400'      INHIBIT             X           77000019
         DC    X'0104000060110400'      WR DATA             X      N    78000019
         DC    X'0200000030220400'      RD SKIP   SKIP FLAG X      N    79000019
         DC    X'010C009960020003'      WR CCC         X    X    3      80000019
         DC    X'0600000060010001'      PREPARE        X    X      1    81000019
         DC    X'0448000060050001'      SENSE          X    X           82000019
         DC    X'0138000060110800'      WR DATA             X      N    83000019
         DC    X'0208000160200001'      RD RESP        X    X    1      84000019
         SPACE 2                                                        85000019
CC       EQU   *-C                      OFFSET TO CONTROL CHARS.        86000019
         DC    X'16'                    CIRCLE D                        87000019
         DC    X'1F1F1F'                CIRCLE C                        88000019
         DC    X'76'                    CIRCLE Y                        89000019
         DC    X'40'                    CIRCLE N                        90000019
         DC    15X'DF'                  PAD CHARACTERS                  91000019
         CNOP  0,8                                                      92000019
         END                                                            93000019
./  ADD  SSI=62660457,NAME=IGG019UP
         TITLE 'IGG019UP - ASYNCHRONOUS READY PROCESSOR 05/01/73'       00050002
IGG019UP CSECT                                                          00100002
*                                                                       00110000
*********************************************************************** 00112000
*                                                                     * 00120000
*        MAINTENANCE ACTIVITY                                         * 00130000
*                                                                     * 00140000
*        ZA00537  (12/19/74)        ZA00549  (12/19/74)               * 00142000
*        ZA08050  (01/30/76)        ZA08056  (01/30/76)               * 00144000
*        ZA14028  (09/14/76)                                          * 00146000
*********************************************************************** 00148000
*                                                                       00148400
* /* START OF SPECIFICATIONS ****                                       00150002
*                                                                       00200002
*01*  MODULE-NAME = IGG019UP (OS/360 CQ513)                             00250002
*01*  COPYRIGHT = NONE                                                  00300002
*01*  STATUS = 00                                                       00350002
*01*  CHANGE-ACTIVITY = NONE                                            00400002
*01*  DESCRIPTIVE-NAME = LOCAL 3270 READY ROUTINE                       00450002
*01*  FUNCTION = PROCESS ASYNCHRONOUS DE INTERRUPTS FROM 3270 LOCAL     00500002
*     DEVICES. ROUTINE IS ASYNCHRONOUSLY SCHEDULED BY FIRST LEVEL       00550002
*     ATTENTION ROUTINE (IECTATEN) IF: 1) THE USER SPECIFIED 'READYQ=0' 00600002
*     IN A DCB MACRO INSTRUCTION FOR A LOCAL 3270 LINE GROUP, 2) THE    00650002
*     USER HAS ATTEMPTED TO OPEN THE PREVIOUSLY MENTIONED LINE GROUP,   00700002
*     3) AND THE DEVICE FROM WHICH AN UNSOLICITED DEVICE END INTERRUPT  00750002
*     IS RECEIVED WAS NOT READY (INTERVENTION REQUIRED) AT OPEN TIME;   00800002
*     OR AN INTERVENTION REQUIRED CONDITION HAS PREVIOUSLY BEEN         00850002
*     DETECTED BY LOCAL 3270 ERP'S FOR A DEVICE WHICH HAD BEEN IN USE   00900002
*     AND AN UNSOLICITED DEVICE END INTERRUPT IS RECEIVED.              00950002
*01*  NOTES = STANDARD CODING PRACTICES, AS DESCRIBED BY SDD            01000002
*     PROGRAMMING STANDARDS, ARE FOLLOWED.                              01050002
*02*    DEPENDENCIES = NONE                                             01100002
*02*    PERFORMANCE = NOT APPLICABLE                                    01150002
*02*    RESTRICTIONS = NONE                                             01200002
*02*    REGISTER-CONVENTIONS = SEE EQUATES IMMEDIATLY FOLLOWING THIS    01250002
*       PROLOG                                                          01300002
*02*    PATCH-LABEL = MAINPTCH                                          01350002
*01*  MODULE-TYPE = MODULE                                              01400002
*02*    PROCESSOR = ASSEMBLER                                           01450002
*02*    MODULE-SIZE = 200 BYTES                                         01500002
*02*    ATTRIBUTES = REENTERABLE                                        01550002
*01*  ENTRY = IGG019UP                                                  01600002
*02*    PURPOSE = ENTERED AT FIRST EXECUTABLE INSTRUCTION VIA           01650002
*       SCHEDULING OF IRB                                               01700002
*02*    LINKAGE = BALR                                                  01750002
*02*    INPUT = REGISTER ONE CONTAINS THE RLN OF THE DEVICE WHICH CAME  01800002
*       READY IN THE HIGH BYTE AND THE ADDRESS OF THE DEB FOR THE LINE  01850002
*       GROUP. THIS COMES FROM THE IQE PARAMETER FIELD WHERE IT WAS     01900002
*       PLACED BY IECTATEN BEFORE BRANCHING TO THE ASYNCHRONOUS EXIT    01950002
*       EFFECTOR STAGE 2 TO SCHEDULE THIS ROUTINE.                      02000002
*02*    OUTPUT = IF A READ INITIAL WAS PENDING FOR THE LINE GROUP, A    02050002
*       RESETPL WILL HAVE BEEN DONE. OTHERWISE, THE UCBGRAF FIELD WILL  02100002
*       HAVE BEEN SET SUCH THAT THE NEXT READ INITIAL FOR THIS LINE     02150002
*       GROUP WILL RESULT IN A RESETPL TYPE COMPLETION. THE DECB WILL   02200002
*       HAVE BEEN MODIFIED AS FOLLOWS (IN EITHER CASE): 1) DECFLAGS     02250002
*       WILL CONTAIN A X'F0', 2) DECPOLPT WILL CONTAIN THE RLN OF THE   02300002
*       DEVICE WHICH CAME READY. IN THE EVENT OF MULTIPLE DEVICES IN    02350002
*       THE SAME LINE GROUP COMING READY, THEY WILL BE PROCESSED        02400002
*       SIMILARLY TO ATTENTIONS. THAT IS TO SAY, ONE WILL BE PROCESSED  02450002
*       FOR EACH READ INITIAL ISSUED TO THE LINE GROUP, THE SEARCH FOR  02500002
*       A READY DEVICE BEGINNING WITH THE RLN SPECIFIED IN THE READ     02550002
*       INSTRUCTION.                                                    02600002
*02*    EXIT-NORMAL = BRANCH RETURN ON THE ENTRY CONTENTS OF REGISTER   02650002
*       14                                                              02700002
*02*    EXIT-ERROR = NONE                                               02750002
*01*  EXTERNAL-REFERENCES = SEE FOLLOWING:                              02800002
*02*    ROUTINES = NONE                                                 02850002
*02*    DATA-SETS = NONE                                                02900002
*02*    DATA-AREA = UCB, DEB, DCB, DECB, IOB                            02950002
*01*  TABLES = NONE                                                     03000002
*01*  MACROS = RESETPL IECTUCBX IECTIOBX IECTDEBX IECTDECB              03050002
*                                                                       03100002
**** END OF SPECIFICATIONS ***/                                         03150002
*                                                                       03200002
*              EQUATE THE GENERAL REGISTERS                             03250002
*                                                                       03300002
RPARM0   EQU   0                   PARAMETER REGISTER 0                 03350002
RPARM1   EQU   1                   PARAMETER REGISTER 1                 03400002
REVN     EQU   2                   EVEN OF ARITHMETIC PAIR              03450002
RODD     EQU   3                   ODD OF ARITHMETIC PAIR               03500002
RRLN     EQU   4                   RLN SAVE REGISTER                    03550002
RDEB     EQU   5                   DEB SAVE REGISTER                    03600002
RSAVE    EQU   6                   RETURN POINT SAVE REGISTER           03650002
RUCB     EQU   7                   UCB ADDRESS REGISTER                 03700002
RDECB    EQU   8                   DECB ADDRESS REGISTER                03750002
RWORK1   EQU   9                   WORK REGISTER                        03800002
RWORK2   EQU   10                  WORK REGISTER                        03850002
RIC      EQU   11                  CHARACTER REGISTER                   03900002
RBASE    EQU   12                  BASE REGISTER                        03950002
RWORKD   EQU   13                  UTILITY REGISTER                     04000002
RRTRN    EQU   14                  LINK REGISTER                        04050002
REP      EQU   15                  ENTRY POINT REGISTER                 04100002
RROUTE   EQU   15                  ROUTING REGISTER FOR SVC 116         04150002
*                                                                       04200002
         SPACE 3                                                        04250002
*                                                                       04300002
*              EQUATE THE CONSTANTS                                     04350002
*                                                                       04400002
ONE      EQU   1                   NUMBER 1                             04450002
TWO      EQU   2                   NUMBER 2                             04500002
THREE    EQU   3                   NUMBER 3                             04550002
FOUR     EQU   4                   NUMBER 4                             04600002
FIVE     EQU   5                   NUMBER 5                             04650002
SIX      EQU   6                   NUMBER 6                             04700002
SEVEN    EQU   7                   NUMBER 7                             04750002
EIGHT    EQU   8                   NUMBER 8                             04800002
NINE     EQU   9                   NUMBER 9                             04850002
TEN      EQU   10                  NUMBER 10                            04900002
*                                                                       04950002
*               GRAPHICS STATUS FIELD FLAGS                             05000002
*                                                                       05050002
OPENINIT EQU   X'80'               OPEN IS IN PROGRESS                  05100002
OPENRDY  EQU   X'40'               DEVICE CAME READY DURING OPEN        05150002
DVCRDY   EQU   X'20'               DEVICE CAME READY - NOT IN OPEN      05200002
BTAMROUT EQU   X'10'               USING IGG019UP                       05250002
USERROUT EQU   X'08'               USING USER WRITTEN EXIT              05300002
*                                  NOTE: THIS FLAG SHOULD NEVER BE      05350002
*                                  ON UPON ENTRY TO IGG019UP            05400002
RDYNDONE EQU   X'04'               PROCESSING OF 'DEVICE CAME READY     05450002
*                                  CONDITION' NOT COMPLETE              05500002
DVCNRDY  EQU   X'02'               DEVICE HAS RETURNED INTERVENTION     05550002
*                                  REQUIRED (SET BY IGG0194P IF         05600002
*                                  DETECTED DURING OPEN OR              05650002
*                                  IGE0210E IF SUBSEQUENT TO OPEN)      05700002
RSVED    EQU   X'01'               FLAG RESERVED FOR BTAM'S USE         05750002
*                                                                       05800002
*              GRAPHICS CONTROL BYTE FLAGS                              05850002
*                                                                       05900002
ONLINTST EQU   X'80'               ONLINE TEST CURRENTLY HAS THE        05950002
*                                  DEVICE                               06000002
DEERR    EQU   X'40'               DEVICE END WITH ERROR                06050002
*                                  IN IECTATEN                          06100002
RDTIACTV EQU   X'08'               READ TI ACTIVE FLAG (SET BY          06150002
*                                  IECTSVC FOR DURATION OF READ         06200002
*                                  INITIAL)                             06250002
RDTIPEND EQU   X'04'               READ TI PENDING (SET BY IECTSVC      06300002
*                                  IF NO ATTENTIONS AT INITIATION       06350002
*                                  OF READ INITIAL, RESET BY            06400002
*                                  IECTATEN WHEN IGG019PG IS            06450002
*                                  SCHEDULED TO ACTUALLY PERFORM        06500002
*                                  THE EXCP FOR THE READ)               06550002
SKIP     EQU   X'02'               DO NOT HONOR ATTENTIONS FROM         06600002
*                                  DEVICE FOR READ TI'S                 06650002
ATTEN    EQU   X'01'               ATTENTION RECEIVED FROM DEVICE       06700002
*                                                                       06750002
*              OTHER EQUATES                                            06800002
*                                                                       06850002
ALLON    EQU   X'FF'               ALL BITS IN A BYTE                   06900002
NOBITS   EQU   X'00'               ALL BITS OFF IN A BYTE               06950002
READY    EQU   X'F0'               DECFLAGS FOR READY DEVICE            07000002
SADENERR EQU   X'80'               IOBINCAM OPEN FAIL BIT               07050002
         EJECT                                                          07100002
         BALR  RBASE,0             ESTABLISH BASE REGISTER              07150002
         USING *,RBASE             AND ASSEMBLER ADDRESSABILITY         07200002
         B     PASTID              BRANCH AROUND ID           NOW       07250002
         DC    C'IGG019UP'         TO LOCATE IN DUMP                    07300000
         DC    C'** MVS *'                                              07303000
         DC    C'&SYSDATE'         ASSEMBLY DATE                        07306000
PATCH    DC    48XL1'00'                   PATCH AREA                   07320000
PASTID   DS    0H                  AROUND ID                            07350002
         LR    RSAVE,RRTRN         SAVE RETURN ADDRESS                  07400002
         XR    RRLN,RRLN           CLEAN RLN REGISTER                   07450002
         LR    RDEB,RPARM1         SAVE DEB AND RLN                     07500002
         SLDL  RRLN,EIGHT          PLUG RLN                             07550002
         SRL   RDEB,EIGHT          PUT DEB ADDRESS BACK                 07600002
         USING IECTDEB+36,RDEB     ESTABLISH DEB ADDRESSABILITY         07650002
         LR    RODD,RRLN           GET THE RLN                          07700002
         BCTR  RODD,0              REDUCE BY ONE                        07750002
         LA    REVN,FOUR           GET LENGTH OF EXTENT                 07800002
         MR    REVN,REVN           RODD CONTAINS DISPLACEMENT           07850002
*                                  FROM DEB EXTENT LIST TO              07900002
*                                  EXTENT FOR THIS DEVICE               07950002
         L     RUCB,DEBUCBAD(RODD) GET THE UCB ADRESS                   08000002
         LA    RUCB,0(RUCB)        INSURE HIGH BYTE CLEAR               08050002
         L     RWORK1,DEBUCBAD     GET MASTER UCB ADDRESS               08100002
         LA    RWORK1,0(RWORK1)    INSURE HIGH BYTE CLEAR               08150002
         USING UCB,RUCB            ESTABLISH UCB ADDRESSABILITY         08200002
         USING MSTRUCB,RWORK1      ESTABLISH MASTER ADDRESSABILITY      08250002
         TM    UCBGRAF,DVCRDY      THIS DEVICE COME READY ?             08300002
         BNO   CANTDO              NO, CAN'T PROCESS THIS DEVICE        08350002
         CLI   MTRINRLN,NOBITS     INITIALIZED ?                        08400002
         BE    CANTDO              NO, NO IOB TO USE                    08450002
         XR    RWORKD,RWORKD       CLEAR REG                            08500002
         IC    RWORKD,MTRINRLN     GET INIT RLN                         08550002
         L     RWORK2,MTRDEBAD     GET THE DEB ADDRESS                  08600002
         LA    RWORK2,0(RWORK2)    INSURE HIGH BYTE CLEAR               08650002
         CR    RDEB,RWORK2         DEB SAME AS PASSED ?                 08700002
         BNE   CANTDO              NO, CONTROL BLOCKS MESSED UP         08750002
         OI    MTRGRAF,RDYNDONE    SET READY NOT DONE                   08800002
         DROP  RWORK1              DON'T NEED MASTER ANY MORE           08850002
         L     RWORK1,DEBPROTG     GET THE DCB ADDRESS                  08900002
         LA    RWORK1,0(RWORK1)    INSURE HIGH BYTE CLEAR               08950002
         USING IHADCB,RWORK1       ESTABLISH DCB ADDRESSABILITY         09000002
         L     RWORK2,DCBIOBAD     GET ADDRESS OF IOB POOL              09050002
         LR    RODD,RWORKD         GET RLN                              09100002
         XR    REVN,REVN           CLEAN EVEN REGISTER                  09150002
         IC    REVN,DCBEIOBX       GET SIZE OF IOB                      09200002
         LR    RWORKD,RWORK1       SAVE DCB ADDRESS                     09250002
         DROP  RWORK1              DON'T NEED DCB ANYMORE               09300002
         MR    REVN,REVN           RODD CONTAINS DISPLACEMENT           09350002
*                                  FROM TOP OF IOB POOL TO              09400002
*                                  IOB FOR THIS DEVICE                  09450002
         LA    RWORK1,0(RODD,RWORK2) GET IOB ADDRESS                    09500002
         USING IECTIOB,RWORK1      ESTABLISH IOB ADDRESSABILITY         09550002
         L     RWORK2,IOBECBPT     GET DECB ADDRESS                     09600002
         LA    RWORK2,0(RWORK2)    INSURE HIGH BYTE CLEAR               09650002
         USING IECTDECB,RWORK2     ADDRESS DECB                         09700002
         STC   RRLN,DECRLN         UPDATE RLN TO READY DEVICE           09750002
         DROP  RWORK1              DON'T NEED IOB ANYMORE               09850002
         B     RESETPL              BRANCH TO RESETPL        LD YA02128 09900002
CONTINUE EQU   *                                             LD YA02128 09910002
         LTR   REP,REP             RETURN ZERO ?                        09950002
         BNZ   OPENOF              NO, DON'T RESET FLAGS                10000002
         USING IECTDECB,RWORK2     ESTABLISH DECB ADDRESSABILITY        10050002
         NI    DECFLAGS,NOBITS     RESET THE FLAGS                      10100002
         OI    DECFLAGS,READY      SET DEVICE CAME READY                10150002
         STC   RRLN,DECPOLPT+THREE PLUG THE RLN              LD YA03233 10200002
OPENOF   EQU   *                   RESET SAD/ENABLE FAILED IN IOB       10250002
         USING IHADCB,RWORKD       ESTABLISH DCB ADDRESSABILITY         10300002
         L     RWORK2,DCBIOBAD     GET ADDRESS OF IOB POOL              10350002
         LR    RODD,RRLN           GET RLN                              10400002
         XR    REVN,REVN           CLEAR EVEN REG                       10450002
         IC    REVN,DCBEIOBX       GET SIZE OF IOB                      10500002
         DROP  RWORKD              DON'T NEED DCB ANY MORE              10550002
         MR    REVN,REVN           RODD CONTAINS DISPLACEMENT           10600002
*                                  FROM TOP OF IOB POOL TO              10650002
*                                  IOB FOR THIS DEVICE                  10700002
         LA    RWORK1,0(RODD,RWORK2) GET IOB ADDRESS                    10750002
         USING IECTIOB,RWORK1      ESTABLISH IOB ADDRESSABILITY         10800002
         NI    IOBINCAM,ALLON-SADENERR TURN OFF SAD ENABLE FAILED       10850002
         DROP  RWORK1              DON'T NEED IOB ANYMORE               10900002
CANTDO   EQU   *                   PROCESSING COMPLETE                  10950002
         LR    RRTRN,RSAVE         PICK UP RETURN POINT                 11000002
         BR    RRTRN               RETURN TO AEE2                       11050002
         EJECT                                                          11200002
*                                                                       11210002
*                                                                       11220002
*        THIS SUBROUTINE WILL SIMULATE RESETPL MACRO         LD YA02128 11230002
*        EXPANSION. (RESETPL MACRO EXPANSION IS NOT          LD YA02128 11240002
*        RE-ENTRANT.)                                        LD YA02128 11242002
*                                                                       11244002
*                                                                       11246002
         SPACE 4                                                        11248002
*        REGISTER EQUATONS                                   LD YA02128 11248402
*                                                                       11248802
EXTREG   EQU   0                    NO. OF EXT               LD YA02128 11249602
RLNREG   EQU   1                    RELATIVE LINE NUMBER REG LD YA02128 11253002
WORKREG  EQU   1                    WORK REG                 LD YA02128 11256402
DEBREG   EQU   2                    DEB ADDRESS              LD YA02128 11259802
IOBREG   EQU   3                    IOB ADDRESS              LD YA02128 11263202
UCBREG   EQU   7                    UCB ADDRESS              LD YA02128 11266602
UCBPTR   EQU   9                    UCB POINTER              LD YA02128 11276602
DECBREG  EQU   10                   DECB ADDRESS             LD YA02128 11278602
DCBREG   EQU   14                   DCB ADDRESS              LD YA02128 11280602
CODEREG  EQU   15                   RETURN CODE REG          LD YA02128 11282602
*                                                                       11283002
         SPACE 4                                                        11283102
*                                                                       11283202
*        MISCELANEOUS EQUATIONS                              LD YA02128 11288802
*                                                                       11290802
ZERO     EQU   0                                             LD YA02128 11292802
SIXTEEN  EQU   16                                            LD YA02128 11293202
TWENTY4  EQU   24                                           LD @ZA00537 11293303
X01      EQU   X'01'                                         LD YA02128 11293602
RDINT    EQU   X'01'                                         LD YA02128 11294002
X0C      EQU   X'0C'                                         LD YA02128 11294102
OPCOMPLT EQU   X'40'                                         LD YA02128 11294202
X58      EQU   X'58'                                         LD YA02128 11294302
XBF      EQU   X'BF'                                         LD YA02128 11308202
SVC116   EQU   116                                           LD YA02128 11318202
*                                                                       11320202
         SPACE 4                                                        11320602
RESETPL  EQU   *                                             LD YA02128 11321002
         XR    RLNREG,RLNREG       CLEAR REG 1               LD YA02128 11321402
         IC    RLNREG,DECRLN       GET RLN FROM DECB         LD YA02128 11321802
         L     DCBREG,DECDCBAD     GET DCB ADDRESS           LD YA02128 11321902
         USING IHADCB,DCBREG       DCB ADDRESSABILITY        LD YA02128 11322002
         TM    DCBOFLGS,DCBOFOPN   HAS DCB BEEN OPENED       LD YA02128 11322102
         BO    RESETPL0            IF SO, CONTINUE           LD YA02128 11326702
         LA    CODEREG,X0C         IF NOT,SET RETURN CODE    LA YA02128 11328702
         B     RESETPL7             AND EXIT                 LD YA02128 11330702
RESETPL0 EQU   *                                             LD YA02128 11331102
         L     DEBREG,DCBDEBAD     GET ADDR OF DEB           LD YA02128 11331202
         LA    DEBREG,ZERO(DEBREG) CLEAR HIGH-ORDER BYTE     LD YA02128 11331302
         SLA   RLNREG,TWO          MULTIPLY RLN BY 4         LD YA02128 11331402
         L     UCBREG,DEBUCBAD-FOUR(RLNREG)  UCB ADDR        LD YA02128 11336002
         CLI   UCBTBYT3,UCB3DISP   DEVICE CLASS=GRAPHICS     LD YA02128 11338002
         BNE   RESETPL6            NO, DEVICE IS NOT ANR     LD YA02128 11340002
         CLI   DECTYPE+ONE,RDINT   IS OP. READ INITIAL       LD YA02128 11340402
         BNE   RESETPL5            NO, GIVE RC=10 AND EXIT   LD YA02128 11340500
         TM    DECSDECB,OPCOMPLT   IS THIS OP COMPLETED      LD YA02128 11340602
         BO    RESETPL4             YES, GIVE RC=4 AND EXIT  LD YA02128 11340702
         LR    RPARM0,DECBREG       DECB ADDR IN REG 0       LD YA02128 11352502
         LR    RPARM1,UCBREG        UCB ADDR IN REG 1        LD YA02128 11362502
         LA    CODEREG,FOUR         ROUTING CODE IN REG 15   LD YA02128 11364502
         SVC   SVC116               ISSSUE SVC 116           LD YA02128 11368402
         SLL   CODEREG,TWENTY4      MAKE SURE THAT ONLY...  LD @ZA00537 11368803
         SRL   CODEREG,TWENTY4      ...RC IN REG 15         LD @ZA00537 11369203
         LA    WORKREG,FOUR         ESTABLISH COMPARANT      LD YA02128 11370402
         CR    CODEREG,WORKREG      IS RC 0 OR 4             LD YA02128 11372402
         BH    RESETPL8            NO, CHECK RC=16             @ZA14028 11376300
         L     IOBREG,DCBIOBAD      GET IOB ADDRESS          LD YA02128 11378302
         USING IECTIOB,IOBREG       IOB ADDRESSABILITY       LD YA02128 11378702
         LA    IOBREG,X58(IOBREG)   GET ADDR OF FIRST IOB    LD YA02128 11380302
         XR    EXTREG,EXTREG        CLEAR REG 0              LD YA02128 11384202
         IC    EXTREG,DEBNMEXT      GET NO. OF EXTENT        LD YA02128 11386202
*                                   AND USE AS LOOP COUNTER  LD YA02128 11388202
         LA    UCBPTR,DEBUCBAD      ADDR OF 1ST DEB UCB PTR  LD YA02128 11398502
RESETPL1 EQU   *                                             LD YA02128 11408602
         OI    IOBFLAG2,X01         SET RESETPL ISSUED FLAG  LD YA02128 11408702
         TM    IOBINCAM,X01         RFT IN PROGRESS          LD YA02128 11412102
         BO    RESETPL3             YES, ADJUST RC           LD YA02128 11414102
         L     UCBREG,ZERO(UCBPTR)  ADDRESS OF UCB           LD YA02128 11414502
         TM    UCBFLA,UCBPST        OUTSTANDING I/O OP.      LD YA02128 11414902
         BO    RESETPL2             YES, KEEP IOB BUSY       LD YA02128 11415302
         NI    IOBINCAM,XBF         TURN OFF IOB BUSY FLAG   LD YA02128 11415402
RESETPL2 EQU   *                                             LD YA02128 11415502
         LA    IOBREG,X58(IOBREG)   STEP TO NEXT IOB         LD YA02128 11415602
         LA    UCBPTR,FOUR(UCBPTR)  STPE TO NEXT UCB PTR     LD YA02128 11419002
         BCT   EXTREG,RESETPL1      LOOP IF NOT FINISHED     LD YA02128 11421002
         B     RESETPL7             EXIT                     LD YA02128 11421402
RESETPL3 EQU   *                                             LD YA02128 11421802
         XR    CODEREG,CODEREG      SET RC TO ZERO           LD YA02128 11422202
         B     RESETPL2                                        @ZA08056 11422300
RESETPL4 EQU   *                                             LD YA02128 11422402
         LA    CODEREG,FOUR         SET RC TO 4              LA YA02128 11422502
         B     RESETPL7             EXIT                     LD YA02128 11425902
RESETPL5 EQU   *                                             LD YA02128 11427902
         LA    CODEREG,SIXTEEN       SET RC TO X'10'         LD YA02128 11428300
         B     RESETPL7              EXIT                    LD YA02128 11428700
RESETPL6 EQU   *                                             LD YA02128 11429102
         LA    CODEREG,EIGHT        SET RC TO 8              LD YA02128 11429202
RESETPL7 EQU   *                                             LD YA02128 11429302
         B     CONTINUE                                      LD YA02128 11429402
RESETPL8 EQU   *                                               @ZA14028 11429800
         LA    WORKREG,SIXTEEN    ESTABLISH COMPARAND          @ZA14028 11430800
         CR    CODEREG,WORKREG    IS RC=16                     @ZA14028 11431800
         BNE   RESETPL7           NO - EXIT WITH ORIG RC       @ZA14028 11432800
         TM    DECSDECB,OPCOMPLT  IS OPERATION COMPLETE        @ZA14028 11433800
         BO    RESETPL4           YES - GIVE RC=4 AND EXIT     @ZA14028 11434800
         B     RESETPL7           EXIT WITH ORIG RC            @ZA14028 11435800
         DROP  IOBREG                                                   11441302
         EJECT                                                          11443002
UCB      DSECT                                                          11444702
         IEFUCBOB                                                       11446402
         EJECT                                                          11448102
MSTRUCB  DSECT                                               LD YA02128 11449802
MTRGRAF  EQU   MSTRUCB+(UCBGRAF-UCBOB)                       LD YA02128 11451502
MTRINRLN EQU   MSTRUCB+(UCBINRLN-UCBOB)                                 11453202
MTRRLN   EQU   MSTRUCB+(UCBRLN-UCBOB)                                   11454902
MTRDEBAD EQU   MSTRUCB+(UCBCTLNK-UCBOB)                                 11456602
         EJECT                                                          11458302
         IECTIOBX                                                       11460002
         EJECT                                                          11462002
         IECTDEBX                                                       11470002
         EJECT                                                          11472002
         IECTDECB                                                       11480002
         EJECT                                                          11482002
         DCBD  DSORG=BX                                                 11490002
         EJECT                                                          11492002
         END   IGG019UP                                                 11500002
./  ADD  SSI=73180159,NAME=IGG0193M
 TITLE 'IGG0193M  BTAM LINE GROUP OPEN EXECUTOR - LOAD 1'               00200019
*********************************************************************** 00400002
*                                                                     * 00450002
* MODULE NAME: IGG0193M  (OS/VS)                                      * 00500002
*                                                                     * 00550002
* DESCRIPTIVE NAME: BTAM LINE GROUP OPEN EXECUTOR - LOAD 1            * 00560002
*                                                                     * 00570002
* COPYRIGHT: NONE                                                     * 00580002
*                                                                     * 00600002
* STATUS: RELEASE 2                                                   * 00800002
*                                                                     * 01000019
* FUNCTION/OPERATION: THIS ROUTINE GETS MAIN STORAGE FOR AND INITIAL- * 01200002
*   IZES A DATA EXTENT BLOCK.  IT ANALYZES DEVICE TYPE INFORMATION    * 01400002
*   PROVIDED IN THE UNIT CONTROL BLOCK TO DETERMINE WHAT TYPE OF      * 01600002
*   TERMINAL DEVICES ARE ATTACHED TO THE GROUP OF LINES THAT MAKE UP  * 01800002
*   THIS LINE GROUP.                                                  * 02000002
*                                                                     * 02200019
* ENTRY POINTS: THIS ROUTINE IS ENTERED AT IGG0193M VIA AN XCTL FROM  * 02400002
*   AN I/O SUPPORT MODULE OR FROM ANOTHER ACCESS METHOD'S OPEN        * 02600019
*   EXECUTOR.  IT MAY ALSO BE RE-ENTERED FROM THE RELOOP PORTION OF   * 02800002
*   THIS ROUTINE IF IT DETERMINES THAT THERE IS ANOTHER DATA CONTROL  * 03000019
*   BLOCK TO BE OPENED.                                               * 03200019
*                                                                     * 03400019
* INPUT: THE REGISTERS 5, 6, 7, AND 8 ARE THE INPUT, AS FOLLOWS,      * 03600002
*   5- THE ADDRESS OF THE FIRST ENTRY IN THE COPIED DCB PARAMETER LIST* 03800002
*   6- THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE,         * 04000002
*   7- THE ADDRESS OF THE CURRENT ENTRY IN THE COPIED DCB PARAMETER   * 04200002
*      LIST,                                                          * 04250002
*   8- THE ADDRESS OF THE CURRENT EXECUTOR'S ENTRY IN THE WHERE-TO-GO * 04400019
*      TABLE.                                                         * 04600019
*                                                                     * 04650002
* OUTPUT:  THE REGISTERS 7 AND 8 WILL BE POSITIONED AT THE NEXT       * 04800002
*   ENTRIES IN THE COPIED DCB PARAMETER LIST AND THE WHERE-TO TABLE.  * 05000002
*   A DEB WILL HAVE BEEN CONSTRUCTED IN SUBPOOL 230.                  * 05200002
*  SOME OF THE DCB FIELDS WILL HAVE BEEN INITIALIZED.                 * 05400019
*  THIS EXECUTOR'S ENTRY (OR ENTRIES) IN THE WHERE - TO -             * 05600019
*   GO TABLE WILL HAVE BEEN UPDATED TO IDENTIFY LOAD 2 (IGG0194N -    * 05800002
*   FOR NON LOCAL 3270 DEVICES) OR (IGG0194P - FOR LOCAL 3270 DEVICES)* 05850002
*                                                                     * 05900002
* EXTERNAL ROUTINES:  NONE                                            * 06000002
*                                                                     * 06200019
* EXITS-NORMAL:  THIS ROUTINE EXITS VIA AN XCTL TO THE MODULE         * 06400002
*   IDENTIFIED BY THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE,   * 06600019
*   NAMELY IGG0194N OR IGG0194P.                                      * 06800002
*                                                                     * 07000019
*     -ERRORS-  THIS ROUTINE EXITS VIA ABEND FOR THE FOLLOWING        * 07200019
*   ERROR CONDITIONS-                                                 * 07400019
*   ABEND CODE ERROR CONDITION                                        * 07600019
*   00090000    A DEVICE OTHER THAN A COMMUNICATIONS DEVICE HAS BEEN  * 07800019
*               ALLOCATED TO THIS DCB.                                * 08000019
*   00091000    AN INVALID OR UNSUPPORTED CONTROL UNIT HAS BEEN       * 08200019
*               SPECIFIED                                             * 08400019
*   00092000    AN INVALID OR UNSUPPORTED TYPE OF TERMINAL CONTROL    * 08600019
*               OR ADAPTER HAS BEEN SPECIFIED                         * 08800019
*   00093000    AN INVALID OR UNSUPPORTED TERMINAL TYPE HAS BEEN      * 09000019
*               SPECIFIED.                                            * 09200019
*   00094000    AN INVALID OR UNSUPPORTED OPTIONAL FEATURE (OR MODE OF* 09400019
*               OPERATION) HAS BEEN SPECIFIED.                        * 09600019
*   00095000    INCOMPATABLE DEVICES ARE DEFINED TO BE ON THE SAME    * 09800019
*               LINE GROUP.                                           * 10000019
*                                                                     * 10200019
* TABLES/WORK AREAS: THE WHERE-TO-GO TABLE CONTAINS THE ID AND TTR    * 10400002
*       OF THE OPEN EXECUTOR LOAD 2. THE DCB PARAMETER LIST CONTAINS  * 10600019
*       THE ADDRESS OF EACH DCB SPECIFIED IN THE OPEN MACRO. THE      * 10800002
*       COMMUNICATION VECTOR TABLE IS A RESIDENT VECTOR LIST USED     * 11000019
*       TO LOCATE THE TIOT, WHICH IS NEEDED IN DEB CONSTRUCTION.      * 11200002
*                                                                     * 11400019
* ATTRIBUTES: THIS ROUTINE IS EXECUTED IN THE DATA MANAGEMENT KEY OF  * 11600002
*       5 AS ENABLED, PRIVILEGED, AND REENTRANT.                      * 11800002
*                                                                     * 12000019
* NOTES: THIS ROUTINE INITIATES THE OPEN PROCESSING FOR               * 12200002
*  TELECOMMUNICATIONS. IT CONSTRUCTS AND INITIALIZES THE DEB          * 12400002
*  (INCLUDING THE UCB ADDRESSES IN THE DEB). FOR SECURITY AND         * 12450002
*  INTEGRITY PURPOSES, OPEN PROCESSING WILL BE ONLY ON THE COPIED     * 12500002
*  DCB AND COPIED DCB PARAMETER LIST. BTAM OPEN LOADS MUST KEEP       * 12550002
*  THE USER DCB AND THE COPIED DCB SYNCHRONIZED. THE LAST BTAM        * 12560002
*  OPEN LOAD WILL SYNCHRONIZE THE DCB'S. UPON COMPLETION OF THIS      * 12570002
*  MODULE, CONTROL IS PASSED TO THE SECOND OPEN MODULE THROUGH        * 12620002
*  THE WHERE-TO-GO TABLE ENTRY.                                       * 12670002
*                                                                     * 13200019
* CHANGE ACTIVITY AS FOLLOWS:                                         * 13250002
*            APARS                           PTMS                     * 13300002
*       YA02170  (10/5/73)               YM5663  (12/11/73) PROLOG    * 13350002
*       YA03251  (2/1/74)                                             * 13352000
*       AZ04858  (10/06/75)                                           * 13356000
*       AZ10016  (03/30/76)                                           * 13358000
*       AZ26035  (09/16/77)                                           * 13360000
*       AZ17697  (11/10/77)                                           * 13370000
*********************************************************************** 13400002
         EJECT                                                          13410002
*/*IGG0193M: CHART                                                   */ 13430000
*/*HEADER                                                               13442000
*/*CHART A1-A  BTAM OPEN EXECUTOR - LOAD 1 (IGG0193M; VS2 RELEASE 2) */ 13444000
*/*IGG0193M: E IGG0193M */                                              13448000
*/*          P ESTABLISH COPIED DCB ADDRESSABILITY */                   13448400
*/*          D (NO,,YES,BYPASS) IS THIS A STRAM DCB? */                 13448800
*/*          P LOCATE DD ENTRY IN TIOT */                               13449200
*/*DDCONCAT  P ACCUMULATE SPACE REQUIREMENTS FOR UCB ADDRESSES */       13449600
*/*          D (YES,ENDD,NO,) END OF TIOT? */                           13449700
*/*          D (YES,DDCONCAT,NO,) NEXT DD ENTRY CONCATENATED? */        13449800
*/*ENDD      D (YES,DEBMAX,NO,) DYNAMIC BUFFERING SPECIFIED? */         13449900
*/*          D (YES,DEBMID,NO,) DOES BUFFER POOL EXIST? */              13499900
*/*          D (NO,DEBMIN,YES,) ARE ANY BUFFERS REQUESTED? */           13509900
*/*          D (YES,DEBMIN,NO,DEBMID) BUFFER LENGTH ZERO? */            13519900
*/*DEBMAX    P INCREMENT DEB SIZE BY 10 */                              13529900
*/*DEBMID    P INCREMENT DEB SIZE BY 6 */                               13539900
*/*DEBMIN    P INCREMENT DEB SIZE BY BASIC DEB SIZE OF 89 */            13541900
*/*          L SVC 10 - GETMAIN FOR DEB FROM SUBPOOL 230 */             13543900
*/*CLEARDEB  P CLEAR DEB AND INITIALIZE DEB AND COPIED DCB FIELDS */    13545900
*/*CHAIN     P PUT DEB ON TCB-DEB CHAIN */                              13547900
*/*          D (YES,SETERP,NO,) IS ERP REQUESTED? */                    13548300
*/*          P SET NO ERP FLAG IN DCB */                                13548700
*/*SETERP    P PLACE USER'S DCB ADDRESS IN DEB */                       13549100
*/*          L SVC 117 - DEBCHK,TYPE=ADD */                             13549500
*/*          P PRIME REG1 WITH ABEND CODE 90 */                         13549600
*/*UCBMOVE   P MOVE UCB ADDRESSES TO DEB */                             13549700
*/*          P SET IOS APPENDAGES ADDR IN FIRST 20 BYTES OF DCB */      13549800
*/*          D (YES,ANRLOAD2,NO,) DEVICE CLASS = GRAPHICS? */           13566500
*/*NEXTUCB   D (NO,AB5,YES,) ALL DEVICES IN LINE GROUP COMPATIBLE? */   13576500
*/*TESTTCU   D (NO,AB0,YES,) TELECOMMUNICATIONS UCB? */                 13578500
*/*          D (NO,AB1,YES,) VALID CONTROL UNIT? */                     13580500
*/*          D (NO,AB2,YES,) VALID ADAPTER? */                          13582500
*/*          D (NO,AB3,YES,) VALID TERMINAL? */                         13582900
*/*          D (NO,AB4,YES,) VALID FEATURES? */                         13583000
*/*ENDLOD1   P SAVE INDEX FOR DEVTAB IN DCB FOR LOAD2 */                13583100
*/*          P SET WTG TABLE FOR IGG0194N */                            13583200
*/*IGG0193M: END */                                                     13588800
         EJECT                                                          13596400
IGG0193M CSECT                                                          13598400
         SPACE 5                                                        13600002
RPARM0   EQU   0                        PARAMETER REGISTER 0            13800019
RPARM1   EQU   1                        PARAMETER REGISTER 1            14000019
RW1      EQU   2                        WORK REGISTER 1                 14200019
RW2      EQU   3                        WORK REGISTER 2                 14400019
RW3      EQU   4                        WORK REGISTER 3                 14600019
RPAR     EQU   5                        ADDRESS OF COPIED DCB    Y02947 14800002
*                                       PARAMETER LIST           Y02947 14850002
RWTG     EQU   6                        ADDRESS OF WTG TABLE            15000019
RPARC    EQU   7                        ADDRESS OF CURRENT       Y02947 15200002
*                                       COPIED DCB ENTRY         Y02947 15250002
RWTGC    EQU   8                        ADDRESS OF CURRENT WTG ENTRY    15400019
RTIOT    EQU   9                        ADDRESS OF TASK I/O TABLE       15600019
RDCB     EQU   10                       ADDRESS OF COPIED DCB    Y02947 15800002
RDEB     EQU   11                       ADDRESS OF DEB                  16000019
RBASE    EQU   12                       BASE REGISTER                   16200019
RSAVE    EQU   13                       ADDRESS OF TASK CONTROL BLOCK   16400019
RUCB     EQU   14                       NO. OF UCB'S/ADDRESS OF UCB     16600019
RSIZE    EQU   15                       SIZE OF DEB IN DOUBLE WORDS     16800019
         BALR  RBASE,0                  SET UP BASE REGISTER            17000019
         USING *,RBASE                                                  17200019
         USING IHADCB,RDCB                                              17400019
         USING IECTDEB,RDEB                                             17600019
         SPACE 4                                                        17800019
         B     AROUND                   BRANCH AROUND ID         Y02947 17850002
         DC    C'IGG0193M'              OPEN ID                  Y02947 17900002
         DC    C'UZ06851'               CURRENT PTF NUMBER     @ZA26035 17910000
         DS    0F                                                Y02947 17920002
PATCH    DC    XL50'00'                 PATCH AREA               Y02947 17930002
         SPACE 4                                                 Y02947 17950002
AROUND   L     RDCB,0(RPARC)            LOAD COPIED DCB ADDRESS  Y02947 18000002
*                                       IF THE SAME DCB OCCURS IN THE   18400019
*                                            PARAMATER LIST MORE THAN   18600019
*                                            ONCE, IT SHOULD BE PRO-    18800019
*                                            CESSED ONLY THE FIRST TIME 19000019
*       FOUR LINES DELETED BY THE FOLLOWING APAR                YA03251 19200000
         SPACE 1                                                        19800019
         TM    DCBDEVTP,STR             TEST FOR STRAM                  20000019
         BO    BYPASS                   IF SO, BRANCH OUT               20200019
         SPACE 1                                                 Y02947 20210002
         USING CVT,RSAVE                CVT ADDRESSABILITY       Y02947 20250002
         L     RSAVE,SIXT               LOCATE DDNAME VIA CVT,   Y02947 20400002
         L     RSAVE,CVTTCBP                 TASK CONTROL BLOCK, Y02947 20600002
         L     RSAVE,CURNTTCB(RSAVE)         AND CURRENT TASK CONTROL   20800019
         L     RTIOT,TCBTIO(RSAVE)           BLOCK.  LOAD ADRS OF TASK  21000019
         AH    RTIOT,DCBTIOT                 I/O TABLE, ADD OFFSET TO   21200019
*                                            LENGTH FIELD               21400019
         DROP RSAVE                    DROP CVT ADDRESS          Y02947 21450002
         EJECT                                                   Y02947 21500002
         LR    RW1,RTIOT                LOAD ADRS INTO WORK REGISTER    21600019
         SR    RW2,RW2                  RESET REGISTERS                 21800019
         SR    RW3,RW3                                                  22000019
         SR    RUCB,RUCB                                                22200019
         SPACE 1                                                 Y02947 22250002
         MODESET EXTKEY=ZERO            KEY ZERO                 Y02947 22300002
         SPACE 1                                                 Y02947 22350002
DDCONCAT LA    RW2,1(RW2)               ADD 1 FOR COUNT OF CONCAT DD'S  22400019
         IC    RW3,0(RW1)               LOAD TIOT LENGTH                22600019
         AR    RW1,RW3                  ADD TO START OF DD ENTRY        22800019
         SH    RW3,SIXTEEN              SUBTRACT SIZE OF DD INFORMATION 23000019
         AR    RUCB,RW3                 RESULT=NO OF DEVICES, ACCUMULAT 23200019
         NC    0(4,RW1),0(RW1)          TEST FOR ZERO END WORD          23400019
         BZ    ENDD                     IF ZERO BRANCH                  23600019
         CLI   4(RW1),BLNK              TEST FOR CONCATENATED DD        23800019
         BE    DDCONCAT                 IF SO, LOOP                     24000019
         SPACE 1                                                 Y02947 24250002
ENDD     EQU   *                                                 Y02947 24252002
         MODESET EXTKEY=DATAMGT         DATAMGT KEY              Y02947 24260002
         SPACE 1                                                 Y02947 24270002
         ST    RW2,DCBDEBAD            SAVE COUNT OF DD'S        A26886 24300002
         SR    RW2,RW2                                           A26886 24400019
         LR    RW3,RUCB                                                 24600019
         TM    DCBBFTEK,DYNBUF          TEST FOR DYNAMIC BUFFERING      24800019
         BO    DEBMAX                   IF SPECIFIED BRANCH             25000019
         CLI   DCBBUFCB+3,X'01'         IS THERE A BUFFER POOL          25200019
         BNE   DEBMID                   IF SO, BRANCH (X'01'=NO BFR PL) 25400019
         CLI   DCBBUFNO,X'00'           ARE ANY BUFFERS REQUESTED       25600019
         BE    DEBMIN                   IF NOT, BRANCH                  25800019
         CH    RW2,DCBBUFL              IF SO, TEST LENGTH              26000019
         BE    DEBMIN                   NO LENGTH IS SPECIFIED          26200019
         B     DEBMID                   LENGTH IS NOT ZERO              26400019
DEBMAX   LA    RW3,10(RW3)              INCREMENT SIZE                  26600019
         LA    RW2,8(RW2)               INCREMENT TYPE                  26800019
DEBMID   LA    RW3,6(RW3)               INCREMENT SIZE                  27000019
         LA    RW2,4(RW2)               INCREMENT TYPE                  27200019
DEBMIN   LA    RW3,89(RW3)              ADD BASIC DEB SIZE              27400019
         SRL   RW3,3                    COMPUTE DOUBLE WORDS IN DEB     27600019
         LR    RW1,RW3                  SAVE                            27800019
         SLL   RW3,3                    COMPUTES BYTES IN DEB           28000019
         LR    RPARM0,RW3               LOAD GET MAIN PARAMETER REG     28200019
         O     RPARM0,DEBPOOL           OR IN SUBPOOL NUMBER            28400019
         SPACE 2                                                 Y02947 28450002
*   GET CORE FOR DEB'S FROM SUBPOOL 230                          Y02947 28500002
         GETMAIN R,LV=(0)               REQUEST STORAGE FOR DEB         28600019
         EJECT                                                   Y02947 28800002
         LR    RDEB,RPARM1              PLACE DEB ADDRESS IN DEB REG    29000019
         SR    RPARM1,RPARM1            CLEAR REG               YA02170 29200002
         B     CLEARS                                                   29400019
CLEARDEB STC   RPARM1,0(RDEB,RW3)       ZERO DEB                        29600019
CLEARS   BCT   RW3,CLEARDEB             DECREMENT AND TEST COUNT        29800019
         STC   RPARM1,0(RDEB)                                           30000019
         STC   RW1,DEBLNGTH             STORE DEB SIZE (IN DBL WORDS)   30200019
         SRL   RUCB,2                                                   30400019
         STC   RUCB,DEBNMEXT            STORE UCB COUNT                 30600019
         ST    RSAVE,DEBTCBAD-1         STORE TCB ADDRESS               30800019
         ST    RDEB,DEBAPPAD-1          STORE DEB ADDRESS               31000019
         MVI   DEBEXSCL,X'02'           CODE AS NOT DIRECT ACCESS DEVIC 31200019
         STC   RW2,DEBAMLNG             STORE ACCESS METHOD SIZE IN DEB 31600019
         SPACE 1                                                 Y02947 31610002
         MODESET EXTKEY=ZERO            KEY OF ZERO              Y02947 31620002
         SPACE 1                                                 Y02947 31650002
         LA    RW3,DEBTCBAD-1           LOAD DEB ADDRESS         Y02947 31800002
         L     RW2,TCBDEB(RSAVE)        ADDR OF 1ST DEB ON TCB   Y02947 32000002
CHAIN    STCM  RW2,SEVEN,DEBDEBAD       CHAIN TO OUR DEB         Y02947 32050002
         CS    RW2,RW3,TCBDEB(RSAVE)    PUT OUR DEB AT TOP OF    Y02947 32060002
         BNE   CHAIN                       CHAIN OR PICK UP NEW  Y02947 32070002
*                                          TOP IF CHANGED        Y02947 32080002
         SPACE 1                                                 Y02947 32090002
         MODESET EXTKEY=DATAMGT         DATAMGT KEY              Y02947 32092002
         SPACE 1                                                 Y02947 32094002
         L     RUCB,DCBDEBAD           GET COUNT OF DD'S         A26886 32100019
         ST    RW3,DCBDEBAD             STORE DEB ADDRESS IN     Y02947 32200002
*                                       COPIED DCB               Y02947 32250002
         TM    DCBERROP,ERP             TEST FOR ERROR RECOVERY PROCED. 32400019
         BZ    SETERP                   IF ZERO, ERP REQUESTED          32600019
         MVI   DCBIFLGS,X'0C'           IF ONE, SET NO ERP BITS         32800019
         SPACE 1                                                 Y02947 32850002
SETERP   EQU  *                                                  Y02947 33000002
*         THE USER'S DCB ADDRESS RATHER THAN THE ADDRESS OF THE  Y02947 33010002
*         COPIED DCB MUST BE PLACED IN THE DEB FOR THE DEBCHK    Y02947 33020002
*         MACRO                                                  Y02947 33030002
         L     RW1,4(RWTGC)             ADDR OF OPEN WORK AREA   Y02947 33050002
         USING WORKAREA,RW1             WORKAREA ADDRESSABILITY  Y02947 33060002
         MVC   DEBDCBMK(4),DXDEBXAD     ADDR OF DEB XTENTION   @ZA17697 33065000
         SPACE 1                                                 Y02947 33070002
         MODESET KEYADDR=DXUKEY,WORKREG=15    USER'S KEY         Y02947 33080002
         SPACE 1                                                 Y02947 33090002
         L     RW1,DXUDCBAD             GET ADDR OF USER'S DCB   Y02947 33100002
         DROP  RW1                      DROP WORKAREA ADDRESS    Y02947 33110002
         DROP  RDCB                     DROP COPY DCB ADDRESS    Y02947 33120002
         USING IHADCB,RW1               USER DCB ADDRESSABILITY  Y02947 33130002
         ST    RW3,DCBDEBAD             PLACE DEB ADDRESS IN     Y02947 33140002
*                                       USER DCB                 Y02947 33142002
         DROP  RW1                      DROP USER DCB ADDRESS    Y02947 33144002
         USING IHADCB,RDCB              COPY DCB ADDRESSABILITY  Y02947 33146002
         SPACE 1                                                 Y02947 33148002
         MODESET EXTKEY=DATAMGT         DATAMGT KEY              Y02947 33148402
         SPACE 1                                                 Y02947 33148802
         ST    RW1,DEBDCBAD-1           PLACE USER'S DCB         Y02947 33150002
*                                       ADDRESS IN DEB           Y02947 33160002
         MVC   DEBPROTG(1),TCBPKF(RSAVE) MOVE PROTECTION KEY TO DEB     33200002
         OI    DEBPROTG,X'0F'           OR IN DEB ID                    33400019
         DEBCHK (RW1),AM=TAM,TYPE=ADD  ADD DEB TO SYSTEM TABLE   Y20947 33450002
         EJECT                                                   Y02947 33460002
         L     RPARM1,ABCODE            LOAD ABEND CODE         YA02170 33510002
         LA    RW3,DEBUCBAD             LOAD UCB ADDRESS                33800019
         SR    RW1,RW1                  RESET WORK REGISTER             34000019
UCBMOVE  IC    RW1,0(RTIOT)             LOAD UCB SIZE                   34200019
         SH    RW1,SEVENTEN             SUBTRACT 16                     34400019
         EX    RW1,UCBMVEX              MOVE UCB FROM TIOT TO DEB       34600019
         LA    RW3,1(RW1,RW3)           STEP ADDRESS                    34800019
         LA    RTIOT,17(RW1,RTIOT)      STEP ADDRESS                    35000019
         BCT   RUCB,UCBMOVE             DECREMENT COUNT OF UCB'S        35200019
         L     RUCB,DEBUCBAD            LOAD UCB ADDRESS                35400019
         USING CVT,RW1                  CVT ADDRESSABILITY       Y02947 35450002
         L     RW1,SIXT                 LOAD ADRS OF CVT         Y02947 35600002
         L     RW1,CVTXAPG          LOAD ADRS OF IOS RETURN ADRS Y02947 35800002
         DROP RW1                       DROP CVT ADDRESS         Y02947 35850002
         MVC   DEBEOEA(4),0(RW1)        MOVE IOS RETURN ADRS INTO DEB   36000019
         MVC   DEBSIOA(16),DEBEOEA      FOR EOEA, SIO, PCI, CE, & XCE   36200019
         CLI   UCBDVCLS(RUCB),GRAPHICS  GRAPHICS DEVICE CLASS IN UCB    36260002
         BE    ANRLOAD2            YES, GO TO SPECIAL LOAD FOR 3270     36320002
         LA    RW1,4                    SET 1ST WORK REG TO VALUE 4     36400019
         SR    RW2,RW2                  RESET REGISTER                  36600019
         IC    RW2,DEBNMEXT             LOAD NO OF UCB'S                36800019
         BCTR  RW2,0                    DECREMENT BY 1                  37000019
         SLL   RW2,2                    MULTIPLY BY 4, RESULT COUNT-1X4 37200019
         SR    RW3,RW3                  RESET WORK REGISTER             37400019
NEXTUCB  BXH   RW3,RW1,TESTTCU          INCREMENT & TEST COUNT          37600019
         MVC   0(4,RWTGC),16(RUCB)      MOVE 1ST UCB TO WORK AREA       37800019
         L     RSIZE,DEBUCBAD(RW3)      LOAD ADRS OF 2ND-NTH UCB        38000019
         XC    0(4,RWTGC),16(RSIZE)     X-OR 2ND-NTH UCB TO 1ST         38200019
         NC    0(4,RWTGC),HOLDMASK      AND OF VARIABLE BITS            38400019
         BNZ   AB5                      IF RESULT NON ZERO ERROR EXISTS 38600019
         B     NEXTUCB                  GO CHECK NEXT UCB               38800019
         SPACE 4                                                        39000019
TESTTCU  EQU   *                                                        39200019
         SR    RW1,RW1                                                  39400019
         SR    RW2,RW2                                                  39600019
         SR    RW3,RW3                                                  39800019
         SR    RPARM0,RPARM0                                            40000019
         SPACE                                                          40200019
         CLI   18(RUCB),TPDEVCCD        IS UCB FOR TELECOMMUNICATIONS   40400019
         BNE   AB0                      IF NOT, ABEND                   40600019
         TM    19(RUCB),X'03'           TEST FOR VALID XMSN CTRL UNIT   40800019
         BZ    AB1                      IF NOT ABEND                    41000019
         MVZ   DCBHOLD1(1),19(RUCB)     GET ADAPTER TYPE                41200019
         MVN   DCBHOLD1(1),16(RUCB)          MODEL TYPE                 41400019
         IC    RW2,17(RUCB)             GET SPECIAL FEATURES            41600019
         SRL   RW2,2                                                    41800019
         STC   RW2,DCBHOLD2                                             42000019
         SPACE 1                                                        42200019
         LA    RW1,TYPETAB                                              42400019
         LA    RW2,SPFETAB                                              42600019
         B     SCAN1                                                    42800019
         SPACE                                                          43000019
SCAN     LA    RW3,1(RW3)                                               43200019
         LA    RW1,1(RW1)                                               43400019
         LA    RW2,1(RW2)                                               43600019
         SPACE 1                                                        43800019
SCAN1    CLC   0(1,RW1),DCBHOLD1        SCAN FIRST FOR DEVICE TYPE      44000019
         BL    SCAN                                                     44200019
         BH    ERROR                                                    44400019
         SPACE                                                          44600019
         LH    RPARM0,ABINDEX                                           44800019
         CLC   0(1,RW2),DCBHOLD2            THEN FOR FEATURES           45000019
         BNE   SCAN                                                     45200019
         SPACE 4                                                        45400019
ENDLOD1  STC   RW3,DCBDEVTP                                             45600019
         MVC   0(5,RWTGC),BTAMLOD2      MOVE BTAM LOAD 2 ID             45800019
         B     BYPASS1                                                  46000019
         SPACE 1                                                        46200019
DUPDCB   MVC   0(2,RWTGC),ZERO          NO FURTHER OPEN PROCESSING      46400019
         B     BYPASS1                                                  46600019
ANRLOAD2 MVC   0(IDTTRSZ,RWTGC),ANRLD2ID  MOVE ID OF OPEN LOAD 2        46760002
*                                  FOR 3270 INTO WTG TABLE              46820002
         B     BYPASS1             GO TO END-OF-LOAD PROCESSING         46880002
*                                                                       46940002
         SPACE                                                          46952002
BYPASS   MVC   0(5,RWTGC),STRAMID                                       47000019
BYPASS1  L     RSIZE,4(RWTGC)           LOAD ADDRESS OF WORK AREA       47200019
RELOOP   LA    RWTGC,WGOFF(RWTGC)       INCREMENT REGISTER TO    Y02947 47400002
*                                       NEXT WTG ENTRY           Y02947 47450002
         LA    RPARC,PLOFF(RPARC)       INCREMENT REGISTER TO    Y02947 47600002
*                                       NEXT COPIED DCB ADDRESS  Y02947 47650002
         CLC   0(2,RWTGC),AMIDCNST      IS THIS OPEN TO BE CALLED NEXT  47800019
         BE    0(RBASE)                 IF SO, RETURN TO BEGINNING      48000019
         CLC   0(2,RWTGC),OPIDCNST      TEST FOR END OF TABLE           48200019
         BNE   RELOOP                   IF NOT END, LOOP                48400019
         LR    RPARC,RPAR               RESTORE REGISTERS               48600019
         LA    RWTGC,WAOFF(RWTG)                                        48800019
ZCHECK   CLI   0(RWTGC),X'00'           IS IT ZERO                      49000019
         BNE   XCTLRTNE                 IF NOT, GO EXIT                 49200019
         LA    RWTGC,WGOFF(RWTGC)       INCREMENT REGISTER TO    Y02947 49400002
*                                       NEXT WTG ENTRY           Y02947 49450002
         LA    RPARC,PLOFF(RPARC)       INCREMENT REGISTER TO    Y02947 49600002
*                                       NEXT COPIED DCB ADDRESS  Y02947 49650002
         B     ZCHECK                                                   49800019
XCTLRTNE EQU   *                                                        50000019
         LR    RW1,RSIZE                                                50100002
         USING WORKAREA,RW1             WORKAREA ADDRESSABILITY  Y02947 50150002
         LA    RSIZE,DXCCW12 POINT TO DOUBLE WORK LIST                  50200002
         DROP  RW1                      DROP WORKAREA ADDRESS    Y02947 50250002
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID TO NAME FIELD.          50400019
         MVC   14(3,RWTG),2(RWTGC)      MOVE TTR TO WTG TABLE.          50600019
         L     RW1,SIXT                 CVT ADDRESS              Y02947 50650002
         USING CVT,RW1                  CVT ADDRESSABILITY       Y02947 50700002
         L     RW1,CVTSVDCB             SYS1.SVCLIB DCB          Y02947 50750002
         DROP  RW1                      DROP CVT ADDRESSABILITY  Y02947 50760002
         XCTL  DE=(RWTG),SF=(E,(15)),DCB=(RW1)                   Y02947 50800002
         SPACE 4                                                        51000019
AB5      AH    RPARM1,ABINDEX           ADD ONE TO ABEND CODE           51200019
AB4      AH    RPARM1,ABINDEX           ADD ONE TO ABEND CODE           51400019
AB3      AH    RPARM1,ABINDEX           ADD ONE TO ABEND CODE           51600019
AB2      AH    RPARM1,ABINDEX           ADD ONE TO ABEND CODE           51800019
AB1      AH    RPARM1,ABINDEX           ADD ONE TO ABEND CODE           52000019
AB0      ABEND (1)                                                      52200019
         SPACE                                                          52400019
*                                 ABEND S093/94                         52600019
ERROR    AR    RPARM1,RPARM0                                     A35728 52800020
         B     AB3                                               A35728 53000020
         DS    0F                                                       53200019
         SPACE                                                          53400019
         EJECT                                                          53600019
BLNK     EQU   X'40'                    EBCDIC BLANK CHARACTER          53800019
CURNTTCB EQU   4                        OFFSET CURRENT TASK CONTROL BLK 54000019
SIXT     EQU   16                       OFFSET OF CVT            Y02947 54200002
DYNBUF   EQU   X'08'                    DYNAMIC BUFFERING BIT           55000019
ERP      EQU   X'01'                    ERP MASK                        55200019
GRAPHICS EQU   X'10'               DEVICE CLASS FOR 3270 DEVICES        55300002
IDTTRSZ  EQU   5                   LENGTH OF IDTTR                      55350002
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           55400019
STR      EQU   X'FF'                                                    55600019
TCBPKF   EQU   28                                                       55800019
TCBTIO   EQU   12                                                       56000019
TPDEVCCD EQU   X'40'                                                    56200019
UCBDVCLS EQU   18                  DISP TO DEVICE CLASS FIELD IN UCB    56300002
WAOFF    EQU   32                       OFFSET OF FIRST WTG ENTRY FROM  56400019
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           56600019
OFF1C4   EQU   X'1C4'                   DCB PROCESSED BIT OFFSET  M4840 56660002
ON       EQU   X'80'                    DCB PROCESSED BIT         M4840 56720002
TCBDEB   EQU  8                         DISPLACEMENT INTO TCB    Y02947 56770002
*                                       FOR DEB ADDRESS          Y02947 56772002
SEVEN    EQU  7                         MASK FOR STCM            Y02947 56780002
*                                       INSTR (3 BYTES)          Y02947 56790002
         EJECT                                                          56800019
TYPETAB  EQU   *              NOTE: THIS TABLE IS IN PARALLEL WITH      57000019
*                                       SPFETAB AND OFFSETAB            57200019
         DC    5X'11'         1050                                      57400019
         DC    2X'12'         1060                                      57600019
         DC    4X'13'         2740C                                     57800019
         DC   22X'14'         2740                                      58000019
         DC    2X'15'         2741P                                     58200019
         DC    3X'16'         2741C                            @ZA10016 58400000
         DC    4X'17'         1050X                                     58600019
         DC    4X'18'         2740X                                     58800019
         DC    1X'19'        2740B                                 00MC 58900020
         DC    2X'21'         1030                                      59000019
         DC    5X'31'         1050                                      59200019
         DC    4X'32'         1050X                                     59400019
         DC    1X'41'         83B3                                      59600019
         DC    1X'42'         115A                                      59800019
         DC    4X'51'         TWX                              @ZA26035 60000000
         DC    1X'61'         WTTA                                      60200019
         DC    1X'81'         2848                                      60400019
         DC    4X'95'         BSC1                                      60600019
         DC   12X'96'         BSC2                                      60800019
         DC    4X'97'         BSC3                                      61000019
         DC    X'FF'     END OF TYPETAB                                 61200019
         EJECT                                                          61400019
SPFETAB  EQU   *              NOTE: THIS TABLE IS IN PARALLEL WITH      61600019
*                                       TYPETAB AND OFFSETAB            61800019
         SPACE                                                          62000019
*                **               N/A   (6 BITS ONLY)                   62200019
*                  *          D   AUTO DIAL                             62400019
*                   *         P   AUTO POLL                             62600019
*                    *        C   CHECKING                              62800019
*                     *       A   AUTO ANSWER                           63000019
*                      *      S   STATION CONTROL  (2740)               63200019
*                       *     T   TRANSMIT CONTROL (2740)               63400019
         DC    B'00000000'         1050                                 63600019
         DC    B'00000100'                                              63800019
         DC    B'00010000'                                              64000019
         DC    B'00100000'                                              64200019
         DC    B'00100100'                                              64400019
         DC    B'00000000'         1060                                 64600019
         DC    B'00010000'                                              64800019
         SPACE                                                          65000019
         DC    B'00001000'         2740C                                65200019
         DC    B'00001100'                                              65400019
         DC    B'00101000'                                              65600019
         DC    B'00101100'                                              65800019
         DC    B'00000000'         2740                                 66000019
         DC    B'00000010'                                              66200019
         DC    B'00000100'                                              66400019
         DC    B'00000101'                                              66600019
         DC    B'00001000'                                              66800019
         DC    B'00001010'                                              67000019
         DC    B'00001011'                                              67200019
         DC    B'00001100'                                              67400019
         DC    B'00001101'                                              67600019
         DC    B'00001111'                                              67800019
         DC    B'00010010'                                              68000019
         DC    B'00011010'                                              68200019
         DC    B'00100000'                                              68400019
         DC    B'00100001'                                              68600019
         DC    B'00100100'                                              68800019
         DC    B'00100101'                                              69000019
         DC    B'00101000'                                              69200019
         DC    B'00101001'                                              69400019
         DC    B'00101011'                                              69600019
         DC    B'00101100'                                              69800019
         DC    B'00101101'                                              70000019
         DC    B'00101111'                                              70200019
         SPACE                                                          70400019
         DC    B'00000000'         2741'S (2)-PTTC                      70600019
         DC    B'00000100'                                              70800019
         DC    B'00000000'         2741'S (2)-CORRS                     71000019
         DC    B'00000010'         2741 AUTO ANSWER            @ZA04858 71100000
         DC    B'00000100'                                              71200019
         DC    B'00000000'         1050X                                71400019
         DC    B'00000100'                                              71600019
         DC    B'00100000'                                              71800019
         DC    B'00100100'                                              72000019
         DC    B'00001000'         2740X                                72200019
         DC    B'00001100'                                              72400019
         DC    B'00101000'                                              72600019
         DC    B'00101100'                                              72800019
         DC    B'00001000'                                         00MC 72900020
         DC    B'00000000'         1030'S (2)                           73000019
         DC    B'00010000'                                              73200019
         DC    B'00000000'         1050'S (5)-IBM TELL                  73400019
         DC    B'00010000'                                              73600019
         DC    B'00100100'                                              73800019
         DC    B'00000100'                                              74000019
         DC    B'00100000'                                              74200019
         DC    B'00000000'         1050X                                74400019
         DC    B'00000100'                                              74600019
         DC    B'00100000'                                              74800019
         DC    B'00100100'                                              75000019
         DC    B'00000000'         83B3'S (1)                           75200019
         DC    B'00000000'         115A'S (1)                           75400019
         DC    B'00000000'         TWX'S  (4)                  @ZA26035 75600000
         DC    B'00100100'                                              75650000
         DC    B'00000100'                                              75800019
         DC    B'00100000'                                              76000019
         DC    B'00000000'         WTTA                                 76200019
         DC    B'00000000'         2848'S (1)                           76400019
         SPACE                                                          76600019
*                **               N/A   (6 BITS ONLY)                   76800019
*                  *              AUTO DIAL   (BSC2)                    77000019
*                   *             AUTO POLL   (BSC3)                    77200019
*                    *            DUAL INTERFACE                        77400019
*                     *           AUTO ANSWER (BSC2)                    77600019
*                      *          NOT USED = 00                         77800019
*                       *         DUAL CODE                             78000019
         DC    B'00000000'         BSC1                                 78200019
         DC    B'00000001'                                              78400019
         DC    B'00001000'                                              78600019
         DC    B'00001001'                                              78800019
         DC    B'00000100'         BSC2                                 79000019
         DC    B'00000101'                                              79200019
         DC    B'00001100'                                              79400019
         DC    B'00001101'                                              79600019
         DC    B'00100000'                                              79800019
         DC    B'00100001'                                              80000019
         DC    B'00100100'                                              80200019
         DC    B'00100101'                                              80400019
         DC    B'00101000'                                              80600019
         DC    B'00101001'                                              80800019
         DC    B'00101100'                                              81000019
         DC    B'00101101'                                              81200019
         DC    B'00010000'         BSC3                                 81400019
         DC    B'00010001'                                              81600019
         DC    B'00011000'                                              81800019
         DC    B'00011001'                                              82000019
         SPACE 2                                                        82200019
         SPACE 2                                                        82400019
ABCODE   DC    0F'0',X'80090000'                                        82600019
DEBPOOL  DC    0F'0',X'E6000000'        SUBPOOL NUMBER 230       Y02947 82800002
ZERO     DC    X'0000'                                                  83000019
SIXTEEN  DC    H'16'                                                    83200019
SEVENTEN DC    H'17'                                                    83400019
ABINDEX  DC    X'1000'                                                  83600019
         SPACE 2                                                        83800019
HOLDMASK DS    0F                                                       84000019
         DC    BL.8'11111111'   0-3 IOSFLAGS, 4-7 MODEL CODE            84200019
         DC    BL.8'11111100'   8-13 FEATURES, 14-15 SAD COMMAND        84400019
         DC    BL.8'11111111'   16-23 DEVICE CLASS,                     84600019
         DC    BL.8'11110000'   24-27 ADAPTER TYPE,                     84800019
*                                    28-31 CONTROL UNIT                 85000019
OPIDCNST DC    C'0S'                    ID OF LAST OPEN LOAD.           85200019
AMIDCNST DC    C'3M'                    ID OF THIS MODULE.              85400019
UCBMVEX  MVC   0(0,RW3),16(RTIOT)       UCB MOVE INSTRUCTION            85600019
         SPACE 4                                                        85800019
BTAMLOD2 DC    C'4N'                   ID FOR SECOND OPEN LOAD MODULE   87400019
         DC    X'00000000'             TTR AND L                        87600019
STRAMID  DC    C'3W'                                                    87800019
         DC    X'00000000'                                              88000019
ANRLD2ID DC    C'4P',XL4'0'        IDTTR OFR OPEN LOAD 2 FOR 3270       88100002
         EJECT                                                          89200019
         DCBD  DSORG=BX                                                 89400019
         SPACE 2                                                        89600019
DCBHOLD1 EQU   DCBREAD+2                                                89800019
DCBHOLD2 EQU   DCBHOLD1+1                                               90000019
         EJECT                                                          90200019
        IECTDEBX                                                        90400019
         EJECT                                                   Y02947 90450002
WORKAREA DSECT                                                          90460002
         IECDSECT                                                       90520002
         EJECT                                                   Y02947 90570002
CVT      DSECT                                                   Y02947 90580002
         CVT   LIST=NO                                           Y02947 90590002
         END                                                            90600019
./  ADD  SSI=62600010,NAME=IGG0193Q
 TITLE 'IGG0193Q  BTAM LINE GROUP OPEN EXECUTOR - LOAD 3'               00200017
*********************************************************************** 00400002
*                                                                     * 00450002
* MODULE NAME: IGG0193Q  (OS/VS)                                      * 00460002
*                                                                     * 00470002
* DESCRIPTIVE NAME: BTAM LINE GROUP OPEN EXECUTOR - LOAD 3            * 00480002
*                                                                     * 00490002
* COPYRIGHT: NONE                                                     * 00492002
*                                                                     * 00500002
* STATUS: RELEASE 2                                                   * 00700002
*                                                                     * 01000002
* FUNCTION/OPERATION: THIS ROUTINE GETS MAIN STORAGE FOR AND INITIAL- * 01200002
*   IZES AN IOB. IT COMPLETES ANALYSIS OF DEVICE TYPE INFORMATION     * 01400002
*   PROVIDED IN THE UNIT CONTROL BLOCK TO DETERMINE WHAT TYPE OF      * 01600002
*   TERMINAL DEVICES ARE ATTACHED TO THE GROUP OF LINES THAT MAKE UP  * 01800002
*   THIS LINE GROUP. IT THEN INITIALIZES THE LINE BY EXECUTING THE    * 02000002
*   APPROPIATE SET ADDRESS, ENABLE, OR SET MODE COMMAND.              * 02050002
*                                                                     * 02200017
*                                                                     * 02400017
* ENTRY POINT: ENTRY WILL BE TO THE FIRST BYTE OF THE MODULE BY AN    * 02600002
*  'XCTL' TO IGG0193Q THE THIRD  BTAM LOAD. CONTROL WILL BE TRANSFERED* 02800017
*   FROM LOAD 2. IT MAY ALSO BE RE-ENTERED FROM THE RELOOP PORTION OF * 03000017
*   THIS ROUTINE IF IT DETERMINES THAT THERE IS ANOTHER DATA CONTROL  * 03200017
*   BLOCK TO BE OPENED.                                               * 03400017
*                                                                     * 03600017
* INPUT:  THE REGISTERS 5, 6, 7, AND 8 ARE THE INPUT, AS FOLLOWS,     * 03800002
*   5- THE ADDRESS OF THE FIRST ENTRY IN THE COPIED DCB PARAMETER LIST* 04000002
*   6- THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE,         * 04200002
*   7- THE ADDRESS OF THE CURRENT ENTRY IN THE COPIED DCB PARAMETER   * 04400002
*      LIST,                                                          * 04450002
*   8- THE ADDRESS OF THE CURRENT EXECUTOR'S ENTRY IN THE WHERE-TO-GO * 04600002
*      TABLE.                                                         * 04800017
*                                                                     * 05400017
*                                                                     * 05600017
* OUTPUT: THE REGISTERS 7 AND 8 WILL BE POSITIONED AT THE NEXT ENTRIES* 05800002
*   IN THE DCB PARAMETER LIST AND THE WHERE-TO TABLE. ONE IOB PER LINE* 06000017
*   WILL HAVE BEEN CONSTRUCTED IN SUBPOOL 250 IN THE USER'S KEY.      * 06200002
*   IF DYNAMIC BUFFERING WAS SPECIFIED AND VIRTUAL=VIRTUAL, ONE       * 06210002
*   VIRTUAL SUBAREA LIST AND TWO INDIRECT ADDRESSING LISTS WILL       * 06220002
*   BE OBTAINED FROM SUBPOOL 250 IN THE USER'S KEY FOR EACH IOB       * 06230002
*   IN THE LINE GROUP. DCB FIELDS (DEVTP, IOBAD, EIOBX,               * 06240002
*   IFLGS, DEBAD, AND READ/WRITE WILL HAVE BEEN INITIALIZED.          * 06400002
*   THIS EXECUTOR'S ENTRY (OR ENTRIES) IN THE WHERE-TO-               * 06600002
*   GO TABLE WILL HAVE BEEN UPDATED TO IDENTIFY LOAD 4 (IGG0193S).    * 06800017
*                                                                     * 07000017
* EXTERNAL ROUTINES: NONE                                             * 07200002
*                                                                     * 07400017
* EXITS-NORMAL:  THIS ROUTINE EXITS VIA AN XCTL TO THE MODULE         * 07600002
*   IDENTIFIED BY THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE,   * 07800017
*   NAMELY IGG0193S (BTAM OPEN EXECUTOR - LOAD 4).                    * 08000017
*                                                                     * 08200017
* EXIT-ERRORS:                                                        * 08400002
*     -ERRORS-  THIS ROUTINE EXITS VIA ABEND FOR THE FOLLOWING        * 08600017
*   ERROR CONDITIONS-                                                 * 08800017
*   ABEND CODE ERROR CONDITION                                        * 09000017
*   00098000    DUAL COMMUNICATION INTERFACE B OR DUAL CODE FEATURE   * 09150002
*               B WAS NOT SPECIFIED IN THE UCB.                       * 09160002
*                                                                     * 09200017
* TABLES/WORK AREAS: 1.DCB PARAMETER LIST CONTAINS THE ADDRESS OF EACH* 09400002
*  DCB SPECIFIED IN THE OPEN MACRO INSTRUCTION. 2. THE WHERE-TO-GO    * 09600017
*  TABLE CONTAINS THE ID AND TTR OF THE ROUTINE NEEDED TO PROCESS THE * 09800017
*  DCB WHICH CORRESPONDS TO THIS ENTRY.                               * 10000002
*                                                                     * 10050002
* NOTES: FOR SECURITY AND INTEGRITY PURPOSES, OPEN PROCESSING WILL    * 10100002
*  BE ONLY ON THE COPIED DCB AND COPIED DCB PARAMETER LIST. BTAM      * 10150002
*  OPEN LOADS MUST KEEP THE USER DCB AND THE COPIED DCB               * 10160002
*  SYNCHRONIZED. UPON COMPLETION OF THIS MODULE, CONTROL IS PASSED    * 10170002
*  TO THE FOURTH OPEN MODULE THROUGH THE WHERE-TO-GO TABLE ENTRY.     * 10180002
*  BEFORE ISSUEING THE I/O TO INITIALIZE THE LINE, THE COPIED DCB     * 10182002
*  WILL BE MAPPED TO THE USER'S DCB.                                  * 10184002
*                                                                     * 10190002
* CHANGE ACTIVITY AS FOLLOWS:                                         * 10190402
*            APARS                           PTMS                     * 10190802
*       YA01249  (10/1/73)               YM4084  (10/29/73)           * 10191202
*       YA01260  (10/1/73)               YM5663  (12/12/73) PROLOG    * 10191602
*       YA02168  (N/A)                   YM5668  (12/14/73) IECRES    * 10191702
*       YA02172  (10/5/73)                                            * 10191802
*       ZA00535  (11/15/74)        ZA00544  (11/15/74)                * 10211800
*       ZA03207  (03/24/75)        ZA03589  (03/20/75)                * 10241800
*       AZ04187  (10/06/75)        AZ04865  (10/14/75)                * 10246800
*       AZ06399  (12/19/75)                                           * 10251800
*       AZ07636  (11/10/75)                                           * 10256800
*       AZ08051  (01/29/76)                                           * 10261800
*       AZ09356  (04/05/76) - DELETED APARS AZ04187 & AZ04865           10263800
*       AZ11430  (06/09/76)                                             10264800
*       AZ13169  (09/03/76)                                           * 10266800
*                                                                     * 10276800
*********************************************************************** 10283800
         EJECT                                                          10600017
IGG0193Q CSECT                                                          10650002
         SPACE 5                                                        10700002
RE       EQU   0                       WORK/PARAMREG                    10800017
RF       EQU   1                       WORK/PARAMREG                    11000017
RDCB     EQU   2                       COPIED DCB ADDRESS        Y02947 11200002
RBASE    EQU   3                       BASE REGISTER                    11400017
RCORE    EQU   4                       IOB ADDRESS                      11600017
RPAR     EQU   5                       START OF COPIED DCB       Y02947 11800002
*                                      PARAMETER LIST            Y02947 11850002
RWTG     EQU   6                       START OF WTG                     12000017
RPARC    EQU   7                       CURRENT ENTRY IN COPIED   Y02947 12200002
*                                      DCB PARAMETER LIST        Y02947 12250002
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       12400017
RTIOT    EQU   9                       TIOT ADDRESS                     12600017
VSLREG   EQU   RTIOT                   VIRTUAL SUBAREA LIST      Y20947 12650002
*                                      ADDRESS                   Y02947 12700002
RUCB     EQU   10                      CURRENT UCB                      12800017
IOBNUM   EQU   RUCB                    NUMBER OF IOB'S           Y02947 12850002
RDEB     EQU   11                      DEB ADDRESS                      13000017
IDALREG  EQU   RDEB                    INDIRECT ADDRESSING LIST  Y02947 13050002
RB       EQU   12                      WORK REG                         13200017
RC       EQU   13                      WORK REG                         13400017
RD       EQU   14                      WORK/PARAMREG                    13600017
RJ       EQU   15                      WORK/PARAMREG                    13800017
TCBREG   EQU   RJ                      TCB ADDRESS               Y02947 13850002
         SPACE 3                                                        14000017
         USING IECTIOB,RCORE                                            14200017
         USING IHADCB,RDCB                                              14400017
         USING IECTDEB,RDEB                                             14600017
         BALR  RBASE,0                                                  14800017
         USING *,RBASE                                                  15000017
         SPACE 4                                                 Y02947 15050002
         B     AROUND                   BRANCH AROUND ID         Y02947 15100002
         DC    C'IGG0193Q'              OPEN ID                  Y02947 15150002
         DC    C'** MVS *'                                       Y02947 15151000
         DC    C'&SYSDATE'         DATE LAST ASSEMBLY       LD @ZA00544 15152803
PATCH    DC    XL90'00'                PATCH AREA                Y02947 15156002
         DS    0H                                                       15158000
         SPACE 4                                                 Y02947 15160002
AROUND   L     RDCB,0(RPARC)           ESTABLISH COPIED DCB ADDR Y02947 15200002
         L     RDEB,DCBDEBAD            ACCESS POINTER TO DEB    Y02947 15400002
         L     RDEB,28(RDEB)            LOAD DEB START FOR DSECT   000D 15600017
         L     RUCB,DEBUCBAD           GET UCB ADDRESS             000M 15610019
         TM    19(RUCB),X'90'          IS THIS A BSC DEVICE        000M 15620019
         BNO   TSTRETRY                                            000M 15630019
         MVC   92(4,RDCB),DCBBSTSX      SAVE IRB ENTRY POINT       000M 15640019
         SR    RF,RF               CLEAR REGISTER                  000M 15650019
         TM    DCBXCODE,USASCII    ASCII CODE TO BE USED           000M 15660019
         BO    ASCII               IF SO, BRANCH                   000M 15670019
         TM    DCBXCODE,TRANSCD    SIX BIT CODE TO BE USED         000M 15680019
         BO    SIXBIT              IF SO, BRANCH                   000M 15690019
         LA    RF,TBLOFFST(RF)     ADD OFFSET TO CORRECT TABLE     000M 15700019
SIXBIT   LA    RF,TBLOFFST(RF)     ADD OFFSET TO CORRECT TABLE     000M 15710019
ASCII    LA    RF,CHARTBL(RF)      GET ADDRESS OF CHAR TABLE       000M 15720019
         MVC   DCBBSRSV(TBLOFFST),0(RF)   MOVE IN CONTROL CHARS    000M 15730019
         EJECT                                                     000M 15740019
TSTRETRY EQU   *                                                   000M 15750019
         SR    RTIOT,RTIOT                                              15800017
         IC    RTIOT,DCBDEVTP           LOAD DEVICE OFFSET              16000017
         LM    RE,RF,RETRYMSK           GET RETRY MASK                  19800017
         SLDL  RE,0(RTIOT)              POSITION BIT               4113 20000017
         LTR   RE,RE                    TEST SIGN BIT                   20200017
         BM    IOBST1                   RETRYS ARE POSIBLE              20400017
         NI    DCBERROP,ALLON-RDRETRY                                   20600017
         EJECT                                                          20800017
IOBST1   SR    RC,RC                                               000D 21000017
         IC    RC,SZTABLE(RTIOT)        SET NORMAL SIZE            000D 21200017
         TM    DCBBFTEK,DYNBUF    BIT 4 ON INDICATES DYN BUFFERING      21400017
         BZ    SETSIZE                  IF NOT, BRANCH             000D 21600017
         LA    RC,24(RC)                ADD 24 FOR 3 CCW'S         000D 21800017
         SPACE 1                                                 Y02947 21810002
* 6 LINES OF CODE DELETED BY APAR ---------------------------- @ZA13169 21850000
         SPACE 1                                                 Y02947 21994002
SETSIZE  LA    RC,64(RC)                ADD BASIC IOB SIZE         000D 22000017
         TM    19(RUCB),X'90'      BSC DEVICE?                  YA01260 22050002
         BO    YESBSC              YES, CONTINUE                YA01260 22100002
         LA    RC,L32(RC)           NO, EXTEND IOB FOR         @ZA06399 22120000
*                                  START STOP SPECIAL CHARS     YA01260 22160002
YESBSC   EQU   *                                                YA01260 22170002
         STC   RC,DCBEIOBX              STORE IOB SIZE IN IOB      000D 22200017
         LA    RF,4(RC)                 INCREASE IOB SIZE BY 4 @ZA03207 22300000
*    FOR THE ERP EXTENSION. THERE IS ONE ERP EXT ENTRY PER IOB @ZA03207 22450000
         SR    RB,RB                    CLEAR REGISTER             000D 22600017
         IC    RB,DEBNMEXT              LOAD NUMBER OF IOB'S       000D 22800017
         MR    RE,RB                    MULTIPLY SIZE BY NO OF IOB 000: 23000017
         LA    RF,4(RF)                 ADD 4 MORE SINCE THE   @ZA03207 23020000
*                      0TH ENTRY OF THE ERP EXTENSION WILL     @ZA03207 23050000
*                      CONTAIN THE ADDR OF THE TRANSLATOR.     @ZA03207 23100000
*                      ALL OTHER ENTRIES CORRESPOND TO THEIR   @ZA03207 23150000
*                      RLN'S.                                  @ZA03207 23160000
         LR    RE,RF                    LOAD PRODUCT INTO REG 0    000D 23200017
         O     RE,IOBPOOL               OR IN SUBPOOL NUMBER       000E 23400017
         L     RJ,4(RWTGC)              ADDRESS OF OPEN WORKAREA Y02947 23450002
         USING WORKAREA,RJ              WORKAREA ADDRESSABILITY  Y02947 23500002
         SPACE 1                                                 Y02947 23510002
         MODESET KEYADDR=DXUKEY,WORKREG=14   ASSUME USER KEY     Y02947 23550002
         SPACE 1                                                 Y02947 23560002
*    GET CORE FOR IOB'S FROM SUBPOOL 250                         Y02947 23570002
         GETMAIN R,LV=(0)               GET CORE FOR THE IOB'S     000D 23600017
         SPACE 1                                                 Y02947 23650002
         LR    RCORE,RF                 LOAD THE ADDRESS OF THE IOB000D 24000017
         SR    RCORE,RC                 SUB IOB SIZE               000D 24200017
         SPACE 1                                                 Y02947 24210002
         MODESET EXTKEY=DATAMGT         BACK TO DATA MGT KEY     Y02947 24250002
         SPACE 1                                                 Y02947 24300002
         ST    RCORE,DCBIOBAD           STORE IOB ADRS MINUS SIZE  000D 24400017
         STC   RTIOT,DCBDEVTP           STORE DEVICE TYPE          000D 24600017
         L     RJ,DISP4(RWTGC)          RESTORE WORKAREA ADDR    Y02947 24610002
         SPACE 1                                                 Y02947 24650002
         MODESET KEYADDR=DXUKEY,WORKREG=14  ASSUME USER KEY      Y02947 24700002
         SPACE 1                                                 Y02947 24750002
         SR    RD,RD                    RESET REGISTER FOR RLN CNT 000D 24800017
         BCTR  RC,0                     SUBTRACT 1 FOR EXECUTE INST000D 25000017
STARTLP  LA    RCORE,1(RC,RCORE)        STEP IOB ADDRESS           000D 25200017
         EX    RC,CLEAR                 CLEAR IOB                  000D 25400017
         MVI   IOBFLAG1,X'C2'           SET BITS 0,1 AND 6 FOR BTAM000D 25600017
         LA    RF,IOBCPA                LOAD THE CHANNEL PROGRAM AD000D 25800017
         ST    RF,IOBSTART              STORE IN IOBSTART          000D 26000017
         MVC   IOBDCBPT(4),DXUDCBAD     USER'S DCB ADDR TO IOB   Y02947 26200002
         STC   RD,IOBUCBX               STORE RELATIVE LINE NUMBER 000D 26400017
         LA    RD,1(RD)                 ADD 1                      000D 26600017
         BCT   RB,STARTLP               DECREMENT & TEST IOB COUNT 000D 26800017
         LA    RCORE,1(RC,RCORE)        ADDR OF ERP EXT OR     @ZA03207 26805000
*                            ADDR OF END OF IOB'S              @ZA03207 26810000
         IC    RB,DEBNMEXT              GET NUMBER OF IOB'S    @ZA03207 26820000
         LA    RB,1(RB)                 THIS ENTRY IS FOR THE  @ZA03207 26830000
*                           ADDR OF THE TRANSLATOR (IECVTCCW)  @ZA03207 26832000
         SLL   RB,2                     MULTIPLY BY 4, THE     @ZA03207 26834000
*                      LENGTH OF EACH ENTRY IN THE ERP EXT     @ZA03207 26840000
         BCTR  RB,0                     DECREMENT BY 1 FOR     @ZA03207 26842000
*                      THE EXECUTE INSTRUCTION                 @ZA03207 26844000
         EX    RB,CLEAR                 CLEAR ALL ENTRIES IN   @ZA03207 26846000
*                      THE ERP EXTENSION                       @ZA03207 26848000
* 79 LINES OF CODE DELETED BY APAR --------------------------- @ZA13169 27188100
NODBEXT  EQU   *                                                 Y02947 27308002
         LA    RUCB,DEBUCBAD            GET ADRS OF UCB LIST       000E 27310402
         L     RUCB,0(RUCB)             GET ADRS OF UCB            000E 27312802
         CLI   DCBDEVTP,INTR1                                      000I 27315202
         BE    IRBPNT                                              000I 27317602
         CLI   DCBDEVTP,INTR2                                      000I 27320018
         BE    IRBPNT                                              000I 27360018
         TM    19(RUCB),X'90'           THIS A BISYNCH DEVICE      000E 27400017
         BNO   TSTONLT                  IF NOT, BRANCH             000E 27600017
         TM    DCBXCODE,GRAPHMSK        1130/2250 GRAPHICS         000E 27800017
         BO    IRBPNT                   IF SO, IRB POINTERS NEEDED 000E 28000017
TSTONLT  TM    DCBERROP,TRMTST          ONLINE TEST REQUESTED      000E 28200017
         BNO   NOPNTRS                  NO POINTERS NEEDED         000E 28400017
         SPACE 1                                                 Y02947 28450002
IRBPNT   MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 28500002
         SPACE 1                                                 Y02947 28550002
         LA    RE,16                    INDICATE NUMBER OF BYTES   000E 28600002
         O     RE,IOBPOOL               OR IN SUBPOOL NUMBER       000E 28800017
         SPACE 1                                                 Y02947 28850002
*    GET CORE FOR IRB'S FROM SUBPOOL 250                         Y02947 28900002
         GETMAIN  R,LV=(0)              GET CORE FOR POINTERS      000E 29000017
         SPACE 1                                                 Y02947 29010002
         XC    0(12,RF),0(RF)           CLEAR AREA                 000E 29020002
* 4 LINES OF CODE DELETED BY APAR ---------------------------- @ZA13169 29023000
         SPACE 1                                                 Y02947 29040002
         MODESET EXTKEY=DATAMGT         BACK TO DATA MGT KEY     Y02947 29050002
         SPACE 1                                                 Y02947 29100002
         ST    RF,DEBIRBAD-1            STORE ADDRESS IN DEB       000E 29200017
         L     RJ,DISP4(RWTGC)          WORKAREA ADDRESS         Y02947 29210002
         USING WORKAREA,RJ              WORKAREA ADDRESSABILITY  Y02947 29220002
         SPACE 1                                                 Y02947 29250002
         MODESET KEYADDR=DXUKEY,WORKREG=14  ASSUME USER KEY      Y02947 29300002
         SPACE 1                                                 Y02947 29310002
         DROP  RJ                       DROP WORKAREA ADDRESS    Y02947 29350002
         EJECT                                                          30000017
*                   INITIALIZE THE LINES WITH A SET MODE, SAD AND/OR    30200017
*                   AN ENABLE COMMAND AS APPROPRIATE                    30400017
         SPACE 3                                                        30600017
NOPNTRS  LA    RD,DEBUCBAD              POINT TO TABLE OF UCB      000E 30800017
*                                  ADDRESSES.                           31000017
         L     RCORE,DCBIOBAD           CALCULATE ADDRESS OF FIRST IOB. 31200017
         SR    RB,RB                                                    31400017
         IC    RB,DCBEIOBX                                              31600017
         AR    RCORE,RB                                                 31800017
         SR    RC,RC                    LOAD NUMBER OF EXTENTS TO BE    32000017
         IC    RC,DEBNMEXT         USED AS A LOOP COUNTER.              32200017
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 32400017
SADTEST  L     RUCB,0(RD)               LOAD UCB ADDRESS.               32600017
         TM    19(RUCB),X'90'           TEST FOR BXC (VIA ADAPTER TYPE( 32800017
         BNO   NOTBSC                   IF NOT BSC, BRANCH              33000017
CHKTCU   TM    19(RUCB),X'03'           TEST FOR 2703 T C U        000D 33200017
         BO SETMODE                     IF SO, NO FURTHER TESTS         33400017
         TM    DCBXMODE,DATAB           TEST FOR DATA INTERFACE B       33600017
         BZ    TESTCODE                 IF NOT SPECIFIED GO TEST CODE   33800017
         TM    17(RUCB),DATAB           IF SOK IS IT LEGAL              34000017
         BZ    AB7                      NO, ABEND              @ZA07636 34050000
TESTCODE TM    DCBXMODE,CODEB           TEST FOR TRANSMISSION CODE B    34400017
         BZ    SETMODE                  IF NOT SPECIFIED GO SET MODE    34600017
         TM    17(RUCB),CODEBUCB        IF SO, IS IT LEGAL              34800017
         BZ    AB7                      IF NOT, ABEND                   35000017
SETMODE  L     RJ,IOBDCBPT             GET DCB ADDR FROM IOB     YM4084 35050002
         LA    RJ,DCBXMODE-IHADCB(RJ)  GET ADDRESS OF MODE BYTE  YM4084 35200002
*                                      IN USER DCB               YM4084 35250002
         MVC   IOBCPA+8(8),ENABLE      MOVE IN SETMODE/SAD CCW   A26896 35300019
         MVI   IOBCPA,DISABLE          MOVE IN COMMAND CODE      A26896 35500019
         MVC   IOBCPA+1(7),ENABLE+1    COMPLETE CCW              A26896 35600019
         OI    IOBCPA+4,CMDCHAIN       CHAIN DISABLE TO SET MODE A26896 35700019
         TM    19(RUCB),X'90'          TEST FOR BSC              A26896 35720019
         BNO   SADRTNE                 IF NOT, BRANCH            A26896 35740019
         ST    RJ,IOBCPA+8             STORE MODE IN CCW         A26896 35760019
         MVI   IOBCPA+8,SETMODCM       MOVE IN COMMAND CODE      A26896 35800019
         B     TESTAA                                                   36000017
AB7      L     1,ERR7                                                   36200017
         ABEND (1)                                                      36400017
NOTBSC   TM    19(RUCB),X'01'           TEST FOR 2702/3                 36600017
         BZ    ENABCTL                                                  36800017
         TM    19(RUCB),X'0C'                                           37000017
         BZ    SETMODE                                           A26896 37200019
ENABCTL  MVC   IOBCPA(8),ENABLE         SET ENABLE CCW IN CHAN PGA30747 37400020
         TM    17(RUCB),X'90'           AUTO CALL OR AUTO ANSR   A30747 37600020
         BNZ   SETNOP                   BRANCH IF EITHER         A30747 37800020
         CLI   19(RUCB),X'82'           TEST FOR 2701 W/ TYPE 3 ADPTR   38000017
         BNE   EXCP                     NO, BRANCH               A30747 38200020
SETNOP   MVI   IOBCPA,X'03'             MOVE IN NOP COMMAND CODE A30747 38400020
         B     EXCP                                                     38600017
SADRTNE  SR    RDCB,RDCB                CLEAR REGISTER AND SET UP       38800017
         IC    RDCB,17(RUCB)       SAD COMMAND CODE.                    39000017
         N     RDCB,ANDMASK                                             39200017
         IC    RTIOT,SADCCODE(RDCB)     INSERT ACTUAL COMMAND CODE AND  39400017
         STC   RTIOT,IOBCPA+8          STORE IN IOB              A26896 39800019
TESTAA   TM    17(RUCB),X'90'           TEST FOR AUTO-CALL OR ANSWER    40200017
         BNZ   EXCP                     IF EITHER PRESENT, DO NOT ENABL 40400017
         MVC   IOBCPA+16(8),ENABLE     MOVE IN ENABLE COMMAND    A26896 40600019
         OI    IOBCPA+12,CMDCHAIN      CHAIN SETMODE TO ENABLE   A26896 40800019
*                                  TO SAD COMMAND.                      41000017
EXCP     EQU   *                                                 Y02947 41080002
         LA    RE,SIXTY                 MESSAGE AREA LENGTH      Y02947 41130002
         O     RE,POOLNUM               SUBPOOL 250              Y02947 41180002
         SPACE 1                                                 Y02947 41190002
         GETMAIN R,LV=(0)               GET CORE FOR MSG AREA    Y02947 41230002
         SPACE 1                                                 Y02947 41232002
         LR    RTIOT,RF                 LOAD BASE FOR MSG AREA   Y02947 41240002
         USING REPLYLTH,RTIOT           MSG AREA ADDRESSABILITY  Y02947 41280002
         ST    RTIOT,IOBCPA+32         ST ADD OF AREA IN IOB     A28619 41400019
         MVI   IOBCPA+32,X'FF'         SET FLAG FOR MSGWTR       A29575 41480019
         MVI   REPLYLTH,ZERO           SET REPLY LENGTH FIELD    Y02947 41690002
*                                      TO ZERO. THE ERP'S WILL   Y02947 41740002
*                                      CHANGE THIS FIELD TO      Y02947 41790002
*                                      REPLY LENGTH IF WE MUST   Y02947 41840002
*                                      ISSUE WTOR                Y02947 41842002
         SPACE 1                                                 Y02947 41850002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 41900002
         LR    RF,RCORE                SAVE IOB ADDRESS          Y02947 41910002
         L     RCORE,DISP4(RWTGC)      WORK AREA ADDRESS         Y02947 41920002
         SPACE 1                                                 Y02947 41950002
         USING WTG,RWTG                 WTG ADDRESSABILITY       Y02947 41970002
         L     RJ,WTGPREFX              WTG PREFIX ADDRESS       Y02947 41980002
         STM   RE,RD,IECREGSV-IECPREFX(RJ) SAVE REGS             Y02947 41990002
         IECRES INIT,DCBCOPY=FRWKAR                              Y02947 41992002
         LR    RJ,RWTG                 REG SAVEAREA ADDR         YM5668 41992402
         LM    RE,RD,IECREGSV-IECPREFX(RJ) RESTORE REGS          Y02947 41994002
         LR    RCORE,RF                RESTORE IOB ADDRESS       Y02947 41994402
         DROP  RWTG                     DROP WTG ADDRESS         Y02947 41996002
         USING WORKAREA,RJ              WORKAREA ADDRESSABILITY  Y02947 41998002
         L     RJ,4(RWTGC)              WORKAREA ADDRESS         Y02947 41998402
         SPACE 1                                                 Y02947 41998802
         MODESET KEYADDR=DXUKEY,WORKREG=1     USER KEY           Y02947 41999202
         SPACE 1                                                 Y02947 41999602
         DROP  RJ                       DROP WORKAREA ADDRESS    Y02947 42049602
RETRY    EQU   *                                                 Y02947 42099602
         LA    RJ,IOBERCCW                                       Y02947 42109602
         ST    RJ,IOBECBPT              STORE ECB ADDRESS IN IOB Y02947 42119602
         LA    1,IOBFLAG1               LOAD IOB ADDRESS.               42149602
         EXCP  (1)                                                      42200017
         MVI   IOBINCAM+1,X'00'         SET BYTE TO ZERO           000E 42400017
         MVC   IOBCPA+36(TIMELNG),TIME  MOVE TIME VALUE        @ZA11430 42405000
         SPACE 1                                                 Y02947 42450002
STIMER   STIMER  WAIT,BINTVL=IOBCPA+36 WAIT ONE HALF SECOND LD @ZA11430 42600000
         SPACE 1                                                 Y02947 42650002
         L     1,IOBECBPT               LOAD POINTER TO IOB        000E 42800017
         TM    IOBFLAG1,X'24'           IS ERP IN CONTROL               42860017
         BO    STIMER                   WAIT FOR ERP TO COMPLETE        42920017
         TM    0(1),X'7F'               IS ECB POSTED              000E 43000017
         BNZ   POSTED                   BRANCH IF YES              000E 43200017
         CLI   IOBINCAM+1,X'0D'        HAS COUNT REACHED MAX 7   A26896 43400019
         BNL   PURGE                   YES, PURGE I/O       LD @ZA00535 43600003
         IC    RF,IOBINCAM+1            GET TIMER COUNT            000E 43800017
         LA    RF,1(RF)                 UPDATE COUNT               000E 44000017
         STC   RF,IOBINCAM+1            STORE TIMER COUNT          000E 44200017
         B     STIMER                                              000E 44400017
POSTED   CLI   0(1),X'7F'               TEST FOR NORMAL COMPLETION 000E 44600017
         BE    NORMALCP                                          A29575 44700019
         CLI   REPLYLTH,ZERO           ERP HAD CONTROL?          Y02947 44810002
         BE    SETERR                  NO, MSGWTOR NOT NEEDED    A27612 44820019
WTOR     EQU   *                                                 Y02947 44850002
         LR    RF,RTIOT                MSG AREA ADDRESS ADDR     Y02947 44860002
         MVI   REPLY+DISP8,ZERO        SET COMPLETION FLAG OFF   Y02947 44870002
*                                      THE 3RD WORD OF THE REPLY Y02947 44880002
*                                      AREA IS THE ECB           Y02947 44882002
         SPACE 3                                                 Y02947 44898802
         WTOR  MF=(E,(1))              WRITE CONTROL UNIT NOT OP A27612 44900019
         SPACE 3                                                 Y02947 44902002
         WAIT  ECB=REPLY+DISP8         WAIT FOR REPLY            Y02947 44910002
         SPACE 1                                                 Y02947 44912002
         CLC   REPLY(4),CONT           RETRY REQUESTED           A27612 44920019
         BE    RETRY                                             A27612 44930019
         CLC   REPLY(4),POST           LINE IDLE REQUESTED       A27612 44940019
         BNE   WTOR                    INVALID RESPONSE, RETRY MEA27612 44950019
         B     SETERR                                       LD @ZA00535 44960003
*                                                                       44970002
PURGE    EQU   *                                            LD @ZA00535 44980003
         MODESET EXTKEY=DATAMGT    DATA MANAGEMENT KEY      LD @ZA00535 44990003
         L     RJ,DISP4(RWTGC)     OPEN WORKAREA ADDR       LD @ZA00535 44992003
         USING WORKAREA,RJ         WORKAREA ADDRESSABILITY  LD @ZA00535 44994003
         XC    DXCCW(TWELVE),DXCCW CLEAR PURGE PARM LIST    LD @ZA00535 44996003
         LA    RDEB,HEX24(RDEB)        POINT TO DEB LOC'0'  L5 @ZA03589 44996200
         ST    RDEB,DXCCW          DEB ADDR IN PARM LIST    LD @ZA00535 44998003
         MVI   DXCCW,PURGEOPT      HALT I/O OPTION          LD @ZA00535 44998403
         PURGE DXCCW                                        LD @ZA00535 44998803
         L     RJ,DISP4(RWTGC)     OPEN WORKAREA ADDR       LD @ZA00535 44999000
         L     RDEB,28(RDEB)       LOAD DEB START FOR DSECT L5 @ZA03589 44999200
         MODESET KEYADDR=DXUKEY,WORKREG=15  USER'S KEY      LD @ZA00535 44999603
SETERR   OI    IOBINCAM,SADENER         SET ERROR FLAG IN IOB      000E 45000017
NORMALCP EQU   *                                                 Y02947 45100002
         LR    RF,RTIOT                MSG AREA ADDRESS          Y02947 45150002
         LA    RE,SIXTY                MSG AREA LENGTH           Y02947 45200002
         O     RE,POOLNUM              SUBPOOL 250               Y02947 45250002
         SPACE 1                                                 Y02947 45260002
         FREEMAIN R,LV=(0),A=(1)       FREE MSG AREA             Y02947 45300002
         SPACE 1                                                 Y02947 45310002
         XC    IOBCPA+32(4),IOBCPA+32  CLEAR WORKAREA IN IOB     A28619 45340019
SADLPCHK MVI   IOBINCAM+1,X'00'                                  A29575 45360019
         LA    RCORE,0(RB,RCORE)                                   000E 45400017
         LA    RD,4(RD)                 GET ADDRESS OF NEXT ENTRY IN    45600017
*                                  TABLE OF UCB ADDRESSES.              45800017
         BCT   RC,SADTEST               RETURN TO SADTEST IF ALL LINES  46000017
*                                  HAVE NOT YET BEEN INITIALIZED.       46200017
         DROP  RTIOT                   DROP MSG AREA ADDRESS     Y02947 46250002
         SPACE 3                                                        48800017
         EJECT                                                          49000017
ENDLOD2  EQU   *                                                 Y02947 49050002
         SPACE 1                                                 Y02947 49060002
         MODESET EXTKEY=DATAMGT         BACK TO DATA MGT KEY     Y02947 49100002
         SPACE 1                                                 Y02947 49150002
         MVC   0(5,RWTGC),BTAMLOD4      SET UP ID FOR LOAD 4 OF  Y02947 49200002
*                                       BTAM EXECUTOR.           Y02947 49400002
         L     RJ,4(RWTGC)                                              49600017
         USING WORKAREA,RJ              WORKAREA ADDRESSABILITY  Y02947 49650002
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG REGISTER. 49800017
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT PARAMETER     50000017
*                                  LIST REGISTER TO NEXT ENTRY.         50200017
         CLC   0(2,RWTGC),AMIDCNST      IF THE NEXT WTG ENTRY CALLS FOR 50400017
         BCR   8,RBASE             THIS EXECUTOR, RETURN TO BEGINNING.  50600017
         CLC   0(2,RWTGC),OPIDCNST      IF NOT, TEST FOR END OF TABLE.  50800017
         BNE   RELOOP              NOT END OF TABLE, RETURN TO CHECK    51000017
*                                  NEXT ENTRY.                          51200017
         LR    RPARC,RPAR               REINITIALIZE CURRENT WTG REG    51400017
         LA    RWTGC,WAOFF(0,RWTG) AND CURRENT PARAMETER LIST REG.      51600017
ZCHECK   CLI   0(RWTGC),X'00'                                           51800017
         BNE   XCTLRTNE            IF NOT ZERO, GO TO TRANSFER CONTROL  52000017
         LA    RWTGC,WGOFF(0,RWTGC) IF ZERO, GET NEXT ENTRY AND RETURN  52200017
         LA    RPARC,PLOFF(0,RPARC) TO ZCHECK.                          52400017
         B     ZCHECK                                                   52600017
         SPACE 3                                                        52800017
XCTLRTNE EQU   *                                                        53000017
         LA    RJ,DXCCW12               ADDR DOUBLE WORD LIST    Y02947 53200002
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID TO NAME FIELD.          53400017
         MVC   14(3,RWTG),2(RWTGC)      MOVE TTR TO WTG TABLE.          53600017
         DROP  RJ                       DROP WORKAREA ADDRESS    Y02947 53650002
         L     RC,SIXT                  CVT ADDRESS              Y02947 53700002
         USING CVT,RC                   CVT ADDRESSABILITY       Y02947 53750002
         L     RC,CVTSVDCB              SYS1.SVCLIB DCB          Y02947 53760002
         DROP  RC                       DROP CVT ADDRESS         Y02947 53770002
         XCTL  DE=(RWTG),SF=(E,(15)),DCB=(RC)                    Y02947 53800002
         EJECT                                                          54000017
SZTABLE  EQU   *                                                        54100019
         SPACE 1                                                        54200019
         DC    AL1(S8)   00        1050                                 54300019
         DC    AL1(S9)   01             P                               54400019
         DC    AL1(SB)   02             AD                              54500019
         DC    AL1(SA)   03             A                               54600019
         DC    AL1(SB)   04             D                               54700019
         SPACE 1                                                        54800019
         DC    AL1(S5)   05        2740                                 54900019
         DC    AL1(S8)   06             AD                              55000019
         DC    AL1(S6)   07             A                               55100019
         DC    AL1(S7)   08             D                               55200019
         DC    AL1(S8)   09             ACDX                            55300019
         DC    AL1(S8)   0A             ACX                             55400019
         DC    AL1(S8)   0B             CDX                             55500019
         DC    AL1(S8)   0C             ADX                             55600019
         DC    AL1(S8)   0D             AX                              55700019
         DC    AL1(S8)   0E             DX                              55800019
         DC    AL1(S8)   0F             ACD                             55900019
         DC    AL1(S6)   10             AC                              56000019
         DC    AL1(S8)   11             CD                              56100019
         DC    AL1(S9)   12             CPS                             56200019
         DC    AL1(S8)   13             CS                              56300019
         DC    AL1(S8)   14             PS                              56400019
         DC    AL1(S7)   15             S                               56500019
         DC    AL1(S6)   16             C                               56600019
         SPACE 1                                                        56700019
         DC    AL1(S7)   17        1060                                 56800019
         DC    AL1(S9)   18             P                               56900019
         SPACE 1                                                        57000019
         DC    AL1(S8)   19        1030                                 57100019
         DC    AL1(S9)   1A             P                               57200019
         SPACE 1                                                        57300019
         DC    AL1(S6)   1B        83B3                                 57400019
         DC    AL1(S0)   1C             TT                              57500019
         SPACE 1                                                        57600019
         DC    AL1(S5)   1D        115A                                 57700019
         DC    AL1(S0)   1E             TT                              57800019
         SPACE 1                                                        57900019
         DC    AL1(S7)   1F        TWX  A                               58000019
         DC    AL1(S7)   20             AD                              58100019
         DC    AL1(S7)   21             D                               58200019
         SPACE 1                                                        58300019
         DC    AL1(S8)   22        2848                                 58400019
         SPACE 1                                                        58500019
         DC    AL1(S0)   23                                             58600019
         DC    AL1(S0)   24                                             58700019
         SPACE 1                                                        58800019
         DC    AL1(S9)   25        BSC1                                 58900019
         SPACE 1                                                        59000019
         DC    AL1(SC)   26        BSC2      (A, AD, OR D)       S99245 59100002
         SPACE 1                                                        59200019
         DC    AL1(SA)   27        BSC3      (P)                        59300019
         SPACE 1                                                        59400019
         DC    AL1(S0)   28                                             59500019
         DC    AL1(S0)   29                                             59600019
         SPACE 1                                                        59700019
         DC    AL1(S8)   2A        WTTA                                 59800019
         SPACE 1                                                        59900019
         DC    AL1(S6)   2B        2741                                 60000019
         DC    AL1(S6)   2C             A                               60100019
         SPACE 1                                                        60200019
         DC    AL1(S8)   2D        2740 C OIU                           60300019
         DC    AL1(S8)   2E             CD OIU                          60400019
         SPACE 1                                                        60500019
         DC    AL1(S8)   2F        1050X                                60600019
         DC    AL1(SB)   30             A,D,AD                          60700019
         SPACE 1                                                        60800019
         DC    AL1(S8)   31        2740X                                60900019
         DC    AL1(S8)   32             A,D,AD                          61000019
         SPACE 4                                                        61100019
S0       EQU   0                                                        61200019
S5       EQU   8*5                                                      61300019
S6       EQU   8*6                                                      61400019
S7       EQU   8*7                                                      61500019
S8       EQU   8*8                                                      61600019
S9       EQU   8*9                                                      61700019
SA       EQU   8*10                                                     61800019
SB       EQU   8*11                                                     61900002
SC       EQU   8*12          DVC DEPENDENT I/O LENGTH - BSC2     S99245 61950002
         EJECT                                                     000M 62000019
CHARTBL  EQU   *                                                   000M 62100019
*              USASCII CONTROL CHARACTERS                          000M 62200019
         DC    X'103F1002'         DLE WBT, DLE STX                000M 62300019
         DC    X'10031030'         DLE ETX, ACK 0                  000M 62400019
         DC    X'10310515'         ACK 1, INQ, NAK                 000M 62500019
         DC    X'17100416'         ETB, DLE, EOT, SYN              000M 62600019
         DC    X'10170125'         DLE ETB, SOH %                       62700019
         DC    X'103B103C'         DLE SAK, DLE RVI                000M 62800019
TBLOFFST EQU   *-CHARTBL                                           000M 62900019
*              TRANSCODE CONTROL CHARACTERS                        000M 63000019
         DC    X'1F401F0A'         DLE WBT, DLE STX                000M 63100019
         DC    X'1F2E1F20'         DLE ETX, ACK 0                  000M 63200019
         DC    X'1F232D3D'         ACK 1, INQ, NAK                 000M 63300019
         DC    X'0F1F1E3A'         ETB, DLE, EOT, SYN              000M 63400019
         DC    X'1F0F002C'         DLE ETB,SOH %                        63500019
         DC    X'1F291F32'         DLE SAK, DLE RVI                000M 63600019
*              EBCDIC CONTROL CHARACTERS                           000M 63700019
         DC    X'107F1002'         DLE WBT, DLE STX                000M 63800019
         DC    X'10031070'         DLE ETX, ACK 0                  000M 63900019
         DC    X'10612D3D'         ACK 1, INQ, NAK                 000M 64000019
         DC    X'26103732'         ETB, DLE, EOT, SYN              000M 64100019
         DC    X'1026016C'         DLE ETB, SOH %                       64200019
         DC    X'106B107C'         DLE SAK, DLE RVI                000M 64300019
USASCII  EQU   X'14'                                               000M 64400019
TRANSCD  EQU   X'28'                                               000M 64500019
TIMELNG  EQU   4                                               @ZA08051 64520000
         SPACE 4                                                        64600017
         EJECT                                                          64800017
TIME     DC    F'50'                                               000E 65000017
EIGHT    DC    F'8'                    LENGTH OF IOB DYNAMIC     Y02947 65010002
*                                      BUFFERING EXTENSION       Y02947 65020002
RPGFIX   DC    X'40000000'             REGISTER PGFIX FLAG FOR   Y02947 65040002
*                                      PAGE SERVICES             Y02947 65042002
POST     DC    C'POST'                                           A27612 65050019
CONT     DC    C'CONT'                                           A27612 65100019
POOLNUM  DC    X'FA000000'       SUBPOOL 250                     Y02947 65150002
ERR4     DC    0F'0',X'80094000'        NON-SUPPORTED FEATURE      000I 65300018
ERR7     DC    X'80098000'       ABEND FOR DUAL INTERFACE ERROR YA01249 65400002
*     ERR8                          DELETED BY FOLLOWING APAR   YA02172 65650002
ANDMASK  DC    X'00000003'                                              65800017
ENABLE   DC    X'2700000020240001'                                      66000017
IOBPOOL  DC    X'FA000000'              SUBPOOL NUMBER FOR IOB          66200017
SADCCODE DC    X'13'                    SADZER CODE                     66600017
         DC    X'17'                    SADONE CODE                     66800017
         DC    X'1B'                    SADTWO CODE                     67000017
         DC    X'1F'                    SADTHREE CODE                   67200017
RETRYMSK DS    0F             READ RETRY MASK                           67400017
   DC  BL.51'111110000111000111110010000000000010000001000111111'  000M 67500019
*        1050*****                                                 000K 67600018
*        2740     ******************                               000K 67700018
*        1060                       **                             000K 67800018
*        1030                         **                           000K 67900018
*        TEL1                           ****                       000K 68000018
*        TEL2                               ***                    000K 68100018
*        2260                                  *                   000K 68200018
*        S360                                   **                 000K 68300018
*        1130/2780                                ***              000K 68400018
*        2780 MULTIPOINT                             *             000K 68500018
*        2020 MULTIPOINT                              *            000K 68600018
*        WTTA                                          *           000K 68700018
*        2741                                           **         000K 68800018
*        2740 OIU                                         **       000K 68900018
*        1050X                                              **     000M 69300019
*        2740X                                                **   000M 69700019
         SPACE                                                          70200017
CLEAR    XC    0(1,RCORE),0(RCORE)                                      70400017
OPIDCNST DC    C'0S'                    ID OF LAST OPEN LOAD.           70600017
AMIDCNST DC    C'3Q'                    ID OF THIS MODULE.              70800017
MASK1    EQU   X'05'                                               000I 70900018
MASK     EQU   X'03'                    UCB MODEL BITS FOR 2780    000C 71000017
MPOFFSET EQU   X'26'                    OFFSET FOR 1130/2780 MPT   000C 71200017
DISP0    EQU   0                        DISPLACEMENT OF 0        Y02947 71250002
DISP4    EQU   4                        DISPLACEMENT OF 4        Y02947 71350002
DISP8    EQU   8                        DISPLACEMENT OF 8        Y02947 71360002
DISP160  EQU   160                      LENGTH OF ONE IDAL       Y02947 71370002
         SPACE 2                                                        71400017
CODEBUCB EQU   X'04'                    TRANSMISSION CODE B             71600017
CODEB    EQU   X'08'                    TRANSMISSION CODE B             71800017
DATAB    EQU   X'20'                    DATA INTERFACE B                72000017
SETMODCM EQU   X'23'                    SET MODE COMMAND                72200017
DISABLE  EQU   X'2F'                                             A26896 72300019
WAOFF    EQU   32                       OFFSET OF FIRST WTG ENTRY FROM  72400017
*                                  START OF WTG.                        72600017
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES.          72800017
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES.          73000017
SADENER  EQU   X'80'         FLAG FOR ERROR ON SAD OR ENABLE            73200017
ALLON    EQU   X'FF'                                                    73400017
RDRETRY  EQU   X'02'                                                    73600017
CMDCHAIN EQU   X'40'                                                    73800017
DYNBUF   EQU   X'08'                    CODE FOR BFTEK=D IN THE DCB,    74400017
GRAPHMSK EQU   X'40'                                               000E 74600017
ONLT     EQU   X'10'                    ON LINE TEST BIT           000D 74800017
TRMTST   EQU   X'10'                                               000E 75000017
TYP25    EQU   X'25'                                                    75200017
TYP26    EQU   X'26'                                                    75400017
TYP27    EQU   X'27'                                                    75600017
TYP2B    EQU   X'2B'                   2741 OFFSET                 000I 75640018
INTR1    EQU   X'2B'                                               000I 75680018
INTR2    EQU   X'2C'                                               000I 75720018
FEA      EQU   X'10'                    AUTO-ANSWER FEATURE        000I 75760018
M2020    EQU   X'04'                                                    75800017
ZERO     EQU   X'00'                                                    75820000
X90      EQU   X'90'                                           @ZA04187 75850000
L19      EQU   19                                              @ZA04187 75900000
HEX24    EQU   36                                           L5 @ZA03589 75950000
PURGEOPT EQU   X'A0'               OPTION BYTE FOR PURGE    LD @ZA00535 76010003
ONE      EQU   1                    VALUE OF 1                   Y02947 76050002
L2       EQU   2                                               @ZA04865 76050500
LEN4     EQU   4                    LENGTH OF 4                  Y02947 76052002
TWELVE   EQU   12                                           LD @ZA00535 76054003
SIXT     EQU   16                   CVT ADDRESS                  Y02947 76060002
TWENTY8  EQU   28                   VALUE OF 28                  Y02947 76070002
THIRTY2  EQU   32                   VSL LENGTH                   Y02947 76080002
L32      EQU   32                                              @ZA06399 76082000
IDALLEN  EQU   320                  LENGTH OF 2 IDAL'S           Y02947 76090002
ONEBIT   EQU   1                    MULTIPLY BY 2                Y02947 76092002
FIVEBITS EQU   5                    MULTIPLY BY 32               Y02947 76094002
SIXTY    EQU   X'60'                MESSAGE AREA LENGTH          Y02947 76096002
         SPACE 4                                                   000I 76100018
BTAMLOD4 DC    C'3S'                   ID FOR FOURTH OPEN LOAD   Y02947 77400002
         DC    X'00000000'             TTR AND L                        77600017
         EJECT                                                          78600017
         DCBD  DSORG=BX,DEVD=BS                                         78800017
         EJECT                                                   Y02947 78850002
        IECTIOBX                                                        79200017
         EJECT                                                          79400017
        IECTDEBX                                                        79600017
         EJECT                                                   Y02947 79610002
WORKAREA DSECT                                                   Y02947 79650002
         IECDSECT IOB=NO                                         Y02947 79700002
         EJECT                                                   Y02947 79702002
         IECDSECS WTG,PREFX,EXPAND=YES                           Y02947 79710002
         EJECT                                                   Y02947 79750002
CVT      DSECT                                                   Y02947 79760002
         CVT   LIST=NO                                           Y02947 79770002
         EJECT                                                   Y02947 79780002
         IKJTCB DSECT=YES,LIST=YES                               Y02947 79790002
         EJECT                                                   Y02947 79792002
         IHAPSA                                                  Y20947 79794002
         END                                                            79800017
./  ADD  SSI=81780241,NAME=IGG0193S
 TITLE 'IGG0193S  BTAM LINE GROUP OPEN EXECUTOR - LOAD 4'               00200017
*********************************************************************** 00250002
*                                                                     * 00300002
* MODULE NAME: IGG0193S   (OS/VS)                                     * 00350002
*                                                                     * 00400002
* DESCRIPTIVE NAME: BTAM LINE GROUP OPEN EXECUTOR - LOAD 4            * 00410002
*                                                                     * 00420002
* COPYRIGHT: NONE                                                     * 00430002
*                                                                     * 00450002
* STATUS: RELEASE 2                                                   * 00700002
*                                                                     * 01000017
* FUNCTION/OPERATION: THIS ROUTINE IS BROUGHT INTO CORE AND GIVEN     * 01200002
*  CONTROL WHEN OPEN EXECUTOR LOAD3 FOR TELECOMMUNICATIONS ISSUES     * 01400017
*  'XCTL' TO IGG0193S.                                                * 01600017
*  THIS ROUTINE LOADS THE REQUIRED OPEN TELECOMMUNICATION MODULES,AND * 01800017
*  STORES THE ID OF THE MODULES AND A COUNT OF MODULES LOADED, INTO   * 02000017
*  THE DEB AND SETS UP TERMINAL TEST MASK IF REQUIRED.                * 02200017
*                                                                     * 02800017
* ENTRY POINT: ENTRY WILL BE TO THE FIRST BYTE OF THE MODULE BY AN    * 03000002
*  'XCTL' TO IGG0193S THE FOURTH BTAM LOAD.                           * 03200002
*                                                                     * 03250002
* INPUT:  THE REGISTERS 5,6,7,8 ARE THE INPUT AS FOLLOWS,             * 03400002
*       5 -   ADDRESS OF THE FIRST ENTRY IN THE COPIED DCB PARAMETER  * 03450002
*             LIST,                                                   * 03500002
*       6 -   BEGINNING OF THE WHERE-TO-GO TABLE                      * 03600017
*       7 -   ADDRESS OF THE CURRENT ENTRY IN THE COPIED DCB          * 03800002
*             PARAMETER LIST,                                         * 03850002
*       8 -   ADDRESS OF THE CURRENT ENTRY IN THE WHERE-TO-GO TABLE   * 04000017
*                                                                     * 04800017
* OUTPUT: THE REGISTERS 7,8 WILL BE POSITIONED TO THE NEXT UNFINISHED * 05000002
*  ENTRY, AND THE REQUIRED BTAM MODULES WILL BE LOADED INTO CORE.     * 05200017
*                                                                     * 05250002
* EXTERNAL ROUTINES: NONE                                             * 05400002
*                                                                     * 05600017
* EXIT-NORMAL: THIS ROUTINE TERMINATES BY LOCATING THE NEXT NON-ZERO  * 05800002
*  ENTRY IN THE WHERE-TO-GO TABLE AND EXECUTING AN XCTL TO THAT       * 06000017
*  ROUTINE.                                                           * 06200017
*                                                                     * 06250002
* EXIT-ERRORS:                                                        * 06400002
*     -ERRORS-  THIS ROUTINE EXITS VIA ABEND FOR THE FOLLOWING        * 06450002
*   ERROR CONDITIONS-                                                 * 06500002
*   ABEND CODE ERROR CONDITION                                        * 06550002
*   00097000   THE CURRENT OPEN REQUIRES AN ADDITIONAL ENTRY IN       * 06560002
*              THE DEVICE I/O DIRECTORY.                              * 06570002
*                                                                     * 06600017
* TABLES/WORK AREAS: 1.DCB PARAMETER LIST CONTAINS THE ADDRESS OF EACH* 06800002
*  DCB SPECIFIED IN THE OPEN MACRO INSTRUCTION. 2. THE WHERE-TO-GO    * 07000017
*  TABLE CONTAINS THE ID AND TTR OF THE ROUTINE NEEDED TO PROCESS THE * 07200017
*  DCB WHICH CORRESPONDS TO THIS ENTRY. THE CHNIDTBL CONTAINS THE     * 07400017
*  IDS NEEDED FOR WHERE-TO-GO TABLE AND LOAD OF REQUIRED OPEN MODULES.* 07600017
*                                                                     * 07650002
* ATTRIBUTES: THIS ROUTINE IS EXECUTED IN THE DATA MANAGEMENT KEY OF  * 08200002
*       5 AS ENABLED, PRIVILEGED, AND REENTRANT.                      * 08400002
*                                                                     * 08600017
* NOTES:  THIS ROUTINE COMPLETES THE OPEN PROCESSING FOR              * 08800002
*  TELECOMMUNICATION SO THE WHERE-TO-GO TABLE ENTRY WILL BE SET TO 0. * 09000002
*  THE COPIED DCB WILL BE COPIED TO THE USER'S DCB TO REFLECT ALL     * 09050002
*  CHANGES MADE BY THE BTAM EXECUTORS.                                * 09100002
*                                                                     * 09103000
* CHANGE ACTIVITY AS FOLLOWS:                                         * 09106000
*            APARS                           PTMS                     * 09109000
*       YA02171  (10/5/73)               YM4057  (10/3/73) NO CODE    * 09112000
*       ZA00531  (10/18/74)              YM4072  (10/24/73)           * 09115000
*       ZA00541  (11/18/74)              YM4091  (11/5/73)            * 09118000
*       ZA02349  (02/21/75)              YM5661  (12/11/73)           * 09121000
*       ZA03594  (10/03/75)              YM5663  (12/11/73) PROLOG    * 09124000
*       ZA06376  (10/03/75)              YM5668  (12/14/73) IECRES    * 09127000
*       ZA08768  (04/15/76)              YM5674  (1/3/73)             * 09130000
*       ZA11422  (06/24/76)                                           * 09133000
*       ZA11446  (10/05/76)                                           * 09136000
*       ZA14073  (03/22/77)                                           * 09139000
*       ZA17710  (04/28/77)                                           * 09142000
*       ZA33143  (07/23/77)                                           * 09150000
*********************************************************************** 09160002
         EJECT                                                          09160402
IGG0193S CSECT                                                          09162002
         SPACE 5                                                        09164002
RE       EQU   0                       WORK/PARAMREG                    09200017
RF       EQU   1                       WORK/PARAMREG                    09400017
RDCB     EQU   2                       COPIED DCB ADDRESS        Y02947 09600002
ENDADR   EQU   2                       END ADDR FOR FIX LIST     Y02947 09650002
ASCBFLAG EQU   RDCB                                         L5 @ZA02349 09700000
RBASE    EQU   3                       BASE REGISTER                    09800017
RCORE    EQU   4                       IOB ADDRESS                      10000017
PSAREG   EQU   4                       ADDR OF PSA            LD YM7707 10050000
ASCBREG  EQU   4                       ADDR OF ASCB           LD YM7707 10100000
RPAR     EQU   5                       START OF COPIED DCB       Y02947 10200002
*                                      PARAMETER LIST            Y02947 10250002
RWTG     EQU   6                       START OF WTG                     10400017
RPARC    EQU   7                       CURRENT ENTRY IN COPIED   Y02947 10600002
*                                      DCB PARAMETER LIST        Y02947 10650002
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       10800017
RTIOT    EQU   9                       TIOT ADDRESS                     11000017
RUCB     EQU   10                      CURRENT UCB                      11200017
RDEB     EQU   11                      DEB ADDRESS                      11400017
RB       EQU   12                      WORK REG                         11600017
ECBREG   EQU   12                      ADDR OF ECB            LD YM7707 11650000
TCBREG   EQU   13                      TCB ADDRESS            LD YM7707 11700000
RC       EQU   13                      WORK REG                         11800017
RD       EQU   14                      WORK/PARAMREG                    12000017
RJ       EQU   15                      WORK/PARAMREG                    12200017
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 12400017
         USING IHADCB,RDCB                                              12800017
         USING IECTDEB,RDEB                                             13000017
         USING WTG,RWTG                 WHERE-TO-GO TABLE        Y02947 13050002
*                                           ADDRESSABILITY       Y02947 13100002
         EJECT                                                          13200017
         BALR  RBASE,0                                                  13400017
         USING *,RBASE                                                  13600017
         SPACE 4                                                 Y02947 13650002
         B     AROUND                   BRANCH AROUND ID         Y02947 13700002
         DC    CL8'IGG0193S'            OPEN ID                  Y02947 13720000
         DC    CL8'** MVS *'                                            13750000
         DC    CL8'&SYSDATE'         DATE LAST ASSEMBLY        @ZA00541 13752000
         DC    XL3'019825'             CURRENT PTF NUMBER               13752800
PATCH    DC    XL50'00'                 PATCH AREA               Y02947 13756002
         DS    0H                                                       13758000
         SPACE 4                                                 Y02947 13760002
AROUND   L     RDCB,0(RPARC)            COPIED DCB ADDRESS       Y02947 13800002
         L     RDEB,DCBDEBAD            LOAD DEB ADDRESS           000D 14000017
         L     RDEB,28(RDEB)            LOAD DEB START FOR DSECT   000D 14200017
         LA    RB,DEBUCBAD             LOAD UCB ADDRESS          A30780 14230020
         SR    RUCB,RUCB               CLEAR REGISTER            A30780 14260020
         IC    RUCB,DEBNMEXT           LOAD NO EXTENTS(UCB'S)    A30780 14290020
         SLL   RUCB,2                                            A30780 14320020
         AR    RUCB,RB                 ADD UCB SECTION SIZE      A30780 14350020
         SR    RTIOT,RTIOT             CLEAR REGISTER            A30780 14380020
         STCM  RUCB,SEVEN,DCBREAD+DISP1      SAVE ACCESS METHOD  Y02947 14440002
*                                            ADDRESS             Y02947 14490002
         IC    RTIOT,DEBAMLNG          LOAD ACCESS METHOD SIZE   A30780 14500020
         AR    RUCB,RTIOT              ADD TO GET SUB-ID AREA    A30780 14530020
         SR    RTIOT,RTIOT              CLEAR REGISTER             000E 14600017
         L     RCORE,DEBIRBAD-1         GET ADDRESS OF POINTERS    000E 14800017
         TM    DCBERROP,TRMTST          TEST FOR ONLINE-TEST       000D 15000017
         BO    ONLTST1                  IF SO, BRANCH TO SET UP    000E 15200017
         SPACE 1                                                        15210002
*********************************************************************** 15212002
*                                                                     * 15214002
*              2740 CODES                                             * 15216002
*        C-CHECKING                                                   * 15218002
*        D-AUTODIAL                                                   * 15218402
*        A-AUTO ANSWER                                                * 15218802
*        S-STATION CONTROL                                            * 15219202
*        P-AUTO POLL                                                  * 15219602
*        T-TRANSMIT CONTROL                                           * 15219702
*                                                                     * 15219802
*********************************************************************** 15219902
         SPACE 1                                                        15223202
TST2741  CLI   DCBDEVTP,INTR1      2741 ?                   LD @ZA00541 15230000
         BE    INTERUPT                                            000I 15240018
         CLI   DCBDEVTP,INTR2      2741 ?                   LD @ZA00541 15260000
         BNE   GRAPHICS            NO BRANCH                   @ZA33143 15263000
*              FOUR LINES OF CODE DELETED BY OZ33143           @ZA33143 15266000
INTERUPT LA    RB,BREAK41                                          000I 15300018
         BAL   RC,LOADROUT                                         000I 15320018
         BAL   RD,BLDIRB                                           000I 15340018
         SPACE 1                                                 Y02947 15350002
         MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 15352002
         SPACE 1                                                 Y02947 15354002
         ST    RF,8(RCORE)                                         000I 15360018
         SPACE 1                                                 Y02947 15370002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 15372002
         SPACE 2                                                        15380018
GRAPHICS LA    RJ,DEBUCBAD         GET UCB TABLE ADDRESS           000E 15400017
         L     RJ,0(RJ)            GET UCB ADDRESS                 000E 15600017
         TM    19(RJ),X'90'        THIS DEVICE BISYNCH             000E 15800017
         BNO   LOADPCI             IF NOT, LOAD PCI APPEND         000E 16000017
         TM    DCBXCODE,GRAPHMSK   TEST FOR 1130/2250              000E 16200017
         BO    GRAPH1                   IF SO, BRANCH TO SET UP    000E 16400017
         B     LOADPCI                  GO LOAD PCI APPENDAGE      000E 16600017
INITIQE  SRL   RTIOT,1                  REDUCE TO NMBR OF EXTENTS  000E 16800017
         SPACE 1                                                 Y02947 16850002
         MODESET EXTKEY=ZERO            KEY OF ZERO              Y02947 16900002
         SPACE 1                                                 Y02947 16950002
         LA    RB,96(RF)                LOAD ADRS OF IQE POINTER   000D 17000017
         LA    RC,4(RB)                 START IQE'S IN NEXT WORD   000D 17200017
         L     RE,DEBTCBAD-1            LOAD ADDRESS OF TCB             17400018
IQEINIT  ST    RC,0(RB)                 STORE ADDRESS OF NEXT IQE  000D 17600017
         ST    RF,8(RC)                 STORE IRB ADDRESS IN IQE   000D 17800017
         ST    RE,12(RC)                STORE TCB ADDRESS               18000018
         MVI   12(RC),X'00'             ZERO OUT HIGH BYTE        23883 18100018
         LR    RB,RC                    SAVE ADDRESS OF THIS IQE   000D 18200017
         LA    RC,16(RC)                STEP TO NEXT               000D 18400017
         BCT   RTIOT,IQEINIT            DECREMENT AND TEST         000D 18600017
         ST    RTIOT,0(RB)              ZERO LAST POINTER          000D 18800017
         SPACE 1                                                 Y02947 18850002
         MODESET EXTKEY=DATAMGT         DATAMGT KEY              Y02947 18900002
         SPACE 1                                                 Y02947 18950002
         BR    RJ                       BRANCH                     000E 19000017
ONLTST1  IC    RTIOT,DCBDEVTP           LOAD DEVICE TYPE           000D 19200017
         LM    RB,RC,ONLTTMSK           LOAD ONLTST MASK           000D 19400017
         SLDL  RB,0(RTIOT)              SHIFT TO DEVICE BIT        000D 19600017
         LTR   RB,RB                    TEST FOR ONLTST SUPPORT    000D 19800017
         BM    TSTOK                    IF BIT=1, BRANCH           000D 20000017
         NI    DCBERROP,MASKALL-TRMTST  TURN OFF TEST BIT          000D 20200017
         B     TST2741                  GO TEST FOR 2741                20400018
TSTOK    LA    RB,ONLTST                LOAD ADDRESS OF MODULE NAME000D 20600017
         BAL   RC,LOADROUT              LINK TO LOAD ROUTINE       000D 20800017
         BAL   RD,BLDIRB                                                20830018
         SPACE 1                                                 Y02947 20840002
         MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 20850002
         SPACE 1                                                 Y02947 20852002
         ST    RF,0(RCORE)              STORE IRB ADRS IN QUEUE         20860018
         SPACE 1                                                 Y02947 20870002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 20880002
         SPACE 1                                                 Y02947 20882002
         B     TST2741                                                  20890018
         SPACE 2                                                        20920018
BLDIRB   EQU   *                                                        20950018
         IC    RTIOT,DEBNMEXT      LOAD NUMBER OF EXTENTS          000E 21000017
         SLL   RTIOT,2                  MULTIPLY BY EIGHT          000D 21200017
         LA    RTIOT,1(RTIOT)           ADD 1 FOR SIZE OF WORKAREA 000D 21400017
         CIRB  EP=(RE),KEY=SUPR,MODE=SUPR,STAB=(RE),WKAREA=(RTIOT) 000D 21600017
         BAL   RJ,INITIQE          LINK TO IQE INIT                000E 21800017
         BR    RD                                                       22100018
GRAPH1   EQU   *                                               @ZA06376 22150000
         SPACE 1                                               @ZA06376 22200000
         MODESET EXTKEY=ZERO      SET KEY OF ZERO              @ZA06376 22250000
         SPACE 1                                               @ZA06376 22300000
         L     RE,12(RCORE)             GET IRB ROUTINE ADDRESS    000E 22350000
         SPACE 1                                               @ZA06376 22400000
         MODESET  EXTKEY=DATAMGT                               @ZA06376 22450000
         SPACE 1                                               @ZA06376 22500000
         IC    RTIOT,DEBNMEXT      LOAD NUMBER OFEXTENTS           000E 22600017
         SLL   RTIOT,2             MULTIPLY BY EIGHT               000E 22800017
         LA    RTIOT,1(RTIOT)      ADD 1 FOR WKAREA SIZE           000E 23000017
         CIRB  EP=(RE),KEY=SUPR,MODE=SUPR,STAB=(RE),WKAREA=(RTIOT),    X23200017
               SVAREA=YES                                          000E 23400017
         BAL   RJ,INITIQE          LINK TO INITIALIZE IQE          000E 23600017
         SPACE 1                                                 Y02947 23650002
         MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 23700002
         SPACE 1                                                 Y02947 23750002
         ST    RF,4(RCORE)         STORE IRB ADDRESS               000E 23800017
         SPACE 1                                                 Y02947 23850002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 23900002
         SPACE 1                                                 Y02947 23950002
LOADPCI  TM    DCBBFTEK,DYNBUF          TEST FOR DYNAMIC BUFFERING 000E 24000017
         BNO   TESTBPM                 NO, DON'T LOAD PCI APP    YM4072 24050002
*             4 LINES DELETED BY THE FOLLOWING PTM               YM4072 24100002
LOADPCI2 EQU   *                                                        24300002
         LA    RB,PCIAPP                LOAD ADDRESS OF IDTTRL ENTRY.   24400017
         BAL   RC,LOADROUT              BRANCH TO LOAD PCI APPENDAGE.   24600017
         ST    RE,DEBPCIA               STORE ADDRESS IN APPENDAGE      24800017
*                                  TABLE.                               25000017
*        B     LOADBPMR             DELETED BY FOLLOWING APAR   YA02171 25200002
TESTBPM  CLI   DEBAMLNG,X'00'           TEST FOR AN ACCESS METHOD       25400017
*    SECTION.  IF NOT, DO NOT LOAD BUFFER ROUTINE.                      25600017
         BZ    LOADCEAP                                                 25800017
LOADBPMR LA    RB,BPMR                  POINT TO IDTTRL TABLE AND       26000017
         BAL   RC,LOADROUT         BRANCH TO LOAD BUFFER POOL           26200017
*                                  MANAGEMENT ROUTINE.                  26400017
         L     RTIOT,DCBREAD           LOAD ACCESS METHOD ADRS   A30780 26600020
         EJECT                                                          26800017
         ST    RE,0(RTIOT)              STORE ADDRESS OF BUFFER POOL    27000017
*    MANAGEMENT ROUTINE IN FIRST WORD OF ACCESS METHOD SECTION OF DEB.  27200017
LOADCEAP EQU   *                                                        27400017
         LA    RB,CHENDAPP             ID AND TTRL FLD NEEDED FOR LOAD  27600017
         BAL   RC,LOADROUT                                              27800017
         ST    RE,DEBCEA                STORE ADDRESS OF CHANNEL END -  28000017
         ST    RE,DEBXCEA          ABNORMAL END APPENDAGE IN APPENDAGE  28200017
*                                  TABLE.                               28400017
         CLI   DCBDEVTP,DEVWTTA         IS THE WORLD TRADE TELETYPE000G 28600017
         BNE   OTHERDEV                 BRANCH IF NOT              000G 28800017
         LA    RB,CEAPPWT               LOAD ADDRESS OF IDTTRL ENTRY00G 29000017
         BAL   RC,LOADROUT              BRANCH TO LOAD CEAPP FOR WTTA.G 29200017
*                                                                       29250003
*        THE PCI APPENDAGE (IGG019MC) AND THE CHANNEL END               29300003
*        APPENDAGE (IGG019MB) ADDRESSES MUST BE MOVED INTO              29350003
*        THE 3RD AND 4TH WORDS IF IGG019PD. OFFSET X'0C'                29400003
*        AND X'10' RESPECTIVELY.                                        29450003
*                                                                       29460003
         USING FORCORE,RJ    WORKAREA ADDRESSABILITY           @ZA03594 29465000
         L     RJ,DISP4(RWTGC)         WORK AREA ADDRESS       @ZA03594 29470000
         SPACE 1                                               @ZA03594 29475000
         MODESET EXTKEY=ZERO          SET SUPERVISOR KEY       @ZA14073 29480000
         SPACE 1                                               @ZA03594 29485000
         DROP  RJ                    DROP WORK AREA ADDRESS    @ZA03594 29490000
         MVC   TWELVE(EIGHT,RB),DEBPCIA  MOVE PCI AND CE    LD @ZA00531 29500003
*                                  APP. ADDRESSES INTO WTTA LD @ZA00531 29510003
*                                  CE APPENDAGE.            LD @ZA00531 29550003
         SPACE 1                                                        29600000
         MODESET  EXTKEY=DATAMGT   BACK TO DATA MGT KEY        @ZA11422 30000000
         SPACE 1                                                        30050000
         ST    RE,DEBPCIA               STORE CEAPP ADDR IN APP. TABLEG 30100000
         MVC   DEBCEA(8),DEBPCIA       CH END AND ABN END ADDR          30150000
OTHERDEV EQU   *                                                   000G 30600017
         LA    RB,SIOAP                LOAD START I/O APPENDAGE         30640002
         BAL   RC,LOADROUT                                              30680002
         ST    RE,DEBSIOA              PUT ADDRESS IN DEB               30720002
         OI    DEBSIOA,PGFXBIT     FLAG PAGE FIX APP IN SIO       3876  30770002
         LA    RB,READWR               ID AND TTRL FLD NEEDED FOR LOAD  30800017
         BAL   RC,LOADROUT             RETURN LINKAGE ESTABLISHED       31000017
*        PROTECT DCBOFLGS FIELD FOR STORE OF READ/WRITE ADDRESS         31200017
*     WHICH DESTROYES HIGH ORDER BYTE-DCBOFLGS.                         31400017
         STCM  RE,SEVEN,DCBREAD+DISP1      ADDRESS OF READ/WRITE Y02947 31800002
*                                          MODULE                Y02947 31850002
         SPACE 2                                                   000M 32040019
         USING FORCORE,RD               WORKAREA ADDRESSABILITY  Y02947 32080002
         L     RD,4(RWTGC)              ADDRESSABILITY FOR WORK ARE000M 32120019
         SPACE 1                                                   000M 32160019
         LR    RCORE,0                 RCORE USED FOR LOCATION OF VD    32200017
         AH    RCORE,VDOFFSET          LOCATE VECTOR DIRECTORY          32400017
         SR    RTIOT,RTIOT             REG USED FOR DEVICE CODE         32600017
         IC    RTIOT,DISP0(RD)  GET DEVICE CODE STORED           Y02947 32800002
*                                         BY MODULE IGG0194N       000M 33000002
         STC   RTIOT,DCBDEVTP          STORE IN DCB                     33400017
         SR    RC,RC         USE LINKREG AS TEMP. COUNT                 33600017
*                                 USED AS A DEVICE COUNT.               33800017
         SPACE 1                                                 Y02947 33850002
RWVDLP   MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 33900002
         SPACE 1                                                 Y02947 33950002
         NC    0(4,RCORE),0(RCORE)     TEST FOR ZERO FIELD              34000002
         BNZ   VD1                     BRANCH IF NOT ZERO FIELD    000A 34200017
         MVI   3(RCORE),X'FF'          MAKE FIELD NON ZERO       A28605 34300019
RWVD1    EQU   *                                                 Y02947 34310002
         SPACE 1                                                 Y02947 34350002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 34400002
         SPACE 1                                                 Y02947 34450002
         LA    RB,WORKTTRL(RD)          RETREIVE I/O MODULE      Y02947 34800002
*                                       ID. (IT WAS PLACED IN    Y02947 34850002
*                                       THE WORKAREA BY OPEN     Y02947 34900002
*                                       LOAD 2 (IGG0194N))       Y02947 34950002
         STC   RC,DCBDEVTP   STORE DEVICE COUNT                         35200017
         BAL   RC,LOADROUT                                              35400017
         DROP  RD                                                  000M 35500019
         SPACE 1                                                 Y02947 35550002
NEXTSP10 MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 35560002
         SPACE 1                                                 Y02947 35570002
         ST    0,0(RCORE)              STORE VECTOR LIST ADDRESS        35600002
         STC   RTIOT,0(RCORE)          STORE DEVICE CD IN HIGH ORDER    35800017
         SPACE 1                                                 Y02947 35850002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 35900002
         SPACE 2                                                        35908000
ENDLOD4  XC    0(2,RWTGC),0(RWTGC)      CLEAR ID TO INDICATE            35916000
*                                       COMPLETION                      35924000
         SPACE 2                                                 Y02947 35932000
*********************************************************************** 35940000
*        SYSEVENT REQSWAP AND SYSEVENT DONTSWAP, AND THEIR     @ZA17710 35948000
*        RELATED SETLOCK OBTAIN/RELEASE AND REQUIRED GETMAIN/  @ZA17710 35956000
*        FREEMAINS, HAVE BEEN REMOVED AND REPLACED BY SYSEVENT @ZA17710 35964000
*        TRANSWAP MACRO.  TRANSWAP WILL BE ISSUED FOR EACH     @ZA17710 35972000
*        BTAM DCB IF RUNNING V=V.  IF THERE IS NO PREVIOUS     @ZA17710 35980000
*        OUTSTANDING TRANSWAP AGAINST THE ADDRESS SPACE, THE   @ZA17710 35988000
*        ADDRESS SPACE WIL BE SWAPPED OUT AND THEN BACK INTO   @ZA17710 35996000
*        THE PREFERRED AREA OF STORAGE, AND THE ADDRESS SPACE  @ZA17710 36004000
*        WILL BE MADE NON-SWAPPABLE.  ISSUING THE TRANSWAP     @ZA17710 36012000
*        MACRO ELIMINATES THE NECESSITY OF MANIPULATING THE    @ZA17710 36020000
*        ASCBNSWP FLAG AS PREVIOUSLY DONE.                     @ZA17710 36028000
*********************************************************************** 36036000
         SPACE 2                                                        36044000
         SR    PSAREG,PSAREG       CLEAR REG                  LD YM7707 36052000
         USING PSA,PSAREG          PSA ADDRESSABILITY         LD YM7707 36060000
         L     TCBREG,PSATOLD      TCB ADDRESS                LD YM7707 36068000
**************** ONE LINE OF CODE REMOVED BY APAR OZ17710      @ZA17710 36076000
         DROP  PSAREG                                         LD YM7707 36084000
         USING TCB,TCBREG      TCB ADDRESSABILITY              @ZA11446 36092000
         TM    TCBFLGS6,TCBRV  VIRTURE = REAL JOB?             @ZA11446 36100000
         BO    REALIOB    YES, DONT ISSUE TRANSWAP MACRO       @ZA17710 36108000
         DROP  TCBREG                                          @ZA11446 36116000
         SPACE 1                                                        36124000
*********************************************************************** 36132000
*      FIFTY LINES OF CODE HAVE BEEN DELETED AND FIFTEEN       @ZA17710 36140000
*      LINES HAVE BEEN ADDED BY APAR OZ17710, IN ORDER TO      @ZA17710 36148000
*      SUPPORT THE TRANSWAP MACRO.                             @ZA17710 36156000
*********************************************************************** 36164000
         SPACE 1                                               @ZA17710 36172000
TRANSWAP EQU   *                                               @ZA17710 36180000
         USING FORCORE,RJ          WORKAREA ADDRESSABILITY     @ZA17710 36188000
         L     RJ,DISP4(RWTGC)     WORK AREA ADDRESS           @ZA17710 36196000
         XC    DXECB(4),DXECB      CLEAR ECB                   @ZA17710 36204000
         LA    RF,DXECB            GET ADDR ECB FOR TRANSWAP   @ZA17710 36212000
         SPACE 1                                                        36220000
         SYSEVENT TRANSWAP         ISSUE TRANSWAP              @ZA17710 36228000
         SPACE 1                                                        36236000
         N     RF,ZEROFF           MAKE SURE ONLY RC IN REG 1  @ZA17710 36244000
         LTR   RF,RF               IS RETURN CODE ZERO?        @ZA17710 36252000
         BNZ   REALIOB             RC IS NOT ZERO, TRANSWAP    @ZA17710 36260000
*                               WAS SUCCESSFUL, DONT WAIT      @ZA17710 36268000
         L      RJ,DISP4(RWTGC)       WORK AREA ADDRESS        @ZA17710 36276000
         LA    RF,DXECB            GET ADDR ECB FOR WAIT       @ZA17710 36284000
         SPACE 1                                                        36292000
         WAIT  ECB=(1)             WAIT FOR ECB TO BE POSTED   @ZA17710 36300000
         SPACE 1                                                        36308000
         L     RJ,DISP4(RWTGC)       WORK AREA ADDRESS         @ZA17710 36316000
         CLC   DXECB,ECBPOST       WAS ECB POSTED BY TRANSWAP  @ZA17710 36324000
         BE    TRANSWAP         NO, RETRY..OTHERWISE CONTINUE  @ZA17710 36332000
         DROP  RJ                                              @ZA17710 36340000
****************************END OF TRANSWAP CODE************** @ZA17710 36400000
         SPACE 2                                                 YM5674 36673502
REALIOB  L     RDCB,DISP0(RPARC)      GET COPY DCB ADDRESS     @ZA11446 36675500
         L     RCORE,4(RWTGC)           ADDR OF OPEN WORK AREA   Y02947 36684102
         SPACE 2                                                 Y02947 36689402
*    UPDATE THE USER'S DCB TO REFLECT ALL CHANGES MADE BY BTAM        * 36694702
*    OPEN EXECUTORS ON THE COPIED DCB.                                * 36700002
         L     RJ,WTGPREFX                                       Y02947 37060002
         STM   RE,RD,IECREGSV-IECPREFX(RJ)  SAVE REGS            Y02947 37070002
         IECRES INIT,DCBCOPY=FRWKAR                              Y02947 37100002
         LR    RJ,RWTG                  REG SAVEAREA ADDR        YM5668 37110002
         LM    RE,RD,IECREGSV-IECPREFX(RJ)  RESTORE REGS         Y02947 37150002
         SPACE 2                                                 Y02947 37150402
         USING FORCORE,RJ               WORKAREA ADDRESSABILITY  Y02947 37152002
         L     RJ,DISP4(RWTGC)          WORKAREA ADDRESS         Y02947 37162002
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG REGISTER. 37200017
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT PARAMETER     37400017
*                                  LIST REGISTER TO NEXT ENTRY.         37600017
         CLC   0(2,RWTGC),AMIDCNST      IF THE NEXT WTG ENTRY CALLS FOR 37800017
         BCR   8,RBASE                                                  38000017
         CLC   0(2,RWTGC),OPIDCNST      IF NOT, TEST FOR END OF TABLE.  38200017
         BNE   RELOOP              NOT END OF TABLE, RETURN TO CHECK    38400017
*                                  NEXT ENTRY.                          38600017
         LR    RPARC,RPAR               REINITIALIZE CURRENT WTG REG    38800017
         LA    RWTGC,WAOFF(0,RWTG) AND CURRENT PARAMETER LIST REG.      39000017
ZCHECK   CLI   0(RWTGC),X'00'                                           39200017
         BNE   XCTLRTNE            IF NOT ZERO, GO TO TRANSFER CONTROL. 39400017
         LA    RWTGC,WGOFF(0,RWTGC) IF ZERO, GET NEXT ENTRY AND RETURN  39600017
         LA    RPARC,PLOFF(0,RPARC) TO ZCHECK.                          39800017
         B     ZCHECK                                                   40000017
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 40200017
XCTLRTNE EQU   *                                                        40400017
         LA    RJ,DXCCW12           POINT TO DOUBLE WORD LIST.   Y02947 40600002
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID TO NAME FIELD.          40800017
         MVC   14(3,RWTG),2(RWTGC)      MOVE TTR TO WTG TABLE.          41000017
         DROP  RJ                 DROP WORKAREA ADDRESS          Y02947 41050002
         L     RC,SIXT            CVT ADDRESS                    Y02947 41100002
         USING CVT,RC             CVT ADDRESSABILITY             Y02947 41150002
         L     RC,CVTSVDCB        SYS1.SVCLIB DCB                Y02947 41160002
         DROP  RC                 DROP CVT ADDRESS               Y02947 41170002
         XCTL  DE=(RWTG),SF=(E,(15)),DCB=(RC)                    Y02947 41200002
         EJECT                                                          41400017
LOADROUT EQU   *                                                 Y02947 41600002
         MVC   6(2,RWTG),0(RB)         MOVE ID OF LAST 2 BYTES OF NAME  41800017
         MVC   14(3,RWTG),2(RB)        MOVE TTR FROM TABLE              42000017
LOAD     LR    RE,RWTG                  POINT TO PARAMETER LIST.        45200017
         USING CVT,RF                   CVT ADDRESSABILITY       Y02947 45250002
         L     RF,SIXT                  CVT ADDRESS              Y02947 45300002
         L     RF,CVTSVDCB              SYS1.SVCLIB DCB          Y02947 45350002
         DROP  RF                       DROP CVT ADDRESS         Y02947 45400002
         CLC   DISP6(LEN2,RWTG),READWR  READ/WRITE ROUTINE       YM4057 45410002
         BE    LOADMA                   YES, LOAD FROM SVCLIB    YM4057 45420002
         CLC   DISP6(LEN2,RWTG),CHENDAPP CE/ABE APPENDAGE        YM4057 45430002
         BE    LOADMB                   YES, LOAD FROM SVCLIB    YM4057 45440002
         CLC   DISP6(LEN2,RWTG),PCIAPP  PCI APPENDAGE?           Y02947 45450002
         BE    LOADMC                   YES, LOAD FROM SVCLIB    YM4057 45500002
         CLC   DISP6(LEN2,RWTG),CEAPPWT WTTA CE APPENDAGE        YM4057 45510002
         BE    LOADPD                   YES, LOAD FROM SVCLIB    YM4057 45520002
         CLC   DISP6(LEN2,RWTG),ONLTST  ON LINE TEST CONTROL MOD YM4091 45530002
         BE    LOADMR                   YES, LOAD FROM SVCLIB    YM4091 45540002
         CLC   DISP6(LEN2,RWTG),BPMR    BUFFER MANAGEMENT MOD    YM5661 45542002
         BE    LOADMS                   YES, LOAD FROM SVCLIB    YM5661 45544002
         SPACE 1                                                 Y02947 45550002
         LOAD  DE=(0),DCB=(1)                                           46200017
*                                                                       46400017
MOVEID   EQU   *                                                 Y02947 46450002
         MVC   0(2,RUCB),0(RB)         MOVE ID TO DEB                   46600017
         LA    RUCB,2(0,RUCB)           UPDATE POINTER TO SUBROUTINE    46800017
*                                  ID SECTION IN DEB.                   47000017
         IC    RD,DEBNMSUB              GET NMBR ROUTINES LOADED   000E 47200017
         LA    RD,1(RD)                 ADD ONE                    000E 47400017
         STC   RD,DEBNMSUB              STORE COUNT IN DEB         000E 47600017
PAGEFIXR EQU   *                   AOS PAGE FIX FOR APPENDS       3876  47650002
         LR    RB,RE               TEMP SAVE EP ADDRESS           3876  47700002
         SLL   RF,3                CONVERT DOUBLEWORDS TO BYTES   3876  47750002
         LA    RF,PAGESIZE(RF,RB)  BUMP BY PAGE SIZE              3876  47760002
         N     RE,PAGEBDRY         PUT ON PAGE BOUNDRY            3876  47770002
         SLR   RF,RE               REMOVE EXTRA BYTES             3876  47780002
         SRL   RF,PAGESHFT         GET NUMBER OF PAGES            3876  47790002
         SLL   RF,24               POSITION FOR OR INTO ADDRESS   3876  47792002
         LR    RE,RB               RESTORE ADDRESS                3876  47794002
         OR    RE,RF               PUT PAGE FIX COUNT IN          3876  47796002
         BR    RC                       RETURN.                         47800017
LOADMA   LOAD  EPLOC=IGG019MA,DCB=(1)                            YM4057 47810002
         B     MOVEID                   MOVE IN THE ID           YM4057 47820002
         SPACE 1                                                 YM4057 47830002
LOADMB   LOAD  EPLOC=IGG019MB,DCB=(1)                            YM4057 47840002
         B     MOVEID                   MOVE IN THE ID           YM4057 47842002
         SPACE 1                                                 YM4057 47844002
LOADMC   LOAD  EPLOC=IGG019MC,DCB=(1)                            YM4057 47850002
         B     MOVEID                   MOVE IN THE ID           Y02947 47900002
         SPACE 1                                                 YM4057 47950002
LOADPD   LOAD  EPLOC=IGG019PD,DCB=(1)                            YM4057 48000002
         B     MOVEID                   MOVE IN THE ID           YM4057 48050002
         SPACE 1                                                 YM4091 48060002
LOADMR   LOAD  EPLOC=IGG019MR,DCB=(1)   LOAD IGG019MR            YM4091 48070002
         B     MOVEID                   MOVE IN THE ID           YM4091 48080002
         SPACE 1                                                 YM5661 48082002
LOADMS   LOAD  EPLOC=IGG019MS,DCB=(1)   LOAD IGG019MS            YM5661 48090002
         B     MOVEID                   MOVE IN THE ID           YM5661 48092002
         SPACE 1                                                 YM4057 48100002
VD1      CLC   DCBDEVTP(1),0(RCORE)  TEST FOR EQUAL DEVICE CODE: DCBDV  49200017
         BE    RWVD1         VS. VECTOR DIREC. DEVICE TYPE.             49400017
*                                  DEVICE CODE AND VECTOR DIRECTORY TBL 49600017
         SPACE 1                                                 Y02947 49650002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 49700002
         SPACE 1                                                 Y02947 49750002
         CLI   0(RCORE),X'FF'          TEST END OF TABLE           000A 49800017
         BE    VDOVFLER                                            000A 50000017
         LA    RCORE,4(0,RCORE)        BUMP TO GET NEXT VD FIELD        50200017
         AH    RC,ONE        BUMP DEVICE COUNT                          50400017
*                                 VECTOR LIST FIELD NOT ZERO OR EQUAL   50600017
*                                 TO DEVICE CODE TO LOAD PROGRAM.       50800017
         B     RWVDLP                                                   51000017
VDOVFLER L     1,ERR6                  VECTOR DIRECTOR OVERFLOW    000A 51200017
         ABEND (1)                                                 000A 51400017
         CNOP  0,4                                                      51600017
         EJECT                                                          51800017
ONLTTMSK DS    0F                                                  000D 52000017
       DC    BL.51'111111111111111111111111111000000011111111111111111' 52200019
*      1050        *****                                           000J 52400018
*      2740             ******************                         000J 52600018
*      1060                               **                       000J 52800018
*      1030                                 **                     000J 53000018
*      83B3                                   **                   000J 53200018
*      115A                                     **                 000J 53400018
*      TWX                                        ***              000J 53600018
*      2260/2848                                     *             000J 53800018
*      S360/1130/2780/2020                            ********     000J 54000018
*      2741                                                   **   000J 54200018
*      2740/2760                                                ** 000J 54400018
*      1050X                                                      **    54460019
*      2740X                                                        **  54520019
         DS    0F                                                       54600017
ZEROFF   DC    X'000000FF'                                    LD YM7707 54610000
XFF      EQU   X'FF'                                          LD YM7707 54620000
PAGEBDRY DC    X'00FFF800'         AOS2 PAGE BOUNDRY MASK       AS23648 54650002
PAGESHFT EQU   11                  AOS2 PAGE SHIFT COUNT        AS23648 54700002
PAGESIZE EQU   2047                AOS2 PAGE SIZE - 1           AS23648 54750002
ERR6     DC    X'80097000'                                         000A 54800017
TRMTST   EQU   X'10'                    TERMINAL TEST BIT IN ERROP      55400017
         SPACE                                                          55600017
WAOFF    EQU   32                       OFFSET OF FIRST WTG ENTRY FROM  55800017
*                                  START OF WTG.                        56000017
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES.          56200017
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES.          56400017
OPIDCNST DC    C'0S'                    ID OF LAST OPEN LOAD.           56600017
AMIDCNST DC    C'3S'                    ID OF THIS MODULE.         000D 56800017
WORKTTRL EQU   2                                                 Y02947 57000002
DYNBUF   EQU   X'08'                    CODE FOR BFTEK=D IN THE DCB,    57200017
DEVWTTA  EQU   X'2A'                    WTTA OFFSET                000G 57400017
ONE      DC    H'01'                                                    57600017
VDOFFSET DC    H'12'                                                    57800017
GRAPHMSK EQU   X'40'                                               000E 60000017
MASKALL  EQU   X'FF'                    ALL ONES                   000D 60200017
XFE      EQU   X'FE'                                           @ZA08768 60230000
INTR1    EQU   X'2B'                                                    60260018
INTR2    EQU   X'2C'                                                    60320018
INTR3    EQU   X'16'                                        LD @ZA00541 60370003
INTR4    EQU   X'10'                                        LD @ZA00541 60420003
PGFXBIT  EQU   X'C0'                                                    62420002
DISP0    EQU   0                  ZERO DISPLACEMENT              Y02947 62430002
DISP1    EQU   1                  VALUE OF ONE                   Y02947 62470002
DISP4    EQU   4                  DISPLACEMENT OF 4              Y02947 62472002
DISP6    EQU   6                  DISPLACEMENT OF 6              Y02947 62480002
DISP28   EQU   28                 DISPLACEMENT OF 28             Y02947 62482402
LEN2     EQU   2                  LENGTH OF 2                    Y02947 62490002
SIXT     EQU   16                 OFFSET TO CVT                  Y02947 62500002
FOUR     EQU   4                                              LD YM7707 62510000
SEVEN    EQU   7                  MASK FOR STCM INSTRUCTION      Y02947 62520002
*                                 (3 BYTES)                      Y02947 62570002
EIGHT    EQU   8                   DISPLACEMENT OF 8        LD @ZA00531 62580003
TWELVE   EQU   12                  DISPLACEMENT OF 12       LD @ZA00531 62620003
TWENTY   EQU   20                                              @ZA11446 62670000
         SPACE 2                                                        63200017
IGG019MA DC    C'IGG019MA'              READ/WRITE MODULE        YM4057 63360002
IGG019MB DC    C'IGG019MB'              CE/ABE APPENDAGE         YM4057 63370002
IGG019MC DC    C'IGG019MC'              PCI MOD NAME             Y02947 63400002
IGG019PD DC    C'IGG019PD'              WTTA CE APPENDAGE        YM4057 63450002
IGG019MR DC    C'IGG019MR'              ON LINE TEST MODULE      YM4091 63500002
IGG019MS DC    C'IGG019MS'              BUFFER MANAGEMENT MODULE YM5661 63550002
PCIAPP   DC    C'MC'                   PCI APPENDAGE                    66600017
         DC    XL4'0'                  TTRL FIELD                       66800017
ONLTST   DC    C'MR'                    ON-LINE TEST CONTROL MOD   000D 67000017
         DC    XL4'0'                        TTRL FIELD            000D 67200017
BPMR     DC    C'MS'                   BUFFER POOL MANAGEMENT ROUTINE   67400017
         DC    XL4'0'                  TTRL FIELD                       67600017
CHENDAPP DC    C'MB'                   CHANNEL END/ABNORMAL END         67800017
*                                 APPENDAGE                             68000017
         DC    XL4'0'                  TTRL FIELD                       68200017
CEAPPWT  DC    C'PD'                    CHANNEL END/ABNORMAL END   000G 68400017
*                                  APPENDAGE FOR WTTA.             000G 68600017
         DC    XL4'0'                   TTRL FIELD                 000G 68800017
READWR   DC    C'MA'                   READ/WRITE ROUTINE               69000017
         DC    XL4'0'                  TTRL FIELD                       69200017
BREAK41  DC    C'PK',XL4'0'            2741 BREAK MODULE                75200019
SIOAP    DC    C'LP',XL4'0'            SIO APPENDAGE                    78200002
SUBPOOL  DC    X'FA000000'             SUBPOOL 250             @ZA11446 78250000
ECBPOST  DC    X'40000004'    POST CODE FOR ECB FROM TRANSWAP  @ZA17710 78300000
         EJECT                                                   Y02947 78400002
         IHAASCB                                                        78450000
         EJECT                                                          78500000
         DCBD  DSORG=BX,DEVD=BS                                    000E 83000017
         EJECT                                                          83050000
        IECTDEBX                                                        83400017
         EJECT                                                     000M 83420000
         IHAPSA                                                  Y02947 83430002
         EJECT                                                     000M 83440000
         IECDSECS MAIN,WTG,PREFX,CVT,EXPAND=YES                  Y20947 83510002
         EJECT                                                          83560000
         IKJTCB DSECT=YES                                               83570000
         END                                                            83600017
./  ADD  SSI=72640772,NAME=IGG0194N
 TITLE 'IGG0194N  BTAM LINE GROUP OPEN EXECUTOR - LOAD 2'               00200017
*********************************************************************** 00400002
*                                                                     * 00410002
* MODULE NAME: IGG0194N  (OS/VS)                                      * 00420002
*                                                                     * 00430002
* DESCRIPTIVE NAME: BTAM LINE GROUP OPEN EXECUTOR - LOAD 2            * 00440002
*                                                                     * 00442002
* COPYRIGHT: NONE                                                     * 00444002
*                                                                     * 00450002
* STATUS: RELEASE 2                                                   * 00700002
*                                                                     * 01000017
* FUNCTION/OPERATION: THIS LOAD ANALYZES DEVICE TYPE INFORMATION      * 01200002
*   PROVIDED IN THE UNIT CONTROL BLOCK TO DETERMINE WHAT TYPE OF      * 01400002
*   TERMINAL DEVICES ARE ATTACHED TO THE GROUP OF LINES THAT MAKE UP  * 01600002
*   THIS LINE GROUP AND ALSO BUILDS A BUFFER POOL IF SO INDICATED     * 01800002
*   BY THE DCB FIELDS.                                                * 01850002
*                                                                     * 02000017
* ENTRY POINT: ENTRY WILL BE TO THE FIRST BYTE OF THE MODULE BY AN    * 02200002
*  'XCTL' TO IGG0194N THE SECOND BTAM LOAD. CONTROL WILL BE TRANSFERED* 02400017
*   FROM LOAD 1. IT MAY ALSO BE RE-ENTERED FROM THE RELOOP PORTION OF * 02600017
*   THIS ROUTINE IF IT DETERMINES THAT THERE IS ANOTHER DATA CONTROL  * 02800017
*   BLOCK TO BE OPENED.                                               * 03000017
*                                                                     * 03200017
* INPUT:  THE REGISTERS 5, 6, 7, AND 8 ARE THE INPUT, AS FOLLOWS,     * 03400002
*   5- THE ADDRESS OF THE FIRST ENTRY IN THE COPIED DCB PARAMETER LIST* 03600002
*   6- THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE,         * 03800002
*   7- THE ADDRESS OF THE CURRENT ENTRY IN THE COPIED DCB PARAMETER   * 04000002
*      LIST.                                                          * 04050002
*   8- THE ADDRESS OF THE CURRENT EXECUTOR'S ENTRY IN THE WHERE-TO-GO * 04200017
*      TABLE.                                                         * 04400017
*                                                                     * 04450002
* OUTPUT:  THE REGISTERS 7 AND 8 WILL BE POSITIONED AT THE NEXT       * 04600002
*   ENTRIES IN THE COPIED DCB PARAMETER LIST AND THE WHERE-TO TABLE.  * 04800002
*   IF NECESSARY, A BUFFER POOL WILL HAVE BEEN CONSTRUCTED IN THE     * 04850002
*   USER KEY IN SUBPOOL 250.                                          * 04900002
*   SOME OF THE DCB FIELDS WILL HAVE BEEN INITIALIZED.                * 05000002
*   THIS EXECUTOR'S ENTRY (OR ENTRIES) IN THE WHERE - TO -            * 05200002
*   GO TABLE WILL HAVE BEEN UPDATED TO IDENTIFY LOAD 3 (IGG0193Q).    * 05400002
*                                                                     * 05450002
* EXTERNAL ROUTINES:  NONE                                            * 05600002
*                                                                     * 05800017
* EXITS-NORMAL:  THIS ROUTINE EXITS VIA AN XCTL TO THE MODULE         * 06000002
*   IDENTIFIED BY THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE,   * 06200017
*   NAMELY IGG0193Q (BTAM OPEN EXECUTOR - LOAD 3).                    * 06400017
*                                                                     * 06600017
*     -ERRORS-  THIS ROUTINE EXITS VIA ABEND FOR THE FOLLOWING        * 06800017
*   ERROR CONDITIONS-                                                 * 07000017
*   ABEND CODE ERROR CONDITION                                        * 07050002
*   00096000    THERE WAS NO BUFFER POOL OR NO BUFFERING              * 07100002
*               TECHNIQUE DEFINED FOR THIS LINE GROUP.                * 07150002
*   00099000    DYNAMIC BUFFERING SPECIFIED FOR A V=V APPLICATION     * 07160002
*                                                                     * 07200017
* TABLES/WORK AREAS: THE WHERE-TO-GO TABLE CONTAINS THE ID AND TTR    * 07400002
*       OF THE OPEN EXECUTOR LOAD 3. THE DCB PARAMETER LIST CONTAINS  * 07600002
*       THE ADDRESS OF EACH DCB SPECIFIED IN THE OPEN MACRO. THE      * 07800002
*       COMMUNICATION VECTOR TABLE IS A RESIDENT VECTOR LIST USED     * 08000017
*       TO LOCATE THE TIOT,WHICH IS NEEDED IN DEB CONSTRUCTION.       * 08200017
*                                                                     * 08400017
*                                                                     * 08450002
* ATTRIBUTES: THIS ROUTINE IS EXECUTED IN THE DATA MANAGEMENT KEY OF  * 08600002
*       5 AS ENABLED, PRIVILEGED, AND REENTRANT.                      * 08850002
*                                                                     * 09000017
* NOTES: FOR SECURITY AND INTEGRITY PURPOSES, OPEN PROCESSING WILL    * 09200002
*  BE ONLY ON THE COPIED DCB AND COPIED DCB PARAMETER LIST. BTAM      * 09210002
*  OPEN LOADS MUST KEEP THE USER DCB AND COPIED DCB SYNCHRONIZED.     * 09220002
*  THIS MODULE (IF NEED BE) WILL CONSTRUCT A BUFFER POOL IN THE       * 09230002
*  KEY OF THE USER IN SUBPOOL 250. THE ID OF THE NECESSARY I/O        * 09240002
*  MODULE WILL BE STORED IN THE WORKAREA FOR LOAD 4 OF OPEN. UPON     * 09242002
*  COMPLETION OF THIS MODULE, CONTROL IS PASSED TO THE THIRD          * 09244002
*  OPEN MODULE THROUGH THE WHERE-TO-GO TABLE ENTRY.                   * 09246002
*                                                                     * 10200017
* CHANGE ACTIVITY AS FOLLOWS:                                         * 10250002
*            APARS                           PTMS                     * 10300002
*       YA03255  (2/1/74)                YM4085  (10/29/73)           * 10350000
*       ZA03550  (03/18/75)              YM5663  (12/11/73) PROLOG    * 10352000
*       AZ10016  (03/30/76)                                           * 10354000
*       AZ26035  (09/16/77)                                           * 10360000
*********************************************************************** 10400002
         EJECT                                                          10600017
IGG0194N CSECT                                                          10650002
         SPACE 5                                                        10700002
RE       EQU   0                       WORK/PARAMREG                    10800017
RF       EQU   1                       WORK/PARAMREG                    11000017
RW1      EQU   2                        WORK REGISTER 1                 11200017
RW2      EQU   3                        WORK REGISTER 2                 11400017
WAREG    EQU   RW2                      ADDR OF OPEN WORK AREA   Y02947 11450002
RB       EQU   4                        WORK REGISTER 3                 11600017
RPAR     EQU   5                        ADDRESS OF COPIED DCB    Y02947 11800002
*                                       PARAMETER LIST           Y02947 11850002
RWTG     EQU   6                        ADDRESS OF WTG TABLE            12000017
RPARC    EQU   7                       ADDRESS OF CURRENT COPIED Y02947 12200002
*                                       DCB ENTRY                Y02947 12210002
RWTGC    EQU   8                        ADDRESS OF CURRENT WTG ENTRY    12400017
RTIOT    EQU   9                        ADDRESS OF TASK I/O TABLE       12600017
RDCB     EQU   10                       ADDRESS OF COPIED DCB    Y02947 12800002
RDEB     EQU   11                       ADDRESS OF DEB                  13000017
RBASE    EQU   12                       BASE REGISTER                   13200017
RC       EQU   13                      WORK REG                         13400017
RUCB     EQU   14                       NO. OF UCB'S/ADDRESS OF UCB     13600017
RJ       EQU   15                      WORK/PARAMREG                    13800017
RW3      EQU   RB                                                       14000017
         BALR  RBASE,0                  SET UP BASE REGISTER            14200017
         USING *,RBASE                                                  14400017
         USING IHADCB,RDCB                                              14600017
         USING IECTDEB,RDEB                                             14800017
         SPACE 4                                                        15000017
         B     AROUND                   BRANCH AROUND ID         Y02947 15050002
         DC    C'IGG0194N'              OPEN ID                  Y02947 15100002
         DC    C'UZ14509'                                      @ZA14509 15110000
         DS    0F                                                Y02947 15120002
PATCH    DC    XL50'00'                 PATCH AREA               Y02947 15130002
         SPACE 4                                                 Y02947 15150002
AROUND   L     RDCB,0(RPARC)            LOAD COPY DCB ADDRESS    Y02947 15200002
         L     RDEB,DCBDEBAD            LOAD DEB ADDRESS           000D 15400017
         L     RDEB,28(RDEB)            LOAD DEB START FOR DSECT   000D 15600017
         L     RUCB,DEBUCBAD           GET UCB ADDRESS                  15800017
         L     WAREG,4(RWTGC)           ADDR OF OPEN WORK AREA   Y02947 15850002
         USING WORKAREA,WAREG                                    Y02947 15900002
*                                       GET DEVICE OFFSET               16700019
         SR    RW1,RW1                                                  17600019
         IC    RW1,DCBDEVTP                                             18500019
         IC    RW1,OFFSETAB(RW1)                                        19400019
         SPACE 4                                                        20600017
ENDLOD1  STC   RW1,DCBDEVTP            STORE DEVICE OFFSET              20800017
         SPACE 2                                                 YM4085 20810002
*        THE FOLLOWING DETERMINES IF ABEND 099 SHOULD BE ISSUED  YM4085 20820002
*        DUE TO DYNAMIC BUFFERING BEING SPECIFIED AND THE        YM4085 20830002
*        APPLICATION RUNNING V=V.                                YM4085 20840002
         TM    DCBBFTEK,DYNBUF         DYNAMIC BUFFERING?        YM4085 20842002
         BNO   CHKBUF                  NO, CHECK BUFFER POOL     YM4085 20844002
         L     RTIOT,DEBTCBAD-DISP1    LOAD TCB ADDRESS          YM4085 20846002
         USING TCB,RTIOT               TCB ADDRESSABILITY        YM4085 20848002
         TM    TCBFLGS6,TCBRV          V=R?                      YM4085 20848402
         BO    CHKBUF                  YES, CHECK BUFFER POOL    YM4085 20848802
         DROP  RTIOT                   DROP TCB ADDRESS          YM4085 20849202
         L     RF,ERR9                 DYNAMIC BUFFERING, BUT    YM4085 20849602
         ABEND (RF),DUMP               FOR A V=V APPLICATION     YM4085 20849702
         SPACE 2                                                 YM4085 20849802
CHKBUF   EQU   *                                                 YM4085 20849902
         SPACE 2                                                 Y02947 20850002
*    THE FOLLOWING SECTION OF CODE BUILDS A BUFFER POOL IF BUFNO AND    21000017
*    BUFL ARE SPECIFIED AND THE PROBLEM PROGRAM HAS NOT PROVIDED ITS    21200017
*    OWN BUFFER POOL.                                                   21400017
         SPACE 1                                                 Y02947 21600002
         CLI   DCBDEVTP,TYPE2F                                          21620019
         BE    NODYNBFF                                                 21640019
         CLI   DCBDEVTP,TYPE30                                          21660019
         BNE   BUFFTEST                                                 21680019
NODYNBFF NI    DCBBFTEK,ALLON-DYNBUF                             A26916 21700019
BUFFTEST EQU   *                                                        21720019
         L     RDCB,0(RPARC)            RE-INITIALIZE DCB REGISTER.     21800017
         CLI   DCBBUFCB+3,X'01'         TEST FOR THE ABSENCE OF A       22000017
         BE    TSTBUFNO     BUFFER POOL CONTROL BLOCK.  IF NOT  YA03255 22200000
*                           EQUAL, THE USER HAS PROVIDED A POOL YA03255 22400000
         L     RC,DCBBUFCB              GET DCB ADDRESS         YA03255 22450000
         MODESET KEYADDR=DXUKEY,WORKREG=15  ASSUME USER KEY L5 @ZA03550 22550000
         ICM   RJ,ONE,DISP5(RC)  GET NUMBER OF BUFFERS      L5 @ZA03550 22552000
         MODESET EXTKEY=DATAMGT        KEY OF 5             L5 @ZA03550 22554000
         STCM  RJ,ONE,DCBBUFCB  INTO BYTE 0 OF CNTRL BLK PTRS  @ZA03550 22556000
         B     ENDLOD2                                          YA03255 22560000
TSTBUFNO EQU   *                                                YA03255 22570000
         CLI   DCBBUFNO,X'00'           TEST FOR NUMBER OF BUFFERS.     22600017
         BE    TESTDYNB            IF NO BUFFERS REQUESTED, BRANCH.     22800017
         CLC   DCBBUFL(2),IOBPOOL+2     IS BUFFER LNGTH EQUAL TO   000E 23000017
         BNE   GETPOOL             ZERO.  IF NOT EQUAL, BRANCH.         23200017
TESTDYNB TM    DCBBFTEK,DYNBUF          TEST FOR DYNAMIC BUFFERING.  IF 23400017
         BZ    ENDLOD2             NOT SPECIFIED, BRANCH.  IF DYNAMIC   23600017
         SPACE 1                                                Y02947  23650002
*    BUFFERING IS SPECIFIED, TERMINATE VIA ABEND.                       23800017
         L     1,ERR6                   DYNAMIC BUFFERING IS SPECIFIED, 24000017
         ABEND (1),DUMP            BUT NO BUFFER POOL HAS BEEN PROVIDED 24200017
*                                  OR REQUESTED.                        24400017
GETPOOL  SR    RB,RB                                                    24600017
         IC    RB,DCBBUFNO              GET NUMBER OF BUFFERS.          24800017
         LH    RC,DCBBUFL               GET BUFFER LENGTH.              25000017
         LA    RC,3(RC)                 ROUND TO                        25200017
         SRL   RC,2                     NEXT HIGHEST                    25400017
         SLL   RC,2                               FULL WORD.            25600017
         STH   RC,DCBBUFL               STORE ROUNDED BUFFER LENGTH IN  25800017
*                                  DCB.                                 26000017
         LR    RE,RB                    SAVE NUMBER OF BUFFERS.         26200017
         LR    RF,RC                    SAVE BUFFER LENGTH.             26400017
         MR    RE,RE                    COMPUTE SIZE OF BUFFER AREA.    26600017
         LA    RE,8(RF)                 ADD 8 FOR BUFFER CONTROL BLOCK. 26800017
         O     RE,IOBPOOL               PLACE SUBPOOL NMBR IN HIGH 000E 27000017
*                                  ORDER BYTE OF PARAMETER REGISTER.    27200017
         SPACE 2                                                 Y02947 27210002
         MODESET KEYADDR=DXUKEY,WORKREG=15    ASSUME USER KEY    Y02947 27250002
         EJECT                                                   Y02947 27300002
*    GET CORE FOR BUFFER POOL FROM SUBPOOL 250                   Y02947 27350002
         GETMAIN R,LV=(0)                                               27400017
         SPACE 2                                                 Y02947 27450002
*                                                                       27600017
         LR    RE,RF               SAVE ADDRESS OF BUFFCB        Y02947 27800002
         STH   RB,4(RF)                 STORE NUMBER OF BUFFERS IN      28400017
*                                  BUFFER CONTROL BLOCK.                28600017
         STH   RC,6(RF)                 STORE BUFFER LENGTH IN BUFFER   28800017
*                                  CONTROL BLOCK.                       29000017
         LR    RUCB,RF                  GET START ADDRESS IN WORK REG.  29200017
*                                                                       29400017
*    THE NEXT SEQUENCE OF INSTRUCTIONS FORMS THE BUFFER CHAIN.          29600017
*                                                                       29800017
         LA    RUCB,8(RUCB)             POINT TO FIRST BUFFER.          30000017
         ST    RUCB,0(RF)               STORE ADDRESS OF FIRST BUFFER   30200017
*                                  IN BUFFER CONTROL BLOCK.             30400017
         LR    RF,RUCB                  SAVE ADDRESS OF FIRST BUFFER.   30600017
TESTBUFC BCT   RB,NEXTBUF               IF THERE ARE MORE BUFFERS,      30800017
*                                  BRANCH.                              31000017
         ST    RB,0(RF)                 ZERO LAST LINK FIELD.           31200017
         SPACE 2                                                 Y02947 31210002
         MODESET EXTKEY=DATAMGT    DATAMGT KEY OF 5              Y02947 31250002
         SPACE 2                                                 Y02947 31260002
         STCM RE,SEVEN,DCBBUFCB+DISP1   PLACE BUFFER CONTROL     Y02947 31300002
*                                       BLOCK ADDR IN DCB        Y02947 31350002
         OI    DCBMACRF,X'04'           INDICATE TO CLOSE THAT THE      31400017
*                                  BUFFER POOL SHOULD BE FREED.         31600017
         B     ENDLOD2                                                  31800017
NEXTBUF  ALR   RUCB,RC                  CALCULATE ADDRESS OF NEXT       32000017
*                                  BUFFER.                              32200017
         ST    RUCB,0(RF)               STORE NEXT BUFFER ADDRESS IN    32400017
*                                  LINK FIELD OF CURRENT BUFFER.        32600017
         ALR   RF,RC                    CALCULATE ADDRESS OF NEXT LINK  32800017
*                                  FIELD.                               33000017
         B     TESTBUFC                                                 33200017
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 33400017
         SPACE 2                                                   000M 33500019
ENDLOD2  EQU   *                                                   000M 33600019
         SPACE 1                                                   000M 33700019
         SPACE 1                                                   000M 34000019
         SR    RTIOT,RTIOT              CLEAR REGERSTER            000M 34100019
         IC    RTIOT,DCBDEVTP           GET OFFSET                 000M 34200019
         IC    RTIOT,DEVTABLE(RTIOT)    GET MODULE NUMBER          000M 34300019
         STC   RTIOT,DISP0(WAREG)       STORE MODULE NUMBER ID   Y02947 34400002
         MH    RTIOT,SIX                6 BYTE IDTTRL FIELDS       000M 34500019
         LA    RB,CHNIDTBL                                         000M 34600019
         AR    RB,RTIOT                 POINT TO SELECTED MODULE ID000M 34700019
         MVC   WORKTTRL(6,WAREG),0(RB)  STORE ID                 Y02947 34800002
         SPACE 2                                                   000M 35000019
EXIT     MVC   0(5,RWTGC),BTAMLOD3      SET UP ID FOR LOAD 3 OF BTAM    36200017
*                                  EXECUTOR.                            36400017
         L     RJ,4(RWTGC)                                              36600017
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG REGISTER. 36800017
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT PARAMETER     37000017
*                                  LIST REGISTER TO NEXT ENTRY.         37200017
         CLC   0(2,RWTGC),AMIDCNST      IF THE NEXT WTG ENTRY CALLS FOR 37400017
         BCR   8,RBASE             THIS EXECUTOR, RETURN TO BEGINNING.  37600017
         CLC   0(2,RWTGC),OPIDCNST      IF NOT, TEST FOR END OF TABLE.  37800017
         BNE   RELOOP              NOT END OF TABLE, RETURN TO CHECK    38000017
*                                  NEXT ENTRY.                          38200017
         LR    RPARC,RPAR               REINITIALIZE CURRENT WTG REG    38400017
         LA    RWTGC,WAOFF(0,RWTG) AND CURRENT PARAMETER LIST REG.      38600017
ZCHECK   CLI   0(RWTGC),X'00'                                           38800017
         BNE   XCTLRTNE            IF NOT ZERO, GO TO TRANSFER CONTROL  39000017
         LA    RWTGC,WGOFF(0,RWTGC) IF ZERO, GET NEXT ENTRY AND RETURN  39200017
         LA    RPARC,PLOFF(0,RPARC) TO ZCHECK.                          39400017
         B     ZCHECK                                                   39600017
         SPACE 3                                                        39800017
XCTLRTNE EQU   *                                                        40000017
         LA    RJ,DXCCW12           POINT TO DOUBLE WORD LIST.   Y02947 40200002
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID TO NAME FIELD.          40400017
         MVC   14(3,RWTG),2(RWTGC)      MOVE TTR TO WTG TABLE.          40600017
         L     RW1,SIXT                 CVT ADDRESS              Y02947 40650002
         USING CVT,RW1                  CVT ADDRESSABILITY       Y02947 40700002
         L     RW1,CVTSVDCB             SYS1.SVCLIB DCB          Y02947 40750002
         DROP  RW1                      DROP CVT ADDRESS         Y02947 40760002
         XCTL  DE=(RWTG),SF=(E,(15)),DCB=(RW1)                   Y02947 40800002
         EJECT                                                          40890019
OFFSETAB EQU   *              NOTE: THIS TABLE IS IN PARRALLEL WITH     40980019
*                                       TYPETAB AND SPFETAB             41070019
         DC    X'00'          1050                                      41160019
         DC    X'03'          1050 A                                    41250019
         DC    X'01'          1050 P                                    41340019
         DC    X'04'          1050 D                                    41430019
         DC    X'02'          1050 AD                                   41520019
         DC    X'17'          1060                                      41610019
         DC    X'18'          1060 P                                    41700019
         DC    X'31'          2470C CS                                  41790019
         DC    X'32'          2740C ACS                                 41880019
         DC    X'32'          2740C CDS                                 41970019
         DC    X'32'          2740C ACDS                                42060019
         DC    X'05'          2740                                      42150019
         DC    X'15'          2740 S                                    42240019
         DC    X'07'          2740 A                                    42330019
         DC    X'0D'          2740 AT                                   42420019
         DC    X'16'          2740 C                                    42510019
         DC    X'13'          2740 CS                                   42600019
         DC    X'2D'          2740 CO                                   42690019
         DC    X'10'          2740 AC                                   42780019
         DC    X'0A'          2740 ACT                                  42870019
         DC    X'2E'          2740 ACO                                  42960019
         DC    X'14'          2740 PS                                   43050019
         DC    X'12'          2740 CPS                                  43140019
         DC    X'08'          2740 D                                    43230019
         DC    X'0E'          2740 DT                                   43320019
         DC    X'06'          2740 AD                                   43410019
         DC    X'0C'          2740 ADT                                  43500019
         DC    X'11'          2740 CD                                   43590019
         DC    X'0B'          2740 CDT                                  43680019
         DC    X'2E'          2740 CDO                                  43770019
         DC    X'0F'          2740 ACD                                  43860019
         DC    X'09'          2740 ACDT                                 43950019
         DC    X'2E'          2740 ACDO                                 44040019
         DC    X'2B'          2741P                                     44130019
         DC    X'2C'          2741P A                                   44220019
         DC    X'2B'          2741C                                     44310019
         DC    X'2C'          2741C A                                   44400019
         DC    X'2C'          2741C AD                         @ZA10016 44440000
         DC    X'2F'          1050X                                     44490019
         DC    X'30'          1050X A                                   44580019
         DC    X'30'          1050X D                                   44670019
         DC    X'30'          1050X AD                                  44760019
         DC    X'31'          2740X CS                                  44850019
         DC    X'32'          2740X ACS                                 44940019
         DC    X'32'          2740X CDS                                 45030019
         DC    X'32'          2740X ACDS                                45120019
         DC    X'16'          2740B C                              00MC 45160020
         DC    X'19'          1030                                      45210019
         DC    X'1A'          1030P                                     45300019
         DC    X'00'          1050                                      45390019
         DC    X'03'          1050 A                                    45480019
         DC    X'01'          1050 P                                    45570019
         DC    X'04'          1050 D                                    45660019
         DC    X'02'          1050 AD                                   45750019
         DC    X'2F'          1050X                                     45840019
         DC    X'30'          1050X A                                   45930019
         DC    X'30'          1050X D                                   46020019
         DC    X'30'          1050 X AD                                 46110019
         DC    X'1B'          83B3                                      46200019
         DC    X'1D'          115A                                      46290019
         DC    X'1F'          TWX                              @ZA26035 46330000
         DC    X'20'          TWX A                                     46380019
         DC    X'21'          TWX D                                     46470019
         DC    X'1F'          TWX AD                                    46560019
         DC    X'2A'          WTTA                                      46650019
         DC    X'22'          2848                                      46740019
         DC    X'25'          BSC1                                      46830019
         DC    X'25'          BSC1  DUAL CODE                           46920019
         DC    X'25'          BSC1  DUAL INTERFACE                      47010019
         DC    X'25'          BSC1  DUAL CODE,DUAL INTERFACE            47100019
         DC    X'26'          BSC2  A                                   47190019
         DC    X'26'          BSC2  A,DUAL CODE                         47280019
         DC    X'26'          BSC2  A,DUAL INTERFACE                    47370019
         DC    X'26'          BSC2  A,DUAL CODE,DUAL INTERFACE          47460019
         DC    X'26'          BSC2  D                                   47550019
         DC    X'26'          BSC2  D,DUAL CODE                         47640019
         DC    X'26'          BSC2  AD                                  47730019
         DC    X'26'          BSC2  AD,DUAL CODE                        47820019
         DC    X'26'          BSC2  D,DUAL INTERFACE                    47910019
         DC    X'26'          BSC2  D,DUAL INTERFACE,DUAL CODE          48000019
         DC    X'26'          BSC2  AD,DUAL INTERFACE                   48090019
         DC    X'26'          BSC2  AD,DUAL INTERFACE,DUAL CODE         48180019
         DC    X'27'          BSC3  P                                   48270019
         DC    X'27'          BSC3  P,DUAL CODE                         48360019
         DC    X'27'          BSC3  P,DUAL INTERDACE                    48450019
         DC    X'27'          BSC3  P,DUAL INTERFACE,DUAL CODE          48540019
         EJECT                                                          48630019
         DS    0F                                                       48720019
ERR6     DC    X'00096000'              ABEND CODE INDICATING THAT      49600017
*                                       NO BUFFER POOL OR        Y02947 49650002
*                                       BUFFERING TECHNIQUE WAS  Y02947 49700002
*                                       DEFINED FOR THE LINE     Y02947 49750002
*                                       GROUP.                   Y02947 49760002
ERR9     DC    X'00099000'              ABEND CODE INDICATING    YM4085 49770002
*                                       THAT DYNAMIC BUFFERING   YM4085 49780002
*                                       WAS SPECIFIED FOR A V=V  YM4085 49790002
*                                       APPLICATION.             YM4085 49792002
IOBPOOL  DC    X'FA000000'              SUBPOOL 250 FOR BUFFER   Y02947 49800002
*                                       POOL.                    Y02947 49850002
TYPE2F   EQU   X'2F'                                                    49860019
TYPE30   EQU   X'30'                                                    49920019
SEVEN    EQU  7                         MASK FOR STCM            Y02947 49970002
*                                       INSTR (3 BYTES)          Y02947 49980002
SIXT     EQU   16                       OFFSET TO CVT            Y02947 50030002
DISP0    EQU   0                        ZERO DISPLACEMENT        Y02947 50040002
DISP1    EQU   1                        DISPLACEMENT OF ONE      Y02947 50080002
DISP5    EQU   5                        DISPLACEMENT OF 5       YA03255 50130000
ONE      EQU   1                       FOR ICM AND STCM     L5 @ZA03550 50180000
         EJECT                                                          50400019
DEVTABLE EQU   *                                                        50800019
*        MODULE NUMB  ID     OFFSET     DEVICE                          51200019
         DC    X'00'  MD        0       1050                            51600019
         DC    X'01'  ME        1       1050 P                          52000019
         DC    X'02'  MF        2       1050 AD                         52400019
         DC    X'02'  MF        3       1050 A                          52800019
         DC    X'02'  MF        4       1050 D                          53200019
         DC    X'03'  MT        5       2740                            53600019
         DC    X'04'  MU        6       2740 AD                         54000019
         DC    X'04'  MU        7       2740 A                          54400019
         DC    X'04'  MU        8       2740 D                          54800019
         DC    X'05'  MV        9       2740 ACDX                       55200019
         DC    X'05'  MV        A       2740 ACX                        55600019
         DC    X'05'  MV        B       2740 CDX                        56000019
         DC    X'06'  MW        C       2740 ADX                        56400019
         DC    X'06'  MW        D       2740 AX                         56800019
         DC    X'06'  MW        E       2740 DX                         57200019
         DC    X'07'  MX        F       2740 ACD                        57600019
         DC    X'07'  MX        10      2740 AC                         58000019
         DC    X'07'  MX        11      2740 CD                         58400019
         DC    X'08'  M1        12      2740 CPS                        58800019
         DC    X'09'  MY        13      2740 CS                         59200019
         DC    X'0A'  M2        14      2740 PS                         59600019
         DC    X'0B'  MZ        15      2740 S                          60000019
         DC    X'0C'  M0        16      2740 C                          60400019
         DC    X'0D'  MI        17      1060                            60800019
         DC    X'0E'  M4        18      1060 P                          61200019
         DC    X'0F'  MJ        19      1030                            61600019
         DC    X'10'  MK        1A      1030 P                          62000019
         DC    X'11'  ML        1B      83B3                            62400019
         DC    X'11'            1C                NCS                   62800019
         DC    X'12'  MN        1D      115A                            63200019
         DC    X'12'            1E                NCS                   63600019
         DC    X'13'  MP        1F      TWX  AD                         64000019
         DC    X'13'  MP        20      TWX  A                          64400019
         DC    X'13'  MP        21      TWX  D                          64800019
         DC    X'14'  M3        22      2848                            65200019
         DC    X'15'            23                                      65600019
         DC    X'16'            24                                      66000019
         DC    X'15'  M5        25      BSC1                            66400019
         DC    X'16'  M6        26      BSC2                            66800019
         DC    X'17'  PC        27      BSC3                            67200019
         DC    X'17'            28                                      67600019
         DC    X'17'            29                                      68000019
         DC    X'18'  PB        2A      WTTA                            68400019
         DC    X'19'  PE        2B      2741                            68800019
         DC    X'1A'  PF        2C      2741 A                          69200019
         DC    X'1B'  PL        2D      2740 CO                         69600019
         DC    X'1C'  PM        2E      2740 ACO/DCO/ADCO               70000019
         DC    X'1D'  PN        2F      1050X                           70400019
         DC    X'1E'  PO        30      1050X A/D/AD                    70800019
         DC    X'1F'  PP        31      2740X CS                        71200019
         DC    X'20'  PQ        32      2740X AC/CD/ACD                 71600019
         EJECT                                                          72000019
DYNBUF   EQU   X'08'                   CODE FOR BFTEK=0  IN DCB         76200017
OPIDCNST DC    C'0S'                    ID OF LAST OPEN LOAD.           76400017
SIX      DC    H'06'                                               000M 76460019
ALLON     EQU   X'FF'                                              000M 76520019
AMIDCNST  DC    C'4N'                   ID OF THIS MODULE               76600017
WAOFF    EQU   32                       OFFSET OF FIRST WTG ENTRY FROM  76800017
*                                  START OF WTG.                        77000017
PLOFF    EQU   4                        OFFSET OO DCB ENTRIES.          77200017
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES.          77400017
         SPACE 3                                                 Y02947 77550002
BTAMLOD3 DC    C'3Q'                   ID FOR THIRD OPEN LOAD MODULE    79000017
         DC    X'00000000'             TTR AND L                        79200017
CHNIDTBL DC    C'MD',XL4'0'   00       1050                        000M 79205019
         DC    C'ME',XL4'0'   01       1050 P                      000M 79210019
         DC    C'MF',XL4'0'   02       1050 AD                     000M 79215019
         DC    C'MT',XL4'0'   03       2740                        000M 79220019
         DC    C'MU',XL4'0'   04       2740 AD                     000M 79225019
         DC    C'MV',XL4'0'   05       2740 ACDT                   000M 79230019
         DC    C'MW',XL4'0'   06       2740 ADT                    000M 79235019
         DC    C'MX',XL4'0'   07       2740                        000M 79240019
         DC    C'M1',XL4'0'   08       2740 CPS                    000M 79245019
         DC    C'MY',XL4'0'   09       2740 CS                     000M 79250019
         DC    C'M2',XL4'0'   0A       2740 PS                     000M 79255019
         DC    C'MZ',XL4'0'   0B       2740 S                      000M 79260019
         DC    C'M0',XL4'0'   0C       2740 C                      000M 79265019
         DC    C'MI',XL4'0'   0D       1060                        000M 79270019
         DC    C'M4',XL4'0'   0E       1060 P                      000M 79275019
         DC    C'MJ',XL4'0'   0F       1030                        000M 79280019
         DC    C'MK',XL4'0'   10       1030 P                      000M 79285019
         DC    C'ML',XL4'0'   11       83B3                        000M 79290019
         DC    C'MN',XL4'0'   12       115A                        000M 79295019
         DC    C'MP',XL4'0'   13       TWX  AD                     000M 79300019
         DC    C'M3',XL4'0'   14       2848                        000M 79305019
         DC    C'M5',XL4'0'   15        BSC1    CONTENTION         000M 79310019
         DC    C'M6',XL4'0'   16        BSC2    SWITCHED  (AD)     000M 79315019
         DC    C'PC',XL4'0'   17        BSC3    POLLED  (P)        000M 79320019
         DC    C'PB',XL4'0'   18        WTTA                       000M 79325019
         DC    C'PE',XL4'0'   19        2741                       000M 79330019
         DC    C'PF',XL4'0'   1A        2741 A                     000M 79335019
         DC    C'PL',XL4'0'   1B        2740 CO                    000M 79340019
         DC    C'PM',XL4'0'   1C        2740 COD                   000M 79345019
         DC    C'PN',XL4'0'   1D        1050X                      000M 79350019
         DC    C'PO',XL4'0'   1E        1050X AD                   000M 79355019
         DC    C'PP',XL4'0'   1F        2740X C                    000M 79360019
         DC    C'PQ',XL4'0'   20        2740X ACD                  000M 79365019
         EJECT                                                   Y02947 80050002
         DCBD  DSORG=BX,DEVD=BS                                         80200017
        IECTDEBX                                                        80600017
         EJECT                                                   Y02947 80610002
CVT      DSECT                                                   Y02947 80612002
         CVT   LIST=NO                                           Y02947 80614002
         EJECT                                                   Y02947 80620002
WORKAREA DSECT                                                   Y02947 80690002
         IECDSECT                                                Y02947 80740002
WORKTTRL EQU   2             DISPLACEMENT INTO WORKAREA  TO      Y02947 80790002
*                            SAVE I/O MODULE ID                  Y02947 80792002
         EJECT                                                   YM4085 80794002
         IKJTCB DSECT=YES,LIST=YES                               YM4085 80796002
         END                                                            80800017
./  ADD  SSI=62260184,NAME=IGG0194P
         TITLE 'IGG0194P - BTAM OPEN LOAD 2 FOR LOCAL 3270'             00100002
IGG0194P CSECT                                                          00200002
*                                                              @YA02128 00250002
*              FOLLOWING CHANGES APPLIED:                      @YA02128 00300002
*                                                              @YA02128 00360002
* A602500-603500,A604000                                     LD YA03239 00370000
* D603000-603500,D604100                                      LD YM7701 00380000
*                                                                       00400002
*        YA03230  (12/1/74)                                             00450002
*        ZA00543  (11/15/74)        ZA00544  (11/15/74)                 00460003
*        ZA02328  (11/15/74)        AZ04872  (10/06/75)                 00470003
*        AZ06392  (10/06/75)        AZ08051  (01/29/76)                 00480003
*        AZ12151  (07/29/76)                                            00490000
*                                                                       00500003
*                                                                       00550002
* STATUS - CHANGE LEVEL 000                                             00600002
*                                                                       00800002
* FUNCTION/OPERATION - THIS MODULE VERIFIES THAT ALL DEVICES IN THE     01000002
*    LINE GROUP ARE LOCAL 3270 DEVICES.  A BUFFER POOL WILL BE OBTAINED 01200002
*    AND INITIALIZED IF REQUESTED.  IOB'S WILL BE OBTAINED AND          01400002
*    INITIALIZED.  AN ERASE WRITE WILL BE DONE TO EACH DEVICE IN THE    01600002
*    LINE GROUP TO INITIALIZE IT.  THE CONTROL BLOCK CHAINS REQUIRED    01800002
*    FOR ATTENTION HANDLING WILL BE INITIALIZED.                        02000002
*                                                                       02200002
* ENTRY POINTS - THIS ROUTINE IS ENTERED AT IGG0194P VIA AN XCTL FROM   02400002
*    IGG0193M, THE FIRST BTAM OPEN LOAD.  IT MAY ALSO BE RE-ENTERED     02600002
*    FROM THE RELOOP PORTION OF THIS ROUTINE IF IT DETERMINES THAT      02800002
*    THERE IS ANOTHER DATA CONTROL BLOCK TO BE OPENED.                  03000002
*                                                                       03200002
* INPUT - THE REGISTERS 5, 6, 7, AND 8 ARE THE INPUT, AS FOLLOWS:       03400002
*    5 - THE ADDRESS OF THE FIRST ENTRY IN THE DCB PARAMETER LIST       03600002
*    6 - THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE          03800002
*    7 - THE ADDRESS OF THE CURRENT ENTRY IN THE DCB PARAMETER LIST     04000002
*    8 - THE ADDRESS OF THE CURRENT EXECUTOR'S ENTRY IN THE WHERE-TO-GO 04200002
*        TABLE                                                          04400002
*                                                                       04600002
* OUTPUT - THE REGISTERS 7 AND 8 WILL BE POSITIONED AT THE NEXT ENTRIES 04800002
*    IN THE DCB PARAMETER LIST AND THE WHERE-TO-GO TABLE.               05000002
*        SOME OF THE DCB AND UCB EXTENSION FIELDS WILL HAVE BEEN        05200002
*    INITIALIZED.                                                       05400002
*        THIS EXECUTOR'S ENTRY (OR ENTRIES) IN THE WHERE-TO-GO TABLE    05600002
*    WILL HAVE BEEN UPDATED TO IDENTIFY LOAD 3 FOR 3270 (IGG0194Q).     05800002
*                                                                       06000002
* EXTERNAL ROUTINES - GETMAIN, REGISTER FORM (SVC 10)                   06200002
*    FREEMAIN, REGISTER FORM (SVC 10)                                   06400002
*    ABEND (SVC 13)                                                     06600002
*    EXCP (SVC 0)                                                       06800002
*    WAIT (SVC 1)                                                       07000002
*    DOM (SVC 87)                                                       07100002
*    PURGE (SVC 16)                                                     07200002
*    WTOR (SVC 35)                                                      07400002
*    XCTL (SVC 7)                                                       07600002
*                                                                       07800002
* EXITS, NORMAL - THIS ROUTINE EXITS VIA XCTL TO THE MODULE IDENTIFIED  08000002
*    BY THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE, NAMELY        08200002
*    IGG0194Q (BTAM OPEN EXECUTOR - LOAD 3 FOR 3270).                   08400002
*                                                                       08600002
* EXITS, ERROR - THIS ROUTINE EXITS VIA ABEND FOR THE FOLLOWING ERROR   08800002
*    CONDITIONS:                                                        09000002
*    00095000  INCOMPATIBLE DEVICES ARE DEFINED ARE DEFINED TO BE ON    09200002
*              THE SAME LINE GROUP.                                     09400002
*                                                                       09600002
* TABLE/WORK AREAS - THE WHERE-TO-GO TABLE CONTAINS THE ID AND TTR OF   09800002
*    OPEN EXECUTOR LOAD 3 FOR 3270.  THE DCB PARAMETER LIST CONTAINS    10000002
*    THE ADDRESS OF EACH DCB SPECIFIED IN THE OPEN MACRO.               10200002
*                                                                       10400002
* ATTRIBUTES - THIS ROUTINE IS EXECUTED IN THE TRANSIENT AREA AS        10600002
*    ENABLED, PRIVILEDGED, AND REENTRANT.                               10800002
*                                                                       11000002
         EJECT                                                          11003002
*/*IGG0194P: CHART */                                                   11006002
*/* HEADER                                                              11009002
*/*BTAM OPEN LOAD 2 FOR LOCAL 3270 DEVICES                          */  11012002
*/*IGG0194P: E ENTRY FROM IGG0193M VIA XCTL */                          11015002
*/* M ESTABLISH ADDRESSABILITY FOR DCB AND DEB DSECTS */                11018002
*/*GETUCB: D (YES,,NO,ABEND95) ALL DVCS IN LINE GROUP 3270 DVCS */      11021002
*/* M SUPPRESS DYNAMIC BUFFERING */                                     11024002
*/*GETIOB: P STORE IOB SIZE IN DCB */                                   11027002
*/* P COMPUTE SIZE OF IOB POOL */                                       11030002
*/* L GETMAIN FOR IOB'S */                                              11033002
*/* P STORE IOB POOL BASE ADDRESS IN DCB */                             11036002
*/* M SET UCB INDEX VALUE TO ZERO */                                    11039002
*/*INITIOBS: P CLEAR CORE FOR ONE IOB */                                11042002
*/* P INITIALIZE IOBFLAG1, IOBSTART, IOBDCBPT, AND IOBUCBX */           11045002
*/* M INCREMENT THE UCB INDEX VALUE BY 1 */                             11048002
*/* D (YES,,NO,INITIOBS) ALL IOB'S INITIALIZED? */                      11051002
*/* D (YES,,NO,INITERMS) OLT REQUESTED? */                              11054002
*/* P GET IRB POINTER AREA AND STORE ADDRESS IN DEBIRBAD */             11057002
*/*INITERMS: M GET NUMBER OF DVCS, ADDR OF DEB UCB LIST AND IOB POOL */ 11060002
*/*INITLP: M GET ADDRESS OF UCB */                                      11063002
*/* P SAVE OLTEP EXECUTING FLAG FROM GCB */                             11066002
*/* P CLEAR ATTENTION HANDLING FIELDS IN UCB EXTENSION */               11069002
*/* P CLEAR THE GRAPHICS STATUS BYTE IN THE UCB */                      11071002
*/* D (NO,,YES,RLN1) IOBUCBX = 0? */                                    11072002
*/* P STORE POINTER TO MASTER UCB */                                    11075002
*/*STRLN: P INCREMENT UCB INDEX BY 1 TO OBTAIN RLN AND STORE IN UCB */  11078002
*/* D (NO,,YES,BYPASSIO) OLTEP EXECUTING ON DEVICE? */                  11081002
*/* P CREATE ERASE WRITE CHANNEL PROGRAM IN IOB CPA */                  11084002
*/* L GETMAIN FOR WTOR AREA AND ECB */                                  11087002
*/* P STORE ADDRESS OF ECB IN IOB */                                    11090002
*/*EXCP: L ISSUE EXCP TO DO WRITE */                                    11093002
*/* M CLEAR TIMER LOOP COUNTER */                                       11096002
*/*TIMELOOP: L STIMER WAIT FOR 1/2 SECOND */                            11099002
*/* D (YES,,NO,TIMLPCHK) ECB POSTED COMPLETE? */                        11102002
*/*CHKECB: D (NO,,YES,RLSECORE) COMP CODE = X'7F'? */                   11105002
*/* D (YES,,NO,CHKERR) COMP CODE = X'44'? */                            11108002
*/* M (,EXCP) CLEAR ECB */                                              11111002
*/*TIMLPCHK: D (NO,,YES,PURGE) HAVE WAITED FOR 30 SEC */                11114002
*/* M (,TIMELOOP) INCR TIMER LOOP COUNTER BY 1 */                       11117002
*/*PURGE: P BUILD PURGE PARM LIST IN WTOR AREA */                       11120002
*/* L PURGE I/O OPERATION REQUEST */                                    11123002
*/* D (YES,,NO,WRTMSG) REQUEST QUIESCING? */                            11126002
*/* L (,CHKECB) WAIT FOR OPERATION TO COMPLETE */                       11129002
*/*CHKERR: D (YES,WRTMSG,NO,) ERROR WAS SIO CC=3? */                    11131002
*/* D (YES,,NO,SETERR) ERROR WAS INTERVENTION REQUIRED ? */             11133002
*/* P SET OPEN FAILED FLAG IN GRAPHICS STATUS BYTE IN UCB */            11133402
*/*DVCIRMSG: M INITIALIZE WTOR PARM LIST, ECB, AND REPLY AREA */        11133802
*/* P STORE DEVICE NAME IN MESSAGE */                                   11134202
*/* L ISSUE WTOR */                                                     11134602
*/* P SAVE MESSAGE ID FROM WTOR */                                      11134702
*/* L WAIT FOR REPLY */                                                 11134802
*/* L RELEASE MESSAGE */                                                11134902
*/* D (YES,SETERR,NO,) IS REPLY POST ? */                               11145902
*/* D (YES,,NO,SPECCHK) IS REPLY CONT ? */                              11155902
*/* M (,EXCP) CLEAR COMPLETION CODE IN ECB */                           11157902
*/*SPECCHK: D (YES,,NO,DVCIRMSG) IS REPLY DROP ? */                     11158202
*/* P (,SETERR) SET FORCE BRANCH TO SETERR ON INTERVENTION REQUIRED */  11158602
*/*WRTMSG: M INITIALIZE WTOR PARM LIST, ECB, AND REPLY AREA */          11159002
*/* P STORE DEVICE NAME IN MESSAGE */                                   11169002
*/* L ISSUE WTOR */                                                     11180002
*/* P SAVE MESSAGE ID FROM WTOR */                                      11191002
*/* L WAIT FOR REPLY */                                                 11202002
*/* L RELEASE MESSAGE */                                                11213002
*/* D (NO,,YES,SETERR) IS REPLY 'POST'? */                              11224002
*/* D (YES,,NO,WRTMSG) IS REPLY 'CONT'? */                              11235002
*/* M (,EXCP) CLEAR COMPLETION CODE IN ECB */                           11246002
*/*BYPASSIO: P SET OLTEP EXECUTING FLAG IN IOB */                       11257002
*/*SETERR: P FLAG INITIALIZATION FAILURE IN IOB */                      11268002
*/*RLSECORE: L FREEMAIN WTOR AREA */                                    11279002
*/* M CLEAR POINTER TO WTOR AREA AND TIMER LOOP COUNT */                11290002
*/* M INCR POINTERS TO NEXT IOB AND UCB POINTER */                      11301002
*/* D (YES,,NO,INITLP) ALL TERMINALS DONE? */                           11312002
*/* R GO TO END-OF-LOAD CODE */                                         11323002
*/*RLN1: P STORE ADDRESS OF DEB IN UCB */                               11334002
*/* P (,STRLN) SAVE ADDRESS OF MASTER UCB */                            11345002
*/*ABEND95: R ABEND WITH SYSTEM 095 CODE */                             11356002
*/*IGG0194P: END */                                                     11367002
         EJECT                                                          11378002
RPARM2   EQU   0                    PARAMETER REGISTER                  11389002
RPARM1   EQU   1                    PARAMETER REGISTER                  11400002
RW1      EQU   2                    WORK REGISTER                       11600002
RCORE    EQU   3                    ADDRESS OF GETMAIN CORE             11800002
RUCB     EQU   4                    UCB ADDRESS                         12000002
RPAR     EQU   5                    ADDRESS OF DCB PARAMETER LIST       12200002
RWTG     EQU   6                    ADDRESS OF WTG TABLE                12400002
RPARC    EQU   7                    ADDRESS OF CURRENT DCB ENTRY        12600002
RWTGC    EQU   8                    ADDRESS OF CURRENT WTG ENTRY        12800002
RTIOT    EQU   9                    ADDRESS OF THE TASK I/O TABLE       13000002
RDCB     EQU   10                   DCB ADDRESS                         13200002
RDEB     EQU   11                   DEB ADDRESS                         13400002
RBASE    EQU   12                   BASE REGISTER                       13600002
RW2      EQU   13                   WORK REGISTER                       13800002
RGMUCB   EQU   13                   MASTER UCB REG             @ZA06392 13900003
RPARM4   EQU   14                   PARAMETER REGISTER                  14000002
RPARM3   EQU   15                   PARAMETER REGISTER                  14200002
*                                                                       14400002
RW3      EQU   RTIOT                ALTERNATE                           14600002
RW4      EQU   RPARM3                   ASSIGNMENTS                     14800002
RW5      EQU   RDCB                         FOR WORK REGISTERS          15000002
*                                                                       15200002
*                                                                       15400002
ALLON    EQU   X'FF'                MASK OF ALL ONE'S                   15600002
ANRIOBSZ EQU   88                   3270 IOB SIZE                       15800002
ATNCNT   EQU   26                   DISP TO ATTN CNT FIELD IN UCB       16000002
ATNXTNSN EQU   14                   LENGTH OF ATTN HANDLING SECTION     16200002
*                                      OF UCB EXTENSION                 16400002
COMPOK   EQU   X'7F'                NORMAL COMPLETION CODE              16600002
DEBATV   EQU   28                  DISP TO DEB VECTOR TO APPNDG TAB     16700002
DVC3277  EQU   X'09'                DEVICE TYPE FOR 3277 DISPLAY        16800002
DVC3286  EQU   X'0B'                DEVICE TYPE FOR 3286 PRINTER        17000002
*              DEVICE TYPE FOR 3284 PRINTER IS X'0A'                    17200002
DYNBUF   EQU   X'08'                DCB DYNAMIC BUFFERING FLAG          17600002
EIGHT    EQU   8                                                        17800002
EQ       EQU   8                    BC MASK FOR EQUALITY                18000002
ERROR    EQU   X'41'                PERMANENT ERROR OCCURED             18200002
FIVE     EQU   5                                                        18400002
FLAG1    EQU   X'42'               IOB IOS FLAGS - CMND CHAINING        18460002
*                                       I/O REQUESTS UNRELATED          18520002
FOUR     EQU   4                    ADDR INCR OF 4                      18600002
GCB      EQU   27                   DISP TO GCB FIELD IN UCB            18800002
GRAF     EQU   28                  DISP TO GRAPHICS STATUS     @YA02128 18800102
GRPHCDVC EQU   X'10'                GRAPHIC DEVICE CLASS                19000002
INITERR  EQU   X'80'                INITIALIZATION ERROR FLAG IN IOB    19200002
INTERCPT EQU   X'44'                IOB INTERCEPTED                     19400002
INTREQ   EQU   X'40'               INTERVENTION REQUIRED SENS  @YA02128 19450002
IOBOLTEP EQU   X'42'                SECONDARY OLTEP EXECUTING FLAGS     19600002
LINK     EQU   36                   DISP TO CONTROL BLOCK LINK-1        19800002
MAXINTVL EQU   59                  MAX VALUE OF TIME LOOP CTR           20000002
MSGDVCAD EQU   21                   DISP TO DEVICE ADDRESS IN WTOR      20200002
*                                      EXPASION                         20400002
OLT      EQU   X'10'                DCB BIT FOR EROPT=T                 20600002
OLTEP    EQU   X'80'                PRIMARY OLTEP EXECUTING FLAG        20800002
ONE      EQU   1                                                        21000002
OPENINIT EQU   X'80'               OPEN IN PROGRESS FLAG       @YA02128 21050002
OPENFAIL EQU   X'02'               OPEN FAILED GRAF FLAG       @YA02128 21120002
OPENMSG  EQU   X'08'               FLAG BYPASS INT REQ MSG     @YA02128 21170002
PLOFF    EQU   4                    OFFSET OF DCB ENTRIES               21200002
POSTBIT  EQU   X'40'               ECB POST BIT                         21400002
PTRSZ    EQU   16                  SIZE OF IRB POINTER AREA             21500002
PRGCTL   EQU   X'94'               PURGE CONTROL BYTE                   21600002
RDYQBTM  EQU   X'02'                RDYQ CODED IN DCB          @ZA12151 21700000
RLN      EQU   36                   DISP TO RLN FIELD IN UCB            21800002
SIOCC3   EQU   X'30'                MASK TO TEST SIO CC = 3 IN IOB      22000002
PURGEOPT EQU   X'A0'               OPTION BYTE FOR PURGE    LD @ZA02328 22050003
SIX      EQU   6                                                        22200002
TENAND4  EQU   14                                                       22300002
THREE    EQU   3                                                        22400002
TIMELNG  EQU   4                                               @ZA08051 22500003
TWELVE   EQU   12                                                       22600002
TWO      EQU   2                                                        22800002
UCBDVCLS EQU   18                   DISP TO DEVICE CLASS FIELD IN UCB   23000002
UCBDVCTP EQU   19                   DISP TO DEVICE TYPE FIELD IN UCB    23200002
UCBNAME  EQU   13                   DISP TO DEVICE NAME IN UCB          23400002
WAOFF    EQU   32                   OFFSET OF FIRST WTG ENTRY FROM      23600002
*                                       BEGINNING OF TABLE              23800002
WGOFF    EQU   8                    OFFSET OF WTG ENTRIES               24000002
WTGPATH  EQU   30                  OFFSET TO PATH BITS         @YA02128 24050002
ZERO     EQU   X'00'                                                    24200002
*              ENTRY AND ADDRESSABILITY CODE                            24400002
         BALR  RBASE,0              ESTABLISH BASE REGISTER             24600002
         USING *,RBASE                                                  24800002
         USING IHADCB,RDCB                                              25000002
         USING IECTDEB,RDEB                                             25200002
         USING WTGENTRY,RWTGC                                           25210002
         B     BEGIN                   BRANCH AROUND ID        @YA02128 25250002
         DC    CL8'IGG0194P'           NAME                    @YA02128 25300002
         DC    C'** MVS *'                                   LD YA03239 25350003
         DC    C'&SYSDATE'         DATE LAST ASSEMBLE       LD @ZA00544 25352003
BEGIN    DS    0H                                              @YA02128 25360002
*                                                                       25400002
         L     RDCB,0(RPARC)        GET DCB ADDRESS                     25600002
         L     RDEB,DCBDEBAD        GET DEB ADDRESS                     25800002
         L     RW4,WTGCORE-ONE     ADDR OF OPEN WORKAREA       @ZA04872 25900003
         USING WORKAREA,RW4                                    @ZA04872 26000003
         XC    DXCCW(TWELVE),DXCCW CLEAR PURGE PARM LIST       @ZA04872 26100003
         ST    RDEB,DXCCW          SAVE DEB ADDR FOR PURGE     @ZA04872 26200003
         L     RDEB,DEBATV(RDEB)  GET ADDR OF APPENDAGE TABLE  @ZA04872 26260003
*                                   FOR BASE OF DSECT          @ZA04872 26320003
*                                                                       26570002
*              CHECK ALL UCB'S IN LINE GROUP FOR 3270 DEVICES           26600002
*                                                                       26650002
         SR    RW1,RW1                                                  26800002
         IC    RW1,DEBNMEXT         GET NUMBER OF DEVICES IN LINE GROUP 27000002
         SR    RW2,RW2              INITIALIZE UCB TABLE INDEX TO ZERO  27200002
*                                                                       27400002
GETUCB   L     RUCB,DEBUCBAD(RW2)   GET ADDRESS OF UCB                  27600002
         CLI   UCBDVCLS(RUCB),GRPHCDVC  DEVICE A GRAPHICS DEVICE        27800002
         BNE   ABEND95              NO, ABEND                           28000002
         CLI   UCBDVCTP(RUCB),DVC3277   DEVICE A 3270 DEVICE            28200002
         BL    ABEND95              NO, ABEND                           28400002
         BE    NEXTUCB              YES, CHECK NEXT UCB                 28600002
         CLI   UCBDVCTP(RUCB),DVC3286   MAYBE                           28800002
         BH    ABEND95              NO, ABEND                           29000002
*                                                                       29200002
NEXTUCB  LA    RW2,FOUR(RW2)        INCR TO NEXT ADDRESS IN TABLE       29400002
         BCT   RW1,GETUCB           CHECK NEXT IF ALL NOT CHECKED       29600002
*                                                                       29800002
         NI    DCBBFTEK,ALLON-DYNBUF  SUPRESS DYNAMIC BUFFERING         30000002
*                                                                       30200002
*              CONSTRUCT THE IOB POOL                                   30400002
GETIOB   LA    RW1,ANRIOBSZ         GET THE IOB SIZE                    30600002
         STC   RW1,DCBEIOBX         STORE IOB SIZE IN DCB               30800002
         LR    RPARM1,RW1                                               31000002
         SR    RW2,RW2                                                  31200002
         IC    RW2,DEBNMEXT         GET NUMBER OF IOB'S                 31400002
         MR    RPARM2,RW2           GET TOTAL CORE REQUIRED             31600002
         LR    RPARM2,RPARM1        LOAD PRODUCT INTO REG 0             31800002
         O     RPARM2,IOBPOOL       OR IN SUBPOOL NUMBER                32000002
         L      RW4,WTGCORE-ONE                                  Y02947 32050002
         USING WORKAREA,RW4                                      Y02947 32100002
         MODESET KEYADDR=DXUKEY,WORKREG=9                        Y02947 32150002
         GETMAIN  R,LV=(0)          GET CORE FOR THE IOB'S              32200002
*                                                                       32400002
         USING IECTIOB,RCORE                                            32600002
         LR    RCORE,RPARM1         GET ADDRESS OF IOB POOL             32800002
         SR    RCORE,RW1            SUBTRACT IOB SIZE                   33000002
         LR    RUCB,RCORE           SAVE IOB BASE ADDR           Y02947 33200002
         LA    RDCB,0(RDCB)         CLEAR HIGH BYTE OF DCB ADDRESS      33400002
         SR    RW3,RW3              INITIALIZE COUNTER FOR UCB INDEX    33600002
*                                                                       33800002
INITIOBS LA    RCORE,0(RCORE,RW1)   STEP TO BEGINNING OF IOB            34000002
         XC    0(ANRIOBSZ,RCORE),0(RCORE)  CLEAR IOB                    34200002
         MVI   IOBFLAG1,FLAG1      SET IOS FLAGS                        34400002
         LA    RW4,IOBCPA           GET ADDR OF CHANNEL PROG AREA       34600002
         ST    RW4,IOBSTART             & STORE IT IN IOBSTART          34800002
         L     RW4,WTGCORE-ONE      ADDRESS OF OPEN WORKAREA     Y02947 34850002
         MVC   IOBDCBPT,DXUDCBAD    ADDR OF USER'S DCB TO IOB    Y02947 34900002
         STC   RW3,IOBUCBX          STORE UCB INDEX                     35200002
         LA    RW3,ONE(RW3)        INCR UCB INDEX BY 1                  35400002
         BCT   RW2,INITIOBS         DECR & TEST IOB COUNT               35600002
*                                   LOOP IF NOT FINISHED                35800002
*                                                                       36000002
*              GET POINTERS FOR IRB IF ON-LINE TEST REQUESTED           36200002
         TM    DCBERROP,OLT         OLT REQUESTED                       36400002
         BNO   INITERMS             NO, GO TO INITIALIZE TERMINALS      36600002
         LA    RPARM2,PTRSZ        NUMBER OF BYTES FOR POINTERS         36800002
         O     RPARM2,IOBPOOL       OR IN SUBPOOL NUMBER                37000002
         GETMAIN  R,LV=(0)          GET CORE FOR POINTERS               37200002
         MODESET EXTKEY=DATAMGT     BACK TO DATA MGT KEY         Y02947 37250002
         ST    RPARM1,DEBIRBAD-1    STORE ADDRESS IN DEB                37400002
         ST    RUCB,DCBIOBAD        IOB ADDR TO 'COPY' DCB       Y02947 37450002
         L     RW4,WTGCORE-ONE                                   Y02947 37500002
         MODESET KEYADDR=DXUKEY,WORKREG=9   ASSUME USER KEY      Y02947 37550002
         XC    0(PTRSZ,RPARM1),0(RPARM1)  CLEAR AREA                    37600002
         B     CONTINUE                                       LD Y02947 37650002
*                                                                       37800002
*              INITIALIZE THE ATTENTION FIELDS IN THE UCB (EXCEPT THE   38000002
*              IRB ADDRESS AND UNLOCK AND CLEAR THE TERMINALS           38200002
*                                                                       38250002
INITERMS EQU   *                                              LD Y02947 38300002
         MODESET EXTKEY=DATAMGT                               LD Y02947 38350002
         ST    RUCB,DCBIOBAD       IOB ADDR TO 'COPY' DCB     LD Y02947 38360002
         L     RW4,WTGCORE-ONE     ADDR OF OPEN WORKAREA      LD Y02947 38370002
         MODESET KEYADDR=DXUKEY,WORKREG=9                     LD Y02947 38380002
CONTINUE EQU   *                                              LD Y02947 38390002
         SR    RW3,RW3                                                  38400002
         IC    RW3,DEBNMEXT         GET NO. OF DEVICES IN  LINE GROUP   38600002
         LA    RDEB,DEBUCBAD        GET ADDR OF DEB UCB LIST            38800002
         DROP  RDEB                END DEB ADDRESSABILITY               39000002
         L     RCORE,DCBIOBAD       GET BASE ADDR OF IOB POOL           39200002
INITLP   EQU   *                                                        39400002
         L     RUCB,0(RDEB)         GET ADDR OF UCB FOR DEVICE          39600002
         LA    RCORE,ANRIOBSZ(RCORE)  GET ADDR OF IOB FOR DEVICE        39800002
         IC    RW1,GCB(RUCB)          SAVE GCB FIELD                    40000002
         MODESET EXTKEY=ZERO          NEED KEY 0 TO STORE IN UCB Y02947 40050002
         XC    ATNCNT(ATNXTNSN,RUCB),ATNCNT(RUCB)  CLEAR ATTN-HANDLING  40200002
*                                         FIELDS IN UCB EXTENSION       40400002
         STC   RW1,GCB(RUCB)          RESTORE GCB TO UCB                40600002
         NI    GCB(RUCB),OLTEP     CLEAR ALL GCB EXCEPT OLTEP-EXEC      40800002
*                                         FLAG                          41000002
         NI    GRAF(RUCB),ZERO     RESET GRAPHICS STATUS       @YA02128 41000102
         OI    GRAF(RUCB),OPENINIT FLAG OPEN IN PROGRESS       @YA02128 41000202
         SR    RW1,RW1                                                  41200002
         IC    RW1,IOBUCBX            GET UCB INDEX FROM IOB            41400002
         LTR   RW1,RW1                IS IT 0, I.E. IS RLN = 1          41600002
         BZ    RLN1                   YES, SET UP MASTER UCB PTR TO DEB 41800002
         ST    RGMUCB,LINK(RUCB) NO, STORE PNTR TO MASTER UCB  @ZA06392 42000003
STRLN    LA    RW1,ONE(RW1)           COMPUTE RLN FROM UCB INDEX        42200002
         STC   RW1,RLN(RUCB)          AND STORE IN UCB                  42400002
*                                                                       42600002
         L     RW4,WTGCORE-ONE        ADDR OF OPEN WORKAREA   LD Y02947 42610002
         MODESET KEYADDR=DXUKEY,WORKREG=2    ASSUME USER KEY     Y02947 42650002
         TM    GCB(RUCB),OLTEP        OLTEP EXECUTING ON DEVICE         42800002
         BO    BYPASSIO               YES, DO NOT DO INITIALIZATION     43000002
*                                                                       43200002
         MVC   IOBCPA(EIGHT),WRTCCW   MOVE ERASE WRITE CCW INTO IOB     43400002
         MVC   IOBCPA+EIGHT(ONE),NOPWRT  WCC TO DATA AREA   LD @ZA00543 43450003
         LA    RW1,IOBCPA+EIGHT          ADR OF DATA AREA   LD @ZA00543 43600003
         O     RW1,IOBCPA             ADD COMMAND CODE TO HIGH BYTE     43800002
         ST    RW1,IOBCPA                                               44000002
         LA    RPARM2,WTOARLNG        GET LENGTH OF WTOR AREA           44200002
         O     RPARM2,IOBPOOL         SET POOL NUMBER                   44400002
         GETMAIN  R,LV=(0)          GET CORE FOR IT                     44600002
         ST    RPARM1,IOBECBPT      STORE ADDRESS IN IOB                44800002
         XC    0(WTOARLNG,RPARM1),0(RPARM1)  CLEAR AREA                 45000002
         MODESET EXTKEY=DATAMGT    DATA MGT KEY               LD Y02947 45050002
         LR    RPARM1,RUCB         SAVE REG 4                 LD Y02947 45100002
         L     RUCB,WTGCORE-ONE    WORK AREA ADDRESS          LD Y02947 45150002
         USING WTG,RWTG            WTG ADDRESSABILITY         LD Y02947 45160002
         L     RW4,WTGPREFX        WTG PREFIX ADDRESS         LD Y02947 45170002
         STM   RPARM2,RPARM4,IECREGSV-IECPREFX(RW4) SAVE REG  LD Y02947 45180002
         IECRES INIT,DCBCOPY=FRWKAR                                     45190002
         LR    RW4,RWTG            REG SAVEAREA ADDR          LD YM5668 45192000
         LM    RPARM2,RPARM4,IECREGSV-IECPREFX(RW4) REST REG  LD Y02947 45194002
         LR    RUCB,RPARM1         RESTORE REG 4              LD Y02947 45196002
         USING WORKAREA,RW4        WORKAREA ADDRESSABILITY    LD Y02947 45198402
         L RW4,WTGCORE-ONE         WORK AREA ADDRESS          LD Y02947 45198802
         MODESET KEYADDR=DXUKEY,WORKREG=1   USER KEY          LD Y02947 45199202
*                                                                       45200002
EXCP     EQU   *                                                 Y02947 45250002
         DROP  RW4                                               Y02947 45300002
         LA    RPARM1,IOBFLAG1      GET ADDRESS OF IOB                  45400002
         EXCP  (1)                  DO I/O OPERATION                    45600002
*                                                                       45800002
         MVI   IOBINCAM+1,ZERO     CLEAR LOOP CTR                       46000002
         MVC   IOBERINF(TIMELNG),TIME   MOVE TIME VALUE        @ZA08051 46050003
*                                                                       46100002
TIMELOOP STIMER WAIT,BINTVL=IOBERINF   WAIT FOR .5 SEC      LD @ZA00544 46200003
         L     RW1,IOBECBPT        GET ADDR OF ECB                      46400002
         TM    0(RW1),POSTBIT      HAS ECB BEEN POSTED                  46600002
         BZ    TIMLPCHK            NO, SEE IF TIME INTERVAL UP          46800002
*                                                                       47000002
CHKECB   EQU   *                                                        47200002
         L     RW1,IOBECBPT         GET ADDRESS OF ECB                  47400002
         CLI   0(RW1),COMPOK        NORMAL COMPLETION                   47600002
         BE    RLSECORE             YES, RELEASE GETMAIN AREA           47800002
*                                                                       48000002
         CLI   0(RW1),INTERCPT      IOB INTERCEPTED                     48200002
         BNE   CHKERR               NO, CHECK CAUSE OF ERROR            48400002
         MVI   0(RW1),ZERO          YES, CLEAR COMPLETION CODE          48600002
         B     EXCP                 RE-ISSUE OPERATION                  48800002
*                                                                       49000002
TIMLPCHK CLI   IOBINCAM+1,MAXINTVL LOOP CTR AT MAX VALUE                49200002
         BE    PURGE               YES, PURGE I/O           LD @ZA02328 49250003
         SR    RW1,RW1                                                  49600002
         IC    RW1,IOBINCAM+1      GET LOOP CTR                         49800002
         LA    RW1,ONE(RW1)        INCR CTR BY 1                        50000002
         STC   RW1,IOBINCAM+1      AND STORE BACK IN IOB                50200002
         B     TIMELOOP            WAIT FOR 0.5 SEC MORE                50400002
*                                                                       50600002
PURGE    EQU   *                                            LD @ZA02328 50610003
         MODESET EXTKEY=DATAMGT    DATA MANAGEMENT KEY      LD @ZA02328 50620003
         L     RW4,WTGCORE-ONE     WORKAREA ADDRESSABILITY  LD @ZA02328 50630003
         USING WORKAREA,RW4                                             50640002
         MVI   DXCCW,PURGEOPT      HALT I/O OPTION          LD @ZA02328 50642003
         PURGE DXCCW                                        LD @ZA02328 50644003
         L     RW4,WTGCORE-ONE     WORKAREA ADDRESSABILITY  LD @ZA02328 50646003
         MODESET KEYADDR=DXUKEY,WORKREG=15                  LD @ZA02328 50648003
*                                                                       50648402
CHKERR   EQU   *                   CHECK CAUSE OF I/O FAILURE  @YA02128 50650002
         TM    IOBSIOCC,SIOCC3     WAS ERROR SIO CC = 3 (CU    @YA02128 50700002
*                                  NOT OPERATIONAL)            @YA02128 50750002
         BO    WRTMSG              YES, TELL OPERATOR          @YA02128 50800002
         TM    IOBSENS0,INTREQ     INTERVENTION REQUIRED ?     @YA02128 50850002
         BNO   SPECBR              NO, GO FLAG OPEN ERROR      @YA02128 50860002
         MODESET EXTKEY=ZERO                                 LD YA02128 50862002
         OI    GRAF(RUCB),OPENFAIL FLAG OPEN FAILED            @YA02128 50870002
         USING WORKAREA,RW4         WORKAREA ADDRESSABILITY  LD YA02128 50872002
         L     RW4,WTGCORE-ONE      WORKAREA ADDRESS         LD YA02128 50874002
         MODESET KEYADDR=DXUKEY,WORKREG=15                   LD YA02128 50876002
         DROP  RW4                                           LD YA02128 50878002
SPECBR   EQU   *                   TEST TO SEE IF BYPASS MSG   @YA02128 50880002
         TM    WTGPATHS,WTGSPMSG   BYPASS MSG SET ?            @YA02128 50900002
         BO    SETERR              YES, BYPASS INT REQ MSG     @YA02128 50950002
         L     RW1,IOBECBPT        GET ADDR OF GETMAINED AREA  @YA02128 51250002
DVCIRMSG EQU   *                   PUT OUT DEVICE NOT OPER     @YA02128 51300002
         XC    0(EIGHT,RW1),0(RW1) CLEAN ECB AND REPLY AREA    @YA02128 51350002
         LA    RPARM2,FOUR(RW1)    GET ADDRESS OF REPLY AREA   @YA02128 51400002
         MVC   EIGHT(WTODVLNG-EIGHT,RW1),WTODEV MOVE DEV MSG   @YA02128 51450002
         MVC   MSGDVCAD+EIGHT(THREE,RW1),UCBNAME(RUCB) PUT     @YA02128 51500002
*                                  UCB NAME IN MESSAGE         @YA02128 51550002
         LA    RPARM1,EIGHT(RW1)   GET BEGINNING OF WTOR EXP   @YA02128 51600002
         WTOR  ,(RPARM2),,(RW1),MF=(E,(1)) WRITE MESSAGE       @YA02128 51650002
         XR    RPARM1,RW1          EXCHANGE CONTENTS           @YA02128 51700002
         XR    RW1,RPARM1          OF REGISTERS                @YA02128 51750002
         XR    RPARM1,RW1          RPARM1 AND RW1              @YA02128 51800002
         WAIT  ECB=(1)             WAIT FOR REPLY              @YA02128 51850002
         DOM   MSG=(2)             RELEASE MESSAGE             @YA02128 51900002
         L     RW1,IOBECBPT        GET ADDRESS OF WTOR AREA    @YA02128 51950002
         CLC   FOUR(FOUR,RW1),POST IS REPLY 'POST' ?           @YA02128 52000002
         BE    SETERR              YES, FLAG ERROR             @YA02128 52050002
         CLC   FOUR(FOUR,RW1),CONT IS REPLY 'CONT' ?           @YA02128 52100002
         BNE   SPECCHK             NO, CHECK SPECIAL REPLY     @YA02128 52150002
         MVI   0(RW1),ZERO         YES, CLEAR COMPLETION CODE  @YA02128 52200002
         MODESET EXTKEY=ZERO                                 LD YA02128 52202002
         NI    GRAF(RUCB),ALLON-OPENFAIL TURN OFF OPEN  FLAG   @YA02128 52210002
         USING WORKAREA,RW4         WORKAREA ADDRESSABILITY  LD YA02128 52220002
         L     RW4,WTGCORE-ONE      WORKAREA ADDRESS         LD YA02128 52230002
         MODESET KEYADDR=DXUKEY,WORKREG=1                    LD YA02128 52240002
         B     EXCP                AND RETRY I/O               @YA02128 52250002
SPECCHK  EQU   *                   CHECK FOR BYPASS FUTURE     @YA02128 52300002
         CLC   FOUR(FOUR,RW1),DROP IS REPLY 'DROP' ?           @YA02128 52700002
         BNE   DVCIRMSG            NO, INVALID - REISSUE MSG   @YA02128 52750002
         MODESET EXTKEY=DATAMGT                              LD YA02128 52760002
         OI    WTGPATHS,WTGSPMSG   SET BYPASS INT REQ MSG      @YA02128 52800002
         L     RW4,WTGCORE-ONE     WORKAREA ADDRESS          LD YA02128 52850002
         MODESET KEYADDR=DXUKEY,WORKREG=15                   LD YA02128 52860002
         DROP  RW4                                           LD YA02128 52870002
         B     SETERR              AND GO SET OPEN ERROR       @YA02128 52900002
*                                                                       55000002
WRTMSG   XC    0(EIGHT,RW1),0(RW1)  YES, CLEAR ECB AND REPLY AREA       55200002
         LA    RPARM2,FOUR(RW1)     GET ADDRESS OF REPLY AREA           55400002
         MVC   EIGHT(WTOARLNG-EIGHT,RW1),WTOBASE  MOVE SKELETON MSG     55600002
*                                   INTO GETMAIN AREA                   55800002
         MVC   MSGDVCAD+EIGHT(THREE,RW1),UCBNAME(RUCB)  PUT DEVICE      56000002
*                                   NAME INTO MESSAGE                   56200002
         LA    RPARM1,EIGHT(RW1)    GET BEGINNING OF WTOR EXPASION      56400002
         WTOR  ,(RPARM2),,(RW1),MF=(E,(1))   WRITE MESSAGE              56600002
         XR    RPARM1,RW1           EXCHANGE CONTENTS                   56800002
         XR    RW1,RPARM1               OF REGISTERS                    57000002
         XR    RPARM1,RW1                   RPARM1 AND RW1              57200002
*                                                                       57400002
         WAIT  ECB=(1)              WAIT FOR REPLY                      57600002
*                                                                       57800002
         DOM   MSG=(2)              RELEASE MESSAGE                     58000002
*                                                                       58200002
         L     RW1,IOBECBPT         GET ADDRESS OF WTOR AREA            58400002
         CLC   FOUR(FOUR,RW1),POST  REPLY IS 'POST'                     58600002
         BE    SETERR               YES, FLAG ERROR                     58800002
*                                                                       59000002
         CLC   FOUR(FOUR,RW1),CONT  REPLY IS 'CONT'                     59200002
         BNE   WRTMSG               NO, INVALID REPLY - REWRITE MESSAGE 59400002
         MVI   0(RW1),ZERO          CLEAR COMPLETION CODE               59600003
         B     EXCP                 RETRY INITIALIZATION                59800002
*                                                                       60000002
BYPASSIO OI    IOBINCAM,IOBOLTEP    SET OLTEP EXECUTING FLAGS IN IOB    60200002
SETERR   EQU   *                                             LD YA03239 60250000
         TM    DCBRDYI,RDYQBTM       USING RDYQ                @ZA06392 60280003
         BZ    SETERR1              NO FLAG IOB                @ZA06392 60310003
         TM    IOBSENS0,INTREQ        INTERVENTION REQUIRED    @ZA06392 60340003
         BO    NOSETERR             YES DON'T FLAG             @ZA06392 60370003
SETERR1  OI    IOBINCAM,INITERR     FLAG I/O ERROR AT OPEN     @ZA06392 60400003
NOSETERR TM    GCB(RUCB),OLTEP      OLTEP USING DVC            @ZA06392 60450003
         BO    DONORLSE                                         YA01229 60500002
RLSECORE LR    RPARM1,RW1           ADDRESS OF AREA TO BE FREED         60600002
         LA    RPARM2,WTOARLNG      LENGTH OF AREA                      60800002
         O     RPARM2,IOBPOOL       POOL NUMBER                         61000002
         FREEMAIN  R,LV=(0),A=(1)   FREE AREA                           61200002
DONORLSE EQU   *                                                YA01229 61250002
         XC    IOBECBPT(FOUR),IOBECBPT  CLEAR POINTER TO AREA           61400002
         MVI   IOBINCAM+1,ZERO                                          61600002
         LA    RDEB,FOUR(RDEB)      GET POINTER TO NEXT UCB ADDRESS     61800002
         BCT   RW3,INITLP           LOOP IF MORE TERMS TO INITIALIZE    62000002
         B     ENDLOAD              END-OF-LOAD CODE                    62200002
*                                                                       62400002
         USING IHADCB,RDCB                                       Y02947 62450002
RLN1     L     RPARM1,DCBDEBAD      GET ADDRESS OF DEB                  62600002
         ST    RPARM1,LINK(RUCB)    STORE IN LINK FIELD                 62800002
         LR    RGMUCB,RUCB       SAVE ADDRESS OF MASTER UCB    @ZA06392 63000003
         B     STRLN                STORE RLN                           63200002
*                                                                       63400002
*              END-OF-LOAD CODE                                         63600002
ENDLOAD  MODESET EXTKEY=DATAMGT     BACK TO DATA MGT KEY         Y02947 63700002
         MVC   WTGIDTTR(FIVE),LD3F3270   SET UP IDTTR FOR NEXT LOAD     63800002
         USING WORKAREA,RW1                                      Y02947 63850002
         L     RW1,WTGCORE-ONE                                          64000002
*                                                                       64200002
RELOOP   LA    RWTGC,WGOFF(RWTGC)   INCR CURRENT WTG REGISTER           64400002
         LA    RPARC,PLOFF(RPARC)   INCR CURRENT PARM LIST REG TO NEXT  64600002
*                                       ENTRY                           64800002
         CLC   WTGIDTTR(TWO),AMIDCNST  IF NEXT WTG ENTRY REQUIRES THIS  65000002
         BCR   EQ,RBASE             EXECUTOR, RETURN TO BEGINNING       65200002
         CLC   WTGIDTTR(TWO),OPIDCNST   IF NOT, TEST FOR END OF TABLE   65400002
         BNE   RELOOP               NOT END, CHECK NEXT ENTRY           65600002
*                                                                       65800002
         LR    RPARC,RPAR           REINITIALIZE CURRENT PARM REG       66000002
         LA    RWTGC,WAOFF(RWTG)    AND CURRENT WTG REG                 66200002
ZCHECK   CLI   WTGIDTTR,ZERO        IF FIRST BYTE OF CURRENT WTG ENTRY  66400002
         BNE   XCTLRTNE             NON-ZERO, GO TO TRANSFER CONTROL    66600002
         LA    RWTGC,WGOFF(RWTGC)   IF NOT, GET NEXT ENTRY              66800002
         LA    RPARC,PLOFF(RPARC)                                       67000002
         B     ZCHECK               AND CHECK IT                        67200002
*                                                                       67400002
*                                                                       67600002
XCTLRTNE EQU   *                                               @YA02128 67650002
         NI    WTGPATHS,ALLON-WTGSPMSG  TURN OFF BYPASS        @YA02128 67700002
         LA    RPARM3,DXCCW12           POINT TO DOUBLE WORD LIST       67800002
         MVC   WTGMODID(TWO),WTGIDTTR   MOVE ID TO NAME FIELD           68000002
         MVC   TENAND4(THREE,RWTG),TWO(RWTGC)  MOVE TTR TO WTG TABLE    68200002
         XCTL  DE=(RWTG),SF=(E,(15))                                    68400002
*                                                                       68600002
ABEND95  L     RPARM1,ERRCODE                                           68800002
         ABEND (1)                 INCOMPATIBLE DEVICES ON LINE GROUP   69000002
NOPWRT   DC    X'C3'                ERASE WRITE DATA STREAM - WCC ONLY  69200002
*                                     RESET KEYBOARD                    69400002
*                                     RESET MODIFIED DATA TAGS          69600002
OPIDCNST DC    C'0S'                ID OF LAST OPEN LOAD                69800002
AMIDCNST DC    C'4P'                ID OF THIS MODULE                   70000002
TIME     DC    F'50'               TIME INTERVAL OF .50 SEC             70200002
ERRCODE  DC    X'80095000'         ABEND CODE                           70400002
IOBPOOL  DC    X'FA000000'          SUBPOOL NUMBER FOR IOB'S            70600002
CONT     DC    C'CONT'             WTOR REPLY                           70800002
DROP     DC    C'DROP'                                         @YA02128 70850002
POST     DC    C'POST'                  COMPARANDS                      71000002
POOLNUM  DC    X'E6000000'          SUBPOOL FOR WTOR AREA               71200002
WRTCCW   DC    XL8'0500000020240001'  ERASE WRITE CCW SKELETON          71400002
*                                   COMMAND = ERASE WRITE               71600002
*                                   FLAGS = SLI                         71800002
*                                   TP OP CODE = OPEN WRITE             72000002
*                                   BYTE CNT = 1                        72200002
WTOBASE  WTOR  'IEC804A  000 CONTROL UNIT NOT OPERATIONAL. REPLY CONT O*72400002
               R POST',,4,,ROUTCDE=(1,8,10),DESC=2,MF=L                 72600002
WTOARLNG EQU   (*-WTOBASE+8+7)/8*8  LENGTH OF GETMAIN AREA FOR WTOR     72800002
WTODEV   WTOR  'IEC804A  000 DEVICE NOT OPERATIONAL. REPLY CONT, POST O*72850002
               R DROP',,4,,ROUTCDE=(1,8,10),DESC=2,MF=L        @YA02128 72900002
WTODVLNG EQU   (*-WTODEV+8+7)/8*8  LENGTH OF GETMAINED AREA    @YA02128 72950002
PTCHAREA DC    80XL1'00'       PATCH AREA                      @YA02128 72960002
NENT     EQU   1                    NUMBER OF IDTTR'S                   73000002
LENGTH   EQU   NENT*6+6             LENGHT OF IDTTR'S+2+4               73200002
NODBWDS  EQU   (LENGTH+7)/8         NO. OF DBL WDS WITH PADDING         73400002
ORGIDTTR EQU   2048-NODBWDS*8                                  @YA02128 73410002
         ORG   IGG0194P+ORGIDTTR                                        73460002
LD3F3270 DC    C'4Q'                ID FOR THIRD LOAD OF BTAM OPEN      74000002
*                                       FOR 3270                        74200002
         DC    X'00000000'          TTR AND L                           74400002
IDEND    DC    X'0000'              END OF IDTTRL TABLE                 74600002
         CNOP  4,8                  PADDING                             74800002
LOADID   DC    C'019'               OPEN SVC CODE                       75000002
         DC    YL1(X'80'-NODBWDS)  POINTER FOR IEHIOSUP                 75200002
*                                                                       75400002
         EJECT                                                          75410002
CVT      DSECT                                                          75420002
         CVT                                                            75430002
         EJECT                                                          75450002
         DCBD  DSORG=BX,DEVD=BS                                         75600002
         EJECT                                                          75650002
         IECTDEBX                                                       75800002
         EJECT                                                          75850002
         IECTIOBX                                                       76000002
         EJECT                                                          76010002
WORKAREA DSECT                                                   Y02947 76050002
         IECDSECT IOB=NO                                         Y02947 76100002
         EJECT                                                          76150002
         IECDSECS WTG,PREFX,EXPAND=YES                                  76160002
         END                                                            76200002
./  ADD  SSI=40800019,NAME=IGG0194Q
         TITLE 'IGG0194Q - BTAM OPEN LOAD 3 FOR LOCAL 3270'             00150002
IGG0194Q CSECT                                                          00200002
*                                                              @YA02128 00210002
*              FOLLOWING CHANGES APPLIED:                      @YA02128 00220002
* C158500                                                    LD YA03953 00232000
*                                                              @YA02128 00240002
*                                                                       00250002
* STATUS - CHANGE LEVEL 000                                             00300002
*                                                                       00350002
* FUNCTION/OPERATION - THIS ROUTINE IS BROUGHT INTO CORE AND EXECUTED   00400002
*    WHEN THE BTAM OPEN LOAD 2 FOR 3270 ISSUES 'XCTL' TO IGG0194Q.      00450002
*    THIS ROUTINE LOADS THE REQUIRED MODULES, STORES THE ID'S OF THE    00500002
*    MODULES AND A COUNT OF MODULES LOADED INTO THE DEB, SETS UP 3270   00550002
*    ATTENTION HANDLING AND SETS UP OLT IF REQUIRED.                    00600002
*                                                                       00650002
* ENTRY POINT - ENTRY IS TO THE FIRST BYTE OF THE MODULE AS A RESULT OF 00700002
*    AN XCTL TO IGG0194Q.                                               00750002
*                                                                       00800002
* INPUT - REGISTERS 5, 6, 7, AND 8 ARE THE INPUT                        00850002
*    5 - BEGINNING OF THE DCB PARAMETER LIST                            00900002
*    6 - BEGINNING OF THE WHERE-TO-GO TABLE                             00950002
*    7 - ADDRESS OF THE CURRENT ENTRY IN THE DCB PARAMETER LIST         01000002
*    8 - ADDRESS OF THE CURRENT ENTRY IN THE WHERE-TO-GO TABLE.         01050002
*                                                                       01100002
* OUTPUT - THE REGISTERS WILL BE POSITIONED TO THE NEXT UNFINISHED      01150002
*    ENTRY IN THE WHERE-TO-GO TABLE.  THE REQUIRED BTAM MODULES ARE     01200002
*    LOADED.  IRB'S AND IQE'S ARE BUILT AS REQUIRED.                    01250002
*                                                                       01300002
* EXTERNAL ROUTINES - ABEND (SVC 13)                                    01350002
*         CIRB (SVC 43)                                                 01400002
*         LOAD (SVC 8)                                                  01450002
*         XCTL (SVC 7)                                                  01500002
*                                                                       01550002
* EXITS, NORMAL - THIS ROUTINE NORMALLY TERMINATES BY LOCATING THE NEXT 01600002
*    NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE AND EXECUTING AN XCTL TO   01650002
*    THAT ROUTINE.                                                      01700002
*                                                                       01750002
* EXITS, ERROR - IF THE VECTOR TABLE IN THE READ/WRITE ROUTINE          01800002
*    (IGG019MA) IS FULL AND ANOTHER ENTRY IS REQUIRED, THE TASK IS      01850002
*    ABENDED WITH A SYSTEM CODE OF 097.                                 01900002
*                                                                       01950002
* TABLES/WORK AREAS - THE DCB PARAMETER LIST CONTAINS THE ADDRESS OF    02000002
*    EACH DCB SPECIFIED IN THE OPEN MACRO.  THE WHERE-TO-GO TABLE       02050002
*    CONTAINS THE ID AND TTR OF THE ROUTINE NEEDED TO PROCESS THE DCB   02100002
*    CORRESPONDING TO THIS ENTRY.  THE IDTTRL TABLE CONTAINS THE ID'S   02150002
*    REQUIRED TO LOAD THE REQUIRED BTAM MODULES.                        02200002
*                                                                       02250002
* ATTRIBUTES - THIS ROUTINE IS EXECUTED IN THE TRANSIENT AREA AS        02300002
*    ENABLED, PRIVELEDGED, AND REENTRANT.                               02350002
*                                                                       02400002
* NOTES - THIS ROUTINE COMPLETES THE OPEN PROCESSING FOR BTAM-SUPPORTED 02450002
*    3270'S.  THEREFORE, THE WHERE-TO-GO ENTRY WILL BE SET TO ZERO.     02500002
*                                                                       02550002
         EJECT                                                          02600002
*/*IGG0194Q: CHART */                                                   02650002
*/* HEADER                                                              02700002
*/*BTAM OPEN LOAD 3 FOR LOCAL 3270 DEVICES                          */  02750002
*/*IGG0194Q: E ENTRY FROM IGG0194P VIA XCTL */                          02800002
*/* M ESTABLISH BASES FOR DCB AND DEB DSECTS */                         02850002
*/* D (NO,,YES,GETIOB) BUFFER POOL PROVIDED BY USER? */                 02900002
*/* D (YES,,NO,GETIOB) ANY BUFFERS REQUESTED? */                        02950002
*/* D (NO,,YES,GETIOB) IS BUFFER LENGTH ZERO? */                        03000002
*/* P ROUND BUFFER LENGTH TO NEXT FULL WORD AND STORE LENGTH IN DCB */  03050002
*/* P COMPUTE TOTAL SIZE OF BUFFERS PLUS BUFFER CONTROL BLOCK */        03100002
*/* L GETMAIN FOR BUFFER POOL */                                        03150002
*/* P STORE ADDRESS OF BUFFER CONTROL BLOCK IN DCB */                   03200002
*/* P INITIALIZE THE BUFFER CONTROL BLOCK AND LINK BUFFERS TOGETHER */  03250002
*/*GETIOB: M OBTAIN ADDRESS OF DEB SUBID FIELD */                       03300002
*/* D (YES,,NO,TESTBPM) OLT'S REQUIRED? */                              03350002
*/* S LOADRTN: LOAD LOCAL 3270 OLT CONTROL RTN */                       03400002
*/* S BLDIRB: BUILD IRB AND IQE'S FOR OLT */                            03450002
*/* P STORE IRB ADDRESS IN IRB POINTER AREA */                          03500002
*/*TESTBPM: D (YES,,NO,LOADCEA) BUFFER MANAGEMENT REQUIRED? */          03550002
*/* S LOADRTN: LOAD BUFFER MANAGEMENT ROUTINE */                        03600002
*/* P STORE ADDRESS OF BUFFER MANAGEMENT ROUTINE IN DEB */              03650002
*/*LOADCEA: S LOADRTN: LOAD LOCAL 3270 CEA/XEA RTN */                   03700002
*/* P STORE ADDRESS OF CEA/XEA IN DEB CEA AND XEA VECTORS */            03750002
*/* S LOADRTN: LOAD BTAM READ/WRITE ROUTINE */                          03800002
*/* P STORE ADDRESS OF READ/WRITE ROUTINE IN DCB */                     03850002
*/* M LOCATE DDM VECTOR TABLE */                                        03900002
*/*RWVDLP: D (YES,,NO,VDLPINDX) VECTOR TABLE ENTRY = ZERO? */           03950002
*/*DDMIN: P STORE INDEX TO VECTOR IN DCB */                             04000002
*/* S LOADRTN: LOAD LOCAL 3270 DDM */                                   04050002
*/* P STORE ADDRESS AND DEVICE CODE IN VECTOR TABLE */                  04100002
*/*ENBLATN: S LOADRTN: LOAD 2ND LEVEL ATTN RTN */                       04150002
*/* S BLDIRB: BUILD IRB & 1 IQE FOR ATTN HANDLING */                    04200002
*/* P STORE IRB ADDRESS IN ALL UCB'S OF LINE GROUP */                   04250002
*/* D (YES,,NO,NORDYQ) READYQ SPECIFIED IN DCB ? */                     04260002
*/* D (YES,BLDRDYRB,NO,) USER PROVIDE ROUTINE ? */                      04270002
*/* S LOADRTN: LOAD BTAM'S READY EXIT ROUTINE */                        04280002
*/* P FLAG USING BTAM'S ROUTINE IN DCB */                               04290002
*/* P STORE ADDRESS OF ROUTINE IN DCB */                                04340002
*/*BLDRDYRB: D (YES,USEUSER,NO,) USER PROVIDE ROUTINE ? */              04390002
*/* S (,RDYIRBDN) BLDIRB: BUILD IRB AND IQE'S FOR BTAM READY */         04490002
*/*USEUSER: S BLDPIRB: BUILD IRB AND IQE'S FOR USER READY */            04540002
*/*RDYIRBDN: P SET GRAF FLAGS AND STORE IRB ADDRESS IN ALL UCB'S */     04590002
*/*ENDLOAD: P CHECK ALL UCB'S FOR READY DURING OPEN */                  04690002
*/*NORDYQ: P CLEAR WHERE-TO-GO ID TO INDICATE END OF OPEN */            04740002
*/* R GO TO STANDARD WHERE-TO-GO CODE */                                04790002
*/*VDLPINDX: D (NO,,YES,DDMIN) VECTOR FOR LOCAL 3270? */                04890002
*/* D (NO,,YES,VDOVRFLO) END OF TABLE ENTRY? */                         05040002
*/* M (,RWVDLP) INCR INDICES FOR NEXT ENTRY */                          05140002
*/*VDOVRFLO: R ABEND WITH SYSTEM 097 CODE */                            05240002
*/*LOADRTN: E ENTRY */                                                  05340002
*/* P CONSTRUCT BLDL LIST ENTRY IN OPEN WORK AREA FROM IDTTRL ENTRY */  05440002
*/* D (NO,,YES,THREERCD) RTN REQUESTED = READ/WRITE RTN? */             05492002
*/*COMPL: D (NO,,YES,LONGLOAD) RTN SIZE EXCEEDS 1024 BYTES? */          05498002
*/* P LENGTH OF FIRST TEXT RCD = SIZE OF ROUTINE */                     05498802
*/*LOAD: L LOAD RTN FROM SYS1.SVCLIB */                                 05499602
*/* P STORE ID IN CURRENT DEB SUBID ENTRY */                            05499802
*/* M INCREMENT POINTER TO NEXT DEB SUBID ENTRY */                      05516602
*/* R RETURN */                                                         05528602
*/*THREERCD: P ADD X'800' TO RTN LENGTH DERIVED FROM IDTTRL*/           05533002
*/*LONGLOAD: P LENGTH OF FIRST TEXT RECORD = 1024 BYTES */              05533202
*/* P (,LOAD) MODIFY LOAD ATTRIBUTES FOR MULTIPLE TEXT RECORDS */       05540802
*/*BLDIRB: E ENTRY */                                                   05543202
*/* P COMPUTE LENGTH OF IRB WORKAREA */                                 05544002
*/* L INVOKE CIRB TO BUILD IRB */                                       05544102
*/*IQEINIT: P INITIALIZE IQE'S AND LINK THEM TOGETHER */                05544202
*/* P SET LINK OF LAST IQE = ZERO */                                    05544302
*/* R RETURN */                                                         05558202
*/*BLDPIRB: E ENTRY */                                                  05568202
*/* P COMPUTE LENGTH OF IRB WORKAREA */                                 05570202
*/* L (,IQEINIT) INVOKE CIRB TO BUILD PROB PROG IRB */                  05570602
*/*IGG0194Q: END */                                                     05571002
         EJECT                                                          05572202
*              REGISTER EQUATES                                         05586102
RPARM2   EQU   0                   SECOND PARAMETER REGISTER            05600002
RPARM1   EQU   1                   FIRST PARAMETER REGISTER             05650002
REVN     EQU   2                   WORK REGISTER- EVEN                  05700002
RODD     EQU   3                   WORK REGISTER- ODD                   05750002
RCORE    EQU   4                   POINTER TO GETMAIN'ED CORE           05800002
RPAR     EQU   5                   START OF PARAMETER LIST              05850002
RWTG     EQU   6                   START OF WTG TABLE                   05900002
RPARC    EQU   7                   CURRENT ENTRY IN PARAMETER LIST      05950002
RWTGC    EQU   8                   CURRENT ENTRY IN WTG TABLE           06000002
RUCB     EQU   9                   POINTER TO UCB                       06050002
RDEB     EQU   10                  POINTER TO DEB                       06100002
RBASE    EQU   11                  BASE REGISTER FOR CSECT              06150002
RDCB     EQU   12                  POINTER TO DCB                       06200002
RW3      EQU   13                  WORK REGISTER                        06250002
RRTRN    EQU   14                  RETURN POINT REGISTER                06300002
RRTN     EQU   14                                                       06350002
REPR     EQU   15                  ENTRY POINT REG                      06400002
*                                                                       06450002
RW1      EQU   2                   ALTERNATE ASSIGNMENTS                06500002
RW2      EQU   3                       FOR WORK REGISTERS               06550002
RSUBID   EQU   9                   POINTER TO NEXT DEB SUB-ID FIELD     06600002
*                                                                       06650002
ANRDEVTP EQU   X'FE'               DCBDEVTP CODE FOR 3270               06700002
CVTAD    EQU   16                                                       06750002
DEBAVT   EQU   28                  DISP TO VECTOR TO DEB APPENDAGE TAB  06800002
EQ       EQU   8                   CC MASK = 8                          06850002
EIGHT    EQU   X'08'                                                    06900002
FIVE     EQU   5                                                        06950002
ONE28    EQU   128                                                      07000002
FOUR     EQU   4                                                        07050002
FREEPOOL EQU   X'04'                FLAG TO CLOSE TO RELEASE BUFFERS    07100002
GRAF     EQU   28                  OFFSET TO GRAPHICS STATUS   @YA02128 07110002
IQEIRB   EQU   8                   DISP TO IRB ADDR FIELD IN IQE        07150002
IQELNGTH EQU   16                  LENGTH OF AN IQE IN BYTES            07200002
IQELNK   EQU   0                   DISP TO LINK FIELD IN IQE            07250002
IQETCB   EQU   12                  DISP TO TCB ADDR FIELD IN IQE        07300002
IRBAD    EQU   28                  DISP TO IRB ADDR IN UCB EXTENSION    07350002
LOADATB  EQU   X'CB'               STANDARD LOAD ATTRIBUTES             07400002
*    REENTERABLE, ONLY LOADABLE, EXECUTABLE, ONLY ONE TEXT RECORD, NO   07450002
*    RLD RECORD, ORIGIN IS ZERO, ENTRY IS ZEROS EERO, AND CANNOT BE     07500002
*    REPROCESSED BY THE LINKAGE EDITOR.                                 07550002
LOADATB1 EQU   X'CA'               LOAD ATTRIBUTES FOR MODULES          07600002
*    LARGER THAN 1024 BYTES - SAME AS LOADATB BUT MORE THAN ONE         07650002
*    TEXT RECORD.                                                       07700002
NDVTRTBL EQU   X'FF'               END OF VECTOR TABLE CODE             07750002
OLT      EQU   X'10'               DCB OLT FLAG                         07800002
ONE      EQU   1                                                        07850002
PLOFF    EQU   4                   OFFSET IN PARM LIST                  07900002
RBNEXAV  EQU   96                  DISP TO IQE POINTER IN IRB           07950002
RDYOFF   EQU   X'EF'               TURN OFF READY IN OPEN FLG  @YA02128 07960002
RDYQ     EQU   32                  UCB OFFSET TO READY IRB AD  @YA02128 07970002
SEVEN    EQU   7                                                        08000002
SIX      EQU   6                                                        08050002
SVCDCB   EQU   84                  DISP TO DCB FOR SYS1.SVCLIB IN CVT   08100002
TENAND4  EQU   14                                                       08150002
THREE    EQU   3                                                        08200002
TWENTY2  EQU   22                                                       08250002
TWENTY4  EQU   24                                                       08300002
TWENTY5  EQU   25                                                       08350002
TWENTY6  EQU   26                                                       08400002
TWENTY7  EQU   27                                                       08450002
TWO      EQU   2                                                        08500002
VDOFFSET EQU   12                  DISP TO VECTOR TABLE IN READ/WRITE   08550002
*                                      RTN                              08600002
WAOFF    EQU   32                  OFFSET OF FIRST WTG ENTRY FROM       08650002
*                                      BEGINNING OF TABLE               08700002
WGOFF    EQU   8                   OFFSET IN WTG TABLE                  08750002
ZERO     EQU   0                                                        08800002
*                                                                       08950002
*                                                                       09000002
         USING IHADCB,RDCB                                              09050002
         USING IECTDEB,RDEB                                             09100002
         USING WTG,RWTG                                          Y02947 09150002
         USING WTGENTRY,RWTGC                                           09160002
         BALR  RBASE,0             ESTABLISH ADDRESSABILITY FOR CSECT   09200002
         USING *,RBASE                                                  09250002
         B     CONTIN                  BRANCH AROUND ID        @YA02128 09260002
         DC    CL8'IGG0194Q'           NAME                    @YA02128 09270002
         DC    XL2'4072'                 AND DATE                       09280000
PATCH    DC    15F'0'                  PATCH AREA            LD YA03953 09282000
CONTIN   DS    0H                                              @YA02128 09290002
         L     RDCB,0(RPARC)       ADDRESSABILITY FOR DCB               09300002
         L     RDEB,DCBDEBAD       GET DEB ADDRESS                      09350002
         L     RDEB,DEBAVT(RDEB)   GET START OF APPENDAGE VECTOR TABLE  09400002
*                                                                       09450002
*                                                                       09500002
*              DETERMINE IF A BUFFER POOL MUST BE OBTAINED              09550002
         CLI   DCBBUFCB+3,ONE      BUFFER POOL PROVIDED BY USER         09600002
         BNE   GETIOB               YES, GO GET IOB'S                   09650002
         CLI   DCBBUFNO,ZERO        NO. ARE ANY BUFFERS REQUESTED       09700002
         BE    GETIOB               NO, BUFFER POOL NOT REQUIRED.       09750002
*                                   GO GET IOB'S                        09800002
         CLC   DCBBUFL(TWO),ZEROS  BUFFER LENGTH EQUAL TO ZERO          09850002
         BE    GETIOB               YES, GO GET IOB'S                   09900002
*                                                                       09950002
*              CONSTRUCT BUFFER POOL                                    10000002
         SR    RW1,RW1                                                  10050002
         IC    RW1,DCBBUFNO         GET NUMBER OF BUFFERS               10100002
         LH    RW2,DCBBUFL          GET BUFFER LENGTH                   10150002
         LA    RW2,THREE(RW2)       ROUND TO                            10200002
         SRL   RW2,TWO                  NEXT HIGHEST                    10250002
         SLL   RW2,TWO                      FULL WORD                   10300002
         STH   RW2,DCBBUFL          STORE ROUNDED LENGTH IN DCB         10350002
         LR    RPARM1,RW1                                               10400002
         MR    RPARM2,RW2           COMPUTE SIZE OF BUFFER AREA         10450002
         LA    RPARM2,EIGHT(RPARM1) ADD 8 FOR BUFFER CONTROL BLOCK      10500002
         O     RPARM2,IOBPOOL       PLACE SUBPOOL NUMBER IN             10550002
*                                   HIGH-ORDER BYTE OF PARM REG         10600002
         L     RW3,WTGCORE-ONE      ADDR OF OPEN WORK AREA       Y02947 10650002
         USING FORCORE,RW3                                       Y02947 10700002
         MODESET KEYADDR=DXUKEY,WORKREG=14    ASSUME USER KEY    Y02947 10750002
         GETMAIN  R,LV=(0)          GET CORE FOR BUFFER POOL            10800002
         LR    RRTN,RPARM1         SAVE ADDR OF GETMAIN'ED AREA  Y02947 10850002
         STH   RW1,FOUR(RPARM1)    STORE NO. OF BUFFERS IN BUFCB        10900002
         STH   RW2,SIX(RPARM1)     STORE SIZE OF BUFFERS IN BUFCB       10950002
*              BUILD BUFFER CHAIN                                       11000002
         LR    RCORE,RPARM1                                             11050002
         LA    RPARM1,EIGHT(RPARM1) GET ADDRESS OF FIRST BUFFER         11100002
         ST    RPARM1,0(RCORE)      STORE ADDRESS OF FIRST BUFFER       11150002
*                                       IN BUFFER CONTROL BLOCK         11200002
TESTBUFC BCT   RW1,NEXTBUF          IF MORE BUFFERS, BRANCH             11250002
         ST    RW1,0(RPARM1)        ZERO LAST LINK FIELD                11300002
         MODESET EXTKEY=DATAMGT    GO BACK TO DATA MGT KEY       Y02947 11350002
         OI    DCBMACRF,FREEPOOL    TELL CLOSE TO FREE BUFFER POOL      11400002
         B     GETIOB               GO GET THE IOB'S                    11450002
*                                                                       11500002
NEXTBUF  LR    RCORE,RPARM1         SAVE ADDRESS OF CURRENT BUFFER      11550002
         ALR   RPARM1,RW2           COMPUTE ADDRESS OF NEXT BUFFER      11600002
         ST    RPARM1,0(RCORE)      STORE ADDRESS OF NEXT BUFFER IN     11650002
*                                       LINK FIELD OF CURRENT BUFFER    11700002
         B     TESTBUFC            LOOP TO PROCESS NEXT BUFFER          11750002
*                                                                       11800002
GETIOB   EQU   *                                                        11850002
         STCM  RRTN,SEVEN,DCBBUFCA STORE BUFFCB ADDRESS          Y02947 11900002
         SR    RSUBID,RSUBID                                            11950002
         IC    RSUBID,DEBNMEXT     GET NO. OF DEVICES IN THE LINE GROUP 12000002
         SLL   RSUBID,TWO          MULT BY 4 TO GET LENGTH OF UCB LIST  12050002
         LA    RSUBID,DEBUCBAD(RSUBID)  GET ADDRESS OF AM AREA          12100002
         IC REVN,DCBOFLGS          SAVE DCB OPEN FLAGS                  12150002
         ST    RSUBID,DCBREAD      SAVE ADDRESS OF ACCESS METHOD AREA   12200002
         STC   REVN,DCBOFLGS       RESTORE DCB OPEN FLAGS               12250002
*                                                                       12300002
         SR    REVN,REVN                                                12350002
         IC    REVN,DEBAMLNG       GET LENGTH OF ACCESS METHOD AREA     12400002
         AR    RSUBID,REVN         ADD TO GET ADDRESS OF SUB-ID'S       12450002
*                                                                       12500002
         TM    DCBERROP,OLT        ON-LINE TESTS REQUIRED               12550002
         BNO   TESTBPM             NO, TEST FOR BUFFER MANAGEMENT RTN   12600002
         L     RCORE,DEBIRBAD-1    GET ADDRESS OF DEB IRB POINTERS      12650002
         LA    RPARM1,OLTCTL       GET ADDRESS OF IDTTRL ENTRY          12700002
         BAL   RRTRN,LOADRTN       LOAD OLT CTL MODULE                  12750002
         SR    RPARM1,RPARM1                                            12800002
         IC    RPARM1,DEBNMEXT     NO. OF IQE'S = NO. OF DEVICES        12850002
         SLA   RPARM1,ONE               & MULTIPLY BY 2                 12900002
*                                  BECAUSE EXISTING BTAM EXPECTS IT     12950002
         BAL   RRTRN,BLDIRB        BUILD IRB AND IQE'S FOR OLT          13000002
         ST    RPARM1,0(RCORE)     STORE IRB ADDRESS IN POINTER         13050002
         B     CONTINUE                                       LD Y02947 13060002
*                                                                       13100002
TESTBPM  EQU   *                                              LD Y02947 13110002
         MODESET EXTKEY=ZERO                                  LD Y02947 13120002
CONTINUE EQU   *                                              LD Y02947 13130002
         CLI   DEBAMLNG,ZERO       BUFFER MANAGEMENT REQUIRED           13150002
         BZ    LOADCEA             NO, GO LOAD CEA/XEA                  13200002
         LA    RPARM1,BPMR         GET ADDRESS OF IDTTRL ENTRY          13250002
         BAL   RRTN,LOADRTN        LOAD BUFFER POOL MANAGEMENT ROUTINE  13300002
         L     REVN,DCBREAD        GET ADDRESS OF AM SECTION IN DEB     13350002
         ST    RPARM2,0(REVN)      STORE ADDR OF ROUTINE IN DEB         13400002
*                                                                       13450002
LOADCEA  LA    RPARM1,CHENDAPP     GET ADDRESS OF IDTTRL ENTRY          13500002
         BAL   RRTN,LOADRTN        LOAD CEA/XEA                         13550002
         ST    RPARM2,DEBCEA       STORE RTN ADDR IN DEB VECTOR TO CEA  13600002
         ST    RPARM2,DEBXCEA          AND XEA                          13650002
*                                                                       13700002
         LA    RPARM1,SIOAPPN          ADDR OF SIO APPENDAGE TTR        13750002
         BAL   RRTN,LOADRTN            LOAD SIO APPENDAGE               13800002
         ST    RPARM2,DEBSIOA          STORE ADDRESS IN DEB PREFIX      13850002
         OI    DEBSIOA,SIOFIX      FLAG PAGE FIX APP IN SIO       3876  13900002
*                                                                       13950002
         LA    RPARM1,RDWRTRTN     GET ADDRESS OF IDTTRL ENTRY          14000002
         BAL   RRTN,LOADRTN        LOAD READ/WRITE ROUTINE              14050002
         IC    REVN,DCBOFLGS       SAVE DCBOFLAGS                       14100002
         ST    RPARM2,DCBREAD      STORE ADDRESS OF READ/WRITE RTN      14150002
         STC   REVN,DCBOFLGS       RESTORE OPEN FLAGS DESTROYED BY      14200002
*                                      PREVIOUS STORE.                  14250002
*                                                                       14300002
         LR    RCORE,RPARM2        GET ADDR OF READ/WRITE RTN           14350002
         LA    RCORE,VDOFFSET(RCORE)    GET BEGINNING OF VECTOR TABLE   14400002
         SR    REVN,REVN           INITIALIZE INDEX COUNTER             14450002
         SR    RODD,RODD           INITIALIZE COMPARAND OF ZERO         14500002
*                                                                       14550002
RWVDLP   C     RODD,0(RCORE)       VECTOR TABLE ENTRY EQUAL ZERO        14600002
         BNZ   VDLPINDX            BRANCH IF FIELD NON-ZERO             14650002
         MVI   TWO(RCORE),ANRDEVTP MAKE FIELD NON-ZERO                  14700002
DDMIN    STC   REVN,DCBDEVTP       STORE INDEX TO VECTOR IN DCB         14750002
         LA    RPARM1,DDM          GET ADDRESS OF IDTTRL ENTRY          14800002
         BAL   RRTN,LOADRTN        LOAD 3270 LOCAL DDM                  14850002
         ST    RPARM2,0(RCORE)     STORE ADDRESS IN VECTOR TABLE        14900002
         MVI   0(RCORE),ANRDEVTP   STORE DEVICE TYPE CODE IN HIGH-ORDER 14950002
         MODESET EXTKEY=DATAMGT    DATAMGT KEY                LD Y02947 15000002
*                                      BYTE                             15050002
         B     ENBLATN             BRANCH TO LOAD 2ND LEVEL ATTN RTN    15100002
*                                                                       15150002
VDLPINDX CLI   0(RCORE),ANRDEVTP   VECTOR FOR ANR                       15200002
         BE    DDMIN               YES, USE IT                          15250002
         CLI   0(RCORE),NDVTRTBL   END OF TABLE                         15300002
         BE    VDOVRFLO            YES, GIVE ABEND                      15350002
         LA    RCORE,FOUR(RCORE)   INCR TO NEXT ENTRY                   15400002
         LA    REVN,ONE(REVN)      BUMP INDEX                           15450002
         B     RWVDLP              CHECK NEXT ENTRY                     15500002
*                                                                       15550002
VDOVRFLO L     RPARM1,ERR6         VECTOR DIRECTORY OVERFLOW ERROR      15600002
         ABEND (1)                                                      15650002
*                                                                       15700002
ENBLATN  LA    RPARM1,ATNRTN2      GET IDTTRL ENTRY                     15750002
         BAL   RRTN,LOADRTN        LOAD SECOND LEVEL ATTN RTN           15800002
         LA    RPARM1,TWO          NO. OF IQE'S = TWO        LD YA03953 15850000
         BAL   RRTN,BLDIRB         BUILD IRB AND IQE FOR ATTENTION      15900002
*                                  HANDLING                             15950002
         LR    RW3,RSUBID          SAVE SUB ID PTR             @YA02128 15960002
         SR    REVN,REVN           INITIALIZE UCB LIST INDEX            16000002
         SR    RODD,RODD                                                16050002
         IC    RODD,DEBNMEXT       INITIALIZE LOOP COUNTER              16100002
         MODESET EXTKEY=ZERO       NEED KEY 0 TO STORE IN UCB    Y02947 16150002
ATNIRBLP L     RUCB,DEBUCBAD(REVN) GET UCB ADDRESS                      16200002
         LA    RPARM1,0(RPARM1)    INSURE HIGH BYTE CLEAR      @YA02128 16210002
         IC    RPARM2,IRBAD(RUCB)  PICK UP GRAF FLAGS          @YA02128 16220002
         SLL   RPARM2,TWENTY4      PUT IN HIGH BYTE            @YA02128 16230002
         OR    RPARM1,RPARM2       SAVE GRAF FLAGS             @YA02128 16240002
         ST    RPARM1,IRBAD(RUCB)  STORE IRB ADDR IN UCB EXTENSION      16250002
         LA    REVN,FOUR(REVN)     INDEX TO NEXT UCB ADDRESS            16300002
         BCT   RODD,ATNIRBLP       LOOP IF NOT FINISHED                 16350002
         L     RDCB,ZERO(RPARC)        POINT TO DCB                     17700002
         MODESET EXTKEY=DATAMGT                                         17750002
         TM    DCBLERB,X'02'       ADDRESS VIA READYQ ?        @YA02128 17760002
         BNO   NORDYQ              NO, DON'T SETUP IRB         @YA02128 17770002
         L     REVN,52(RDCB)       PICK POINTER TO USER        @YA02128 17780002
*                                  SUPPLIED READY ROUTINE      @YA02128 17790002
         LA    REVN,0(REVN)        CLEAR HIGH BYTE             @YA02128 17792002
         LTR   REVN,REVN           ADDRESS SUPPLIED ?          @YA02128 17794002
         BNZ   BLDRDYRB            YES, USE IT                 @YA02128 17796002
         LR    RSUBID,RW3          RESTORE SUB ID PTR          @YA02128 17798002
         OI    DCBLERB,X'01'       FLAG USING BTAM'S           @YA02128 17798402
         LA    RPARM1,READYM       POINT TO IDTTRL             @YA02128 17798802
         BAL   RRTN,LOADRTN        LOAD READYQ - IGG019UP      @YA02128 17799202
         LR    REVN,RPARM2         GET ENTRY POINT             @YA02128 17799602
         LA    REVN,0(REVN)        CLEAR HIGH BYTE             @YA02128 17799702
         O     REVN,DCBLERB        PICK UP FLAGS               @YA02128 17799802
         ST    REVN,DCBLERB        SAVE THE ADDRESS            @YA02128 17799902
         LA    REVN,0(REVN)        CLEAR HIGH BYTE             @YA02128 17816602
BLDRDYRB EQU   *                   BUILD THE IRB               @YA02128 17826602
         LR    RPARM2,REVN         SET EP ADDRESS              @YA02128 17828602
         SR    RPARM1,RPARM1       CLEAR IQE COUNT REG         @YA02128 17830602
         IC    RPARM1,DEBNMEXT     GET NUMB IQE'S - ONE / UCB  @YA02128 17832602
         TM    DCBLERB,X'01'       USING BTAM'S ?              @YA02128 17833002
         BNO   USEUSER             NO, BUILD PP IRB            @YA02128 17833102
         BAL   RRTN,BLDIRB         BUILD A SUPR IRB            @YA02128 17833202
         MODESET EXTKEY=DATAMGT                              LD YA02128 17835202
         B     RDYIRBDN            GO SET UP UCB'S             @YA02128 17838802
USEUSER  EQU   *                   BUILD USER IRB              @YA02128 17840802
         BAL   RRTN,BLDPIRB        GO BUILD THE READY QUEUE    @YA02128 17842802
         MODESET EXTKEY=DATAMGT                              LD YA02128 17842902
RDYIRBDN EQU   *                   IRB IS BUILT                @YA02128 17843202
         SR    REVN,REVN           CLEAR A WORK REGISTER       @YA02128 17843602
         SR    RODD,RODD           CLEAR A WORK REGISTER       @YA02128 17844002
         IC    RODD,DEBNMEXT       INITIALIZE LOOP COUNTER     @YA02128 17844102
RDYIRBLP L     RUCB,DEBUCBAD(REVN) GET UCB ADDRESS             @YA02128 17844202
         MODESET EXTKEY=ZERO                                 LD YA02128 17846102
         ST    RPARM1,RDYQ(RUCB)   STORE IRB ADDRESS IN UCB    @YA02128 17850002
         TM    DCBLERB,X'01'       USING BTAM'S ?              @YA02128 17858202
         BZ    SETUSER             NO, FLAG USER               @YA02128 17868202
         OI    GRAF(RUCB),X'10'    SAY BTAM                    @YA02128 17870202
         B     TYPESET             CONTINUE                    @YA02128 17870602
SETUSER  EQU   *                   INDICATE USER ROUTINE       @YA02128 17871002
         OI    GRAF(RUCB),X'08'    SAY USER                    @YA02128 17871402
TYPESET  EQU   *                   TYPE OF ROUTINE FLAGGED     @YA02128 17871802
         MODESET EXTKEY=DATAMGT                              LD YA02128 17873202
         LA    REVN,FOUR(REVN)     INDEX TO NEXT UCB ADDRESS   @YA02128 17877602
         BCT   RODD,RDYIRBLP       LOOP IF NOT FINISHED        @YA02128 17879002
ENDLOAD  EQU   *                   BTAM OPEN DONE              @YA02128 17880402
         SR    RODD,RODD           CLEAR A WORK REGISTER       @YA02128 17881802
         SR    REVN,REVN           CLEAR A WORK REGISTER       @YA02128 17883202
         IC    RODD,DEBNMEXT       INITIALIZE LOOP COUNTER     @YA02128 17884602
CHKOPRDY EQU   *                   CHECK FOR READY DURING OPEN @YA02128 17886002
         L     RUCB,DEBUCBAD(REVN) GET UCB ADDRESS             @YA02128 17887402
         MODESET EXTKEY=ZERO                                 LD YA02128 17888402
         NI    GRAF(RUCB),X'7F'    TURN OPEN IN PROGRESS       @YA02128 17888802
         TM    GRAF(RUCB),X'40'    READY DURING OPEN ?         @YA02128 17890202
         BNO   SCHEDRET            NO, CONTINUE                @YA02128 17891602
         NI    GRAF(RUCB),X'BF'    TURN OFF OPEN READY         @YA02128 17893002
         SR    RDCB,RDCB           CLEAR EVEN REG              @YA02128 17894402
         LA    RW3,X'58'           PICK UP IOB LENGTH          @YA02128 17895802
         IC    RDCB,36(RUCB)       GET RLN FOR DEVICE          @YA02128 17897202
         MR    RDCB,RDCB           DISP INTO IOB POOL          @YA02128 17898602
         MODESET EXTKEY=DATAMGT                              LD YA02128 17899002
         L     RDCB,0(RPARC)       GET DCB ADDRESS             @YA02128 17900002
         L     RDCB,28(RDCB)       GET ADDRESS OF IOB POOL     @YA02128 17902502
         LA    RDCB,0(RW3,RDCB)    POINT TO THIS RLN'S IOB     @YA02128 17912502
         USING FORCORE,RW3          WORKAREA ADDRESSABILITY  LD YA02128 17912902
         L     RW3,WTGCORE-ONE      WORKAREA ADDRESS         LD YA02128 17913302
         MODESET KEYADDR=DXUKEY,WORKREG=13                   LD YA02128 17913702
         DROP  RW3                                                      17914102
         NI    28(RDCB),X'7F'      TURN OFF OPEN FAILED        @YA02128 17914502
         MODESET EXTKEY=DATAMGT                              LD YA02128 17916502
         L     RDCB,0(RPARC)       RESTORE DCB ADDRESS         @YA02128 17918402
SCHEDRET LA    REVN,FOUR(REVN)     INDEX TO NEXT UCB           @YA02128 17920402
         MODESET EXTKEY=DATAMGT                              LD YA02128 17920802
         BCT   RODD,CHKOPRDY       LOOP IF NOT FINISHED        @YA02128 17922402
NORDYQ   EQU   *                   THIS LOAD FINISHED          @YA02128 17926302
         XC    0(TWO,RWTGC),0(RWTGC) CLEAR ID TO INDICATE DONE @YA02128 17928302
         L     RCORE,4(RWTGC)      WORKAREA ADDRESS           LD Y02947 17930402
         L     REPR,WTGPREFX                                     Y02947 17934302
         STM   RRTN,RDCB,IECREGSV-IECPREFX(REPR) SAVE REGS       Y02947 17938202
         IECRES INIT,DCBCOPY=FRWKAR  REFRESH USER'S DCB FROM 'COPY'     17950002
         LR    REPR,RWTG            REG SAVEAREA ADDR            YM5668 17960002
         LM    RRTN,RDCB,IECREGSV-IECPREFX(REPR)  RESTORE REGS   Y02947 18000002
         XC    0(TWO,RWTGC),0(RWTGC)  CLEAR ID TO INDICATE COMPLETION   18050002
         L     REPR,FOUR(RWTGC)    GET ADDR OF  WORK AREA        Y02947 18100002
         USING FORCORE,REPR                                             18110002
*                                                                       18150002
RELOOP   LA    RWTGC,WGOFF(RWTGC)  INCR CURRENT WTG REGISTER            18200002
         LA    RPARC,PLOFF(RPARC)  INCR CURRENT PARM LIST REGISTER      18250002
         CLC   0(TWO,RWTGC),AMIDCNST   IF THE NEXT WTG ENTRY REQUIRES   18300002
         BCR   EQ,RBASE            THIS EXECUTOR, EXEC MODULE AGAIN     18350002
         CLC   0(TWO,RWTGC),OPIDCNST   END OF TABLE                     18400002
         BNE   RELOOP              NO, CHECK NEXT ENTRY IN TABLE        18450002
*                                                                       18500002
         LR    RPARC,RPAR          REINITIALIZE CURRENT PARM LIST REG   18550002
         LA    RWTGC,WAOFF(RWTG)       AND WTG REGISTER                 18600002
*                                                                       18650002
ZCHECK   CLI   0(RWTGC),ZERO       IF ENTRY NON-ZERO,                   18700002
         BNE   XCTLRTNE                GO TO TRANSFER CONTROL           18750002
         LA    RWTGC,WGOFF(RWTGC)  IF ZERO, GET NEXT ENTRY              18800002
         LA    RPARC,PLOFF(RPARC)                                       18850002
         B     ZCHECK                  AND CHECK IT                     18900002
*                                                                       18950002
XCTLRTNE EQU   *                                                        18960002
         LA    REPR,DXCCW12            POINT TO DOUBLE WORD LIST        19000002
         DROP  REPR                                                     19010002
         MVC   SIX(TWO,RWTG),0(RWTGC)  MOVE ID TO NAME FIELD            19050002
         MVC   TENAND4(THREE,RWTG),TWO(RWTGC)  MOVE TTR TO WTG FIELD    19100002
         MVC   TWENTY2(SEVEN,RWTG),CONATB  RESTORE XCTL ATTRIBUTES      19150002
*                                  & LENGTH                             19200002
         XCTL  DE=(RWTG),SF=(E,(15))                                    19250002
*                                                                       19300002
*                                                                       19350002
*        THIS SUBROUTINE IS USED TO LOAD ROUTINES FOR OPEN              19400002
*  INPUT - REGISTER 1 - ADDR OF IDTTRL ENTRY OF MODULE TO BE LOADED     19450002
*  OUTPUT - REGISTER 0 - ADDR OF THE LOADED ROUTINE                     19500002
*  RETURN ADDR IN REGISTER 14                                           19550002
LOADRTN  MVI   TWENTY2(RWTG),LOADATB  SET STANDARD LOAD ATTRIBUTES      19600002
         MVC   SIX(TWO,RWTG),0(RPARM1)  MOVE ID TO LAST 2 BYTES OF      19650002
*                                  NAME                                 19700002
         MVC   TENAND4(THREE,RWTG),TWO(RPARM1)  MOVE TTR FROM TABLE     19750002
         SR    REVN,REVN                                                19800002
         IC    REVN,FIVE(RPARM1)   GET LENGTH IN DOUBLE WORDS           19850002
         SLL   REVN,3                  AND CONVERT TO BYTES             19900002
         ST    REVN,TWENTY4(RWTG)  STORE LENGTH IN PARM LIST            19950002
         MVC   TWENTY5(TWO,RWTG),TWENTY6(RWTG)  MOVE LENGTH             20000002
         CLC   0(TWO,RPARM1),RDWRTRTN  MOD REQUESTED = READ/WRITE RTN   20050002
         BE    THREERCD            YES, ADJUST LENGTH TO THREE RECORDS  20100002
*                                      TOTAL LENGTH OF MODULE           20150002
CMPL     CLI   FIVE(RPARM1),ONE28  IF MOD MORE THAN 128 DOUBLE WORDS    20200002
         BH    LONGLOAD                (1024 BYTES)  LONG, GO TO        20250002
*                                       SET UP LONG LOAD                20300002
         MVC   TWENTY7(TWO,RWTG),TWENTY5(RWTG)  MOVE LENGTH TO FIELD    20350002
*                                       WHICH INDICATES LENGTH OF       20400002
*                                       FIRST TEXT RECORD               20450002
LOAD     LR    RPARM2,RWTG         POINT TO PARAMETER LIST              20500002
         L     RPARM1,CVTAD        GET ADDRESS OF CVT                   20550002
         L     RPARM1,SVCDCB(RPARM1)   GET ADDR OF DCB FOR SYS1.SVCLIB  20600002
         LR    RODD,RRTN           SAVE RETURN ADDRESS                  20650002
         CLC   SIX(TWO,RWTG),RDWRTRTN  R/W MODULE                YM4057 20660002
         BE    LOADSVC             LOAD R/W ROUTINE FROM SVCLIB  YM4057 20670002
         CLC   SIX(TWO,RWTG),BPMR  BUFF.MNGMT RTN             LD YM5661 20680002
         BE    LOADSVC2            LOAD RTN FROM SVCLIB       LD YM5661 20690002
         LOAD  DE=(0),DCB=(1)                                           20700002
MOVEID   EQU   *                                                 YM4057 20710002
         MVC   0(TWO,RSUBID),SIX(RWTG)  MOVE ID TO DEB                  20750002
         LA    RSUBID,TWO(RSUBID)  INCR TO NEXT SUB-ID IN DEB           20800002
         SR    REVN,REVN                                                20850002
         IC    REVN,DEBNMSUB       GET NO. OF SUBROUTINES LOADED        20900002
         LA    REVN,ONE(REVN)      ADD ONE                              20950002
         STC   REVN,DEBNMSUB       STORE UPDATED COUNT IN DEB           21000002
PAGEFIXR EQU   *                   AOS PAGE FIX FOR APPENDS       3876  21050002
         LR    REVN,RPARM2         TEMP SAVE EP ADDRESS           3876  21100002
         SLL   RPARM1,3            SUBP OUT AND CONV TO BYTES     3876  21150002
         LA    RPARM1,PAGESIZE(RPARM1,REVN) BUMP BY PAGE SIZE     3876  21200002
         N     RPARM2,PAGEBDRY     PUT ON PAGE BOUNDRY            3876  21250002
         SLR   RPARM1,RPARM2       REMOVE EXTRA BYTES             3876  21300002
         SRL   RPARM1,PAGESHFT     GET NUMBER OF PAGES            3876  21350002
         SLL   RPARM1,24           GET SET FOR OR INTO ADDRESS    3876  21400002
         LR    RPARM2,REVN         RESTORE ADDRESS                3876  21450002
         OR    RPARM2,RPARM1       PUT FIX COUNT IN               3876  21500002
         BR    RODD                RETURN TO NSI                        21550002
LOADSVC  LOAD  EPLOC=IGG019MA,DCB=(1)                            YM4057 21560002
         B     MOVEID              MOVE R/W ID                   YM4057 21570002
LOADSVC2 EQU   *                                              LD YM5661 21580002
         LOAD  EPLOC=IGG019MS,DCB=(1)                         LD YM5661 21590002
         B     MOVEID              MOVE BUFF.MNGMT ID         LD YM5661 21592002
         DS    0F                                                Y02947 21600002
PAGEBDRY DC    X'00FFF000'         AOS2 PAGE BOUNDRY MASK         3876  21650002
IGG019MA DC    C'IGG019MA'         R/W MODULE ID                 YM4057 21660002
IGG019MS DC    C'IGG019MS'         BUFF.MNGMT MODULE ID       LD YM5661 21670002
PAGESHFT EQU   12                  AOS2 PAGE SHIFT COUNT          3876  21700002
PAGESIZE EQU   4095                AOS2 PAGE SIZE -1              3876  21750002
*                                                                       21800002
THREERCD OI    TWENTY5(RWTG),EIGHT ADD X'800' TO TTR LENGTH             21850002
LONGLOAD MVC   TWENTY7(TWO,RWTG),CONATB+3  SET LENGTH OF FIRST TEXT     21900002
*                                  RECORD TO 1024 (X'400') BYTES        21950002
         MVI   TWENTY2(RWTG),LOADATB1  MODIFY ATTRIBUTES FOR MORE       22000002
*                                      THAN ONE TEXT RECORD             22050002
         B     LOAD                                                     22100002
*                                                                       22150002
*        THIS SUBROUTINE IS USED TO BUILD AN IRB AND REQUIRED IQE'S     22200002
*        FOR OPEN                                                       22250002
* INPUT - REGISTER 0 - ADDRESS OF THE ROUTINE ENTRY POINT TO BE USED    22300002
*         REGISTER 1 - NUMBER OF IQE'S TO BE BUILT                      22350002
*                                                                       22400002
* OUTPUT - REGISTER 1 - ADDRESS OF THE INITIALIZED IRB                  22450002
*                                                                       22500002
* RETURN ADDRESS PASSED IN REGISTER 14                                  22550002
*                                                                       22600002
BLDPIRB  EQU   *                   BUILD PP IRB                @YA02128 22610002
         LR    REVN,RPARM1         SAVE NO. IQE'S              @YA02128 22620002
         SLL   REVN,1              MULTIPLY BY TWO             @YA02128 22630002
         LA    REVN,ONE(REVN)      ADD ONE FOR LNGTH OF WKAREA @YA02128 22640002
         LR    RW3,RRTN            SAVE RETURN PTR             @YA02128 22642002
         CIRB  EP=(RPARM2),KEY=PP,MODE=PP,STAB=(RE),WKAREA=(REVN),     X22644002
               SVAREA=YES                                      @YA02128 22648002
         B     IRBSETUP            GO SET IT UP                @YA02128 22648402
*                                                              @YA02128 22648802
BLDIRB   LR    REVN,RPARM1         SAVE NO. OF IQE'S                    22650002
         SLL   REVN,1              MULTIPLY BY TWO                      22700002
         LA    REVN,ONE(REVN)      ADD ONE TO GET LENGTH OF WORKAREA    22750002
         LR    RW3,RRTN                IN DOUBLE WORDS                  22800002
         CIRB  EP=(RPARM2),KEY=SUPR,MODE=SUPR,STAB=(RE),WKAREA=(REVN)   22850002
*                                                                       22900002
IRBSETUP EQU   *                                               @YA02128 22910002
         SRL   REVN,1              GET NUMBER OF IQE'S                  22950002
         LA    RODD,RBNEXAV(RPARM1)    GET ADDR OF IRB'S IQE POINTER    23000002
         LR    RRTN,RW3            RESTORE RETURN ADDRESS               23050002
         L     RPARM2,DEBTCBAD-1   GET TCB ADDRESS                      23100002
         LA    RW3,FOUR(RODD)                                           23150002
IQEINIT  EQU   *                                                        23200002
         MODESET EXTKEY=ZERO       KEY ZERO                   LD Y02947 23250002
         ST    RW3,IQELNK(RODD)    STORE ADDR OF NEXT IQE IN CURRENT    23300002
*                                      LINK                             23350002
         ST    RPARM1,IQEIRB(RW3)  STORE IRB ADDR IN IQE                23400002
         ST    RPARM2,IQETCB(RW3)  STORE TCB ADDR IN IQE                23450002
         MVI   IQETCB(RW3),ZERO    CLEAR HIGH ORDER BYTE                23500002
         LR    RODD,RW3            SAVE ADDR OF THIS IQE                23550002
         LA    RW3,IQELNGTH(RW3)   STEP TO NEXT                         23600002
         BCT   REVN,IQEINIT        LOOP IF MORE TO DO                   23650002
         ST    REVN,IQELNK(RODD)   ZERO LINK FIELD OF LAST IQE          23700002
*                                                                       23750002
         BR    RRTN                RETURN TO CALLING POINT              23800002
*                                                                       23850002
*                                                                       23900002
AMIDCNST DC    C'4Q'               ID OF THIS EXECUTOR                  23950002
OPIDCNST DC    C'0S'               ID OF LAST OPEN LOAD                 24000002
         DS    0F                  FORCE FULL WORD ALIGNMENT            24050002
ZEROS    DC    F'0'                WORD OF ZEROS                        24100002
ECB      DC    F'0'                    ECB FOR PAGE FIX                 24150002
IOBPOOL  DC    X'FA000000'         SUBPOOL NO. FOR IOB'S AND BUFFERS    24250002
ERR6     DC    X'80097000'         ABEND CODE FOR VECTOR TABLE OVERFLOW 24300002
CONATB   DC    X'C3780004000400'   XCTL ATTRIBUTES AND LENGTH           24350002
*                                                                       24400002
*        IDTTRL TABLE FOR THE BTAM ROUTINES USED FOR THE LOCAL 3270.    24450002
*    EACH ENTRY CONSISTS OF THE LAST TWO CHARACTERS OF THE MODULE NAME, 24500002
*    THE RELATIVE TRACK AND RECORD ADDRESS OF THE CORRESPONDING LOAD    24550002
*    MODULE ON SYS1.SVCLIB, AND THE LENGTH OF THE MODULE IN DOUBLE      24600002
*    WORDS. THE TTR AND LENGTH ARE INSERTED BY THE IEHIOSUP UTILITY     24650002
*    DURING STAGE 2 OF SYSGEN. IF ANY OF THESE MODULES ARE CHANGED,     24700002
*    REPLACED, OR MOVED, IEHIOSUP MUST BE EXECUTED AGAIN.               24750002
*                                                                       24800002
ONEPAGE  EQU   X'02'    NUMBER OF PAGES A ONE PAGE MODULE MAY SPAN      24850002
SIOFIX   EQU   X'80'    INDICATES EXISTENCE OF PAGE FIX APPENDAGE       24900002
NENT     EQU   8                   NUMBER OF IDTTRL'S          @YA02128 24910002
LENGTH   EQU   NENT*6+6                LENGTH OF IDTTRL'S               24920002
NODBWDS  EQU   (LENGTH+7)/8            DBL WORDS WITH PADDING           24930002
RDWRTRTN DC    C'MA',XL4'0'        READ/WRITE RTN                       24950002
BPMR     DC    C'MS',XL4'0'        BUFFER POOL MANAGEMENT RTN           25000002
CHENDAPP DC    C'PA',XL4'0'        LOCAL 3270 CEA/XEA RTN               25050002
ATNRTN2  DC    C'PG',XL4'0'        LOCAL 3270 SECOND LEVEL ATTN RTN     25100002
DDM      DC    C'PH',XL4'0'        LOCAL 3270 DEVICE DEPENDENT MODULE   25150002
OLTCTL   DC    C'PI',XL4'0'        LOCAL 3270 OLT CONTROL RTN           25200002
READYM   DC    C'UP',XL4'0'        LOCAL 3270 READY ROUTINE    @YA02128 25210002
SIOAPPN  DC    C'LP',XL4'0'            START I/O APPENDAGE              25250002
IDEND    DC    XL2'0'              END OF IDTTRL TABLE                  25350002
         CNOP  4,8                 PADDING                              25400002
LOADID   DC    C'019'              OPEN SVC CODE                        25450002
         DC    YL1(X'80'-NODBWDS)  POINTER FOR IEHIOSUP                 25500002
*                                                                       25550002
*        END OF IDTTRL TABLE                                            25600002
*                                                                       25650002
         DCBD  DSORG=BX,DEVD=BS                                         25700002
         IECTDEBX                                                       25750002
         IECDSECS MAIN,WTG,PREFX,CVT,EXPAND=YES                         25800002
         IHAPSA                                                         25850002
         END                                                            25900002
./  ADD  SSI=70520095,NAME=IGG0203M
 TITLE 'IGG0203M - BTAM LINE GROUP CLOSE EXECUTOR'                      00350002
IGG0203M CSECT                                                          00400002
*                                                              @YA02128 00410002
*        FOLLOWING CHANGES APPLIED:                            @YA02128 00420002
*                                                              @YA02128 00440002
*                                                                       00450002
*                                                                       00500002
* D061000-061500,C062000-062500                              LD YA02147 00550002
* A085600-085988,A259000,A276200                             LD YA02169 00600002
* A076020                                                     LD YM7707 00610000
* D096100-096200                                            LD @ZA00520 00620000
* C036500                                                   L5 @ZA02840 00630003
* A036600-036800                                            L5 @ZA02840 00640003
*                                                                       00650002
*        YA03971  (1/3/74)                                              00660002
*        ZA00545  (11/15/74)                                            00670003
*        ZA00546  (11/15/74)                                            00680003
*        ZA00547  (11/15/74)                                            00690003
*        ZA02840  (02/25/75)                                            00692003
*        ZA03207  (03/24/75)          ZA03557  (03/10/75)               00694003
*        ZA03561  (03/10/75)          ZA03973  (04/29/75)               00695003
*        ZA04076  (04/17/75)          ZA04082  (04/17/75)               00696003
*        AZ07660  (12/05/75)          AZ08049  (01/26/76)             * 00697000
*        AZ09347  (04/08/76)          AZ10045  (06/07/76)             * 00698000
*        AZ14146  (11/01/76)          AZ17707  (02/15/77)               00699000
*                                                                       00700002
*********************************************************************** 00750002
*                                                                     * 00800002
* STATUS -          CHANGE LEVEL 003    8/16/74                       * 00850000
*                                                                     * 00900002
* FUNCTION -       THE CLOSE EXECUTOR LOGICALLY DETACHES A COMMUNI-   * 00950002
*                  CATION LINE GROUP FROM THE SYSTEM. THE ROUTINE     * 01000002
*                  PERFORMS THE FOLLOWING FUNCTIONS -                 * 01050002
*                                                                     * 01100002
*                    1. HALTS ANY OUTSTANDING ENABLE COMMANDS.        * 01150002
*                                                                     * 01200002
*                    2. STOPS ACTIVITY ON THE LINES.                  * 01250002
*                                                                     * 01300002
*                    3. DISABLES THE LINES.                           * 01350002
*                                                                     * 01400002
*                    4. FREES THE STORAGE OBTAINED BY OPEN FOR        * 01450002
*                                                                     * 01500002
*                       INPUT/OUTPUT BLOCKS.                          * 01550002
*                                                                     * 01600002
*                    5. REINITIALIZES DCB FIELDS.                     * 01650002
*                    6. FREES THE STORAGE OCCUPIED BY THE BUFFER      * 01700002
*                       POOL IF A BUFFER POOL WAS OBTAINED BY THE     * 01750002
*                       OPEN EXECUTOR.                                * 01800002
*                                                                     * 01850002
* ENTRY POINT -    ENTRY IS TO THE FIRST EXECUTABLE INSTRUCTION.      * 01900002
*                                                                     * 01950002
* INPUT -          REGISTER 5 - START OF PARAMETER LIST               * 02000002
*                                                                     * 02050002
*                  REGISTER 6 - START OF WHERE-TO-GO TABLE            * 02100002
*                                                                     * 02150002
*                  REGISTER 7 - CURRENT ENTRY IN PARAMETER LIST       * 02200002
*                                                                     * 02250002
*                  REGISTER 8 - CURRENT ENTRY IN WHERE-TO-GO TABLE    * 02300002
*                                                                     * 02350002
* OUTPUT -         NONE                                               * 02400002
*                                                                     * 02450002
* EXIT -           CONTROL IS GIVEN TO THE SYSTEM CLOSE ROUTINE.      * 02500002
*                                                                     * 02550002
* ATTRIBUTES -     THIS ROUTINE IS EXECUTED IN THE TRANSIENT AREA     * 02600002
*                  AS ENABLED AND REENTRANT.                          * 02650002
*                                                                     * 02700002
*********************************************************************** 02750002
         EJECT                                                          02800002
         USING IECTIOB,RCORE                                            02850002
         USING IHADCB,RDCB                                              02900002
         USING IECTDEB,RDEB                                             02950002
         BALR  RBASE,0                                                  03000002
         USING *,RBASE                                                  03050002
         B     BEGIN                                                    03100002
         DC    C'IGG0203M'                                              03150003
         DC    C'** MVS *'                                              03180003
         DC    C'&SYSDATE'         ASSEMBLY DATE            LD @ZA00545 03210003
         DC    C'UZ06852'          PTF NUMBER                           03215000
         DC    S(*)                                                     03220003
PATCH    DC    20F'0'                                                   03230003
         DS    0H                                                       03250000
BEGIN    EQU   *                                                        03270000
*                                      INITIALIZATION OF REGISTERS FOR  03300002
*                                      DEB,DCB AND IOB                  03350002
         L     RDCB,0(RPARC,0)         ACCESS POINTER TO DCB            03400002
         L     RDEB,DCBDEBAD           ACCESS POINTER TO DEB            03450002
         L     RJ,4(RWTGC)    LOAD ADDRESS OF DCB WORK AREA.   @ZA09347 03460000
         USING WORKAREA,RJ                                     @ZA09347 03470000
         ST    RDEB,DXCCW          SAVE DEB ADDR FOR PURGE     @ZA09347 03480000
         L     RDEB,28(RDEB)           POINT TO APPENDAGE TABLE OF DEB  03500002
*                                 OR TRUE START OF DEB FOR DSECT.       03550002
         L     RCORE,DCBIOBAD           GET IOB ADDRESS MINUS SIZE.     03600002
         MVC   DEBSIOA+1(THREE),DEBEOEA+1     SET           L5 @ZA02840 03650003
         MVC   DEBPCIA+1(THREE),DEBEOEA+1       APPENDAGE   L5 @ZA02840 03660003
         MVC   DEBCEA+1(THREE),DEBEOEA+1          ADDRESS   L5 @ZA02840 03670003
         MVC   DEBXCEA+1(THREE),DEBEOEA+1          TO IOS   L5 @ZA02840 03680003
         NI    DEBSIOA,NOPGFIX          TURN OFF PAGE FIX      @ZA02840 03690003
*                        APPENDAGE FLAG REQUIRED FLAG          @ZA02840 03692003
         TM    DCBDEVTP,X'FF'           TEST FOR STRAM             000C 03700002
         BC    14,NOSTRAM               IF NOT, BRANCH             000C 03750002
         MVC   0(5,RWTGC),STRAMID       MOVE IN STRAM ID           000C 03800002
         B     STRAMOUT                                            000C 03850002
NOSTRAM  SR    RB,RB          CLEAR REGISTER                            03900000
         IC    RB,DCBEIOBX    GET IOB  SIZE                             03950000
         SR    RC,RC                                                    04000002
         IC    RC,DEBNMEXT              GET NUMBER OF EXTENTS.          04050002
         L     RTIOT,DEBTCBAD-1                                         04100002
         TM    TCBFLG(RTIOT),ABCLOSE   WAS CLOSE INITIATED BY ABEND?    04150002
         BO    DISABLER            IF SO, GO DIRECTLY TO DISABLE        04200002
*    ROUTINE, AS ABEND WILL HAVE PURGED ALL OUTSTANDING I/O REQUESTS.   04250002
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 04300002
         SPACE 2                                                        04350002
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 04400002
         SPACE 1                                                        04450002
         AR    RCORE,RB                 INITIALIZE IOB REGISTER  A25673 04550002
*         TWO LINES OF CODE DELETED BY APAR ------------->     @ZA09347 04600000
         MODESET KEYADDR=DXUKEY,WORKREG=1   ASSUME USER KEY      Y02947 04700002
         OI    IOBFLAG2,RESETPL     TERMINATE POLLING            Y02947 04750002
         MODESET EXTKEY=DATAMGT    GET TO KEY 5                         04800002
         L     RB,DXCCW       SAVE ORGINAL DEB ADDRESS         @ZA09347 04820000
         LA    RF,DXCCW         LOAD ADDRESS OF AREA TO BE USED  Y02947 04850002
*                                  AS PARAMETER LIST FOR PURGE.         04900002
         LA    RTIOT,DEBNMSUB           LOAD ADDRESS OF DEB ORIGIN.     05050002
         ST    RTIOT,DXCCW   STORE DED ADDRESS IN PARM LIST    @ZA09347 05100000
         MVI   0(RF),PURGEOPT  MOVE PARAMETER LIST OPTION BYTE @ZA09347 05110000
*                             TO PARAMETER LIST AREA.                   05120000
*         ONE LINE OF CODE DELETED BY APAR -------------->     @ZA09347 05150000
         L     RTIOT,DEBTCBAD-1                                         05200002
         LA    RTIOT,0(RTIOT)           CLEAR HIGH ORDER BYTE OF TCB    05250002
*    ADDRESS SO THAT IT WILL NOT LOOK LIKE A COMPLETION CODE.           05300002
         ST    RTIOT,4(RF)              STORE TCB ADDRESS IN PARAMETER  05350002
*                                  LIST.                                05400002
         LA    RTIOT,DEBSYSPG-1         STORE ADDRESS OF DEB SYSTEM     05450002
         ST    RTIOT,8(RF)         PURGE FIELD IN PARAMETER LIST.       05500002
         LA    RTIOT,4(RF)              LOAD ADDRESS OF TCB FIELD IN    05550002
*                                  PARAMETER LIST TO BE USED AS ECB.    05600002
         LA    RC,DXCCW+12        LOAD ADDRESS OF CCW AREA PLUS  Y02947 05650002
*    12 IN DCB WORK AREA FOR USE AS A REGISTER SAVE AREA.               05700002
         MODESET KEYADDR=DXUKEY,WORKREG=10  ASSUME USER KEY             05750002
         SVC   16                       ISSUE PURGE SVC.                05800002
         MODESET EXTKEY=DATAMGT    GET TO KEY 5                @ZA09347 05800100
         L     RJ,4(RWTGC)   LOAD ADDRESS OF DCB WORK AREA     @ZA09347 05800200
         LA    RJ,0(RJ)      CLEAR HIGH ORDER BYTE             @ZA09347 05800300
         ST    RB,DXCCW      RESTORE ORIGINAL DEB ADDRESS      @ZA09347 05800400
         MODESET KEYADDR=DXUKEY,WORKREG=10  ASSUME USER KEY    @ZA09347 05800500
         SR    RC,RC                                                    05850002
         IC    RC,DEBNMEXT              RE-INITIALIZE NUMBER OF         05900002
*                                  EXTENTS REGISTER.                    05950002
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 06000002
*    THE FOLLOWING SECTION OF CODE ISSUES DISABLE COMMANDS TO ALL       06050002
*    COMMUNICATION LINES IN THE LINE GROUP.                             06100002
         SPACE 1                                                        06150002
DISABLER EQU   *                                                        06200002
         L     RUCB,DEBUCBAD       GET FIRST UCB ADDRESS                06250002
         CLI   UCBCLASS(RUCB),GRPHCDVC  IS DEVICE 3270                  06300002
         BNE   ENDANR              NO, SKIP ANR CLEAN-UP AND   @ZA03207 06350003
*                        SEE IF ANY PAGES ARE TO BE FREED      @ZA03207 06360003
*                                                                       06400002
         L     RF,ATNIRBAD(RUCB)   GET ADDRESS OF IRB                   06550002
         LA    RF,ZERO(RF)         CLEAR HI ORDER BYTE       LD YA03240 06600000
         L     RB,RDYQ(RUCB)       GET ADDR OF READYQ IRB    LD YA03240 06605000
         LA    RB,ZERO(RB)         CLEAR HI ORDER BYTE       LD YA03240 06610000
         SR    RC,RC               CLEAR REG                 LD YA03240 06615000
         SR    RD,RD               CLEAR REG                 LD YA03240 06620000
         IC    RD,DEBNMEXT         GET NUM. OF DEVICES       LD YA03240 06625000
         MODESET EXTKEY=ZERO       RESUME KEY ZERO           LD YA03240 06630000
CLIRBPT  IC    RDCB,UCBGCB(RUCB)   SAVE GCB                  LD YA03240 06635000
         XC    UCBATTN(ANRATNXT,RUCB),UCBATTN(RUCB)          LD YA03240 06640000
*                                  CLEAR READYQ IRB PTR      LD YA03240 06645000
         STC   RDCB,UCBGCB(RUCB)   RESTORE GCB               LD YA03240 06650000
         LA    RC,FOUR(RC)         BUMP TO NEXT UCB          LD YA03240 06655000
         L     RUCB,DEBUCBAD(RC)   POINT TO NEXT UCB         LD YA03240 06660000
         BCT   RD,CLIRBPT          LOOP TO CLEAR IRB PTR     LD YA03240 06665000
         LR    RUCB,RB             RDY Q IRB ADDRESS        L5 @ZA04076 06665403
         LTR   RF,RF               IS ATN IRB ADDR ZERO?       @ZA03557 06667003
         BZ    TSTRDYQ             YES, GO TEST READYQ         @ZA03557 06669003
         BAL   RDCB,IRBFREE        GO FREE THE IRB          L5 @ZA04076 06679003
TSTRDYQ  LTR   RF,RUCB             IS RDY Q IRB ADDR ZERO?  L5 @ZA04076 06700003
         BZ    NORDYQP             YES,COMTINUE             L5 @ZA04076 06710003
         BAL   RDCB,IRBFREE        GO FREE THE IRB          L5 @ZA04076 06712003
         B     NORDYQP             CONTINUE                 L5 @ZA04076 06714003
IRBFREE  EQU   *                                            L5 @ZA04076 06714403
         SR    RB,RB               CLEAR REG                 LD YA03240 06715000
         IC    RB,NINE(RF)         GET READYQ IRB SIZE       LD YA03240 06720000
         SLL   RB,THREE            CHANGE TO BYTES           LD YA03240 06725000
         LA    RE,ZERO(RB)         PUT IN PARM               LD YA03240 06730000
         O     RE,IRBPOOL          OR IN SUBPOOL NUMBER      LD YA03240 06735000
         LA    RD,TWO              NUMBER OF IQES           L5 @ZA04076 06747003
         L     RC,NXTAVAL(RF)      ADDR AVAIL. READYQ IQE    LD YA03240 06755000
IQELOOP  LA    RC,ZERO(RC)         CLEAR HI ORDER BYTE       LD YA03240 06760000
         LTR   RC,RC               IQE ADDR AVAILABLE        LD YA03240 06770000
         BZ    CVTFREE             NO,BRANCH                 LD YA03240 06775000
         L     RC,ZERO(RC)         GET NEXT IQE PRT          LD YA03240 06780000
         BCT   RD,IQELOOP                                    LD YA03240 06785000
         SH    RF,HEADER           ALLOW FOR 20 BYTE PREFIX L5 @ZA04082 06790003
         FREEMAIN R,LV=(0),A=(1)   FREE IRB                  LD YA03240 06795000
         BR    RDCB                RETURN TO NSI             LD YA03240 06800000
CVTFREE  EQU   *                                             LD YA03240 06805000
         SR    RC,RC               CLEAR REG                 LD YA03240 06810000
         L     RC,CVTPTR           GET CVT ADDRESS           LD YA03240 06815000
         USING CVT,RC              CVT ADDRESSABILITY        LD YA03240 06820000
         LA    RC,CVTEXIT          GET ADDR OF SVC 3         LD YA03240 06825000
         DROP  RC                                            LD YA03240 06830000
         ST    RC,RBEP(RF)         PLACE SVC INTO EP         LD YA03240 06835000
         XC    RBOPSW+ONE(THREE,RF),RBOPSW+ONE(RF)           LD YA03240 06840000
         OC    RBOPSW+ONE(THREE,RF),RBEP+ONE(RF)             LD YA03240 06845000
         OI    RBSTAB(RF),TWO      RB CAN BE FREED           LD YA03240 06850000
         BR    RDCB                RETURN TO NSI             LD YA03240 06855000
NORDYQP  EQU   *                                             LD YA03240 06860000
         L     RDCB,ZERO(RPARC)    GET DCB ADDRESS           LD YA03240 06865000
         SR    RC,RC              CLEAR THE INDEX REG          @YA02128 06890802
         IC    RC,DEBNMEXT        RESTORE NUMBER EXTENTS       @YA02128 06892802
         L     RUCB,DEBUCBAD      RESTORE FIRST UCB POINTER    @YA02128 06893202
         SR    RF,RF               INITIALIZE INDEX                     06950002
*         TWO LINES OF CODE DELETED BY APAR ----------->       @ZA09347 07450000
         MODESET EXTKEY=DATAMGT    ASSUME DATAMGT KEY         LD YM5674 07460002
         B     ENDANR1             BRANCH AROUND SYSEVENT MAC LD YM5674 07470002
ENDANR   EQU   *                   END OF 3270 CODE                     07500002
         MODESET EXTKEY=DATAMGT         ASSUME DATA MGT KEY   LD Y02947 07510000
         DROP  RCORE                                           @AZ17707 07520000
         L     TCBREG,DEBTCBAD-1       SET TCB ADDRESSABILITY  @AZ17707 07530000
         USING TCB,TCBREG              TCB ADDRESSABILITY      @AZ17707 07540000
         TM    TCBFLGS6,TCBRV          VIRTUAL=REAL JOB?       @AZ17707 07550000
         BO    ENDANR1                 YES, DON'T ISSUE OKSWAP @AZ17707 07560000
         DROP  TCBREG                                          @AZ17707 07570000
         SR    RE,RE               CLEAR REG                  LD YM7707 07602000
         SYSEVENT OKSWAP           MAKE MEMORY....            LD YM5674 07610002
*                                      SWAPPABLE AGAIN.       LD YM5674 07620002
ENDANR1  EQU   *                                              LD YM5674 07630002
         USING IECTIOB,RCORE        RESET IOB ADDRESSABILITY   @ZA17707 07633000
         SR    RB,RB               GET NUMBER OF DEVICES       @ZA09347 07636000
         IC    RB,DCBEIOBX       GET  IOBSIZE                  @ZA09347 07642000
         L     RDCB,0(RPARC)            RE-INITIALIZE DCB REGISTER.     07650002
         L     RCORE,DCBIOBAD           GET IOB ADDRESS MINUS SIZE.     07700002
         OI    DCBIFLGS,X'0C'           INDICATE NO ERP IN CLOSE        07750002
         L     RJ,FOUR(RWTGC)       WORKAREA ADDRESSABILITY   LD YM5674 07770002
         MODESET KEYADDR=DXUKEY,WORKREG=14   ASSUME USER KEY     Y02947 07800002
         LR    RTIOT,RC                 LOAD NUMBER OF EXTENTS TO COUNT 07850002
*                                  REGISTER.                            07900002
         L     RDCB,DXUDCBAD       POINT TO USER DCB                    07950002
         OI    DCBIFLGS,X'0C'      INDICATE NO ERP TO CLOSE             08000002
         LA    RDCB,IOBERCCW(RB)        LOAD ECB ADDRESS.     LD YM5655 08050002
EXCPLOOP AR    RCORE,RB                 INITIALIZE IOB REGISTER TO      08100002
*                                  POINT AT NEXT IOB.                   08150002
         SR    RD,RD                                                    08200002
         IC    RD,IOBUCBX                                               08250002
         SLL   RD,2                                                     08300002
         TM    IOBINCAM,X'80'          SAD/ENABLE FAILURE        A30762 08350002
         BO    SADOFF                  YES, AVOID DISABLE        A30762 08400002
         L     RUCB,DEBUCBAD(RD)        LOAD UCB ADDRESS.               08450002
         CLI   UCBCLASS(RUCB),GRPHCDVC  IS DEVICE 3270                  08500002
         BE    CLEARDVC                 YES, CLEAR DEVICE    LD YA03971 08550000
         CLI   UCBTYP+3(RUCB),IBM32701  TEST FOR IBM TYPE III ADAPTER   08600002
         BE    LOOPTEST            ON A 2701 CONTROL UNIT.              08650002
         TM    UCBFL1(RUCB),XE8    DEV NOT READY OR BUSY    LD @ZA00546 08660003
         BM    LOOPTEST            EITHER, BYPASS EXCP      LD @ZA00546 08670003
         ST    RDCB,IOBECBPT            STORE ECB ADDRESS IN IOB.       08700002
         XC    IOBERCCW(4),IOBERCCW     CLEAR ECB              @ZA03207 08710003
         MVC   IOBCPA(8),DISABLE                                        08750002
         MVC   IOBCPA+8(8),IONOP                                   000E 08800002
         LA    RF,IOBCPA                SET UP START OF CHANNEL         08850002
         ST    RF,IOBSTART         PROGRAM ADDRESS.                     08900002
         L     RF,DEBTCBAD-ONE      GET TCB ADDRESS          LD YA03237 08960002
         TM    TCBFLG(RF),ABCLOSE    ABEND ISSUED CLOSE?     LD YA03237 09000002
         LR    RF,RCORE                                                 09010002
         BZ    ISSUEXCP                 NO, ISSUE EXCP       LD YA02169 09050002
REPSTEST LA    RE,LOOPCNT               LOAD LOOP COUNT        @ZA03973 09100003
REPTTEST EQU   *                                             LD YA02169 09150002
         BCT   RE,TESTUCB                                    LD YA02169 09200002
         B     SADOFF         TURN OFF SAD/ENAB EHWN CNT=0   LD YA02169 09250002
TESTUCB  EQU   *                                             LD YA02169 09300002
         TM    UCBFL1(RUCB),XE8         IS LINE HUNG?        LD YA02169 09350002
         BC    FIVE,REPTTEST                                 LD YA02169 09400002
ISSUEXCP EQU   *                                             LD YA02169 09450002
         EXCP  (1)                                                      09500002
         LR    RF,RDCB                  LOAD ECB ADDRESS FOR WAIT.      09550002
         MVI   IOBINCAM+1,X'00'    SET TIMER COUNT TO ZERO     @ZA14146 09553000
STIMER   STIMER WAIT,BINTVL=TIME        WAIT 1/2 SECOND     LD @ZA14146 09556000
         TM    0(2),X'7F'               IS ECB POSTED       LD @ZA14146 09562000
         BNZ   SADOFF                   BRANCH IF YES          @ZA14146 09563000
         CLI   IOBINCAM+1,X'0D'         IS COUNT MAX 7         @ZA14146 09564000
         BNL   GOPURGE                  YES, GO PURGE          @ZA14146 09565000
         IC    RF,IOBINCAM+1            STORE NEW STIMER COUNT @ZA14146 09566000
         LA    RF,1(RF)                 UPDATE COUNT BY ONE    @ZA14146 09567000
         STC   RF,IOBINCAM+1            STORE NEW TIMER COUNT  @ZA14146 09568000
         B     STIMER                   REISSUE TIMER 1/2 SEC. @ZA14146 09569000
GOPURGE  EQU   *                                               @ZA10045 09572000
         STC   RTIOT,IOBCPA+SIXTEEN YES, SAVE COUNT REG     LD @ZA00546 09580003
         BAL   RD,PURGE2           BAL TO PURGE SUBRTN      LD @ZA00546 09590003
         SR    RTIOT,RTIOT         CLEAR REG                LD @ZA00546 09592003
         IC    RTIOT,IOBCPA+SIXTEEN RESTORE COUNT REG       LD @ZA00546 09594003
*                       THREE LINES DELETED BY---------------->@ZA14146 09600000
*                                                                     * 09610000
*        2 LINES OF CODE REMOVED FOR OZ00520                          * 09620000
*                                                                     * 09630000
SADOFF   NI    IOBINCAM,X'7F'          TURN OFF SAD/ENABLE       A30762 09650002
LOOPTEST EQU   *                                                        09700002
         BCT   RTIOT,EXCPLOOP                                           09750002
         B     FREEIOBS                 GO TO FREE IOB'S     LD YA03971 09770000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 09850002
         SPACE 1                                                        09860002
PURGE2   EQU   *                                            LD @ZA00546 09870003
         MODESET EXTKEY=DATAMGT    DATA MANAGEMENT KEY      LD @ZA00546 09880003
         L     RJ,FOUR(RWTGC)      WORKAREA ADDRESSABILITY  LD @ZA00546 09890003
         XC    DXCCW+L4(L8),DXCCW+L4    CLEAR PARM LIST        @ZA09347 09892000
*         ONE LINE OF CODE DELETED BY APAR ------------->      @ZA09347 09894000
         MVI   DXCCW,PURGOPTN      PURGE OPTION             LD @ZA00546 09896003
         PURGE DXCCW               ISSUE PURGE/HALT I/O     LD @ZA00546 09898003
         L     RJ,FOUR(RWTGC)      WORKAREA ADDRESSABILITY  LD @ZA00546 09898403
         MODESET KEYADDR=DXUKEY,WORKREG=15                  LD @ZA00546 09898803
         BR    RD                  RETURN TO CALLER         LD @ZA00546 09899203
         SPACE 1                                                        09900002
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 09902000
*        THIS SECTION WILL CLEAR THE 3270'S SCREEN                      09904000
         SPACE 1                                                        09906000
CLEARDVC EQU   *                                             LD YA03971 09908000
         ST    RDCB,IOBECBPT            STORE ECB ADDR...    LD YA03971 09910000
*                                       IN IOB               LD YA03971 09912000
         XC    IOBERCCW(4),IOBERCCW     CLEAR ECB              @ZA03207 09912403
         MVC   IOBCPA+FOUR(FIVE),CLEARCCW  MOVE ER/WR CCW    LD YA03971 09914000
*                                       AND WCC TO IOB       LD YA03971 09916000
         LA    RF,IOBCPA+EIGHT          ADDR OF DATA AREA               09918000
         ST    RF,IOBCPA                STORE IT IN CCW      LD YA03971 09920000
         MVI   IOBCPA,X05               OP CODE FOR CCW      LD YA03971 09922000
         LA    RF,IOBCPA                ADDR OF CCW          LD YA03971 09924000
         ST    RF,IOBSTART              FOR I/O              LD YA03971 09926000
         LR    RF,RCORE                 ADDR OF IOB          LD YA03971 09928000
         B     REPSTEST                 ISSUE EXCP             @ZA03973 09930003
         SPACE 1                                                        09932000
*                                                                       09934000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 09936000
         SPACE 2                                                        09938000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 09950002
*    THE FOLLOWING SECTION OF CODE FREES THE CORE USED FOR IOB'S.       10000002
         SPACE 1                                                        10050002
FREEIOBS EQU   *                                                        10100002
         L     RDCB,0(RPARC)            RE-INITIALIZE DCB REGISTER.     10150002
*                                                                       10200002
*             15 LINES DELETED BY THE FOLLOWING APAR           @ZA03207 10210003
*                                                                       10260003
CONTINUE EQU   *                                              LD Y02947 10950002
         L     RUCB,DEBUCBAD          UCB ADDR                 @ZA03207 10960003
         CLI   UCBCLASS(RUCB),GRPHCDVC LOCAL 3270 DEVICE       @ZA03207 10970003
         BNE   FREETCCW               NO, CHECK ERP EXT        @ZA03207 10980003
RETURN   EQU   *                                               @ZA03207 10990003
         L     RF,DCBIOBAD              GET IOB ADDRESS MINUS SIZE.     11000002
         AR    RF,RB                    ADD SIZE TO GET TRUE IOB ADDR.  11050002
         L     RUCB,DEBUCBAD          UCB ADDR                 @ZA03207 11060003
         CLI   UCBCLASS(RUCB),GRPHCDVC LOCAL 3270 DEVICE       @ZA03207 11070003
         BE    NOEXT                  YES, NO ERP EXT          @ZA03207 11080003
         LA    RB,4(RB)               LENGTH OF ERP EXT ENTRY  @ZA03207 11090003
*                          FOR REMOTES ONLY                    @ZA03207 11092003
NOEXT    EQU   *                                               @ZA03207 11094003
         MR    RB,RB                    MULTIPLY TO GET TOTAL SIZE.     11100002
         CLI   UCBCLASS(RUCB),GRPHCDVC LOCAL 3270 DEVICE       @ZA03207 11102003
         BE    NOEXT1                 YES, NO ERP EXT          @ZA03207 11104003
         LA    RC,4(RC)                 ADD 4 MORE FOR THE 0TH @ZA03207 11110003
*                                       IN THE ERP EXT         @ZA03207 11120003
NOEXT1   EQU   *                                               @ZA03207 11130003
         LA    RE,0(RC)                 CLEAR HIGH ORDER BYTE.          11150002
         O     RE,IOBPOOL               PLACE SUBPOOL NUMBER IN HIGH    11200002
*                                  ORDER BYTE.                          11250002
         FREEMAIN R,LV=(0),A=(1)       FREEMAIN FOR IOB                 11300002
         L     RB,DEBIRBAD-1            GET ADRS OF PNTRS TO IRBS  000E 11350002
         LA    RB,0(RB)                 CLEAR HI-ORDER BYTE        000E 11400002
         LTR   RB,RB                    WAS ADDRESS ZERO           000E 11450002
         BZ    BUFPOOL                  IF SO, BRANCH              000E 11500002
         MODESET EXTKEY=DATAMGT         BACK TO DATA MGT KEY     Y02947 11550002
         XC    DEBIRBAD(3),DEBIRBAD     CLEAR ADDRESS FIELD        000E 11600002
         MODESET EXTKEY=ZERO                                  LD YM4059 11650002
         L     RC,0(RB)                 GET ADDRESS OF ONLT IRB    000E 11700002
         MODESET EXTKEY=DATAMGT                               LD YM4059 11750002
         LTR   RC,RC                    IS ADDRESS PRESENT         000E 11800002
         BZ    NOTONLT                  IF NOT, BRANCH             000E 11850002
         LA    RDCB,NOTONLT        RETURN ADDR FOR SUBRTN   LD @ZA00547 11860003
         SR    RE,RE               CLEAR REG                LD @ZA00547 11870003
         L     RJ,FOUR(RWTGC)      WORKAREA ADDRESSABILITY  LD @ZA00547 11872003
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER'S KEY     LD @ZA00547 11880003
         IC    RE,DEBNMEXT         NO. DEVICES TIMES 2...   LD @ZA00547 11892003
         AR    RE,RE               ...IS TOTAL NO. IQES     LD @ZA00547 11894003
         MODESET EXTKEY=ZERO       KEY ZERO                 LD @ZA00547 11896003
         L     RJ,NXTAVAL(RC)      GET 1'ST FREE IQE        LD @ZA00547 11898003
         LR    RF,RC               PRIME REG FOR SUBRTN     LD @ZA00547 11898403
ONLTLOOP EQU   *                                            LD @ZA00547 11898803
         LA    RJ,ZERO(RJ)         CLEAR HI-ORDER BYTE      LD @ZA00547 11899203
         LTR   RJ,RJ               IQE ADDR AVAILABLE       LD @ZA00547 11899603
         BZ    CVTFREE             NO, LET EXIT FREE IRB.   LD @ZA00547 11899703
         L     RJ,ZERO(RJ)         GET NEXT IQE ADDRESS.    LD @ZA00547 11899803
         BCT   RE,ONLTLOOP         LOOP TO CHECK ALL IQES.  LD @ZA00547 11899903
         MODESET EXTKEY=DATAMGT    DATA MANAGEMENT KEY      LD @ZA00547 11916603
         LR    RC,RF               RESTORE IRB ADDRESS      LD @ZA00547 11926603
         BAL   RDCB,FREEIRB             GO FREE CORE               000E 11933302
NOTONLT  EQU   *                                              LD YM4059 11950002
         MODESET EXTKEY=ZERO                                  LD YM4059 12000002
         L     RC,4(RB)                 GET ADDRESS OF PTOP IRB    000E 12050002
         MODESET EXTKEY=DATAMGT                               LD YM4059 12100002
         LTR   RC,RC                    IS ADDRESS PRESENT         000E 12150002
         BZ    NOTPTOP                  IF NOT BRANCH              000E 12200002
         L     R2,0(RC)                 GET ADR OF SAVE     LD @ZA00545 12250003
         LA    R2,0(R2)                 CLEAR HIGH BYTE     LD @ZA00545 12300003
         LTR   R2,R2                    SAVE AREA EXIST?    LD @ZA00545 12350003
         BZ    NOPTOPSV                 NO, PROCESS IRB         YA01234 12400002
         LA    RJ,72                    SAVE AREA SIZE          YA01234 12450002
         O     RJ,IOBPOOL               USER SUBPOOL            YA01234 12500002
         LR    RF,R2                    ADDR FOR FREEMAIN   LD @ZA00545 12550003
         LR    RE,RJ                    SUBPOOL & SIZE          YA01234 12600002
         FREEMAIN R,LV=(0),A=(1)        FREE SAVE AREA          YA01234 12650002
NOPTOPSV EQU   *                        PROCESS THE IRB         YA01234 12700002
         BAL   RDCB,FREEIRB             GO FREE CORE               000E 12750002
NOTPTOP  EQU  *                                                  Y02947 12800002
         L     RJ,4(RWTGC)               ADDR OF OPEN WORK AREA  Y02947 12850002
         MODESET KEYADDR=DXUKEY,WORKREG=13   ASSUME USER KEY     Y02947 12900002
         LR    RF,RB                    ADDRESS OF PNTRS IN REG 1Y02947 12950002
         LA    RE,16                    LNGTH 16 BYTES             000E 13000002
         O     RE,IOBPOOL               OR IN SUBPOOL NUMBER       000E 13050002
         FREEMAIN  R,LV=(0),A=(1)       FREE IRB PNTRS                  13100002
         B     BUFPOOL                                             000E 13150002
FREEIRB  SR    RJ,RJ                    CLEAR REGISTER             000E 13200002
         IC    RJ,DEBNMEXT              GET NUMBER OF EXTENTS      000E 13250002
         SLL   RJ,2                     MULTIPLY BY 8              000E 13300002
         LA    RJ,1(RJ)                 ADD ONE                    000E 13350002
         SLL   RJ,3                     MULTIPLY BY EIGHT          000E 13400002
         LA    RJ,96(RJ)                ADD IRB SIZE               000E 13450002
         O     RJ,IRBPOOL               OR IN SUBPOOL NUMBER       000E 13500002
         LR    RE,RJ                    PUT COUNT IN REG 0         000E 13550002
         LR    RF,RC                    PUT ADDRESS IN REG 1       000E 13600002
         FREEMAIN R,LV=(0),A=(1)        FREE IRB                   000E 13650002
         BR    RDCB                                                000E 13700002
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 13750002
         SPACE 2                                                        13800002
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 13850002
*    THE FOLLOWING SECTION OF CODE FREES THE CORE USED FOR A BUFFER     13900002
*    POOL, IF THE BUFFER POOL WAS CREATED BY OPEN.                      13950002
         SPACE 1                                                        14000002
BUFPOOL  L     RJ,4(RWTGC)                                       Y02947 14050002
         L     RDCB,DXUDCBAD            POINT TO USER'S DCB      Y02947 14100002
         TM    DCBMACRF,X'04'           TEST WHETHER BUFFER POOL SHOULD 14150002
         BZ    DCBINIT             BE FREED.  IF NOT, BRANCH.           14200002
         MODESET EXTKEY=DATAMGT                                         14250002
         L     RDCB,ZERO(RPARC)    COPY DCB ADDRESS                     14300002
         NI    DCBMACRF,X'FB'           CLEAR BIT THAT INDICATES BUFFER 14350002
*                                  POOL SHOULD BE FREED BY CLOSE.       14400002
         L     RF,DCBBUFCB              LOAD BUFFER CONTROL BLOCK       14450002
*                                  ADDRESS.                             14500002
         LA    RF,0(RF)                ZERO OUT HI BYTE          A32442 14550002
         LH    RB,DCBBUFL                                               14600002
         SR    RC,RC                                                    14650002
         IC    RC,DCBBUFNO                                              14700002
         MR    RB,RB                                                    14750002
         LA    RE,8(RC)                 LOAD BUFFER POOL SIZE TO        14800002
*                                  PARAMETER LIST REGISTER.             14850002
         O     RE,IOBPOOL               PLACE SUBPOOL NUMBER IN HIGH    14900002
*    ORDER BYTE OF PARAMETER LIST REGISTER.                             14950002
*                                                                       15000002
         MODESET KEYADDR=DXUKEY,WORKREG=13   ASSUME USER KEY  LD Y02947 15050002
*                                                                       15100002
         FREEMAIN R,LV=(0),A=(1)                                        15150002
*                                                                       15200002
         MODESET EXTKEY=DATAMGT                               LD Y02947 15250002
*                                                                       15300002
         MVC   DCBBUFCB+1(3),CLEARMSK+1 RE-INITIALIZE BUFFER CONTROL    15350002
*                                  BLOCK ADDRESS FIELD IN DCB.          15400002
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 15450002
         SPACE 2                                                        15500002
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 15550002
*    THE FOLLOWING SECTION OF CODE RE-INITIALIZES DCB FIELDS.           15600002
*     IF LOCAL 3270 IOB SIZE CHANGES FROM X'58', THE           @ZA08049 15610003
*      FOLLOWING (CLI) MUST BE CHANGED.                        @ZA08049 15620003
         SPACE 1                                                        15650002
DCBINIT  EQU   *                                                        15700002
         CLI   DCBEIOBX,L3270      IF NOT L3270, THERE WAS NO  @ZA08049 15750003
         BNE   NOCLRLRB          READY Q, SO DON'T CLEAR LERB  @ZA08049 15770003
         TM    DCBLERB,IGG019UP  READYQ SPEC BTAM'S ROUTINE    @ZA08049 15790003
         BNO   NOCLRLRB        NO, DON'T CLEAR ADDRESS         @ZA08049 15810003
         NI    DCBLERB,ALLON-IGG019UP CLEAR READYQ FLAG        @ZA08049 15830003
         XC    DCBLERB+L1(L3),DCBLERB+L1 CLEAR ADDRESS         @ZA08049 15850003
*                                       READYQ  IS  RESET      @ZA08049 15870003
*              TWO LINES OF CODE DELETED BY APAR -------->     @ZA07660 15890003
NOCLRLRB MVC   DCBIOBAD(L4),CLEARMSK    REINIT IOB ADDRESS     @ZA08049 15980003
*                                         FIELD IN DCB         @ZA08049 16000003
         XC    DCBEIOBX(L1),DCBEIOBX  REINIT DCB'S IOB SIZE    @ZA08049 16020003
         XC    DCBREAD+L1(L3),DCBREAD+L1   REINIT R/W ADDRESS  @ZA08049 16040003
         XC    DCBIFLGS(L1),DCBIFLGS  REINIT IOS ERROR FLAGS   @ZA08049 16060003
         IC    RD,DCBMACRF                                       Y02947 16350002
         L     RJ,FOUR(RWTGC)      CLOSE WORK AREA                      16400002
         L     RDCB,DXUDCBAD       USER DCB ADDRESS                     16450002
         MODESET KEYADDR=DXUKEY,WORKREG=13   USER KEY                   16500002
         STC   RD,DCBMACRF          (NOT MAPPED BY SYS CLOSE)    Y02947 16550002
         L     RDCB,0(RPARC)           POINT TO COPY DCB                16600002
         MODESET EXTKEY=DATAMGT                               LD Y02947 16650002
         XC    0(2,RWTGC),0(RWTGC)     CLEAR ID TO INDICATE COMPLETION  16700002
*                                  OF EXECUTOR.                         16750002
STRAMOUT EQU   *                                                        16800002
         USING WTG,RWTG                                                 16850002
         LR    RF,RCORE                 SAVE IOB ADDRESS      LD Y02947 16900002
         L     RCORE,4(RWTGC)           WORK ADREA ADDRESS    LD Y02947 16950002
         L     RJ,WTGPREFX              WTG PREFIX ADDRESS    LD Y02947 17000002
         STM   RE,RD,IECREGSV-IECPREFX(RJ)  SAVE REGS         LD Y02947 17050002
         IECRES INIT,DCBCOPY=FRWKAR                           LD Y02947 17100002
         LR    RJ,RWTG                  REG SAVEAREA ADDR        YM5668 17150002
         LM    RE,RD,IECREGSV-IECPREFX(RJ)  RESTORE REGS      LD Y02947 17200002
         L     RJ,4(RWTGC)              ADDR OPEN WORK AREA   LD Y02947 17250002
         LR    RCORE,RF                 RESTORE IOBADDRESS    LD Y02947 17300002
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG REGISTER. 17350002
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT PARAMETER     17400002
*                                  LIST REGISTER TO NEXT ENTRY.         17450002
         CLC   0(2,RWTGC),AMIDCNST     IF THE NEXT WTG ENTRY CALLS FOR  17500002
         BCR   8,RBASE             BTAM CLOSE, REEXECUTE THIS EXECUTOR. 17550002
         CLC   0(2,RWTGC),CLOSEIDL                                      17600002
         BL    RELOOP                                                   17650002
         CLC   0(2,RWTGC),CLOSEIDH                                      17700002
         BH    RELOOP                                                   17750002
         LR    RPARC,RPAR               REINITIALIZE CURRENT WTG REG    17800002
         LA    RWTGC,WAOFF(0,RWTG) AND CURRENT PARAMETER LIST REG.      17850002
ZCHECK   CLI   0(RWTGC),X'00'     TEST FOR ZERO ENTRY                   17900002
         BNE   XCTLRTNE            IF NOT ZERO, GO TO TRANSFER CONTROL. 17950002
         LA    RWTGC,WGOFF(0,RWTGC) IF ZERO, GET NEXT ENTRY AND RETURN  18000002
         LA    RPARC,PLOFF(0,RPARC) TO ZCHECK.                          18050002
         B     ZCHECK                                                   18100002
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 18150002
XCTLRTNE EQU   *                                                        18200002
         LA    RJ,DXCCW12               POINT TO DOUBLE WORD LIST.      18250002
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID TO NAME FIELD.          18300002
         MVC   14(3,RWTG),2(RWTGC)      MOVE TTR TO WTG TABLE.          18350002
         XCTL  DE=(RWTG),SF=(E,(15))                                    18400002
         EJECT                                                          18450002
*                                                                     * 18500002
*                                                                     * 18550002
*        THIS ROUTINE WILL UNFIX ALL PAGES THAT WERE FIXED (BUT       * 18610003
*        NOT FREED) BY THE ERROR RECOVERY PROCEDURES. (REMOTE ONLY)   * 18620003
*                                                                     * 18800002
*                                                                     * 18850002
*        SUBROUTINE REGISTER DEFINITION                               * 18900002
*                                                                     * 18950002
*                                                                     * 19000002
         SPACE 3                                                        19050002
GETMNIN  EQU   0                   INPUT FOR GETMAIN          LD Y02947 19100002
ECBREG   EQU   0                   ECB REGISTER FOR PGFREE    LD Y02947 19150002
*        1 LINE DELETED BY THE FOLLOWING APAR                  @ZA03207 19200003
GETMNOUT EQU   1                   OUTPUT FROM GETMAIN        LD Y02947 19250002
FREELIST EQU   1                   START ADDRES FOR PGFREE     @ZA03207 19300003
ENDADDR  EQU   2                   END ADDRESS FOR PGFREE     LD Y02947 19350002
TCBREG   EQU   4                   TCB REGISTER               LD Y02947 19400002
IOBADR   EQU   5                   ADDRESS OF IOB'S           LD Y02947 19450002
IOBSIZE  EQU   6                   SIZE OF IOB'S              LD Y02947 19500002
NUMIOBS  EQU   7                   NUMBER OF IOB'S             @ZA03207 19550003
WORKREG  EQU   8                   WORK REGISTER              LD Y02947 19600002
TCCW     EQU   9                   TCCW ADDR (ERP'S)           @ZA03207 19650003
SAVEREG  EQU   10                  SAVEAREA REGISTER          LD Y02947 19700002
CVTREG   EQU   11                  CVT ADDRESS                LD Y02947 19750002
RTNREG   EQU   14                  RETURN REGISTER            LD Y02947 19800002
LINKREG  EQU   15                  LINK REGISTER              LD Y02947 19850002
         SPACE 5                                                        19900002
FREETCCW EQU   *                                               @ZA03207 19950003
         MODESET EXTKEY=DATAMGT    DATA MANAGEMENT KEY 0F 5    @ZA03207 19960003
         L     GETMNIN,SAVEAREA    GETMAIN BYTES AND SUBPOOL  LD Y02947 20000002
         GETMAIN R,LV=(0)          GETMAIN FOR SAVEAREA       LD Y02947 20050002
         STM   GETMNIN,LINKREG,ZERO(GETMNOUT) SAVE REGS       LD Y02947 20100002
         LR    SAVEREG,GETMNOUT    SAVE ADDRES OF GETMAINT    LD Y02947 20150002
         L     IOBADR,DCBIOBAD     IOBADDR MINUS SIZE         LD Y02947 20200002
         SR    IOBSIZE,IOBSIZE     CLEAR REGISTER 6           LD Y02947 20250002
         IC    IOBSIZE,DCBEIOBX    SIZE OF IOB'S              LD Y02947 20300002
         LA    IOBADR,ZERO(IOBSIZE,IOBADR) ADDR OF 1ST IOB     @ZA03207 20350003
         SR    NUMIOBS,NUMIOBS        CLEAR REG                @ZA03207 20400003
         IC    NUMIOBS,DEBNMEXT       NUMBER OF IOB'S          @ZA03207 20450003
         L     LINKREG,4(WORKREG)     WORKAREA ADDR            @ZA03207 20500003
         MODESET KEYADDR=DXUKEY,WORKREG=14   GET USER KEY      @ZA03207 20550003
         LR    WORKREG,IOBADR         ADDR OF 1ST IOB          @ZA03207 21160003
NEXT     LA    WORKREG,ZERO(IOBSIZE,WORKREG) ADDR NEXT IOB     @ZA03207 21170003
         BCT   NUMIOBS,NEXT           WHEN WE FALL THRU,       @ZA03207 21180003
*                     WORKREG POINTS TO ERP EXT                @ZA03207 21190003
         L     TCBREG,0(WORKREG)        ADDR OF TRANSLATOR...  @ZA03207 21190103
*                  PUT THERE BY IGE0904B...                    @ZA03207 21190203
         LA    TCBREG,0(TCBREG)         CLEAR HIGH ORDER BYTE  @ZA03207 21190303
         LA    WORKREG,4(WORKREG)       POINT TO 1ST ENTRY IN  @ZA03207 21190903
*                        ERP EXT CORRESPONDING TO RLN 1        @ZA03207 21192903
         MODESET EXTKEY=DATAMGT       DATA MANAGEMENT KEY      @ZA03207 21193403
         IC    NUMIOBS,DEBNMEXT       NUMBER OF IOB'S          @ZA03207 21194003
         MODESET KEYADDR=DXUKEY,WORKREG=14   GET USER KEY      @ZA03207 21194603
AGAIN    L     RTNREG,0(WORKREG)      GET ENTRY CONTENTS       @ZA03207 21195203
         LA    RTNREG,0(RTNREG)       CLEAR HI ORDER BYTE      @ZA03207 21196003
         LTR   RTNREG,RTNREG          ENTRY = 0 MEANS NOTHING  @ZA03207 21196403
*                                     NEEDS TO BE UNFIXED      @ZA03207 21197003
         BNZ   UNFIX                  UNFIX NECESSARY PAGES    @ZA03207 21198003
CHECK    LA    WORKREG,4(WORKREG)     ADDR NEXT ERP EXT ENTRY  @ZA03207 21198403
         BCT   NUMIOBS,AGAIN          FINISHED WHEN FALL THRU  @ZA03207 21198803
         B     DONE                   ALL PAGES FREED          @ZA03207 21199403
UNFIX    EQU   *                                               @ZA03207 21200003
*                                                             LD Y02947 21250002
*                                                             LD Y02947 21300002
*        FOR BRANCH ENTRY TO THE TRANSLATOR (IECVTCCW)         @ZA03207 21350003
*        WE MUST BE IN KEY 0, WITH A LOCAL LOCK HELD.         LD Y02947 21400002
*          REG0 = ZERO                                         @ZA03207 21410003
*          REG1 = ADDR OF TCCW                                 @XA03207 21420003
*          REG14 = RETURN ADDR                                 @ZA03207 21442003
*          REG15 = TRANSLATOR (IECVTCCW) ENTRY ADDR            @ZA03207 21444003
*                                                             LD Y02947 21450002
*                                                             LD Y02947 21500002
         SPACE 3                                                        21550002
         MODESET EXTKEY=ZERO       GET KEY 0                  LD Y02947 21600002
         SPACE 3                                                        21650002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(PGFREE,        *21700002
               IGG0203,(RELLOCK))                             LD Y02947 21750002
         SPACE 3                                                        21800002
         SR    ECBREG,ECBREG          ECB ADDR FOR IECVTCCW    @ZA03207 22050003
         L     TCCW,ZERO(WORKREG)     TCCW ADDR FROM ERP EXT   @ZA03207 22100003
         LR    LINKREG,TCBREG         ADDR OF IECVTCCW         @ZA03207 22150003
         MVI   4(TCCW),X'08'        UNFIX OPTION OF TRANSLATOR @ZA03207 22200003
         LR    FREELIST,TCCW            REG1 = TCCW ADDR       @ZA03207 22250003
         BALR  RTNREG,LINKREG      LINK TO PAGE SERVICES      LD Y02947 22400002
         SPACE 3                                                        22450002
RELLOCK  SETLOCK RELEASE,TYPE=LOCAL,RELATED=(PGFREE,IGG0203M,(GETLOCK)) 22500002
         SPACE 3                                                        22550002
NEXTBLK  LTR   FREELIST,FREELIST      END OF CHAIN             @ZA03207 22560003
         BZ    RESET                  YES, CLEAR ERP EXT ENTRY @ZA03207 22570003
         L     GETMNIN,TCCWPOOL    SUBPOOL AND LENGTH          @ZA03207 22572003
         L     TCCW,0(FREELIST)       SAVE LINK POINTER        @ZA03207 22580003
         FREEMAIN R,LV=(0),A=(1)     FREE TCCW                 @ZA03207 22590003
         LR    FREELIST,TCCW          RESET CHAIN BASE         @ZA03207 22592003
         B     NEXTBLK                                         @ZA03207 22594003
RESET    EQU   *                                               @ZA03207 22596003
         L     LINKREG,X20(SAVEREG)   RESTORE REGISTER 8      LD Y02947 22600003
         L     LINKREG,FOUR(LINKREG)  RESTORE WORKAREA ADDR   LD Y02947 22650003
*                                                             LD Y02947 22700002
*                                                             LD Y02947 22750002
*        RETURN TO USER KEY                                   LD Y02947 22800002
*                                                             LD Y02947 22850002
*                                                             LD Y02947 22900002
         SPACE 2                                                        22950002
         MODESET KEYADDR=DXUKEY,WORKREG=14                    LD Y02947 23000002
         SPACE 2                                                        23050002
*                                                             LD Y02947 23100002
         XC    ZERO(4,WORKREG),ZERO(WORKREG) CLEAR TCCW ADDR   @ZA03207 23150003
*                              AFTER FREEING                   @ZA03207 23200003
         B     CHECK                  SEE IF ANY MORE          @ZA03207 23250003
DONE     EQU   *                                               @ZA03207 23300003
         SPACE 2                                                        23650002
         MODESET EXTKEY=DATAMGT       DATA MANAGEMENT KEY      @ZA03207 23660003
         L     GETMNIN,SAVEAREA    SET PARAMETERS FOR FREE    LD Y02947 23700002
         LR    GETMNOUT,SAVEREG    THE SAVEAREA               LD Y02947 23750002
         LM    ENDADDR,LINKREG,EIGHT(SAVEREG) RESTORE REGS    LD Y02947 23800002
         FREEMAIN R,LV=(0),A=(1)   FREE SAVEAREA              LD Y02947 23850002
         L     RJ,4(RWTGC)         WORKAREA ADDRESS            @ZA03207 23900003
         MODESET KEYADDR=DXUKEY,WORKREG=15     USER KEY        @ZA03207 23902003
         B     RETURN                 RETURN TO MAINSTREAM     @ZA03207 23910003
         EJECT                                                          23950002
**********                                                              24000002
*                                                                       24050002
*        CONSTANTS                                                      24100002
*                                                                       24150002
**********                                                              24200002
         DS    0F                                             LD Y02947 24250002
SAVEAREA DC    X'E6000040'         SAVEAREA SUBPOOL AND LNGTH  @ZA03207 24300003
IOBPOOL  DC    X'FA000000'              SUBPOOL NUMBER OF 250 FOR IOB'S 24400002
IRBPOOL  DC    X'FD000000'                                         000E 24450002
TCCWPOOL DC    X'FF0000A0'         SUBPOOL AND LENGTH OF TCCW  @ZA03207 24460003
CLEARMSK DC    X'00000001'                                              24500002
DISABLE  DC    X'2F00000060240001'      DISABLE COMMAND.           000E 24550002
IONOP    DC    X'0300000020240001'      I/O NOP COMMAND            000E 24600002
FULL0    DC    F'0'                   FULL WORD OF ZEROS       @ZA03207 24610003
LIST     DC    X'80000000'            INDICATES A LIST ,       @ZA03207 24620003
*                        RATHER THAN REGISTERS                 @ZA03207 24630003
STRAMID  DC    C'3W'                                               000C 24650002
         DC    X'00000000'                                         000C 24700002
CLOSEIDL DC    C'0B'           LOW RANGE OF ID'S OF LAST LOAD OF CLOSE  24750002
CLOSEIDH DC    C'0G'           HIGH RANGE OF ID'S OF LAST LOAD OF CLOSE 24800002
AMIDCNST DC    C'3M'              ID OF THIS EXECUTOR                   24850002
CLEARCCW DC    X'20240001'              CCW FOR ERASE/WRITE  LD YA03971 24860000
         DC    X'C3'                    WRITE CONTRL CHAR.   LD YA03971 24870000
HEADER   DC    H'32'               HEADER SIZE FOR IRBS     L5 @ZA04082 24880003
TIME     DC    F'50'                                                    24885000
         EJECT                                                          24900002
**********                                                              24950002
*                                                                       25000002
*        REGISTER DEFINITIONS                                           25050002
*                                                                       25100002
**********                                                              25150002
RE       EQU   0                       WORK/PARAMREG                    25200002
RF       EQU   1                       WORK/PARAMREG                    25250002
RTCB     EQU   1                       TCB ADDRESS            LD Y02947 25300002
RDCB     EQU   2                       DCB ADDRESS                      25350002
R2       EQU   RDCB                    WORK REGISTER        LD @ZA00545 25360003
RBASE    EQU   3                       BASE REGISTER                    25400002
RCORE    EQU   4                       IOB ADDRESS                      25450002
RPAR     EQU   5                       START OF PARAMETER LIST          25500002
RWTG     EQU   6                       START OF WTG                     25550002
RPARC    EQU   7                       CURRENT ENTRY IN PARAMETER LIST  25600002
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       25650002
RTIOT    EQU   9                       TIOT ADDRESS                     25700002
RUCB     EQU   10                      CURRENT UCB                      25750002
RDEB     EQU   11                      DEB ADDRESS                      25800002
RB       EQU   12                      WORK REG                         25850002
RC       EQU   13                      WORK REG                         25900002
RD       EQU   14                      WORK/PARAMREG                    25950002
RJ       EQU   15                      WORK/PARAMREG                    26000002
**********                                                              26050002
*                                                                       26100002
*        MISCELLANEOUS EQUATES                                          26150002
*                                                                       26200002
**********                                                              26250002
TCCWFIX  EQU   12                     OFFSET IN TCCW OF FIX    @ZA03207 26260003
*                                           LIST               @ZA03207 26270003
PGFREE   EQU   X'20'                  PAGE FREE FLAG           @ZA03207 26280003
SBPOOL   EQU   255                    TCCW SUBPOOL             @ZA03207 26290003
L160     EQU   160                    TCCW LENGTH              @ZA03207 26292003
LEN4     EQU   4                                                        26300002
LOOPCNT  EQU   4095                LOOP COUNT                LD YA02169 26350002
IRBSTAB  EQU   10                  DISPLACE FOR IRBSTAB FLAGS   YA01235 26400002
WAOFF    EQU   32                       OFFSET OF FIRST WTG ENTRY FROM  26450002
*                                  START OF WTG.                        26500002
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES.          26550002
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES.          26600002
PURGEOPT EQU   X'E0'               OPTION BYTE FOR PURGE                26650002
PURGOPTN EQU   X'A0'               OPTION BYTE FOR PURGE    LD @ZA00546 26660003
ZERO     EQU   0                                              LD Y02947 26700002
ONE      EQU   1                                              LD Y02947 26750002
FIVE     EQU   5                                              LD Y02947 26800002
EIGHT    EQU   8                                              LD Y02947 26850002
IDALNGTH EQU   320                 LENGTH OF TWO IDAL'S       LD Y02947 26900002
TCBFLG   EQU   29                                                       26950002
ABCLOSE  EQU   X'04'                                                    27000002
UCBFL1   EQU   6                                                        27050002
UCBTYP   EQU   16                                                       27100002
ARMSEEK  EQU   X'02'                                                    27150002
SWITCHED EQU   X'90'                                                    27200002
IBM32701 EQU   X'82'                                                    27250002
RESETPL  EQU   X'01'                                                    27300002
BUSY     EQU   X'40'                                                    27350002
CCPOLL   EQU   X'09'                                               000E 27400002
CCNOOP   EQU   X'03'                                               000E 27450002
CCTIC    EQU   X'08'                                               000E 27500002
COMCHAIN EQU   X'40'                                               000E 27550002
APOLL    EQU   X'40'                                               000E 27600002
TRMTST   EQU   X'10'                                                    27650002
CCPREPAR EQU   X'06'                                                    27700002
CCENABLE EQU   X'27'                                                    27750002
CCWCCSLI EQU   X'60'                                                    27800002
GRPHCDVC EQU   X'10'               GRAPHIC DEVICE CLASS                 27850002
UCBCLASS EQU   18                  DISP TO DEVICE CLASS IN UCB          27900002
ANRATNXT EQU   14                  LENGTH OF ATTN HANDLING FIELDS       27950002
*                                       IN UCB EXTENSION                28000002
OLTEP    EQU   X'80'               UCB OLTEP FLAG                       28050002
X20      EQU   X'20'               REG 8 DISP. IN SAVEAREA    LD Y02947 28100002
XE8      EQU   X'E8'               MASK FOR LINE HUNGED UP   LD YA02169 28150002
X05      EQU   X'05'                    OPCODE FOR ER/WR CCW LD YA03971 28170000
ALLON    EQU   X'FF'               MASK OF ALL ONE'S                    28200002
ATNIRBSZ EQU   116                 SIZE OF ANR ATTN IRB & IQE           28250002
ATNIRBAD EQU   28                  DISP TO IRB ADDR IN UCB              28300002
UCBGCB   EQU   27                  DISP TO GCB IN UCB                   28350002
UCBGRAF  EQU   28                 DISP TO GRAPHIC STATUS       @YA02128 28360002
RDYQ     EQU   32                 OFFSET TO READY IRB POINTER  @YA02128 28370002
IGG019UP EQU   X'01'              FLAG FOR DEFAULT ROUTINE     @YA02128 28390002
UCBATTN  EQU   26                  DISP TO ATTN FIELDS IN UCB           28400002
L1       EQU   1                                               @ZA08049 28405003
TWO      EQU   2                                             LD YA03240 28410000
L3       EQU   3                                               @ZA08049 28415003
THREE    EQU   3                                             LD YA03240 28420000
L4       EQU   4                                               @ZA08049 28430003
FOUR     EQU   4                                                        28450002
L8       EQU   8                                               @ZA09347 28454000
NINE     EQU   9                                             LD YA03240 28458000
TWELVE   EQU   12                                           LD @ZA00546 28458403
SIXTEEN  EQU   16                  DISPLACEMENT             LD @ZA00546 28460003
NXTAVAL  EQU   X'60'               NEXT AVAILABLE IQE        LD YA03240 28466000
RBSTAB   EQU   11                  STATUS AND ATTRIBUTE BIT  LD YA03240 28474000
RBEP     EQU   12                  ENTRY POINT               LD YA03240 28482000
RBOPSW   EQU   20                  OLD PSW                   LD YA03240 28490000
NOPGFIX  EQU   X'7F'       NO PAGE FIX REQUIRED IN DEB AVT     @ZA02840 28492003
L3270    EQU   X'58'      SIZE OF LOCAL 3270 IOB               @ZA08049 28496003
TIMELNG  EQU   4                                                        28497000
         EJECT                                                          28500002
CVT      DSECT                                                LD Y02947 28550002
         CVT                                                            28600002
         EJECT                                                          28650002
         DCBD  DSORG=BX                                                 28700002
         EJECT                                                          28750002
         IECDSECS WTG,PREFX,EXPAND=YES                        LD Y02947 28800002
         EJECT                                                          28850002
         IECTDEBX                                                       28900002
         EJECT                                                          28950002
         IECTIOBX                                                       29000002
         EJECT                                                          29050002
         IHAPSA                                                         29100002
         EJECT                                                          29150002
WORKAREA DSECT                                                   Y02947 29200002
         IECDSECT IOB=NO                                         Y02947 29250002
         EJECT                                                          29300002
         IKJTCB DSECT=YES                                               29350002
         END                                                            29400002
