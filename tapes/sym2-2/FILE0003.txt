./  ADD  SSI=73150047,NAME=IEBPPAL1
 TITLE 'IEBPPAL1-IEBPTPCH CONTROL CARD ANALYZER'                   1769 00020014
*                                                                       00040000
*    IEBPPAL1        CONTROL CARD ANALYZER OF PRINT/PUNCH               00060000
*                                                                       00080000
*                                                                       00100000
*                                                                       00120000
*RECEIVES CONTROL FROM THE ROOT SEGMENT AND CALLS THE CONTROL CARD SCAN 00140000
*MODULE (IEBCCS02). THE CONTROL CARDS ARE READ AND SCANNED IN IEBCCS02, 00160000
*BUT THEIR VALIDITY IS CHECKED IN IEBPPAL1.                             00180000
*IF AN ERROR OCCURS,IEBPPAL1 LOADS THE ERROR MESSAGE NUMBER IN REGISTER 00200000
*ZERO,AND THE OFFSET IN REGISTER ONE. A BRANCH IS TAKEN TO THE MESSAGE  00220000
*WRITER IN IEBPPUN1.                                                    00240000
*THE CONDITION CODE IS SET ACCORDING TO THE SEVERITY OF THE ERROR, AND  00260000
*THE REMAINDER OF THE CONTROL CARDS ARE SCANNED. THE CONDITION CODE IS  00280000
*EXAMINED ON RETURN TO IEBPPUN1. IF IT IS TWELVE OR HIGHER, THE REQUEST 00300000
*IS TERMINATED.                                                         00320000
*WHEN IEBCCS02 SENDS IEBPPAL1 AN END OF FILE INDICATION,A DIAGNOSTIC IS 00340000
*PERFORMED. A CHECK IS MADE WHETHER THE MAXLINE PARAMETER WAS SPECIFIED 00360000
*IF IT WAS,WE CHECK THAT THE BASIC SPACING AND TITLE PARAMETERS EXCEED  00380000
*THIS COUNT AT THE START.                                               00400000
*                                                                       00420000
*        ENTRY POINT    IEBPPAL1                                        00440000
*                                                                       00460000
*        INPUT          CONTROL STATEMENTS, READ AND PASSED TO THIS     00480000
*                       MODULE BY THE CONTROL SCAN ROUTINE. ALSO        00500000
*                       PASSED TO THIS MODULE ARE CONTROL BYTES SET     00520000
*                       BY THE SCAN ROUTINE.                            00540000
*                                                                       00560000
*        OUTPUT         ERROR DIAGNOSTICS ARE INITIATED BY THIS         00580000
*                       ROUTINE. THE CONTROL TABLE IS BUILT AND         00600000
*                       PASSED TO THE MAIN PROCESSOR.                   00620000
*                                                                       00640000
*        EXTERNAL RTNS  CALLS THE SCAN ROUTINE, WHICH READS THE         00660000
*                       CONTROL STATEMENTS AND PASSES PARAMETER         00680000
*                       INFORMATION.  GOES TO ZZPR,WHICH PRINTS         00700000
*                       DIAGNOSTICS AND INFORMATIONAL MESSAGES.         00720000
*                       THE LINK IS DONE BY A BALR.                     00740000
*                                                                       00760000
*        EXITS          NOT APPLICABLE.                                 00780000
*                                                                       00800000
*        WORK AREAS     AREA FOR MEMBER NAME TABLE OF A PARTIAL         00820000
*                       PDS  IS REQUESTED.  TABLE FOR  RECORD           00840000
*                       STATEMENT INFORMATION (IDENTS-FIELDS).          00860000
         EJECT                                                          00880000
*                                                                       00900000
*                  FORMAT OF MEMBER NAME TABLE                          00920000
*                                                                       00940000
*              *                                                        00960000
*              *4 BYTES * 8 BYTES        *4 BYTES *                     00980000
*              ************************************                     01000000
*              *MEMBERCT*MEMBER NAME     *MCB ADDR*                     01020000
*              ************************************    ***************  01040000
*                       *MEMBER NAME     *MCB ADDR*    TOTAL AREA =     01060000
*                       ***************************    (MEMCOUNT X 12)  01080000
*                       *MEMBER NAME     *MCB ADDR*    +4               01100000
*                       ***************************    ***************  01120000
*                                                                       01140000
*                                                                       01160000
*        FORMAT OF GETMAIN AREA FOR GROUP CONTROL BLOCKS (GCB)     1769 01164014
*        AND FIELD CONTROL BLOCKS (FCB)                            1769 01168014
*                                                                  1769 01172014
*                                                                  1769 01176014
* 2 BYTES- NUMBER OF GCB'S FOLLOWING                               1769 01180014
*                                                                  1769 01184014
*                                                                  1769 01188014
* 8 BYTES- FIRST GCB                                               1769 01192014
*          2 BYTES- NUMBER OF FCB'S FOR THIS GCB                   1769 01196014
*          2 BYTES- LENGTH OF CURRENT IDENT LITERAL                1769 01200014
*          2 BYTES- DISPLACEMENT OF CURRENT IDENT IN LITERAL POOL  1769 01204014
*          2 BYTES- INPUT LOCATION MINUS 1 OF CURRENT IDENT        1769 01208014
*                                                                  1769 01212014
* 8 BYTES- FIRST FCB FOR FIRST GCB                                 1769 01216014
*          2 BYTES- LENGTH OF FIELD                                1769 01220014
*          2 BYTES- INPUT LOCATION MINUS 1                         1769 01224014
*          2 BYTES- CONVERSION CODE                                1769 01228014
*          2 BYTES- OUTPUT LOCATION MINUS 1                        1769 01232014
*                                                                  1769 01236014
* 8 BYTES- SECOND FCB FOR FIRST GCB                                1769 01240014
*    *                                                             1769 01244014
*    *                                                             1769 01248014
*    *                                                             1769 01252014
* 8 BYTES- N'TH FCB FOR FIRST GCB                                  1769 01256014
*                                                                  1769 01260014
*                                                                  1769 01264014
* 8 BYTES- SECOND GCB                                              1769 01268014
*                                                                  1769 01272014
* 8 BYTES- FIRST FCB FOR SECOND GCB                                1769 01276014
*    *                                                             1769 01280014
*    *                                                             1769 01284014
*    *                                                             1769 01288014
* 8 BYTES- N'TH FCB FOR SECOND GCB                                 1769 01292014
*                                                                  1769 01296014
*                                                                  1769 01300014
*  *                                                               1769 01304014
*  *                                                               1769 01308014
*  *                                                               1769 01312014
*                                                                  1769 01316014
*                                                                  1769 01320014
* 8 BYTES- N'TH GCB                                                1769 01324014
*    *                                                             1769 01328014
*    *                                                             1769 01332014
*    *                                                             1769 01336014
*                                                                  1769 01340014
*                                                                       01360000
*                                                                       01380000
*        ATTRIBUTES     NON-REUSABLE                                    01400000
*                                                                       01420000
*********************************************************************** 01440000
         EJECT                                                          01460000
*                                                                       01480000
IEBPPAL1 CSECT                                                          01520000
* 120650                                                          M3306 01520818
* 109120-109240,214700                                            M3310 01521618
* 167420-167520                                                   M3311 01522418
* 150402-150404,165420-165440                                     M3312 01523218
* 109140-109220,214700                                           A25956 01524018
*3416079600,075400-075600                                        A21407 01525018
*3416082460,082640                                               A21407 01531018
*3416016200-016600,023200,024200,024600,025800,026000,026250,      SA0I 01537118
*027000,027800,028600,029400,030200,031000,031600,032200,032800,   SA0I 01537218
*033400,034000,035600,036200,                                      SA0I 01537318
*037200,038000,038800,039600,040400,041200,                        SA0I 01537418
*042600,042800,043400,044200-044400,046200,053000,064400-065600,   SA0I 01537518
*067000,067400,067600,068000,068200,068600,069000,069600,070000,   SA0I 01537618
*071000,071450,071550,071600,075400-075600,076000-076200,077400,   SA0I 01537718
*077800,079600,086400-086600,089800-090800,100800,101200,105200,   SA0I 01537818
*105400,106600,106800,106920,                                      SA0I 01537918
*107600,108000,108400,109200,110400,112600,                        SA0I 01538018
*114600,114680,117600,120800,121050,121600,122400,123200,124000,   SA0I 01538118
*124200,125000,125400,125800,126200,128200-128800,130600,130800,   SA0I 01538218
*132400,132600,132800,133400,133800,134200,138000,139000-139200,   SA0I 01538318
*139400,142208,142228,142240,142248,142260,142300-142310,142316,   SA0I 01538418
*142328,142336,142344,143400,143520,146000,149000,149200,149600,   SA0I 01538518
*149800,151200,152400,152600,153000,154400,154800,160200,166200,   SA0I 01538618
*166600,169000,169600,170000,173400,                               SA0I 01538718
*177400-177600,177700,178400,182000-                               SA0I 01538818
*182200,187600-188700,189600-192200,192300-192350,193000,193800-   SA0I 01538918
*194000,194800,195600-196200,208400                                SA0I 01539018
*082440-082620                                                    M4118 01539318
*056200                                                           24304 01540319
*101800                                                           29476 01541319
*085200,085400                                                    25790 01542319
*073720-073380,225204-225216                                      27715 01545319
*120600,020650,127400                                             28397 01548319
*142201-142204,142206,142324,142332,142340,142348                 29608 01551319
* 130500,130600,131000,137000,137200,143020                      A35450 01552320
*                                                                A36048 01552721
*130850-130950                                                   A36082 01553121
*                                                                A36090 01553521
*163800                                                          A36097 01553921
*084000                                                          A38738 01554021
*A135700                                                         A45130 01554121
*A041400,041700-041760,135700,19300,229300                       A45135 01554221
*D041400                                                         A45135 01560621
*A043720-043760                                                  A41815 01562621
*C043200                                                         A41815 01564621
*A077624,113900-114200,214720                                   OY01168 01565216
*C101600,102000,109000,109060,113400,114000,114520,114640,114800,Y01168 01565816
*C218600                                                        OY01168 01566416
*D110200,110400,112400,112600,113600-114200                     OY01168 01573616
*A092900,092920,135100,135120,178440                            OY01169 01574616
*C093600,178400                                                 OY01169 01575616
*C073160,073320                                                 OY01170 01576616
*A 110900-110984,111300,196120                                 @ZA04419 01578699
*A079410,079420                                                @ZA06525 01578799
*C079440                                                       @ZA06525 01578899
*A110930,110950,114624                                         @ZA07319 01578999
*C110940,110960,114600                                         @ZA07319 01579099
*D110980                                                       @ZA07319 01579199
*C196120                                                       @ZA18364 01579599
*A110830-110890,110910,110970           (ORG)@XA19750,@YA19580,@ZA27264 01580099
*A111010-111310                         (ORG)@XA19750,@YA19580,@ZA27264 01580599
*C110930,110950,114480,115050-115150    (ORG)@XA19750,@YA19580,@ZA27264 01581099
*C196120                                (ORG)@XA19750,@YA19580,@ZA27264 01581599
*D110900,110920,110940,110960,110984    (ORG)@XA19750,@YA19580,@ZA27264 01582099
*D111000,111200,111300,114520-114640    (ORG)@XA19750,@YA19580,@ZA27264 01582599
         SAVE  (14,12),T,IEBPPAL1-OZ27264                      @ZA27264 01584099
*                                                                       01586016
         TM    0(R1),X'80'         TEST FOR ERROR                       01592016
         BO    0(R14)              ERROR-IMMEDIATE EXIT                 01600000
         BALR  BASER,R0            SET UP ADDRESSABILITY           SA0I 01610018
         USING HOWIE3,BASER,BASE                                   SA0I 01620018
HOWIE3   L     BASE,BASEADDR                                       SA0I 01630018
         B     PKUP                                                SA0I 01640018
BASEADDR DC    A(HOWIE3+4096)                                      SA0I 01650018
PKUP     ST    R13,SAVEADD+4       STORE SAVE REG                  SA0I 01660018
         LA    R1,SAVEADD               GET PTR TO SAVE AREA            01680000
         ST    R1,8(R13)                STORE PTR TO S.A. IN SAVE AREA  01700000
         L     R1,24(R13)               RESTORE R1                      01720000
         LA    R13,SAVEADD         OWN SAVE AREA IN SAVE REGISTER       01740000
         ST    R1,PARMADR          SAVE ADDRESS IN REG 1           4304 01744019
         L     R1,4(R1)            GET FREE ADDR FROM PARM PASSED  4304 01748019
         MVC   FREEA(4),0(R1)      GET ADDR OF FREECORE TABLE      4304 01752019
         L     R1,PARMADR          RESTORE REG 1                   4304 01756019
         L     R1,0(R1)            GET DDNAME FOR SYSIN -ADDRESS OF     01760000
         MVC   PPSYSI(8),0(R1)    MOVE DDNAME FOR SYSIN                 01780000
*                                                                       01800000
*                                                                       01820000
         MVI   PPWORK,0           ZERO TO WORK AREA                     01840000
         MVC   PPWORK+1(WORKLEN-1),PPWORK    ZERO WORK AREA             01860000
         MVC   SKIPSW(2),PH1                 TURN OFF SKIP SWITCH       01880000
         MVC   PLANT(2),PH1        TURN OFF SWITCH                      01900000
*                                                                       01920000
         LA    RZ,DLEN             ADDRESS OF DTABLE LENGTH INDICATOR   01940000
         ST    TEMP3,TEMPSAVE          SAVE CONTENTS OF REG 3      4304 01943019
         L     TEMP3,FREEA             USE REG 3 TO ESTAB ADDRESS  4304 01946019
         USING FREECOR,TEMP3           FOR FREECOR DSECT           4304 01949019
         ST    RZ,DTBL                 STORE TBLE LENG TO FREE     4304 01952019
         MVI   MAIN1,X'10'             TURN ON GET MAIN SWTCH      4304 01955019
         GETMAIN R,LV=(0)                                               01960000
         ST    R1,DTBA             STORE DTBLE ADDR FOR FREE       4304 01965019
         L     TEMP3,TEMPSAVE          RESTORE REG 3 CONTENTS      4304 01970019
         DROP  3                                                   4304 01975019
         LR    TREG,R1             ADDRESS OF GETMAIN AREA              01980000
         USING DTABLE,TREG         GETMAIN BASE FOR DSECT               02000000
         MVI   DBEGIN,0            ZERO TO FIRST BYTE OF DTABLE         02020000
         MVC   DBEGIN+1(DLEN-1),DBEGIN       ZERO OUT DTABLE            02040000
         MVI   EXLST,C' '          BLANK FIRST BYTE EXIT LIST           02060000
         MVC   EXLST+1(EXLEN-1),EXLST        BLANK EXIT LIST            02080000
*                                                                       02100000
         MVI   RECSW,X'00'        CLEAR RECORD BYPASS SWITCH            02110020
         MVC   TABLE(TABLEN),TABLE-1         ZERO SWITCHES,POINTERS     02120000
         LA    TEMP1,120                     LOAD REGISTER WITH 12/     02140000
         STH   TEMP1,MAXOUT                  MAXIMUM PRINT LINE LENGTH  02160000
         MVI   INITPG+1,1          FIRST PAGE NUMBER DEFAULT=1          02180000
         EJECT                                                          02200000
*                                                                       02220000
*********************************************************************** 02240000
*              RETURN FROM INITIAL CALL TO SCANNER SHOULD BE COMMAND    02260000
*              TO PRINT OR PUNCH.                                       02280000
*                                                                       02300000
         LA    ERREG,PPERRC        LOAD ADDRESS OF MESSAGE ROUTINE      02340000
         BAL   BREG,CALLSCAN       BRANCH AND LINK TO CALL MACRO        02360000
PTCOM    OI    BIT,X'01'           TURN OFF FIRST CARD BIT         SA0I 02370018
         TM    PPWORK,COMM        TEST FOR COMMAND                      02380000
         BZ    0(ERREG)            NO,TERMINATE                         02400000
         CLC   CPRINT(6),0(R1)    DOES COMMAND=PRINT               SA0I 02420018
         BE    PPCOM              COMMAND IS PRINT                      02440000
         CLC   CPUNCH(6),0(R1)    DOES COMMAND=PUNCH               SA0I 02460018
         BNE   0(ERREG)            NEITHER PRINT NOR PUNCH-TERMINATE    02480000
*                                                                       02500000
         MVI   PPSW1,X'01'         SET PPSW1 FOR PUNCH                  02520000
         LA    TEMP1,80            LOAD REGISTER WITH 80                02540000
         STH   TEMP1,MAXOUT        MAXIMUM PUNCH CARD CAPACITY          02560000
PPCOM    LA    ERREG,PPERRH        ADDRESS OF MSG RTN              SA0I 02580018
         BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 02590018
PPCOM1   TM    PPWORK,PAR          TEST FOR PARAMETER              0033 02605015
         BZ    PPK0                NO, B AROUND PARAM CHECK        0033 02610015
         LTR   RZ,RZ               IS PARAM LENGTH ZERO            0033 02615015
         BE    PPCOM               YES, B TO SCAN AGAIN            0033 02620015
         B     PPERRH              BRANCH TO ERROR MESSAGE         SA0I 02625018
PPK0     TM    PPWORK,KEYW         TEST FOR KEYWORD                0033 02630015
         BZ    GETSTOR            NO,END OF CARD                        02640000
*                                                                       02660000
*              COMMAND IS PRINT OR PUNCH. TEST FOR VALID KEYWORD        02680000
*                                                                       02700000
         NI    PPWORK+81,X'FD'     SET OFF KEYWORD REQUIRED BIT    SA0I 02710018
         MVC   PPCSW1(1),PDZERO    ZERO TO SWITCH                       02720000
         LA    BREG,PPSCANP        ADDRESS OF PARAM CHECK               02740000
         LA    KREG,PPSETPB        ADDRESS OF CVB ROUTINE               02760000
         CLC   KTYPORG(7),0(R1)   COMPARE FOR KEYWORD TYPORG       SA0I 02780018
         BNE   PPK1                NOT TYPORG KEYWORD                   02800000
         LA    KREG,TYPORGP        ADDRESS OF TYPORG VALIDITY CHECK     02820000
         BR    BREG                BRANCH TO PARAM CHECK                02840000
PPK1     CLC   KTOTCONV(8),0(R1)  COMPARE FOR TOTCONV KEYWORD      SA0I 02860018
         BNE   PPK2A               NOT TOTCONV KEYWORD                  02880000
         LA    KREG,TOTCONVP       ADDR OF TOTCONV TYPE CHECK           02900000
         BR    BREG                BRANCH TO PARAM CHECK                02920000
PPK2A    CLC   KPREFRM(8),0(R1)   TEST FOR KEYWORD PREFORM         SA0I 02940018
         BNE   PPK2                NOT PREFORM KEYWORD                  02960000
         LA    KREG,FORMATED       ADDRESS OF FORMAT CHECK              02980000
         BR    BREG                BRANCH TO PARAM CHECK                03000000
PPK2     CLC   KCNTRL(6),0(R1)    COMPARE FOR CNTRL KEYWORD        SA0I 03020018
         BNE   PPK3                NOT CNTRL KEYWORD                    03040000
         LA    KREG,CNTRLP         ADDRESS OF CNTRL CHECK               03060000
         BR    BREG                BRANCH TO PARAM CHECK                03080000
PPK3     CLC   KINITPG(7),0(R1)   COMPARE FOR INITPG KEYWORD       SA0I 03100018
         BNE   PPK4                NOT INITPG KEYWORD                   03120000
         TM    PPSW1,X'01'         TEST FOR PUNCH                       03140000
         BO    PPERRH              INITPG VALID ONLY FOR PRINT     SA0I 03160018
         LA    PARLOC,INITPG       ADDRESS OF INITIAL PAGE NO INDICATOR 03180000
         BR    BREG                BRANCH TO PARAM CHECK                03200000
PPK4     CLC   KMAXLINE(8),0(R1)  COMPARE FOR MAXLINE KEYWORD      SA0I 03220018
         BNE   PPK5                NOT MAXLINE KEYWORD                  03240000
         TM    PPSW1,X'01'         TEST FOR PUNCH                       03260000
         BO    PPERRH              MAXLINE VALID ONLY FOR PRINT    SA0I 03280018
         LA    PARLOC,PMAXLINE     ADDR OF MAX LINES PER PAGE INDICATOR 03300000
         BR    BREG                BRANCH TO PARAM CHECK                03320000
PPK5     CLC   KCDSEQ(6),0(R1)    COMPARE FOR CDSEQ KEYWORD        SA0I 03340018
         BNE   PPK6                NOT CDSEQ KEYWORD                    03360000
         TM    PPSW1,X'01'         TEST FOR PUNCH                       03380000
         BZ    PPERRH              CDSEQ INVALID IF NOT PUNCH      SA0I 03400018
         OI    PPCSW1,X'02'        ( SET SWITCH)                        03420000
         OI    PPSW1,X'02'                                              03440000
         OI    PPWORK+140,X'01'                                         03460000
         LA    PARLOC,CDNOB        ADDRESS OF INITIAL SEQUENCE NUMBER   03480000
         LA    KREG,FPSETPB             ADDR BIN CONV ROUTINE FOR       03500000
*                                        FULLWORD COUNTER               03520000
         BR    BREG                BRANCH TO PARAM CHECK                03540000
PPK6     CLC   KCDINCR(7),0(R1)   COMPARE FOR CDINGR KEYWORD       SA0I 03560018
         BNE   PPK7                NOT CDINCR KEYWORD                   03580000
         TM    PPSW1,X'01'         TEST FOR PUNCH                       03600000
         BZ    PPERRH              CDINCR INVALID IF NOT PUNCH     SA0I 03620018
         LA    PARLOC,CDINCRB      ADDRESS OF INCREMENT                 03640000
         LA    KREG,FPSETPB             ADDR BIN CONV ROUTINE FOR       03660000
*                                        FULLWORD COUNTER               03680000
         BR    BREG                BRANCH TO PARAM CHECK                03700000
PPK7     CLC   KSTOPAFT(8),0(R1)  COMPARE FOR STOPAFT KEYWORD      SA0I 03720018
         BNE   PPK8                NO STOPAFT KEYWORD                   03740000
         LA    PARLOC,INITSTOP     ADDRESS OF STOP DATA                 03760000
         BR    BREG                BRANCH TO PARAM CHECK                03780000
PPK8     CLC   KSKIP(5),0(R1)     COMPARE FOR SKIP KEYWORD         SA0I 03800018
         BNE   PPK9                NOT SKIP KEYWORD                     03820000
         LA    PARLOC,INITSKIP     ADDRESS OF SKIP DATA                 03840000
         BR    BREG                BRANCH TO PARAM CHECK                03860000
PPK9     CLC   KMAXNAME(8),0(R1)  COMPARE FOR MAXNAME KEYWORD      SA0I 03880018
         BNE   PPK10               NOT MAXNAME KEYWORD                  03900000
         LA    PARLOC,MAXNAME      ADDRESS OF MAXIMUM MEMBER STATEMENTS 03920000
         BR    BREG                BRANCH TO PARAM CHECK                03940000
PPK10    CLC   KMAXFLDS(8),0(R1)  COMPARE PUR MAXFLDS KEYWORD      SA0I 03960018
         BNE   PPK11               NOT MAXFLDS KEYWORD                  03980000
         LA    PARLOC,MAXFLDS      ADDRESS OF MAXIMUM FIELD PARAMETERS  04000000
         BR    BREG                BRANCH TO PARAM CHECK                04020000
PPK11    CLC   KMAXGPS(7),0(R1)   COMPARE FOR MAXGPS KEYWORD       SA0I 04040018
         BNE   PPK12               NOT MAXCPS KEYWORD                   04060000
         LA    PARLOC,MAXGPS       ADDRESS OF MAXIMUM IDENT PARAMETERS  04080000
         BR    BREG                BRANCH TO PARAM CHECK                04100000
PPK12    CLC   KMAXLITS(8),0(R1)  COMPARE FOR MAXLITS KEYWORD      SA0I 04120018
         BNE   PPK13               NOT MAXLITS KEYW, GO TO NEXT  A45135 04140021
         LA    PARLOC,MAXLITS      ADDR OF MAX IDENT LITERAL CHARACTERS 04160000
         BR    BREG               BRANCH TO PARAMETER CHECK      A45135 04170021
PPK13    CLC   KSTRTAFT,0(R1)      COMPARE FOR STARTAT KEYWORD   A45135 04172021
         BNE   0(ERREG)           ERROR, INVALID KEYWORD         A45135 04174021
         LA    PARLOC,STRTAFT     ADDR OF START NBR              A45135 04176021
         EJECT                                                          04180000
*                                                                       04200000
*              EXAMINE PRINT/PUNCH PARAMETERS                           04220000
*                                                                       04240000
PPSCANP  LA    ERREG,PPERRJ        ADDRESS OF MSG ROUTINE          SA0I 04250018
         OI    PPWORK+81,X'01'     SET ON PARAMETER REQUIRED BIT   SA0I 04260018
         BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 04270018
         NI    PPWORK+81,X'FE'     SET OFF PARAMETER REQUIRED BIT  SA0I 04280018
         TM    PPWORK,PAR          HAVE A PARAMETER?                    04300000
         BO    PARTEST             YES, TEST FOR PARAM. LENGTH   A41815 04320021
         LA    ERREG,PPERRH        ADDRESS OF MSG RTN              SA0I 04340018
         B     PPCOM1              BACK TO KEYWORD CHECK                04360000
PARTEST  LTR   RZ,RZ               PARAM. LENGTH ZERO ?          A41815 04372021
         BE    PPERRJ              YES, PRINT MESS. IEB432I      A41815 04374021
         B     0(KREG)             NO, CONT PARAM CHECKING       A41815 04376021
*                                                                       04380000
TYPORGP  CLC   PPS(2),0(R1)        COMPARE FOR TYPORG PARAM PHYS SEQ    04400000
         BNE   DENNIS              NO-CONTINUE                     SA0I 04410018
         CH    RZ,PH2              IS PARAM LENGTH=2?              SA0I 04420018
         BNE   PPERRJ              NO-BRANCH TO ERROR MSG          SA0I 04430018
         B     PPCOM               PHYS SEQ ORG- TO SCAN                04440018
DENNIS   CLC   PPO(2),0(R1)        COMPARE FOR TYPORG PARTITIONED  SA0I 04450018
         BNE   0(ERREG)            IF NEITHER PS NOR PO,INVALID PARAM   04460000
         CH    RZ,PH2              IS PARAM LENGTH=2?              SA0I 04466018
         BNE   PPERRJ              NO-B TO ERR MSG                 SA0I 04472018
         OI    TYPORG,X'01'        RESET TYPORG TO PO                   04480000
         B     PPCOM               BRANCH TO SCAN                       04500000
*                                                                       04520000
TOTCONVP CLC   PHE(2),0(R1)        COMPARE FOR PARAMETER HE             04540000
         BE    ORR                 TREATED AS HEX PARAMETER XE          04560000
         CLC   PXE(2),0(R1)        COMPARE FOR HEX PARAMETER XE         04580000
         BNE   TOTCP5              NOT HE OR XE - BRANCH TO RZ TEST     04600000
ORR      CH    RZ,PH2              IS PARAM LENGTH=2?              SA0I 04610018
         BNE   PPERRJ              NO-BRANCH TO ERROR MSG          SA0I 04620018
         OI    TOTCONV,X'01'       RESET TOTCONV FOR HEX           SA0I 04630018
         B     PPCOM               BRANCH TO SCAN                       04640000
TOTCP5   CLC   PPZ(2),0(R1)        COMPARE FOR UNPACKED DECIMAL PARAM   04660000
         BNE   0(ERREG)            NONE OF ABOVE-INVALID PARAMETER      04680000
         CH    RZ,PH2              IS PARAM LENGTH=2?              SA0I 04686018
         BNE   PPERRJ              NO-BRANCH TO ERROR MSG          SA0I 04692018
         OI    TOTCONV,X'03'       SET TOTCONV FOR UNPACKED DECIMAL     04700000
         B     PPCOM               BRANCH TO SCAN                       04720000
*                                                                       04740000
CNTRLP   BAL   BREG,SETPBIN        CONVERT PARAMETER TO BINARY          04760000
         LA    TEMP1,3                                                  04780000
         TM    PPSW1,1             TEST FOR PUNCH                       04800000
         BZ    CP5                 NOT PUNCH,THEREFORE PRINT            04820000
         BCTR  TEMP1,R0            SUBTRACT ONE FOR PUNCH               04840000
CP5      CR    PREG,TEMP1          TEST PARAM AGAINST 2(PUN) OR 3(PR)   04860000
         BCR   2,ERREG            BRANCH IF PARAM ABOVE MAXIMUM         04880000
         LTR   PREG,PREG           TEST FOR ZERO PARAMETER              04900000
         BNH   0(ERREG)            ONLY ABOVE ZERO VALID                04920000
         STC   PREG,PPCTL          SET CONTROL FOR GIVEN PARAMETER      04940000
         B     PPCOM               BRANCH TO SCAN                       04960000
*                                                                       04980000
*  BRANCH TO CONVERT TO BINARY ROUTINE FOR THE FOLLOWING PARAMETERS     05000000
*   CDSEQ (VALUE CARD SEQUENCE NUMBER IS TO BEGIN WITH)                 05020000
*   CDINCR (VALUE CARD SEQUENCE NUMBER IS TO BE INCREMENTED)            05040000
*   USE OF FULLWORD COUNTERS ALLOWS SEQUENCE NUMBERS TO 99,999,999 DEC  05060000
*                                                                       05080000
FPSETPB  BAL   BREG,SETPBIN             GO TO CONVERT ROUTINE           05100000
         ST    PREG,0(PARLOC)           PLACE CONV. VALUE IN DTABLE     05120000
         B     PPCOM                    FINISHED WITH THIS PARAMETER    05140000
*                                                                       05160000
*  BRANCH TO CONVERT TO BINARY ROUTINE FOR PARAMETERS WITH HALFWORD CTR 05180000
*                                                                       05200000
FORMATED CLI   0(R1),C'A'          TEST FOR CONTROL CHARACTER           05220000
         BE    SLIPDOWN            YES-BRANCH TO SWITCH SET             05240000
         CLI   0(R1),C'M'          TEST FOR CONTROL CHARACTER      SA0I 05246018
         BNE   PPERRJ              BRANCH TO ERROR MESSAGE         SA0I 05252018
         OI    PREFMTP,X'01'       SET FORMAT SWITCH                    05260000
         B     PPCOM               BRANCH TO SCAN                       05280000
SLIPDOWN CH    RZ,PH1              IS PARAM LENGTH =1?             SA0I 05290018
         BNE   PPERRJ              NO-BRANCH TO ERROR MSG          SA0I 05300018
         OI    PREFMTP,X'80'       SET FORMAT SWITCH               SA0I 05310018
         B     PPCOM               BRANCH TO SCAN                       05320000
*              CONVERT PARAMETER TO BINARY                              05340000
PPSETPB  BAL   BREG,SETPBIN       CONVERT TO BINARY                     05360000
         STH   PREG,0(PARLOC)     STORE PARAMETER                       05380000
         B     PPCOM               BRANCH TO SCAN                       05400000
*                                                                       05420000
*              GET STORAGE FOR TABLES                                   05440000
*                                                                       05460000
GETSTOR  TM    TYPORG,1            TEST TYPE OF ORGANIZATION            05480000
         BZ    GS5                 SDS,NO MEMBER NAME TABLE             05500000
         LH    RZ,MAXNAME          TEST FOR                             05520000
         LTR   RZ,RZ               NAMED MEMBERS                        05540000
         BE    GS5A                NO NAMED MEMBERS                     05560000
         MH    RZ,LISTLEN          MULT MEMBER NUMBER OF LENGTH CONST   05580000
         AH    RZ,PH4              TOTAL TAB LENGTH=ABOVE PLUS FOUR     05600000
GS1      ST    TEMP3,TEMPSAVE          SAVE CONTENTS OF REG 3      4304 05604019
         L     TEMP3,FREEA             USE REG 3 TO ESTAB ADDRESS  4304 05608019
         USING FREECOR,TEMP3           FOR FREECOR DSECT           4304 05612019
         ST    RZ,GS1L                 STORE MNT LENG FOR FREE     4304 05616019
         MVI   MAIN2,X'10'             TURN ON MNT GET MAIN SWTCH  4304 05620019
         GETMAIN  R,LV=(0)             GET CORE FOR MEMBER TBLE    4304 05624019
         ST    R1,MNTA                 STORE MNT ADDRESS           4304 05628019
         L     TEMP3,TEMPSAVE          RESTORE REG 3 CONTENTS      4304 05632019
         DROP  3                                                   4304 05636019
         ST    R1,MNTADD           STORE TABLE ADDRESS                  05640000
         LA    MNTPTER,4(R1)       ADDRESS OF SECOND WORD OF TABLE      05660000
         ST    MNTPTER,CURRMNT    STORE THIS ADDRESS                    05680000
         MVC   8(4,MNTPTER),PDZERO ZERO FOURTH WORD OF MNT              05700000
         LH    RZ,MAXNAME          TEST FOR                             05720000
         LTR   RZ,RZ               NAMED MEMBERS                        05740000
         BE    GS6                 NO NAMED MEMBERS                     05760000
         MH    RZ,PH10                  DOUBLE MEMBER NAME              05780000
         B     GS8                 TO USER DEFINED GROUP CHECK          05800000
GS5A     MVC   MASK(2),PH12        CAUSE BRANCH AT CSCAN7               05820000
GS5      LA    RZ,16              MNT LENGTH-NO MEMBERS                 05840000
         B     GS1                BUILD TABLE-NO MEMBERS                05860000
GS6      LH    RZ,PH10      SET REG TO CONSTANT OF 10              7827 05880000
GS8      LH    R1,MAXGPS           TEST FOR                             05900000
         LTR   R1,R1               USER DEFINED GROUPS                  05920000
         BNE   OVERFLDS            YES - USER DEFINED GROUPS            05940000
         LH    R1,MAXFLDS         TEST FOR                              05960000
         LTR   R1,R1               USER FORMATTED OUTPUT                05980000
         BE    GSMCBNO             NO USER FORMATTED OUTPUT             06000000
         LH    R1,MAXGPS          LOAD NO OF IDENTS                     06020000
OVERFLDS MH    R1,GCBLEN          MULTIPLY IDENTS BY 8 FOR LENGTH       06040000
         AR    RZ,R1               ADD 2 TO LENGTH                      06060000
         LH    R1,MAXFLDS          LOAD MAXIMUM FIELD STATEMENTS        06080000
         MH    R1,FCBLEN           MULTIPLY BY STATEMENT LENGTH 8       06100000
         AR    RZ,R1               TOTAL LENGTH FOR GETMAIN             06120000
         ST    RZ,MCBLEN           STORE MEMBER CONTROL BLOCK LENGTH    06140000
         ST    RZ,MCBREM           STORE IN MCB REMAINING               06160000
         ST    TEMP3,TEMPSAVE          SAVE CONTENTS OF REG 3      4304 06163019
         L     TEMP3,FREEA             USE REG 3 TO ESTAB ADDRESS  4304 06166019
         USING FREECOR,TEMP3           FOR FREECOR DSECT           4304 06169019
         ST    RZ,MCBL                 STORE LENGTH OF MCB AREA    4304 06172019
         MVI   GETMA,X'10'                                       A36090 06174021
         MVI   MAIN3,X'10'             SET GET MAIN SWITCH FOR MCB 4304 06175019
         GETMAIN R,LV=(0)                                               06180000
         ST    R1,MCBADD           STORE ADDRESS OF MEMBER CONTROL BLK  06200000
         ST    R1,MCBA                 STORE MCB ADDR FOR FREE     4304 06205019
         L     TEMP3,TEMPSAVE          RESTORE REG 3 CONTENTS      4304 06210019
         DROP  3                                                   4304 06215019
         LR    MCBPTER,R1          LOAD POINTER TO MEMBER CONTROL BLOCK 06220000
         MVC   0(2,MCBPTER),PDZERO ZERO FIRST HALFWORD OF MCB           06240000
         LH    RZ,MAXLITS          TEST FOR                             06260000
         LTR   RZ,RZ               LITERALS                             06280000
         BE    GSEND              NONE-DON'T GET MAIN                   06300000
         ST    TEMP3,TEMPSAVE          SAVE CONTENTS OF REG 3      4304 06303019
         L     TEMP3,FREEA             USE REG 3 TO ESTAB ADDRESS  4304 06306019
         USING FREECOR,TEMP3           FOR FREECOR DSECT           4304 06309019
         ST    RZ,LITS                 STORE LIT LENG FOR FREE     4304 06312019
         MVI   MAIN4,X'10'             TURN LIT GET MAIN SWTCH     4304 06315019
         GETMAIN R,LV=(0)                                               06320000
         ST    R1,LITADD           STORE LITERAL POOL ADDRESS           06340000
         ST    R1,LITA                 SAVE LITS FOR FREEMAIN      4304 06345019
         L     TEMP3,TEMPSAVE          RESTORE REG 3 CONTENTS      4304 06350019
         DROP  3                                                   4304 06355019
GSEND    B     CSCANZ              B TO MESS-SAVE LOAD ROUTINE          06360000
GSMCBNO  MVC   PLANT(2),PH12       CAUSE BRANCH AT CSCAN12              06380000
         B     CSCANZ              BRANCH TO MESS-SAVE LOAD ROUTINE     06400000
*              MESSAGE SET-UP                                           06420000
PPERRH   ST    R14,REGSAV          SAVE RETURN POINT               SA0I 06425018
         BAL   R14,TISTIC          CALCULATE COLUMN NUMBER         SA0I 06430018
         L     R14,REGSAV          RESTORE CALLERS ADDRESS         SA0I 06435018
         LA    RZ,31               MESSAGE DISPLACEMENT            SA0I 06440018
         LA    R1,PPIK             MESSAGE POINTER                 SA0I 06445018
         MVC   SEYLE(4),VPPIKM     MOVE IN MESSAGE LOCATION        SA0I 06450018
         B     HOWIE1              PUT COLUMN NUMBER IN MSG        SA0I 06455018
PPERRI   ST    R14,REGSAV          SAVE RETURN POINT               SA0I 06460018
         BAL   R14,TISTIC          CALCULATE COLUMN NUMBER         SA0I 06465018
         L     R14,REGSAV          RESTORE CALLERS ADDRESS         SA0I 06470018
         LA    RZ,33               MESSAGE DISPLACEMENT            SA0I 06475018
         LA    R1,PPMK             MESSAGE POINTER                 SA0I 06480018
         MVC   SEYLE(4),VPPMKM     MOVE IN MESSAGE LOCATION        SA0I 06485018
         B     HOWIE1              PUT COLUMN NUMBER IN MSG        SA0I 06490018
PPERRJ   ST    R14,REGSAV          SAVE RETURN POINT               SA0I 06495018
         BAL   R14,TISTIC          CALCULATE COLUMN NUMBER         SA0I 06500018
         L     R14,REGSAV          RESTORE CALLERS ADDRESS         SA0I 06505018
         LA    RZ,32               MESSAGE DISPLACEMENT            SA0I 06510018
         LA    R1,PPIP             MESSAGE POINTER                 SA0I 06515018
         MVC   SEYLE(4),VPPIPM     MOVE IN MESSAGE LOCATION        SA0I 06520018
         B     HOWIE1              PUT COLUMN NUMBER IN MSG        SA0I 06525018
PPERRL   ST    R14,REGSAV          SAVE RETURN POINT               SA0I 06530018
         BAL   R14,TISTIC          CALCULATE COLUMN NUMBER         SA0I 06535018
         L     R14,REGSAV          RESTORE CALLERS ADDRESS         SA0I 06540018
         LA    RZ,34               MESSAGE DISPLACEMENT            SA0I 06545018
         LA    R1,PPMP             MESSAGE POINTER                 SA0I 06550018
         MVC   SEYLE(4),VPPMPM     MOVE IN MESSAGE LOCATION        SA0I 06555018
         B     HOWIE1              PUT COLUMN NUMBER IN MSG        SA0I 06560018
         EJECT                                                          06580000
*                                                                       06600000
*              EXAMINE COMMAND WORD                                     06620000
*                                                                       06640000
CDSKIP   OI    PPWORK,BYPASS       SET BYPASS SWITCH-NO COMMAND         06660000
*                                                                       06680000
CSCAN    LA    ERREG,PPERRQ        ADDRESS OF MSG RTN              SA0I 06700018
         MVI   COMMSW,X'0'         SET COMMAND SWITCH                   06720000
         BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 06740018
CSCAN1   OI    BITS,X'01'          TURN OFF SECOND CARD SWITCH     SA0I 06750018
         TM    PPWORK,COMM         TEST FOR COMMAND                SA0I 06760018
         BZ    CDSKIP              NOT COMMAND - SKIP REST OF CARD      06780000
PKUP5    CLC   CTITLE(6),0(R1)    TEST FOR TITLE COMMAND           SA0I 06810018
         BE    TITLEC             HAVE TITLE COMMAND                    06840000
         CLC   CEXITS(6),0(R1)    TEST FOR EXITS COMMAND           SA0I 06860018
         BE    EXITSC              HAVE EXITS COMMAND                   06880000
         CLC   CMEMBER(7),0(R1)   TEST FOR MEMBER COMMAND          SA0I 06900018
         BNE   CSCAN8              NOT MEMBER COMMAND                   06920000
         CLC   MASK(2),PH12        TEST IF BRANCH SPECIFIED             06940000
         BE    PICK                YES-NO MEMBERS                  SA0I 06960018
         B     MEMBERC             SKIP TO MSG WHEN MNT FULL            06980000
CSCAN8   CLC   CRECORD(7),0(R1)   TEST FOR RECORD COMMAND          SA0I 07000018
         BNE   TSTLBLS                                             UL0H 07020017
         CLC   SKIPSW(2),PH12      TEST IF BRANCH SPECIFIED             07040000
         BE    CDSKIP             YES-SKIP RECORD SWITCH                07060000
         CLC   PLANT(2),PH12      TEST IF BRANCH SPECIFIED              07080000
         BE    PPERRQ              BRANCH TO ERROR MSG             SA0I 07100018
         B     RECORDC            HAVE RECORD COMMAND                   07120000
*                                                                       07140000
TSTLBLS  CLC   CLABELS(7),0(R1)   TEST FOR LABELS COMMAND          SA0I 07145018
         BE    LABLSC                                              UL0H 07150017
         B     PPERRQ              BRANCH TO ERROR MSG             SA0I 07155018
CSCANZ   LA    ERREG,PPERRQ        ADDRESS OF MSG RTN              SA0I 07165018
         L     RZ,LENSAVE          LOAD TABLE LENGTH                    07180000
         L     R1,LOCSAVE          LOAD TABLE ADDRESS                   07200000
         B     CSCAN1              BRANCH TO COMMAND TEST               07220000
*                                                                       07240000
*                                                                       07260000
CALLSCAN CALL  IEBCCS02,(PPWORK,PPSYSI)                                 07280000
*                                                                       07300000
*                                                                       07302019
*      I / O   E R R O R   H A N D L I N G   F O R   S Y S I N     7715 07304019
*                                                                  7715 07306019
         TM    PPWORK+144,X'02'   TEST FOR I/O ERROR ON SYSIN      7715 07308019
         BZ    NOERR              BRANCH IF NO TO NORMAL PROCESSING7715 07310019
         LA    R7,MSGSYNDF        GET ADDRESS OF MSG AREA          7715 07312019
         LA    R7,18(R7)          INCREMENT ADDR PAST MSG ID       7715 07314019
         MVC   0(79,R7),0(R1)     MOVE SYNAD. MSG TO AREA TO PR.OY01170 07316016
         ST    R1,FREESYND        SAVE ADDR OF SYNADAF MSG TO FREE 7715 07318019
         LA    R1,MSGSYNDF        LOAD REG 1 WITH AREA ADDR        7715 07320019
         LA    R0,96              LOAD REG 0 WITH AREA LENGTH      7715 07322019
         MVI   PPCONCD,X'0C'      SET RETURN CODE                  7715 07324019
         L     R15,VZZPR          GET ADDR OF MSG WRITER IN PPUN1  7715 07326019
         BALR  R14,R15            GO WRITE SYNADAF I/O ERROR INFO  7715 07328019
         L     R1,FREESYND        GET ADDR OF MSG IN DYNAMIC CORE  7715 07330019
         LA    R0,79              GET MESS. LENGTH TO FREE CORE OY01170 07332016
         FREEMAIN  R,LV=(0),A=(1)                                  7715 07334019
         B     PPRET              GO TO RETURN ROUTINE             7715 07336019
NOERR    ST    RZ,LENSAVE         SAVE TABLE LENGTH TO REFERENCE   7715 07338019
         ST    R1,LOCSAVE         SAVE TABLE ADDRESS                    07340000
         TM    PPWORK+WORKLEN-1,NEWCD   TEST FOR NEW CARD               07360000
         BZ    CALLS4                   NO-BRANCH AROUND CARD WRITE     07380000
         LA    R1,PPWORK+1         ADDRESS OF WRITE AREA                07400000
         L     R15,CDWRT           LOAD ADDRESS OF CARD WRITER          07420000
         BALR  R14,R15             BRANCH TO CARD WRITE EXTERN          07440000
         L     R1,LOCSAVE          RELOAD TABLE ADDRESS                 07460000
         L     RZ,LENSAVE          RELOAD TABLE LENGTH                  07480000
CALLS4   TM    PPWORK+WORKLEN-1,RIO     TEST FOR I/O ERROR ON SYSIN     07500000
         BO    IOERRIN             I/O ERROR ON SYSIN                   07520000
         TM    PPWORK,ERROR        TEST FOR ERROR                       07580000
         BO    TESTO               BRANCH TO ERROR BIT ANALYSIS    SA0I 07586018
         TM    PPWORK,EOF          TEST FOR END OF FILE                 07587018
         BO    PPEOF               YES-BRANCH TO EOF RTN                07588018
         MVI   SYSIN,X'FF'         SW TO INDICATE SYSIN NOT EMPTY       07589018
         TM    PPWORK,BYPASS       IS BYPASS BIT ON                SA0I 07592018
         BCR   8,BREG                                                   07602018
HOWIE    TM    PPWORK,X'01'        IS END PARAMETER ON?            SA0I 07622018
         BZ    CALLSCAN            BRANCH TO CALL RTN              SA0I 07628018
         BR    BREG                RETURN TO LINK POINT            SA0I 07634018
*                                                                       07640000
PPERRC   LA    RZ,1                MESSAGE DISPLACEMENT                 07660000
         LA    R1,PTERM1           MESSAGE POINTER                      07680000
PPERR    BAL   R14,PREMSG          BRANCH TO MESSAGE WRITER             07700000
         MVI   PPCONCD,X'0C'       SET CONDITION CODE TO TWELVE         07720000
         TM    PPWORK+WORKLEN-1,RIO TEST FOR I/O ERROR ON SYSIN    9989 07726013
         BO    PPRET              IF ERROR, BR TO RETURN ROUTINE   9989 07732013
         LA    BREG,CSCAN1         ADDR COMMAND TEST               SA0I 07741018
         OI    BIT,X'01'           TURN OFF FIRST CARD BIT(IF ON)  SA0I 07750018
ERRENDA  OI    PPWORK,BYPASS       SET BYPASS SWITCH                    07760000
         NI    PPWORK+81,X'FC'       TURN OFF KEYWORD AND PARAMETER     07761018
*                                  REQUIRED BITS                   SA0I 07762018
         NI    PPWORK+129,X'00'    SET PARENTH COUNTER TO ZERO  OY01168 07762516
         B     CALLSCAN            BRANCH TO CCS02                 SA0I 07763018
TESTO    TM    PPWORK+130,X'02'    IS  MISSING END OF PARENTHESIS       07764018
*                                  BIT ON?                         SA0I 07765018
         BO    PPERRY              YES-WRITE ERROR MSG             SA0I 07766018
         TM    PPWORK,BYPASS       IS BYPASS ON                    SA0I 07767018
         BZ    PPERRS              WRITE ERROR MSG                 SA0I 07768018
HAHA1    TM    PPWORK,COMM         IS COMMAND ON                   SA0I 07769018
         BO    HAHA                YES-BRANCH                      SA0I 07770018
         TM    PPWORK,KEYW         IS KEYWORD ON                   SA0I 07771018
         BZ    HAHA2               NO-CONTINUE                     SA0I 07772018
         B     PPERRH              WRITE ERROR MSG                 SA0I 07773018
HAHA2    TM    PPWORK,PAR          IS PARAMETER ON                 SA0I 07774018
         BZ    HAHA3               NO-CONTINUE                     SA0I 07775018
         B     PPERRJ              WRITE ERROR MSG                 SA0I 07776018
HAHA3    TM    PPWORK+81,X'02'     IS KEYWORD EXPECTED ON?         SA0I 07777018
         BZ    HAHA4               NO-CONTINUE                     SA0I 07778018
         B     PPERRI              WRITE ERROR MSG                 SA0I 07779018
HAHA4    TM    PPWORK+81,X'01'     IS PARAMETER EXPECTED ON?       SA0I 07780018
         BZ    PPERRT              NO-CONTINUE                     SA0I 07781018
         B     PPERRL              WRITE ERROR MSG                 SA0I 07782018
HAHA     TM    PPWORK,PAR          IS PARAMETER ON                 SA0I 07783018
         BO    PPERRN              YES-BRANCH                      SA0I 07784018
         TM    PPWORK,KEYW         IS KEYWORD ON                   SA0I 07785018
         BO    PPERRN              YES-BRANCH                      SA0I 07786018
         B     PPERRQ              WRITE ERROR MSG                 SA0I 07787018
         EJECT                                                          07800000
*                                                                       07820000
*********************************************************************** 07840000
*WRAP-UP ROUTINE FOR THE ANALYZER. PRINTS EOF ON SYSIN MESSAGE. CHECKS* 07860000
*THAT MAX LINES NOT EXCEEDED. PLACES IN MEMBER NAME TABLE THE NUMBER  * 07880000
*OF MEMBERS TO BE PRINTED OR PUNCHED. RETURNS TO THE ROOT SEGMENT.    * 07900000
*********************************************************************** 07920000
*                                                                       07940000
PPEOF    TM    PPWORK+81,X'4A'     CONTINUATION?               @ZA06525 07941099
         BO    PPERRT              YES,WRITE ERROR MSG         @ZA06525 07942099
         TM    SYSIN,X'FF'         IS SYSIN EMPTY              @ZA06525 07944099
         BZ    USERROR             YES, USER ERROR               A21407 07950018
         CLI   PPCONCD,X'0C'           IS RETURN CODE=12           SA0I 07956018
         BE    SYSMS               YES,END OF ANALYSIS             SA0I 07960018
         TM    COMMSW,RCOMM        TEST IF LAST COMMAND WAS RCD    SA0I 07970018
         BZ    PPEOFA              NO - BRANCH TO MAXLINE TEST          07980000
         TM    RECORDSW,FIRSTR     HAS MCB ADDRESS BEEN ENTERED IN MNT  08000000
         BO    PPEOFA1             HAS BEEN ENTERED                     08020000
         LH    TEMP1,0(MCBPTER)    LOAD MCB                             08040000
         AH    TEMP1,PH1           ADD ONE TO MCB LEN                   08060000
         STH   TEMP1,0(MCBPTER)    STORE IN MCB                         08080000
         L     MNTPTER,CURRMNT     LOAD MEMBER NAME TABLE ADDRESS       08100000
         ST    MCBPTER,8(MNTPTER)  STORE ADDRESS OF MCB IN MNT          08120000
         B     PPEOFA              BRANCH TO MAXLINE TEST               08140000
PPEOFA1  TM    TYPORG,1      PARTITIONED ORGANIZED ?             A36048 08160021
         BNZ   PPEOFA        YES                                 A36048 08170021
         LH    RZ,RECDCNT    NO, STORE GCB NUMBER FOR DATA SET   A36048 08172021
         LTR   RZ,RZ               IDENT KEYWORD                        08180000
         BE    PPEOFA              NONE-BRANCH TO MAXLINE TEST          08200000
         L     R1,MCBADD           LOAD MEMBER CONTROL BLOCK ADDRESS    08220000
         STH   RZ,0(R1)            STORE IDENT IN MCB                   08240000
PPEOFA   LH    R1,PMAXLINE         DO TEST FOR                    M4118 08260018
         LTR   R1,R1               MAXLINE KEYWORD                      08280000
         BZ    PPEOFA9             MAXLINE NOT SPECIFIED                08300000
         TM    TITLESW,X'01'       TEST FOR TITLE                       08320000
         BO    ADDONE              HAVE TITLE - BRANCH TO TITLE ROUTINE 08340000
         CLC   PPCTL(1),PMAXLINE+1  COMPARE SPACING TO MAXIMUM LINES    08360000
         BL    PPEOFA9             SPACE INCREMENT LESS THAN MAX LINES  08380000
         L     R1,MAXMSG     LOAD ERROR MSG ROUT. ADDRESS        A38738 08400021
         MVC   0(7,R1),KMAXLINE  MOVE MAXLINE IN MESSAGE         A38738 08410021
         B     MAXERROR                                          A38738 08412021
ADDONE   SR    R1,R1               ZERO OUT REGISTER                    08420000
         SR    RZ,RZ               ZERO OUT REGISTER                    08440000
         IC    RZ,PPCTL            LOAD SPACE FACTOR                    08460000
         LA    R1,1(R1)            ALLOW ONE SPACE FOR HEADER           08480000
         AR    R1,RZ               ADD SPACES BETWEEN HEADERS           08500000
         CLI   TITLESW,X'03'       TEST FOR SUBTITLE ALSO          5790 08520019
         BNE   COMPARE1            BRANCH IF NO SUBTITLE           5790 08540019
         LA    R1,1(R1)            ADD ONE SPACE FOR SUBTITLE           08560000
         AR    R1,RZ               ADD SPACES FOLLOWING SUBTITLE        08580000
COMPARE1 CH    R1,PMAXLINE         TEST IF AT OR OVER MAXIMUM LINES     08600000
         BL    PPEOFA9             NO - OK                              08620000
PPEOFA8  ST    R14,REGSAV          SAVE RETURN POINT               SA0I 08626018
         BAL   R14,TISTIC          CALCULATE COLUMN NUMBER         SA0I 08632018
         L     R14,REGSAV          RESTORE CALLERS ADDRESS         SA0I 08638018
         LA    RZ,31               MESSAGE DISPLACEMENT            SA0I 08644018
         LA    R1,PPIK             MESSAGE POINTER                 SA0I 08650018
         LA    TEMP4,30            LOAD DISPLACEMENT               SA0I 08656018
         A     TEMP4,VPPIKM        POSITION FOR INSERTING COLUMN   SA0I 08662018
         MVC   0(2,TEMP4),FULL+2   MOVE TO COLUMN NUMBER           SA0I 08668018
PPTERM   BAL   R14,PREMSG               PRINT MESSAGE                   08680017
         MVI   PPCONCD,X'0C'       SET CONDITION CODE TO TWELVE         08700000
PPEOFA9  LA    RZ,EOFCDE           MESSAGE CODE                         08720000
         LA    R1,PEOF             MESSAGE POINTER                      08740000
         LA    R14,PPEND           RETURN ADDRESS FROM PRINT = WRAPUP   08760000
         B     PREMSG              BRANCH TO MESSAGE WRITE              08780000
*                                                                       08800000
USERROR  LA    RZ,NOSYSIN          MESSAGE CODE                  A21407 08801018
         LA    R1,42               MESSAGE OFFSET                A21407 08802018
         BAL   R14,PREMSG          BRANCH TO MESSAGE WRITER      A21407 08803018
         MVI   PPCONCD,X'0C'       SET CONDITION CODE TO TWELVE  A21407 08804018
         B     PPRET               BRANCH TO RETURN ROUTINE      A21407 08805018
*                                                                     * 08806018
*                                                                     * 08812018
IOERRIN  LA    RZ,7                MESSAGE CODE FOR I/O ERROR ON SYSIN  08820000
         LA    R1,PEOJIO           MESSAGE POINTER                      08840000
         B     PPERR               BRANCH TO WRITE LINK                 08860000
*                                                                       08880000
PPERRCD  LA    RZ,9                MESSAGE CODE                         08900000
         LA    R1,SYNTMSG          MESSAGE POINTER                      08920000
         B     PPERR               BRANCH TO WRITE LINK                 08940000
*                                                                       08960000
PPERRN   ST    R14,REGSAV          SAVE RETURN POINT               SA0I 08963018
         BAL   R14,TISTIC          CALCULATE COLUMN NUMBER         SA0I 08966018
         L     R14,REGSAV          RESTORE CALLERS ADDRESS         SA0I 08969018
         LA    RZ,35               MESSAGE DISPLACEMENT            SA0I 08972018
         LA    R1,PPMC             MESSAGE POINTER                 SA0I 08975018
         MVC   SEYLE(4),VPPMCM     MOVE IN MESSAGE LOCATION        SA0I 08978018
HOWIE1   LA    TEMP4,30            LOAD DISPLACEMENT               SA0I 08981018
         A     TEMP4,SEYLE         POSITION FOR INSERTING COLUMN   SA0I 08984018
         MVC   0(2,TEMP4),FULL+2   MOVE TO COLUMN NUMBER           SA0I 08987018
         B     PPERR               BRANCH TO WRITE LINK            SA0I 08990018
PPERRQ   LA    RZ,36               MESSAGE DISPLACEMENT            SA0I 08993018
         LA    R1,PPIC             MESSAGE POINTER                 SA0I 08996018
         B     PPERR               BRANCH TO WRITE LINK            SA0I 08999018
PPERRR   LA    RZ,37               MESSAGE DISPLACEMENT            SA0I 09002018
         LA    R1,PPIL             MESSAGE POINTER                 SA0I 09005018
         B     PPERR               BRANCH TO WRITE LINK            SA0I 09008018
PPERRS   LA    RZ,38               MESSAGE DISPLACEMENT            SA0I 09011018
         LA    R1,PPIN             MESSAGE POINTER                 SA0I 09014018
         BAL   R14,PREMSG          BRANCH TO MSG WRITER            SA0I 09017018
         TM    PPWORK+WORKLEN-1,RIO TEST FOR I/O ERROR ON SYSIN    SA0I 09020018
         BO    PPRET               IF ERROR,RETURN                 SA0I 09023018
         CLI   BIT,X'01'           IS THIS THE FIRST CARD?         SA0I 09026018
         BE    GOB                 NOT FIRST CARD-BRANCH           SA0I 09029018
         LA    BREG,PTCOM          ADDR COMMAND TEST-PT OR PCH     SA0I 09032018
         B     CALLSCAN            BRANCH TO CCS02                 SA0I 09035018
GOB      CLI   BITS,X'01'          IS THIS THE SECOND CARD?        SA0I 09038018
         BE    GOA                 NOT SECOND CARD-BRANCH          SA0I 09041018
         BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 09044018
         B     GETSTOR             GET STORAGE FOR TABLES          SA0I 09047018
GOA      LA    BREG,CSCAN1         ADDR COMMAND TEST               SA0I 09050018
         B     CALLSCAN            BRANCH TO CCS02                 SA0I 09053018
PPERRT   LA    RZ,39               MESSAGE DISPLACEMENT            SA0I 09056018
         LA    R1,PPBC             MESSAGE POINTER                 SA0I 09059018
         B     PPERR               BRANCH TO WRITE LINK            SA0I 09062018
PPERRU   LA    RZ,41               MESSAGE DISPLACEMENT            SA0I 09065018
         LA    R1,41               MESSAGE POINTER                 SA0I 09068018
         B     PPERR               BRANCH TO WRITE LINK            SA0I 09071018
PPERRY   LA    RZ,40               MESSAGE DISPLACEMENT            SA0I 09074018
         LA    R1,40               MESSAGE POINTER                 SA0I 09077018
         B     PPERR               BRANCH TO WRITE LINK            SA0I 09080018
SYSMS    LA    RZ,EOFCDE           MESSAGE CODE                    SA0I 09083018
         LA    R1,PEOF             MESSAGE POINTER                 SA0I 09086018
         LA    R14,PPRET           RETURN ADDRESS                  SA0I 09089018
         B     PREMSG              BRANCH TO MSG WRITE             SA0I 09092018
*                                                                       09100000
PPEND    TM    TYPORG,1            TEST FOR PARTITIONED ORGANIZATION    09120000
         BZ    PPENDA              NO-BRANCH AROUND MEMBER TEST         09140000
         TM    GETMA,X'10'   GETM. FOR FI AND REC PARAM. ?       A36090 09142021
         BNO   SKIPLCO       NO, SKIP                            A36090 09144021
         LH    R1,RECDCNT    LAST COUNT WAS NOT                  A36090 09150021
         STH   R1,0(MCBPTER) NOT FILLED IN                       A36090 09152021
SKIPLCO  LH    MEMCT,MEMBCT  LOAD MEMBERCOUNT                    A36090 09160021
         LTR   MEMCT,MEMCT         TEST FOR NAMED MEMBERS               09180000
         BE    PPENDA              NO NAMED MEMBERS                     09200000
         L     MNTPTER,MNTADD      LOAD ADDRESS OF MEMBER NAME TABLE    09220000
         ST    MEMCT,0(MNTPTER)    STORE MEMBER COUNT IN MEMB NAME TAB  09240000
         B     PPRET               BRANCH TO RESTORE-RETURN ROUTINE     09260000
PPENDA   L     MCBPTER,MCBADD      LOAD ADDRESS OF MEMBER CONTROL BLOCK 09280000
         TM    GETMA,X'10'         GETM. FOR FI AND REC PARAM. ?OY01169 09286016
         BNO   MNTZERO             NO, SKIP                     OY01169 09292016
         LH    R1,0(MCBPTER)       LOAD MEMBER COUNT                    09300000
         LTR   R1,R1               TEST FOR RECORD GROUPS               09320000
         BH    PPRET               HAVE RECORD GROUPS - BRANCH TO EXIT  09340000
MNTZERO  MVC   MNTADD(4),PDZERO    REMOVE PNTER TO MNT-NO REC GR Y01169 09360016
PPRET    SR    R15,R15             ZERO RETURN CODE REGISTER            09380000
         IC    R15,PPCONCD         INSERT RETURN CODE                   09400000
         L     R13,SAVEADD+4       LOAD SAVE REGISTER                   09420000
         ST    TREG,24(R13)        SAVE DSECT BASE                      09440000
         RETURN   (14,12),RC=(15)                                       09460000
*                                                                       09480000
*                                                                       09500000
*        CONVERT PARAMETER TO BINARY                                    09520000
SETPBIN  LR    TEMP1,RZ            LOAD PARAMETER LENGTH                09540000
         LR    TEMP2,R1            LOAD PARAMETER ADDRESS               09560000
         LTR   TEMP1,TEMP1         TEST  PARAMETER LENGTH               09580000
         BH    SETPB2              HAVE PARAMETER                       09600000
         SR    PREG,PREG           SET LENGTH INDICATOR TO ZERO         09620000
         BR    BREG                BRANCH BACK                          09640000
SETPB2   CLI   0(TEMP2),C'0'       TEST FOR NUMERIC CHARACTER           09660000
         BL    0(ERREG)            PARAMETER IS NON-NUMERIC             09680000
         CLI   0(TEMP2),C'9'       TEST AGAINST HIGHEST NUMERIC         09700000
         BH    0(ERREG)            HIGH NON-NUMERIC                     09720000
         AH    TEMP2,PH1           INCREMENT LOCATION BY ONE            09740000
         BCT   TEMP1,SETPB2        CONTINUE THROUGH PARAMETER           09760000
         BCTR  RZ,RZ               SUBTRACT ONE FROM PARAMETER LENGTH   09780000
         STC   RZ,SETPB4+1                                              09800000
         OI    SETPB4+1,X'70'                                           09820000
SETPB4   PACK  DBLWD(8),0(1,R1)    PACK INTO CONVERSION AREA            09840000
         CVB   PREG,DBLWD          CONVERT PARAMETER TO BINARY          09860000
         LTR   PREG,PREG           TEST FOR NEGATIVE VALUE              09880000
         BL    0(ERREG)            NEGATIVE IS ERROR                    09900000
         BR    BREG                BRANCH BACK                          09920000
         EJECT                                                          09940000
*                                                                       09960000
*                                                                       09980000
*        COMMAND = TITLE                                                10000000
*                                                                       10020000
*                                                                       10040000
TITLEC   LA    ERREG,CDSKIP        ADDRESS OF CARD SKIP ROUT            10060000
         OI    PPWORK+81,X'02'     SET ON KEYWORD REQUIRED BIT     SA0I 10070018
         BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 10080018
         NI    PPWORK+81,X'FD'     SET OFF KEYWORD REQUIRED BIT    SA0I 10090018
         TM    PPWORK,KEYW         TEST FOR KEYWORD                     10100000
         BZ    PPERRI              ERROR IF NO KEYWORD AFTER TITLE SA0I 10130018
         GETMAIN R,LV=144              FOR MAX POSS. LRECL-1    OY01168 10160016
         ST    TEMP3,TEMPSAVE          SAVE CONTENTS OF REG 3      4304 10162019
         L     TEMP3,FREEA             USE REG 3 TO ESTAB ADDRESS  4304 10164019
         USING FREECOR,TEMP3           FOR FREECOR DSECT           4304 10166019
         TM    MAIN5,X'10'             TEST FRST TITLE SWTCH ON?   4304 10168019
         BZ    TITLE1                  NO-THIS MUST BE FIRST       4304 10170019
         MVI   MAIN6,X'10'              SET SWITCH FOR A SUBTITLE  4304 10172019
         ST    R1,SUBTITA              SAVE SUBTITLE ADDRESS       4304 10174019
         B     SKIPTITL                MISS FIRST TITLE SETTING    4304 10176019
TITLE1   MVI   MAIN5,X'10'             SET FIRST TITLE SWTCH       4304 10178019
         ST    R1,TITLA                SAVE TITLE ADDRESS          4304 10180019
SKIPTITL L     TEMP3,TEMPSAVE          RESTORE REG 3 CONTENTS      4304 10182019
         DROP  3                                                   4304 10184019
         MVI   0(R1),C' '              BLANK FIRST BYTE OF TITLE   4304 10186019
         MVC   1(143,R1),0(R1)     BLANK TITLE AREA             OY01168 10200016
         TM    TITLESW,X'01'       TEST FOR FIRST TITLE                 10220000
         BO    SUBTC               NOT FIRST, THEREFORE SUBTITLE        10240000
         OI    TITLESW,X'01'       SET TITLE SWITCH FOR SUBTITLE        10260000
         LA    TCBR,TCB1           ADDRESS OF TITLE CONTROL BLOCK       10280000
         B     TITLEADD            SKIP SUBTITLE ROUTINE                10300000
SUBTC    TM    TITLESW,X'02'       TEST FOR FORMATTED SUBTITLT          10320000
         BO    TMULT               SUBTITLE ALREADY FORMATTED           10340000
         LA    TCBR,TCB2           ADDRESS OF SUBTITLE CONTROL BLOCK    10360000
         OI    TITLESW,X'02'       SET TITLE SWITCH FOR FORMATTED SUBT  10380000
TITLEADD ST    R1,4(TCBR)          STORE ADDRESS OF TITLE IN TCB        10400000
         MVC   0(4,TCBR),PDZERO    ZERO FIRST WORD OF TCB               10420000
         L     RZ,LENSAVE          LOAD LIST LENGTH                     10440000
         L     R1,LOCSAVE          LOAD LIST ADDRESS                    10460000
         B     TITLEK1             BRANCH TO ITEM TEST                  10480000
*              SCAN FOR FIELD KEYWORD                                   10500000
TITLEK   LA    ERREG,PPERRH        ADDRESS OF MSG RTN              SA0I 10520018
         BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 10540018
         TM    PPWORK,KEYW         TEST FOR KEYWORD                     10560000
         BZ    TKEYNO              NO-BRANCH TO NO KEYWORD ROUTINE      10580000
*                                                                       10600000
*              COMMAND = TITLE,IS KEYWORD FIELD                         10620000
*                                                                       10640000
         NI    PPWORK+81,X'FD'     SET OFF KEYWORD REQUIRED BIT    SA0I 10650018
TITLEK1  CLC   KITEM(5),0(R1)     TEST FOR ITEM KEYWORD            SA0I 10660018
         BNE   PPERRH              NO-BRANCH TO MSG RTN            SA0I 10670018
         CLI   5(R1),X'4D'        TEST FOR LEFT PARENTHESIS      13695  10686015
         BNE   PPERRY                                             M3311 10693018
*                                                                       10700000
*              GET PARAMETERS FOR TITLE FIELD                           10720000
*                                                                       10740000
         LA    ERREG,PPERRJ        ADDRESS OF MESSAGE ROUTINE      SA0I 10760018
         LA    PARLIST,TITLEP2     ADDRESS OF LITERAL TEST              10780000
TITLEP   OI    PPWORK+81,X'01'     SET ON PARAMETER REQUIRED BIT   SA0I 10790018
         BAL   BREG,CALLSCAN       BRANCH TO CALL RTN              SA0I 10800018
         NI    PPWORK+81,X'FE'     SET OFF PARAMETER REQUIRED BIT  SA0I 10810018
         TM    PPWORK,PAR          TEST FOR PARAMETER                   10820000
         BZ    PPERRL              MISSING PARAMETER               SA0I 10840018
         BR    PARLIST             EVALVATE PARAMETER                   10860000
*                                                                       10880000
TITLEP2  CH    RZ,PH3              IS LITTERAL SMALLER TH 3 ?   OY01168 10900016
         BL    PPERRJ              YES,BRANCH TO ERROR MSG SA0I OY01168 10906016
         CH    RZ,LIT42            IS LITERAL GT 42 ALLOWING FOR A25956 10914018
*                                  END QUOTES                    A25956 10922018
         BH    PPERRR              YES-BRANCH TO ERROR MSG         SA0I 10930018
         LA    PARLOC,1            LOAD 1                               10940000
         AR    PARLOC,R1           LOCATION OF LITERAL                  10960000
         LR    RLIT,RZ             LOAD LENGTH                          10980000
         SH    RLIT,PH2            LITERAL LENGTH                       11000000
         TM    PPWORK,PARP         TEST IF LAST PARAMETER               11060000
         BO    TP5                 BRANCH TO LENGTH SET                 11080000
         CLI   PPWORK+82,X'00'     IS THERE A PARTIAL PARAM    @ZA27264 11083099
         MVI   PPWORK+82,X'00'     CLEAR FIELD                 @ZA27264 11085099
         BNE   SKIPSAVE            YES,SKIP SAVING OF ITEM     @ZA27264 11087099
         MVI   TITLESAV,X'40'          CLEAR TITLE SAVE AREA   @ZA27264 11089099
         MVC   TITLESAV+1(79),TITLESAV                         @ZA27264 11090099
         SR    PARLIST,PARLIST     CLEAR MOVE LENGTH REG       @ZA27264 11093099
         LA    BREG,TITLESAV       ADDRESS OF SAVE AREA        @ZA27264 11095099
MOVETITL MVC   0(1,BREG),0(PARLOC) MOVE 1 ITEM BYTE            @ZA27264 11097099
         CLI   0(PARLOC),X'7D'     MOVED A QUOTE?              @ZA27264 11099099
         LA    PARLOC,1(PARLOC)    UP TO NEXT BYTE TO BE MOVED @ZA27264 11101099
         LA    BREG,1(BREG)        UP TO NEXT BYTE TO MOVE TO  @ZA27264 11103099
         BE    TESTNEXT            YES,TEST IF NEXT ALSO       @ZA27264 11105099
MOVENEXT LA    PARLIST,1(PARLIST)  ONE MORE BYTE MOVED         @ZA27264 11107099
         CR    PARLIST,RLIT        IS ALL ITEM MOVED?          @ZA27264 11109099
         BL    MOVETITL            NO, GO AND MOVE MORE        @ZA27264 11111099
         LA    PARLOC,TITLESAV        POINT TO TITLE SAVE AREA @ZA27264 11113099
SKIPSAVE LA    PARLIST,TITLEP3     ADDRESS OF LITERAL ROUTINE  @ZA27264 11114099
         B     TITLEP              TEST FURTHER PARAMETERS     @ZA27264 11115099
TESTNEXT CH    RLIT,PH1            LITERAL LENGTH > 1 ?        @ZA27264 11119099
         BNL   NEXTQUOT            YES,TEST IF NEXT A QUOT     @ZA27264 11121099
         B     PPERRR              NO,GIVE INVLAID LITERAL MSG @ZA27264 11123099
NEXTQUOT CLI   0(PARLOC),X'7D'     ALSO A QUOTE?               @ZA27264 11125099
         BNE   PPERRR              NO,GIVE INVALID LITERAL MSG @ZA27264 11127099
         LA    PARLOC,1(PARLOC)    UP TO NEXT BYTE TO MOVE     @ZA27264 11129099
         B     MOVENEXT            GO AND MOVE NEXT BYTE       @ZA27264 11131099
*                                                                       11140000
TITLEP3  LTR   RZ,RZ               TEST OUTPUT LOCATION                 11160000
         BE    TP5                 ZERO = FIRST LOCATION                11180000
         BAL   BREG,SETPBIN        BRANCH TO CVB ROUTINE                11200000
         BE    TP4                                                      11220000
         BCTR  PREG,RZ             SUBTRACT ONE FROM LENGTH             11280000
TP4      LR    TEMP1,PREG          LOAD LENGTH                          11300000
         AR    TEMP1,RLIT          ADD LITERAL LENGTH                   11320000
         CH    TEMP1,MAXOUT1       COMPARE TO MAXIMUM OUTP.LNG. OY01168 11340016
         BH    PPERRR              PRINT ERRMSG IEB437I         OY01168 11360016
         CH    TEMP1,2(TCBR)       LARGEST END OF BOUNDARY ?    OY01168 11400016
         BL    SKPSTOR             NO, DON'T SAVE THE LENGTH    OY01168 11410016
         STH   TEMP1,2(TCBR)       STORE END OF LITT. LOC.      OY01168 11420016
SKPSTOR  A     PREG,4(TCBR)        ADD TITLE ADDRESS            OY01168 11440016
TMVC     MVC   0(1,PREG),0(PARLOC) MOVE LITERAL TO TITLE           3718 11444015
         LA    PARLOC,1(0,PARLOC)  ADD ONE                         3718 11448099
         LA    PREG,1(0,PREG)      ADD ONE                         3718 11472015
         BCT   RLIT,TMVC           SUBTRACT ONE FROM LENGTH & LOOP 3718 11476015
         MVC   0(2,TCBR),MAXOUT1   MAXIMUM OUTPUT LENGTH TO TCB OY01168 11480016
         B     TITLEK              CONTINUE                             11500000
*                                                                       11520000
*                                                                       11540000
TP5      SR    PREG,PREG           ZERO PARAM LENGTH INDIC              11560000
         B     TP4                 BRANCH TO LENGTH TEST                11580000
*                                                                       11600000
*                                                                       11620000
*                                                                       11660000
TKEYNO   TM    PPWORK,PAR          TEST FOR PARAMETER                   11680000
         BZ    CSCANZ              NO PARAMETER - BRANCH TO SCAN        11700000
         LTR   RZ,RZ               TEST FOR PARAMETER LENGTH            11720000
         BE    TITLEK              LENGTH ZERO,BRANCH TO FIELD SCAN     11740000
         B     PPERRJ              BRANCH TO ERROR MSG             SA0I 11760018
*                                                                       11780000
TMULT    LA    RZ,PTMULT           MESSAGE CODE                         11800000
         LA    R1,3                MESSAGE OFFSET                       11820000
         B     PPERR               BRANCH TO WRITE LINK                 11840000
TCDPERR  LA    RZ,5                MESSAGE CODE                         11860000
         LA    R1,PPAR             MESSAGE OFFSET                       11880000
         B     PPERR               BRANCH TO WRITE LINK                 11900000
TCDKERR  LA    RZ,4                MESSAGE CODE                         11920000
         LA    R1,PKEY             MESSAGE OFFSET                       11940000
         B     PPERR               BRANCH TO WRITE LINK                 11960000
TISTIC   LA    TEMP3,1             LOAD DISPLACEMENT FACTOR        SA0I 11962018
         AR    TEMP3,R1            ADD CCS02 POINTER LOCATION      SA0I 11964018
         LA    TEMP4,PPWORK+1      LOAD ADDRESS WORK AREA          SA0I 11966018
         SR    TEMP3,TEMP4         CALCULATE COLUMN NUMBER         SA0I 11968018
         CVD   TEMP3,DOUBLE        CONVERT TO DECIMAL              SA0I 11970018
         OI    DOUBLE+7,X'03'      SET FIELD                       SA0I 11972018
         UNPK  FULL,DOUBLE+4(4)    SET UP FOR EBCDIC PRINTOUT      SA0I 11974018
         BCR   15,R14              RETURN TO CALLER                SA0I 11976018
         EJECT                                                          11980000
*                                                                       12000000
*              COMMAND = EXITS                                          12020000
*                                                                       12040000
EXITSC   OI    PPWORK+81,X'02'     TURN ON KEYWORD REQ BIT         8397 12050019
EXITSCN  LA    ERREG,CDSKIP        ADDRESS OF SKIP ROUTINE         8397 12060019
         BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 12070018
         TM    PPWORK,PAR          TEST FOR PARAMETER              0033 12085015
         BZ    EK0                 NO, B AROUND PARAM CHECK        0033 12090015
         LTR   RZ,RZ               IS PARAM LENGTH ZERO            0033 12095015
         BE    EXITSC              YES, B TO SCAN AGAIN            0033 12100015
         B     PPERRH              BRANCH TO ERROR MSG             SA0I 12105018
EK0      TM    PPWORK,KEYW         TEST FOR KEYWORD                0033 12110015
         BZ    CSCAN1              NOT KEYWORD,BRANCH TO COMMAND TEST   12120000
*        TEST FOR VALID KEYWORD                                         12140000
         NI    PPWORK+81,X'FD'     SET OFF KEYWORD REQUIRED BIT    SA0I 12150018
         CLC   KINHDR(6),0(R1)    TEST FOR INPUT HEADER KEYWORD    SA0I 12160018
         BNE   EK1                 NO-TRY INTLR KEYWD                   12180000
         LA    PARLOC,EX1          ADDRESS OF INHDR EXIT                12200000
         B     EXSCANP             BRANCH TO EXIT NAME ROUTINE          12220000
EK1      CLC   KINTLR(6),0(R1)    TEST FOR INPUT TRAILER KEYWORD   SA0I 12240018
         BNE   EK3                 NO-TRY INREC KEYWORD                 12260000
         LA    PARLOC,EX3          ADDRESS OF INTLR EXIT                12280000
         B     EXSCANP             BRANCH TO EXIT NAME ROUTINE          12300000
EK3      CLC   KINREC(6),0(R1)    TEST IF INPUT RECORD RTN KEYWORD SA0I 12320018
         BNE   EK5                 NO-TRY OUTREC KEYWORD                12340000
         LA    PARLOC,EXIN         ADDRESS OF INREC EXIT                12360000
         B     EXSCANP             BRANCH TO EXIT NAME ROUTINE          12380000
EK5      CLC   KOUTREC(7),0(R1)   TEST FOR OTPT REC RTN KYWD       SA0I 12400018
         BNE   PPERRH              NO-INVALID KEYWORD              SA0I 12420018
         LA    PARLOC,EXOUT        ADDRESS OF OUTREC EXIT               12440000
*                                                                       12460000
*              VALID KEYWORD-GET NAME OF EXIT ROUTINE                   12480000
EXSCANP  OI    PPWORK+81,X'01'     SET ON PARAMETER REQUIRED BIT   SA0I 12490018
         BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 12500018
         NI    PPWORK+81,X'FE'     SET OFF PARAMETER REQUIRED BIT  SA0I 12510018
         TM    PPWORK,PAR          TEST FOR PARAMETER                   12520000
         BZ    PPERRL              NO-BRANCH TO MSG RTN            SA0I 12540018
         LTR   RZ,RZ               TEST NAME LENGTH FOR ZERO            12560000
         BE    PPERRJ              LENGTH ZERO-BRANCH TO MSG RTN   SA0I 12580018
         CH    RZ,PH8              TEST NAME LENFTH FOR EIGHT           12600000
         BH    PPERRJ              TOO LONG-BRANCH TO MSG RTN      SA0I 12620018
         LR    TEMP2,RZ            LOAD REGISTER WITH NAME LENGTH       12640000
         BCTR  TEMP2,RZ            SUBTRACT ONE (RESTORED IN EX-MVC)    12660000
         EX    TEMP2,EXPMOV        EXECUTE MOVE INSTRUCTION             12680000
         LA    TEMP2,EXLST         ADDRESS OF EXIT LIST                 12700000
         ST    TEMP2,EXLSTADD      STORE ADDRESS OF EXIT LIST           12720000
         B     EXITSCN             CONTINUE EXIT TEST              8397 12740019
*                                                                       12760000
*                                                                       12940000
EXPMOV   MVC   0(1,PARLOC),0(R1)   MOVE EXIT ROUTINE NAME TO EXIT LIST  12960000
         EJECT                                                          12980000
*                                                                       13000000
*              COMMAND = MEMBER                                         13020000
*                                                                       13040000
MEMBERC  LH    MEMCT,MEMBCT            LOAD MEMBER CNT                  13047020
          AH    MEMCT,PH1              INCREMENT MEM CNT                13054020
          STH   MEMCT,MEMBCT           STORE MEM CNT                    13061020
         MVC   RECDCNT(2),PDZERO  FOR LAST MEMB.WITHOUT REC.STAT.A36090 13063021
         TM    TYPORG,X'01'        TEST FOR PARTITIONED DATA SET   SA0I 13070018
         BZ    PPERRU              NOT PARTITIONED-MEMBER INVALID  SA0I 13080018
         CLI   RECSW,X'03'   REC. COMM.PREC.FRST MEMBER COMM.    A36082 13082021
         BE    PPERRQ        YES,'INVALID COMMAND' MSG           A36082 13084021
         OI    RECSW,X'08'   PUT MEMBER COMM.ON                  A36082 13084421
          BCTR  MEMCT,0                DECR MEM CNT BY 1                13105020
         CH    MEMCT,MAXNAME       COMPARE COUNT TO MAXIMUM ALLOWED     13120000
         BL    ERRMESS                                             1769 13130014
         L     R1,MAXMSG               ADDRESS OF ERROR MESSAGE    1769 13140014
PICK     L     R1,MAXMSG           ADDRESS  OF ERROR MESSAGE       SA0I 13145018
         MVC   0(7,R1),KMAXNAME        MOVE 'MAXNAME' TO MESSAGE   1769 13150014
         B     MAXERROR                GO TO PRINT OUT MESSAGE     1769 13160014
ERRMESS  LA    ERREG,MEMBERNO          ADDRESS OF MESSAGE ROUTINE  1769 13170014
*                                                                       13180000
         OI    PPWORK+81,X'02'     SET ON KEYWORD REQUIRED BIT     SA0I 13190018
         BAL   BREG,CALLSCAN       BRANCH TO CALL ROUTINE               13200000
         NI    PPWORK+81,X'FD'     SET OFF KEYWORD REQUIRED BIT    SA0I 13210018
         TM    PPWORK,KEYW         TEST FOR KEYWORD                     13220000
         BZ    PPERRI              NOT KEYWORD-WRITE MESSAGE       SA0I 13240018
         CLC   KNAME(5),0(R1)     TEST FOR NAME KEYWORD            SA0I 13260018
         BNE   PPERRH              NOT NAME-INVALID-WRITE MESSAGE  SA0I 13270018
         OI    PPWORK+81,X'01'     SET ON PARAMETER REQUIRED BIT   SA0I 13280018
         BAL   BREG,CALLSCAN       BRANCH TO CALL ROUTINE               13300000
         NI    PPWORK+81,X'FE'     SET OFF PARAMETER REQUIRED BIT  SA0I 13310018
         TM    PPWORK,PAR          TEST FOR PARAMETER                   13320000
         BZ    MEMBHDM2            NOT PARAM-MSG RTN               SA0I 13340018
         CH    RZ,PH8              TEST FOR NAME LENGTH EIGHT           13360000
         BH    PPERRJ              TOO LONG-BRANCH TO MSG RTN      SA0I 13380018
         LTR   RZ,RZ               TEST FOR NAME LENGTH ZERO            13400000
         BE    MEMBHDM1            LENGTH ZERO-MSG RTN             SA0I 13410018
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 13420018
         BE    TESTO1              BRANCH TO COMMAND TEST          SA0I 13430018
         L     MNTPTER,CURRMNT     ADDRESS OF MEMBER NAME TABLE         13440000
         LTR   MEMCT,MEMCT         TEST FOR MEBER COUNT ZERO            13460000
         BE    MS5                 COUNT ZERO-BRANCH TO MNT CLEAR       13480000
         AH    MNTPTER,LISTLEN     UPDATE MNT POINTER                   13500000
         TM    GETMA,X'10'         GETM. FOR FI AND REC PARAM.? OY01169 13506016
         BNO   MS5                 NO, SKIP                     OY01169 13512016
         CLC   0(2,MCBPTER),PDZERO TEST MEMBER CONTROL BLOCK PTR TO 0   13520000
         BE    MS5                 POINTER = 0,BRANCH TO MNT CLEAR      13540000
         A     MCBPTER,CURRMCB     UPDATE MCB POINTER                   13560000
         MVC   CURRMCB(4),PDZERO   RESET CURRENT MCB PTR TO ZERO A45130 13570021
MS5      MVC   0(8,MNTPTER),PDBLANK     BLANK SPACE IN MNT              13580000
         MVC   8(4,MNTPTER),PDZERO      ZERO MEMBER COUNT               13600000
         ST    MNTPTER,CURRMNT          STORE MNT ADDRESS               13620000
         LR    TEMP2,RZ            LOAD NAME LENGTH                     13640000
         BCTR  TEMP2,RZ            SUBTRACT ONE (RESTORED IN EX-MVC)    13660000
         EX    TEMP2,NAMEMOV       EXECUTE MOVE INSTRUCTION             13680000
         OI    TYPORG,X'02'        SET TYPORG                           13740000
         MVC   SKIPSW(2),PH1      SET SWITCH TO READ RECORDS            13760000
         NI    RECORDSW,NEWR       SET RECORD SWITCH                    13780000
TESTO1   BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 13788018
         TM    PPWORK,COMM         WAS A COMMAND FOUND?            SA0I 13796018
         BZ    PPERRJ              NO-WRITE ERROR MSG              SA0I 13804018
         B     PKUP5               CONTINUE WITH COMMAND TEST      SA0I 13812018
*                                                                       13820000
NAMEMOV  MVC   0(1,MNTPTER),0(R1)  MOVE NAME TO MEMBER NAME TABLE       13840000
*                                                                       13860000
*              MESSAGE ROUTINES                                         13880000
MEMBHDM1 ST    R14,REGSAV          SAVE RETURN POINT               SA0I 13883018
         BAL   R14,TISTIC          CALCULATE COLUMN NUMBER         SA0I 13886018
         L     R14,REGSAV          RESTORE CALLERS ADDRESS         SA0I 13889018
         LA    RZ,32               MESSAGE DISPLACEMENT            SA0I 13892018
         LA    R1,PPIP             MESSAGE POINTER                 SA0I 13895018
         MVC   SEYLE(4),VPPIPM     MOVE IN MSG  LOCATION           SA0I 13898018
HOWIE2   LA    TEMP4,30            LOAD DISPLACEMENT               SA0I 13901018
         A     TEMP4,SEYLE         POSITION FOR INSERTING COLUMN   SA0I 13904018
         MVC   0(2,TEMP4),FULL+2   MOVE IN COLUMN NUMBER           SA0I 13907018
         B     MIKEH               BRANCH TO WRITE LINK            SA0I 13910018
MEMBHDM2 ST    R14,REGSAV          SAVE RETURN POINT               SA0I 13913018
         BAL   R14,TISTIC          CALCULATE COLUMN NUMBER         SA0I 13916018
         BAL   R14,REGSAV          RESTORE CALLERS ADDRESS         SA0I 13919018
         LA    RZ,34               MESSAGE DISPLACEMENT            SA0I 13922018
         LA    R1,PPMP             MESSAGE POINTER                 SA0I 13925018
         MVC   SEYLE(4),VPPMPM     MOVE IN MSG LOCATION            SA0I 13928018
         B     HOWIE2              PUT COLUMN NUMBER IN MSG        SA0I 13931018
MIKEH    BAL   R14,PREMSG          BRANCH TO MSG LINK              SA0I 13940018
         MVI   PPCONCD,X'0C'       SET CONDITION CODE TO 12        SA0I 13949018
         B     RECORDNO            BRANCH TO SWITCH SET                 13960000
MEMBERNO LA    RZ,MERR             MESSAGE CODE                         14060000
         LA    R1,PMEMBNO          MESSAGE OFFSET                       14080000
         BAL   R14,PREMSG          BRANCH TO MESSAGE LINK               14100000
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 14106018
         BE    RECORDNO            BRANCH TO SWITCH SET            SA0I 14112018
         MVI   PPCONCD,X'08'       SET CONDITION CODE TO EIGHT          14120000
RECORDNO MVC   SKIPSW(2),PH12      SET TO SKIP RECORDS                  14140000
         B     CDSKIP              BRANCH TO SKIP ROUTINE               14160000
MEMBNO   LA    RZ,5                MESSAGE CODE                         14180000
         LA    R1,PPAR             MESSAGE OFFSET                       14200000
         B     PPERR               BRANCH TO WRITE LINK                 14220000
*     DATA IS LAST OR ONLY KEYWORD ON LABELS CARD                  9608 14220119
*     IF CONV IS SPECIFIED FOR LABELS THE DATA KEYWORD MUST BE     9608 14220219
*     PRESENT AFTER IT.                                            9608 14220319
LABLSC   OI    PPWORK+81,X'02'         SET KEYWORD REQ BIT        S9608 14220419
LABLSCN  LA    ERREG,CDSKIP            GET ADR OF CARD SKIP ROUT   9608 14220619
         BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 14220818
         TM    PPWORK,PAR                                          UL0H 14221217
         BZ    LKO                      NO,TEST KEYWORD            UL0H 14221617
         LTR   RZ,RZ                    IS PARAM LNGTH ZERO        UL0H 14222017
         BE    LABLSC                                              UL0H 14222417
         B     PPERRH              BRANCH TO ERROR MESSAGE         SA0I 14222818
LKO      TM    PPWORK,KEYW                                         UL0H 14223217
         BZ    CSCAN1                                              UL0H 14223617
         NI    PPWORK+81,X'FD'     SET OFF KEYWORD REQUIRED BIT    SA0I 14223818
TSTLBLKW CLC   KDATA(5),0(R1)     TEST FOR DATA KEYWORD            SA0I 14224118
         BE    TSTDATAP                                            UL0H 14224417
         CLC   KCONV(5),0(R1)     TEST FOR CONV KEYWORD            SA0I 14224818
         BE    LABCONV                  *                          UL0H 14225217
         MVI   LBLCONSW,X'00'                                      UL0H 14225617
         B     PPERRH              BRANCH TO ERROR MESSAGE         SA0I 14226018
TSTDATAP BAL   KREG,PPSCANP                                        UL0H 14226417
         CLC   PNO,0(R1)                                           UL0H 14226817
         BE    PARNO                                               UL0H 14227217
         CLC   PALL,0(R1)                                          UL0H 14227617
         BE    PARALL                                              UL0H 14228017
         CLC   PONLY,0(R1)                                         UL0H 14228417
         BE    PARONLY                                             UL0H 14228817
         CLC   PYES,0(R1)                                          UL0H 14229217
         BE    PARYES                                              UL0H 14229617
         B     PPEOFA8             BRANCH TO WRITE MESSAGE         SA0I 14230618
PARNO    CH    RZ,PH2              IS PARAM LENGTH=2?              SA0I 14230918
         BNE   PPERRJ              NO-WRITE ERROR MESSAGE          SA0I 14231218
         MVZ   LBLPRTSW,=X'00'     SET LABEL PRINT SW OFF          SA0I 14231518
         MVI   PROCKY,X'40'                                        UL0H 14232017
         B     LABLSCN                 GO TO SCAN NEXT CARD        9608 14232319
PARALL   CH    RZ,PH3              IS PARAM LENGTH=3?              SA0I 14232618
         BNE   PPERRJ              NO-WRITE ERROR MESSAGE          SA0I 14232818
         MVC   PROCKY,X'20'                                        SA0I 14233018
         B     LABLSCN                 GO TO SCAN NEXT CARD        9608 14233219
PARONLY  CH    RZ,PH4              IS PARAM LENGTH =4?             SA0I 14233418
         BNE   PPERRJ              NO-WRITE ERROR MESSAGE          SA0I 14233618
         MVI   PROCKY,X'10'                                        SA0I 14233818
         B     LABLSCN                 GO TO SCAN NEXT CARD        9608 14234019
PARYES   CH    RZ,PH3              IS PARAM LENGTH=3?              SA0I 14234218
         BNE   PPERRJ              NO-BRANCH TO ERROR MESSAGE      SA0I 14234418
         MVI   PROCKY,X'80'                                        SA0I 14234618
         B     LABLSCN                 GO TO SCAN NEXT CARD        9608 14234919
LABCONV  BAL   KREG,PPSCANP                                        UL0H 14235217
         CLC   PXE,0(R1)                                           UL0H 14235617
         BE    SETHXLB                                             UL0H 14236017
         CLC   PPZ,0(R1)                                           UL0H 14236417
         BNE   0(ERREG)                                            UL0H 14236817
LABLZ    OI    LBLCONSW,X'03'                                      UL0H 14237217
         B     LABLSC                                              UL0H 14237617
SETHXLB  OI    LBLCONSW,X'01'                                      UL0H 14238017
         B     LABLSC                                              UL0H 14238417
         EJECT                                                          14240000
*                                                                       14260000
*              COMMAND = RECORD,EXAMINE KEYWORDS                        14280000
*                                                                       14300000
RECORDC  DS    0H                                                       14301020
          XI    RECSW,X'03'                                             14302020
         CLC   COMPMEM(2),MEMBCT       COMPARE MEMBER NBS               14303020
         BE    COUNTREC            IF SAME MEMBER BRANCH          M4118 14304018
         MVC   COMPMEM(2),MEMBCT   UPDATE MEMBER TO NEW COUNT     M4118 14306018
         MVC   RECDCNT(2),PH1      RESET RECORD COUNT TO ONE      M4118 14308018
         XC    IDENTCON(2),IDENTCON  ID SW. ZERO FOR NEXT MEMBER A36090 14308421
         XC    COUNTID(2),COUNTID    ID.CNT. ZERO FOR NEXT MEM.  A36090 14308821
         XC    COMPREC(2),COMPREC RECD GRP.NUMB, 0 FOR NEXT MEM. A36090 14309221
         B     RECD2               CONTINUE PROCESSING            M4118 14310018
*                                                                       14312018
*  CHECK FOR ERROR WHEN MULTIPLE RECORD CARDS WITHOUT IDENTS    PTM4118 14314018
COUNTREC LH    TEMP1,RECDCNT       GET RECORD COUNT FOR THIS      M4118 14316018
         AH    TEMP1,PH1            MEMBER OR PS DATA SET         M4118 14318018
         STH   TEMP1,RECDCNT        AND INCREMENT BY ONE          M4118 14320018
         LH    TEMP1,COUNTID       GET COUNT OF RECORDS WITH      M4118 14322018
         AH    TEMP1,PH1            IDS TO ADD TEMPORARY ONE      M4118 14324018
         CH    TEMP1,RECDCNT       IF IDS+1 EQUAL TOTAL RECORDS   M4118 14326018
         BE    RECD2                THEN BRANCH TO CONTINUE       M4118 14328018
         B     MEMBNO               ERROR IF NO IDENT BETWEEN REC M4118 14330018
RECD2    OI    PPWORK+81,X'02'     TURN ON KEYWORD REQUIRED BIT   SAOI  14332018
         BAL   BREG,CALLSCAN       BRANCH TO CCS02                 SA0I 14338018
         TM    PPWORK,PAR          TEST FOR PARAMETER              0033 14346015
         BO    PPERRH              YES,WRITE ERROR MESSAGE         SA0I 14353018
         TM    PPWORK,KEYW         TEST FOR KEYWORD                     14360000
         BZ    CDSKIP              NO KEYWORD-BRANCH TO CARD SKIP       14380000
         NI    PPWORK+81,X'FD'     SET OFF KEYWORD REQUIRED BIT    SA0I 14390018
         OI    COMMSW,RCOMM        SET COMMAND SWITCH FOR RECORD        14400000
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 14406018
         BE    RECDKEY1            YES-BRANCH AROUND PROCESSING    SA0I 14412018
         TM    RECORDSW,FIRSTR     TEST IF FIRST GROUP                  14420000
         BO    RECD3               NOT FIRST GROUP                      14440000
         SR    TEMP1,TEMP1         ZERO WORK REGISTER                   14460000
         STH   TEMP1,0(MCBPTER)    ZERO IN MCB COUNT                    14480000
         LH    TEMP1,PH2           LOAD WORK REGISTER WITH 2 (MCB LEN)  14500000
         ST    TEMP1,CURRMCB       STORE IN MCB LENGTH INDICATOR        14520000
RECD3    L     TEMP1,CURRMCB       LOAD MCB LENGTH                      14540000
         AH    TEMP1,GCBLEN        ADD GROUP CONTROL BLOCK LENGTH       14560000
         C     TEMP1,MCBREM        COMPARE TO MCB SPACE REMAINING       14580000
         BH    PPERRJ              INSUFFICIENT SPACE IN MCB TABLE SA0I 14600018
         LR    GCBPTER,MCBPTER     LOAD GROUP CONTROL BLOCK POINTER     14620000
         A     GCBPTER,CURRMCB     ADD MCB LENGTH                       14640000
         LA    FCBPTER,FCBL        LOAD CONSTANT EIGHT-FCB LENGTH       14660000
         ST    FCBPTER,CURRGCB     STORE FCB LENGTH                     14680000
*              SET POINTER FOR FCB                                      14700000
         LR    FCBPTER,GCBPTER          LOAD FCB ADDRESS                14720000
         MVC   0(GCBL,GCBPTER),PDZERO   ZERO 8 BYTES OF GCB             14740000
         B     RECDKEY1                 BRANCH TO KEYWORD CHECK         14760000
*                                                                       14780000
*              EXAMINE RECORD KEYWORDS                                  14800000
*                                                                       14820000
RECDKEY  BAL   BREG,CALLSCAN       BRANCH TO CALL                       14840000
RECDKEY1 TM    PPWORK,KEYW         TEST FOR KEYWORD                     14860000
         BZ    RKEYNO              NO KEYWORD-BRANCH TO PARAM CHECK     14880000
         NI    PPWORK+81,X'FD'     SET OFF KEYWORD REQUIRED BIT    SA0I 14890018
         LA    ERREG,PPERRJ        ADDRESS OF MSG RTN              SA0I 14900018
         CLC   KIDENT(6),0(R1)    TEST FOR IDENT KEYWORD           SA0I 14920018
         BE    IDKEY               YES-BRANCH TO IDENT PARAM CHECK      14940000
         CLC   KFIELD(6),0(R1)    TEST FOR FIELD KEYWORD           SA0I 14960018
         BNE   PPERRH              INVALID KEYWORD-BRANCH TO MSG   SA0I 14980018
*                                                                       15000000
*              KEYWORD = FIELD,EXAMINE PARAMETER LIST                   15020000
*                                                                       15040000
         CLI   6(R1),X'4D'         IS LEFT PAREN PRESENT          M3312 15040218
         BNE   PPERRY              NO-WRITE ERR MSG               M3312 15040418
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 15040618
         BE    PKUP1               YES-BRANCH AROUND PROCESSING    SA0I 15041218
         LH    TEMP1,FIELDCNT    COUNT OF FLD PARAM'S FOUND SO FAR 1769 15042014
         LA    TEMP1,1(TEMP1)          INCREMEMT COUNT BY 1        1769 15044014
         CH    TEMP1,MAXFLDS           COMPARE NO. OF FIELDS FOUND 1769 15046014
*                                         TO NUMBER ALLOWED        1769 15048014
         BNH   CONTINUE                MAXIMUM NOT EXCEEDED, BRANCH1769 15050014
         L     R1,MAXMSG               TOO MANY FLD PARAM'S        1769 15052014
         MVC   0(7,R1),KMAXFLDS        PREPARE TO WRITE ERROR MSG  1769 15054014
         B     MAXERROR                                            1769 15056014
CONTINUE STH   TEMP1,FIELDCNT          UPDATE FLD PARAM COUNT      1769 15058014
         L     TEMP1,CURRMCB       LOAD MCB LENGTH                      15060000
         AH    TEMP1,FCBLEN        ADD FIELD CONT BLOCK LENGTH          15080000
         C     TEMP1,MCBREM        COMPARE TO MCB SPACE REMAINING       15100000
         BH    PPERRJ              NO ROOM IN MCB TABLE            SA0I 15120018
         L     TEMP2,CURRGCB       ADDRESS OF GROUP CONTROL BLOCK       15140000
         LA    TEMP2,8(0,TEMP2)    INCREMENT BY NAME LENGTH             15160000
         ST    TEMP2,CURRGCB       STORE INCREMENTED ADDRESS            15180000
         AH    FCBPTER,FCBLEN      ADD FCB LENGTH TO FCB ADDRESS        15200000
         MVC   0(FCBL,FCBPTER),PDZERO   ZEROS TO UPDATED FCB            15220000
PKUP1    LA    PARLIST,FLDP1       ADDRESS OF FIELD LENGTH CHECK   SA0I 15240018
FLDPAR   OI    PPWORK+81,X'01'     SET ON PARAMETER REQUIRED BIT   SA0I 15250018
         BAL   BREG,CALLSCAN       BRANCH TO CALL                  SA0I 15260018
         NI    PPWORK+81,X'FE'     SET OFF PARAMETER REQUIRED BIT  SA0I 15270018
         TM    PPWORK,PAR          TEST FOR PARAMETER                   15280000
         BZ    PPERRL              NO-BRANCH TO MSG RTN            SA0I 15300018
         BR    PARLIST             BRANCH TO PARAM CHECK                15320000
*                                                                       15340000
*              FIRST PARAMETER IS FIELD LENGTH                          15360000
*                                                                       15380000
FLDP1    LA    PARLIST,FLDP2       ADDRESS OF INPUT LOCATION CHECK      15400000
         LTR   RZ,RZ               TEST FOR FIELD LENGTH                15420000
         BE    PPERRJ              NO LENGTH SPEC-BRANCH MSG RTN   SA0I 15440018
         BAL   BREG,SETPBIN        BRANCH TO CVB ROUTINE                15460000
         BE    PPERRJ              LENGTH=0,BRANCH TO MESSAGE RTN  SA0I 15470018
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 15480018
         BE    FPNEXT              CONTINUE THROUGH THE PARAMETERS SA0I 15490018
         STH   PREG,0(FCBPTER)     STORE LENGTH IN FIELD CONTROL BLOCK  15500000
         B     FPNEXT              CONTINUE THROUGH PARAMETERS          15520000
*                                                                       15540000
*              SECOND PARAMETER IS RELATIVE INPUT LOCATION              15560000
*                                                                       15580000
FLDP2    LA    PARLIST,FLDP3       ADDRESS OF CONVERSION CHECK          15600000
         LTR   RZ,RZ               TEST IF RILOC SPEC                   15620000
         BE    FPNEXT              NO-CONTINUE THROUGH PARAMETERS       15640000
         BAL   BREG,SETPBIN        BRANCH TO CVB ROUTINE                15660000
         BE    FPNEXT              RILOC=0,CONTINUE THROUGH PARAMETERS  15680000
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 15686018
         BE    FPNEXT              CONTINUE THROUGH THE PARAMETERS SA0I 15692018
         BCTR  PREG,RZ             DECREMENT LENGTH BY ONE              15700000
         STH   PREG,2(FCBPTER)      STORE INPUT LOCATION IN FCB         15720000
         B     FPNEXT              CONTINUE THROUGH PARAMETERS          15740000
*                                                                       15760000
*              THIRD PARAMETER IS CONVERSION CODE                       15780000
*                                                                       15800000
FLDP3    LA    PARLIST,FLDP4       ADDRESS OF OUTPUT LOCATION TEST      15820000
         LTR   RZ,RZ               TEST IF CONVERSION SPECIFIED         15840000
         BE    FPNEXT              NO CONVERSION-CONTINUE THRU PARAMS   15860000
         CLC   PHE(2),0(R1)        TEST FOR PRINTABLE HEX PARAMETER     15880000
         BE    FLDPOR              YES-BRANCH TO FCB OR                 15900000
         CLC   PXE(2),0(R1)        TEST FOR PRINTABLE HEX PARAMETER     15920000
         BNE   FLDP3A              NOT HEX-BRANCH TO UNPACK TEST        15940000
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 15946018
         BE    FPNEXT              CONTINUE THROUGH THE PARAMETERS SA0I 15952018
FLDPOR   OI    4(FCBPTER),X'01'    SET CONVERSION FOR PRINTABLE HEX     15960000
         B     FPNEXT              CONTINUE THROUGH PARAMETERS          15980000
FLDP3A   CLC   PPZ(2),0(R1)        TEST FOR PACKED TO UNPACKED CONVERS  16000000
         BNE   PPERRJ              INVALID PARAM-BRANCH TO MSG RTN      16010018
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 16020018
         BE    FPNEXT              CONTINUE THROUGH THE PARAMETERS SA0I 16030018
         OI    4(FCBPTER),X'03'    SET CONVERSION FOR UNPACK DECIMAL    16040000
*                                                                       16060000
FPNEXT   TM    PPWORK,PARP         TEST FOR END OF PARAMETER LIST       16080000
         BO    FLDPEND             END-BRANCH TO PARAM END ROUTINE      16100000
         B     FLDPAR              CONTINUE THROUGH PARAMETERS          16120000
*                                                                       16140000
*              FOURTH PARAMETER IS RELATIVE OUTPUT LOCATION             16160000
*                                                                       16180000
FLDP4    LTR   RZ,RZ               TEST IF OUTPUT LOCATION SPECIFIED    16200000
         BE    FLDPEND             NOT SPEC-BRANCH TO PARAM END RTN     16220000
         BAL   BREG,SETPBIN        BRANCH TO CVB ROUTINE                16240000
         BE    FLDPEND             PARAM ZERO-BRANCH TO END ROUTINE     16260000
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 16266018
         BE    FLDPEND             BRANCH TO END ROUTINE           SA0I 16272018
         BCTR  PREG,RZ             DECREMENT LOC BY ONE                 16280000
         STH   PREG,6(FCBPTER)     STORE OUTPUT LOCATION IN FCB         16300000
*                                                                       16320000
*              END OF PARAMETER LIST                                    16340000
*                                                                       16360000
FLDPEND  CLI   PPCONCD,X'0C' IS COND. CODE = 12                  A36097 16370021
         BE    RECDKEY       YES, EXAMINE OTHER REC. KEYWORDS    A36097 16372021
         LA    TEMP1,1                                           A36097 16374021
         AH    TEMP1,0(GCBPTER)    INCREMENT FIELD COUNT                16400000
         STH   TEMP1,0(GCBPTER)    STORE NEW FIELD COUNT                16420000
         B     RECDKEY                                                  16440000
*                                                                       16460000
*                                                                       16480000
*        EXAMINE IDENT PARAMETERS                                       16500000
*                                                                       16520000
IDKEY    LA    PARLIST,IDP1        ADDRESS OF LITERAL TEST              16540000
         CLI   6(R1),X'4D'         IS LEFT PAREN PRESENT          M3312 16542018
         BNE   PPERRY              NO-WRITE ERR MSG               M3312 16544018
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 16546018
         BE    IDPAR               BRANCH AROUND PROCESSING        SA0I 16552018
         CLC   COMPREC(2),RECDCNT  COMPARE RECORDS NUMBERS        M4118 16553018
         BE    IDPAR               EQUAL-NO COUNT MULTPLE IDENTS  M4118 16554018
         MVC   COMPREC(2),RECDCNT  UNEQUAL-UPDATE RECORD NUMBERS  M4118 16555018
         LH    BREG,COUNTID        GET COUNT OF RECORDS WITH      M4118 16556018
         AH    BREG,PH1              IDENT PARAMETERS             M4118 16557018
         STH   BREG,COUNTID         AND INCREMENT BY ONE          M4118 16558018
         LH    BREG,IDENTCON       LOAD NO OF IDENTS                    16560000
         LA    BREG,1(0,BREG)      ADD ONE FOR THIS IDENT               16580000
         STH   BREG,IDENTCON       STORE UPDATED IDENT NUMBER           16600000
         CH    BREG,MAXGPS             IS ACTUAL NO.OF IDENT STMTS 1769 16602014
*                                       GREATER THAN NO.SPECIFIED  1769 16604014
         BNH   IDPAR                   NO--CONTINUE.               1769 16606014
         L     R1,MAXMSG               ADDRESS OF ERROR MESSAGE    1769 16608014
         MVC   0(6,R1),KMAXGPS         MOVE'MAXGPS' TO MESSAGE     1769 16610014
         MVI   6(R1),X'40'             MOVE BLANK INTO LAST BYTE   1769 16612014
         B     MAXERROR                GO TO PRINT OUT MESSAGE     1769 16614014
IDPAR    OI    PPWORK+81,X'01'     SET ON PARAMETER REQUIRED BIT   SA0I 16620018
         BAL   BREG,CALLSCAN       BRANCH TO CALL                  SA0I 16626018
         NI    PPWORK+81,X'FE'     SET OFF PARAMETER REQUIRED BIT  SA0I 16632018
         TM    PPWORK,PAR          TEST FOR PARAMETER                   16640000
         BZ    PPERRL              NO-PARM-BRANCH TO MSG RTN       SA0I 16660018
         BR    PARLIST             BRANCH TO LIT TEST                   16680000
*              FIRST PARAMETER IS LENGTH OF LITERAL                     16700000
*                                                                       16720000
IDP1     LA    PARLIST,IDP2        ADDRESS OF LIT PARAM RTN             16740000
         CH    R0,PH1              IS LENGTH GT ONE               M3311 16742018
         BH    PPERRJ              YES-WRITE ERR MSG              M3311 16744018
         CLI   0(R1),X'F0'         IS CHAR NUMERIC                M3311 16746018
         BL    PPERRJ              NO-WRITE ERR MSG               M3311 16748018
         CLI   0(R1),X'F9'         IS CHAR NUMERIC                M3311 16750018
         BH    PPERRJ              NO-WRITE ERR MSG               M3311 16752018
         MVC   LITLEN+3(1),0(R1)   MOVE LENGTH OF LIT TO SAVE AREA      16760000
         NI    LITLEN+3,X'0F'      LENGTH NOT OVER FIFTEEN              16780000
         B     IDPAR               BRANCH TO CALL NEXT PARAM            16800000
*                                                                       16820000
*              SECOND PARAMETER IS A LITERAL                            16840000
*                                                                       16860000
IDP2     LTR   RZ,RZ               TEST FOR LITERAL PARAMETER           16880000
         BE    PPERRL              NONE-BRANCH TO MSG RTN          SA0I 16900018
         SH    RZ,PH2              SUBTRACT 2 (APOSTROPHES)FOR LIT LEN  16920000
         LTR   RZ,RZ               TEST FOR LITERAL LENGTH ZERO         16940000
         BE    PPERRJ              LENGTH ZERO,BRANCH TO MSG RTN   SA0I 16960018
         C     RZ,LITLEN           COMPARE ACTUAL TO STATED LENGTH      16980000
         BNE   PPERRJ              UNEQUAL-BRANCH TO MSG RTN       SA0I 16990018
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 17000018
         BE    PKUP2               BRANCH AROUND PROCESSING        SA0I 17010018
         LH    TEMP2,CURRLIT       LOAD NO OF BYTES STORED IN LIT POOL  17020000
         LH    TEMP1,MAXLITS       LOAD MAXIMUM CHARACTERS              17040000
         LR    PREG,TEMP2          CURRENT NO OF LIT CHARACTERS         17060000
         AR    PREG,RZ             ADD LENGTH OF THIS LITERAL           17080000
         CR    PREG,TEMP1          COMPARE TO-DATE TOTAL TO MAXIMUM     17100000
         BNH   STORLIT                                             1769 17110014
         L     R1,MAXMSG               ADDRESS OF ERROR MESSAGE    1769 17120014
         MVC   0(7,R1),KMAXLITS        MOVE 'MAXLITS' TO MESSAGE   1769 17130014
         B     MAXERROR                GO TO PRINT OUT MESSAGE     1769 17140014
STORLIT  STH   PREG,CURRLIT            STORE NO, OF LIT CHAR USED. 1769 17150014
         STH   RZ,2(GCBPTER)       STORE LITERAL LENGTH IN GCB          17160000
         AH    R1,PH1              INCREMENT LIT LOC TO SKIP APOSTROPHE 17180000
         L     TEMP1,LITADD        ADDRESS OF LITERAL POOL              17200000
         AR    TEMP1,TEMP2         ADD CURRENT SPACE USED               17220000
         STH   TEMP2,4(GCBPTER)    STORE CURRENT SPACE IN GCB           17240000
         LR    TEMP2,RZ            LOAD LENGTH OF LITERAL               17260000
         BCTR  TEMP2,RZ            SUBTRACT ONE (RESTORED IN EX-MVC)    17280000
         EX    TEMP2,IDLITMOV      EXECUTE MOVE INSTRUCTION             17300000
*              TEST FOR END                                             17320000
PKUP2    TM    PPWORK,PARP         TEST FOR END OF LIST            SA0I 17340018
         BO    RECDKEY             END-BRANCH TO RECORD KEYWORD CHECK   17360000
         LA    PARLIST,IDP3        NOT END,CONTINUE THROUGH PARAMETERS  17380000
         B     IDPAR               BRANCH TO PARAMETER CHECK            17400000
*                                                                       17420000
*              THIRD PARAMETER IS RELATIVE INPUT LOCATION               17440000
*                                                                       17460000
IDP3     LTR   RZ,RZ               TEST FOR PARAMETER                   17480000
         BE    RECDKEY             BRANCH TO KEYWORD CHECK              17500000
         BAL   BREG,SETPBIN        BRANCH TO CVB ROUTINE                17520000
         BE    RECDKEY             PARAM ZERO-BRANCH TO KEYWORD CHECK   17540000
         CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 17546018
         BE    RECDKEY             BRANCH AROUND PROCESSING        SA0I 17552018
         BCTR  PREG,RZ             SUBTRACT ONE FROM INPUT LOC (INCRD)  17560000
         STH   PREG,6(GCBPTER)     STORE REL INPUT LOCATION IN GCB      17580000
         B     RECDKEY             BRANCH TO KEYWORD CHECK              17600000
*                                                                       17620000
IDLITMOV MVC   0(1,TEMP1),0(R1)    MOVE LITERAL TO LIT POOL             17640000
*                                                                       17660000
*                                                                       17680000
RKEYNO   TM    PPWORK,PAR          TEST FOR PARAMETER                   17700000
         BZ    RECDEND             NOT PARAM-BRANCH TO REC CARD END     17720000
         B     PPERRJ              YES,WRITE ERROR MESSAGE         SA0I 17750018
*                                                                       17780000
*              RECORD CARD SUCCESSFULLY SCANNED                         17800000
*                                                                       17820000
RECDEND  CLI   PPCONCD,X'0C'       IS CONDITION CODE =12?          SA0I 17830018
         BE    CSCANZ              BRANCH AROUND PROCESSING        SA0I 17840016
         LH    TEMP1,0(MCBPTER)    LOAD GROUP COUNT                SA0I 17850018
         LTR   TEMP1,TEMP1         TEST GROUP COUNT FOR ZERO            17860000
         BH    REND5               THIS IS NOT FIRST GROUP              17880000
         OI    RECORDSW,FIRSTR     SET SWITCH FOR FIRST GROUP           17900000
         L     MNTPTER,CURRMNT     LOAD CURRENT MNT ADDRESS             17920000
         ST    MCBPTER,8(MNTPTER)  STORE MCB ADDRESS IN MNT             17940000
REND5    AH    TEMP1,PH1           INCREMENT GROUP COUNT                17960000
         STH   TEMP1,0(MCBPTER)    STORE UPDATED GROUP COUNT            17980000
         L     TEMP1,CURRGCB       LOAD GCB LENGTH                      18000000
         A     TEMP1,CURRMCB       ADD MCB LENGTH                       18020000
         ST    TEMP1,CURRMCB       STORE TOTAL LENGTH                   18040000
         B     CSCANZ              BRANCH TO SCAN                       18060000
IDLITNO  LA    RZ,RERR                  MESSAGE CODE                    18080000
         B     RCDNOSP1            BRANCH TO LOAD REGISTER ONE          18100000
RCDNOSP  LA    RZ,5                MESSAGE CODE                         18120000
RCDNOSP1 LA    R1,PPAR             MESSAGE OFFSET                       18140000
         B     PPERR               BRANCH TO MESSAGE LINK               18160000
*                                                                  0033 18180015
*                                                                  0033 18240015
MAXERROR LA    RZ,14                   MESSAGE CODE                1769 18283014
         LA    R1,23                   MESSAGE OFFSET              1769 18286014
         B     PPERR                   BRANCH TO MESSAGE LINK.     1769 18289014
         EXTRN MAXMSGS                                             1769 18292014
MAXMSG   DC    A(MAXMSGS)                                          1769 18295014
*                                                                       18300000
PREMSG   SLL   R1,8                SET UP REGISTERS                     18320000
         AR    R1,RZ               FOR MESSAGE WRITE                    18340000
         L     R15,PMSGWRTA        ADDRESS OF MESS WRITE RTN-EXTERN     18360000
         BR    R15                 BRANCH TO MESSAGE WRITE ROUTINE      18380000
*                                                                       18400000
         ENTRY BLKRTN                                              BS0H 18403017
BLKRTN   LA    RZ,7        MESSAGE CODE FOR I/O ERROR ON SYSIN     BS0H 18406017
         LA    R1,PEOJIO                MESSAGE POINTER            BS0H 18409017
         LA    R14,DDRTN1         RETURN ADDRESS AFTER PRINTING    BS0H 18412017
         B     PREMSG             BRANCH TO MESSAGE WRITE ROUTINE  BS0H 18415017
         ENTRY DDRTN                                                    18420000
DDRTN    LA    RZ,11               DDERROR1 MESSAGE NUMBER              18440000
         LA    R1,21               DDERROR1 MESSAGE OFFSET IN IEBPPMSG  18460000
         LA    R14,DDRTN1          RETURN ADDRESS AFTER PRINTING        18480000
         B     PREMSG              BRANCH TO MESSAGE EXIT               18500000
DDRTN1   MVI   PPCONCD,X'0C'       SET RETURN CODE TO TWELVE            18520000
         B     PPRET               BRANCH TO RETURN ROUTINE             18540000
*                                                                       18560000
         EJECT                                                          18580000
*********************************************************************** 18600000
*                                                                       18620000
*              IEBPPAL1 - CONSTANTS                                     18640000
*                                                                       18660000
LITLEN   DC    F'0'                LENGTH OF LITERAL                    18680000
*                                                                       18700000
*        COMMAND LIST                                                   18720000
*                                                                       18740000
CPRINT   DC    C'PRINT '          INIT OPERATION- PT OR            SA0I 18750018
CPUNCH   DC    C'PUNCH '          PUNCH                            SA0I 18760018
CTITLE   DC    C'TITLE '          REQUESTS TITLE,SUBTITLE          SA0I 18770018
CEXITS   DC    C'EXITS '          IDENTIFIES EXIT ROUTINES         SA0I 18780018
CMEMBER  DC    C'MEMBER '         IDENTIFIES MEMBERS OF PDS        SA0I 18790018
CRECORD  DC    C'RECORD '         DEFINES RECORD GROUPS            SA0I 18800018
CLABELS  DC    C'LABELS '                                          SA0I 18810018
*                                                                       18880000
*                                                                       18900000
*        KEYWORD LIST - PRINT/PUNCH                                     18920000
*                                                                       18940000
KTYPORG  DC    C'TYPORG='         SPECIFIES DATA SET ORGANIZATION  SA0I 18950018
KTOTCONV DC    C'TOTCONV='        SPECIFIES OUTPUT CONVERSION      SA0I 18960018
KCNTRL   DC    C'CNTRL='          SPECIFIES CONTROL CHARACTER      SA0I 18970018
KINITPG  DC    C'INITPG='         SPECIFIES INIT PG NUMB-PT        SA0I 18980018
KMAXLINE DC    C'MAXLINE='        SPECIFIES MAX LINES/PAGE-PT      SA0I 18990018
KCDSEQ   DC    C'CDSEQ='          SPECIFIES INIT SEQ NO-PUNCH      SA0I 19000018
KCDINCR  DC    C'CDINCR='         SPECIFIES SEQ. INCR-PUNCH        SA0I 19010018
KSTOPAFT DC    C'STOPAFT='        SPECIFIES NO INPT RCDS TO BE PROCSA0I 19020018
KSKIP    DC    C'SKIP='           SPECIFIES PROC  INCREMENT        SA0I 19030018
KMAXNAME DC    C'MAXNAME='        SPECIFIES MAX MEMBER STS         SA0I 19040018
KMAXFLDS DC    C'MAXFLDS='        SPECIFIES MAX FLD PARMS          SA0I 19050018
KMAXGPS  DC    C'MAXGPS='         SPECIFIES MAX IDENT PARMS        SA0I 19060018
KMAXLITS DC    C'MAXLITS='        SPECIFIES MAX LIT CHARS          SA0I 19070018
KPREFRM  DC    C'PREFORM='        SPECIFIES FORMATTED OUTPUT       SA0I 19080018
KSTRTAFT DC    C'STRTAFT='        SPECIF. THE START NBR          A45135 19130021
*        KEYWORD LIST - LABELS                                     UL0H 19225017
KDATA    DC    C'DATA='                                            SA0I 19230018
KCONV    DC    C'CONV='                                            SA0I 19235018
*                                                                       19240000
*        KEYWORD - TITLE STATEMENT                                      19260000
*                                                                       19280000
KITEM    DC    C'ITEM='           SPEC TITLE OR SUBTITLE INFO      SA0I 19300018
*                                                                       19320000
*        KEYWORD LIST - RECORD STATEMENT                                19340000
*                                                                       19360000
KFIELD   DC    C'FIELD='          EDIT INFO-SPECIFIED PROCESSING   SA0I 19380018
KIDENT   DC    C'IDENT='          IDENTIFIES LAST RCD-FIELD PARM   SA0I 19400018
*                                                                       19420000
*        KEYWORD - MEMBER STATEMENT                                     19440000
*                                                                       19460000
KNAME    DC    C'NAME='           IDENTIFIES MEMBER BY NAME/ALIAS  SA0I 19480018
*                                                                       19500000
*        KEYWORD LIST - EXITS STATEMENT                                 19520000
*                                                                       19540000
KINHDR   DC    C'INHDR='          SPECIFIES NME INPT HDR RTN       SA0I 19547018
KINTLR   DC    C'INTLR='          SPECIFIES NME INPT TRLR RTN      SA0I 19554018
KINREC   DC    C'INREC='          SPECIFIES NME OF P9E796CESS RTN  SA0I 19561018
KOUTREC  DC    C'OUTREC='         SPECIFIES NME OF PREOUTPUT RTN   SA0I 19568018
*                                                                       19575018
*                                                                       19582018
*                                                                       19589018
DOUBLE   DS    D                   DOUBLE WORD FOR CVD             SA0I 19596018
FULL     DS    F                   FULL WORD TO STORE COLUMN NUMB  SA0I 19603018
REGSAV   DS    F                   FULL WORD TO SAVE REG CONTENTS  SA0I 19610018
TITLESAV DS    20F                 TITLE SAVE AREA             @ZA27264 19612099
SEYLE    DS    F                   FULL WORD TO SAVE ADDR MSG      SA0I 19617018
BIT      DC    X'00'               FIRST CARD INDICATOR            SA0I 19624018
BITS     DC    X'00'               SECOND CARD INDICATOR           SA0I 19631018
RECSW    DC    X'00'              TO TEST ORDER OF RECORD MEMBER COMM   19635020
GETMA    DC    X'00'                                             A36090 19637021
*                                                                       19640000
*                                                                       19660000
*        NON-NUMERIC PARAMETERS                                         19680000
*                                                                       19700000
PPS      DC    C'PS'               SPEC PHYSICAL SEQUENTIAL ORGANIZAT   19720000
PPO      DC    C'PO'               SPECIFIES PARTITIONED ORGANIZATION   19740000
PHE      DC    C'HE'               SPEC PRINTABLE HEX CONVERSION        19760000
PXE      DC    C'XE'               SPEC PRINTABLE HEX CONVERSION        19780000
PPZ      DC    C'PZ'               SPEC UNPACKED DECIMAL CONVERSION     19800000
*                                                                       19820000
PNO      DC    C'NO'                                               UL0H 19824017
PALL     DC    C'ALL'                                              UL0H 19828017
PONLY    DC    C'ONLY'                                             UL0H 19832017
PYES     DC    C'YES'                                              UL0H 19836017
SYSIN    DC    X'00'               SET TO 00 IND. SYSIN EMPTY    A21407 19837018
*              X'FF'               SET TO FF FOR SYSIN NOT EMPTY A21407 19838018
*                                                                       19840000
*                                                                       19860000
COMM     EQU   X'08'               INDICATES COMMAND                    19880000
KEYW     EQU   X'04'               INDICATED KEYWORD                    19900000
PAR      EQU   X'02'               INDICATES PARAMETER                  19920000
PARP     EQU   X'03'               INDICATES FINAL PARAMETER            19940000
EOF      EQU   X'20'               INDICATES END OF FILE                19960000
ERROR    EQU   X'80'               INDICATES ERROR                      19980000
BYPASS   EQU   X'40'               INDICATES SKIP RECORD STATEMENTS     20000000
BYPASSNO EQU   X'BF'               INDIC NO SKIP OF RECORD STATEMENTS   20020000
NEWCD    EQU   X'01'               INDICATES NEW CARD                   20040000
RIO      EQU   X'02'               INDICATES I/O ERROR ON SYSIN         20060000
FIRSTR   EQU   X'01'               INDICATES FIRST RECORD               20080000
NEWR     EQU   X'FE'               INDICATES NEW RECORD                 20100000
RCOMM    EQU   X'02'               INDICATES RECORD COMMAND             20120000
*                                                                       20140000
*                                                                       20160000
SAVEADD  DS    18F                 REGISTER SAVE AREA                   20180000
*                                                                       20200000
PPWORK   DS    145B                WORK AREA                            20220000
*                                                                       20240000
WORKLEN  EQU   145                 LENGTH OF WORK AREA                  20260000
*                                                                       20280000
*                                                                       20300000
*        MESSAGE CODES                                                  20320000
*                                                                       20340000
EOFCDE   EQU   0                   END OF FILE                          20360000
RERR     EQU   4                   RECORD ERROR                         20380000
MERR     EQU   5                   MEMBER ERROR                         20400000
IERR     EQU   14                  LITERAL ERROR                        20420000
*                                                                       20440000
PTERM1   EQU   1                   COMMAND ERROR                        20460000
PTERM2   EQU   2                   COMMAND ERROR                        20480000
PTMULT   EQU   3                   TITLE ERROR                          20500000
PKEY     EQU   4                   KEYWORD ERROR                        20520000
PPAR     EQU   5                   PARAMETER ERROR                      20540000
PMEMBNO  EQU   7                   MEMBER ERROR                         20560000
PEOF     EQU   10                  END OF FILE                          20580000
PEOJIO   EQU   13                  I/O ERROR ON SYSIN                   20600000
SYNTMSG  EQU   19                  ERROR INDICATOR ON                   20620000
NOSYSIN  EQU   20   *********TO BE CHECKED                       A21407 20621018
PPIK     EQU   31                  INVALID KEYWORD ER9OR           SA0I 20622018
PPIP     EQU   32                  INVALID PARAMETER ERROR         SA0I 20624018
PPMK     EQU   33                  MISSING KEYWORD ERROR           SA0I 20626018
PPMP     EQU   34                  MISSING PARAMETER ERROR         SA0I 20628018
PPMC     EQU   35                  MISSING COMMAND ERROR           SA0I 20630018
PPIC     EQU   36                  INVALID COMMAND ERROR           SA0I 20632018
PPIL     EQU   37                  INVALID LITERAL ERROR           SA0I 20634018
PPIN     EQU   38                  INVALID NAME ERROR              SA0I 20636018
PPBC     EQU   39                  CONTINUATION CARD ERROR         SA0I 20638018
*                                                                       20640000
*                                                                       20660000
*        REGISTER EQUATES                                               20680000
*                                                                       20700000
TEMP2    EQU   15                  WORK REGISTER                        20720000
R15      EQU   15                  EXTERN BRANCH,RETURN CODE            20740000
R14      EQU   14                  BAL RETURN                           20760000
TEMP1    EQU   14                  WORK REGISTER                        20780000
R13      EQU   13                  SAVE REGISTER                        20800000
ERREG    EQU   12                  ERROR BRANCH REGISTER                20820000
BASE     EQU   11                  BASE REGISTER                   SA0I 20840018
PARLIST  EQU   10                  INTERNAL BRANCH REGISTER             20860000
BASER    EQU   9                   BASE REGISTER                        20880000
PREG     EQU   8                   PARAMETER REGISTER                   20900000
PARLOC   EQU   7                   PARAMETER POINTER                    20920000
BREG     EQU   6                   INTERNAL BRANCH RETURN               20940000
TCBR     EQU   5                   POINTER TO TITLE CONTROL BLOCK       20960000
GCBPTER  EQU   5                   POINTER TO GROUP CONTROL BLOCK       20980000
TEMP4    EQU   5                                                   SA0I 20990018
MNTPTER  EQU   5                   POINTER TO MEMBER NAME TABLE         21000000
KREG     EQU   5                   INTERNAL BRANCH REGISTER             21020000
TREG     EQU   4                   DTABLE BASE REGISTER                 21040000
MEMCT    EQU   3                   MEMBER COUNT REGISTER                21060000
TEMP3    EQU   3                                                   SA0I 21070018
RLIT     EQU   3                   LITERAL LENGTH REGISTER              21080000
FCBPTER  EQU   3                   POINTER TO FCB                       21100000
MCBPTER  EQU   2                   POINTER TO MEMBER CONTROL BLOCK      21120000
R1       EQU   1                   MESSAGE POINTER                      21140000
RZ       EQU   0                   MESSAGE POINTER                      21160000
R0       EQU   0                                                        21180000
*                                                                       21200000
*                                                                       21220000
*                                                                       21240000
TEMPSAVE DC    F'0'                    REGISTER 3 SAVE AREA        4304 21245019
PARMADR  DC    F'0'                    PARAMETER SAVE AREA         4304 21250019
FREEA    DC    F'0'           FREECORE ADDR PASSED TO PPAL1        4304 21255019
IDENTCON DC    H'0'                IDENT SWITCH                         21260000
RECDCNT  DC    H'0'                                                0324 21270017
COMPMEM  DC    H'00'               COUNT TO COMPARE RECD GRP NUMB M4118 21272018
COMPREC  DC    H'00'               COUNT TO COMPARE MEMBER NUMB   M4118 21274018
COUNTID  DC    H'00'               COUNT OF REC CARDS WITH IDENTS M4118 21276018
PPSYSI   DC    D'0'                DDNAME FOR SYSIN                     21280000
SKIPSW   DC    H'0'                RECORD SKIP SWITCH                   21300000
MASK     DC    H'0'                NO MEMBER SWITCH                     21320000
PLANT    DC    H'0'                FULL MCB SWITCH                      21340000
PH1      DC    H'1'                COUNT INCREMENT                      21360000
PH2      DC    H'2'                INCREMENT                            21380000
PH3      DC    H'3'                                                SA0I 21390018
PH4      DC    H'4'                PRE-NAME MNT AREA                    21400000
PH8      DC    H'8'                NAME LENGTH                          21420000
PH10     DC    H'10'                                                    21440000
PH12     DC    H'12'               MNT AREA PER NAME                    21460000
LIT42    DC    H'42'                                             A25956 21470018
MAXOUT1  DC    H'144'              MAX OUTPUT LEN IS 144        OY01168 21475016
PDBLANK  DC    CL8' '              DOUBLE WORD OF BLANKS (FOR BLANKING) 21480000
PDZERO   DC    D'0'                DOUBLE WORD OF ZEROES (FOR ZEROING)  21500000
*                                                                       21520000
*                                                                       21540000
*                                                                       21560000
TABLE    EQU   *                                                        21580000
*                                                                       21600000
*        COMMAND AND KEYWORD SWITCHES                                   21620000
*                                                                       21640000
PPCSW1   DC    X'0'                COMMAND SWITCH-PRINT/PUNCH           21660000
PPCSW2   DC    X'0'      NU                                             21680000
TITLESW  DC    X'0'                TITLESWITCH                          21700000
EXITSW   DC    X'0'      NU                                             21720000
MEMBERSW DC    X'0'      NU                                             21740000
RECORDSW DC    X'0'                RECORD SWITCH                        21760000
PLISTSW  DC    X'0'      NU                                             21780000
FIRSTSW  DC    X'0'      NU        FIRST TIME SWITCH                    21800000
COMMSW   DC    X'0'                COMMAND SWITCH                       21820000
PPCONCD  DC    X'0'                RETURN CODE                          21840000
MAXOUT   DC    H'144'              MAX OUTPUT LEN IS 144        OY01168 21860016
MCBADD   DC    F'0'                ADDRESS OF MCB                       21880000
*                                                                       21900000
LENSAVE  DS    F                   LENGTH SAVE AREA                     21920000
LOCSAVE  DS    F                   LOCATION SAVE AREA                   21940000
DBLWD    DS    1D                 WORK AREA FOR CVB ROUTINE             21960000
*                                                                       21980000
*                                                                       22000000
FIELDCNT DC    H'0'         COUNT OF FLD PARAM'S FOUND SO FAR      1769 22010014
MAXNAME  DC    H'0'                MAX MEMBER STATEMENTS                22020000
MEMBCT   DC    H'0'                MEMBER COUNT                         22040000
MAXGPS   DC    H'0'                MAX IDENT PARAMETERS                 22060000
MAXLITS  DC    H'0'                MAX LITERAL CHARACTERS               22080000
MAXFLDS  DC    H'0'                MAX FIELD PARAMETERS                 22100000
CURRLIT  DC    H'0'                NO OF BYTES STORED IN LITERAL POOL   22120000
CURRGCB  DC    F'0'                LENGTH OF CURRENT GCB                22140000
CURRMCB  DC    F'0'                LENGTH OF CURRENT MCB                22160000
MCBREM   DC    F'0'                REMAINING STORAGE IN MCB             22180000
CURRMNT  DC    F'0'                POINTER TO MNT                       22200000
MCBLEN   DS    F                   MCB LENGTH                           22220000
TABLEN   EQU   *-TABLE             TABLE LENGTH                         22240000
*                                                                       22260000
FCBL     EQU   8                   LENGTH INDICATOR                     22280000
GCBL     EQU   8                  LENGTH INDICATOR                      22300000
*                                                                       22320000
*                                                                       22340000
LISTLEN  EQU   PH12                LENGTH INDICATOR                     22360000
FCBLEN   EQU   PH8                 LENGTH INDICATOR                     22380000
GCBLEN   EQU   PH8                 LENGTH INDICATOR                     22400000
*                                                                       22420000
*                                                                       22440000
*        EXTERNAL REFERENCES                                            22460000
*                                                                       22480000
CDWRT    DC    V(CCWRITE)          ADDRESS OF WRITE EXTERN              22500000
PMSGWRTA DC    V(PPMSGWRT)         ADDRESS OF MESSAGE WRITE EXTERN      22520000
R7    EQU    7                                                     7715 22520419
FREESYND DS    F                  ADDR OF DYNAMIC MSG AREA         7715 22520819
MSGSYNDF DC    CL96'IEB421I I/O ERROR'       SYNAD I/O ERROR MSG   7715 22521219
VZZPR    DC    V(ZZPR)               ADDR OF PRINT ROUTINE IN PPUN17715 22521619
*--------------------MESSAGE POINTERS------EXTERNAL-------------------* 22522018
VPPIKM   DC    V(PPIKM)            INVALID KEYWORD MESSAGE         SA0I 22524018
VPPIPM   DC    V(PPIPM)            INVALID PARAMETER MESSAGE       SA0I 22526018
VPPMKM   DC    V(PPMKM)            MISSING KEYWORD MESSAGE         SA0I 22528018
VPPMPM   DC    V(PPMPM)            MISSING PARAMETER MESSAGE       SA0I 22530018
VPPMCM   DC    V(PPMCM)            MISSING COMMAND MESSAGE         SA0I 22532018
*                                                                       22534018
*                                                                       22536018
*                                                                       22538018
*                                                                       22540000
*                                                                       22560000
DTABLE   DSECT                                                          22580000
DBEGIN   DS    0F                                                       22600000
DDN1     DS    CL8                 DDNAME FOR SYSUT1                    22620000
DDN2     DS    CL8                 DDNAME FOR SYSUT2                    22640000
EXLSTADD DS    A                   ADDRESS OF EXIT LIST                 22660000
LITADD   DC    F'0'                ADDRESS OF LITERAL POOL              22680000
MNTADD   DC    F'0'                ADDRESS OF MNT                       22700000
RCB      DS    0X                                                       22720000
TYPORG   DC    X'0'               DATA SET ORGANIZATION-DEFAULT=PS      22740000
TOTCONV  DC    X'0'                                                     22760000
PPSW1    DC    X'0'                                                     22780000
PPCTL    DC    X'0'                                                     22800000
CDNOB    DC    F'0'                                                     22820000
CDINCRB  DC    F'0'                                                     22840000
INITPG   DC    H'0'               INIT PAGE NUMBER-DEFAULT=1            22860000
PMAXLINE DC    H'0'               MAX LINES PER PAGE-DEFAULT=60         22880000
INITSTOP DC    H'0'               RECORDS TREATED IF STOPAFT SPECIFIED  22900000
INITSKIP DC    H'0'               NTH RECORD TREATED-DEFAULT=ALL        22920000
STRTAFT  DC    H'0'               RECORD     TO START AFT        A45135 22930021
TCB      DS    0F                 TITLE CONTROL BLOCK                   22940000
TCB1     DC    H'0'                    LENGTH                           22960000
         DC    H'0'                    ROLOC                            22980000
         DC    F'0'                    ADDR                             23000000
*                                 SUBTITLE                              23020000
TCB2     DC    H'0'                    LENGTH                           23040000
         DC    H'0'                    ROLOC                            23060000
         DC    F'0'                    ADDR                             23080000
PREFMTP  DC    X'00'               FORMATTED OUTPUT                     23100000
LBLPRTSW DC    X'F0'                    DEFAULT VALUES SET TO PRNT UL0H 23105017
PROCKY   DC    X'80'                    PROCESS =YES               UL0H 23110017
LBLCONSW DC    X'00'                    NO LABEL CONV.             UL0H 23115017
EXLST    DS    0X                 LIST OF USER EXITS                    23120000
EX1      DC    BL8'0'                                              UL0H 23140017
EX3      DC    BL8'0'                                              UL0H 23160017
EXIN     DS    CL8                     INREC                            23180000
EXOUT    DS    CL8                     OUTREC                           23200000
EXLEN    EQU   *-EXLST            EXIT LIST LENGTH                      23220000
DLEN     EQU   *-DBEGIN           DTABLE LENGTH                         23240000
*                                                                       23240819
*      FREECOR TABLE CONTAINS DATA FOR LATER  FREEMAINS FOR DTABLE 4304 23241619
*                                                                  4304 23242419
FREECOR  DSECT                                                     4304 23243219
DTBL     DS    F              DTABLE LENGTH                        4304 23244019
DTBA     DS    F              ADDRESS OF DTABLE                    4304 23244819
GS1L     DS    F              LENGTH OF MNT                        4304 23245619
MNTA     DS    F              ADDRESS OF MNT                       4304 23246419
MCBL     DS    F              LENGTH OF MCB                        4304 23247219
MCBA     DS    F              ADDRESS OF MCB                       4304 23248019
LITS     DS    F              LENGTH-COUNT  OF LITERALS            4304 23248819
LITA     DS    F              ADDRESS OF LITERALS                  4304 23249619
TITLA    DS    F              ADDRESS OF TITLE                     4304 23250419
SUBTITA  DS    F              ADDRESS OF SUBTITLE                  4304 23251219
*                                                                  4304 23252019
*        SWITCHES  TO INDICATE SPECIFIC GETMAINS DONE              4304 23252819
MAIN1    DS    XL1            DTABLE                               4304 23253619
MAIN2    DS    XL1            MEMBER NAMETABLE                     4304 23254419
MAIN3    DS    XL1            MCB                                  4304 23255219
MAIN4    DS    XL1            LITERALS                             4304 23256019
MAIN5    DS    XL1            TITLE                                4304 23256819
MAIN6    DS    XL1            SUBTITLE                             4304 23257619
         END   IEBPPAL1                                                 23260000
./  ADD  SSI=72060161,NAME=IEBPPCH1
     TITLE 'IEBPPCH1-IEBPTPCH MAIN PROCESSOR'                           00020014
*                                                                       00040000
*                                                                       00060000
* TITLE  - IEBPPCH1 ---RELEASE SEVENTEEN                                00080017
*                                                                       00100000
*                                                                       00120000
* FUNCTION/OPERATION - THIS IS THE MAIN PROCESSING MODULE OF THE PRINT/ 00140000
* PUNCH UTILITY. IT OPERATES ON A TABLE BUILT BY IEBPPAL1. IT FUNCTIONS 00160000
* AS FOLLOWS:                                                           00161017
*        THE TABLE IS STORED, AND PROCESSING PARAMATERS ARE             00162017
*  ESTABLISHED.                                                         00163017
* THE INPUT IS OPENED THE FIRST TIME, THE OUTPUT IS OPENED, AND IF      00164002
* NECESSARY THE INPUT IS OPENED THE SECOND TIME. THE INPUT DATA SET IS  00164502
* OPENED AS A BSAM FILE. THE INPUT CAN BE PHYSICAL SEQUENTIAL OR        00165002
* PARTITIONED. A DCB EXIT IS TAKEN BY THE UTILITY WHEREUPON IT IS       00166002
* DETERMINED IF THE INPUT CONSISTS OF VARIABLE SPANNED RECORDS(VALID IN 00167002
* PS ORGANIZATION ONLY). IF VS/VBS,AND THE RECORD LENGTH DOES NOT       00168002
* EXCEED 32K, THE INPUT DATA SET IS CLOSED, AND THEN REOPENED FOR       00169017
* QSAM IO. IF VARIABLE AND >32K, THE FILE IS PROCESSED BLOCK BY         00170017
* BLOCK WITH BSAM.                                                      00171017
*       DURING THE FIRST (OR ONLY) INPUT OPEN, THE UTILITY TAKES        00172017
* A HEADER LABEL EXIT(IF SUL HAS BEEN SPECIFIED FOR SYSUT1). IT         00173017
* INTERROGATES THE TABLE FROM PAL1 FOR USER LABEL PROCESSING            00174017
* INSTRUCTIONS AND EXIT ADDRESS. IF NONE, THE DEFAULT OPTION OF         00175017
* PROCESSING ALL USER HEADER AND TRAILER LABELS AS DATA IS EXCER-       00176017
* CISED. IF A USER EXIT EXISTS, IT IS ACCESSED AND THE LABELS ARE       00177017
* PROCESSED ACCORDING TO THE 'LABELS' STATEMENT,DEPENDENT ON USER       00178017
* SUPPLIED RETURN CODES.                                                00179017
*        UPON RETURN TO THE UTILITY FROM OPEN, THE STORED LABELS        00180017
* ARE OUTPUTTED UNLESS THE USER HAS SPECIFIED OTHERWISE.                00181017
*                                                                       00200000
*      IF THE INPUTDATA SET, SYSUT1, IS PARTITIONED AND THE ENTIRE      00220000
* DATA SET IS TO BE READ AND PROCESSED, THE PROGRAM READS THE DIRECTORY 00240000
* AND EXTRACTS THE NAME AND LOCATION OF EACH ENTRY. THE ENTRIES ARE     00260000
* THEN SORTED BY TTR AND ALIAS SO THAT MEMBERS CAN BE WRITTEN IN THE    00280000
* ORDER OF THEIR PHYSICAL OCCURRENCE ON THE DIRECT ACCESS DEVICE.       00300000
*                                                                       00320000
*                                                                       00420000
*      IF THE INPUT DATA SET IS PARTITIONED, THE NAME AND LOCATION OF   00440000
* THE MEMBER THAT IS TO BE PROCESSED IS OBTAINED AND THE DATA SET IS    00460000
* POSITIONED SO THAT THE MEMBER CAN BE READ.                            00480000
*                                                                       00500000
*      ANY USER-SUPPLIED TITLES ARE WRITTEN AT THIS TIME. IF THE INPUT  00520000
* IS PARTITIONED, THE MEMBER CURRENTLY BEING PROCESSED IS IDENTIFIED.   00540000
* A NEW PAGE IS STARTED FOR PRINTED OUTPUT OR A NEW SEQUENCE NUMBER IS  00560000
* INITIATED FOR PUNCHED OUTPUT. THE PROGRAM THEN DETERMINES WHETHER     00580000
* THERE ARE USER WRITTEN RECORD GROUPS AND PERFORMS INITIALIZATION      00600000
* ACCORDINGLY. IF THERE IS NO EDITING, INITIALIZATION IS PERFORMED TO   00620000
* PROCESS THE SEQUENTIAL DATA SET OR MEMBER IN THE STANDARD FORMAT.     00640000
*                                                                       00660000
*      THE  R D C H  ROUTINE READS A PHYSICAL RECORD AND DETERMINES IF  00680000
* A NOTE LIST IS PRESENT. IF THE PHYSICAL RECORD IS A NOTE LIST AND IT  00700000
* IS TO BE OMITTED, THE NEXT PHYSICAL RECORD IS READ.                   00720000
*                                                                       00740000
*      AT THIS TIME THE  P R E F O R M  ROUTINE TAKES CONTROL IF,       00760000
* PREFORM WAS SPECIFIED AND DEBLOCKS THE INPUT AND WRITES THE OUTPUT.   00780000
* THE OUTPUT MAY BE EITHER PRINTED OR PUNCHED.                          00800000
*                                                                       00820000
*      THE  R E C L O C 1  ROUTINE DEBLOCKS THE PHYSICAL RECORD AND     00840000
* OBTAINS THE LENGTH AND LOCATION OF THE NEXT LOGICAL RECORD. WHEN NO   00860000
* LOGICAL RECORDS REMAIN IN A BLOCK, THE  R E C L O C 1  ROUTINE        00880000
* RETURNS TO THE  R D C H  ROUTINE, AND ANOTHER PHYSICAL RECORD IS      00900000
* READ.                                                                 00920000
*                                                                       00940000
*      A USER EXIT CAN BE TAKEN AT THIS POINT TO PROCESS A LOGICAL      00960000
* RECORD BEFORE IT IS PROCESSED BY THE PROGRAM.                         00980000
*                                                                       01000000
*      THE PROCESSING OF A LOGICAL RECORD INCLUDES CHECKING THE RECORD  01020000
* ID TO DETERMINE IF IT IS THE LAST RECORD IN A RECORD GROUP AND        01040000
* TESTING THE RECORD COUNT TO SEE IF THE RECORD SHOULD BE SKIPPED. IF   01060000
* THE RECORD IS THE LAST RECORD OF A RECORD GROUP, A SWITCH IS SET FOR  01080000
* SUBSEQUENT TESTING. IF THE RECORD IS SKIPPED, CONTROL IS PASSED TO    01100000
* THE END OF RECORD GROUP TEST.                                         01120000
*                                                                       01140000
*      NEXT, THE OUTPUT FORMAT OF THE LOGICAL RECORD IS TESTED TO       01160000
* DETERMINE IF IT IS TO BE STANDARD OR USER DEFINED. THE  F O R M S     01180000
* ROUTINE WRITES A LOGICAL RECORD IN THE STANDARD FORMAT AND WHEN       01200000
* NECESSARY, SEGMENTS THE INPUT RECORD INTO MULTIPLE OUTPUT RECORDS.    01220000
* THE  F O R M U  ROUTINE EDITS A LOGICAL RECORD ACCORDING TO USER      01240000
* SPECIFICATIONS. A USER EXIT MAY BE TAKEN BEFORE THE RECORD IS WRITTEN 01260000
* TO ALLOW THE USER TO PERFORM ADDITIONAL EDITING.                      01280000
*                                                                       01300000
*      AFTER THE LAST RECORD IN EACH RECORD GROUP IS WRITTEN, THE       01320000
* N E X T G R  ROUTINE PERFROMS REINITIALIZATION TO ALLOW THE NEXT      01340000
* RECORD GROUP TO BE PROCESSED.                                         01360000
*                                                                       01380000
*    WHEN THE END OF DATA FOR A MEMBER OF A PO DATA SET IS REACHED      01400017
* THE NAME AND LOCATION OF THE NEXT MEMBER IS OBTAINED AND THE DATA SET 01420000
* IS POSITIONED TO THE NEXT MEMBER.                                     01450017
*        WHEN THE END OF DATA IS REACHED, OR THE USER'S SPECIFIC        01480017
*    DATA REQUEST HAS BEEN FULFILLED,                                   01510017
*                                                                       01540000
*      THE TASK IS TERMINATED AND CONTROL IS RETURNED TO THE CALLING    01560000
* PROGRAM.                                                              01580000
*                                                                       01600000
*                                                                       01620000
* ENTRY POINT - IEBPPCH1 IS ENTERED BY IEBPPUN1 BY A CALL MACRO.        01640000
* REGISTER ONE POINTS TO THE 'DTABLE'.                                  01660000
*                                                                       01680000
*                                                                       01700000
* INPUT - ANY SEQUENTIAL OR PARTITIONED DATA SET WITH FIXED, FIXED      01720000
* BLOCKED, VARIABLE, VARIABLE BLOCKED OR UNDEFINED RECORD FORMATS.      01740000
*                                                                       01760000
*                                                                       01780000
*OUTPUT----                                                             01788017
*    IF PRINTED, CAN BE ANY SIZE SPECIFIED BY THE USER IN THE           01796017
* SYSUT2 DD STATEMENT. IT IS THE USER'S RESPONSIBILITY TO SUPPLY        01804017
* THE CORRECT OUTPUT SIZE, DEPENDENT ON THE CAPABILITIES OF THE         01812017
* DEVICE BEING USED. IF NO OUTPUT SIZE IS SPECIFIED, PRINT/PUNCH        01820017
* SETS THE DEFAULT SIZE OF 121 BYTES. PUNCHED OUTPUT IS 81 BYTES        01828017
* AND BOTH ARE FIXED LENGTH RECORDS, THE FIRST CHARACTER OF             01836017
* WHICH IS A CONTROL CHARACTER FOR THE OUTPUT DEVICE.                   01844017
*  OUTPUT MUST BE RECORD LENGTH PLUS 1 BYTE FOR CONTROL CHARACTER.      01852017
*                                                                       01860000
*                                                                       01880000
* EXTERNAL ROUTINES - USES A BALR TO GO TO TWO ROUTINES IN IEBPPUN1 --  01900000
* PPMSGWRT AND PPMNMSG -- WHICH DECIDES WHAT MESSAGE TO PRINT AND THEN  01920000
* CONTROL IS GIVEN TO THE ZZPR ROUTINE, ALSO OF THE SAME MODULE, WHICH  01940000
* IS THE MESSAGE WRITER.                                                01960000
*                                                                       01980000
*                                                                       02000000
* EXITS - N O R M A L -- A RETURN TO THE USER OF THE PROGRAM.           02020000
*                                                                       02040000
*                        A LINK TO A USER EXIT THAT MANIPULATES LOGICAL 02060000
*                        RECORDS BEFORE PROCESSING(INREC).              02080000
*                                                                       02100000
*                        A LINK TO A USER EXIT THAT MANIPULATES LOGICAL 02120000
*                        RECORDS BEFORE THEY ARE OUTPUTED(OUTREC).      02140000
*                                                                       02160000
*                       A LOAD OF A USER EXIT ROUTINE THAT              02170017
*                       PROCESSES INPUT HDR LABELS(UHIN).               02180017
*                                                                       02190017
*                       A LOAD OF A USER EXIT ROUTINE THAT              02200017
*                       PROCESSES INPUT TLR LABELS(UTIN).               02210017
*   NO TRAILER LABEL EXIT CAN BE TAKEN, IF THE 'STOPAFT' PARAMETER      02220017
* CAUSES  THE UTILITY TO TERMINATE PRIOR TO END OF INPUT.               02230017
*                                                                       02280000
*         E R R O R S -- TO THE ABOVE MENTIONED EXTERNAL ROUTINES WITH  02300000
* IT RETURNING TO THIS MODULES END OF JOB ROUTINE. A MESSAGE LOCATED IN 02320000
* IEBPPMSG MAY ALSO BE EXTERNALLY REFERENCED AND FILLED IN WITH A       02340000
* DDNAME.                                                               02360000
*                                                                       02380000
*                                                                       02400000
* TABLES & WORK AREAS:                                                  02410017
*    STORAGE IS DYNAMICALLY ALLOCATED FOR INPUT AND OUTPUT BUFFERS.     02420017
*  INPUT IS BLOCK SIZE PLUS KEY LENGTH PLUS 4 BYTES FOR SEGMENT         02430017
* DESCRIPTOR WORDS, IF VRE.                                             02440017
*  LABEL PROCESSING REQUIRES 640 BYTES OF FIXED STORAGE                 02450017
* IMBEDDED IN THIS MODULE.                                              02460017
*                                                                       02520000
*                                                                       02540000
* ATTRIBUTES - NON-REUSABLE                                             02560000
*                                                                       02580000
*                                                                       02600000
         EJECT                                                          02620000
*                                                                       02640000
*********************************************************************** 02660000
* EXAMINE PARAMETERS AND PREFORM INITIALIZATION BASED UPON THOSE      * 02680000
* PARAMETERS.                                                         * 02700000
*********************************************************************** 02720000
*                                                                       02740000
IEBPPCH1 CSECT                                                          02780000
*3315050000                                                        4055 02786016
*3315249400-250000,251000,253800-254200                            2461 02792016
*3315248400-248600,250200-250400,252600,255400-255800,263400       VS0H 02794017
*3392271600,271800,351600                                        A23458 02796018
*3392057160,305200                                               A23836 02798018
*182600,196800                                                    24304 02802019
*285810-285950,325660,325720,351000,351600                        27715 02804019
*350207,350235,350239                                             29059 02806019
*143800,144000                                                    29305 02808019
*175200                                                           29475 02810019
*351500                                                           30004 02812019
*393800                                                                 02814019
*350326                                                  PTM4866=A38702 02814520
*039000,039200                                                     2642 02815020
*142000,143200-143600,145200                                     A34102 02815520
*292260,292320                                                   A35453 02815921
*174200                                                          A36088 02821921
*079400-079600,301200                                            A36098 02823921
*057050-057120,350342-350344,351500,821800-827000                A38762 02825921
*A059300,177100,177120                                           A41759 02827921
*C176600                                                         A41759 02829921
*A180700-180760,181000-181320                                    A41816 02834121
*D180700,181000,182720                                           A41816 02834821
*A116020-116192,149580                                           A44337 02835521
*D116400-116600,149600                                           A44337 02836321
*C149800                                                         A44337 02838321
*A228100,228200,229020-221000,229400-229800,351965,829700-829740 A45134 02844100
*D228200,229400-229800                                           A45134 02845000
*A035500-035584,055300-055360,06500,057020-057040,057144-057342  A45135 02845900
*A063420,063440,084700-084780,097304-097388,111900-111997,       A45135 02846800
*A283500-283540,287668-287696,305300,311500,316900,347775-347828 A45135 02847700
*A350221,350277-350280,351937,825320,827900-829600,830300-830800 A45135 02849221
*D038800-041200,053200,057150-057180,057200,287657-287666,       A45135 02851221
*D350277,350278,836300                                           A45135 02853221
*C042600,055400,057371,065140,097400,287692,292260,292320,       A45135 02853621
*C305200,393900,825300                                           A45135 02853721
*A051400,051500,055320-055500,056300                            AS12988 02853821
*D051400,055320-055400                                          AS12988 02854000
*A284320,284350,285840-285845,350050                             A48732 02855900
*D063540-063800,064000,284350,285840                             A48732 02857900
*C351000                                                         A48793 02860421
*A161200-161783,240950,285840-285845,347780-348003,350216,       A48796 02860800
*A350218,350224,350228,351000                                    A48796 02861200
*D161200-161600,240950,285840,347775-347828,350216,350218,       A48796 02861600
*D350221,350223,350301,351000                                    A48796 02862000
*A237800-238200,239100-239160                                    A50923 02862421
*C237800-238200,239000                                           A50923 02864421
*D239200-239600                                                  A50923 02866421
*A276300-276392,837900-838800                                   OY01168 02866616
*C305200,305300,827600,827700,827900,828300,829500              OY01168 02866816
*D275400,275600,276000,350600-351000                            OY01168 02867016
*A028715,116180,116392,116592                                   OY01171 02867516
*D028675,116180                                                 OY01171 02869516
*A61220-61360,351958-351963                                    @YM04138 02869902
*A036700,058850,063620-063720                                   YA01459 02870102
*C036400,058600                                                 YA01459 02870702
*C220800                                                        YA01690 02871102
*D097800-101400                                                @YA02556 02871302
*C 067200                                                      @ZA03373 02871403
*D 067400                                                      @ZA03373 02874703
*C 063620,537800                                               @ZA03383 02874903
*C251000                                                       @ZA04389 02876903
*A103240,103280,105840-105920                                  @ZA06548 02877099
*C103400                                                       @ZA06548 02877199
*C230200,230800,231400-240200                                  @ZA07371 02877299
*A285835,285955                                                @ZA07372 02877399
*C285840                                                       @ZA07372 02877499
*A067250-067400                                                @ZA07374 02877599
*C067600                                                       @ZA07374 02877699
*C103240,103280                                                @ZA07390 02877700
*A226250,226300                                                @ZA11952 02877899
*C226400                                                       @ZA11952 02877999
*A220850-220950                                                @ZA11968 02878000
*C221000                                                       @ZA11968 02878100
         SAVE  (14,12),T,IEBPPCH109-JULY-66 RENUMBER THE STMNT  OY01171 02884003
         BALR  BASER,R0                SET BASIC CSECT ADDRESSABILITY   02890003
         USING *,BASER,BASER2          TWO BASE REGISTERS FOR MODULE    02896003
         USING DTABLE,R1               BASE FOR DTABLE DSECT            02902003
         LA    BASER2,4095(BASER)      SET SECOND BASE ADDRESSABILITY   02908003
         LA    BASER2,1(BASER2)        BUMP SECOND BASE TO 4096         02914003
         ST    R13,PERM13              SAVE REGISTER 13                 02920000
         ST    R13,SAVEADD+4            SAVE ADDRESS OF SAVE AREA       02940000
         LA    R1,SAVEADD               GET PTR TO SAVE AREA            02960000
         ST    R1,8(R13)                STORE PTR TO S.A. IN SAVE AREA  02980000
         L     R1,24(R13)               RESTORE R1                      03000000
         ST    R1,TABLEADD                                         UL0H 03010017
         LA    R13,SAVEADD             LOAD ADDRESS OF THIS SAVE AREA   03020000
*                                                                       03040000
*          EXAMINE TABLE PREPARED BY ROOT SEGMENT                       03060000
*            INDICATE EXIT LIST ADDRESSES IN DCB                        03080000
*                                                                       03100000
         SR    R2,R2                   CLEAR REGISTER TWO               03120000
         C     R2,DDN1                 IS THERE A SYSUT1                03140000
         BE    PRPUN2                  NO --- BRANCH                    03160000
         LA    DCBREG,INSET            YES - GET ADDRESS OF INPUT DCB   03180000
         MVC   DDNAM(8,DCBREG),DDN1    MOVE SYSUT1 TO DCB DDNAME        03200000
PRPUN2   C     R2,DDN2                 IS THERE A SYSUT2                03220000
         BE    PRPUN3                  NO --- BRANCH                    03240000
         LA    DCBREG,OUTSET           YES - GET ADDRESS OF OUTPUT DCB  03260000
         MVC   DDNAM(8,DCBREG),DDN2    MOVE SYSUT2 TO DCB DDNAME        03280000
PRPUN3   C     R2,DEXLSTA              IS THERE AN EXIST LIST           03300000
         BE    PRPUN4                  NO --- BRANCH                    03320000
         L     R4,DEXLSTA              YES -- LOAD EXIT LIST ADDRESS    03340000
         MVC   EXLIST(EXLEN),0(R4)     MOVE LIST TO BREAK IT UP         03360000
         CLI   INHDR,C' '              IS THERE AN INPUT HEADER LAB RTE 03380000
         BE    PRPUN3A                 NO --- BRANCH                    03400000
         LOAD  EPLOC=INHDR                                         UL0H 03406017
         ST    R0,UHIN                                             UL0H 03412017
         OI    UHIN,X'01'              YES -- SET INDICATOR BYTE IN LST 03420000
         MVI   PPHINEX,X'01'      ACTIVATE HEADER LABEL EXIT     A35453 03430021
PRPUN3A  CLI   INTLR,C' '              IS THERE A INPUT TRAILER LAB RTE 03440000
         BE    PRPUN4                  NO EXIT --- BRANCH               03460000
         LOAD  EPLOC=INTLR                                         UL0H 03466017
         ST    R0,UTIN                                             UL0H 03472017
         OI    UTIN,X'03'              YES -- SET INDICATOR BYTE IN LST 03480000
         MVI   PPTINEX,X'03'      ACTIVATE TRAILER LABEL EXIT    A35453 03482021
PRPUN4   L     R1,TABLEADD             RESTORE DTABLE BASE         UL0H 03490017
         MVC   TABLE(TBLEN),DTBLE      MOVE TCBS & SWTCHS TO BRK   UL0H 03500017
*                                      THEM UP FOR PROCESSING           03520000
         DROP  R1                      DROP BASE FOR DTABLE             03540000
         CLI   PROCKY,X'40'        NO LABEL PRINTING ?           A45135 03550021
         BE    CONTIN              YES, SKIP INIT. OF LAB. EX.   A45135 03552021
         MVI   PPHINEX,X'01'       INIT HEADER LAB. EXIT         A45135 03552421
         CLI   PROCKY,X'10'        ONLY LABEL PRINTING ?         A45135 03554021
         BE    CONTIN              YES, SKIP INIT. OF TR. LAB.EX.A45135 03556021
         MVI   PPTINEX,X'03'       INIT. TRAILER LAB  EXIT       A45135 03558021
CONTIN   EQU   *                                                 A45135 03558421
         OC    CDINCRB(4),CDINCRB       CARD INCREMENT SPECIFIED        03560000
         BNE   PRPUN5A                  YES, INCREMENT SPECIFIED        03580000
         MVI   CDINCRB+3,10             NO,DEFAULT OPTION IS 10         03600000
PRPUN5A  CLC   PMAXLINE(2),PHZERO      IS ASSUMED LINES/PAGE COUNT ZERO 03620000
         BNE   WHATTYPE      NO -- BRANCH -- USER SUPPLIED      YA01459 03640002
         MVI   PMAXLINE+1,60           YES -- INITIALIZE IT             03660000
         B     WHATTYPE                OPEN INPUT(SYSUT1) FIRST YA01459 03670002
         EJECT                                                          03680000
*                                                                       03700000
*          OPEN DCBS                                                    03720000
*            INITIALIZE FOR PRINT                                       03740000
*              OR PUNCH OPERATION                                       03760000
*                                                                       03780000
PPOPEN   TM    PPSW1,1                 TEST SWITCH FOR PUNCH OPERATION  03800000
         BZ    PPOPEN4                 OFF -- BRANCH PRINT OPERATION    03820000
*          P U N C H    I N I T I A L I Z A T I O N                     03840000
         LA    DCBREG,OUTSET           LOAD ADDRESS OF OUTPUT DCB       03860000
         LA    CTLREG,STACK2           GET STACKER 2 CTL CHARACTER ADR  04140000
         CLI   CNTRL,X'02'             CHECK CTL CHAR PASSED AS PARAM   04160000
         BE    PPOPEN6                 IF EQUAL USE STACKER TWO         04180000
         BCT   CTLREG,PPOPEN6          IF NOT EQUAL USE STACKER ONE     04200000
*          P R I N T    I N I T I A L I Z A T I O N                     04220000
PPOPEN4  CLI   CNTRL,X'02'             CHECK CTL CHAR PASSED AS PARAM   04240000
         BL    ISITFMT                 IF LOWER SNGLE SPACE OUTP A45135 04260021
         LA    TEMP1,3                 LOAD LINE INCREMENT - TRI SPACE  04280000
         LA    CTLREG,SPTRIPLE         GET ADR OF TRIPLE SPACE CTL CHAR 04300000
         BH    PPOPEN5                 TRIPLE SPACE IF COMPARES HIGHER  04320000
         BCTR  TEMP1,R0                DOUBLE SPACE IF EQUAL COMPARE    04340000
         BCTR  CTLREG,R0               REDUCE PTR TO DOUB SPACE CTL CHR 04360000
PPOPEN5  STH   TEMP1,LINEINCR          INITIALIZE LINE INCREMENT TO A   04380000
*                                      2 OR 3 -- ASSEMBLY TIME SET TO 1 04400000
PPOPEN6  MVC   PPCTL(1),0(CTLREG)      MOVE CTL CHAR TO OUTPUT BUFFER   04420000
ISITFMT  TM    PREFORMT,X'81'          IS IT PREFORMATTED INPUT         04540000
         BZ    CHKDCBS                                             7034 04560000
         TM    PREFORMT,X'80'          IS IT IN ASA CONTROL CHARACTER   04580000
         BO    CHKDCBS                                             1591 04600014
         NI    OUTSET+36,X'F9'         CLEAR OUT CTL CHAR BITS IN DCB   04620000
         OI    OUTSET+36,X'02'         SET CTL CHAR TO MACHINE CODE     04640000
*                                                                  7034 04660000
*    CHECK ...ARE BOTH SYSPRINT AND SYSUT2  USING  SAME  U.C.B.    7034 04680000
*                                                                  7034 04700000
CHKDCBS  STM   R4,R6,KEEPR4R6   SAVE R4 R5  R6                     7034 04720000
         LA    R6,OUTSET    D C B  ADDRESS                         7034 04740000
         SR    R5,R5                                               7034 04760000
         L     R5,16(R5)      GET POINTER TO TCB FROM CVT          7034 04780000
         L     R5,0(R5)   POINTS TO POINTER OF T C B               7034 04800000
         L     R5,4(R5)       POINTER TO CURRENT TCB               7034 04820000
         L     R5,12(R5)      POINTER TO TIOT                      7034 04840000
         ST    R5,STARTIOT    SAVE POINTER TO START OF TIOT        7034 04860000
         LA    R5,28(R5)      FIRST DDNAME ENTRY                   7034 04880000
         MVC   SISUT2(8),DDNAM(R6)   GET SYSUT2 DDNAME             7034 04900000
FINDIT   CLC   0(8,R5),SISUT2      IS THIS ENTRY SYSUT2 T          7034 04920000
         BC    8,GETUCB       YES...GO FIND UCB                    7034 04940000
         LA    R4,4          ADDRESS CORECTION                     4055 04947016
         SR    R5,R4         GET BEGINNING OF DD ENTRY             4055 04954016
         IC    R4,0(R5)      GET LENGTH OF DD ENTRY                4055 04961016
         AR    R5,R4         UPDATE POINTER TO NEXT DD ENTRY       4055 04968016
         TM    0(R5),X'FF'   IS TIOT ENDED                         4055 04975016
         BZ    NOENTRY       YES...ERROR    NO...CONTINUE          4055 04982016
         LA    R5,4(R5)      GET ADDRESS OF NEXT DDNAME            4055 04989016
         B     FINDIT         SEARCH SOME MORE                     7034 05020000
*                                                                  7034 05040000
*              GET SYSUT2   UCB ...TEST IT FOR TAPE                7034 05060000
*                                                                  7034 05080000
GETUCB   L     R5,12(R5)       POINTER TO UCB                      7034 05100000
         LA    R5,0(R5)       CLEAR HIGH ORDER BYTE                7034 05120000
         LTR   R4,R5              TST UCB ADDR.  FOR ZERO       AS12988 05140021
         BZ    PPOPOUT1           ZERO, OPEN SYSUT2             AS12988 05150021
         TM   18(R5),X'80'     IS IT TAPE                          7034 05160000
         BO    CHKSYSPR     GO GET SYSPRINT U C B                  7034 05180000
         LM    R4,R6,KEEPR4R6      NO...                           7034 05200000
         B     PPOPOUT          GO TO NORMAL OPEN FOR SYSUT2       7034 05220000
*                                                                  7034 05240000
*        FIND  SYSPRINT UCB AND COMPARE IT WITH SYSUT2 UCB         7034 05260000
*                                                                  7034 05280000
CHKSYSPR L     R5,SYSPRPTR    GET ADDRESS OF VCON PPOUT            7034 05300000
         LH    R5,40(R5)    GET T I O T   OFFSET                   7034 05320000
         L     R6,STARTIOT    BEGINNING OF T I O T  TABLE          7034 05340000
         AR    R5,R6      ADD OFFSET TO START OF T I O T           7034 05360000
         L     R5,16(R5)    GET U C B    ADDRESS                   7034 05380000
         LA    R5,0(R5)       CLEAR THE HIGH ORDER BYTE            7034 05400000
         CR    R4,R5          COMPARE UCB ADDRESSES                7034 05420000
         BC    8,SETTAPES     EQUAL...DONT OPEN DCB FOR SYSUT2     7034 05440000
         LM    R4,R6,KEEPR4R6     RESTORE R4  R5  R6               7034 05460000
         B     PPOPOUT        DO NORMAL SYSUT2 OPEN                7034 05480000
SETTAPES MVI   NOTOPEN,X'F0'  SET SWITCH FOR WRITE                 7034 05500000
         TM    PPSW1,1             PUNCHED OUTPUT ?              A45135 05530021
         BO    NOENTRY            YES,SEND ERR. MSG. IEB411I    AS12988 05532021
         TM    OUTSET+36,X'02'    IS RECFM FBM ?                AS12988 05541021
         BNO   INSEGTST           NO,DONT OPEN UT2 AND CONT.    AS12988 05550021
NOENTRY  LM    R4,R6,KEEPR4R6  RESTORE R4 R5 R6                    7034 05560000
         LA    TEMP1,OUTSET       DCB OF DDNAME NOT FOUND IN TIOT  7034 05580000
         B     DDERROR                                             7034 05600000
*          O P E N    O U T P U T    D C B                              05620000
PPOPOUT1 LM    R4,R6,KEEPR4R6     RESTORE R4,R5,R6              AS12988 05630021
PPOPOUT  OPEN  (OUTSET,OUTPUT)                                          05640000
         STM   R4,R6,KEEPR4R6                                           05650021
         LA    TEMP1,OUTSET            GET ADR OF SYSUT2 DCB - OUTPUT   05660000
         TM    OFLGS(TEMP1),X'10'      HAS IT BEEN OPENED               05680000
         BZ    DDERROR                 NO - PRINT ERROR MESSAGE         05700000
         TM    ERRDCB,X'80'   WRONG LRECL OR BLKSIZE PARAM ?     A45135 05702021
         BO    DCBERROR       YES, PRINT ERROR MESS.             A45135 05704021
         LH    R5,82(TEMP1)  CHECK FOR MAX LRECL                 A38762 05705021
         SH    R5,PH1                                              VS0H 05714017
         STH   R5,MAXOUT           STORE LRECL-1                 A45135 05714421
         TM    PPSW1,1             PUNCH OPERATION ?             A45135 05714521
         BZ    PRINTBUF            NO, TEST PRINTBUFF. LENGTH    A45135 05714621
SEQCHECK TM    PPSW1,X'03'         CARDS TO BE SEQUENCED ?       A45135 05714821
         BNO   *+8            NO, SET SPECIF. VALUES             A45135 05714921
         LA    R5,72               LOAD DATA FIELD LENGTH        A45135 05715021
         STH   R5,INSEG            INSERT SEGMENT LENGTH         A45135 05715421
         STH   R5,OUTSEG           SET OUTPUT SEGM. LENGTH       A45135 05715521
         LA    R5,1                LOAD ONE FOR MAXSEG           A45135 05715721
         STH   R5,MAXSEG           STORE ONE IN MAXSEG           A45135 05715821
INSEGTST TM    TOTCONV,1           CONVERSION OF DATA ?          A45135 05716421
         BZ   FINISH               NO, LEAVE THE INSEG VALUE     A45135 05716621
         LH    TEMP1,INSEG         LOAD CHAR. COUNT PER OUTP. GR A45135 05716821
         SRL   TEMP1,1             DIVIDE COUNT IN HALF          A45135 05717021
         STH   TEMP1,INSEG         STORE IT BACK                 A45135 05717221
         B     FINISH              END INITIAL. OF OUTPUT FORMAT A45135 05717421
PRINTBUF SR    R4,R4               ZERO REG 4 FOR DIV PURP.      A45135 05718421
         LH    R5,MAXOUT           LOAD MAXOUT PARAMETER         A45135 05718821
         CH    R5,=H'10'           LRECL-1 SMALLER TH TEN ?      A45135 05718921
         BH    TMAXSEG             NO, DETECT MAXSEG             A45135 05719021
         STH   R5,INSEG            SET INSEG AND                 A45135 05719121
         STH   R5,OUTSEG           OUTSET EQ TO MAXOUT           A45135 05722021
         LA    R5,1                SET NUMBER OF                 A45135 05724021
         STH   R5,MAXSEG           SEGMENTS TO ONE               A45135 05724421
         B     INSEGTST            SCAN FOR CONVERTING           A45135 05724821
TMAXSEG  LA    R6,10               CALCULATE THE                 A45135 05725521
         DR    R4,R6               NUMBER OF                     A45135 05728421
         STH   R5,MAXSEG           SEGMENTS                      A45135 05731321
         B     INSEGTST            TEST FOR CONVERTING           A45135 05733321
FINISH   LM    R4,R6,KEEPR4R6      LOAD REG 4 TO R6              A45135 05734221
FINISHUP CLC   INITSKIP(2),PHZERO                                A45135 05737121
         BE    PPOPEN10                YES -- BRANCH                    05740000
         LH    TEMP1,INITSKIP          NO -- LOAD RECORD NUMBER TO SKIP 05760000
         BCTR  TEMP1,R0                REDUCE IT BY ONE                 05780000
         STH   TEMP1,INITSKIP          STORE IT BACK                    05800000
         OI    INSW,SKIP               SET SWITCH TO ONE                05820000
PPOPEN10 CLC   INITSTOP(2),PHZERO      DO ALL RECORDS GET PROCESSED     05840000
         BE    POSTOPEN                OPEN HAS BEEN DONE FOR   YA01459 05860002
*                                       SYSUT1 (FIRST TIME) AND YA01459 05866002
*                                       SYSUT2                  YA01459 05872002
         OI    INSW,STOP               NO -- SET SWITCH TO TWO          05880000
         B     POSTOPEN                OPEN HAS BEEN DONE FOR   YA01459 05885002
*                                       SYSUT1 (FIRST TIME) AND YA01459 05890002
*                                       SYSUT2                  YA01459 05895002
WHATTYPE TM    TYPORG,3                WHAT TYPE DATA SET IS THE INPUT  05900000
         BZ    PREOPEN                 BITS OF = SEQ.              VS0H 05920017
         MVI   SDSEOD+1,X'00'      MARK INPUT NOT EMPTY          A41759 05930021
         BO    PREOP1                  ONLY PROCESS SOME MEMBERS OF PDS 05940000
         OI    POSTOPEN+1,X'F0'        TOTAL PDS, READ DIRECTORY FIRST  05960000
*                                      SET UNCONDITIONAL BRANCH ALSO    05980000
         B     PREOPEN                                             VS0H 06000017
PREOP1   LA    DCBREG,INSET            LOAD ADDRESS OF INPUT DCB        06020000
         MVI   DSORG(DCBREG),X'02'     MOVE PDS ORGANIZATION TO DCB     06040000
*          O P E N    I N P U T    D C B    T W I C E                   06060000
*             F I R S T    R E A D    D I R E C T O R Y                 06080000
*                T H E N    R E A D    M E M B E R S                    06100000
PREOPEN  LA    DCBREG,INSET                                        VS0H 06106017
         MVC   BSAMACRF(2,DCBREG),BSAMSPEC                         VS0H 06112017
         TM    TYPORG,3                                                 06114002
         BNZ   PSETOPSW                                                 06114402
         MVI   BSAMACRF(DCBREG),X'20'                                   06114802
PSETOPSW OI    OPENSW,X'10'            SET SW TO INDICATE VOL 1    UL0H 06116002
PPOPENIN OPEN  (INSET,INPUT)                                            06120000
* IF QSAM PROCESSING MUST BE USED, CLOSE DATA SET AND          @YM04138 06122002
* RE-OPEN IT                                                   @YM04138 06124002
         TM    AMSW,QSAM         QSAM PROCESSING NEEDED        @YM04138 06126002
         BZ    BSMOK             NO - BSAM OK                  @YM04138 06128002
         CLOSE (INSET)           CLOSE INPUT D/S               @YM04138 06130002
         MVC   BSAMACRF(2,DCBREG),QSAMSPEC CHANGE MACRF FROM   @YM04138 06132002
*                                BSAM TO QSAM                  @YM04138 06134002
         OPEN  (INSET,INPUT)     RE-OPEN FOR QSAM PROCESSING   @YM04138 06136002
BSMOK    EQU   *                                               @YM04138 06138002
*                                                                       06140000
*********************************************************************** 06160000
* CHECK TO SEE IF SYSUT1 DCB HAS BEEN OPENED. IF NOT PRINT AN ERROR   * 06180000
* MESSAGE STATING THAT SYSUT1 OR A CORRESPONDING DDNAME COULD NOT BE  * 06200000
* OPENED. A RETURN CODE OF 12 IS GIVEN. THE SAME PROCEDURE IS FOLLOWED* 06220000
* WHEN SYSUT2 COULD NOT BE OPENED.                                    * 06240000
*********************************************************************** 06260000
*                                                                       06280000
         LA    TEMP1,INSET             GET ADR OF SYSUT1 DCB - INPUT    06300000
         TM    OFLGS(TEMP1),X'10'      HAS IT BEEN OPENED               06320000
         BZ    DDERROR                 NO, PRINT AN ERROR MESSAGE       06340000
         TM    ERRDCB,X'80'      OPEN ERROR  ?                   A45135 06342021
         BO    DCBERROR          YES, PRINT MESS. AND TERM. EXEC.A45135 06344021
TESTRC   CLI   MSGWS,00                SEE IF  ANY MSG FROM OPEN   VS0H 06346017
         BNE   OPENMSG                                             VS0H 06352017
TESTOPEN TM    OUTSET+OFLGS,X'10'     IS OUTPUT (SYSUT2) OPEN? @ZA03383 06362003
         BZ    PPOPEN                  NO, OPEN IT              YA01459 06372002
*                                                                       06382017
*****************************************************************  UL0H 06384017
*   SEE IF CONDITIONS HAVE BEEN ESTABLISHED TO PRINT INPUT HDR  *  UL0H 06386017
*   LABELS. GO TO COMMON RTNE FOR HDR & TRLR LABEL PRINTING     *  UL0H 06388017
*****************************************************************  UL0H 06390017
         EJECT                                                          06420000
POSTOPEN NOP   TOTAL                   SWITCH TO READ DIRECTORY AND     06440000
*                                      SORT ENTRIES (BRANCH TAKEN) OR   06460000
*                                      READ MEMBERS (FALL THROUGH)      06480000
POSTMSG  LA    TEMP1,INSET             GET ADDR. OF INPUT DCB      VS0H 06500017
         TM    QSBRNOP+1,X'F0'                                     VS0H 06507017
         BO    QSSWSET                 CONT VBS PROCESS.         A45135 06514021
REALLYOP BAL   R8,LBLPRNT                                          UL0H 06521017
         NI    OPENSW,X'00'            SET VOL1 SWITCH OFF         UL0H 06522017
         CLI   PROCKY,X'10'                                        UL0H 06523017
         BE    ONLYIHL                 'ONLY' SPECIFIED,GO TO EOJ  UL0H 06525017
         TM    DEVT(TEMP1),X'20'                                   UL0H 06528017
         BO    PPSDS                   YES -- BRANCH                    06540000
         MVC   KEYLEN(2),PHZERO        SET KEYLEN TO ZERO FOR TAPE      06560000
PPSDS    LH    R0,BLKLEN               LOAD INPUT DATA SET BLOCK LENGTH 06580000
         AH    R0,KEYLEN               ADD KEY LENGTH TO BLOCK LENGTH   06600000
         ST    R0,LENGTHSV             SAVE INPUT RECORD LENGTH         06620000
*          G E T    I N P U T    B U F F E R                            06640000
         GETMAIN R,LV=(0)              GET CORE FOR THAT SIZE RECORD    06660000
         ST    R1,INBUFF               SAVE INPUT BUFFER ADDRESS        06680000
         ST    R1,LENGTHAD             SAVE INPUT BUFFER ADDRESS        06700000
GOTMAIN  EQU   *                                               @ZA03373 06720003
         TM    TYPORG,1           IS INPUT A PDS?              @ZA07374 06725099
         BO    NOTSTPRE           YES,DON'T TEST PREFORMATTED  @ZA07374 06730099
         TM    PREFORMT,X'81'     IS IT PREFORMATTED INPUT?    @ZA07374 06735099
         BM    RDCH               YES,GO AND READ A RECORD     @ZA07374 06740099
NOTSTPRE TM    TYPORG,3           TEST FOR SELECTED MEMBERS    @ZA07374 06760099
         BO    PDPART                  YES --- BRANCH                   06780000
         L     MCBR,MNTADD             LOAD MEMBER NAME TABLE ADDRESS   06800000
         LTR   MCBR,MCBR               TEST FOR AN ADDRESS TO MNT       06820000
         BZ    NOPTR                   ZERO -- BRANCH -- NO ADDRESS     06840000
         L     MCBR,12(MCBR)           GET MCBADD FROM MNT - PTR TO GCB 06860000
         ST    MCBR,MCBRWS                                         VS0H 06870017
NOPTR    TM    TYPORG,1                IS THIS A TOTAL PDS OPERATION    06880000
         BZ    PPSDSH                  NO --- BRANCH                    06900000
         L     LISTR,DIRADD            YES -- GET ADR OF MEMBER NAMES   06920000
PDT1     LA    TEMP1,1                 TO ACCOUNT FOR TRUE NAME         06940000
         CH    TEMP1,MEMBCT            EXCEEDED TOTAL - CK MEMBER COUNT 06960000
         BE    PDT3                    YES -- BRANCH                    06980000
         LR    TEMP2,LISTR             MOVE POINTER TO MEMBER ADDRESSES 07000000
PDT2     AH    TEMP2,LISTLEN           BUMP PTR TO NEXT MEMBER          07020000
         TM    11(TEMP2),X'80'         IS THIS AN ALIAS                 07040000
         BZ    PDT3                    NO -- BRANCH                     07060000
         CLC   8(3,LISTR),8(TEMP2)     IS THIS ALIAS FOR THIS MEMBER    07080000
         BNE   PDT3                    NO IT IS NOT - BRANCH            07100000
         AH    TEMP1,PH1               INCREMENT MEMBER NAME COUNT BY 1 07120000
         CH    TEMP1,MEMBCT            HAS TOTAL BEEN EXCEEDED          07140000
         BNE   PDT2                    NO -- LOOP                       07160000
PDT3     BCTR  TEMP1,R0                REDUCE TRUE MEMBER NAME COUNT    07180000
         STH   TEMP1,ALIASCT           STORE ALIAS NAME COUNT FOR MEMBR 07200000
         LH    TEMP2,MEMBCT            SUBTRACT ALIASES FROM TOTAL CT   07220000
         SR    TEMP2,TEMP1                                              07240000
         STH   TEMP2,MEMBCT            UPDATE MEMBER NAME COUNT         07260000
         B     MEMBLOC                 LOCATE MEMBER                    07280000
PDPART   L     LISTR,MNTADD            LOAD MEMBER NAME TABLE ADDRESS   07300000
         L     LISTCT,0(LISTR)         LOAD MEMBER COUNT                07320000
         STH   LISTCT,MEMBCT           STORE MEMBER NAME COUNT          07340000
         LA    LISTR,4(LISTR)          POINT TO NAMED MEMBER            07360000
         ST    LISTR,DIRADD            STORE LOCATION OF TABLE          07380000
PDP1     L     MCBR,8(LISTR)           LOAD POINTER TO GCB              07400000
         ST    MCBR,MCBRWS                                         VS0H 07410017
*                                                                       07420000
*********************************************************************** 07440000
* BLDL WITH A MEMBER NAME TO SEE IF THIS MEMBER EXISTS IN THE PDS.    * 07460000
* PRECEDING THE MEMBER NAME IS ONE FULL WORD OF BLDL INFORMATION CON -* 07480000
* SISTING OF A HALF WORD FOR THE NUMBER OF ENTRIES IN THE BLDL LIST   * 07500000
* AND THE SECOND HALF WORD IS THE LENGTH OF THE ENTRY. THE MAXIMUM    * 07520000
* LENGTH FOR A DIRECTORY ENTRY IS 74 BYTES. IF ENTRIES ARE SHORTER    * 07540000
* ONLY THE ACTUAL LENGTH IS RETUREND. THE MAIN ITEM RETURNED IS THE   * 07560000
* TTR FOR THE MEMBER WHICH IS TAKEN FROM THE DIRECTORY AND USED IN    * 07580000
* THE 'FIND' MACRO.                                                   * 07600000
*********************************************************************** 07620000
*                                                                       07640000
MEMBLOC  LA    R1,BLDLADD              GET ADDRESS OF BLDL LIST         07660000
         MVC   4(8,R1),0(LISTR)        MOVE MEMBER NAME TO BLDL LIST    07680000
         BLDL  INSET,BLDLADD           IS MEMBER NAME IN DIRECTORY      07700000
         CH    R15,PH4                 CHECK RETURN CODE AGAINST A 4    07720000
         BL    FINDMEM                 CODE 0 -- BRANCH -- FOUND MEMBER 07740000
         BE    MEMBNO                  CODE 4 -- BRANCH -- NOT FOUND    07760000
         B     IOERRIN                 CODE 8 -- BRANCH -- I/O ERROR    07780000
*                                                                       07800000
QSSWSET  MVC   QSSW+1(1),=X'F0'                                    VS0H 07807017
         CLI   PROCKY,X'10'                                        UL0H 07807617
         BE    REALLYOP                'ONLY' WAS SPECIFIED        UL0H 07808217
         BAL   R8,LBLPRNT                                          UL0H 07809217
         NI    OPENSW,X'00'            SET VOL1 SWITCH OFF         UL0H 07809317
         LH    R0,LRECL                                            VS0H 07809417
         ST    R0,LENGTHSV                                         VS0H 07809517
         AH    R0,KEYLEN                                           VS0H 07809617
         GETMAIN R,LV=(0)                                          VS0H 07809817
         ST    R1,INBUFF                                           VS0H 07810017
         ST    R1,LENGTHAD                                         VS0H 07810117
         B     GOTMAIN                                             VS0H 07814117
*********************************************************************** 07820000
* THE FIND MACRO USES THE TTR GIVEN BY BLDL, THIS POINTS TO THE FIRST * 07840000
* RECORD OF THE MEMBER. THE ABSOLUTE DISK ADDRESS OF THE MEMBER IS    * 07860000
* PLACED IN THE SYSUT1 DCB AS A RESULT OF THE FIND MACRO.             * 07880000
*********************************************************************** 07900000
*                                                                       07920000
FINDMEM  FIND  INSET,BLDTTR,C     CALCULATE TTR OF THE MEMBER    A36098 07940021
PPSDSH   BAL   BREG,PPHEAD                                         VS0H 07970017
         L     MCBR,MCBRWS                                         VS0H 07990017
         EJECT                                                          08000000
*                                                                       08020000
*********************************************************************** 08040000
* THIS ROUTINE DETERMINES IF EDITING OR SKIPPING IS TO TAKE PLACE     * 08060000
* AND INITIALIZES ACCORDINGLY.                                        * 08080000
*********************************************************************** 08100000
*                                                                       08120000
         LTR   MCBR,MCBR               IS THERE A MEMBER NAME TABLE     08140000
         BC    13,NOMCB                NO - BRANCH                      08160000
         LH    TEMP1,0(MCBR)                                            08180000
         LTR   TEMP1,TEMP1             ARE THERE USER DEFINED RECD GRPS 08200000
         BP    PPSDS2                  YES, POINT TO RECD GROUP DESCRIP 08220000
NOMCB    LA    TEMP1,1                 NO, SET SWITCHES FOR STAND. OUT. 08240000
         STH   TEMP1,GRCT              STORE RECORD GROUP COUNT         08260000
PPSI     MVI   IDSW,0                  SET INPUT GROUP SWITCH TO ZERO   08280000
PPSF     MVI   FORMATSW,0              SET OUTPUT FORMAT SWITCH TO ZERO 08300000
*                                      FOR STANDARD FORMAT OUTPUT       08320000
         B     PPSDS4                                                   08340000
PPSDS2   STH   TEMP1,GRCT              STORE RECORD GROUP COUNT         08360000
         LR    GCBR,MCBR               MOVE PTR TO MEMBER NAME TABLE    08380000
         AH    GCBR,PH2                POINT TO FIRST GROUP             08400000
         BAL   BREG,SETGCBSW           SET RECORD GROUP SWITCHES        08420000
PPSDS4   XC    CURSKIP(2),CURSKIP      CLEAR WORK AREAS                 08440000
         XC    CURSTOP(2),CURSTOP                                       08460000
         LH    TEMP1,STRTAFT      WAS STRTAFT NBR                A45135 08470021
         LTR   TEMP1,TEMP1        SPECIFIED?                     A45135 08472021
         BZ    RDCH               NO,READ A PHYS. RECORD         A45135 08474021
         XC    CURSTRT(2),CURSTRT YES, CLEAR WORKAREA            A45135 08476021
         OI    INSW,X'04'         SET STRT NBR SWITCH            A45135 08478021
         B     RDCH                    READ A PHYSICAL RECORD           08480000
*                                                                       08500000
*          SET RECORD GROUP SWITCHES                                    08520000
*                                                                       08540000
SETGCBSW LA    TEMP2,1                 LOAD A 'ONE' BIT                 08560000
         LH    TEMP1,0(GCBR)           LOAD PTR TO RECORD GROUP         08580000
         LTR   TEMP1,TEMP1             ARE THERE USER DEFINED FIELDS    08600000
         BP    SETG1                   YES - BRANCH - FORMAT SW IS 1    08620000
         SR    TEMP2,TEMP2             NO - CLEAR REG - FORMAT SW IS 0  08640000
SETG1    EX    TEMP2,PPSF              SET OUTPUT FORMAT SWITCH         08660000
         LA    TEMP2,1                 RELOAD A 'ONE' BIT               08680000
         LH    TEMP1,2(GCBR)           LOAD GROUP IDENTIFIER            08700000
         LTR   TEMP1,TEMP1             IS THERE A GROUP IDENTIFIER      08720000
         BP    SETG2                   YES - BRANCH - ID SW WILL BE 1   08740000
         SR    TEMP2,TEMP2             NO CLEAR REG - ID SW WILL BE 0   08760000
SETG2    EX    TEMP2,PPSI              SET ID SWITCH                    08780000
         BR    BREG                    RETURN TO MAIN LINE OF CODE      08800000
         EJECT                                                          08820000
*                                                                       08840000
*          FORMAT OF MEMBER NAME TABLE                                  08860000
*                                                                       08880000
*        *4 BYTES *8 BYTES         *4 BYTES                             08900000
*        ************************************    MEMBERCT EQUALS        08920000
*        *MEMBERCT*MEMBER NAME     *GCB ADDR*    12 X NO. OF ENTRIES    08940000
*        ************************************                           08960000
*                 *MEMBER NAME     *GCB ADDR*                           08980000
*                 ***************************                           09000000
*                 *MEMBER NAME     *GCB ADDR*                           09020000
*                 ***************************                           09040000
*                 *ETC.                     *                           09060000
*                 ***************************                           09080000
*                                                                       09100000
*                                                                       09120000
*        FORMAT OF GETMAIN AREA FOR GROUP CONTROL BLOCKS (GCB)     1591 09124014
*        AND FIELD CONTROL BLOCKS (FCB)                            1591 09128014
*                                                                  1591 09132014
*                                                                  1591 09136014
* 2 BYTES- NUMBER OF GCB'S FOLLOWING                               1591 09140014
*                                                                  1591 09144014
*                                                                  1591 09148014
* 8 BYTES- FIRST GCB                                               1591 09152014
*          2 BYTES- NUMBER OF FCB'S FOR THIS GCB                   1591 09156014
*          2 BYTES- LENGTH OF CURRENT IDENT LITERAL                1591 09160014
*          2 BYTES- DISPLACEMENT OF CURRENT IDENT IN LITERAL POOL  1591 09164014
*          2 BYTES- INPUT LOCATION MINUS 1 OF CURRENT IDENT        1591 09168014
*                                                                  1591 09172014
* 8 BYTES- FIRST FCB FOR FIRST GCB                                 1591 09176014
*          2 BYTES- LENGTH OF FIELD                                1591 09180014
*          2 BYTES- INPUT LOCATION MINUS 1                         1591 09184014
*          2 BYTES- CONVERSION CODE                                1591 09188014
*          2 BYTES- OUTPUT LOCATION MINUS 1                        1591 09192014
*                                                                  1591 09196014
* 8 BYTES- SECOND FCB FOR FIRST GCB                                1591 09200014
*    *                                                             1591 09204014
*    *                                                             1591 09208014
*    *                                                             1591 09212014
* 8 BYTES- N'TH FCB FOR FIRST GCB                                  1591 09216014
*                                                                  1591 09220014
*                                                                  1591 09224014
* 8 BYTES- SECOND GCB                                              1591 09228014
*                                                                  1591 09232014
* 8 BYTES- FIRST FCB FOR SECOND GCB                                1591 09236014
*    *                                                             1591 09240014
*    *                                                             1591 09244014
*    *                                                             1591 09248014
* 8 BYTES- N'TH FCB FOR SECOND GCB                                 1591 09252014
*                                                                  1591 09256014
*                                                                  1591 09260014
*  *                                                               1591 09264014
*  *                                                               1591 09268014
*  *                                                               1591 09272014
*                                                                  1591 09276014
*                                                                  1591 09280014
* 8 BYTES- N'TH GCB                                                1591 09284014
*    *                                                             1591 09288014
*    *                                                             1591 09292014
*    *                                                             1591 09296014
*                                                                  1591 09300014
*                                                                       09340000
**N O T E -- IF THERE ARE NO MEMBERS IN THE MEMBER NAME TABLE THE       09360000
**           MEMBER COUNT AND THE MCBADDR(GCB POINTER) ARE ZERO AND THE 09380000
**           MEMBER NAME SECTION CONTAINS BLANKS. IN THIS CASE THE      09400000
**           TABLE LENGTH IS SIXTEEN BYTES.                             09420000
*                                                                       09440000
         EJECT                                                          09460000
*                                                                       09480000
*********************************************************************** 09500000
* READ ONE PHYSICAL RECORD - MEMBER IF THE INPUT IS A PDS. IF A NOTE  * 09520000
* LIST IS PRESENT, AND NOTE LISTS ARE TO BE OMITTED, ANOTHER PHYSICAL * 09540000
* RECORD IS READ. A NOTE LIST IS PRESENT ONLY IN A PDS AND IT REFERS  * 09560000
* TO THE N BYTE OF THE TTRN'S IN THE USERS DATA FIELD. A NOTE LIST    * 09580000
* CONSISTS OF ADDITIONAL POINTERS TO BLOCKS WITHIN THE SAME MEMBER.   * 09600000
*********************************************************************** 09620000
*                                                                       09640000
RDCH     L     R3,INBUFF               LOAD ADDRESS OF INPUT BUFFER     09660000
         TM    QSSW+1,X'F0'                                        VS0H 09670017
         BO    QSGETREC                PERFORM QSAM GET            VS0H 09680017
         READ  DECBI,SF,INSET,(R3),'S' READ THE MEMBER                  09700000
         CHECK DECBI                   CHECK THE READ                   09720000
         MVI   SDSEOD+1,X'00'  MARK INPUT NOT EMPTY              A36088 09730021
         TM    RECFM,X'C0'        RECFM UNDEFINED ?              A45135 09730421
         BNO   TESTFORM           NO, TEST OUTPUT FORMAT         A45135 09730821
         L     TEMP1,DECBI+16     LOCFIRST LOG. RECD             A45135 09732021
         LH    TEMP2,14(TEMP1)    FROM DECB                      A45135 09734021
         LH    RLEN,BLKLEN        LOAD INPUT BLOCK LENGTH        A45135 09736021
         SR    RLEN,TEMP2         SUBTRACT RESIDUAL COUNT        A45135 09738021
         CH    RLEN,PHZERO        LENGTH READ OF ZERO ?          A45135 09738421
         BE    RDCH               YES, READ NEXT RECORD          A45135 09738821
TESTFORM TM    PREFORMT,X'81'     IS THIS PREFORMATTED INPUT?    A45135 09740021
         BM    PREFORM                 YES - BRANCH                     09760000
LOCREC   B     RECDLOC1                                            VS0H 10143017
QSGETREC GET   INSET,(R3)                                          VS0H 10146017
         MVI   SDSEOD+1,X'00'  MARK INPUT NOT EMPTY              A36088 10148021
GOTQSREC LR    RLOC,R1                                             VS0H 10153717
         LH    RLEN,0(RLOC)                                        VS0H 10154417
         TM    PREFORMT,X'81'                                      VS0H 10154617
         BM    QSPREFM                                             VS0H 10154817
         B     RECDLOC2                                            VS0H 10155117
         EJECT                                                          10160000
*                                                                       10180000
*********************************************************************** 10200000
* THIS ROUTINE DETERMINES WHAT TYPE RECORDS THE INPUT DATA SET HAS -- * 10220000
* VARIABLE, VARIABLE BLOCKED, UNDEFINED AND FIXED UNBLOCKED ARE ALL   * 10240000
* HANDLED BY THIS ROUTINE. HERE DEBLOCKING IS ALSO PERFORMED AND THE  * 10260000
* USER INPUT RECORD PROCESSING ROUTINE IS ENTERED.                    * 10280000
*********************************************************************** 10300000
*                                                                       10320000
RECDLOC1 CLI   RECFM,X'40'        VARIABLE RECORDS?            @ZA07390 10324000
         BE    VARREC             YES,GO TO USE BDW            @ZA07390 10328000
         L     TEMP1,DECBI+16     LOC FIRST LOG. REC FROM DECB @ZA06548 10340099
         LH    TEMP2,14(TEMP1)                                          10360000
         LH    RLEN,BLKLEN             LOAD INPUT BLOCK LENGTH          10380000
         SR    RLEN,TEMP2              SUBTRACT RESIDUAL COUNT          10400000
         L     RLOC,INBUFF             LOAD ADDRESS OF INPUT BUFFER     10420000
         AH    RLOC,KEYLEN             ADD IN RECORD KEY LENGTH         10440000
         TM    RECFM,X'C0'             UNDEFINED TYPE RECORDS           10460000
         BO    RECPROC                 YES -- BRANCH                    10480000
         TM    RECFM,X'40'             VARIABLE BLOCKED-UNBLOCKED       10500000
         BO    BLKEDV                  YES -- BRANCH                    10520000
         TM    RECFM,X'10'             FIXED BLOCKED                    10540000
         BO    BLKEDF                  YES -- BRANCH                    10560000
         B     RECPROC                 NO - BRANCH - FIXED UNBLOCKED    10580000
VARREC   L     RLOC,INBUFF        LOAD ADDRESS IF INPUT BUFFER @ZA06548 10584099
         AH    RLOC,KEYLEN        ADD KEYLENGTH                @ZA06548 10588099
         LH    RLEN,0(RLOC)       LOAD LENGTH FROM BDW         @ZA06548 10592099
BLKEDV   AH    RLOC,PH4                ADD 4 TO ADR OF INPUT BUFFER     10600000
         SH    RLEN,PH4                SUBTRACT 4 FROM ADJUSTED BLK LEN 10620000
BV1      SH    RLEN,PH4                DO IT AGAIN                      10640000
         STH   RLEN,PLEN               STORE REMAINING BYES OF BLKD REC 10660000
         MVC   TEMPHW1,0(RLOC)         GET LENGTH OF LOGICAL RECORD     10680000
         LH    RLEN,TEMPHW1            LOAD LENGTH OF LOGICAL RECORD    10700000
RECDLOC2 CH    RLEN,LRECL              IS IT  > RECORD LENGTH      VS0H 10720017
         BH    IOERRIN                 YES - PERMANENT I/O ERROR        10740000
         CH    RLEN,PH4                IS IT AT LEAST FIVE BYTES LONG   10760000
         BNH   IOERRIN                 NO IT ISN'T - I/O ERROR          10780000
         SH    RLEN,PH4                SUBTRACT 4 FROM LOGICAL RECD LEN 10800000
         AH    RLOC,PH4                BUMP PTR TO INPUT BUFFER         10820000
         B     RECPROC                                                  10840000
BLKEDF   STH   RLEN,PLEN               SAVE REMAINING BYTES OF BLKD REC 10860000
BF1      LH    RLEN,LRECL              LOAD LOGICAL RECORD LENGTH       10880000
         CH    RLEN,PLEN               COMPARE IT TO REMAINING BYTES    10900000
         BNH   RECPROC                 IF NOT HIGHER BRANCH             10920000
         LH    RLEN,PLEN               HIGHER -- LOAD REMAINING BYTES   10940000
         EJECT                                                          10960000
*                                                                       10980000
*********************************************************************** 11000000
* CHECK AN IDENTITY WITH EVERY INPUT RECORD UNTIL THE CONDITION IS MET* 11020000
* ONCE IT IS MET WE HAVE A RECORD GROUP. PROCESSING OF THE INPUT DATA * 11040000
* SET MAY STOP AT THIS POINT IF THIS WAS THE LAST RECORD STATEMENT OR * 11060000
* WILL CONTINUE IF MORE RECORD STATEMENTS ARE PRESENT. THE RECORD     * 11080000
* STATEMENT IS A CONTROL CARD TO THE UTILITY PROGRAM.                 * 11100000
*********************************************************************** 11120000
*                                                                       11140000
RECPROC  STH   RLEN,RECDLEN            STORE LENGTH OF CURRENT LOG. REC 11160000
         ST    RLOC,RECDLOC            STORE PTR  TO CURRENT LOGIC. REC 11180000
         TM    INSW,X'04'         STRTNBR SWITCH ON?             A45135 11190021
         BZ    NOSWON             NO                             A45135 11192021
         LH    TEMP1,CURSTRT      YES, CALCULATE RECORDS         A45135 11194021
         AH    TEMP1,PH1          ALREADY GET OR READ            A45135 11196021
         STH   TEMP1,CURSTRT      STORE UPDATED NBR.             A45135 11198021
         CH    TEMP1,STRTAFT      NBR OF REC TO BE SKIP. ALR HAD A45135 11198421
         BNE   RECRET             NO, SKIP THIS RECORD           A45135 11198821
         NI    INSW,X'FB'         YES, SET STRTNBR SWITCH OFF    A45135 11199221
         B     RECRET             SKIP THIS RECORD               A45135 11199621
NOSWON   EQU   *                  CONTINUE                       A45135 11199721
         MVI   RCP2+1,0                SET BRANCH TO A NOP              11200000
         CLI   INREC,C' '              TEST FOR USER EXIT FOR LOGICAL   11220000
*                                      RECORD PROCESSING ON INPUT       11240000
         BE    RECPROC1                NONE --- BYPASS LINK             11260000
*          G O    T O    U S E R    E X I T                             11280000
*             B E F O R E    P R O C E S S I N G    R E C O R D         11300000
         LINK  EPLOC=INREC,PARAM=((RLOC),(RLEN))                        11320000
         SR    R0,R0              CLEAR REGISTER ZERO              2044 11330020
         IC    R0,PPRETCDE             LOAD RETURN CODE                 11340000
         CR    R15,R0                  COMPARE AGAINST USER RETURN CODE 11360000
         BL    RECPROC1                IF LOWER - BRANCH - CONTINUE PGM 11380000
         SRL   R15,2                   CLEAR TWO LOW ORDER BITS         11400000
         SLL   R15,2                                                    11420000
         STC   R15,PPRETCDE            STORE USERS RETURN CODE          11440000
         LA    R0,12                   LOAD UTILITY RETURN CODE         11460000
         CR    R15,R0                  DOES USER REQUEST TERMINATION    11480000
         BL    RECPROC1                NO CONTINUE PGM                  11500000
         B     EXTERM1                 BRANCH TO MESSAGE WRITER - TERM. 11520000
RECPROC1 TM    IDSW,1                  IS AN ID TEST NECESSARY          11540000
         BZ    SKIPT                   NO - BYPASS ID TEST ROUTINE      11560000
         LA    TEMP1,INSET             GET ADDRESS OF INPUT DCB         11580000
         LH    TEMP2,GCBIDLOC(GCBR)    GET RELATIVE INPUT LOCAT. OF LIT 11600000
         AH    TEMP2,GCBIDLEN(GCBR)    ADD ID LENGTH TO IT       A44337 11602021
         CH    TEMP2,LRECL        DOES IDENT EXC. INIT. LRECL ? OY01171 11618016
         BH    PRERROR                 IF IT IS LARGER - ERROR - A44337 11619221
         CH    TEMP2,RECDLEN      DOES IDENT EXC. ACT. LRECL ?  OY01171 11639216
         BH    SKIPT              YES, SKIP IDENT TEST          OY01171 11659216
         AH    RLOC,GCBIDLOC(GCBR)     OK - ADD IT TO CURRENT RECD PTR  11680000
         L     RLIT,LITADD             LOAD ADDRESS OF LITERAL POOL     11700000
         AH    RLIT,GCBIDLIT(GCBR)                                      11720000
         LH    TEMP1,GCBIDLEN(GCBR)    LOAD LENGTH OF ID                11740000
IDT1     CH    TEMP1,PH256             DOES ID EXCEED 256 BYTES         11760000
         BNH   IDT2                    NO - BRANCH                      11780000
         CLC   0(256,RLOC),0(RLIT)     YES - COMPARE FIRST 256 BYTES    11800000
         BNE   IDT4                    NOT EQUAL - BRANCH               11820000
         SH    TEMP1,PH256             EQUAL - CONTINUE                 11840000
         LA    RLOC,256(RLOC)          ADD 256 TO CURRENT LOGIC REC PTR 11860000
         LA    RLIT,256(RLIT)          ADD 256 TO LITERAL POOL POINTER  11880000
         B     IDT1                    LOOP UNTIL COMPLETE              11900000
IDT2     BCTR  TEMP1,R0                PREPARE TO EXECUTE COMPARE       11920000
         EX    TEMP1,IDTCOMP           COMPARE ID'S                     11940000
IDT4     BNE  SKIPT                                                2885 11980015
         MVI   IDSW,X'03'         ID'S  ARE EQUAL                  2885 12020015
         EJECT                                                          12060000
*                                                                       12080000
*********************************************************************** 12100000
* IF A SKIP PARAMETER HAS BEEN SPECIFIED BY THE USER EVERY N'TH       * 12120000
* LOGICAL RECORD WILL BE PROCESSED. ALSO TEST FOR END OF PAGE AND     * 12140000
* DETERMINE THE OUTPUT FORMAT.                                        * 12160000
*********************************************************************** 12180000
*                                                                       12200000
SKIPT    TM    INSW,1                  TEST SKIP SWITCH                 12220000
         BZ    SKIPNO                  OFF - BRANCH TO END PAGE TEST    12240000
         LH    SKIPR,CURSKIP           LOAD SKIP COUNTER                12260000
         CH    SKIPR,INITSKIP          CHECK AGAINST RECD NO. TO PROCES 12280000
         BE    NOSKIP                  EQUAL - DON'T SKIP RECORD        12300000
         AH    SKIPR,PH1               NOT EQUAL - INCREMENT SKIP CTR   12320000
         STH   SKIPR,CURSKIP           STORE SKIP COUNTER               12340000
         B     NEXT1                   BRANCH TO GET NEXT RECORD        12360000
NOSKIP   SR    SKIPR,SKIPR             CLEAR WORK REGISTER              12380000
         STH   SKIPR,CURSKIP           CLEAR RECORD SKIP COUNTER        12400000
SKIPNO   TM    PPSW1,1                 IS OUTPUT PRINTED OR PUNCHED     12420000
         BO    PUNREC                  NO - PUNCH - BYPASS LINE TEST    12440000
*          E N D    O F    P A G E    T E S T                           12460000
         LH    TEMP1,LINECT            LOAD LINE CTR FOR END PAGE TEST  12480000
         CH    TEMP1,PMAXLINE          CHECK AGAINST USER OR ASSUMED    12500000
*                                      LINE PER PAGE MAXIMUM COUNT      12520000
         BL    PUNREC                  LOW - NOT END - BRANCH           12540000
         BAL   HDRET,PPHEAD            END - PUT HEADING ON PAGE        12560000
PUNREC   BAL   BREG,BLANKOUT           CLEAR OUTPUT AREA                12580000
*          D E T E R M I N E    O U T P U T    F O R M A T              12600000
RCP2     NOP   FS15                    SWITCH TO CONT WITH CURRENT RECD 12620000
         LH    RLEN,RECDLEN            LOAD CURRENT LOGICAL RECD LENGTH 12640000
         L     RLOC,RECDLOC            LOAD PTR TO CURRENT LOGICAL RECD 12660000
         TM    FORMATSW,1              IS OUTPUT TO BE USER FORMATTED   12680000
         BO    FORMU                   YES - BRANCH TO USE USERS SPECS  12700000
         EJECT                                                          12720000
*                                                                       12740000
*********************************************************************** 12760000
* THIS ROUTINE FORMATS THE OUTPUT IN THE STANDARD FORMAT, WHICH MEANS * 12780000
* 12 EIGHT CHARACTER GROUPS PER LINE WITH EACH GROUP SEPARATED BY TWO * 12800000
* BLANKS. THIS WILL PRINT OUT 96 CHARACTERS AND 24 BLANKS, PRINTING   * 12820000
* 120 CHARACTERS. IF THE CHARACTERS ARE TO BE CONVERTED TO HEX RE-    * 12840000
* PRESENTATIONS OR TO THE UNPACKED FORM THE OUTPUT NOW BECOMES DOUBLE * 12860000
* THE SIZE AND IT TAKES TWO CHARACTERS TO PRINT ONE CORE CHARACTER.   * 12880000
* THE FORMAT OF 12 EIGHT BYTE GROUPS STILL HOLDS TRUE BUT NOW ONLY 48 * 12900000
* CHARACTERS AND 24 BLANKS MAKE UP A LINE. THERE IS ALSO AN EXIT TO   * 12920000
* A USER ROUTINE TO PROCESS THE RECORDS BEFORE THEY ARE OUTPUTED.     * 12940000
*********************************************************************** 12960000
*                                                                       12980000
FORMS    LH    FLDCT,MAXSEG            LOAD NUMBER OF GROUPS PER LINE   13000000
         LH    INLEN,INSEG             LOAD NUMBER CHARACTERS PER GROUP 13020000
         LA    ROUT,OUTBUFF1           LOAD ADDRESS OF OUTPUT BUFFER    13040000
FS1      CR    INLEN,RLEN              COMPARE CHARACTERS PER GROUP TO  13060000
*                                      ACTUAL RECORD LENGTH             13080000
         BNH   FS2                     IF NOT HIGHER BRANCH             13100000
         OI    LASTSW,X'01'            SET LAST GROUP SWITCH            13120000
         LR    INLEN,RLEN              MOVE ACTUAL RECORD LENGTH        13140000
FS2      CR    INLEN,RLEN              IS IT EQUAL TO CHARACTERS/GROUP  13160000
         BNE   BYPASSSW                NO - BRANCH                      13180000
         OI    LASTSW,X'01'            SET LAST GROUP SWITCH            13200000
BYPASSSW SR    RLEN,INLEN              GET NUMBER BYTES LEFT TO OUTPUT  13220000
         TM    TOTCONV,1               DATA CONVERSION TO BE DONE       13240000
         BO    FS4                     YES - BRANCH                     13260000
         BCTR  INLEN,R0                NO - REDUCE COUNT FOR EXECUTE    13280000
         EX    INLEN,FMOVE             MOVE DATA TO OUTPUT BUFFER       13300000
         AH    INLEN,PH1               RESTORE CHARACTER COUNT          13320000
         B     FS10                    BYPASS DATA CONVERSION BRANCH    13340000
FS4      BAL   BREG,FLDCONV            MOVE AND CONVERT ONE SEGMENT     13360000
FS10     LTR   RLEN,RLEN               END OF INPUT RECORD TEST         13380000
         BZ    EORTEST                 END - BRANCH                     13400000
         AR    RLOC,INLEN              NO - BUMP PTR TO RECORD          13420000
         BCT   FLDCT,FS12              TEST FOR END OF OUTPUT RECORD    13440000
         OI    RCP2+1,X'F0'            END, SET SWITCH TO CONTINUE WITH 13460000
*                                      THIS INPUT RECORD                13480000
         STH   RLEN,FSLEN              STORE BYTES LEFT IN INPUT RECORD 13500000
         ST    RLOC,FSLOC              STORE PTR TO RECORD              13520000
         B     UFEND                   TEST FOR USER EXIT ON OUTPUT     13540000
FS12     AH    ROUT,OUTSEG             BUMP PTR TO OUTPUT BUFFER        13560000
         B     FS1                     CONTINUE OUTPUTING               13580000
EORTEST  TM    PPSW1,1                 TEST FOR PUNCH OPERATION         13600000
         BO    UFEND                   IF YES TEST FOR USER EXIT        13620000
         TM    TOTCONV,1               DATA CONVERSION NECESSARY        13640000
         BZ    NOCONV                  NO - BRANCH                      13660000
         AR    INLEN,INLEN             YES - DOUBLE RECORD LENGTH       13680000
NOCONV   AR    ROUT,INLEN              ADD RECD LENGTH TO OUTPUT BUF AD 13700000
         MVI   0(ROUT),EOB             MOVE ASTERISK TO OUTPUT AREA     13720000
         TM    RECFM,X'10'             IS INPUT BLOCKED                 13740000
         BZ    UFEND                   NO - TEST FOR USER EXIT          13760000
         CLC   RECDLEN(2),PLEN         YES, IS THIS END OF BLOCK        13780000
         BNE   UFEND                   TEST FOR USER EXIT               13800000
         MVI   1(ROUT),EOB             MOVE ASTERISK TO OUTPUT BUFFER   13820000
RECWRITE B     UFEND                   TEST FOR USER EXIT               13840000
         LTR   RLEN,RLEN               END OF INPUT RECORD TEST         13860000
         BZ    NEXT                    YES - GET NEXT LOGICAL RECORD    13880000
         B     SKIPNO                  NO - CONTINUE WITH CURRENT RECD  13900000
FS15     LH    RLEN,FSLEN              LOAD REMAINING BYTES OF IN. RECD 13920000
         L     RLOC,FSLOC              LOAD PTR TO INPUT AREA           13940000
         MVI   RCP2+1,0                TURN OFF RECD CONTINUATION SWITH 13960000
         B     FORMS                                                    13980000
         EJECT                                                          14000000
*                                                                       14020000
*********************************************************************** 14040000
* THIS ROUTINE COMPUTES THE TOTALS OF THE LENGTH FIELDS IN THE RECORD * 14060000
* CARDS. IF THE FIELD IS TO BE CONVERTED THE LENGTH IS DOUBLED. IF THE* 14080000
* TOTAL OF ALL THESE LENGTHS ADD UP TO MORE THAN 120, THE REQUEST IS  * 14100000
* TERMINATED, AN ERROR MESSAGE IS PRINTED AND A RETURN CODE OF 12 IS  * 14120000
* RETURNED.                                                           * 14140000
*********************************************************************** 14160000
*                                                                       14180000
COMPUTEL LR    R0,FLDCT                LOAD NUMBER OF FIELDS     A34102 14200020
         LH    INLEN,0(FCBR)           GET LENGTH OF USER FORMAT FIELD  14220000
         TM    4(FCBR),1               IS DATA TO BE CONVERTED          14240000
         BO    DOUBLEL                 YES IT IS                        14260000
TRUEL    AH    INLEN,RECOUNT           INCREMENT USER FORMAT LENGTH     14280000
         STH   INLEN,RECOUNT           STORE LENGTH                     14300000
         BCT   R0,INCREL               NSI IF ALL FLDS PROCESSED A34102 14330020
         ST    R14,TEMPSAVE            SAVE BRANCH ADDRESS         9305 14370019
         LH    TEMP1,MAXOUT            GET MAX CHAR PER LINE       9305 14380019
         CH    TEMP1,RECOUNT           DOES IT EXCEED TOTAL FIELDS?9305 14397019
         BL    PRERROR                 IF NOT = OR > THEN ERROR    9305 14404019
         L     R14,TEMPSAVE            RESTORE BRANCH REGISTER     9305 14411019
         LA    FCBR,GCBL(GCBR)         NO, RESET STARTING POINT         14420000
         MVC   RECOUNT(2),PHZERO       RESET COUNTER TO ZERO            14440000
         BR    R14                     RETURN TO FORMU ROUTINE          14460000
         SPACE 2                                                        14480000
INCREL   AH    FCBR,FCBLEN             GO TO NEXT FIELD PARAMETER       14500000
         B     COMPUTEL+2              LOOP TO PROCESS NEW FLD   A34102 14520020
DOUBLEL  AR    INLEN,INLEN             DOUBLE OUTPUT LENGTH FOR CONVER. 14540000
         TM    4(FCBR),3               IS IT PACKED TO UNPACKED         14560000
         BM    TRUEL                   NO - BRANCH                      14580000
         BCTR  INLEN,R0                REDUCE DOUBLED LENGTH BY ONE     14600000
         B     TRUEL                                                    14620000
         EJECT                                                          14640000
*                                                                       14660000
*********************************************************************** 14680000
* THIS IS THE USER FORMATTED OUTPUT ROUTINE. THE OUTPUT IS DETERMINED * 14700000
* BY THE FIELD PARAMETERS OF THE RECORD STATEMENTS. THERE MAY BE MORE * 14720000
* THAN ONE FIELD PARAMETER PER RECORD STATEMENT BUT ONLY ONE IDENT    * 14740000
* PARAMETER IS ALLOWED. THERE IS ALSO A USER EXIT TO FURTHER PROCESS  * 14760000
* THE RECORDS BEFORE THEY ARE OUTPUTED.                               * 14780000
*********************************************************************** 14800000
*                                                                       14820000
FORMU    LH    FLDCT,0(GCBR)                                            14840000
         LA    FCBR,GCBL(GCBR)         POINT TO FIRST FIELD CONTROL BLK 14860000
         BAL   R14,COMPUTEL            COMPUTE USER FIELD LENGTHS       14880000
UF1      LA    TEMP1,INSET             GET ADDRESS OF INPUT DCB         14900000
         LH    INLEN,0(FCBR)           LENGTH OF FIELD TO BE EDITED     14920000
         AH    INLEN,2(FCBR)           ADD RELATIVE INPUT LOCATION      14940000
         CH    INLEN,LRECL          COMP INP WITH LRECL LEN      A44337 14958021
         BH    PRERROR                 IF IT IS LARGER - ERROR - A44337 14980021
         LH    INLEN,0(FCBR)           LOAD LENGTH OF FIELD TO BE EDIT. 15000000
         LTR   INLEN,INLEN             IS THERE A LENGTH                15020000
         BC    13,UF10                 BRANCH IF NO                     15040000
         LH    RLOC,2(FCBR)            LOAD RELATIVE INPUT LOCATION     15060000
         LTR   RLOC,RLOC                                                15080000
         BM    UF10                                                     15100000
         CH    RLOC,RECDLEN            COMPARE TO LENGTH OF CURRENT REC 15120000
         BNL   UF10          NO GO TO CHECK IF MORE FIELDS              15140000
         LR    TEMP1,INLEN             MOVE LENGTH OF FIELD             15160000
         AR    TEMP1,RLOC              ADD RELATIVE INPUT LOCATION      15180000
         CH    TEMP1,RECDLEN           COMPARE TO LENGTH OF CUR LOG REC 15200000
         BNH   UF3                                                      15220000
         LH    INLEN,RECDLEN           HIGHER - LOAD LENGTH OF CURR LEN 15240000
         SR    INLEN,RLOC              TRUNCATE FIELD                   15260000
UF3      LH    ROUT,6(FCBR)            REL. OUTPUT LOCATION             15280000
         LTR   ROUT,ROUT               TEST PTR TO OUTPUT BUFFER        15300000
         BL    UF10                     BRANCH ON MINUS                 15320000
         CH    ROUT,MAXOUT             COMPARE TO MAXIMUM LINE COUNT    15340000
         BNL   UF10                                                     15360000
         LR    TEMP1,ROUT              MOVE PTR TO OUTPUT BUFFER        15380000
         AR    TEMP1,INLEN                                              15400000
         CH    TEMP1,MAXOUT            COMPARE TO MAXIMUM LINE COUNT    15420000
         BL    UF4                                                      15440000
         LH    INLEN,MAXOUT            LOAD MAXIMUM OUTPUT LENGTH       15460000
         SR    INLEN,ROUT              TRUNCATE FIELD                   15480000
UF4      A     RLOC,RECDLOC                                             15500000
         A     ROUT,OUTBADD                                             15520000
         TM    4(FCBR),1               DATA CONVERSION                  15540000
         BO    UF5                     BRANCH IF SWITCH ON              15560000
         BCTR  INLEN,R0                REDUCE COUNT FOR EXECUTE         15580000
         EX    INLEN,FMOVE             MOVE FIELD TO OUTPUT AREA        15600000
         B     UF10                                                     15620000
UF5      OI    LASTSW,X'01'            SET LAST FIELD SWITCH            15640000
         BAL   BREG,FLDCONVU           USER FORMATTED DATA - BRANCH     15660000
UF10     BCT   FLDCT,UF12               ARE THERE ANY MORE FIELDS       15680000
         B     UFEND0                  NO - BRANCH                      15700000
UF12     AH    FCBR,FCBLEN             YES - CONTINUE                   15720000
         B     UF1                                                      15740000
UFEND0   OI    RECWRT+1,X'F0'          SET NOP SWITCH                   15760000
UFEND    CLI   OUTREC,C' '             TEST FOR USER EXIT FOR PROCESS-  15780000
*                                      ING OUTPUT RECORDS               15800000
         BE    RECWRT                  NONE --- BYPASS LINK             15820000
         ST    RLEN,HOLDRLEN           STORE CURRENT LOGICAL RECD LENG. 15840000
         LA    RLOC,OUTBUFF1           LOAD ADDRESS OF OUTPUT BUFFER    15860000
         LH    RLEN,MAXOUT        LOAD OUTPUT LRECL MINUS ONE   LETTER  15880021
*          G O    T O    U S E R    E X I T                             15900000
*             B E F O R E    O U T P U T I N G    R E C O R D           15920000
         LINK  EPLOC=OUTREC,PARAM=((RLOC),(RLEN))                       15940000
         L     RLEN,HOLDRLEN           RESTORE CURRENT LOGICAL REC LEN. 15960000
         LA    R0,4               SET REGISTER ZERO EQ 4         A48796 16120021
         CR    R15,R0             RETURN CODE 4                  A48796 16170021
         BE    NEXT               YES, SKIP THE RECORD           A48796 16172021
         LA    R0,12              SET REGISTER ZERO EQ 12        A48796 16174021
         CR    R15,R0             RETURN CODE 12 ?               A48796 16176021
         BE    EXTERM1            YES, TERMINATE PROCESSING      A48796 16178021
         LA    R0,16              SET REGISTER ZERO EQ 16        A48796 16178121
         CR    R15,R0             RETURN CODE 16 ?               A48796 16178221
         BE    EXTERM1            YES, TERMINATE PROCESSING      A48796 16178321
RECWRT   NOP   RECWRT1                 NOP SWITCH                       16180000
         LA    BREG,RECWRITE+4                                          16200000
         B     WRCH                    BRANCH TO WRITE OUTPUT ROUTINE   16220000
RECWRT1  BAL   BREG,WRCH               BRANCH TO WRITE OUTPUT ROUTINE   16240000
*                                                                       16260000
*          GET NEXT LOGICAL RECORD                                      16280000
*                                                                       16300000
NEXT     TM    INSW,2                  WAS THERE A 'STOP' PARAMETER     16320000
         BZ    NEXT1                   NO - BRANCH                      16340000
         LH    TEMP1,CURSTOP           YES, IS IT TIME TO STOP          16360000
         AH    TEMP1,PH1               ADD ONE TO STOP COUNTER          16380000
         CH    TEMP1,INITSTOP          DO WE STOP - CHECK USER PASSED   16400000
*                                      RECORD NUMBER                    16420000
         BNL   EODSTOP                 NOT LOWER - STOP FOR MEMBER OR   16440000
         STH   TEMP1,CURSTOP           SDS - NO, CONTINUE - STORE CTR   16460000
NEXT1    TM    IDSW,2                  IS THIS THE END OF A RECORD GRP. 16480000
         BZ    RECRET                  NO - BRANCH                      16500000
         LH    TEMP1,GRCT              YES, MORE GROUPS - LOAD GROUP CT 16520000
         BCT   TEMP1,NEXTGR            IF YES REDUCE COUNTER            16540000
         B     EODID                   IF NO DO NEXT MEMBER             16560000
*          R E I N I T I A L I Z A T I O N    T O                       16580000
*            P R O C E S S    N E X T    R E C O R D   G R O U P        16600000
NEXTGR   STH   TEMP1,GRCT              STORE RECORD GROUP COUNTER       16620000
         LH    TEMP1,0(GCBR)           POINT TO NEXT GROUP              16640000
         MH    TEMP1,FCBLEN            ALIGN PTR TO PROPER BOUNDARY     16660000
         AR    GCBR,TEMP1                                               16680000
         AH    GCBR,GCBLEN                                              16700000
         BAL   BREG,SETGCBSW           SET SWITCHES FOR THIS RECD GROUP 16720000
RECRET   TM    RECFM,X'10'             BLOCKED RECORDS FOR INPUT        16740000
         BZ    RDCH                    NO, READ NEXT RECORD             16760000
         TM    RCP2+1,X'F0'                  CONTINUE SAME RECORD? 1450 16766020
         BO    SKIPNO                        YES - BRANCH          1450 16772020
         LH    RLEN,PLEN               LOAD REMAINING BYTES IN CURR REC 16780000
         SH    RLEN,RECDLEN            END OF PHYSICAL RECD - SUBTRACT  16800000
*                                      LENGTH OF CURRENT LOGICAL RECD.  16820000
         BC    12,RDCH                 BRANCH IF ZERO OR NEGATIVE TO    16840000
*                                      READ NEXT PHYSICAL RECORD        16860000
         STH   RLEN,PLEN               STORE REMAINING BYTES IN CUR REC 16880000
         L     RLOC,RECDLOC            LOAD PTR TO CURRENT RECORD       16900000
         AH    RLOC,RECDLEN            ADD LENGTH OF LAST LOGICAL RECD. 16920000
         TM    RECFM,X'50'             CHECK RECORD FORMAT              16940000
         BO    BV1                     FORMAT IS BLOCKED VARIABLE       16960000
         B     BF1                     FORMAT IS BLOCKED FIXED          16980000
         EJECT                                                          17000000
*                                                                       17020000
*********************************************************************** 17040000
* THESE ARE THE END OF DATA ROUTINES. ALL TERMINATION MUST GO THROUGH * 17060000
* THIS ROUTINE. TERMINATION INCLUDES PRINTING A MESSAGE, CLOSING THE  * 17080000
* DCB'S, FREEING CORE AND RETURNING. IF THIS IS NOT THE LAST MEMBER   * 17100000
* OF A PARTITIONED DATA SET THE NAME AND LOCATION OF THE NEXT MEMBER  * 17120000
* IS OBTAINED AND THE NEXT MEMBER IS PROCESSED. A USER EXIT MAY BE    * 17140000
* TAKEN TO PROCESS THE INPUT TRAILER LABEL IF IT IS A SEQUENTIAL DATA * 17160000
* SET.                                                                * 17180000
*********************************************************************** 17200000
*                                                                       17220000
EODID    LA    R1,IDMSG                LOAD A 14 INTO R1                17240000
         SR    R0,R0                   CLEAR REGISTER 0                 17260000
         B     EODWRT                  BRANCH TO MESSAGE ROUTINE        17280000
BLKSZERR LA    R1,BLKSZMIS             LOAD ERROR MESSAGE DISPLACEMENT  17300000
         LA    R0,12                   LOAD IEB MESSAGE CODE            17320000
         B     DOIT                                                     17340000
EODSTOP  LA    R1,STPMSG               LOAD A 15 INTO R1                17360000
         SR    R0,R0                   CLEAR REGISTER 0                 17380000
         B     EODWRT                  BRANCH TO MESSAGE ROUTINE        17400000
SDSEOD   B     TEMPTY        TAKE BRANCH IF EMPTY                A36088 17420021
         LA    R1,EODMSG     GET EOD MESSAGE NUMBER              A36088 17430021
         SR    R0,R0                   CLEAR REGISTER 0                 17440000
EODWRT   SLL   R1,8                                                     17460000
         L     R15,PMSGWRTA            LOAD ADDR OF ROUTINE IN IEBPPUN1 17480000
*                                      THAT PRINTS MESSAGES             17500000
         BALR  R14,R15                 BRANCH TO MESSAGE WRITER         17520000
         LH    TEMP1,LINECT            INCREMENT LINE COUNT        9476 17525019
         AH    TEMP1,PH1               BY 1 FOR EACH EOF MESSAGE   9476 17530019
         STH   TEMP1,LINECT            STORE NEW VALUE             9476 17535019
SDSEND   TM    TYPORG,3                WAS THE INPUT A PDS              17540000
         BZ    CLOSEIO                 NO - CLOSE A SEQUENTIAL DATA SET 17560000
         LH    TEMP1,MEMBCT            LOAD PDS MEMBER COUNT            17580000
         BCT   TEMP1,NEXTMEMB          REDUCE COUNT AND BRANCH          17600000
         B     CLOSEIO                 NO MORE MEMBERS - CLOSE DCB'S    17620000
NEXTMEMB STH   TEMP1,MEMBCT            STORE NEW MEMBER COUNT           17640000
         L     LISTR,DIRADD            LOAD ADDR.OF MEMBER NAMES A41759 17660021
         BO    NEXTM                   TEST FOR ONLY NAMED PDS MEMBERS  17680000
*                                      IF THAT'S CASE BRANCH            17700000
         TM    MEMGET,X'10'            GETMAIN FOR MEMB NAMES ?  A41759 17710021
         BC    8,TEMPTY                NO, PDS IS EMPTY          A41759 17712021
         LH    TEMP2,ALIASCT           SKIP ALIASES FROM DIRECTORY FOR  17720000
         AH    TEMP2,PH1               TOTAL PDS - ADD 1 TO ALIAS COUNT 17740000
         MH    TEMP2,LISTLEN           MULTIPLY COUNT BY A 12           17760000
         AR    LISTR,TEMP2             ADD VALUE TO MEMBER PTR          17780000
         ST    LISTR,DIRADD            SAVE PTR TO MEMBER NAMES         17800000
         B     PDT1                                                     17820000
NEXTM    AH    LISTR,LISTLEN           POINT TO NEXT NAMED MEMBER       17840000
         ST    LISTR,DIRADD            STORE PTR TO MEMBER NAMES        17860000
         B     PDP1                                                     17880000
*          E N T E R E D    W H E N    O P E N    D C B    E R R O R    17900000
DDERROR  LA    TEMP2,DDNAM(TEMP1)      GET ADR OF DDNAME IN DCB IN ERR. 17920000
         L     TEMP1,VMSG              GET ADR OF ERROR MSG             17940000
         MVC   7(8,TEMP1),0(TEMP2)     MOVE DDNAME TO ERROR MESSAGE     17960000
         LA    R0,11                                                    17980000
         LA    R1,21                   GET NUMBER OF MSG IN MSG MODULE  18000000
DOIT     MVI   DDSWITCH,X'01'          SET SWITCH NOT TO FREE MAIN      18020000
         B     IOWRT                   PRINT MESSAGE                    18040000
*        C L O S E   I N P U T   D C B                             UL0H 18060017
CLOSEIO  LA    R1,INSET            LOAD ADDR. OF  INP. DCB       A41816 18070021
         TM    OFLGS(R1),X'10'     WAS DCB OPENED ?              A41816 18071021
         BZ    CLOSEOUT            NO, DO NOT CLOSE              A41816 18072021
         CLOSE (INSET)             YES,CLOSE OUTPUT DCB          A41816 18073021
         TM    QSBRNOP+1,X'F0'     INPUT QSAM OPENED             A41816 18074021
         BNO   INTLRPRT            NO, DON'T FREE INP. BUFFERS   A41816 18075021
         FREEPOOL  INSET           FREE INP BUFFERS              A41816 18076021
INTLRPRT BAL   R8,LBLPRNT                                          UL0H 18080017
*        C L O S E   O U T P U T   D C B                           UL0H 18090017
CLOSEOUT LA    R1,OUTSET           LOAD ADDR. OF OUTP. DCB       A41816 18100021
         TM    OFLGS(R1),X'10'     WAS DCB OPENED ?              A41816 18108021
         BZ    NOFREE              NO, DO NOT CLOSE              A41816 18116021
         CLOSE (OUTSET)            YES,CLOSE OUTP. DATA SET      A41816 18124021
         FREEPOOL  OUTSET          FREEPOOL OUTPUT CORE          A41816 18132021
         TM    DDSWITCH,X'01'          IS FREEMAIN SKIPPED              18140000
         BO    NOFREE                  YES - BRANCH                     18160000
         L     R0,LENGTHSV             RESTORE ALLOCATED CORE SIZE      18180000
         L     R1,LENGTHAD             RESTORE ALLOCATED CORE ADDRESS   18200000
*          F R E E    C O R E    F O R    I N P U T    B U F F E R      18220000
         FREEMAIN R,LV=(0),A=(1)                                        18240000
NOFREE   TM    MEMGET,X'10'            TEST FOR MEMBER GETMAIN     4304 18245019
         BC    8,NOFREE1               IF NONE THEN BRANCH         4304 18250019
         L     R0,MEMAREA              ELSE GET ADDR OF LENGTH     4304 18255019
         L     R1,MEMADDR              AND AREA ADDRESS            4304 18260019
         FREEMAIN   R,LV=(0),A=(1)                                 4304 18265019
         MVI   MEMGET,X'00'            RESET GETMAIN SWITCH        4304 18270019
NOFREE1  SR    R15,R15             ZERO OUT REG. 15              A41816 18272021
         IC    R15,PPRETCDE            LOAD RETURN CODE                 18280000
         L     R13,PERM13              RESTORE REGISTER 13              18300000
*          R E T U R N    T O    C A L L I N G    P R O G R A M         18320000
         RETURN (14,12),RC=(15)                                         18340000
         EJECT                                                          18360000
*                                                                       18380000
*********************************************************************** 18400000
* THIS IS THE ROUTINE THAT GETS CORE (264 BYTES) FOR THE DIRECTORY    * 18420000
* RECORD AND KEY IF THE INPUT DATA SET IS PARTITIONED, THEN IT READS  * 18440000
* THE WHOLE DIRECTORY AND COUNTS THE NUMBER OF MEMBERS IN IT. IT THEN * 18460000
* REREADS THE DIRECTORY, THIS TIME PLACING THE MEMBERS IN ALLOCATED   * 18480000
* CORE AND SORTING THEM BY TTR'S AND ALIAS BITS. THIS IS DONE SO THAT * 18500000
* THE MESSAGE MAY BE PRINTED IN THE ORDER OF THEIR PHYSICAL OCCURRENCE* 18520000
* ON THE DIRECT ACCESS STORAGE DEVICE.                                * 18540000
*********************************************************************** 18560000
*                                                                       18580000
TOTAL    LA    TEMP1,INSET             GET ADDRESS OF INPUT DCB         18600000
         TM    DEVT(TEMP1),X'20'       IS IT A DIRECT ACCESS DCB        18620000
         BO    CHGABC                                                   18640000
         MVI   DDSWITCH,X'01'          SET NOT FREEMAIN SWITCH          18660000
         B     IOERRIN                                                  18680000
CHGABC   LA    R0,DIRBLKL              LOAD DIRECTORY LENGTH            18700000
         ST    R0,LENGTHSV             SAVE DIRECTORY LENGTH            18720000
*          G E T    C O R E    F O R    D I R E C T O R Y               18740000
         GETMAIN R,LV=(0)                                               18760000
         ST    R1,DIRBUFF              STORE POINTER TO BUFFER          18780000
         ST    R1,LENGTHAD             SAVE PTR TO ALLOCATED AREA       18800000
TOTRD1   SR    MEMCT,MEMCT             CLEAR MEMBER COUNTER             18820000
         L     R3,INBUFF               LOAD POINTER TO DIRECTORY        18840000
*          R E A D    D I R E C T O R Y                                 18860000
TOTRD    READ  DECBI,SF,INSET,(R3),'S',MF=E                             18880000
         CHECK DECBI                   CHECK THE READ                   18900000
TOT5     NOP   TOT9                    SWITCH SET BELOW - NEVER RESET   18920000
         NOTE  INSET                   REMEMBER LOCATION OF BLOCK READ  18940000
         ST    R1,DADDSAV              SAVE BLOCK IDENTIFICATION        18960000
         OI    TOT5+1,X'F0'            SET NOP SWITCH TO 'NOTE' ONCE    18980000
TOT9     LH    CTR,0(R3)               COUNT OF DIRECTORY BLOCK         19000000
         CH    CTR,PH256               IS COUNT GREATER THAN 256        19020000
         BH    IOERRIN                 THIS IS AN ERROR                 19040000
         CH    CTR,PH14                IT MUST BE GREATER THAN 14       19060000
         BE    TOT15B                   EQUAL, RESET SWITCH             19080000
         BL    SDSEOD                  NO INPUT --- BRANCH              19100000
         SH    CTR,PH2                 SUBTRACT 2 FOR 2 BYTE COUNT      19120000
         LA    RLOC,2(R3)              GET ADDRESS OF FIRST MEMBER      19140000
TOT10    B     TOT14                                                    19160000
         MVC   0(LISTL,ROUT),0(RLOC)   MOVE DIRECTORY ENTRY             19180000
         AH    ROUT,LISTLEN            INCREMENT PTR TO OUTPUT BY       19200000
*                                      LENGTH OF DIRECTORY ENTRY        19220000
TOT14    AH    MEMCT,PH1               ADD ONE TO MEMBER COUNT          19240000
         SR    RLEN,RLEN               CLEAR REGISTER TO HOLD LENGTH    19260000
         IC    RLEN,11(RLOC)           GET LENGTH OF USER DATA IN       19280000
*                                      DIRECTORY ENTRY                  19300000
         N     RLEN,ANDCONST           'AND' OUT ALL BITS EXCEPT 3-7    19320000
         SLL   RLEN,1                  MULTIPLY BY 2 - USER DATA HALF   19340000
         AH    RLEN,PH12               WORDS - ADD LENGTH OF DIR. ENTRY 19360000
         SR    CTR,RLEN                TEST FOR END OF INPUT RECORD     19380000
         LTR   CTR,CTR                                                  19400000
         BZ    TOT15A                  END - BRANCH - HAVE ALL MEMBERS  19420000
         AR    RLOC,RLEN               NO, CONTINUE                     19440000
         CLI   0(RLOC),X'FF'           IS THIS THE END OF DIRECTORY     19460000
         BNE   TOT10                   NO, CONTINUE LOOP                19480000
         NI    TOT15+1,X'0F'           YES - NOP TOT15                  19500000
TOT15    B     TOTRD                   END OF DIRECTORY SWITCH          19520000
         TM    TOT10+1,X'F0'           HAS DIRECTORY BEEN READ TWICE    19540000
         BZ    TOTCONT                 YES - BRANCH                     19560000
         NI    TOT10+1,X'0F'           NO -- RE-READ DIRECTORY          19580000
         OI    TOT15+1,X'F0'           RESET NOP SWITCH                 19600000
         LR    R0,MEMCT                HAVE READ DIRECTORY ONCE TO      19620000
         CH    R0,PHZERO                                           1244 19626014
         BE    TEMPTY                                              1244 19632014
         MH    R0,LISTLEN              COUNT ENTRIES, NOW GET SPACE FOR 19640000
*                                      MEMBERS                          19660000
         ST    R0,MEMAREA              SAVE AREA LENGTH            4304 19670019
         MVI   MEMGET,X'10'            SET GETMAIN SWITCH ON       4304 19680019
         GETMAIN R,LV=(0)                                               19700000
         ST    R1,DIRADD               STORE POINTER TO MEMBERS         19720000
         ST    R1,MEMADDR              SAVE MEMBER ADDRESS         4304 19730019
         LR    ROUT,R1                 SAVE POINTER TO MEMBERS          19740000
         POINT INSET,DADDSAV           POSITION DASD USING 'NOTE' PTR   19760000
         B     TOTRD1                                                   19780000
TOT15A   STH   MEMCT,MEMBCT            STORE MEMBER COUNT               19800000
         CH    MEMCT,PH1               IS THERE ONLY ONE MEMBER         19820000
         BE    SDSEOD                  YES - BRANCH TO END OF DATA ROUT 19840000
         CLI   0(RLOC),X'FF'           ARE WE AT THE END OF DATA        19860000
         BNE   TOT15                   NO -- BRANCH                     19880000
TOT15B   NI    TOT15+1,X'0F'            YES -- RESET NOP SWITCH         19900000
         B     TOT15                                                    19920000
TOTCONT  STH   MEMCT,MEMBCT            STORE PDS MEMBER COUNT           19940000
         L     R0,LENGTHSV             RESTORE LENGTH OF BUFFER         19960000
         L     R1,LENGTHAD             RESTORE POINTER TO BUFFER        19980000
*          F R E E    C O R E    F O R    D I R E C T O R Y             20000000
         FREEMAIN R,LV=(0),A=(1)                                        20020000
*          C L O S E    I N P U T    D C B                              20040000
*             F O R    D I R E C T O R Y    R E A D                     20060000
         CLOSE (INSET)                                                  20080000
*                                                                       20100000
*          SORT PARTITIONED DATA SET DIRECTORY                          20120000
*            ENTRIES BY TTR'S AND ALIAS BIT                             20140000
*                                                                       20160000
         LH    R1,PH1                  LOAD A ONE INTO REGISTER 1       20180000
         CH    R1,MEMBCT               IS THERE ONLY 1 MEMBER IN PDS    20200000
         BE    TOTEND                  YES -- BRANCH                    20220000
DSORT1   OI    DSORT10+1,X'F0'         NO -- SET SWITCH                 20240000
         L     LISTR,DIRADD            LOAD PTR TO MEMBER NAMES         20260000
         LR    LISTCT,R1               MOVE A ONE TO SORT COUNTER       20280000
DSORT3   CLC   8(3,LISTR),LISTL+8(LISTR) COMPARE TTR'S                  20300000
         BL    DSORT8                  IF LOW BRANCH                    20320000
         BH    DSORT5                  IF HIGH BRANCH                   20340000
         TM    ABITL(LISTR),X'80'      TTR'S ARE EQUAL, ONE MAY BE AN   20360000
         BZ    DSORT8                  ALIAS - IF NOT ALIAS BRANCH      20380000
         TM    ABITL+LISTL(LISTR),X'80' IF BOTH ARE ALIAS -             20400000
         BO    DSORT8                  DO NOTHING                       20420000
DSORT5   MVC   SAVE12(LISTL),0(LISTR)  MOVE NON-LOW MEMBER TO WORK AREA 20440000
         MVC   0(LISTL,LISTR),LISTL(LISTR) SWITCH MEMBER ENTRIES        20460000
         MVC   LISTL(LISTL,LISTR),SAVE12 MOVE OTHER MEMBER TO WORK AREA 20480000
         NI    DSORT10+1,X'0F'         SET SWITCH TO CONTINUE SORTING   20500000
DSORT8   AH    LISTR,LISTLEN           ADD LENGTH OF ENTRIES IN         20520000
*                                      DIRECTORY TO MEMBER NAME POINTER 20540000
         AR    LISTCT,R1               ADD ONE TO SORT COUNT            20560000
         CR    LISTCT,MEMCT            COMPARE SORT COUNT TO MEMBER CT. 20580000
         BL    DSORT3                  IF LOWER CONTINUE SORT           20600000
DSORT10  B     TOTEND                  SWITCH TO CONTINUE SORT          20620000
         BCT   MEMCT,DSORT1            REDUCE MEMBER COUNT AND CONTINUE 20640000
TOTEND   NI    POSTOPEN+1,X'0F'        SET SWITCH TO READ DATA SET      20660000
         B     PREOP1                                                   20680000
         EJECT                                                          20700000
*                                                                       20720000
*********************************************************************** 20740000
* MOVE AND CONVERT 'N' BYTES OF INPUT INTO '2N' BYTES OF OUTPUT.      * 20760000
* HEXIDECIMAL INPUT WILL BE CONVERTED TO EBCDIC, PACKED DECIMAL INPUT * 20780000
* WILL BE CONVERTED TO ZONED DECIMAL WITH THE SIGN OCCURING AS A      * 20800000
* SEPARATE CHARACTER.                                                 * 20820000
*                                                                     * 20840000
*       INLEN = NUMBER OF BYTES TO BE CONVERTED                       * 20860000
*       RLOC = THE INPUT LOCATION                                     * 20880000
*       ROUT = THE OUTPUT LOCATION                                    * 20900000
*                                                                     * 20920000
*********************************************************************** 20940000
*    L A B E L  C O N V.   E N T R Y   P O I N T                  *UL0H 20943017
FLDCONVL OI    LASTSW,81                                           UL0H 20946017
         TM    CONVSW,3                                            UL0H 20949017
         BO    FLDCONV1                                            UL0H 20952017
         B     FCHE                                                UL0H 20955017
*                                                                       20960000
*          S T A N D A R D    O U T P U T    E N T R Y    P O I N T     20980000
FLDCONV  CLC   CONVSW(1),TOTCONV                                        21000000
         BE    FLDCONV1                                                 21020000
         B     FCTEST                  CHANGE LIST                      21040000
*          U S E R    F O R M A T    E N T R Y    P O I N T             21060000
FLDCONVU CLC   CONVSW(1),4(FCBR)                                        21080000
         BE    FLDCONV1                                                 21100000
FCTEST   TM    CONVSW,3                TEST FOR PACKED TO ZONED DECIMAL 21120000
         BO    FCHE                    ON ALREADY - BRANCH              21140000
         MVC   FCPLUSA(6),FCSIGNS      SET UP CONVERSION LIST           21160000
         MVI   CONVSW,3                SET SWITCH - PACKED TO ZONED     21180000
         B     FLDCONV1                SKIP HEX TO EBCDIC SETUP         21200000
FCHE     MVC   FCPLUSA(6),FCHEX        SET UP CONVERSION LIST           21220000
         MVI   CONVSW,1                SET SW FOR HEX TO EBCDIC         21240000
*                                      THE TWO ABOVE SWITCH SETTINGS    21260000
*                                      SHOW THE CONVERSION LIST STATUS  21280000
FLDCONV1 CLI   CONVSW,X'03'            IS IT PACKED TO UNPACKED         21300000
         BNE   FLDCONV2                NO -- BRANCH                     21320000
         TM    LASTSW,X'01'            IS THIS THE LAST GROUP           21340000
         BZ    FLDCONV2                NO -- BRANCH                     21360000
         OI    LASTSW,X'80'            YES - SET LAST GROUP SW TO X'81' 21380000
         BCTR  INLEN,R0                REDUCE INPUT COUNT BY ONE        21400000
FLDCONV2 STH   INLEN,LENSAV            STORE INPUT COUNT                21420000
         ST    ROUT,OUTSAV             STORE PTR TO OUTPUT AREA         21440000
         ST    RLOC,LOCSAV             STORE PTR TO INPUT AREA          21460000
         LTR   INLEN,INLEN             IS INPUT COUNT ZERO              21480000
         BZ    FCRET                   YES - TEST FOR LAST GROUP        21500000
FC1      SR    TEMP1,TEMP1             CLEAR REGISTER                   21520000
         IC    TEMP1,0(RLOC)           LOAD CHARACTER TO CONVERT        21540000
         LR    TEMP2,TEMP1             MOVE CHARACTER TO CONVERT        21560000
         SRL   TEMP1,4                 REMOVE LOW ORDER 4 BITS          21580000
         STC   TEMP1,0(ROUT)           SEPARATE THE 4-BIT CHARACTERS    21600000
         STC   TEMP2,1(ROUT)           IN EACH BYTE                     21620000
         BCT   INLEN,FC2               REDUCE INPUT COUNT               21640000
         B     FC3                     BRANCH WHEN INPUT COUNT IS ZERO  21660000
FC2      AH    ROUT,PH2                INCREMENT PTR TO OUTPUT BY TWO   21680000
         AH    RLOC,PH1                INCREMENT PTR TO INPUT AREA BY 1 21700000
         B     FC1                     LOOP UNTIL INPUT COUNT IS ZERO   21720000
FC3      LH    INLEN,LENSAV            LOAD INPUT COUNT                 21740000
         L     ROUT,OUTSAV             RESTORE OUTPUT AREA POINTER      21760000
         SLL   INLEN,1                 MULTIPLY COUNT BY 2              21780000
         BCTR  INLEN,R0                REDUCE COUNT BY 1                21800000
         NI    0(ROUT),X'0F'           CLEAR HIGH ORDER 4 BITS EACH BYT 21820000
         BCTR  INLEN,R0                REDUCE INPUT LENGTH BY ONE       21840000
         EX    INLEN,FCMZ                                               21860000
         LA    INLEN,1(INLEN)          ADD ONE TO INPUT LENGTH          21880000
         EX    INLEN,FCTR                                               21900000
FCRET    LH    INLEN,LENSAV            LOAD INPUT COUNT                 21920000
         L     ROUT,OUTSAV             RESTORE OUTPUT AREA POINTER      21940000
         L     RLOC,LOCSAV             RESTORE PTR TO INPUT             21960000
         TM    LASTSW,X'81'            DID ROUTINE SET LAST GROUP SW    21980000
         BO    UNPKLAST                YES - BRANCH                     22000000
         BR    BREG                    NO - RETURN TO MAIN CODE         22020000
         SPACE 2                                                        22040000
UNPKLAST AR    RLOC,INLEN              GET TO LAST CHARACTER            22060000
         LA    R14,15                  LOAD LAST CHARACTER      YA01690 22080002
         TM    PPSW1,1            PRINT OR PUNCH?              @ZA11968 22085000
         BZ    PRINTA             PRINT.GO PRINT WITHOUT SIGN  @ZA11968 22090000
         IC    R14,0(RLOC)        PUNCH.LOAD LAST CHARACTER    @ZA11968 22095000
PRINTA   SLL   R14,8              MOVE IT OVER 1 BYTE          @ZA11968 22100000
         IC    R14,0(RLOC)             LOAD LAST CHARACTER AGAIN        22120000
         SRL   R14,4                   SWITCHED - LOSE 4 LOW ORDER BITS 22140000
         SLL   INLEN,1                 MULTIPLY COUNT BY TWO            22160000
         AR    ROUT,INLEN              ADD IN OUTPUT LOCATION           22180000
         STC   R14,0(ROUT)             STORE CHARACTER IN OUTPUT AREA   22200000
         MVI   LASTSW,X'00'            CLEAR LAST SWITCH                22220000
         LH    INLEN,LENSAV            RESET LENGTH REG                 22240000
         L     ROUT,OUTSAV             RESET OUTPUT PTR                 22260000
         L     RLOC,LOCSAV             RESET INPUT PTR                  22280000
         LA    ROUT,1(ROUT)            ADD 1 TO OUTPUT PTR FOR EOR *    22300000
         BR    BREG                    RETURN TO MAIN CODE              22320000
         SPACE 3                                                        22340000
*          T R A N S L A T I O N    L I S T S                           22360000
FCLIST   DC    C'0123456789'                                            22380000
FCPLUSA  DC    C'ABCDEF'                                                22400000
FCHEX    DC    C'ABCDEF'                                                22420000
FCSIGNS  DC    C'+-+-++'                                                22440000
FCMZ     MVZ   1(1,ROUT),0(ROUT)       INSTRUCTION EXECUTED             22460000
         EJECT                                                          22480000
*                                                                       22500000
*********************************************************************** 22520000
* THIS ROUTINE INITIALLY BLANKS OUT THE OUTPUT BUFFER, PRINTS TITLES  * 22540000
* AND SETS UP FOR THE PRINTING OR PUNCHING OF A SEQUENTIAL DATA SET   * 22560000
* OR THE MEMBERS OF A PARTITIONED DATA SET.                           * 22580000
*********************************************************************** 22600000
*                                                                       22620000
PPHEAD   TM    PREFORMT,X'81'     IS IT PREFORMATTED INPUT?    @ZA11952 22625099
         BCR   7,BREG             YES,SKIP PRINTING OF SEQ NO  @ZA11952 22630099
         ST    BREG,PPHSAVE            SAVE RETURN REGISTER    @ZA11952 22640099
         TM    PPSW1,1                 IS THIS A PRINT OR PUNCH OPERAT. 22660000
         BO    PU1                     PUNCH - BRANCH                   22680000
*          P R I N T I N G                                              22700000
         IC    CTLREG,PPCTL            SAVE CONTROL CHARACTER           22720000
         BAL   BREG,BLANKOUT           CLEAR OUTPUT BUFFER TO BLANKS    22740000
         MVI   PPCTL,C'1'              CTL TO EJECT PAGE AND PRINT LINE 22760000
         SR    TEMP1,TEMP1             CLEAR WORK REG                   22780000
         STH   TEMP1,LINECT            CLEAR OUTPUT LINE COUNTER        22800000
         TM    PAGEBYT,X'F0'       PAGE NBR TO BE PRINTED ?      A45134 22810021
         BO    TURNPAGE            NO, TURN TO NEXT PAGE         A45134 22820021
         LH    TEMP1,PGBIN             LOAD INITIAL PAGE NUMBER         22840000
         LR    TEMP2,TEMP1             MOVE PAGE NUMBER                 22860000
         AH    TEMP2,PH1               ADD ONE TO PAGE NUMBER           22880000
         STH   TEMP2,PGBIN             STORE NEXT PAGE NUMBER           22900000
         LA    TEMP2,OUTBUFF1      LOAD OUTPUT BUFF. ADDRESS     A45134 22902021
         AH    TEMP2,MAXOUT        ADD OUTPUT LENGTH-1           A45134 22904021
         SH    TEMP2,=H'10'        SUBTR 10 FOR PAGE NBR PURP.   A45134 22906021
         MVC   0(4,TEMP2),PAGE     MOVE 'PAGE' TO OUTPUT AREA    A45134 22910021
         CVD   TEMP1,DBLWD             CONVERT PAGE NUMBER TO DECIMAL   22920000
         UNPK  5(4,TEMP2),DBLWD+5(3)   UNPK PAGE NBR IN HEADER   A45134 22940021
         OI    8(TEMP2),X'F0'      RESET SIGN TO PRINTABLE CHAR. A45134 22960021
TURNPAGE BAL   BREG,WRCH               PRINT PAGE NUMBER         A45134 22980021
         STC   CTLREG,PPCTL            RESTORE CONTROL CHARACTER        23000000
         B     PPNAME         SKIP OVER PUNCH ROUTINE          @ZA07371 23020099
*          P U N C H I N G                                              23040000
PU1      TM    PPSW1,2                 ARE PUNCHED CARDS TO BE SEQUENCE 23060000
         BZ    PPNAME         NO --- BRANCH                    @ZA07371 23080099
         L     TEMP1,INITCDB            GET INIT.CARD SEQ NUMBER        23100000
         ST    TEMP1,CDNOB              SAVE SEQUENCE NUMBER            23120000
*          W R I T E    S E T U P                              @ZA07371 23140099
PPNAME   TM    TYPORG,1       IS THE INPUT A PDS               @ZA07371 23160099
         BZ    PPT            NO,TEST IF TITLE                 @ZA07371 23180099
         L     LISTR,DIRADD   YES - HAVE TO WRITE MEMBER NAME  @ZA07371 23200099
*                             LOAD PTR TO MEMBER NAMES         @ZA07371 23220099
         LA    OUTLOC,OUTBUFF1 LOAD PTR TO OUTPUT AREA         @ZA07371 23240099
         BAL   BREG,BLANKOUT  BLANK OUT OUTPUT AREA            @ZA07371 23260099
         MVC   0(11,OUTLOC),MBRNAMEA 'MEMBER NAME' TO OUTPUT   @ZA07371 23280099
         MVC   13(8,OUTLOC),0(LISTR) MOVE NAME TO OUTPUT AREA  @ZA07371 23300099
         BAL   BREG,WRCH      PRINT A LINE                     @ZA07371 23320099
         TM    TYPORG,2       IS WHOLE PDS BEING PROCESSED     @ZA07371 23340099
         BO    PPT            NO,TEST IF TITLE                 @ZA07371 23360099
         NI    PPN7+1,X'0F'   YES - CLEAR NOP SWITCH           @ZA07371 23380099
         LH    ALIASR,ALIASCT ALIAS COUNT FOR THIS MEMBER      @ZA07371 23400099
PPN6     LTR   ALIASR,ALIASR  ARE THERE ANY ALIASES            @ZA07371 23420099
         BC    13,PPT         NO,TEST IF TITLE                 @ZA07371 23440099
         LA    OUTLOC,OUTBUFF1 ADDRESS OF OUPUT BUFFER         @ZA07371 23460099
         BAL   BREG,BLANKOUT  CLEAR OUTPUT AREA TO BLANKS      @ZA07371 23480099
PPN7     NOP   PPN8           PRINT ALIASES SWITCH             @ZA07371 23500099
         MVC   0(7,OUTLOC),ALIASA 'ALIASES' TO OUTPUT AREA     @ZA07371 23520099
PPN8     LH    FLDCT,MAXOUT   LOAD OUPUT LRECL MINUS ONE       @ZA07371 23540099
         SRL   FLDCT,4        DIVIDE IT BY 16                  @ZA07371 23560099
PPN10    LA    OUTLOC,10(OUTLOC) BUMP OUTPUT POINTER TEN       @ZA07371 23580099
         AH    LISTR,LISTLEN  BUMP PTR TO MEMBER NAMES TO      @ZA07371 23600099
*                             ALIASES - ADD 12                 @ZA07371 23620099
         MVC   3(8,OUTLOC),0(LISTR) MOVE ACT. ALIAS TO OUTPUT  @ZA07371 23640099
         BCT   ALIASR,PPN11   ANY MORE ALIASES ?               @ZA07371 23660099
         B     PPNWRT         NO, PRINT ALIASES AND RETURN     @ZA07371 23680099
PPN11    BCT   FLDCT,PPN10    BRANCH WHEN ENOUGH SPACE IN      @ZA07371 23700099
*                             OUTPUT BUFF FOR NEXT ALIAS       @ZA07371 23720099
PPN12    OI    PPN7+1,X'F0'   SET NO ALIAS NOP SWITCH          @ZA07371 23740099
PPNWRT   BAL   BREG,WRCH      PRINT ALIAS NAME                 @ZA07371 23760099
         B     PPN6           TEST FOR MORE ALIASES            @ZA07371 23780099
*          T I T L E    P R I N T I N G                        @ZA07371 23800099
PPT      TM    PPSW1,1        IS IT A PRINT OPERATION?         @ZA07371 23805099
         BZ    PRINT          YES,GO TO TEST IF TITLE TO PRINT @ZA07371 23810099
         TM    PPSW1,4        IS THIS THE FIRST MEMBER         @ZA07371 23820099
         BO    PPHRET         NO - BRANCH                      @ZA07371 23840099
         OI    PPSW1,4        YES - SET SWITCH                 @ZA07371 23860099
PRINT    CLC   TCB1(2),PHZERO IS THERE A TITLE                 @ZA07371 23880099
         BNH   NOTITLE        NO -- TEST FOR SUBTITLE          @ZA07371 23900099
         LA    TCBR,TCB1      LOAD ADDRESS OF TITLE CTL BLOCK  @ZA07371 23920099
         BAL   BREG1,TITLEMOV WRITE AND CHECK TITLE            @ZA07371 23940099
NOTITLE  CLC   TCB2(2),PHZERO IS THERE A SUBTITLE              @ZA07371 23960099
         BNH   PPHRET         NO,RETURN                        @ZA07371 23980099
         LA    TCBR,TCBL(TCBR) LOAD ADDR OF SUBTITLE CTL BLK   @ZA07371 24000099
         BAL   BREG1,TITLEMOV WRITE AND CHECK SUBTITLE         @ZA07371 24020099
PPHRET   L     BREG,PPHSAVE            RESTORE RETURN REGISTER          24040000
         BR    BREG                    RETURN TO MAIN CODE              24060000
QSPREFM LH     R12,MAXOUT                                          VS0H 24061017
         STH   R12,OUTLRECL                                        VS0H 24062017
         LA    R6,1                                                VS0H 24064017
         MVI   OUTBUFF1,C' '                                       VS0H 24065017
         EX    R12,CLEAROUT                                        VS0H 24066017
         SH    R4,PH4                                              VS0H 24067517
         SR    R4,R6                   REDUCE BY 1 FOR EXEC&COMP   VS0H 24067717
         CR    R12,R4                                              VS0H 24068017
         BL    PREVRBA1                                            VS0H 24069017
         EX    R4,QSMOVE                                           VS0H 24071017
         BAL   BREG,WRCH                                           VS0H 24072017
         B     RDCH                                                VS0H 24073017
PTCHONE  CLC   LRECL,=X'7FF4'                                      VS0H 24075017
         BNH   TSTKEYS                 LESS THAN 32K               VS0H 24079017
         MVI   QSBRNOP+1,X'0'                                      VS0H 24083017
         B     TSTPREFM                                            VS0H 24087017
TSTKEYS  TM    KEYLEN+1,X'FF'                                      VS0H 24091017
         BZ    VRQSAM                  NO, SET QSAM ACC METH.    A48796 24095021
         MVI   QSBRNOP+1,X'00'                                     VS0H 24099017
         B     VSKEYS                  USE BSAM                    VS0H 24103017
PPHSAVE  DS    F                       HOLDS RETURN REG FOR PPHEAD ROUT 24107017
OPENSW   DC    X'0'                    ON DURING OPEN RTNE ONLY    UL0H 24111017
         EJECT                                                          24120000
*                                                                       24140000
*********************************************************************** 24160000
* THIS ROUTINE HANDLES THE 'PREFORM' UTILITY PROGRAM OPTION. THROUGH  * 24180000
* THIS OPTION THE USER MAY HAVE ALREADY BUILT AN INPUT DATA SET WITH  * 24200000
* AN IMBEDDED CONTROL CHARACTER WHICH WILL GOVERN THE OUTPUT CONTROL  * 24220000
* OF THE OUTPUT DATA SET. IF THE INPUT RECORDS ARE OF THE FIXED OR    * 24240000
* UNDEFINED FORMAT THE CONTROL CHARACTER IS IN THE FIRST BYTE; IF     * 24260000
* VARIABLE THE FIFTH BYTE. AN INPUT LOGICAL RECORD WHICH EXCEEDS 121  * 24280000
* BYTES CAUSES A MESSAGE TO BE PRINTED AND JOB TERMINATION. WHEN      * 24300000
* PREFORM IS SPECIFIED ALL OTHER CONTROL STATEMENT REQUESTS ARE       * 24320000
* IGNORED.                                                            * 24340000
*********************************************************************** 24360000
*                                                                       24380000
PREFORM  LA    R8,INSET                SET UP DSECT ADDRESSABILITY      24400000
         USING IHADCB,R8               USE DSECT FOR INPUT DCB          24420000
         LH    12,MAXOUT                                           VS0H 24430017
         STH   12,OUTLRECL                                         VS0H 24440017
NOTPUNCH L     R1,DECBI+16             IS THIS A TRUNCATED RECORD       24520000
         SH    R1,PH1                  GET TO RIGHT BYTE IN DECB -      24540000
         TM    0(R1),X'01'             SUBTRACT ONE - TEST FOR TRUNCAT. 24560000
         BO    COMPUTE                 YES IT'S A TRUNCATED RECD - BRAN 24580000
         TM    DCBRECFM,X'90'          IS INPUT BLOCKED RECORDS         24600000
         BO    BLOCKED                 YES - BRANCH                     24620000
         TM    DCBRECFM,X'C0'          IS IT A UNDEFINED LENGTH RECORD  24640000
         BO    URECORD                 YES IT IS - BRANCH               24660000
         TM    DCBRECFM,X'40'          IS IT A VARIABLE LENGTH RECORD   24680000
         BO    VBLOC                                               3173 24700015
         L     R1,INBUFF               LOAD ADDRESS OF INPUT AREA       24720000
         LA    R6,1                    LOAD ONE INTO A REG              24740000
         MVI   OUTBUFF1,C' '           CLEAR OUTPUT BUFFER              24760000
         EX    R12,CLEAROUT                                        VS0H 24780017
         LH    R4,DCBLRECL             LOAD LOGICAL RECORD LENGTH       24800000
         SR    R4,R6                   REDUCE BY 1 FOR EXEC&COMP   VS0H 24810017
         CR    R12,R4                   IS INPUT GREATER THAN MAX       24820000
         BL    PREVRBA1                                            VS0H 24850017
         EX    R4,MOVE                 MOVE INPUT CONTROL CHAR TO OUT.  24880000
         BAL   BREG,WRCH               WRITE(PRINT/PUNCH) RECORD        24900000
         B     RDCH                    READ ANOTHER PHYSICAL RECORD     24920000
BLOCKED  MVC   STARTIN(4),INBUFF                                   2461 24930016
         L     R3,DECBI+16                                         2461 24940016
         LH    R3,14(R3)                                           2461 24950016
         LH    R4,DCBBLKSI                                         2461 24960016
         SR    R4,R3                                               2461 24970016
         STH   R4,BLCKREM                                          2461 24980016
TRUNCBLK DS    0H                                                  VS0H 25000017
THRUONCE LH    R1,BLCKREM              HOW MUCH OF INPUT BLOCK IS LEFT  25060000
         LTR   R1,R1                   IS BLOCK FINISHED                25080000
         BNP   RDCH                                            @ZA04389 25100003
         SH    R1,DCBLRECL             TAKE LRECL FROM REMAINING BLKSIZ 25120000
         STH   R1,BLCKREM              STORE REMAINDER                  25140000
         L     R2,STARTIN              LOAD PTR TO INPUT BUFFER         25160000
         LA    R6,1                    LOAD A ONE IN REG                25180000
         MVI   OUTBUFF1,C' '           CLEAR OUTPUT BUFFER              25200000
         EX    R12,CLEAROUT                                        VS0H 25220017
         LH    R4,DCBLRECL             LOAD LOGICAL RECORD LENGTH       25240000
         SR    R4,R6                   REDUCE BY 1 FOR EXEC&COMP   VS0H 25243017
         CR    R12,R4                                              VS0H 25246017
         BL    SETBLKSW                                            VS0H 25252017
         EX    R4,MOVE2                MOVE CTL CHAR TO OUTPUT AREA     25280000
         AH    R2,DCBLRECL             ADD LRECL TO INPUT POINTER       25300000
         ST    R2,STARTIN              SAVE THIS ADDRESS IN SAVE AREA   25320000
         TM    BLKDSWCH+1,X'F0'                                    VS0H 25326017
         BO    BLKDLONG                                            VS0H 25333017
         BAL   BREG,WRCH               WRITE(PRINT/PUNCH) RECORD        25340000
         B     THRUONCE                DO NEXT RECORD                   25360000
RESETSW  MVC   STARTIN(4),INBUFF       RESET INPUT ADDRESS              25380000
         MVC   BLCKREM,DCBBLKSI        RESET BLOCK SIZE                 25400000
         B     RDCH                    READ ANOTHER PHYSICAL RECORD     25420000
COMPUTE  L     R1,DECBI+16             LOAD IOB+8 PTR                   25440000
         LH    R2,14(R1)               LOAD RESIDUAL COUNT FROM CSW     25460000
         LH    R3,DCBBLKSI             LOAD BLOCKSIZE FROM INPUT DCB    25480000
         SR    R3,R2                   GET NUMBER OF BYTES IN TRUNC REC 25500000
         ST    R3,BLCKREM              STORE NEW BLOCK SIZE             25520000
         B     TRUNCBLK                                            VS0H 25620017
URECORD  L     R1,INBUFF               LOAD ADDRESS OF INPUT AREA       25740000
         LH    R4,DCBBLKSI             LOAD BLOCK SIZE OF INPUT DCB     25760000
         L     R5,DCBIOBA              GET IOB ADDRESS FROM INPUT DCB   25780000
         LA    R5,0(R5)                CLEAR HIGH ORDER BYTE OF R5      25800000
         LH    R5,22(R5)               GET RESIDUAL COUNT FROM CSW      25820000
COMMON   MVI   OUTBUFF1,C' '           CLEAR OUTPUT BUFFER              25840000
         EX    R12,CLEAROUT                                        VS0H 25860017
         LA    R6,1                    LOAD A ONE FOR EXECUTE INSTRUCT. 25880000
         SR    R4,R5                   SUBTRACT RES COUNT FROM BLKSIZE  25900000
         CR    R12,R4                  IS INPUT GREATER THAN MAX        25920000
         BL    PREVRBA2                BREAK UP UNDEFINED RECORDS  VS0H 25940017
         SR    R4,R6                   SUBTRACT ONE MORE                25960000
         EX    R4,MOVE                 MOVE LENGTH TO OUTPUT BUFFER     25980000
         BAL   BREG,WRCH               WRITE(PRINT/PUNCH) RECORD        26000000
         B     RDCH                    READ ANOTHER PHYSICAL RECORD     26020000
VBLOC    LA    R4,1                    LOAD A ONE                       26040000
         LA    R5,4                    LOAD A FOUR                      26060000
         L     R3,INBUFF               LOAD ADDRESS OF INPUT BUFFER     26080000
         LH    R7,0(R3)                GET BLOCK SIZE                   26100000
         SR    R7,R5                   SUBTRACT 4 BYTES FROM BLKSIZE    26120000
         STH   R7,BLCKREM              STORE THAT IN HOLD AREA          26140000
         LA    R3,4(R3)                SKIP 4 BYTES OF VAR. BLK RECORD  26160000
         ST    R3,STARTIN              STORE INPUT AREA PTR+4           26180000
ONCE     LH    R1,BLCKREM              HOW MUCH INPUT BLOCK LEFT        26200000
         LTR   R1,R1                   IS IT ALL DONE                   26220000
         BZ    RDCH                    YES --- READ NEW PHYSICAL RECD   26240000
         L     R3,STARTIN               NO -- GET PTR TO LOGICAL REC    26260000
         MVC   HWD(2),0(R3)            MOVE LRECL TO HALF WORD BOUNDARY 26280000
         LH    R3,HWD                  LOAD LOGICAL RECORD LENGTH       26300000
         AR    R12,R5    ADD 4 BYTES TO ACCOUNT FOR LLBB           3173 26310015
         AH    R12,PH1       ADD 1 BYTE FOR ASA OR MC. BYTE      A38702 26315020
         CH    R12,HWD                  IS INPUT GREATER THAN MAX       26320000
         BL    SETVSW                                              VS0H 26330017
         SR    R12,R5    REINITIALIZE R12                          3173 26350015
         SH    R12,PH1                                           A38702 26355020
         SR    R1,R3                   SUBTRACT LOG. REC. LEN FROM BLKZ 26360000
         STH   R1,BLCKREM              STORE REST OF BLOCK SIZE         26380000
         L     R2,STARTIN              LOAD INPUT AREA POINTER          26400000
         LA    R2,4(R2)                BUMP IT BY 4                     26420000
         SR    R3,R5                   SUBTRACT 4 BYTES OF LRECL        26440000
         SR    R3,R4                   PREPARE FOR EXECUTE INSTRUCTION  26460000
         MVI   OUTBUFF1,C' '           CLEAR OUTPUT BUFFER              26480000
         EX    R12,CLEAROUT                                        VS0H 26500017
         EX    R3,MOVE2                                                 26520000
         AR    R3,R4                   RESET R3                         26540000
         AR    R2,R3                   BUMP UP INPUT PTR                26560000
         ST    R2,STARTIN              SAVE THIS NEW ADDRESS            26580000
         BAL   BREG,WRCH               WRITE(PRINT/PUNCH) RECORD        26600000
         B     ONCE                                                     26620000
         SPACE 3                                                        26640000
MOVE     MVC   OUTBUFF(1),0(R1)                                         26660000
MOVE2    MVC   OUTBUFF(1),0(R2)                                         26680000
MOVEPART MVC   OUTBUFF1,0(R2)                                      VS0H 26690017
HWD      DC    X'0000'                 HALF WORD WORK AREA              26700000
CLEAROUT MVC   OUTBUFF1+1,OUTBUFF1                                 UL0H 26705017
SAVLRECL DS    H                                                   VS0H 26710017
OUTLRECL DS    H                                                   VS0H 26715017
         DROP  R8                                                       26720000
         EJECT                                                          26740000
*                                                                       26760000
*********************************************************************** 26780000
* THIS ROUTINE WRITES(PRINT/PUNCH) ONE RECORD. THE LINE COUNT IS      * 26800000
* INCREMENTED BY ONE BEFORE IT IS PRINTED IF PRINTING IS REQUIRED OR  * 26820000
* THE CARD NUMBER IS INCREMENTED IF IT IS TO BE PUNCHED.              * 26840000
*********************************************************************** 26860000
*                                                                       26880000
WRCH     TM    PPSW1,X'03'             IS OUTPUT PRINTED OR PUNCHED     26900000
         BO    WCCDNO                  YES - PUNCH W/SEQUENCE - BRANCH  26920000
         BM    WRCH2                   NO - JUST PUNCHED - BRANCH       26940000
CGLPUNCH LH    TEMP1,LINECT            LOAD LINE COUNTER                26960000
         AH    TEMP1,LINEINCR          ADD ONE TO LINE COUNTER          26980000
         STH   TEMP1,LINECT            STORE LINE COUNTER               27000000
*          W R I T E    O U T P U T                                     27020000
WRCH2    ST    R8,KEEPR4R6         SAVE R8                         7034 27040000
         TM    NOTOPEN,X'F0'    SYSUT2 D C B NOT OPENED            7034 27060000
         BO    SYPRNDCB    USE SYSPRINT D C B                      7034 27080000
         LA    R8,OUTSET    ADDR OF SYSUT2  D C B                  7034 27100000
         B     WRCH3    GO ISSUE WRITE                             7034 27120000
SYPRNDCB L     R8,SYSPRPTR     USE SYSPRINT D C B                  7034 27140000
WRCH3    PUT   (R8),OUTBUFF                                      A23458 27170018
         L     R8,KEEPR4R6     RESTORE R 8                         7034 27200000
         BR    BREG                    RETURN TO MAIN CODE              27220000
         SPACE 2                                                        27240000
WCCDNO   L     TEMP2,CDNOB              LOAD CARD NUMBER                27260000
         LR    TEMP1,TEMP2              MOVE CARD NUMBER                27280000
         A     TEMP2,CDINCRB            INCREMENT CARD NUMBER           27300000
         ST    TEMP2,CDNOB             STORE CARD NUMBER                27320000
         CVD   TEMP1,DBLWD             CONVERT CARD NUMBER TO DECIMAL   27340000
         UNPK  PUCD(8),DBLWD+3(5)      ADD ZONE BITS TO CONVERTED NUMB. 27360000
         OI    PUCD+7,X'F0'            RESET SIGN TO PRINTABLE CHAR.    27380000
         B     WRCH2                   BRANCH TO WRITE MACRO TO PUNCH   27400000
*                                                                       27420000
*          MOVE AND WRITE TITLE                                         27440000
*                                                                       27460000
TITLEMOV LH    LEN,0(TCBR)             LOAD TITLE LENGTH                27480000
         BCTR  LEN,R0                  REDUCE LENGTH FOR EXECUTE INST.  27500000
         LA    ROUT,OUTBUFF1           LOAD ADDRESS TO OUTPUT FIELD     27520000
         L     RLOC,4(TCBR)            LOAD PTR TO TITLE                27580000
         EX    LEN,FMOVE               MOVE TITLE TO OUTPUT AREA        27620000
         LH    LEN,2(TCBR)         LOAD TITLE LENGTH            OY01168 27622016
         LH    R12,MAXOUT          LOAD OUTPUT LRECL-1          OY01168 27624016
         CR    LEN,R12             LITT. EXCEEDS OUTPUT ?       OY01168 27626016
         BNH   TITLOKE             NO, CONTINUE                 OY01168 27628016
         LA    R0,37               LOAD MSG NUMBER IEB437I      OY01168 27630016
         LR    R1,R0               LOAD MSG DISPL OF MSG IEB437I Y01168 27632016
         B     IOWRT               PRINT MSG AND STOP PROC.     OY01168 27634016
TITLOKE  EQU   *                   CONT. PROCESSING             OY01168 27636016
         LR    BREG,BREG1              MOVE RETURN PTR TO PPNAME        27640000
         B     WRCH                    WRITE AND CHECK TITLE            27660000
*                                                                       27680000
*          CLEAR OUTPUT AREA                                            27700000
*                                                                       27720000
BLANKOUT MVI   OUTBUFF1,C' '           CLEAR OUTPUT BUFFER TO BLANKS    27740000
         LH    R12,MAXOUT                                          UL0H 27750017
         EX    R12,CLEAROUT                                        UL0H 27760017
         BR    BREG                    RETURN TO MAIN CODE              27780000
         SPACE 3                                                        27800000
*                                                                       27820000
*          INSTRUCTIONS EXECUTED                                        27840000
*                                                                       27860000
IDTCOMP  CLC   0(1,RLOC),0(RLIT)                                        27880000
FMOVE    MVC   0(1,ROUT),0(RLOC)       USED TO MOVE TITLE AND OUTPUT    27900000
*                                      TO OUTPUT BUFFER                 27920000
FCTR     TR    0(1,ROUT),FCLIST        USED TO CONVERT CHARACTERS       27940000
QSMOVE   MVC   OUTBUFF(1),4(R1)                                    VS0H 27950017
         EJECT                                                          27960000
*                                                                       27980000
*********************************************************************** 28000000
*                 E R R O R    R O U T I N E S                        * 28020000
*                                                                     * 28040000
*          GO TO IEBPPUN1 - ROOT SEGMENT - TO PRINT MESSAGE           * 28060000
*********************************************************************** 28080000
*                                                                       28100000
*          B L D L    M A C R O    E R R O R                            28120000
MEMBNO   LA    R1,BLDENTRY             LOAD ADDRESS OF MEMBER NAME      28140000
         MVI   PPRETCDE,X'8'           SET RETURN CODE                  28160000
         LA    R0,8                    LOAD PTR TO APPROPRIATE MESSAGE  28180000
         L     R15,MNMSGA              LOAD ADDRESS OF MESSAGE ROUTINE  28200000
         LA    R14,SDSEND              LOAD RETURN REGISTER - IF        28220000
*                                      PROCESSING A SDS THE PROGRAM IS  28240000
*                                      TERMINATED - IF A PDS NEXT       28260000
*                                      MEMBER IS READ                   28280000
         BR    R15                     GO TO ROOT SEGMENT TO PRINT MSG  28300000
         SPACE 2                                                        28320000
*          T E R M I N A T I O N    E R R O R    R O U T N E            28340000
DCBERROR LA    R0,12             LOAD  IEB412I MESS.             A45135 28350021
         LA    R1,6              LOAD MESS. NUMBER               A45135 28352021
         MVI   DDSWITCH,X'01'    SET NOTFREEMAIN SWITCH          A45135 28352421
         B     IOWRT             SET C.C AND PRINT MESSAGE       A45135 28354021
PRERROR1 L     R10,SAVEAREA            RESTORE ADDRESSABILITY           28360000
PRERROR  LA    R0,10                   LOAD IEB CODE FOR MESSAGE        28380000
         LA    R1,20                   LOAD ONE LESS THAN MSG NUMBER    28400000
         B     IOWRT                   ARRANGE IEB CODE AND MSG NUMBER  28420000
TEMPTY   LA    R0,17                                               1244 28425014
         LA    R1,25                                               1244 28430014
         MVI   PPRETCDE,X'4'       SET RETURN CODE TO 4          A48732 28432021
         B     IOWRT1              PRINT MSG IEB417I             A48732 28435021
IOERRIN  LA    R0,7                    LOAD IEB CODE FOR MESSAGE        28440000
         LA    R1,IOMSG                LOAD ONE LESS THAN MSG NUMBER    28460000
IOWRT    MVI   PPRETCDE,X'C'           SET RETURN CODE TO 12            28480000
IOWRT1   SLL   R1,8                    MOVE MSG NUMBER OVER 2 BYTES     28500000
         AR    R1,R0                   PLACE IEB CODE IN SAME REG       28520000
         L     R15,PMSGWRTA            LOAD PTR TO MESSAGE WRITER       28540000
         LA    R14,CLOSEIO             LOAD PTR TO END OF JOB ROUTINE   28560000
         MVC   INTLRPRT,NOPLBLPR       BYPASS PRINT OF TLR         UL0H 28566017
*                                      LABELS ON IO ERROR ON OP    UL0H 28572017
         BR    R15                     GO TO ROOT SEGMENT TO PRINT MSG  28580000
*                                                                       28581019
*               I / O   E R R O R  H A N D L I N G   R O U T I N E      28582019
*                                                                       28583019
         USING IHADCB,R8                                       @ZA07372 28583599
SYNADMSG TM    DCBCIND2,DCBCNQSM   QSAM USED FOR D/S?          @ZA07372 28584099
         BO    QSYNADAF            YES, TAKE QSAM SYSNADAF ROUT. A48796 28584121
         SYNADAF ACSMETH=BSAM      BSAM SYSNADAF                 A48796 28584221
         B     SKIPQSYN            SKIP QSAM SYSNADAF            A48796 28584321
QSYNADAF SYNADAF ACSMETH=QSAM      QSAM SYSNADAF                 A48796 28584421
SKIPQSYN EQU   *                   PRINT SYNADAF MESSAGE         A48796 28584521
         LA    R7,MSGSYNDF        GET MESSAGE BUFFER ADDR          7715 28585019
         LA    R7,18(R7)          GET ADDR OF BUFFER BEYOND ID     7715 28586019
         MVC   0(79,R7),49(R1)    MOVE MESSAGE TO BUF              7715 28587019
         SYNADRLS                                                  7715 28588019
         LA    R1,MSGSYNDF        GET MESSAGE ADDR FOR PRINT       7715 28589019
         LA    R0,96              SET LENGTH OF MSG TO BE WRITTEN  7715 28590019
         MVI   PPRETCDE,X'C'      SET RETURN CODE TO 12            7715 28591019
         LA    R14,CLOSEIO        LOAD PTR TO END OF PPCH1         7715 28592019
         L     R15,VZZPR          LOAD PTR TO MESSAGE WRITER RTN   7715 28593019
         MVC   INTLRPRT,NOPLBLPR  BYPASS TLR LABEL PRINT ON I/O ER 7715 28594019
         BR    R15                GO TO CLOSE INPUT & OUTPUT DCBS  7715 28595019
         DROP  R8                                              @ZA07372 28595599
         SPACE 2                                                        28600000
EXTERM1  LA    R1,EOJUSM               LOAD 12 INTO REG 0 AND 1         28620000
         LA    R0,6                                                     28640000
         STC   R15,PPRETCDE            STORE RETURN CODE                28660000
         B     IOWRT1                  WRITE MESSAGE                    28680000
PREERR1  LA    R0,13                    LOAD ERROR MESSAGE CODE FOR IEB 28700000
         LA    R1,22                   LOAD ONE LESS THAN MESSAGE       28720000
*                                       NUMBER IN IEBPPMSG MODULE  UL0H 28728017
         B     IOWRT1                   ARRANGE CODES--PRINT MSG   UL0H 28736017
LBLPRNT  ST    R5,SAVER5                                           UL0H 28744017
         TM    IOSW+1,X'F0'                                        UL0H 28752017
         BO    IOLABERR                                            UL0H 28760217
         LA    R5,LABEL1                                           UL0H 28760317
         CL    R5,LBLSVPTR                                         UL0H 28760621
         BE    EXITULPR                                            UL0H 28760817
         TM    ULEXSW+1,X'F0'                                      UL0H 28761117
         BO    ULPROC                  GO TO USER LABEL PROC.      UL0H 28761317
YESLABLS B    LABELS                                               UL0H 28761517
ULPROC   CLI   USRTRMSW,X'F0'                                      UL0H 28761817
         BE    WRTUSTMS                                            UL0H 28762117
         B     LABELS                                              UL0H 28762717
WRTUSTMS LA    R0,6                                                UL0H 28763317
         LA    R1,12                    12 IS USTERM MSG # DIPSL.  UL0H 28763617
         B     IOWRT                                               UL0H 28763917
WRTIOMSG LA    R0,7                                                UL0H 28764217
         LA    R1,13                                               UL0H 28764517
         B     IOWRT                                               UL0H 28764817
LABELS   MVC   PRNTLIM,LBLSVPTR                                    UL0H 28765117
         ST    R5,LBLSVPTR                                         UL0H 28765417
         TM    PPSW1,1        PUNCH COMMAND ?                    A45135 28766821
         BNZ   PRINTLBL       YES, DO NOT PRINT PAGE HEADER      A45135 28766921
         BAL   BREG,PPHEAD    TURN PAGE AND PRINT PAGE NBR       A45135 28769221
         L     R5,LBLSVPTR    RESTORE PTR TO LABEL SAVE AREA     A45135 28769621
PRINTLBL BAL   BREG,BLANKOUT                                       UL0H 28770621
         LA    ROUT,OUTBUFF1                                       UL0H 28772021
         TM    LBLCONSW,1                                          UL0H 28773421
         BO    CONVLBLS            YES, BR TO CONVERT LBLS         UL0H 28774821
         MVC   0(80,ROUT),0(R5)                                    UL0H 28776221
         BAL   BREG,WRCH                                           UL0H 28777621
         L     R5,LBLSVPTR                                         UL0H 28779021
         AH    R5,=X'0050'         ADD  80 BYTES                   UL0H 28780421
         ST    R5,LBLSVPTR                                         UL0H 28781821
         C     R5,PRNTLIM                                          UL0H 28783221
         BE    LBLPRNTX            ALL DONE                        UL0H 28784621
         B     PRINTLBL                                            UL0H 28786021
LBLPRNTX LA    R5,LABEL1                                           UL0H 28787421
         ST    R5,LBLSVPTR             RESET PTR TO 1ST POS'N      UL0H 28788821
         MVC   LINECT,PMAXLINE          FORCE LINE COUNT TO ADV    UL0H 28790221
EXITULPR L     R5,SAVER5                                           UL0H 28791621
         BR    R8                                                  UL0H 28793021
IOLABERR LA    R0,22                                               UL0H 28794421
         LA    R1,30                                               UL0H 28795821
         B     DOIT                    TERM.RTNE ON IO LBL ERROR   UL0H 28797221
         EJECT                                                          28798621
*                                                                       28800000
*********************************************************************** 28820000
*      C O N S T A N T S    A N D    W O R K    A R E A S             * 28840000
*********************************************************************** 28860000
*                                                                       28880000
*                                                                       28900000
*          EXIT LIST FOR INPUT DATA SET                                 28920000
*              UHIN-USER INOUT HDR LABEL EXIT-ADDR.OBT'D           UL0H 28940017
*              UTIN-           TLR            BY LOAD MACROS       UL0H 28960017
*               DCBIN - DCB EXIT TAKEN AT OPEN TIME                     28980000
*                  DCBEXSW-WHEN DS CLOSED PRIOR TO REOPENING       VS0H 28990017
*                            WITH QSAM                             VS0H 29000017
         DS    0F                                                  7034 29020000
SAVER5   DS    F                                                   UL0H 29030017
DCBSAVE  DS    F                                                 A38762 29032021
KEEPR4R6 DS    3F                                                  7034 29040000
STARTIOT DS    F                                                   7034 29060000
SYSPRPTR DC    V(PPOUT)      ADDRESS OF SYSPRINT   D C B           7034 29080000
SISUT2   DC    CL8'        '                                       7034 29100000
NOTOPEN  DC    X'00'                                               7034 29120000
EXITSIN  DS    0F                                                       29140000
UHIN     DC    XL4'00C8C8C8'           WILL BE REPLACED BY INHDR   UL0H 29160017
UTIN     DC    XL4'00E3E3E3'           INTLR RTN IF ANY PASSED     UL0H 29180017
PPEXIN   DS    0F                                                  UL0H 29223017
PPHINEX  DC    X'00'                                             A45135 29226021
         DC    AL3(PPIHLEX)                                        UL0H 29229017
PPTINEX  DC    X'00'                                             A45135 29232021
         DC    AL3(PPITLEX)                                        UL0H 29235017
DDDEX    DC    X'85'         LABEL CHANGED BEC. OF AOS DSCB             29240021
DCBEXIN  DC    AL3(DCBIN)                                               29260000
DCBEXSW  DC    X'85'                                               VS0H 29265017
         DC    AL3(DCBRET)                                         VS0H 29270017
USEREX   DC    BL4'0'                                              UL0H 29276017
*                                                                       29280000
*          USED FOR BUILDING OUTPUT LINE                                29300000
*            MODIFIED FOR PUNCHING OUTPUT                               29320000
*                                                                       29340000
MAXSEG   DC    H'12'                   NUMBER OF GROUPS PER LINE        29360000
INSEG    DC    H'8'                    NUMBER OF CHARACTERS PER GROUP   29380000
OUTSEG   DC    H'10'                   CHARACTERS PLUS BLANKS PER GROUP 29400000
*                                                                       29420000
*          RECORD GROUP SWITCHES                                        29440000
*                                                                       29460000
IDSW     DC    X'0'                    INPUT, 0 = NO ID, 1 = ID TEST,   29480000
*                                      3 = END OF GROUP                 29500000
FORMATSW DC    X'0'                    OUTPUT, 0 = STANDARD FORMAT      29520000
*                                              1 = USER DEFINED FORMAT  29540000
DBLWD    DS    D                       WORK AREA FOR CARD AND PAGE      29560000
*                                      NUMBER CONVERSION TO DECIMAL     29580000
TEMBADD  DS    F                       TTR FROM NOTE MACRO EXECUTION    29600000
DADDSAV  EQU   TEMBADD                 ADDRESS OF DIRECTORY             29620000
SAVE12   DS    12F                     USED TO SORT MEMBERS IN TOTAL RT 29640000
SAVEAREA DS    2F                      REGS 10 AND 2 SAVE AREA FOR      29660000
*                                      UF10 ROUTINE                     29680000
WORKAREA DS    F                       WORK AREA FOR UF10 ROUTINE       29700000
TEMPHW1  DC    H'0'                    LENGTH OF CURRENT LOGICAL RECD.  29720000
PERM13   DC    F'0'                    SAVE AREA FOR REG 13             29740000
RECOUNT  DC    H'0'                    TO COMPUTE LENGTH OF USER FORMAT 29760000
MEMGET   DC    X'00'         SWITCH FOR GET MAIN FOR MEMBERS       4304 29768019
MEMADDR  DC    F'0'          ADDR OF STORAGE FOR GET MAIN          4304 29776019
MEMAREA  DC    F'0'          LENG OF STORAGE FOR MEMBER GET MAIN   4304 29784019
LENGTHSV DC    F'0'          LENGTH OF ALLOCATED CORE              4304 29792019
LENGTHAD DC    F'0'                    POINTER TO ALLOCATED CORE        29800000
STARTIN  DC    F'0'                    POINTS TO INPUT AREA             29820000
BLCKREM  DC    H'0'                    HOLDS REMAINING BLOCK SIZE       29840000
*                                                                       29860000
*          HALF WORD INCREMENT VALUES                                   29880000
*                                                                       29900000
PHZERO   DC    H'0'                    USED TO CLEAR AREAS TO ZEROS     29920000
PH1      DC    H'1'                                                     29940000
PH2      DC    H'2'                                                     29960000
PH4      DC    H'4'                                                     29980000
PH8      DC    H'8'                                                     30000000
PH12     DC    H'12'                                                    30020000
PH14     DC    H'14'                                                    30040000
PH16     DC    H'16'                                                    30060000
*                                                                       30080000
ANDCONST DC    F'31'                   USED TO 'AND' OUT BITS, TOTAL RT 30100000
HOLDRLEN DC    F'0'                    HOLDS LENGTH OF CURRENT RECORD   30140000
PH256    DC    H'256'                  COMPARAND FOR RECORD SIZE        30160000
LASTSW   DC    X'00'                   USED TO INDICATE LAST OF GROUP   30180000
*                                                                       30200000
*          OUTPUT CONSTANTS                                             30220000
*                                                                       30240000
PAGE     DC    C'PAGE'                 USED FOR NUMBERING PAGES         30260000
MBRNAMEA DC    C'MEMBER NAME'          USED FOR PRINTING A PDS          30280000
ALIASA   DC    C'ALIASES'                                               30300000
EOB      EQU   C'*'                                                     30320000
*                                                                       30340000
*          OUTPUT BUFFER FOR SYSUT2                                     30360000
*                                                                       30380000
OUTBUFF  DS    0X                      NAMES BUFFER                     30400000
PPCTL    DC    C' '                    CONTROL CHAR. FOR SPACE/STACKER  30420000
OUTBUFF1 DS    72X                     START OF OUTPUT IMAGE            30440000
PUCD     DS    8X                      SEQUENCE NUMBER                  30460000
         DS    30X                                                      30480000
PRPG     DS    10X                     PAGE NUMBER                      30500000
         DC    24C' '            EXTENDED BUFFER FOR MAX BLOCK   A23836 30510018
ONE45    DC    H'145'            MAXIMUM OUTPUT LRECL WHEN PRINT Y01168 30520016
EIGHTY1  DC    H'81'             MAX OUTP. LRECL WHEN PUNCH     OY01168 30530016
*                                                                       30540000
*          INPUT DATA SET PARAMETERS                                    30560000
*                                                                       30580000
RECFM    DC    X'0'                    RECORD FORMAT                    30600000
KEYLEN   DC    H'0'                    KEY LENGTH                       30620000
BLKLEN   DC    H'0'                    BLOCK LENGTH                     30640000
LRECL    DC    H'0'                    LOGICAL RECORD LENGTH            30660000
TABLEADD DS    F                       DTABLE BASE ADDRESS         UL0H 30680017
*          TABLE BUILT BY IEBPPAL1                                      30700000
*            CONTAINS SWITCHES AND COUNTERS                             30720000
*              PERTINENT TO USERS REQUEST - INITIALLY                   30740000
*                REFERENCED BY DTABLE DSECT                             30760000
*                                                                       30780000
TABLE    DS    0F                                                       30800000
LITADD   DC    F'0'                    ADDRESS OF LITERAL POOL          30820000
MNTADD   DC    F'0'                    MEMBER NAME TABLE ADDRESS        30840000
TYPORG   DC    X'0'                    0 - PDS, 1 - TOTAL PDS, 3 -      30860000
*                                      NAMED PDS MEMBERS                30880000
TOTCONV  DC    X'0'                    CONVERSION SWITCH -- 0 = NO CONV 30900000
*                                      1 = HEX TO EBCDIC(HE)            30920000
*                                      3 = PACKED TO UNPACKED DEC.(PZ)  30940000
PPSW1    DC    X'00'                   0 - PRINT, 1 - PUNCH,            30960000
*                                      3 - SEQUENCE CARDS, 7 - NOT      30980000
*                                      FIRST TIME                       31000000
CNTRL    DC    X'1'                                                     31020000
INITCDB  DC    F'0'                                                     31040000
CDINCRB  DC    F'10'                    CARD INCREMENT,BINARY           31060000
PGBIN    DC    H'1'                    INITIAL PAGE NUMBER              31080000
PMAXLINE DC    H'60'                   LINES PER PAGE                   31100000
INITSTOP DC    H'0'                    RECORD NUMBER TO STOP AFTER      31120000
INITSKIP DC    H'0'                    RECORD NUMBER TO SKIP(PROCESS)   31140000
STRTAFT  DC    H'0'                    RECORD NBR TO START AT    A45135 31150021
TCB      DS    0F                      TITLE CONTROL BLOCK              31160021
TCB1     DC    H'0'                    LENGTH OF TITLE                  31180000
         DC    H'0'                    RELATIVE LOCATION OF OUTPUT AREA 31200000
*                                      WHERE ON CARD OR PAGE IT APPEARS 31220000
         DC    F'0'                    ADDRESS OF TITLE                 31240000
*                                      SUBTITLE CONTROL BLOCK           31260000
TCB2     DC    H'0'                    LENGTH OF TITLE                  31280000
         DC    H'0'                    RELATIVE OUTPUT LOCATION         31300000
         DC    F'0'                    ADDRESS OF TITLE                 31320000
PREFORMT DC    X'00'                   80 = ASA, 01 = MACHINE CODE      31340000
LPRSW    DC    X'00'                                               UL0H 31345017
PROCKY   DC    X'00'                                               UL0H 31350017
LBLCONSW DC    X'00'                                               UL0H 31355017
TBLEN    EQU   *-TABLE                 GET TABLE LENGTH                 31360000
*          E N D    O F    T A B L E                                    31380000
*                                                                       31400000
*                        COUNTERS FOR HDR & TRLR LABEL PROC        UL0H 31401017
*                                                                  UL0H 31402017
         DS    0D                                                  UL0H 31403017
UTINCT   DC    XL8'0'                                              UL0H 31404017
USERTNCT DC    XL4'0'                                              UL0H 31405017
ULABIN   DC    XL4'0'                                              UL0H 31406017
BYPASSED DC    XL4'0'                                              UL0H 31407017
CONVSAV  DS    XL1                                                 UL0H 31409017
*          SYMBOLIC NAMES OF USERS EXITS                                31420000
*                                                                       31440000
EXLIST   DS    0D                                                       31460000
INHDR    DC    CL8' '                  ROUTINE PROCESSES INPUT HDR LABL 31480000
INTLR    DC    CL8' '                  ROUTINE PROCESSES INPUT TLR LABL 31500000
INREC    DC    CL8' '                  ROUTINE PROCESSES LOGICAL RECORD 31520000
*                                      BEFORE BEING PROCESSED           31540000
OUTREC   DC    CL8' '                  ROUTINE PROCESSES LOGICAL RECORD 31560000
*                                      BEFORE BEING OUTPUTED            31580000
EXLEN    EQU   32                      LENGTH OF EXIT ROUTINE NAMES     31600000
*                                                                       31620000
*          COUNTERS                                                     31640000
*                                                                       31660000
CURSKIP  DC    H'0'                    SKIP RECORD COUNTER              31680000
CURSTRT  DC    H'0'                    NBR. OF REC. ALR. SKIPPED A45135 31690021
CURSTOP  DC    H'0'                    STOP RECORD COUNTER              31700000
LINECT   DC    H'0'                    OUTPUT LINE COUNTER              31720000
LINEINCR DC    H'1'                    LINE INCREMENT - MODIFIED        31740000
CDNOB    DC    F'0'                                                     31760000
PPRETCDE DC    X'0'                    USER RETURN CODE                 31780000
CONVSW   DC    X'01'                   CONVERSION SWITCH -- 1 = HE      31800000
*                                      3 = PZ                           31820000
*                                                                       31840000
*          A S A  CONTROL CHARACTERS FOR                                31860000
*            OUTPUT BUFFER - MUST BE POSITIONED AS IS                   31880000
*                                                                       31900000
         DC    C'0'                    DOUBLE SPACE BEFORE PRINTING     31920000
SPTRIPLE DC    C'-'                    TRIPLE SPACE BEFORE PRINTING     31940000
         DC    C'V'                    SELECT PUNCH POCKET 1            31960000
STACK2   DC    C'W'                    SELECT PUNCH POCKET 2            31980000
*                                                                       32000000
*          SKIP OR STOP SWITCH                                          32020000
*                                                                       32040000
SKIP     EQU   X'01'                                                    32060000
STOP     EQU   X'02'                                                    32080000
INSW     DC    X'0'                    1 - SKIP, 2 - STOP               32100000
*                                                                       32120000
INBUFF   DS    F                       ADDRESS OF INPUT BUFFER          32140000
DIRBUFF  EQU   INBUFF                  DIRECTORY INPUT AREA             32160000
SAVEADD  DS    18F                     MODULE SAVE AREA                 32180000
MEMBCT   DC    H'0'                    PDS MEMBER COUNT                 32200000
GRCT     DC    H'0'                    RECORD GROUP COUNT               32220000
ALIASCT  DC    H'0'                    NO. OF ALIASES FOR CURRENT MEMB. 32240000
*                                                                       32260000
GCBL     EQU   8                       LENGTH OF GROUP CONTROL BLOCK    32280000
GCBIDLEN EQU   2                                                        32300000
GCBIDLIT EQU   4                                                        32320000
GCBIDLOC EQU   6                                                        32340000
FCBLEN   EQU   PH8                     LENGTH OF FIELD CONTROL BLOCK    32360000
GCBLEN   EQU   PH8                     LENGTH OF GROUP CONTROL BLOCK    32380000
TCBL     EQU   8                       LENGTH OF TITLE CONTROL BLOCK    32400000
LISTLEN  EQU   PH12                    LENGTH OF EACH ENTRY IN DIRBUFF  32420000
LISTL    EQU   12                                                       32440000
ABITL    EQU   11                      LOCATION OF ALIAS BIT            32460000
DIRBLKL  EQU   264                                                      32480000
*                                                                       32500000
OUTBADD  DC    A(OUTBUFF1)             ADDRESS OF OUTPUT BUFFER         32520000
DIRADD   DS    A                       PTR TO ANY MEMBER NAMES          32540000
DTABPTR  DC    F'0'                    PTR TO DTABLE                    32560000
VZZPR    DC    V(ZZPR)                       ADDR OF MSG RTN       7715 32566019
MSGSYNDF DC    CL96'IEB421I I/O ERROR'       SYNAD I/O ERROR MSG   7715 32572019
*                                                                       32580000
*          BLDL LIST                                                    32600000
*                                                                       32620000
BLDLADD  DS    0F                      AREA USED FOR BLDL MACRO         32640000
         DC    H'01'                   NUMBER OF ENTRIES IN LIST        32660000
         DC    H'76'                   LENGTH OF ENTRY IN LIST          32680000
BLDENTRY DS    8X                      NAME OF MEMBER TO FIND           32700000
BLDTTR   DS    4X                      RELATIVE TRACK ADDRESS-RETURNED  32720000
         DS    1X                      FILLER BYTE - NOT USED           32740000
BLDC     DS    1X                      DESCRIBES USER DATA FIELD-RETURN 32760000
BLDUSER  DS    62X                     USER DATA IN DIRECTORY-RETURNED  32780000
*                                      MAXIMUM USER DATA SIZE - 62 BYTE 32800000
*                                      MAXIMUM DIRECTORY ENTRY-74 BYTES 32820000
*                                      MINIMUM DIRECTORY ENTRY-12 BYTES 32840000
*                                                                       32860000
PLEN     DC    H'0'                    REMAINING BYTES IN BLOCKED RECD  32880000
RECDLEN  DC    H'0'                    LENGTH OF CURRENT LOGICAL RECORD 32900000
RECDLOC  DC    F'0'                    LOCATION OF CURRENT LOGICAL RECD 32920000
FSLOC    DS    F'0'                    POINTER TO CURRENT INPUT RECORD  32940000
FSLEN    DS    H'0'                    REMAINING BYTES OF INPUT RECORD  32960000
*                                                                       32980000
*          STORAGE USED IN FLDCONV ROUTINE                              33000000
*                                                                       33020000
OUTSAV   DS    F                       OUTPUT LOCATION OF CURRENT FIELD 33040000
LOCSAV   DS    F                       INPUT LOCATION OF CURRENT FIELD  33060000
LENSAV   DS    H                       NUMBER OF BYTES TO CONVERT       33080000
MAXOUT   DC    H'120'                  MAXIMUM BYTES PER OUTPUT LINE    33100000
*                                                                       33120000
*          REGISTER EQUATES                                             33140000
*                                                                       33160000
R15      EQU   15                      USED TO TEST RETURN CODES        33180000
TEMP2    EQU   15                      TEMPORARY WORK REIGSTER          33200000
R14      EQU   14                      USED IN CONVERSION ROUTINE       33220000
TEMP1    EQU   14                      TEMPORARY WORK REGISTER          33240000
SKIPR    EQU   14                      RECORD SKIP COUNTER              33260000
R13      EQU   13                      PTR TO SAVE AREA                 33280000
R12      EQU   12                                                       33300000
MCBR     EQU   12                      PTR TO MEMBER NAME TABLE         33320000
R11      EQU   11                                                       33340000
BREG1    EQU   11                      RETURN REG FOR HANDLING TITLES   33360000
CTLREG   EQU   11                      POINTER TO OUTPUT CONTROL CHAR.  33380000
INLEN    EQU   11                      CONTAINS INPUT FIELD SIZE        33400000
R10      EQU   10                      WORK REG FOR UF10 ROUTINE        33420000
BASER2   EQU   10                      MODULE EXTRA BASE REGISTER       33440000
BASER    EQU   9                       MODULE BASE REGISTER             33460000
R8       EQU   8                                                        33480000
GCBR     EQU   8                       POINTER TO GROUP CONTROL BLOCK   33500000
CTR      EQU   8                       COUNTER FOR DIRECTORY ENTRIES    33520000
R7       EQU   7                       USED IN PREFORM ROUTINE          33540000
LISTR    EQU   7                       POINTS TO MEMBER NAMES           33560000
RLOC     EQU   7                       POINTS TO INPUT AREA             33580000
R6       EQU   6                       WORK REG IN PREFORM ROUTINE      33600000
BREG     EQU   6                       INTERNAL BAL RETURN REGISTER     33620000
HDRET    EQU   6                       INTERNAL BAL RETURN REGISTER     33640000
R5       EQU   5                       WORK REG IN PREFORM ROUTINE      33660000
MEMCT    EQU   5                       MEMBER COUNTER                   33680000
TCBR     EQU   5                       POINTS TO A TITLE CONTROL BLOCK  33700000
DCBREG   EQU   5                       POINTS TO A DCB                  33720000
ALIASR   EQU   5                       NUMBER OF ALIASES FOR THIS MEMB. 33740000
FCBR     EQU   5                       PTR TO FIELD CONTROL BLOCK       33760000
R4       EQU   4                       WORK REG IN PREFORM ROUTINE      33780000
LEN      EQU   4                       LENGTH OF TITLE                  33800000
RLEN     EQU   4                       INPUT BLOCK LENGTH               33820000
R3       EQU   3                       USED IN PREFORM ROUTINE          33840000
FLDCT    EQU   3                       NUMBER OF FIELDS                 33860000
RLIT     EQU   3                       ADDRESS OF LITERAL POOL          33880000
LISTCT   EQU   3                       MEMBER SORT COUNTER              33900000
R2       EQU   2                       WORK REG FOR PREFORM ROUTINE     33920000
ROUT     EQU   2                       POINTS TO OUTPUT AREA            33940000
OUTLOC   EQU   2                       POINTS TO OUTPUT AREA            33960000
R1       EQU   1                       WORK REGISTER                    33980000
R0       EQU   0                       WORK REGISTER                    34000000
*                                                                       34020000
*          CODES FOR MESSAGE WRITER                                     34040000
*                                                                       34060000
BLKSZMIS EQU   6                                                        34080000
EODMSG   EQU   11                                                       34100000
EOJUSM   EQU   12                                                       34120000
IOMSG    EQU   13                                                       34140000
IDMSG    EQU   14                                                       34160000
STPMSG   EQU   15                                                       34180000
*                                                                       34200000
PMSGWRTA DC    V(PPMSGWRT)                                              34220000
MNMSGA   DC    V(PPMNMSG)                                               34240000
DDSWITCH DC    X'00'                   ERROR FREEMAIN SWITCH            34260000
         EXTRN DDERROR1                                                 34280000
VMSG     DC    A(DDERROR1)             ADDRESS OF MESSAGE IN IEBPPMSG - 34300000
*                                      'DDNAME --- CANNOT BE OPENED'    34320000
         EXTRN RCERROR                                             UL0H 34326017
RCMSG    DC    A(RCERROR)                                          UL0H 34332017
         EJECT                                                          34340000
         EJECT                                                          34620000
*                                                                       34640000
*          INPUT DCB EXIT -                                             34660000
*            ENTERED AT OPEN TIME AFTER                                 34680000
*              THE JFCB HAS BEEN USED TO SUPPLY                         34700000
*                INFORMATION TO THE DCB                                 34720000
*                                                                       34740000
         USING IHADCB,DCBREG                                            34760000
DCBIN    ST    14,SYSSAVE               SAVE CTL PGM RETURN ADR    VS0H 34768017
         LA    DCBREG,INSET             LOAD BASE REG WITH DCBADR  VS0H 34776017
         TM    DCBRECFM,X'C0'     RECFM NOT U OR NOT DEF. ?      A48796 34778021
         BM    TSTRECF1           YES, SKIP DEF. ROUTINE         A48796 34780021
         OI    DCBRECFM,X'C0'     SET RECFM = U                  A48796 34782021
SETLDEF  MVC   DCBLRECL(2),DCBBLKSI SET LRECL = BLKSI            A48796 34782421
         B     TSTBLK1            BRANCH TO BLKSIZE TEST         A48796 34782821
TSTRECF1 TM    DCBRECFM,X'10'     BLOCKED RECORDS ?              A48796 34783221
         BO    TSTBLK1            YES, TEST BLKSI                A48796 34783621
         TM    DCBRECFM,X'80'     RECFM IS F                     A48796 34783721
         BO    SETLDEF            YES, SET LRECL = BLKSI         A48796 34783821
TSTBLK1  CLC   DCBBLKSI(2),=X'0000' BLKSI PRESENT ?              A48796 34783921
         BNE   TSTLREC1           YES, TEST LRECL PRESENCE       A48796 34788421
         OI    DCBBLKSI+1,X'0A'   SET BLKSI = 10                 A48796 34790421
SETDEF1  MVC   DCBLRECL(2),=X'0005' SET DEFAULT LRECL = 5        A48796 34792421
         OI    ERRDCB,X'80'       SET ERRBIT (MSG IEB412I )      A48796 34792821
         B     DCBINTST           TEST REST OF DCB VALUES        A48796 34792921
TSTLREC1 CLC   DCBLRECL(2),=X'0000' LRECL PRESENT ?              A48796 34798321
         BE    SETDEF1            NO, SET DEF. + ERR BIT         A48796 34800321
DCBINTST TM    DCBRECFM,X'48'          IS IT VRE                   VS0H 34803821
         BO    TSTDSORG                 RECFM  IS VARIABLE         VS0H 34809221
NOQSAM   MVC   KEYLEN+1(1),DCBKEYLE    SAVE KEY LENGTH FROM DCB    VS0H 34814621
         MVC   RECFM(1),DCBRECFM       SAVE RECORD FROMAT FROM DCB      34820000
         MVC   LRECL(2),DCBLRECL       SAVE LOGICAL RECORD LENGTH       34840000
         MVC   BLKLEN(2),DCBBLKSI      SAVE BLOCK SIZE                  34860000
         MVI   QSBRNOP+1,X'00'                                     VS0H 34870017
DCBDIR   TM    POSTOPEN+1,X'F0'         IS DIRECTPRY BEING READ    VS0H 34880017
         BZ    DCBRET                  YES -- RETURN TO CONTROL PROGRAM 34900000
         MVI   DCBKEYLE,X'00'          NO - ALTER DCB TO READ DIRECTORY 34920000
         MVI   DCBRECFM,X'81'                                           34940000
         LH    R1,PH256                LOAD 256 INTO REG 1              34960000
         STH   R1,DCBBLKSI             STORE SIZE OF DIRECT. IN BLKSIZE 34980000
*                                      RETURN TO CONTROL PROGRAM        35000000
         STH   R1,DCBLRECL         STORE IN LRECL FIELD          A48732 35005021
VRERET   L     R14,SYSSAVE                                         VS0H 35010017
DCBRET   RETURN                                                         35020000
TSTDSORG TM    TYPORG,3                                            VS0H 35020217
         BZ    TSTRECL                 NOT PDS                     VS0H 35020417
VREERR   MVC   MSGWS(4),VMSG18         ERROR- PDS SPECIFIED FOR VS 9059 35020719
         B     VRENG                                               VS0H 35021017
TSTRECL  MVI   QSBRNOP+1,X'F0'                                     VS0H 35021217
         MVI   RECFM,X'40'              SET REFCM=V IN WORK AREA   VS0H 35021417
         MVC   LRECL(2),DCBLRECL     SAV LRECL VAL.              A48796 35021621
         MVC   BLKLEN(2),DCBLRECL    SAVE BLKSI VAL.             A48796 35021821
         MVC   KEYLEN+1(1),DCBKEYLE                                VS0H 35022017
         B     PTCHONE                                             VS0H 35022317
VRQSAM   OI    AMSW,QSAM        INDICATE QSAM PROC. NEEDED     @YM04138 35022402
         B     VRERET             RETURN TO OPEN                 A48796 35022821
TSTPREFM TM    PREFORMT,X'81'                                      VS0H 35023621
         BM    VREPRFER                                            VS0H 35024021
VSKEYS   MVI   RECFM,X'C0'             SET RECFM=U IN WORK AREA    VS0H 35024421
         MVC   LRECL(2),DCBBLKSI  SAVE BLKSI VAL.                A48796 35024821
         MVC   BLKLEN(2),DCBBLKSI                                  VS0H 35025221
PHYSMSG  MVC   MSGWS(4),VMSG15         INFO- BLOCK PROCESSING      9059 35025621
         B     VRERET                                              VS0H 35026021
VREPRFER MVC   MSGWS(4),VMSG16         ERROR- PREFORM = A INVALID  9059 35026421
         B     VRENG                                               VS0H 35026821
CCTOLSTC MVC   LASTCCH,0(R1)            MOVE CC TO LASTCC          VS0H 35027221
         ST    R1,STARTIN                                          UL0H 35027621
         TM    PPSW1,1                                             VS0H 35028021
         BO    STCCTOIN                 STORE CC TO INTERCC        VS0H 35028421
         TM    PREFORMT,X'01'                                      VS0H 35028821
         BO    STPRSK                                              VS0H 35029221
         MVC   INTERCCH,=C' '                                      VS0H 35029621
         MVC   LASTCCH,=C' '                                       VS0H 35030021
PREVREWR EX    R12,MOVE                                            VS0H 35030421
         BAL   BREG,WRCH                                           VS0H 35030821
         LH    R6,PH1                                              VS0H 35031221
         SR    R12,R6                                              VS0H 35031621
         L     R2,STARTIN                                          VS0H 35032021
         AR    R2,R6                                               VS0H 35032421
         ST    R2,STARTIN                                          VS0H 35032821
NEXTPART LH    R6,SAVLRECL                                         VS0H 35033221
         CR    R12,R6                  COMPARE MAXOUT AND REST     0294 35033621
         BNL   FIX                     BRANCH IF MAXOUT NOT LESS   0506 35034021
         SR    R6,R12                  ELSE SUBTRACT ONE OUT REC   0294 35034421
FIX      SH    R6,PH1                  DECREMENT BY ONE            0506 35034821
         STH   R6,SAVLRECL             STORE REMAIDER OF IN.LRECL  VS0H 35035221
         L     R2,STARTIN              LOAD CURRENT POINTER        VS0H 35035621
         AR    R2,R12                  INCR. POINTER BY LINELENGTH VS0H 35036021
         AH    R2,PH1                                              VS0H 35036421
         ST    R2,STARTIN              STORE NEW POINTER           VS0H 35036821
         AH    R12,PH1       ADD ONE FOR TEST PURP.              A45135 35037221
         CR    R12,R6        COMP LINEL. AND REM INLRECL         A45135 35037621
         BNL   LASTOFRL      LINE LENGTH NOT LOW --BRANCH        A45135 35038021
         SH    R12,PH1       RESET R12 ON CORRECT VALUE          A45135 35038421
         MVC   PPCTL,INTERCCH          MOVE INTERM. CC TO OUTPUT   VS0H 35038821
         EX    R12,MOVEPART            MOVE DATA (OUTP.LNGTH-1)    VS0H 35039221
         BAL   BREG,WRCH               WRITE NEXT PART             VS0H 35039621
         B     NEXTPART                GET NEXT PART OF RECORD     VS0H 35040021
LASTOFRL BAL   BREG,BLANKOUT BLANK OUTPUT AREA                     VSOH 35040421
         MVC   PPCTL,LASTCCH MOVE STORED CC TO LAST OUT            VSOH 35040821
         LH    R12,SAVLRECL  MOVE LAST OF LOG. RECORD              VSOH 35041221
         CH    R12,PH2       WHEN SAVLRECL 1 OR LESS THAN        A38702 35041621
         BL    SKIPPUT       NO DATA HAS TO BE MOVED             A38702 35042021
         SH    R12,PH2       TWO SUBTR(1 FOR MVC,1 FOR ASA OR MC)  VSOH 35042421
         EX    R12,MOVEPART  MOVE IN OUTPUT BUFFER                 VSOH 35042821
         BAL   BREG,WRCH     PUT THE RECORD                        VSOH 35043221
SKIPPUT  TM    VSWITCH+1,X'F0' TEST VAR. SWITCH                  A38702 35043621
         BO    BIGONCE                                             VS0H 35044421
         TM    BLKDSWCH+1,X'F0'                                    VS0H 35044821
         BO    BIGONCE                                             VS0H 35045221
         B     RDCH                                                VS0H 35045621
STCCTOIN MVC   INTERCCH,0(R1)                                      VS0H 35046021
         B     PREVREWR                                            VS0H 35046421
STPRSK   MVC   INTERCCH,=X'09'                                     VS0H 35046821
         MVC   0(1,R1),=X'09'                                      VS0H 35047221
         B     PREVREWR                                            VS0H 35047621
SETBLKSW MVI   BLKDSWCH+1,X'F0'                                    VSOH 35048021
         B     BLKDLONG                                            VSOH 35048421
SETVSW   SR    R12,R5        RESET 12 TO LINE LENGTH               VSOH 35048821
         SH    R12,PH1                                           A38702 35049221
         SR    R1,R3                   DECR.REMAINING BLOCKLNGTH   VS0H 35049621
         STH   R1,BLCKREM    WITH CURRENT RECORD LENGTH          A38702 35050021
         SH    R3,PH4                  ADJUST RECD LNGTH FOR RDW   VS0H 35050421
         STH   R3,SAVLRECL             TO GET THE DATA LENGTH      VS0H 35050821
         L     R1,STARTIN                 SET POINTER TO           VS0H 35051221
         AH    R1,PH4                  TO FIRST DATA BYTE          VS0H 35051621
         ST    R1,STARTIN                                          VS0H 35052021
         MVI   VSWITCH+1,X'F0'                                     VS0H 35052421
         B     CCTOLSTC                                            VS0H 35052821
         DS    0F                                                  VS0H 35053621
SYSSAVE  DS    CL4                                                 VS0H 35054021
VRENG    MVI   PPHINEX,X'80'                                       VS0H 35054421
         MVI  PPTINEX,X'80'                                        VS0H 35054821
         MVI   DDDEX,X'80'    LABEL CHANGED BEC. OF AOS DSCB            35055221
         MVI   DCBEXSW,X'80'                                       VS0H 35055621
         B     VRERET                                              VS0H 35056021
OPENMSG  SR    R0,R0                                               VS0H 35056421
         SR    R1,R1                   CLEAR OUT MSG REGS          VS0H 35056821
         IC    R0,MSGWS                                            VS0H 35057221
         IC    R1,MSGWS+1                                          VS0H 35057621
         CLI   MSGWS+2,X'00'                                       VS0H 35058021
         BE    MSGONLY                                             VS0H 35058421
         MVI   DDSWITCH,X'01'                                      VS0H 35058821
         B     IOWRT                                               VS0H 35059221
         EJECT                                                          35059621
         EJECT                                                          35120000
*          O U T P U T    D C B                                         35140000
* REF A.LYONS TO MR. CAMMACK E.T. ( 1 MARCH 1971 )                      35150021
*  SUBJECT: DESIGN PROBLEMS WITH RELEASE 20 AND TSO                     35152021
OUTSET   DCB   DDNAME=SYSUT2,DSORG=PS,MACRF=(PM),RECFM=FBA,            C35154021
               SYNAD=SYNADMSG,EXLST=PPEXOUT                        7715 35160019
PPIHLEX  MVI   HDTRLSW,X'F0'           SET HEADER IND.             UL0H 35173017
         CLC   USEREX+1(3),UHIN+1      CURRENT EXIT IS HEADER      UL0H 35176017
         BE    PPILEX                                              UL0H 35180217
         MVC   USEREX(4),UHIN                                      UL0H 35180317
         CLI   PROCKY,X'40'                                        UL0H 35180417
         BE    PRNTSWOF                                            UL0H 35180517
         B     PPILEX                                              UL0H 35180617
PPITLEX  MVI   HDTRLSW,X'0F'           SET TRAILER IND.            UL0H 35180717
         CLC   USEREX+1(3),UTIN+1      CIRRENT EXIT IS TRAILER EXITUL0H 35180817
         BNE   RESTLPTR                                            UL0H 35180917
         B     PPILEX                                              UL0H 35181217
PRNTSWOF MVZ   ULEXSW+1(1),=X'F0'            "          OFF-BR     UL0H 35181617
PPILEX   LH    R15,PH4                                             UL0H 35181717
         ST    R14,SYSSAVE                                         UL0H 35181817
PPILEXA  LA    R6,LABELAST                                         UL0H 35181917
         CL    R6,LBLSVPTR                                         UL0H 35182017
         BL    SETBYPSS                TOO MANY LABELS, BYPASS     UL0H 35182117
         B     TSTPBIT                 TEST FOR VOL1,EOV,IOERR     UL0H 35182217
NOLBLTST L     R7,0(R1)                                            UL0H 35182417
         LTR   R7,R7                                               UL0H 35182517
         BZ    SETNORC                                             UL0H 35182617
         L     R6,ULABIN                                           UL0H 35182717
         AH    R6,PH1                                              UL0H 35182817
         ST    R6,ULABIN                                           UL0H 35182917
         CLI   BYPLASW,X'F0'                                       UL0H 35183017
         BE    ADDBYPSD                                            UL0H 35183117
STORELBL L     R6,LBLSVPTR                                         UL0H 35183217
         MVC   0(80,R6),0(R7)           STORE LABEL                UL0H 35183317
         AH    R6,LABLINC               ADD 80 POSNS TO LBLSVPTR   UL0H 35183417
         ST    R6,LBLSVPTR                                         UL0H 35183517
TSTULSW  TM    USEREX,X'FF'                                        UL0H 35183617
         BZ    GOTOSYST                                            UL0H 35183717
         L     R5,USERTNCT                                         UL0H 35183817
         AH    R5,PH1                                              UL0H 35183917
         ST    R5,USERTNCT                                         UL0H 35184017
         L     R15,USEREX                                          UL0H 35184117
         BALR  R14,R15                                             UL0H 35184217
         B     TSTUSRC                                             UL0H 35184317
SETNORC  MVZ   NORCSW+1(1),=X'F0'                                  UL0H 35184417
         B     TSTULSW                                             UL0H 35184517
GOTOSYST L     R14,SYSSAVE             RETURN CONTROL TO SYSTEM    UL0H 35184717
         BR    R14                                                 UL0H 35184817
SETIOERR MVI   IOSW+1,X'F0'                                        UL0H 35185517
         B     NOLBLTST                                            UL0H 35185617
TSTUSRC  CH    R15,=X'0010'             TEST USER RC=16            UL0H 35185717
         BE    SETUSTRM                                            UL0H 35185817
         CH    R15,=X'0000'                                        UL0H 35185917
         BE    SETULPSF                                            UL0H 35186017
         CH    R15,=X'0004'                                        UL0H 35186117
         BE    GOTOSYST                                            UL0H 35186217
         TM    NORCSW+1,X'F0'                                      UL0H 35186317
         BO    GOTOSYST                NO RET. CODE EXPECTED       UL0H 35186417
         B     USERCERR                                            UL0H 35186517
SETUSTRM MVI   USEREX,X'00'             SET ULBLPROCSW OFF         UL0H 35186617
         MVZ   USRTRMSW,=X'F0'          SET TERMSW ON              UL0H 35186717
         B     GOTOSYST                                            UL0H 35186817
ADDBYPSD L     R5,BYPASSED                                         UL0H 35186917
         AH    R5,PH1                                              UL0H 35187017
         ST    R5,BYPASSED                                         UL0H 35187117
         B     GOTOSYST                                            UL0H 35187217
SETULPSF MVI   USEREX,X'00'             SET USER LBL PROC OFF      UL0H 35187317
         CLI   PROCKY,X'80'                                        UL0H 35187417
         BE    SETBYPSS                                            UL0H 35187517
         B     GOTOSYST                                            UL0H 35187617
SETBYPSS MVI   BYPLASW,X'F0'                                       UL0H 35187717
         B     GOTOSYST                                            UL0H 35187817
USERCERR L     R5,RCMSG                                            UL0H 35187917
         AH    R15,NUMZON              ADD HEX F0 FOR DISPLAY      UL0H 35188017
         STC   R15,19(R5)                                          UL0H 35188117
         SH    R15,NUMZON              REMOVE ZONE FOR PROCESSING  UL0H 35188217
         MVC   MSGWS,=X'151D0C00'                                  UL0H 35188317
         B     SETUSTRM                                            UL0H 35188417
CONVLBLS L     RLOC,LBLSVPTR                                       UL0H 35188817
         LA    INLEN,40                                            UL0H 35188917
         MVC   CONVSAV,CONVSW                                      UL0H 35189017
         MVC   CONVSW,LBLCONSW                                     UL0H 35189117
         BAL   BREG,FLDCONVL                                       UL0H 35189217
         BAL   BREG,WRCH                                           UL0H 35189317
         L     R5,LBLSVPTR                                         UL0H 35189417
         AH    R5,=X'0028'                                         UL0H 35189517
         ST    R5,LBLSVPTR                                         UL0H 35189617
         C     R5,PRNTLIM                                          UL0H 35189717
         BE    RELCONV                 RESTORE CONVSW FOR DATA     UL0H 35189817
         B     CONVLBLS                                            UL0H 35189917
         DS    0F                                                  UL0H 35190017
LABLINC  DC    X'0050'                                             UL0H 35190117
USRTRMSW DC    X'00'                                               UL0H 35190217
         DS    0D                                                  UL0H 35190317
LBELSAVE DS    0CL640                                              UL0H 35190417
LABEL1   DS    CL80                                                UL0H 35190517
LABELINT DS    CL480                                               UL0H 35190617
LABELAST DS    CL80                                                UL0H 35190717
LBLSVPTR DC    A(LBELSAVE)                                         UL0H 35190817
PRNTLIM  DC    X'00000000'                                         UL0H 35190917
BYPLASW  DC    X'00'                                               UL0H 35193317
ERRDCB   DC    X'00'         OPEN ERROR BIT                      A45135 35193721
         DS    0H                                                  UL0H 35194017
NUMZON   DC    X'00F0'                                             UL0H 35194717
BSAMSPEC DC    X'2400'                                             VS0H 35195417
QSAMSPEC DC    X'5000'                                         @YM04138 35195802
AMSW     DC    X'00'            QSAM OR BSAM PROC INDICATOR    @YM04138 35196202
QSAM     EQU   X'80'            QSAM PROC. NEEDED              @YM04138 35196302
HDTRLSW  DC    X'00'                                               UL0H 35196417
PAGEBYT  DC    X'00'         ZERO WHEN NO PAGE NBR TO BE WRITTEN A45134 35196521
VMSG15   DC    XL4'0F1A0000'           INFO MSG IEB415I            9059 35196619
VMSG16   DC    XL4'101B0C00'           ERROR MSG IEB416I           9059 35196819
VMSG18   DC    XL4'121C0C00'           ERROR MSG  IEB418I          9059 35197019
TEMPSAVE DC    F'0'                    SAVE BRANCH REGISTER        9305 35197219
NOPLBLPR B     CLOSEOUT                                            UL0H 35197417
VSWITCH  DC    XL2'0'                                              VS0H 35198217
BLKDSWCH DC    XL2'0'                                              VS0H 35198417
ULEXSW   DC    XL2'0'                                              UL0H 35198617
IOSW     DC    XL2'0'                                              UL0H 35198817
QSSW     DC    XL2'0'                                              VS0H 35199017
QSBRNOP  DC    XL2'0'                                              VS0H 35199217
NORCSW   DC    XL2'0'                                              UL0H 35199417
MCBRWS   DC    F'0'                                                VS0H 35199617
MSGWS    DC    XL4'0'                                              VS0H 35199817
         EJECT                                                          35200000
*                                                                       35220000
*          DUMMY DCB DSECT                                              35240000
*                                                                       35260000
         DCBD  DSORG=PO                                                 35280000
         EJECT                                                          35300000
*                                                                       35320000
*          GET DISPLACEMENT OF DCB AREAS                                35340000
*                                                                       35360000
DDNAM    EQU   DCBDDNAM-IHADCB         DDNAME FOR DCB                   35380000
BLKSI    EQU   DCBBLKSI-IHADCB         BLOCK SIZE OF DATA               35400000
DSORG    EQU   DCBDSORG-IHADCB         DATA SET ORGANIZATION            35420000
RECL     EQU   DCBLRECL-IHADCB         LOGICAL RECORD LENGTH OF DATA    35440000
OFLGS    EQU   DCBOFLGS-IHADCB         OPEN FLAGS                       35460000
DEVT     EQU   DCBDEVT-IHADCB          DEVICE TYPE                      35480000
RECINFM  EQU   DCBRECFM-IHADCB         RECORD FORM                 VS0H 35484017
BSAMACRF EQU   DCBMACR-IHADCB                                      VS0H 35488017
*                                      BE ALTERED TO QSAM          VS0H 35492017
*                                      FOR VRE RECORDS             VS0H 35496017
*                                                                       35500000
*          DTABLE DSECT                                                 35520000
*                                                                       35540000
DTABLE   DSECT                                                          35560000
DDN1     DS    CL8                     SYSUT1 DDNAME - INPUT            35580000
DDN2     DS    CL8                     SYSUT2 DDNAME - OUTPUT           35600000
DEXLSTA  DS    A                       ADDRESS OF EXIT LIST             35620000
DTBLE    DS    0X                      BEGINING OF 'TABLE' AREA         35640000
DLITA    DS    A                       ADDRESS OF USER LITERAL POOL     35660000
DMNTA    DS    A                       MEMBER NAME TABLE ADDRESS        35680000
DRCB     DS    0X                      16 BYTES OF SWITCHES DESCRIBED   35700000
         DS    20X                                                      35720000
DTCB     DS    0X                      TITLE CONTROL BLOCKS FOR TITLE   35740000
         DS    16X                     AND SUBTITLE DESCRIBED AT TCB    35760000
*                                                                       35780000
IEBPPCH1 CSECT                                                          38780017
TSTPBIT  TM    8(R1),X'80'                                         UL0H 38880017
         BO    SETIOERR                                            UL0H 38980017
         CLI   HDTRLSW,X'0F'           TRAILER IND.                UL0H 39010017
         BE    TSTPBIT1                 YES - BRANCH               UL0H 39040017
         TM    OPENSW,X'10'            IS THIS VOL 1 HDR LABEL     UL0H 39080017
         BO    NOLBLTST                YES,RETURN TO UL PROCESS    UL0H 39180017
         B     TSTULSW                 DO NOT STORE LABEL          UL0H 39240017
TSTPBIT1 TM    4(R1),X'80'             INTERMEDIATE TRAILER        UL0H 39300017
         BO   NOLBLTST                 NO, EOF REACH.,STORE LAB. A45135 39390021
         B     TSTULSW                 DO NOT STORE THE LABEL      UL0H 39480017
LASTCCH  DS    CL1                                                 VS0H 39780017
INTERCCH DS    CL1                                                 VS0H 40780017
MSGONLY  SLL   R1,8                                                VS0H 41780017
         AR    R1,R0                                               VS0H 44780017
         MVI   PPRETCDE,X'00'                                      VS0H 47780017
         L     R15,PMSGWRTA                                        VS0H 50780017
         LA    R14,TESTOPEN                                    @ZA03383 53780003
         BR    R15                                                 VS0H 56780017
RESTLPTR MVC   LBLSVPTR,LABEL1AD                                   UL0H 59780017
         MVC   USEREX(4),UTIN                                      UL0H 62780017
         CLI   PROCKY,X'10'                                        UL0H 65780017
         BE    PRNTSWOF                                            UL0H 68780017
         B     PPILEX                                              UL0H 71780017
ONLYIHL  MVI   DDSWITCH,X'01'                                      UL0H 74780017
         MVC   INTLRPRT,NOPLBLPR                                   UL0H 77780017
         B     CLOSEIO                                             UL0H 80780017
PPEXOUT  DS    0F                      OUTPUT DCB EXIT             VS0H 80980017
DCBOUT   DC    X'85'                   WHEN SYSUT2 NOT = SYSPRINT  VS0H 81180017
         DC    AL3(SETOPBLK)                                       VS0H 81380017
         USING IHADCB,DCBREG                                       VS0H 81580017
SETOPBLK ST    R14,SYSSAVE                                         VS0H 81780017
         LA    DCBREG,OUTSET                                       VS0H 81980017
         CLC   DCBLRECL,=X'0000'  IS LRECL EQ ZERO ?             A38762 82180021
         BE    TESTBLK       YES,                                A38762 82230021
         CLC   DCBBLKSI,=X'0000'  IS BLKSI EQ ZERO ?             A38762 82280021
         BE    FILLREC            YES, TAKE LRECL AS BLKSI       A38762 82330021
         ST    DCBREG,DCBSAVE                                    A38762 82380021
         SR    R4,R4                   TEST                      A38762 82430021
         LH    R6,DCBLRECL             BLKSIZE                   A38762 82440021
         LH    R5,DCBBLKSI             MULTIPLE                  A38762 82450021
         DR    R4,R6                   OF                        A38762 82460021
         LTR   R4,R4                   LRECL                     A38762 82510021
         L     DCBREG,DCBSAVE          RELOAD DCB ADDRESS        A45135 82530021
         BZ    OUTBLKOK                YES, RETURN               A45135 82532021
         MVC   DCBBLKSI(2),DCBLRECL    MOVE LRECL IN BLKSI FLD   A38762 82540021
         B     OUTBLKOK                RETURN                    A38762 82590021
TESTBLK  CLC   DCBBLKSI,=X'0000'       IS BLKSI EQ ZERO ?        A38762 82600021
         BE    TESTPRPU                YES, TEST PRINT OR PUNCH  A38762 82610021
         MVC   DCBLRECL(2),DCBBLKSI    ELSE MOVE BLK IN LR FLD   A38762 82620021
         B     OUTBLKOK                RETURN                    A38762 82670021
FILLREC     MVC DCBBLKSI(2),DCBLRECL   MOVE LRECL IN BLKSI FLD   A38762 82680021
         B     OUTBLKOK                RETURN                    A38762 82690021
TESTPRPU TM    PPSW1,1                 PRINT COMMAND ?           A38762 82700021
         BZ    PRINTR                  YES                       A38762 82750021
         MVC   DCBBLKSI(2),EIGHTY1     SET DEF VALUE OF 81      OY01168 82760016
         MVC   DCBLRECL(2),EIGHTY1     SET DEF VALUE OF 81      OY01168 82770016
         B     OUTBLKOK           RETURN                         A38762 82772021
PRINTR   MVC   DCBBLKSI,=X'0079'  TAKE BLKSI = 121               A38762 82774021
         MVC   DCBLRECL,=X'0079'  TAKE LRECL = 121               A38762 82776021
OUTBLKOK L     R14,SYSSAVE                                         VS0H 82780017
         CLC   DCBLRECL(2),ONE45       LRECL PARAM GR THAN 145? OY01168 82790016
         BH    ERROUT                  YES, SET ERROR BIT        A45135 82800021
         CLC   DCBLRECL(2),EIGHTY1     IS LRECL LARGER THAN 81? OY01168 82830016
         BCR   11,R14                  YES, RETURN TO OPEN       A45135 82880021
         CLI   PPSW1,X'03'             SHOULD CARDS BE SEQ ?     A45135 82930021
         BE    TESTPRPU                YES, SET DEF.: LR=BLK=81  A45135 82940021
         CLC   DCBLRECL(2),PH1         LRECL EQUAL 1 ?          OY01168 82950016
         BE    ERROUT                  YES,ERR. NO PR OR PU POSS.A45135 82960021
         CLC   DCBLRECL(2),=H'11'      LRECL LESS THAN 11  ?     A45134 82970021
         BNL   *+8                     NO, SKIP PAGE BYTE        A45134 82972021
         MVI   PAGEBYT,X'F0'           YES, SET PAGE BYTE        A45134 82974021
         BR    R14                                                 VS0H 82980017
ERROUT   OI    ERRDCB,X'80'            SET LRECL PARAM ERROR BIT A45135 83030021
         BR    14                      RETURN TO OPEN            A45135 83080021
RELCONV  MVC   CONVSW,CONVSAV                                      UL0H 83180017
         B     LBLPRNTX                                            UL0H 83187017
         USING IHADCB,R8                                           VS0H 83190017
BLKDLONG LH    R4,DCBLRECL                                         VS0H 83194017
         L     R1,STARTIN                                          VS0H 83201017
PREVRBA2 STH   R4,SAVLRECL                                         VS0H 83210017
         CLI   QSBRNOP+1,X'F0'         IS IT QSAM ACCESS           VS0H 83240017
         BNE   CCTOLSTC                                            VS0H 83270017
         AH    R1,PH4                                              VS0H 83300017
         B     CCTOLSTC                                            VS0H 83330017
PREVRBA1 AH    R4,PH1                                              VS0H 83350017
         B     PREVRBA2                                            VS0H 83370017
BIGONCE  L     R2,STARTIN                  ADJUST POINTER TO       VSOH 83400017
         AH    R12,PH1                       RDW OF                VSOH 83470017
         AR    R2,R12                         NEXT                 VS0H 83540017
         ST    R2,STARTIN                     RECORD               VS0H 83610017
         LH    R12,MAXOUT                                          VS0H 83620017
         TM    BLKDSWCH+1,X'F0'                                    VS0H 83640017
         BO    THRUONCE                                            VS0H 83650017
         B     ONCE                                                VS0H 83680017
LABEL1AD DC    A(LABEL1)                                           UL0H 83780017
         LTORG         ,           ALIGN IMM OPERANDS           OY01168 84380016
*          I N P U T    D C B                                   OY01168 84980016
INSET    DCB   DDNAME=SYSUT1,DSORG=PS,MACRF=GM,EODAD=SDSEOD,    OY01168X85580016
               EXLST=PPEXIN,SYNAD=SYNADMSG                      OY01168 86180016
         END   IEBPPCH1                                                 86780017
./  ADD  SSI=31230662,NAME=IEBPPMSG
     TITLE 'IEBPPMSG-IEBPTPCH MESSAGE MODULE'                           00020014
*****   *****   *****   *****   *******   *****   *****   *****   ***** 00040000
*                                                                       00060000
* IEBPPMSG IS THE ERROR MESSAGE MODULE OF PRINT/PUNCH                   00080000
*                                                                       00100000
* EACH MESSAGE IS 32 BYTES IN LENGTH. THUS, IT IS CONVENIENT TO         00120000
* INCREMENT TO THE PROPER MESSAGE.                                      00140000
* THE MESSAGE CODE NO. HAS NO RELATIONSHIP TO THE DISPLACEMENT NO.      00160017
*                                                                       00180000
*        ENTRY POINT     IEBPPMSG                                       00200000
*                                                                       00220000
*        INPUT           NOT APPLICABLE                                 00240000
*                                                                       00260000
*        OUTPUT          NOT APPLICABLE                                 00280000
*                                                                       00300000
*        EXTERNAL RTNS   NOT APPLICABLE                                 00320000
*                                                                       00340000
*        EXITS           NOT APPLICABLE                                 00360000
*                                                                       00380000
*        WORK AREAS      NOT APPLICABLE                                 00400000
*                                                                       00420000
*        ATTRIBUTES      NON EXECUTABLE                                 00440000
*                                                                       00460000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 00480000
IEBPPMSG CSECT                                                          00500000
*3392,3416                                                       A21407 00510018
*C007400                                                         A45135 00512021
*C010950                                                         A48732 00516021
*                                                                       00520000
*        MESSAGES                                                       00540000
         ENTRY RCERROR                                             UL0H 00550017
         ENTRY MAXMSGS                                                  00570014
         ENTRY DDERROR1                                                 00580000
PPMSGES  DS    0X                                                       00600000
PHDR     DC    CL32'PRINT/PUNCH DATA SET UTILITY'                       00620000
PTERM1   DC    CL32'PRINT/PUNCH STATEMENT NOT FIRST'                    00640000
PTERM2   DC    CL32'INVALID OPERATION JOB TERMINATED'                   00660000
PTMULT   DC    CL32'MORE THAN TWO TITLE CARDS'                          00680000
PKEY     DC    CL32'KEYWORD INVALID OR OMITTED'                         00700000
PPAR     DC    CL32'PARAMETER INVALID OR OMITTED'                       00720000
PDCERR   DC    CL32'INVALID INP/OUTP DCB PARAMETER'              A45135 00740021
PMEMBNO  DC    CL32'OMIT THIS MEMBER'                                   00760000
*        'PSF' NO LONGER USED                                           00780000
PSF      DC    CL32'USE STANDARD FORMAT'                                00800000
PSPACE   DC    CL32'INVALID SPACE ALLOCATION'                           00820000
PEOF     DC    CL32'EOF ON SYSIN'                                       00840000
PEOD     DC    CL32'END OF DATA FOR SDS OR MEMBER'                      00860000
PEOJEX   DC    CL32'JOB TERMINATED AFTER USER EXIT'                     00880000
PEOJIO   DC    CL32'JOB TERMINATED DUE TO I/O ERROR'                    00900000
PEOJID   DC    CL32'LAST RECORD GROUP WRITTEN'                          00920000
PEOJSTOP DC    CL32'REQUESTED RECORDS WRITTEN'                          00940000
PUSERERR DC    CL32'INVALID USER PARAMETERS'                            00960000
PBLDNO   DC    C'MEMBER           CANNOT BE FOUND'                      00980000
PINVAL   DC    CL32'INVALID INVOCATION PARAMETER'                       01000000
PCDERR   DC    CL32'INVALID CONTROL STATEMENT'                          01020000
         DC    CL32'INCORRECT RECORD STATEMENT'                         01040000
DDERROR1 DC    CL32'DDNAME          CANNOT BE OPENED'                   01060000
MGRTR    DC    CL32'    '                                               01070017
MAXMSGS  DC    CL32'         PARAMETER IS TOO SMALL'               1769 01085014
         DC    CL32' '                                             1244 01090014
PEMPTY   DC    CL32'DATA SET EMPTY, RETURN CODE IS 4'            A48732 01095021
*                                                                       01100000
         DC    CL32'VS/VBS DATA PROCESSED IN BLOCKS'               VS0H 01104017
         DC    CL32'PREFORM,VS LRECL LARGER THAN 32K'              VS0H 01108017
PDSVSERR DC    CL32'VS/VBS NOT ALLOWED IN PDS'                     VS0H 01112017
RCERROR  DC    CL32' USERS RETURN CODE X INVALID'                  UL0H 01115017
IOLABER  DC    CL32'USER LABEL IO ERROR CAUSED TERM'               UL0H 01118017
PPIKM    DC    CL32'       INVALID KEYWORD IN COL   '              SA0I 06118018
PPIPM    DC    CL32'     INVALID PARAMETER IN COL   '              SA0I 11118018
PPMKM    DC    CL32'   MISSING KEYWORD BEFORE COL   '              SA0I 16118018
PPMPM    DC    CL32' MISSING PARAMETER BEFORE COL   '              SA0I 21118018
PPMCM    DC    CL32'MISSING COMMAND PRECEDING COL   '              SA0I 26118018
PPICM    DC    CL32'INVALID COMMAND'                               SA0I 31118018
PPILM    DC    CL32'INVALID ITEM PARAMETER'                     OY01168 36118016
PPINM    DC    CL32'INVALID NAME'                                  SA0I 41118018
PPBCM    DC    CL32'CONTINUATION NOT STARTED IN 4-16'              SA0I 46118018
         DC    CL32'MISSING PARENTHESIS'                           SA0I 51118018
         DC    CL32'MEMBER INVALID-TYPORG NOT PO'                  SA0I 56118018
NOSYSIN  DC    CL32'SYSIN IS EMPTY'                              A21407 58118018
         ENTRY PPMSGES                                                  61118018
         ENTRY PPIKM                                               SA0I 66118018
         ENTRY PPIPM                                               SA0I 71118018
         ENTRY PPMKM                                               SA0I 76118018
         ENTRY PPMPM                                               SA0I 81118018
         ENTRY PPMCM                                               SA0I 86118018
         END   IEBPPMSG                                                 91118018
./  ADD  SSI=62880141,NAME=IEBPPUN1
         TITLE 'IEBPPUN109--ROOT SEGMENT OF IEBPTPCH'                   00020000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 00040000
*                                                                     * 00060000
* IEBPPUN1     ROOT SEGMENT OF PRINT/PUNCH                              00080000
*                                                                       00100000
* THE PRINT-PUNCH PROGRAM IS BROKEN DOWN INTO FIVE MODULES WHICH IN     00120000
* TURN ARE PUT IN AN OVERLAY STRUCTURE. THE ROOT SEGMENT IS MADE UP OF  00140000
* TWO MODULES: IEBPPUN1,WHICH GETS INITIAL CONTROL; AND IEBPPMSG, WHICH 00160000
* IS THE ERROR MESSAGE MODULE. ONE LEG OF THE OVERLAY TREE IS MADE UP   00180000
* OF TWO MODULES: IEBPPALI, WHICH IS THE CONTROL CARD ANALYSER ROUTINE; 00200000
* AND IEBCCS02, WHICH IS THE CONTROL CARD SCAN ROUTINE. THE OTHER LEG   00220000
* OF THE OVERLAY TREE IS THE MAIN PROCESSING MODULE IEBPPCH1.           00240000
*                                                                       00260000
* IEBPPUN1                                                              00280000
*                                                                       00300000
* THIS MODULE GETS INITIAL CONTROL, AND THEREFORE DOES ALL THE INVOKER  00320000
* CHECKING. IF THE PROGRAM IS INVOKED, THIS MODULE DIAGNOSES THE THREE  00340000
* POSSIBLE PARAMETER LISTS THAT CAN BE PASSED. THEN THIS MODULE CALLS   00360000
* THE CONTROL CARD SCAN ROUTINE WHICH IN CONJUNCTION WITH THE CONTROL   00380000
* CARD ANALYSER PROCESSES THE CONTROL STATEMENTS FOR PRINT/PUNCH.       00400000
* RETURN COMES TO IEBPPUN1 WHICH IN TURN CALLS THE MAIN PROCESSING      00420000
* MODULE OF PRINT PUNCH. THE FINAL RETURN TO THE SCHEDULER IS DONE FROM 00440000
* THIS MODULE. IEBPPUN1 CONTAINS ALL SYSPRINT INFORMATION AND PROVIDES  00460000
* FOR WRITING ALL ERROR MESSAGES. THIS MESSAGE WRITER ALSO INCLUDES THE 00480000
* FACILITIES TO PRINT A HEADER ON EACH PAGE WITH ASCENDING PAGE         00500000
* NUMBERS. TO USE THIS MESSAGE WRITER, THE FOLLOWING LINKAGE CONVENTION 00520000
* MUST BE FOLLOWED.                                                     00540000
* REGISTER 0 MUST CONTAIN THE LENGTH OF THE MESSAGE.                    00560000
* REGISTER 1 MUST CONTAIN THE ADDRESS OF THE MESSAGE.                   00580000
* BAL 14,ZZPR MUST BE USED TO LINK TO ZZPR WHICH IS THE NAME OF THE     00600000
* MESSAGE WRITER ROUTINE.                                               00620000
* THIS MODULE ALSO CONTAINS A DUMMY DCB AND THE DCB FOR SYSPRINT.       00640000
*                                                                       00660000
*                                                                       00680000
*        ENTRY POINT     IEBPTPCH                                       00700000
*                                                                       00720000
*        INPUT           IF INVOKED, THIS MODULE WILL SET UP THE        00740000
*                        DDLIST AND SET THE APPROPRIATE SWITCHES.       00760000
*                                                                       00780000
*        OUTPUT          ALL DIAGNOSTICS AND INFORMATIONAL MESSAGES     00800000
*                        ARE PRINTED.                                   00820000
*                                                                       00840000
*        EXTERNAL RTNS   THIS MODULE CALLS THE CONTROL CARD ANALYSER    00860000
*                        MODULE AND THE MAIN PROCESSOR MODULE.          00880000
*                                                                       00900000
*        EXITS           THIS MODULE DOES A FINAL RETURN AT EOJ.        00920000
*                                                                       00940000
*        WORK AREAS      THIS MODULE OBTAINS CORE FOR AN INFORMATION    00960000
*                        TABLE TO BE SET UP BY THE ANALYSER AND USED BY 00980000
*                        THE MAIN PROCESSOR.                            01000000
*                                                                       01020000
*        ATTRIBUTES      NON-REUSABLE                                   01040000
*                                                                       01060000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 01080000
         EJECT                                                          01100000
IEBPTPCH CSECT                                                          01120000
*0118088800-091000,091600,094000,095600-095800                     BS0H 01130017
*037000,054600                                                    24304 01131019
*093000                                                           29476 01132019
*094920-094950,095800                                             27715 01135019
*A030300                                                         A38794 01137421
*C031200,032000,066200                                           A38794 01137821
*D030400,030600,030800                                           A38794 01138221
*A041760-041780,041900                                           A41816 01139021
*D041760                                                         A41816 01139521
*C041706                                                        OY01168 01139716
*C078600-079000,079800,086000,093600                           @ZA07383 01139899
*D085000,085200                                                @ZA07383 01139999
         ENTRY PRPCH                                                    01140000
*                                                                       01160000
R0       EQU   0                                                        01180000
RZ       EQU   0                                                        01200000
R1       EQU   1                                                        01220000
R2       EQU   2                                                        01240000
R3       EQU   3                                                        01260000
R4       EQU   4                                                        01280000
DCBREG   EQU   5                                                        01300000
RLEN     EQU   7                                                        01320000
R8       EQU   8                                                   BS0H 01330017
BASER    EQU   9                                                        01340000
R13      EQU   13                                                       01360000
R14      EQU   14                                                       01380000
R15      EQU   15                                                       01400000
*                                                                       01420000
DDU1     EQU   58                                                       01440000
DDU2     EQU   66                                                       01460000
DDIN     EQU   34                                                       01480000
DDPR     EQU   42                                                       01500000
*                                                                       01520000
PRPCH    SAVE  (14,12),T,IEBPPUN1-JULY-1966                             01540000
         BALR  BASER,R0                                                 01560000
         USING *,BASER             ESTABLISH ADDRESSABILITY             01580000
         ST    R13,SAVEREG+4                                            01600000
         LA    R1,SAVEREG               GET PTR TO SAVE AREA            01620000
         ST    R1,8(R13)                STORE PTR TO S.A. IN SAVE AREA  01640000
         L     R1,24(R13)               RESTORE R1                      01660000
         LA    R13,SAVEREG         SET UP SAVE AREA FOR CALLED ROUTINE  01680000
         MVI   PPTBLE,X'0'         INITIALIZE PRINT/PUNCH TABLE         01700000
         MVC   PPTBLE+1(PPTLEN-1),PPTBLE  TO ZEROES                     01720000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 01740000
*                                                                       01760000
* THIS ROUTINE CHECKS THE PARAMETER LISTS PASSED WHEN THE PROGRAM IS    01780000
* INVOKED. REGISTER 1 POINTS TO A THREE FULL WORD AREA IN CORE WHICH    01800000
* CONTAINS ADDRESSES OF THE THREE POSSIBLE PARAMETER LISTS. THE HIGH    01820000
* ORDER BYTE OF EACH OF THE FULL WORDS MUST BE EITHER HEX 00 OR HEX     01840000
* 80. THE 80 SIGNIFIES THAT THIS IS THE LAST PARAMETER LIST POINTER.    01860000
* THE FIRST POINTER IS TO THE LIST THAT EQUALS THE PARM VALUES FOUND ON 01880000
* THE EXECUTE CARD, AND IT DOES NOT APPLY TO THIS UTILITY. THE SECOND   01900000
* POINTER IS TO THE DDNAME LIST WHICH MUST BEGIN ON A HALF WORD         01920000
* BOUNDARY THAT IS NOT ALSO A FULL WORD BOUNDARY. THE TWO HIGH ORDER    01940000
* BYTES CONTAIN A COUNT OF THE NUMBER OF BYTES IN THE REMAINDER OF THE  01960000
* LIST. ALL ENTRIES IN THE LIST HAVE A MAXIMUM LENGTH OF EIGHT BYTES    01980000
* AND ARE LEFT JUSTIFIED AND PADDED WITH BLANKS. IF A NAME IS OMITTED   02000000
* WITHIN THE LIST, THE EIGHT-BYTE ENTRY MUST CONTAIN BINARY ZEROES.     02020000
* NAMES ARE OMITTED FROM THE END BY SHORTENING THE LIST. THE SEQUENCE   02040000
* OF THE ENTRIES IS AS FOLLOWS:                                         02060000
*                                                                       02080000
*              ENTRY 1    00000000                                      02100000
*                    2    00000000                                      02120000
*                    3    00000000                                      02140000
*                    4    00000000                                      02160000
*                    5    SYSIN                                         02180000
*                    6    SYSPRINT                                      02200000
*                    7    00000000                                      02220000
*                    8    SYSUT1                                        02240000
*                    9    SYSUT2                                        02260000
*                                                                       02280000
* THE THIRD PARAMETER LIST PERTAINS TO HEADER INFORMATION               02300000
*                                                                       02320000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 02340000
         TM    0(R1),X'80'         IS THIS THE LAST PARAMETER LIST PTR  02360000
         BO    PPHDRS              YES, THIS IS THE LAST PARAMETER LIST 02380000
*                                  PTR, AND ZEROES NOT CHECKED          02400000
         L     R2,4(R1)            OBTAIN ADDRESS OF DDNAME LIST        02420000
         LH    RLEN,0(R2)          PUT LENGTH OF DDNAME LIST IN REG     02440000
         LTR   RLEN,RLEN           IS LENGTH EQUAL TO ZERO              02460000
         BE    TESTEND             YES, PROCEED TO CHECK FOR A THIRD    02480000
*                                  PARAMETER LIST PTR                   02500000
         CH    RLEN,PH40           IS LENGTH LESS THAN OR EQUAL TO 40   02520000
         BL    TESTEND             YES, CHECK FOR THIRD PARAMETER LIST  02540000
         CLI   DDIN(R2),X'00'      IS THERE A SYSIN DDNAME              02560000
         BE    PPRDD4    NO, CONTINUE TO TEST SECOND                    02580000
*                                  PARAMETER LIST                       02600000
         MVC   PPSYSI(8),DDIN(R2)  MOVE SYSIN DDNAME TO PPDDNAM+24      02620000
PPRDD4   CH    RLEN,PH48           IS LENGTH LESS THAN OR EQUAL TO 48   02640000
         BL    TESTEND             YES, CHECK FOR THIRD PARAMETER LIST  02660000
         CLI   DDPR(R2),X'00'      IS THERE A SYSPRINT DDNAME           02680000
         BE    PPRDD8              NO, CONTINUE TO TEST SECOND          02700000
*                                  PARAMETER LIST                       02720000
         LA    DCBREG,PPOUT        LOAD REGISTER WITH ADDRESS OF DCB    02740000
         MVC   DDNAM(8,DCBREG),DDPR(R2) MOVE DDNAME FROM LIST TO DCB    02760000
PPRDD8   CH    RLEN,PH64           IS THERE A SYSUT1 DDNAME             02780000
         BL    TESTEND             NO, CHECK FOR THIRD PARAMETER LIST   02800000
         MVC   PPUT1(8),DDU1(R2)   MOVE SYSUT1 DDNAME TO TABLE          02820000
         CH    RLEN,PH72           IS THERE A SYSUT2 DDNAME             02840000
         BL    TESTEND             NO, CHECK FOR THIRD PARAMETER LIST   02860000
         MVC   PPUT2(8),DDU2(R2)   MOVE SYSUT2 DDNAME TO TABLE          02880000
TESTEND  TM    4(R1),X'80'         IS THIS THE LAST PARAMETER LIST PTR  02900000
         BO    PPHDRS              YES, BRANCH TO HEADER ROUTINE        02920000
         MVC   PPHEADER(120),PPHDRBL CLEAR HEADER                       02940000
         L     R2,8(R1)            LOAD ADDRESS OF HEADER INFORMATION   02960000
         LH    RLEN,0(R2)          LOAD LENGTH OF HEADER INTO REGISTER  02980000
         LTR   RLEN,RLEN           IS LENGTH EQUAL TO ZERO              03000000
         BE    PPHDRS              NO, REDUCE LENGTH BY ONE             03020000
          B     PPHNMOV       BRANCH TO HEADE ROUTINE            A38794 03030021
PPHDRS   SR    RLEN,RLEN           INITIALIZE LENGTH REGISTER TO ZERO   03100000
PPHNMOV  MVC   PPHEADER(32),PHDR   SET UP STANDARD HEADER        A38794 03120021
         MVC   PPHDPAGE(9),PAGE    SET UP PAGE NUMBER                   03140000
         CH    RLEN,PH4                 IS LENGTH LESS THAN 4           03160000
         BL    PPROPEN             YES, BRANCH TO OPEN OUTPUT           03180000
         MVC   PPHDNO(4),2(R2)         SET UP HEADER NUMBER      A38794 03200021
PPROPEN  OPEN  (PPOUT,OUTPUT)      OPEN PRINTER DCB                     03220000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 03240000
* IF THE SYSPRINT DCB HAS NOT BEEN OPENED, RETURN WITH A CONDITION CODE 03260000
* OF 12 AND NO ERROR MESSAGE. ALL INFORMATION NUMBERS EXCEPT HEADER     03280000
* INFORMATION NUMBERS ARE LESS THAN 512. WHEN THE REGISTERS ARE SAVED   03300000
* IN ZZPR, TWO BYTES FROM RZ ARE STORED IN ZZSW. IF 512 WAS PUT IN RZ   03320000
* TO INDICATE HEADER INFORMATION, THIS WILL APPEAR AS X'02' IN ZZSW.    03340000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 03360000
         LA    R1,PPOUT            LOAD ADDRESS OF PTR DCB              03380000
         TM    OFLGS(R1),X'10'     WAS DCB OPENED                       03400000
         BZ    DDERROR             NO, BRANCH TO ERROR ROUTINE          03420000
         TM    DFLG,X'10'               IS BLKSIZE ERROR FLAG SET  BS0H 03426017
         BC    1,DDERROR                YES, BRANCH TO ERROR RTN   BS0H 03432017
         LA    R1,PPHEADER         YES, LOAD HEADER ADDRESS IN REGISTER 03440000
         LA    RZ,HEADER           LOAD MESSAGE LENGTH INTO REGISTER    03460000
         BAL   R14,ZZPR            BRANCH TO MESSAGE WRITER             03480000
         L     R1,SAVEREG+4                                             03500000
         L     R1,24(R1)           RESTORE REGISTER 1                   03520000
         TM    0(R1),X'80'         IS THIS LAST PARAMETER LIST PTR      03540000
         BO    CALLANAL            YES, BRANCH                          03560000
*                                                                       03580000
         LH    RLEN,0(R2)          IS THERE CONTROL INFORMATION         03600000
         LTR   RLEN,RLEN                                                03620000
         BNH   CALLANAL            THERE ARE CONTROL CARDS              03640000
         CLC   2(2,R2),PPINT       ARE THERE INTERNAL PARAMETERS        03660000
         BE    PPINTERN            YES, BRANCH                          03680000
CALLANAL LA    1,FREECORE          GET ADDRESS OF FREECORE TABLE   4304 03690019
         ST    1,FREE@             SAVE ADDR AND PASS IT TO PPAL1  4304 03700019
         CALL  IEBPPAL1,(PPSYSI,FREE@)    CALL ANALYZER ROUTINE    4304 03710019
*                                                                       03720000
         LTR   R15,R15             IS THERE A RETURN CODE               03740000
         BE    POSTSCAN            NO MESSAGES                          03760000
         STC   R15,PPCONCD         STORE RETURN CODE                    03780000
         CLI   PPCONCD,X'0C'       HAS THE DCB BEEN OPENED PROPERLY     03800000
         BNL   PPTERM              NO, CLOSE AND RETURN                 03820000
*                                                                       03840000
POSTSCAN ST    R1,PPTBLEAD         STORE MESSAGE ADDRESS                03860000
*                                                                       03880000
PRECALL  MVC   N1DD(8,R1),PPUT1    PREPARE PARAMETER TABLE BY MOVING    03900000
         MVC   N2DD(8,R1),PPUT2    DDNAMES SYSUT1 AND SYSUT2            03920000
*                                                                       03940000
         CALL  IEBPPCH1            CALL PRINT/PUNCH ROUTINE             03960000
*                                                                       03980000
         SR    R4,R4               INITIALIZE REGISTER TO ZERO          04000000
         IC    R4,PPCONCD          ENTER PRINT/PUNCH CONDITION CODE     04020000
         CR    R4,R15              IS CONDITION CODE RETURNED FROM      04040000
*                                  PRPUN LESS THAN THE CONDITION CODE   04060000
*                                  RETURNED FROM PPANAL                 04080000
         BC    10,PPTERM           NO, CLOSE AND RETURN                 04100000
PPDDTERM STC   R15,PPCONCD         YES, STORE NEW CONDITION CODE        04120000
*                                                                       04140000
PPTERM   TM    GOTMAIN,X'10'       TEST FOR STORAGE GOTTEN         4304 04140919
         BC    8,PPTERM1           NO - SKIP FREEMAIN              4304 04141819
         L     RZ,AREASIZE         GET TBLE SIZE TO FREEE          4304 04142719
         L     R1,PPTBLEAD         GET TBLE ADDR TO FREE           4304 04143619
         FREEMAIN  R,A=(1),LV=(0)  FREE DYNAMIC CORE               4304 04144519
PPTERM1   TM   GOTMAIN1,X'10'      TEST FOR GET MAIN               4304 04145419
         BC    8,PPRET2            IF NO BRANCH                    4304 04146319
         L     RZ,DTBLENG          GET LENGTH IN REG 0             4304 04147219
         L     R1,DTBADDR          GET DTBLE ADDR TO FREE          4304 04148119
         MVI   GOTMAIN1,X'00'      RESET SWITCH                    4304 04149019
         FREEMAIN   R,A=(1),LV=(0)    FREE DTBLE CORE              4304 04149919
PPRET2   TM    GOTMAIN2,X'10'      TEST FOR GET MAIN               4304 04150819
         BC    8,PPRET3            IF NO - BRANCH                  4304 04151719
         L     RZ,GS1LENG          GET LENGTH IN REG               4304 04152619
         L     R1,MNTADD2          GET ADDRESS IN REGISTER         4304 04153519
         MVI   GOTMAIN2,X'00'      RESET SWITCH TO FREE            4304 04154419
         FREEMAIN  R,A=(1),LV=(0)     FREE MNT CORE                4304 04155319
PPRET3   TM    GOTMAIN3,X'10'      TEST FOR MCB GET MAIN           4304 04156219
         BC    8,PPRET4            IF NO THEN BRANCH               4304 04157119
         L     RZ,MCBLEN2          GET LENGTH OF MCB AREA          4304 04158019
         L     R1,MCBADD2          GET ADDR OF MCB AREA            4304 04158919
         MVI   GOTMAIN3,X'00'      RESET SWITCH TO FREE            4304 04159819
         FREEMAIN  R,A=(1),LV=(0)    FREE MCB CORE                 4304 04160719
PPRET4   TM    GOTMAIN4,X'10'      TEST FOR LITERAL GET MAIN       4304 04161619
         BC    8,PPRET5            IF NONE BYPASS FREE             4304 04162519
         L     RZ,LITSAV           GET LENGTH OF LITS IN REG 0     4304 04163419
         L     R1,LITADD2          GET ADDR OF LITS IN REG 1       4304 04164319
         MVI   GOTMAIN4,X'00'      RESET SWITCH FOR FREED          4304 04165219
         FREEMAIN   R,A=(1),LV=(0)     FREE LITERALS AREA          4304 04166119
PPRET5   TM    GOTMAIN5,X'10'      TEST FOR TITLE GET MAIN         4304 04167019
         BC    8,PPRET6            IF NONE THEN BYPASS FREE        4304 04167919
         L     R1,TITLADD2         GET TITLE ADDR IN REG 1         4304 04168819
         MVI   GOTMAIN5,X'00'      SET SWITCH TO FREE              4304 04169719
         FREEMAIN   R,A=(1),LV=144     FREE TITLE CORE          OY01168 04170616
PPRET6   TM    GOTMAIN6,X'10'      TEST FOR  SUBTITLE STORAGE      4304 04171519
         BC    8,PPRET7            IF NONE BYPASS FREE             4304 04172419
         L     R1,STITLADD         ELSE GET ADDR OF SUBTITLE       4304 04173319
         MVI   GOTMAIN6,X'00'      TURN OFF SWITCH                 4304 04174219
         FREEMAIN  R,A=(1),LV=120      FREE SUBTITLE CORE          4304 04175119
PPRET7   LA    R1,PPOUT            LOAD ADDR. OF OUTP. DCB       A41816 04176021
         TM    OFLGS(R1),X'10'     WAS DCB OPENED ?              A41816 04176521
         BZ    RETSYS              NO, DO NOT CLOSE              A41816 04177021
         CLOSE (PPOUT)             CLOSE OUTPUT DCB              A41816 04177521
         FREEPOOL  PPOUT           FREEPOOL PPOUT BUFFER CORE    A41816 04178021
*                                                                       04180000
RETSYS   EQU   *                                                 A41816 04190021
         SR    R15,R15             CLEAR REGISTER 15 AND                04200000
         IC    R15,PPCONCD         ENTER THE STORED CONDITION CODE      04220000
         L     R13,SAVEREG+4       RESTORE REGISTERS AND RETURN CONTROL 04240000
         RETURN (14,12),RC=(15)    TO THE CALLING PROGRAM               04260000
*                                                                       04280000
DDERROR  MVI   PPCONCD,X'0C'       SET CONDITION CODE TO 12             04300000
         B     PPTERM              CLOSE AND RETURN                     04320000
*                                                                  BS0H 04321017
*                         DCB EXIT ROUTINE                         BS0H 04322017
*                                                                  BS0H 04323017
DCBEXIT  LA    R1,PPOUT                                            BS0H 04324017
         USING IHADCB,R1                                           BS0H 04325017
         CLI   DCBLRECL+1,X'00'   IS LRECL FILLED IN               1825 04325421
         BNE   *+8                YES.. GO ON                      1825 04325821
         MVI   DCBLRECL+1,X'79'   GET DEFAULT VALUE                1825 04325921
         LH    R3,DCBBLKSI              LOAD SYSPRINT BLOCKSIZE    BS0H 04326017
         LTR   R3,R3                                               BS0H 04327017
         BC    2,TESTBLK                TEST BLOCKSIZE             BS0H 04328017
         MVI   DCBBLKSI+1,X'79'         INSERT DCB BLKSIZE         BS0H 04329017
         BCR   15,R14                   RETURN                     BS0H 04330017
TESTBLK  SR    R2,R2                    TEST FOR MODULAR BLOCKSIZE BS0H 04331017
         LA    R4,121                                              BS0H 04332017
         DR    R2,R4                                               BS0H 04333017
         LTR   R2,R2                                               BS0H 04334017
         BCR   8,R14                    IF MODULAR, RETURN         BS0H 04335017
         MVI   DFLG,X'10'               SET BLKSIZE ERROR FLAG     BS0H 04336017
         MVC   DCBBLKSI(2),DCBLRECL     MOVE LRECL TO BLKSIZE      BS0H 04337017
         DROP  R1                                                  BS0H 04338017
         RETURN                                                         04339017
*                                                                       04340000
*                                                                       04360000
*        PROCESS INTERNAL PARAMETER LIST                                04380000
*                                                                       04400000
         ENTRY PPDDTERM                                                 04420000
*                                                                       04440000
PPINTERN LA    R4,10                                                    04460000
         SR    RLEN,R4             SUBTRACT 10 FROM RECORD LENGTH       04480000
         LA    RZ,UTBLEN           OBTAIN TABLE LENGTH                  04500000
         CR    RLEN,RZ             IS RECORD LENGTH GREATER THAN        04520000
*                                  TABLE LENGTH                         04540000
         BNH   PPNO                NO, INVALID TABLE LENGTH             04560000
         ST    RZ,AREASIZE         STORE SIZE OF GET MAIN AREA     4304 04570019
         MVI   GOTMAIN,X'10'       SET SWITCH FOR LATER FREE       4304 04580019
         GETMAIN   R,LV=(0)           OBTAIN  CORE FOR WORKAREA    4304 04590019
         ST    R1,PPTBLEAD         STORE ADDRESS OF AREA ACQUIRED       04600000
         LA    R2,10(R2)           UPDATE POINTER TO INTERNAL PARAMETER 04620000
         USING DUTBLE,R2           ESTABLISH ADDRESSABILITY TO TABLES   04640000
         USING DTABLE,R1                                                04660000
*                                                                       04680000
         MVI   TABLE,0             INITIALIZE TABLE TO ZEROES           04700000
         MVC   TABLE+1(TABLEN-1),TABLE                                  04720000
         EJECT                                                          04740000
*                                                                       04760000
*        CONSTRUCT TABLE TO BE EXAMINED BY IEBPPCH1                     04780000
*                                                                       04800000
         MVC   EXLSTADD(4),UEXLADD SET EXIT LIST ADDRESS                04820000
         MVC   LITADD(4),ULITADD   MOVE IN USER LITERAL POOL ADDRESS    04840000
         MVC   MNTADD(4),UMNTADD   MOVE IN MEMBER NAME TABLE ADDRESS    04860000
         L     R4,URCBADD          LOAD ADDRESS OF SWITCHES TO TEST     04880000
         MVC   RCB(RCBLEN),0(R4)   MOVE IN SWITCHES TO TEST             04900000
         L     R4,UTCBADD          LOAD ADDRESS OF TABLE CONTROL BLOCK  04920000
         MVC   TCB(TCBLEN),0(R4)   MOVE IN TABLE CONTROL BLOCK          04940000
*                                                                       04960000
         L     R4,MNTADD           LOAD MEMBER NAME TABLE ADDRESS       04980000
         L     R4,0(R4)            OBTAIN FIRST WORD OF TABLE           05000000
         TM    TYPORG,X'02'        TEST TYPE ORGANIZATION               05020000
         BZ    PPINTA              NO NAMED PDS                         05040000
         LTR   R4,R4               IS THIS A PARTIAL PDS                05060000
         BNH   PPNO                YES, NO NAMED MEMBERS, BRANCH        05080000
         B     PPINTB              NO, BRANCH                           05100000
PPINTA   LTR   R4,R4               IS THIS A TOTAL PDS                  05120000
         BH    PPNO                YES, BRANCH                          05140000
*                                                                       05160000
PPINTB   SR    R4,R4               INITIALIZE REGISTER TO ZERO          05180000
         LA    R3,120              LOAD RECORD LENGTH INTO REGISTER     05200000
         CH    R4,TCB1             IS THERE A TITLE                     05220000
         BE    PPINTC              NO, BRANCH                           05240000
         LH    R2,TCB1             DETERMINE THE LENGTH OF              05260000
         AH    R2,TCB1+2           THE TITLE                            05280000
         CR    R2,R3               IS TITLE LENGTH GREATER THAN 120     05300000
         BH    PPNO                YES, INVALID TITLE                   05320000
PPINTC   CH    R4,TCB2             IS THERE A SUBTITLE                  05340000
         BE    PPINTD              NO, BRANCH                           05360000
         LH    R2,TCB2             DETERMINE LENGTH OF SUBTITLE         05380000
         AH    R2,TCB2+2                                                05400000
         CR    R2,R3               IS SUBTITLE LENGTH GREATER THAN 120  05420000
         BH    PPNO                YES, INVALID SUBTITLE                05440000
PPINTD   LA    1,FREECORE          GET ADDR OF FREECOR TABLE       4304 05450019
         ST    1,FREE@             SAVE ADDR AND PASS IT TO PPAL1  4304 05460019
         CALL  IEBPPAL1,(PPSYSI,FREE@),VL     ANALYZE CONTROL CARDS4304 05470019
         L     R1,PPTBLEAD         LOAD ADDRESS OF PRINT/PUNCH TABLE    05480000
         B     PRECALL             BRANCH                               05500000
*                                                                       05520000
PPNO     LA    R1,PPINVLD          LOAD POINTER                         05540000
         SLL   R1,8                MOVE POINTER TO ALLOW SPACE FOR ID   05560000
         LA    RZ,PPINVAL          LOAD ID CODE                         05580000
         AR    R1,RZ               PUT ID CODE IN SAME REG AS POINTER   05600000
         LA    R15,PPMSGWRT        OBTAIN ADDRESS OF MESSAGE WRITER     05620000
         BALR  R14,R15             PRINT OUT THE APPROPRIATE MESSAGE    05640000
         MVI   PPCONCD,X'0C'       SET CONDITION CODE                   05660000
         B     PPTERM              CLOSE AND RETURN                     05680000
         EJECT                                                          05700000
*                                                                       05720000
*                                                                       05740000
PHMOV    MVC   PPHEADER(1),2(R2)   MOVE HEADER INFORMATION              05760000
*                                                                       05780000
*        FORMAT FOR HEADER LABEL                                        05800000
PPHDRBL  DC    C' '                CONTROL INDICATOR                    05820000
PPHEADER DC    2C' '                                                    05840000
         DC    3CL32' '                                                 05860000
PPHDPAGE DC    C'PAGE '                                                 05880000
PPHDNO   DC    CL17'0001'                                               05900000
*                                                                       05920000
*                                                                       05940000
PAGE     DC    C'PAGE 0001'                                             05960000
PHDR     DC    CL32'PRINT/PUNCH DATA SET UTILITY'                       05980000
SAVEREG  DS    18F                 SAVE AREA                            06000000
*                                                                       06020000
PPTBLEAD DS    F'0'                PRINT/PUNCH TABLE ADDRESS            06040000
FREE@    DC    F'0'          FREE CORE TABLE ADDR PASSED TO PPAL1  4304 06040719
GOTMAIN  DC    X'00'         INDICATES  GETMAIN DONE IN PPUN1           06041419
AREASIZE DC    F'0'          SIZE OF TABLE IN PPUN1                4304 06042119
*                                                                  4304 06042819
*   FREECORE TABLE CONTAINS DATA TO FREE MAIN STORAGE FOR DTABLE   4304 06043519
*                                                                  4304 06044219
FREECORE DS    0F                                                  4304 06044919
DTBLENG  DC    F'0'                LENGTH OF DTABLE                4304 06045619
DTBADDR  DC    F'0'                ADDRESS OF DTABLE               4304 06046319
GS1LENG  DC    F'0'                MNT LENGTH                      4304 06047019
MNTADD2  DC    F'0'                ADDRESS OF MNT                  4304 06047719
MCBLEN2  DC    F'0'                LENGTH OF MCB                   4304 06048419
MCBADD2  DC    F'0'                ADDR OF MCB                     4304 06049119
LITSAV   DC    F'0'                LENGTH OF LITERALS              4304 06049819
LITADD2  DC    F'0'                ADDRESS OF LITERALS             4304 06050519
TITLADD2 DC    F'0'                ADDRESS OF TITLE                4304 06051219
STITLADD DC    F'0'                ADDRESS OF SUBTITLE             4304 06051919
*                                                                  4304 06052619
*        SWITCHES TO INDICATE WHICH GETMAINS WERE EXECUTED         4304 06053319
*                                                                  4304 06054019
GOTMAIN1 DC    X'00'          DTABLE                               4304 06054719
GOTMAIN2 DC    X'00'          MNT                                  4304 06055419
GOTMAIN3 DC    X'00'          MCB                                  4304 06056119
GOTMAIN4 DC    X'00'          LITERALS                             4304 06056819
GOTMAIN5 DC    X'00'          TITLE                                4304 06057519
GOTMAIN6 DC    X'00'          SUBTITLE                             4304 06058219
*                                                                       06060000
PPTBLE   DS    0X                                                       06080000
PPDDNAM  DS    4D                  DDNAME LIST IN PRINT/PUNCH TABLE     06100000
PPCONCD  DC    X'0'                CONDITION CODE INDICATOR             06120000
PPTLEN   EQU   *-PPTBLE            LENGTH OF PRINT/PUNCH TABLE          06140000
*                                                                       06160000
PPINT    DC    C'IN'                                                    06180000
PPUT1    EQU   PPDDNAM                                                  06200000
PPUT2    EQU   PPDDNAM+8                                                06220000
PPSYSI   EQU   PPDDNAM+24                                               06240000
*                                                                       06260000
*        CONSTANTS USED TO DETERMINE DDNAME LIST LENGTH                 06280000
PH4      DC    H'4'                                                     06300000
PH40     DC    H'40'                                                    06320000
PH48     DC    H'48'                                                    06340000
PH64     DC    H'64'                                                    06360000
PH72     DC    H'72'                                                    06380000
         EJECT                                                          06400000
*                                                                       06420000
         USING *,R15                                                    06440000
*                                                                       06460000
         ENTRY PPMNMSG                                                  06480000
PPMNMSG  LR    RZ,R1               PRESERVE CONTENTS OF REGISTER 1      06500000
         LA    R1,MNPTER           *LOCATE THE 18TH ERROR MESSAGE BY    06520000
         SLL   R1,5                *ADDING THE ADDRESS OF THE 1ST MSG   06540000
         A     R1,PPMSGADD         *TO THE LENGTH OF THE FIRST 17 MSGS  06560000
         MVC   PPERRMSG(32),0(R1)  *AND MOVE MSG INTO WORK AREA         06580000
         LR    R1,RZ               RESTORE REGISTER 1                   06600000
         MVC   PPERRMSG+7(8),0(R1) MOVE PROPER NAME INTO MESS.   A38794 06620021
         MVC   PPMIDN(2),MERR      MOVE PROPER MSG NUMBER INTO MSG      06640000
         LA    RZ,39               PUT MSG LENGTH INTO REGISTER 0       06660000
         LA    R1,PPMAREA          PUT MSG ADDRESS NTO REGISTER 1       06680000
         B     ZZPR                BRANCH TO MSG WRITER ROUTINE         06700000
*                                                                       06720000
         ENTRY PPMSGWRT                                                 06740000
         USING *,15                                                     06760000
PPMSGWRT LR    RZ,R1               PRESERVE CONTENTS OF REGISTER 1      06780000
         SLL   RZ,24               CLEAR THE THREE HIGH ORDER BYTES     06800000
         SRL   RZ,24               BY SHIFTING TO BRING IN ZEROES       06820000
         SRL   R1,8                * LOCATE THE APPROPRIATE ERROR       06840000
         SLL   R1,5                * MESSAGE AND                        06860000
         A     R1,PPMSGADD         * MOVE INTO THE ERROR MESSAGE        06880000
         MVC   PPERRMSG(32),0(R1)  *WORK AREA                           06900000
         CVD   RZ,DBLWD            CONVERT TO DECIMAL THE MSG NUMBER    06920000
         UNPK  PPMIDN(2),DBLWD+6(2) AND SUPPLY APPROPRIATE              06940000
         OI    PPMIDN+1,X'F0'      MESSAGE NUMBER                       06960000
         LA    RZ,39               PUT MESSAGE LENGTH IN REGISTER 0     06980000
         LA    R1,PPMAREA          PUT MESSAGE ADDRESS IN REGISTER 1    07000000
         B     ZZPR                BRANCH TO MSG WRITER ROUTINE         07020000
         DROP  R15                                                      07040000
*                                                                       07060000
         ENTRY CCWRITE                                                  07080000
         USING *,R15                                                    07100000
CCWRITE  LA    RZ,79               LOAD MESSAGE LENGTH INTO REGISTER 0  07120000
         B     ZZPR                BRANCH TO MSG WRITER ROUTINE         07140000
         DROP  R15                                                      07160000
*                                                                       07180000
         EXTRN PPMSGES                                                  07200000
PPMSGADD DC    A(PPMSGES)                                               07220000
*                                                                       07240000
PPMAREA  DS    0X                                                       07260000
PPMID    DC    C'IEB4'             * NUMBER GIVEN TO ERROR MESSAGE      07280000
PPMIDN   DC    C'00I '             *                                    07300000
PPERRMSG DS    32C                 * ERROR MESSAGE WORK AREA            07320000
*                                                                       07340000
PPINVAL  EQU   X'00'                                                    07360000
MERR     DC    C'08'               PART OF ERROR MESSAGE NUMBER         07380000
*                                                                       07400000
IOMSG    EQU   13                  * NUMBERS USED TO LOCATE             07420000
MNPTER   EQU   17                  * THE APPROPRIATE                    07440000
PPINVLD  EQU   18                  * ERROR MESSAGES                     07460000
*                                                                       07480000
DBLWD    DS    D                   WORK AREA FOR DECIMAL CONVERSION     07500000
         EJECT                                                          07520000
*                                                                       07540000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 07560000
* THIS GENERALIZED MESSAGE WRITER INCLUDES THE FACILITY TO PRINT A      07580000
* HEADER ON EACH PAGE WITH ASCENDING PAGE NUMBERS. THE FOLLOWING        07600000
* LINKAGE CONVENTIONS MUST BE OBSERVED:                                 07620000
*              REGISTER 0 MUST CONTAIN THE MESSAGE LENGTH,              07640000
*              REGISTER 1 MUST CONTAIN THE MESSAGE ADDRESS,             07660000
*              AND ZZPR MUST BE INVOKED BY A BAL 14, ZZPR.              07680000
*****   *****   *****  *****    *******   *****   *****   *****   ***** 07700000
*                                                                       07720000
         ENTRY ZZPR                                                7034 07740000
ZZPR     BALR  R15,R0                                                   07760000
         USING *,R15               ESTABLISH ADDRESSABILITY             07780000
         STM   R14,R2,ZZSAVE       SAVE REGISTERS FOR CALLING ROUTINE   07800000
         TM    ZZSW,X'02'          IS THIS A HEADER                     07820000
         BO    ZZHEAD              YES, BRANCH TO HEADER ROUTINE        07840000
         CLC   ZZLINES(R1),ZZLINCNT IS NUMBER OF LINES PRINTED @ZA07383 07860099
*                                  EQUAL TO 60?                @ZA07383 07880099
         BNH   ZZSKIP              YES, SKIP TO NEW PAGE       @ZA07383 07900099
         TM    ZZSW,X'01'          IS THIS A CLEAR                      07920000
         BO    ZZSKIP              NO, PROCEED TO PRINT                 07940000
         B     ZZCLEAR             YES, BRANCH TO CLEAR ROUTINE         07960000
ZZHEAD   MVC   ZZHDSAVE(120),0(R1) MOVE MSG INTO PRINT AREA    @ZA07383 07980099
         MVI   ZZHDSAVE-1,C'-'     INDICATE TRIPLE SPACE                08000000
ZZSKIP   MVI   ZZCTRL,C'1'         SKIP TO CHANNEL 1                    08020000
         MVI   ZZPRINT,C' '        CLEAR PRINT AREA TO BLANKS           08040000
         MVC   ZZPRINT+1(119),ZZPRINT                                   08060000
         BAL   R14,ZZWRITE         BRANCH TO WRITE ROUTINE              08080000
         USING *,R14                                                    08100000
         DROP  R15                                                      08120000
         MVC   ZZCTRL(121),ZZHDSAVE-1    MOVE HEADER INTO PRINT AREA    08140000
         MVI   ZZLINCNT,X'04'      SET INCREMENT TO FOUR                08160000
         BAL   R14,ZZWRITE         BRANCH TO WRITE ROUTINE              08180000
         USING *,R14                                                    08200000
         PACK  ZZCONVRT(8),ZZPGNO(4)                                    08220000
         CVB   R15,ZZCONVRT        CONVERT TO BINARY                    08240000
         LA    R15,1(R15)          INCREMENT BY ONE                     08260000
         CVD   R15,ZZCONVRT        CONVERT TO DECIMAL                   08280000
         UNPK  ZZPGNO(4),ZZCONVRT(8)                                    08300000
         OI    ZZPGNO+3,X'F0'          SET INDICATOR BITS               08320000
         TM    ZZSAVE+11,X'FF'     IS THIS A CLEAR                      08340000
         BM    ZZCLEAR             YES                                  08360000
         LM    R14,R2,ZZSAVE       RESTORE REGISTERS                    08380000
         BR    R14                 RETURN                               08400000
*                                                                       08420000
ZZCLEAR  BALR  R1,R0                                                    08440000
         DROP  R14                                                      08460000
         USING *,R1                                                     08480000
         IC    R14,ZZLINCNT                                             08540000
         LA    R14,1(R14)              INCREMENT LINCNT BY ONE          08560000
         STC   R14,ZZLINCNT                                             08580000
         MVI   ZZPRINT,C' '        CLEAR THE PRINT ARES        @ZA07383 08600099
         MVC   ZZPRINT+1(119),ZZPRINT                                   08620000
         LM    R14,R15,ZZSAVE+8    RESTORE REGISTERS 14 AND 15          08640000
         CLC   4(2,R15),FOXZERO    IS THERE AN INFORMATION MSG          08660000
         BNE   ZZEX                NO                                   08680000
         S     R14,CONS7           IGNORE MSG NUMBER AND LOAD THE       08700000
         LA    R15,7(R15)          ADDRESS OF THE MESSAGE ITSELF        08720000
ZZEX     EX    R14,ZZMOVE          MOVE MESSAGE INTO PRINT AREA         08740000
         MVI   ZZCTRL,C' '         SET CONTROL INDICATOR                08760000
         L     R14,ZZSAVE          RESTORE REGISTER 14                  08780000
         B     ZZWRITE             BRANCH TO WRITE ROUTINE              08800000
*                                                                       08820000
ZZMOVE   MVC   ZZPRINT(1),0(R15)   MOVE MESSAGE INTO PRINT AREA         08840000
*                                                                       08860000
ZZWRITE  BALR  R8,R0                    ESTABLISH ADDRESSABILITY   BS0H 08890017
         DROP  R1                                                  BS0H 08920017
         USING *,R8                                                BS0H 08950017
         ST    R14,REGSAVE              SAVE REGISTER 14           BS0H 08980017
         PUT   ZZDCB,ZZCTRL                                        BS0H 09010017
         L     14,REGSAVE                                          BS0H 09040017
         L     R2,ZZSAVE+16                                             09120000
         BR    R14                 RETURN TO CALLING ROUTINE            09140000
         DROP  R8                                                  BS0H 09160017
         EJECT                                                          09180000
         DS    0D                                                       09200000
*                                                                       09220000
ZZSAVE   DS    10X                 SAVE AREA                            09240000
ZZSW     DS    10X                 CONTROL INFORMATION                  09260000
ZZCTRL   DS    1X                  CONTROL BYTE                         09280000
ZZPRINT  DS    143C' '        SYSPRINT BUFFER                      9476 09300019
ZZHDSAVE DS    120X                WORK AREA                            09320000
ZZCONVRT EQU   ZZSAVE+32                                                09340000
ZZLINES  DC    X'3C'               LINES PER PAGE              @ZA07383 09360099
ZZLINCNT DS    1X                  LINE COUNT                           09380000
HEADER   EQU   512                                                      09420000
ZZPGNO   EQU   ZZHDSAVE+103                                             09440000
FOXZERO  DC    X'F0F0'                                                  09460000
CONS7    DC    F'7'                                                     09480000
OPT      DC    X'85'                                               BS0H 09483017
         DC    AL3(DCBEXIT)                                        BS0H 09486017
DFLG     DC    X'00'                                               BS0H 09489017
REGSAVE  DC    F'0'                                                BS0H 09492017
SPSYNAD  SYNADAF  ACSMETH=QSAM                                     7715 09492219
         MVC   WTOMG1+23(26),49(R1)     GET PART OF I/O ERR MSG    7715 09492419
         MVC   WTOMG2+13(53),75(R1)     GET PART OF I/O ERR MSG    7715 09492619
         SYNADRLS                                                  7715 09492819
         LA    1,WTOMG1                 GET ADDR FOR PRINTING MSG  7715 09493019
         WTO   MF=(E,(1))               WRITE THIS PORTION OF MSG  7715 09493219
         LA    1,WTOMG2                 GET  ADDR OF 2ND MSG PART  7715 09493419
         WTO   MF=(E,(1))               WRITE SECOND PORTION       7715 09493619
         RETURN                                                         09493819
WTOMG1   WTO   'IEB421I I/O ERROR                           ',MF=L,    X09494019
               ROUTCDE=11,DESC=7                                   7715 09494219
WTOMG2   WTO   'IEB421I                                                X09494419
                               ',MF=L,ROUTCDE=11,DESC=7            7715 09494619
         DS    0D                                                  BS0H 09495017
         EJECT                                                          09500000
*                                                                       09520000
         ENTRY   PPOUT                                             7034 09540000
PPOUT    DCB   DDNAME=SYSPRINT,RECFM=FBA,DSORG=PS,MACRF=(PM),      BS0H*09560017
               EXLST=OPT,SYNAD=SPSYNAD                             7715 09580019
*                                                                       09600000
*                                                                       09620000
ZZDCB    EQU   PPOUT                                                    09640000
*                                                                       09660000
         EJECT                                                          09680000
*                                                                       09700000
         DCBD  DSORG=PS                                                 09720000
*                                                                       09740000
DDNAM    EQU   DCBDDNAM-IHADCB                                          09760000
*                                                                       09780000
         EJECT                                                          09800000
*                                                                       09820000
DTABLE   DSECT                                                          09840000
TABLE    DS    0F                                                       09860000
DDN1     DS    CL8                 * DDNAME WORK AREAS                  09880000
DDN2     DS    CL8                 *                                    09900000
EXLSTADD DS    F                   EXIT LIST ADDRESS                    09920000
LITADD   DS    F                   USER LITERAL POOL ADDRESS            09940000
MNTADD   DS    F                   MEMBER NAME TABLE ADDRESS            09960000
RCB      DS    0X                                                       09980000
TYPORG   DS    0X                  BIT INDICATORS                       10000000
         DS    16X                                                      10020000
RCBLEN   EQU   *-RCB                                                    10040000
TCB      DS    0F                                                       10060000
TCB1     DS    2F                  TITLE INFORMATION                    10080000
TCB2     DS    2F                  SUBTITLE INFORMATION                 10100000
TCBLEN   EQU   *-TCB                                                    10120000
PREFORMT DS    X'0'                PREFORMAT SWITCH FOR ALLIGNMENT      10140000
TABLEN   EQU   *-TABLE                                                  10160000
N1DD     EQU   DDN1-DTABLE                                              10180000
N2DD     EQU   DDN2-DTABLE                                              10200000
*                                                                       10220000
DUTBLE   DSECT                                                          10240000
UTBEG    DS    0F                                                       10260000
UEXLADD  DS    F                   EXIT LIST ADDRESS                    10280000
URCBADD  DS    F                   RCB ADDRESS                          10300000
UTCBADD  DS    F                   TCB ADDRESS                          10320000
ULITADD  DS    F                   USER LITERAL POOL ADDRESS            10340000
UMNTADD  DS    F                   MEMBER NAME TABLE ADDRESS            10360000
UTBLEN   EQU   *-UTBEG                                                  10380000
OFLGS    EQU   DCBOFLGS-IHADCB                                          10400000
*                                                                       10420000
         END   IEBPTPCH                                                 10440000
