./  ADD  SSI=52180046,NAME=IGE0011C
* /* START OF SPECIFICATIONS ****                                       00050002
*01*  PROCESSOR=ASSEMXF-370R                                            00100002
**** END OF SPECIFICATIONS ***/                                         00235602
IGE0011C CSECT                    1287 OCR ERP ENTRY POINT              00241502
         TITLE 'IGE0011C - 1287 OPTICAL CHARACTER READER ERP'           00247202
*********************************************************************** 00252902
*MODULE-NAME                                                   @YM00638 00254902
* IGE0011C                                                     @YM00638 00256902
*                                                              @YM00638 00257302
*DESCRIPTIVE-NAME                                              @YM00638 00257702
* OCR ERP MODULE FOR 1287 DEVICE                               @YM00638 00258102
*                                                              @YM00638 00258502
*COPYRIGHT                                                     @YM00638 00259002
* NONE                                                         @YM00638 00259402
*                                                              @YM00638 00259802
*CHANGE-ACTIVITY                                               @YM00638 00259902
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                00260002
*C510000,503000,506000,508000                                    A33926 00264302
*D357000                                                         A33936 00270001
*C480000,537000                                                  A33936 00280001
*                                                                       00285001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                00290001
*A171500,173500,478100-478600,530100-530600                       21797 00295001
*C377000-380000                                                  A39680 00297001
*                                                                     * 00300019
* RELEASE VS2/1.6 ADDITIONS/CHANGES/DELETIONS                         * 00330001
*A397000                                                              * 00360001
* RELEASE VS2/ 2.0  ADDITIONS/CHANGES/DELETIONS                  Y02967 00362002
*A224000,                                                        Y02967 00364002
*A178000,260000,408000                                           YM2510 00364602
*A367000,538000                                                  YM2518 00365202
*C046000,069000,073000,079000,096000-097000,148000,149000,160000 Y02967 00366002
*C258000-259000,263000-264000,268000,270000-274000,275000,278000 Y02967 00368002
*C285000-286000,288000-290000,292000-294000,307000-308000,311000 Y02967 00370002
*C329000,347000,349000,351000,353000,360000-362000,366000,368000 Y02967 00372002
*C370000,374000,401000-402000,407000-409000,413000,428000-429000 Y02967 00374002
*C431000,433000,435000-437000,439000-440000,446000-455000,       Y02967 00376002
*C457000-465000,469000,471000-472000,476000,478000-478100,478300 Y02967 00378002
*C479000,487000,489000-491000,495000,497000-498000,502000,505000 Y02967 00380002
*C507000,511000,513000,516000,518000-519000,525000,528000        Y02967 00382002
*C530000-530100,530300,531000,538000,                            Y02967 00384002
*C431000,433000                                                  YM2510 00384502
*C249000,428400,446800,448400,507000                             YM2511 00385002
*C397000                                                         YM2518 00385502
*D070000-071000,093000-095000,098000-103000,116000-122000,       Y02967 00386002
*D131000-137000,205000-208000,296000-306000,                            00388002
*D213000,413500                                                  YM2510 00389002
*                                                                     * 00390002
*TITLE 'IGE0011C' - 1287 ERROR RECOVERY PROCEDURES                    * 00400019
*                                                                     * 00500019
*STATUS - RELEASE VS2/ 2.0  CHANGE LEVEL 000                     Y02967 00600002
*                                                                     * 00700019
*FUNCTION/OPERATION   IGE0011C IS SCHEDULED FOR EXECUTION WHENEVER THE* 00800019
*   I/O SUPERVISOR DETECTS AN ERROR ASSOCIATED WITH THE 1287 OPTICAL  * 00900019
*   CHARACTER READER THAT REQUIRES ERROR RECOVERY PROCEDURES.         * 01000019
*                                                                     * 01100019
*                                                                     * 01200019
*   THE ERROR ROUTINE USES THE STANDARD ERROR INTERPRETER ROUTINE FOR * 01300019
*   TESTING OF SENSE BITS AND CSW STATUS BITS. THE FOLLOWING ACTIONS  * 01400019
*   ARE TAKEN DEPENDING UPON THE NATURE OF THE ERROR                  * 01500019
*                                                                     * 01600019
*   1)  NORMAL CONDITION OR SUCCESSFUL RETRY OF RECOVERABLE ERROR     * 01700019
*       CONDITION                                                     * 01800019
*                                                                     * 01900019
*       IOSB EXCEPTION, ERROR FLAGS ARE CLEARED; CONTROL IS    @YM00636 02000002
*       TRANSFERRED TO THE STATISTICS UPDATE ROUTINE.                 * 02100019
*   2)  RECOVERABLE ERROR                                             * 02200019
*                                                                     * 02300019
*       IOSB ERROR FLAG IS SET.                                @YM00636 02400002
*       IOSB EXCEPTION FLAG IS CLEARED.                        @YM00636 02500002
*       ERROR COUNTS ARE UPDATED.                                     * 02600019
*       CONTROL IS PASSED TO THE I/O SUPERVISOR VIA SVC 15 AND SVC 3  * 02700019
*       TO RETRY THE CHANNEL PROGRAM.                                 * 02800019
*                                                                     * 02900019
*   3)  PERMANENT ERROR                                               * 03000019
*       IOSB ERROR AND EXCEPTION FLAGS ARE SET.                @YM00636 03100002
*       IOSB MESSAGE AND LOGOUT FLAGS MAY BE SET.              @YM00636 03200002
*       CONTROL IS RETURNED TO THE I/O SUPERVISOR EITHER DIRECTLY     * 03300019
*       THROUGH ISSUANCE OF AN SVC 15 AND AN SVC 3 OR INDIRECTLY BY   * 03400019
*       FIRST PASSING CONTROL TO THE WTO ROUTINE WHICH IN TURN PASSES * 03500019
*       CONTROL TO THE STATISTICS UPDATE ROUTINE AND THE I/O OUTBOARD * 03600019
*       RECORDING ROUTINE, IF REQUIRED, AND EVENTUALLY TO THE I/O     * 03700019
*       SUPERVISOR.                                                   * 03800019
*                                                                     * 03900019
*ENTRY POINTS                                                         * 04000019
*       IGE0011C - ERROR RECOVERY PROCEDORE ENTRY POINT               * 04100019
*                                                                     * 04200019
*       DATA PASSED TO THE ROUTINE CONSISTS OF STANDARD SYSTEM CONTROL* 04300019
*       BLOCKS.                                                       * 04400019
*                                                                     * 04500019
*INPUT  IOSB POINTER IN REGISTER 1                               Y02967 04600002
*                                                                     * 04700019
*OUTPUT I/O ERROR AND INTERVENTION REQUIRED MESSAGES IN SOME INSTANCES* 04800019
*                                                                     * 04900019
*EXTERNAL ROUTINES  ERROR INTERPRETER ROUTINE                         * 05000019
*                                                                     * 05100019
*EXITS-NORMAL  XCTL TO STATISTICS UPDATE ROUTINE FOLLOWING SUCCESSFUL * 05200019
*       RECOVERY OF A RETRYABLE ERROR OR UPON DETECTION OF A NORMAL   * 05300019
*       CONDITION.                                                    * 05400019
*                                                                     * 05500019
*     -ERROR                                                          * 05600019
*                                                                     * 05700019
*   1)  SVC 15 AND SVC 3 EXIT TO I/O SUPERVISOR FOR RE-EXECUTION OF   * 05800019
*       THE CHANNEL PROGRAM UPON DETECTION OF A RETRYABLE ERROR.      * 05900019
*                                                                     * 06000019
*   2)  XCTL TO WTO ROUTINE FOR ISSUANCE OF A PERMANENT I/O ERROR     * 06100019
*       MESSAGE AND UPDATING OF STATISTICS AND SYS1.LOGREC IN THE CASE* 06200019
*       OF SOME PERMANENT ERRORS.                                     * 06300019
*                                                                     * 06400019
*   3)  SVC 15 AND SVC 3 EXIT TO I/O SUPERVISOR IN THE CASE OF SOME   * 06500019
*       PERMANENT I/O ERRORS.                                         * 06600019
*                                                                     * 06700019
*TABLES/WORK AREAS                                                    * 06800019
*   1)  INPUT/OUTPUT SYSTEM BLOCK (IOSB)                         Y02967 06900002
*                                                                     * 07200019
*   3)  DYNAMIC WORK AREA                                        Y02967 07300002
*                                                                     * 07400019
*   4)  STATISTICS UPDATE TABLE                                       * 07500019
*                                                                     * 07600019
*ATTRIBUTES                                                           * 07700019
*                                                                     * 07800019
*       RE-ENTRANT,SUPERVISOR MODE                               Y02967 07900002
*                                                                     * 08000019
*NOTES                                                                * 08100019
*                                                                     * 08200019
*       N/A                                                           * 08300019
*                                                                     * 08400019
*                                                                     * 08500019
*********************************************************************** 08600019
         EJECT                                                 @YA00406 08650002
*********************************************************************** 13000019
*                                                                     * 13800019
*        STATUS INDICATORS                                            * 13900019
*                                                                     * 14000019
*********************************************************************** 14100019
CSWUCK   EQU   X'02'              UNIT CHECK                            14200019
*********************************************************************** 14300019
*                                                                     * 14400019
*        REGISTER DEFINITION                                          * 14500019
*                                                                     * 14600019
*********************************************************************** 14700019
IOSBREG  EQU   1                  IOSB REG                     @YM00636 14800002
RVREG    EQU   1                  WORK REGISTER                  Y02967 14850002
CCWREG   EQU   2                  CCW ADDRESS REGISTER                  14900019
WORKR3   EQU   3                  WORK REGISTER                @YM00636 14950002
ERREG    EQU   4                  WORK REGISTER                         15000019
WORKR4   EQU   4                  WORK REGISTER                @YM00636 15100002
WORKR5   EQU   5                  WORK REGISTER                @YM00636 15200002
WORKR6   EQU   6                  WORK REGISTER                @YM00636 15500002
COMREG   EQU   8                  COMMUNICATION TABLE REG               15700019
WORKR9   EQU   9                  WORK REGISTER                @YM00636 15800002
SVREG    EQU   9                  WORK REGISTER                         15900019
ERPREG   EQU   10                 DYNAMIC WORKAREA REG           Y02967 16000002
VTLREG   EQU   11                 ADDR OF VIRTUAL I/O AREA       Y02967 16050002
LINKR    EQU   12                 WORK REGISTER                         16100019
ERRE1    EQU   13                 WORK REGISTER                         16300019
ERRETR   EQU   14                 RETURN REG                            16400019
BASREG   EQU   15                 BASE REGISTER                         16500019
*********************************************************************** 16600019
*                                                                     * 16700019
*        RETRY COUNTS                                                 * 16800019
*                                                                     * 16900019
*********************************************************************** 17000019
ILCOUNT  EQU   5                  INCORRECT LENGTH RETRY COUNT @YM00636 17100002
ILCOUNT2 EQU   3                  DOCUMENT INCORRECT LENGTH COUNT 21797 17150002
CCCNT    EQU   5                  TEST FOR CHAINING CHECK RETRISE       17200019
EQCNT    EQU   10                 TEST FOR EQUIPMENT CHECK RETRIES      17300002
EQCNT2   EQU   3                  DOCUMENT EQUIPMENT CHECK COUNT  21797 17350002
DCCOUNT1 EQU   3                  DOCUMENT DATA CHECK RETRY COUNT       17400002
DCCOUNT2 EQU   5                  TAPE DATA CHECK COUNT        @YM00636 17500002
INCCOUNT EQU   16                 INCREMENT FOR OVERRUN RETRY COUNT     17600019
ORCOUNT  EQU   X'50'              OVERRUN RETRY COUNT (FIVE)            17700019
BOCOUNT  EQU   X'08'              TEST FOR BUS OUT CHECK RETRIED        17800019
CDCCNT   EQU   X'08'              TEST FOR CHANNEL DATA CHK    @YM00636 17850002
         EJECT                                                 @YA00406 17860002
*********************************************************************** 17900019
*                                                                     * 18000019
*        MISCELLANEOUS DEFINITIONS                                    * 18100019
*                                                                     * 18200019
*********************************************************************** 18300019
VEXCTL   EQU   44                 ADDR OF XCTL ROUTINE                  18400019
STAUPRTN EQU   254                STATISTICS UPDATE ROUTINE             18500019
BYTECNT  EQU   6                  DISPLACMENT TO BYTE COUNT IN CCW      18600019
CVTADDR  EQU   16                 POINTER TO CVT ADDRESS                18700019
NODOC    EQU   X'20'              TEST FOR NO DOCUMENT FOUND            18800019
LATESS   EQU   X'40'              TEST FOR LATE STACKER SELECT          18900019
KC       EQU   X'01'              TEST FOR KEYBOARD CORRECTION          19000019
SNSLEN   EQU   2                  LENGTH OF SENSE BYTES TO PUT IN STATA 19100019
CHINTCHK EQU   X'06'              TEST FOR CHANNEL OR INTERFACE CHECK   19400019
CLRCNT   EQU   X'03'              BYTE COUNT FOR CLEARING COUNTERS      19500019
OLC      EQU   X'40'              TEST FOR ON-LINE CORRECTION           19900019
ZEROCNT  EQU   X'0F'              TEST FOR FIRST RETRY, INC LENGTH      20000019
ERPIBLEN EQU   8                  ERPIB LENGTH                          20200019
DC       EQU   0                  DISPLACEMENT TO DATA CHECK COUNTS     21000019
ILC      EQU   1                  DISPLACEMENT TO INCORRECT LENGTH CNTS 21100019
EC       EQU   2                  DISPLACEMENT TO EQUIPMENT CHECK CNTS  21200019
RETSVC   EQU   3                  RETURN TO IOS SVC                     21400019
ERRORSVC EQU   15                 ERROR EXCP                            21500019
CLEARCNT EQU   X'02'              COUNT OF ERROR COUNTER BYTES TO CLEAR 21600019
INVSNS1  EQU   X'01'              TEST FOR INVALID SENSE BIT            21700019
INVSNS   EQU   X'17'              TEST FOR INVALID SENSE BITS           21800019
TM       EQU   X'80'              TEST FOR TAPE MODE                    21900019
VFCT68   EQU   68                 INDEX TO INTERPRETER ROUTINE          22200019
WTORTN   EQU   253                LOAD NAME TO WTO RTN.                 22400019
VFCF120  EQU   X'0120'            DISPLACEMENT TO TRANSLATE RTN  Y02967 22900002
CCWFLAG  EQU   4                  DISPLACEMENT TO CCW FLAG BYTE  Y02967 23400002
IDA      EQU   X'04'              TEST FOR INDIRECT ADDRESS      Y02967 23900002
IOB      EQU   X'05'              DISPLACEMENT TO IOB            Y02967 24400002
IOSERRCT EQU   X'1C'              DISP TO IOSB ERROR CNT       @YM00636 24900002
ADDRLN   EQU   3                  LENGTH OF 3 USED FOR COMPARE @YA00406 24910002
         EJECT                                                 @YM00636 24950002
         USING *,BASREG                                                 25700019
         USING EWA,ERPREG         BASE FOR WORK AREA             Y02967 25800002
         USING IOSB,IOSBREG       BASE REG FOR IOSB            @YM00636 25850002
         L     ERPREG,IOSERP      GET WORK AREA ADDRESS          Y02967 25950002
         L     COMREG,CVTADDR     GET CVT ADDRESS                       26000019
         OI    IOSFLA,IOSEX       SET EXCEPTION CONDITION ON   @YM00636 26050002
         TM    IOSFLA,IOSERR      ERP IN CONTROL               @YM00636 26100002
         BO    ERR000             YES CONTINUE                          26200019
* CLEAR IOB ERROR COUNTERS                                              26250019
         XC    EWACNTR1(CLRCNT),EWACNTR1 CLEAR COUNT             Y02967 26300002
ERR000   CLI   IOSCOD,IOSFINTC    IS IT AN INTERCEPT CONDITION @YM00636 26400002
         BE    ERR0012            YES SEE IF CHANNEL ERROR              26500019
         CLI   IOSCOD,IOSERRC     CHECK FOR X'41' IN ECB       @YA00406 26550002
         BNE   ERR001A            NO,CONTINUE                  @YA00406 26560002
         CLC   IOSCSWCA(ADDRLN),WKAREA IS CCW ADDRESS VALID?   @YA00406 26570002
         BE    ERR007             NO, PERMANENT ERROR          @YA00406 26580002
ERR001A  TM    IOSFLA,IOSACHN     IS IT MIXED CHAINING         @YA00406 26600002
         BO    ERR0012            YES SEE IF CHANNEL ERROR              26700019
         TM    IOSCC,IOSCC1       CODE EQUAL X'10'             @YM00636 26800002
         BZ    ERR002             NO CONTINUE                           26900019
         L     CCWREG,IOSVST      LOAD VIRTUAL ADDR OF CHL PGM   Y02967 27000002
         B     ERR003             CONTINUE                       Y02967 27200002
ERR0012  TM    IOSTSB,CHINTCHK    CHANNEL OR INTERFACE CHK     @YM00636 27500002
         BZ    ERR007             NO EXIT TO WTO ROUTINE                27600019
         B     ERR010             YES TO CHANNEL+INTERFACE CHK RTN      27700019
ERR002   L     CCWREG,IOSCSW-1    GET CCW ADDRESS                Y02967 27800002
         LA    CCWREG,0(CCWREG)   CLEAR HIGH ORDER BYTE                 27900019
         SH    CCWREG,ERRON1      BACK UP ONE CCW                       28000019
         TM    IOSFLA,IOSCCHN     IS COMMAND CHAINING USED     @YM00636 28100002
         BZ    ERR003             NO SET UP FOR WTO                     28200019
         TM    IOSFLA,IOSERR      ENTERED AFTER RETRY          @YM00636 28300002
         BZ    ERR002A            NO CONTINUE                           28400019
         LRA   ERREG,0(CCWREG)    LOAD REAL ADDR OF CCW          Y02967 28500002
         S     ERREG,IOSRST       SUBTRACT RESTART ADDRESS       Y02967 28600002
         BE    ERR003             IF EQUAL ERROR                        28700019
         LA    WORKR6,EWCCNTRS    POINT TO TEMPORARY ERROR     @YM00636 28800002
*                                 COUNTERS                     @YM00636 28900002
         LA    WORKR5,EWACNTR1    POINT TO IOSB ERROR CNTRS    @YM00636 29000002
         BAL   LINKR,ERR018       LINK TO COUNTER UPDATE ROUTINE        29100019
ERR002A  LRA   ERREG,0(CCWREG)    LOAD REAL ADDR OF CHANNEL PGM  Y02967 29200002
         ST    ERREG,IOSRST       SAVE CCW START ADDRESS         Y02967 29300002
ERR003   TM    IOSTSA,CSWUCK      IS IT  UNIT CHECK            @YM00636 29400002
         BZ    ERR004             NO DETERMINE ERROR TYPE               29500019
         OC    EWASTUP(SNSLEN),IOSSNS OR SENSE BITS              Y02967 30700002
         NC    EWASTUP(SNSLEN),MASKOUT MASK UNWANTED BITS        Y02967 30800002
ERR004   LR    SVREG,BASREG       SAVE BASE REGISTER                    30900019
         L     BASREG,VFCT68(COMREG) GET INTERPRETER ROUTINE ADDRESS    31000019
ERR0041  BALR  ERRETR,BASREG      LINK TO INTERPRETER            Y02967 31100002
         DC    X'1D'              TEST FOR CHANNEL CONTROL CHECK        31200019
         DC    AL1(ERR010L-ERR0041-2) BRANCH TO CCC ACTION              31300019
         DC    X'1E'              TEST FOR INTERFACE CONTROL CHECK      31400019
         DC    AL1(ERR010L-ERR0041-4) BRANCH TO ICC ACTION              31500019
         DC    X'1C'              TEST FOR CHANNEL DATA CHECK           31600019
         DC    AL1(ERR200L-ERR0041-6) BRANCH TO CDC ACTION              31700019
         DC    X'12'              CHECK FOR CONTROL UNIT END            31800019
         DC    AL1(ERR007L-ERR0041-8) BRANCH TO CUE ACTION              31900019
         DC    X'16'              CHECK FOR UNIT CHECK                  32000019
         DC    AL1(ERR006-ERR0041-10) BRANCH TO UNIT CHECK ACTION       32100019
         DC    X'2F'              END OF LIST                           32200019
         DC    AL1(ERR004B-ERR0041-12) PASS CONTROL TO ERR004B          32300019
ERR010L  B     ERR010             GO TO ERR010                          32400019
ERR200L  B     ERR200             GO TO CDC ROUTINE                     32500019
ERR007L  B     ERR007             EXIT TO WTO                           32600019
ERR004B  LR    SVREG,BASREG       SAVE BASE REGISTER                    32700019
         L     BASREG,VFCT68(COMREG) GET INTERPRETER ROUTINE ADDRESS    32800019
ERR004B1 BALR  ERRETR,BASREG      LINK TO INTERPRETER            Y02967 32900002
         DC    X'1F'              TEST FOR CHAINING CHECK               33000019
         DC    AL1(ERR011L-ERR004B1-2) BRANCH TO CC ACTION              33100019
         DC    X'1A'              TEST FOR PROGRAM CHECK                33200019
         DC    AL1(ERR007A-ERR004B1-4) BRANCH TO PC ACTION              33300019
         DC    X'1B'              TEST FOR PROTECTION CHECK             33400019
         DC    AL1(ERR007A-ERR004B1-6) BRANCH TO PC ACTION              33500019
         DC    X'19'              TEST FOR INCORRECT LENGTH             33600019
         DC    AL1(ERR017L-ERR004B1-8) BRANCH TO IL ACTION              33700019
         DC    X'17'              CHECK FOR UNIT EXCEPTION              33800019
         DC    AL1(ERR013L-ERR004B1-10) BRANCH TO UE ACTION             33900019
         DC    X'2F'              END OF LIST                           34000019
         DC    AL1(ERR004B2-ERR004B1-12) PASS CONTROL TO ERR004BI       34100019
* FOLLOWING BRANCHS GO TO ROUTINES MORE THAN 128 BYTES AWAY             34150019
ERR011L  B     ERR011             GO TO CC ACTION                       34200019
ERR017L  B     ERR017             GO TO IL ACTION                       34300019
ERR013L  B     ERR013             GO TO UE-ACTION                       34400019
ERR004B2 TM    IOSTSA,CSWUCK      IS UNIT CHECK POSTED         @YM00636 34700002
         BZ    ERR005             NO TO STATISTICS UPDATE ROUTINE       34800019
ERR004E1 TM    IOSSNS,KC          IS KEY BOARD POSTED            Y02967 34900002
         BO    ERR008             YES EXIT TO IOS                       35000019
         TM    IOSSNS+1,LATESS    IS LATE STACKER SELECT POSTED  Y02967 35100002
         BO    ERR005B            YES GO CLEAN UP                       35200019
ERR004D  TM    IOSSNS+1,NODOC     IS NO DOCUMENT POSTED          Y02967 35300002
         BO    ERR005B            YES CLEAN UP                          35400019
ERR005   NI    IOSFLA,X'FF'-IOSEX CLEAR IOB EXCPT, ERR CORRECT @YM00636 35500002
         B     ERR005B            CONTINUE CLEAN UP                     35600019
ERR005B  NI    IOSFLA,X'FF'-IOSERR CLEAR IOSERR                @YM00636 35800002
         LA    ERRE1,STAUPRTN     LOAD NAME OF STATISTICS UPDATE RTN    35900019
ERR005C  LA    WORKR5,EWCCNTRS    POINT TO TEMPORARY ERROR     @YM00636 36000002
*                                 COUNTERS                     @YM00636 36100002
         LA    WORKR6,EWACNTR1    POINT TO IOSB ERROR COUNTERS   Y02967 36200002
         BAL   LINKR,ERR018       LINK TO COUNTER UPDATE ROUTINE        36300019
         L     ERRETR,VEXCTL(COMREG) GET ADDRESS OF XCTL ROUTINE        36400019
         BR    ERRETR             EXIT VIA XCTL                         36500019
ERR006   TM    IOSSNS+1,INVSNS    ANY INVALID SENSE BITS ON      Y02967 36600002
         BC    5,ERR007           YES ALL DONE-CLEAN UP                 36700019
         CLC   IOSSNS(2),ZERO     UNIT CHECK NO SENSE          @YM00636 36730002
         BE    ERR007             YES, LOGOUT AND MSG          @YM00636 36760002
         CLC   IOSSNS(2),JTBITON  UNIT CHECK TAPE SENSE        @ZA00772 36770003
         BE    ERR007             YES  SET PERMANENT ERROR     @ZA00772 36780003
ERR0061  TM    IOSSNS+1,TM        IS IT TAPE MODE                Y02967 36800002
         BO    ERR006B            YES DETERMINE ERROR TYPE              36900019
ERR006A  TM    IOSSNS,INVSNS1     INVALID SENSE BITS ON          Y02967 37000002
         BO    ERR007             YES GO CLEAN UP                       37100019
ERR006B  LR    SVREG,BASREG       SAVE BASE ADDRESS                     37200019
         L     BASREG,VFCT68(COMREG) GET INTERPRETER ROUTINE ADDRESS    37300019
ERR006C  BALR  ERRETR,BASREG      LINK TO INTERPRETER            Y02967 37400002
         DC    X'03'              TEST FOR EQUIPMENT CHECK              37500019
         DC    AL1(ERR012L-ERR006C-2) BRANCH TO EC ROUTINE     @YM00636 37600002
         DC    X'06'              TEST FOR NONRECOVERY         @YM00634 37700002
         DC    AL1(ERR007-ERR006C-4) BRANCH TO NONREC ROUTINE  @YM00634 37800002
         DC    X'01'              TEST FOR INTERVENTION REQ'ED @YM00634 37900002
         DC    AL1(ERR006D-ERR006C-6) BRANCH TO IR ROUTINE     @YM00634 38000002
         DC    X'02'              TEST FOR BUS OUT CHECK                38100019
         DC    AL1(ERR015L-ERR006C-8) BRANCH TO BUS OUT CHECK ROUTINE   38200019
         DC    X'04'              TEST FOR DATA CHECK                   38300019
         DC    AL1(ERR014L-ERR006C-10) BRANCH TO DATA CHECK ROUTINE     38400019
         DC    X'05'              TEST FOR OVERRUN                      38500019
         DC    AL1(ERR016L-ERR006C-12) BRANCH TO OVERRUN ROUTINE        38600019
         DC    X'00'              TEST FOR COMMAND REJECT               38700019
         DC    AL1(ERR007A-ERR006C-14) BRANCH TO COMMAND REJECT ROUTINE 38800019
         DC    X'0C'              TEST FOR INVALID OPERATION            38900019
         DC    AL1(ERR007-ERR006C-16)  BRANCH TO INVALID OPERATION RTN  39000019
         DC    X'2F'              END OF LIST                           39100019
         DC    AL1(ERR004BL-ERR006C-18) CONTINUE CHECKING FOR ERRORS    39200019
ERR012L  B     ERR012             GO TO EC ACTION                       39300019
ERR015L  B     ERR015             GO TO BUS OUT ACTION                  39400019
ERR014L  B     ERR014             GO TO DATA CHECK ACTION               39500019
ERR016L  B     ERR016             GO TO OVERRUN ACTION                  39600019
ERR004BL B     ERR004B2           CONTINUE CHECKING            @YM00636 39700002
ERR006D  OI    IOSFLA,IOSERR      SET IOSERR ON                @YM00636 39800002
         B     ERR007B            GO WRITE TO OPERATOR                  39900019
* EXIT TO WTO ROUTINE                                                   40000019
ERR007   OI    IOSFLB,IOSLOG      SET LOGOUT FALG                Y02967 40100002
ERR007A  OI    IOSFLB,IOSMSG      SET MESSAGE FLAG               Y02967 40160002
         NI    EWAFLG2,X'FF'-EWAMDR  SET FLAG BIT FOR OBR        Y02967 40220002
         NI    IOSFLA,X'FF'-IOSERR CLEAR IOSERR FLAG           @YM00636 40300002
ERR007B  LA    ERRE1,WTORTN       LOAD NAME OF WTO ROUTINE              40400019
         B     ERR005C            GET OUT VIA XCTL                      40500019
ERR008   NI    IOSFLA,X'FF'-IOSERR CLEAR IOSERR FLAG           @YM00636 40600002
         LA    WORKR5,EWCCNTRS    POINT TO TEMPORARY ERROR     @YM00636 40700002
*                                 COUNTERS                     @YM00636 40800002
         LA    WORKR6,EWACNTR1    POINT TO IOSB ERROR COUNT    @YM00636 40900002
         BAL   LINKR,ERR018       LINK TO COUNTER UPDATE ROUTINE        41000019
         SVC   ERRORSVC           ISSUE ERROR EXCP                      41100019
         SVC   RETSVC             RETURN TO IOS VIA SVC 3               41200019
*   UPDATE EWA ERROR COUNTERS ROUTINE                            Y02967 41300002
ERR018   SR    WORKR4,WORKR4      ZERO OUT                     @YM00636 41400002
         SR    WORKR9,WORKR9      WORK REGISTERS               @YM00636 41500002
         IC    WORKR4,DC(WORKR5)  GET DATA                     @YM00636 41600002
         IC    WORKR9,DC(WORKR6)  CHECK COUNTS                 @YM00636 41700002
         AR    WORKR4,WORKR9      ADD COUNTS                   @YM00636 41800002
         STC   WORKR4,DC(WORKR6)  UPDATE DATA CHECK COUNT      @YM00636 41900002
         IC    WORKR4,ILC(WORKR5) GET INCORRECT                @YM00636 42000002
         IC    WORKR9,ILC(WORKR6) LENGTH COUNTS                @YM00636 42100002
         AR    WORKR4,WORKR9      ADD COUNTS                   @YM00636 42200002
         STC   WORKR4,ILC(WORKR6) UPDATE INCORRECT LENGTH COUNT         42300002
         IC    WORKR4,EC(WORKR5)  GET EQUIPMENT CHECK          @YM00636 42400002
         IC    WORKR9,EC(WORKR6)  CHECK COUNTS                 @YM00636 42500002
         AR    WORKR4,WORKR9      ADD COUNTS                   @YM00636 42600002
         STC   WORKR4,EC(WORKR6)  UPDATE EQUIPMENT CHECK COUNT @YM00636 42700002
CLEAR1   XC    0(CLEARCNT,WORKR5),0(WORKR5) CLEAR ERROR CNTRS    Y02967 42800002
         TM    IOSDVRID,IOSXCPID  DRIVER ID EXCP                 Y02967 42820002
         BNO   ERR018A            NO,IOB DOES NOT EXIST          YM2511 42840002
         L     WORKR4,IOSUSE      LOAD ADDRESS OF RQE            Y02967 42860002
         L     WORKR4,IOB-1(WORKR4) LOAD ADDRESS OF IOB          Y02967 42880002
         MVC   IOSERRCT(4,WORKR4),0(WORKR6) MOVE ERROR COUNTERS  Y02967 42900002
ERR018A  BR    LINKR              RETURN                         Y02967 42920002
* CHANNEL DATA CHECK ROUTINE                                   @YM00636 43000002
ERR200   TM    EWACNTR3,CDCCNT    CHANNEL DATA CHECK           @YM00636 43100002
         BO    ERR007             YES EXIT TO WTO ROUTINE               43200019
         OI    EWACNTR3,CDCCNT    SET TO INDICATE RETRIED      @YM00636 43300002
* RETRY ROUTINE                                                         43400019
ERR009   SR    WORKR3,WORKR3      CLEAR REGISTER               @YM00636 43500002
               XC    IOSSNS(2),IOSSNS                          @ZA00415 43550003
         IC    WORKR3,0(CCWREG)   GET OP CODE                  @YM00636 43570002
         N     WORKR3,CLEARHI     CLEAR TOP FOUR BITS          @YM00636 43640002
         CLM   WORKR3,1,RBTEST    IS COMMAND READ BACKWARD     @YM00636 43710002
         BE    ERR009B            YES CLEAR INPUT AREA & RETRY          43800019
         N     WORKR3,BITS56      CLEAR BITS 5+6               @YM00636 43900002
         CLM   WORKR3,1,RFTEST    IS COMMAND READ FORWORD      @YM00636 44000002
         BE    ERR009B            YES CLEAR INPUT AREA & RETRY          44100019
ERR009A  OI    IOSFLA,IOSERR      SET IOSERR ON                @YM00636 44200002
         SVC   ERRORSVC           RETRY CCW                             44300019
         SVC   RETSVC             RETURN TO IOS VIA SVC 3               44400019
* CLEAR INPUT AREA                                                      44500019
*   THE REAL DATA ADDRESS IN THE CCW IS TRANSLATED TO A          Y02967 44600002
*   VIRTUAL ADDRESS. IF INDIRECT ADDRESSING IS SPECIFIED IN      Y02967 44610002
*   THE CCW,EACH ADDRESS IN THE IDA LIST IS TRANSLATED.          Y02967 44620002
ERR009B  LR    WORKR4,IOSBREG     SAVE IOSB REGISTER           @YM00636 44630002
         L     RVREG,0(CCWREG)    GET REAL INPUT AREA ADDR       Y02967 44640002
         N     RVREG,MASK1        CLEAR OUT COMMAND CODE         Y02967 44650002
         LA    RVREG,1(RVREG)     INCREMENT ADDR BY ONE          Y02967 44660002
         LR    SVREG,BASREG       SAVE BASE REGISTER             Y02967 44670002
         L     BASREG,VFCF120(COMREG)  GET ADDR OF TRANSLATE RTN YM2511 44680002
         BALR  ERRETR,BASREG      LINK TO TRANSLATE ROUTINE      Y02967 44690002
         LR    BASREG,SVREG       RESTORE BASE REGISTER          Y02967 44700002
         BCTR  RVREG,0            DECREMENT ADDR BY ONE          Y02967 44710002
         LR    ERRE1,RVREG        SAVE VITUAL ADDR OF IO LIST    Y02967 44720002
         LR    VTLREG,RVREG       SAVE VITUAL ADDR OF IO AREA    Y02967 44730002
         LR    IOSBREG,WORKR4     RESTORE IOSB REGISTER        @YM00636 44740002
         LH    WORKR6,BYTECNT(CCWREG) GET BYTE COUNT             Y02967 44750002
         TM    CCWFLAG(CCWREG),IDA INDIRECT ADDRESSING SPECIFED  Y02967 44760002
         BZ    ERR009H            NO, IO ADDRESS CORRECT         Y02967 44770002
*                                                                Y02967 44780002
*   IDA IS SPECIFIED. TRANSLATE EACH ADDRESS IN LIST             Y02967 44790002
*                                                                Y02967 44800002
ERR009C  L     RVREG,0(ERRE1)     GET ADDRESS IN IDA LIST        Y02967 44810002
         LA    RVREG,1(RVREG)     INCREMENT ADDR BY ONE          Y02967 44820002
         LR    SVREG,BASREG       SAVE BASE REGISTER             Y02967 44830002
         L     BASREG,VFCF120(COMREG)  GET ADDR OF TRANSLATE RTN YM2511 44840002
         BALR  ERRETR,BASREG      LINK TO TRANSLATE ROUTINE      Y02967 44850002
         LR    BASREG,SVREG       RESTORE BASE REGISTER          Y02967 44860002
         BCTR  RVREG,0            DECREMENT ADDR BY ONE          Y02967 44870002
         LR    VTLREG,RVREG       SAVE ADDRESS OF IO AREA        Y02967 44880002
ERR009D  LR    IOSBREG,WORKR4     RESTORE IOSB REGISTER        @YM00636 44890002
*   THE VIRTUAL ADDRESS IS DIVIDED BY THE PAGE SIZE(4096)  THE   Y02967 44900002
*   REMAINDER IS USED TO DETERMINE HOW MANY BYTES CAN BE         Y02967 44910002
*   CLEARED IN THE NEXT EXECUTE INSTRUCTION.                     Y02967 44920002
         LR    WORKR4,VTLREG      LOAD VITUAL ADDR OF IO ADRA    Y02967 44930002
         SRDA  WORKR4,32(0)       SHIFT INTO ODD REGISTER        Y02967 44940002
         D     WORKR4,CON4096     DIVIDE ADDR BY PAGE SIZE       Y02967 44950002
         LA    WORKR4,1(WORKR4)   ADJUST REMAINDER               Y02967 44960002
         CLM   WORKR3,1,RFTEST    IS COMMAND READ FORWARD      @YM00636 44970002
         BE    ERR009F            YES, ADDRESS CORRECT           Y02967 44980002
         CR    WORKR4,WORKR6      REMAINDER GE BYTE COUNT        Y02967 44990002
         BNL   ERR009E            YES, CLEAR ENTIRE IO AREA      Y02967 45000002
         SR    WORKR6,WORKR4      SUBTRACT NO. OF BYTES IN PAGE  Y02967 45010002
         BCTR  WORKR4,0           DECREMENT COUNT BY ONE         Y02967 45020002
         SR    VTLREG,WORKR4      ADJUST IO ADDRESS              Y02967 45030002
         B     ERR009G            GO CLEAR INPUT AREA            Y02967 45040002
ERR009E  BCTR  WORKR6,0           DECREMENT COUNT BY ONE         Y00620 45050002
         SR    VTLREG,WORKR6      ADJUST IO ADDRESS              Y00620 45060002
         B     ERR009I            GO CLEAR INPUT AREA            Y02967 45070002
ERR009F  S     WORKR4,CON4096     COMPUTE NO. OF                 Y02967 45080002
         LPR   WORKR4,WORKR4      BYTES LEFT IN PAGE             Y02967 45090002
         LA    WORKR4,1(WORKR4)   ADJUST NO. OF BYTES            Y02967 45100002
         CR    WORKR4,WORKR6      REMAINDER GE BYTE COUNT        Y02967 45110002
         BNL   ERR009H            YES, CLEAR ENTIRE IO AREA      Y02967 45120002
         SR    WORKR6,WORKR4      SUBTRACT NO. OF BYTES IN PAGE  Y02967 45130002
         BCTR  WORKR4,0           DECREMENT COUNT BY ONE         Y02967 45140002
ERR009G  EX    WORKR4,CLEAR       CLEAR INPUT AREA               Y02967 45150002
         LA    ERRE1,4(ERRE1)     INCREMENT TO NEXT IO ADDRESS   Y02967 45160002
         LR    WORKR4,IOSBREG     SAVE IOSB REGISTER           @YM00636 45170002
         B     ERR009C            GO TRANSLATE NEXT ADDRESS      Y02967 45180002
ERR009H  BCTR  WORKR6,0           DECREMENT COUNT BY ONE         Y02967 45190002
         CLM   WORKR3,1,RFTEST    IS COMMAND READ FORWARD      @YM00636 45200002
         BE    ERR009I            YES,IO ADDRESS OK              Y02967 45210002
         SR    VTLREG,WORKR6      ADJUST IO ADDRESS              Y02967 45220002
ERR009I  EX    WORKR6,CLEAR       CLEAR OUT DATA AREA            Y02967 45230002
         B     ERR009A            RETRY BAD CCW                  Y02967 45240002
* CHANNEL CHECK ROUTINE                                                 45600019
ERR010   LA    WORKR5,EWAERPIB    LOAD ADDR OF ERPIB             Y02967 45700002
ERR010B  XC    0(ERPIBLEN,WORKR5),0(WORKR5) CLEAR ERPIB        @YM00636 46600002
         B     ERR007             GO TO LOGOUT ROUTINE                  46700019
* CHAINING CHECK ROUTINE                                                46800019
ERR011   IC    WORKR5,EWACNTR4    GET CHAINING CK COUNT        @YM00636 46900002
         LA    WORKR5,1(WORKR5)   INCREMENT COUNT              @YM00636 47000002
         STC   WORKR5,EWACNTR4    UPDATE COUNT                 @YM00636 47100002
         TM    EWACNTR4,CCCNT     IS COUNT FIVE                @YM00636 47200002
         BO    ERR007             YES TO LOGOUT                         47300019
         B     ERR009             NO RETRY                              47400019
* EQUIPMENT CHECK                                                       47500019
ERR012   IC    WORKR5,EWACNTR3    GET EQUIPMENT CK COUNT       @YM00636 47600002
         LA    WORKR5,1(WORKR5)   INCREMENT COUNT              @YM00636 47700002
         STC   WORKR5,EWACNTR3    UPDATE COUNTERS              @YM00636 47800002
         TM    IOSSNS+1,TM        IS IT TAPE MODE                Y02967 47810002
         BO    ERR012B            YES TEST FOR A FIVE COUNT    @YM00636 47820002
         CLI   EWACNTR3,EQCNT2    IS COUNT NOW THREE             Y02967 47830002
         BE    ERR008             YES EXIT TO IOS              @YM00636 47840002
         B     ERR009             NO RETRY                     @YM00636 47850002
ERR012B  EQU   *                                                  21797 47860001
         CLI   EWACNTR3,EQCNT     IS COUNT NOW TEN               Y02967 47900002
         BE    ERR008             YES TO IOS                     A33936 48000001
         B     ERR009             NO RETRY                              48100019
* UNIT EXCEPTION                                                        48200019
ERR013   TM    IOSFLA,IOSERR      IOSERR ON                    @YM00636*48300002
                                  (ENTERED AFTER RETRY)        @YM00636 48310002
         BZ    ERR013B            NO CONTINUE                           48400019
ERR013A  NI    IOSFLA,X'FF'-IOSEX SET IOBEX OFF                @YM00636 48500002
         B     ERR005B            TO STATISTICS UPDATE ROUTINE          48600019
ERR013B  TM    IOSCC,IOSCC1       SIO CONDITION 01             @YM00636 48700002
         BO    ERR005B            YES TO STATISTICS UPDATE ROUTINE      48800019
         SR    WORKR3,WORKR3      CLEAR WORK REGISTER          @YM00636 48900002
         IC    WORKR3,0(CCWREG)   GET COMMAND CODE             @YM00636 48970002
         N     WORKR3,BITS56      CLEAR BITS 5+6               @YM00636 49040002
         CLM   WORKR3,1,RFTEST    IS COMMAND READ FORWARD      @YM00636 49110002
         BE    ERR009B            YES GO CLEAR INPUT AREA AND RETRY     49200019
         B     ERR005B            NO TO STATISTICS UPDATE ROUTINE       49300019
* DATA CHECK ROUTINE                                                    49400019
ERR014   IC    WORKR5,EWACNTR1    GET DATA CHECK ERROR COUNT     Y02967 49500002
         LA    WORKR5,1(WORKR5)   INCREMENT COUNT              @YM00636 49600002
         STC   WORKR5,EWACNTR1    UPDATE DATA CHECK ERROR COUNT  Y02967 49700002
         TM    IOSSNS+1,TM        IS IT TAPE MODE                Y02967 49800002
         BO    ERR014B            YES PROCESS TAPE                      49900019
ERR014A  TM    0(CCWREG),OLC      IS IT ON-LINE CORRECTION              50000019
         BO    ERR008             YES TO IOS                     A33926 50100020
         TM    EWACNTR1,DCCOUNT1  IS COUNT NOW THREE             Y02967 50200002
         BO    ERR008             YES TO IOS                     A33926 50300020
         B     ERR009             NO RETRY                              50400019
ERR014B  TM    IOSSNS,KC          IS IT KEYBOARD CORRECTION      Y02967 50500002
         BO    ERR008             YES TO IOS                     A33926 50600020
         TM    EWACNTR1,DCCOUNT2  DATA CHECK COUNT EQUAL 5     @YM00636 50700002
         BO    ERR008             YES TO IOS                     A33926 50800020
         B     ERR009             NO RETRY                              50900019
* BUSOUT CHECK                                                          51000019
ERR015   TM    EWACNTR4,BOCOUNT   BUSOUT CHECK COUNT EQUAL ONE   Y02967 51100002
         BO    ERR007             YES TO WTO ROUTINE                    51200019
         OI    EWACNTR4,BOCOUNT   SET COUNT TO ONE               Y02967 51300002
         B     ERR009             RETRY                                 51400019
* OVERRUN                                                               51500019
ERR016   IC    WORKR5,EWACNTR4    GET OVERRUN ERROR COUNT      @YM00636 51600002
         LA    WORKR5,INCCOUNT(WORKR5) INCREMENT COUNT         @YM00636 51700002
         STC   WORKR5,EWACNTR4    UPDATE ERROR COUNT           @YM00636 51800002
         TM    EWACNTR4,ORCOUNT   DOES COUNT EQUAL FIVE          Y02967 51900002
         BO    ERR007             YES EXIT TO WTO ROUTINE               52000019
         B     ERR009             NO RETRY                              52100019
* INCORRECT LENGTH                                                      52200019
ERR017   TM    IOSFLA,IOSERR ENTERED AFTER RETRY               @YM00636 52300002
         BZ    ERR017A            NO                                    52400019
         TM    EWACNTR2,ZEROCNT   FIRST TIME HERE                Y02967 52500002
         BC    5,ERR017A          NO CONTINUE                           52600019
         NI    IOSFLA,X'FF'-IOSEX CLEAR IOBEX                  @YM00636 52700002
         B     ERR008             EXIT TO IOS                           52750019
ERR017A  IC    WORKR5,EWACNTR2    GET INCORRECT LENGTH COUNT     Y02967 52800002
         LA    WORKR5,1(WORKR5)   INCREMENT ERROR COUNT        @YM00636 52900002
         STC   WORKR5,EWACNTR2    UPDATE COUNTERS                Y02967 53000002
         TM    IOSSNS+1,TM        IS IT TAPE MODE                Y02967 53010002
         BO    ERR017B            YES TEST FOR A FIVE COUNT    @YM00636 53020002
         CLI   EWACNTR2,ILCOUNT2  IS COUNT NOW THREE             Y02967 53030002
         BE    ERR008             YES EXIT TO IOS              @YM00636 53040002
         B     ERR009             NO RETRY                     @YM00636 53050002
ERR017B  EQU   *                                                  21797 53060001
         CLI   EWACNTR2,ILCOUNT   IS COUNT NOW FIVE              Y02967 53100002
         BE    ERR008             YES EXIT TO IOS                       53200019
         B     ERR009             NO RETRY                              53300019
         DS    0H                 FORCE HALF WORD ALIGNMENT             53400019
ERRON1   DC    AL2(8)             CONSTANT OF 8                         53500019
MASKOUT  DC    X'267F'            MASK FOR CLEARING            @YM00636 53700002
*                                 UNWANTED SENSE DATA          @YM00636 53750002
WKAREA   DC    XL2'00'            CHECK FOR VALID CCW ADDR     @YA00406 53760002
ZERO     DC    XL2'00'            TEST FOR UC NO SENSE         @YM00636 53800002
JTBITON  DC    XL2'0080'          TEST FOR UC TAPE SENSE       @ZA00772 53802003
         DS    0F                                                Y02967 53805002
MASK1    DC    X'00FFFFFF'        MASK FOR HIGH ORDER BYTE       Y02967 53810002
CON4096  DC    X'00001000'        PAGE SIZE                      Y02967 53815002
CLEARHI  DC    XL4'0F'            CLEAR FOUR BITS OF BYTE        Y02967 53820002
BITS56   DC    XL4'03'            CLEAR BITS 5 + 6               Y02967 53825002
RFTEST   DC    X'02'              TEST FOR READ FORWARD COMMAND  Y02967 53830002
RBTEST   DC    X'0C'              TEST FOR READ BACKWARD COMMAND Y02967 53835002
CLEAR    XC    0(0,VTLREG),0(VTLREG)    CLEAR INPUT AREA         Y02967 53840002
         IECDIOSB                                                Y02967 53845002
         IECDERWA                                                       53850002
*****************************************************************Y02967 53855002
*                                                                Y02967 53860002
*   THIS DSECT DESCRIBES THE OPTICAL CHARACTER READER DEVICE DEPEY02967 53865002
*   SECTION OF THE ERP WORKAREA                                  Y02967 53870002
*                                                                Y02967 53875002
*****************************************************************Y02967 53880002
         ORG   EWAIERP                                           Y02967 53885002
EWCSNS   DS    XL8                EXTENDED SENSE BYTES           Y02967 53890002
EWCCNTRS DS    XL4                TEMPORARY ERROR COUNTERS       Y02967 53895002
         END   IGE0011C                                                 53900019
./  ADD  SSI=72710015,NAME=IGE0011D
* /* START OF SPECIFICATIONS ****                                       00010002
*01* PROCESSOR = ASSEMXF-370R                                           00020002
**** END OF SPECIFICATIONS ***/                                         00030002
IGE0011D CSECT                    ENTRY POINT FOR 1288 ERP              00050019
         TITLE 'IGE0011D - 1288 OPTICAL CHARACTER READER ERP'           00100019
*********************************************************************** 00200019
*MODULE-NAME                                                   @YM00638 00210002
* IGE0011D                                                     @YM00638 00220002
*                                                              @YM00638 00222002
*DESCRIPTIVE-NAME                                              @YM00638 00224002
* OCR ERP MODULE FOR 1288 DEVICE                               @YM00638 00226002
*                                                              @YM00638 00228002
*COPYRIGHT                                                     @YM00638 00228402
* NONE                                                         @YM00638 00228802
*                                                              @YM00638 00229202
*CHANGE-ACTIVITY                                               @YM00638 00229602
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                00230020
*C503000                                                         A33926 00260020
*D360000                                                         A33936 00270001
*C482000,533000                                                  A33936 00280001
*                                                                       00285001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                00290001
*C17600,180000                                                    21797 00295001
*C379000-382000                                                  A39680 00297001
*                                                                       00297602
* RELEASE VS/2 2.0 ADDITIONS / CHANGES / DELETIONS                      00298202
*A258000                                                         YM2510 00298502
*A222000                                                         Y02967 00298802
*C046000,069000,073000,075000,079000,096000-097000,150000,151000 Y02967 00305802
*C162000,256000-257000,261000-262000,266000,268000-272000,273000 Y02967 00312802
*C276000,283000-284000,286000-288000,290000-292000,305000-307000 Y02967 00319802
*C310000,330000,347000,350000,356000,363000-365000,369000,372000 Y02967 00326802
*C379000-382000                                                  A01004 00333802
*C376000,403000,404000,409000-411000,415000,430000-431000,433000 Y02967 00340802
*C435000,437000-439000,441000-442000,448000-457000,459000-467000 Y02967 00347802
*C471000,473000-4740008478000,480000-481000,497000,499000-502000 Y02967 00354802
*C506000,508000,511000,513003-514000,520000,524000,526000-527000 Y02967 00361802
*C534000,                                                        Y02967 00368802
*C174000,433000,435000                                           YM2510 00370802
*C247000,430400,448800,450400                                    YM2511 00372802
*D071000-072000,093000-095000,098000-103000,116000-124000        Y02937 00375802
*D132000-138000,207000-210000,294000-304000,                            00382802
*TITLE 'IGE0011D' - 1288 ERROR RECOVERY PROCEDURES                    * 00400019
*                                                                     * 00500019
* STATUS RELEASE VS2 / 2.0 CHANGE LEVEL 0000                            00600002
*                                                                     * 00700019
*FUNCTION/OPERATION   IGE0011D IS SCHEDULED FOR EXECUTION WHENEVER THE* 00800019
*   I/O SUPERVISOR DETECTS AN ERROR ASSOCIATED WITH THE 1288 OPTICAL  * 00900019
*   CHARACTER READER THAT REQUIRES ERROR RECOVERY PROCEDURES.         * 01000019
*                                                                     * 01100019
*                                                                     * 01200019
*   THE ERROR ROUTINE USES THE STANDARD ERROR INTERPRETER ROUTINE FOR * 01300019
*   TESTING OF SENSE BITS AND CSW STATUS BITS. THE FOLLOWING ACTIONS  * 01400019
*   ARE TAKEN DEPENDING UPON THE NATURE OF THE ERROR                  * 01500019
*                                                                     * 01600019
*   1)  NORMAL CONDITION OR SUCCESSFUL RETRY OF RECOVERABLE ERROR     * 01700019
*       CONDITION                                                     * 01800019
*                                                                     * 01900019
*       IOSB EXCEPTION, ERROR FLAGS ARE CLEARED AND CONTROL IS @YM00636 02000002
*       TRANSFERRED TO THE STATISTICS UPDATE ROUTINE.                 * 02100019
*   2)  RECOVERABLE ERROR                                             * 02200019
*                                                                     * 02300019
*       IOSB ERROR FLAG IS SET.                                @YM00636 02400002
*       IOSB EXCEPTION FLAG IS CLEARED.                        @YM00636 02500002
*       ERROR COUNTS ARE UPDATED.                                     * 02600019
*       CONTROL IS PASSED TO THE I/O SUPERVISOR VIA SVC 15 AND SVC 3  * 02700019
*       TO RETRY THE CHANNEL PROGRAM.                                 * 02800019
*                                                                     * 02900019
*   3)  PERMANENT ERROR                                               * 03000019
*       IOSB ERROR AND EXCEPTION FLAGS ARE SET.                @YM00636 03100002
*       IOSB MESSAGE AND LOGOUT FLAGS MAY BE SET.              @YM00636 03200002
*       CONTROL IS RETURNED TO THE I/O SUPERVISOR EITHER DIRECTLY     * 03300019
*       THROUGH ISSUANCE OF AN SVC 15 AND AN SVC 3 OR INDIRECTLY BY   * 03400019
*       FIRST PASSING CONTROL TO THE WTO ROUTINE WHICH IN TURN PASSES * 03500019
*       CONTROL TO THE STATISTICS UPDATE ROUTINE AND THE I/O OUTBOARD * 03600019
*       RECORDING ROUTINE, IF REQUIRED, AND EVENTUALLY TO THE I/O     * 03700019
*       SUPERVISOR.                                                   * 03800019
*                                                                     * 03900019
*ENTRY POINTS                                                         * 04000019
*       IGE0011D - ERROR RECOVERY PROCEDURE ENTRY POINT               * 04100019
*                                                                     * 04200019
*       DATA PASSED TO THE ROUTINE CONSISTS OF STANDARD SYSTEM CONTROL* 04300019
*       BLOCKS.                                                       * 04400019
*                                                                     * 04500019
*INPUT  IOSB POINTER IN REGISTER 1                               Y02967 04600002
*                                                                     * 04700019
*OUTPUT I/O ERROR AND INTERVENTION REQUIRED MESSAGES IN SOME INSTANCES* 04800019
*                                                                     * 04900019
*EXTERNAL ROUTINES  ERROR INTERPRETER ROUTINE                         * 05000019
*                                                                     * 05100019
*EXITS-NORMAL  XCTL TO STATISTICS UPDATE ROUTINE FOLLOWING SUCCESSFUL * 05200019
*       RECOVERY OF A RETRYABLE ERROR OR UPON DETECTION OF A NORMAL   * 05300019
*       CONDITION.                                                    * 05400019
*                                                                     * 05500019
*     -ERROR                                                          * 05600019
*                                                                     * 05700019
*   1)  SVC 15 AND SVC 3 EXIT TO I/O SUPERVISOR FOR RE-EXECUTION OF   * 05800019
*       THE CHANNEL PROGRAM UPON DETECTION OF A RETRYABLE ERROR.      * 05900019
*                                                                     * 06000019
*   2)  XCTL TO WTO ROUTINE FOR ISSUANCE OF A PERMANENT I/O ERROR     * 06100019
*       MESSAGE AND UPDATING OF STATISTICS AND SYS1.LOGREC IN THE CASE* 06200019
*       OF SOME PERMANENT ERRORS.                                     * 06300019
*                                                                     * 06400019
*   3)  SVC 15 AND SVC 3 EXIT TO I/O SUPERVISOR IN THE CASE OF SOME   * 06500019
*       PERMANENT I/O ERRORS.                                         * 06600019
*                                                                     * 06700019
*TABLES/WORK AREAS                                                    * 06800019
*   1)  INPUT/OUTPUT SYSTEM BLOCK (IOSB)                         Y02967 06900002
*                                                                     * 07000019
*   3)  DYNAMIC WORK AREA                                        Y02967 07300002
*                                                                     * 07400019
*   4)  STATISTICS UPDATE TABLE                                  Y02967 07500002
*                                                                     * 07600019
*ATTRIBUTES                                                           * 07700019
*                                                                     * 07800019
*       RE-ENTRANT,SUPERVISOR MODE                               Y02967 07900002
*                                                                     * 08000019
*NOTES                                                                * 08100019
*                                                                     * 08200019
*       N/A                                                           * 08300019
*                                                                     * 08400019
*                                                                     * 08500019
*********************************************************************** 08600019
         EJECT                                                 @YA00406 08650002
*********************************************************************** 13900019
*                                                                     * 14000019
*        STATUS INDICATORS                                            * 14100019
*                                                                     * 14200019
*********************************************************************** 14300019
CSWUCK   EQU   X'02'              UNIT CHECK                            14400019
*********************************************************************** 14500019
*                                                                     * 14600019
*        REGISTER DEFINITION                                          * 14700019
*                                                                     * 14800019
*********************************************************************** 14900019
IOSBREG  EQU   1                  IOSB REG                     @YM00636 15000002
RVREG    EQU   1                  WORK REGISTER                  Y02967 15050002
CCWREG   EQU   2                  CCW ADDRESS REGISTER                  15100019
WORKR3   EQU   3                  WORK REGISTER                @YM00636 15150002
ERREG    EQU   4                  WORK REGISTER                         15200019
WORKR4   EQU   4                  WORK REGISTER                @YM00636 15300002
WORKR5   EQU   5                  WORK REGISTER                @YM00636 15500002
WORKR6   EQU   6                  WORK REGISTER                @YM00636 15600002
COMREG   EQU   8                  COMMUNICATION TABLE REG               15900019
SVREG    EQU   9                  WORK REGISTER                         16000019
WORKR9   EQU   9                  WORK REGISTER                @YM00636 16100002
ERPREG   EQU   10                 DYNAMIC WORKAREA REG           Y02967 16200002
VTLREG   EQU   11                 ADDR OF VIRTUAL I/O AREA       Y02967 16250002
LINKR    EQU   12                 WORK REGISTER                         16300019
ERRE1    EQU   13                 WORK REGISTER                         16500019
ERRETR   EQU   14                 RETURN REG                            16600019
BASREG   EQU   15                 BASE REGISTER                         16700019
*********************************************************************** 16800019
*                                                                     * 16900019
*        RETRY COUNTS                                                 * 17000019
*                                                                     * 17100019
*********************************************************************** 17200019
BOCOUNT  EQU   X'08'              TEST FOR BUS OUT CHECK RETRIED        17300019
CDCCNT   EQU   X'08'              TEST FOR CHANNEL DATA CHK    @YM00636 17400002
CCCNT    EQU   5                  TEST FOR CHAINING CHECK RETRY         17500002
EQCNT    EQU   X'03'              TEST FOR EQUIPMENT CHECK RETRY  21797 17600001
DCCOUNT1 EQU   X'03'              DOCUMENT DATA CHECK RETRY COUNT       17700019
INCCOUNT EQU   16                 INCREMENT FOR OVERRUN RETRY COUNT     17800019
ORCOUNT  EQU   X'50'              OVERRUN RETRY COUNT (FIVE)            17900019
ILCOUNT  EQU   X'03'              INCORRECT LENGTH RETRY COUNT    21797 18000001
         EJECT                                                 @YA00406 18050002
*********************************************************************** 18100019
*                                                                     * 18200019
*        MISCELLANEOUS DEFINITIONS                                    * 18300019
*                                                                     * 18400019
*********************************************************************** 18500019
VEXCTL   EQU   44                 ADDR OF XCTL ROUTINE                  18600019
STAUPRTN EQU   254                STATISTICS UPDATE ROUTINE             18700019
CVTADDR  EQU   16                 POINTER TO CVT ADDRESS                18800019
BYTECNT  EQU   6                  DISPLACMENT TO BYTE COUNT IN CCW      18900019
CLRCNT   EQU   X'03'              BYTE COUNT FOR CLEARING COUNTERS      19300019
CHINTCHK EQU   X'06'              TEST FOR CHANNEL OR INTERFACE CHECK   19400019
SNSLEN   EQU   2                  LENGTH OF SENSE BYTES TO PUT IN STATA 19700019
EOP      EQU   X'40'              TEST FOR END OF PAGE                  19900019
NODOC    EQU   X'20'              TEST FOR NO DOCUMENT FOUND            20000019
INVSNS   EQU   X'97'              TEST FOR INVALID SENSE BITS           20100019
INVSNS1  EQU   X'01'              TEST FOR INVALID SENSE BIT            20200019
CLEARCNT EQU   X'02'              COUNT OF ERROR COUNTER BYTES TO CLEAR 20300019
ERRORSVC EQU   15                 ERROR EXCP                            20400019
RETSVC   EQU   3                  RETURN TO IOS SVC                     20500019
ERPIBLEN EQU   8                  ERPIB LENGTH                          21300019
DC       EQU   0                  DISPLACEMENT TO DATA CHECK COUNTS     21400019
ILC      EQU   1                  DISPLACEMENT TO INCORRECT LENGTH CNTS 21500019
EC       EQU   2                  DISPLACEMENT TO EQUIPMENT CHECK CNTS  21600019
ZEROCNT  EQU   X'0F'              TEST FOR FIRST RETRY, INC LENGTH      21800019
VFCT68   EQU   68                 INDEX TO INTERPRETER ROUTINE          22000019
WTORTN   EQU   253                LOAD NAME TO WTO RTN.                 22200019
VFCF120  EQU   X'0120'            DISPLACEMENT TO TRANSLATE RTN  Y02967 22700002
CCWFLAG  EQU   4                  DISPLACEMENT TO CCW FLAG BYTE  Y02967 23200002
IDA      EQU   X'04'              TEST FOR INDIRECT ADDRESS      Y02967 23700002
IOB      EQU   X'05'              DISPLACEMENT TO IOB          @YM00636 24200002
IOSERRCT EQU   X'1C'              DISP TO IOSB ERROR CNT       @YM00636 24250002
ADDRLN   EQU   3                  LENGTH OF 3 USED FOR COMPARE @YA00406 24300002
         EJECT                                                 @YA00406 24350002
         USING *,BASREG                                                 25500019
         USING EWA,ERPREG         BASE FOR WORK AREA             Y02967 25600002
         USING IOSB,IOSBREG       BASE REG FOR IOSB            @YM00636 25650002
         L     ERPREG,IOSERP      GET WORK AREA ADDRESS          Y02967 25750002
         L     COMREG,CVTADDR     GET CVT ADDRESS                       25800019
         OI    IOSFLA,IOSEX       SET EXCEPTION CONDITION ON   @YM00636 25850002
         TM    IOSFLA,IOSERR      ERP IN CONTROL               @YM00636 25900002
         BO    ERR000             YES CONTINUE                          26000019
* CLEAR IOSB ERROR COUNTERS                                    @YM00636 26050002
         XC    EWACNTR1(CLRCNT),EWACNTR1 CLEAR COUNT             Y02967 26100002
ERR000   CLI   IOSCOD,IOSFINTC    IS IS AN INTERCEPT CONDITION @YM00636 26200002
         BE    ERR0012            YES SEE IF CHANNEL ERROR              26300019
         CLI   IOSCOD,IOSERRC     CHECK FOR X'41' IN ECB       @YA00406 26350002
         BNE   ERR001A            NO,CONTINUE                  @YA00406 26360002
         CLC   IOSCSWCA(ADDRLN),WKAREA IS CCW ADDRESS VALID?   @YA00406 26370002
         BE    ERR007             NO,PERMANENT ERROR           @YA00406 26380002
ERR001A  TM    IOSFLA,IOSACHN     IS IT MIXED CHAINING         @YA00406 26400002
         BO    ERR0012            YES SEE IF CHANNEL ERROR              26500019
         TM    IOSCC,IOSCC1       CODE EQUAL 10                @YM00636 26600002
         BZ    ERR002             NO CONTINUE                           26700019
         L     CCWREG,IOSVST      LOAD VIRTUAL ADDRESS OF CCW    Y02967 26800002
         B     ERR003             CONTINUE                       Y02967 27000002
ERR0012  TM    IOSTSB,CHINTCHK    CHANNEL OR INTERFACE CHK     @YM00636 27300002
         BZ    ERR007             NO EXIT TO WTO ROUTINE                27400019
         B     ERR010             YES TO CHANNEL+INTERFACE CHK RTN      27500019
ERR002   L     CCWREG,IOSCSW-1    GET CCW ADDRESS                Y02967 27600002
         LA    CCWREG,0(CCWREG)   CLEAR HIGH ORDER BYTE                 27700019
         SH    CCWREG,ERRON1      BACK UP ONE CCW                       27800019
         TM    IOSFLA,IOSCCHN     IS COMMAND CHAINING USED     @YM00636 27900002
         BZ    ERR003             NO SET UP FOR WTO                     28000019
         TM    IOSFLA,IOSERR      ENTERED AFTER RETRY          @YM00636 28100002
         BZ    ERR002A            NO CONTINUE                           28200019
         LRA   ERREG,0(CCWREG)    LOAD REAL ADDR OF CCW          Y02967 28300002
         S     ERREG,IOSRST       SUBTRACT RESTART ADDRESS       Y02967 28400002
         BE    ERR003             IF EQUAL ERROR                        28500019
         LA    WORKR5,EWACNTR1    POINT TO IOSB ERROR CNTRS    @YM00636 28600002
         LA    WORKR6,EWCCNTRS    POINT TO TEMPORARY ERROR     @YM00636 28700002
*                                 COUNTERS                     @YM00636 28800002
         BAL   LINKR,ERR018       LINK TO COUNTER UPDATE ROUTINE        28900019
ERR002A  LRA   ERREG,0(CCWREG)    LOAD REAL ADDR OF CHANNEL PGM  Y02967 29000002
         ST    ERREG,IOSRST       SAVE CCW START ADDRESS         Y02967 29100002
ERR003   TM    IOSTSA,CSWUCK      IS IT  UNIT CHECK            @YM00636 29200002
         BZ    ERR004             NO DETERMINE ERROR TYPE               29300019
         OC    EWASTUP(SNSLEN),IOSSNS OR SENSE BITS              Y02967 30500002
         NC    EWASTUP(SNSLEN),MASKOUT MASK UNWANTED BITS        Y02967 30600002
         NI    EWASTUP+1,EOP      CLEAR POSSIBLE END OF PAGE     Y02967 30700002
ERR004   LR    SVREG,BASREG       SAVE BASE REGISTER                    30800019
         L     BASREG,VFCT68(COMREG) GET INTERPRETER ROUTINE ADDRESS    30900019
ERR0041  BALR  ERRETR,BASREG      LINK TO INTERPRETER            Y02967 31000002
         DC    X'1D'              TEST FOR CHANNEL CONTROL CHECK        31100019
         DC    AL1(ERR010L-ERR0041-2) BRANCH TO CCC ACTION              31200019
         DC    X'1E'              TEST FOR INTERFACE CONTROL CHECK      31300019
         DC    AL1(ERR010L-ERR0041-4) BRANCH TO ICC ACTION              31400019
         DC    X'1C'              TEST FOR CHANNEL DATA CHECK           31500019
         DC    AL1(ERR200L-ERR0041-6) BRANCH TO CDC ACTION              31600019
         DC    X'10'              TEST FOR ATTENTION                    31700019
         DC    AL1(ERR007-ERR0041-8) BRANCH TO ATTENTION ACTION         31800019
         DC    X'12'              TEST FOR CONTROL UNIT END             31900019
         DC    AL1(ERR007-ERR0041-10) BRANCH TO CUE ACTION              32000019
         DC    X'16'              TEST FOR UNIT CHECK                   32100019
         DC    AL1(ERR006-ERR0041-12) BRANCH TO UNIT CHECK ACTION       32200019
         DC    X'2F'              END OF LIST                           32300019
         DC    AL1(ERR004B-ERR0041-14)  PASS CONTROL TO ERR004B         32400019
* FOLLOWING BRANCHES GO TO ROUTINES MORE THAN 128 BYTES AWAY            32450019
ERR010L  B     ERR010             GO TO ERR010                          32500019
ERR200L  B     ERR200             GO TO CDC ROUTINE                     32600019
ERR004B  LR    SVREG,BASREG       SAVE BASE REGISTER                    32800019
         L     BASREG,VFCT68(COMREG) GET INTERPRETER ROUTINE ADDRESS    32900019
ERR004B1 BALR  ERRETR,BASREG      LINK TO INTERPRETER            Y02967 33000002
         DC    X'1F'              TEST FOR CHAINING CHECK               33100019
         DC    AL1(ERR011L-ERR004B1-2) BRANCH TO CC ACTION              33200019
         DC    X'1A'              TEST FOR PROGRAM CHECK                33300019
         DC    AL1(ERR007A-ERR004B1-4) BRANCH TO PC ACTION              33400019
         DC    X'1B'              TEST FOR PROTECTION CHECK             33500019
         DC    AL1(ERR007A-ERR004B1-6) BRANCH TO PC ACTION              33600019
         DC    X'19'              TEST FOR INCORRECT LENGTH             33700019
         DC    AL1(ERR017L-ERR004B1-8) BRANCH TO IL ACTION              33800019
         DC    X'17'              CHECK FOR UNIT EXCEPTION              33900019
         DC    AL1(ERR013L-ERR004B1-10) BRANCH TO UE ACTION             34000019
         DC    X'2F'              END OF LIST                           34100019
         DC    AL1(ERR004B2-ERR004B1-12) PASS CONTROL TO ERR004B2       34200019
* THESE BRANCHS GO TO ROUTINES MORE THAN 128 BYTES AWAY                 34250019
ERR011L  B     ERR011             GO TO CC ACTION                       34300019
ERR017L  B     ERR017             GO TO IL ACTION                       34400019
ERR013L  B     ERR013             GO TO UE-ACTION                       34500019
ERR004B2 TM    IOSTSA,CSWUCK      IS UNIT CHECK POSTED         @YM00636 34700002
         BZ    ERR005             NO TO STATISTICS UPDATE ROUTINE       34900019
ERR004C  TM    IOSSNS+1,EOP       IS IT END OF PAGE              Y02967 35000002
         BO    ERR008             YES EXIT TO IOS                       35200019
ERR004D  TM    IOSSNS+1,NODOC     IS NO DOCUMENT POSTED          Y02967 35600002
         BO    ERR005B            YES CLEAN UP                          35700019
ERR005   NI    IOSFLA,X'FF'-IOSEX CLEAR EXCEPTION, ERR CORRECT @YM00636 35800002
         B     ERR005B            CONTINUE CLEAN UP                     35900019
ERR005B  NI    IOSFLA,X'FF'-IOSERR CLEAR IOSERR                @YM00636 36100002
         LA    ERRE1,STAUPRTN     LOAD NAME OF STATISTICS UPDATE RTN    36200019
ERR005C  LA    WORKR5,EWCCNTRS    POINT TO TEMPORARY ERROR     @YM00636 36300002
*                                 COUNTERS                     @YM00636 36400002
         LA    WORKR6,EWACNTR1    POINT TO IOSB ERROR COUNTERS   Y02967 36500002
         BAL   LINKR,ERR018       LINK TO COUNTER UPDATE ROUTINE        36600019
         L     ERRETR,VEXCTL(COMREG) GET ADDRESS OF XCTL ROUTINE        36700019
         BR    ERRETR             EXIT VIA XCTL                         36800019
ERR006   TM    IOSSNS+1,INVSNS    ANY INVALID SENSE BITS ON      Y02967 36900002
         BC    5,ERR007           YES ALL DONE-CLEAN UP                 37000019
ERR006A  TM    IOSSNS,INVSNS1     INVALID SENSE BITS ON          Y02967 37200002
         BO    ERR007             YES GO CLEAN UP                       37300019
ERR006B  LR    SVREG,BASREG       SAVE BASE ADDRESS                     37400019
         L     BASREG,VFCT68(COMREG) GET INTERPRETER ROUTINE ADDRESS    37500019
ERR006C  BALR  ERRETR,BASREG      LINK TO INTERPRETER ROUTINE    Y02967 37600002
         DC    X'03'              TEST FOR EQUIPMENT CHECK              37700019
         DC    AL1(ERR012L-ERR006C-2) BRANCH TO EC ROUTINE     @YM00636 37800002
         DC    X'06'              TEST FOR NONRECOVERY           A01004 37900002
         DC    AL1(ERR007-ERR006C-4)   BRANCH TO NOCREC ROUTINE  A01004 38000002
         DC    X'01'              TEST FOR INTERVENTION REQUIRED A01004 38100002
         DC    AL1(ERR006D-ERR006C-6)  BRANCH TO IR ROUTINE      A01004 38200002
         DC    X'02'              TEST FOR BUS OUT CHECK                38300019
         DC    AL1(ERR015L-ERR006C-8) BRANCH TO BUS OUT CHECK ROUTINE   38400019
         DC    X'04'              TEST FOR DATA CHECK                   38500019
         DC    AL1(ERR014L-ERR006C-10) BRANCH TO DATA CHECK ROUTINE     38600019
         DC    X'05'              TEST FOR OVERRUN                      38700019
         DC    AL1(ERR016L-ERR006C-12) BRANCH TO OVERRUN ROUTINE        38800019
         DC    X'00'              TEST FOR COMMAND REJECT               38900019
         DC    AL1(ERR007A-ERR006C-14) BRANCH TO COMMAND REJECT ROUTINE 39000019
         DC    X'0C'              TEST FOR INVALID OPERATION            39100019
         DC    AL1(ERR007-ERR006C-16)  BRANCH TO INVALID OPERATION RTN  39200019
         DC    X'2F'              END OF LIST                           39300019
         DC    AL1(ERR004BL-ERR006C-18) CONTINUE CHECKING FOR ERRORS    39400019
ERR012L  B     ERR012             GO TO EC ACTION                       39500019
ERR015L  B     ERR015             GO TO BUS OUT ACTION                  39600019
ERR014L  B     ERR014             GO TO DATA CHECK ACTION               39700019
ERR016L  B     ERR016             GO TO OVERRUN ACTION                  39800019
ERR004BL B     ERR004B            CONTINUE ERROR CHECKING               39900019
ERR006D  OI    IOSFLA,IOSERR      SET IOSERR ON                @YM00636 40000002
         B     ERR007B            GO WRITE TO OPERATOR                  40100019
* EXIT TO WTO ROUTINE                                                   40200019
ERR007   OI    IOSFLB,IOSLOG      SET LOGOUT FALG                Y02967 40300002
         NI    EWAFLG2,X'FF'-EWAMDR    SET FLAG BIT FOR OBR      Y02967 40360002
ERR007A  OI    IOSFLB,IOSMSG      SET MESSAGE FLAG               Y02967 40420002
         NI    IOSFLA,X'FF'-IOSERR CLEAR IOSERR FLAG           @YM00636 40500002
ERR007B  LA    ERRE1,WTORTN       LOAD NAME OF WTO ROUTINE              40600019
         B     ERR005C            GET OUT VIA XCTL                      40700019
ERR008   NI    IOSFLA,X'FF'-IOSERR CLEAR IOSERR FLAG           @YM00636 40800002
         LA    WORKR5,EWCCNTRS    POINT TO TEMPORARY ERROR       Y02967 40900002
*                                 COUNTERS                     @YM00636 41000002
         LA    WORKR6,EWACNTR1    POINT TO IOSB CNTRS          @YM00636 41100002
         BAL   LINKR,ERR018       LINK TO COUNTER UPDATE ROUTINE        41200019
         SVC   ERRORSVC           ISSUE ERROR EXCP                      41300019
         SVC   RETSVC             RETURN TO IOS VIA SVC 3               41400019
*   UPDATE EWA ERROR COUNTERS ROUTINE                            Y02967 41500002
ERR018   SR    WORKR4,WORKR4      ZERO OUT                     @YM00636 41600002
         SR    WORKR9,WORKR9      WORK REGISTERS               @YM00636 41700002
         IC    WORKR4,DC(WORKR5)  GET DATA                     @YM00636 41800002
         IC    WORKR9,DC(WORKR6)  CHECK COUNTS                 @YM00636 41900002
         AR    WORKR4,WORKR9      ADD COUNTS                   @YM00636 42000002
         STC   WORKR4,DC(WORKR6)  UPDATE DATA CHECK COUNT      @YM00636 42100002
         IC    WORKR4,ILC(WORKR5) GET INCORRECT                @YM00636 42200002
         IC    WORKR9,ILC(WORKR6) LENGTH COUNTS                @YM00636 42300002
         AR    WORKR4,WORKR9      ADD COUNTS                   @YM00636 42400002
         STC   WORKR4,ILC(WORKR6) UPDATE INCORRECT LENGTH COUNT         42500002
         IC    WORKR4,EC(WORKR5)  GET EQUIPMENT CHECK          @YM00636 42600002
         IC    WORKR9,EC(WORKR6)  CHECK COUNTS                 @YM00636 42700002
         AR    WORKR4,WORKR9      ADD COUNTS                   @YM00636 42800002
         STC   WORKR4,EC(WORKR6)  UPDATE EQUIPMENT CHECK COUNT @YM00636 42900002
CLEAR1   XC    0(CLEARCNT,WORKR5),0(WORKR5) CLEAR ERROR CNTRS    Y02967 43000002
         TM    IOSDVRID,IOSXCPID  DRIVER ID EXCP               @YM00636 43020002
         BNO   ERR018A            NO,IOSB DOES NOT EXIST       @YM00636 43040002
         L     WORKR4,IOSUSE      LOAD ADDR OF RQE             @YM00636 43060002
         L     WORKR4,IOB-1(WORKR4) LOAD ADDRESS OF IOB        @YM00636 43080002
         MVC   IOSERRCT(4,WORKR4),0(WORKR6) MOVE ERROR COUNTERS  Y02967 43100002
ERR018A  BR    LINKR              RETURN                       @YM00636 43120002
* CHANNEL DATA CHECK ROUTINE                                   @YM00636 43200002
ERR200   TM    EWACNTR3,CDCCNT    CHANNEL DATA CHECK           @YM00636 43300002
         BO    ERR007             YES EXIT TO WTO ROUTINE               43400019
         OI    EWACNTR3,CDCCNT    SET TO INDICATE RETRIED      @YM00636 43500002
* RETRY ROUTINE                                                         43600019
ERR009   SR    WORKR3,WORKR3      CLEAR REGISTER               @YM00636 43700002
               XC    IOSSNS(2),IOSSNS                          @ZA00415 43750003
         IC    WORKR3,0(CCWREG)   GET OP CODE                  @YM00636 43770002
         N     WORKR3,CLEARHI     CLEAR TOP FOUR BITS          @YM00636 43840002
         CLM   WORKR3,1,RBTEST    IS COMMAND READ BACKWARD     @YM00636 43910002
         BE    ERR009B            YES CLEAR INPUT AREA & RETRY          44000019
         N     WORKR3,BITS56      CLEAR BITS 5+6               @YM00636 44100002
         CLM   WORKR3,1,RFTEST    IS COMMAND READ FORWORD      @YM00636 44200002
         BE    ERR009B            YES CLEAR INPUT AREA & RETRY          44300019
ERR009A  OI    IOSFLA,IOSERR      SET IOSERR ON                @YM00636 44400002
         SVC   ERRORSVC           RETRY CCW                             44500019
         SVC   RETSVC             RETURN TO IOS VIA SVC 3               44600019
* CLEAR INPUT AREA                                                      44700019
*   THE REAL DATA ADDRESS IN THE CCW IS TRANSLATED TO A          Y02967 44800002
*   VIRTUAL ADDRESS. IF INDIRECT ADDRESSING IS SPECIFIED IN      Y02967 44810002
*   THE CCW,EACH ADDRESS IN THE IDA LIST IS TRANSLATED.          Y02967 44820002
ERR009B  LR    WORKR4,IOSBREG     SAVE IOSB REGISTER           @YM00636 44830002
         L     RVREG,0(CCWREG)    GET REAL INPUT AREA ADDR       Y02967 44840002
         N     RVREG,MASK1        CLEAR OUT COMMAND CODE         Y02967 44850002
         LR    SVREG,BASREG       SAVE BASE REGISTER             Y02967 44870002
         L     BASREG,VFCF120(COMREG)  GET ADDR OF TRANSLATE RTN YM2511 44880002
         BALR  ERRETR,BASREG      LINK TO TRANSLATE ROUTINE      Y02967 44890002
         LTR   BASREG,BASREG      ADDRESS TRANSLATED ?         @ZA04474 44895003
         LR    BASREG,SVREG       RESTORE BASE REGISTER          Y02967 44900002
         BZ    ERR009B1           NO, DO NOT RETRY CCW         @ZA04474 44901003
         LR    IOSBREG,WORKR4     RESTORE IOSB REGISTER        @ZA04474 44902003
         NI    IOSFLA,X'FF'-IOSERR SET IOS ERROR FLAG OFF      @ZA04474 44903003
         SVC   ERRORSVC           RETRY CCW                    @ZA04474 44904003
         SVC   RETSVC             RETURN TO IOS VIA SVC 3      @ZA04474 44905003
ERR009B1 EQU   *                                               @ZA04474 44906003
         LR    ERRE1,RVREG        SAVE VIRTUAL ADDR OF IO LIST   Y02967 44920002
         LR    VTLREG,RVREG       SAVE VITUAL ADDR OF IO AREA    Y02967 44930002
         LR    IOSBREG,WORKR4     RESTORE IOSB REGISTER        @YM00636 44940002
         LH    WORKR6,BYTECNT(CCWREG) GET BYTE COUNT             Y02967 44950002
         TM    CCWFLAG(CCWREG),IDA INDIRECT ADDRESSING SPECIFED  Y02967 44960002
         BZ    ERR009H            NO, IO ADDRESS CORRECT         Y02967 44970002
*                                                                Y02967 44980002
*   IDA IS SPECIFIED. TRANSLATE EACH ADDRESS IN LIST             Y02967 44990002
*                                                                Y02967 45000002
ERR009C  L     RVREG,0(ERRE1)     GET ADDRESS IN IDA LIST        Y02967 45010002
         LR    SVREG,BASREG       SAVE BASE REGISTER             Y02967 45030002
         L     BASREG,VFCF120(COMREG)  GET ADDR OF TRANSLATE RTN YM2511 45040002
         BALR  ERRETR,BASREG      LINK TO TRANSLATE ROUTINE      Y02967 45050002
         LTR   BASREG,BASREG      ADDRESS TRANSLATED ?         @ZA04474 45055003
         LR    BASREG,SVREG       RESTORE BASE REGISTER          Y02967 45060002
         BZ    ERR009C1           NO, DO NOT RETRY CCW         @ZA04474 45061003
         LR    IOSBREG,WORKR4     RESTORE IOSB REGISTER        @ZA04474 45062003
         NI    IOSFLA,X'FF'-IOSERR TURN OFF IOS ERROR FLAG     @ZA04474 45063003
         SVC   ERRORSVC           RETRY CCW                    @ZA04474 45064003
         SVC   RETSVC             RETURN TO IOS VIA SVC 3      @ZA04474 45065003
ERR009C1 EQU   *                                               @ZA04474 45066003
         LR    VTLREG,RVREG       SAVE ADDRESS OF IO AREA        Y02967 45080002
ERR009D  LR    IOSBREG,WORKR4     RESTORE IOSB REGISTER        @YM00636 45090002
*   THE VIRTUAL ADDRESS IS DIVIDED BY THE PAGE SIZE(4096)  THE   Y02967 45100002
*   REMAINDER IS USED TO DETERMINE HOW MANY BYTES CAN BE         Y02967 45110002
*   CLEARED IN THE NEXT EXECUTE INSTRUCTION.                     Y02967 45120002
         LR    WORKR4,VTLREG      LOAD VITUAL ADDR OF IO ADRA    Y02967 45130002
         SRDA  WORKR4,32(0)       SHIFT INTO ODD REGISTER        Y02967 45140002
         D     WORKR4,CON4096     DIVIDE ADDR BY PAGE SIZE       Y02967 45150002
         LA    WORKR4,1(WORKR4)   ADJUST REMAINDER               Y02967 45160002
         CLM   WORKR3,1,RFTEST    IS COMMAND READ FORWARD      @YM00636 45170002
         BE    ERR009F            YES, ADDRESS CORRECT           Y02967 45180002
         CR    WORKR4,WORKR6      REMAINDER GE BYTE COUNT        Y02967 45190002
         BNL   ERR009E            YES, CLEAR ENTIRE IO AREA      Y02967 45200002
         SR    WORKR6,WORKR4      SUBTRACT NO. OF BYTES IN PAGE  Y02967 45210002
         BCTR  WORKR4,0           DECREMENT COUNT BY ONE         Y02967 45220002
         SR    VTLREG,WORKR4      ADJUST IO ADDRESS              Y02967 45230002
         B     ERR009G            GO CLEAR INPUT AREA            Y02967 45240002
ERR009E  BCTR  WORKR6,0           DECREMENT COUNT BY ONE         Y00620 45250002
         SR    VTLREG,WORKR6      ADJUST IO ADDRESS              Y00620 45260002
         B     ERR009I            GO CLEAR INPUT AREA            Y02967 45270002
ERR009F  S     WORKR4,CON4096     COMPUTE NO. OF                 Y02967 45280002
         LPR   WORKR4,WORKR4      BYTES LEFT IN PAGE             Y02967 45290002
         LA    WORKR4,1(WORKR4)   ADJUST NO. OF BYTES            Y02967 45300002
         CR    WORKR4,WORKR6      REMAINDER GE BYTE COUNT        Y02967 45310002
         BNL   ERR009H            YES, CLEAR ENTIRE IO AREA      Y02967 45320002
         SR    WORKR6,WORKR4      SUBTRACT NO. OF BYTES IN PAGE  Y02967 45330002
         BCTR  WORKR4,0           DECREMENT COUNT BY ONE         Y02967 45340002
ERR009G  EX    WORKR4,CLEAR       CLEAR INPUT AREA               Y02967 45350002
         LA    ERRE1,4(ERRE1)     INCREMENT TO NEXT IO ADDRESS   Y02967 45360002
         LR    WORKR4,IOSBREG     SAVE IOSB REGISTER           @YM00636 45370002
         B     ERR009C            GO TRANSLATE NEXT ADDRESS      Y02967 45380002
ERR009H  BCTR  WORKR6,0           DECREMENT COUNT BY ONE         Y02967 45390002
         CLM   WORKR3,1,RFTEST    IS COMMAND READ FORWARD      @YM00636 45400002
         BE    ERR009I            YES,IO ADDRESS OK              Y02967 45410002
         SR    VTLREG,WORKR6      ADJUST IO ADDRESS              Y02967 45420002
ERR009I  EX    WORKR6,CLEAR       CLEAR INPUT AREA               Y02967 45430002
         B     ERR009A            RETRY BAD CCW                  Y02967 45440002
* CHANNEL CHECK ROUTINE                                                 45800019
ERR010   LA    WORKR5,EWAERPIB    LOAD ADDRESS OF ERPIB          Y02967 45900002
ERR010B  XC    0(ERPIBLEN,WORKR5),0(WORKR5) CLEAR ERPIB        @YM00636 46800002
         B     ERR007             GO TO LOGOUT ROUTINE                  46900019
* CHAINING CHECK ROUTINE                                                47000019
ERR011   IC    WORKR5,EWACNTR4    GET CHAINING CK COUNT        @YM00636 47100002
         LA    WORKR5,1(WORKR5)   INCREMENT COUNT              @YM00636 47200002
         STC   WORKR5,EWACNTR4    UPDATE COUNT                 @YM00636 47300002
         TM    EWACNTR4,CCCNT     IS COUNT FIVE                @YM00636 47400002
         BO    ERR007             YES TO LOGOUT                         47500019
         B     ERR009             NO RETRY                              47600019
* EQUIPMENT CHECK                                                       47700019
ERR012   IC    WORKR5,EWACNTR3    GET EQUIPMENT CK COUNT       @YM00636 47800002
         LA    WORKR5,1(WORKR5)   INCREMENT COUNT              @YM00636 47900002
         STC   WORKR5,EWACNTR3    UPDATE COUNTERS              @YM00636 48000002
         CLI   EWACNTR3,EQCNT     IS COUNT NOW TEN               Y02967 48100002
         BE    ERR008             YES TO IOS                     A33936 48200001
         B     ERR009             NO RETRY                              48300019
* UNIT EXCEPTION                                                        48400019
ERR013   TM    IOSFLA,IOSERR     IOSERR ON-ENTERED AFTER RETRY @YM00636 48500002
         BZ    ERR005B            NO EXIT TO STATISTICS UPDATE          48600019
ERR013A  NI    IOSFLA,X'FF'-IOSEX SET IOSEX OFF                @YM00636 48700002
         B     ERR005B            TO STATISTICS UPDATE ROUTINE          48800019
* DATA CHECK ROUTINE                                                    49600019
ERR014   IC    WORKR5,EWACNTR1    GET DATA CHECK ERROR COUNT     Y02967 49700002
         LA    WORKR5,1(WORKR5)   INCREMENT COUNT              @YM00636 49800002
         STC   WORKR5,EWACNTR1    UPDATE DATA CHECK ERROR COUNT  Y02967 49900002
         TM    EWACNTR1,DCCOUNT1  IS COUNT NOW THREE             Y02967 50100002
         BO    ERR008             YES TO IOS                     A33926 50300020
         B     ERR009             NO RETRY                              50400019
* BUSOUT CHECK                                                          50500019
ERR015   TM    EWACNTR4,BOCOUNT   BUSOUT CHECK COUNT EQUAL ONE   Y02967 50600002
         BO    ERR007             YES TO WTO ROUTINE                    50700019
         OI    EWACNTR4,BOCOUNT   SET COUNT TO ONE               Y02967 50800002
         B     ERR009             RETRY                                 50900019
* OVERRUN                                                               51000019
ERR016   IC    WORKR5,EWACNTR4    GET OVERRUN ERROR COUNT      @YM00636 51100002
         LA    WORKR5,INCCOUNT(WORKR5) INCREMENT COUNT         @YM00636 51200002
         STC   WORKR5,EWACNTR4    UPDATE ERROR COUNT           @YM00636 51300002
         TM    EWACNTR4,ORCOUNT   DOES COUNT EQUAL FIVE          Y02967 51400002
         BO    ERR007             YES EXIT TO WTO ROUTINE               51500019
         B     ERR009             NO RETRY                              51600019
* INCORRECT LENGTH                                                      51700019
ERR017   TM    IOSFLA,IOSERR      ENTERED AFTER RETRY          @YM00636 51800002
         BZ    ERR017A            NO                                    51900019
         TM    EWACNTR2,ZEROCNT   FIRST TIME HERE                Y02967 52000002
         BC    5,ERR017A          NO CONTINUE                           52100019
         NI    IOSFLA,X'FF'-IOSEX CLEAR IOSEX                  @YM00636 52200002
         B     ERR008             EXIT TO IOS                           52300019
ERR017A  IC    WORKR5,EWACNTR2    GET INCORRECT LENGTH COUNT     Y02967 52400002
         LA    WORKR5,1(WORKR5)   INCREMENT ERROR COUNT        @YM00636 52500002
         STC   WORKR5,EWACNTR2    UPDATE COUNTERS                Y02967 52600002
         CLI   EWACNTR2,ILCOUNT   IS COUNT NOW FIVE              Y02967 52700002
         BE    ERR008             YES EXIT TO IOS                       52800019
         B     ERR009             NO RETRY                              52900019
         DS    0H                 FORCE HALF WORD ALIGNMENT             53000019
ERRON1   DC    AL2(8)             CONSTANT OF 8                         53100019
MASKOUT  DC    X'267F'            MASK FOR CLEARING UNWANTED   @YM00636*53300002
                                  SENSE DATA                   @YM00636 53310002
WKAREA   DC    XL3'00'            CHECK FOR VALID CCW ADDR     @YA00406 53360002
         DS    0F                                                Y02967 53400002
CON4096  DC    X'00001000'        PAGE SIZE                      Y02967 53405002
MASK1    DC    X'00FFFFFF'        MASK FOR HIGH ORDER BYTE       Y02967 53410002
CLEARHI  DC    XL4'0F'            CLEAR FOUR BITS OF BYTE        Y02967 53415002
BITS56   DC    XL4'03'            CLEAR BITS 5 + 6               Y02967 53420002
RFTEST   DC    X'02'              TEST FOR READ FORWARD COMMAND  Y02967 53425002
RBTEST   DC    X'0C'              TEST FOR READ BACKWARD COMMAND Y02967 53430002
CLEAR    XC    0(0,VTLREG),0(VTLREG)    CLEAR INPUT AREA         Y02967 53435002
         IECDIOSB                                                Y02967 53440002
         IECDERWA                                                       53445002
*****************************************************************Y02967 53450002
*                                                                Y02967 53455002
*   THIS DSECT DESCRIBES THE OPTICAL CHARACTER READER DEVICE     Y02967 53460002
*   DEPENDENT SECTION OF THE ERP WORKAREA                        Y02967 53465002
*                                                                Y02967 53470002
*****************************************************************Y02967 53475002
         ORG   EWAIERP                                           Y02967 53480002
EWCSNS   DS    XL8                EIGHT  BYTES OF SENSE DATA     Y02967 53485002
EWCCNTRS DS    XL4                FOUR BYTES OF ERROR COUNTERS   Y02967 53490002
         END   IGE0011D                                                 53500019
./  ADD  SSI=40650092,NAME=IGG019VA
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00100002
**** END OF SPECIFICATIONS ***/                                         00150002
         TITLE      'IGG019VA  -  GET LOCATE FIXED RECORDS (OCR) '      00400019
IGG019VA CSECT                                                          00800019
***********************************************************    @YM00638 00850002
*MODULE-NAME                                                   @YM00638 00900002
* IGG019VA                                                     @YM00638 00950002
*                                                              @YM00638 01000002
*DESCRIPTIVE-NAME                                              @YM00638 01050002
* OCR GET, LOCATE MODE, FIXED RECORDS                          @YM00638 01100002
*                                                              @YM00638 01150002
*COPYRIGHT                                                     @YM00638 01160002
* NONE                                                         @YM00638 01170002
*                                                              @YM00638 01180002
*CHANGE-ACTIVITY                                               @YM00638 01190002
*                                                                       01200019
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                01500020
*A553000,554000                                                  A33921 01800020
*C608000                                                         A33921 02100020
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                02400020
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                02700020
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                03000020
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                03300020
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                03600020
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                03900020
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                04200020
*                                                                       04800019
*                                                                       05200019
* STATUS - CHANGE LEVEL 00  RELEASE 20                                  05600020
*                                                                       06000019
*                                                                       06400019
*                                                                       06800019
*FUNCTION-GET- TO LOCATE THE ADDRESS OF LOGICAL SEQUENTIAL RECORDS      07200019
*              WITHIN A BUFFER FOR THE USER                             07600019
*         RELEASE- CAUSES THE REMAINING CONTENTS OF THE CURRENT BUFFER  08000019
*                  TO BE IGNORED                                        08400019
*                                                                       08800019
*ENTRY POINTS                                                           09200019
*        LABEL  OCR010                                                  09600019
*        LABEL  OCR020                                                  10000019
*                                                                       10400019
*ENTRY INSTRUCTION SEQUENCE                                             10800019
*              GET                 RELESE                               11200019
*                LA      1,DCB       LA      1,DCB                      11600019
*                L       15,48(1)    L       15,48(1)                   12000019
*                BALR    14,15       BALR    14,8(15)                   12400019
*                                                                       12800019
*INPUT FROM USER AS ADDRESSES IN FOLLOWING REGISTERS                    13200019
*        REG   0    USED IN MOVE MODE(NOT APPLICABLE IN LOCATE MODE)    13600019
*        REG   1    DCB ADDRESS                                         14000019
*        REG   13   WORK-SAVE ADDRESS                                   14400019
*        REG   14   USER IN-LINE RETURN ADDRESS                         14800019
*        REG   15   THIS ROUTINES INITIAL BASE ADDRESS                  15200019
*                                                                       15600019
*OUTPUT REGISTER ADDRESSES AS FOLLOWS                                   16000019
*        REG   0    NOT APPLICABLE                                      16400019
*        REG   1    RECORD ADDRESS LOCATED FOR USER                     16800019
*        REG   13   WORK-SAVE ADDRESS                                   17200019
*        REG   14   RETURN ADDRESS                                      17600019
*        REG   15   RETURN CODE                                         18000019
*        REG   2-12 AS UPON ENTRY TO THIS ROUTINE                       18400019
*                                                                       18800019
*EXTERNAL ROUTINES                                                      19200019
*                                                                       19600019
*        IGG019VE - INPUT ERROR ROUTINE WHICH DETECTS, CORRECTS DEV-DEP 20000019
*                   ERRORS AND RETURNS BLOCK OF DATA.                   20400019
*        IGG019CC   END OF BLOCK ROUTINE WHICH SCHEDULES REQUESTS.      20800019
*EXITS                                                                  21200019
*        OCR025     BRANCH TO USER,RETURNS PARAMETERS                   21600019
*        OCR034     BRANCH AND LINK TO END OF BLOCK ROUTINE             22000019
*        OCR072     BRANCH AND LINK TO END OF BLOCK ROUTINE             22400019
*        OCR080     BRANCH AND LINK TO INPUT ERROR ROUTINE              22800019
*        OCR110     BRANCH TO USER, RETURNS PARAMETERS                  23200019
*                                                                       23600019
*TABLES/WORKAREAS                                                       24000019
*                                                                       24400019
*        USER  SAVE/WORK AREA-LAST 13 WORDS USED                        24800019
*        DCB                                                            25200019
*                                                                       25600019
*        IOB                                                            26000019
*                                                                       26400019
*ATTRIBUTES---REENTRANT,REUSABLE,PROBLEM PROGRAM MODE                   26800019
*                                                                       27200019
**********************************************************************  27600019
*                                                                       28000019
*  ALL REGISTER EQUATES HAVE AN 'R' AT THE END OF THE SYMBOL            28400019
*                                                                       28800019
*********************************************************************** 29200019
*                                                                       29600019
PARA1R   EQU   1                   PARAMETER REGISTER 1                 30000019
BUFADR   EQU   1                   ADDRESS OF BUFFER                    30400019
DCBR     EQU   2                   DCB ADDRESS                          30800019
IOBADR   EQU   3                   IOB ADDRESS                          31200019
EOBADR   EQU   4                   EOB ADDRESS                          31600019
RECADR   EQU   5                   RECORD ADDRESS                       32000019
LRECLR   EQU   6                   RECORD LENGTH                        32400019
WORK3R   EQU   6                   WORK REGISTER                        32800019
WORK1R   EQU   7                   WORK REGISTER                        33200019
CON255R  EQU   7                   WORK REGISTER-CONTAINS 255           33600019
BASER    EQU   8                   BASE REGISTER                        34000019
SAVR     EQU   13                  USER SAVE AREA                       34400019
RETR     EQU   14                  RETURN ADDRESS                       34800019
WORK2R   EQU   14                  WORK REGISTER                        35200019
ENTRYR   EQU   15                  ENTRY ADDRESS                        35600019
LNGHR    EQU   15                  WORK REGISTER-CONTAINS BUFFER LNGH   36000019
*********************************************************************** 36400019
*                                                                       36800019
EOFBIT   EQU   X'40'               DCBORBYT-END OF FILE BIT             37200019
BUFPRIME EQU   X'20'               DCBORBYT-BUFFERS PRIMED BIT          37600019
ERRFLGS  EQU   X'3F'               DCBIFLGS-DCB ERROR FLGS OFF          38000019
BUF      EQU   0                   OFFSET OF BUFFER ADDRESS IN CCW      38400019
CNT      EQU   6                   OFFSET OF COUNT IN CCW               38800019
LINECNT  EQU   28                  OFFSET OF LINE COUNT IN ERROR CNTRS  39200019
NOERROR  EQU   X'00'               TESTS FOR RETURN CODE OF ZERO        39600019
C255     EQU   255                 USED TO CLEAR 256 BYTES OF CORE      40000019
C256     EQU   256                 USED TO INCREMENT POINTER BY 256     40400019
ADDRESS  EQU   3                   LENGTH OF AN ADDRESS                 40800019
ONE      EQU   1                   USED TO INCREMENT BY 1               41200019
USERREG  EQU   36                  SAVE AREA OFFSET TO REG2             41600019
RETREG   EQU   20                  SAVE AREA OFFSET TO REG14            42000019
SAVREG   EQU   20                  SAVE AREA OFFSET TO STORE REGISTERS  42400019
*                                                                       42800019
 EJECT                                                                  43200019
         USING IGG019VA,ENTRYR     USE ENTRY POINT AS A BASE (REG 15)   43600019
         USING IHADCB,PARA1R       USE DCB ADDRESS AS A BASE (REG 1)    44000019
*                                                                       44400019
OCR010   B     OCR030              BRANCH AROUND RELEASE                44800019
ZEROS    DC    X'00000000'         FILL FOR ENTRY AT +8 -USE AS CONST=0 45200019
*                                                                       45600019
OCR020   MVC   DCBRECAD+1(ADDRESS),DCBEOBAD+1 INITIALIZE FOR RELEASE    46000019
OCR025   BR    RETR                RETURN TO USER                       46400019
*                                                                       46800019
OCR030   STM   RETR,BASER,SAVREG(SAVR) SAVE REGISTERS                   47200019
*                                                                       47600019
         DROP  ENTRYR              DROP REG 15 AS BASE FOR MODULE       48000019
         DROP  PARA1R              DROP REG  1 AS BASE FOR DCB          48400019
         USING IGG019VA,BASER      NEW  BASE REG ADDRESSABILITY         48800019
         USING IHADCB,DCBR         NEW  DCB  REG ADDRESSABILITY         49200019
*                                                                       49600019
         LR    BASER,ENTRYR        LOAD BASE ADDRESS                    50000019
         LR    DCBR,PARA1R         LOAD DCB ADDRESS                     50400019
         LM    IOBADR,RECADR,DCBIOBA  LOAD WORK REG2                    50800019
         TM    DCBORBYT,BUFPRIME   ARE THE BUFFERS PRIMED               51200019
         BNZ   OCR035              YES, BRANCH                          51600019
*********************************************************************** 52000019
*                                                                       52400019
*        PRIME BUFFERS SUBROUTINE                                       52800019
*                                                                       53200019
*********************************************************************** 53600019
*                                                                       54000019
         NI    DCBIFLGS,ERRFLGS    MAKE SURE ERROR FLAGS ARE OFF        54400019
*                                                                       54800019
         SR    WORK3R,WORK3R       CLEAR REGISTER                       55200019
         CLI   DCBBUFNO,ONE            IF BUFFER NUMBER IS ONE   A33921 55300020
         BE    OCR0341                      GO TO OCR0341        A33921 55400020
         IC    WORK3R,DCBBUFNO     GET NUMBER OF BUFFERS                55600019
         BCTR  WORK3R,0            DECREMENT BY 1 FOR LOCATE MODE       56000019
*                                                                       56400019
OCR033   L     IOBADR,0(IOBADR)    GET ADDRESS OF NEXT IOB              56800019
         ST    IOBADR,DCBIOBA      STORE THAT IOB ADDRESS TO THE DCB    57200019
*                                                                       57600019
         BAL   RETR,OCR040         BRANCH AND LINK TO CLEAR BUFFERS     58000019
*                                                                       58400019
         L     ENTRYR,DCBEOB       LOAD  ADDRESS OF END OF BLOCK RTN    58800019
OCR034   BALR  RETR,ENTRYR         BRANCH AND LINK TO EOB ROUTINE       59200019
         BCT   WORK3R,OCR033       IF MORE IOBS, BRANCH TO SCHEDULE     59600019
         L     IOBADR,0(IOBADR)    GET IOB ADDRESS THAT WAS NOT SCHED   60000019
         ST    IOBADR,DCBIOBA      STORE TO DCB                         60400019
OCR0341  OI    DCBORBYT,BUFPRIME   SET BUFFERS PRIMED SWITCH ON  A33921 60800020
*                                                                       61200019
*********************************************************************** 61600019
OCR035   AH    RECADR,DCBLRECL     DETERMINE NEXT RECORD ADDRESS        62000019
         CR    RECADR,EOBADR       END OF BLOCK ADDRESS                 62400019
         BL    OCR085              NO, BRANCH TO GIVE ADDRESS OF REC    62800019
         LA    RETR,OCR070         LOAD CORRECT RETURN ADDRESS          63200019
*                                                                       63600019
 EJECT                                                                  64000019
*********************************************************************** 64400019
*                                                                       64800019
*        CLEAR BUFFER SUBROUTINE                                        65200019
*                                                                       65600019
*********************************************************************** 66000019
OCR040   SR    WORK1R,WORK1R       CLEAR REGISTER                       66400019
         IC    WORK1R,DCBOFFSR     GET OFFSET OF CHANNEL PROGRAM        66800019
         AR    WORK1R,IOBADR       GET ADDRESS OF CHANNEL PROGRAM       67200019
         L     BUFADR,BUF(WORK1R)  LOAD BUFFER ADDRESS                  67600019
         LA    BUFADR,ONE(BUFADR)  CLEAR HI BYTE AND INCREMENT BY 1     68000019
         SH    BUFADR,CNT(WORK1R)  SUBTRACT RECORD LENGTH               68400019
         LH    LNGHR,DCBBUFL       LOAD LENGTH OF BUFFER                68800019
         LA    CON255R,C255        LOAD CONSTANT = 255                  69200019
         BCTR  LNGHR,0             DECREMENT LENGTH BY 1                69600019
*                                                                       70000019
OCR050   CR    LNGHR,CON255R       COMPARE LENGTH TO CLEAR WITH 255     70400019
         BNH   OCR060              IF 255 OR LESS,BRANCH                70800019
*                                                                       71200019
         EX    CON255R,OCR055E     CLEAR 256 BYTES                      71600019
*                                                                       72000019
         SR    LNGHR,CON255R       SUBTRACT 255 FROM AMOUNT TO BE CLEAR 72400019
         BCTR  LNGHR,0             SUBTRACT ONE MORE BYTE               72800019
         LA    BUFADR,C256(BUFADR) UPDATE AREA ADDRESS                  73200019
         B     OCR050              BRANCH TO TEST FOR MORE              73600019
*                                                                       74000019
OCR055E  XC    0(1,BUFADR),0(BUFADR) CLEAR INSTRUCTION USED BY EX INSTR 74400019
*                                                                       74800019
OCR060   EX    LNGHR,OCR055E       CLEARS LESS THAN 256 BYTES           75200019
         BR    RETR                RETURN TO CALLING ROUTINE            75600019
*                                                                       76000019
*********************************************************************** 76400019
*                                                                       76800019
 EJECT                                                                  77200019
OCR070   TM    DCBORBYT,EOFBIT     TEST IF END OF FILE IS ON            77600019
         BO    OCR075              IF YES, DO NOT SCHEDULE,BRANCH       78000019
         L     ENTRYR,DCBEOB       LOAD EOB ROUTINE ADDRESS             78400019
OCR072   BALR  RETR,ENTRYR         BRANCH AND LINK TO EOB RTN           78800019
*                                                                       79200019
OCR075   L     ENTRYR,DCBGERR      LOAD GERR ROUTINE ADDRESS            79600019
*                                                                       80000019
OCR080   BALR  RETR,ENTRYR         BRANCH AND LINK TO GERR ROUTINE      80400019
*                                                                       80800019
OCR085   CLC   DCBERRCN+1(ADDRESS),ZEROS ARE COUNTERS SPECIFIED         81200019
         BE    OCR090              NO, BRANCH                           81600019
*                                                                       82000019
*                                                                       82400019
         L     WORK1R,DCBERRCN     LOAD ADR OF 32 BYTE COUNT AREA       82800019
         L     WORK2R,LINECNT(WORK1R)   LOAD NO. OF LINES READ          83200019
         LA    WORK2R,ONE(WORK2R)       ADD 1 TO COUNT                  83600019
         ST    WORK2R,LINECNT(WORK1R)   STORE COUNT                     84000019
*                                                                       84400019
OCR090   LR    PARA1R,RECADR       RECORD ADDRESS TO REGISTER 1         84800019
         ST    PARA1R,DCBRECAD     STORE RECORD ADDRESS TO DCB          85200019
         AH    RECADR,DCBLRECL     DETERMINE ADDRESS OF NEXT RECORD     85600019
         L     WORK1R,DCBEOBAD     LOAD EOB ADDRESS                     86000019
         SR    ENTRYR,ENTRYR       CLEAR REG 15                         86400019
         CR    RECADR,WORK1R       COMPARE NEXT REC ADR TO EOB ADDRESS  86800019
         BL    OCR100              IF LESS,BRANCH                       87200019
         CLI   DCBEIB+1,NOERROR    IS RETURN CODE = 0                   87600019
         BE    OCR100              YES,BRANCH                           88000019
         IC    ENTRYR,DCBEIB+1     LOAD RETURN CODE                     88400019
         XC    DCBEIB+1(ONE),DCBEIB+1 CLEAR RETURN CODE SAVE AREA       88800019
*                                                                       89200019
OCR100   LM    DCBR,BASER,USERREG(SAVR) RESTORE USER REGISTERS          89600019
         L     RETR,RETREG(SAVR)   RESTORE RETURN REGISTER              90000019
OCR110   BR    RETR                RETURN TO USER                       90400019
*                                                                       90800019
         CNOP  0,8                 PAD MODULE TO DOUBLE WORD            91200002
         DCBD  DSORG=PS,DEVD=OR                                @YM00635 91600002
         END                                                            92000019
./  ADD  SSI=40650099,NAME=IGG019VB
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00100002
**** END OF SPECIFICATIONS ***/                                         00150002
   TITLE   'IGG019VB - GET LOCATE VARIABLE AND UNDEFINED RECORDS (OCR)' 00300019
IGG019VB CSECT                                                          00600019
***********************************************************    @YM00638 00650002
*MODULE-NAME                                                   @YM00638 00700002
* IGG019VB                                                     @YM00638 00750002
*                                                              @YM00638 00800002
*DESCRIPTIVE-NAME                                              @YM00638 00850002
* OCR GET, LOCATE MODE, VARIABLE AND UNDEFINED RECORDS         @YM00638 00860002
*                                                              @YM00638 00870002
*COPYRIGHT                                                     @YM00638 00880002
* NONE                                                         @YM00638 00890002
*                                                              @YM00638 00892002
*CHANGE-ACTIVITY                                               @YM00638 00894002
*                                                                       00900019
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                01100020
*A427000,428000                                                  A33921 01300020
*C471000                                                         A33921 01500020
*A454000,455000,460000,628000,629000,631000,802000               A56384 01600001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                01700020
*D454000,455000,460000,628000,629000,631000,802000               YM5997 01750001
*C240000,366000,393000,792000                                    YM5997 01800001
*A394000,630500                                                  YM5997 01850001
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                01900020
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                02100020
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                02300020
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                02500020
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                02700020
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                02900020
*                                                                       03600019
*                                                                       03900019
* STATUS - CHANGE LEVEL 00  RELEASE 20                                  04200020
*                                                                       04500019
*                                                                       04800019
*                                                                       05100019
*FUNCTION-GET- TO LOCATE THE ADDRESS OF LOGICAL SEQUENTIAL RECORDS      05400019
*              WITHIN A BUFFER FOR THE USER                             05700019
*         RELEASE- CAUSES THE REMAINING CONTENTS OF THE CURRENT BUFFER  06000019
*                  TO BE IGNORED                                        06300019
*                                                                       06600019
*ENTRY POINTS                                                           06900019
*        LABEL  OCR010                                                  07200019
*        LABEL  OCR020                                                  07500019
*                                                                       07800019
*ENTRY INSTRUCTION SEQUENCE                                             08100019
*              GET                 RELEASE                              08400019
*                LA      1,DCB       LA      1,DCB                      08700019
*                L       15,48(1)    L       15,48(1)                   09000019
*                BALR    14,15       BALR    14,8(15)                   09300019
*                                                                       09600019
*INPUT FROM USER AS ADDRESSES IN FOLLOWING REGISTERS                    09900019
*        REG   0    USED IN MOVE MODE(NOT APPLICABLE IN LOCATE MODE)    10200019
*        REG   1    DCB ADDRESS                                         10500019
*        REG   13   WORK-SAVE ADDRESS                                   10800019
*        REG   14   USER IN-LINE RETURN ADDRESS                         11100019
*        REG   15   THIS ROUTINES INITIAL BASE ADDRESS                  11400019
*                                                                       11700019
*OUTPUT REGISTER ADDRESSES AS FOLLOWS                                   12000019
*        REG   0    NOT APPLICABLE                                      12300019
*        REG   1    RECORD ADDRESS LOCATED FOR USER                     12600019
*        REG   13   WORK-SAVE ADDRESS                                   12900019
*        REG   14   RETURN ADDRESS                                      13200019
*        REG   15   RETURN CODE                                         13500019
*        REG   2-12 AS UPON ENTRY TO THIS ROUTINE                       13800019
*                                                                       14100019
*EXTERNAL ROUTINES                                                      14400019
*                                                                       14700019
*        IGG019VE - INPUT ERROR ROUTINE WHICH DETECTS, CORRECTS DEVICE  15000019
*                   ERRORS AND RETURNS BLOCK OF DATA.                   15300019
*        IGG019CC   END OF BLOCK ROUTINE WHICH SCHEDULES REQUESTS.      15600019
*EXITS                                                                  15900019
*        OCR025     BRANCH TO USER,RETURNS PARAMETERS                   16200019
*        OCR034     BRANCH AND LINK TO END OF BLOCK ROUTINE             16500019
*        OCR072     BRANCH AND LINK TO END OF BLOCK ROUTINE             16800019
*        OCR080     BRANCH AND LINK TO INPUT ERROR ROUTINE              17100019
*        OCR150     BRANCH TO USER, RETURNS PARAMETERS                  17400019
*                                                                       17700019
*TABLES/WORKAREAS                                                       18000019
*                                                                       18300019
*        USER  SAVE/WORK AREA-LAST 13 WORDS USED                        18600019
*        DCB                                                            18900019
*                                                                       19200019
*        IOB                                                            19500019
*                                                                       19800019
*ATTRIBUTES---REENTRANT,REUSABLE,PROBLEM PROGRAM MODE                   20100019
*                                                                       20400019
*******************************************************************     20700019
*                                                                       21000019
*  ALL REGISTER EQUATES HAVE AN 'R' AT THE END OF THE SYMBOL            21300019
*                                                                       21600019
*********************************************************************** 21900019
*                                                                       22200019
PARA1R   EQU   1                   PARAMETER REGISTER 1                 22500019
BUFADR   EQU   1                   ADDRESS OF BUFFER                    22800019
DCBR     EQU   2                   DCB ADDRESS                          23100019
IOBADR   EQU   3                   IOB ADDRESS                          23400019
EOBADR   EQU   4                   EOB ADDRESS                          23700019
RECADR   EQU   5                   RECORD ADDRESS              @YA00403 24000002
WORK3R   EQU   6                   WORK REGISTER                        24300019
WORK1R   EQU   7                   WORK REGISTER                        24600019
CON255R  EQU   7                   WORK REGISTER-CONTAINS 255           24900019
BASER    EQU   8                   BASE REGISTER                        25200019
SAVR     EQU   13                  USER SAVE AREA                       25500019
RETR     EQU   14                  RETURN ADDRESS                       25800019
WORK2R   EQU   14                  WORK REGISTER                        26100019
ENTRYR   EQU   15                  ENTRY ADDRESS                        26400019
LNGHR    EQU   15                  WORK REGISTER-CONTAINS BUFFER LNGH   26700019
*********************************************************************** 27000019
EOFBIT   EQU   X'40'               DCBORBYT-END OF FILE BIT             27300019
BUFPRIME EQU   X'20'               DCBORBYT-BUFFERS PRIMED BIT          27600019
ERRFLGS  EQU   X'3F'               DCBIFLGS-DCB ERROR FLGS OFF          27900019
BUF      EQU   0                   OFFSET OF BUFFER ADDRESS IN CCW      28200019
CNT      EQU   6                   OFFSET OF COUNT IN CCW               28500019
LINECNT  EQU   28                  OFFSET OF LINE COUNT IN ERROR CNTRS  28800019
NOERROR  EQU   X'00'               TESTS FOR RETURN CODE OF ZERO        29100019
LPREFIX  EQU   4                   LENGTH OF A VARIABLE RECORD PREFIX   29400019
LNGH     EQU   2                   LENGTH OF NUMBER IN PREFIX           29700019
UNDEF    EQU   X'C0'               USED TO TEST FOR UNDEF RECORDS       30000019
C255     EQU   255                 USED TO CLEAR 256 BYTES OF CORE      30300019
C256     EQU   256                 USED TO INCREMENT POINTER BY 256     30600019
ADDRESS  EQU   3                   LENGTH OF AN ADDRESS                 30900019
ZERO     EQU   0                   USED AS A CONSTANT OF ZERO           31200019
ONE      EQU   1                   USED TO INCREMENT BY 1               31500019
USERREG  EQU   36                  SAVE AREA OFFSET TO REG2             31800019
RETREG   EQU   20                  SAVE AREA OFFSET TO REG14            32100019
SAVREG   EQU   20                  SAVE AREA OFFSET TO STORE REGISTERS  32400019
*                                                                       32700019
*                                                                       33000019
*                                                                       33300019
 EJECT                                                                  33600019
         USING IGG019VB,ENTRYR     USE ENTRY POINT AS A BASE (REG 15)   33900019
         USING IHADCB,PARA1R       USE DCB ADDRESS AS A BASE (REG 1)    34200019
*                                                                       34500019
OCR010   B     OCR030              BRANCH AROUND RELEASE                34800019
ZEROS    DC    X'00000000'         FILL FOR ENTRY AT +8 - USE AS CNST=0 35100019
*                                                                       35400019
OCR020   MVC   DCBRECAD+1(ADDRESS),DCBEOBAD+1 INITIALIZE FOR RELEASE    35700019
*                                                                       36000019
OCR025   BR    RETR                RETURN TO USER                       36300019
OCR030   STM   RETR,BASER,SAVREG(SAVR)  SAVE REGISTERS         @YA00403 36600002
*                                                                       36900019
         DROP  ENTRYR              DROP REG 15 AS BASE FOR MODULE       37200019
         DROP  PARA1R              DROP REG 1  AS BASE FOR DCB          37500019
         USING IGG019VB,BASER      NEW BASE REG ADDRESSABILITY          37800019
         USING IHADCB,DCBR         NEW DCB  REG ADDRESSABILITY          38100019
*                                                                       38400019
         LR    BASER,ENTRYR        LOAD BASE ADDRESS                    38700019
         LR    DCBR,PARA1R         LOAD DCB  ADDRESS                    39000019
         LM    IOBADR,RECADR,DCBIOBA   LOAD WORK REGISTERS     @YA00403 39300002
         TM    DCBORBYT,BUFPRIME   ARE THE BUFFERS PRIMED               39600019
         BNZ   OCR035              YES,BRANCH                           39900019
*                                                                       40200019
*********************************************************************** 40500019
*                                                                       40800019
*        PRIME BUFFERS SUBROUTINE                                       41100019
*                                                                       41400019
*********************************************************************** 41700019
         NI    DCBIFLGS,ERRFLGS    MAKE SURE ERROR FLAGS ARE OFF        42000019
*                                                                       42300019
         SR    WORK3R,WORK3R       CLEAR REGISTER                       42600019
         CLI   DCBBUFNO,ONE            IF BUFFER NUMBER IS ONE   A33921 42700020
         BE    OCR0341                      GO TO OCR0341        A33921 42800020
         IC    WORK3R,DCBBUFNO     GET NUMBER OF BUFFERS                42900019
         BCTR  WORK3R,0            DECREMENT BY 1 FOR LOCATE MODE       43200019
OCR033   L     IOBADR,0(IOBADR)    GET ADDRESS OF NEXT IOB              43500019
         ST    IOBADR,DCBIOBA      STORE THAT IOB ADDRESS TO THE DCB    43800019
*                                                                       44100019
*                                                                       44400019
         BAL   RETR,OCR040         BRANCH AND LINK TO CLEAR BUFFER      44700019
*                                                                       45000019
         L     ENTRYR,DCBEOB       LOAD ADDRESS OF END OF BLOCK ROUTINE 45300019
*                                                                       45600019
OCR034   BALR  RETR,ENTRYR         BRANCH AND LINK TO EOB ROUTINE       45900019
         BCT   WORK3R,OCR033       IF MORE IOBS, BRANCH TO SCHEDULE     46200019
         L     IOBADR,0(IOBADR)    GET IOB ADDRESS THAT WAS NOT SCHED   46500019
         ST    IOBADR,DCBIOBA      STORE TO DCB                         46800019
OCR0341  OI    DCBORBYT,BUFPRIME   SET BUFFERS PRIMED SWITCH ON  A33921 47100020
*                                                                       47400019
*********************************************************************** 47700019
OCR035   AH    RECADR,DCBLRECL     DETERMINE NEXT RECORD ADDRESS        48000019
         CR    RECADR,EOBADR       END OF BLOCK ADDRESS                 48300019
         BL    OCR085              NO,BRANCH TO GIVE ADDRESS OF REC     48600019
*                                                                       48900019
         LA    RETR,OCR070         LOAD CORRECT RETURN ADDRESS          49200019
 EJECT                                                                  49500019
*********************************************************************** 49800019
*                                                                       50100019
*        CLEAR BUFFER SUBROUTINE                                        50400019
*                                                                       50700019
*********************************************************************** 51000019
OCR040   SR    WORK1R,WORK1R       CLEAR REGISTER                       51300019
         IC    WORK1R,DCBOFFSR     GET OFFSET OF CHANNEL PROGRAM        51600019
         AR    WORK1R,IOBADR       GET ADDRESS OF CHANNEL PROGRAM       51900019
         L     BUFADR,BUF(WORK1R)  LOAD BUFFER ADDRESS                  52200019
         LA    BUFADR,ONE(BUFADR)  CLEAR HI BYTE AND INCREMENT BY 1     52500019
         SH    BUFADR,CNT(WORK1R)  SUBTRACT RECORD LENGTH               52800019
         TM    DCBRECFM,UNDEF      UNDEFINED RECORDS                    53100019
         BO    OCR045              YES, BRANCH                          53400019
         SH    BUFADR,FOUR         FOR VAR RECS, SUB 4  TO ACCOUNT FOR  53700019
*                                   FOUR BYTE PREFIX IN BUFFER          54000019
OCR045   LH    LNGHR,DCBBUFL       LOAD LENGTH OF BUFFER                54300019
         LA    CON255R,C255        LOAD CONSTANT = 255                  54600019
         BCTR  LNGHR,0             DECREMENT LENGTH BY 1                54900019
*                                                                       55200019
OCR050   CR    LNGHR,CON255R       COMPARE LENGTH TO CLEAR WITH 255     55500019
         BNH   OCR060              IF 255 OR LESS, BRANCH               55800019
*                                                                       56100019
         EX    CON255R,OCR055E     CLEAR 256 BYTES                      56400019
*                                                                       56700019
         SR    LNGHR,CON255R       SUBTRACT 255 FROM AMT TO BE CLEARED  57000019
         BCTR  LNGHR,0             SUBTRACT ONE MORE BYTE               57300019
         LA    BUFADR,C256(BUFADR) UPDATE AREA ADDRESS                  57600019
         B     OCR050              BRANCH TO TEST FOR MORE              57900019
*                                                                       58200019
OCR055E  XC    0(1,BUFADR),0(BUFADR) CLEAR INSTRUCTION USED BY EX INSTR 58500019
*                                                                       58800019
OCR060   EX    LNGHR,OCR055E       CLEARS LESS THAN 256 BYTES           59100019
*                                                                       59400019
         BR    RETR                RETURN TO CALLING ROUTINE            59700019
*                                                                       60000019
*********************************************************************** 60300019
 EJECT                                                                  60600019
OCR070   TM    DCBORBYT,EOFBIT     TEST IF END OF FILE IS ON            60900019
         BO    OCR075              IF YES, DO NOT SCHEDULE,BRANCH       61200019
         L     ENTRYR,DCBEOB       LOAD ADDRESS OF EOB ROUTINE          61500019
OCR072   BALR  RETR,ENTRYR         BRANCH AND LINK TO EOB ROUTINE       61800019
*                                                                       62100019
OCR075   L     ENTRYR,DCBGERR      LOAD ADDRESS OF GERR ROUTINE         62400019
*                                                                       62700019
OCR080   BALR  RETR,ENTRYR         BRANCH AND LINK TO GERR RTN          63000019
*                                                                       63300019
OCR085   CLC   DCBERRCN+1(ADDRESS),ZEROS ARE COUNTERS SPECIFIED         63600019
         BE    OCR090              NO, BRANCH                           63900019
*                                                                       64200019
*                                                                       64500019
         L     WORK1R,DCBERRCN          LOAD ADR OF 32 BYTE COUNT AREA  64800019
         L     WORK2R,LINECNT(WORK1R)   LOAD NO. OF LINES READ          65100019
         LA    WORK2R,ONE(WORK2R)       ADD 1 TO COUNT                  65400019
         ST    WORK2R,LINECNT(WORK1R)   STORE COUNT                     65700019
OCR090   LR    WORK2R,RECADR       SAVE BEGINNING ADR OF BUFFER FOR REC 66000019
         SR    WORK1R,WORK1R       CLEAR REGISTER                       66300019
         IC    WORK1R,DCBOFFSR     LOAD CHANNEL PROGRAM OFFSET          66600019
         AR    WORK1R,IOBADR       LOAD CHANNEL PROGRAM ADDRESS         66900019
         LH    LNGHR,CNT(WORK1R)   LOAD LENGTH OF  RECORD FROM CCW      67200019
         TM    DCBRECFM,UNDEF      UNDEFINED BUFFER  SPECIFIED          67500019
         BO    OCR095              IF YES,BRANCH                        67800019
         LA    LNGHR,LPREFIX(LNGHR) ADD 4 FOR VARIABLE RECORDS TO GET   68100019
*                                  LENGTH OF RECORD BUFFER              68400019
OCR095   LR    WORK3R,LNGHR        LOAD COUNT FOR BUFFER SCAN           68700019
*                                                                       69000019
OCR092   CLI   0(RECADR),ZERO      IS BUFFER BYTE = 0                   69300019
         BNE   OCR100              NO, BRANCH                           69600019
         LA    RECADR,ONE(RECADR)  INCREMENT BUFFER POINTER BY 1        69900019
         BCT   WORK3R,OCR092       BRANCH TO CHECK NEXT BYTE FOR ZERO   70200019
*                                                                       70500019
OCR100   AR    WORK2R,LNGHR        ADD MAX LENGTH TO BEGIN TO GET END   70800019
OCR110   SR    WORK2R,RECADR       SUBTRACT BEGINNING OF DATA FROM      71100019
*                                  END OF RECORD BUFFER TO GET LENGTH   71400019
         TM    DCBRECFM,UNDEF      TEST FOR UNDEFINED RECORDS           71700019
         BO    OCR120              YES,BRANCH                           72000019
*                                                                       72300019
         LA    WORK2R,LPREFIX(WORK2R) ADD 4 TO LNGH TO INCLUDE PREFIX   72600019
         STH   WORK2R,DCBLRECL     STORE LNGH TO DCB                    72900019
         SH    RECADR,FOUR         SUBTRACT 4 FROM REC ADDR TO GET PRE- 73200019
*                                   FIX ADDRESS, THEN STORE IN DCB      73500019
         MVC   0(LNGH,RECADR),DCBLRECL  MOVE LENGTH TO PREFIX           73800019
         B     OCR130              BRANCH TO CONT. PROCESSING           74100019
*                                                                       74400019
OCR120   STH   WORK2R,DCBLRECL     STORE UNDEFINED LENGTH TO DCB        74700019
*                                                                       75000019
*                                                                       75300019
OCR130   LR    PARA1R,RECADR       RECORD ADDRESS TO REGISTER 1         75600019
         ST    PARA1R,DCBRECAD     STORE RECORD ADDRESS TO DCB          75900019
         AH    RECADR,DCBLRECL     DETERMINE ADDRESS OF NEXT RECORD     76200019
         L     WORK1R,DCBEOBAD     LOAD EOB ADDRESS                     76500019
         SR    ENTRYR,ENTRYR       CLEAR REGISTER 15                    76800019
         CR    RECADR,WORK1R       COMPARE NEXT REC ADR TO EOB ADDRESS  77100019
         BL    OCR140              IF LESS, BRANCH                      77400019
         CLI   DCBEIB+1,NOERROR    IS RETURN CODE = 0                   77700019
         BE    OCR140              YES,BRANCH                           78000019
         IC    ENTRYR,DCBEIB+1     LOAD RETURN CODE                     78300019
         XC    DCBEIB+1(ONE),DCBEIB+1 CLEAR RETURN CODE SAVE AREA       78600019
*                                                                       78900019
OCR140   LM    DCBR,BASER,USERREG(SAVR) RESTORE USER REGISTERS @YA00403 79200002
         L     RETR,RETREG(SAVR)       RESTORE RETURN REGISTER          79500019
OCR150   BR    RETR                RETURN TO USER                       79800019
FOUR     DC    1H'4'               USED AS A CONSTANT OF 4              80100019
         CNOP  0,8                 PAD TO DOUBLE WORD BOUNDARY          80400019
         DCBD  DSORG=PS,DEVD=OR                                @YM00635 80700002
         END                                                            81000019
./  ADD  SSI=40650103,NAME=IGG019VC
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00100002
**** END OF SPECIFICATIONS ***/                                         00150002
   TITLE   'IGG019VC - GET MOVE FIXED RECORDS (OCR)'                    00300019
IGG019VC CSECT                                                          00600019
***********************************************************    @YM00638 00650002
*MODULE-NAME                                                   @YM00638 00700002
* IGG019VC                                                     @YM00638 00750002
*                                                              @YM00638 00800002
*DESCRIPTIVE-NAME                                              @YM00638 00850002
* OCR GET, MOVE MODE, FIXED RECORDS                            @YM00638 00860002
*                                                              @YM00638 00870002
*COPYRIGHT                                                     @YM00638 00880002
* NONE                                                         @YM00638 00890002
*                                                              @YM00638 00892002
*CHANGE-ACTIVITY                                               @YM00638 00894002
*                                                                       00900019
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                01200020
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                01500020
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                01800020
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                02100020
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                02400020
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                02700020
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                03000020
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                03300020
*                                                                       03600019
*                                                                       03900019
* STATUS - CHANGE LEVEL 00  RELEASE 20                                  04200020
*                                                                       04500019
*                                                                       04800019
*FUNCTION-GET- TO MOVE A LOGICAL RECORD FROM A BUFFER TO A USER         05100019
*              WORKAREA. IF THE BUFFER IS EMPTIED A NEW ONE IS ACCEPTED 05400019
*              AFTER THE OLD ONE HAS BEEN SCHEDULED FOR REFILLING       05700019
*              BY THE END OF BLOCK ROUTINE                              06000019
*         RELEASE- CAUSES THE REMAINING CONTENTS OF THE CURRENT BUFFER  06300019
*                  TO BE IGNORED                                        06600019
*                                                                       06900019
*ENTRY POINTS                                                           07200019
*        LABEL  OCR010                                                  07500019
*        LABEL  OCR020                                                  07800019
*                                                                       08100019
*ENTRY INSTRUCTION SEQUENCE                                             08400019
*              GET                 RELEASE                              08700019
*                LA      1,DCB       LA      1,DCB                      09000019
*                L       15,48(1)    L       15,48(1)                   09300019
*                BALR    14,15       BALR    14,8(15)                   09600019
*                                                                       09900019
*INPUT FROM USER AS ADDRESSES IN FOLLOWING REGISTERS                    10200019
*        REG   0    USED IN MOVE MODE-CONTAINS ADDRESS OF INPUT AREA    10500019
*        REG   1    DCB ADDRESS                                         10800019
*        REG   13   WORK-SAVE ADDRESS                                   11100019
*        REG   14   USER IN-LINE RETURN ADDRESS                         11400019
*        REG   15   THIS ROUTINES INITIAL BASE ADDRESS                  11700019
*                                                                       12000019
*OUTPUT REGISTER ADDRESSES AS FOLLOWS                                   12300019
*        REG   0    NOT APPLICABLE                                      12600019
*        REG   1    RECORD ADDRESS LOCATED FOR USER                     12900019
*        REG   13   WORK-SAVE ADDRESS                                   13200019
*        REG   14   RETURN ADDRESS                                      13500019
*        REG   15   RETURN CODE                                         13800019
*        REG   2-12 AS UPON ENTRY TO THIS ROUTINE                       14100019
*                                                                       14400019
*EXTERNAL ROUTINES                                                      14700019
*                                                                       15000019
*        IGG019VE - INPUT ERROR ROUTINE WHICH DETECTS, CORRECTS DEVICE  15300019
*                   ERRORS AND RETURNS BLOCK OF DATA.                   15600019
*        IGG019CC   END OF BLOCK ROUTINE WHICH SCHEDULES REQUESTS.      15900019
*EXITS                                                                  16200019
*        OCR025     BRANCH TO USER,RETURNS PARAMETERS                   16500019
*        OCR034     BRANCH AND LINK TO END OF BLOCK ROUTINE             16800019
*        OCR090     BRANCH AND LINK TO END OF BLOCK ROUTINE             17100019
*        OCR040     BRANCH AND LINK TO INPUT ERROR ROUTINE              17400019
*        OCR105     BRANCH TO USER, RETURNS PARAMETERS                  17700019
*                                                                       18000019
*TABLES/WORKAREAS                                                       18300019
*                                                                       18600019
*        USER  SAVE/WORK AREA-LAST 13 WORDS USED                        18900019
*        DCB                                                            19200019
*                                                                       19500019
*        IOB                                                            19800019
*                                                                       20100019
*ATTRIBUTES---REENTRANT,REUSABLE,PROBLEM PROGRAM MODE                   20400019
*                                                                       20700019
*******************************************************************     21000019
*                                                                       21300019
*  ALL REGISTER EQUATES HAVE AN 'R' AT THE END OF THE SYMBOL            21600019
*                                                                       21900019
*********************************************************************** 22200019
PARA1R   EQU   1                   PARAMETER REGISTER 1                 22500019
BUFADR   EQU   1                   ADDRESS OF BUFFER                    22800019
DCBR     EQU   2                   DCB ADDRESS                          23100019
IOBADR   EQU   3                   IOB ADDRESS                          23400019
EOBADR   EQU   4                   EOB ADDRESS                          23700019
RECADR   EQU   5                   RECORD ADDRESS                       24000019
LRECLR   EQU   6                   RECORD LENGTH                        24300019
WORK3R   EQU   6                   WORK REGISTER                        24600019
WORK1R   EQU   7                   WORK REGISTER                        24900019
CON255R  EQU   7                   WORK REGISTER-CONTAINS 255           25200019
BASER    EQU   8                   BASE REGISTER                        25500019
SAVR     EQU   13                  USER SAVE AREA                       25800019
RETR     EQU   14                  RETURN ADDRESS                       26100019
WORK2R   EQU   14                  WORK REGISTER                        26400019
ENTRYR   EQU   15                  ENTRY ADDRESS                        26700019
LNGHR    EQU   15                  WORK REGISTER-CONTAINS BUFFER LNGH   27000019
*********************************************************************** 27300019
EOFBIT   EQU   X'40'               DCBORBYT-END OF FILE BIT             27600019
BUFPRIME EQU   X'20'               DCBORBYT-BUFFERS PRIMED BIT          27900019
ERRFLGS  EQU   X'3F'               DCBIFLGS-DCB ERROR FLGS OFF          28200019
BUF      EQU   0                   OFFSET OF BUFFER ADDRESS IN CCW      28500019
CNT      EQU   6                   OFFSET OF COUNT IN CCW               28800019
LINECNT  EQU   28                  OFFSET OF LINE COUNT IN ERROR CNTRS  29100019
NOERROR  EQU   X'00'               TESTS FOR RETURN CODE OF ZERO        29400019
C255     EQU   255                 USED TO CLEAR 256 BYTES OF CORE      29700019
C256     EQU   256                 USED TO INCREMENT POINTER BY 256     30000019
ADDRESS  EQU   3                   LENGTH OF AN ADDRESS                 30300019
ONE      EQU   1                   USED TO INCREMENT BY 1               30600019
USERREG  EQU   36                  SAVE AREA OFFSET TO REG2             30900019
RETREG   EQU   20                  SAVE AREA OFFSET TO REG14            31200019
SAVREG   EQU   20                  SAVE AREA OFFSET TO STORE REGISTERS  31500019
REG0SAV  EQU   28                  OFFSET IN SAVE AREA FOR REGISTER 0   31800019
RELEASE  EQU   X'F0'               USED IF BUFFER IS TO BE RELEASED     32100019
LNGH     EQU   2                   LENGTH OF LRECL AND BUFL             32400019
*                                                                       32700019
*                                                                       33000019
*                                                                       33300019
 EJECT                                                                  33600019
         USING IGG019VC,ENTRYR     USE ENTRY POINT AS A BASE (REG 15)   33900019
         USING IHADCB,PARA1R       USE DCB ADDRESS AS A BASE (REG 1)    34200019
*                                                                       34500019
OCR010   B     OCR030              BRANCH AROUND RELEASE                34800019
ZEROS    DC    X'00000000'         FILL FOR ENTRY AT +8 - USE AS CON=0  35100019
*                                                                       35400019
OCR020   CLC   DCBEOBAD+1(ADDRESS),DCBRECAD+1 END OF BLOCK YET          35700019
         BCR   8,RETR              YES, RETURN TO USER                  36000019
         OI    DCBIOBA,RELEASE     SET RELEASE SWITCH                   36300019
OCR025   BR    RETR                RETURN TO USER                       36600019
OCR030   STM   RETR,BASER,SAVREG(SAVR) SAVE REGISTERS                   36900019
*                                                                       37200019
         DROP  ENTRYR              DROP REG 15 AS BASE FOR MODULE       37500019
         DROP  PARA1R              DROP REG  1 AS BASE FOR DCB          37800019
         USING IGG019VC,BASER      NEW  BASE REG ADDRESSABILITY         38100019
         USING IHADCB,DCBR         NEW  DCB  REG ADDRESSABILITY         38400019
*                                                                       38700019
         LR    BASER,ENTRYR        LOAD BASE ADDRESS                    39000019
         LR    DCBR,PARA1R         LOAD DCB  ADDRESS                    39300019
         LM    IOBADR,RECADR,DCBIOBA  LOAD WORK REGS                    39600019
         TM    DCBORBYT,BUFPRIME   ARE THE BUFFERS PRIMED               39900019
         BNZ   OCR035              YES,BRANCH                           40200019
*                                                                       40500019
*********************************************************************** 40800019
*                                                                       41100019
*        PRIME BUFFERS SUBROUTINE                                       41400019
*                                                                       41700019
*********************************************************************** 42000019
         NI    DCBIFLGS,ERRFLGS    MAKE SURE ERROR FLAGS ARE OFF        42300019
*                                                                       42600019
         SR    WORK3R,WORK3R       CLEAR A WORK REGISTER                42900019
         IC    WORK3R,DCBBUFNO     GET NUMBER OF BUFFERS                43200019
         B     OCR033              BRANCH TO SCHEDULE BUFFERS           43500019
*                                                                       43800019
OCR032   L     IOBADR,0(IOBADR)    GET NEXT IOB ADDRESS                 44100019
         ST    IOBADR,DCBIOBA      STORE ADDRESS OF NEXT IOB TO THE DCB 44400019
OCR033   BAL   RETR,OCR060         BRANCH AND LINK TO CLEAR THE BUFFER  44700019
*                                                                       45000019
         L     ENTRYR,DCBEOB       LOAD ADDRESS OF END OF BLOCK ROUTINE 45300019
*                                                                       45600019
OCR034   BALR  RETR,ENTRYR         BRANCH AND LINK TO EOB ROUTINE       45900019
         BCT   WORK3R,OCR032       IF MORE IOBS TO SCHEDULE ,BRANCH     46200019
         OI    DCBORBYT,BUFPRIME   SET BUFFERS PRIMED SWITCH ON         46500019
*                                                                       46800019
*********************************************************************** 47100019
*                                                                       47400019
OCR035   TM    DCBIOBA,RELEASE     RELEASE CALLED FOR                   47700019
         BO    OCR055              BRANCH TO SCHEDULE BUFFER            48000019
*                                                                       48300019
         CR    RECADR,EOBADR       HAS END OF BLOCK BEEN REACHED YET    48600019
         BL    OCR045              NO, BRANCH                           48900019
OCR037   L     ENTRYR,DCBGERR      LOAD ADDRESS OF SYNCH AND ERROR PROC 49200019
OCR040   BALR  RETR,ENTRYR         BRANCH AND LINK TO GERR RTN          49500019
OCR045   CLC   DCBERRCN+1(ADDRESS),ZEROS ARE COUNTERS SPECIFIED         49800019
         BE    OCR050              NO, BRANCH                           50100019
*                                                                       50400019
         L     WORK1R,DCBERRCN     LOAD ADR OF 32 BYTE COUNT AREA       50700019
         L     WORK2R,LINECNT(WORK1R) LOAD NO. OF LINES READ            51000019
         LA    WORK2R,ONE(WORK2R)  ADD 1 TO COUNT                       51300019
         ST    WORK2R,LINECNT(WORK1R) STORE COUNT                       51600019
OCR050   L     PARA1R,REG0SAV(SAVR) MAKE WORK AREA ADDRESSABEL          51900019
         LH    LRECLR,DCBLRECL     LOAD LENGTH OF RECORD--LESS THAN 256 52200019
         BCTR  LRECLR,0            DECREMENT BY 1                       52500019
*                                                                       52800019
         EX    LRECLR,OCR076E      MOVE RECORD TO WORK AREA             53100019
*                                                                       53400019
         CLC   DCBBUFL(LNGH),DCBLRECL MORE THAN 1 REC IN A BUFFER       53700019
         BH    OCR110              YES, BRANCH                          54000019
*                                                                       54300019
         MVC   DCBRECAD+1(ADDRESS),DCBEOBAD+1 SIMULATE END OF BLOCK     54600019
OCR055   LA    RETR,OCR085         LOAD RETURN ADDRESS FOR SUBROUTINE   54900019
 EJECT                                                                  55200019
*********************************************************************** 55500019
*                                                                       55800019
*        CLEAR BUFFER SUBROUTINE                                        56100019
*                                                                       56400019
*********************************************************************** 56700019
OCR060   SR    WORK1R,WORK1R       CLEAR REGISTER                       57000019
         IC    WORK1R,DCBOFFSR     GET OFFSET OF CHANNEL PROGRAM        57300019
         AR    WORK1R,IOBADR       GET ADDRESS OF CHANNEL PROGRAM       57600019
         L     BUFADR,BUF(WORK1R)  LOAD BUFFER ADDRESS                  57900019
         LA    BUFADR,ONE(BUFADR)    CLEAR HI BYTE AND INCREMENT BY 1   58200019
         SH    BUFADR,CNT(WORK1R)  SUBTRACT RECORD LENGTH               58500019
         LH    LNGHR,DCBBUFL       LOAD LENGTH OF BUFFER                58800019
         LA    CON255R,C255        LOAD CONSTANT = 255                  59100019
         BCTR  LNGHR,0             DECREMENT LENGTH BY 1                59400019
*                                                                       59700019
OCR070   CR    LNGHR,CON255R       COMPARE LENGTH TO CLEAR TO 255       60000019
         BNH   OCR080              IF 255 OR LESS,BRANCH                60300019
*                                                                       60600019
         EX    CON255R,OCR075E     CLEAR 256 BYTES                      60900019
*                                                                       61200019
         SR    LNGHR,CON255R       SUBTRACT 255 FROM AMOUNT TO BE CLEAR 61500019
         BCTR  LNGHR,0             SUBTRACT ONE MORE                    61800019
*                                                                       62100019
         LA    BUFADR,C256(BUFADR)  INCREMENT BUFFER ADDRESS BY 256     62400019
         B     OCR070              BRANCH TO CLEAR NEXT PORTION OF BUF  62700019
*                                                                       63000019
OCR075E  XC    0(1,BUFADR),0(BUFADR) CLEAR INSTRUCTION USED BY EXECUTE  63300019
OCR076E  MVC   0(1,PARA1R),0(RECADR) MOVE  INSTRUCTION USED BY EXECUTE  63600019
*                                                                       63900019
*                                                                       64200019
*                                                                       64500019
OCR080   EX    LNGHR,OCR075E       CLEAR REMAINDER OF BUFFER            64800019
         BR    RETR                BRANCH TO CALLING ROUTINE            65100019
*********************************************************************** 65400019
 EJECT                                                                  65700019
OCR085   TM    DCBORBYT,EOFBIT     TEST IF END OF FILE IS ON            66000019
         BO    OCR095              IF YES, DO NOT SCHEDULE, BRANCH      66300019
         L     ENTRYR,DCBEOB       LOAD END OF BLOCK ROUTINE ADDRESS    66600019
OCR090   BALR  RETR,ENTRYR         BRANCH AND LINK TO END OF BLOCK RTN  66900019
*                                                                       67200019
OCR095   TM    DCBIOBA,RELEASE     IS RELEASE SWITCH ON                 67500019
         BO    OCR037              YES, BRANCH TO GET NEW BUFFER        67800019
*                                                                       68100019
         SR    ENTRYR,ENTRYR       CLEAR REGISTER                       68400019
         CLI   DCBEIB+1,NOERROR    IS RETURN CODE = 0                   68700019
         BE    OCR100              YES, BRANCH TO RESTORE REGS          69000019
*                                                                       69300019
         IC    ENTRYR,DCBEIB+1     LOAD RETURN CODE                     69600019
         XC    DCBEIB+1(ONE),DCBEIB+1 CLEAR RETURN CODE SAVE AREA       69900019
*                                                                       70200019
OCR100   LM    DCBR,BASER,USERREG(SAVR) RESTORE  USER REGISTERS         70500019
         L     PARA1R,REG0SAV(SAVR) RESTORE WORK AREA ADDRESS           70800019
         L     RETR,RETREG(SAVR)   RESTORE RETURN ADDRESS               71100019
OCR105   BR    RETR                RETURN TO USER                       71400019
*                                                                       71700019
OCR110   L     RECADR,DCBRECAD     LOAD ADDRESS OF CURRENT RECORD       72000019
         AH    RECADR,DCBLRECL     DETERMINE NEXT RECORD ADDRESS        72300019
         ST    RECADR,DCBRECAD     STORE ADDRESS OF NEXT RECORD         72600019
         CLC   DCBEOBAD+1(ADDRESS),DCBRECAD+1 IS IT END OF BLOCK YET    72900019
         BNH   OCR055              YES, BRANCH                          73200019
         SR    ENTRYR,ENTRYR       SET RETURN CODE TO ZERO              73500019
         B     OCR100              BRANCH TO RETURN TO USER             73800019
         CNOP  0,8                 PAD MODULE  TO DOUBLE WORD           74100019
         DCBD  DSORG=PS,DEVD=OR                                @YM00635 74400002
         END                                                            74700019
./  ADD  SSI=40650104,NAME=IGG019VD
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00100002
**** END OF SPECIFICATIONS ***/                                         00150002
   TITLE   'IGG019VD - GET MOVE VARIABLE AND UNDEFINED RECORDS (OCR)'   00300019
IGG019VD CSECT                                                          00600019
***********************************************************    @YM00638 00650002
*MODULE-NAME                                                   @YM00638 00700002
* IGG019VD                                                     @YM00638 00750002
*                                                              @YM00638 00800002
*DESCRIPTIVE-NAME                                              @YM00638 00850002
* OCR GET, MOVE MODE, VARIABLE AND UNDEFINED RECORDS           @YM00638 00860002
*                                                              @YM00638 00870002
*COPYRIGHT                                                     @YM00638 00880002
* NONE                                                         @YM00638 00890002
*                                                              @YM00638 00892002
*CHANGE-ACTIVITY                                               @YM00638 00894002
*                                                                       00900019
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                01200020
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                01500020
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                01800020
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                02100020
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                02400020
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                02700020
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                03000020
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                03300020
*                                                                       03600019
* STATUS - CHANGE LEVEL 00  RELEASE 20                                  03900020
*                                                                       04200019
*                                                                       04500019
*FUNCTION-GET- TO MOVE A LOGICAL RECORD FROM A BUFFER TO A USER         04800019
*              WORKAREA. IF THE BUFFER IS EMPTIED A NEW ONE IS ACCEPTED 05100019
*              AFTER THE OLD ONE HAS BEEN SCHEDULED FOR REFILLING       05400019
*              BY THE END OF BLOCK ROUTINE                              05700019
*         RELEASE- CAUSES THE REMAINING CONTENTS OF THE CURRENT BUFFER  06000019
*                  TO BE IGNORED                                        06300019
*                                                                       06600019
*ENTRY POINTS                                                           06900019
*        LABEL  OCR010                                                  07200019
*        LABEL  OCR020                                                  07500019
*                                                                       07800019
*ENTRY INSTRUCTION SEQUENCE                                             08100019
*              GET                 RELESE                               08400019
*                LA      1,DCB       LA      1,DCB                      08700019
*                L       15,48(1)    L       15,48(1)                   09000019
*                BALR    14,15       BALR    14,8(15)                   09300019
*                                                                       09600019
*INPUT FROM USER AS ADDRESSES IN FOLLOWING REGISTERS                    09900019
*        REG   0    USED IN MOVE MODE-CONTAINS ADDRESS OF INPUT AREA    10200019
*        REG   1    DCB ADDRESS                                         10500019
*        REG   13   WORK-SAVE ADDRESS                                   10800019
*        REG   14   USER IN-LINE RETURN ADDRESS                         11100019
*        REG   15   THIS ROUTINES INITIAL BASE ADDRESS                  11400019
*                                                                       11700019
*OUTPUT REGISTER ADDRESSES AS FOLLOWS                                   12000019
*        REG   0    NOT APPLICABLE                                      12300019
*        REG   1    RECORD ADDRESS LOCATED FOR USER                     12600019
*        REG   13   WORK-SAVE ADDRESS                                   12900019
*        REG   14   RETURN ADDRESS                                      13200019
*        REG   15   RETURN CODE                                         13500019
*        REG   2-12 AS UPON ENTRY TO THIS ROUTINE                       13800019
*                                                                       14100019
*EXTERNAL ROUTINES                                                      14400019
*                                                                       14700019
*        IGG019VE - INPUT ERROR ROUTINE WHICH DETECTS, CORRECTS DEVICE  15000019
*                   ERRORS AND RETURNS BLOCK OF DATA.                   15300019
*        IGG019CC   END OF BLOCK ROUTINE WHICH SCHEDULES REQUESTS.      15600019
*EXITS                                                                  15900019
*        OCR025     BRANCH TO USER,RETURNS PARAMETERS                   16200019
*        OCR034     BRANCH AND LINK TO END OF BLOCK ROUTINE             16500019
*        OCR130     BRANCH AND LINK TO END OF BLOCK ROUTINE             16800019
*        OCR040     BRANCH AND LINK TO INPUT ERROR ROUTINE              17100019
*        OCR145     BRANCH TO USER, RETURNS PARAMETERS                  17400019
*                                                                       17700019
*TABLES/WORKAREAS                                                       18000019
*                                                                       18300019
*        USER  SAVE/WORK AREA-LAST 13 WORDS USED                        18600019
*        DCB                                                            18900019
*                                                                       19200019
*        IOB                                                            19500019
*                                                                       19800019
*ATTRIBUTES---REENTRANT,REUSABLE,PROBLEM PROGRAM MODE                   20100019
*                                                                       20400019
*******************************************************************     20700019
*                                                                       21000019
*  ALL REGISTER EQUATES HAVE AN 'R' AT THE END OF THE SYMBOL            21300019
*                                                                       21600019
*                                                                       21900019
*********************************************************************** 22200019
PARA1R   EQU   1                   PARAMETER REGISTER 1                 22500019
BUFADR   EQU   1                   ADDRESS OF BUFFER                    22800019
DCBR     EQU   2                   DCB ADDRESS                          23100019
IOBADR   EQU   3                   IOB ADDRESS                          23400019
EOBADR   EQU   4                   EOB ADDRESS                          23700019
RECADR   EQU   5                   RECORD ADDRESS                       24000019
WORK3R   EQU   6                   WORK REGISTER                        24300019
WORK1R   EQU   7                   WORK REGISTER                        24600019
CON255R  EQU   7                   WORK REGISTER-CONTAINS 255           24900019
BASER    EQU   8                   BASE REGISTER                        25200019
SAVR     EQU   13                  USER SAVE AREA                       25500019
RETR     EQU   14                  RETURN ADDRESS                       25800019
WORK2R   EQU   14                  WORK REGISTER                        26100019
ENTRYR   EQU   15                  ENTRY ADDRESS                        26400019
LNGHR    EQU   15                  WORK REGISTER-CONTAINS BUFFER LNGH   26700019
*********************************************************************** 27000019
EOFBIT   EQU   X'40'               DCBORBYT-END OF FILE BIT             27300019
BUFPRIME EQU   X'20'               DCBORBYT-BUFFERS PRIMED BIT          27600019
ERRFLGS  EQU   X'3F'               DCBIFLGS-DCB ERROR FLGS OFF          27900019
BUF      EQU   0                   OFFSET OF BUFFER ADDRESS IN CCW      28200019
CNT      EQU   6                   OFFSET OF COUNT IN CCW               28500019
LINECNT  EQU   28                  OFFSET OF LINE COUNT IN ERROR CNTRS  28800019
NOERROR  EQU   X'00'               TESTS FOR RETURN CODE OF ZERO        29100019
C255     EQU   255                 USED TO CLEAR 256 BYTES OF CORE      29400019
C256     EQU   256                 USED TO INCREMENT POINTER BY 256     29700019
ADDRESS  EQU   3                   LENGTH OF AN ADDRESS                 30000019
ONE      EQU   1                   USED TO INCREMENT BY 1               30300019
USERREG  EQU   36                  SAVE AREA OFFSET TO REG2             30600019
RETREG   EQU   20                  SAVE AREA OFFSET TO REG14            30900019
SAVREG   EQU   20                  SAVE AREA OFFSET TO STORE REGISTERS  31200019
REG0SAV  EQU   28                  OFFSET IN SAVE AREA FOR REGISTER 0   31500019
RELEASE  EQU   X'F0'               USED IF BUFFER IS TO BE RELEASED     31800019
LNGH     EQU   2                   LENGTH OF NUMBER IN PREFIX           32100019
LPREFIX  EQU   4                   LENGTH OF A VARIABLE RECORD PREFIX   32400019
ZERO     EQU   0                   USED AS A CONSTANT OF ZERO           32700019
UNDEF    EQU   X'C0'               USED TO TEST FOR UNDEFINED RECORDS   33000019
TWO      EQU   2                   USED AS AN OFFSET OF TWO IN PREFIX   33300019
 EJECT                                                                  33600019
         USING IGG019VD,ENTRYR     USE ENTRY POINT AS A BASE (REG 15)   33900019
         USING IHADCB,PARA1R       USE DCB ADDRESS AS A BASE (REG 1)    34200019
*                                                                       34500019
OCR010   B     OCR030              BRANCH AROUND RELEASE                34800019
ZEROS    DC    X'00000000'         FILL FOR ENTRY AT +8 - USE AS CON=0  35100019
*                                                                       35400019
OCR020   CLC   DCBEOBAD+1(ADDRESS),DCBRECAD+1 END OF BLOCK YET          35700019
         BCR   8,RETR              YES, RETURN TO USER                  36000019
         OI    DCBIOBA,RELEASE     SET, RELEASE SWITCH                  36300019
OCR025   BR    RETR                RETURN TO THE USER                   36600019
OCR030   STM   RETR,BASER,SAVREG(SAVR) SAVE USER REGISTERS              36900019
*                                                                       37200019
         DROP  ENTRYR              DROP REG 15 AS BASE FOR MODULE       37500019
         DROP  PARA1R              DROP REG 1 AS BASE FOR DCB           37800019
         USING IGG019VD,BASER      NEW BASE REG ADDRESSABILITY          38100019
         USING IHADCB,DCBR         NEW DCB  REG ADDRESSABILITY          38400019
*                                                                       38700019
         LR    BASER,ENTRYR        LOAD BASE ADDRESS                    39000019
         LR    DCBR,PARA1R         LOAD DCB ADDRESS                     39300019
         LM    IOBADR,RECADR,DCBIOBA LOAD WORK REGISTERS                39600019
         TM    DCBORBYT,BUFPRIME   ARE THE BUFFERS PRIMED               39900019
         BNZ   OCR035              YES, BRANCH                          40200019
*********************************************************************** 40500019
*                                                                       40800019
*        PRIME BUFFERS SUBROUTINE                                       41100019
*                                                                       41400019
*********************************************************************** 41700019
*                                                                       42000019
         NI    DCBIFLGS,ERRFLGS    MAKE SURE ERROR FLAGS ARE OFF        42300019
*                                                                       42600019
         SR    WORK3R,WORK3R       CLEAR A WORK REGISTER                42900019
         IC    WORK3R,DCBBUFNO     GET NUMBER OF BUFFERS                43200019
         B     OCR033              BRANCH TO SCHEDULE BUFFERS           43500019
*                                                                       43800019
OCR032   L     IOBADR,0(IOBADR)    GET NEXT IOB ADDRESS                 44100019
         ST    IOBADR,DCBIOBA      STORE THE ADDRESS OF NEXT IOB TO DCB 44400019
OCR033   BAL   RETR,OCR100         BRANCH AND LINK TO CLEAR THE BUFFER  44700019
*                                                                       45000019
         L     ENTRYR,DCBEOB       LOAD ADDRESS OF END OF BLOCK ROUTINE 45300019
OCR034   BALR  RETR,ENTRYR         BRANCH AND LINK TO EOB ROUTINE       45600019
         BCT   WORK3R,OCR032       IF MORE IOBS TO SCHEDULE ,BRANCH     45900019
*                                                                       46200019
         OI    DCBORBYT,BUFPRIME   SET BUFFERS PRIMED SWITCH ON         46500019
*                                                                       46800019
*********************************************************************** 47100019
OCR035   TM    DCBIOBA,RELEASE     RELEASE CALLED FOR                   47400019
         BO    OCR095              BRANCH TO SCHEDULE BUFFER            47700019
*                                                                       48000019
         CR    RECADR,EOBADR       HAS END OF BLOCK BEEN REACHED YET    48300019
         BL    OCR045              NO, BRANCH                           48600019
OCR037   L     ENTRYR,DCBGERR      LOAD ADDRESS OF SYNCH AND ERROR PROC 48900019
OCR040   BALR  RETR,ENTRYR         BRANCH AND LINK TO GERR RTN          49200019
OCR045   CLC   DCBERRCN+1(ADDRESS),ZEROS ARE COUNTERS SPECIFIED         49500019
         BE    OCR050              NO, BRANCH                           49800019
*                                                                       50100019
         L     WORK1R,DCBERRCN     LOAD ADDRESS OF 32 BYTE  COUNT AREA  50400019
         L     WORK2R,LINECNT(WORK1R) LOAD NO. OF LINES READ            50700019
         LA    WORK2R,ONE(WORK2R)  ADD 1 TO THE COUNT                   51000019
         ST    WORK2R,LINECNT(WORK1R) STORE COUNT                       51300019
OCR050   LR    WORK2R,RECADR       LOAD RECORD ADDRESS                  51600019
         L     PARA1R,REG0SAV(SAVR) MAKE WORK AREA ADDRESSABLE          51900019
         SR    WORK1R,WORK1R       CLEAR REGISTER                       52200019
         IC    WORK1R,DCBOFFSR     LOAD CHANNEL PROGRAM OFFSET          52500019
         AR    WORK1R,IOBADR       LOAD CHANNEL PROGRAM ADDRESS         52800019
         LH    LNGHR,CNT(WORK1R)   LOAD LENGTH OF BUFFER FROM CCW       53100019
*                                                                       53400019
         TM    DCBRECFM,UNDEF      UNDEFINED RECORDS SPECIFIED          53700019
         BO    OCR055              YES, BRANCH                          54000019
         LA    LNGHR,LPREFIX(LNGHR) ADD 4 TO VAR RECS TO GET END        54300019
OCR055   LR    WORK3R,LNGHR        LOAD COUNT TO SCAN RECORD BUFFER     54600019
OCR057   CLI   0(RECADR),ZERO      IS BUFFER  BYTE = 0                  54900019
         BNE   OCR060              NO, BRANCH                           55200019
         LA    RECADR,ONE(RECADR)  INCREMENT BUFFER POINTER BY 1        55500019
         BCT   WORK3R,OCR057       BRANCH TO CHECK NEXT BYTE FOR ZERO   55800019
OCR060   AR    WORK2R,LNGHR        ADD  MAX LNGH TO BEGIN TO GET END    56100019
OCR070   ST    WORK2R,DCBRECAD     STORE ADDRESS OF NEXT RECORD         56400019
         SR    WORK2R,RECADR       SUB BEGIN OF DATA FROM END OF BUFFER 56700019
*                                                                       57000019
         TM    DCBRECFM,UNDEF      TEST FOR UNDEFINED RECORDS           57300019
         BO    OCR080              YES, BRANCH                          57600019
*                                                                       57900019
         LA    WORK2R,LPREFIX(WORK2R) ADD 4 TO VAR RECS TO INCLUDE PREF 58200019
         STH   WORK2R,DCBLRECL     STORE LNGTH TO DCB                   58500019
         MVC   0(LNGH,PARA1R),DCBLRECL MOVE LENGTH TO PREFIX            58800019
         XC    TWO(LNGH,PARA1R),TWO(PARA1R) CLEAR RIGHTMOST TWO BYTES   59100019
*                                           OF PREFIX IN USER AREA      59400019
         LA    PARA1R,LPREFIX(PARA1R) GET ADDR OF RECORD IN WORK AREA   59700019
         SH    WORK2R,FOUR         SUBTRACT FOUR TO GET LNGTH OF REC    60000019
         B     OCR090              BRANCH TO MOVE RECORD                60300019
*                                                                       60600019
*                                                                       60900019
OCR080   STH   WORK2R,DCBLRECL     STORE RECORD LENGTH TO DCB           61200019
*                                                                       61500019
OCR090   LTR   WORK2R,WORK2R       TEST LENGTH OF RECORD FOR 0          61800019
         BZ    OCR092              IF LENGTH IS ZERO, DO NOT MOVE       62100019
         BCTR  WORK2R,0            DECREMENT LENGTH BY 1 FOR MOVE       62400019
         EX    WORK2R,OCR117E      MOVE RECORD TO USER WORK AREA        62700019
OCR092   CLC   DCBEOBAD+1(ADDRESS),DCBRECAD+1 TEST IF MORE THAN  RECS   63000019
         BH    OCR150              YES, BRANCH                          63300019
*                                                                       63600019
*                                                                       63900019
OCR095   LA    RETR,OCR125         LOAD RETURN ADDRESS FOR SUBROUTINE   64200019
 EJECT                                                                  64500019
*********************************************************************** 64800019
*                                                                       65100019
*        CLEAR BUFFER SUBROUTINE                                        65400019
*                                                                       65700019
*********************************************************************** 66000019
OCR100   SR    WORK1R,WORK1R       CLEAR REGISTER                       66300019
         IC    WORK1R,DCBOFFSR     GET OFFSET OF CHANNEL PROGRAM        66600019
         AR    WORK1R,IOBADR       GET ADDRESS OF CHANNEL PROGRAM       66900019
         L     BUFADR,BUF(WORK1R)  LOAD BUFFER ADDRESS                  67200019
         LA    BUFADR,ONE(BUFADR)  CLEAR HI BYTE AND INCREMENT BY 1     67500019
         SH    BUFADR,CNT(WORK1R)  SUBTRACT RECORD LENGTH               67800019
         TM    DCBRECFM,UNDEF      UNDEFINED RECORDS                    68100019
         BO    OCR105              YES, BRANCH                          68400019
         SH    BUFADR,FOUR         FOUR BYTE PREFIX IN IN BUFFER        68700019
*                                                                       69000019
OCR105   LH    LNGHR,DCBBUFL       LOAD LENGTH OF BUFFER                69300019
         LA    CON255R,C255        LOAD CONSTANT = 255                  69600019
         BCTR  LNGHR,0             DECREMENT LENGTH BY 1                69900019
*                                                                       70200019
OCR110   CR    LNGHR,CON255R       COMPARE LENGTH TO CLEAR WITH 255     70500019
         BNH   OCR120              IF 255 OR LESS, BRANCH               70800019
*                                                                       71100019
         EX    CON255R,OCR115E     CLEAR 256 BYTES                      71400019
*                                                                       71700019
         SR    LNGHR,CON255R       SUBTRACT 255 FROM AMOUNT TO BE CLEAR 72000019
         BCTR  LNGHR,0             SUBTRACT ONE MORE                    72300019
         LA    BUFADR,C256(BUFADR) INCREMENT BUFFER ADDRESS BY 256      72600019
         B     OCR110              BRANCH TO CLEAR NEXT PORTION OF BUF  72900019
*                                                                       73200019
OCR115E  XC    0(1,BUFADR),0(BUFADR) CLEAR INSTRUCTION USED BY EXECUTE  73500019
OCR117E  MVC   0(1,PARA1R),0(RECADR) MOVE INSTRUCTION USED BY EXECUTE   73800019
*                                                                       74100019
OCR120   EX    LNGHR,OCR115E       CLEAR REMAINDER OF BUFFER            74400019
         BR    RETR                BRANCH TO CALLING ROUTINE            74700019
*********************************************************************** 75000019
 EJECT                                                                  75300019
OCR125   TM    DCBORBYT,EOFBIT     TEST IF END OF FILE IS ON            75600019
         BO    OCR135              IF YES, DO NOT SCHEDULE, BRANCH      75900019
         L     ENTRYR,DCBEOB       LOAD END OF BLOCK ROUTINE ADDRESS    76200019
*                                                                       76500019
OCR130   BALR  RETR,ENTRYR         BRANCH AND LINK TO THE EOB ROUTINE   76800019
*                                                                       77100019
OCR135   TM    DCBIOBA,RELEASE     IS RELEASE SWITCH ON                 77400019
         BO    OCR037              IF YES, BRANCH                       77700019
*                                                                       78000019
         SR    ENTRYR,ENTRYR       CLEAR REGISTER                       78300019
         CLI   DCBEIB+1,NOERROR    IS RETURN CODE =0                    78600019
         BE    OCR140              YES, BRANCH TO RESTORE REGS          78900019
*                                                                       79200019
         IC    ENTRYR,DCBEIB+1     LOAD RETURN CODE                     79500019
         XC    DCBEIB+1(ONE),DCBEIB+1 CLEAR RETURN CODE SAVE AREA       79800019
*                                                                       80100019
OCR140   LM    DCBR,BASER,USERREG(SAVR) RESTORE USER REGISTERS          80400019
         L     PARA1R,REG0SAV(SAVR) RESTORE WORK AREA ADDRESS           80700019
         L     RETR,RETREG(SAVR)   RESTORE RETURN REGISTER              81000019
OCR145   BR    RETR                RETURN TO USER                       81300019
*                                                                       81600019
OCR150   SR    ENTRYR,ENTRYR       SET RETURN CODE TO ZERO              81900019
         B     OCR140              BRANCH TO RETURN TO USER             82200019
FOUR     DC    H'4'                USED AS A CONSTANT OF 4              82500019
         CNOP  0,8                 PAD MODULE  TO DOUBLE WORD           82800019
         DCBD  DSORG=PS,DEVD=OR                                @YM00635 83100002
         END                                                            83400019
./  ADD  SSI=80610034,NAME=IGG019VE
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00060002
**** END OF SPECIFICATIONS ***/                                         00070002
         TITLE  ' IGG019VE - SYNCH  AND ERROR PROCESSING ROUTINE-(OCR)' 00100019
IGG019VE CSECT                                                          00300019
***********************************************************    @YM00638 00350002
*MODULE-NAME                                                   @YM00638 00360002
* IGG019VE                                                     @YM00638 00370002
*                                                              @YM00638 00380002
*DESCRIPTIVE-NAME                                              @YM00638 00390002
* OCR SYNCH AND ERROR PROCESSING MODULE                        @YM00638 00392002
*                                                              @YM00638 00394002
*COPYRIGHT                                                     @YM00638 00396002
* NONE                                                         @YM00638 00398002
*                                                              @YM00638 00398402
*CHANGE-ACTIVITY                                               @YM00638 00398802
*                                                                       00400019
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                00500001
*A535500                                                         A33940 00550001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                00600001
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                00700001
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                00800001
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                00900001
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                01000001
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                01100001
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                01200001
*                                                                       01300019
*                                                                       01400019
* STATUS - CHANGE LEVEL 01  RELEASE 20                                  01500001
*                                                                       01600019
*                                                                       01700019
*FUNCTION-SYNCH ROUTINE-TO ACQUIRE NEXT SEQUENTIAL IOB AND WAIT FOR     01800019
*                       COMPLETION(TEST PREVIOUS EXCP STATUS)           01900019
*                       1) NORMAL COMPLETION RETURNS TO GET ROUTINE     02000019
*                       2) INCOMPLETE ISSUES WAIT                       02100019
*                       3) ABNORMAL CONDITION GOES TO USERS SYNAD ROUTN 02200019
*                       4) EOF CONDITION ISSUES EOV TO EXECUTOR         02300019
*        -EIB ROUTINE-                                                  02400019
*                       1) SET ERROR INDICATOR BYTE                     02500019
*        -COMPLETION CODE ROUTINE-                                      02600019
*                       1) SET COMPLETION CODE                          02700019
*        -COUNTER ROUTINE-                                              02800019
*                       1) UPDATE TEMPORARY ERROR COUNTERS              02900019
*ENTRY POINTS                                                           03000019
*        LABEL  OCR010                                                  03100019
*        LABEL  OCR020                                                  03200019
*        LABEL  OCR030                                                  03300019
*        LABEL  OCR035                                                  03400019
*                                                                       03500019
*ENTRY INSTRUCTION SEQUENCE                                             03600019
*             /SYNCH/             /EIB/          /COMP CODE/            03700019
*        LA    1,DCB                                                    03800019
*        L     15,DCBGERR     L    15,DCBGERR     L    15,DCBGERR       03900019
*        BALR  14,15          BAL  14,8(15)       BAL  14,16(15)        04000019
*                                                                       04100019
*             /COUNTER/                                                 04200019
*        L     15,DCBGERR                                               04300019
*        BAL   14,24(15)                                                04400019
*                                                                       04500019
*INPUT FROM CALLING ROUTINES -/SYNCH/EIB/COMP CODE/COUNTER/ ROUTINES    04600019
*        REG   0-1   N/A                                                04700019
*        REG   2    DCB ADDRESS                                         04800019
*        REG   3    IOB ADDRESS                                         04900019
*        REG   4-7  N/A                                                 05000019
*        REG   8    N/A FOR GERR , MUST BE AVAILABLE FOR BASE REG       05100019
*                   FOR EIB,COMP CODE, AND COUNTER ROUTINES             05200019
*        REG   9-12 N/A                                                 05300019
*        REG   13   WORK-SAVE ADDRESS                                   05400019
*        REG   14   CALLING ROUTINE IN-LINE RETURN ADDRESS              05500019
*        REG   15   BASE ADDRESS                                        05600019
*OUTPUT TO CALLING ROUTINES -/SYNCH/EIB/COMP CODE/ ROUTINES             05700019
*        REG   0-1  N/A                                                 05800019
*        REG   2-7  AS UPON ENTRY EXCEPT FOR GERR PARAMETER CHANGES     05900019
*        REG   8    N/A EXCEPT GERR BASE                                06000019
*        REG   9-12 SAME AS ENTRY                                       06100019
*        REG   13   WORK-SAVE ADDRESS                                   06200019
*        REG   14   ADDRESS OF IN-LINE RETURN                           06300019
*        REG   15   N/A EXCEPT RETURN CODE FOR COMP CODE ROUTINE        06400019
*                                                                       06500019
*SYNAD REGISTERS - ENTRY FROM SYNCH TO SYNAD                            06600019
*        REG   0    IOB ADDRESS                                         06700019
*        REG   1    DCB ADDRESS                                         06800019
*        REG   2-12 USER SPECIFIED                                      06900019
*        REG   13   WORK-SAVE ADDRESS                                   07000019
*        REG   14   RETURN ADDRESS TO SYNCH ROUTINE                     07100019
*        REG   15   ENTRY ADDRESS TO SYNAD ROUTINE                      07200019
*        ----------EXIT FROM SYNAD TO SYNCH                             07300019
*        REG   0-1  N/A                                                 07400019
*        REG   2-12 USER SPECIFIED                                      07500019
*        REG   13   WORK-SAVE AREA                                      07600019
*        REG   14   RETURN ADDRESS TO SYNCH ROUTINE                     07700019
*        REG   15   ZERO OR ADDRESS OF USER SPECIFIED BRANCH ADDRESS    07800019
*                                                                       07900019
*EXTERNAL ROUTINES                                                      08000019
*        IGG019VA        GET LOC,F                                      08100019
*        IGG019VB        GET LOC,V,U                                    08200019
*        IGG019VC        GET MOV,F                                      08300019
*        IGG019VD        GET MOV,V,U                                    08400019
*        IGG019VH        CNTRL                                          08500019
*        IGG019VI        RDLNE                                          08600019
*        EOV             END OF VOLUME ROUTINE                          08700019
*                                                                       08800019
*EXITS-NORMAL                                                           08900019
*        OCR090     BRANCH TO CALLING ROUTINE FROM GERR                 09000019
*        OCR132     BRANCH AND LINK TO SYNAD                            09100019
*        OCR250     BRANCH TO CALLING ROUTINE FROM EIB  ROUTINE         09200019
*        OCR330     BRANCH TO CALLING ROUTINE FROM COMP CODE ROUTINE    09300019
*        OCR410     BRANCH TO CALLING ROUTINE FROM COUNTER ROUTINE      09400019
*        OCR133     EXIT TO USER SPECIFIED RETURN ADDRESS               09500019
*        OCR147     EOV EXIT                                            09600019
*     -ABNORMAL                                                         09700019
*        ABEND      COMPLETION-CODE =001  - ABE SPECIFIED               09800019
*TABLES/WORKAREA                                                        09900019
*                                                                       10000019
*        USER SAVE/WORK AREA                                            10100019
*        DCB                                                            10200019
*        IOB                                                            10300019
*                                                                       10400019
*ATTRIBUTES--REENTRANT,REUSABLE,PROBLEM PROGRAM MODE                    10500019
*                                                                       10600019
*                                                                       10700019
*                                                                       10800019
*                                                                       10900019
*                                                                       11000019
*                                                                       11100019
*********************************************************************** 11200019
*                                                                       11300019
*  ALL REGISTER EQUATES HAVE AN 'R' AT THE END OF THE SYMBOL            11400019
*                                                                       11500019
*********************************************************************** 11600019
*                                                                       11700019
PARA0R   EQU   0                   PARAMETER  REGISTER  0               11800019
PARA1R   EQU   1                   PARAMETER  REGISTER  1               11900019
WORK4R   EQU   1                   WORK REGISTER                        12000019
R1       EQU   1                   USED IN DOM MACRO                    12100019
DCBR     EQU   2                   DCB ADDRESS                          12200019
IOBADR   EQU   3                   IOB ADDRESS                          12300019
EOBADR   EQU   4                   EOB ADDRESS                          12400019
RECADR   EQU   5                   RECORD ADDRESS                       12500019
WORK1R   EQU   7                   WORK REGISTER                        12600019
BASER    EQU   8                   BASE REGISTER FOR THIS ROUTINE       12700019
WORK8R   EQU   8                   REG 8 FOR RESTORE        @ZA04457    12750003
SAVR     EQU   13                  USER SAVE AREA                       12800019
RETR     EQU   14                  RETURN ADDRESS                       12900019
WORK2R   EQU   14                  WORK REGISTER                        13000019
ENTRYR   EQU   15                  ENTRY ADDRESS                        13100019
WORK3R   EQU   15                  WORK REGISTER                        13200019
*                                                                       13300019
*                                                                       13400019
*********************************************************************** 13500019
*********************************************************************** 13600019
*                                                                       13700019
*                        ERROR COUNTER EQUATES                          13800019
*                                                                       13900019
*********************************************************************** 14000019
*********************************************************************** 14100019
ECCOUNT  EQU   0                   EQUIP CHECK RETRY COUNT IN USER AREA 14200019
PERMEC   EQU   4                   PERMANENT EQUIPMENT CHECK COUNTER    14300019
WLRCOUNT EQU   8                   WRONG LNGTH CNT IN  USER AREA        14400019
PERMWLR  EQU   12                  PERMANENT WRONG LENGTH REC COUNTER   14500019
KCCOUNT  EQU   16                  KEYBOARD CORRECTION COUNTER          14600019
DCCOUNT  EQU   20                  DATA CHECK RETRY COUNT IN USER AREA  14700019
DCRETRY  EQU   36                  DATA CHECK RETRY COUNT IN IOB        14800019
WLRETRY  EQU   37                  WRONG LNGTH CNT  IN IOB              14900019
ECRETRY  EQU   38                  EQUIP CHECK RETRY COUNT IN IOB       15000019
*********************************************************************** 15100019
*                                                                       15200019
*                        STATUS OR  SENSE                               15300019
*                                                                       15400019
*********************************************************************** 15500019
NONREC   EQU   X'02'               NON RECOVERY ERROR                   15600019
EQUCHK   EQU   X'10'               EQUIPMENT CHECK ERROR                15700019
DATACHK  EQU   X'08'               DATA CHECK ERROR                     15800019
KCORR    EQU   X'01'               KEY-BOARD CORRECTION                 15900019
WLR      EQU   X'40'               WRONG LENGTH RECORD ERROR            16000019
UNEXCEP  EQU   X'01'               UNIT EXCEPTION IN STATUS IN CSW(IOB) 16100019
COMREJ   EQU   X'80'               COMMAND REJECT                       16200019
INVCOM   EQU   X'08'               INVALID COMMAND                      16300019
SENS0ERR EQU   X'24'               BUS OUT , OVERRUN                    16400019
STAT1ERR EQU   X'3F'               PG C,PT C,C C C,C I C,C D C          16500019
*********************************************************************** 16600019
*                                                                       16700019
*                        DCBEIB -ERROR INDICATOR BYTE                   16800019
*                                                                       16900019
*********************************************************************** 17000019
NRBIT    EQU   X'10'               NON RECOVERY                         17100019
ECBIT    EQU   X'08'               EQUIPMENT CHECK                      17200019
DCBIT    EQU   X'01'               DATA CHECK                           17300019
KCHEBIT  EQU   X'02'               KEYBOARD CORRECTION                  17400019
WLRBIT   EQU   X'04'               WRONG LENGTH RECORD                  17500019
EIBERR   EQU   X'FF'               ANY ERROR IN DCBEIB                  17600019
*********************************************************************** 17700019
*                                                                       17800019
*                        DCB EQUATES                                    17900019
*                                                                       18000019
*********************************************************************** 18100019
ABEND2ND EQU   X'10'               2ND TIME INDICATOR FOR EOV RTN,      18200019
*                                    USED TO ABEND WITH A RET CODE OF 1 18300019
FORUB    EQU   X'80'               TEST FOR FIXED OR UNDEFINED          18400019
EOFBIT   EQU   X'40'               EOF BIT SWITCH IN DCBORBYT           18500019
ERRFLGS  EQU   X'3F'               ERROR FLAGS IN DCBI FLGS-X'C0'       18600019
SYNADOFF EQU   X'7F'               TURN SYNAD IN PROGRESS BIT OFF       18700019
SYNADBIT EQU   X'80'               SYNAD-IN-PROCESS BIT IN DCBORBYT     18800019
ABE      EQU   X'20'               ABEND OPTION IN DCBEROPT             18900019
SKP      EQU   X'40'               SKIP OPTION IN DCBEROPT              19000019
*********************************************************************** 19100019
*                                                                       19200019
*                        IOB EQUATES                                    19300019
*                                                                       19400019
*********************************************************************** 19500019
ECB      EQU   4                   ECB OFFSET IN QSAM IOB               19600019
COMPLETE EQU   X'40'               TEST IF ECB POSTED COMPLETE          19700019
PERROR   EQU   X'41'               TEST IF ECB POSTED WITH PERM ERROR   19800019
PERROR44 EQU   X'44'               TEST IF PERM ERROR          @ZA00774 19850003
IOSIOB   EQU   8                   PLUS 8 FROM ACCESS METHOD IOB        19900019
SENSE0   EQU   10                  SENSE BYTE 0 IN IOB                  20000019
SENSE1   EQU   11                  SENSE BYTE 1 IN IOB                  20100019
INTCCW   EQU   16                  INTERRUPTED CCW IN CSW IN IOB        20200019
STATUS   EQU   20                  STATUS IN CSW IN IOB                 20300019
RESIDUAL EQU   22                  OFFSET TO THE RESIDUAL COUNT IN CSW  20400019
CPADR    EQU   24                  OFFSET OF CHANNEL PROGRAM ADR IN IOB 20500019
TEMCCW   EQU   40                  OFFSET TO TEMPORARY CCW IN THE IOB   20600019
FLAG     EQU   44                  CCW FLAG BYTE AT IOB + 40            20700019
CCWSTART EQU   48                  START OF THE CHANNEL PROGRAM         20800019
RBCOM    EQU   X'0C'               READ BACKWARD COMMAND                20900019
BUF      EQU   0                   ADDR OF BUFFER OFFSET IN CCW         21000019
DATADR   EQU   0                   DATA ADDRESS OFFSET IN CCW           21100019
CNT      EQU   6                   COUNT FIELD OFFSET IN CCW            21200019
GNLCCW   EQU   8                   OFFSET TO GNL CCW IN RB AND GNL PAIR 21300019
CHAINOFF EQU   X'BF'               MASK TO TURN OFF COMMAND CHAINING    21400019
*********************************************************************** 21500019
FOURRC   EQU   4                   RETURN CODE OF FOUR                  21600019
EIGHTRC  EQU   8                   RETURN CODE OF EIGHT                 21700019
TWELVERC EQU   12                  RETURN CODE OF TWELVE                21800019
ZERO     EQU   0                   USED AS A CONSTANT OF ZERO           21900019
ONE      EQU   X'01'               CONSTANT 1                           22000019
CCWL     EQU   8                   LENGTH OF ONE CCW                    22100019
SYSCC    EQU   12                  USED AS A SHIFT TO SET A SYSTEM C C  22200019
HIBYTE   EQU   24                  USED TO SHIFT TO HI ORDER BYTE       22300019
TWO      EQU   2                   USED AS A CONSTANT OF 2              22400019
ADDRESS  EQU   3                   LENGTH OF AN ADDRESS                 22500019
INPREAD  EQU   X'90'               HI ORDER BYTE OF REG 1 FOR SYNAD ENT 22600019
RDNDATA  EQU   X'80'               INDICATES READ DATA                  22700019
USERREG  EQU   36                  OFFSET IN SAVE AREA TO USER REGS     22800019
TEMPSAV  EQU   32                  OFFSET TO SAVE AREA FOR DCB          22900019
GETREG   EQU   24                  SAVE AREA FOR ADDRESS OF GET ROUTINE 23000019
RETREG   EQU   64                  SAVE AREA FOR RETURN ADDRESS         23100019
SAVREG   EQU   64                  OFFSET IN SAVE AREA FOR USER REGS    23200019
BASEREG  EQU   68                  OFFSET IN SAVE AREA FOR SYNCH ADDR   23300019
*********************************************************************** 23400019
*********************************************************************** 23500019
 EJECT                                                                  23600019
         USING IGG019VE,ENTRYR     USE  REGISTER 15 AS A TEMP BASE      23700019
         USING IHADCB,DCBR         USE  REGISTER 2 AS DCB BASE          23800019
*********************************************************************** 23900019
*                                                                       24000019
*                        ENTRYS INTO THE SYNCH ROUTINE                  24100019
*                                                                       24200019
*********************************************************************** 24300019
*                                                                       24400019
OCR010   LR    BASER,ENTRYR        ENTRY +0 - LOAD NEW BASE REGISTER    24500019
         B     OCR040              BRANCH TO GERR ROUTINE               24600019
FOUR     DC    H'4'                FILLER - USED AS CONSTANT OF 4       24700019
OCR020   LR    BASER,ENTRYR        ENTRY +8 - LOAD NEW BASE REGISTER    24800019
         B     OCR200              BRANCH TO EIB ROUTINE                24900019
EIGHT    DC    H'8'                FILLER - USED AS CONSTANT OF 8       25000019
OCR030   LR    BASER,ENTRYR        ENTRY +16- LOAD NEW BASE REGISTER    25100019
         B     OCR300              BRANCH TO COMPLETION CODE ROUTINE    25200019
SIXTEEN  DC    H'16'               FILLER - USED AS CONSTANT OF 16      25300019
OCR035   LR    BASER,ENTRYR        ENTRY +24- LOAD NEW BASE REGISTER    25400019
         B     OCR400              BRANCH TO ERROR COUNTER ROUTINE      25500019
*                                                                       25600019
*********************************************************************** 25700019
OCR040   STM   RETR,ENTRYR,SAVREG(SAVR) SAVE RETURN AND ENTRY REGISTERS 25800019
         DROP  ENTRYR              DROP TEMPORARY BASE REG              25900019
         USING IGG019VE,BASER      USE NEW BASE REGISTER                26000019
*                                                                       26100019
OCR045   L     IOBADR,0(IOBADR)    GET THE ADDRESS OF THE NEXT IOB      26200019
         LA    IOBADR,0(IOBADR)    CLEAR HI ORDER BYTE                  26300019
*                                                                       26400019
         LA    WORK1R,CCWSTART(IOBADR)  GET ADDRESS OF CHANNEL PROGRAM  26500019
         L     WORK2R,BUF(WORK1R)  GET BUFFER ADDRESS                   26600019
         LA    WORK2R,ONE(WORK2R)  CLEAR HI ORDER BYTE AND INCREMENT 1  26700019
         SH    WORK2R,CNT(WORK1R)  SUBTRACT CCW COUNT TO GET BUF STRT   26800019
         TM    DCBRECFM,FORUB      TEST FOR FIXED OR UNDEFINED FORMAT   26900019
         BO    OCR050              BRANCH IF FIXED OR UNDEFINED         27000019
*                                                                       27100019
         SH    WORK2R,FOUR         IF VAR RECORDS, SUB 4 MORE TO GET    27200019
*                                  START OF BUFFER                      27300019
OCR050   ST    WORK2R,DCBRECAD     STORE ADDRESS OF FIRST RECORD        27400019
*                                                                       27500019
OCR060   TM    ECB(IOBADR),COMPLETE  IS EVENT NOT COMPLETE YET (X'80')  27600019
         BO    OCR065              IF COMPLETE BRANCH                   27700019
*                                                                       27800019
         WAIT  ECB=ECB(IOBADR)     WAIT FOR EVENT TO COMPLETE           27900019
*                                                                       28000019
OCR065   L     PARA1R,DCBWTOID     LOAD POSSIBL WTO ID                  28100019
         LTR   PARA1R,PARA1R       HAS WTO MESSAGE BEEN DELETED         28200019
         BZ    OCR070              IF ZEROS -YES, BRANCH                28300019
*                                                                       28400019
         DOM   MSG=(R1)            DELETE OPERATOR MESSAGE              28500019
*                                                                       28600019
         XC    DCBWTOID+1(ADDRESS),DCBWTOID+1  CLEAR MESSAGE ID         28700019
*                                                                       28800019
*                                                                       28900019
OCR070   BAL   RETR,OCR400         BRANCH AND LINK TO COUNTER ROUTINE   29000019
*                                                                       29100019
OCR080   L     RECADR,DCBRECAD     LOAD RECORD ADDRESS FOR RETURN       29200019
         LR    EOBADR,RECADR       COPY RECORD ADDRESS                  29300019
         AH    EOBADR,DCBBUFL      ESTABLISH EOB ADDRESS FOR RETURN     29400019
         STM   IOBADR,RECADR,DCBIOBA REINITIALIZE DCB FIELDS            29500019
         TM    DCBORBYT,EOFBIT     TEST FOR END OF FILE CONDITION       29600019
         BO    OCR100             IF EOF ON, BRANCH TO EOV RTN          29700019
         CLI   ECB(IOBADR),PERROR  DID A PERMANENT ERROR OCCUR          29800019
         BE    OCR120              YES, BRANCH TO HANDLE PERM ERROR     29900019
         CLI   ECB(IOBADR),PERROR44 DID PERM ERROR OCCUR       @ZA00774 29950003
         BE    OCR120              YES,BRANCH                  @ZA00774 29960003
*                                                                       30000019
OCR085   L     RECADR,DCBRECAD     LOAD ADDRESS OF START OF REC         30100019
         L     RETR,RETREG(SAVR)   LOAD RETURN ADDRESS                  30200019
         L     BASER,GETREG(SAVR)  LOAD ADDRESS OF GET ROUTINE          30300019
OCR090   BR    RETR                RETURN TO GET ROUTINE                30400019
 EJECT                                                                  30500019
*********************************************************************** 30600019
*                                                                       30700019
*        THIS CODE EXECUTED IF THERE ARE ANY ERRORS                     30800019
*                                                                       30900019
*********************************************************************** 31000019
*                                                                       31100019
OCR100   XC    STATUS(TWO,IOBADR),STATUS(IOBADR) CLEAR STATUS           31200019
         OI    STATUS(IOBADR),UNEXCEP SET UNIT EXCEPTION BIT ON         31300019
*                                                                       31400019
OCR110   MVI   DCBORBYT,ZERO       TURN OFF DCBORBYT SWITCHES           31500019
         MVC   DCBEOBAD+1(ADDRESS),DCBRECAD+1 SET EOB CONDITION         31600019
         B     OCR145              BRANCH TO GO TO EOV ROUTINE          31700019
*                                                                       31800019
OCR120   L     WORK1R,INTCCW(IOBADR) GET CCW ADDRESS                    31900019
         LA    WORK1R,0(WORK1R)    CLEAR HI ORDER BYTE                  32000019
*                                                                       32100019
OCR125   SR    EOBADR,EOBADR       CLEAR REGISTER                       32200019
         LA    WORK2R,CCWSTART+8(IOBADR)  LOAD ADDRESS OF CHANNEL PROGR 32300019
         CR    WORK1R,WORK2R       IS INTERRUPTED CCW VALID             32400019
         BL    OCR126              NO,BRANCH TO SET NEW EOB ADDRESS     32500019
         SH    WORK1R,EIGHT        BACK UP TO INTERRUPTED CCW           32600019
         L     EOBADR,DATADR(WORK1R) LOAD DATA ADDRESS FROM CCW         32700019
         LA    EOBADR,ONE(EOBADR)  CLEAR HI ORDER BYTE AND INC BY 1     32800019
*                                                                       32900019
OCR126   ST    EOBADR,DCBEOBAD     STORE NEW END OF BLOCK ADDRESS       33000019
*                                                                       33100019
OCR1261  BAL   RETR,OCR200         BRANCH AND LINK TO EIB ROUTINE       33200019
*                                                                       33300019
         BAL   RETR,OCR300         BRANCH AND LINK TO SET COMPLETION    33400019
*                                    CODE                               33500019
         STC   ENTRYR,DCBEIB+1     STORE RETURN CODE                    33600019
*                                                                       33700019
         TM    STATUS(IOBADR),UNEXCEP TEST FOR UNIT EXCEPTION CONDITION 33800019
         BZ    OCR130              BRANCH IF NOT UNIT EXCEPTION CONDITN 33900019
         LA    WORK2R,CCWSTART+8(IOBADR)   LOAD ADDR OF CHANNEL PROGRAM 34000019
         CR    WORK1R,WORK2R       COMPARE INT CCW WITH BEGIN OF CHAIN  34100019
         BNH   OCR110              BRANCH TO GO TO EOV ROUTINE          34200019
*                                                                       34300019
OCR127   OI    DCBORBYT,EOFBIT     SET EOF FOR NEXT GET                 34400019
         SH    WORK1R,SIXTEEN      BACK UP 16 MORE TO LAST READ CCW     34500019
         L     EOBADR,DATADR(WORK1R) LOAD THE DATA ADDRESS              34600019
         LA    EOBADR,ONE(EOBADR)  CLEAR HI ORDER BYTE AND INC BY 1     34700019
         ST    EOBADR,DCBEOBAD     STORE NEW END OF BLOCK ADDRESS       34800019
         B     OCR085              RETURN TO LOAD GET REGISTERS         34900019
*                                                                       35000019
*                                                                       35100019
OCR130   CLI   DCBSYNAD+3,ONE      IS SYNAD ROUTINE SPECIFIED           35200019
         BE    OCR135              NO, SYNAD ROUTINE NOT SPEC -BRANCH   35300019
 EJECT                                                                  35400019
*********************************************************************** 35500019
*                                                                       35600019
*        GO TO THE USER'S SYNAD ROUTINE                                 35700019
*                                                                       35800019
*********************************************************************** 35900019
         ST    DCBR,TEMPSAV(SAVR)  STORE DCB ADDRESS                    36000019
*                                                                       36100019
         LA    PARA1R,INPREAD      LOAD INPUT AND DATA BITS             36200019
         TM    0(WORK1R),RBCOM     TEST FOR READ BACKWARD COMMAND       36300019
         BNO   OCR131              BRANCH IF NOT READ BACKWARD          36400019
         CLC   RESIDUAL(TWO,IOBADR),CNT(WORK1R) COMP RESIDUAL TO ORGINL 36500019
         BL    OCR1311             BRANCH IF DATA READ                  36600019
OCR131   LA    PARA1R,RDNDATA      SET TO NO DATA READ                  36700019
OCR1311  SLL   PARA1R,HIBYTE       SHIFT TO HIGH ORDER BYTE             36800019
         OR    PARA1R,DCBR         DCB ADDRESS TO LOW ORDER 24 BITS     36900019
*                                                                       37000019
         LA    PARA0R,TEMCCW       LOAD OFFSET TO CHAN PROG             37100019
         SLL   PARA0R,HIBYTE       SHIFT TO HIGH ORDER BYTE             37200019
         LA    IOBADR,IOSIOB(IOBADR) POINT TO IOS IOB                   37300019
         OR    PARA0R,IOBADR       IOB ADDRESS TO LOW ORDER BYTES       37400019
*                                                                       37500019
         NI    DCBIFLGS,ERRFLGS    TURN ERROR FLAGS OFF                 37600019
         OI    DCBORBYT,SYNADBIT   SET SYNAD IN PROGRESS BIT ON         37700019
         L     ENTRYR,DCBSYNAD     LOAD SYNAD ROUTINE ADDRESS           37800019
         LM    DCBR,BASER,USERREG(SAVR) LOAD USER REGISTERS             37900019
OCR132   BALR  RETR,ENTRYR         BRANCH AND LINK TO USERS SYNAD ROUTN 38000019
*                                                                       38100019
         STM   DCBR,BASER,USERREG(SAVR) STORE USER REGISTERS            38200019
         L     DCBR,TEMPSAV(SAVR)  LOAD DCB ADDRESS                     38300019
         L     IOBADR,DCBIOBA      LOAD IOB ADDRESS                     38400019
         L     BASER,BASEREG(SAVR) RESTORE BASE REGISTER                38500019
         NI    DCBORBYT,SYNADOFF   TURN SYNAD IN PROCESS BIT OFF        38600019
         NI    DCBIFLGS,ERRFLGS    TURN DCB ERROR FLAGS OFF             38700019
*                                                                       38800019
*                                                                       38900019
         LTR   ENTRYR,ENTRYR       TEST REGISTER 15 FOR ZEROS           39000019
*                                                                       39100019
         BZ    OCR140              IF ZERO,BRANCH                       39200019
*                                                                       39300019
         NI    DCBORBYT,ZERO       RESET DCBORBYT SWITCHES              39400019
         MVC   DCBEOBAD+1(ADDRESS),DCBRECAD+1  SET EOB CONDITION        39500019
         LM    DCBR,WORK8R,USERREG(SAVR) RESTORE USER REG'S    @ZA04457 39600003
OCR133   BR    ENTRYR              BRANCH TO USER SPECIFIED ADDRESS     39700019
*                                                                       39800019
OCR135   NI    DCBIFLGS,ERRFLGS    RESET ERRFLGS IN DCBIFLGS            39900019
OCR140   TM    DCBEROPT,ABE        IS ABEND OPTION SPECIFIED            40000019
         BZ    OCR150              NO, BRANCH TO TEST FOR SKP           40100019
*                                                                       40200019
         OI    DCBCIND2,ABEND2ND   SET 2ND TIME SWITCH FOR ABEND        40300019
         LA    PARA0R,ONE          LOAD 1 TO REG 0                      40400019
         SLL   PARA0R,SYSCC        SHIFT LEFT 12 TO SET COMP CODE       40500019
         B     OCR147              BRANCH TO GO TO THE EOV ROUTINE      40600019
*                                                                       40700019
OCR145   LR    PARA0R,IOBADR       SET REGISTER 0 FOR EOV               40800019
*********************************************************************** 40900019
*                                                                       41000019
*        EXIT TO EOV                                                    41100019
*                                                                       41200019
*********************************************************************** 41300019
OCR147   EOV   (DCBR)              GO TO END OF VOLUME ROUTINE          41400019
*                                  NO RETURN                            41500019
*********************************************************************** 41600019
*                                                                       41700019
OCR150   TM    DCBEROPT,SKP        IS SKIP OPTION SPECIFIED             41800019
         BZ    OCR170              NO, BRANCH AND ASSUME ACC OPTION     41900019
         MVI   DCBEIB+1,ZERO       CLEAR RETURN CODE IF RECORD IS SKIPD 42000019
         L     EOBADR,DCBEOBAD     LOAD END OF BLOCK ADDRESS            42100019
         LA    WORK2R,CCWSTART(IOBADR)  LOAD ADDRESS OF THE C P         42200019
         SH    EOBADR,CNT(WORK2R)  SUBTRACT RECORD SIZE IE BUFFER SIZE  42300019
*                                                                       42400019
         TM    DCBRECFM,FORUB      TEST FOR FIXED OR UNDEFINED FORMAT   42500019
         BO    OCR160              BRANCH IF FIXED OR UNDEFINED         42600019
         SH    EOBADR,FOUR         IF VARIABLE,SUBTRACT FOUR MORE BECS  42700019
*                                  CCW COUNT DOES NOT INCLUDE PREFIX    42800019
OCR160   ST    EOBADR,DCBEOBAD     STORE NEW END OF BLOCK ADDRESS       42900019
*                                                                       43000019
 EJECT                                                                  43100019
*********************************************************************** 43200019
*                                                                       43300019
*        RESTART PROCEDURE                                              43400019
*                                                                       43500019
*********************************************************************** 43600019
OCR170   L     WORK1R,CPADR(IOBADR) LOAD CHANNEL PROGRAM ADDRESS        43700019
         MVC   TEMCCW(CCWL,IOBADR),GNLCCW(WORK1R) MOVE GNL CCW TO TEMP  43800019
         NI    FLAG(IOBADR),CHAINOFF TURN CHAINING BIT OFF              43900019
         LA    WORK2R,TEMCCW(IOBADR) LOAD ADDRESS OF TEMP GNL CCW       44000019
         ST    WORK2R,CPADR(IOBADR) STORE CHANNEL PROGRAM ADDR TO IOB   44100019
         EXCP  IOSIOB(IOBADR)      EXECUTE CHANNEL PROGRAM              44200019
         WAIT  ECB=ECB(IOBADR)     WAIT FOR COMPLETION OF EVENT         44300019
         ST    WORK1R,CPADR(IOBADR)  STORE ADDR OF ORIGINAL CHANNEL PRG 44400019
         CLI   ECB(IOBADR),PERROR  CHECK FOR A PERMANENT ERROR          44500019
         BE    OCR1261             IF AN ERROR, BRANCH TO PROCESS       44600019
         CLI   ECB(IOBADR),PERROR44 DID PERM ERROR OCCUR       @ZA00774 44650003
         BE    OCR1261             YES,BRANCH                  @ZA00774 44660003
         LR    WORK1R,IOBADR       COPY IOB ADDRESS                     44700019
OCR180   L     WORK1R,0(WORK1R)    GET NEXT IOB ADDRESS IN CHAIN        44800019
         LA    WORK1R,0(WORK1R)    CLEAR HI ORDER BYTE                  44900019
         CR    IOBADR,WORK1R       HAS IOB BEEN SCHEDULED               45000019
         BE    OCR190              BRANCH TO SEE IF ANY RECS IN BUFFER  45100019
*                                                                       45200019
*                                  RESCHEDULE THE BUFFER                45300019
         EXCP  IOSIOB(WORK1R)      EXECUTE CHANNEL PROGRAM              45400019
         B     OCR180              BRANCH  TO CHECK NEXT IOB            45500019
*                                                                       45600019
OCR190   CLC   DCBRECAD+1(ADDRESS),DCBEOBAD+1 ARE THERE ANY RECORDS IN  45700019
*                                       BUFFER-MIGHT HAVE BEEN SKIPPED  45800019
         BL    OCR085              IF RECORDS IN BUFFER,RETURN          45900019
*                                  RESCHEDULE THE BUFFER                46000019
         EXCP  IOSIOB(IOBADR)      EXECUTE CHANNEL PROGRAM              46100019
         B     OCR045              IF NONE IN THIS BUFFER, GO GET NEXT  46200019
 EJECT                                                                  46300019
*********************************************************************** 46400019
*                                                                       46500019
*        ERROR INDICATOR BYTE (EIB) ROUTINE                             46600019
*                                                                       46700019
*********************************************************************** 46800019
OCR200   MVI   DCBEIB,ZERO         CLEAR EIB                            46900019
         L     WORK3R,DCBERRCN     LOAD FROM DCBERRCN POSSIBLE AREA ADR 47000019
*                                                                       47100019
         TM    SENSE0(IOBADR),NONREC DID NON-RECOVERY ERROR OCCUR       47200019
         BZ    OCR210              NO, BRANCH                           47300019
         OI    DCBEIB,NRBIT        SET NON-RECOVERY BIT                 47400019
*                                                                       47500019
OCR210   TM    SENSE0(IOBADR),EQUCHK DID AN EQ CHK ERROR OCCUR          47600019
         BZ    OCR220              NO, BRANCH                           47700019
         LTR   WORK3R,WORK3R       IS AN ERROR COUNT ADDRESS SPECIFIED  47800019
         BZ    OCR215              NO, BRANCH                           47900019
         L     WORK4R,PERMEC(WORK3R) LOAD PERMANENT EQUIP CHK COUNT     48000019
         LA    WORK4R,ONE(WORK4R)    INCREMENT COUNT BY 1               48100019
         ST    WORK4R,PERMEC(WORK3R) STORE  COUNT                       48200019
*                                                                       48300019
OCR215   OI    DCBEIB,ECBIT        SET EQUIPMENT CHECK BIT IN DCBEIB    48400019
*                                                                       48500019
OCR220   TM    SENSE0(IOBADR),DATACHK DID A DATA CHECK ERROR OCCUR      48600019
         BZ    OCR230              NO,BRANCH                            48700019
         OI    DCBEIB,DCBIT        SET DATA CHECK BIT IN DCBEIB         48800019
*                                                                       48900019
OCR230   TM    SENSE0(IOBADR),KCORR DID KEYBOARD CORRECTION OCCUR       49000019
         BZ    OCR240              NO,BRANCH                            49100019
         OI    DCBEIB,KCHEBIT      SET KEYBOARD CORRECTION BIT DCBEIB   49200019
*                                                                       49300019
OCR240   TM    STATUS+1(IOBADR),WLR DID WRONG LNGTH RECORD OCCUR        49400019
         BCR   8,RETR              NO,BRANCH                            49500019
         OI    DCBEIB,WLRBIT       SET WRONG LNGTH REC BIT IN DCBEIB    49600019
         LTR   WORK3R,WORK3R       IS AN ERRCNT ADDRESS SPECIFIED       49700019
         BCR   8,RETR              NO,BRANCH                            49800019
         L     WORK4R,PERMWLR(WORK3R) LOAD PERMANENT WLR COUNT          49900019
         LA    WORK4R,ONE(WORK4R)    INCREMENT COUNT BY 1               50000019
         ST    WORK4R,PERMWLR(WORK3R)  STORE COUNT                      50100019
*                                                                       50200019
OCR250   BR    RETR                RETURN TO CALLING ROUTINE            50300019
 EJECT                                                                  50400019
*********************************************************************** 50500019
*                                                                       50600019
*        COMPLETION CODE ROUTINE                                        50700019
*                                                                       50800019
*********************************************************************** 50900019
OCR300   SR    ENTRYR,ENTRYR       CLEAR RETURN CODE REGISTER           51000019
         TM    DCBEIB,EIBERR       TEST FOR ERROR INDICATED IN THE EIB  51100019
         BZ    OCR310              IF NONE,BRANCH                       51200019
         LA    ENTRYR,FOURRC       SET A RETURN CODE OF FOUR            51300019
*                                                                       51400019
OCR310   TM    SENSE0(IOBADR),COMREJ TEST FOR COMMAND REJECT            51500019
         BNZ   OCR315                IF YES, BRANCH TO SET RETURN CODE  51600019
         TM    SENSE1(IOBADR),INVCOM TEST FOR INVALID COMMAND           51700019
         BZ    OCR320                IF NOT, BRANCH                     51800019
OCR315   LA    ENTRYR,EIGHTRC      SET  RETURN CODE OF EIGHT            51900019
*                                                                       52000019
OCR320   TM    SENSE0(IOBADR),SENS0ERR  TEST FOR ERRORS IN SENSE        52100019
         BNZ   OCR325              BRANCH IF ERRORS ARE FOUND           52200019
         TM    STATUS+1(IOBADR),STAT1ERR TEST FOR ERRORS IN STATUS      52300019
         BCR   8,RETR              NO,BRANCH                            52400019
OCR325   LA    ENTRYR,TWELVERC     SET RETURN CODE OF TWELVE            52500019
*                                                                       52600019
OCR330   BR    RETR                RETURN TO CALLING ROUTINE            52700019
 EJECT                                                                  52800019
*********************************************************************** 52900019
*                                                                       53000019
*        ERROR COUNTER ROUTINE                                          53100019
*                                                                       53200019
*********************************************************************** 53300019
*                                                                       53400019
OCR400   L     WORK4R,DCBERRCN     LOAD ADDRESS OF COUNTERS             53500019
         MVI   DCBEIB,ZERO         RESET EIB BYTE TO ZERO        A33940 53550001
         LTR   WORK4R,WORK4R       ARE COUNTERS SPECIFIED               53600019
         BCR   8,RETR              NO,BRANCH                            53700019
*                                                                       53800019
         SR    WORK3R,WORK3R       CLEAR COUNT REGISTER                 53900019
         IC    WORK3R,DCRETRY(IOBADR) LOAD DATA CHECK RETRY COUNT       54000019
         A     WORK3R,DCCOUNT(WORK4R) INCREMENT BY NUMBER OF RETRYS     54100019
         ST    WORK3R,DCCOUNT(WORK4R) STORE DATA CHECK RETRY COUNT      54200019
*                                                                       54300019
         SR    WORK3R,WORK3R       CLEAR COUNT REGISTER                 54400019
         IC    WORK3R,ECRETRY(IOBADR) LOAD EQUIP CHECK RETRY COUNT      54500019
         A     WORK3R,ECCOUNT(WORK4R) INCREMENT BY NUMBER OF RETRYS     54600019
         ST    WORK3R,ECCOUNT(WORK4R) STORE EQUIP CHECK RETRY COUNT     54700019
*                                                                       54800019
         SR    WORK3R,WORK3R       CLEAR COUNT REGISTER                 54900019
         IC    WORK3R,WLRETRY(IOBADR)  LOAD WLR RETRY COUNT             55000019
         A     WORK3R,WLRCOUNT(WORK4R)  INCREMENT BY NUMBER OF RETRYS   55100019
         ST    WORK3R,WLRCOUNT(WORK4R)  STORE WLR RETRY COUNT           55200019
         XC    DCRETRY(3,IOBADR),DCRETRY(IOBADR)  CLEAR IOB COUNTERS    55250019
*                                                                       55300019
         TM    SENSE0(IOBADR),KCORR DID KEYBOARD CORRECTION OCCUR       55400019
         BCR   8,RETR              NO,BRANCH                            55500019
         L     WORK3R,KCCOUNT(WORK4R) LOAD KC COUNT                     55600019
         LA    WORK3R,ONE(WORK3R)  INCREMENT BY ONE                     55700019
         ST    WORK3R,KCCOUNT(WORK4R) STORE UPDATED KC COUNT            55800019
*                                                                       55900019
OCR410   BR    RETR                RETURN TO CALLING ROUTINE            56000019
 EJECT                                                                  56100019
*********************************************************************** 56200019
*                                                                       56300019
*                                                                       56400019
         CNOP  0,8                 PAD TO DOUBLE WORD                   56500019
         DCBD  DSORG=PS,DEVD=OR                                @YM00635 56600002
         END                                                            56700019
./  ADD  SSI=40650107,NAME=IGG019VF
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00100002
**** END OF SPECIFICATIONS ***/                                         00150002
         TITLE 'IGG019VF - READ ROUTINE-(OCR)'                          00700019
IGG019VF CSECT                                                          01400019
***********************************************************    @YM00638 01450002
*MODULE-NAME                                                   @YM00638 01500002
* IGG019VF                                                     @YM00638 01550002
*                                                              @YM00638 01600002
*DESCRIPTIVE-NAME                                              @YM00638 01650002
* OCR READ ROUTINE                                             @YM00638 01750002
*                                                              @YM00638 01800002
*COPYRIGHT                                                     @YM00638 01850002
* NONE                                                         @YM00638 01900002
*                                                              @YM00638 01950002
*CHANGE-ACTIVITY                                               @YM00638 02000002
*                                                                       02100019
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                02800001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                03500001
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                04200001
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                04900001
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                05600001
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                06300001
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                07000001
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                07700001
*                                                                       08400019
*                                                                       09100019
* STATUS - CHANGE LEVEL 00  RELEASE 20                                  09800001
*                                                                       10500019
*                                                                       11200019
*FUNCTION-READ ROUTINE                                                  11900019
*                  1) SET CORRECT CCW,IOB,ECB ADDRESSES                 12600019
*                  2) LINK TO EOB TO SCHEDULE INPUT EVENT               13300019
*                                                                       14000019
*ENTRY POINT                                                            14700019
*        LABEL  OCR010                                                  15400019
*                                                                       16100019
*ENTRY INSTRUCTION SEQUENCE                                             16800019
*              LA   1,DECB                                              17500019
*              LA   14,DCB                                              18200019
*              L    15,48(14)                                           18900019
*              BALR 14,15                                               19600019
*                                                                       20300019
* INPUT FROM CALLING ROUTINE                                            21000019
*        REG   0    N/A                                                 21700019
*        REG   1    DECB ADDRESS                                        22400019
*        REG   2-12 N/A                                                 23100019
*        REG   13   SAVE AREA                                           23800019
*        REG   14   RETURN ADDRESS                                      24500019
*        REG   15   BASE ADDRESS                                        25200019
*                                                                       25900019
*OUTPUT TO CALLING ROUTINE                                              26600019
*        REG   0-1  N/A                                                 27300019
*        REG   2-12 SAME AS WHEN ENTERED                                28000019
*        REG   13   SAVE AREA                                           28700019
*        REG   14   RETURN ADDRESS                                      29400019
*        REG   15   ZERO                                                30100019
*                                                                       30800019
*EXTERNAL ROUTINES                                                      31500019
*        IGG019CC   EXTERNAL ROUTINE WHICH SCHEDULES INPUT REQUESTS     32200019
*                                                                       32900019
*EXITS -NORMAL                                                          33600019
*        OCR020     BRANCH AND LINK TO END OF BLOCK ROUTINE             34300019
*        OCR040     BRANCH TO CALLING ROUTINE FROM READ                 35000019
*                                                                       35700019
*TABLES/WORKAREA                                                        36400019
*                                                                       37100019
*        USER  SAVE/WORK AREA                                           37800019
*        DCB                                                            38500019
*        IOB                                                            39200019
*        DECB                                                           39900019
*         +0   ECB ADDRESS                                              40600019
*         +4   N/A                                                      41300019
*         +8   DCB ADDRESS                                              42000019
*         +12  CCW ADDRESS                                              42700019
*         +16  IOB ADDRESS                                              43400019
*                                                                       44100019
*ATTRIBUTES--REENTRANT,REUSABLE, PROBLEM PROGRAM MODE                   44800019
*                                                                       45500019
*                                                                       46200019
*                                                                       46900019
*********************************************************************** 47600019
*                                                                       48300019
*        ALL REGISTER EQUATES HAVE AN 'R' AT THE END OF THE SYMBOL      49000019
*                                                                       49700019
*********************************************************************** 50400019
PARA0R   EQU   0                   PARAMETER REGISTER 0                 51100019
DECBR    EQU   1                   DECB  ADDRESS                        51800019
DCBR     EQU   2                   DCB ADDRESS                          52500019
IOBADR   EQU   3                   IOB ADDRESS                          53200019
WORK1R   EQU   7                   WORK REGISTER                        53900019
BASER    EQU   8                   BASE REGISTER                        54600019
WORK2R   EQU   14                  WORK REGISTER                        55300019
SAVR     EQU   13                  USER SAVE AREA                       56000019
RETR     EQU   14                  RETURN ADDRESS                       56700019
ENTRYR   EQU   15                  ENTRY ADDRESS                        57400019
*********************************************************************** 58100019
EOFBIT   EQU   X'40'               EOF BIT SWITCH IN DCBORBYT           58800019
ERRFLGS  EQU   X'3F'               ERROR FLAGS IN DCBIFLGS-X'C0'        59500019
START    EQU   24                  CCW ADDRESS IN IOB                   60200019
CCWADR   EQU   12                  CCW ADDRESS IN DECB                  60900019
RDCNT    EQU   28                  OFFSET TO READ COUNT IN USER AREA    61600019
ADDRESS  EQU   4                   LENGTH OF AN ADDRESS IN DECB         62300019
USERREG  EQU   20                  SAVE AREA OFFSET FOR USER REGS       63000019
DCBOFF   EQU   8                   DCB OFFSET IN DECB                   63700019
IOSIOB   EQU   8                   OFFSET FROM ACCESS METHOD IOB        64400019
IOBOFF   EQU   16                  IOB OFFSET IN DECB                   65100019
ECBOFF   EQU   12                  ECB ADDRESS OFFSET IN IOB            65800019
ONE      EQU   1                   USED AS A CONSTANT OF ONE            66500019
 EJECT                                                                  67200019
         USING IGG019VF,BASER      USE REG 8 AS A BASE REGISTER         67900019
         USING IHADCB,DCBR         USE REG 2 AS A  DCB BASE             68600019
OCR010   STM   RETR,BASER,USERREG(SAVR) SAVE USER REGISTERS             69300019
         LR    BASER,ENTRYR        ESTABLISH BASE REGISTER              70000019
*                                                                       70700019
         L     DCBR,DCBOFF(DECBR)  GET DCB ADDRESS                      71400019
*                                                                       72100019
         TM    DCBORBYT,EOFBIT     TEST IF END OF FILE BIT IS ON        72800019
         BO    OCR034              IF ON, BRANCH TO RETURN TO USER      73500019
*                                                                       74200019
         L     IOBADR,DCBIOBA      GET IOB ADDRESS                      74900019
*                                                                       75600019
         LA    PARA0R,IOSIOB(IOBADR) GET IOS IOB POINTER                76300019
         ST    PARA0R,IOBOFF(DECBR) STORE IOB ADDRESS OF DECB           77000019
         ST    DECBR,ECBOFF(IOBADR) STORE ECB ADDRESS TO DECB           77700019
*                                                                       78400019
         NI    DCBIFLGS,ERRFLGS    INSURE ERROR FLGS ARE OFF            79100019
         MVC   START(ADDRESS,IOBADR),CCWADR(DECBR) MOVE C P TO IOB      79800019
         L     ENTRYR,DCBEOBR      LOAD ADDRESS OF EOB ROUTINE          80500019
*                                                                       81200019
OCR020   BALR  RETR,ENTRYR         BRANCH AND LINK TO EOB ROUTINE       81900019
*                                                                       82600019
         L     WORK1R,DCBERRCN     LOAD ADDRESS OF ERROR COUNT AREA     83300019
         LTR   WORK1R,WORK1R       ARE COUNTERS SPECIFIED               84000019
         BZ    OCR034              NO, BRANCH                           84700019
*                                                                       85400019
         L     WORK2R,RDCNT(WORK1R) LOAD READ COUNT                     86100019
         LA    WORK2R,ONE(WORK2R)  INCREMENT BY 1                       86800019
         ST    WORK2R,RDCNT(WORK1R)  STORE READ COUNT                   87500019
*                                                                       88200019
OCR034   LM    RETR,BASER,USERREG(SAVR) RESTORE USER REGISTERS          88900019
         SR    ENTRYR,ENTRYR       CLEAR RETURN CODE REGISTER           89600019
*                                                                       90300019
OCR040   BR    RETR                RETURN TO USER                       91000019
*                                                                       91700019
         CNOP  0,8                 BAD TO DOUBLE WORD BOUNDARY          92400019
         DCBD  DSORG=PS,DEVD=OR                                @YM00635 93100002
         END                                                            93800019
./  ADD  SSI=42240346,NAME=IGG019VG
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00060002
**** END OF SPECIFICATIONS ***/                                         00070002
         TITLE  'IGG019VG - CHECK ROUTINE -(OCR)'                       00100019
IGG019VG CSECT                                                          00200019
************************************************************   @YM00638 00250002
*MODULE-NAME                                                   @YM00638 00260002
* IGG019VG                                                     @YM00638 00270002
*                                                              @YM00638 00280002
*DESCRIPTIVE-NAME                                              @YM00638 00290002
* OCR CHECK MODULE                                             @YM00638 00292002
*                                                              @YM00638 00294002
*COPYRIGHT                                                     @YM00638 00296002
* NONE                                                         @YM00638 00298002
*                                                              @YM00638 00298402
*CHANGE-ACTIVITY                                               @YM00638 00298802
*                                                                       00300019
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                00390020
*C256000,269000                                                  A33922 00480020
*A523500                                                         A33940 00520001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                00570020
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                00660020
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                00750020
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                00840020
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                00930020
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                01020020
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                01110020
*                                                                       01200019
*                                                                       01300019
* STATUS - CHANGE LEVEL 01  RELEASE 20                                  01400001
*                                                                       01500019
*                                                                       01600019
*FUNCTION-CHECK ROUTINE-TO ACQUIRE NEXT SEQUENTIAL IOB AND WAIT FOR     01700019
*                       COMPLETION (TEST PREVIOUS EXCP STATUS)          01800019
*                       1) NORMAL COMPLETION RETURNS TO USER            01900019
*                       2) INCOMPLETE ISSUES WAIT                       02000019
*                       3) ABNORMAL CONDITION GOES TO USERS SYNAD ROUTN 02100019
*                       4) EOF CONDITION ISSUES EOV TO EXECUTOR         02200019
*        -EIB ROUTINE-                                                  02300019
*                       1) SET ERROR INDICATOR BYTE                     02400019
*        -COMPLETION CODE ROUTINE-                                      02500019
*                       1) SET COMPLETION CODE                          02600019
*        -COUNTER ROUTINE-                                              02700019
*                       1) UPDATE TEMPORARY ERROR COUNTERS              02800019
*ENTRY POINTS                                                           02900019
*        LABEL  OCR010                                                  03000019
*        LABEL  OCR020                                                  03100019
*        LABEL  OCR030                                                  03200019
*        LABEL  OCR035                                                  03300019
*                                                                       03400019
*ENTRY INSTRUCTION SEQUENCE                                             03500019
*                                                                       03600019
*             /CHECK/             /EIB/          /COMP CODE/            03700019
*        LA    1,DECB         LA   1,DECB         LA   1,DECB           03800019
*        L     15,DCBCHECK    L    15,DCBCHECK    L    15,DCBCHECK      03900019
*        BALR  14,15          BAL  14,8(15)       BAL  14,16(15)        04000019
*                                                                       04100019
*             /COUNTER/                                                 04200019
*        L     15,DCBCHECK                                              04300019
*        BAL   14,24(15)                                                04400019
*                                                                       04500019
*INPUT FROM CALLING ROUTINES -/CHECK/EIB/COMP CODE/COUNTER/ ROUTINES    04600019
*        REG   0    N/A                                                 04700019
*        REG   1    DECB ADDRESS(CHECK)  N/A (EIB/CC/CNTR)              04800019
*        REG   2-12 N/A(CHECK)                                          04900019
*        REG   2    DCB  ADDRESS(EIB/CC/CNTR)                           05000019
*        REG   3    IOB  ADDRESS(EIB/CC/CNTR)                           05100019
*        REG   8    WORK REG    (EIB/CC/CNTR)                           05200019
*        REG   13   WORK-SAVE ADDRESS                                   05300019
*        REG   14   CALLING ROUTINES IN-LINE RETURN ADDRESS             05400019
*        REG   15   BASE ADDRESS(ADDR OF CHECK RTN)                     05500019
*                                                                       05600019
*OUTPUT TO CALLING ROUTINES -/CHECK/EIB/COMP CODE/  ROUTINES            05700019
*        REG   0-1  N/A                                                 05800019
*        REG   2-7  SAME AS ENTRY                                       05900019
*        REG   8    N/A FOR SUBROUTINES,SAME AS ENTRY FOR CHECK         06000019
*        REG   9-12 SAME AS ENTRY                                       06100019
*        REG   13   WORK-SAVE ADDRESS                                   06200019
*        REG   14   ADDRESS OF IN-LINE RETURN                           06300019
*        REG   15   RETURN CODE                                         06400019
*                                                                       06500019
*SYNAD REGISTERS - ENTRY FROM CHECK TO SYNAD                            06600019
*        REG   0    DECB ADDRESS                                        06700019
*        REG   1    DCB ADDRESS                                         06800019
*        REG   2-12 USER SPECIFIED                                      06900019
*        REG   13   WORK-SAVE ADDRESS                                   07000019
*        REG   14   RETURN ADDRESS                                      07100019
*        REG   15   ENTRY ADDRESS                                       07200019
*        ----------EXIT FROM SYNAD TO CHECK                             07300019
*        REG   0-1  N/A                                                 07400019
*        REG   2-12 USER SPECIFIED                                      07500019
*        REG   13   WORK-SAVE ADDRESS                                   07600019
*        REG   14   RETURN ADDRESS                                      07700019
*        REG   15   ZERO OR ADDRESS OF USER SPECIFIED BRANCH ADDRESS    07800019
*                                                                       07900019
*EXTERNAL ROUTINES                                                      08000019
*        IGG019VH   CNTRL                                               08100019
*        IGG019VJ   DSPLY                                               08200019
*        IGG019VK   RESCN                                               08300019
*        EOV        END OF VOLUME ROUTINE                               08400019
*                                                                       08500019
*                                                                       08600019
*EXITS-NORMAL                                                           08700019
*        OCR090     BRANCH TO CALLING ROUTINE FROM CHECK                08800019
*        OCR145     BRANCH AND LINK TO SYNAD                            08900019
*        OCR147     BRANCH TO USER SPECIFIED RETURN ADDRESS             09000019
*        OCR260     BRANCH TO CALLING ROUTINE FROM EIB ROUTINE          09100019
*        OCR330     BRANCH TO CALLING ROUTINE FROM COMP CODE ROUTINE    09200019
*        OCR410     BRANCH TO CALLING ROUTINE FROM COUNTER ROUTINE      09300019
*        OCR115     EOV EXIT                                            09400019
*    -ABNORMAL                                                          09500019
*        ABEND      COMPLETION CODE= 001 -NO SYNAD ROUTINE SPECIFIED    09600019
*                                                                       09700019
*TABLES/WORKAREAS                                                       09800019
*                                                                       09900019
*        USER SAVE/WORK AREA                                            10000019
*        DCB                                                            10100019
*        IOB                                                            10200019
*        DECB                                                           10300019
*ATTRIBUTES--REENTRANT,REUSABLE,PROBLEM PROGRAM MODE                    10400019
*                                                                       10500019
*                                                                       10600019
*                                                                       10700019
*                                                                       10800019
*                                                                       10900019
*                                                                       11000019
*                                                                       11100019
*********************************************************************** 11200019
*                                                                       11300019
*        ALL REGISTER EQUATES HAVE AN 'R' AT THE END OF THE SYMBOL      11400019
*                                                                       11500019
*********************************************************************** 11600019
PARA0R   EQU   0                   PARAMETER REGISTER 0                 11700019
PARA1R   EQU   1                   PARAMETER REGISTER 1                 11800019
WORK4R   EQU   1                   WORK REGISTER                        11900019
R1       EQU   1                   USED IN DOM MACRO                    12000019
DCBR     EQU   2                   DCB ADDRESS                          12100019
IOBADR   EQU   3                   IOB ADDRESS                          12200019
WORK1R   EQU   7                   WORK REGISTER                        12300019
BASER    EQU   8                   BASE REGISTER                        12400019
SAVR     EQU   13                  USER SAVE AREA                       12500019
RETR     EQU   14                  RETURN ADDRESS                       12600019
WORK2R   EQU   14                  WORK REGISTER                        12700019
ENTRYR   EQU   15                  ENTRY ADDRESS                        12800019
WORK3R   EQU   15                  WORK REGISTER                        12900019
*                                                                       13000019
*                                                                       13100019
*********************************************************************** 13200019
*********************************************************************** 13300019
*                                                                       13400019
*        ERROR INDICATOR BYTE                                           13500019
*                                                                       13600019
*********************************************************************** 13700019
NRBIT    EQU   X'10'               NON RECOVERY                         13800019
RMBIT    EQU   X'40'               EQUIPMENT CHECK-REGISTRATION MARK    13900019
ECBIT    EQU   X'08'               EQUIPMENT CHECK                      14000019
DCBIT    EQU   X'01'               DATA CHECK                           14100019
KCHEBIT  EQU   X'02'               HOPPER EMPTY                         14200019
WLRBIT   EQU   X'04'               WRONG LENGTH RECORD                  14300019
LSSEPBIT EQU   X'20'               LATE STKR SELECT OR END OF PAGE      14400019
EIBERR   EQU   X'FF'               ANY ERROR IN DCBEIB                  14500019
*                                                                       14600019
*********************************************************************** 14700019
*                                                                       14800019
*        STATUS OR SENSE                                                14900019
*                                                                       15000019
*********************************************************************** 15100019
NONREC   EQU   X'02'               NON RECOVERY ERROR                   15200019
EQUCHK   EQU   X'10'               EQUIPMENT CHECK ERROR                15300019
DATACHK  EQU   X'08'               DATA CHECK ERROR                     15400019
WLR      EQU   X'40'               WRONG LENGTH RECORD ERROR            15500019
LSSOREOP EQU   X'40'               LSS OR EOP IN SENSE                  15600019
INVCOM   EQU   X'08'               INVALID COMMAND                      15700019
SENS0ERR EQU   X'24'               SENSE ERRORS                         15800019
STAT1ERR EQU   X'3F'               STATUS ERRORS                        15900019
COMREJ   EQU   X'80'               COMMAND REJECT                       16000019
UNEXCEP  EQU   X'01'               UNIT EXCEPTION IN STATUS IN CSW(IOB) 16100019
STATUSMD EQU   X'40'               STATUS MODIFIER STATUS BIT           16200019
HPREMPTY EQU   X'20'               HOPPER EMPTY SENE BIT                16300019
*********************************************************************** 16400019
*                                                                       16500019
*        COUNTER EQUATES                                                16600019
*                                                                       16700019
*********************************************************************** 16800019
ECCOUNT  EQU   0                   EQUIP CHECK RETRY COUNT IN USER AREA 16900019
DCRETRY  EQU   36                  DATA CHECK RETRY COUNT IN IOB        17000019
WLRCOUNT EQU   8                   WRNG LNGTH COUNT IN USER AREA        17100019
WLRETRY  EQU   37                  WRNG LNGTH COUNT IN IOB              17200019
DCCOUNT  EQU   20                  DATA CHECK RETRY COUNT IN USER AREA  17300019
ECRETRY  EQU   38                  EQUIP CHECK RETRY COUNT IN IOB       17400019
PERMEC   EQU   4                   PERMANENT EQUIPMENT CHECK COUNTER    17500019
PERMWLR  EQU   12                  PERMANENT WRONG LENGTH REC COUNTER   17600019
*********************************************************************** 17700019
*                                                                       17800019
*        DCB EQUATES                                                    17900019
*                                                                       18000019
*********************************************************************** 18100019
HEOPT    EQU   X'10'               HOPPER EMPTY EXIT SPEC IN DCBOPTCD   18200019
EOFBIT   EQU   X'40'               EOF BIT SWITCH IN DCBORBYT           18300019
SYNADOFF EQU   X'7F'               TURN SYNAD IN PROGRESS BIT OFF       18400019
ERRFLGS  EQU   X'3F'               ERROR FLAGS IN DCBIFLGS-X'C0'        18500019
SYNADBIT EQU   X'80'               SYNAD-IN-PROCESS BIT IN DCBORBYT     18600019
*********************************************************************** 18700019
*                                                                       18800019
*        IOB EQUATES                                                    18900019
*                                                                       19000019
*********************************************************************** 19100019
IOSIOB   EQU   8                   OFFSET FROM ACCESS METHOD IOB        19200019
SENSE0   EQU   10                  SENSE BYTE 0 IN IOB                  19300019
SENSE1   EQU   11                  SENSE BYTE 1 IN IOB                  19400019
ECBPTR   EQU   12                  ECB POINTER IN THE IOB               19500019
ECBPT    EQU   12                  ADDRESS OF ECB IN IOB                19600019
INTCCW   EQU   16                  INTERRUPTED CCW IN CSW IN IOB        19700019
STATUS   EQU   20                  STATUS IN CSW IN IOB                 19800019
RESIDUAL EQU   22                  OFFSET TO THE RESIDUAL COUNT IN CSW  19900019
START    EQU   24                  OFFSET OF CHANNEL PROGRAM ADDR (IOB) 20000019
TEMCCW   EQU   40                  OFFSET TO CCW WORK AREA              20100019
FLAGS    EQU   4                   CCW FLAGS                            20200019
CNT      EQU   6                   COUNT FIELD OFFSET IN CCW            20300019
CHAINBIT EQU   X'40'               CCW CHAINING BIT                     20400019
TESTCOM  EQU   X'10'               TEST COMMAND TEST                    20500019
COMASK   EQU   X'0F'               MASK TO TEST FOR RB OR RF            20600019
RFCOM    EQU   X'02'               TEST FOR READ FORWARD COMMAND        20700019
RBCOM    EQU   X'0C'               TEST FOR READ BACKWARD COMMAND       20800019
TICCOM   EQU   X'08'               TIC COMMAND                          20900019
LF       EQU   X'53'               LOAD FORMAT COMMAND                  21000019
CCWL     EQU   8                   LENGTH OF ONE CCW                    21100019
*********************************************************************** 21200019
*                                                                       21300019
*        DECB EQUATES                                                   21400019
*                                                                       21500019
*********************************************************************** 21600019
DCBOFF   EQU   8                   DCB OFFSET IN DECB                   21700019
IOBOFF   EQU   16                  IOB OFFSET IN DECB                   21800019
COMPLETE EQU   X'40'               TEST IF ECB POSTED COMPLETE          21900019
PERROR   EQU   X'41'               TEST IF ECB POSTED WITH PERM ERROR   22000019
PERROR44 EQU   X'44'               TEST IF PERM ERROR          @ZA00774 22050003
*********************************************************************** 22100019
CTRLINFO EQU   3                   OFFSET TO BYTE3 OF 4 BYTE CONTRL INF 22200019
ADDRESS  EQU   3                   LENGTH OF AN ADDRESS                 22300019
TWO      EQU   2                   USED AS A CONSTANT OF 2              22400019
RETREG   EQU   20                  OFFSET IN SAVE AREA FOR RETURN REG   22500019
SAVREG   EQU   20                  OFFSET IN SAVE AREA FOR USER REGS    22600019
BASESAV  EQU   24                  OFFSET IN SAVE AREA FOR BASE REG     22700019
TEMPSAV  EQU   28                  OFFSET IN SAVE AREA FOR TEMP STORAGE 22800019
USERREG  EQU   36                  OFFSET IN SAVE AREA FOR USER REGS    22900019
CSWSAV   EQU   64                  OFFSET IN SAVE AREA FOR CSW          23000019
INPREAD  EQU   X'90'               HI ORDER BYTE OF REG 1 FOR SYNAD ENT 23100019
RDNDATA  EQU   X'80'               INDICATES READ DATA                  23200019
ONE      EQU   1                   USED AS A CONSTANT OF 1              23300019
SYSCC    EQU   12                  USED AS A SHIFT TO SET A SYSTEM C C  23400019
HIBYTE   EQU   24                  USED TO SHIFT TO HI ORDER BYTE       23500019
ZERO     EQU   0                   USED AS A CONSTANT OF ZERO           23600019
REGMARK  EQU   X'04'               BYTE 3 OF CONTROL INFORMATION        23700019
FOURRC   EQU   4                   RETURN CODE OF FOUR                  23800019
EIGHTRC  EQU   8                   RETURN CODE OF EIGHT                 23900019
TWELVERC EQU   12                  RETURN CODE OF TWELVE                24000019
NOP      EQU   X'03'               NO-OP COMMAND                        24100019
*                                                                       24200019
*                                                                       24300019
*                                                                       24400019
*********************************************************************** 24500019
*********************************************************************** 24600019
 EJECT                                                                  24700019
         USING IGG019VG,ENTRYR     USE REG 15 AS A TEMPORARY BASE       24800019
         USING IHADCB,DCBR         USE REG 2  AS DCB BASE               24900019
*                                                                       25000019
*********************************************************************** 25100019
*                                                                       25200019
*        ENTRYS                                                         25300019
*                                                                       25400019
*********************************************************************** 25500019
OCR010   STM   RETR,BASER,SAVREG(SAVR) SAVE USER REGISTERS 14-8  A33922 25600020
         B     OCR040              BRANCH TO CHECK  ROUTINE             25700019
OCR020   LR    BASER,ENTRYR        ENTRY POINT + 8 - LOAD NEW BASE REG  25900019
         B     OCR200              BRANCH TO EIB ROUTINE                26000019
EIGHT    DC    H'8'                FILLER - USED AS CONSTANT OF 8       26100019
OCR030   LR    BASER,ENTRYR        ENTRY POINT + 16 - LOAD NEW BASE REG 26200019
         B     OCR300              BRANCH TO COMPLETION CODE ROUTINE    26300019
         DC    H'0'                FILLER                               26400019
OCR035   LR    BASER,ENTRYR        ENTRY +24- LOAD NEW BASE REGISTER    26500019
         B     OCR400              BRANCH TO ERROR COUNTER ROUTINE      26600019
*                                                                       26700019
*********************************************************************** 26800019
OCR040   LR    BASER,ENTRYR        ENTRY POINT + 0 -NEW BASE REG A33922 26900020
         DROP  ENTRYR              DROP TEMPORARY BASE                  27000019
         USING IGG019VG,BASER      USE NEW BASE REG                     27100019
         L     DCBR,DCBOFF(PARA1R) LOAD DCB ADDRESS FROM DECB           27200019
         L     IOBADR,IOBOFF(PARA1R) LOAD IOB ADDRESS FROM DECB         27300019
         SH    IOBADR,EIGHT        POINT TO SAM IOB ADDRESS             27400019
         MVI   DCBEIB+1,ZERO       CLEAR RETURN CODE SAVE AREA          27500019
*                                                                       27600019
OCR055   TM    0(PARA1R),COMPLETE  IS SCHEDULED EVENT COMPLETE          27700019
         BO    OCR060              IF YES, BRANCH                       27800019
*                                                                       27900019
         WAIT  ECB=(PARA1R)        WAIT FOR EVENT TO COMPLETE           28000019
*                                                                       28100019
OCR060   L     PARA1R,DCBWTOID     LOAD WTO MESSAGE ID                  28200019
         LTR   PARA1R,PARA1R       IS ID EQUAL TO ZERO                  28300019
         BZ    OCR070              IF YES, BRANCH                       28400019
*                                                                       28500019
         DOM   MSG=(R1)            DELETE OPERATOR MESSAGE              28600019
*                                                                       28700019
         XC    DCBWTOID+1(ADDRESS),DCBWTOID+1 CLEAR WTO ID              28800019
*                                                                       28900019
OCR070   BAL   RETR,OCR400         BRANCH AND LINK TO COUNTER ROUTINE   29000019
*                                                                       29100019
OCR080   TM    DCBORBYT,EOFBIT     TEST FOR END OF FILE CONDITION       29200019
         BZ    OCR082              IF NOT, BRANCH AND CHECK FOR ERRORS  29300019
*                                                                       29400019
         XC    STATUS(TWO,IOBADR),STATUS(IOBADR) CLEAR STATUS           29500019
         OI    STATUS(IOBADR),UNEXCEP SET UNIT EXCEPTION BIT            29600019
         B     OCR112              BRANCH TO GO TO END OF VOLUME ROUTIN 29700019
*                                                                       29800019
OCR082   L     WORK1R,ECBPTR(IOBADR)   LOAD ECB ADDRESS                 29900019
         CLI   0(WORK1R),PERROR    DID A PERMANENT ERROR OCCUR          30000019
         BE    OCR100              YES, BRANCH                          30100019
         CLI   0(WORK1R),PERROR44 DID PERM ERROR OCCUR         @ZA00774 30150003
         BE    OCR100              YES,BRANCH                  @ZA00774 30160003
*                                                                       30200019
OCR085   L     RETR,RETREG(SAVR)   LOAD RETURN ADDRESS                  30300019
         SR    ENTRYR,ENTRYR       CLEAR RETURN CODE REGISTER           30400019
         IC    ENTRYR,DCBEIB+1     LOAD RETURN CODE                     30500019
         LM    DCBR,BASER,USERREG(SAVR) RESTORE USER REGISTERS          30600019
*                                                                       30700019
OCR090   BR    RETR                RETURN TO USER                       30800019
 EJECT                                                                  30900019
*********************************************************************** 31000019
*                                                                       31100019
*        THIS CODE EXECUTED IF THERE ARE ANY ERRORS                     31200019
*                                                                       31300019
*********************************************************************** 31400019
OCR100   BAL   RETR,OCR200         BRANCH AND LINK TO EIB ROUTINE       31500019
*                                                                       31600019
         BAL   RETR,OCR300         BRANCH AND LINK TO RETRN CODE ROUTN  31700019
*                                                                       31800019
         STC   ENTRYR,DCBEIB+1     STORE THE RETURN CODE                31900019
*                                                                       32000019
         TM    STATUS(IOBADR),UNEXCEP TEST FOR UNIT EXCEPTION CONDITION 32100019
         BZ    OCR130              IF NO U.E , BRANCH                   32200019
*                                                                       32300019
OCR112   NI    DCBIFLGS,ERRFLGS    RESET ERROR FLGS IN DCB              32400019
         MVI   DCBORBYT,ZERO       CLEAR DCBORBYT                       32500019
OCR113   LR    PARA0R,IOBADR       LOAD IOB ADDRESS TO REG 0            32600019
*                                                                       32700019
*********************************************************************** 32800019
*                                                                       32900019
*        END OF VOLUME EXIT                                             33000019
*                                                                       33100019
*********************************************************************** 33200019
OCR115   EOV   0(DCBR)             SVC 55 TO EOV ROUTINE                33300019
*********************************************************************** 33400019
*                                                                       33500019
OCR120   LA    PARA0R,ONE          LOAD 1 TO REG 0                      33600019
         SLL   PARA0R,SYSCC        SHIFT LEFT 12 TO SET FOR COMP CODE   33700019
         B     OCR115              BRANCH TO GO TO THE EOV ROUTINE      33800019
*                                                                       33900019
OCR130   MVC   CSWSAV(ONE,SAVR),STATUS(IOBADR) SAVE STATUS MODIFIER     34000019
         MVC   CSWSAV+1(ADDRESS,SAVR),INTCCW+1(IOBADR) SAVE CCW ADDR    34100019
         NI    CSWSAV(SAVR),STATUSMD CLEAR ALL EXCEPT STATUS MODIFIER   34200019
         NI    DCBIFLGS,ERRFLGS    TURN OFF DCB ERRFLGS                 34300019
*                                                                       34400019
         TM    SENSE1(IOBADR),HPREMPTY IS HOPPER EMPTY SENSE PRESENT    34500019
         BZ    OCR140              NO, BRANCH                           34600019
*                                                                       34700019
         MVI   CSWSAV(SAVR),HPREMPTY SAVE HOPPER EMPTY INDICATION       34800019
         TM    DCBOPTCD,HEOPT      SHOULD HOPPER EMPTY EXIT BE TAKEN    34900019
         BZ    OCR150              NO, BRANCH                           35000019
*                                                                       35100019
OCR140   CLI   DCBSYNAD+3,ONE      IS SYNAD ROUTINE SPECIFIED           35200019
         BE    OCR120              BRANCH TO GO TO THE EOV ROUTINE      35300019
 EJECT                                                                  35400019
*********************************************************************** 35500019
*                                                                       35600019
*        GO TO THE USERS SYNAD ROUTINE                                  35700019
*                                                                       35800019
*********************************************************************** 35900019
         STM   DCBR,IOBADR,TEMPSAV(SAVR) SAVE DCB AND IOB ADDRESSES     36000019
         L     PARA0R,ECBPT(IOBADR) LOAD DECB ADDRESS                   36100019
         LA    PARA1R,INPREAD      LOAD INPUT AND DATA BITS             36200019
         L     WORK3R,INTCCW(IOBADR) LOAD ADDRESS OF INT CCW            36300019
         LA    WORK3R,0(WORK3R)    CLEAR HI ORDER BYTE                  36400019
         SH    WORK3R,EIGHT        BACK UP ONE CCW                      36500019
         MVC   TEMCCW(ONE,IOBADR),0(WORK3R) MOVE COMMAND TO WORK AREA   36600019
         NI    TEMCCW(IOBADR),COMASK CLEAR TO TEST FOR READ COMMANDS    36700019
         CLI   TEMCCW(IOBADR),RBCOM TEST FOR READ BACKWARD COMMAND      36800019
         BE    OCR142              BRANCH IF READ BACKWARD              36900019
         CLI   TEMCCW(IOBADR),RFCOM TEST FOR A READ FORWARD COMMAND     37000019
         BNE   OCR143              BRANCH IF NOT A READ FORWARD         37100019
OCR142   CLC   RESIDUAL(TWO,IOBADR),CNT(WORK3R) COMP RESIDUAL TO ORIGNL 37200019
         BL    OCR144              BRANCH IF DATA READ                  37300019
OCR143   LA    PARA1R,RDNDATA      SET TO NO DATA READ                  37400019
OCR144   SLL   PARA1R,HIBYTE       SHIFT TO HIGH ORDER BYTE             37500019
         OR    PARA1R,DCBR         OR DCB ADDRESS TO REG 1              37600019
*                                                                       37700019
         OI    DCBORBYT,SYNADBIT   SET SYNAD IN PROCESS BIT ON          37800019
         L     ENTRYR,DCBSYNAD     LOAD  SYNAD ROUTINE ADDRESS          37900019
*                                                                       38000019
*                                                                       38100019
         LM    DCBR,BASER,USERREG(SAVR) RESTORE USER REGISTERS          38200019
OCR145   BALR  RETR,ENTRYR         BRANCH AND LINK TO SYNAD ROUTINE     38300019
*                                                                       38400019
         STM   DCBR,BASER,USERREG(SAVR) SAVE USER REGISTERS             38500019
         L     BASER,BASESAV(SAVR) RESTORE BASE REGISTER                38600019
         LM    DCBR,IOBADR,TEMPSAV(SAVR) RESTORE DCB AND IOB REGS       38700019
         NI    DCBORBYT,SYNADOFF   TURN SYNAD IN PROCESS BIT OFF        38800019
         NI    DCBIFLGS,ERRFLGS    TURN ERROR FLAGS OFF                 38900019
         LTR   ENTRYR,ENTRYR       TEST REG 15 FOR ZEROS                39000019
         BZ    OCR150              BRANCH TO RESTART IF ZERO            39100019
         NI    DCBORBYT,ZERO       RESET DCBORBYT SWITCHES              39200019
         LM    DCBR,BASER,USERREG(SAVR) RESTORE USER REGISTERS          39300019
OCR147   BR    ENTRYR              BRANCH TO ADDRESS IN REGISTER 15     39400019
 EJECT                                                                  39500019
*********************************************************************** 39600019
*                                                                       39700019
*        RESTART PROCEDURE                                              39800019
*                                                                       39900019
*********************************************************************** 40000019
OCR150   L     WORK1R,CSWSAV(SAVR) LOAD SAVED INTCCW ADDRESS            40100019
         LA    WORK1R,0(WORK1R)    CLEAR HIGH ORDER BYTE                40200019
         SH    WORK1R,EIGHT        BACK UP 1 CCW                        40300019
*                                                                       40400019
         LR    WORK2R,WORK1R       LOAD CHANNEL PROGRAM RESTART ADDR    40500019
         TM    CSWSAV(SAVR),HPREMPTY CHECK IF HOPPER EMPTY OCCURED      40600019
         BZ    OCR165              BRANCH IF NOT HOPPER EMPTY           40700019
         CLI   0(WORK2R),NOP       DID HOPPER EMPTY OCCUR ON NOP        40800019
         BNE   OCR170              BRANCH TO RESTART THE INT COMMAND    40900019
*                                                                       41000019
OCR165   TM    FLAGS(WORK1R),CHAINBIT IS CCW CHAINING BIT ON            41100019
         BZ    OCR085              NO, BRANCH                           41200019
         LA    WORK2R,CCWL(WORK1R) INCREMENT TO NEXT CCW                41300019
         TM    0(WORK1R),TESTCOM   WAS INT CCW A TEST COMMAND           41400019
         BZ    OCR160              NO, BRANCH                           41500019
*                                                                       41600019
         TM    CSWSAV(SAVR),STATUSMD   WAS STATUS MODIFIER ON           41700019
         BZ    OCR160              NO, BRANCH                           41800019
*                                                                       41900019
         LA    WORK2R,CCWL(WORK2R) INCREMENT TO NEXT CCW                42000019
*                                                                       42100019
OCR160   CLI   0(WORK2R),TICCOM    IS COMMAND A TIC                     42200019
         BNE   OCR170              NO, BRANCH                           42300019
*                                                                       42400019
         L     WORK2R,0(WORK2R)    GET NEW CCW ADDRESS FROM TIC         42500019
         LA    WORK2R,0(WORK2R)    CLEAR HIGH ORDER BYTE                42600019
         B     OCR160              BRANCH TO CHECK IF TIC COMM          42700019
*                                                                       42800019
OCR170   ST    WORK2R,START(IOBADR) STORE ADDRESS OF CHANNEL PROG(IOB)  42900019
         LA    PARA1R,IOSIOB(IOBADR) POINT TO IOS IOB                   43000019
*                                                                       43100019
         EXCP  (PARA1R)            RESTART CHANNEL PROGRAM              43200019
         L     PARA1R,ECBPT(IOBADR) LOAD ADDRESS OF ECB                 43300019
         LA    PARA1R,0(PARA1R)    CLEAR HI ORDER BYTE                  43400019
         B     OCR055              BRANCH TO TEST COMPLETION            43500019
 EJECT                                                                  43600019
*********************************************************************** 43700019
*                                                                       43800019
*        ERROR  INDICATOR BYTE (EIB) ROUTINE                            43900019
*                                                                       44000019
*********************************************************************** 44100019
OCR200   MVI   DCBEIB,ZERO         CLEAR EIB                            44200019
         L     WORK3R,DCBERRCN     LOAD FROM DCBERRCN POSSIBLE AREA ADR 44300019
*                                                                       44400019
         TM    SENSE0(IOBADR),NONREC DID NON-RECOVERY ERROR OCCUR       44500019
         BZ    OCR210              NO, BRANCH                           44600019
         OI    DCBEIB,NRBIT        SET NON-RECOVERY BIT                 44700019
*                                                                       44800019
OCR210   TM    SENSE0(IOBADR),EQUCHK DID AN EQ CHK ERROR OCCUR          44900019
         BZ    OCR220              NO,BRANCH                            45000019
         LTR   WORK3R,WORK3R       IS ERRCNT ADDRESS SPECIFIED          45100019
         BZ    OCR215              NO, BRANCH                           45200019
         L     WORK4R,PERMEC(WORK3R) LOAD PERMANENT EQUIP CHK COUNT     45300019
         LA    WORK4R,ONE(WORK4R)    INCREMENT COUNT BY 1               45400019
         ST    WORK4R,PERMEC(WORK3R) STORE COUNT                        45500019
*                                                                       45600019
OCR215   L     WORK4R,INTCCW(IOBADR) GET INTERRUPTED CCW ADR FROM CSW   45700019
         LA    WORK4R,0(WORK4R)    CLEAR HI ORDER BYTE                  45800019
         SH    WORK4R,EIGHT        BACK UP ONE CCW                      45900019
         CLI   0(WORK4R),LF        IS COMMAND A LOAD FORMAT             46000019
         BNE   OCR217              NO, BRANCH                           46100019
         L     WORK4R,0(WORK4R)    LOAD THE DATA ADDRESS FROM LF CCW    46200019
         LA    WORK4R,0(WORK4R)    CLEAR HI ORDER BYTE                  46300019
         TM    CTRLINFO(WORK4R),REGMARK IS IT A LF FOR A REG MARD       46400019
         BZ    OCR217              NO,BRANCH                            46500019
         OI    DCBEIB,RMBIT        SET EQUIPMENT CHECK ON REG MARK BIT  46600019
         B     OCR220              IN DCBEIB                            46700019
OCR217   OI    DCBEIB,ECBIT        SET EQUIPMENT CHECK BIT IN DCBEIB    46800019
*                                                                       46900019
OCR220   TM    SENSE0(IOBADR),DATACHK  DID A DATA CHECK ERROR OCCUR     47000019
         BZ    OCR230              NO, BRANCH                           47100019
         OI    DCBEIB,DCBIT        SET DATA CHECK BIT IN DCBEIB         47200019
*                                                                       47300019
OCR230   TM    SENSE1(IOBADR),HPREMPTY DID HOPPER EMPTY OCCUR           47400019
         BZ    OCR240              NO,BRANCH                            47500019
         OI    DCBEIB,KCHEBIT      SET HOPPER EMPTY BIT IN DCBEIB       47600019
*                                                                       47700019
OCR240   TM    STATUS+1(IOBADR),WLR  DID WRONG LNGTH RECORD OCCUR       47800019
         BZ    OCR250              NO,BRANCH                            47900019
         OI    DCBEIB,WLRBIT       SET WRONG LENGTH REC BIT IN DCBEIB   48000019
         LTR   WORK3R,WORK3R       IS ERRCNT ADDRESS SPECIFIED          48100019
         BZ    OCR250              NO, BRANCH                           48200019
         L     WORK4R,PERMWLR(WORK3R)  LOAD PERMANENT WLR  COUNT        48300019
         LA    WORK4R,ONE(WORK4R)  INCREMENT COUNT BY 1                 48400019
         ST    WORK4R,PERMWLR(WORK3R) STORE COUNT                       48500019
*                                                                       48600019
OCR250   TM    SENSE1(IOBADR),LSSOREOP  DID LATE STKR SEL OR EOP OCCUR  48700019
         BCR   8,RETR              NO,BRANCH                            48800019
         OI    DCBEIB,LSSEPBIT     SET LSS OR EOP BIT IN DCBEIB         48900019
*                                                                       49000019
OCR260   BR    RETR                RETURN TO CALLING ROUTINE            49100019
 EJECT                                                                  49200019
*********************************************************************** 49300019
*                                                                       49400019
*        COMPLETION CODE ROUTINE                                        49500019
*                                                                       49600019
*********************************************************************** 49700019
OCR300   SR    ENTRYR,ENTRYR       CLEAR RETURN CODE REGISTER           49800019
         TM    DCBEIB,EIBERR       TEST FOR ERROR INDICATED IN THE EIB  49900019
         BZ    OCR310              IF NONE , BRANCH                     50000019
         LA    ENTRYR,FOURRC       SET RETURN CODE OF FOUR              50100019
*                                                                       50200019
OCR310   TM    SENSE0(IOBADR),COMREJ TEST FOR COMMAND REJECT            50300019
         BO    OCR315              IF YES, BRANCH TO SET RETURN CODE    50400019
         TM    SENSE1(IOBADR),INVCOM TEST FOR INVALID COMMAND           50500019
         BZ    OCR320              IF NOT, BRANCH                       50600019
OCR315   LA    ENTRYR,EIGHTRC      SET RETURN CODE OF EIGHT             50700019
*                                                                       50800019
OCR320   TM    SENSE0(IOBADR),SENS0ERR  TEST FOR ERRORS IN SENSE        50900019
         BNZ   OCR325              BRANCH IF NO ERRORS ARE FOUND        51000019
         TM    STATUS+1(IOBADR),STAT1ERR TEST FOR ERRORS IN  STATUS     51100019
         BCR   8,RETR              NO,BRANCH                            51200019
OCR325   LA    ENTRYR,TWELVERC     SET RETURN CODE OF TWELVE            51300019
*                                                                       51400019
OCR330   BR    RETR                RETURN TO CALLING ROUTINE            51500019
 EJECT                                                                  51600019
*********************************************************************** 51700019
*                                                                       51800019
*        ERROR COUNTER ROUTINE                                          51900019
*                                                                       52000019
*********************************************************************** 52100019
*                                                                       52200019
OCR400   L     WORK4R,DCBERRCN     LOAD ADDRESS OF COUNTERS             52300019
         MVI   DCBEIB,ZERO         RESET EIB BYTE TO ZERO        A33940 52350001
         LTR   WORK4R,WORK4R       ARE COUNTERS SPECIFIED               52400019
         BCR   8,RETR              NO,BRANCH                            52500019
*                                                                       52600019
         SR    WORK3R,WORK3R       CLEAR COUNT REGISTER                 52700019
         IC    WORK3R,DCRETRY(IOBADR) LOAD DATA CHECK RETRY COUNT       52800019
         A     WORK3R,DCCOUNT(WORK4R) INCREMENT BY NUMBER OF RETRYS     52900019
         ST    WORK3R,DCCOUNT(WORK4R) STORE DATA CHECK RETRY COUNT      53000019
*                                                                       53100019
         SR    WORK3R,WORK3R       CLEAR COUNT REGISTER                 53200019
         IC    WORK3R,ECRETRY(IOBADR) LOAD EQUIP CHECK RETRY COUNT      53300019
         A     WORK3R,ECCOUNT(WORK4R) INCREMENT BY NUMBER OF RETRYS     53400019
         ST    WORK3R,ECCOUNT(WORK4R) STORE EQUIP CHECK RETRY COUNT     53500019
*                                                                       53600019
         SR    WORK3R,WORK3R       CLEAR COUNT REGISTER                 53700019
         IC    WORK3R,WLRETRY(IOBADR)  LOAD WLR RETRY COUNT             53800019
         A     WORK3R,WLRCOUNT(WORK4R)  INCREMENT BY NUMBER OF RETRYS   53900019
         ST    WORK3R,WLRCOUNT(WORK4R)  STORE WLR RETRY COUNT           54000019
         XC    DCRETRY(3,IOBADR),DCRETRY(IOBADR)  CLEAR IOB COUNTERS    54050019
*                                                                       54100019
OCR410   BR    RETR                RETURN TO CALLING ROUTINE            54200019
 EJECT                                                                  54300019
*********************************************************************** 54400019
*                                                                       54500019
*                                                                       54600019
         CNOP  0,8                 PAD TO DOUBLE WORD                   54700019
         DCBD  DSORG=PS,DEVD=OR                                @YM00635 54800002
         END                                                            54900019
./  ADD  SSI=40660002,NAME=IGG019VH
* /* START OF SPECIFICATIONS ****                                       00000102
*01* PROCESSOR = ASSEMXF-370R                                           00000202
**** END OF SPECIFICATIONS ***/                                         00000802
IGG019VH CSECT                    ENTRY POINT FOR CNTRL MODULE          00006002
*********************************************************************** 00006602
*MODULE-NAME                                                   @YM00638 00007002
* IGG019VH                                                     @YM00638 00007102
*                                                              @YM00638 00007302
*DESCRIPTIVE-NAME                                              @YM00638 00007402
* OCR CONTROL MODULE                                           @YM00638 00007502
*                                                              @YM00638 00007602
*COPYRIGHT                                                     @YM00638 00007802
* NONE                                                         @YM00638 00008202
*                                                              @YM00638 00008302
*CHANGE-ACTIVITY                                               @YM00638 00008402
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                00008502
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                00008702
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                00008902
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                00009102
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                00009602
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                00010202
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                00010802
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                00011402
* RELEASE 28 ADDITIONS/CHANGES/DELETIONS                                00012002
*                                                                     * 00012602
*STATUS - RELEASE 20 CHANGE LEVEL 000                                 * 00013202
*                                                                     * 00013802
*FUNCTION/OPERATION - TO PROVIDE THE CAPABILITY TO PERFORM VARIOUS    * 00014402
*                      FUNCTIONS TO THE USER. THESE FUNCTIONS ARE     * 00015002
*                       1 ESD - EJECT AND STACKER SELECT A DOCUMENT   * 00015602
*                       2 RKB - READ A FIELD IN THE ON-LINE           * 00016202
*                               CORRECTION MODE                       * 00016802
*                       3 HDR - READ A LINE OF HEADER INFORMATION     * 00017402
*                       4 MKL - MARK A JOURNAL TAPE LINE IN ERROR     * 00018002
*                       5 INC - INCREMENT A DOCUMENT TO THE NEXT STOP * 00018602
*                       6 EJD - EJECT A DOCUMENT                      * 00019202
*                       7 SSD - STACKER SELECT A DOCUMENT             * 00019802
*                                                                     * 00020402
*ENTRY POINTS - IGG019VH CSECT     CALLING SEQUENCE -                 * 00021002
*                                  LOAD DCB ADDRESS IN REGISTER 1     * 00021602
*                                  NEXT AN INSTRUCTION SEQUENCE OF    * 00022202
*                                  BAL 0,*+8                          * 00022802
*                                  DC AL1(N1) INDICATE FUNCTION WANTED* 00023402
*                                  DC AL3(N2) INFORMATION             * 00024002
*                                  IS GENERATED. CONTENTS OF THE TWO  * 00024602
*                                  DC INSTRUCTIONS IS                 * 00025202
*             FUNCTION     DC AL1   DC AL3                            * 00025802
*             ESD             4       1-4 STACKER DESIRED             * 00026402
*             RKB             8       N/A                             * 00027002
*             HDR            12       INPUT AREA ADDRESS              * 00027602
*             MKL            16       N/A                             * 00028202
*             INC            20       N/A                             * 00028802
*             EJD            24       N/A                             * 00029402
*             SSD            28       1-4 STACKER DESIRED             * 00030002
*                                                                     * 00030602
*                                  L 15,84(1,0) POINT TO CNTRL        * 00031202
*                                  BALR 14,15 LINK TO CNTRL           * 00031802
*                                                                     * 00032402
*INPUT - IOB                                                          * 00033002
*         IOBCSW - ADDRESS OF FAILING CCW IF IN SYNAD ROUTINE         * 00033602
*        DCB                                                          * 00034202
*         DCBIOBA - ADDRESS OF THE IOB                                * 00034802
*         DCBCIND2 - QSAM OR BSAM DETERMINATION                       * 00035402
*         DCBSYNAD - ADDRESS OF THE SYNAD ROUTINE                     * 00036002
*                                                                     * 00036602
*OUTPUT - COMPLETION CODE IN REGISTER 15                              * 00037202
*         UPDATED IOB ERROR COUNTERS                                  * 00037802
*         IF UNIT EXCEPTION OCCURS, EOF(X'40') IS POSTED IN DCBORBYT  * 00038402
*         IF ANY PERMANENT ERRORS OCCUR, THE EIB IS UPDATED           * 00039002
*                                                                     * 00039602
*EXTERNAL ROUTINES - IOS VIA EXCP                                     * 00040202
*                    ERROR COUNTER UPDATE IN SYNCH ROUTINE            * 00040802
*                    EIB UPDATE ROUTINE IN SYNCH ROUTINE              * 00041402
*                    COMPLETION CODE ROUTINE IN SYNCH ROUTINE         * 00042019
*                    USER SYNAD ROUTINE                               * 00042719
*                                                                     * 00043419
*EXITS/NORMAL - RETURN TO CALLER - BR 14                              * 00044119
*                                                                     * 00044819
*EXITS/ERROR - ABEND, CODE 001    EOV 0(REG1)                         * 00045519
*                                                                     * 00046219
*TABLES/WORK AREAS - USER SAVE AREA POINTED AT BY REGISTER 13         * 00046919
*                                                                     * 00047619
*ATRIBUTES - REENTRANT,REUSABLE,PROBLEM PROGRAM MODE                  * 00048319
*                                                                     * 00049019
*NOTES - N/A                                                          * 00049719
*                                                                     * 00050419
*********************************************************************** 00051119
         TITLE 'IGG019VH  CNTRL MODULE FOR OCR'                         00051819
*********************************************************************** 00052319
*                                                                     * 00052819
*        REGISTER EQUATES                                             * 00053319
*                                                                     * 00053819
*********************************************************************** 00054319
REG0     EQU   0                  PARAMETER PASSER                      00054819
REG1     EQU   1                  GENERAL REGISTER 1                    00055319
DCBR     EQU   2                  POINTER TO DCB                        00055819
SREG1    EQU   2                  POINTER TO FIRST SAVED USER REGISTER  00056319
IOBR     EQU   3                  POINTER TO IOB                        00056819
REG3     EQU   3                  GENERAL REGISTER 3                    00057319
WORK1    EQU   4                  WORK REGISTER                         00057819
WORK2    EQU   5                  WORK REGISTER                         00058319
CCWREG   EQU   6                  ADDRESS OF CCW                        00058819
PARM1    EQU   7                  POINTS TO PASSED PARAMETER            00059402
REG8     EQU   8                  USED AS LINK TO EIB                   00060002
WORK3    EQU   8                  WORK REGISTER                         00060602
REG9     EQU   9                  GENERAL REGISTER 9                    00061202
BASER    EQU   9                  BASE REGISTER                         00061802
SAVR     EQU   13                 POINTER TO SAVE AREA                  00062402
BACK     EQU   14                 RETURN TO USER                        00063002
RETCODE  EQU   15                 USED TO PASS RETURN CODE              00063602
*********************************************************************** 00064202
*                                                                     * 00064802
*        IOB EQUATES                                                  * 00065402
*                                                                     * 00066002
*********************************************************************** 00066602
IOBSTUS  EQU   4                  DISPLACEMENT TO IOB STATUS            00067202
IOBFL1   EQU   8                  DISPLACEMENT TO IOBFLAG1              00067802
ECBADR   EQU   12                 OFFSET OF ECB ADDRESS IN IOB          00068402
IOBCSW   EQU   16                 DISPLACEMENT TO CSW IN IOB            00069002
IOBSTADR EQU   25                 DISPLACEMENT TO IOB START ADDRESS     00069602
OFFSET   EQU   40                 CCCW OFFSET IN IOB                    00070202
OFFSET1  EQU   48                 POINTER TO NORMAL IOB CCW             00070802
IOBCCOFF EQU   X'BF'              SET IOB COMMAND CHAINING BIT OFF      00071402
IOBCCON  EQU   X'40'              SET IOB COMMAND CHAINING BIT ON       00072002
UETEST   EQU   X'01'              TEST FOR UNIT EXCEPTION               00072602
PERR     EQU   X'41'              CHECK FOR PERMANENT ERROR IN ECB      00073202
*********************************************************************** 00073802
*                                                                     * 00074402
*        CCW EQUATES                                                  * 00075002
*                                                                     * 00075602
*********************************************************************** 00076202
CCWFLAG  EQU   4                  DISPLACEMENT TO FLAG IN CCW           00076802
CCWFLAGS EQU   4                  DISPLACEMENT TO CCW FLAG BYTE         00077402
CCWCOUNT EQU   6                  DISPLACEMENT TO COUNT FIELD IN CCW    00078002
CCWLENG  EQU   8                  LENGTH OF CCW TO MOVE                 00078602
CCOFF    EQU   X'BF'              TURN OFF COMMAND CHAINING BIT IN CCW  00079202
SLION    EQU   X'20'              SET SLI FLAG IN CCW ON                00079802
RFOP     EQU   X'02'              FR COMMAND CODE                       00080402
MKLOP    EQU   X'0B'              MKL COMMAND CODE                      00081002
INCOP    EQU   X'4B'              INC COMMAND CODE                      00081602
EJDOP    EQU   X'43'              EJD COMMAND CODE                      00082202
TEST1OR3 EQU   X'01'              TEST FOR STACKER 1 OR 3               00082802
SETSTK34 EQU   X'70'              SET STACKER 3 OR 4 FOR ESD            00083402
TEST1OR2 EQU   3                  TEST FOR STACKER 1 OR 2               00084002
SET1OR2  EQU   X'20'              SET FOR SSD STACKER 1 OR 2            00084602
SETSTK12 EQU   X'60'              SET FOR ESD STACKER 1 OR 2            00085202
SET3OR4  EQU   X'30'              SET SSD STACKER 3 OR 4                00085802
SET13    EQU   X'03'              SET STACKER 1 OR 3                    00086402
SET24    EQU   X'0B'              SET STACKER 2 OR 4                    00087002
*********************************************************************** 00087602
*                                                                     * 00088202
*        DCB EQUATES                                                  * 00088802
*                                                                     * 00089402
*********************************************************************** 00090002
ERROFF   EQU   X'3F'              CLEAR DCB ERROR FLAGS                 00090602
SYNOFF   EQU   X'7F'              SET SYNAD IN CONTROL OFF              00091202
SYNADPRS EQU   X'01'              TEST FOR SYNAD PRESENT                00091802
HE       EQU   X'02'              TEST FOR HOPPER EMPTY                 00092402
EXITSPEC EQU   X'10'              TEST FOR HOPPER EMPTY SPECIFIED       00093002
QSAMTEST EQU   X'01'              TEST FOR QSAM                         00093602
SYNTEST  EQU   X'80'              TEST FOR IN SYNAD                     00094202
EOF      EQU   X'40'              POST EOF                              00094802
*********************************************************************** 00095402
*                                                                     * 00096002
*        DECB EQUATES                                                 * 00096602
*                                                                     * 00097202
*********************************************************************** 00097802
DECBADDR EQU   48                 DISPLACEMENT TO DECB BUILD AREA       00098402
DECBLT   EQU   52                 DISPLACEMENT TO DECB LENGTH & TYPE    00099002
DECBDCB  EQU   56                 DISPLACEMENT TO DECB DCB ADDRESS      00099602
DECBCCW  EQU   60                 DISPLACEMENT TO DECB CCW ADDRESS      00100202
DECBIOB  EQU   64                 DISPLACEMENT TO DECB IOB ADDRESS      00100802
LNGTYP   EQU   X'80'              DECB LENGTH AND TYPE                  00101402
*********************************************************************** 00102002
*                                                                     * 00102602
*        SAVE AREA EQUATES                                            * 00103202
*                                                                     * 00103802
*********************************************************************** 00104402
USERSAVE EQU   12                 DISPLACEMENT TO REGISTER SAVE AREA    00105002
SAVE39   EQU   16                 DISPLACEMENT TO SAVE AREA             00105602
RETSAVE  EQU   44                 RETURN ADDRESS SAVE AREA POINTER      00106202
XDECB    EQU   48                 ECB OFFSET IN SAVE AREA DECB          00106802
SAVE9    EQU   68                 REGISTER 9 SAVE AREA DISPLACEMENT     00107402
*********************************************************************** 00108002
*                                                                     * 00108602
*        MISCELLANEOUS EQUATES                                        * 00109202
*                                                                     * 00109802
*********************************************************************** 00110402
MKLCNT   EQU   24                 DISPLACEMENT TO MKL ERROR BUCKET      00111002
PARMDISP EQU   3                  DISPLACEMENT TO STACKER PARAMETER     00111602
INITCONT EQU   1                  INITIALIZE CCW COUNT                  00112202
BUFLENG  EQU   X'1E'              ASSUMED BUFFER LENGTH                 00112802
MOVEBYTE EQU   1                  LENGTH TO MOVE ONE BYTE OF DATA       00113402
HDRTEST  EQU   X'0C'              TEST FOR HDR                          00114002
LENGTH4  EQU   4                  MOVE FOUR BYTES                       00114602
ZERO     EQU   X'00'              SET A BYTE TO ZERO                    00115202
CNTRLERR EQU   X'20'              CONTROL ERROR BIT                     00115802
SHIFTHI  EQU   24                 SHIFT COUNT FOR HIGH ORDER BYTE SHIFT 00116402
RKBTEST  EQU   X'08'              TEST FOR RKB                          00117002
RETCDRTN EQU   16                 DISPLACEMENT TO RETURN CODE ROUTINE   00117602
EIBRTN   EQU   8                  DISPLACEMENT TO EIB ROUTINE ADDRESS   00118202
CNTRUPRT EQU   24                 DISPLACEMENT TO ADDR OF CNTR UPDATE   00118802
ACTIOB   EQU   8                  POINTER TO ACTUAL IOB                 00119402
CLEARLEN EQU   8                  LENGTH OF CCW AREA TO CLEAR           00120002
ONE      EQU   1                  ABEND COMPLETION CODE                 00120602
TWELVE   EQU   12                 SHIFT COUNT TO SET ABEND COMP CODE    00121202
         USING IGG019VH,RETCODE   ESTABLISH BASE REGISTER               00121819
         USING IHADCB,DCBR        ESTABLISH DCB ADDRESSIBILITY          00122519
         STM   SREG1,REG9,USERSAVE(SAVR) SAVE USER REGISTERS            00123219
         ST    BACK,RETSAVE(SAVR) SAVE RETURN ADDRESSS                  00123919
         LR    BASER,RETCODE      GET BASE REGISTER SET UP              00124619
         DROP  RETCODE            DROP BASE REGISTER                    00125319
         USING IGG019VH,BASER     ESTABLISH ADDRESSIBILITY              00126019
         LR    DCBR,REG1          GET DCB ADDRESS                       00126719
         L     IOBR,DCBIOBA       GET IOB ADDRESS                       00127419
         LR    PARM1,REG0         GET DESIRED OPERATION                 00128119
         NI    IOBFL1(IOBR),IOBCCOFF SET COMMAND CHAINING BIT OFF       00128819
         XC    OFFSET(CLEARLEN,IOBR),OFFSET(IOBR) CLEAR CCW AREA        00129519
         MVI   CCWCOUNT+OFFSET+1(IOBR),INITCONT SET COUNT TO 1          00130219
DETOP    SR    WORK1,WORK1        CLEAR WORK REGISTER                   00130919
         IC    WORK1,0(PARM1)     GET BRANCH TABLE OFFSET               00131619
         B     BRTAB(WORK1)       GO TO DESIRED ROUTINE                 00132319
*********************************************************************** 00132419
* BRANCH TABLE FOR OPERATUN DETERMINATION                             * 00132519
*********************************************************************** 00132619
BRTAB    EQU   *-4                ESTABLISH BRANCH TABLE ADDRESSABILITY 00133019
         B     ESD                ESD DESIRED                           00133719
         B     RKB                RKB DESIRED                           00134419
         B     SETHDR             GO SET UP HDR CCW                     00135119
         B     MKL                MKL DESIRED                           00135819
         B     INC                INC DESIRED                           00136519
         B     EJD                EJD DESIRED                           00137219
         B     SSD                SSD DESIRED                           00137919
* SET FOR ESD                                                           00138219
ESD      CLI   PARMDISP(PARM1),TEST1OR2 IS STACKER 1 OR 2 WANTED        00138619
         BL    SET1               NO MUST BE 3 OR 4                     00139319
         OI    OFFSET(IOBR),SETSTK34 SET FOR STACKER 3 OR 4             00140019
SET1     OI    OFFSET(IOBR),SETSTK12 SET FOR STACKER 1 OR 2             00140719
SETFINAL TM    PARMDISP(PARM1),TEST1OR3 IS OT STACKER 1 OR 3            00141419
         BO    SET2               YES SET A 3                           00142119
         OI    OFFSET(IOBR),SET24 SET STACKER 2 OR 4                    00142819
SET2     OI    OFFSET(IOBR),SET13 SET STACKER 1 OR 3                    00143519
         B     ISSUE              GO ISSUE COMMAND                      00144219
* SET FOR SSD                                                           00144519
SSD      OI    CCWFLAG+OFFSET(IOBR),SLION SET SLI FLAG ON               00144919
         CLI   PARMDISP(PARM1),TEST1OR2 IS IT STACKER 1 OR 2            00145619
         BL    SET3               YES SET FOR 1 OR 2                    00146319
         OI    OFFSET(IOBR),SET3OR4  SET FOR STACKER 3 OR 4             00147019
SET3     OI    OFFSET(IOBR),SET1OR2 SET FOR STACKER 1 OR 2              00147719
         B     SETFINAL           GO SET UP 2ND 4 BITS OF COMMAND CODE  00148419
* SET FOR MKL                                                           00148719
MKL      MVI   OFFSET(IOBR),MKLOP SET MKL OP CODE                       00149119
         B     ISSUE              GO ISSUE COMMAND                      00149819
* SET FOR INC                                                           00150119
INC      MVI   OFFSET(IOBR),INCOP SET INC OP CODE                       00150519
         B     ISSUE              GO ISSUE COMMAND                      00151219
* SET FOR EJD                                                           00151519
EJD      MVI   OFFSET(IOBR),EJDOP SET EJD OP CODE                       00151919
         B     ISSUE              GO ISSUE COMMAND                      00152619
* START SETTING FOR RKB                                                 00152919
RKB      L     CCWREG,IOBCSW(IOBR) GET CCW ADDRESS                      00153319
         B     SETRF              GO READ                               00154019
*********************************************************************** 00154119
* SET TO ISSUE MKL,EJD,ESD,SSD, OR INC COMMAND                        * 00154219
*********************************************************************** 00154319
ISSUE    EQU   *                  PREPARE TO ISSUE COMMAND              00154719
         NI    DCBIFLGS,ERROFF    CLEAR ERROR FLAGS                     00155419
         L     REG8,IOBCSW(IOBR)  SAVE ADDRESS OF FAILINC CCW           00156119
         MVI   DCBOFFSR,OFFSET    POINT TO CNTRL CCW IN IOB             00156819
         LA    WORK1,OFFSET(IOBR) GET CCW ADDRESS                       00157519
         L     WORK2,IOBSTADR-1(IOBR) SAVE START ADDRESS                00158219
         ST    WORK1,IOBSTADR-1(IOBR) SET START ADDRESS                 00158919
*********************************************************************** 00159019
* EXCP AND WAIT                                                         00159119
*********************************************************************** 00159219
         EXCP  ACTIOB(IOBR)       EXECUTE CHALLEL PROGRAM               00159619
         L     REG1,ECBADR(IOBR)  LOAD ECB ADDRESS                      00160319
         WAIT  ECB=(REG1)         WAIT FOR EVENT TO COMPLETE            00161019
         OI    IOBFL1(IOBR),IOBCCON SET COMMAND CHAINING BIT ON         00161719
         MVI   DCBOFFSR,OFFSET1   RESTORE CCW OFFSCT IN DCB             00162419
         ST    REG8,IOBCSW(IOBR)  RESTORE POINTER TO FAILING CCW        00163119
         ST    WORK2,IOBSTADR-1(IOBR) RESTORE START ADDRESS             00163819
*********************************************************************** 00163919
* LINK TP COUNTER UPDATE ROUTINE IN SYNCH OR CHECK MODULE             * 00164019
*********************************************************************** 00164119
COUNTERS L     RETCODE,DCBGERR    GET ADDR OF CNTR UPDATE RTN - 24      00164519
         BAL   BACK,CNTRUPRT(RETCODE) LINK TL COUNTER UPDATE ROUTINE    00165219
         LTR   REG1,REG1          COUNTERS SPECIFIED                    00165919
         BZ    NOCOUNT            NO CONTINUE                           00166619
         CLI   OFFSET(IOBR),MKLOP IS IT MKL                             00167319
         BNE   NOCOUNT            NO BYPASS MKL COUNTER UPDATE          00168019
         L     WORK2,MKLCNT(REG1) GET MKL ERROR BUCKET                  00168719
         LA    WORK2,1(WORK2)     BUMP ERROR COUNTER                    00169419
         ST    WORK2,MKLCNT(REG1) UPDATE ERROR BUCKET                   00170119
*                                                                       00170819
NOCOUNT  SR    RETCODE,RETCODE    SET RETURN CODE TO ZEROS              00171519
         L     REG1,ECBADR(IOBR)  LOAD ECB ADDRESS                      00173619
         CLI   0(REG1),PERR       DID ANY PERMANENT ERRORS OCCUR        00174319
         BNE   NOERROR            NO RETURN TO USER                     00175019
*********************************************************************** 00175119
* LINJ TO SET EIB ROUTINE IN SYNCH OR CHECK MODULE                    * 00175219
*********************************************************************** 00175319
ERROR    EQU   *                  ERROR PROCESSING ROUTINE              00175719
         L     RETCODE,DCBGERR    GET ADDRESS OF EIB ROUTINE-8          00176419
         BAL   BACK,EIBRTN(RETCODE) LINK TO EIB ROUTINE                 00176619
*********************************************************************** 00176819
* LINK TO COMPLETION CODE ROUTINE IN SYNCH OR CHECK MODULE            * 00177019
*********************************************************************** 00177219
         L     RETCODE,DCBGERR    GET ADDRESS OF RETURN CODE ROUTINE-16 00177419
         BAL   BACK,RETCDRTN(RETCODE) LINK TO RETURN CODE ROUTINE       00177619
*001918                                                                 00177819
*********************************************************************** 00178019
* LINK TO USER SYNAD ROUTINE                                          * 00178219
*********************************************************************** 00178419
         TM    IOBCSW+IOBSTUS(IOBR),UETEST DID UNIT EXCAPTION OCCUR     00179219
         BZ    NOTDONE            NO CONTINUE                           00179919
         OI    DCBORBYT,EOF       POST EOF IN DCBORBYT                  00180619
DONE     EQU   *                  RETURN TO USER                        00181319
         NI    DCBIFLGS,ERROFF    SET DCB ERROR FLAGS OFF               00182019
NOERROR  LM    SREG1,REG9,USERSAVE(SAVR) RESTORE USER REGISTERS         00182719
         L     BACK,RETSAVE(SAVR) RESTORE RETURN ADDRESS                00183419
         BR    BACK               RETURN TO USER                        00184119
NOTDONE  CLI   OFFSET(IOBR),MKLOP IS IT MKL                             00184819
         BE    DONE               YES QUIT                              00185519
         CLI   0(PARM1),RKBTEST   IS IT RKB                             00186219
         BE    DONE               YES QUIT                              00186919
         TM    DCBORBYT,SYNTEST   IN SYNAD ROUTINE                      00187619
         BO    DONE               YES QUIT                              00188319
         TM    DCBCIND2,QSAMTEST  IS IT QSAM                            00189019
         BZ    BSAMROUT           NO BSAM                               00189719
         LA    REG0,OFFSET        GET CCW OFFSET                        00190419
         SLL   REG0,SHIFTHI       SHIFT TO HIGH ORDER BYTE              00191119
         OR    REG0,IOBR          POT IOB ADDRESS IN REG 0              00191819
TRY      EQU   *                  LINK TO SYNAD ROUTINE IF PRESENT      00192519
         LA    REG1,CNTRLERR      SET CONTROL ERROR BIT                 00193219
         SLL   REG1,SHIFTHI       SHIFT TO HIGH ORDER BYTE              00193919
         OR    REG1,DCBR          GET DCB ADDRESS                       00194619
         NI    DCBIFLGS,ERROFF    TURN OFF ERROR FLAGS                  00195319
         OI    DCBORBYT,SYNTEST   TURN ON SYNAD BIT IN DCB              00196019
         L     RETCODE,DCBSYNAD   GET ADDRESS OF SYNAD ROUTINE          00196719
         ST    REG9,SAVE9(SAVR)   SAVE REGISTER 9                       00197419
         LM    SREG1,REG9,USERSAVE(SAVR) RESTORE USER REGISTERS         00198119
         ST    REG1,USERSAVE(SAVR) SAVE DCB ADDRESS                     00198819
         BALR  BACK,RETCODE       LINK TO SYNAD ROUTINE                 00199519
         STM   REG3,REG9,SAVE39(SAVR) SAVE USER REGISTERS               00200219
         L     REG9,SAVE9(SAVR)   RESTORE REGISTER 9                    00200919
         L     REG3,USERSAVE(SAVR) GET DCB ADDRESS                      00201619
         ST    SREG1,USERSAVE(SAVR) SAVE USER REGISTER 2                00202319
         LR    DCBR,REG3          RESTORE DCB REGISTER                  00203019
         NI    DCBIFLGS,ERROFF    SET DCB ERROR FLAGS OFF               00203719
         NI    DCBORBYT,SYNOFF    SET SYNAD IN CONTROL BIT OFF          00204419
         LTR   RETCODE,RETCODE    USER EXIT ADDRESS SPECIFIED           00205119
         BZ    DONE               NO RETURN TO USER                     00205819
         NI    DCBORBYT,ZERO      CLEAR DCBORBYT                        00206519
         TM    DCBCIND2,QSAMTEST  IS IT QSAM                            00207219
         BZ    LOAD               NO                                    00207919
         MVC   DCBRECAD(LENGTH4),DCBEOBAD SET EOB CONDITION             00208619
LOAD     LM    SREG1,REG9,USERSAVE(SAVR) RESTORE USER REGISTERS         00209319
         BR    RETCODE            EXIT TO USER ROUTINE                  00210019
BSAMROUT TM    DCBSYNAD+3,SYNADPRS IS A SYNAD ROUTINE PRESENT           00210719
         BZ    SYNPRES            YES PROCESS FOR SYNAD                 00211419
*********************************************************************** 00211519
* ABEND                                                               * 00211619
*********************************************************************** 00211719
         LA    REG0,ONE           SET COMPLETION CODE TO 1              00212019
         SLL   REG0,TWELVE        ADJUST FOR EOV                        00212319
         LR    REG1,DCBR          PUT DCB ADDRESS IN REG 1              00212819
         EOV   (REG1)             ABORT                                 00213519
SYNPRES  TM    DCBEIB,HE          HOPPER EMPTY PRESENT                  00214219
         BZ    HPRFULL            NO                                    00214919
         TM    DCBOPTCD,EXITSPEC  HOPPER EMPTY EXIT SPECIFIED           00215619
         BZ    DONE               NO RETURN TO USER                     00216319
HPRFULL  L     WORK1,ECBADR(IOBR) LOAD ECB ADDRESS                      00217019
         MVC   XDECB(LENGTH4,SAVR),0(WORK1) MOVE ECB TO DECB            00217719
         LA    WORK2,LNGTYP       GET LENGTH AND TYPE                   00218419
         ST    WORK2,DECBLT(SAVR) PUT IN DECB                           00219119
         LA    WORK2,OFFSET(IOBR) GET CCW ADDRESS                       00219819
         ST    WORK2,DECBCCW(SAVR) PUT IN DECB                          00220519
         LA    WORK1,ACTIOB(IOBR) GET IOB ADDRESS                       00221219
         ST    WORK1,DECBIOB(SAVR) PUT IN DECB                          00221919
         ST    DCBR,DECBDCB(SAVR) PUT DCB ADDRESS IN DECB               00222619
         LA    REG0,DECBADDR(SAVR) PUT DECB ADDRESS IN REGISTER 0       00223319
         B     TRY                CONTINUE                              00224019
* SET FOR RKB                                                           00224319
SETRF    LA    CCWREG,0(CCWREG)   CLEAR HIGH ORDER BYTE                 00224719
         SH    CCWREG,EIGHT       DECREMENT BY EIGHT                    00225419
         MVC   OFFSET(CCWLENG,IOBR),0(CCWREG) MOVE CCW TO IOB + 40      00226119
* THIS CODE SETS UP TO ISSUE HDR OR RKB COMMAND                         00226419
NOBUF    LA    CCWREG,OFFSET(IOBR) LOAD ADDRESS OF CHANNEL PROG START   00226819
         NI    CCWFLAGS(CCWREG),CCOFF TURN OFF COMMAND CHAINING BIT     00227519
         NI    DCBIFLGS,ERROFF    TURN OFF DCB ERROR FLAGS              00228219
         L     WORK1,0(CCWREG)    GET DATA ADDRESS                      00228919
         LA    WORK1,0(WORK1)     CLEAR HIGH ORDER BYTE                 00229619
         LH    WORK2,CCWCOUNT(CCWREG) GET BYTE COUNT                    00230319
         BCTR  WORK2,0            SUBTRACT 1                            00231019
         CLI   0(PARM1),HDRTEST   IS IT HDR                             00231719
         BE    NOCLEAR            YES DO NOT CLEAR INPUT AREA           00232419
         SR    WORK1,WORK2        GET START OF I/O AREA                 00233119
         ST    WORK1,OFFSET(IOBR) SET CORRECT DATA ADDRESS IN CCW       00233819
CLEAR    EX    WORK2,CLEAREX                                            00234519
NOCLEAR  EQU   *                  PREPARE TO ISSUE COMMAND              00235219
         MVI   0(CCWREG),RFOP     SET RF OP CODE                        00235919
         L     REG8,IOBCSW(IOBR)  SAVE ADDRESS OF FAILINC CCW           00236619
         MVI   DCBOFFSR,OFFSET    POINT TO CNTRL CCW IN IOB             00237319
         L     WORK1,IOBSTADR-1(IOBR) SAVE START ADDRESS                00238019
         ST    CCWREG,IOBSTADR-1(IOBR) SET START ADDRESS                00238719
*********************************************************************** 00238819
* EXCP AND WAIT                                                       * 00238919
*********************************************************************** 00239019
         EXCP  ACTIOB(IOBR)       EXECUTE CHANNEL PROGRAM               00239419
         L     REG1,ECBADR(IOBR)  LOAD ECB ADDRESS                      00240119
         WAIT  ECB=(REG1)         WAIT FOR EVENT TO COMPLETE            00240819
         MVI   DCBOFFSR,OFFSET1   RESTORE CCW OFFSCT IN DCB             00241519
         OI    IOBFL1(IOBR),IOBCCON SET COMMAND CHAINING BIT ON IN IOB  00242219
         ST    REG8,IOBCSW(IOBR)  RESTORE POINTER TO FAILING CCW        00242919
         ST    WORK1,IOBSTADR-1(IOBR) RESTORE START ADDRESS             00243619
         CLI   0(PARM1),RKBTEST   IS IT RKB                             00244319
         BNE   COUNTERS           NO QUIT                               00245019
*********************************************************************** 00245119
* ROUTINE TO RIGHT ADJUST DATA FOR RKB                                * 00245219
*********************************************************************** 00245319
         SR    WORK1,WORK1        CLEAR WORK                            00245719
         LH    WORK1,CCWCOUNT(CCWREG) GET BYTE COUNT                    00246419
         L     WORK3,0(CCWREG)    GET BUFFER ADDRESS                    00247119
         LA    WORK3,0(WORK3)     CLEAR HIGH ORDER BYTE                 00247819
         AR    WORK3,WORK2        POINT TO END OF BUFFER                00248519
         LR    CCWREG,WORK3       SAVE BUFFER ADDRESS                   00249219
         SR    WORK2,WORK2        REGISTERS                             00249919
TEST     CLI   0(WORK3),ZERO      IS BYTE 00                            00250619
         BNE   MOVEDATA           NO ADJUST DATA                        00251319
         BCT   WORK1,TRYAGAIN     IF MORE DATA TRY AGAIN                00252019
         B     COUNTERS           QUIT                                  00252719
TRYAGAIN BCTR  WORK3,0            DECREMENT BUFFER ADDRESS              00253419
         LA    WORK2,1(WORK2)     INCREMENT ZERO BYTE COUNTER           00254119
         B     TEST               TRY ANOTHER BYTE                      00254819
MOVEDATA EQU   *                  MOVE ROUTINE TO RIGHT ADJUST DATA     00255519
MOVE     MVC   0(MOVEBYTE,CCWREG),0(WORK3) MOVE A BYTE                  00256219
         BCTR  CCWREG,0           DECREMENT END OF BUFFER POINTER       00256919
         BCTR  WORK3,0            DECREMENT END OF DATA POINTER         00257619
         BCT   WORK1,MOVE         IF MORE DATA,MOVE IT                  00258319
         LTR   WORK2,WORK2        ANY ZERO BYTES                        00259019
         BZ    COUNTERS           NO ALL DONE                           00259719
         LA    WORK3,1(WORK3)     POINT TO START OF BUFFER              00260419
         BCTR  WORK2,0            SUBTRACT 2 FROM COUNT                 00261119
         EX    WORK2,CLEAREX1     CLEAR INPUT AREA                      00261819
         B     COUNTERS           QUIT                                  00262519
* SET FOR HDR                                                           00262819
SETHDR   L     WORK1,0(PARM1)     GET INPUT ADDRESS                     00263219
         ST    WORK1,OFFSET(IOBR) PUT IN CCW                            00263919
         MVI   OFFSET+CCWFLAGS(IOBR),SLION SET SLI FLAG ON              00264619
         MVI   OFFSET+CCWCOUNT+1(IOBR),BUFLENG SET TO ASSUMED LENGTH    00265319
         LH    WORK1,DCBBUFL      GET BUFFER LENGTH                     00266019
         LTR   WORK1,WORK1        LENGTH SPECIFIED                      00266719
         BZ    NOBUF              NO USE ASSUMED VALUE                  00267419
         STH   WORK1,OFFSET+CCWCOUNT(IOBR) SET COUNT                    00268119
         B     NOBUF              GO READ HEADER                        00268819
CLEAREX  XC    0(1,WORK1),0(WORK1) EXECUTED INSTRUCTION TO CLEAR AEEA   00269519
CLEAREX1 XC    0(1,WORK3),0(WORK3) EXECUTED INSTRUCTION TO CLEAR AEEA   00270219
EIGHT    DC    H'08'              CONSTANT OF 8                         00270919
IHADCB   DCBD  DSORG=PS           DCB DSECT                             00271619
         END   IGG019VH                                                 00272319
         TITLE 'IGG019VH  CNTRL MODULE FOR OCR'                         00300019
OFFSET   EQU   40                 CCCW OFFSET IN IOB                    00600019
OFFSET1  EQU   48                 POINTER TO NORMAL IOB CCW             00900019
RETCODE  EQU   15                 USED TO PASS RETURN CODE              01200019
REG1     EQU   1                  GENERAL REGISTER 1                    01500019
REG9     EQU   9                  GENERAL REGISTER 9                    01800019
BASER    EQU   9                  BASE REGISTER                         02100019
DCBR     EQU   2                  POINTER TO DCB                        02400019
IOBR     EQU   3                  POINTER TO IOB                        02700019
IOBFL1   EQU   8                  DISPLACEMENT TO IOBFLAG1              03000019
IOBECBCC EQU   4                  DISPLACEMENT TO ECB CONDITION CODE    03300019
WORK1    EQU   4                  WORK REGISTER                         03600019
PARM1    EQU   7                  POINTS TO PASSED PARAMETER            03900019
REG0     EQU   0                  PARAMETER PASSER                      04200019
MKLCNT   EQU   24                 DISPLACEMENT TO MKL ERROR BUCKET      04500019
SREG1    EQU   2                  POINTER TO FIRST SAVED USER REGISTER  04800019
IOBSNS   EQU   11                 POINTER TO IOB SENSE BYTE             05100019
MKLOP    EQU   X'0B'              MKL COMMAND CODE                      05400019
INCOP    EQU   X'4B'              INC COMMAND CODE                      05700019
EJDOP    EQU   X'43'              EJD COMMAND CODE                      06000019
SET1OR2  EQU   X'20'              SET FOR SSD STACKER 1 OR 2            06300019
SETSTK12 EQU   X'60'              SET FOR ESD STACKER 1 OR 2            06600019
SET3OR4  EQU   X'30'              SET SSD STACKER 3 OR 4                06900019
SLION    EQU   X'20'              SET SLI FLAG IN CCW ON                07200019
CCWFLAG  EQU   4                  DISPLACEMENT TO FLAG IN CCW           07500019
SET13    EQU   X'03'              SET STACKER 1 OR 3                    07800019
SET24    EQU   X'0B'              SET STACKER 2 OR 4                    08100019
TEST1OR3 EQU   X'01'              TEST FOR STACKER 1 OR 3               08400019
SETSTK34 EQU   X'70'              SET STACKER 3 OR 4 FOR ESD            08700019
TEST1OR2 EQU   3                  TEST FOR STACKER 1 OR 2               09000019
PARMDISP EQU   3                  DISPLACEMENT TO STACKER PARAMETER     09300019
INITCONT EQU   1                  INITIALIZE CCW COUNT                  09600019
CCWCOUNT EQU   6                  DISPLACEMENT TO COUNT FIELD IN CCW    09900019
STACK1   EQU   X'63'              STACKER 1 ESD                         10200019
STACK2   EQU   X'6B'              STACKER 2 ESD                         10500019
STACK3   EQU   X'73'              STACKER 3 ESD                         10800019
STCK1    EQU   X'23'              STACKER 1 SSD                         11100019
STCK2    EQU   X'2B'              STACKER 2 SSD                         11400019
STCK3    EQU   X'33'              STACKER 3 SSD                         11700019
IOBCSW   EQU   16                 DISPLACEMENT TO CSW IN IOB            12000019
LNGTYP   EQU   X'80'              DECB LENGTH AND TYPE                  12300019
CCWREG   EQU   6                  ADDRESS OF CCW                        12600019
WORK2    EQU   5                  WORK REGISTER                         12900019
INCAM    EQU   36                 DISPLACEMENT TO IOB DATA CHECK COUNT  13200019
DATCK    EQU   20                 DISPACEMENT TO UCB DATA CHECK COUNT   13500019
ILCNT    EQU   8                  DISPLACEMENT TO UCB IL COUNT          13800019
EQCNT    EQU   0                  DISPLACEMENT TO UCB EQUIPMENT CHK CNT 14100019
ECBCODE  EQU   4                  DISPLACEMENT TO ECB CODE IN IOB       14400019
IOBSTADR EQU   25                 DISPLACEMENT TO IOB START ADDRESS     14700019
REG8     EQU   8                  USED AS LINK TO EIB                   15000019
RET1     EQU   7                  RETURN ADDRESS REGISTER               15300019
BACK     EQU   14                 RETURN TO USER                        15600019
SAVR     EQU   13                 POINTER TO SAVE AREA                  15900019
SAV12    EQU   12                 USER SAVE REGISTER                    16200019
WORK3    EQU   8                  WORK REGISTER                         16500019
RE2      EQU   2                  USER SAVE REGISTER                    16800019
IGG019VH CSECT                    ENTRY POINT FOR CONTROL MODULE        17100019
         USING IGG019VH,RETCODE   ESTABLISH BASE REGISTER               17400019
         USING IHADCB,DCBR        ESTABLISH DCB ADDRESSIBILITY          17700019
         STM   SREG1,REG9,12(SAVR) SAVE USER REGISTERS                  18000019
         ST    BACK,44(SAVR)      SAVE RETURN ADDRESS                   18300019
         LR    BASER,RETCODE      GET BASE REGISTER SET UP              18600019
         DROP  RETCODE            DROP BASE REGISTER                    18900019
         USING IGG019VH,BASER     ESTABLISH ADDRESSIBILITY              19200019
         LR    DCBR,REG1          GET DCB ADDRESS                       19500019
         L     IOBR,DCBIOBA       GET IOB ADDRESS                       19800019
         LR    PARM1,REG0         GET DESIRED OPERATION                 20100019
         NI    IOBFL1(IOBR),X'BF' SET COMMAND CHAINING BIT OFF          20400019
         XC    OFFSET(8,IOBR),OFFSET(IOBR) CLEAR CCW AREA               20700019
         MVI   CCWCOUNT+OFFSET+1(IOBR),INITCONT SET COUNT TO 1          21000019
DETOP    SR    WORK1,WORK1        CLEAR WORK REGISTER                   21300019
         IC    WORK1,0(PARM1)     GET BRANCH TABLE OFFSET               21600019
         B     BRTAB(WORK1)       GO TO DESIRED ROUTINE                 21900019
BRTAB    EQU   *-4                                                      22200019
         B     ESD                ESD DESIRED                           22500019
         B     RKB                RKB DESIRED                           22800019
         B     SETHDR             GO SET UP HDR CCW                     23100019
         B     MKL                MKL DESIRED                           23400019
         B     INC                INC DESIRED                           23700019
         B     EJD                EJD DESIRED                           24000019
         B     SSD                SSD DESIRED                           24300019
ESD      CLI   PARMDISP(PARM1),TEST1OR2 IS STACKER 1 OR 2 WANTED        24600019
         BL    SET1               NO MUST BE 3 OR 4                     24900019
         OI    OFFSET(IOBR),SETSTK34 SET FOR STACKER 3 OR 4             25200019
SET1     OI    OFFSET(IOBR),SETSTK12 SET FOR STACKER 1 OR 2             25500019
SETFINAL TM    PARMDISP(PARM1),TEST1OR3 IS OT STACKER 1 OR 3            25800019
         BO    SET2               YES SET A 3                           26100019
         OI    OFFSET(IOBR),SET24 SET STACKER 2 OR 4                    26400019
SET2     OI    OFFSET(IOBR),SET13 SET STACKER 1 OR 3                    26700019
         B     ISSUE              GO ISSUE COMMAND                      27000019
SSD      OI    CCWFLAG+OFFSET(IOBR),SLION SET SLI FLAG ON               27300019
         CLI   PARMDISP(PARM1),TEST1OR2 IS IT STACKER 1 OR 2            27600019
         BL    SET3               YES SET FOR 1 OR 2                    27900019
         OI    OFFSET(IOBR),SET3OR4  SET FOR STACKER 3 OR 4             28200019
SET3     OI    OFFSET(IOBR),SET1OR2 SET FOR STACKER 1 OR 2              28500019
         B     SETFINAL           GO SET UP 2ND 4 BITS OF COMMAND CODE  28800019
MKL      MVI   OFFSET(IOBR),MKLOP SET MKL OP CODE                       29100019
         B     ISSUE              GO ISSUE COMMAND                      29400019
INC      MVI   OFFSET(IOBR),INCOP SET INC OP CODE                       29700019
         B     ISSUE              GO ISSUE COMMAND                      30000019
EJD      MVI   OFFSET(IOBR),EJDOP SET EJD OP CODE                       30300019
         B     ISSUE              GO ISSUE COMMAND                      30600019
RKB      L     CCWREG,IOBCSW(IOBR) GET CCW ADDRESS                      30900019
         B     SETRF              GO READ                               31200019
ISSUE    EQU   *                                                        31500019
         NI    DCBIFLGS,X'3F'     CLEAR E-ROR FLAGS                     31800019
         L     REG8,IOBCSW(IOBR)  SAVE ADDRESS OF FAILINC CCW           32100019
         MVI   DCBOFFSR,OFFSET    POINT TO CNTRL CCW IN IOB             32400019
         LA    WORK1,OFFSET(IOBR) GET CCW ADDRESS                       32700019
         L     WORK2,IOBSTADR-1(IOBR) SAVE START ADDRESS                33000019
         ST    WORK1,IOBSTADR-1(IOBR) SET START ADDRESS                 33300019
         EXCP  8(IOBR)                                                  33600019
         WAIT  ECB=4(IOBR)        WAIT FOR COMPLETION                   33900019
         OI    IOBFL1(IOBR),X'40' SET COMMAND CHAINING BIT ON           34200019
         MVI   DCBOFFSR,OFFSET1   RESTORE CCW OFFSCT IN DCB             34500019
         ST    REG8,IOBCSW(IOBR)  RESTORE POINTER TO FAILING CCW        34800019
         ST    WORK2,IOBSTADR-1(IOBR) RESTORE START ADDRESS             35100019
COUNTERS L     RETCODE,DCBGERR    GET ADDR OF CNTR UPDATE RTN - 24      35400019
         BAL   BACK,24(RETCODE)   LINK TO CNTR UPDATE ROUTINE           35700019
         LTR   REG1,REG1          COUNTERS SPECIFIED                    36000019
         BZ    NOCOUNT            NO CONTINUE                           36300019
         CLI   40(IOBR),X'0B'     IS IT MKL                             36600019
         BNE   NOCOUNT                                                  36900019
         L     WORK2,MKLCNT(REG1) GET MKL ERROR BUCKET                  37200019
         LA    WORK2,1(WORK2)     BUMP ERROR COUNTER                    37500019
         ST    WORK2,MKLCNT(REG1) UPDATE ERROR BUCKET                   37800019
*                                                                       38100019
NOCOUNT  SR    RETCODE,RETCODE    SET RETURN CODE TO ZEROS              38400019
         TM    IOBSNS(IOBR),X'10' IS IT KEYBOARD CORRECTION             38700019
         BO    ERROR              YES PROCESS IT                        39000019
         CLI   ECBCODE(IOBR),X'41' DID ANY PERMANENT ERRORS OCCUR       39300019
         BNE   NOERROR            NO RETURN TO USER                     39600019
ERROR    EQU   *                                                        39900019
         L     RETCODE,DCBGERR    GET ADDRESS OF EIB ROUTINE-8          40200019
         BAL   BACK,8(RETCODE)    LINK TO EIB ROUTINR                   40500019
         L     RETCODE,DCBGERR    GET ADDRESS OF RETURN CODE ROUTINE-16 40800019
         BAL   BACK,16(RETCODE)   LINK TO RETURN CODE ROUTINE           41100019
         TM    IOBCSW+4(IOBR),X'01'  DID UNIT EXCEPTION OCCUR           41400019
         BZ    NOTDONE            NO CONTINUE                           41700019
         OI    DCBORBYT,X'40'     POST EOF IN DCB                       42000019
DONE     EQU   *                                                        42300019
         NI    DCBIFLGS,X'3F'     SET DCB ERROR FLAGS OFF               42600019
NOERROR  LM    SREG1,REG9,12(SAVR) RESTORE USER REGISTERS               42900019
         L     BACK,44(SAVR)      RESTORE RETURN ADDRESS                43200019
         BR    BACK               RETURN TO USER                        43500019
NOTDONE  CLI   40(IOBR),X'0B'     IS IT MKL                             43800019
         BE    DONE               YES QUIT                              44100019
         CLI   0(PARM1),X'08'     IS IT RKB                             44400019
         BE    DONE               YES QUIT                              44700019
         TM    DCBORBYT,X'80'     IN SYNAD ROUTINE                      45000019
         BO    DONE               YES QUIT                              45300019
         TM    DCBCIND2,X'01'     IS IT QSAM                            45600019
         BZ    BSAMROUT           NO BSAM                               45900019
         LA    REG0,OFFSET        GET CCW OFFSET                        46200019
         SLL   REG0,24            SHOFT TO HIGH ORDER BYTE              46500019
         OR    REG0,IOBR          POT IOB ADDRESS IN REG 0              46800019
TRY      EQU   *                                                        47100019
         LA    REG1,X'20'         SET CONTROL ERROR BI7                 47400019
         SLL   REG1,24            SHIFT TO HIGH ORDER BYTE              47700019
         OR    REG1,DCBR          GET DCB ADDRESS                       48000019
         NI    DCBIFLGS,X'3F' 1   TURN OFF ERROR FLAGS                  48300019
         OI    DCBORBYT,X'80'     TURN ON SYNAD BIT IN DCB              48600019
         L     RETCODE,DCBSYNAD   GET ADDRESS OF SYNAD ROUTINE          48900019
         ST    DCBR,68(SAVR)      SAVE DCB POINTER                      49200019
         LM    SREG1,REG9,12(SAVR) RESTORE USER REGISTERS               49500019
         BALR  BACK,RETCODE       LINK TO SYNAD ROUTINE                 49800019
         STM   SREG1,REG9,12(SAVR) SAVE USER REGISTERS                  50100019
         L     DCBR,68(SAVR)      RESTORE DCB POINTER                   50400019
         NI    DCBIFLGS,X'3F'     SET DCB ERROR FLAGS OFF               50700019
         NI    DCBORBYT,X'7F'     SET SYNAD IN CONTROL BIT OFF          51000019
         LTR   RETCODE,RETCODE    USER EXIT ADDRESS SPECIFIED           51300019
         BZ    DONE               NO RETURN TO USER                     51600019
         NI    DCBORBYT,X'00'     RESET DCBORBYT                        51900019
         TM    DCBCIND2,X'01'     IS IT QSAM                            52200019
         BZ    LOAD               NO                                    52500019
         MVC   DCBRECAD(4),DCBEOBAD SET EOB CONDITION                   52800019
LOAD     LM    SREG1,REG9,12(SAVR) RESTORE USER REGISTERS               53100019
         BR    RETCODE            EXIT TO USER ROUTINE                  53400019
BSAMROUT TM    DCBSYNAD+3,X'01'   IS A SYNAD ROUTINE PRESENT            53700019
         BZ    SYNPRES            YES PROCESS FOR SYNAD                 54000019
         LR    REG0,IOBR          PUT IOB ADDRESS IN REG 0              54300019
         LR    REG1,DCBR          PUT DCB ADDRESS IN REG 1              54600019
         EOV   (REG1)             ABORT                                 54900019
SYNPRES  TM    DCBEIB,X'02'       HOPPER EMPTY PRESENT                  55200019
         BZ    HPRFULL            NO                                    55500019
         TM    DCBOPTCD,X'10'     HOPPER EMPTY EXIT SPECIFIED           55800019
         BZ    DONE               NO RETURN TO USER                     56100019
HPRFULL  L     WORK1,ECBCODE(IOBR) GET ECB ADDRESS                      56400019
         LA    WORK1,0(WORK1)     CLEAR HIGH ORDER BYTE                 56700019
         L     WORK2,0(WORK1)     GET ECB                               57000019
         ST    WORK2,48(SAVR)     PUT IN DECB                           57300019
         LA    WORK2,LNGTYP       GET LENGTH AND TYPE                   57600019
         ST    WORK2,52(SAVR)     PUT IN DECB                           57900019
         LA    WORK2,40(IOBR)     GET CCW ADDRESS                       58200019
         ST    WORK2,60(SAVR)     PUT IN DECB                           58500019
         LA    WORK1,8(IOBR)      GET IOB ADDRESS                       58800019
         ST    WORK1,64(SAVR)     PUT IN DECB                           59100019
         ST    DCBR,56(SAVR)      PUT IN DECB                           59400019
         LA    REG0,48(SAVR)      PUT DECB ADDRESS IN REG 0             59700019
         B     TRY                CONTINUE                              60000019
SETRF    LA    CCWREG,0(CCWREG)   CLEAR HIGH ORDER BYTE                 60300019
         SH    CCWREG,EIGHT       DECREMENT BY EIGHT                    60600019
         MVC   OFFSET(8,IOBR),0(CCWREG) MOVE CCW TO IOB+40              60900019
NOBUF    LA    CCWREG,OFFSET(IOBR) LOAD ADDRESS OF CHANNEL PROG START   61200019
         NI    4(CCWREG),X'BF'    TURN OFF COMMAND CHAINING             61500019
         NI    DCBIFLGS,X'3F'     CLEAR ERROR FLAGS                     61800019
         L     WORK1,0(CCWREG)    GET DATA ADDRESS                      62100019
         LA    WORK1,0(WORK1)     CLEAR HIGH ORDER BYTE                 62400019
         LH    WORK2,6(CCWREG)    GET BYTE COUNT                        62700019
         BCTR  WORK2,0            SUBTRACT 1                            63000019
         CLI   0(PARM1),X'0C'     IS IT HDR                             63300019
         BE    NOCLEAR            YES DO NOT CLEAR INPUT AREA           63600019
         SR    WORK1,WORK2        GET START OF I/O AREA                 63900019
         ST    WORK1,OFFSET(IOBR) SET CORRECT DATA ADDRESS IN CCW       64200019
CLEAR    EX    WORK2,CLEAREX                                            64500019
NOCLEAR  EQU   *                                                        64800019
         MVI   0(CCWREG),X'02'    SET RF OP CODE                        65100019
         L     REG8,IOBCSW(IOBR)  SAVE ADDRESS OF FAILINC CCW           65400019
         MVI   DCBOFFSR,OFFSET    POINT TO CNTRL CCW IN IOB             65700019
         L     WORK1,IOBSTADR-1(IOBR) SAVE START ADDRESS                66000019
         ST    CCWREG,IOBSTADR-1(IOBR) SET START ADDRESS                66300019
         EXCP  8(IOBR)            ISSUE COMMAND                         66600019
         WAIT  ECB=4(IOBR)        WAIT FOR COMPLETION                   66900019
         MVI   DCBOFFSR,OFFSET1   RESTORE CCW OFFSCT IN DCB             67200019
         OI    IOBFL1(IOBR),X'40' SET COMMAND CHAINING BIT ON           67500019
         ST    REG8,IOBCSW(IOBR)  RESTORE POINTER TO FAILING CCW        67800019
         ST    WORK1,IOBSTADR-1(IOBR) RESTORE START ADDRESS             68100019
         CLI   0(PARM1),X'08'     IS IT RKB                             68400019
         BNE   COUNTERS           NO QUIT                               68700019
         SR    WORK1,WORK1        CLEAR WORK                            69000019
         LH    WORK1,6(CCWREG)    GET COUNT                             69300019
         L     WORK3,0(CCWREG)    GET BUFFER ADDRESS                    69600019
         LA    WORK3,0(WORK3)     CLEAR HIGH ORDER BYTE                 69900019
         AR    WORK3,WORK2        POINT TO END OF BUFFER                70200019
         LR    CCWREG,WORK3       SAVE BUFFER ADDRESS                   70500019
         SR    WORK2,WORK2        REGISTERS                             70800019
TEST     CLI   0(WORK3),X'00'     BYTE 00                               71100019
         BNE   MOVEDATA           NO ADJUST DATA                        71400019
         BCT   WORK1,TRYAGAIN     IF MORE DATA TRY AGAIN                71700019
         B     COUNTERS           QUIT                                  72000019
TRYAGAIN BCTR  WORK3,0            DECREMENT BUFFER ADDRESS              72300019
         LA    WORK2,1(WORK2)     INCREMENT ZERO BYTE COUNTER           72600019
         B     TEST               TRY ANOTHER BYTE                      72900019
MOVEDATA EQU   *                                                        73200019
MOVE     MVC   0(1,CCWREG),0(WORK3) MOVE A BYTE                         73500019
         BCTR  CCWREG,0           DECREMENT END OF BUFFER POINTER       73800019
         BCTR  WORK3,0            DECREMENT END OF DATA POINTER         74100019
         BCT   WORK1,MOVE         IF MORE DATA,MOVE IT                  74400019
         LTR   WORK2,WORK2        ANY ZERO BYTES                        74700019
         BZ    COUNTERS           NO ALL DONE                           75000019
         LA    WORK3,1(WORK3)     POINT TO START OF BUFFER              75300019
         BCTR  WORK2,0            SUBTRACT 2 FROM COUNT                 75600019
         EX    WORK2,CLEAREX1     CLEAR INPUT AREA                      75900019
         B     COUNTERS           QUIT                                  76200019
SETHDR   L     WORK1,0(PARM1)     GET INPUT ADDRESS                     76500019
         ST    WORK1,40(IOBR)     PUT IN CCW                            76800019
         MVI   44(IOBR),X'20'     SET SLI FLAG ON                       77100019
         MVI   OFFSET+7(IOBR),X'1E' SET TO ASSUMED LENGTH               77400019
         LH    WORK1,DCBBUFL      GET BUFFER LENGTH                     77700019
         LTR   WORK1,WORK1        LENGTH SPECIFIED                      78000019
         BZ    NOBUF              NO USE ASSUMED VALUE                  78300019
         STH   WORK1,46(IOBR)     SET COUNT                             78600019
         B     NOBUF              GO READ HEADER                        78900019
CLEAREX  XC    0(1,WORK1),0(WORK1)                                      79200019
CLEAREX1 XC    0(1,WORK3),0(WORK3)                                      79500019
EIGHT    DC    H'08'                                                    79800019
IHADCB   DCBD  DSORG=PS,DEVD=OR   DCB DSECT                    @YM00635 80100002
DCBEIB   EQU   IHADCB+18                                                80400019
ERCTAR   EQU   IHADCB+4           POINTER TO DCB ERROR COUNTERS         80700019
DCBORBYT EQU   IHADCB+16                                                81000019
         END   IGG019VH                                                 81300019
./  ADD  SSI=41000074,NAME=IGG019VI
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00100002
**** END OF SPECIFICATIONS ***/                                         00150002
IGG019VI CSECT                    ENTRY POINT FOR RDLNE MODULE          00300019
         TITLE  'IGG019VI  RDLNE MODULE---(OCR)---QSAM'                 00600019
*********************************************************************** 01200019
*MODULE-NAME                                                   @YM00638 01250002
* IGG019VI                                                     @YM00638 01300002
*                                                              @YM00638 01350002
*DESCRIPTIVE-NAME                                              @YM00638 01400002
* OCR READ A LINE MODULE                                       @YM00638 01450002
*                                                              @YM00638 01500002
*COPYRIGHT                                                     @YM00638 01550002
* NONE                                                         @YM00638 01600002
*                                                              @YM00638 01650002
*CHANGE-ACTIVITY                                               @YM00638 01700002
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                01800001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                02400001
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                03000001
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                03600001
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                04200001
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                04800001
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                05400001
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                06000001
* RELEASE 28 ADDITIONS/CHANGES/DELETIONS                                06600001
*                                                                     * 07200019
*STATUS - RELEASE 20 CHANGE LEVEL 000                                 * 07800001
*                                                                     * 08400019
*FUNCTION/OPERATION - READ A JOURNAL TAPE LINE WITH ON-LINE CORRECTION* 09000019
*                                                                     * 09600019
*ENTRY POINTS - IGG019VI CSECT     CALLING SEQUENCE -                 * 10200019
*                                  LOAD DCB ADDRESS IN REGISTER 1     * 10800019
*                                  L  15,12(1) GET ADDRESS OF RDLNE   * 11400019
*                                              MODULE                 * 12000019
*                                  BALR 14,15  LINK TO RDLNE MODULE   * 12600019
*                                                                     * 13200019
*INPUT - IOB                                                          * 13800019
*         IOB+CSW-1 - ADDRESS OF FAILING CCW                          * 14400019
*        DCB                                                          * 15000019
*         DCBIOBA - IOB ADDRESS                                       * 15600019
*                                                                     * 16200019
*OUTPUT - COMPLETION CODE IN REGISTER 15                              * 16800019
*         UPDATED IOB ERROR COUNTERS                                  * 17400019
*         IF UNIT EXCEPTION OCCURS, EOF(X'40') IS POSTED IN DCBORBYT  * 18000019
*         IF ANY PERMANENT ERRORS OCCUR, THE EIB IS UPDATED           * 18600019
*                                                                     * 19200019
*EXTERNAL ROUTINES - IOS VIA EXCP                                     * 19800019
*                    ERROR COUNTER UPDATE IN SYNCH ROUTINE            * 20400019
*                    EIB UPDATE ROUTINE IN SYNCH ROUTINE              * 21000019
*                    COMPLETION CODE ROUTINE IN SYNCH ROUTINE         * 21600019
*                                                                     * 22200019
*EXITS/NORMAL - RETURN TO CALLER - BR 14                              * 22800019
*                                                                     * 23400019
*EXITS/ERROR - NONE                                                   * 24000019
*                                                                     * 24600019
*TABLES/WORK AREAS - USER SAVE AREA POINTED AT BY REGISTER 13         * 25200019
*                                                                     * 25800019
*ATRIBUTES - REENTRANT,REUSABLE,PROBLEM PROGRAM MODE                  * 26400019
*                                                                     * 27000019
*NOTES - N/A                                                          * 27600019
*                                                                     * 28200019
*********************************************************************** 28800019
*********************************************************************** 29200019
*                                                                     * 29600019
*        REGISTER EQUATES                                             * 30000019
*                                                                     * 30400019
*********************************************************************** 30800019
REG1     EQU   1                  REGISTER 1                            31200019
DCBR     EQU   2                  POINTER TO DCB                        31600019
IOBR     EQU   3                  POINTER TO IOB                        32000019
CCWADR   EQU   4                  ADDRESS OF CCW IN QUESTION            32400019
WKREG1   EQU   5                  WORK REGISTER                         32800019
WKREG2   EQU   6                  WORK REGISTER                         33200019
REG8     EQU   8                  REGISTER 8                            33600019
BASR     EQU   9                  BASE REGISTER                         34000019
REG9     EQU   9                  REGISTER 9                            34400019
SAVR     EQU   13                 ADDRESS OF SAVE AREA                  34800019
RETURN   EQU   14                 CONTAINS RETURN ADDRESS               35200019
RETCODE  EQU   15                 USED TO PASS RETURN CODE              35600019
*********************************************************************** 36000019
*                                                                     * 36400019
*        IOB EQUATES                                                  * 36800019
*                                                                     * 37200019
*********************************************************************** 37600019
ECBCODE  EQU   4                  DISPLACEMENT TO ECB CODE IN THE IOB   38000019
CSW      EQU   17                 DISPLACEMENT TO CSW IN IOB            38400019
UNEXCP   EQU   20                 DISP TO CSW STATUS IN IOB    @YA00412 38800002
IOBSTADR EQU   25                 DISPLACEMENT TO START ADDRESS IN IOB  39200019
OFFSET   EQU   40                 OFFSET TO CCW IN IOB                  39600019
CCWFLAG  EQU   44                 DISPLACEMENT TO CCW FLAGS IN IOB      40000019
BYTECNT  EQU   46                 DISPLACEMENT TO CCW BYTE COUNT IN IOB 40400019
OFFSET1  EQU   48                 CCW OFFSET IN DCB                     40800019
UNEXCPON EQU   X'01'              TEST FOR UNIT EXCEPTION               41200019
PERMERR  EQU   X'41'              TEST FOR PERMANENT ERRORS             41600019
CHAINOFF EQU   X'BF'              TURN OFF COMMAND CHAINING BIT         42000019
*********************************************************************** 42400019
*                                                                     * 42800019
*        DCB EQUATES                                                  * 43200019
*                                                                     * 43600019
*********************************************************************** 44000019
EOFON    EQU   X'40'              SET EOF IN DCBORBYT                   44400019
ERRFLOFF EQU   X'CF'              SET ERROR FLAGS IN DCB OFF            44800019
*********************************************************************** 45200019
*                                                                     * 45600019
*        SAVE AREA EQUATES                                            * 46000019
*                                                                     * 46400019
*********************************************************************** 46800019
RETSAVE  EQU   12                 DISPLACEMENT TO START OF USER SAVE    47200019
SAV12    EQU   12                 POINTER FOR SAVING REGISTERS          47600019
NORMSAVE EQU   24                 POINT TO REGS 2-9 IN SAVE AREA        48000019
*********************************************************************** 48400019
*                                                                     * 48800019
*        MISCELLANEOUS EQUATES                                        * 49200019
*                                                                     * 49600019
*********************************************************************** 50000019
RBOCOP   EQU   X'4C'              RBOC COMMAND CODE                     50400019
MOVECCW  EQU   8                  LENGTH OF CCW TO MOVE                 50800019
ACTIOB   EQU   8                  USED TO POINT TO ACTUAL IOB           51200019
ERRCNT   EQU   24                 DISPLACEMENT TO ADDRESS OF ERROR     C51600019
                                  COUNT UPDATE ROUTINE                  52000019
EIBUPDAT EQU   8                  DISPLACEMENT TO ADDRESS OF EIB UPDATEC52400019
                                  ROUTINE                               52800019
RETCD    EQU   16                 DISPLACEMENT TO ADDRESS OF RETURN    C53200019
                                  CODE POSTING ROUTINE                  53600019
         USING IGG019VI,RETCODE   ESTABLISH ADDRESSIBILITY              56400019
         USING IHADCB,DCBR        POINTER TO DCB                        57000019
         STM   RETURN,SAV12,RETSAVE(SAVR) SAVE USER REGISTERS           57600019
         LR    BASR,RETCODE       GET BASE ADDRESS                      58200019
         DROP  RETCODE            DROP BASE REGISTER                    58800019
         USING IGG019VI,BASR      ESTABLISH ADDRESSIBILITY              59400019
         LR    DCBR,REG1          GET DCB ADDRESS                       60000019
         L     IOBR,DCBIOBA       GET IOB ADDRESS FOM DCB               60600019
*********************************************************************** 60700019
* PREPARE TO ISSUE RBOC COMMAND                                       * 60800019
*********************************************************************** 60900019
         L     CCWADR,CSW-1(IOBR)  GET CCW ADDRESS                      61200019
         LA    CCWADR,0(CCWADR)   CLEAR HIGH ORDER BYTE                 61800019
         SH    CCWADR,EIGHT       BACK UP ONE CCW                       62400019
         MVC   OFFSET(MOVECCW,IOBR),0(CCWADR) MOVE CCW TO IOB+40        63000019
         NI    CCWFLAG(IOBR),CHAINOFF TURN CHAINING BIT OFF             63600019
         L     REG8,CSW-1(IOBR)   SAVE ADDRESS OF FAILING CCW           64200019
         MVI   DCBOFFSR,OFFSET    MOVE CCW OFFSET TO DCB                64800019
         LA    WKREG1,OFFSET(IOBR) GET CCW OFFSET                       65400019
         ST    WKREG1,IOBSTADR-1(IOBR) PUT CCW ADDR IN IOB START ADDR   66000019
         MVI   OFFSET(IOBR),RBOCOP SET CCW COMMAND CODE TO RBOC         66600019
         L     WKREG1,OFFSET(IOBR) GET DATA ADDRESSS                    67200019
         LH    WKREG2,BYTECNT(IOBR) GET CCW BYTE COUNT                  67800019
         BCTR  WKREG2,0           SUBTRACT ONE                          68400019
         SR    WKREG1,WKREG2      DECREMENT DATA ADDR BY BYTE COUNT     69000019
         EX    WKREG2,CLEAR1      CLEAR INPUT AREA                      69600019
         LA    REG1,ACTIOB(IOBR)  POINT TO ACTUAL IOB                   70200019
*********************************************************************** 70300019
* EXCP AND WAIT                                                       * 70400019
*********************************************************************** 70500019
         EXCP  (REG1)             ISSUE RBOC                            70800019
         WAIT  ECB=4(IOBR)       WAIT FOR COMPLETION                    71400019
         ST    REG8,CSW-1(IOBR)   RESTORE POINTER TO FAILING CCW        72000019
         MVI   DCBOFFSR,OFFSET1   RESTORE DCB OFFSET                    72600019
         LA    WKREG1,OFFSET1(IOBR) GET ORIGINAL CCW OFFSET             73200019
         ST    WKREG1,IOBSTADR-1(IOBR) PUT CCW ADDR IN IOB START ADDR   73800019
*********************************************************************** 73900019
* LINK TO COUNTER UPDATE ROUTINE IN SYNCH MODULE                        74000019
*********************************************************************** 74100019
         L     RETCODE,DCBGERR     LOAD ADDRESS OF GERR ROUTINE         74400019
         BAL   RETURN,ERRCNT(RETCODE) LINK TO COUNTER UPDATE ROUTINE    75000019
NOCOUNT  CLI   ECBCODE(IOBR),PERMERR DID ANY PERMANENT ERRORS OCCUR     75600019
         BE    ERRORS             YES TO ERROR PROCESSOR                76200019
         SR    RETCODE,RETCODE    SET RETURN CODE TO ZERO               78000019
DONE     LM    REG1,REG9,NORMSAVE(SAVR) RESTORE USER REGISTERS          78600019
         L     RETURN,RETSAVE(SAVR) RESTORE RETURN ADDRESS              79200019
         BR    RETURN             RETURN TO CALLER                      79800019
*********************************************************************** 79900019
* LINK TO SET EIB ROUTINE IN SYNCH MODULE                             * 80000019
*********************************************************************** 80100019
ERRORS   L     RETCODE,DCBGERR    GET ADDRESS OF EIB ROUTINE - 8        80400019
         BAL   RETURN,EIBUPDAT(RETCODE) LINK TO EIB ROUTINE             81000019
*********************************************************************** 81100019
* LINK TO COMPLETION CODE ROUTINE IN SYNCH MODULE                     * 81200019
*********************************************************************** 81300019
         L     RETCODE,DCBGERR    GET ADDRESS OF RETURN CODE ROUTINE-16 81600019
         BAL   RETURN,RETCD(RETCODE) LINK TO RETURN CODE ROUTINE        82200019
         TM    UNEXCP(IOBR),UNEXCPON DID UNIT EXCEPTION OCCUR           82800019
         BZ    NOUNEXCP           NO BYPASS EOF SET                     83400019
         OI    DCBORBYT,EOFON     SET EOF BIT ON                        84000019
NOUNEXCP NI    DCBIFLGS,ERRFLOFF  SET ERROR FLAGS OFF                   84600019
         B     DONE               RETURN TO USER                        85200019
EIGHT    DC    H'8'               CONSTANT OF EIGHT                     85800019
CLEAR1   XC    0(1,WKREG1),0(WKREG1) EXECUTED INSTRUCTION TO CLEAR AREA 86400019
IHADCB   DCBD  DSORG=PS,DEVD=OR   DCB DSECT                    @YM00635 87000002
         END   IGG019VI                                                 87600019
./  ADD  SSI=40650309,NAME=IGG019VJ
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00060002
**** END OF SPECIFICATIONS ***/                                         00070002
IGG019VJ CSECT                    ENTRY POINT FOR DSPLY MODULE          00100019
         TITLE 'IGG019VJ---DSPLY ROUTINE(OCR)'                          00300019
*********************************************************************** 00600019
*MODULE-NAME                                                   @YM00638 00650002
* IGG019VJ                                                     @YM00638 00700002
*                                                              @YM00638 00750002
*DESCRIPTIVE-NAME                                              @YM00638 00800002
* OCR DISPLAY MODULE                                           @YM00638 00850002
*                                                              @YM00638 00860002
*COPYRIGHT                                                     @YM00638 00870002
* NONE                                                         @YM00638 00880002
*                                                              @YM00638 00890002
*CHANGE-ACTIVITY                                               @YM00638 00892002
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                00900001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                01200001
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                01500001
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                01800001
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                02100001
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                02400001
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                02700001
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                03000001
* RELEASE 28 ADDITIONS/CHANGES/DELETIONS                                03300001
*                                                                     * 03600019
*STATUS - RELEASE 20 CHANGE LEVEL 000                                 * 03900001
*                                                                     * 04200019
*FUNCTION/OPERATION - TO DISPLAY A FIELD IN ERROR ON THE CRT          * 04500019
*                                                                     * 04800019
*ENTRY POINTS - IGG019VJ CSECT     CALLING SEQUENCE -                 * 05100019
*                                  LOAD DCB ADDRESS IN REGISTER 1     * 05400019
*                                  IF ISSUED OUTSIDE THE SYNAD ROUTINE* 05700019
*                                  THE FOLLOWING INSTRUCTIOS ARE      * 06000019
*                                  REQUIRED -                         * 06300019
*                                  L 15,68(1) GET IOB ADDRESS         * 06600019
*                                  MVC 48(16,15),0(R1) MOVE TWO LOAD  * 06900019
*                                                      FORMAT CCW'S TO* 07200019
*                                                      IOB+48         * 07500019
*                                  MVC 40(8,15),0(R2) MOVE READ CCW   * 07800019
*                                                      TO IOB+40      * 08100019
*                                  THE FOLLOWING INSTRUCTIONS ARE     * 08400019
*                                  ALWAYS REQUIRED -                  * 08700019
*                                  L 15,8(1) GET ADDRESS OF DSPLY     * 09000019
*                                            MODULE                   * 09300019
*                                  BALR 14,15 LINK TO DSPLY MODULE    * 09600019
*                                                                     * 09900019
*INPUT - IOB                                                          * 10200019
*         IOBCSW - ADDRESS OF FAILING CCW IF IN SYNAD ROUTINE         * 10500019
*        DCB                                                          * 10800019
*         DCBIOBA - ADDRESS OF THE IOB                                * 11100019
*         DCBSYNAD - ADDRESS OF THE SYNAD ROUTINE                     * 11400019
*                                                                     * 11700019
*OUTPUT - COMPLETION CODE IN REGISTER 15                              * 12000019
*         UPDATED IOB ERROR COUNTERS                                  * 12300019
*         IF UNIT EXCEPTION OCCURS, EOF(X'40') IS POSTED IN DCBORBYT  * 12600019
*         IF ANY PERMANENT ERRORS OCCUR, THE EIB IS UPDATED           * 12900019
*                                                                     * 13200019
*EXTERNAL ROUTINES - IOS VIA EXCP                                     * 13500019
*                    ERROR COUNTER UPDATE IN SYNCH ROUTINE            * 13800019
*                    EIB UPDATE ROUTINE IN SYNCH ROUTINE              * 14100019
*                    COMPLETION CODE ROUTINE IN SYNCH ROUTINE         * 14400019
*                    USER SYNAD ROUTINE                               * 14700019
*                                                                     * 15000019
*EXITS/NORMAL - RETURN TO CALLER - BR 14                              * 15300019
*                                                                     * 15600019
*EXITS/ERROR - ABEND, CODE 001    EOV 0(REG1)                         * 15900019
*                                                                     * 16200019
*TABLES/WORK AREAS - USER SAVE AREA POINTED AT BY REGISTER 13         * 16500019
*                                                                     * 16800019
*ATRIBUTES - REENTRANT,REUSABLE,PROBLEM PROGRAM MODE                  * 17100019
*                                                                     * 17400019
*NOTES - N/A                                                          * 17700019
*                                                                     * 18000019
*********************************************************************** 18300019
*********************************************************************** 18500019
*                                                                     * 18700019
*        REGISTER EQUATES                                             * 18900019
*                                                                     * 19100019
*********************************************************************** 19300019
REG0     EQU   0                  GENERAL REGISTER 0                    19500019
REG1     EQU   1                  GENERAL REGISTER 1                    19700019
DCBR     EQU   2                  ADDRESS OF THE DCB                    19900019
REG2     EQU   2                  GENERAL REGISTER 2                    20100019
IOBR     EQU   3                  ADDRESS OF THE IOB                    20300019
REG3     EQU   3                  REGISTER 3                            20500019
CCWR     EQU   4                  CCW POINTER                           20700019
WKREG1   EQU   5                  WORK REGISTER                         20900019
WKREG2   EQU   6                  WORK REGISTER                         21100019
WKREG3   EQU   7                  WORK REGISTER                         21300019
REG8     EQU   8                  WORK REGISTER                         21500019
REG9     EQU   9                  GENERAL REGISTER 9                    21700019
BASER    EQU   9                  BASE REGISTER                         21900019
SAVR     EQU   13                 ADDRESS OF SAVE AREA                  22100019
BACK     EQU   14                 USER RETURN ADDRESS                   22300019
RETCODE  EQU   15                 USED TO PASS RETURN CODE              22500019
*********************************************************************** 22700019
*                                                                     * 22900019
*        IOB EQUATES                                                  * 23100019
*                                                                     * 23300019
*********************************************************************** 23500019
IOBSTUS  EQU   3                  DISPLACEMENT TO IOB STATUS            23700019
IOBFLGS  EQU   8                  OFFSET TO IOBFLGS IN THE IOB          23900019
ECBADR   EQU   12                 OFFSET OF ECB ADDRESS IN IOB          24100019
IOBCSW   EQU   17                 DISPLACEMENT TO CSW IN IOB            24300019
DATADR   EQU   0                  DATA ADDRESS OFFSET IN CSW            24500019
STRTADR  EQU   24                 DISPLACEMENT TO IOB START ADDRESS     24700019
OFFSET1  EQU   40                 OFFSET OF FIRST CCW                   24900019
OFFSET2  EQU   48                 OFFSET OF SECOND CCW                  25100019
OFFSET3  EQU   56                 OFFSET OF THIRD CCW                   25300019
UNEXCP   EQU   X'01'              TEST UNIT EXCEPTION BIT               25500019
PERR     EQU   X'41'              TEST FOR PERM ERROR IN ECB            25700019
CCFLGON  EQU   X'40'              SET COMM CHAIN BIT ON IN IOBFLGS      25900019
CCFLGOFF EQU   X'BF'              SET COMM CHAIN BIT OFF IN IOBFLGS     26100019
*********************************************************************** 26300019
*                                                                     * 26500019
*        DCB EQUATES                                                  * 26700019
*                                                                     * 26900019
*********************************************************************** 27100019
SNBITOFF EQU   X'7F'              SET SYNAD IN PROCESS BIT OFF          27300019
SYNADBIT EQU   X'80'              SET SYNAD IN PROCESS BIT OF           27500019
PSYNAD   EQU   1                  TEST FOR PRESENCE OF SYNAD ROUTINE    27700019
HEOPTCD  EQU   X'10'              TEST FOR HOPPER EMPTY EXIT REQUEST    27900019
HPREMPTY EQU   X'02'              TEST HOPPER EMPTY IN EIB              28100019
ERROFF   EQU   X'3F'              TURN ERROR FLAGS OFF IN DCBIFLGS      28300019
EOF      EQU   X'40'              SET EOF BIT IN DCBORBYT               28500019
*********************************************************************** 28700019
*                                                                     * 28900019
*        DECB EQUATES                                                 * 29100019
*                                                                     * 29300019
*********************************************************************** 29500019
XDECB    EQU   48                 OFFSET OF DECB                        29700019
XLNGTYP  EQU   52                 OFFSET OF LENGTH AND TYPE             29900019
XDCBADR  EQU   56                 OFFSET OF DCB ADDRESS                 30100019
XCCWADR  EQU   60                 OFFSET OF CCW ADDRESS                 30300019
XIOBADR  EQU   64                 OFFSET OF IOB ADDRESS                 30500019
*********************************************************************** 30700019
*                                                                     * 30900019
*        CCW EQUATES                                                  * 31100019
*                                                                     * 31300019
*********************************************************************** 31500019
CCWFLAGS EQU   4                  DISPLACEMENT TO FLAGS IN CCW          31700019
COUNT    EQU   6                  OFFSET OF COUNT FIELD IN A CCW        31900019
RDFWDCC  EQU   X'02'              READ FORWARD COMMAND CODE             32100019
CCON     EQU   X'40'              SET COMMAND CHAINING BIT ON           32300019
CCOFF    EQU   X'BF'              SET COMMAND CHAINING BIT OFF          32500019
RBCOMM   EQU   X'0C'              READ BACKWARD COMMAND                 32700019
*********************************************************************** 32900019
*                                                                     * 33100019
*        SAVE AREA EQUATES                                            * 33300019
*                                                                     * 33500019
*********************************************************************** 33700019
USERSAVE EQU   12                 DISPLACEMENT IN SAVE AREA FOR REGS    33900019
SAVE39   EQU   16                 SAVE AREA POINTER FOR REGISTERS 3-9   34100019
RETSAVE  EQU   44                 DISPLACEMENT TO RETURN ADDRESS SAVE   34300019
SAVE9    EQU   68                 SAVE AREA POINTER FOR REGISTER 9      34500019
DCBSAVE  EQU   68                 DISPLACEMENT TO DCB ADDRESS SAVE AREA 34700019
*********************************************************************** 34900019
*                                                                     * 35100019
*        MISCELLANEOUS EQUATES                                        * 35300019
*                                                                     * 35500019
*********************************************************************** 35700019
ECBLEN   EQU   4                  LENGTH OF ECB TO MOVE                 35900019
CCRTN    EQU   16                 DISPLACEMENT TO COMP CODE RTN         36100019
EIBRTN   EQU   8                  DISPLACEMENT TO ADDR OF EIB UPDATE    36300019
UPERRCT  EQU   24                 DISPLACEMENT TO ADDR OF ERROR COUNT   36500019
ACTIOB   EQU   8                  POINT TO ACTUAL IOB                   36700019
CNTRLB   EQU   X'20'              SET CNTRL BIT FOR SYNAD REGISTER      36900019
ZERO     EQU   0                  ZERO A BYTE                           37100019
SHIFTHI  EQU   24                 SHIFT COUNT                           37300019
LNTYPLEN EQU   4                  LENGTH OF LENGTH AND TYPE TO MOVE     37500019
CCWMOVE  EQU   8                  LENGTH OF CCW TO MOVE                 37700019
TWELVE   EQU   12                 SHIFT COUNT TO SET ABEND COMP CODE    37900019
ONE      EQU   1                  ABEND COMPLETION CODE                 38100019
         USING IGG019VJ,RETCODE   ESTABLISH TEMP BASE REG               40200019
         USING IHADCB,DCBR        ESTABLISH DCB REG                     40500019
         STM   REG2,REG9,USERSAVE(SAVR) SAVE USER REGISTERS             40800019
         ST    BACK,RETSAVE(SAVR) SAVE RETURN ADDRESS                   41100019
         LR    BASER,RETCODE      LOAD NEW BASE REGISTER                41400019
         DROP  RETCODE                                                  41700019
         USING IGG019VJ,BASER     ESTABLISH PERM BASE REG               42000019
         LR    DCBR,REG1          LOAD DCB REGISTER                     42300019
         L     IOBR,DCBIOBA       LOAD IOB ADDRESS                      42600019
         TM    DCBORBYT,SYNADBIT  TEST IF IN SYNAD ROUTINE              42900019
         BZ    NOTINSYN           BRANCH IF NOT IN SYNAD                43200019
*********************************************************************** 43500019
*                                                                       43800019
*        THIS CODE EXECUTED IF DSPLY IS ISSUED IN THE SYNAD ROUTINE     44100019
*                                                                       44400019
*********************************************************************** 44700019
         L     CCWR,IOBCSW-1(IOBR) GET CCW ADDRESS                      45000019
         LA    CCWR,0(CCWR)       CLEAR HIGH ORDER BYTE                 45300019
         SH    CCWR,EIGHT         BACK UP BY 8                          45600019
         MVC   OFFSET1(CCWMOVE,IOBR),0(CCWR) MOVE CCW TO IOB+40         45900019
         NI    OFFSET1+CCWFLAGS(IOBR),CCOFF TURN COMMAND CHAINING OFF   46200019
         LA    CCWR,OFFSET1(IOBR) LOAD ADDRESS OF READ COMMAND          46500019
         NI    IOBFLGS(IOBR),CCFLGOFF TURN COMM CHAIN BIT OF IN IOBFLGS 46800019
         B     RDREADY            GO GET READY TO READ                  47100019
*********************************************************************** 47400019
*                                                                       47700019
*        THIS CODE EXECUTED IF DSPLY IS NOT ISSUED IN THE SYNAD ROUTINE 48000019
*                                                                       48300019
*********************************************************************** 48600019
NOTINSYN OI    OFFSET1+CCWFLAGS(IOBR),CCON SET COMMAND CHAINING IN CCW1 48900019
         OI    OFFSET2+CCWFLAGS(IOBR),CCON SET COMMAND CHAINING IN CCW2 49200019
         NI    OFFSET3+CCWFLAGS(IOBR),CCOFF COMMAND CHAIN OFF IN CCW 3  49500019
         LA    CCWR,OFFSET3(IOBR) LOAD ADDRESS OF READ COMMAND          49800019
*********************************************************************** 50100019
*                                                                       50400019
*        THIS CODE EXECUTED WHENEVER DSPLY IS ISSUED                    50700019
*                                                                       51000019
*********************************************************************** 51300019
RDREADY  L     WKREG1,DATADR(CCWR) GET DATA ADDRESS                     51600019
         LA    WKREG1,0(WKREG1)   CLEAR HIGH ORDER BYTE                 51900019
         LH    WKREG2,COUNT(CCWR) LOAD COUNT FROM CCW                   52200019
         BCTR  WKREG2,0           DECREMENT COUNT BY 1                  52500019
         TM    0(CCWR),RBCOMM     IS COMMAND A READ BACKWARD            52800019
         BNO   RDFWD              NO DON'T ADJUST I/O AREA ADDRESS      53100019
         SR    WKREG1,WKREG2      ADJUST I/O AREA ADDRESS               53400019
         ST    WKREG1,DATADR(CCWR) SET CORRECT ADDRESS IN CCW           53700019
RDFWD    EX    WKREG2,CLEAR       CLEAR I/O AREA                        54000019
         L     WKREG3,STRTADR(IOBR) SAVE IOB START ADDRESS              54300019
         LA    WKREG2,OFFSET1(IOBR) LOAD CHANNEL PROG START ADDR        54600019
         ST    WKREG2,STRTADR(IOBR) SET NEW IOB START ADDRESS           54900019
         MVI   0(CCWR),RDFWDCC    SET READ FORWARD COMMAND              55200019
         NI    DCBIFLGS,ERROFF    TURN ERROR FLAGS OFF                  55500019
         L     REG8,IOBCSW-1(IOBR) SAVE FAILING CCW ADDRESS             55800019
*********************************************************************** 56100019
*                                                                       56400019
*        EXECUTE CHANNEL PROGRAM AND WAIT                               56700019
*                                                                       57000019
*********************************************************************** 57300019
         EXCP  ACTIOB(IOBR)       EXECUTE THE CHANNEL PROGRAM           57600019
         L     REG1,ECBADR(IOBR)  LOAD ECB ADDRESS                      57900019
         WAIT  ECB=(REG1)         WAIT FOR EVENT TO COMPLETE            58200019
         ST    REG8,IOBCSW-1(IOBR) RESTORE FAILING CCW ADDRESS          58500019
         ST    WKREG3,STRTADR(IOBR) RESTORE START ADDRESS               58800019
         OI    IOBFLGS(IOBR),CCFLGON  TURN COMM CHAIN BIT ON IN IOBFLGS 59100019
*********************************************************************** 59400019
*                                                                       59700019
*        BRANCH AND LINK TO ERROR COUNTER ROUTINE                       60000019
*                                                                       60300019
*********************************************************************** 60600019
         L     RETCODE,DCBCHECK   LOAD ADDRESS OF CHECK ROUTINE         60900019
         BAL   BACK,UPERRCT(RETCODE) LINK TO UPDATE ROUTINT             61200019
*********************************************************************** 61500019
         SR    RETCODE,RETCODE    SET RETURN CODE TO ZERO               61800019
         L     REG1,ECBADR(IOBR)  LOAD ECB ADDRESS                      62100019
         CLI   0(REG1),PERR       DID ANY PERMANENT ERRORS OCCUR        62400019
         BNE   NOERRORS           NO RETURN TO USER                     63300019
*********************************************************************** 64200019
*                                                                       64500019
*        BRANCH AND LINK TO SET ERROR INDICATOR BYTE ROUTINE            64800019
*                                                                       65100019
*********************************************************************** 65400019
ERRORS   L     RETCODE,DCBCHECK   LOAD ADDRESS OF CHECK ROUTINE         65700019
         BAL   BACK,EIBRTN(RETCODE) LINK TO EIB ROUTINE                 66000019
*********************************************************************** 66300019
*                                                                       66600019
*        BRANCH AND LINK TO SET COMPLETION CODE ROUTINE                 66900019
*                                                                       67200019
*********************************************************************** 67500019
         L     RETCODE,DCBCHECK   LOAD ADDRESS OF THE CHECK ROUTINE     67800019
         BAL   BACK,CCRTN(RETCODE) LINK TO CONDITION CODE ROUTINE       68100019
*********************************************************************** 68400019
         TM    IOBCSW+IOBSTUS(IOBR),UNEXCP DID UNIT EXCEPTION OCCUR     68700019
         BO    DONE               YES RETURN TO USER                    69000019
SYNADCK  TM    DCBORBYT,SYNADBIT  IS SYNAD ROUTINE IN CONTROL           69300019
         BO    NOERRORS           YES RETURN TO USER                    69600019
         TM    DCBSYNAD+3,PSYNAD  SYNAD ROUTINE PRESENT                 69900019
         BZ    SYNPROC            YES PROCESS FOR SYNAD                 70200019
         LA    REG0,ONE           SET COMPLETION CODE TO 1              70400019
         SLL   REG0,TWELVE        ADJUST FOR EOV                        70600019
         LR    REG1,DCBR          SET REG1 TO DCB ADDRESS               70800019
         EOV   0(REG1)            GO TO EOV TO ABEND                    71100019
*********************************************************************** 71400019
*                                                                       71700019
*        RETURN TO THE USER                                             72000019
*                                                                       72300019
*********************************************************************** 72600019
DONE     OI    DCBORBYT,EOF       POST EOF IN DCB                       72900019
NOERRORS NI    DCBIFLGS,ERROFF    SET DCB ERROR FLAGS OFF               73200019
         LM    REG2,REG9,USERSAVE(SAVR) RESTORE USER REGISTERS          73500019
         L     BACK,RETSAVE(SAVR) RESTORE RETURN ADDRESS                73800019
         BR    BACK               RETURN TO USER                        74100019
SYNPROC  TM    DCBEIB,HPREMPTY    HOPPER EMPTY PRESENT                  74400019
         BZ    HPRFULL            NO                                    74700019
         TM    DCBOPTCD,HEOPTCD   HOPPER EMPTY EXIT SPECIFIED           75000019
         BZ    NOERRORS           NO RETURN TO USER                     75300019
*********************************************************************** 75600019
*                                                                       75900019
*        GO TO THE USER'S SYNAD ROUTINE                                 76200019
*                                                                       76500019
*********************************************************************** 76800019
HPRFULL  L     WKREG1,ECBADR(IOBR) LOAD ECB ADDRESS                     77100019
         MVC   XDECB(ECBLEN,SAVR),0(WKREG1) MOVE ECB TO DECB            77400019
         STC   RETCODE,DCBEIB+1    SAVE RETURN CODE                     77700019
         MVC   XLNGTYP(LNTYPLEN,SAVR),LNGTYP MOVE LENGTH & TYPE TO DECB 78000019
         LA    WKREG2,OFFSET1(IOBR) LOAD ADDRESS OF CHANNEL PROGRAM     78300019
         ST    WKREG2,XCCWADR(SAVR) STORE CCW ADDRESS TO DECB           78600019
         ST    DCBR,XDCBADR(SAVR) STORE DCB ADDRESS TO DECB             78900019
         ST    IOBR,XIOBADR(SAVR) STORE IOB ADDRESS TO DECB             79200019
         LA    REG0,XDECB(SAVR)   GET DECB ADDRESS IN REG0              79500019
         LA    REG1,CNTRLB        SET CNTRL BIT ON IN REG1              79800019
         SLL   REG1,SHIFTHI       SHIFT BIT TI HIGH ORDER BYTE          80100019
         OR    REG1,DCBR          DCB ADDRESS TO REG1                   80400019
         NI    DCBIFLGS,ERROFF    TURN ERROR FLAGS OFF                  80700019
         OI    DCBORBYT,SYNADBIT  TURN SYNAD BIT ON                     81000019
         L     RETCODE,DCBSYNAD   LOAD ADDRESS OF SYNAD ROUTINE         81300019
         ST    REG9,SAVE9(SAVR)   SAVE REGISTER 9                       81600019
         LM    REG2,REG9,USERSAVE(SAVR) RESTORE USER REGISTERS          81900019
         ST    REG1,USERSAVE(SAVR) SAVE DCB ADDRESS                     82200019
         BALR  BACK,RETCODE       BRANCH AND LINK TO USER SYNAD RTN     82500019
         STM   REG3,REG9,SAVE39(SAVR) SAVE USER REGISTERS               82800019
         L     REG9,SAVE9(SAVR)   RESTORE REGISTER 9                    83100019
         L     REG3,USERSAVE(SAVR) GEF DCB ADDRESS                      83400019
         ST    REG2,USERSAVE(SAVR) SAVE USER REGISTER 2                 83700019
         LR    DCBR,REG3          RESTORE DCB POINTER                   84000019
         NI    DCBIFLGS,ERROFF    TURN OFF ERROR FLAGS                  84300019
         NI    DCBORBYT,SNBITOFF  TURN OFF SYNAD BIT                    84600019
         LTR   RETCODE,RETCODE    TEST IF ADDRESS IS SPECIFIED          84900019
         BZ    LODRETCD           RESTORE RETURN CODE IF ZERO           85200019
         NI    DCBORBYT,ZERO      RESET OCR FLAGS                       85500019
         LM    REG2,REG9,USERSAVE(SAVR) RESTORE USER REGISTERS          85800019
         BR    RETCODE            BRANCH TO SPECIFIED ADDRESS           86100019
LODRETCD IC    RETCODE,DCBEIB+1   RESTORE RETURN CODE                   86400019
         MVI   DCBEIB+1,ZERO      CLEAR RETURN CODE SAVE AREA           86700019
         B     NOERRORS           RETURN TO USER                        87000019
CLEAR    XC    0(1,WKREG1),0(WKREG1) EXECUTED INSTRUCTION TO CLEAR AREA 87300019
EIGHT    DC    H'8'               HALF WORD CONSTANT                    87600019
LNGTYP   DC    X'00008000'        LENGTH AND TYPE                       87900019
IHADCB   DCBD  DSORG=PS,DEVD=OR   DCB DSECT                    @YM00635 88200002
         END                                                            88500019
./  ADD  SSI=40650313,NAME=IGG019VK
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00060002
**** END OF SPECIFICATIONS ***/                                         00070002
IGG019VK CSECT                    ENTRY PINT FOR RESCN MODULE           00100019
         TITLE 'IGG019VK---RESCN ROUTINE,OCR'                           00200019
*********************************************************************** 00400019
*MODULE-NAME                                                   @YM00638 00450002
* IGG019VK                                                     @YM00638 00500002
*                                                              @YM00638 00550002
*DESCRIPTIVE-NAME                                              @YM00638 00560002
* OCR RESCAN MODULE                                            @YM00638 00570002
*                                                              @YM00638 00580002
*COPYRIGHT                                                     @YM00638 00590002
* NONE                                                         @YM00638 00592002
*                                                              @YM00638 00594002
*CHANGE-ACTIVITY                                               @YM00638 00596002
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                00600001
*D408000,522000,524000,526000                                    A33939 00660001
*A252000,262000,406500-409000                                    A33939 00720001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                00800001
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                01000001
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                01200001
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                01400001
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                01600001
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                01800001
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                02000001
* RELEASE 28 ADDITIONS/CHANGES/DELETIONS                                02200001
*                                                                     * 02400019
*STATUS - RELEASE 20 CHANGE LEVEL 001                                 * 02600001
*                                                                     * 02800019
*FUNCTION/OPERATION - TO PROVIDE THE USER WITH THE ABILITY TO REREAD A* 03000019
*                      FIELD IN ERROR UP TO 9 TIMES. IF THE FIELD CAN * 03200019
*                      NOT BE SUCCESSFULLY READ, A READ WITH ON-LINE  * 03400019
*                      CORRECTION MAY BE CALLED FOR BY THE USER.      * 03600019
*                                                                     * 03800019
*ENTRY POINTS - IGG019VK CSECT     CALLING SEQUENCE -                 * 04000019
*                                  LOAD DCB ADDRESS IN REGISTER 1     * 04200019
*                                  IF ISSUED OUTSIDE THE SYNAD ROUTINE* 04400019
*                                  THE FOLLOWING INSTRUCTIOS ARE      * 04600019
*                                  REQUIRED -                         * 04800019
*                                  L 15,68(1) GET IOB ADDRESS         * 05000019
*                                  MVC 48(16,15),0(R1) MOVE TWO LOAD  * 05200019
*                                                      FORMAT CCW'S TO* 05400019
*                                                      IOB+48         * 05600019
*                                  MVC 40(8,15),0(R2) MOVE READ CCW   * 05800019
*                                                      TO IOB+40      * 06000019
*                                  THE FOLLOWING INSTRUCTIONS ARE     * 06200019
*                                  ALWAYS REQUIRED -                  * 06400019
*                                  LA 0,X'0N' RETRY N TIMES           * 06600019
*                                 OR                                  * 06800019
*                                  LA 0,X'FN' RETRY N TIMES, THEN FORC* 07000019
*                                             ON-LINE CORRECTION      * 07200019
*                                  L 15,12(1) GET ADDRESS OF RESCN    * 07400019
*                                             MODULE                  * 07600019
*                                  BALR 14,15 LINK TO RESCN MODULE    * 07800019
*                                                                     * 08000019
*INPUT - IOB                                                          * 08200019
*         IOBCSW - ADDRESS OF FAILING CCW IF IN SYNAD ROUTINE         * 08400019
*        DCB                                                          * 08600019
*         DCBIOBA - ADDRESS OF THE IOB                                * 08800019
*         DCBSYNAD - ADDRESS OF THE SYNAD ROUTINE                     * 09000019
*OUTPUT - COMPLETION CODE IN REGISTER 15                              * 09200019
*         UPDATED IOB ERROR COUNTERS                                  * 09400019
*         IF UNIT EXCEPTION OCCURS, EOF(X'40') IS POSTED IN DCBORBYT  * 09600019
*         IF ANY PERMANENT ERRORS OCCUR, THE EIB IS UPDATED           * 09800019
*                                                                     * 10000019
*EXTERNAL ROUTINES - IOS VIA EXCP                                     * 10200019
*                    ERROR COUNTER UPDATE IN SYNCH ROUTINE            * 10400019
*                    EIB UPDATE ROUTINE IN SYNCH ROUTINE              * 10600019
*                    COMPLETION CODE ROUTINE IN SYNCH ROUTINE         * 10800019
*                    USER SYNAD ROUTINE                               * 11000019
*                                                                     * 11200019
*EXITS/NORMAL - RETURN TO CALLER - BR 14                              * 11400019
*                                                                     * 11600019
*EXITS/ERROR - ABEND, CODE 001    EOV 0(REG1)                         * 11800019
*                                                                     * 12000019
*TABLES/WORK AREAS - USER SAVE AREA POINTED AT BY REGISTER 13         * 12200019
*                                                                     * 12400019
*ATRIBUTES - REENTRANT,REUSABLE,PROBLEM PROGRAM MODE                  * 12600019
*                                                                     * 12800019
*NOTES - N/A                                                          * 13000019
*                                                                     * 13200019
*********************************************************************** 13400019
*********************************************************************** 13500019
*                                                                     * 13600019
*        REGISTER EQUATES                                             * 13700019
*                                                                     * 13800019
*********************************************************************** 13900019
REG0     EQU   0                  GENERAL REGISTER 0                    14000019
NUMF     EQU   0                  PARAMETER PESSER                      14100019
REG1     EQU   1                  GENERAL REGISTER 1                    14200019
DCBR     EQU   2                  ADDRESS OF THE DCB                    14300019
REG2     EQU   2                  GENERAL REGISTER 2                    14400019
IOBR     EQU   3                  ADDRESS OF THE IOB                    14500019
REG3     EQU   3                  REGISTER 3                            14600019
CCWR     EQU   4                  CCW POINTER                           14700019
WKREG1   EQU   5                  WORK REGISTER                         14800019
WKREG2   EQU   6                  WORK REGISTER                         14900019
WKREG3   EQU   7                  WORK REGISTER                         15000019
PARM1    EQU   7                  HOLD POSSIBLE PASSED 'F'              15100019
PARM2    EQU   8                  RETRY COUNTER                         15200019
REG8     EQU   8                  WORK REGISTER                         15300019
REG9     EQU   9                  GENERAL REGISTER 9                    15400019
BASER    EQU   9                  BASE REGISTER                         15500019
SAVR     EQU   13                 ADDRESS OF SAVE AREA                  15600019
BACK     EQU   14                 USER RETURN ADDRESS                   15700019
RETCODE  EQU   15                 USED TO PASS RETURN CODE              15800019
*********************************************************************** 15900019
*                                                                     * 16000019
*        IOB EQUATES                                                  * 16100019
*                                                                     * 16200019
*********************************************************************** 16300019
IOBSTUS  EQU   3                  DISPLACEMENT TO IOB STATUS            16400019
IOBFLGS  EQU   8                  OFFSET TO IOBFLGS IN THE IOB          16500019
ECBADR   EQU   12                 OFFSET OF ECB ADDRESS IN IOB          16600019
IOBCSW   EQU   17                 DISPLACEMENT TO CSW IN IOB            16700019
DATADR   EQU   0                  DATA ADDRESS OFFSET IN CSW            16800019
STRTADR  EQU   24                 DISPLACEMENT TO IOB START ADDRESS     16900019
OFFSET1  EQU   40                 OFFSET OF FIRST CCW                   17000019
OFFSET2  EQU   48                 OFFSET OF SECOND CCW                  17100019
OFFSET3  EQU   56                 OFFSET OF THIRD CCW                   17200019
PERR     EQU   X'41'              TEST FOR PERM ERROR IN ECB            17300019
UNEXCP   EQU   X'01'              TEST UNIT EXCEPTION BIT               17400019
CCFLGON  EQU   X'40'              SET COMM CHAIN BIT ON IN IOBFLGS      17500019
CCFLGOFF EQU   X'BF'              SET COMM CHAIN BIT OFF IN IOBFLGS     17600019
*********************************************************************** 17700019
*                                                                     * 17800019
*        DCB EQUATES                                                  * 17900019
*                                                                     * 18000019
*********************************************************************** 18100019
SNBITOFF EQU   X'7F'              SET SYNAD IN PROCESS BIT OFF          18200019
SYNADBIT EQU   X'80'              SET SYNAD IN PROCESS BIT OF           18300019
PSYNAD   EQU   1                  TEST FOR PRESENCE OF SYNAD ROUTINE    18400019
HEOPTCD  EQU   X'10'              TEST FOR HOPPER EMPTY EXIT REQUEST    18500019
HPREMPTY EQU   X'02'              TEST HOPPER EMPTY IN EIB              18600019
ERROFF   EQU   X'3F'              TURN ERROR FLAGS OFF IN DCBIFLGS      18700019
EOF      EQU   X'40'              SET EOF BIT IN DCBORBYT               18800019
*********************************************************************** 18900019
*                                                                     * 19000019
*        DECB EQUATES                                                 * 19100019
*                                                                     * 19200019
*********************************************************************** 19300019
XDECB    EQU   48                 OFFSET OF DECB                        19400019
XLNGTYP  EQU   52                 OFFSET OF LENGTH AND TYPE             19500019
XDCBADR  EQU   56                 OFFSET OF DCB ADDRESS                 19600019
XCCWADR  EQU   60                 OFFSET OF CCW ADDRESS                 19700019
XIOBADR  EQU   64                 OFFSET OF IOB ADDRESS                 19800019
*********************************************************************** 19900019
*                                                                     * 20000019
*        CCW EQUATES                                                  * 20100019
*                                                                     * 20200019
*********************************************************************** 20300019
COUNT    EQU   6                  OFFSET OF COUNT FIELD IN A CCW        20400019
CCWFLAGS EQU   4                  DISPLACEMENT TO CCW FLAGS             20500019
RBCOMM   EQU   X'0C'              READ BACKWARD COMMAND                 20600019
CCOFF    EQU   X'BF'              SET COMMAND CHAINING BIT OFF          20700019
CCON     EQU   X'40'              SET COMMAND CHAINING BIT ON           20800019
RBDCOC   EQU   X'6C'              RBDCOC COMMAND CODE                   20900019
*********************************************************************** 21000019
*                                                                     * 21100019
*        SAVE AREA EQUATES                                            * 21200019
*                                                                     * 21300019
*********************************************************************** 21400019
USERSAVE EQU   12                 DISPLACEMENT TO REGISTERS IN SAVE     21500019
SAVE39   EQU   16                 SAVE AREA POINTER FOR REGISTERS 3-9   21600019
RETSAVE  EQU   44                 DISPLACEMENT TO RETURN ADDRESS SAVE   21700019
PARMSAVE EQU   48                 PARAMETER SAVE AREA                   21800019
FSAVE    EQU   48                 F SAVE AREA                           21900019
RETRYSAV EQU   52                 RETRY SAVE AREA                       22000019
DCBSAVE  EQU   68                 DCB ADDRESS SAVE AREA                 22100019
SAVE9    EQU   68                 SAVE AREA POINTER FOR REGISTER 9      22200019
*********************************************************************** 22300019
*                                                                     * 22400019
*        MISCELLANEOUS EQUATES                                        * 22500019
*                                                                     * 22600019
*********************************************************************** 22700019
CNTRLB   EQU   X'20'              SET CNTRL BIT FOR SYNAD REGISTER      22800019
ZERO     EQU   0                  ZERO A BYTE                           22900019
SHIFTHI  EQU   24                 SHIFT COUNT FOR HIGH ORDER BYTE SHIFT 23000019
LNTYPLEN EQU   4                  LENGTH OF LENGTH & TYPE TO MOVE       23100019
ECBMOVE  EQU   4                  LENGTH TO MOVE FOR ECB                23200019
CCRTN    EQU   16                 DISPLACEMENT TO CONDITION CODE RTN    23300019
EIBRTN   EQU   8                  DISPLACEMENT TO EIB ROUTINE ADDRESS   23400019
FORCECNT EQU   X'02'              FORCE AN EXCP FOR OLC                 23500019
ERRCTADR EQU   24                 DISPLACEMENT TO ADDR OF COUNTER RTN   23600019
ACTIOB   EQU   8                  POINT TO ACTUAL IOB                   23700019
NELIM    EQU   X'F0'              SAVE F                                23800019
FELIM    EQU   X'0F'              SAVE NUMBER OF RETRIES                23900019
CCWMOVE  EQU   8                  LENGTH OF CCW TO MOVE                 24000019
TWELVE   EQU   12                 SHIFT COUNT TO SET ABEND COMP CODE    24100019
ONE      EQU   1                  ABEND COMPLETION CODE                 24200019
RETRYEND EQU   X'01'              TEST FOR END OF RETRY REQUESTS A33939 25200001
ONLINE   EQU   X'F0'              TEST FOR ON-LINE CORRECTION    A33939 26200001
         USING IGG019VK,RETCODE   ESTABLISH TEMP BASE REG               30000019
         USING IHADCB,DCBR        ESTABLISH DCB REG                     30200019
         STM   REG2,REG9,USERSAVE(SAVR) SAVE USER REGISTERS             30400019
         ST    BACK,RETSAVE(SAVR) SAVE RETURN ADDRESS                   30600019
         LR    BASER,RETCODE      LOAD NEW BASE REGISTER                30800019
         DROP  RETCODE                                                  31000019
         USING IGG019VK,BASER     ESTABLISH AXDRESSIBILITY              31200019
         LR    DCBR,REG1          LOAD DCB REGISTER                     31400019
         L     IOBR,DCBIOBA       LOAD IOB ADDRESS                      31600019
         LR    PARM1,NUMF         SAVE PASSED PARAMETER                 31800019
         LR    PARM2,NUMF         SAVE PASSED PARAMETER                 32000019
         LA    WKREG1,FELIM       GET F ELIMINATOR                      32200019
         NR    PARM2,WKREG1       LEAVE ONLY NUMBER OF RETRIES          32400019
         LA    WKREG1,NELIM       GET NUMBER ELIMINATOR                 32600019
         NR    PARM1,WKREG1       LEAVE ONLY POSSIBLE FORCE             32800019
         LA    PARM2,1(PARM2)     BUMP COUNT BY ONE                     33000019
         STM   PARM1,PARM2,PARMSAVE(SAVR) SAVE PASSED PARAMETERS        33200019
         TM    DCBORBYT,SYNADBIT  TEST IF IN SYNAD ROUTINE              33400019
         BZ    NOTINSYN           BRANCH IF NOT IN SYNAD                33600019
*********************************************************************** 33800019
*                                                                       34000019
*        THIS CODE EXECUTED IF RESCN IS ISSUED IN THE SYNAD ROUTINE     34200019
*                                                                       34400019
*********************************************************************** 34600019
         L     CCWR,IOBCSW-1(IOBR) GET CCW ADDRESS                      34800019
         LA    CCWR,0(CCWR)       CLEAR HIGH ORDER BYTE                 35000019
         SH    CCWR,EIGHT         BACK UP BY 8                          35200019
         MVC   OFFSET1(CCWMOVE,IOBR),0(CCWR) MOVE CCW TO IOB + 40       35400019
         NI    OFFSET1+CCWFLAGS(IOBR),CCOFF SET COMMAND CHAONING OFF    35600019
         LA    CCWR,OFFSET1(IOBR) LOAD ADDRESS OF READ COMMAND          35800019
         NI    IOBFLGS(IOBR),CCFLGOFF TURN COMM CHAIN BIT OF IN IOBFLGS 36000019
         B     RDREADY            GO GET READY TO READ                  36200019
*********************************************************************** 36400019
*                                                                       36600019
*        THIS CODE EXECUTED IF RESCN IS NOT ISSUED IN THE SYNAD ROUTINE 36800019
*                                                                       37000019
*********************************************************************** 37200019
NOTINSYN OI    OFFSET1+CCWFLAGS(IOBR),CCON SET COMMAND CHAINING ON IN   37400019
*                                          CCW 1                        37600019
         OI    OFFSET2+CCWFLAGS(IOBR),CCON SET CHAINING ON IN CCW 2     37800019
         NI    OFFSET3+CCWFLAGS(IOBR),CCOFF SET CHAINING OFF IN CCW 3   38000019
         LA    CCWR,OFFSET3(IOBR) LOAD ADDRESS OF READ COMMAND          38200019
*********************************************************************** 38400019
*                                                                       38600019
*        THIS CODE EXECUTED WHENEVER RESCN IS ISSUED                    38800019
*                                                                       39000019
*********************************************************************** 39200019
RDREADY  L     WKREG1,DATADR(CCWR) GET DATA ADDRESS                     39400019
         LA    WKREG1,0(WKREG1)   CLEAR HIGH ORDER BYTE                 39600019
         LH    WKREG2,COUNT(CCWR) LOAD COUNT FROM CCW                   39800019
         BCTR  WKREG2,0           DECREMENT COUNT BY 1                  40000019
         TM    0(CCWR),RBCOMM     IS COMMAND A READ BACKWARD            40200019
         BNO   RDFWD              NO DON'T ADJUST I/O AREA ADDRESS      40400019
         SR    WKREG1,WKREG2      ADJUST I/O AREA ADDRESS               40600019
RDFWD    EQU   *                                                 A33939 40650001
         CLI   FSAVE+3(SAVR),ONLINE IS THERE ONLINE CORRECTION   A33939 40700001
         BE    EXCLEAR              YES, CLEAR I/O AREA          A33939 40750001
         CLI   RETRYSAV+3(SAVR),RETRYEND ARE ALL RETRIES DONE    A33939 40800001
         BE    GOTOEIB              YES, GO TO EIB ROUTINE       A33939 40850001
EXCLEAR  EX    WKREG2,CLEAR         CLEAR I/O AREA               A33939 40900001
CPSRTADR EQU   *                                                        41000019
         L     WKREG3,STRTADR(IOBR) SAVE IOB START ADDRESS              41200019
         LA    WKREG2,OFFSET1(IOBR) LOAD CHANNEL PROG START ADDR        41400019
         ST    WKREG2,STRTADR(IOBR) SET NEW IOB START ADDRESS           41600019
         NI    DCBIFLGS,ERROFF    TURN ERROR FLAGS OFF                  41800019
         L     PARM2,RETRYSAV(SAVR) LOAD RETRY COUNT                    42000019
         BCT   PARM2,READ         READ UNTIL COUNT IS EXHAUSTED         42200019
         B     TRYOLC             TRY POSSIBLE ON LINE CORRECTION       42400019
*********************************************************************** 42600019
*                                                                       42800019
*        EXECUTE CHANNEL PROGRAM AND WAIT                               43000019
*                                                                       43200019
*********************************************************************** 43400019
READ     EQU   *                  RETRY ROUTINE                         43600019
         ST    PARM2,RETRYSAV(SAVR) SAVR RETRY COUNT                    43800019
         L     REG8,IOBCSW-1(IOBR) SAVE FAILING CCW ADDRESS             44000019
         EXCP  ACTIOB(IOBR)       EXECUTE CHANNEL PROGRAM               44200019
         L     REG1,ECBADR(IOBR)  LOAD ECB ADDRESS                      44400019
         WAIT  ECB=(REG1)         WAIT FOR EVENT TO COMPLETE            44600019
         ST    REG8,IOBCSW-1(IOBR) RESTORE FAILING CCW ADDRESS          44800019
         ST    WKREG3,STRTADR(IOBR) RESTORE START ADDRESS               45000019
*********************************************************************** 45200019
*                                                                       45400019
*        BRANCH AND LINK TO ERROR COUNTER ROUTINE                       45600019
*                                                                       45800019
*********************************************************************** 46000019
         L     RETCODE,DCBCHECK   LOAD ADDRESS OF CHECK ROUTINE         46200019
         BAL   BACK,ERRCTADR(RETCODE) LINK TO COUNTER UPDATE TOUTINE    46400019
*********************************************************************** 46600019
         SR    RETCODE,RETCODE    SET RETURN CODE TO ZERO               46800019
         CLI   0(CCWR),RBDCOC     IS COMMAND CODE RBDCOC                47000019
         BNE   UETEST             NO TEST FOR UNIT EXCEPTION            47200019
         L     REG1,ECBADR(IOBR)  LOAD ECB ADDRESS                      47400019
         CLI   0(REG1),PERR       DID ANY PERMANENT ERRORS OCCUR        47600019
         BE    GOTOEIB            YES GO TO EIB ROUTINE                 47800019
DONE     NI    DCBIFLGS,ERROFF    RESET DCB ERROR FLAGS                 48800019
         OI    IOBFLGS(IOBR),CCFLGON  TURN COMM CHAIN BIT ON IN IOBFLGS 49000019
         L     BACK,RETSAVE(SAVR) RESTORE RETURN ADDRESS                49200019
         LM    REG2,REG9,USERSAVE(SAVR) RESTORE USER REGISTERS          49400019
         BR    BACK               RETURN TO USER                        49600019
UETEST   TM    IOBCSW+IOBSTUS(IOBR),UNEXCP DID UNIT EXCEPTION OCCUR     49800019
         BZ    NOUNEX             NO TEST FOR ERRORS                    50000019
         OI    DCBORBYT,EOF       POST EOF IN DCBORBYT                  50200019
NOUNEX   L     REG1,ECBADR(IOBR)  LOAD ECB ADDRESS                      50400019
         CLI   0(REG1),PERR       DID ANY PERMANENT ERRORS OCCUR        50600019
         BE    RDREADY            YES GO RETRY                          50800019
         B     DONE               RETURN TO USER                        51800019
TRYOLC   EQU   *                                                        52000019
         TM    0(CCWR),RBCOMM     IS COMMAND CODE READ BACKWARD         52800019
         BO    RDBKWD             YES DONT ADJUST I/O AREA ADDRESS      53000019
         L     WKREG1,0(CCWR)     GET INPUT AREA ADDRESS                53200019
         LA    WKREG1,0(WKREG1)    CLEAR HIGH ORDER BYTE                53400019
         LH    WKREG2,COUNT(CCWR) GET CCW BYTE COUNT                    53600019
         BCTR  WKREG2,0           DECREMENT COUNT BY 1                  53800019
         AR    WKREG1,WKREG2      ADD COUNT TO ADDRESS                  54000019
         ST    WKREG1,0(CCWR)     UPDATE DATA ADDRESS                   54200019
RDBKWD   MVI   0(CCWR),RBDCOC      FORCE COMMAND CODE TO RBDCOC         54400019
         MVI   RETRYSAV+3(SAVR),FORCECNT SET FOR ONE NORE TIME          54600019
         B     CPSRTADR           BRANCH TO STORE AND EX CHAN PROG      54800019
*********************************************************************** 55000019
*                                                                       55200019
*        BRANCH AND LINK TO SET ERROR INDICATOR BYTE ROUTINE            55400019
*                                                                       55600019
*********************************************************************** 55800019
GOTOEIB  EQU   *                                                        56000019
ERRORS   L     RETCODE,DCBCHECK   LOAD ADDRESS OF CHECK ROUTINE         56200019
         BAL   BACK,EIBRTN(RETCODE) LINK TO EIB ROUTINE                 56400019
*********************************************************************** 56600019
*                                                                       56800019
*        BRANCH AND LINK TO SET COMPLETION CODE ROUTINE                 57000019
*                                                                       57200019
*********************************************************************** 57400019
         L     RETCODE,DCBCHECK   LOAD ADDRESS OF THE CHECK ROUTINE     57600019
         BAL   BACK,CCRTN(RETCODE) LINK TO CONDITION CODE ROUTINE       57800019
*********************************************************************** 58000019
         TM    IOBCSW+3(IOBR),UNEXCP DID UNIT EXCEPTION OCCUR           58200019
         BZ    SYNADCK            NO CHECK FOR SYNSD                    58400019
         OI    DCBORBYT,EOF       POST EOF IN DCBORBYT                  58600019
         B     DONE               RETURN TO USER                        58800019
SYNADCK  TM    DCBORBYT,SYNADBIT  IS SYNAD ROUTINE IN CONTROL           59000019
         BO    DONE               YES RETURN TO USER                    59200019
         TM    DCBSYNAD+3,PSYNAD  SYNAD ROUTINE PRESENT                 59400019
         BZ    SYNPROC            YES PROCESS FOR SYNAD                 59600019
         LA    REG0,ONE           SET COMPLETION CODE TO 1              59700019
         SLL   REG0,TWELVE        ADJUST FOR EOV                        59800019
         LR    REG1,DCBR          SET REG1 TO DCB ADDRESS               60000019
         EOV   0(REG1)            GO TO EOV TO ABEND                    60200019
*********************************************************************** 60400019
*                                                                       60600019
*        RETURN TO THE USER                                             60800019
*                                                                       61000019
*********************************************************************** 61200019
SYNPROC  TM    DCBEIB,HPREMPTY    HOPPER EMPTY PRESENT                  61400019
         BZ    HPRFULL            NO                                    61600019
         TM    DCBOPTCD,HEOPTCD   HOPPER EMPTY EXIT SPECIFIED           61800019
         BZ    DONE               NO  RETURN TO USER                    62000019
*********************************************************************** 62200019
*                                                                       62400019
*        GO TO THE USER'S SYNAD ROUTINE                                 62600019
*                                                                       62800019
*********************************************************************** 63000019
HPRFULL  L     WKREG1,ECBADR(IOBR) LOAD ECB ADDRESS                     63200019
         MVC   XDECB(ECBMOVE,SAVR),0(WKREG1) MOVE ECB TO DECB           63400019
         STC   RETCODE,DCBEIB+1    SAVE RETURN CODE                     63600019
         MVC   XLNGTYP(LNTYPLEN,SAVR),LNGTYP MOVE LENGTH & TYPE TO DECB 63800019
         LA    WKREG2,OFFSET1(IOBR) LOAD ADDRESS OF CHANNEL PROGRAM     64000019
         ST    WKREG2,XCCWADR(SAVR) STORE CCW ADDRESS TO DECB           64200019
         ST    DCBR,XDCBADR(SAVR) STORE DCB ADDRESS TO DECB             64400019
         ST    IOBR,XIOBADR(SAVR) STORE IOB ADDRESS TO DECB             64600019
         LA    REG0,XDECB(SAVR)   GET DECB ADDRESS IN REG0              64800019
         LA    REG1,CNTRLB        SET CNTRL BIT ON IN REG1              65000019
         SLL   REG1,SHIFTHI       SHIFT TO HIGH ORDER BYTE              65200019
         OR    REG1,DCBR          DCB ADDRESS TO REG1                   65400019
         NI    DCBIFLGS,ERROFF    TURN ERROR FLAGS OFF                  65600019
         OI    DCBORBYT,SYNADBIT  TURN SYNAD BIT ON                     65800019
         L     RETCODE,DCBSYNAD   LOAD ADDRESS OF SYNAD ROUTINE         66000019
         ST    REG9,SAVE9(SAVR)   SAVE REGISTER 9                       66200019
         LM    REG2,REG9,USERSAVE(SAVR) RESTORE USER REGISTERS          66400019
         ST    REG1,USERSAVE(SAVR) SAVE DCB ADDRESS                     66600019
         BALR  BACK,RETCODE       BRANCH AND LINK TO USER SYNAD RTN     66800019
         STM   REG3,REG9,SAVE39(SAVR) SAVE USER REGISTERS               67000019
         L     REG9,SAVE9(SAVR)   RESTORE REGISTER 9                    67200019
         L     REG3,USERSAVE(SAVR) GEF DCB ADDRESS                      67400019
         ST    REG2,USERSAVE(SAVR) SAVE USER REGISTER 2                 67600019
         LR    DCBR,REG3          RESTORE DCB POINTER                   67800019
         NI    DCBIFLGS,ERROFF    TURN OFF ERROR FLAGS                  68000019
         NI    DCBORBYT,SNBITOFF  TURN OFF SYNAD BIT                    68200019
         LTR   RETCODE,RETCODE    TEST IF ADDRESS IS SPECIFIED          68400019
         BZ    LODRETCD           RESTORE RETURN CODE IF ZERO           68600019
         NI    DCBORBYT,ZERO      RESET OCR FLAGS                       68800019
         LM    REG2,REG9,USERSAVE(SAVR) RESTORE USER REGISTERS          69000019
         BR    RETCODE            BRANCH TO SPECIFIED ADDRESS           69200019
LODRETCD IC    RETCODE,DCBEIB+1   RESTORE RETURN CODE                   69400019
         MVI   DCBEIB+1,ZERO      CLEAR RETURN CODE SAVE AREA           69600019
         B     DONE               RETURN TO USER                        69800019
CLEAR    XC    0(1,WKREG1),0(WKREG1) EXECUTED INSTRUCTION TO CLEAR AREA 70000019
EIGHT    DC    H'8'               HALF WORD CONSTANT                    70200019
LNGTYP   DC    X'00008000'        LENGTH AND TYPE                       70400019
IHADCB   DCBD  DSORG=PS,DEVD=OR   DCB DSECT                    @YM00635 70600002
         END   IGG019VK                                                 70800019
./  ADD  SSI=40650059,NAME=IGG0197A
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00100002
**** END OF SPECIFICATIONS ***/                                         00150002
         TITLE     ' IGG0197A   OPEN EXECUTOR '                         00200019
IGG0197A CSECT                                                          00400019
***********************************************************    @YM00638 00450002
*MODULE-NAME                                                   @YM00638 00500002
* IGG0197A                                                     @YM00638 00550002
*                                                              @YM00638 00560002
*DESCRIPTIVE-NAME                                              @YM00638 00570002
* OCR OPEN EXECUTOR, STAGE 2                                   @YM00638 00580002
*                                                              @YM00638 00590002
*COPYRIGHT                                                     @YM00638 00592002
* NONE                                                         @YM00638 00594002
*                                                              @YM00638 00596002
*CHANGE-ACTIVITY                                               @YM00638 00598002
*                                                                       00600019
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                00800001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                01000001
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                01200001
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                01400001
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                01600001
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                01800001
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                02000001
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                02200001
* VS 2 REL 2 ADDITIONS/CHANGES/DELETIONS                                02240002
*A185000,431000,446400 - 447600,568500 - 569500,581000,         Y02967* 02280002
*A663000,717000,847000                                          Y02967* 02320002
*C732000,946000 - 947000,964000 - 967000                        Y02967* 02360002
*                                                                     * 02400019
* STATUS - CHANGE LEVEL 00  RELEASE 20                                  02600001
*                                                                     * 02800019
*FUNCTION/OPERATION                                                   * 03000019
* IT GETS CORE FOR IOB'S AND CHANNEL PROGRAMS                         * 03200019
* IT DETERMINES THE CORRECT CNTRL MODULE                              * 03400019
* IT DETERMINES THE CORRECT EOB MODULE                                * 03600019
* IT DETERMINES THE CORRECT CHECK OR SYNCH AND ERROR PROC RTN         * 03800019
* IT DETERMINES THE CORRECT READ OR GET ROUTINE                       * 04000019
* A CODE IS SET IN THE DCBCNTRL FIELD TO INDICATE THE CORRECT ROUTINE * 04200019
*   TO IGG0197B                                                       * 04400019
* IT GENERATES THE REQUIRED IOB'S(AND CHANNEL PROGRAMS FOR QSAM)      * 04600019
* IT LINKS THE CHANNEL PROGRAMS TO THE IOB'S AND THE IOB'S TO ONE     * 04800019
*  .ANOTHER                                                           * 05000019
* IT SPECIFIES IN THE WTG TABLE THAT EXECUTOR IGG0197B IS THE NEXT    * 05200019
*   EXECUTOR REQUIRED FOR THIS DCB                                    * 05400019
* IT THEN SEARCHES THE WTG TABLE TO PASS CONTROL TO ANOTHER EXECUTOR  * 05600019
*                                                                     * 05800019
*ENTRY POINT                                                            06000019
*        LABEL  OCR010                                                  06200019
*ENTRY METHOD- ENTERED FROM IGGO191B OR IGG0191I BY USE OF THE XCTL   * 06400019
*   MACRO                                                             * 06600019
*INPUT- SEE DESCRIPTION OF REGISTERS, USER'S DCB                      * 06800019
*                                                                     * 07000019
*OUTPUT- SEE DESCRIPTION OF REGISTERS, USER'S DCB, USER'S IOB'S       * 07200019
*                                                                     * 07400019
*EXITS- NORMAL - XCTL TO IGG0197B                                     * 07600019
*EXITS- ERROR - SVC 13(ABEND 013) DCB INCONSISTENCIES, FUNCTION NOT   * 07800019
*                  SUPPORTED                                          * 08000019
*                                                                     * 08200019
*                                                                     * 08400019
*                                                                     * 08600019
*TABLES/WORKAREAS - WHERE TO GO TABLE                                 * 08800019
*                                                                     * 09000019
*  BYTE 0-7   NAME                                                    * 09200019
*  BYTE 8-10  RELATIVE DISK ADDRESS (TTR) OF FIRST RECORD             * 09400019
*  BYTE 11    CONCATENATION NUMBER                                    * 09600019
*  BYTE 12    ZERO                                                    * 09800019
*  BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR          * 10000019
*             ALIAS INDICATOR-1 BIT                                   * 10200019
*             NUMBER OF TTRS IN USERS DATA FIELD-2BITS                * 10400019
*  BYTE 14-16 TTR                                                     * 10600019
*  BYTE 17    NAME                                                    * 10800019
*  BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                        * 11000019
*  BYTE 20    TRANSLATION TABLE                                       * 11200019
*  BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST              * 11400019
*  BYTE 22-23 ATTRIBUTES                                              * 11600019
*  BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE       * 11800019
*  BYTE 27-28 LENGTH OF FIRST TEXT RECORD                             * 12000019
*  BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                   * 12200019
*  BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                          * 12400019
*  BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                         * 12600019
*  BYTE 37-39 WORK AREA ADDRESS FOR FIRST DCB                         * 12800019
*  BYTE 40--- TABLE OF IDTTR'S AND WORK AREA ADDRESSES                * 13000019
*                                                                     * 13200019
*  BYTE 32+N(8) IDTTR OF EXECUTOR FOR NTH DCB (5 BYTES)               * 13400019
*               WORK AREA ADDRESS FOR NTH DCB (3 BYTES)               * 13600019
*                                                                     * 13800019
*  BYTE 32+8(N+1)IDTTR OF LAST ROUTINE LOAD   (5 BYTES)               * 14000019
*                                             (3 BYTES)               * 14200019
*                                                                     * 14400019
*ATTRIBUTES- REENTRANT, REUSABLE                                      * 14600019
*                                                                     * 14800019
*NOTES- THIS EXECUTOR DEALS ONLY WITH OPTICAL CHARACTER READERS,      * 15000019
*        IN PARTICULAR THE 1285, 1287, AND 1288                         15200019
*                                                                       15400019
*********************************************************************** 15600019
*                                                                     * 15800019
*  REGISTER CONVENTIONS USED THROUGHOUT ALL OPEN PASSES               * 16000019
*                                                                     * 16200019
*********************************************************************** 16400019
*                                                                       16600019
RE       EQU   0                   WORK REG5                            16800019
RF       EQU   1                   WORK REG6                            17000019
RDCB     EQU   2                   DCB REGISTER                         17200019
RBASE    EQU   3                   BASE REGISTER                        17400019
RCORE    EQU   4                   WORK REGISTER                        17600019
RPAR     EQU   5                   TOP OF PARAMETER LIST                17800019
RWTG     EQU   6                   TOP OF WTG TABLE                     18000019
RPARC    EQU   7                   CURRENT PARAMETER                    18200019
RWTGC    EQU   8                   CURRENT TRANS LOAD                   18400019
RTCB     EQU   9                        CURRENT TCB ADDRESS      Y02967 18500002
RUCB     EQU   10                  USED HERE AS A COUNTER IN IOB GENERA 18600019
RDEB     EQU   11                  DEB ADDRESS                          18800019
RB       EQU   12                  WORK REG1                            19000019
RC       EQU   13                  WORK REG2                            19200019
RD       EQU   14                  WORK REG3                            19400019
RJ       EQU   15                  WORK REG4                            19600019
**********************************************************************  19800019
*                                                                       20000019
*                   OPEN INDICATORS                                     20200019
*                                                                       20400019
*********************************************************************** 20600019
INPUT    EQU   X'7F'              DCB OPENED FOR INPUT=X'00'            20800019
*                                                                       21000019
**********************************************************************  21200019
*                                                                       21400019
*                   OPERATIONS                                          21600019
*                                                                       21800019
*********************************************************************** 22000019
RBOP     EQU   X'0C'               READ BACKWARD WITH ON-LINE CORRECTN  22200019
RBOCOP   EQU   X'4C'               READ BACKWARD                        22400019
GNLOP    EQU   X'13'               GO TO NEXT LINE                      22600019
*                                                                       22800019
**********************************************************************  23000019
*                                                                       23200019
*                   MASKS FOR MODULES TO BE USED                        23400019
*                                                                       23600019
*********************************************************************** 23800019
QSAMB    EQU   X'01'               IND2--QSAM                           24000019
RBOCB    EQU   X'10'               OPTCD--RBOC BIT                      24200019
CNTRLB   EQU   X'02'               MACRF--CNTRL                         24400019
LOCATEB  EQU   X'08'               MACRF--LOCATE MODE                   24600019
FIXEDB   EQU   X'80'               RECFM--FIXED RECORDS                 24800019
VORUB    EQU   X'40'               RECFM--VARIABLE OR UNDEFINED RECORDS 25000019
UNDEFB   EQU   X'C0'               RECFM--UNDEFINED RECORDS             25200019
**********************************************************************  25400019
*                                                                       25600019
*                   CCW FLAGS USED                                      25800019
*                                                                       26000019
*********************************************************************** 26200019
SLIB     EQU   X'20'               SLI BIT                              26400019
CCHAIN   EQU   X'40'               COMMAND CHAIN BIT                    26600019
CCHAINOF EQU   X'BF'               COMMAND CHAIN BIT OFF                26800019
*                                                                       27000019
*                                                                       27200019
*                   CCW OFFSETS USED                                    27400019
*                                                                       27600019
FLAG1    EQU   X'04'               FLAG BYTE IN FIRST CCW               27800019
FLAG2    EQU   X'0C'               FLAG BYTE IN SECOND CCW              28000019
COUNT    EQU   X'06'               COUNT FIELD IN FIRST CCW             28200019
COUNT2   EQU   X'0E'               COUNT FIELD IN SECOND CCW            28400019
COMMAND  EQU   X'00'               COMMAND FIELD IN FIRST CCW           28600019
COMMAND2 EQU   X'08'               COMMAND FIELD IN SECOND CCW          28800019
*                                                                       29000019
**********************************************************************  29200019
*                                                                       29400019
*                   IDS OF MODULES TO BE USED                           29600019
*                                                                       29800019
*********************************************************************** 30000019
EOBID    EQU   12                  EOB ROUTINE                          30200019
CNTRLID  EQU   8                   CNTRL ROUTINE                        30400019
CHECKID  EQU   7                   CHECK   ROUTINE                      30600019
GERRID   EQU   5                   SYNCH AND ERROR PROC ROUTINE         30800019
READID   EQU   6                   READ ROUTINE                         31000019
LOCFID   EQU   1                   GET ROUTINE---LOCATE MODE,RECFM=F    31200019
LOCVUID  EQU   2                   GET ROUTINE---LOCATE MODE,RECFM=V,U  31400019
MOVFID   EQU   3                   GET ROUTINE---MOVE MODE,RECFM=F      31600019
MOVVUID  EQU   4                   GET ROUTINE---MOVE MODE,RECFM=V,U    31800019
**********************************************************************  32000019
*                                                                       32200019
*                   OFFSETS                                             32400019
*                                                                       32600019
**********************************************************************  32800019
PLOFF    EQU   4                   OFFSET---DCB ENTRIES                 33000019
WGOFF    EQU   8                   OFFSET---XCTL TABLE                  33200019
WAOFF    EQU   32                  OFFSET---WTG ENTRIES                 33400019
IDOFF    EQU   0                   ID OFFSET IN IEHIOSUP UPDATE TABLE   33600019
TTROFF   EQU   2                   TTR OFFSET IN IEHIOSUP UPDATE TABLE  33800019
WTGID    EQU   6                   OFFSET TO ID IN WTG TABLE            34000019
WTGTTR   EQU   14                  OFFSET TO TTR IN WTG TABLE           34200019
WKAOFF   EQU   4                   OFFSET IN WTG TABLE TO WORK AREA AR  34400019
ECBOFF   EQU   4                   ECB OFFSET IN IOB                    34600019
IOBFLG1  EQU   8                   OFFSET OF IOBFLG1 IN ACCESS METH IOB 34800019
ECBADDR  EQU   12                  OFFSET OF ECB ADDRESS IN IOB         35000019
CPSTART  EQU   20                  OFFSET OF CHAN PROG START IN IOB     35200019
DCBOFF   EQU   4                   DCB OFFSET FROM CPSTART OFFSET       35400019
FORTY    EQU   40                  SIZE OF AN IOB INCLUDING THE PREFIX  35600019
FORTY8   EQU   48                  QSAM CHANNEL PROGRAM OFFSET          35800019
*********************************************************************** 36000019
*                                                                       36200019
*                   IOB FLAGS                                           36400019
*                                                                       36600019
*********************************************************************** 36800019
FIRSTIOB EQU   X'01'               INDICATES FIRST IOB IN CHAIN         37000019
NOERROR  EQU   X'7F'               USED TO INITIALIZE THE ECB           37200019
*********************************************************************** 37400019
*                                                                       37600019
*                   SHIFTS                                              37800019
*                                                                       38000019
*********************************************************************** 38200019
DIV8     EQU   3                   SHIFT TO MULTIPLY BY 8               38400019
MULT8    EQU   3                   SHIFT TO MULTIPLY BY 8               38600019
BITS12   EQU   12                  USED TO SHIFT LEFT 12 BITS           38800019
*********************************************************************** 39000019
*                                                                       39200019
*                   LENGTHS                                             39400019
*                                                                       39600019
*********************************************************************** 39800019
CCWL     EQU   8                   LENGTH OF 1 CCW                      40000019
CCWL2    EQU   16                  LENGTH OF 2 CCWS                     40200019
CCWL3    EQU   24                  LENGTH OF 3 CCWS                     40400019
IDLNGH   EQU   2                   LENGTH OF OPEN EXECUTOR ID           40600019
TTRLNGH  EQU   3                   LENGTH OF OPEN EXECUTOR TTR          40800019
IDTTRL   EQU   5                   LENGTH OF OPEN EXECUTOR ID AND TTR   41000019
*********************************************************************** 41200019
*                                                                       41400019
*                   CONSTANTS                                           41600019
*                                                                       41800019
*********************************************************************** 42000019
C255     EQU   255                 USED TO CLEAR 256 BYTES(EX INSTR)    42200019
C256     EQU   256                 USED TO INCREMENT A POINTER BY 256   42400019
ZERO     EQU   0                   USED AS A CONSTANT OF 0              42600019
ONE      EQU   1                   CONSTANT OF ONE                      42800019
TWO      EQU   2                   USED AS A CONSTANT OF TWO            43000019
BYT4     EQU   4                        CONSTANT OF FOUR         Y02967 43100002
ABENDCOD EQU   X'13'               OPEN ABEND SYSTEM CODE               43200019
*********************************************************************** 43400019
*********************************************************************** 43600019
 EJECT                                                                  43800019
         BALR  RBASE,RE            SET BASE                             44000019
         USING OCR010,RBASE        BASE                                 44200019
         USING IHADCB,RDCB         DCB                                  44400019
         USING FORCORE,RCORE       WORK AREA                            44600019
         USING DEBBASIC,RDEB            DEB BASE                 Y02967 44640002
         USING TCB,RTCB                 TCB BASE                 Y02967 44680002
OCR010   EQU   *                                               @YM02503 44700002
         TM    0(RPARC),INPUT           OPEN FOR INPUT         @YM02503 44720002
         BNZ   OCRABEND            IF NOT, ABEND (013)                  45000019
         L     RDCB,0(RPARC)       INITIALIZE THE DCB REGISTER          45200019
         LA    RDCB,0(RDCB)        CLEAR HIGH ORDER BYTE                45400019
         L     RCORE,WKAOFF(RWTGC) GET WORK AREA REGISTER               45600019
         LA    RCORE,0(RCORE)      CLEAR HIGH ORDER BYTE                45800019
         L     RDEB,DCBDEBAD            GET DEB ADDRESS        @YM02503 45860002
         L     RTCB,DEBTCBAD            GET TCB ADDR           @YM02503 45920002
         LA    RF,FORTY            LOAD SIZE OF BASIC IOB (40 BYTES)    46000019
*                                                                       46200019
         TM    DCBRECFM,UNDEFB     TEST IF ANY RECFM SPECIFIED          46400019
         BNZ   OCR015              IF YES, BRANCH                       46600019
         OI    DCBRECFM,UNDEFB     IF NONE SPECIFIED,ASSUME UNDEFINED   46800019
*                                                                       47000019
*                                                                       47200019
*********************************************************************** 47400019
*                                                                       47600019
*        CALCULATE AND GET CORE FOR IOBS                                47800019
*                                                                       48000019
*********************************************************************** 48200019
OCR015   TM    DCBCIND2,QSAMB      TEST IF QSAM                         48400019
         BNO   OCR020              BRANCH IF NOT QSAM                   48600019
         LA    RF,CCWL(RF)         INCREMENT BY 8 FOR CNTRL AND RDLNE   48800019
         LH    RC,DCBBUFL          CCW--THEN LOAD BUFFER LENGTH         49000019
         LTR   RC,RC               TEST BUFL FOR ZERO                   49200019
         BZ    OCRABEND            IF ZERO, ABEND(F13)                  49400019
         LH    RE,DCBLRECL         LOAD RECORD LENGTH FROM DCB          49600019
         LTR   RE,RE               TEST LRECL FOR ZERO                  49800019
         BZ    OCRABEND            IF ZERO, ABEND (F13)                 50000019
         CR    RC,RE               COMPARE BUFFER LENGTH TO RECORD'LNGH 50200019
         BL    OCRABEND            IF BUFL LESS THAN LRECL, ABEND (F13) 50400019
         SR    RB,RB               CLEAR REGISTER FOR REGISTER DIVIDE   50600019
         DR    RB,RE               DIVIDE BUFL BY LRECL                 50800019
         LH    RE,DCBBUFL          LOAD BUFFER LENGTH                   51000019
         SR    RE,RB               SUBTRACT REMAINDER TO MAKE IT A      51200019
*                                  MULTIPLE OF THE RECORD LENGTH        51400019
         STH   RE,DCBBUFL          STORE BUFFER LENGTH BACK TO DCB      51600019
         LR    RE,RC               SAVE NUMBER OF LINES TO BE READ      51800019
*                                                                       52000019
*                                                                       52200019
         MH    RC,SIXTEEN          MULTIPLY BY 16                       52400019
         AR    RF,RC               ADD SIZE FOR CCWS TO IOB SIZE        52600019
         LR    RC,RE               RESTORE NUMBER OF LINES TO BE READ   52800019
         B     OCR030              BRANCH TO CONTINUE PROCESSING QSAM   53000019
*                                                                       53200019
OCR020   LA    RF,CCWL3(RF)        INCREMENT BSAM IOB BY 24 FOR CNTRL,  53400019
*                                   RESCN,AND DSPLY CCWS.               53600019
OCR030   SRL   RF,DIV8             DIVIDE IOB LENGTH BY 8               53800019
         STC   RF,DCBIOBL          STORE DOUBLE WORK LENGTH TO DCB      54000019
         SLL   RF,MULT8            RESET LENGTH                         54200019
*                                                                       54400019
*                                                                       54600019
         TM    DCBCIND2,QSAMB      TEST IF QSAM                         54800019
         BO    OCR040              YES, BRANCH                          55000019
         LA    RE,ONE              SUPPLY 1 DCB FOR BSAM                55200019
         STC   RE,DCBNCP           STORE IN DCB                         55400019
         B     OCR050              BRANCH TO PROCESS                    55600019
*                                                                       55800019
OCR040   IC    RE,DCBBUFNO         GET NUMBER OF IOBS TO BUILD          56000019
*                                                                       56200019
OCR050   LR    RUCB,RE             SAVE NUMBER AS COUNTER               56400019
         MR    RE,RE               COMPUTE SPACE REQUIRED               56600019
         LR    RB,RF               SAVE FOR FUTURE USE                  56800019
         MODESET KEYADDR=DXUKEY,WORKREG=1    GET USER KEY      @YM02503 56850002
*                                                                Y02967 56900002
         LR    RF,RB                    GET IOB SPACE            Y02967 56950002
*                                                                       57000019
**********************************************************************  57200019
*                                                                       57400019
         GETMAIN R,LV=(RF),SP=250  GET CORE FOR IOBS                    57600019
*                                                                       57800019
**********************************************************************  58000019
         MODESET EXTKEY=DATAMGT         PUT SYSTEM IN OPEN KEY   Y02967 58100002
*                                                                       58200019
         LR    RJ,RB               RESOTRE LENGTH TO CLEAR AREA         58400019
         MVI   DCBCNTRL+3,EOBID    SET END-OF-BLOCK ID                  58600019
*                                                                       58800019
         TM    DCBMACRF,CNTRLB     IS CNTRL SPECIFIED                   59000019
         BNO   OCR060              IF NOT, BRANCH                       59200019
         MVI   DCBCNTRL,CNTRLID    SET THE CNTRL ID                     59400019
*                                                                       59600019
OCR060   TM    DCBCIND2,QSAMB      IS QSAM USED                         59800019
         BO    OCR070              YES, BRANCH                          60000019
*                                                                       60200019
         MVI   DCBCNTRL+1,CHECKID  SET THE CHECK ROUTINE ID             60400019
         MVI   DCBCNTRL+2,READID   SET THE READ ROUTINE ID              60600019
         B     OCR100              BRANCH TO CLEAR THE IOBS             60800019
*                                                                       61000019
OCR070   MVI   DCBCNTRL+1,GERRID   SET THE GERR ID                      61200019
         TM    DCBMACRF,LOCATEB    IS LOCATE MODE SPECIFIED             61400019
         BNO   OCR090              IF NOT, BRANCH                       61600019
         TM    DCBRECFM,VORUB      TEST FOR VARIABLE OR UNDEFINED       61800019
         BO    OCR080              IF EITHER, BRANCH                    62000019
         MVI   DCBCNTRL+2,LOCFID   SET THE GET ROUTINE ID               62200019
         B     OCR100              BRANCH TO CLEAR THE IOBS             62400019
*                                                                       62600019
OCR080   MVI   DCBCNTRL+2,LOCVUID  STORE RESULTANT ID                   62800019
         B     OCR100              BRANCH TO CLEAR IOBS                 63000019
*                                                                       63200019
OCR090   TM    DCBRECFM,VORUB      TEST FOR VARIABLE OR UNDEFINED       63400019
         BO    OCR095              IF EITHER, BRANCH                    63600019
         MVI   DCBCNTRL+2,MOVFID   SET GET ROUTINE ID                   63800019
         B     OCR100              BRANCH TO CLEAR IOBS                 64000019
*                                                                       64200019
OCR095   MVI   DCBCNTRL+2,MOVVUID  RECORD FORMAT IS VARIABLE OR UNDEF   64400019
*                                                                       64600019
OCR100   TM    DCBCIND2,QSAMB      IS QSAM USED                         64800019
         BZ    OCR103              NO, BRANCH                           65000019
         MVI   DCBOFFSR,FORTY8     SET CHANNEL PROGRAM OFFSET           65200019
         B     OCR104              BRANCH TO CONTINUE PROCESSING        65400019
OCR103   MVI   DCBOFFSR,FORTY      SET CHANNEL PROGRAM OFFSET           65600019
*                                                                       65800019
OCR104   ST    RF,DCBIOBA          SAVE FIRST IOB ADDRESS               66000019
         BCTR  RJ,0                REDUCE AMOUNT BY ONE                 66200019
         MODESET KEYADDR=DXUKEY,WORKREG=11   GET USER KEY      @YM02503 66300002
         LA    RB,C255             GET MAX AMOUNT OF ONE CLEAR (256)    66400019
*                                                                       66600019
OCR105   CR    RJ,RB               IS AMOUNT GREATER THAN 255           66800019
         BNH   OCR110              NO, BRANCH                           67000019
*                                                                       67200019
         EX    RB,OCR107E          CLEAR 256 BYTES                      67400019
*                                                                       67600019
         SR    RJ,RB               SUBTRACT 255 FROM AMT TO BE CLEARED  67800019
         BCTR  RJ,0                SUBTRACT ONE MORE BYTE               68000019
         LA    RF,C256(RF)         UPDATE AREA ADDRESS                  68200019
         B     OCR105              GO CLEAR SOME MORE                   68400019
*                                                                       68600019
OCR107E  XC    0(1,RF),0(RF)       CLEAR INSTRUCTION--USED BY EX INSTR  68800019
*                                                                       69000019
OCR110   EX    RJ,OCR107E          CLEARS LESS THAN 256 BYTES           69200019
*                                                                       69400019
         L     RB,DCBIOBA          GET IOB ADDRESS                      69600019
         LR    RD,RB               SET UP WORK REGISTER                 69800019
*                                                                       70000019
*********************************************************************** 70200019
*                                                                       70400019
*        INITIALIZE THE IOBS                                            70600019
*                                                                       70800019
*********************************************************************** 71000019
OCR120   LTR   RUCB,RUCB           HAVE ALL IOBS BEEN GENERATED         71200019
         BZ    OCR200              YES, BRANCH                          71400019
*                                                                       71600019
         MODESET KEYADDR=DXUKEY,WORKREG=11   GET USER KEY      @YM02503 71700002
         ST    RB,0(RD)            LINK THIS IOB TO THE LAST ONE        71800019
         LR    RD,RB               UPDATE THE WORK REGISTER             72000019
         LA    RB,ECBOFF(RB)       POINT TO THE ECB                     72200019
         OI    0(RB),NOERROR       SET ECB COMPLETE WITHOUT ERROR       72400019
         OI    IOBFLG1(RD),CCHAIN  SET COMMAND CHAINING BIT             72600019
         ST    RB,ECBADDR(RD)      STORE ECB POINTER                    72800019
         LA    RJ,CPSTART(RB)      POINT TO CHANNEL PROGRAM START ADDRE 73000019
         MVC   DCBOFF(BYT4,RJ),DXUDCBAD MOVE DCB ADDRESS TO IOB  Y02967 73200002
         LA    RB,CCWL2(RJ)        POINT TO CCWS                        73400019
         TM    DCBCIND2,QSAMB      USING QSAM                           73600019
         BO    OCR130              YES,BRANCH                           73800019
         LA    RB,CCWL3(RB)        POINT TO THE NEXT IOB                74000019
         BCTR  RUCB,0              DECREMENT IOB COUNTER                74200019
         B     OCR120              SEE IF ALL IOBS HAVE BEEN GENERATED  74400019
*                                                                       74600019
*********************************************************************** 74800019
*                                                                       75000019
*        SET UP CHANNEL PROGRAM FOR QSAM (JOURNAL TAPES)                75200019
*                                                                       75400019
*********************************************************************** 75600019
OCR130   LA    RB,CCWL(RB)         POINT TO CHANNEL PROGRAM             75800019
         ST    RB,0(RJ)            STORE CHANNEL PROGRAM ADDRESS IN IOB 76000019
*                                                                       76200019
         LR    RJ,RC               LOAD NUMBER OF LINES TO BE READ      76400019
         TM    DCBOPTCD,RBOCB      IS READ BACKWD WITT ON-LINE CORR SP  76600019
         BZ    OCR140              NO, BRANCH                           76800019
         MVI   COMMAND(RB),RBOCOP  MOVE RBOC TO COMMAND                 77000019
         B     OCR150              BRANCH TO CONTINUE PROCESSING        77200019
*                                                                       77400019
OCR140   MVI   COMMAND(RB),RBOP    MOVE READ BACKWD                     77600019
*                                                                       77800019
OCR150   TM    DCBRECFM,UNDEFB     TEST FOR UNDEFINED RECORDS           78000019
         BO    OCR155              YES,BRANCH                           78200019
         TM    DCBRECFM,FIXEDB     TEST FOR FIXED RECORDS               78400019
         BO    OCR160              YES,BRANCH                           78600019
OCR155   OI    FLAG1(RB),SLIB      TURN SLI BIT ON IN READ CCW          78800019
         TM    DCBRECFM,UNDEFB     IS FORMAT UNDEFINED                  79000019
         BNO   OCR170              NO, BRANCH                           79200019
*                                                                       79400019
OCR160   MVC   COUNT(TWO,RB),DCBLRECL MOVE RECORD LENGTH TO COUNT       79600019
         B     OCR180              BRANCH TO CONTINUE PROCESSING        79800019
*                                                                       80000019
OCR170   LH    RF,DCBLRECL         LOAD RECORL LENGTH                   80200019
         SH    RF,FOUR             SUBTRACT 4 FOR VARIABLE COUNT        80400019
         STH   RF,COUNT(RB)        STORE COUNT TO CCW                   80600019
*                                                                       80800019
OCR180   OI    FLAG1(RB),CCHAIN    TURN COMMAND CHAINING BIT ON         81000019
         MVI   COMMAND2(RB),GNLOP  SET GNL OP                           81200019
         MVI   FLAG2(RB),CCHAIN    TURN COMMAND CHAINING BIT ON         81400019
         MVI   COUNT2+1(RB),ONE    SET CCW COUNT TO ONE                 81600019
*                                                                       81800019
OCR190   BCT   RJ,OCR195           BRANCH ON NUMBER OF LINES TO BE READ 82000019
         NI    FLAG2(RB),CCHAINOF  TURN OFF COMMAND CHAIN IN LAST CCW   82200019
         LA    RB,CCWL2(RB)        POINT TO NEXT IOB                    82400019
         BCTR  RUCB,0              DECREMENT IOB COUNTER                82600019
         B     OCR120              BRANCH TO CHECK FOR MORE IOBS        82800019
*                                                                       83000019
OCR195   LR    RF,RB               COPY CCW POINTER                     83200019
         LA    RB,CCWL2(RB)        INCREMENT POINTER TO NEXT TWO CCWS   83400019
         MVC   0(CCWL2,RB),0(RF)   COPY 2 CCWS TO READ ANOTHER LINE     83600019
         B     OCR190              BRANCH TO CHECK FOR MORE LINES       83800019
*                                                                       84000019
OCR200   L     RB,DCBIOBA          GET FIRST IOB ADDRESS                84200019
         ST    RB,0(RD)            LINK FIRST IOB TO LAST               84400019
         OI    0(RB),FIRSTIOB      SET FIRST IOB INDICATOR              84600019
         MODESET EXTKEY=DATAMGT         PUT SYSTEM IN OPEN KEY   Y02967 84700002
*                                                                       84800019
         MVC   0(IDTTRL,RWTGC),SOP7B  SET ID FOR NEXT LOAD USED BY THIS 85000019
*                                  DCB. ID GOES TO BYTES 0-5 OF AN 8    85200019
*                                  BYTE ENTRY IN THE WTG TABLE.         85400019
*********************************************************************** 85600019
*                                                                       85800019
*        GO TO NEXT EXECUTOR OR DO THIS ONE AGAIN                       86000019
*                                                                       86200019
**********************************************************************  86400019
RELOOP   LA    RWTGC,WGOFF(RWTGC)   INCREMENT CURRENT WTG ENTRY         86600019
         LA    RPARC,PLOFF(RPARC)   INCREMENT CURRENT DCB ENTRY         86800019
         CLC   0(IDLNGH,RWTGC),AMIDCNST IS THIS ROUTINE NEEDED AGAIN    87000019
         BCR   8,RBASE             BRANCH TO BEGIN ROUTINE AGAIN        87200019
*                                                                       87400019
         CLC   0(IDLNGH,RWTGC),OPIDCNST END OF TABLE                    87600019
         BC    7,RELOOP            NO, CHECK NEXT ENTRY                 87800019
*                                                                       88000019
         LR    RPARC,RPAR          REINITIALIZE DCB LIST POINTER        88200019
         LA    RWTGC,WAOFF(RWTG)   REINITIALIZE WTG LIST POINTER        88400019
*                                                                       88600019
RELOOP1  CLI   0(RWTGC),ZERO       IS THIS ENTRY COMPLETE               88800019
         BC    7,XCTLRTN           IF NOT,BRANCH TO TRANSFER CONTROL    89000019
*                                  TO NEXT EXECUTOR                     89200019
         LA    RWTGC,WGOFF(RWTGC)   GET NEXT WTG ENTRY                  89400019
         LA    RPARC,PLOFF(RPARC)   GET NEXT DCB ENTRY                  89600019
         B     RELOOP1             BRANCH TO CHECK NEXT ENTRY COMPLETE  89800019
*                                                                       90000019
XCTLRTN  MVC   WTGID(IDLNGH,RWTG),IDOFF(RWTGC) STORE IF IN WTG TABLE    90200019
         MVC   WTGTTR(TTRLNGH,RWTG),TTROFF(RWTGC) STORE TTR IN WTG TAB  90400019
*                                                                       90600019
         LA    RJ,DXCCW12          SET UP FOR XCTL- LOAD ADDR OF PARMS  90800019
**********************************************************************  91000019
*                                                                       91200019
         XCTL  DE=(RWTG),SF=(E,(RJ)) TRANSFER CONTROL TO NEXT EXECUTOR  91400019
*                                                                       91600019
**********************************************************************  91800019
*                                                                       92000019
OCRABEND LA    RF,ABENDCOD         GET ABEND CODE                       92200019
         SLL   RF,BITS12           SET UP REG 1 FOR ABEND               92400019
         ABEND (RF),DUMP           ISSUE ABEND TO TERMINATE             92600019
*                                                                       92800019
*                                                                       93000019
*                                                                       93200019
OPIDCNST DC    C'0S'               END OF TABLE ID                      93400019
AMIDCNST DC    C'7A'               STAGE III OCR EXECUTOR ID            93600019
SIXTEEN  DC    H'16'               CONSTANT (16)                        93800019
FOUR     DC    H'4'                CONSTANT (4)                         94000019
*                                                                       94200019
*                                                                       94400019
ZAPSZAPS DC    8C'ZAPSZAPS'             WORKAREA SPACE           Y02967 94600002
*                                                                Y02967 94660002
*                                                                Y02967 94720002
SOP7B    DC    C'7B    '           IDTTRL                               94800019
         DC    H'0'                END OF TABLE                         95000019
         DC   2H'0'                TABLE FILLER---TO DOUBLE WORD        95200019
         DC    C'019'              OPENSVC CODE                         95400019
         DC    AL1(126)            DBL WORDS FROM CSECT TO BEGIN OF     95600019
*                                  XCTL TABLE                           95800019
         DCBD  DSORG=PS,DEVD=OR    DCB DSECT                   @YM00635 96000002
*                                                                       96200019
         IECDSECS MAIN,EXPAND=YES                                Y02967 96400002
         IKJTCB                                                  Y02967 96500002
         IHARB                                                   Y02967 96600002
         IEZDEB                                                  Y02967 96700002
         END                                                            96800019
./  ADD  SSI=42400097,NAME=IGG0197B
* /* START OF SPECIFICATIONS ****                                       00050002
*01* PROCESSOR = ASSEMXF-370R                                           00060002
**** END OF SPECIFICATIONS ***/                                         00070002
         TITLE 'IGG0197B  OPEN EXECUTOR '                               00100019
IGG0197B CSECT                                                          00200019
***********************************************************    @YM00638 00250002
*MODULE-NAME                                                   @YM00638 00260002
* IGG0197B                                                     @YM00638 00270002
*                                                              @YM00638 00280002
*DESCRIPTIVE-NAME                                              @YM00638 00290002
* OCR OPEN EXECUTOR, STAGE 3                                   @YM00638 00292002
*                                                              @YM00638 00294002
*COPYRIGHT                                                     @ZA00775 00296003
* NONE                                                         @YM00638 00298002
*                                                              @YM00638 00298402
*CHANGE-ACTIVITY                                               @YM00638 00298802
*                                                                       00300019
* RELEASE 20 ADDITIONS/CHANGES/DELETIONS                                00400001
* RELEASE 21 ADDITIONS/CHANGES/DELETIONS                                00500001
* RELEASE 22 ADDITIONS/CHANGES/DELETIONS                                00600001
* RELEASE 23 ADDITIONS/CHANGES/DELETIONS                                00700001
* RELEASE 24 ADDITIONS/CHANGES/DELETIONS                                00800001
* RELEASE 25 ADDITIONS/CHANGES/DELETIONS                                00900001
* RELEASE 26 ADDITIONS/CHANGES/DELETIONS                                01000001
* RELEASE 27 ADDITIONS/CHANGES/DELETIONS                                01100001
*A069500,150500,252300,252600,314300,314600,320500,359300,      Y02967$ 01120002
*A359600,361500,390100 - 390600,404500                          Y02967* 01140002
*C148000,277000 - 277600,439000 - 440200,463000 - 473000,       Y02967* 01160002
*C477000 - 478200                                               Y02967* 01180002
*                                                                     * 01200019
* STATUS - CHANGE LEVEL 00  RELEASE 20                                  01300001
*                                                                     * 01400019
*FUNCTION/OPERATION                                                   * 01500019
* IT LOADS DEVICE DEPENDENT ROUTINES IDENTIFIED BY A MASK SET IN STAGE* 01600019
*   2 IN DCBCNTRL                                                     * 01700019
* IT ENTERS THE ADDRESS OF THESE ROUTINES INTO THE DCB                * 01800019
* IT ENTERS THE IDENTIFICATION OF EACH ROUTINE LOADED INTO THE DEBSUBED 01900019
*   FIELD OF THE DEB                                                  * 02000019
* IT COMPLETES THE CHANNEL PROGRAMS BY INSERTING.A BUFFER ADDRESS INTO* 02100019
*   EACH CCW (QSAM)                                                   * 02200019
* IT WRITES A MOUNT MESSAGE TO THE OPERATOR INDICATING THE NAME       * 02300019
*   ASSOCIATED WITH THE VOLUME TO BE MOUNTED. IF NO NAME IS SPECIFIED * 02400019
*   IN THE VOLUME PARAMETER ON THE USERS DD CARD, THE NAME OCRINP IS  * 02500019
*   USED                                                              * 02600019
* IT ISSUES A NO-OP COMMAND TO CLEAR STATUS AND SENSE                   02700019
* IT SEARCHES THE WTG TABLE TO PASS CONTROL TO ANOTHER EXECUTOR.      * 02800019
*   IF THE WTG TABLE HAS NO OTHER ENTRIES, THE EXECUTOR RETURNS CONTROL 02900019
*   TO THE OPEN ROUTINE.                                              * 03000019
*                                                                     * 03100019
*ENTRY POINT                                                            03200019
*        LABEL  OCR010                                                  03300019
*ENTRY METHOD- ENTERED FROM IGG0197A BY USE OF THE XCTL MACRO         * 03400019
*                                                                     * 03500019
*INPUT  SEE DESCRIPTION OF REGISTERS, USER'S DCB AND IOB'S            * 03600019
*                                                                     * 03700019
*OUTPUT  SEE DESCRIPTION OF REGISTERS, USER'S DCB AND IOB'S, WRITE TO * 03800019
*         OPERATOR MESSAGE                                            * 03900019
*                                                                     * 04000019
*EXITS-NORMAL  XCTL TO IGG0190S  (OPEN)                               * 04100019
*                                                                     * 04200019
*EXITS-ABNORNAL  SVC 13, ABEND 013 -INSUFFICIENT BUFFERS AVAILABLE    * 04300019
*                   IN BUFFER POOL TO SATISFY DCB BUFFER REQUIREMENTS * 04400019
*                                                                     * 04500019
*TABLES/WORKAREAS-WHERE TO GO TABLE                                   * 04600019
*                                                                     * 04700019
*ATTRIBUTES  REENTRANT, REUSABLE                                      * 04800019
*********************************************************************** 04900019
*                                                                     * 05000019
*REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                * 05100019
*                                                                     * 05200019
*********************************************************************** 05300019
RE       EQU   0                   WORK REG 5                           05400019
RF       EQU   1                   WORK REG 6                           05500019
RDCB     EQU   2                   DCB REGISTER                         05600019
RBASE    EQU   3                   BASE REGISTER                        05700019
RCORE    EQU   4                   WORK AREA ADDRESS                    05800019
RPAR     EQU   5                   TOP OF PARAMETER LIST                05900019
RWTG     EQU   6                   TOP OF WTG TABLE                     06000019
RPARC    EQU   7                   CURRENT PARAMETER                    06100019
RWTGC    EQU   8                   CURRENT TRANS LOAD                   06200019
RTIOT    EQU   9                   USED HERE AS WRK REG AND COMM VECT   06300019
RUCB     EQU   10                  USED ASICOUNTER AND UCB ADDRESS      06400019
RDEB     EQU   11                  DEB ADDRESS                          06500019
RB       EQU   12                  WORK REG 1                           06600019
RC       EQU   13                  WORK REG 2                           06700019
RD       EQU   14                  WORK REG 3                           06800019
RJ       EQU   15                  WORK REG 4                           06900019
RTCB     EQU   15                       TCB REGISTER             Y02967 06950002
*********************************************************************** 07000019
*                                                                       07100019
*        OFFSET EQUATES FOR WTG  AND XCTL TABLES                        07200019
*                  ALSO FOR MOUNT MESSAGE AND UCB                       07300019
*                                                                       07400019
*********************************************************************** 07500019
WKAOFF   EQU   4                   OFFSET TO WORK AREA IN WTG TABLE     07600019
WTGID    EQU   6                   OFFSET TO ID IN WTG TABLE            07700019
WTGTTR14 EQU   14                       OFFSET TOTTR IN WTG TABLE       07800002
TEMP0    EQU   24                  OFFSET TO TEMP STORAGE IN WTG TABLE  07900019
TOTALOFF EQU   24                  OFFSET OF TOTAL TEXT LNGH IN WTG TAB 08000019
TEMP     EQU   25                  OFFSET TO TEMP STORAGE IN WTG TABLE  08100019
TEXTOFF  EQU   27                  OFFSET TO FIRST TEXT IN WTG TAB      08200019
WAOFF    EQU   32                  OFFSET OF WTG TABLE FROM BLDL TABLE  08300019
IDOFF    EQU   0                   OFFSET TO ID IN IDTTRL ENTRY         08400019
TTROFF   EQU   2                   OFFSET TO TTR IN IDTTRL ENTRY        08500019
LOFF     EQU   5                   OFFSET TO L IN IDTTRL ENTRY          08600019
UNIT     EQU   14                  UNIT POSITION IN MESSAGE             08700019
VOLID    EQU   18                  VOLUME PARAMETER IN MESSAGE          08800019
UNAME    EQU   13                  UNIT OFFSET IN UCB                   08900019
QSAMCP   EQU   48                  OFFSET OF QSAM CHANNEL PROGRAM IS 48 09000019
*********************************************************************** 09100019
*                                                                       09200019
*        LENGTHS                                                        09300019
*                                                                       09400019
*********************************************************************** 09500019
WGOFF    EQU   8                   LENGTH OF ENTRY IN WTG TABLE         09600019
PLOFF    EQU   4                   LENGTH OF ENTRY IN OPEN PARAM LIST   09700019
DEBSIZE  EQU   32                  SIZE OF THE DEB                      09800019
ADDRESS  EQU   3                   LENGTH OF AN ADDRESS                 09900019
CCWL     EQU   8                   LENGTH OF ONE CCW                    10000019
CCWL2    EQU   16                  LENGTH OF A PAIR OF CCWS             10100019
WORD     EQU   4                   LENGTH OF DCBCNTRL - 4 BYTES         10200019
DOUBLEWD EQU   8                   DOUBLE WORD LENGTH IS 8 BYTES        10300019
UNITL    EQU   3                   LENGTH OF UNIT ADDRESS IS 3          10400019
VOLUMEL  EQU   6                   LENGTH OF VOLUME PARAMETER IS 6      10500019
IDLNGH   EQU   2                   LENGTH OF OPEN EXECUTOR ID           10600019
TTRLNGH  EQU   3                   LENGTH OF OPEN EXECUTOR TTR          10700019
IDTTRLL  EQU   6                   LENGTH OF IDTTRLL FIELD              10800019
TOTALL   EQU   3                   INDICATES LENGTH OF TOTAL TEXT       10900019
TEXTL    EQU   2                   INDICATES LENGTH OF FIRST TEXT REC   11000019
TXTOTL   EQU   5                   LENGTH OF TEXTL AND TOTALL           11100019
*********************************************************************** 11200019
*                                                                       11300019
*        SHIFTS                                                         11400019
*                                                                       11500019
*********************************************************************** 11600019
BITS8    EQU   8                   USED TO SHIFT ONE BYTE               11700019
MULT8    EQU   3                   SHIFT TO MULTIPLY BY 8               11800019
BITS12   EQU   12                  USED TO SHIFT LEFT 12 BITS           11900019
*********************************************************************** 12000019
*                                                                       12100019
*        CONSTANTS                                                      12200019
*                                                                       12300019
*********************************************************************** 12400019
QSAMB    EQU   X'01'               QSAM INDICATOR                       12500019
ABENDCOD EQU   X'13'               OPEN ABEND SYSTEM CODE               12600019
BLANK    EQU   X'40'               USED TO CHECK FOR A BLANK CHARACTER  12700019
X5C      EQU   X'5C'               1288 DEVD ENTRY IN DCB               12800019
ZERO     EQU   0                   USED AS A ONE BYTE HEX 0 CONSTANT    12900019
ONE      EQU   1                   USED AS A CONSTANT OF 1              13000019
*********************************************************************** 13100019
*                                                                       13200019
*        EQUATES FOR EXCP OF NO-OP COMMAND                              13300019
*                                                                       13400019
*********************************************************************** 13500019
ECB      EQU   4                   OFFSET OF ECB IN THE IOB             13600019
IOSIOB   EQU   8                   OFFSET OF THE IOS IOB IN THE ACCESS  13700019
*                                   METHOD IOB                          13800019
CPADR    EQU   24                  OFFSET OF CHAN PROG ADDR IN IOB      13900019
TEMCCW   EQU   40                  OFFSET OF NO-OP CCW IN IOB           14000019
ERRFLGS  EQU   X'3F'               USED TO TURN OFF IOS ERRFLGS         14100019
*********************************************************************** 14200019
*********************************************************************** 14300019
 EJECT                                                                  14400019
         BALR  RBASE,0             LOAD BASE REGISTER                   14500019
         USING OCR010,RBASE        MODULE BASE                          14600019
         USING IHADCB,RDCB         DCB  BASE                            14700019
         USING DEBBASIC,RDEB           DEB BASE REGISTER         Y02967 14800002
         USING FORCORE,RCORE       CORE BASE                            14900019
         USING CVT,RF              CVT  BASE                            15000019
         USING TCB,RTCB                 TCB BASE                 Y02967 15050002
         USING WTG,RWTG                                        @YM02503 15070002
*                                                                       15100019
OCR010   L     RDCB,0(RPARC)       GET DCB ADDRESS                      15200019
         LA    RDCB,0(RDCB)        CLEAR HIGH ORDER BYTE                15300019
         L     RDEB,DCBDEBAD       GET DEB ADDRESS                      15400019
         L     RCORE,WKAOFF(RWTGC) GET WORK AREA ADDRESS                15500019
*                                                                       15600019
         SR    RUCB,RUCB           CLEAR REGISTER                       15700019
         SR    RF,RF               CLEAR REGISTER                       15800019
         IC    RUCB,DEBNMEXT       GET NUMBER OF EXTENTS                15900019
         IC    RF,DEBEXSCL         GET SCALING FACTOR                   16000019
         SLL   RUCB,0(RF)          SHIFT ACCORDING TO EXTENT SIZE       16100019
         IC    RF,DEBAMLNG         GET ACCESS METHOD LENGTH             16200019
         LA    RUCB,0(RF,RUCB)     ADD TO POINT TO SUBRT ID FIELD       16300019
         LA    RUCB,DEBSIZE(RUCB,RDEB) ADD  BASIC DEB SZ TO DEB ADDRESS 16400019
*                                                                       16500019
* RUCB NOW POINTS TO THE SUBROUTINE ID FIELD IN THE DEB                 16600019
*********************************************************************** 16700019
*                                                                       16800019
*        LOAD ACCESS METHOD MODULES                                     16900019
*                                                                       17000019
*********************************************************************** 17100019
*                                                                       17200019
         MVI   0(RWTGC),ZERO       ZERO CURRENT ID ENTRY                17300019
*                                                                       17400019
         BAL   RF,POINT2ID         POINT TO THE END OF BLOCK ROUTINE    17500019
*                                                                       17600019
         BAL   RC,LOADMOD          LOAD THE EOB ROUTINE                 17700019
*                                                                       17800019
         TM    DCBCIND2,QSAMB      IS QSAM USED                         17900019
         BZ    OCR020              NO,BRANCH                            18000019
         MVC   DCBEOB+1(ADDRESS),TEMP(RWTG) MOVE EOB ADDRESS TO DCB     18100019
         B     OCR030              BRANCH TO CONTINUE PROCESSING        18200019
*                                                                       18300019
OCR020   MVC   DCBEOBR+1(ADDRESS),TEMP(RWTG) MOVE EOB ADDRESS TO DCB    18400019
*                                                                       18500019
OCR030   BAL   RF,POINT2ID         POINT TO GET/READ ROUTINE            18600019
*                                                                       18700019
         BAL   RC,LOADMOD          LOAD GET/READ MODULE                 18800019
*                                                                       18900019
         MVC   DCBGET+1(ADDRESS),TEMP(RWTG) MOVE GET/READ ADDRESS 2 DCB 19000019
*                                                                       19100019
         BAL   RF,POINT2ID         POINT TO GERR/CHECK ROUTINE          19200019
*                                                                       19300019
         BAL   RC,LOADMOD          LOAD  GERR/CHECK MODULE              19400019
*                                                                       19500019
         MVC   DCBGERR+1(ADDRESS),TEMP(RWTG) MOVE GERR/CHECK ADDRESS TO 19600019
*                                            DCB                        19700019
         BAL   RF,POINT2ID         POINT TO CNTRL ROUTINE               19800019
*                                                                       19900019
         LTR   RC,RC               IS THERE A CNTRL ID                  20000019
         BNZ   OCR040              YES, BRANCH                          20100019
*                                                                       20200019
         XC    DCBCNTRL(WORD),DCBCNTRL CLEAR PARAMETER LIST             20300019
         OI    DCBCNTRL+3,ONE      SET VECTOR TO 1                      20400019
         B     OCR050              BRANCH TO CONT PROCESSING            20500019
*                                                                       20600019
OCR040   BAL   RC,LOADMOD          LOAD CNTRL ROUTINE                   20700019
*                                                                       20800019
         MVC   DCBCNTRL+1(ADDRESS),TEMP(RWTG) MOVE CNTRL ROUTINE TO DCB 20900019
OCR050   MVC   DCBEROPT(ONE),DXCCW6  REPLACE QSAM ERROR OPTIONS         21000019
         TM    DCBCIND2,QSAMB      THIS A QSAM DCB                      21100019
         BZ    OCR060              NO, BRANCH                           21200019
*                                                                       21300019
         LA    RB,RDLNEID          LOAD ADDRESS OF  RDLNE ID            21400019
         BAL   RC,LOADMOD          LOAD THE RDLNE ROUTINE               21500019
*                                                                       21600019
         MVC   DCBRDLNE+1(ADDRESS),TEMP(RWTG) MOVE RDLNE ADDRESS TO DCB 21700019
*                                                                       21800019
         B     OCR080              BRANCH TO CONT PROCESSING            21900019
*                                                                       22000019
OCR060   CLI   DCBDEVT,X5C         IS THE DEVICE A 1288                 22100019
         BE    OCR070              YES, BRANCH                          22200019
*                                                                       22300019
         LA    RB,DSPLYID          GET THE ADDRESS OF THE DSPLY ID      22400019
         BAL   RC,LOADMOD          LOAD THE DSPLY ROUTINE               22500019
*                                                                       22600019
         MVC   DCBDSPLY+1(ADDRESS),TEMP(RWTG) MOVE DSPLY ADDRESS TO DCB 22700019
*                                                                       22800019
OCR070   LA    RB,RESCNID          GET THE ADDRESS OF THE RESCN ID      22900019
         BAL   RC,LOADMOD          LOAD THE RESCN ID                    23000019
*                                                                       23100019
         MVC   DCBRESCN+1(ADDRESS),TEMP(RWTG) MOVE RESCN                23200019
*                                                                       23300019
OCR080   L     RUCB,DCBIOBA        LOAD FIRST IOB ADDRESS               23400019
         LR    RTIOT,RUCB          SAVE ADDRESS IN WORK REGISTER        23500019
*                                                                       23600019
         TM    DCBCIND2,QSAMB      THIS DCB USING QSAM                  23700019
         BZ    OCR095              NO,BRANCH                            23800019
*                                                                       23900019
         XC    DCBEOBAD(DOUBLEWD),DCBEOBAD FORCE EOB CONDITION          24000019
         SR    RB,RB               CLEAR REGISTER TO INSERT COUNT       24100019
         IC    RB,DCBBUFNO         GET NUMBER OF BUFFERS                24200019
         LR    RD,RTIOT            SAVE FIRST IOB ADDRESS               24300019
OCR085   LA    RTIOT,QSAMCP(RTIOT) POINT TO CHANNEL PROGRAM             24400019
*                                    ASSUME  NORMAL SCHEDULINGG=8       24500019
*                                    ASSUME  IOB=32                     24600019
*                                    ASSUME  CNTRL & RDLNE CCWS =8      24700019
         SR    RE,RE               CLEAR DIVIDE REGISTER                24800019
         LH    RF,DCBBUFL          LOAD BUFFER LENGTH                   24900019
         LH    RJ,DCBLRECL         LOAD RECORD LENGTH                   25000019
         DR    RE,RJ               CALC NUMBER OF LINES PER BUFFER      25100019
         L     RC,DCBBUFCB         LOAD ADDRESS OF BUFFER CONTROL BLOCK 25200019
         MODESET KEYADDR=DXUKEY,WORKREG=15   GET USER KEY      @YM02503 25230002
         L     RJ,0(RC)            GET A BUFFER ADDRESS                 25300019
         LTR   RJ,RJ               VALID BUFFER ADDRESS                 25400019
         BZ    OCRABEND            NO, BRANCH TO ABEND                  25500019
         MVC   ONE(ADDRESS,RC),ONE(RJ) UPDATE BUFCB ADDRESS             25600019
         AH    RJ,DCBLRECL         ADJUST BUFFER FOR READ BACKWARD      25700019
         BCTR  RJ,0                DECREMENT BY ONE                     25800019
*                                                                       25900019
OCR090   IC    RE,0(RTIOT)         SAVE OP CODE                         26000019
         ST    RJ,0(RTIOT)         STORE BUFFER ADDRESS TO CCW          26100019
         STC   RE,0(RTIOT)         RESTORE OP CODE                      26200019
*                                                                       26300019
         AH    RJ,DCBLRECL         UPDATE BUFFER ADDRESS                26400019
         LA    RTIOT,CCWL2(RTIOT)  UPDATE CCW ADDRESS                   26500019
         BCT   RF,OCR090           IF MORE CCWS, CONTINUE               26600019
*                                                                       26700019
         L     RTIOT,0(RD)         GET NEXT IOB TO INITIALIZE           26800019
         LR    RD,RTIOT            UPDATE IOB POINTER                   26900019
         BCT   RB,OCR085           IF MORE IOBS, CONTINUE               27000019
*                                                                       27100019
*********************************************************************** 27200019
*                                                                       27300019
*        WRITE MOUNT MESSAGE                                            27400019
*                                                                       27500019
*********************************************************************** 27600019
OCR095   EQU   *                                                 Y02967 27700002
         MODESET EXTKEY=DATAMGT         PUT SYSTEM IN OPEN KEY   Y02967 27730002
         LA    RF,MESSAGEA+48           GET WTO AREA           @YM02503 27760002
*                                                                       28000019
         MVC   0(WTOSIZE,RF),WTOBEGIN  MOVE WTO LIST FORM TO CORE       28100019
*                                                                       28200019
*                                                                       28300019
         L     RUCB,DEBTCBAD+32         GET UCB ADDRESS          Y02967 28400002
         MVC   UNIT(UNITL,RF),UNAME(RUCB) MOVE UNITNAME TO MESSAGE      28500019
*                                                                       28600019
*                                                                       28700019
         CLI   JFCBVOLS,BLANK      IS VOLID SPECIFIED                   28800019
         BE    OCR100              NO,BRANCH                            28900019
*                                                                       29000019
         MVC   VOLID(VOLUMEL,RF),JFCBVOLS MOVE SPECIFIED VOLID TO MESAG 29100019
         B     OCR110              BRANCH TO CONT PROCESSING            29200019
*                                                                       29300019
OCR100   MVC   VOLID(VOLUMEL,RF),OCRINP  MOVE DEFAULT ID TO MESSAGE     29400019
*                                                                       29500019
OCR110   LR    RUCB,RF             SAVE ADDRESS OF GETMAIN CORE         29600019
*********************************************************************** 29700019
*                                                                       29800019
         WTO   MF=(E,(RF))         PARAMETER LIST ADDRESS IN REG.1      29900019
*                                                                       30000019
*********************************************************************** 30100019
         ST    RF,DCBWTOID         STORE WTO MESSAGE IDENTIFICATION     30200019
*********************************************************************** 30800019
*                                                                       30900019
*        ISSUE NO-OP TO CLEAR STATUS AND SENSE                          31000019
*         BY BUILDING AN IOB IN THE OPEN WORKAREA AND PUTTING  @YM02503 31010002
*        THE DATA MANAGEMENT COPIED DCB ADDRESS INTO THE IOB. THIS      31020002
*        HAS TO BE DONE BECAUSE THE DEB HAS DATA MANAGEMENT DCB         31030002
*        ADDRESS IN IT AT THIS TIME.THE USER IOB CANNOT BE USED         31040002
*        AT THIS TIME BECAUSE THE IOD AND DCB WOULD BE IN TWO  @YM02503 31050002
*        DIFFERENT PROTECT KEYS.THIS CONDITION WOULD CAUSE     @YM02503 31060002
*        A PROTECTION CHECK AT EXCP TIME                       @YM02503 31070002
*                                                                       31100019
*********************************************************************** 31200019
         LA    RB,MESSAGEA              GET IOB ADDRESS        @YM02503 31300002
         XC    0(40,RB),0(RB)           ZERO OUT IOB AREA      @YM02503 31310002
         ST    RB,0(RB)                 ONLY IOB IN CHAIN      @YM02503 31320002
         OI    0(RB),1                  FIRST IOB              @YM02503 31330002
         LA    RD,4(RB)                GET ECB ADDRESS         @YM02503 31340002
         ST    RD,12(RB)                PUT ECB ADDRESS IN IOB @YM02503 31350002
         OI    0(RD),X'7F'              SET ECB COMPLETE       @YM02503 31360002
         OI    8(RB),X'02'              SET UNRELATED FLAG ON IN IOB    31370002
         ST    RDCB,X'1C'(RB)           PUT D.M. DCB ADDR IN IOB        31380002
         LA    RD,40(RB)                GET IOB CCW ADDR       @YM02503 31390002
         ST    RD,X'18'(RB)             PUT CCW ADDR IN IOB    @YM02503 31400002
         MVC   TEMCCW(CCWL,RB),NOPCCW SET UP NO-OP CCW                  31500019
         LA    RD,TEMCCW(RB)       LOAD ADDRESS OF NO-OP CCW            31600019
         ST    RD,CPADR(RB)        STORE ADDRESS OF NO-OP IN IOB        31700019
         EXCP  IOSIOB(RB)          EXECUTE THE NO-OP                    31800019
         WAIT  ECB=ECB(RB)         WAIT FOR COMPLETION                  31900019
         NI    DCBIFLGS,ERRFLGS    RESET ERROR FLAGS IF ANY             32100019
         IECRES INIT,DCBCOPY=FRWKAR,STM=(0,14,WTGPREFX)        @YM02503 32120002
         L     RDEB,DCBDEBAD           GET DEB ADDRESS         @YM02503 32140002
         MVC   DEBDCBAD+1(3),DXUDCBAD+1 PUT USER DCB ADDR IN DEB        32160002
*********************************************************************** 32200019
*                                                                       32300019
*        GO TO NEXT EXECUTOR OR DO THIS ONE AGAIN                       32400019
*                                                                       32500019
*********************************************************************** 32600019
*                                                                       32700019
RELOOP   LA    RWTGC,WGOFF(RWTGC)   INCREMENT CURRENT WTG ENTRY         32800019
         LA    RPARC,PLOFF(RPARC)   INCREMENT CURRENT DCB ENTRY         32900019
         CLC   0(IDLNGH,RWTGC),AMIDCNST  THIS ROUTINE NEEDED AGAIN      33000019
         BCR   8,RBASE              YES, BRANCH TO BEGINNING            33100019
*                                                                       33200019
         CLC   0(IDLNGH,RWTGC),OPIDCNST END OF TABLE                    33300019
         BC    7,RELOOP            NO,CHECK NEXT ENTRY                  33400019
*                                                                       33500019
         LR    RPARC,RPAR          REINITIALIZE DCB LIST POINTER        33600019
         LA    RWTGC,WAOFF(RWTG)   REINITIALIZE WTG LIST POINTER        33700019
CHECK00  CLI   0(RWTGC),ZERO       IS THIS ENTRY COMPLETE               33800019
         BC    7,XCTLRTN           IF NOT, TRANSFER CONTROL             33900019
*                                                                       34000019
         LA    RWTGC,WGOFF(RWTGC)   GET NEXT WTG ENTRY                  34100019
         LA    RPARC,PLOFF(RPARC)   GET NEXT DCB ENTRY                  34200019
         BC    15,CHECK00           BRANCH TO CHECK NEXT ENTRY          34300019
*********************************************************************** 34400019
*                                                                       34500019
*        SUBROUTINE TO LOAD MODULES                                     34600019
*                                                                       34700019
*********************************************************************** 34800019
LOADMOD  EQU   *                                               @YM02503 34900002
         MVC   WTGTTR14(TTRLNGH,RWTG),TTROFF(RB) TTR TO DE     @YM02503 34950002
         MVC   WTGID(IDLNGH,RWTG),IDOFF(RB) MOVE ID TO DE               35000019
         SR    RF,RF               CLEAR RF                             35100019
         IC    RF,LOFF(RB)         LOAD DOUBLE WORD LENGTH              35200019
         SLL   RF,MULT8            MULTPY BY EIGHT FOR BYTE LENGTH      35300019
         ST    RF,TEMP0(RWTG)      TEMP. STORE OF LENGTH                35400019
         MVC   TOTALOFF(TOTALL,RWTG),TEMP(RWTG) STORE 3 BYTE TOTAL LNGH 35500019
         MVC   TEXTOFF(TEXTL,RWTG),TEMP(RWTG) STORE 2 BYTE TEXT LENGTH  35600019
         L     RF,CVTPTR           GET COMM VECTOR POINTER              35700019
         L     RF,CVTSVDCB         GET SVC LIBS DCB ADR                 35800019
*                                                                       35900019
         MODESET KEYADDR=DXUKEY,WORKREG=15   GET USER KEY      @YM02503 35930002
         LOAD  DE=(RWTG),DCB=(RF)  LOAD ACCESS METHOD ROUTINE           36000019
*                                                                       36100019
         MODESET EXTKEY=DATAMGT         PUT SYSTEM IN OPEN KEY   Y02967 36150002
         ST    RE,TEMP0(RWTG)      TEMP STORE OF ROUTINE ADDRESS        36200019
         MVC   0(IDLNGH,RUCB),0(RB) STORE ROUTINES ID IN DEB            36300019
         LA    RUCB,IDLNGH(RUCB)   UPDATE SUBROUTINE POINTER            36400019
         SR    RD,RD               CLEAR REG                            36500019
         IC    RD,DEBNMSUB         GET NO.OF SUBRTNS LOADED SO FAR      36600019
         LA    RD,ONE(RD)          ONE MORE SUBROUTINE LOADED           36700019
         STC   RD,DEBNMSUB         STORE NEW TOTAL OF SUBRTNS LOADED    36800019
         BR    RC                  RETURN TO CALLING ROUTINE            36900019
**********************************************************************  37000019
*                                                                       37100019
*        SUBROUTINE TO CONVERT THE 2 BYTE IDS IN DCBCNTRL TO ID         37200019
*        ADDRESSES IN THE XCTL TABLE                                    37300019
*                                                                       37400019
**********************************************************************  37500019
POINT2ID SR    RC,RC               CLEAR RC                             37600019
         LA    RE,TABLE            GET ADDRESS OF TTR TABLE             37700019
         LA    RB,IDTTRLL          SIX BYTE FIELD                       37800019
         IC    RC,DCBCNTRL+3       GET TTR NO. FROM DCBCNTRL+3          37900019
         L     RJ,DCBCNTRL         SHIFT IDS                            38000019
         SRL   RJ,BITS8                 RIGHT BY                        38100019
         ST    RJ,DCBCNTRL                   ONE BYTE                   38200019
         MR    RB,RB               CALCULATE WHERE TTR IS (6 XID)       38300019
         LR    RB,RC               LOAD THE PRODUCT                     38400019
         AR    RB,RE               ADD THE BEGINNING ADDR OF THE TTR    38500019
         BR    RF                     TABLE, AND RETURN                 38600019
*                                                                       38700019
**********************************************************************  38800019
*                                                                       38900019
XCTLRTN  MVC   TEMP0(TXTOTL,RWTG),XCTLCON RESTORE TOTAL AND TEST LNGHS  39000019
         MVC   WTGID(IDLNGH,RWTG),IDOFF(RWTGC) STORE ID IN WTG TABLE    39100019
         MVC   WTGTTR14(TTRLNGH,RWTG),TTROFF(RWTGC) TTR TO WTG TABLE    39200002
*                                                                       39300019
         LA    RJ,DXCCW12          SET UP FOR XCTL                      39400019
*                                                                       39500019
         XCTL  DE=(RWTG),SF=(E,(RJ))  TRANSFER CONTROL TO NXT EXECUTOR  39600019
*                                                                       39700019
**********************************************************************  39800019
*                                                                       39900019
*                                                                       40000019
OCRABEND LA    RF,ABENDCOD         GET ABEND CODE                       40100019
         SLL   RF,BITS12           SET UP REG FOR ABEND                 40200019
         ABEND (RF),DUMP           ABEND WITH A SYSTEM COMPLETION CODE  40300019
*                                                                       40400019
MOVEDCB  MVC   0(0,RJ),0(RDCB)         MOVE D.M. DCB TO USER AREAY02967 40450002
**********************************************************************  40500019
OPIDCNST DC    C'0S'               END OF TABLE ID                      40600019
AMIDCNST DC    C'7B'               ID OF THIS EXECUTOR                  40700019
OCRINP   DC    C'OCRINP'           DEFAULT VOLUME PARAMETER             40800019
XCTLCON  DC    X'0004000400'       TOTAL AND TEXT LENGTH OF OPEN MODS   40900019
**********************************************************************  41000019
****     WTO LIST FORM--MOVED TO GOTTEN CORE, THE MESSAGE COMPLETED,    41100019
****                               AND THEN EXECUTED                    41200019
         CNOP  0,8                 FORCE TO A DOUBLE WORD BOUNDARY      41300019
WTOBEGIN EQU   *                   WTO BEGINS ON A DOUBLE WORD          41400019
         WTO   'IEC001E M    ,      ',MF=L,ROUTCDE=7,DESC=3    @ZA00775 41500003
         CNOP  0,8                 FORCE TO A DOUBLE WORD BOUNDARY      41600019
WTOEND   EQU   *                   WTO ENDS ON A DOUBLE WORD BOUNDARY   41700019
*********************************************************************** 41800019
NOPCCW   DC    X'0300000000000001' NO-OP COMMAND ON DOUBLE WORD BNDARY  41900019
*********************************************************************** 42000019
WTOSIZE  EQU   WTOEND-WTOBEGIN     LENGTH OF WTO LIST FORM              42100019
* +0  1 BYTE                                                            42200019
* +1  2 BYTES  MESSAGE LENGTH                                           42300019
* +3  1 BYTE   MCSFLAGS                                                 42400019
* +4  MAX OF 72 BYTES  MESSAGE ID                                       42500019
*                      MESSAGE TEXT                                     42600019
*                TOTAL = 24 BYTES                                       42700019
* +28 2 BYTES  DESCRIPTOR CODE                                          42800019
* +30 2 BYTES  ROUTING CODE                                             42900019
* +32 2 BYTES  SVC 35                                                   43000019
*                                                                       43100019
*  NOTE    UNIT ADDRESS AT +14                                          43200019
*          VOLUME PARAM AT +18                                          43300019
**********************************************************************  43400019
*                                                                       43500019
* BELOW ARE ROUTINES USED BY OCR PROCESSING                             43600019
*                                                                       43700019
*********************************************************************** 43800019
*                                                                Y02967 43900002
*                                                                Y02967 43960002
ZAPSZAPS DC    8C'ZAPSZAPS'             WORKAREA SPACE           Y02967 44020002
*                                                                       44100019
TABLE    DC    C'      '           FIRST ENTRY FILLER                   44200019
*                                                                       44300019
GETLFID  DC    C'VA    '           ID-TTR-L  1                          44400019
GETLVUID DC    C'VB    '           ID-TTR-L  2                          44500019
GETMFID  DC    C'VC    '           ID-TTR-L  3                          44600019
GETMVUID DC    C'VD    '           ID-TTR-L  4                          44700019
SYNCHID  DC    C'VE    '           ID-TTR-L  5                          44800019
READID   DC    C'VF    '           ID-TTR-L  6                          44900019
CHECKID  DC    C'VG    '           ID-TTR-L  7                          45000019
CNTRLID  DC    C'VH    '           ID-TTR-L  8                          45100019
RDLNEID  DC    C'VI    '           ID-TTR-L  9                          45200019
DSPLYID  DC    C'VJ    '           ID-TTR-L  10                         45300019
RESCNID  DC    C'VK    '           ID-TTR-L  11                         45400019
EOBID    DC    C'CC    '           ID-TTR-L  12                         45500019
         DC    H'0'                END OF TABLE                         45600019
         DC   2H'0'                FILLER                               45700019
         DC    C'019'              OPEN SVC                             45800019
         DC    AL1(117)            START OF TABLE FROM BEGINNING OF     45900019
*                                  MODULE                               46000019
**********************************************************************  46100019
*********************************************************************** 46200019
         IEZDEB LIST=YES                                         Y02967 46300002
**********************************************************************  47400019
         DCBD  DSORG=PS,DEVD=OR                                @YM00635 47500002
**********************************************************************  47600019
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @YM02503 47700002
         IKJTCB                                                  Y02967 47760002
         IHARB                                                   Y02967 47820002
**********************************************************************  47900019
CVT      DSECT                                                          48000019
         CVT                                                            48100019
         END                                                            48200019
         END                                                            90600019
