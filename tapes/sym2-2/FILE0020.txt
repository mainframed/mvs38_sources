./  ADD  SSI=20480117,NAME=IFFAAA01
*TITLE         INIGSP (PART2)                                           00900021
*********************************************************************** 01800021
*                                                                     * 02700021
*TITLE              INGSP(PART 2)       INITIATE GSP                  * 03600021
*                                                                     * 04500021
*MODULE NAME        IFFAAA01                                          * 05400021
*                                                                     * 06300021
*ENTRY              IFFAAA01                                          * 07200021
*                                                                     * 08100021
*INPUT- SET UP BY INGSP PART 1. REGISTER 1 POINTS TO A PARAMETER LIST * 09000021
*   +0  ADDRESS OF A 1K STORAGE AREA SP=0                             * 09900021
*    FIRST WORD OF STORAGE AREA CONTAINS ADDRESS OF PARAMETER LIST    * 10800021
*    AS PASSED TO INGSP PART 1                                        * 11700021
*                                                                     * 12600021
*OUTPUT  ADDRESS OF GSPCB IN FIRST PARAMETER PASSED TO INGSP PART 1   * 13500021
*                                                                     * 14400021
*FUNCTION/OPERATION- THE FIELDS OF THE GSPCB ARE INITIALIZED. THE     * 15300021
*   STATUS TABLE (IFFAHA12) AND PART 2 OF THE DIRECTOR (IFFAHA11)     * 16200021
*   ARE LOADED FROM THE LINKLIB AND THEIR ADDRESSES PLACED IN THE     * 17100021
*   GSPCB.                                                            * 18000021
*EXTERNAL MACROS-LOAD                                                 * 18900021
*                                                                     * 19800021
*EXITS-RETURN TO CALLER VIA REGISTER 14                               * 20700021
*      ERROR- GSPNAME FIELD SET TO ZERO- RETURN VIA REGISTER 14       * 21600021
*                                                                     * 22500021
*TABLES/WORKAREAS- SEE GSPCB,PSECT DSECTS                             * 23400021
*                                                                     * 24300021
*ATTRIBUTES-REENTRANT                                                 * 25200021
*                                                                     * 26100021
*********************************************************************** 27000021
         EJECT                                                          27900021
*                                                                       28800021
*                          --REGISTER EQUATES                           29700021
*                                                                       30600021
R0       EQU   0                                                        31500021
R1P      EQU   1                                                        32400021
R2WRK    EQU   2                                                        33300021
R3WRK    EQU   3                                                        34200021
R4WRK    EQU   4                                                        35100021
R5WRK    EQU   5                                                        36000021
R9BASE   EQU   9                                                        36900021
RTWRK    EQU   10                                                       37800021
R13      EQU   13                                                       38700021
         EJECT                                                          39600021
IFFAAA01 CSECT                                                          40500021
         SAVE  (14,12)                 ENTRY HOUSEKEEPING               41400021
         BALR  R9BASE,0                                                 42300021
         USING *,R9BASE                                                 43200021
         LR    R2WRK,R1P               ESTABLISH GSPCB ADDRESSIBILITY   44100021
         USING GSPCB,R2WRK                                              45000021
         L     R3WRK,0(R2WRK)          GET ADDRESS OF USER PLIST        45900021
         USING PSECT,R3WRK                                              46800021
         XC    GSPCB(GSPCBLNG),GSPCB   CLEAR GSPCB TO ZERO              47700021
         ST    R13,TEMPSAVE+4          CHAIN SAVE AREAS                 48600021
         LA    R13,TEMPSAVE            EXTABLIST SAVE AREA              49500021
         L     R4WRK,GSPNAME           GET ADDRESS OF GSP ADDR RTRNFLD  50400021
         ST    R2WRK,0(R4WRK)          STORE INTO RETURN FIELD          51300021
         TM    GSPNAME,X'80'           TEST IF GSPNAME IS ONLY INPUT,   52200021
         BO    AAA300                  BRANCH IF REQ PARMS NOT PRESENT  53100021
AAA020   L     R4WRK,NULLVAR           STORE NULL VARIABLE ADDRESS      54000021
         LA    R4WRK,0(R4WRK)          INTO GSPCB                       54900021
         ST    R4WRK,GSPNULLV                                           55800021
*                                                                       56700021
*                          --INITIALIZE GSPCB                           57600021
*                                                                       58500021
AAA080   MVC   GSPSYSID(2),IDFIELD     SET HALFWORD IDENT FIELD         59400021
         LA    R4WRK,GSPASTAT+8        WORK AREA FOLLOWS ADDR           60300021
         ST    R4WRK,GSPAWORK          OF STATUS TABLE                  61200021
*                                                                       62100021
*                          --LOAD STATUS TABLE, DIRECTOR PART2          63000021
*                                                                       63900021
         L     R4WRK,16                                                 64800021
         L     R4WRK,CVTLINK(R4WRK)    GET LINKLIB DCB FROM CVT         65700021
         LOAD  EP=IFFAHA12             LOAD STATUS TABLE                66600021
         ST    R0,GSPASTAT             STORE ADDRESS IN GSPCB           67500021
         LOAD  EP=IFFAHA11             LOAD DIRECTOR, PART 2            68400021
         ST    R0,GSPDCTR2             STORE ADDRESS IN GSPCB           69300021
*                                                                       70200021
*                          --GSPCB INITIALIZED, SET TO EXIT             71100021
*                                                                       72000021
AAA900   L     R13,TEMPSAVE+4                                           72900021
         RETURN (14,12),T                                               73800021
*                                                                       74700021
AAA300   L     R5WRK,GSPNAME                                            75600021
         XC    0(4,R5WRK),0(R5WRK)     SET VARIABLE TO ZERO IF INVALID  76500021
         B     AAA900                                                   77400021
         EJECT                                                          78300021
*                                                                       79200021
*                          --EQUATES AND CONSTANTS                      80100021
*                                                                       81000021
CVTLINK  EQU   8                                                        81900021
IDFIELD  DC    X'F201'                 IDENTIFIEL GSPCB                 82800021
         EJECT                                                          83700021
         COPY  GSPCB                                                    84600021
*                                                                       85500021
*                          --DUMMY SECTIONS                             86400021
*                                                                       87300021
         EJECT                                                          88200021
*WORK AREA FOLLOWS GSPCB                                                89100021
GSPCBLNG EQU   *-GSPCB                                                  90000021
TEMPSAVE DS    9D            USER WORK AREA FOR SAVE AREA               90900021
         EJECT                                                          91800021
PSECT    DSECT                         PARAMETER LIST DSECT             92700021
GSPNAME  DS    A                                                        93600021
NULLVAR  DS    A                                                        94500021
         END                                                            95400021
./  ADD  SSI=20480136,NAME=IFFAAA02
*TITLE         TERMINATE GSP PART 2                                     00900021
*********************************************************************** 01800021
*                                                                     * 02700021
*TITLE              TMGSP(PART 2)       TERMINATE GSP                 * 03600021
*                                                                     * 04500021
*MODULE NAME        IFFAHA02                                          * 05400021
*                                                                     * 06300021
*ENTRY              IFFAHA02 - VIA LINK FOR TMGSP PART 1              * 07200021
*                                                                     * 08100021
*FUNCTION/OPERATION                                                   * 09000021
*   CALLS TMDEV, CAUSING ALL GRAPHIC DATA SETS AND DEVICES TO BE      * 09900021
*   TERMINATED. DELETES ALL LOADED GSP SUBROUTINES AS INDICATED IN    * 10800021
*   THE STATUS TABLE                                                  * 11700021
*                                                                     * 12600021
*INPUT- REGISTER 6 CONTAINS THE ADDRESS OF THE GSPCB                  * 13500021
*                                                                     * 14400021
*OUTPUT-NONE TO CALLER                                                * 15300021
*                                                                       16200021
*EXTERNAL MACROS - LINK, DELETE                                       * 17100021
*                                                                     * 18000021
*EXITS- BACK TO TMGSP PART 1 VIA REGISTER 14                          * 18900021
*                                                                     * 19800021
*WORKAREAS- SEE WKSECT DSECT                                          * 20700021
*                                                                     * 21600021
*ATTRIBUTES - REENTRANT                                               * 22500021
*                                                                     * 23400021
*********************************************************************** 24300021
         EJECT                                                          25200021
*                                                                       26100021
*REGISTER UTILIZATION                                                   27000021
*                                                                       27900021
R0       EQU   0                                                        28800021
R1       EQU   1                                                        29700021
R2       EQU   2                                                        30600021
R3       EQU   3                                                        31500021
R4       EQU   4                                                        32400021
R5       EQU   5                                                        33300021
R6       EQU   6                                                        34200021
R7       EQU   7                                                        35100021
R8       EQU   8                                                        36000021
R9       EQU   9                                                        36900021
R10      EQU   10                                                       37800021
R11      EQU   11                                                       38700021
R13      EQU   13                                                       39600021
         EJECT                                                          40500021
IFFAAA02 CSECT                                                          41400021
         SAVE  (14,12)                                                  42300021
         BALR  R11,R0                                                   43200021
         USING *,R11                   ESTABLISH CSECT ADDRESSABILITY   44100021
         USING GSPCB,R6                ESTABLISH GSPCB ADDRESSABILITY   45000021
         L     R10,GSPAWORK            GET WORK AREA ADDR FROM GSPCB    45900021
         LA    R10,88(R10)             COMPUTE WORK AREA ADDR           46800021
         USING WRKSECT,R10             SET WORK AREA ADDRESSABILITY     47700021
         ST    R13,SVAREA+4            CHAIN SAVE AREAS                 48600021
         LA    R2,SVAREA                                                49500021
         ST    R2,8(R13)                                                50400021
         LR    R13,R2                  SET SAVE AREA REG                51300021
         LA    R2,1                    INITIALIZE DEVICE SW             52200021
TR2C3    L     R3,GSPGTMCB             GET GTMCB ADDR                   53100021
         LTR   R3,R3                   IS THERE A CHAIN                 54000021
         BZ    TR2C4                   NO                               54900021
TR2D3    L     R5,16                                                    55800021
         L     R5,CVTLINK(R5)          GET LINKLIB DCB ADDR             56700021
         ST    R3,IGRAFD               PUT GTMCB ADDR IN VARIABLE       57600021
         LA    R4,IGRAFD                                                58500021
         ST    R4,PLIST                SETUP PARAM LIST FOR TMDEV       59400021
         LA    R4,PLIST                SIMULATE DCTR SETUP              60300021
         ST    R4,TRMDEV               SET UP PARAM FOR TRMDEV          61200021
         LA    R4,GSPARRAY             GET RETURN ARRAY ADDR            62100021
         ST    R4,TRMDEV+4             COMPLETE PLIST                   63000021
         LA    R1,TRMDEV                                                63900021
         XC    SUPPLIST(16),SUPPLIST                                    64800021
         LINK  EP=IFFAAA04,MF=(E,(1)),SF=(E,SUPPLIST)                   65700021
         B     TR2C3                                                    66600021
TR2C4    L     R5,GSPASTAT             GET STATUS TABLE ADDR            67500021
         LR    R4,R5                                                    68400021
         LA    R7,56                   SET LOOP CONTROL                 69300021
TR2D4    L     R3,0(R5)                GET EP ADDR                      70200021
         LTR   R3,R3                   IS MODULE LOADED                 71100021
         BZ    TR2F4                                                    72000021
         MVC   EPLOC+4(4,R4),4(R5)     COMPLETE MODULE NAME             72900021
         LA    R0,EPLOC(R4)            LOAD MODULE NAME ADDR            73800021
         DELETE EPLOC=(0)                                               74700021
TR2F4    LA    R5,12(R5)               GET ADDR OF NEXT STATAB ENTRY    75600021
         BCT   R7,TR2D4                                                 76500021
TR2F4A   LTR   R2,R2                   ARE ALL MODULES DELETED          77400021
         BZ    TR2G4                   YES                              78300021
         LA    R7,14                   RESET LOOP CONTROL               79200021
         SR    R2,R2                   INDICATE ALL DEVICES DELETED     80100021
         LA    R5,120(R5)                                               81000021
         B     TR2D4                                                    81900021
TR2G4    L     R13,SVAREA+4                                             82800021
         RETURN (14,12),T                                               83700021
         COPY  GSPCB                                                    84600021
*                                                                       85500021
*CONSTANTS AND DSECTS                                                   86400021
*                                                                       87300021
EPLOC    EQU   70*12+120                                                88200021
CVTLINK  EQU   8                                                        89100021
WRKSECT  DSECT                                                          90000021
SVAREA   DS    18F                                                      90900021
IGRAFD   DS    F                                                        91800021
SUPPLIST DS    4F                                                       92700021
PLIST    DS    F                                                        93600021
TRMDEV   DS    10F                                                      94500021
         END                                                            95400021
./  ADD  SSI=80330199,NAME=IFFAAA03
         TITLE 'INDEV - INITIALIZE DEVICE ROUTINE'          D11         00200000
*                                                                       00400000
*                                                                       00600000
*        INDEV IS ENTERED FROM DIRECTOR PART 2 WITH THE ADDRESS OF      00800000
*        THE WORK AREA IN REGISTER 1. THE FIRST WORD OF THE WORK        01000000
*        AREA CONTAINS THE ADDRESS OF THE PARAMETER LIST LISTED         01200000
*        BELOW.                                                         01400000
*                                                                       01600000
*                        +0  A(GSPCBVAR)                                01800000
*                        +4  A(UNITVAR)                                 02000000
*                        +8  A(GTMCBVAR)                                02200000
*                        +12 A(GDOALNVAR)   OPTIONAL                    02400000
*                                                                       02600000
*                                                                       02800000
*                                                                       03000000
*        INDEV WILL LOAD THE FOLLOWING ROUTINES             D11         03200000
*        IF THEY ARE NOT ALREADY LOADED:                    D11 ZA15418 03400000
*        BUFFER MANAGEMENT-IFFAHAO2                                     03600000
*        DATA GENERATOR   -IFFAHAO4                                     03800000
*        DATA STORE       -IFFAHA05                                     04000000
*        SCALE            -IFFAHAO6                                     04200000
*        SCISSOR          -IFFAHAO7                                     04400000
*        UPDATE           -IFFAHA13/14                      D11 ZA15418 04600000
*                                                                       04800000
*        EXTERNAL REFERENCES ARE MADE TO :                              05000000
*                                                                       05200000
*        INGDS-IFFAAAO5                                                 05400000
*                                                                       05600000
*        EXTERNAL MACROS USED ARE:                                      05800000
*                                                                       06000000
*        GETMAIN                                                        06200000
*        SPAR                                                           06400000
*        SAEC                                                           06600000
*        LINK                                                           06800000
*        LOAD                                                           07000000
*        OPEN                                                           07200000
*        CLOSE                                                          07400000
*        FREEMAIN                                                       07600000
*                                                                       07800000
         EJECT                                                          08000000
*                                                                       08200000
*        ON ENTRY THE BASE REGISTER IS SET UP, REGISTERS ARE SAVED,     08400000
*        THE RETURN ARRAY IS INITIALIZED, AND THE WORK AREA DSECT       08600000
*        IS INITIALIZED.                                                08800000
*                                                                       09000000
*0873,302000,310000,526000,570000                                  4746 09200000
*2023,562000                                                       4324 09400000
*0114,434000,442000-444000,458000-466000,474000,486000-488000,     000A 09600000
*0114,492000,574000-584000,714000,870000-876000                    000A 09800000
*C370000-374000,D932000,C398000,C232000-234000                   A37988 10000000
*A616200-617600,789000                                      D11 ZA15418 10200000
         EJECT                                              D11         10400000
IFFAAA03 CSECT                                              D11         10600000
GSPTIN   SAVE  (14,12)                                                  10800000
         BALR  BASE,0              ESTABLISH ADDRESSABILITY             11000000
         USING *,BASE                                                   11200000
         LR    WORK,PARM           ADDR OF WORK AREA                    11400000
         USING WORKCORE,WORK       WORK DSECT                           11600000
         SPACE 5                                                        11800000
*                                                                       12000000
*        THE PARAMETERS ARE CHECKED FOR VALIDITY NEXT AND ERROR         12200000
*        RETURNS ARE MADE IF THEY ARE INVALID. THE GDOA LENGTH          12400000
*        PARAMETER IS NOT CHECKED FOR VALIDITY.                         12600000
*                                                                       12800000
         L     PARM,WRKPARM        PARM LIST IN REG                     13000000
         L     REGA,GSP(PARM)      VARIABLE WITH GSPCB ADDR             13200000
         L     GSPREG,ZERO(REGA)   GSPCB ADDR                           13400000
         USING GSPCB,GSPREG        GSPCB DSECT                          13600000
         L     ERRCD,WRKRTNCD      RETURN CODE ARRAY ADDR               13800000
         XC    ZERO(20,ERRCD),ZERO(ERRCD) ZERO RETURN ARRAY             14000000
         XC    WRKSPVSR(12),WRKSPVSR ZERO SUPERVISOR PARAMETER LIST     14200000
         CLI   GSPCBID,GSPID       VALID GSPCB                          14400000
         BNE   ERR1                NO                                   14600000
         LTR   REGA,REGA           ANY MORE PARMS                       14800000
         BL    ERR2                NO                                   15000000
         SR    GTMREG,GTMREG       SET TO ZERO UNTIL GETMAIN            15200000
         L     REGA,LOGUNT(PARM)   LOAD ADDR OF LOGICAL UNIT            15400000
         L     REGB,ZERO(REGA)     LOAD UNIT INTO REG                   15600000
         C     REGB,SMALLEST       UNIT LESS THAN SMALLEST ALLOWED      15800000
         BL    ERR3                YES                                  16000000
         C     REGB,LARGEST        UNIT GR THAN LARGEST                 16200000
         BH    ERR3                YES                                  16400000
         LTR   REGA,REGA           IS ANOTHER PARM PASSED               16600000
         BL    ERR2                NO                                   16800000
         EJECT                                                          17000000
*                                                                       17200000
*        MAIN STORAGE FOR THE CONTROL BLOCK, DCB, GACBS, COM AREAS,     17400000
*        AND THE BUFFER CONTROL TABLE ARE OBTAINED WITH A CONDITIONAL   17600000
*        GETMAIN REQUEST.  IF THE STORAGE IS NOT AVAILABLE THE          17800000
*        ROUTINE WILL EXIT WITH AN ERROR CODE TO THE CALLER.            18000000
         ST    SAVE,WRKSAVE+4      SAVE HIS AREA IN MINE                18200000
         LA    REGB,WRKSAVE        SAVE MY ADDR IN HIS                  18400000
         ST    REGB,EIGHT(SAVE)                                         18600000
         LR    SAVE,REGB           SET UP SAVE REG                      18800000
         LA    REGB,GTMLEN         COMPUTE LENGTH OF CORE               19000000
         LA    REGB,GACBLEN3(REGB) ADD 3 GACB LENS                      19200000
         LA    REGC,DCBLEN         LENGTH OF DCB                        19400000
         AR    REGB,REGC           REQUIRED                             19600000
         A     REGB,BCTLEN                                              19800000
         ST    REGB,FAKE           SAVE LENGTH                          20000000
*        THIS DOES NOT IMPAIR REENTERANCY                               20200000
         GETMAIN EC,LV=(REGB),A=WRKLIST,SP=0,MF=(E,WRKGETMN) GET CORE   20400000
         LTR   15,15               CORE AVAILABLE                       20600000
         BNE   ERR4                                                     20800000
         L     GTMREG,WRKLIST      LOAD ADDR OF AREA                    21000000
         USING GTMCB,GTMREG                                             21200000
         EJECT                                                          21400000
*                                                                       21600000
*        THE DCB SKELETON IS MOVED INTO THE GETMAIN CORE AND THE        21800000
*        UNIT PARAMETER IS CONVERTED TO DECIMAL, UNPACKED AND PLACED    22000000
*        IN THE DCB.  THE DCB IS THEN OPENED.  IF THE OPEN IS           22200000
*        UNSUCCESSFUL OR IF THE DEVICE IS ALREADY OPEN FOR ANOTHER      22400000
*        GTMCB THE DCB IS CLOSED IF NECESSARY(IN THE SECOND CASE)       22600000
*        AND THE STORAGE IS FREED.  THEN THE PROGRAM RETURNS TO         22800000
*        THE CALLER WITH A RETURN CODE.                                 23000000
         MVC   ZERO(GTMLEN,GTMREG),SKELGTM MOVE IN SKELETON CTL BLK     23200000
         ST    GTMREG,GTMGTMCB     PLACE ADDR IN CTL BK                 23400000
         ST    GSPREG,GTMGSPCB     ADDRESS OF THE GSPCB                 23600000
         MVC   DCB(DCBLEN),DCB1    MOVE IN SKELETON DCB                 23800000
         L     REGA,0(REGA)        VALUE IN REG                         24000000
         CVD   REGA,WRKGETMN       CONVERT IT TO DECIMAL                24200000
         UNPK  WRKLIST(4),WRKGETMN+6(3)                                 24400000
         MVC   DCB+DDNM(TWO),WRKLIST ADD TO DDNAME                      24600000
         MVI   WRKGETMN,128                                             24800000
         OPEN  (DCB),MF=(E,WRKGETMN)                                    25000000
         TM    DCBOFLG,XOPNFLG    TEST FOR SUCCESSFUL OPEN       A37988 25200000
         BZ    ERR3               BRANCH IF DCB NOT OPEN         A37988 25400000
         LA    REGA,DCB            DCB ADDR                             25600000
         ST    REGA,GTMGRDCB       IN GTMCB                             25800000
         L     REGA,DEB(REGA)      ADDR OF DEB                          26000000
         L     REGA,UCB(REGA)      ADDR OF UCB                          26200000
         EJECT                                                          26400000
*                                                                       26600000
*        THE UCB FEATURES ARE MOVED INTO THE GTMCB. STANDARD FEATURES   26800000
*        ARE ADDED (DEPENDING ON THE 2250 MODEL) TO THE OPTIONAL        27000000
*        FEATURE FLAGS ALREADY SET IN THE UCB.                          27200000
*        FOR A MODEL 1 2250 THE FLAGS THAT ARE SET BY VALUE RATHER      27400000
*        THAN BY BIT ARE CHANGED TO BIT FLAGS.                          27600000
*                                                                       27800000
         MVC   GTMFEATS,UCBTYP(REGA) MOVE IN UCB TYPE                   28000000
         MVC   GTMDVADR,PHYSADDR(REGA) PHYS ADDR OF DEVICE              28200000
         NI    GTMDVADR,CHAN       REMOVE ALL BUT CHANNEL ADDR          28400000
         L     REGA,GSPGTMCB                                            28600000
TIN00010 LTR   REGA,REGA                                                28800000
         BZ    TIN00020                                                 29000000
         CLC   DVADRDSP(2,REGA),GTMDVADR  SAME TERMINAL                 29200000
         BE    ERR3                ERROR                                29400000
         L     REGA,NXGTMDSP(REGA)      NEXT ONE                        29600000
         B     TIN00010                                                 29800000
TIN00020 TM    GTMFEATS,MODEL3     MODEL 3                              30000000
         BO    TIN00060            YES                                  30200000
         TM    GTMFEATS,MODEL2     MODEL 2                              30400000
         BO    TIN00070                                                 30600000
         MVC   GTMFEATS+2(1),GTMFEATS+1 MOVE BYTE OVER ONE              30800000
         NI    GTMFEATS+2,X'0F'    GET RID OF TOP 4 BITS                31000000
*                                  NOTE: BECAUSE THE SWITCHES ARE       31200000
*                                  SET BY VALUE THE CHECK WOULD REQUIRE 31400000
*                                  TEN TM INSTR IF NOT DONE THIS WAY.   31600000
         NI    GTMFEATS+1,X'F0'                                         31800000
         CLI   GTMFEATS+2,GDF+CHAR GDF & CHAR GEN                       32000000
         BNL   TIN00100                                            4746 32200000
         CLI   GTMFEATS+2,GDF      GDF ONLY                             32400000
         BNL   TIN00090                                                 32600000
         CLI   GTMFEATS+2,CHAR     CHAR GEN ONLY                        32800000
         BNL   TIN00080                                            4746 33000000
         EJECT                                                          33200000
*                                                                       33400000
*        THE BUFFER CONTROL TABLE IS THEN SET TO ZERO AND THE           33600000
*        SYSTEM GDS IS OPENED.  THE SYSTEM GDS HAS A 256 BYTE           33800000
*        GDOA AND IT IS A LEVEL 2 GDS.  THEN FLOW CONTROL MANAGEMENT    34000000
*        IS CALLED TO INITIALIZE THE FLOW CONTROL TABLE AND THE         34200000
*        FLOW CONTROL STRUCTURE IN THE BUFFER.  IF THE CALL             34400000
*        TO FLOW CONTROL MANAGEMENT IS UNSUCCESSFUL, THE DCB            34600000
*        IS CLOSED, THE SYSTEM GDS IS TERMINATED, AND THE STORAGE       34800000
*        OBTAINED IS RELEASED.                                          35000000
*                                                                       35200000
TIN00050 XC    BCT(256),BCT        ZERO OUT START OF BCT                35400000
         XC    BCT+256(BCTLEN1-256),BCT+256 ZERO OUT REST OF BCT        35600000
         LA    REGB,BCT                                                 35800000
         ST    REGB,GTMBCTBL       ADDR OF BCT                          36000000
         LA    REGA,GTMSYGDS       SYSTEM GDS                           36200000
         ST    REGA,WRKGETMN+4     SET UP PARM LIST FOR OPEN            36400000
         LA    REGA,GTMGTMCB       VARIABLE CONTAINING GTMCB ADDR       36600000
         ST    REGA,WRKGETMN       IN PARM LIST                         36800000
         LA    REGA,TWFIFSX        GDOA LEN IS 256                      37000000
         ST    REGA,WRKGETMN+8                                          37200000
         LA    REGA,TWO            LEVEL2                               37400000
         ST    REGA,WRKLIST                                             37600000
         LA    REGA,WRKLIST        ADDRESS OF LEVEL VAR                 37800000
         ST    REGA,WRKGETMN+12                                         38000000
         OI    WRKGETMN+12,X'80'   SET LAST PARAMETER FLAG              38200000
         LA    PARM,WRKGETMN                                            38400000
*///           OPEN GDS                                                 38600000
*///                                                                    38800000
         ST    PARM,WRKPARM1           SET UP PTRS TO PARM LIST  A37988 39000000
         MVC   WRKRTN1(FOUR),WRKRTNCD  POINTER TO GSPARRAY       A37988 39200000
         LA    PARM,WRKPARM1          SET UP INPUT FOR HA01      A37988 39400000
         L     REGA,16                                                  39600000
         L     REGA,CVTLINK(REGA)  ADDR OF LINKLIB DCB                  39800000
         LINK  EP=IFFAAA05,MF=(E,(1)),SF=(E,WRKSPVSR)                   40000000
         CLI   0(ERRCD),X'00'      WAS THERE AN ERROR                   40200000
         BNE   ERR5B               YES, ERROR IN OPEN                   40400000
         EJECT                                                          40600000
         LA    REGB,ONE            CODE FOR FLOW CTL                    40800000
         ST    REGB,WRKGETMN       FOR FLOW CTL                         41000000
         ST    GTMREG,WRKGETMN+4                                        41200000
*                   CALL FLOW CONTROL WITH CODE 1 TO INITALIZE  FCT     41400000
         LA    PARM,WRKPARM1          SET UP INPUT FOR HA01      A37988 41600000
         LINK  EP=IFFAHA01,MF=(E,(1)),SF=(E,WRKSPVSR)                   41800000
         CLI   0(ERRCD),X'00'      WAS THERE AN ERROR                   42000000
         BNE   ERR5                YES                                  42200000
         EJECT                                                          42400000
*                                                                       42600000
*        THE GACBS AND COM AREAS ARE ZEROED AND THE POINTERS ARE        42800000
*        INITIALIZED.  EACH GACB POINTS TO THE GTMCB, THE NEXT          43000000
*        GACB, AND TO ITS OWN COM AREA.  THE GACBS ARE CHAINED SO       43200000
*        THAT THE GRMCB POINTS TO THE GSP GACB, THAT ONE POINTS TO      43400000
*        THE DIRECT ENTRY GACB, (NOT YET IMPLEMENTED) AND THAT          43600000
*        ONE POINTS TO THE PANIC GACB.  THEY ARE SPARED SUCH THAT       43800000
*        THE GASP GACB HAS PRIORITY 0, THE DIRECT ENTRY GACB HAS        44000000
*        PRIORITY 1, AND THE PANIC GACB HAS PRIORITY 127.               44200000
*                                                                       44400000
TIN00030 XC   GACB1PTR(GACBLEN3),GACB1PTR                               44600000
         LA    REGA,DCB            ADDR OF DCB                          44800000
         ST    REGA,GACB1+4        IN GACB1                             45000000
         ST    REGA,GACB3+4        IN GACB3                             45200000
         LA    REGA,COM1           COMM                                 45400000
         ST    REGA,GACB1          IN GACB1                             45600000
         LA    REGA,COM3                                                45800000
         ST    REGA,GACB3                                               46000000
*///                               OBTAIN ENTRY POINT TO ATTN HNDG AND  46200000
*///                               PANIC ATTN IN REGA, PANIC IN REGB    46400000
         SAEC  EP=0,RESTART=NO,MF=(E,GACB1)                             46600000
         SAEC  EP=0,RESTART=NO,MF=(E,GACB3)                             46800000
         EJECT                                                          47000000
         MVC   WRKGETMN(EIGHT),SPAR1                                    47200000
         SPAR  (GACB1),PRTY=0,MF=(E,WRKGETMN)                           47400000
         SPAR  (GACB3),PRTY=1,MF=(E,WRKGETMN)                           47600000
         LA    REGA,GACB1PTR       PLACE ADDR OF GACB IN                47800000
         ST    REGA,GTMGACBA       GTMCB                                48000000
         LA    REGA,GACB3PTR       CHAIN THE GACBS                      48200000
         ST    REGA,GACB1PTR                                            48400000
         ST    GTMREG,GACB1GTM     STORE GTMCB ADDR IN GACBS            48600000
         ST    GTMREG,GACB3GTM                                          48800000
         MVC   GTMNXGTM(4),GSPGTMCB ADD GTMCB TO CHAIN OF               49000000
         ST    GTMREG,GSPGTMCB     GTMCBS IN GSPCB                      49200000
         L     REGA,WRKPARM        PARM LIST ADDR                       49400000
         L     REGB,8(REGA)        ADDR OF GTMCB VAR                    49600000
         ST    GTMREG,0(REGB)      STORE ADDR OF GTMCB IN VAR           49800000
         TM    8(REGA),X'80'       ANY MORE PARMS                       50000000
         BO    TIN05400                                                 50200000
         CLC   13(3,REGA),GSPNULLV+1 IS IT NULL                         50400000
         BE    TIN05400            YES                                  50600000
         EJECT                                                          50800000
*                                                                       51000000
*        IF THE GDOA LENGTH WAS PASSED, IT IS PLACED IN THE GTMCB.      51200000
*        THE KEYBOARD IS UNLOCKED NEXT.                                 51400000
*        THE INTERNAL ROUTINES ARE CHECKED IN THE STATUS TABLE AND      51600000
*        ARE LOADED IF NECESSARY.  THE ROUTINE THEN RETURNS TO          51800000
*        THE CALLING PROGRAM WITH A SUCCESSFUL RETURN CODE.             52000000
*                                                                       52200000
         L     REGB,GDOA(REGA)     NO                                   52400000
         MVC   GTMGDOAL(2),2(REGB) MOVE IT IN                           52600000
TIN05400 L     PARM,GTMDECB1                                            52800000
         L     REGA,GTMGRDCB       LOAD DCB ADDR                        53000000
         WAIT  ECB=(1)             WAIT                                 53200000
         L     PARM,GTMDECB1       NOW WE WILL UNLOCK THE KEYBOARD      53400000
         GREADR (PARM),MIP,(REGA),WRKGETMN,MF=E                         53600000
         B     TIN00120            GO TO LOAD INTERNAL ROUTINES         53800000
TIN00055 L     SAVE,4(SAVE)        RESET SAVE REG                       54000000
         RETURN (14,12),T                                               54200000
TIN00060 OI    GTMFEATS+1,LP+ABS SET BITS FOR LP & ABS VECT             54400000
         NI    GTMFEATS+1,X'F0'    CLEAR OUT LOWER FOUR BITS            54600000
         OI    GTMFEATS+1,GDFSW+CHARSW CHARGEN & GDF(INCR VECT)         54800000
         B     TIN00050                                                 55000000
TIN00070 OI    GTMFEATS+1,ABS      ABSOLUTE VECT                        55200000
         NI    GTMFEATS+1,X'F0'    CLEAR OUT LOWER FOUR BITS            55400000
TIN00080 OI    GTMFEATS+1,CHARSW   CHAR ONLY                       4746 55600000
         B     TIN00050                                                 55800000
TIN00090 OI    GTMFEATS+1,GDFSW    GDF ONLY                             56000000
         B     TIN00050                                                 56200000
TIN00100 OI    GTMFEATS+1,CHARSW+GDFSW  CHAR GEN AND GDF           4746 56400000
         B     TIN00050                                                 56600000
TIN00120 L     REGA,STAT(ERRCD)    LOAD ADDR OF STATUS TABLE            56800000
         L     REGB,BMGT(REGA)     LOAD ADDR OF BUFFER MGT              57000000
         LTR   REGB,REGB           IS IT ALREADY LOADED                 57200000
         BNE   TIN00055            YES, EXIT                            57400000
         L     REGC,16             ADDR OF CVT                          57600000
         L     REGC,CVTLINK(REGC)  ADDR OF LINK LIBRARY DCB             57800000
         LOAD  EP=IFFAHA02                                              58000000
         ST    REGZERO,BMGT(REGA)  ADDR IN STATUS TABLE                 58200000
         LOAD  EP=IFFAHA04                                              58400000
         ST    REGZERO,DGEN(REGA)  ADDR IN STATUS TABLE                 58600000
         LOAD  EP=IFFAHA05                                              58800000
         ST    REGZERO,DSTOR(REGA) ADDR IN STATUS TABLE                 59000000
         LOAD  EP=IFFAHA06                                              59200000
         ST    REGZERO,SCALE(REGA)  ADDR IN STATUS TABLE                59400000
         SR    REGB,REGB                                           000B 59600000
         IC    REGB,SCALE+9(REGA)  PICK UP CONVERT ENTRY COUNT     000B 59800000
         MH    REGB,H12            COMPUTE DISPLACEMENT            000B 60000000
         AH    REGZERO,SCALE+10(REGA) COMPUTE ENTRY POINT          000B 60200000
         ST    REGZERO,0(REGB,REGA) STORE IN ENTRY                 000B 60400000
         OI    SCALE+8(REGA),X'08' SET SW, SCALE LOADED            000B 60600000
         LOAD  EP=IFFAHA07                                              60800000
         ST    REGZERO,SCISS(REGA) ADDR IN STATUS TABLE                 61000000
         LOAD  EP=IFFAHA13         UPDATE                   D11 ZA15418 61200000
         ST    REGZERO,UPDATE(REGA) SAVE ADDR IN STATABLE   D11 ZA15418 61400000
         SR    REGB,REGB                                    D11 ZA15418 61600000
         IC    REGB,UPDATE+9(REGA) PICKUP H14 ENTRY COUNT   D11 ZA15418 61800000
         MH    REGB,H12            STATAB ENTRY IS LEN=12   D11 ZA15418 62000000
         AH    REGZERO,UPDATE+10(REGA) COMPUTE H14 EP       D11 ZA15418 62200000
         ST    REGZERO,0(REGB,REGA) SAVE IN H14 STATAB ENT  D11 ZA15418 62400000
         OI    UPDATE+8(REGA),X'08' INDICATE LOADED         D11 ZA15418 62600000
         B     TIN00055            RETURN                               62800000
         EJECT                                                          63000000
ERR1     LA    REGA,ONE            BAD GTMCB                            63200000
ERR1A    ST    REGA,PARE(ERRCD)                                         63400000
         MVI   ZERO(ERRCD),PARMER                                       63600000
ERR1B    RETURN (14,12),T                                               63800000
ERR2     LA    REGA,ZERO                                                64000000
         B     ERR1A                                                    64200000
ERR3     MVC   PARE(4,ERRCD),TWOFLD  BAD UNIT                           64400000
         MVI   ZERO(ERRCD),PARMER                                       64600000
         LTR   GTMREG,GTMREG       WAS GETMAIN ISSUED                   64800000
         BZ    ERR1B               NO,RETURN                            65000000
         B     ERR5A                                                    65200000
ERR4     LA    REGA,FOUR           STORAGE EXCEEDED                     65400000
         ST    REGA,STORAG(ERRCD)                                       65600000
         MVI   ZERO(ERRCD),STOREXCD                                     65800000
         B     TIN00055                                                 66000000
ERR5     LA    REGA,GTMSYGDS       SYSTEM GDS                           66200000
         ST    REGA,WRKGETMN                                            66400000
         MVI   WRKGETMN,X'80'                                           66600000
         LA    REGA,WRKGETMN                                            66800000
         ST    REGA,WRKPARM1      SET UP LIST POINTER            A37988 67000000
         LA    PARM,WRKPARM1                                     A37988 67200000
         MVC   WRKRTN1(FOUR),WRKRTNCD  POINTER TO GSPARRAY       A37988 67400000
         MVC   WRKGSPAR(CODES),ZERO(ERRCD)   SAVE ERROR CODES    A37988 67600000
         L     REGA,16             ADDR OF THE CVT                      67800000
         L     REGA,CVTLINK(REGA)  ADDR OF LINKLIB DCB                  68000000
         LINK  EP=IFFAAA06,DCB=(REGA),MF=(E,(1)),SF=(E,WRKSPVSR)        68200000
         MVC   ZERO(CODES,ERRCD),WRKGSPAR   RESTORE ERROR CODES  A37988 68400000
ERR5B    MVI   WRKGETMN,128                                             68600000
         CLOSE (DCB),MF=(E,WRKGETMN)                                    68800000
ERR5A    L     REGZERO,FAKE        LENGTH OF CORE                       69000000
         LR    PARM,GTMREG         ADDRESS OF CORE                      69200000
         FREEMAIN R,LV=(0),A=(1)   FREE CORE                            69400000
         B     TIN00055                                                 69600000
         EJECT                                                          69800000
REGZERO  EQU   0                                                        70000000
PARM     EQU   1                                                        70200000
ERRCD    EQU   2                                                        70400000
REGC     EQU   4                                                        70600000
WORK     EQU   5                                                        70800000
GSPREG   EQU   6                                                        71000000
GTMREG   EQU   7                                                        71200000
BASE     EQU   9                                                        71400000
REGA     EQU   10                                                       71600000
REGB     EQU   11                                                       71800000
SAVE     EQU   13                                                       72000000
NXGTMDSP EQU   0                                                        72200000
DVADRDSP EQU   X'3A'                                                    72400000
BCTLEN   DC    F'384'              ENOUGH FOR A 32K BUFFER              72600000
BCTLEN1  EQU   384                                                      72800000
GACBLEN3 EQU   160                                                 000A 73000000
TWOFLD   DC    F'2'                                                     73200000
SUBSEG   DC    F'123'                                                   73400000
H12      DC    H'12'                                               000B 73600000
SKELGTM  DC    2F'0'               ZERO GTMCB                           73800000
         DC    X'F202'             EXCEPT ID                            74000000
         DC    X'0000'                                                  74200000
         DC    11F'0'                                                   74400000
         DC    H'256'              AND DEFAULT GDOA LEN                 74600000
         DC    H'0'                                                     74800000
         DC    F'0'                                                     75000000
         DC    3X'00'                                                   75200000
         DC    X'02'                                                    75400000
GTMLEN   EQU   *-SKELGTM                                                75600000
SPAR1    SPAR  0,MF=L                                                   75800000
DCB1     DCB   DSORG=GS,MACRF=(RC,WC),GTYPE=BASIC,DDNAME=FT00F001,     X76000000
               GNCP=2                                                   76200000
DCBLEN   EQU   *-DCB1                                                   76400000
TWFIFSX  DC    F'256'                                                   76600000
GSP      EQU   0                                                        76800000
ZERO     EQU   0                                                        77000000
GSPID    EQU   X'01'                                                    77200000
EIGHT    EQU   8                                                        77400000
LOGUNT   EQU   4                                                        77600000
STORAG   EQU   12                                                       77800000
THREE    EQU   3                                                        78000000
TWO      EQU   2                                                        78200000
DDNM     EQU   42                                                       78400000
DEB      EQU   44                                                       78600000
UCB      EQU   32                                                       78800000
FOUR     EQU   4                                                        79000000
UCBTYP   EQU   16                                                       79200000
PANIC    EQU   900                                                      79400000
STAT     EQU   24                                                       79600000
CVTLINK  EQU   8                                                        79800000
DGEN     EQU   840                                                      80000000
SCISS    EQU   876                                                      80200000
SCALE    EQU   864                                                      80400000
UPDATE   EQU   936                 IFFAHA13,14 STATAB LOC   D11 ZA15418 80600000
BMGT     EQU   816                                                      80800000
DSTOR    EQU   852                                                      81000000
SMALLEST DC    F'7'                                                     81200000
LARGEST  DC    F'99'                                                    81400000
PHYSADDR EQU   4                                                        81600000
CHAN     EQU   X'3F'                                                    81800000
MODEL3   EQU   3                                                        82000000
MODEL2   EQU   2                                                        82200000
GDF      EQU   6                                                        82400000
CHAR     EQU   3                                                        82600000
ONE      EQU   1                                                        82800000
GACBNXT  EQU   64                                                       83000000
GACBGTM  EQU   60                                                       83200000
GDOA     EQU   12                                                       83400000
LP       EQU   X'20'                                                    83600000
ABS      EQU   X'80'                                                    83800000
GDFSW    EQU   X'04'                                                    84000000
CHARSW   EQU   X'08'                                                    84200000
PARE     EQU   16                                                       84400000
PARMER   EQU   X'08'                                                    84600000
STOREXCD EQU   X'10'                                                    84800000
XOPNFLG  EQU   X'10'              MASK FOR DCB OPEN BIT          A37988 85000000
CODES    EQU   20                  LENGTH OF GSPARRAY            A37988 85200000
PATCH    DC    64X'FF'             PATCH AREA               D11         85400000
         EJECT                                                          85600000
WORKCORE DSECT                                                          85800000
WRKPARM  DS    F                                                        86000000
WRKRTNCD DS    F                                                        86200000
FAKE     DS    F                                                        86400000
WRKSPVSR DS    3F                                                       86600000
WRKGETMN DS    2D                                                       86800000
WRKLIST  DS    F                                                        87000000
WRKSAVE  DS    18F                                                      87200000
WRKGSPAR DS    6F                 SAVE AREA FOR GSPARRAY         A37988 87400000
WRKPARM1 DS    F                  ARGUMENT ADDRESS LIST          A37988 87600000
WRKRTN1  DS    F                  POINTER TO GSPARRAY            A37988 87800000
         COPY  GSPCB                                                    88000000
         COPY  GTMCB                                                    88200000
*        THE FOLLOWING WORDS ARE ADDED TO THE GTMCB FOR THE OPEN        88400000
*        ROUTINE.                                                       88600000
*                                                                       88800000
DCB      DS    13F                                                      89000000
DCBOFLG  EQU   DCB+48             DCB OPEN FLAG FIELD            A37988 89200000
BCT      DS    384X                                                     89400000
GACB1PTR DS    F                                                        89600000
GACB1GTM DS    F                                                        89800000
GACB1    DS    14F                                                      90000000
COM1     DS    4F                                                       90200000
GACB3PTR DS    F                                                        90400000
GACB3GTM DS    F                                                        90600000
GACB3    DS    14F                                                      90800000
COM3     DS    4F                                                       91000000
         COPY  GDSCB                                                    91200000
         END                                                            91400000
./  ADD  SSI=71430598,NAME=IFFAAA04
*                                                                       00500021
*        TMDEV IS ENTERED FROM DIRECTOR PART 2 WITH THE ADDRESS OF      01000021
*        THE WORK AREA IN REGISTER 1.  THE FIRST WORD OF THE WORK       01500021
*        AREA CONTAINS THE ADDRESS OF THE PARAMETER LIST LISTED         02000021
*        BELOW:                                                         02500021
*                                                                       03000021
*        +0   A(GTMCBVAR)                                               03500021
*                                                                       04000021
*        EXTERNAL REFERENCES ARE MADE TO:                               04500021
*                                                                       05000021
*        TMGDS-IFFAAAO6                                                 05500021
*        BUFFER MANAGEMENT-IFFAHAO2                                     06000021
*        FLOW CONTROL MANAGEMENT-IFFAHAO1                               06500021
*                                                                       07000021
*        EXTERNAL MACROS USED ARE:                                      07500021
*                                                                       08000021
*        LINK                                                           08500021
*        DAR                                                            09000021
*        CLOSE                                                          09500021
*        FREEMAIN                                                       10000021
*        ENATL-IFFACAO1                                                 10500021
*                                                                       11000021
IFFAAA04 CSECT                                                          11500021
*                                                                       12000021
* C805000                                                         M4680 12050021
*                                                                       12100021
*        ON ENTRY THE BASE REGISTER IS SET UP, THE WORK AREA DSECT      12500021
*        IS INITIALIZED, AND THE RETURN ARRAY IS INITIALIZED.           13000021
*                                                                       13500021
*        THE GTMCB IS CHECKED FOR VALIDITY AND IF VALID THE DSECT       14000021
*        IS INITIALIZED AND THE SAVE AREAS ARE CHAINED.                 14500021
GTMCLS   SAVE  (14,12)                                                  15000021
         BALR  BASE,0                                                   15500021
         USING *,BASE                                                   16000021
         LR    WORK,PARM           ADDR OF WORK AREA                    16500021
         USING WORKAREA,WORK                                            17000021
         XC    WRKSPVSR(12),WRKSPVSR ZERO SUPERVISOR PARAMETER LIST     17500021
         L     PARM,WRKPARM        PARM LIST                            18000021
         L     GTMREG,0(PARM)      ADDR OF GTMCB                        18500021
         L     GTMREG,0(GTMREG)                                         19000021
         USING GTMCB,GTMREG                                             19500021
         L     ERRCD,WRKRTNCD      ADDRESS OF RETURN CODE ARRAY         20000021
         XC    0(20,ERRCD),0(ERRCD) ZERO RETURN ARRAY                   20500021
         C     GTMREG,GTMGTMCB     IS THE TERMINAL OPEN                 21000021
         BNE   ERR1                NO                                   21500021
         LA    REGA,4                                                   22000021
         ST    REGA,WRKSPACE       BUILD THE FLOW CTL PARM              22500021
         ST    GTMREG,WRKSPACE+4   LIST                                 23000021
         ST    SAVE,WRKSAVE+4      SET UP SAVE AREA                     23500021
         LA    REGA,WRKSAVE                                             24000021
         ST    REGA,8(SAVE)        CHAIN SAVE AREAS                     24500021
         LR    SAVE,REGA                                                25000021
*                                                                       25500021
*        THE FLOW CONTROL IS CALLED TO DELETE THE FLOW CONTROL          26000021
*        STRUCTURE AND BUFFER MANAGEMENT IS CALLED TO FREE ALL          26500021
*        BUFFER ASSIGNED TO THIS TERMINAL.                              27000021
*///                                                                    27500021
*///     CALL  FLOW CTL TO DELETE STRUCTURE                             28000021
*///                                                                    28500021
         LA    PARM,WRKSPACE                                            29000021
         ST    PARM,WRKSAVE+72                                          29500021
         MVC   WRKSAVE+76(4),WRKRTNCD                                   30000021
         LA    PARM,WRKSAVE+72                                          30500021
         L     REGC,16                                                  31000021
         L     REGC,CVTLINK(REGC)  LINK LIB DCB                         31500021
         LINK  EP=IFFAHA01,MF=(E,(1)),SF=(E,WRKSPVSR)                   32000021
         LA    REGA,7              SET UP PARMS FOR                     32500021
         ST    REGA,WRKSPACE       BUFFER MGT                           33000021
*///                                                                    33500021
*///     CALL  BUFFER MGT TO FREE ALL CORE                              34000021
*///                                                                    34500021
         LA    PARM,WRKSAVE+72                                          35000021
         L     R15,STAT(ERRCD)     STATUS TABLE                         35500021
         L     R15,BMGT(R15)       BMGT ADDR                            36000021
         BALR  R14,R15             CALL                                 36500021
*                                                                       37000021
*        ANY GDSS THAT NEED TO BE CLOSED ARE CLOSED NEXT.  TMGDS        37500021
*        WILL CHECK TO SEE IF FLOW CONTROL AND BUFFER MANAGEMENT        38000021
*        ARE ALREADY CLOSED AND WHEN IT DETERMINES THAT THEY ARE        38500021
*        IT WILL BYPASS CALLS TO THESE ROUTINES.                        39000021
TCL00010 L     REGA,GTMGDSCB       ANY GDS' TO BE CLOSED                39500021
         LTR   REGA,REGA                                                40000021
         BE    TCL00020            NO                                   40500021
         LA    REGA,GTMGDSCB       ADDR OF WORD CONT. ADDR OF GDS       41000021
         ST    REGA,WRKSPACE       PLACE IN PARM LIST                   41500021
         LA    PARM,WRKSPACE       LOAD ADDR OF PARM LIST               42000021
         EJECT                                                          42500021
*///                                                                    43000021
*///     CLOSE GDS                                                      43500021
*///                                                                    44000021
         ST    PARM,WRKSAVE+72                                          44500021
         MVC   WRKSAVE+76(4),WRKRTNCD                                   45000021
         LA    PARM,WRKSAVE+72                                          45500021
         LINK  EP=IFFAAA06,MF=(E,(1)),SF=(E,WRKSPVSR)                   46000021
         B     TCL00010            GO CHECK IF ANY MORE                 46500021
*                                                                       47000021
*        ANY ATTENTION LEVELS STILL OPEN WILL BE ENDED.                 47500021
*                                                                       48000021
TCL00020 LA    REGA,GTMLATBL       ADDR OF ATTN LEVEL                   48500021
         ST    REGA,WRKSPACE       STORE IN PARM LIST                   49000021
         OI    WRKSPACE,X'80'      SET VARIABLE LIST SWITCH             49500021
TCL00030 L     REGA,GTMLATBL       CHECK IF ANY LEFT TO                 50000021
         LTR   REGA,REGA           BE CLOSED                            50500021
         BE    TCL00040            NO                                   51000021
         LA    PARM,WRKSPACE       LOAD ADDR OF PARM LIST               51500021
*                                                                       52000021
*        CALL  ENDATL              END THE ATTN LEVEL                   52500021
*                                                                       53000021
         ST    PARM,WRKSAVE+72                                          53500021
         LA    PARM,WRKSAVE+72                                          54000021
         LINK  EP=IFFACA01,MF=(E,(1)),SF=(E,WRKSPVSR)                   54500021
         B     TCL00030                                                 55000021
*                                                                       55500021
*        THE GTMCB VALIDITY FLAGS WILL BE SET TO ZERO AND THE           56000021
*        THREE GACBS WILL BE DARED.                                     56500021
*                                                                       57000021
TCL00040 XC    GTMGTMCB(4),GTMGTMCB ZERO OUT TERM ADDR                  57500021
         XC    GTMTERID(1),GTMTERID ZERO OUT ID                         58000021
         MVC   WRKSPACE,=F'3'                                           58500021
         DAR   (GACB1,GACB2,GACB3),MF=(E,WRKSPACE)                      59000021
*                                                                       59500021
*        THE GTMCB WILL BE REMOVED FROM THE CHAIN OF GTMCBS IN          60000021
*        THE GSPCB AND THE DCB WILL BE CLOSED.  FOLLOWING THIS          60500021
*        ALL STORAGE WILL BE FREED AND CONTROL WILL RETURN TO           61000021
*        THE CALLING PROGRAM.                                           61500021
*                                                                       62000021
         L     GSPREG,GTMGSPCB     PICK UP GSPCB                        62500021
         USING GSPCB,GSPREG                                             63000021
         LA    REGA,GSPGTMCB     LOAD GSPGTMCB ADDR                     63500021
TCL00050 L     REGB,0(REGA)                                             64000021
         CR    GTMREG,REGB                                              64500021
         BE    TCL00060                                                 65000021
         LR    REGA,REGB                                                65500021
         B     TCL00050                                                 66000021
TCL00060 MVC   0(4,REGA),GTMNXGTM                                       66500021
         MVI   WRKSPACE,128        SET OPTION BYTE                      67000021
         CLOSE (DCB),MF=(E,WRKSPACE)                                    67500021
         L     REGZERO,GETMNLEN                                         68000021
         LR    PARM,GTMREG                                              68500021
         FREEMAIN R,LV=(0),A=(1)   FREE ALL CORE                        69000021
         L     SAVE,4(SAVE)        RESET SAVE AREA                      69500021
         RETURN (14,12),T                                               70000021
ERR1     MVI   0(ERRCD),X'08'                                           70500021
         MVI   19(ERRCD),X'01'     INVALID GTMCB                        71000021
         RETURN (14,12),T                                               71500021
         EJECT                                                          72000021
REGZERO  EQU   0                                                        72500021
PARM     EQU   1                                                        73000021
REGA     EQU   2                                                        73500021
REGB     EQU   3                                                        74000021
WORK     EQU   5                                                        74500021
GSPREG   EQU   6                                                        75000021
GTMREG   EQU   7                                                        75500021
BASE     EQU   9                                                        76000021
ERRCD    EQU   10                                                       76500021
REGC     EQU   11                                                       77000021
SAVE     EQU   13                                                       77500021
R14      EQU   14                                                       78000021
R15      EQU   15                                                       78500021
BMGT     EQU   816                                                      79000021
STAT     EQU   24                                                       79500021
NXGTM    EQU   0                   DISPLACEMENT OF GTMCB CHAIN          80000021
GETMNLEN DC    F'664'                                             M4680 80500021
CVTLINK  EQU   8                                                        81000021
         EJECT                                                          81500021
WORKAREA DSECT                                                          82000021
WRKPARM  DS    F                                                        82500021
WRKRTNCD DS    F                                                        83000021
WRKSPACE DS    4F                                                       83500021
WRKSPVSR DS    3F                                                       84000021
WRKSAVE  DS    18F                                                      84500021
         COPY  GSPCB                                                    85000021
         COPY  GTMCB                                                    85500021
*                                                                       86000021
*        THE FOLLOWING WORDS ARE ADDED TO THE GTMCB FOR THE             86500021
*                        CLOSE ROUTINE.                                 87000021
DCB      DS    13F                                                      87500021
BCT      DS    384X                                                     88000021
GACB1PTR DS    F                                                        88500021
GACB1GTM DS    F                                                        89000021
GACB1    DS    14F                                                      89500021
COM1     DS    4F                                                       90000021
GSCB2PTR DS    F                                                        90500021
GACB2GTM DS    F                                                        91000021
GACB2    DS    14F                                                      91500021
COM2     DS    4F                                                       92000021
GACB3PTR DS    F                                                        92500021
GACB3GTM DS    F                                                        93000021
GACB3    DS    14F                                                      93500021
COM3     DS    4F                                                       94000021
         COPY  GDSCB                                                    94500021
         END                                                            95000021
./  ADD  SSI=21250078,NAME=IFFAAA05
*                                                                       00200021
*                                                                       00400021
*                                                                       00600021
*        INGDS IS ENTERED FROM DIRECTOR PART 2 WITH THE ADDRESS OF      00800021
*        THE WORK AREA IN REGISTER 1.  THE FIRST WORD OF THE WORK       01000021
*        AREA CONTAINS THE ADDRESS OF THE PARAMETER LIST LISTED BELOW   01200021
*                                                                       01400021
*                        +0  A(GTMCBVAR)                                01600021
*                        +4  A(GDSCBVAR)                                01800021
*                        +8  A(GDOALNVAR)  OPTIONAL                     02000021
*                        +12 A(LEVELVAR)  OPTIONAL                      02200021
*                        +16 A(GDSNAME)     OPTIONAL                    02400021
*                        +20 A(GDSNAME)     OPTIONAL                    02600021
*                        ETC                                            02800021
*                                                                       03000021
*                                                                       03200021
*                                                                       03400021
*        INGDS HAS NO EXTERNAL REFERENCES.                              03600021
*                                                                       03800021
*        EXTERNAL MACROS USED ARE:                                      04000021
*                                                                       04200021
*        GETMAIN                                                        04400021
*        FREEMAIN                                                       04600021
*                                                                       04800021
         EJECT                                                          05000021
*                                                                       05200021
*        ON ENTRY REGISTERS ARE SAVED AND CHAINED, THE BASE REGISTER    05400021
*        IS SET UP, THE RETURN ARRAY IS INITIALIZED AND THE WORK AREA   05600021
*        DSECT IS INITIALIZED.                                          05800021
IFFAAA05 CSECT                                                          06000021
*A636500-637000,A762500-763000                                   YM1963 06050000
GDSOPN   SAVE  (14,12)             SAVE REGS                            06200021
         BALR  BASE,0                                                   06400021
         USING *,BASE              BASE REGISTER                        06600021
         USING WORKAREA,WORK                                            06800021
         LR    WORK,PARM           SET UP SAVE AREA                     07000021
         L     ERRCD,WRKRTNCD      RETURN CODE ARRAY                    07200021
         XC    0(20,ERRCD),0(ERRCD) ZERO OUT ARRAY                      07400021
         ST    SAVE,WRKSAVE+4      SAVE HIS ADDRESS IN MINE             07600021
         LA    REGA,WRKSAVE        SAVE MY ADDR IN HIS                  07800021
         ST    REGA,8(SAVE)                                             08000021
         LR    SAVE,REGA           SET UP SAVE REG                      08200021
         L     PARM,WRKPARM        PARM LIST                            08400021
         LA    GDSNAME,EXT(PARM)   ADDR OF FIRST EQUIV GDS              08600021
         L     REGA,GTM(PARM)      GTMCB VAR ADDR                       08800021
         L     GTMDSECT,0(REGA)    ADDR OF GTMCB                        09000021
         USING GTMCB,GTMDSECT                                           09200021
         C     GTMDSECT,GTMGTMCB   IS GTMCB VALID                       09400021
         BNE   ERR1                NO                                   09600021
         LTR   REGA,REGA           ANY MORE PARMS                       09800021
         BL    ERR2                NO, ERROR                            10000021
         XC    WRKGDOA(20),WRKGDOA ZERO WORK AREA                       10200021
         LA    REGB,4              NO OF PARMS SO FAR TIMES 4           10400021
*                                                                       10600021
*        IF ALL THE REQUIRED PARAMETERS ARE PRESENT, A COUNT IS         10800021
*        MADE OF THE PARAMETERS PASSED TO DETERMINE IF THERE            11000021
*        ARE ANY EQUIVALENCE GDSS TO BE CREATED AND IF SO, HOW          11200021
*        MANY ARE NEEDED.  IF TOO MANY ARE REQUESTED, THE ROUTINE       11400021
*        WILL RETURN TO THE CALLING PROGRAM WITH AN ERROR CODE.         11600021
*                                                                       11800021
OPN00010 LA    PARM,FOUR(PARM)     POINT TO SECOND PARM                 12000021
         LA    REGB,FOUR(REGB)     ADD LEN TO COUNT                     12200021
         TM    ZERO(PARM),NOMORE   ANY MORE                             12400021
         BZ    OPN00010            YES                                  12600021
         C     REGB,EIGHT          MORE THAN TWO                        12800021
         BE    OPN00070            NO DO NOT OBTAIN OPTIONAL PARMS      13000021
         L     PARM,WRKPARM        ADDR OF PARM LIST                    13200021
         S     REGB,EIGHT          REDUCE CT                            13400021
         C     REGB,EIGHT          MORE THAN TWO OPTIONALS              13600021
         BH    OPN00050            YES                                  13800021
         S     REGB,ONE            NUMBER TO MOVE INTO WORK AREA        14000021
OPN00020 EX    REGB,OPNMOVE                                             14200021
         L     REGB,GTMGSPCB       REFERENCE GSPCB                      14400021
         USING GSPCB,REGB                                               14600021
         LA    REGB,GSPNULLV       PICK UP NULL VAR                     14800021
         DROP  REGB                                                     15000021
         LA    REGA,TWO            SET UP LOOP                          15200021
         LA    REGC,WRKGDOA                                             15400021
OPN00030 CLC   1(3,REGB),1(REGC)   IS IT NULL                           15600021
         BE    OPN00060            YES                                  15800021
OPN00040 LA    REGC,FOUR(REGC)     NO, GO TO NEXT                       16000021
         BCT   REGA,OPN00030       ALL DONE?                            16200021
         B     OPN00070            YES                                  16400021
         EJECT                                                          16600021
OPN00050 S     REGB,EIGHT          SUBTRACT OTHER PARMS                 16800021
         SRA   REGB,TWO            DIVIDE BY FOUR                       17000021
         C     REGB,FIFTY          TOO MANY EQUIV GDS                   17200021
         BH    ERR2                YES                                  17400021
         ST    REGB,WRKNOGDS       STORE # OF ADDED GDS'                17600021
         L     REGB,EIGHT          SET UP TO MOVE IN OPTIONAL PARMS     17800021
         B     OPN00020                                                 18000021
OPN00060 XC    0(4,REGC),0(REGC)   ZERO MISSING PARMS                   18200021
         B     OPN00040                                                 18400021
OPN00070 L     REGB,WRKLEVEL        IS LEVEL PASSED                     18600021
         LTR   REGB,REGB                                                18800021
         BE    OPN00075            NO                                   19000021
         CLC   ZERO(FOUR,REGB),TWOFLD IS PARM VALID                     19200021
         BH    ERR4                NO                                   19400021
         CLC   ZERO(FOUR,REGB),ONE  IS IT VALID                         19600021
         BL    ERR4                NO                                   19800021
         MVC   WRKLEVEL(4),0(REGB)      MOVE IT IN                      20000021
OPN00075 CLC   WRKGDOA,ZEROFLD     IS GDOALEN ZERO                      20200021
         BE    OPN00200            NO                                   20400021
*                                                                       20600021
*        THE GDOA LENGTH IS OBTAINED FROM THE PARAMETER LIST OR FROM    20800021
*        THE GTR                                                        21000021
*        THE GTMCB AND IT IS ROUNDED TO 128 OR THE NEAREST MULTIPLE     21200021
*        OF 256.  THE LENGTH OF STORAGE REQUIRED FOR THE GETMAIN        21400021
*        INSTRUCTION IS OBTAINED BY MULTIPLYING THE GDOA LENGTH         21600021
*        BY 2, ADDING DOUBLE THE OACB LENGTH AND THE LENGTH OF THE      21800021
*        GDSCB.  THE GETMAIN IS ISSUED AND IF STORAGE IS NOT            22000021
*        AVAILABLE AN ERROR RETURN IS MADE TO THE CALLING PROGRAM.      22200021
*                                                                       22400021
         L     REGB,WRKGDOA        ADDRESS OF GDOA SIZE                 22600021
         L     REGB,0(REGB)        GDOA SIZE                            22800021
OPN00080 C     REGB,F128           SUBSEG                               23000021
         BNH   OPN00190            YES                                  23200021
         EJECT                                                          23400021
         LA    REGB,TWO55(REGB)    TO MAKE EVEN MULTIPLE                23600021
         SRL   REGB,ATE                                                 23800021
         SLL   REGB,ATE                                                 24000021
         ST    REGB,WRKGDOA        SAVE FOR LATER                       24200021
OPN00100 AR    REGB,REGB           DOUBLE GDOA LEN                      24400021
         LA    REGB,DBLOACB(REGB)  ADD DOUBLE THE OACB LENGTH           24600021
         LA    REGB,GDSCBLEN(REGB) ADD GDSCB LENGTH                     24800021
         GETMAIN  EC,LV=(REGB),A=WRKLIST,SP=0,MF=(E,WRKGETMN) GET CORE  25000021
*                                                                       25200021
*        IF AT ANY TIME ALL THE STORAGE REQUIRED CANNOT BE OBTAINED     25400021
*        ALL STORAGE IS FREED THAT HAD ALREADY BEEN OBTAINED AND        25600021
*        CONTROL IS RETURNED TO THE CALLING PROGRAM WITH AN ERROR       25800021
*        CODE.                                                          26000021
*                                                                       26200021
         LTR   15,15                                                    26400021
         BNE   ERR3                IF NOT ZERO, ERROR-NO CORE AVAIL.    26600021
***                                HERE A CHECK IS MADE TO SEE IF       26800021
***                                THERE IS ADDITIONAL CORE NEEDED FOR  27000021
***                                EQUIV. SETS. IF YES, A LIST IS BUILT 27200021
***                                IN THE CORE OBTAINED FOR THE FIRST.  27400021
         L     REGA,WRKLIST        LOAD ADDR OF CORE                    27600021
         LR    GDSREG,REGA                                              27800021
         L     REGC,WRKNOGDS       COUNT OF EXTRAS                      28000021
         LR    COUNT,REGC                                               28200021
         C     COUNT,ZEROFLD       ANY EQUIV                            28400021
         BE    OPN00115            NO                                   28600021
         B     OPN00110                                                 28800021
OPN00105 LA    REGA,4(REGA)        UPDATE LIST                          29000021
OPN00110 GETMAIN EC,LV=(REGB),A=(REGA),SP=0,MF=(E,WRKGETMN)  CORE-EQUIV 29200021
         LTR   15,15               ERROR                                29400021
         BNE   ERR3A               YES                                  29600021
         BCT   REGC,OPN00105        ANY MORE                            29800021
         L     REGA,WRKLIST        ADDR OF LIST OF ADDRESSES            30000021
         L     GDSREG,0(REGA)      PICK UP FIRST EXTRA GDSCB            30200021
         USING GDSCB,GDSREG                                             30400021
         EJECT                                                          30600021
*                                                                       30800021
*        THE FIRST GDSCB IS SET UP AND POINTERS ARE PLACED IN IT        31000021
*        TO THE GTMCB AND TO ITSELF.  THE LEVEL FLAG IS THEN SET.       31200021
*        A CHECK IS MADE TO SEE IF THE DEVICE HAS INCREMENTAL           31400021
*        VECTORS AND IF NOT, THE GDSCURMD FIELD IS SET TO ABSOLUTE      31600021
*        OUTPUT INSTEAD OF THE DEFAULT OF OPTIMIZE.  THE GDOA           31800021
*        LENGTH IS PLACED IN THE GDSCB.                                 32000021
*                                                                       32200021
OPN00115 MVC   GDSCB(SKELLEN),SKELGDS SET UP SKELETON GDSCB             32400021
         ST    GTMDSECT,GDSGTMCB   SAVE GTMCB ADDR                      32600021
         ST    GDSREG,GDSGDSCB     SAVE ADDR OF THIS GDSCB              32800021
         TM    GTMFEATS+1,GDS      INCR VECT AVAIL                      33000021
         BO    OPN00117            YES                                  33200021
         MVI   GDSCURMD,ABS        SET OUTPUT ABSOL MODE                33400021
OPN00117 CLC   WRKLEVEL,TWOFLD     LEVEL 2                              33600021
         BL    OPN00120                                                 33800021
         OI    GDSFLAGS,LEVEL2     SET LEVEL 2                          34000021
*                                                                       34200021
*        THE OACB IS SET UP NEXT.  BUFFER IS NOT OBTAINED UNTIL         34400021
*        THE FIRST CALL TO A DATA GENERATING ROUTINE AND THE            34600021
*        GDS IS ADDED TO FLOW CONTROL AT THE TIME ALSO.                 34800021
*                                                                       35000021
OPN00120 MVC   GDSGDOAL(2),WRKGDOA+2 SAVE GDOA LEN                      35200021
         ST    GDSREG,WRKLEVEL                                          35400021
         LA    RETURN,OPN00160     SET TO FALL THROUGH                  35600021
         EJECT                                                          35800021
OPN00140 LA    REGB,GDSCBLEN(GDSREG) ADDR OF OACB/GDOA                  36000021
         ST    REGB,GDSAOACB                                            36200021
         LA    REGC,OACBLEN(REGB)  GDOA ADDR                            36400021
         ST    REGC,GDOA(REGB)     GDOA                                 36600021
         XC    0(2,REGC),0(REGC)   ZERO FIRST TWO BYTES                 36800021
         ST    REGC,CRSA(REGB)     CRSA                                 37000021
         A     REGC,TWOFLD         UPDATE TWO BYTES                     37200021
         XC    LOGADDR(8,REGB),LOGADDR(REGB) LOGICAL ADDR               37400021
         ST    REGC,OLP(REGB)      OLP                                  37600021
         LH    REGC,GDSGDOAL                                            37800021
         ST    REGC,BUFLN(REGB)    BUFFER LENGTH                        38000021
         S     REGC,SIXFLD         SET LENLEFT OT SIX LESS              38200021
         ST    REGC,LEFT(REGB)     IN LENGTH LEFT FIELD                 38400021
         XC    UNRES(16,REGB),UNRES(REGB) UNRES ADDR                    38600021
         MVC   STAT(4,REGB),STATUS STATUS                               38800021
         LA    REGC,SECND          TO REFERENCE SECOND DOA              39000021
         AH    REGC,GDSGDOAL       LENGTH OF GDOA                       39200021
         AR    REGC,REGB           ADDR OF SECOND                       39400021
         ST    REGC,CHAIN(REGB)    CHAIN                                39600021
         MVC   0(60,REGC),0(REGB)  DUPLICATE TWO OACB'S                 39800021
         ST    REGB,CHAIN(REGC)    CHAIN                                40000021
         LA    REGB,OACBLEN(REGC)  GDOA ADDR                            40200021
         ST    REGB,GDOA(REGC)     GDOA                                 40400021
         BR    RETURN              RETURN TO CORRECT PORTION OF PROG    40600021
*                                                                       40800021
*        THE GDSCB IS ADDED TO THE CHAIN OF GDSCBS ON THE GTMCB.        41000021
*        A CHECK IS MADE TO SEE IF THIS IS ONE OF AN EQUIVALENCE        41200021
*        SET OF GDSCBS.  IF YES, THE FLAG IS THE GDSCB IS SET.          41400021
*        THE NEXT SHARED GDSCB IS PICKED UP.  THE ADDRESS OF            41600021
*        THIS GDSCB IS PLACED IN THE VARIABLE PASSED.                   41800021
*                                                                       42000021
OPN00160 MVC   GDSNXGDS(4),GTMGDSCB ADD THIS GDSCB TO CHAIN             42200021
         ST    GDSREG,GTMGDSCB                                          42400021
         C     COUNT,ZEROFLD       ANY MORE GDS                         42600021
         BE    OPN00220            RETURN                               42800021
         L     REGB,0(GDSNAME)                                          43000021
         ST    GDSREG,0(REGB)      SAVE GDSCB ADDR IN VARIABLE PASSED   43200021
         LA    GDSNAME,4(GDSNAME)  UPDATE TO NEXT                       43400021
         OI    GDSFLAGS,SHARED                                          43600021
        BCT   COUNT,OPN00210                                            43800021
         L     REGB,WRKLIST        LOAD ADDR OF FIRST CORE              44000021
         EJECT                                                          44200021
*                                                                       44400021
*        A COPY OF THIS GDSCB IS MOVED INTO THE NEXT ADDRESS.           44600021
*        THE ADDRESS OF THIS GDSCB IS PLACED IN THE SHARED BACK         44800021
*        ADDRESS OF THE NEXT GDSCB.  THE ADDRESS OF THE NEXT            45000021
*        GDSCB IS PLACED IN THE SHARED FOREWARD ADDRESS OF THIS         45200021
*        GDSCB.  A BRANCH IS THEN MADE TO THE INTERNAL SUBROUTINE       45400021
*        WHICH SETS UP THE OACB AND GDOA.  ON EXIT THE CHAINING         45600021
*        OF GDSCBS WILL TAKE PLACE UNTIL ALL GDSCBS ARE                 45800021
*        INITIALIZED.  ON EXIT THE LAST ADDRESS OF THE GDSCB            46000021
*        IS PLACED IN THE FIRST VARIABLE PASSED.                        46200021
*                                                                       46400021
OPN00170 MVC   0(GDSCBLEN,REGB),0(GDSREG) DUPLICATE GDSCB               46600021
         ST    REGB,GDSSHDFD                                            46800021
         LR    GDSREG,REGB                                              47000021
         MVC   GDSSHDBK(4),GDSGDSCB ADDR OF OLD GDSCB MOVED TO BK PTR   47200021
         ST    GDSREG,GDSGDSCB     PTR TO SELF                          47400021
         LA    RETURN,OPN00160     POINT TO RETURN AFTER OACB           47600021
         B     OPN00140                                                 47800021
OPN00190 LA    REGB,SUBSEG         PICK UP SUBSEGMENT                   48000021
         ST    REGB,WRKGDOA        STORE IN GDOA                        48200021
         B     OPN00100                                                 48400021
OPN00200 MVC   WRKGDOA+2(2),GTMGDOAL PICK UP GDOA FROM GTMCB            48600021
         L     REGB,WRKGDOA        PLACE VALUE IN REGB                  48800021
         B     OPN00080                                                 49000021
OPN00210 LA    REGA,4(REGA)        PICK UP NEXT CORE                    49200021
         L     REGB,0(REGA)                                             49400021
         B     OPN00170                                                 49600021
OPN00220 L     REGB,WRKPARM        PICK UP PARM LIST                    49800021
         L     REGB,4(REGB)        PICK UP GDSNAME                      50000021
         ST    GDSREG,0(REGB)      STORE ADDR IN VAR PASSED             50200021
         TM    GDSFLAGS,LEVEL2                                          50220021
         BO    OPN00230                                                 50240021
         L     REGA,STAB(ERRCD)                                         50260021
         L     REGB,KEYTB(REGA)                                         50280021
         LTR   REGB,REGB                                                50300021
         BNE   OPN00230                                                 50320021
         LOAD  EP=IFFAHA03                                              50340021
         ST    REGZERO,KEYTB(REGA)                                      50360021
OPN00230 L     SAVE,4(SAVE)        RESET PROPER SAVE AREA               50400021
         RETURN (14,12),T                                               50600021
ERR1     MVC   ERCD4(4,ERRCD),GTMERR BAD GTMCB                          50800021
ERR1A    MVI   RTNCD(ERRCD),PARMERR PARAMETER ERROR                     51000021
         B     OPN00230            RETURN                               51200021
ERR2     MVC   ERCD4(4,ERRCD),ZEROFLD TOO FEW PARMS OR TOO MANY         51400021
         B     ERR1A                                                    51600021
ERR3A   L     REGC,WRKLIST        ADDR OF CORE OBTAINED SO FAR          51800021
ERR3B   LR    REGZERO,REGB                                              52000021
        CR    REGA,REGC           ALL RELEASED                          52200021
        BE    ERR3C               YES EXCEPT FIRST                      52400021
        L     PARM,0(REGC)        ADDR TO BE FREED                      52600021
        FREEMAIN R,LV=(0),A=(1)                                         52800021
        LA    REGC,4(REGC)                                              53000021
        B     ERR3B                                                     53200021
ERR3C   L     PARM,WRKLIST                                              53400021
        FREEMAIN R,LV=(0),A=(1)                                         53600021
ERR3     MVI   RTNCD(ERRCD),STORAGE                                     53800021
         MVC   ERCD3(4,ERRCD),CORE  STORAGE EXCEEDED                    54000021
         B     OPN00230                                                 54200021
ERR4     MVC   ERCD4(4,ERRCD),LEVEL BAD LEVEL                           54400021
         B     ERR1A                                                    54600021
         EJECT                                                          54800021
REGZERO  EQU   0                   PARM REGISTER                        55000021
PARM     EQU   1                   PARM REEISTER                        55200021
COUNT    EQU   2                   COUNT OF EQUIV GDS'                  55400021
REGC     EQU   3                   ASST USES                            55600021
ERRCD    EQU   4                   ERROR CODE ARRAY                     55800021
WORK     EQU   5                   WORK AREA                            56000021
GDSNAME  EQU   6                   POINTER TO LIST OF GDS NAMES         56200021
GTMDSECT EQU   7                   GTMCB DSECT ADDRESS                  56400021
GDSREG   EQU   8                   ADDRESS OF GDSCB                     56600021
BASE     EQU   9                   BASE REGISTER                        56800021
REGA     EQU   10                  ASST USES PART OF EVEN/ODD PAIR      57000021
REGB     EQU   11                  ASST USES PART OF EVEN/ODD PAIR      57200021
SAVE     EQU   13                  SAVE AREA                            57400021
RETURN   EQU   14                  RETURN                               57600021
SKELGDS  DC    2F'0'               POINTERS SET TO ZERO                 57800021
         DC    X'F2'               VALID CTL BLK                        58000021
         DC    X'03'               GDSCB                                58200021
         DC    X'00'                                                    58400021
*                                  CURSOR ABS                           58600021
*                                  LEVEL 1 GSP                          58800021
*                                  GDS NOT SHARED                       59000021
*                                  SEQUENCE NOT STARTED                 59200021
*                                  BUF SUBR NOT STARTED                 59400021
*                                  DISABLE PEN INTERRUPTS               59600021
         DC    X'00'               RESERVED                             59800021
         DC    6F'0'               ZERO POINTERS                        60000021
         DC    2E'0'               USER LL IN FLOAT                     60200021
         DC    2E'4095'            USER UPPER RIGHT IN FLOAT            60400021
         DC    2F'0'               GRID-INTEGER                         60600021
         DC    2F'4095'            GRID-INTEGER                         60800021
         DC    2E'0'               GRID-FLOAT                           61000021
         DC    2E'4095'            GRID-FLOAT                           61200021
         DC    X'08'               CHAR BASIC PROT                      61400021
         DC    X'0A'               SCISS-SCREEN AND CONTINUE            61600021
         DC    X'04'               OUTPUT OPTIMIZED                     61800021
         DC    X'88'               INPUT                                62000021
         DC    X'2AFF0000'         FLOW CONTROL RETURN                  62200021
         DC    2H'0'               F/C & B/MGT PTRS                     62400021
         DC    X'00'               BCT ID                               62600021
         DC    X'00'               CONTROL MODE                         62800021
         DC    H'256'              GDOA LEN                             63000021
         DC    2F'0'               SHARED POINTERS                      63200021
         DC    2H'0'               LOG AND PHYS ADDR OF REP DATA        63400021
         DC    F'0'                DATA TO OVERWRITE GTRU TO FLOW CTL   63600021
         DC    F'0'                X CORR FOR DATA GEN           YM1963 63650000
         DC    F'0'                Y CORR FOR DATA GEN           YM1963 63700000
SKELLEN  EQU   *-SKELGDS                                                63800021
SUBSEG   EQU   128                                                      64000021
SHARED   EQU   X'08'                                                    64200021
LEVEL2   EQU   X'10'                                                    64400021
OACBLEN  EQU   60                                                       64600021
GDSCBLEN EQU   SKELLEN                                                  64800021
DBLOACB  EQU   120                                                      65000021
OPNMOVE  MVC   WRKGDOA(1),8(PARM)                                       65200021
EXT      EQU   16                                                       65400021
GTM      EQU   0                                                        65600021
FOUR     EQU   4                                                        65800021
ZERO     EQU   0                                                        66000021
NOMORE   EQU   X'80'                                                    66200021
EIGHT    DC    F'8'                                                     66400021
ONE      DC    F'1'                                                     66600021
TWO      EQU   2                                                        66800021
TWOFLD   DC    F'2'                                                     67000021
THREE    EQU   3                                                        67200021
ZEROFLD  DC    F'0'                                                     67400021
F128     DC    F'128'                                                   67600021
TWO55    EQU   255                                                      67800021
ATE      EQU   8                                                        68000021
STATUS   DC    X'80000000'         FLAG-NEED FIRST BUFFER ASSIGNMENT    68200021
GDOA     EQU   4                                                        68400021
STAT     EQU   8                                                        68600021
CHAIN    EQU   0                                                        68800021
CRSA     EQU   12                                                       69000021
OLP      EQU   16                                                       69200021
BLP      EQU   20                                                       69400021
BUFST    EQU   24                                                       69600021
BUFLN    EQU   28                                                       69800021
UNRES    EQU   32                                                       70000021
LOGADDR  EQU   48                                                       70200021
LEFT     EQU   56                                                       70400021
SECND    EQU   60                                                       70600021
RTNCD    EQU   0                                                        70800021
PARMERR  EQU   X'08'                                                    71000021
STORAGE  EQU   X'10'                                                    71200021
GTMERR   DC    F'1'                                                     71400021
FOURFLD  DC    F'4'                                                     71600021
CORE     DC    F'4'                                                     71800021
ERCD4    EQU   16                                                       72000021
ERCD3    EQU   12                                                       72200021
LEVEL   DC    F'4'                                                      72400021
FIFTY   DC    F'50'                                                     72600021
SIXFLD   DC    F'6'                                                     72800021
GDS      EQU   X'04'                                                    73000021
ABS      EQU   X'02'                                                    73200021
STAB     EQU   24                                                       73260021
KEYTB    EQU   X'33C'                                                   73320021
         EJECT                                                          73400021
WORKAREA DSECT                                                          73600021
WRKPARM  DS    F                   PARM LIST ADDR                       73800021
WRKRTNCD DS    F                   ADDR OF RETURN ARRAY                 74000021
WRKGDOA  DS    F                   GDOA LEN                             74200021
WRKLEVEL DS    F                   LEVEL                                74400021
WRKSPACE DS    F                   EXTRA WORD FOR PARAMETER LISTS       74600021
WRKNOGDS DS    F                   NUMBER OF GDS'S                      74800021
WRKSAVE  DS    18F                 SAVE AREA                            75000021
WRKLIST  DS    F                                                        75200021
WRKLEN   DS    F                                                        75400021
WRKGETMN DS    3F                                                       75600021
         COPY  GSPCB                                                    75800021
         COPY  GTMCB                                                    76000021
         COPY  GDSCB                                                    76200021
GDSXCOR  DS    F                   X CORR FACTOR FOR DGEN        YM1963 76250000
GDSYCOR  DS    F                   Y CORR FACTOR FOR DGEN        YM1963 76300000
        END                                                             76400021
./  ADD  SSI=21250091,NAME=IFFAAA06
*                                                                       00500021
*        TMGDS IS ENTERED FROM DIRECTOR PART 2 WITH THE ADDRESS OF      01000021
*        THE WORK AREA IN REGISTER 1.  THE FIRST WORD OF THE WORK       01500021
*        AREA CONTAINS THE ADDRESS OF THE PARAMETER LIST.               02000021
*                                                                       02500021
*        TMGDS INPUT PARAMETER LIST:                                    03000021
*                                                                       03500021
*        +0    A(GDSVAR)                                                04000021
*                                                                       04500021
*        EXTERNAL REFERENCES ARE MADE TO:                               05000021
*                                                                       05500021
*        BUFFER MANAGEMENT   IFFAHAO2                                   06000021
*        FLOW CONTROL MANAGEMENT  IFFAHAO1                              06500021
*        KEY TABLE MANAGEMENT  IFFAHAO3                                 07000021
*                                                                       07500021
*        EXTERNAL MACROS USED ARE:                                      08000021
*                                                                       08500021
*        LINK                                                           09000021
*        FREEMAIN                                                       09500021
*                                                                       10000021
*                                                                       10500021
*        ON ENTRY THE BASE REGISTER IS SET UP, REGISTERS ARE            11000021
*        SAVED, THE RETURN ARRAY IS INITIALIZED, AND THE WORK           11500021
*        AREA DSECT IS INITIALIZED.                                     12000021
*                                                                       12500021
IFFAAA06 CSECT                                                          13000021
*0114,335000                                                       000A 13200021
*C855000,A920500-921000                                          YM1963 13250000
CLSGDS   SAVE  (14,12)                                                  13500021
         BALR  BASE,0                                                   14000021
         USING *,BASE                                                   14500021
         LR    WORK,PARM           SET UP WORK AREA                     15000021
         USING WORKAREA,WORK                                            15500021
         L     PARM,WRKPARM        PARM LIST                            16000021
         L     GDSREG,0(PARM)      ASDR OF GDS CONST                    16500021
         L     GDSREG,0(GDSREG)    ADDRESS OF THE GDSCB                 17000021
         USING GDSCB,GDSREG                                             17500021
         L     ERRCD,WRKRTNCD                                           18000021
         XC    0(20,ERRCD),0(ERRCD) ZERO RETURN ARRAY                   18500021
         XC    WRKSPVSR(12),WRKSPVSR ZERO SUPERVISOR PARAMETER LIST     19000021
*                                                                       19500021
*        THE INPUT PARAMETER IS CHECKED FOR VALIDITY AND IF VALID,      20000021
*        THE GDSCB DSECT IS INITIALIZED.  THE SAVE AREAS ARE THEN       20500021
*        CHAINED, AND THE GTMCB DSECT IS INITIALIZED.  A CHECK IS       21000021
*        MADE TO SEE IF ANY DATA WAS EVER GENERATED.  IF NOT,           21500021
*        A BRANCH IS MADE TO THE FREEMAIN.  A CHECK IS MADE TO          22000021
*        SEE IF THERE IS A KEY TABLE AND IF SO, IT IS FREED BY          22500021
*        KEY TABLE MANAGEMENT.                                          23000021
*                                                                       23500021
         C     GDSREG,GDSGDSCB     IS THIS A VALID GDS                  24000021
         BNE   ERR1                NO                                   24500021
         ST    SAVE,WRKSAVE+4      SET UP SAVE AREA CHAIN               25000021
         LA    REGA,WRKSAVE                                             25500021
         ST    REGA,8(SAVE)                                             26000021
         LR    SAVE,REGA                                                26500021
         L     GTMREG,GDSGTMCB     PICK UP ADDR OF THE GTMCB            27000021
         USING GTMCB,GTMREG                                             27500021
         L     REGB,16             CVT                                  28000021
         L     REGB,CVTLINK(REGB)  LINK LIB DCB                         28500021
         CLC   GDSFCBUF,ZERO                                            29000021
         BE    DSC00012            FLOW CONTROL NEVER ENTERED           29500021
         LA    REGD,DSC00005            SET TO FALL THROUGH             29700021
DSC00003 L     REGA,GDSKEYTB            ADDR OF KEY TABLE               30100021
         LTR   REGA,REGA           IN EXISTANCE                         30500021
         BCR   8,REGD                   NO                              31000021
         ST    GDSREG,WRKPRLST                                          31500021
         LA    REGA,FOUR           BUILD PARM LIST TO DELETE            32000021
         ST    REGA,WRKPRLST+4     THE KEY TABLE                        32500021
         LA    PARM,WRKPRLST                                            33000021
         L     REGA,GTMGSPCB       GET POINTER TO GSPCB            000A 33100021
         L     REGA,FE(REGA)       GET POINTER TO STATUS TABLE     000A 33200021
         L     REG15,ETE(REGA)     GET ADRS OF KEY TABLE MGMT      000A 33300021
         BALR  RETURN,REG15        BRANCH TO KEY TABLE MGMT        000A 33400021
         BR    REGD                     RETURN                          33700021
*                                                                       34000021
*        NEXT A CHECK IS MADE TO SEE IF INDEV HAS CLOSED OUT            34500021
*        BUFFER MANAGEMENT AND FLOW CONTROL MANAGEMENT.  IF NOT,        35000021
*        BOTH ARE NOW CALLED TO REMOVE THE GDS.                         35500021
*                                                                       36000021
DSC00005 CLC   GTMFCTBL,ZERO                                            36500021
         BE    DSC00012            FLOW CONTROL ALREADY CLOSED          37000021
         LA    REGA,3              CODE FOR DELETE A                    37500021
         ST    REGA,WRKSPACE       DATASET FROM FLOW CTL                38000021
         ST    GDSREG,WRKSPACE+4                                        38500021
         LA    PARM,WRKSPACE                                            39000021
*//                                                                     39500021
*//      CALL FLOW CONTROL                                              40000021
*//                                                                     40500021
         ST    PARM,WRKSAVE+72                                          41000021
         MVC   WRKSAVE+76(4),WRKRTNCD                                   41500021
         LA    PARM,WRKSAVE+72                                          42000021
         LINK  EP=IFFAHA01,MF=(E,(1)),SF=(E,WRKSPVSR)                   42500021
         LA    REGA,4              CODE TO FREE SUBSEGMT                43000021
         CLC   GDSGDOAL,SUBSEG     IS BUFFER A SUB SEGMENT              43500021
         BNH   DSC00010            YES                                  44000021
         LA    REGA,1(REGA)        NO INCREASE CODE TO FULL SEGMT       44500021
DSC00010 ST    REGA,WRKSPACE       STORE CHAIN                          45000021
         LA    PARM,WRKSPACE                                            45500021
*                                                                       46000021
*        CALL BUFFER MANAGMENT     RELEASE ALL BUFFER                   46500021
*                                                                       47000021
         LA    PARM,WRKSAVE+72                                          47500021
         L     REG15,STAT(ERRCD)   STATUS TABLE                         48000021
         L     REG15,BMGT(REG15)   ADDR OF BUFFER MGT                   48500021
         BALR  RETURN,REG15        CALL                                 49000021
         EJECT                                                          49500021
*                                                                       50000021
*        THE GDSCB IS REMOVED FROM THE CHAIN OF GDSCBS ON THE           50500021
*        GTMCB.  CORE IS THEN FREED FOR THE GDSCB, ITS OACBS            51000021
*        AND GDAOS.  A CHECK IS MADE TO SEE IF THERE WERE ANY           51500021
*        EQUIVALENCE GDSS.  IF SO THEY ARE ALSO REMOVED FROM THE        52000021
*        CHAIN OF GDSCBS ON THE GTMCB AND THE STORAGE FOR EACH IS       52500021
*        FREED.                                                         53000021
*                                                                       53500021
DSC00012 LA    RETURN,DSC00040     SET UP RETURN                        54000021
DSC00015 LA    REGB,GTMGDSCB                                            54500021
DSC00020 L     REGA,0(REGB)                                             55000021
         CR    REGA,GDSREG                                              55500021
         BE    DSC00030                                                 56000021
         LA    REGB,NXGDS(REGA)                                         56500021
         B     DSC00020                                                 57000021
DSC00030 MVC   0(4,REGB),GDSNXGDS  REMOVE FROM CHAIN                    57500021
         XC    GDSGDSCB(4),GDSGDSCB ZERO OUT ADDR TO MAKE INVALID       58000021
         XC    GDSGDSID(1),GDSGDSID                                     58500021
         BR    RETURN                                                   59000021
DSC00040 LH    REGC,GDSGDOAL       PICK UP GDOA LENGTH                  59500021
         SLL   REGC,1              DOUBLE IT                            60000021
         A     REGC,DBLOACB                                             60500021
         A     REGC,GDSLEN         LENGTH OF GETMAIN AREA               61000021
         TM    GDSFLAGS,X'08'      IS THIS SHARED                       61500021
         BO    DSC00080            YES                                  62000021
         XC    WRKPARM(4),WRKPARM  ZERO OUT FOR SWITCH                  62500021
DSC00050 LR    REGZERO,REGC                                             63000021
         LR    PARM,GDSREG                                              63500021
         FREEMAIN R,LV=(0),A=(1)   FREE CORE                            64000021
         CLC   WRKPARM,=F'0'                                            64500021
         BE    DSC00090            EXIT                                 65000021
         L     GDSREG,WRKSHRDF     ALL FOREWARD FREED                   65500021
         LTR   GDSREG,GDSREG                                            66000021
         BZ    DSC00070            YES                                  66500021
         BAL   REGD,DSC00003            FREE KEY TABLE                  66700021
         MVC   WRKSHRDF(4),GDSSHDFD NO, REMOVE ONE FROM CHAIN           67000021
DSC00060 BAL   RETURN,DSC00015     REMOVE FROM GDS CHAIN AND ZERO ID    67500021
         B     DSC00050                                                 68000021
DSC00070 L     GDSREG,WRKSHRDB     PICK UP BACK PTR                     68500021
         LTR   GDSREG,GDSREG       ANY MORE                             69000021
         BZ    DSC00090            NO                                   69500021
         BAL   REGD,DSC00003            FREE KEY TABLE                  69700021
         MVC   WRKSHRDB(4),GDSSHDBK REMOVE FROM CHAIN                   70000021
         B     DSC00060                                                 70500021
DSC00080 MVC   WRKSHRDF(4),GDSSHDFD SAVE FOREWARD PTR                   71000021
         MVC   WRKSHRDB(4),GDSSHDBK SAVE BACKWARD PTR                   71500021
         B     DSC00050                                                 72000021
DSC00090 L     SAVE,4(SAVE)        RESET SAVE AREA                      72500021
         RETURN (14,12),T                                               73000021
ERR1     MVI   0(ERRCD),X'08'                                           73500021
         MVI   19(ERRCD),X'01'     INVALID GDSCB                        74000021
         RETURN (14,12),T                                               74500021
         EJECT                                                          75000021
REGZERO  EQU   0                                                        75500021
PARM     EQU   1                                                        76000021
REGA     EQU   2                                                        76500021
REGB     EQU   3                                                        77000021
REGD     EQU   4                                                        77200021
WORK     EQU   5                                                        77500021
GTMREG   EQU   7                                                        78000021
GDSREG   EQU   8                                                        78500021
BASE     EQU   9                                                        79000021
REGC     EQU   10                                                       79500021
ERRCD    EQU   11                                                       80000021
SAVE     EQU   13                                                       80500021
RETURN   EQU   14                                                       81000021
REG15    EQU   15                                                       81500021
BMGT     EQU   816                                                      82000021
CVTLINK  EQU   8                                                        82500021
STAT     EQU   24                                                       83000021
NXGDS    EQU   0                                                        83500021
ETE      EQU   828                                                 000A 83600021
FE       EQU   48                                                  000A 83700021
ZERO     DC    F'0'                                                     84000021
FOUR     DC    F'4'                                                     84500021
DBLOACB  DC    F'120'              DOUBLE OACB LENGTH                   85000021
GDSLEN   DC    F'124'              LENGTH OF GDSCB               YM1963 85500000
SUBSEG   DC    H'128'                                                   85700021
         EJECT                                                          86000021
WORKAREA DSECT                                                          86500021
WRKPARM  DS    F                                                        87000021
WRKRTNCD DS    F                                                        87500021
WRKSPVSR DS    3F                                                       88000021
WRKSPACE DS    3F                                                       88500021
WRKSHRDF DS    F                                                        89000021
WRKSHRDB DS    F                                                        89500021
WRKSAVE  DS    18F                                                      90000021
WRKPRLST DS    2F                                                       90500021
         COPY  GSPCB                                                    91000021
         COPY  GTMCB                                                    91500021
         COPY  GDSCB                                                    92000021
GDSXCOR  DS    F                   X CORR FACTOR FOR DGEN        YM1963 92050000
GDSYCOR  DS    F                   Y CORR FACTOR FOR DGEN        YM1963 92100000
         END                                                            92500021
./  ADD  SSI=20480151,NAME=IFFACA00
* TITLE:CRATL-CREATE AN ATTENTION LEVEL                                 00300013
* STATUS:CHANGE LEVEL 0                                                 00600013
* FUNCTION:TO ESTABLISH THE FIRST OR ONLY ATTENTION LEVEL OR TO ESTAB-  00900013
*          LISH A NEW ACTIVE ATTENTION LEVEL BELOW THE CURRENTLY ACTIVE 01200013
*          LEVEL.                                                       01500013
* ENTRY:ENTERED AT IFFACA00 VIA A CALL TO CRATL.                        01800013
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD    02100013
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 02400013
*         1.DEVICENAME-ADDRESS OF A VARIABLE CONTAIN THE ADDRESS OF THE 02700013
*           GTMCB.                                                      03000013
*         2.ATTNLEVEL-ADDRESS OF A USER LOCATION WHERE THE ADDRESS OF   03300013
*           THE NEWLY CREATED ATTENTION LEVEL IS TO BE PLACED.          03600013
*         3.DEQUECT-ADDRESS OF A VALUE INDICATING WHETHER ATTENTIONS    03900013
*           MADE AVAILABLE TO THE USER ARE DEQUEUED ANY TIME(VALUE=1)   04200013
*           OR ONLY WHEN ATTENTION LEVEL IS ACTIVE(VALUE=2).            04500013
* OUTPUT:ATTENTION LEVEL AND A QUEUE ARE CREATED.                       04800013
* EXIT:RETURN TO CALLING PROGRAM                                        05100013
* RETURN CODES: 4,0 INCORRECT NUMBER OF PARAMETERS.                     05400013
*               4,1 NOT A VALID DEVICENAME.                             05700013
*               4,3 DEQUECT NOT VALID                                   06000013
*               3,4 MAIN STORAGE NOT AVAILABLE                          06300013
*               0,0 SUCCESSFULL EXECUTION                               06600013
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE                            06900013
* NOTES:THE FOLLOWING CONTROL BLOCKS ARE EXAMINED BY THIS ROUTINE:      07200013
*       1.GTMCB                                                         07500013
*       2.GSPCB                                                         07800013
*EXTERNAL ROUTINES:ATTNINQ                                              08100013
*                  GIOCR                                                08400013
REG0     EQU   0                       PARAM REG 0                      08700013
REG1     EQU   1                       PARAM REG1                       09000013
RLIST    EQU   2                       INPUT PARAMETER REG              09300013
RPARM    EQU   3                       PARAMETER LIST REG               09600013
RGTMCB   EQU   4                       GTMCB REG                        09900013
RATL     EQU   5                       ATTENTION LEVEL                  10200013
SPARE1   EQU   6                       SPARE REG                        10500013
RWORKD   EQU   7                       WORK REG D                       10800013
RDEQ     EQU   8                       DEQUECT REG                      11100013
RBASE    EQU   9                       BASE REGISTER                    11400013
RGSPCB   EQU   10                      GSPCB ADR                        11700013
RD       EQU   10                      WORK REG                         12000013
RWORKC   EQU   11                      WORK REG C                       12300013
SPARE2   EQU   12                      RSVD PL1                         12600013
RSAVE    EQU   13                      SAVE AREA REG                    12900013
RWORKA   EQU   14                      WORK REG A                       13200013
RWORKB   EQU   15                      WORK REG B                       13500013
ADD0     EQU   0                       ADD INFO 0                       13800013
ADD1     EQU   1                       ADD INFO 1                       14100013
ADD2     EQU   2                       ADD INFO 2                       14400013
ADD3     EQU   3                       ADD INFO 3                       14700013
ADD4     EQU   4                       ADD INFO 4                       15000013
BPID     EQU   X'01'                   BP ID                            15300013
CORE     EQU   256                     CORE REQUEST                     15600013
COUNT    EQU   7                       NUMBER OF DATA ENTRIES           15900013
DATSRT   EQU   80                      DATA START                       16200013
DATSIZE  EQU   24                      DATA ENTRY SIZE                  16500013
DEQOPT   EQU   X'04'                   DEQUEUE OPTION                   16800013
DEQ1     EQU   1                       DEQUECT=1                        17100013
DEQ2     EQU   2                       DEQUECT=2                        17400013
EIGHT    EQU   8                       EIGHT                            17700013
EOS      EQU   X'40'                   EOS RESTART BIT                  17800013
FOUR     EQU   4                       FOUR                             18000013
GACBOFF  EQU   0                       OFFSET TO GACB                   18300013
GACBPLUS EQU   8                       OFFSET TO GACB ADDRESS           18600013
GTMCBID  EQU   X'02'                   GTMCB ID                         18900013
HASPFK   EQU   X'10'                   HAS PF KEYBOARD                  19000013
ID1      EQU   X'F2'                   ID                               19200013
ID2      EQU   X'04'                   ID                               19500013
IOK      EQU   X'7F'                   I/O SUCCESSFULL CODE             19600013
LAST     EQU   X'80'                   LAST ENTRY IN LIST               19800013
LITE     EQU   X'01'                   LIGAT OPTION                     20100013
LIT2     EQU   X'02'                   OPTION 2                         20400013
LIT3     EQU   X'03'                   OPTION 3                         20700013
LP       EQU   X'08'                   LP RESTART BIT                   20800013
LPRST    EQU   45                      LP RESTART BYTE                  21000013
OFFSAVE  EQU   8                       SAVE AREA CHAIN                  21300013
PFK0     EQU   X'80'                   PFK0                             21600013
PFMSK    EQU   8                       OFFSET TO PFMSK                  21900013
RCC3     EQU   X'10'                   RETURN CODE 3                    22200013
RCC4     EQU   X'08'                   RETURN CODE 4                    22500013
RC3      EQU   12                      OFFSET TO RTN CODE 3             22800013
RC4      EQU   16                      OFFSET TO RTN CODE 4             23100013
RC5      EQU   X'04'                   I/O ERROR                        23200013
TWO      EQU   2                       TWO                              23400013
UPHF     EQU   256                     UPPER HALF OF ATTN LEVEL         23700013
ZERO     EQU   0                       ZERO                             24000013
IFFACA00 CSECT                                                          24300013
*2101,471000-528000                                                000A 24400018
         SAVE  (14,12)                 SAVE REGISTERS                   24600013
         BALR  RBASE,0                 SET UP BASE REG                  24900013
         USING *,RBASE                 DEFINE BASE REG                  25200013
         LR    RLIST,REG1              SAVE REGISTER                    25500013
         USING LIST,RLIST              DEFINE INPUT CSECT               25800013
         ST    RSAVE,SAVE+4            SAVE-SAVE AREA PTR               26100013
         LA    RD,SAVE                 LOAD ADR OF MY SAVE AREA         26400013
         ST    RD,OFFSAVE(RSAVE)       STORE IN USER SAVE AREA          26700013
         LA    RSAVE,SAVE              ESTABLISH NEW SAVE AREA          27000013
         L     RWORKA,RCODE            LOAD RETURN CODE ARRAY ADR       27300013
         XC    ZERO(20,RWORKA),ZERO(RWORKA) CLEAR RETURN CODE ARRAY     27600013
         B     AROUND                  BRANCH                           27900013
ERROR    L     RWORKA,RCODE            LOAD RETURN CODE ADR             28200013
         STC   RWORKB,ZERO(RWORKA)     STORE RETURN CODE IN ARRAY       28500013
         ST    RWORKC,ZERO(RWORKD,RWORKA) STORE ADD INFO AT PROPER      28800013
*                                      OFFSET IN ARRAY                  29100013
OUTRTN   L     RSAVE,SAVE+4            RESTORE OLD SAVE AREA PTR        29400013
         RETURN (14,12),T              RETURN TO CALLING PROGRAM        29700013
AROUND   L     RPARM,PLIST             LOAD ADR OF PARAM LIST           30000013
         USING PARAMS,RPARM            DEFINE DSECT REG                 30300013
         L     RGTMCB,DEVICE           LOAD INDIRECT ADR OF GTMCB       30600013
         L     RGTMCB,ZERO(RGTMCB)     LOAD GTMCB ADR                   30900013
         USING GTMCB,RGTMCB            DEFINE DSECT REG                 31200013
         CLI   GTMTERID,GTMCBID        TEST TO SEE IF VALID GTMCB       31500013
         BE    CR01                    BRANCH IF VALID                  31800013
CR02     LA    RWORKC,ADD1             LOAD ADD INFO CODE               32100013
CR03     LA    RWORKB,RCC4             LOAD RETURN CODE                 32400013
         LA    RWORKD,RC4              LOAD OFFSET                      32700013
         B     ERROR                   BRANCH                           33000013
CR01     L     RWORKA,GTMGTMCB         LOAD ADR FLD                     33300013
         CLR   RWORKA,RGTMCB           HAS GTMCB BEEN INITIALIZED       33600013
         BNE   CR02                    BRANCH IF NO                     33900013
         L     RGSPCB,GTMGSPCB         LOAD ADR OF GSPCB                34200013
         USING GSPCB,RGSPCB            DEFINE DSECT                     34500013
         TM    DEVICE,LAST             IS THIS THE LAST PARAMETER       34800013
         BC    14,CR04                 BRANCH IF NO                     35100013
CR05     LA    RWORKC,ADD0             LOAD ADD INFO                    35400013
         B     CR03                    BRANCH                           35700013
CR04     L     RWORKA,GSPNULLV         LOAD ADR OF NULL                 36000013
         L     RWORKB,ATTNL            LOAD ATTNLEVEL PARAM             36300013
         LA    RWORKB,ZERO(RWORKB)     ZERO HI ORDER BYTE               36600013
         CLR   RWORKA,RWORKB           IS IT ADR OF NULL                36900013
         BE    CR05                    BRANCH IF YES                    37200013
         LTR   RWORKB,RWORKB           VALUE=0                          37500013
         BC    8,CR05                  BRANCH IF YES                    37800013
         TM    ATTNL,LAST              IS THIS LAST PARAM               38100013
         BC    14,CR06                 BRANCH IF NO                     38400013
CR07     LA    RDEQ,DEQ1               ASSUME DEQUECT OF 1              38700013
         B     CR08                    BRANCH                           39000013
CR06     L     RDEQ,DEQUECT            LOAD INDIRECT ADR OF DEQUECT     39300013
         LA    RDEQ,ZERO(RDEQ)         ZERO HI ORDER BYTE               39600013
         CLR   RWORKA,RDEQ             EQUAL ADR OF NULL                39900013
         BE    CR07                    BRANCH IF YES                    40200013
         L     RDEQ,ZERO(RDEQ)         LOAD DEQUECT PARAMETER           40500013
         LA    RWORKA,DEQ1             LOAD CONSTANT                    40800013
         CLR   RDEQ,RWORKA             DEQUECT=1                        41100013
         BE    CR08                    BRANCH IF YES                    41400013
         LA    RWORKA,DEQ2             LOAD CONSTANT                    41700013
         CLR   RWORKA,RDEQ             DEQUECT#2                        42000013
         BE    CR08                    BRANCH IF YES                    42300013
         LA    RWORKC,ADD3             LOAD ADD INFO CODE               42600013
         B     CR03                    BRANCH                           42900013
CR08     XC    MAINCORE(20),MAINCORE   CLEAR PARAMETER LIST AREA        43200013
         LA    REG1,MAINCORE           LOAD ADR OF PARAMETER LIST       43500013
         LA    RWORKC,CORE             LOAD BYTE REQUEST                43800013
         LA    RWORKD,ADDRESS          LOAD LOC TO PUT ADR OF CORE      44100013
         GETMAIN EC,LV=(11),A=(7),MF=(E,(1))                            44400013
         LTR   RWORKB,RWORKB           WAS CORE REQUEST SATISFIED       44700013
         BC    8,CR09                  BRANCH IF YES                    45000013
         LA    RWORKB,RCC3             LOAD RETURN CODE                 45300013
         LA    RWORKC,ADD4             LOAD ADD INFO                    45600013
         LA    RWORKD,RC3              LOAD OFFSET                      45900013
         B     ERROR                   BRANCH                           46200013
CR09     CLC   GTMLATBL(4),ZERO1       IS THERE AN ACTIVE LEVEL         46500013
         BE    CR10                    BRANCH IF NO                     46800013
CR12     EQU   *                                                   000A 48800018
         XC    LFORM(64),LFORM                                     000A 50800018
         L     RWORKA,GTMGACBA                                     000A 51000018
         LA    RWORKA,GACBPLUS(RWORKA)                             000A 51200018
         L     RWORKD,ZERO(RWORKA)                                 000A 51400018
         LA    RWORKB,COM                                          000A 51600018
         ST    RWORKB,ZERO(RWORKA)                                000A  51800018
         LR    SPARE1,RWORKA                                       000A 52000018
         ATTNINQ (6),MODE=(C,CR11),TYP=ANY,MF=(E,LFORM)           000A  52200018
         L     RWORKA,GTMGACBA         LOAD GACB ADR                    53100013
         LA    RWORKA,GACBPLUS(RWORKA) LOAD PTR TO TRUE START OF GACB   53400013
         ST    RWORKD,ZERO(RWORKA)     RESTORE OLD COMMAREA             53700013
         B     CR10                    BRANCH                           54000013
CR11     L     RATL,GTMLATBL           LOAD ATTN LEVEL ADR              54300013
         USING  ATTNLEVL,RATL          DEFINE DSECT                     54600013
         CLC   ATTNAVAL(4),ZERO1       ANY ENTRY BLOCKS AVAILABLE       54900013
         BNE   CR13                    BRANCH IF YES                    55200013
         B     CR12                    BRANCH                           55500013
CR13     L     RWORKA,ATTNAVAL         LOAD AVAILABLE ENTRY ADDRESS     55800013
         MVC   ATTNAVAL(4),ZERO(RWORKA) UPDATE CHAIN                    56100013
         MVC   EIGHT(12,RWORKA),COM    MOVE DATA TO ENTRY               56400013
         CLC   ATTNMLEN(4),ZERO1       ANY ENTRIES NOW ON QUEUE         56700013
         BNE   CR21                    BRANCH IF ENTRIES ON QUEUE       57000013
         MVC   ZERO(4,RWORKA),ATTNMLEN UPDATE                           57300013
         ST    RWORKA,ATTNMLEN         CHAIN                            57600013
         B     CR12                    BRANCH                           57900013
CR21     L     REG1,ATTNMLEN           LOAD ADR OF 1ST ENTRY            58200013
CR23     CLC   ZERO(4,REG1),ZERO1      IS THIS LAST ENTRY               58500013
         BE    CR22                    BRANCH IF LAST ENTRY             58800013
         L     REG1,ZERO(REG1)         LOAD ADR OF NEXT ENTRY           59100013
         B     CR23                    BRANCH                           59400013
CR22     ST    RWORKA,ZERO(REG1)       ADD ENTRY TO LIST                59700013
         XC    ZERO(4,RWORKA),ZERO(RWORKA) INDICATE LAST ENTRY          60000013
         B     CR12                    BRANCH                           60300013
CR10     L     RWORKA,GTMGACBA         LOAD ML GACB ADR                 60600013
         LA    RWORKA,GACBPLUS(RWORKA) LOAD PTR TO TRUE START OF GACB   60900013
         SAEC  PFKMSK=NULL,ATTNTYP=NULL,RESTART=YES,MF=(E,(14))         61200013
         L     RWORKA,GTMGACBA         LOAD ADR OF ML GACB              61500013
         L     RWORKA,GACBOFF(RWORKA)  LOAD ADR OF DE GACB              61800013
         LA    RWORKA,GACBPLUS(RWORKA) LOAD PTR TO TRUE START OF GACB   62100013
         SAEC  PFKMSK=NULL,ATTNTYP=NULL,RESTART=YES,MF=(E,(14))         62400013
         L     RATL,ADDRESS            LOAD ADR OF GOTTEN CORE          62700013
         XC    ZERO(256,RATL),ZERO(RATL) CLEAR                          63000013
         LA    RWORKC,COUNT            LOAD LOOP COUNT                  63300013
         LA    RWORKD,DATSRT(RATL)     LOAD ADR OF FIRST ENTRY          63600013
CR14     MVC   ZERO(4,RWORKD),ATTNAVAL PLACE ENTRY-                     63900013
         ST    RWORKD,ATTNAVAL         ON CHAIN                         64200013
         LA    RWORKD,DATSIZE(RWORKD)  LOAD ADR OF NEXT ENTRY           64500013
         BCT   RWORKC,CR14             BRANCH IF MORE TO CREATE         64800013
         MVI   ATTNLVID,ID1            MOVE IN ID                       65100013
         MVI   ATTNLVID+1,ID2          MOVE IN ID                       65400013
         MVI   ATTNLITE,LITE           MOVE IN LIGHT OPTION             65700013
         OI    ATTNFLGA,LP+EOS         SET RESTART OPTIONS=YES          65800013
         LA    RWORKA,TWO              LOAD CONSTANT                    66000013
         CLR   RDEQ,RWORKA             DEQUECT=2                        66300013
         BNE   CR15                    BRANCH IF NO                     66600013
         OI    ATTNFLGA,DEQOPT         SET DEQUECT OPTION               66900013
CR15     L     RWORKA,ATTNL            LOAD LOC TO PLACE ATNLVL ADR     67200013
         LA    RWORKA,ZERO(RWORKA)     ZERO HIGH ORDER BYTE             67500013
         ST    RATL,ZERO(RWORKA)       STORE ATLVL ADR IN USER AREA     67800013
         CLC   GTMLATBL(4),ZERO1       ANY LEVELS EXIST                 68100013
         BNE   CR16                    BRANCH IF YES                    68400013
         ST    RGTMCB,ATTNBKPT         GTMCB ADR TO BP                  68700013
         ST    RATL,GTMLATBL           ADR OF LEVEL TO GTMCB            69000013
         OI    ATTNBPID,BPID           INDICATE POINTS TO GTMCB         69300013
         B     CR17                    BRANCH                           69600013
CR16     L     RWORKA,GTMLATBL         LOAD ADR OF PRES ACT LEVEL       69900013
         ST    RATL,ZERO(RWORKA)       ADR OF NEW TO FP OF OLD          70200013
         ST    RWORKA,ATTNBKPT         ADR OF OLD TO BP OF NEW          70500013
         ST    RATL,GTMLATBL           ADR OF NEW TO GTMCB              70800013
CR17     XC    DECB(36),DECB           CLEAR I/O AREA                   71100013
         TM    GTMFEATS+1,HASPFK       DOES DEVICE HAVE A PF KEYBOARD   71200013
         BC    14,OUTRTN               BRANCH-NO KEYBOARD               71300013
         CLI   GTMLIGHT,LIT2           OPTION 2                         71400013
         BNE   CR18                    BRANCH IF NO                     71700013
         B     CR20                    BRANCH                           72000013
CR18     CLI   GTMLIGHT,LIT3           OPTION 3                         72300013
         BNE   CR19                    BRANCH IF NO                     72600013
         MVC   DATA(4),ATTNPFEN        MOVE IN ENABLED KEYS             72900013
         B     CR20                    BRANCH                           73200013
CR19     MVC   DATA(4),GTMPFKSS        MOVE IN LIGHT MASK               73500013
CR20     LA    REG1,DECB               LOAD DECB ADR                    73800013
         LA    RWORKC,DATA             LOAD DATA ADR                    74100013
         L     RWORKD,GTMGRDCB         LOAD DCB ADR                     74400013
         GCNTRL (1),IND,(7),(11),MF=E                                   74700013
         WAIT  ECB=(1)                                                  75000013
         CLI   DECB,IOK                I/O SUCCESSFULL                  75060013
         BE    OUTRTN                  BRANCH-I/O OK                    75120013
         L     RD,RCODE                LOAD RTN CODE ARRAY ADR          75180013
         OI    ZERO(RD),RC5            INDICATE I/O ERROR               75240013
         B     OUTRTN                  BRANCH                           75300013
ZERO1    DC    1F'0'                   ZERO                             75600013
         CNOP  0,8                                                      75900013
         COPY  ATTNLEVL                                                 76200013
         COPY  GSPCB                                                    76500013
         COPY  GTMCB                                                    76800013
         COPY  GDSCB                                                    77100013
LIST     DSECT                                                          77400013
PLIST    DS    1F                      ADDRESS OF PARAM LIST            77700013
RCODE    DS    1F                      ADDRESS OF RETURN CODE ARRAY     78000013
SAVE     DS    18F                     SAVE AREA                        78300013
DECB     DS    8F                      I/O DECB                         78600013
DATA     DS    1F                      DATA AREA FOR I/O                78900013
MAINCORE DS    4F                      GETMAIN PARAM LIST AREA          79200013
ADDRESS  DS    1F                      LOCATION TO PUT ADR OF GOTTEN    79500013
GACB     DS    1F                                                       79800013
TYPE     DS    BL1                                                      80100013
OPT      DS    BL1                                                      80400013
TYP      DS    1H                                                       80700013
BRANCH   DS    1F                                                       81000013
COM      DS    3F                                                       81300013
LFORM    DS    16F                                                 000A 81400018
PARAMS   DSECT                                                          81600013
DEVICE   DS    1F                      GTMCB                            81900013
ATTNL    DS    1F                      ATTN LEVEL                       82200013
DEQUECT  DS    1F                      DEQUECT                          82500013
         END                                                            82800013
./  ADD  SSI=20480155,NAME=IFFACA01
* TITLE:ENATL-END AN ATTENTION LEVEL                                    00300021
* STATUS:CHANGE LEVEL 0                                                 00600021
* FUNCTION:TO TERMINATE THE SPECIFIED ATTENTION LEVEL AND ANY OTHER     00900021
*          ATTENTION LEVEL(S) LOWER IN THE HIERARCHY FOR ITS GTMCB,     01200021
*          MAKING THE NEXT HIGHER REMAINING ATTENTION LEVEL,IF ANY,     01500021
*          ACTIVE.                                                      01800021
*          TO TERMINATE ALL ATTENTION LEVEL(S) LOWER IN THE HIERARCHY   02100021
*          FOR ITS GTMCB THAN THE SPECIFIED ATTENTION LEVEL,MAKING THE  02400021
*          SPECIFIED ATTENTION LEVEL ACTIVE.                            02700021
* ENTRY:ENTERED AT IFFACA01 VIA A CALL TO ENATL.                        03000021
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD    03300021
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 03600021
*         1.ATTNLEVEL-ADDRESS OF A VARIABLE WHICH CONTAINS THE ADDRESS  03900021
*           OF THE ATTENTION LEVEL.                                     04200021
*         2.RANGECODE-ADDRESS OF A VALUE INDICATING :                   04500021
*           A. 1-TERMINATE SPECIFIED AND ALL LOWER (ASSUMED IF OMITTED) 04800021
*           B. 2-TERMINATE ALL LOWER                                    05100021
* OUTPUT:ATTENTION LEVEL(S) AND QUEUE(S) DELETED.                       05400021
* EXIT:RETURN TO CALLING PROGRAM.                                       05700021
* RETURN CODES:4,1 ATTNLEVEL DID NOT REFER TO A VALID OR EXISTING       06000021
*                  ATTENTION LEVEL.                                     06300021
*              4,2 RANGE CODE INVALID                                   06600021
*              0,0 SUCCESSFULL EXECUTION                                06900021
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE                            07200021
* NOTES:THE FOLLOWING CONTROL BLOCKS ARE EXAMINED BY THIS ROUTINE:      07500021
*       1.GTMCB                                                         07800021
*       2.GSPCB                                                         08100021
* EXTERNAL ROUTINES:ATTNINQ                                             08400021
*                   GIOCR                                               08700021
R0       EQU   0                       PARM REG 0                       09000021
R1       EQU   1                       PARM REG 1                       09300021
RPARAM   EQU   2                       WORK AREA ADR                    09600021
RLIST    EQU   3                       USER PARAM LIST                  09900021
RATL     EQU   4                       ATTN LEVEL REG                   10200021
RGTMCB   EQU   5                       GTMCB REG                        10500021
RET      EQU   6                       INTERVAL RETURN                  10800021
SPARE1   EQU   7                       SPARE REG 1                      11100021
RC       EQU   8                       WORK REG                         11400021
RBASE    EQU   9                       BASE REG                         11700021
RA       EQU   10                      WORK REG                         12000021
RB       EQU   11                      WORK REG                         12300021
SPARE2   EQU   12                      RSVD PL1                         12600021
RSAVE    EQU   13                      SAVE AREA PTR                    12900021
RD       EQU   14                      WORK REG                         13200021
RE       EQU   15                      WORK REG                         13500021
ADD1     EQU   1                       ADD INFO 1                       13800021
ADD2     EQU   2                       ADD INFO 2                       14100021
AN       EQU   12                      OFFSET TO A/N MASK               14400021
ATLID    EQU   X'04'                   ATN LEVEL ID                     14700021
ATLV     EQU   256                     SIZE OF ATTN LEVEL               15000021
BPID     EQU   X'01'                   BACK PTR ID                      15300021
DERB     EQU   32                      SIZE OF DERB                     15600021
GACBOFF  EQU   8                       OFFSET TO GACB                   15900021
HASPFK   EQU   X'10'                   HAS PF KEYBOARD                  16000021
IOK      EQU   X'7F'                   I/O SUCCESSFULL CODE             16100021
LAST     EQU   X'80'                   LAST PARAM                       16200021
LIT1     EQU   X'01'                   OPTION 1                         16500021
LIT2     EQU   X'02'                   OPTION 2                         16800021
LIT3     EQU   X'03'                   OPTION 3                         17100021
LP       EQU   X'01'                   RESTART=YES                      17400021
LPSTRT   EQU   X'08'                   LP RESTART OPTION                17700021
NEXT     EQU   0                       NEXT GACB ADR                    18000021
OFFSAVE  EQU   8                       SAVE AREA CHAIN                  18300021
PF       EQU   8                       OFFSET TO PF MASK                18600021
PFK0     EQU   X'80'                   PFK0 BIT                         18900021
RCC4     EQU   X'08'                   RETURN CODE 4                    19200021
RC4      EQU   16                      OFFSET TO RC 4                   19500021
RC5      EQU   X'04'                   I/O ERROR                        19600021
START    EQU   45                      OFFSET TO START BIT              19800021
ZERO     EQU   0                       ZERO                             20100021
IFFACA01 CSECT                                                          20400021
*2101,645000-687000                                                000A 20500021
         SAVE  (14,12)                 SAVE REGS                        20700021
         BALR  RBASE,0                 SET UP BASE REG                  21000021
         USING *,RBASE                 DEFINE BASE REG                  21300021
         LR    RPARAM,R1               SAVE WORK AREA ADR               21600021
         USING WORKAREA,RPARAM         DEFINE DSECT                     21900021
         L     RLIST,PLIST             LOAD ADR OF USER PARM LIST       22200021
         USING PARAM,RLIST             DEFINE DSECT                     22500021
         ST    RSAVE,SAVE+4            SAVE-SAVE AREA PTR               22800021
         LA    RD,SAVE                 LOAD ADR OF MY SAVE AREA         23100021
         ST    RD,OFFSAVE(RSAVE)       STORE IN USER SAVE AREA          23400021
         LA    RSAVE,SAVE              ESTABLISH NEW SAVE AREA          23700021
         L     RA,RTNARAY              LOAD RTN CODE ARRAY ADR          24000021
         XC    ZERO(20,RA),ZERO(RA)    INITIALIZE RTN CODE ARRAY        24300021
         B     AROUND                  BRANCH                           24600021
ERROR    L     RA,RTNARAY              LOAD RTN CODE ARRAY ADR          24900021
         STC   RB,ZERO(RA)             STORE RETURN CODE                25200021
         ST    RC,ZERO(RD,RA)          STORE ADD INFO AT PROPER OFFSET  25500021
OUTRTN   L     RSAVE,SAVE+4            RESTORE OLD SAVE AREA PTR        25800021
         RETURN (14,12),T              RETURN TO CALLING PROGRAM        26100021
AROUND   L     RATL,ATNLVL             LOAD PTR TO ATLCB ADR            26400021
         LA    RATL,ZERO(RATL)         ZERO HI ORDER BYTE               26700021
         L     RATL,ZERO(RATL)         LOAD ATLCB ADR                   27000021
         USING ATTNLEVL,RATL           DEFINE DSECT                     27300021
         CLI   ATTNLVID+1,ATLID        IS THIS A VALID ATLCB            27600021
         BE    END01                   BRANCH IF VALID                  27900021
         LA    RC,ADD1                 LOAD ADD INFO CODE               28200021
END02    LA    RB,RCC4                 LOAD RETURN CODE                 28500021
         LA    RD,RC4                  LOAD OFFSET TO RETURN CODE       28800021
         B     ERROR                   BRANCH                           29100021
END01    LR    RE,RATL                 SAVE REG                         29400021
END04    CLI   ATTNBPID,BPID           LEVEL POINT TO GTMCB             29700021
         BE    END03                   BRANCH IF YES                    30000021
         L     RATL,ATTNBKPT           LOAD ADR OF NEXT LEVEL           30300021
         B     END04                   BRANCH                           30600021
END03    L     RGTMCB,ATTNBKPT         LOAD GTMCB ADR                   30900021
         USING GTMCB,RGTMCB            DEFINE DSECT                     31200021
         LR    RATL,RE                 RESTORE REGISTER                 31500021
         L     RA,GTMGSPCB             LOAD GSPCB ADR                   31800021
         USING GSPCB,RA                DEFINE DESECT                    32100021
         TM    ATNLVL,LAST             IS THIS LAST PARAM               32400021
         BC    1,END05                 BRANCH IF YES                    32700021
         L     RE,RANGECDE             LOAD RANGE CODE PARAM ADR        33000021
         LA    RE,ZERO(RE)             ZERO HI ORDER BYTE               33300021
         CL    RE,GSPNULLV             IS RANGE CODE ADR OF NULL        33600021
         BE    END05                   BRANCH IF YES                    33900021
         L     RE,ZERO(RE)             LOAD RANGE CODE PARAM            34200021
         CL    RE,ONE                  RANGE CODE=1                     34500021
         BE    END05                   BRANCH IF YES                    34800021
         CL    RE,TWO                  RANGE CODE=2                     35100021
         BE    END06                   BRANCH IF YES                    35400021
         LA    RC,ADD2                 LOAD ADD INFO CODE               35700021
         B     END02                   BRANCH                           36000021
END06    CLC   ATTNFWPT(4),ZERO1       ATLCB FP=0                       36300021
         BNE   END07                   BRANCH IF NO                     36600021
         SR    RC,RC                   ADD INFO=0                       36900021
         B     END02                   BRANCH                           37200021
END07    L     RA,GTMGACBA             LOAD GACB ADR                    37500021
         LA    RB,GACBOFF(RA)          LOAD PTR TO START OF GACB        37800021
         LR    RC,RB                   LOAD REG                         38100021
         LA    RET,END19               LOAD RET ADR                     38400021
         B     END20                   BRANCH                           38700021
END19    EQU   *                                                        39000021
         SAEC  PFKMSK=NULL,ATTNTYP=NULL,RESTART=NO,MF=(E,(11))          39300021
         L     RA,NEXT(RA)             LOAD ADR OF NEXT GACB            39600021
         LA    RB,GACBOFF(RA)          LOAD PTR TO START OF GACB        39900021
         SAEC  PFKMSK=NULL,ATTNTYP=NULL,RESTART=NO,MF=(E,(11))          40200021
         ST    RATL,GTMLATBL           PUT ADR OF NEW ACTIVE LEVEL      40500021
*                                      IN GTMCB                         40800021
         L     RA,ATTNFWPT             SAVE ADR OF 1ST LEVEL TO FREE    41100021
         XC    ATTNFWPT(4),ATTNFWPT    INDICATE LEVEL NOW ACTIVE        41400021
         B     END08                   BRANCH                           41700021
END05    L     RB,GTMGACBA             LOAD GACB ADR                    42000021
         LA    RC,GACBOFF(RB)          LOAD START ADR OF GACB           42300021
         LA    RET,END21               LOAD RETN ADR                    42600021
         B     END20                   BRANCH                           42900021
END21    EQU   *                                                        43200021
         SAEC  PFKMSK=NULL,ATTNTYP=NULL,RESTART=NO,MF=(E,(8))           43500021
         L     RB,NEXT(RB)             LOAD ADR OF NEXT GACB            43800021
         LA    RC,GACBOFF(RB)          LOAD START ADR OF GACB           44100021
         SAEC  PFKMSK=NULL,ATTNTYP=NULL,RESTART=NO,MF=(E,(8))           44400021
         CLI   ATTNBPID,BPID      LEVEL POINT TO GTMCB                  44700021
         BE    END09              BRANCH IF YES                         45000021
         MVC   GTMLATBL(4),ATTNBKPT ESTABLISH NEW ACTIVE LEVEL          45300021
         LR    RA,RATL            SAVE ADR OF 1ST LEVEL TO FREE         45600021
         L     RATL,ATTNBKPT      LOAD ADR OF NEW ACTIVE LEVEL          45900021
         XC    ATTNFWPT(4),ATTNFWPT INDICATE THIS IS ACTIVE LEVEL       46200021
         B     END08              BRANCH                                46500021
END09    XC    GTMLATBL(4),GTMLATBL INDICATE NO ACTIVE LEVELS           46800021
         LR    RA,RATL            LOAD ADR OF 1ST LEVEL TO FREE         47100021
         XC    DECB(36),DECB      CLEAR I/O AREA                        47400021
END10    L     RB,GTMGRDCB        LOAD DCB ADR                          47700021
         LA    RC,DATA            LOAD DATA ADR                         48000021
         LA    R1,DECB            LOAD PARAM LIST ADR                   48300021
         LA    RET,END11          LOAD RETURN ADR                       48600021
         TM    GTMFEATS+1,HASPFK       DOES DEVICE HAVE A PF KEYBOARD   48700021
         BC    14,END11A               BRANCH-NO                        48800021
         GCNTRL (1),IND,(11),(8),MF=E                                   48900021
         WAIT  ECB=(1)                                                  49200021
         CLI   DECB,IOK                I/O SUCCESSFULL                  49250021
         BE    END11A                  BRANCH-I/O OK                    49300021
         L     R1,RTNARAY              LOAD RTN CODE ARRAY ADR          49350021
         OI    ZERO(R1),RC5            INDICATE I/O ERROR               49400021
END11A   EQU   *                                                        49450021
         BR    RET                RETURN                                49500021
END08    L     RATL,GTMLATBL      LOAD ADR OF ACTIVE LEVEL              49800021
         L     RB,GTMGACBA        LOAD GACB ADR                         50100021
         LA    RC,GACBOFF(RB)     LOAD GACB START ADR                   50400021
         MVC   PF(4,RC),ATTNPFEN  MOVE IN ENABLED PF KEYS FOR LEVEL     50700021
         MVC   AN(4,RC),ATTNANEN  MOVE IN ENABLED A/N SOURCES FOR LVL   51000021
         TM    ATTNFLGA,LPSTRT    RESTART WANTED FOR LP                 51300021
         BC    14,END12                BRANCH IF NO                     51600021
         MVI   START(RC),LP            MOVE IN RESTART                  51900021
END12    L     RB,NEXT(RB)             LOAD NEXT GACB ADR               52200021
         LA    RC,GACBOFF(RB)          LOAD GACB START ADR              52500021
         MVC   PF(4,RC),ATTNPFDE       MOVE IN ENABLED PF FOR DE        52800021
         MVC   AN(4,RC),ATTNANDE       MOVE IN ENABLED A/N FOR DE       53100021
         TM    ATTNFLGA,LPSTRT         RESTART WANTED                   53400021
         BC    14,END13                BRANCH IF NO                     53700021
         MVI   START(RC),LP            MOVE IN RESTART                  54000021
END13    XC    DECB(36),DECB           CLEAR I/O AREA                   54300021
         CLI   ATTNLITE,LIT1           OPTION 1                         54600021
         BE    END14                   BRANCH IF YES                    54900021
         CLI   ATTNLITE,LIT2           OPTION 2                         55200021
         BE    END15                   BRANCH IF YES                    55500021
         CLI   ATTNLITE,LIT3           OPTION 3                         55800021
         BE    END16                   BRANCH IF YES                    56100021
         MVC   DATA(4),ATTNPFLM        MOVE IN LIGHT MASK               56400021
         B     END10                   BRANCH                           56700021
END15    EQU   *                                                        57000021
         B     END10                   BRANCH                           57300021
END16    MVC   DATA(4),ATTNPFEN        MOVE IN ENABLED KEYS             57600021
         B     END10                   BRANCH                           57900021
END14    CLI   GTMLIGHT,LIT2           OPTION 2                         58200021
         BE    END15                   BRANCH IF YES                    58500021
         CLI   GTMLIGHT,LIT3           OPTION 3                         58800021
         BE    END16                   BRANCH IF YES                    59100021
         MVC   DATA(4),GTMPFKSS        MOVE IN LIGHT MASK               59400021
         B     END10                   BRANCH                           59700021
END11    LR    RATL,RA                 LOAD ADR OF      LEVEL TO FREE   60000021
         L     RA,ATTNFWPT             LOAD ADDR OF NEXT LEVEL TO FREE  60300021
END18    CLC   ATTNDERB(4),ZERO1       ANY DERBS TO FREE                60600021
         BE    END17                   BRANCH IF NO                     60900021
         L     R1,ATTNDERB             LOAD ADR OF DERB                 61200021
         MVC   ATTNDERB(4),ZERO(R1)    UPDATE CHAIN                     61500021
         LA    R0,DERB                 LOAD # OF BYTES TO FREE          61800021
         FREEMAIN R,LV=(0),A=(1)                                        62100021
         B     END18                   BRANCH                           62400021
END17    LR    R1,RATL                 LOAD ADR TO FREE                 62700021
         LA    R0,ATLV                 LOAD SIZE TO FREE                63000021
         FREEMAIN R,LV=(0),A=(1)                                        63300021
         LTR   RA,RA                   ANY MORE LEVELS TO FREE          63600021
         BC    7,END11                 BRANCH IF YES                    63900021
         B     OUTRTN                  BRANCH                           64200021
END20    EQU   *                                                   000A 65200021
         XC    LFORM(64),LFORM          ZERO LIST                  000A 66200021
         ATTNINQ (8),MODE=(C,END22),TYP=ANY,MF=(E,LFORM)           000A 67200021
         BR    RET                     RETURN                           69000021
END22    B     END20                   CONTINUE DATA FLUSH              69300021
         DS    0F                                                       69600021
ZERO1    DC    1F'0'                                                    69900021
ONE      DC    A(1)                                                     70200021
TWO      DC    A(2)                                                     70500021
         CNOP  0,8                                                      70800021
         COPY  GSPCB                                                    71100021
         COPY  GTMCB                                                    71400021
         COPY  ATTNLEVL                                                 71700021
PARAM    DSECT                                                          72000021
ATNLVL   DS    1F                                                       72300021
RANGECDE DS    1F                                                       72600021
WORKAREA DSECT                                                          72900021
PLIST    DS    1F                                                       73200021
RTNARAY  DS    1F                                                       73500021
SAVE     DS    18F                                                      73800021
DECB     DS    8F                                                       74100021
DATA     DS    1F                                                       74400021
GACB     DS    1F                      *                                74700021
TYPE     DS    BL1                     *                                75000021
OPT      DS    BL1                     ATTNINQ MACRO AREA               75300021
TYP      DS    1H                                                       75600021
BRANCH   DS    1F                      *                                75900021
LFORM    DS    16F                                                 000A 76000021
         END                                                            76200021
./  ADD  SSI=20480157,NAME=IFFACA02
*   NAME                                                                00200021
*        ENATN                                                          00400021
*   MODULE NAME                                                         00600021
*        IFFAC02                                                        00800021
*                                                                       01000021
*   FUNCTION                                                            01200021
*        TO ENABLE PROCESSING OF ATTENTION OCCURRENCE(S)                01400021
*        ON THE DESIGNATED SOURCE(S) WHEN THE ASSOCIATED                01600021
*        ATTENTION LEVEL IS ACTIVE.                                     01800021
*                                                                       02000021
*   ENTRY                                                               02200021
*        CSECT NAME                                                     02400021
*                                                                       02600021
*   INPUT                                                               02800021
*        REGISTER 1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.           03000021
*        THE FIRST WORD CONTAINS THE ADDRESS OF A PARAMETER LIST        03200021
*        COMPOSED OF.                                                   03400021
*              1. ADDRESS OF A VARIABLE CONTAINING THE ATTENTION        03600021
*                 TABLE ADDRESS(ATTNLEVEL).                             03800021
*              2. ADDRESS OF ATTENTION SOURCE(S) (ATTNSOURCE).          04000021
*                 1-31   PROGRAM FUNCTION KEYS 1-31                     04200021
*                 32     END KEY                                        04400021
*                 33     CANCEL KEY                                     04600021
*                 34     LIGHT PEN                                      04800021
*                 35     EOS                                            05000021
*                 36     ASYNCHRONOUS ERROR                             05200021
*                 TO GIVE INDIVIDUAL SOURCES, GIVE A NUMBER.            05400021
*                 TO GIVE SOURCES 5 TO 10, FOR EXAMPLE, 5 IS            05600021
*                 POSITIVE AND 10 IS NEGATIVE.                          05800021
*   OUTPUT                                                              06000021
*        ENABLE MASK TO ATTENTION TABLE AND DELETION OF ANY             06200021
*        ATTENTIONS FROM THE QUEUE THAT MATCH THOSE ATTENTION           06400021
*        TYPES JUST ENABLED.                                            06600021
*   EXIT                                                                06800021
*        TO CALLER VIA REGISTER 14                                      07000021
*   RETURN CODES                                                        07200021
*        4,1   INVALID ATTENTION LEVEL                                  07400021
*        4,N   INVALID SOURCE CODE                                      07600021
*   ATTRIBUTES                                                          07800021
*        REENTRANT, PROBLEM PROGRAM MODE                                08000021
*   FLOWCHARTS                                                          08200021
*        CG, CH, CI                                                     08400021
IFFACA02 CSECT                                                          08600021
*2101,462000-504000                                                000A 08700021
         TITLE  'ENATN - ENABLE ATTENTIONS'                             08800021
REG0     EQU   0                       PARAM REG 0                      09000021
REG1     EQU   1                       PARAM REG 1                      09200021
RLIST    EQU   2                       INPUT PARAM LIST                 09400021
RPARAM   EQU   3                       USER PARAM LIST                  09600021
RATL     EQU   4                       ATTENTION LEVEL ADDR             09800021
RGTMCB   EQU   5                       GTMCB ADR                        10000021
RWORKF   EQU   6                                                        10200021
RWORKD   EQU   7                       WORK REG                         10400021
RBASE    EQU   9                       BASE REG                         10600021
RWORKC   EQU   11                      WORK REG                         10800021
RSAVE    EQU   13                      SAVE AREA REG                    11000021
RWORKA   EQU   14                      WORK REG                         11200021
RWORKB   EQU   15                      WORK REG                         11400021
RSOURCE  EQU   2             CONVERTA  ATTNSOURCE ADR REG               11600021
RFIRST   EQU   3             CONVERTA  FIRST ARG REG                    11800021
RINFO    EQU   4             CONVERTA  ADD INFO REG                     12000021
RPFA     EQU   5             CONVERTA  PF REG                           12200021
RANA     EQU   6             CONVERTA  A/N REG                          12400021
RA       EQU   7             CONVERTA  WORK REG A                       12600021
RB       EQU   8             CONVERTA  WORK REG B                       12800021
* RBASE  EQU   9                       BASEREG DUMMY                    13000021
RC       EQU   10            CONVERTA  WORK REG C                       13200021
RD       EQU   11            CONVERTA  WORK REG D                       13400021
RE       EQU   12            CONVERTA  WORK REG E                       13600021
ADD0     EQU   0                       ADD INFO 0                       13800021
ADD1     EQU   1                                                        14000021
ADD5     EQU   2                       ADD INFO EQUAL 2 FOR ENATTN      14200021
AID      EQU   X'04'                   ATTN LEVEL ID                    14400021
ANTYPE   EQU   X'01'                   A/N END KEY                      14600021
ATYPE    EQU   11                                                       14800021
BPIND    EQU   19                      BACK POINTER INDICATOR           15000021
EGHT     EQU   8                                                        15200021
GACBPLUS EQU   8                       OFFSET TO GACB ADDR              15400021
HASPFK   EQU   X'10'                   HAS PF KEYBOARD                  15500021
HEX00    EQU   X'00'                                                    15600021
HEX01    EQU   X'01'                                                    15800021
HEX03    EQU   X'03'                                                    16000021
HEX04    EQU   X'04'                                                    16200021
HEXFF    EQU   X'FF'                                                    16400021
IOK      EQU   X'7F'                   I/O SUCCESSFULL CODE             16500021
KEYNUM   EQU   10                                                       16600021
L4       EQU   4                                                        16800021
LAST     EQU   X'80'                   LAST PARAMETER                   17000021
NEG      EQU   X'80'                   NEGATIVE VALUE                   17200021
NEXT     EQU   4                       NEXT SOURCE                      17400021
ONE      EQU   1                                                        17600021
PFK0     EQU   X'80'                   PFK0 BIT                         17800021
PFTYPE   EQU   X'02'                                                    18000021
RCC4     EQU   X'08'                   RETURN CODE 4                    18200021
RC4      EQU   16                      OFFSET TO RC4                    18400021
RC5      EQU   X'04'                   I/O ERROR                        18500021
TWO      EQU   2                                                        18600021
TWLV     EQU   12                                                       18800021
ZERO     EQU   0                       ZERO                             19000021
         SAVE  (14,12)                 SAVE REGISTERS                   19200021
         BALR  RBASE,0                 SET UP BASE REG                  19400021
         USING *,RBASE                 DEFINE BASE REG                  19600021
         LR    RLIST,REG1              SAVE INPUT PARAM                 19800021
         USING WORKAREA,RLIST          DEFINE DSECT                     20000021
         L     RPARAM,PARAM            LOAD ADDR USER PARAM LIST        20200021
         USING PLIST,RPARAM            DEFINE DSECT                     20400021
         ST    RSAVE,SAVE+4            MY SAVE ARE ADDR                 20600021
         LA    RSAVE,SAVE              LOAD ADDR MY SAVE AREA           20800021
         ST    RSAVE,SAVE+8            SAVE USERS R13                   21000021
         L     RWORKA,RCA              LOAD RETURN CODE ARRAY ADDR      21200021
         XC    ZERO(20,RWORKA),ZERO(RWORKA)  ZERO ARRAY                 21400021
         B     AROUND                                                   21600021
ERROR    EQU   *                                                        21800021
*   RETURN CODE MUST BE LOADED INTO REG RWORKB (15)                     22000021
*   ADD INFO MUST BE LOADED INTO REG RWORKC (R11)                       22200021
*   OFFSET MUST BE LOADED INTO REG RWORKD (R12)                         22400021
*   UPON ENTRY TO ERROR ROUTINE                                         22600021
         L     RWORKA,RCA              LOAD RETURN CODE ARRAY ADDR      22800021
         STC   RWORKB,ZERO(RWORKA)     STORE RETURN CODE                23000021
         ST    RWORKC,ZERO(RWORKD,RWORKA) STO ADD INFO AT PROPER OFFSET 23200021
OUT      L     RSAVE,SAVE+4            RESTABLISH OLD SAVE AREA         23400021
         RETURN (14,12),T              RETURN TO CALLER                 23600021
AROUND   TM    ATNLVL,LAST             LAST PARAM                       23800021
         BC    14,REQ01                BRANCH IF NO                     24000021
         LA    RWORKC,ADD0             LOAD ADD INFO                    24200021
REQ03    LA    RWORKB,RCC4             LOAD RETURN CODE                 24400021
         LA    RWORKD,RC4              LOAD OFFSET                      24600021
         B     ERROR                                                    24800021
REQ01    L     RATL,ATNLVL             LOAD INDIRECT PTR TO ATTN LEVEL  25000021
         L     RATL,ZERO(RATL)         LOAD ATTN LEVEL ADDR             25200021
         USING ATTNLEVL,RATL           DEFINE DSECT                     25400021
         CLI   ATTNLVID+1,AID          IS THIS VALID ATTN LEVEL         25600021
         BNE   REQ40                   BRANCH IF NO ADD INFO EQUAL1     25800021
*   TEST FOR ANY ATTNSOURCES SPECIFIED                                  26000021
         L     RWORKC,ATNSRCE          LOAD ADDR OF DATA                26200021
         LA    RWORKC,ZERO(RWORKC)     ZERO HI ORDER BIT                26400021
         LTR   RWORKC,RWORKC           IS THERE AN ADDR THERE           26600021
         BZ    INFOADD0                NO                               26800021
         BAL   RWORKA,CONVERTA         BRANCH TO ATTNSOURCE CONVERSION  27000021
         LTR   RWORKB,RWORKB           RC=0                             27200021
         BZ    GOOD                    YES                              27400021
         LR    RWORKC,RWORKB           LOAD ADD INFO                    27600021
         B     REQ03                                                    27800021
REQ40    EQU   *                                                        28000021
         LA    RWORKC,ADD1             LOAD ADD INFO CODE OF 1          28200021
         B     REQ03                                                    28400021
INFOADD0 EQU   *                                                        28600021
*   NO ATTN SOURCE PARAMETER SPECIFIED                                  28800021
         LA    RWORKC,ADD5             LOAD ADD INFO CODE OF 2          29000021
         B     REQ03                                                    29200021
GOOD     EQU   *                                                        29400021
         ST    REG0,ANMASK             SAVE AN MASK                     29600021
         ST    REG1,PFMASK             SAVE PF MASK                     29800021
         OC    ATTNANEN,ANMASK         OR AN MASK TO PERM MASK IN ATLV  30000021
         OC    ATTNPFEN,PFMASK         OR PF MASK TO PERM MASK IN ATLV  30200021
         CLC   ATTNFWPT(4),ZERO1       IS LEVEL ACTIVE                  30400021
         BE    ATNQ                    CONSTRUCT ATTNINQ-IF YES         30600021
TESTATTN EQU   *                                                        30800021
*   TEST ENTRIES ON ATTNMLEN QUEUE FOR MATCH TO NEWLY ENABLED SOURCES   31000021
REQ60    CLC   ATTNMLEN,ZERO1          ANY DATA                         31200021
         BE    TSTATDTA                NO-TEST ATTNDATA QUEU            31400021
         L     RWORKA,ATTNMLEN         LOAD ADDR OF FIRST ENTRY         31600021
         SR    RWORKF,RWORKF           CLEAR PREVIOUS ENTRY REG         31800021
         MVI   ATNFLAG,HEX00           CLEAR ATTNDATA SWITCH            32000021
PFATTNKY CLI   ATYPE(RWORKA),PFTYPE    PF ATTN                          32200021
         BE    PFATTN                  YES                              32400021
         LA    RWORKB,ONE              PRIME REG WITH VALUE ONE         32600021
         CLI   ATYPE(RWORKA),ANTYPE    END KEY ATTN                     32800021
         BE    ANDREG                  YES                              33000021
         SR    RWORKC,RWORKC                CLEAR REG                   33200021
         IC    RWORKC,ATYPE(RWORKA)         INSERT ATTN TYPE            33400021
         LA    RWORKD,TWO              LOAD CONSTANT                    33600021
         SR    RWORKC,RWORKD           DETERMINE SHIFT CONSTANT         33800021
         SLL   RWORKB,ZERO(RWORKC)     POSITION BIT                     34000021
ANDREG   N     RWORKB,ANMASK           DETERMINE IF MATCH               34200021
         LTR   RWORKB,RWORKB           WAS THERE A MATCH                34400021
         BC    7,MATCH                 WK REG EQUAL NON ZERO - BRANCH   34600021
SWPTRS   EQU   *                                                        34800021
SAVEADDR EQU   *                                                        35000021
*   PRESENT ENTRY TO PREVIOUS REGISTER                                  35200021
         LR    RWORKF,RWORKA           SAVE ADDR IN PREVIOUS ENTRY REG  35400021
         L     RWORKA,ZERO(RWORKA)     LOAD PTR TO NEXT ENTRY           35600021
         LTR   RWORKA,RWORKA           ANY MORE ENTRIES                 35800021
         BC    7,PFATTNKY              RWORKA EQUAL NON ZERO-BRANCH     36000021
         B     TSTATDTA                NO                               36200021
MATCH    EQU   *                                                        36400021
         CLI   ATNFLAG,HEX01           ENTRY FROM ATTNDATA              36600021
         BE    FLAGDEL                      YES                         36800021
         LTR   RWORKF,RWORKF           FIRST ENTRY                      37000021
         BZ    DEQENTRY                                                 37200021
*   MOVE FP OF ENTRY TO FP OF PREVIOUS                                  37400021
         MVC   ZERO(4,RWORKF),ZERO(RWORKA)  DEQUEUE ENTRY               37600021
         B     REQ61                                                    37800021
*   MOVE FP OF FIRST TO ATTNMLEN                                        38000021
DEQENTRY MVC   ATTNMLEN(4),ZERO(RWORKA)     DEQUEUE ENTRY               38200021
REQ61    MVC   ZERO(4,RWORKA),ATTNAVAL      ADD ENTRY TO TABLE          38400021
         ST    RWORKA,ATTNAVAL              AVAILABLE LIST              38600021
         B     REQ60                                                    38800021
PFATTN   L     RWORKB,PRIME            PRIME PF REG                     39000021
         SR    RWORKC,RWORKC                CLEAR REG                   39200021
         IC    RWORKC,KEYNUM(RWORKA)        INSERT KEY NUMBER           39400021
         SRL   RWORKB,ZERO(RWORKC)          POSITION BIT                39600021
         N     RWORKB,PFMASK                DETERMINE IF A MATCH        39800021
         LTR   RWORKB,RWORKB                WAS THERE A MATCH           40000021
         BC    7,MATCH                 WK REG EQUAL NON ZERO - BRANCH   40200021
         B     SAVEADDR                                                 40400021
TSTATDTA EQU   *                                                        40600021
         CLI   ATNFLAG,HEX01           BEEN HERE BEFORE                 40800021
         BE    ACTATNLV                YES                              41000021
         CLC   ATTNDATA,ZERO1          ANY DATA                         41200021
         BE    ACTATNLV                                                 41400021
         L     RWORKA,ATTNDATA              LOAD ADDR OF FIRST ENTRY    41600021
         MVI   ATNFLAG,HEX01           SET ATTNDATA ENTRY SWITCH ON     41800021
         SR    RWORKF,RWORKF           CLEAR PREVIOUS ENTRY REG         42000021
         B     PFATTNKY                                                 42200021
FLAGDEL  EQU   *                                                        42400021
*   RWORKA HAS ADDR OF ENTRY ON ATTN QUEU                               42600021
         MVI   20(RWORKA),HEX01        SET PENDING DELETION FLAG        42800021
         B     SWPTRS                                                   43000021
ATNQ     EQU   *                                                        43200021
         ST    RATL,SAVE1              SAVE ATTN LVL ADDR               43400021
AGAIN    CLI   ATTNBPID,HEX01          ATBL BP POINT TO GTMCB           43600021
         BE    LBPTR                   YES                              43800021
         L     RATL,ATTNBKPT           LOAD BACKWARD PTR INTO BASE REG  44000021
         B     AGAIN                                                    44200021
LBPTR    L     RGTMCB,ATTNBKPT         LOAD BASE                        44400021
         USING GTMCB,RGTMCB            DEFINE DESECT                    44600021
         L     RATL,SAVE1              RESTORE ATTN LVL ADDR            44800021
*   REPLACE AN AND PF MASKS IN ATTN LVL 3 OF GACB                       45000021
         L     RWORKA,GTMGACBA         LOAD GACB ADR                    45200021
         LA    RWORKA,GACBPLUS(RWORKA) LOAD PTR TO TRUE START OF GACB   45400021
         MVC   EGHT(L4,RWORKA),PFMASK  PUT NEW PF MASK INTO GACB+8      45600021
         MVC   TWLV(L4,RWORKA),ANMASK  PUT NEW AN MASK INTO GACB+12     45800021
CR12     EQU   *                                                        46000021
         ST    RANA,ATTSAVE                                        000A 46600021
         L     RANA,GTMGACBA            GACB ADDR                  000A 47200021
         LA    RANA,GACBPLUS(RANA)      TRUE GACB ADDR             000A 47800021
         XC    LFORM(64),LFORM          ZERO LIST                  000A 48400021
         ATTNINQ (6),MODE=(C,CR12),TYP=ANY,MF=(E,LFORM)            000A 49000021
         L     RANA,ATTSAVE                                        000A 49600021
*   TEST ENTRIES ON ATTNDATA FOR MATCH TO NEWLY ENABLED SOURCES         50600021
         B     TESTATTN                                                 50800021
ACTATNLV EQU   *                                                        51000021
         CLC   ATTNFWPT(4),ZERO1       IS LEVEL ACTIVE                  51200021
         BNE   RETCODE0                NO                               51400021
*   PUT NEW PERM MASKS IN GACB3                                         51600021
         L     RWORKA,GTMGACBA         LOAD GACB ADDR                   51800021
         LA    RWORKA,GACBPLUS(RWORKA) LOAD PTR TO TRUE START OF GACB   52000021
         MVC   8(4,RWORKA),ATTNPFEN    PUT PF ATN LVL MASK INTO GACB    52200021
         MVC   12(4,RWORKA),ATTNANEN   PUT AN ATN LVL MASK INTO GACB    52400021
         TM    GTMFEATS+1,HASPFK       DOES DEVICE HAVE A PF KEYBOARD   52460021
         BC    14,OUT                  BRANCH-NO                        52520021
         L     RWORKA,ATTNPFEN         LOAD PF MASK                     52600021
         LTR   RWORKA,RWORKA           ANY PF KEYS ENABLED              52800021
         BZ    RETCODE0                NO                               53000021
         CLI   ATTNLITE,HEX03          ENABLED KEYS USED FOR PF LITES   53200021
         BE    TURNONL                                                  53400021
*   SET PF LITES ON AS PER ENABLED KEYS                                 53600021
         CLI   ATTNLITE,HEX01          SYS DEFAULT OPTION IN GTMCB      53800021
         BNE   RETCODE0                                                 54000021
         CLI   GTMLIGHT,HEX03          LIGHT ENABLED KEYS               54200021
         BNE   RETCODE0                NO                               54400021
*   TURN PF LIGHTS ON                                                   54600021
TURNONL  EQU   *                                                        54800021
         XC    DECB(36),DECB           CLEAR I/O AREA                   55000021
         L     RWORKD,GTMGRDCB         LOAD DCB ADDR                    55200021
         LA    RWORKC,DATA             LOAD DATA ADDR                   55400021
         LA    REG1,DECB               LOAD PARM LIST ADDR              55600021
         MVC   DATA(4),ATTNPFEN        PUT KEY MASK INTO DATA (LIGHTS)  55800021
         GCNTRL (1),IND,(7),(11),MF=E  TURN LIGHTS ON                   56000021
         WAIT  ECB=(1)                                                  56200021
         CLI   DECB,IOK                I/O SUCCESSFULL                  56230021
         BE    OUT                     BRANCH- I/O OK                   56260021
         L     REG1,RCA                LOAD RTN CODE ARRAY ADR          56290021
         OI    ZERO(REG1),RC5          INDICATE I/O ERROR               56320021
         B     OUT                     RETURN TO CALLER                 56350021
RETCODE0 EQU   *                                                        56600021
         B     OUT                     RETURN TO CALLER                 56700021
         LA    RWORKC,ADD0             LOAD ADD INFO                    56800021
         LA    RWORKB,ADD0             LOAD RETURN CODE                 57000021
         LA    RWORKD,RC4              LOAD OFFSET                      57200021
         B     ERROR                                                    57400021
         EJECT                                                          57600021
CONVERTA SAVE  (2,12)                  SAVE REGS                        57800021
         LA    RSOURCE,ATNSRCE         LOAD ADR OF 1ST ARG              58000021
         LA    RFIRST,NEXT             INDICATE 1ST ARG                 58200021
         SR    RPFA,RPFA               CLEAR PF REG                     58400021
         SR    RANA,RANA               CLEAR A/N REG                    58600021
         LA    RINFO,ADD5              LOAD 1ST ADD INFO CODE           58800021
         B     REQ18                   BRANCH                           59000021
REQOK    SR    RWORKB,RWORKB           ZERO RETURN CODE                 59200021
         LR    REG0,RANA               LOAD A/N MASK                    59400021
         LR    REG1,RPFA               LOAD P/F MASK                    59600021
         B     REQ19                   BRANCH                           59800021
REQERR   LR    RWORKB,RINFO            LOAD RETURN CODE                 60000021
REQ19    RETURN (2,12)                 RETURN                           60200021
REQ18    L     RC,ZERO(RSOURCE)        LOAD ADR OF ARG                  60400021
         TM    ZERO(RC),NEG            ARG NEGATIVE                     60600021
         BC    1,REQNEG                BRANCH IF NEG                    60800021
         L     RB,ZERO(RC)             LOAD VALUE OF ARG                61000021
REQ24    CL    RB,MAX                  VALUE GREATER THAN ALLOWABLE     61200021
         BC    2,REQERR                BRANCH IF YES                    61400021
REQ23    CL    RB,ANSIZE               VALUE GREATER THAN 31            61600021
         BC    2,REQ20                 BRANCH IF YES                    61800021
         L     RE,PRIME                PRIME REG                        62000021
         SRL   RE,ZERO(RB)             POSITION BIT                     62200021
         OR    RPFA,RE                 ADD TO PF MASK                   62400021
REQ26    TM    ZERO(RC),NEG            ARG NEG                          62600021
         BC    1,REQ21                 BRANCH IF YES                    62800021
REQ22    TM    ZERO(RSOURCE),LAST      MORE ARGS                        63000021
         BC    1,REQOK                 BRANCH IF NO                     63200021
         L     RA,ZERO(RC)             SAVE VALUE PRESENT ARG           63400021
         LA    RSOURCE,NEXT(RSOURCE)   STEP TO NEXT ARG                 63600021
         SR    RFIRST,RFIRST           INDICATE NOT 1ST ARG             63800021
         LA    RINFO,ONE(RINFO)        INCREMENT ADD INFO               64000021
         B     REQ18                   BRANCH TO MORE ARGS              64200021
REQ21    LA    RE,ONE                  LOAD CONSTANT                    64400021
         SR    RB,RE                   DECREMENT ARG BY 1               64600021
         CLR   RA,RB                   VALUE=PREVIOUS VALUE             64800021
         BE    REQ22                   BRANCH IF YES                    65000021
         B     REQ23                   BRANCH                           65200021
REQNEG   LTR   RFIRST,RFIRST           FIRST ARG                        65400021
         BC    7,REQERR                BRANCH IF YES                    65600021
         LTR   RA,RA                   PREV ARG NEG                     65800021
         BC    4,REQERR                BRANCH IF YES                    66000021
         L     RB,ZERO(RC)             LOAD VALUE OF ARG                66200021
         LPR   RB,RB                   MAKE ARG POS                     66400021
         CLR   RB,RA                   VALUE GREATER THAN PREV ARG      66600021
         BC    2,REQ24                 BRANCH IF YES                    66800021
         B     REQERR                  BRANCH                           67000021
REQ20    LA    RD,END                  LOAD ADR OF CONSTANT             67200021
         LA    RE,ONE                  LOAD CONSTANT                    67400021
REQ27    CL    RB,ZERO(RD)             COMPARE                          67600021
         BE    REQ25                   BRANCH IF YES                    67800021
         SLL   RE,ONE                  SHIFT BIT                        68000021
         LA    RD,NEXT(RD)             LOAD NEXT CONSTANT ADR           68200021
         B     REQ27                   BRANCH                           68400021
REQ25    OR    RANA,RE                 ADD BIT TO MASK                  68600021
         B     REQ26                   BRANCH                           68800021
         SPACE 3                                                        69000021
*   CONSTANTS                                                           69200021
*   END,LP,EOS,CANCEL,MAX,ANSIZE FIELDS MUST BE IN SEQUENCE             69400021
END      DC    A(32)                                                    69600021
LP       DC    A(34)                                                    69800021
EOS      DC    A(35)                                                    70000021
CANCEL   DC    A(33)                                                    70200021
MAX      DC    A(36)                                                    70400021
ANSIZE   DC    A(31)                                                    70600021
PRIME    DC    X'80000000'             PF PRIME VALUE                   70800021
ZERO1    DC    1F'0'                                                    71000021
         EJECT                                                          71200021
WORKAREA DSECT                                                          71400021
PARAM    DS    1F                                                       71600021
RCA      DS    1F                                                       71800021
ANMASK   DS    1F                      SAVE AREA FOR ANMASK             72000021
PFMASK   DS    1F                      SAVE AREA FOR PFMASK             72200021
SAVE     DS    18F                                                      72400021
DECB     DS    8F                      I/O DECB                         72600021
SAVE1    DS    1F                                                       72800021
*   GACB,TYPE,OPT,TYP,BRANCH,COM FIELDS MUST BE IN SEQUENCE             73000021
GACB     DS    1F                                                       73200021
TYPE     DS    BL1                                                      73400021
OPT      DS    BL1                                                      73600021
TYP      DS    1H                                                       73800021
BRANCH   DS    1F                                                       74000021
COM      DS    3F                                                       74200021
DATA     DS    1F                      DATA AREA FOR IO                 74400021
ATNFLAG  DS    BL1                     ATTNDATA SWITCH                  74600021
ATTSAVE  DS    F                                                   000A 74660021
LFORM    DS    16F                                                 000A 74720021
         SPACE 3                                                        74800021
PLIST    DSECT                                                          75000021
ATNLVL   DS    1F                                                       75200021
ATNSRCE  DS    1F                                                       75400021
         EJECT                                                          75600021
         COPY  ATTNLEVL                                                 75800021
         COPY  GTMCB                                                    76000021
         COPY  GDSCB                                                    76200021
         COPY  GSPCB                                                    76400021
         END                                                            76600021
./  ADD  SSI=20480162,NAME=IFFACA03
*   NAME                                                                00300021
*        DISATN                                                         00600021
*                                                                       00900021
*   MODLUE NAME                                                         01200021
*        IFFACA03                                                       01500021
*                                                                       01800021
*   FUNCTION                                                            02100021
*        TO CAUSE GSP TO DISREGARD SUBSEQUENT OCCURRANCE OF             02400021
*        ATTENTIONS ON THE DESIGNATED SOURCE(S) WHEN THE                02700021
*        ASSOCIATED ATTENTION LEVEL IS ACTIVE.                          03000021
*                                                                       03300021
*   ENTRY                                                               03600021
*        CSECT NAME                                                     03900021
*                                                                       04200021
*   INPUT                                                               04500021
*        REGISTER 1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.           04800021
*        THE FIRST WORD CONTAINS THE ADDRESS OF A PARAMETER             05100021
*        LIST CONTAINING.                                               05400021
*              4. ADDRESS OF A VARIABLE CONTAINING THE ADDRESS          05700021
*                 OF THE ATTENTION LEVEL(ATTNLEVEL).                    06000021
*              2. ADDRESS OF ATTENTION SOURCE(S) TO BE DISABLED         06300021
*                 (ATTNSOURCE).                                         06600021
*                 1-31   PROGRAM FUNCTION KEYS 1-31                     06900021
*                 32     END KEY                                        07200021
*                 33     CANCEL KEY                                     07500021
*                 34     LIGHT PEN                                      07800021
*                 35     EOS                                            08100021
*                 36     ASYNCHRONOUS ERROR                             08400021
*                                                                       08700021
*                 TO GIVE INDIVIDUAL SOURCES, GIVE A NUMBER.            09000021
*                 TO GIVE SOURCES 5 TO 10, FOR EXAMPLE, 5 IS            09300021
*                 POSITIVE AND 10 IS NEGATIVE.                          09600021
*                                                                       09900021
*   OUTPUT                                                              10200021
*        RESET INDICATED ATTENTION SOURCE BIT(S) IN THE                 10500021
*        ATTENTION TABLE ENABLED SOURCE MASKS.                          10800021
*                                                                       11100021
*   EXIT                                                                11400021
*        RETURN TO CALLING ROUTINE VIA REGISTER 14.                     11700021
*                                                                       12000021
*   RETURN CODES                                                        12300021
*        4,1   INVALID ATTENTION LEVEL                                  12600021
*        4,N   INVALID SOURCE CODE                                      12900021
*                                                                       13200021
*   ATTRIBUTES                                                          13500021
*        REENTRANT, PROBLEM PROGRAM MODE                                13800021
*   FLOWCHARTS                                                          14100021
*        CM, CN, CO                                                     14400021
         TITLE 'DISATN - DISABLE ATTENTIONS'                            14700021
REG0     EQU   0                       PARAM REG 0                      15000021
REG1     EQU   1                       PARAM REG 1                      15300021
RLIST    EQU   2                       INPUT PARAM LIST                 15600021
RPARAM   EQU   3                       USER PARAM LIST                  15900021
RATL     EQU   4                       ATTENTION LEVEL ADDR             16200021
RGTMCB   EQU   5                       GTMCB ADR                        16500021
RWORKD   EQU   7                       WORK REG                         16800021
RBASE    EQU   9                       BASE REG                         17100021
RWORKC   EQU   11                      WORK REG                         17400021
RSAVE    EQU   13                      SAVE AREA REG                    17700021
RWORKA   EQU   14                      WORK REG                         18000021
RWORKB   EQU   15                      WORK REG                         18300021
RSOURCE  EQU   2             CONVERTA  ATTNSOURCE ADR REG               18600021
RFIRST   EQU   3             CONVERTA  FIRST ARG REG                    18900021
RINFO    EQU   4             CONVERTA  ADD INFO REG                     19200021
RPFA     EQU   5             CONVERTA  PF REG                           19500021
RANA     EQU   6             CONVERTA  A/N REG                          19800021
RA       EQU   7             CONVERTA  WORK REG A                       20100021
RB       EQU   8             CONVERTA  WORK REG B                       20400021
* RBASE  EQU   9                       BASEREG DUMMY                    20700021
RC       EQU   10            CONVERTA  WORK REG C                       21000021
RD       EQU   11            CONVERTA  WORK REG D                       21300021
RE       EQU   12            CONVERTA  WORK REG E                       21600021
ADD0     EQU   0                       ADD INFO 0                       21900021
ADD1     EQU   1                                                        22200021
ADD5     EQU   2                       ADD INFO EQUAL 2 FOR ENATTN      22500021
AID      EQU   X'04'                   ATTN LEVEL ID                    22800021
GACBPLUS EQU   8                       OFFSET TO GACB ADDR              23100021
HASPFK   EQU   X'10'                   HAS PF KEYBOARD                  23200021
HEX01    EQU   X'01'                                                    23400021
HEX03    EQU   X'03'                                                    23700021
IOK      EQU   X'7F'                   I/O SUCCESSFULL CODE             23800021
LAST     EQU   X'80'                   LAST PARAMETER                   24000021
NEG      EQU   X'80'                   NEGATIVE VALUE                   24300021
NEXT     EQU   4                       NEXT SOURCE                      24600021
ONE      EQU   1                                                        24900021
PFK0     EQU   X'80'                   PFK0 BIT                         25200021
RCC4     EQU   X'08'                   RETURN CODE 4                    25500021
RC4      EQU   16                      OFFSET TO RC4                    25800021
RC5      EQU   X'04'                   I/O ERROR                        25900021
ZERO     EQU   0                       ZERO                             26100021
IFFACA03 CSECT                                                          26400021
*2101,513000                                                   PTM 3051 26450021
*2101,513000                                                            26500021
         SAVE  (14,12)                 SAVE REGISTERS                   26700021
         BALR  RBASE,0                 SET UP BASE REG                  27000021
         USING *,RBASE                 DEFINE BASE REG                  27300021
         LR    RLIST,REG1              SAVE INPUT PARAM                 27600021
         USING WORKAREA,RLIST          DEFINE DSECT                     27900021
         L     RPARAM,PARAM            LOAD ADDR USER PARAM LIST        28200021
         USING PLIST,RPARAM            DEFINE DSECT                     28500021
         ST    RSAVE,SAVE+4            MY SAVE ARE ADDR                 28800021
         LA    RSAVE,SAVE              LOAD ADDR MY SAVE AREA           29100021
         ST    RSAVE,SAVE+8            SAVE USERS R13                   29400021
         L     RWORKA,RCA              LOAD RETURN CODE ARRAY ADDR      29700021
         XC    ZERO(20,RWORKA),ZERO(RWORKA)  ZERO ARRAY                 30000021
         B     AROUND                                                   30300021
ERROR    EQU   *                                                        30600021
*   RETURN CODE MUST BE LOADED INTO REG RWORKB (15)                     30900021
*   ADD INFO MUST BE LOADED INTO REG RWORKC (R11)                       31200021
*   OFFSET MUST BE LOADED INTO REG RWORKD (R12)                         31500021
*   UPON ENTRY TO ERROR ROUTINE                                         31800021
         L     RWORKA,RCA              LOAD RETURN CODE ARRAY ADDR      32100021
         STC   RWORKB,ZERO(RWORKA)     STORE RETURN CODE                32400021
         ST    RWORKC,ZERO(RWORKD,RWORKA) STO ADD INFO AT PROPER OFFSET 32700021
OUT      L     RSAVE,SAVE+4            RE-ESTABLISH OLD SAVE AREA       33000021
         RETURN (14,12),T              RETURN TO CALLER                 33300021
AROUND   TM    ATNLVL,LAST             LAST PARAM                       33600021
         BC    14,REQ01                BRANCH IF NO                     33900021
         LA    RWORKC,ADD0             LOAD ADD INFO                    34200021
REQ03    LA    RWORKB,RCC4             LOAD RETURN CODE                 34500021
         LA    RWORKD,RC4              LOAD OFFSET                      34800021
         B     ERROR                                                    35100021
REQ01    L     RATL,ATNLVL             LOAD INDIRECT PTR TO ATTN LEVEL  35400021
         L     RATL,ZERO(RATL)         LOAD ATTN LEVEL ADDR             35700021
         USING ATTNLEVL,RATL           DEFINE DSECT                     36000021
         CLI   ATTNLVID+1,AID          IS THIS VALID ATTN LEVEL         36300021
         BNE   REQ40                   BRANCH IF NO ADD INFO EQUAL1     36600021
*   TEST FOR ANY ATTNSOURCES SPECIFIED                                  36900021
         L     RWORKC,ATNSRCE          LOAD ADDR OF DATA                37200021
         LA    RWORKC,ZERO(RWORKC)     ZERO HI ORDER BIT                37500021
         LTR   RWORKC,RWORKC           IS THERE AN ADDR THERE           37800021
         BZ    INFOADD0                NO                               38100021
         BAL   RWORKA,CONVERTA         BRANCH TO ATTNSOURCE CONVERSION  38400021
         LTR   RWORKB,RWORKB           RC=0                             38700021
         BZ    GOOD                    YES                              39000021
         LR    RWORKC,RWORKB           LOAD ADD INFO                    39300021
         B     REQ03                                                    39600021
REQ40    EQU   *                                                        39900021
         LA    RWORKC,ADD1             LOAD ADD INFO CODE OF 1          40200021
         B     REQ03                                                    40500021
INFOADD0 EQU   *                                                        40800021
*   NO ATTN SOURCE PARAMETER SPECIFIED                                  41100021
         LA    RWORKC,ADD5             LOAD ADD INFO CODE OF 2          41400021
         B     REQ03                                                    41700021
GOOD     EQU   *                                                        42000021
*   SAVE PF MASK FOR LATER TEST                                         42300021
         ST    REG1,PFMASK             SAVE PF MASK                     42600021
*   SUBTRACT A/N AND P/F MASK FROM PERM ATLV MASKS                      42900021
         X     REG0,MASK              *FLIP AN MASK                     43200021
         X     REG1,MASK              *FLIP PF MASK                     43500021
         ST    REG0,AN1               *                                 43800021
         ST    REG1,PF1               *                                 44100021
         NC    ATTNPFEN(4),PF1        *                                 44400021
         NC    ATTNANEN(4),AN1        *                                 44700021
         NC    ATTNPFDE(4),PF1        *                                 45000021
         NC    ATTNANDE(4),AN1        *                                 45300021
         CLC   ATTNFWPT,ZERO1         *IS LEVEL ACTIVE                  45600021
         BNE   RETCODE0               *                                 45900021
*   PUT NEW ATLV PERM MASKS IN GACB2 AND GACB3                          46200021
         ST    RATL,SAVE1              SAVE ATTN LVL ADDR               46500021
AGAIN    CLI   ATTNBPID,HEX01          ATBL BP POINT TO GTMCB           46800021
         BE    LBPTR                   YES                              47100021
         L     RATL,ATTNBKPT           LOAD BACKWARD PTR INTO BASE REG  47400021
         B     AGAIN                                                    47700021
LBPTR    L     RGTMCB,ATTNBKPT         LOAD BASE                        48000021
         USING GTMCB,RGTMCB            DEFINE DESECT                    48300021
         L     RATL,SAVE1              RESTORE ATTN LVL ADDR            48600021
*   REPLACE AN AND PF MASKS IN ATTN LVL OF GACB 3 AND2                  48900021
         L     RWORKA,GTMGACBA         LOAD GACB ADR                    49200021
         LA    RWORKA,GACBPLUS(RWORKA) LOAD PTR TO TRUE START OF GACB   49500021
         MVC   8(4,RWORKA),ATTNPFEN   *                                 49800021
         MVC   12(4,RWORKA),ATTNANEN  *NEW ANMASK INTO ML GACB PLUS 12  50100021
         L     RWORKA,GTMGACBA        *LOAD GACB ADDR                   50400021
         L     RWORKA,ZERO(RWORKA)    *SET PTR TO START OF DE GACB %2<  50700021
         LA    RWORKA,GACBPLUS(RWORKA) LOAD PTR TO TRUE START OF GACB*  51000021
         MVC   8(4,RWORKA),ATTNPFDE    NEW PFK MASK INTO DE    PTM 3051 51200021
*                                       GACB + 8               PTM 3051 51400021
         MVC   12(4,RWORKA),ATTNANDE  *NEW ANMASK INTO DE GACB PLUS 12  51600021
         TM    GTMFEATS+1,HASPFK       DOES DEVICE HAVE A PF KEYBOARD   51700021
         BC    14,OUT                  BRANCH-NO                        51800021
         L     RWORKB,PFMASK          *LOAD PF MASK                     51900021
         LTR   RWORKB,RWORKB          *ANY PF KEYS DISABLED             52200021
         BZ    RETCODE0               *NO                               52500021
         CLI   ATTNLITE,HEX03                                           52800021
         BE    TURNON                                                   53100021
*   SET PF LITES ON AS PER ENABLED KEYS                                 53400021
         CLI   ATTNLITE,HEX01          SYS DEFAULT OPTION IN GTMCB      53700021
         BNE   RETCODE0                                                 54000021
         CLI   GTMLIGHT,HEX03          LIGHT ENABLED KEYS               54300021
         BNE   RETCODE0                NO                               54600021
*   TURN PF LIGHTS ON                                                   54900021
TURNON   EQU   *                                                        55200021
         XC    DECB(36),DECB           CLEAR I/O AREA                   55500021
         L     RWORKD,GTMGRDCB         LOAD DCB ADDR                    55800021
         LA    RWORKC,DATA             LOAD DATA ADDR                   56100021
         LA    REG1,DECB               LOAD PARM LIST ADDR              56400021
         MVC   DATA(4),ATTNPFEN        PUT KEY MASK INTO DATA (LIGHTS)  56700021
         GCNTRL (1),IND,(7),(11),MF=E  TURN LIGHTS ON                   57000021
         WAIT  ECB=(1)                                                  57300021
         CLI   DECB,IOK                I/O SUCCESSFULL                  57350021
         BE    OUT                     BRANCH-I/O OK                    57400021
         L     REG1,RCA                LOAD RTN CODE ARRAY ADR          57450021
         OI    ZERO(REG1),RC5          INDICATE I/O ERROR               57500021
         B     OUT                     RETURN TO CALLER                 57550021
RETCODE0 EQU   *                                                        57900021
         B     OUT                     RETURN TO CALLER                 58000021
         LA    RWORKC,ADD0             LOAD ADD INFO                    58200021
         LA    RWORKB,ADD0             LOAD RETURN CODE                 58500021
         LA    RWORKD,RC4              LOAD OFFSET                      58800021
         B     ERROR                                                    59100021
         EJECT                                                          59400021
CONVERTA SAVE  (2,12)                  SAVE REGS                        59700021
         LA    RSOURCE,ATNSRCE         LOAD ADR OF 1ST ARG              60000021
         LA    RFIRST,NEXT             INDICATE 1ST ARG                 60300021
         SR    RPFA,RPFA               CLEAR PF REG                     60600021
         SR    RANA,RANA               CLEAR A/N REG                    60900021
         LA    RINFO,ADD5              LOAD 1ST ADD INFO CODE           61200021
         B     REQ18                   BRANCH                           61500021
REQOK    SR    RWORKB,RWORKB           ZERO RETURN CODE                 61800021
         LR    REG0,RANA               LOAD A/N MASK                    62100021
         LR    REG1,RPFA               LOAD P/F MASK                    62400021
         B     REQ19                   BRANCH                           62700021
REQERR   LR    RWORKB,RINFO            LOAD RETURN CODE                 63000021
REQ19    RETURN (2,12)                 RETURN                           63300021
REQ18    L     RC,ZERO(RSOURCE)        LOAD ADR OF ARG                  63600021
         TM    ZERO(RC),NEG            ARG NEGATIVE                     63900021
         BC    1,REQNEG                BRANCH IF NEG                    64200021
         L     RB,ZERO(RC)             LOAD VALUE OF ARG                64500021
REQ24    CL    RB,MAX                  VALUE GREATER THAN ALLOWABLE     64800021
         BC    2,REQERR                BRANCH IF YES                    65100021
REQ23    CL    RB,ANSIZE               VALUE GREATER THAN 31            65400021
         BC    2,REQ20                 BRANCH IF YES                    65700021
         L     RE,PRIME                PRIME REG                        66000021
         SRL   RE,ZERO(RB)             POSITION BIT                     66300021
         OR    RPFA,RE                 ADD TO PF MASK                   66600021
REQ26    TM    ZERO(RC),NEG            ARG NEG                          66900021
         BC    1,REQ21                 BRANCH IF YES                    67200021
REQ22    TM    ZERO(RSOURCE),LAST      MORE ARGS                        67500021
         BC    1,REQOK                 BRANCH IF NO                     67800021
         L     RA,ZERO(RC)             SAVE VALUE PRESENT ARG           68100021
         LA    RSOURCE,NEXT(RSOURCE)   STEP TO NEXT ARG                 68400021
         SR    RFIRST,RFIRST           INDICATE NOT 1ST ARG             68700021
         LA    RINFO,ONE(RINFO)        INCREMENT ADD INFO               69000021
         B     REQ18                   BRANCH TO MORE ARGS              69300021
REQ21    LA    RE,ONE                  LOAD CONSTANT                    69600021
         SR    RB,RE                   DECREMENT ARG BY 1               69900021
         CLR   RA,RB                   VALUE=PREVIOUS VALUE             70200021
         BE    REQ22                   BRANCH IF YES                    70500021
         B     REQ23                   BRANCH                           70800021
REQNEG   LTR   RFIRST,RFIRST           FIRST ARG                        71100021
         BC    7,REQERR                BRANCH IF YES                    71400021
         LTR   RA,RA                   PREV ARG NEG                     71700021
         BC    4,REQERR                BRANCH IF YES                    72000021
         L     RB,ZERO(RC)             LOAD VALUE OF ARG                72300021
         LPR   RB,RB                   MAKE ARG POS                     72600021
         CLR   RB,RA                   VALUE GREATER THAN PREV ARG      72900021
         BC    2,REQ24                 BRANCH IF YES                    73200021
         B     REQERR                  BRANCH                           73500021
REQ20    LA    RD,END                  LOAD ADR OF CONSTANT             73800021
         LA    RE,ONE                  LOAD CONSTANT                    74100021
REQ27    CL    RB,ZERO(RD)             COMPARE                          74400021
         BE    REQ25                   BRANCH IF YES                    74700021
         SLL   RE,ONE                  SHIFT BIT                        75000021
         LA    RD,NEXT(RD)             LOAD NEXT CONSTANT ADR           75300021
         B     REQ27                   BRANCH                           75600021
REQ25    OR    RANA,RE                 ADD BIT TO MASK                  75900021
         B     REQ26                   BRANCH                           76200021
         SPACE 3                                                        76500021
*   CONSTANTS                                                           76800021
*   END,LP,EOS,CANCEL,MAX,ANSIZE FIELDS MUST BE IN SEQUENCE             77100021
END      DC    A(32)                                                    77400021
LP       DC    A(34)                                                    77700021
EOS      DC    A(35)                                                    78000021
CANCEL   DC    A(33)                                                    78300021
MAX      DC    A(36)                                                    78600021
ANSIZE   DC    A(31)                                                    78900021
PRIME    DC    X'80000000'             PF PRIME VALUE                   79200021
ZERO1    DC    1F'0'                                                    79500021
MASK     DC    X'FFFFFFFF'            *                                 79800021
         EJECT                                                          80100021
WORKAREA DSECT                                                          80400021
PARAM    DS    1F                                                       80700021
RCA      DS    1F                                                       81000021
ANMASK   DS    1F                      SAVE AREA FOR ANMASK             81300021
PFMASK   DS    1F                      SAVE AREA FOR PFMASK             81600021
SAVE     DS    18F                                                      81900021
DECB     DS    8F                      I/O DECB                         82200021
SAVE1    DS    1F                                                       82500021
DATA     DS    1F                      DATA AREA FOR IO                 82800021
AN1      DS    1F                     *                                 83100021
PF1      DS    1F                     *                                 83400021
         SPACE 3                                                        83700021
PLIST    DSECT                                                          84000021
ATNLVL   DS    1F                                                       84300021
ATNSRCE  DS    1F                                                       84600021
ATNFLAG  DS    BL1                     ATTNDATA SWITCH                  84900021
         EJECT                                                          85200021
         COPY  ATTNLEVL                                                 85500021
         COPY  GTMCB                                                    85800021
         COPY  GDSCB                                                    86100021
         COPY  GSPCB                                                    86400021
         END                                                            86700021
./  ADD  SSI=20480122,NAME=IFFACA04
* TITLE:MPATL-MODIFY POSITION OF AN ATTENTION LEVEL                     00200021
* STATUS:CHANGE LEVEL 0                                                 00400021
* FUNCTION:TO CHANGE THE RELATIVE POSITION OF A SPECIFIED  ATTENTION    00600021
*          LEVEL WITHIN THE HIERARCHY OF ALL ATTENTION LEVELS           00800021
*          CURRENTLY ASSOCIATED WITH ITS GTMCB.                         01000021
* ENTRY:ENTERED AT IFFACA04 VIA A CALL TO MPATL.                        01200021
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD    01400021
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 01600021
*       1.ATTNLEVEL-ADDRESS OF A VARIABLE WHICH CONTAINS THE ADDRESS    01800021
*         OF AN ATTENTION LEVEL.                                        02000021
*       2.DIRECTION-ADDRESS OF A VALUE INDICATING:                      02200021
*         A POSITIVE VALUE-DEFINES THE NUMBER OF LEVELS THAT THE SPEC-  02400021
*         IFIED ATTENTION LEVEL IS TO BE MOVED UP THE ATTENTION LEVEL   02600021
*         HIERARCHY FROM ITS PRESENT LOCATION OR, IF THE 'RELATTNLEVEL' 02800021
*         ARGUMENT IS SPECIFIED,THE NUMBR OF LEVELS THAT THE SPECIFIED  03000021
*         ATTENTION LEVEL IS TO BE PLACED ABOVE THE RELATIVE ATTENTION  03200021
*         LEVEL.                                                        03400021
*         A NEGATIVE VALUE-SAME AS POSITIVE EXCEPT THE SPECIFIED        03600021
*         ATTENTION LEVEL MOVES DOWN THE HIERARCHY.                     03800021
*       3.RELATTNLEVEL-ADDRESS OF A VARIABLE WHICH CONTAINS THE ADDRESS 04000021
*         OF THE RELATIVE ATTENTION LEVEL.                              04200021
* OUTPUT:RESTRUCTURE WITHIN THE ATTENTION LEVEL HIERARCHY.              04400021
* EXIT:RETURN TO CALLING PROGRAM VIA REGISTER 14.                       04600021
* RETURN CODES:4,0 INSUFFICIENT PARAMETERS                              04800021
*              4,1 INVALID ATTNLEVEL PARAMETER                          05000021
*              4,2 INVALID DIRECTION PARAMETER                          05200021
*              4,3 INVALID RELATTNLEVEL PARAMETER                       05400021
*              0,0 SUCCESSFULL                                          05600021
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE                            05800021
* EXTERNAL ROUTINES:ATTNINQ                                             06000021
*                   GIOCR                                               06200021
* NOTES:THIS ROUTINE EXAMINES THE FOLLOWING CONTROL BLOCKS:             06400021
*       1.GTMCB                                                         06600021
*       2.GSPCB                                                         06800021
*       3.MAIN LINE GACB                                                07000021
*       4.DIRECT ENTRY GACB                                             07200021
* EXAMPLES:THE FOLLOWING EXAMPLES ARE SHOWN TO AVOID ANY POSSIBLE       07400021
*          MISUNDERSTANDING OF HOW THE INPUT PARAMETERS ARE SPECIFIED.  07600021
*                                                                       07800021
* ******   *****   *****   *****   *****   *****   *******              08000021
* *    *   * 0 *   * A *   * B *   * C *   * D *   *  E  * FORWARD PTR  08200021
* ******   *****   *****   *****   *****   *****   *******              08400021
* * A  *   * B *   * C *   * D *   * E *   * F *   *GTMCB* BACKWARD PTR 08600021
* ******   *****   *****   *****   *****   *****   *******              08800021
* *    *  * LVLA *  LVLB *  LVLC *  LVLD *  LVLE *  LVLF   *            09000021
* ****** ***    ***     ***     ***     ***     ***       ***           09200021
*  GTMCB  *      *       *       *       *       *         *            09400021
*        POS1   POS2    POS3    POS4    POS5    POS6      POS7          09600021
*                                                                       09800021
*                             *** EXAMPLE A ***                         10000021
*  THE FOLLOWING METHODS MAY BE USED TO MOVE   LVLF TO POS2.            10200021
*   1.ATTNLEVEL=LVLF  DIRECTION=+1  RELATTNLEVEL=LVLA                   10400021
*   2.ATTNLEVEL=LVLF  DIRECTION=-4                                      10600021
*   3.ATTNLEVEL=LVLF  DIRECTION=-1  RELATTNLEVEL=LVLB                   10800021
*                             *** EXAMPLE B ***                         11000021
*  THE FOLLOWING METHODS MAY BE USED TO MOVE   LVLA TO POS6.            11200021
*   1.ATTNLEVEL=LVLA  DIRECTION=-1  RELATTNLEVEL=LVLF                   11400021
*   2.ATTNLEVEL=LVLA  DIRECTION=+4                                      11600021
*   3.ATTNLEVEL=LVLA  DIRECTION=+1  RELATTNLEVEL=LVLE                   11800021
*                             *** EXAMPLE C ***                         12000021
*  THE FOLLOWING METHODS MAY BE USED TO MOVE   LVLB TO POS7.            12200021
*   1.ATTNLEVEL=LVLB  DIRECTION=+1  RELATTNLEVEL=LVLF                   12400021
*   2.ATTNLEVEL=LVLB  DIRECTION=+4                                      12600021
*                             *** EXAMPLE D ***                         12800021
* THE FOLLOWING METHODS MAY BE USED TO MOVE   LVLE TO POS3.             13000021
*   1.ATTNLEVEL=LVLE  DIRECTION=-1  RELATTNLEVEL=LVLC                   13200021
*   2.ATTNLEVEL=LVLE  DIRECTION=-2                                      13400021
*   3.ATTNLEVEL=LVLE  DIRECTION=+1  RELATTNLEVEL=LVLB                   13600021
*   THE ABOVE EXAMPLES DID NOT SHOW ALL OF THE POSSIBLE COMBINATIONS.   13800021
*   THEY ARE INTENDED ONLY AS BASIC EXAMPLES TO SHOW HOW THE INPUT      14000021
*   PARAMETERS ARE SPECIFIED AND HOW A VALUE FOR DIRECTION IS DETERMIN- 14200021
*   ED BY THE USER.                                                     14400021
R0       EQU   0                       PARM REG 0                       14600021
R1       EQU   1                       PARM REG 1                       14800021
RLIST    EQU   2                       WORK AREA REG                    15000021
RPARM    EQU   3                       PARAM LIST REG                   15200021
RATNLV   EQU   4                       ATTN LEVEL REG                   15400021
RREL     EQU   5                       REL ATTN LEVEL REG               15600021
RDIRECT  EQU   6                       DIRECTION REG                    15800021
RGTMCB   EQU   7                       GTMCB ADR                        16000021
RLVL     EQU   8                       INSERTION ATNLEVEL ADR           16200021
RBASE    EQU   9                       BASE REG                         16400021
RA       EQU   10                      WORK REG                         16600021
RB       EQU   11                      WORK REG                         16800021
SPARE    EQU   12                      RSVD PL/1                        17000021
RSAVE    EQU   13                      SAVE AREA PTR                    17200021
RC       EQU   14                      WORK REG                         17400021
RD       EQU   15                      WORK REG                         17600021
ADD1     EQU   1                       ADD INFO 1                       17800021
ADD2     EQU   2                       ADD INFO 2                       18000021
ADD3     EQU   3                       ADD INFO 3                       18200021
AID      EQU   X'04'                   ATTN LEVEL ID                    18400021
AN       EQU   12                      OFFSET TO AN MASK IN GACB        18600021
BKPT     EQU   4                       BACKWARD PTR                     18800021
BPID     EQU   X'01'                   BACK PTR TO                      19000021
BPT      EQU   X'1E'                   OFFSET TO BPID                   19200021
DATA     EQU   8                       START OF DATE IN ENTRY BLOCK     19400021
FWPT     EQU   0                       FORWARD PTR                      19600021
GACBOFF  EQU   8                       OFFSET TO START OF GACB          19800021
HASPFK   EQU   X'10'                   HAS PF KEYBOARD                  19860021
IOK      EQU   X'7F'                   I/O SUCCESSFULL CODE             19920021
LAST     EQU   X'80'                   LAST PARAM                       20000021
LIT1     EQU   X'01'                   OPTION 1                         20200021
LIT2     EQU   X'02'                   OPTION 2                         20400021
LIT3     EQU   X'03'                   OPTION 3                         20600021
LP       EQU   X'08'                   LP RESTART OPTION                20800021
OFFSAVE  EQU   8                       SAVE AREA CHAIN                  21000021
ONE      EQU   1                       ONE                              21200021
PF       EQU   8                       OFFSET TO PFMASK IN GACB         21400021
RCC4     EQU   16                      OFFSET TO ADD INFO               21600021
RC4      EQU   X'08'                   RTN CODE 4                       21800021
RC5      EQU   X'04'                   I/O ERROR                        21900021
ZERO     EQU   0                       ZERO                             22000021
IFFACA04 CSECT                                                          22200021
*2238,442000-476000                                                000A 22300021
         SAVE  (14,12)                 SAVE REGISTERS                   22400021
         BALR  RBASE,0                 SET UP BASE REG                  22600021
         USING *,RBASE                 DEFINE BASE REG                  22800021
         LR    RLIST,R1                LOAD DSECT REG                   23000021
         USING WORKAREA,RLIST          DEFINE DSECT                     23200021
         L     RPARM,PLIST             LOAD ADR USER PARM LIST          23400021
         USING PARAM,RPARM             DEFINE DSECT                     23600021
         L     RA,RCA                  LOAD ADR RTN CODE ARRAY          23800021
         XC    ZERO(20,RA),ZERO(RA)    INITIALIZE ARRAY                 24000021
         SR    RREL,RREL               INITIALIZE REG                   24200021
         ST    RSAVE,SAVE+4            SAVE-SAVE AREA PTR               24400021
         LA    RD,SAVE                 LOAD ADR OF MY SAVE AREA         24600021
         ST    RD,OFFSAVE(RSAVE)       STORE IN USER SAVE AREA          24800021
         LA    RSAVE,SAVE              * SAVE AREAS                     25000021
         B     AROUND                  BRANCH                           25200021
ERROR    L     RA,RCA                  LOAD RTN CODE ARRAY ADR          25400021
         STC   RB,ZERO(RA)             STORE RTN CODE                   25600021
         ST    RC,ZERO(RA,RD)          STORE ADD INFO                   25800021
OUTRTN   L     RSAVE,SAVE+4            RESTORE OLD SAVE AREA PTR        26000021
         RETURN (14,12),T              RETURN TO CALLER                 26200021
AROUND   TM    ATNLV,LAST              LAST PARAM                       26400021
         BC    14,MP01                 BRANCH IF NO                     26600021
MP02     SR    RC,RC                   ADD INFO=0                       26800021
MP03     LA    RB,RC4                  LOAD RTN CODE                    27000021
         LA    RD,RCC4                 LOAD ADD INFO OFFSET             27200021
         B     ERROR                   BRANCH                           27400021
MP01     L     RATNLV,ATNLV            LOAD INDIRECT PTR TO ATTN LEVEL  27600021
         L     RATNLV,ZERO(RATNLV)     LOAD ATN LEVEL ADR               27800021
         USING ATTNLEVL,RATNLV         DEFINE DSECT                     28000021
         CLI   ATTNLVID+1,AID          VALID ATTN LEVEL                 28200021
         BE    MP04                    BRANCH IF YES                    28400021
         LA    RC,ADD1                 LOAD ADD INFO                    28600021
         B     MP03                    BRANCH                           28800021
MP04     LR    RA,RATNLV               SAVE REG                         29000021
MP06     CLI   ATTNBPID,BPID           ATN LEVEL POINT TO GTMCB         29200021
         BE    MP05                    BRANCH IF YES                    29400021
         L     RATNLV,ATTNBKPT         LOAD PTR TO NEXT HIGHER LEVEL    29600021
         B     MP06                    BRANCH                           29800021
MP05     L     RGTMCB,ATTNBKPT         LOAD GTMCB ADR                   30000021
         USING GTMCB,RGTMCB            DEFINE DSECT                     30200021
         LR    RATNLV,RA               RESTORE REG                      30400021
         L     RA,GTMGSPCB             LOAD GSPCB ADR                   30600021
         USING GSPCB,RA                DEFINE DSECT                     30800021
         L     RB,DIRECTON             LOAD ADR OF DIRECTION PARAM      31000021
         LA    RB,ZERO(RB)             ZERO HI ORDER BYTE               31200021
         CL    RB,GSPNULLV             DIRECTION=NULL                   31400021
         BE    MP02                    BRANCH IF DIRECTION=NULL         31600021
         L     RDIRECT,ZERO(RB)        LOAD VALUE OF DIRECTION          31800021
         LTR   RDIRECT,RDIRECT         IS DIRECTION VALUE = 0           31860021
         BZ    OUTRTN                  YES, EXIT IMMEDIATELY            31920021
MP07     TM    DIRECTON,LAST           LAST PARAM                       32000021
         BO    MP08                    BRANCH-LAST PARAM                32200021
         L     RB,RELATNLV             LOAD INDIRECT PTR TO REL ATTN    32400021
*                                      LEVEL                            32600021
         LA    RB,ZERO(RB)             ZERO HI ORDER BYTE               32800021
         CL    RB,GSPNULLV             REL ATTN LEVEL=NULL              33000021
         BE    MP08                    BRANCH IF YES                    33200021
         L     RREL,ZERO(RB)           LOAD ADR REL ATN LEVEL           33400021
         USING ATNLEVL,RREL            DEFINE DSECT                     33600021
MP09     CLI   ATNLVID+1,AID           VALID ATTN LEVEL                 33800021
         BE    MP10                    BRANCH IF YES                    34000021
         LA    RC,ADD3                 LOAD ADD INFO                    34200021
         B     MP03                    BRANCH                           34400021
MP10     LR    RB,RREL                 SAVE ADR                         34600021
         SR    RA,RA                   ZERO COUNT REG                   34800021
MP11     CLI   ATNBPID,BPID            REL ATTN LEVEL POINT TO GTMCB    35000021
         BE    MP12                    BRANCH IF YES                    35200021
         L     RREL,ATNBKPT            LOAD BACK PTR                    35400021
         CLR   RREL,RATNLV             BACK PTR=SPEC ATTN LEVEL ADR     35600021
         BE    MP13                    BRANCH IF YES                    35800021
         LA    RA,ONE(RA)              INCREMENT COUNT BY ONE           36000021
         B     MP11                    BRANCH                           36200021
MP12     SR    RA,RA                   ZERO COUNT REG                   36400021
         LR    RREL,RB                 RESTORE REL ATN LEVEL ADR REG    36600021
MP14     CLC   ATNFWPT(4),ZERO1        FORWARD PTR=0                    36800021
         BE    MP02                    BRANCH IF YES                    37000021
         L     RREL,ATNFWPT            LOAD FORWARD PTR                 37200021
         CLR   RREL,RATNLV             FORWARD PTR = ADR OF SPEC'D      37400021
         BE    MP15                    BRANCH IF YES                    37600021
         LA    RA,ONE(RA)              INCREMENT COUNT                  37800021
         B     MP14                    BRANCH                           38000021
MP13     LA    RA,1(RA)                BIAS COUNT BY ONE                38100021
         LNR   RA,RA                   MAKE COUNT NEGATIVE              38200021
MP15     LR    RREL,RB                 RESTORE REL ATN LEVEL REG        38400021
         LA    RB,ONE                                                   38470021
         LTR   RA,RA                   CHECK DIRECTION TO RELATIVE      38540021
*                                      BLOCK                            38610021
         BM    MP15A                                                    38680021
         LTR   RDIRECT,RDIRECT         LESS THAN ZERO, CHECK DIRECTION  38750021
         BP    MP16                    IF POSITIVE, DIRECTION OK        38780021
         AR    RDIRECT,RB              INCREMENT DIRECTION BY ONE       38820021
         B     MP16                    GET FINAL DIRECTION              38890021
MP15A    AR    RA,RB                   REMOVE BIAS                      38960021
         LTR   RDIRECT,RDIRECT         IS DIRECTION POSITIVE            39030021
         BM    MP16                    LESS THAN 0, GET FINAL COUNT     39100021
         SR    RDIRECT,RB              DECREMENT DIRECTION BY ONE       39200021
MP16     AR    RDIRECT,RA              ADD COUNT TO DIRECTION           39400021
         LTR   RDIRECT,RDIRECT         DIRECTION = ZERO                 39460021
         BZ    OUTRTN                  YES, EXIT IMMEDIATELY            39520021
MP08     SR    RA,RA                   CLEAR COUNT REG                  39600021
         LR    RB,RATNLV               SAVE REG CONTENTS                39800021
         LTR   RDIRECT,RDIRECT         DIRECTION NEGATIVE               40000021
         BC    4,MP17                  BRANCH-NEGATIVE                  40200021
MP19     CLI   ATTNBPID,BPID           ATN LEVEL POINT TO GTMCB         40400021
         BE    MP18                    BRANCH IF YES                    40600021
         L     RATNLV,ATTNBKPT         LOAD PTR TO NEXT HIGHER LEVEL    40800021
         LA    RA,ONE(RA)              INCREMENT COUNT BY ONE           41000021
         B     MP19                    BRANCH                           41200021
MP18     CLR   RDIRECT,RA              COUNT = OR GT DIRECTION          41400021
         BC    12,MP20                 BRANCH IF YES                    41600021
MP22     LA    RC,ADD2                 LOAD ADD INFO                    41800021
         B     MP03                    BRANCH                           42000021
MP17     L     RATNLV,ATTNFWPT         LOAD FORWARD PTR                 42200021
         LTR   RATNLV,RATNLV           FORWARD PTR=0                    42400021
         BZ    MP21                    BRANCH ON ZERO                   42600021
         LA    RA,ONE(RA)              INCREMENT COUNT                  42800021
         B     MP17                    BRANCH                           43000021
MP21     LNR   RA,RA                   MAKE COUNT NEGATIVE              43200021
         CR    RDIRECT,RA              COUNT = OR LT DIRECTION          43400021
         BL    MP22                    NO, ERROR EXIT                   43600021
MP20     L     RATNLV,GTMLATBL         LOAD ADR OF ACTIVE LEVEL         44000021
MP23     EQU   *                                                   000A 44400021
         ST    RPARM,ATTSAVE                                       000A 44800021
         L     RPARM,GTMGACBA          GACB ADDRESS                000A 45200021
         LA    RPARM,PF(RPARM)          TRUE GACB ADDR             000A 45600021
         L     RA,ZERO(RPARM)           COMMAREA ADDR              000A 46000021
         XC    LFORM(64),LFORM          ZERO LIST                  000A 46400021
         ATTNINQ (3),MODE=(C,MP24),TYP=ANY,MF=(E,LFORM)            000A 46800021
         L     RPARM,ATTSAVE                                       000A 47200021
         B     MP25                    BRANCH                           47800021
MP24     CLC   ATTNAVAL(4),ZERO1       ANY ENTRIES AVAILABLE            48000021
         BE    MP23                    BRANCH IF NO                     48200021
         L     RC,ATTNAVAL             LOAD ADR OF AVAILABLE ENTRY      48400021
         MVC   ATTNAVAL(4),ZERO(RC)    UPDATE CHAIN                     48600021
         MVC   DATA(4,RC),ZERO(RA)     MOVE DATA INTO ENTRY             48800021
         CLC   ATTNMLEN(4),ZERO1       DATA ON QUEUE                    49000021
         BNE   MP26                    BRANCH IF YES                    49200021
         MVC   ZERO(4,RC),ATTNMLEN     * HANG ENTRY                     49400021
         ST    RC,ATTNMLEN             * ON QUEUE                       49600021
         B     MP23                    BRANCH                           49800021
MP26     L     RD,ATTNMLEN             LOAD ADR OF 1ST ENTRY            50000021
MP28     CLC   ZERO(4,RD),ZERO1        ANY MORE ENTRIES                 50200021
         BE    MP27                    BRANCH IF NO                     50400021
         L     RD,ZERO(RD)             LOAD ADR OF NEXT ENTRY           50600021
         B     MP28                    BRANCH                           50800021
MP27     MVC   ZERO(4,RC),ZERO(RD)     * HANG ENTRY                     51000021
         ST    RC,ZERO(RD)             * ON QUEUE                       51200021
         B     MP23                    BRANCH                           51400021
MP25     LR    RATNLV,RB               RESTORE REG                      51600021
         L     RA,GTMGACBA             LOAD ADR OF ML GACB              51800021
         LA    RB,GACBOFF(RA)          LOAD START ADR OF GACB           52000021
         SAEC  RESTART=NO,MF=(E,(11))                                   52200021
         XC    PF(8,RB),PF(RB)         DISABLE ML GACB                  52400021
         L     RA,ZERO(RA)             LOAD ADR DE GACB                 52600021
         LA    RB,GACBOFF(RA)          LOAD START ADR OF GACB           52800021
         SAEC  RESTART=NO,MF=(E,(11))                                   53000021
         XC    PF(8,RB),PF(RB)         DISABLE DE GACB                  53200021
MP29     CLI   ATTNBPID,BPID           BACK PTR POINT TO GTMCB          53400021
         BE    MP30                    BRANCH IF YES                    53600021
         CLC   ATTNFWPT(4),ZERO1       FORWARD PTR=0                    53800021
         BE    MP31                    BRANCH IF YES                    54000021
         L     RA,ATTNBKPT             LOAD ADR NEXT HIGHER LEVEL       54200021
         MVC   FWPT(4,RA),ATTNFWPT     SPEC ATNLVL FP TO NEXT HIGHER    54400021
*                                      ATTN LEVEL FP                    54600021
         L     RA,ATTNFWPT             LOAD ADR NEXT LOWER LEVEL        54800021
         MVC   BKPT(4,RA),ATTNBKPT  -  SPEC ATLV BP TO NEXT LOWER       55000021
*                                      ATLV BP                          55200021
         B     MP32                    BRANCH                           55400021
MP31     L     RA,ATTNBKPT             LOAD ADR OF NEXT HIGHER LEVEL    55600021
         MVC   FWPT(4,RA),ATTNFWPT     SPEC ATLV FP TP NEXT HIGHER      55800021
*                                      ATLV FP                          56000021
         MVC   GTMLATBL(4),ATTNBKPT    SPEC ATLV BP TO GTMCB ATLV PTR   56200021
         B     MP32                                                     56400021
MP30     CLC   ATTNFWPT(4),ZERO1       SPEC ATLV FP=0                   56600021
         BE    MP33                    BRANCH IF YES                    56800021
         L     RA,ATTNFWPT             LOAD ADR NEXT LOWER LEVEL        57000021
         MVC   BKPT(4,RA),ATTNBKPT     SPEC ATLV BP TO NEXT LOWER       57200021
*                                      ATLV BP                          57400021
         OI    BPT(RA),BPID            INDICATE LOWER ATLV POINT        57600021
*                                      TO GTMCB                         57800021
         B     MP32                    BRANCH                           58000021
MP33     XC    GTMLATBL(4),GTMLATBL    ZERO GTMCB ATLV PTR              58200021
MP32     XC    ATTNBPID(1),ATTNBPID    TURN OFF BACK PTR ID             58400021
         LTR   RDIRECT,RDIRECT         DIRECTION NEGATIVE               58600021
         BC    4,MP34                  BRANCH IF NEGATIVE               58800021
MP36     L     RLVL,ATTNBKPT           LOAD BP OF SPEC LEVEL            59600021
MP38     LA    RA,ONE                  LOAD CONSTANT                    59800021
         SR    RDIRECT,RA              DECREMENT DIRECTION              60000021
         LTR   RDIRECT,RDIRECT         DIRECTION=0                      60200021
         BZ    MP37                    BRANCH IF 0                      60400021
         L     RLVL,BKPT(RLVL)         LOAD BACK PTR                    60600021
         B     MP38                    BRANCH                           60800021
MP37     EQU   *                                                        61000021
         DROP  RREL                                                     61200021
         USING ATNLEVL,RLVL                                             61400021
         MVC   ATTNBKPT(4),ATNBKPT     BP OF HIGHER ATLV TO BP OF       61600021
*                                      SPEC ATLV                        61800021
         MVC   ATTNBPID(1),ATNBPID     BPID OF HIGHER ATLV TO BPID      62000021
*                                      OF SPEC ATLV                     62200021
         ST    RLVL,ATTNFWPT           ADR OF HIGHER ATLV TO FP OF      62400021
*                                      SPEC ATLV                        62600021
         ST    RATNLV,ATNBKPT          ADR OF SPEC'D ATLV TO BP OF      62800021
*                                      HIGHER ATLV                      63000021
         CLI   ATTNBPID,BPID           SPEC ATNLV BP= X'01'             63200021
         BE    MP39                    BRANCH IF YES                    63400021
         L     RA,ATTNBKPT             LOAD ADR NEXT HIGHER LEVEL       63600021
         ST    RATNLV,FWPT(RA)         ADR OF SPEC ATNLV TO FP OF ATNLV 63800021
*                                      POINTED TO BY BP OF SPEC ATLV    64000021
         B     MP40                    BRANCH                           64200021
MP39     XC    ATNBPID(1),ATNBPID      ZERO BPID OF HIGHER LEVEL        64400021
         B     MP40                    BRANCH                           64600021
MP34     LPR   RDIRECT,RDIRECT         MAKE DIRECTION POSITIVE          64800021
         L     RLVL,ATTNFWPT           LOAD FP OF SPEC LEVEL            65000021
MP42     LA    RA,ONE                  LOAD CONSTANT                    65200021
         SR    RDIRECT,RA              DECREMENT DIRECTION              65400021
         LTR   RDIRECT,RDIRECT         DIRECT=0                         65600021
         BZ    MP41                    BRANCH=0                         65800021
         L     RLVL,FWPT(RLVL)         LOAD FORWARD PTR                 66000021
         B     MP42                    BRANCH                           66200021
MP41     MVC   ATTNFWPT(4),ATNFWPT     FP TO LOWER ATLV TO FP OF        66400021
*                                      SPEC'D ATLV                      66600021
         ST    RLVL,ATTNBKPT           ADR OF LOWER ATLV TO BP OF       66800021
*                                      SPEC ATLV                        67000021
         ST    RATNLV,ATNFWPT          ADR OF SPEC ATLV TO FP OF        67200021
*                                      LOWER ATLV                       67400021
         CLC   ATTNFWPT(4),ZERO1       FP OF SPEC ATLV=0                67600021
         BE    MP43                    BRANCH=0                         67800021
         L     RA,ATTNFWPT             LOAD FP OF SPEC                  68000021
         ST    RATNLV,BKPT(RA)         ADR OF SPEC ATLV TO BP OF ATLV   68200021
*                                      POINTED TO BY FP OF SPEC ATLV    68400021
         B     MP40                    BRANCH                           68600021
MP43     ST    RATNLV,GTMLATBL         ADR OF SPEC ATLV TO GTMCB        68800021
MP40     L     RATNLV,GTMLATBL         LOAD ADR OF ACTIVE LEVEL         69000021
         L     RA,GTMGACBA             LOAD GACB ADR                    69200021
         LA    RB,GACBOFF(RA)          LOAD START ADR ML GACB           69400021
         MVC   PF(4,RB),ATTNPFEN       ENABLE PF KEYS                   69600021
         MVC   AN(4,RB),ATTNANEN       ENABLE A/N SOURCES               69800021
         TM    ATTNFLGA,LP             RESTART WANTED ON LP             70000021
         BC    14,MP45                 BRANCH-NO                        70200021
         SAEC  RESTART=YES,MF=(E,(11))                                  70400021
MP45     L     RA,ZERO(RA)             LOAD ADR NEXT GACB               70600021
         LA    RB,GACBOFF(RA)          LOAD START ADR OF DE GACB        70800021
         MVC   PF(4,RB),ATTNPFDE       ENABLE PF KEYS                   71000021
         MVC   AN(4,RB),ATTNANDE       ENABLE A/N SOURCES               71200021
         TM    ATTNFLGA,LP             RESTART WANTED ON LP             71400021
         BC    14,MP46                 BRANCH-NO                        71600021
         SAEC  RESTART=YES,MF=(E,(11))                                  71800021
MP46     XC    DECB(36),DECB           CLEAR I/O AREA                   72000021
         TM    GTMFEATS+1,HASPFK       DOES DEVICE HAVE A PF KEYBOARD   72060021
         BC    14,OUTRTN               BRANCH-NO                        72120021
         CLI   ATTNLITE,LIT1           OPTION 1                         72200021
         BE    MP47                    BRANCH-YES                       72400021
         CLI   ATTNLITE,LIT2           OPTION 2                         72600021
         BNE   MP48                    BRANCH-NO                        72800021
MP51     LA    RA,DATA1                LOAD DATA ADR                    73000021
         B     MP49                    BRANCH                           73200021
MP48     CLI   ATTNLITE,LIT3           OPTION 3                         73400021
         BE    MP50                    BRANCH YES                       73600021
         LA    RA,ATTNPFLM             LOAD DATA ADR                    73800021
         B     MP49                    BRANCH                           74000021
MP50     LA    RA,ATTNPFEN             LOAD DATA ADR                    74200021
         B     MP49                    BRANCH                           74400021
MP47     CLI   GTMLIGHT,LIT2           OPTION 2                         74600021
         BE    MP51                    BRANCH-YES                       74800021
         CLI   GTMLIGHT,LIT3           OPTION 3                         75000021
         BE    MP50                    BRANCH-YES                       75200021
         LA    RA,GTMPFKSS             LOAD DATA ADR                    75400021
MP49     L     RB,GTMGRDCB             LOAD DCB ADR                     75600021
         LA    R1,DECB                 LOAD ADR PARAM LIST              75800021
         GCNTRL (1),IND,(11),(10),MF=E                                  76000021
         WAIT  ECB=(1)                                                  76200021
         CLI   DECB,IOK                I/O SUCCESSFULL                  76240021
         BE    OUTRTN                  BRANCH-YES                       76280021
         L     RA,RCA                  LOAD RTN CODE ARRAY ADR          76320021
         OI    ZERO(RA),RC5            INDICATE I/O ERROR               76360021
         B     OUTRTN                                                   76400021
         DS    0F                                                       76600021
ZERO1    DC    1F'0'                                                    76800021
         CNOP  0,8                                                      77000021
PARAM    DSECT                                                          77200021
ATNLV    DS    1F                                                       77400021
DIRECTON DS    1F                                                       77600021
RELATNLV DS    1F                                                       77800021
         COPY  ATTNLEVL                                                 78000021
         COPY  GSPCB                                                    78200021
         COPY  GTMCB                                                    78400021
ATNLEVL  DSECT                                                          78600021
ATNFWPT  DS    1F                                                       78800021
ATNBKPT  DS    1F                                                       79000021
ATNLVID  DS    1F                                                       79200021
ATNDERB  DS    1F                                                       79400021
ATNAVAL  DS    1F                                                       79600021
ATNDATA  DS    1F                                                       79800021
ATNMLEN  DS    1F                                                       80000021
ATNFLGA  DS    BL1                                                      80200021
ATNFLGB  DS    BL1                                                      80400021
ATNBPID  DS    BL1                                                      80600021
ATNLITE  DS    BL1                                                      80800021
ATNPFLM  DS    1F                                                       81000021
ATNPFEN  DS    1F                                                       81200021
ATNANEN  DS    1F                                                       81400021
ATNPFDE  DS    1F                                                       81600021
ATNANDE  DS    1F                                                       81800021
WORKAREA DSECT                                                          82000021
PLIST    DS    1F                                                       82200021
RCA      DS    1F                                                       82400021
SAVE     DS    18F                                                      82600021
GACB     DS    1F                                                       82800021
TYPE     DS    BL1                                                      83000021
OPT      DS    BL1                                                      83200021
TYP      DS    1H                                                       83400021
BRANCH   DS    1F                                                       83600021
DECB     DS    8F                                                       83800021
DATA1    DS    1F                                                       84000021
LFORM    DS    16F                                                 000A 84060021
ATTSAVE  DS    F                                                   000A 84120021
         END                                                            84200021
./  ADD  SSI=20480169,NAME=IFFACA05
* TITLE:MLPEO-MODIFY LIGHT PEN OR END ORDER SEQUENCE OPTIONS.           00400021
* STATUS:CHANGE LEVEL 0                                                 00800021
* FUNCTION:ALLOWS MODIFICATION TO THE OPTIONS THAT SPECIFY THE TYPE OF  01200021
*          INFORMATION THAT IS TO BE QUEUED FOR AN ATTENTION LEVEL      01600021
*          ABOUT A LIGHT PEN OR END ORDER SEQUENCE ATTENTION.ALSO       02000021
*          ALLOWS THE OPTION TO RESTART OR NOT ON LIGHT PEN OR END      02400021
*          ORDER SEQUENCE ATTENTIONS.                                   02800021
* ENTRY:ENTERED AT IFFACA05 VIA CALL TO MLPED.                          03200021
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD    03600021
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 04000021
*       1.ATTNLEVEL-ADDRESS OF A VARIABLE THAT CONTAINS THE ADDRESS OF  04400021
*         THE ATTENTION LEVEL.                                          04800021
*       2.ATTNTYP-ADDRESS OF A VALUE INDICATING:                        05200021
*         A.(1)-THIS CALL REFERS TO END ORDER SEQUENCE ATTENTIONS.      05600021
*         B.(2)-THIS CALL REFERS TO LIGHT PEN ATTENTIONS.               06000021
*       3.INFO-ADDRESS OF A VALUE INDICATING:                           06400021
*         A.(1)-NO DATA RETURN.(DEFAULT)                                06800021
*         B.(2)-RETURN XY COORDINATES                                   07200021
*         C.(3)-RETURN CHARACTER INFORMATION ON LIGHT PEN ATTENTION.    07600021
*         D.(4)-B AND C AS ABOVE.                                       08000021
*       4.RESTART-ADDRESS OF A VALUE INDICATING:                        08400021
*         A.(1)-RESTART DISPLAY.(DEFAULT)                               08800021
*         B.(2)-DO NOT RESTART DISPLAY.                                 09200021
* OUTPUT:APPROPRIATE OPTION BITS SET IN ATTENTION LEVEL AND GACB IF     09600021
*        SPECIFIED ATTENTION LEVEL IS ACTIVE.                           10000021
* EXIT:RETURN TO CALLING PROGRAM.                                       10400021
* RETURN CODES:4,0 INCORRECT NUMBER OF PARAMETERS.                      10800021
*              4,1 INVALID ATTNLEVEL.                                   11200021
*              4,2 INVALID ATTNTYP.                                     11600021
*              4,3 INVALID INFO.                                        12000021
*              4,4 INVALID RESTART.                                     12400021
*              0,0 SUCCESSFULL EXECUTION                                12800021
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE.                           13200021
* NOTES:THIS ROUTINE EXAMINES THE FOLLOWING CONTROL BLOCKS:             13600021
*       1.GSPCB                                                         14000021
*       2.GTMCB                                                         14400021
*       3.MAINLINE GACB                                                 14800021
*       4.DIRECT ENTRY GACB                                             15200021
R0       EQU   0                       PARAM REG 0                      15600021
R1       EQU   1                       PARAM REG 1                      16000021
RLIST    EQU   2                       LIST REG                         16400021
RPARAM   EQU   3                       USER PARAM LIST REG              16800021
RATL     EQU   4                       ATLV REG                         17200021
RTYP     EQU   5                       ATTNTYP REG                      17600021
RINFO    EQU   6                       INFO REG                         18000021
RSTART   EQU   7                       RESTART REG                      18400021
RE       EQU   8                       WORK REG                         18800021
RBASE    EQU   9                       BASE REG                         19200021
RD       EQU   10                      WORK REG                         19600021
RGTMCB   EQU   10                      GTMCB ADR REG                    20000021
RB       EQU   11                      WORK REG                         20400021
SPARE1   EQU   12                      RSVD PL1                         20800021
RSAVE    EQU   13                      SAVE AREA PTR REG                21200021
RC       EQU   14                      WORK REG                         21600021
RA       EQU   15                      WORK REG                         22000021
ADD1     EQU   1                       ADD INFO 1                       22400021
ADD2     EQU   2                       ADD INFO 2                       22800021
ADD3     EQU   3                       ADD INFO 3                       23200021
ADD4     EQU   4                       ADD INFO 4                       23600021
AID      EQU   X'04'                   ATNLV ID                         24000021
BPID     EQU   X'01'                   BPID                             24400021
EOSRT    EQU   X'40'                   EOS RESTART                      24800021
EOSXY    EQU   X'80'                   EOS XY                           25200021
GACBOFF  EQU   8                       START OF GACB                    25600021
LAST     EQU   X'80'                   LAST PARAM                       26000021
LPCHAR   EQU   X'10'                   LP CHAR                          26400021
LPSRT    EQU   X'08'                   LP RESTART                       26800021
LPXY     EQU   X'20'                   LP XY                            27200021
MASK     EQU   X'FF'                   ALL MASK                         27600021
RCC4     EQU   16                      RETURN CODE OFFSET               28000021
RC4      EQU   X'08'                   RETURN CODE 4                    28400021
ZERO     EQU   0                       ZERO                             28800021
IFFACA05 CSECT                                                          29200021
         SAVE  (14,12)                 SAVE REGS                        29600021
         BALR  RBASE,0                 SET UP BASE REG                  30000021
         USING *,RBASE                 DEFINE BASE REG                  30400021
         LR    RLIST,R1                SAVE REG                         30800021
         USING WORKAREA,RLIST          DEFINE DSECT                     31200021
         L     RPARAM,PLIST            LOAD ADR USER PARM LIST          31600021
         USING PARAM,RPARAM            DEFINE DSECT                     32000021
         L     RA,RCA                  LOAD RTN CODE ARRAY ADR          32400021
         XC    ZERO(20,RA),ZERO(RA)    INITIALIZE ARRAY                 32800021
         B     AROUND                  BRANCH                           33200021
ERROR    L     RA,RCA                  LOAD RCA ADR                     33600021
         STC   RB,ZERO(RA)             STORE RETURN CODE                34000021
         ST    RC,ZERO(RA,RD)          STORE ADD INFO CODE              34400021
OUTRTN   RETURN (14,12),T              RETURN                           34800021
AROUND   TM    ATNLV,LAST              ONLY PARAM                       35200021
         BO    MLP01                   BRANCH IF YES                    35600021
         L     RATL,ATNLV              LOAD INDIRECT PTR                36000021
         L     RATL,ZERO(RATL)         LOAD ATLCB ADR                   36400021
         USING ATTNLEVL,RATL           DEFINE DSECT                     36800021
         CLI   ATTNLVID+1,AID          IS THIS A VALID ATTN LEVEL       37200021
         BE    MLP02                   BRANCH IF VALID                  37600021
         LA    RC,ADD1                 LOAD ADD INFO                    38000021
MLP03    LA    RB,RC4                  LOAD RTN CODE                    38400021
         LA    RD,RCC4                 LOAD OFFSET                      38800021
         B     ERROR                   BRANCH                           39200021
MLP01    SR    RC,RC                   ADD INFO=0                       39600021
         B     MLP03                   BRANCH                           40000021
MLP02    LR    RE,RATL                 SAVE ADR                         40400021
MLP05    CLI   ATTNBPID,BPID           POINT TO GTMCB                   40800021
         BE    MLP04                   BRANCH IF YES                    41200021
         L     RATL,ATTNBKPT           LOAD ADR NEXT LEVEL              41600021
         B     MLP05                   BRANCH                           42000021
MLP04    L     RGTMCB,ATTNBKPT         LOAD GTMCB ADR                   42400021
         USING GTMCB,RGTMCB            DEFINE DSECT                     42800021
         LR    RATL,RE                 RESTORE REG                      43200021
         L     RE,GTMGSPCB             LOAD GSPCB ADR                   43600021
         USING GSPCB,RE                DEFINE DSECT                     44000021
         L     RTYP,ATNTYP             LOAD ATTN TYPE ADR               44400021
         LA    RTYP,ZERO(RTYP)         CLEAR HIGH ORDER BYTE            44800021
         CL    RTYP,GSPNULLV           ATTNTYP=NULL                     45200021
         BE    MLP01                   BRANCH IF YES                    45600021
         L     RTYP,ZERO(RTYP)         LOAD ATTNTYP VALUE               46000021
         CL    RTYP,ONE                ATTNTYP=1                        46400021
         BE    MLP06                   BRANCH IF YES                    46800021
         CL    RTYP,TWO                ATTNTYP=2                        47200021
         BE    MLP06                   BRANCH IF YES                    47600021
         LA    RC,ADD2                 LOAD ADD INFO                    48000021
         B     MLP03                   BRANCH                           48400021
MLP06    TM    ATNTYP,LAST             LAST PARAM                       48800021
         BC    14,MLP07                BRANCH-NO                        49200021
         L     RINFO,ONE               ASSUME VALUE OF ONE              49600021
MLP11    L     RSTART,ONE              ASSUME VALUE OF ONE              50000021
         B     MLP08                   BRANCH                           50400021
MLP07    L     RINFO,INFO              LOAD ADR OF INFO                 50800021
         LA    RINFO,ZERO(RINFO)       ZERO HI ORDER BYTE               51200021
         CL    RINFO,GSPNULLV          INFO=NULL                        51600021
         BNE   MLP09                   BRANCH IF NO                     52000021
         L     RINFO,ONE               ASSUME VALUE OF ONE              52400021
         B     MLP10                   BRANCH                           52800021
MLP09    L     RINFO,ZERO(RINFO)       LOAD INFO VALUE                  53200021
         CL    RINFO,ONE               INFO=1                           53600021
         BE    MLP10                   BRANCH-YES                       54000021
         CL    RINFO,TWO               INFO=2                           54400021
         BE    MLP10                   BRANCH-YES                       54800021
         CL    RINFO,THREE             INFO=3                           55200021
         BE    MLP10                   BRANCH-YES                       55600021
         CL    RINFO,FOUR              INFO=4                           56000021
         BE    MLP10                   BRANCH-YES                       56400021
         LA    RC,ADD3                 LOAD ADD INFO CODE               56800021
         B     MLP03                   BRANCH                           57200021
MLP10    TM    INFO,LAST               LAST PARAM                       57600021
         BO    MLP11                   BRANCH-LAST                      58000021
         L     RSTART,RESTART          LOAD ADR OF RESTART              58400021
         LA    RSTART,ZERO(RSTART)     ZERO HI ORDER BYTE               58800021
         CL    RSTART,GSPNULLV         EQUAL NULL                       59200021
         BE    MLP11                   BRANCH IF YES                    59600021
         L     RSTART,ZERO(RSTART)     LOAD VALUE OF RESTART            60000021
         CL    RSTART,ONE              RESTART=1                        60400021
         BE    MLP08                   BRANCH-YES                       60800021
         CL    RSTART,TWO              RESTART=2                        61200021
         BE    MLP08                   BRANCH-YES                       61600021
         LA    RC,ADD4                 LOAD ADD INFO                    62000021
         B     MLP03                   BRANCH                           62400021
MLP08    CL    RTYP,TWO                ATNTYP=2                         62800021
         BE    MLP12                   BRANCH=2                         63200021
         CL    RINFO,ONE               INFO=ONE                         63600021
         BE    MLP13                   BRANCH=1                         64000021
         OI    ATTNFLGA,EOSXY          SET EOS XY BIT                   64400021
         B     MLP14                   BRANCH                           64800021
MLP13    NI    ATTNFLGA,MASK-EOSXY     CLEAR EOS XY BIT                 65200021
MLP14    CL    RSTART,ONE              RESTART=ONE                      65600021
         BE    MLP15                   BRANCH=1                         66000021
         NI    ATTNFLGA,MASK-EOSRT     TURN OFF EOS RESTART BIT         66400021
         B     OUTRTN                  BRANCH                           66800021
MLP15    OI    ATTNFLGA,EOSRT          SET EOS RESTART BIT              67200021
         B     OUTRTN                  BRANCH                           67600021
MLP12    CL    RINFO,ONE               INFO=1                           68000021
         BNE   MLP16                   BRANCH NOT= 1                    68400021
         NI    ATTNFLGA,MASK-LPXY-LPCHAR  CLEAR LP CHAR AND XY BITS     68800021
         B     MLP17                   BRANCH                           69200021
MLP16    CL    RINFO,TWO               INFO=2                           69600021
         BE    MLP18                   BRANCH=2                         70000021
         CL    RINFO,THREE             INFO=3                           70400021
         BE    MLP19                   BRANCH=3                         70800021
         OI    ATTNFLGA,LPXY+LPCHAR    SET UP CHAR AND XY BITS          71200021
         B     MLP17                   BRANCH                           71600021
MLP18    OI    ATTNFLGA,LPXY           SET RETURN XY ON LP              72000021
         B     MLP17                   BRANCH                           72400021
MLP19    OI    ATTNFLGA,LPCHAR         SET LP CHAR BIT                  72800021
MLP17    CL    RSTART,ONE              RESTART=1                        73200021
         BE    MLP20                   BRANCH=1                         73600021
         NI    ATTNFLGA,MASK-LPSRT     CLEAR LP RESTART FLAG            74000021
         B     MLP21                   BRANCH                           74400021
MLP20    OI    ATTNFLGA,LPSRT          SET UP RESTART FLAG              74800021
MLP21    CLC   ATTNFWPT,ZERO1          LEVEL ACTIVE                     75200021
         BNE   OUTRTN                  BRANCH-NOTACTIVE                 75600021
         L     RB,GTMGACBA             LOAD PTR TO GACB                 76000021
         LA    RA,GACBOFF(RB)          LOAD GACB ADR                    76400021
         LA    RE,MLP22                LOAD RETURN ADR                  76800021
MLP25    TM    ATTNFLGA,LPSRT          RESTART DESIRED                  77200021
         BO    MLP23                   BRANCH-YES                       77600021
         B     MLP24                   BRANCH-NO                        78000021
MLP22    L     RB,ZERO(RB)             LOAD ADR NEXT GACB PTR           78400021
         LA    RA,GACBOFF(RB)          LOAD GACB ADR                    78800021
         LA    RE,OUTRTN               LOAD RETURN ADR                  79200021
         B     MLP25                   BRANCH                           79600021
MLP23    SAEC  RESTART=YES,MF=(E,(15))                                  80000021
         BR    RE                      RETURN                           80400021
MLP24    SAEC  RESTART=NO,MF=(E,(15))                                   80800021
         BR    RE                      RETURN                           81200021
         DS    0F                                                       81600021
ZERO1    DC    1F'0'                                                    82000021
ONE      DC    A(1)                                                     82400021
TWO      DC    A(2)                                                     82800021
THREE    DC    A(3)                                                     83200021
FOUR     DC    A(4)                                                     83600021
         CNOP  0,8                                                      84000021
         COPY  ATTNLEVL                                                 84400021
         COPY  GSPCB                                                    84800021
         COPY  GTMCB                                                    85200021
PARAM    DSECT                                                          85600021
ATNLV    DS    1F                                                       86000021
ATNTYP   DS    1F                                                       86400021
INFO     DS    1F                                                       86800021
RESTART  DS    1F                                                       87200021
WORKAREA DSECT                                                          87600021
PLIST    DS    1F                                                       88000021
RCA      DS    1F                                                       88400021
         END                                                            88800021
./  ADD  SSI=80900246,NAME=IFFACA06
*                                                                       00800021
*                                                                       01600021
*                             SLPAT INPUT PARAMETER LIST                02400021
*                                                                       03200021
*                             +0   A(GDSVAR)                            04000021
*                             +4   A(DETECT)                            04800021
*                                                                       05600021
*                             0= PERMIT DETECT INTERRUPTS               06400021
*                             1= DISABLE DETECT INTERRUPTS              07200021
*                                                                       08000021
*                                                                       08800021
*                                                                       09600021
*                                                                       10400021
*                                                                       11200021
*                                                                       12000021
*                                                                       12800021
*                                                                       13600021
*                                                                       14400021
*                                                                       15200021
*                                                                       16000021
*                                                                       16800021
*                                                                       17600021
*                                                                       18400021
*                                                                       19200021
         EJECT                                                          20000021
IFFACA06 CSECT                                                          20800021
*C440000,A624500-625500,D632000,A626000-639988,A720500,A760500  YA03229 20850000
         SAVE  (14,12)                                                  21600021
         BALR  BASE,0                                                   22400021
         USING *,BASE                                                   23200021
         LR    WORK,PARM                                                24000021
         L     REGA,PRMLST(WORK)   ADDR OF WORK AREA                    24800021
         L     ERRCD,ERR(WORK)     ADDR OF ERROR RETURN ARRAY           25600021
         XC    0(20,ERRCD),0(ERRCD) ZERO OUT RETURN ARRAY               26400021
*        WE NOW HAVE PICKED UP THE WORKAREA, REMOVED THE PARAMETER      27200021
*        LIST AND THE RETURN ARRAY ADDRESS, WE WILL NOW CHECK           28000021
*        PARAMETERS FOR VALIDITY AND QUANTITY.                          28800021
*        IF THE CODE IS ZERO WE WILL POINT REGB TO THE GESD ORDER. IF   29600021
*        CODE IS ONE REGB WILL POINT TO THE GDPD ORDER.                 30400021
         L     GDSREG,GDS(REGA)    ADDR OF GDS VAR                      31200021
         L     GDSREG,0(GDSREG)    ADDR OF GDSCB                        32000021
         USING GDSCB,GDSREG                                             32800021
         C     GDSREG,GDSGDSCB     GDSCB VALID                          33600021
         BNE   ERR1                NO                                   34400021
         TM    GDS(REGA),LAST      ENOUGH PARMS                         35200021
         BO    ERR1A               NO                                   36000021
         L     REGB,CODE(REGA)     PICK UP CODE                         36800021
         L     REGB,0(REGB)                                             37600021
         C     REGB,ONE            IS IT PERMIT                         38400021
         BE    SLP00300            YES                                  39200021
         C     REGB,TWO            DISABLE                              40000021
         BNE   ERR2                NO INVALID CODE                      40800021
         LA    REGB,GDPD           ADDR OF DISABLE ORDER                41600021
         NI    GDSFLAGS,DSBLE      SET FLAG IN GDSCB TO DISABLE         42400021
         TM    GDSFLAGS,EQUIV      IS THIS AN EQUIV                     43200021
         BO    SLP00301            YES SET GDSFLG IN SHARED GDS YA03229 44000000
         EJECT                                                          44800021
*        NOW THE GTMCB DSECT WILL BE INITIALIZED AND SAVE AREAS WILL    45600021
*        BE CHAINED. OLD I/O WILL BE WAITED.  THEN THE ORDER POINTED    46400021
*        TO BY REGB WILL BE WRITTEN OUT TO FLOW CONTROL SO THAT THE     47200021
*        ENTIRE GDS WILL BE IN THE PROPER PEN MODE.                     48000021
SLP00100 L     GTMREG,GDSGTMCB     GTMCB                                48800021
         USING GTMCB,GTMREG                                             49600021
         CLC   GDSFCBUF,ZERO       FLOW CONTROL INITIALIZER             50400021
         BE    SLP00200            NO DATA STORE WILL WRITE OUT         51200021
         LA    REGA,SAVEARA(WORK)  CHAIN SAVE AREAS                     52000021
         ST    REGA,8(SAVE)                                             52800021
         ST    SAVE,4(REGA)                                             53600021
         LR    SAVE,REGA                                                54400021
         L     REGA,GTMGRDCB       DCB ADDR                             55200021
         L     PARM,GTMDECB1       WAIT ON OLD I/O                      56000021
         WAIT  ECB=(1)                                                  56800021
         L     PARM,GTMDECB1       RELOAD REG1                          57600021
         CLI   0(PARM),X'7F'                                            57800021
         BNE   ERR3                                                     58000021
         NI    0(PARM),X'BF'                                            58200021
*                                  WRITE OUT ORDER TO FLOW CTL          58400021
         GWRITE (PARM),STR,(REGA),2,(REGB),GDSFCBUF,GDSFCBUF,MF=E       59200021
         LTR   REG15,REG15        I/O STARTED               E12 ZA30875 59250000
         BNZ   ERR3               NO, DON'T WAIT            E12 ZA30875 59300000
         L     PARM,GTMDECB1      RELOAD REG1               E12 ZA30875 59350000
         WAIT  ECB=(1)            WAIT FOR I/O COMPLETE     E12 ZA30875 59400000
         L     PARM,GTMDECB1      RELOAD REG1               E12 ZA30875 59450000
         CLI   0(PARM),X'7F'      COMPLETE OK?              E12 ZA30875 59500000
         BNE   ERR3               NO                        E12 ZA30875 59550000
         L     SAVE,4(SAVE)        RESET SAVE AREA                      60000021
SLP00200 RETURN (14,12)            RETURN                               60800021
SLP00300 LA    REGB,GESD           ADDR OF ENABLE SW DETECT             61600021
         OI    GDSFLAGS,PERMIT     SET FLAG IN GDSCB TO PERMIT          62400021
         TM    GDSFLAGS,EQUIV     IS THIS AN EQUIV GDS?         YA03229 62450000
         BZ    SLP00100           NO,GO WRITE OUT ORDER         YA03229 62500000
SLP00301 EQU   *                                                YA03229 62550000
* FOR EQUIVALENT GDS'S,WE WILL GO DOWN THE FORWARD AND BACKWARD YA03229 62650000
* CHAINS AND SET THE PROPER BIT(ENABLE OR DISABLE LIGHT PEN     YA03229 62700000
* DETECT) IN GDSFLAGS BECAUSE ALL GDS'S IN THE EQUIVALENCE WILL YA03229 62750000
* BE IN THE SAME DETECTABLE MODE .                              YA03229 62800000
         L     REGA,GDSSHDBK      LOAD BACK SHARED PTR          YA03229 62850000
         LR    GDSSAVE,GDSREG     SAVE ORIGINAL GDS PTR         YA03229 62900000
         L     GDSFWD,GDSSHDFD    LOAD FORWARD POINTER          YA03229 62950000
         LR    GDSREG,REGA        BASE NEXT GDS                 YA03229 63000000
SLP00302 EQU   *                                                YA03229 63050000
         LTR   GDSREG,GDSREG      END OF CHAIN?                 YA03229 63100000
         BZ    SLP00305           YES,SEARCH FWD CHAIN          YA03229 63150000
         CH    REGB,GESD          ENABLE ORDER DESIRED?         YA03229 63200000
         BE    SLP00303           YES,SET ENABLE SWITCH         YA03229 63250000
         NI    GDSFLAGS,DSBLE     SET DISABLE FLAG BIT          YA03229 63300000
         B     SLP00304           GET NEXT SHARED GDS           YA03229 63350000
SLP00303 EQU   *                                                YA03229 63400000
         OI    GDSFLAGS,PERMIT    SET ENABLE FLAG BIT           YA03229 63450000
SLP00304 EQU   *                                                YA03229 63500000
         L     GDSREG,GDSSHDBK    NEXT SHARED GDS PTR           YA03229 63550000
         B     SLP00302           LOOP TO END OF CHAIN          YA03229 63600000
SLP00305 EQU   *                                                YA03229 63650000
         LR    GDSREG,GDSFWD      FORWARD SHARED PTR            YA03229 63700000
SLP00306 EQU   *                                                YA03229 63750000
         LTR   GDSREG,GDSREG      END OF CHAIN?                 YA03229 63800000
         BNZ   SLP00307           NO,CONTINUE PROCESSING        YA03229 63850000
         LR    GDSREG,GDSSAVE     RESTORE ORIGINAL PTR          YA03229 63900000
         B     SLP00100           WRITE ORDER TO BUFFER         YA03229 63950000
SLP00307 EQU   *                                                YA03229 63960000
         CH    REGB,GESD          ENABLE ORDER DESIRED?         YA03229 63970000
         BE    SLP00308           YES,SET ENABLE FLAG BIT       YA03229 63980000
         NI    GDSFLAGS,DSBLE     SET DISABLE BIT               YA03229 63990000
         B     SLP00309           GET NEXT PTR                  YA03229 63992000
SLP00308 EQU   *                                                YA03229 63994000
         OI    GDSFLAGS,PERMIT    SET ENABLE FLAG BIT           YA03229 63996000
SLP00309 EQU   *                                                YA03229 63998000
         L     GDSREG,GDSSHDFD    GET NEXT PTR                  YA03229 63998400
         B     SLP00306           LOOP TO END OF CHAIN          YA03229 63998800
         EJECT                                                          64000021
ERR1     MVC   PARERR(4,ERRCD),ONE BAD GDSCB                            64800021
ERR1A    MVI   ERCODE(ERRCD),PARMEROR PARM ERROR                        65600021
         B     SLP00200                                                 66400021
ERR2     MVC   PARERR(4,ERRCD),TWO BAD CODE                             67200021
         B     ERR1A                                                    68000021
ERR3     OI    ERCODE(ERRCD),IO                                         68200021
         B     SLP00200                                                 68400021
         EJECT                                                          68800021
* REGISTERS                                                             69600021
PARM     EQU   1                                                        70400021
REGA     EQU   2                                                        71200021
REGB     EQU   3                                                        72000021
GDSSAVE  EQU   4                  WORK REGISTER                 YA03229 72050000
WORK     EQU   5                                                        72800021
GTMREG   EQU   7                                                        73600021
GDSREG   EQU   8                                                        74400021
BASE     EQU   9                                                        75200021
ERRCD    EQU   10                                                       76000021
GDSFWD   EQU   11                 WORK REGISTER                 YA03229 76050000
SAVE     EQU   13                                                       76800021
REG15    EQU   15                 RETURN CODE REG           E12 ZA30875 76850000
         EJECT                                                          77600021
PRMLST   EQU   0                                                        78400021
ERR      EQU   4                                                        79200021
SAVEARA  EQU   8                                                        80000021
GDS      EQU   0                                                        80800021
CODE     EQU   4                                                        81600021
LAST     EQU   X'80'                                                    82400021
PARERR   EQU   16                                                       83200021
ERCODE   EQU   0                                                        84000021
PARMEROR EQU   X'08'                                                    84800021
DSBLE    EQU   X'FE'                                                    85600021
PERMIT   EQU   X'01'                                                    86400021
EQUIV    EQU   X'80'                                                    87200021
IO       EQU   X'04'                                                    87600021
         EJECT                                                          88000021
ZERO     DC    F'0'                                                     88800021
ONE      DC    F'1'                                                     89600021
TWO      DC    F'2'                                                     90400021
         GINIT                                                          91200021
GDPD     GDPD                                                           92000021
GESD     GESD                                                           92800021
         COPY  GDSCB                                                    93600021
         COPY  GTMCB                                                    94400021
         COPY  GSPCB                                                    95200021
         END                                                            96000021
./  ADD  SSI=20480173,NAME=IFFACA07
* TITLE:MLITS-MODIFY PROGRAM FUNCTION INDICATOR LIGHTS                  00300021
* STATUS:CHANGE LEVEL 0                                                 00600021
* FUNCTION:TO DEFINE WHICH PROGRAM FUNCTION INDICATOR LIGHTS ARE TO BE  00900021
*          ON AND WHICH ARE TO BE OFF.                                  01200021
* ENTRY:ENTERED AT IFFACA07 VIA A CALL TO MLITS                         01500021
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD    01800021
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 02100021
*       1.DEVICENAME/ATTNLEVEL-ADDRESS OF A VARIABLE CONTAINING EITHER  02400021
*         THE ADDRESS OF A GTMCB OR AN ATTENTION LEVEL.                 02700021
*       2.STATUS-ADDRESS OF A VALUE WHICH INDICATES:                    03000021
*         A. 1-USE CURRENTLY APPLICABLE SYSTEM DEFAULT                  03300021
*         B. 2-TURN OFF ALL PROGRAM FUNCTION INDICATORS                 03600021
*         C. 3-LIGHT PROGRAM FUNCTION INDICATORS TO CORRESPOND TO       03900021
*              CURRENTLY ENABLED PROGRAM FUNCTION KEYS.                 04200021
*         D. 4-USE LIGHTS ARGUMENTS AS PREVIOUSLY SPECIFIED BY ANOTHER  04500021
*              CALL OR AS FOLLOWS.                                      04800021
*       3.LIGHTS-ADDRESS(ES) OF A VALUE(S) SPECIFYING WHICH PROGRAM     05100021
*         FUNCTION INDICATOR LIGHTS ARE TO BE TURNED ON IN GTMCB OR     05400021
*         ATTENTION LEVEL LIGHT MASK.                                   05700021
* OUTPUT:DESIGNATED PROGRAM FUNCTION INDICATORS ARE LIGHTED.            06000021
* EXIT:RETURN TO CALLING PROGRAM                                        06300021
* RETURN CODES: 4,0 INCORRECT NUMBER OF PARAMETERS                      06600021
*               4,1 INVALID DEVICENAME/ATTNLEVEL                        06900021
*               4,2 INVALID STATUS                                      07200021
*               4,3-N INVALID LIGHTS ARGUMENT                           07500021
*               0,0-SUCCESSFULL EXECUTION.                              07800021
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE                            08100021
* NOTES:THE FOLLOWING CONTROL BLOCKS ARE EXAMINED BY THIS ROUTINE       08400021
*       1.GTMCB                                                         08700021
*       2.GSPCB                                                         09000021
* EXTERNAL ROUTINES:GIOCR                                               09300021
R0       EQU   0                       PARM REG 0                       09600021
R1       EQU   1                       PARM REG 1                       09900021
RLIST    EQU   2                       WORK AREA REG                    10200021
RSOURCE  EQU   2                       SOURCE ADR REG                   10500021
RFIRST   EQU   3                       FIRST ARG REG                    10800021
RPARM    EQU   3                       USER PARAM LIST REG              11100021
RATL     EQU   4                       ATLV ADR REG                     11400021
RLIGHTS  EQU   4                       LIGHT MASK REG                   11700021
RGTMCB   EQU   5                       GTMCB ADR REG                    12000021
RINFO    EQU   5                       ADD INFO REG                     12300021
RGSPCB   EQU   6                       GSPCB ADR REG                    12600021
RVAL     EQU   6                       ARG VALUE REG                    12900021
RARG     EQU   7                       ARG ADR REG                      13200021
RE       EQU   8                       WORK REG                         13500021
RSHIFT   EQU   8                       SHIFT REG                        13800021
RBASE    EQU   9                       BASE REG                         14100021
RC       EQU   10                      WORK REG                         14400021
RPREV    EQU   10                      PREVIOUS ARG VALUE REG           14700021
RD       EQU   11                      WORK REG                         15000021
SPARE1   EQU   12                      RSVD FOR PL1                     15300021
RSAVE    EQU   13                      SAVE AREA REG                    15600021
RA       EQU   14                      WORK REG                         15900021
RB       EQU   15                      WORK REG                         16200021
ADD1     EQU   1                       ADD INFO 1                       16500021
ADD2     EQU   2                       ADD INFO 2                       16800021
ADD3     EQU   3                       ADD INFO 3                       17100021
AID      EQU   X'04'                   ATTN LVL ID                      17400021
BPID     EQU   X'01'                   BP ID                            17700021
GID      EQU   X'02'                   GTMCB ID                         18000021
HASPFK   EQU   X'10'                   HAS PF KEYBOARD                  18100021
IOK      EQU   X'7F'                   I/O SUCCESSFULL CODE             18200021
LAST     EQU   X'80'                   LAST PARAM                       18300021
LIT1     EQU   X'01'                   OPTION 1                         18600021
LIT2     EQU   X'02'                   OPTION 2                         18900021
LIT3     EQU   X'03'                   OPTION 3                         19200021
LIT4     EQU   X'04'                   OPTION 4                         19500021
NEG      EQU   X'80'                   NEG ARG                          19800021
NEXT     EQU   4                       NEXT ARG                         20100021
OFFSAVE  EQU   8                       SAVE AREA CHAIN                  20400021
ONEA     EQU   1                       ONE                              20700021
PFK0     EQU   X'80'                   PFK 0                            21000021
RCC4     EQU   16                      OFFSET TO RTN CODE 4             21300021
RC4      EQU   X'08'                   RTN CODE 4                       21600021
RC5      EQU   X'04'                   I/O ERROR                        21700021
ZERO     EQU   0                       ZERO                             21900021
IFFACA07 CSECT                                                          22200021
         TITLE 'MLITES - MODIFY PF LIGHTS'                              22500021
         SAVE  (14,12)                 SAVE REGS                        22800021
         BALR  RBASE,0                 SET UP BASE REG                  23100021
         USING *,RBASE                 DEFINE BASE REG                  23400021
         LR    RLIST,R1                LOAD REG                         23700021
         USING WORKAREA,RLIST          DEFINE DSECT                     24000021
         L     RPARM,PLIST             LOAD ADR USER PARAM LIST         24300021
         USING PARAM,RPARM             DEFINE DSECT                     24600021
         ST    RSAVE,SAVE+4            SAVE-SAVE AREA PTR               24900021
         LA    RD,SAVE                 LOAD ADR OF MY SAVE AREA         25200021
         ST    RD,OFFSAVE(RSAVE)       STORE IN USER SAVE AREA          25500021
         LA    RSAVE,SAVE              ESTABLISH NEW SAVE AREA          25800021
         L     RA,RCA                  LOAD RTN CODE ARRAY ADR          26100021
         XC    ZERO(20,RA),ZERO(RA)    INITIALIZE ARRAY                 26400021
         XC    DECB(36),DECB           CLEAR I/O AREA                   26700021
         B     AROUND                  BRANCH                           27000021
ERROR    L     RA,RCA                  LOAD RTN CODE ARRAY ADR          27300021
         STC   RB,ZERO(RA)             STORE RETURN CODE                27600021
         ST    RC,ZERO(RA,RD)          STORE ADD INFO                   27900021
OUTRTN   L     RSAVE,SAVE+4            RESTORE OLD SAVE AREA PTR        28200021
         RETURN (14,12),T              RETURN TO CALLING PROGRAM        28500021
AROUND   TM    DVCENAME,LAST           LAST PARAM                       28800021
         BC    14,ML01                 BRANCH IF NOT LAST PARAM         29100021
ML11     SR    RC,RC                   ADD INFO=0                       29400021
ML02     LA    RB,RC4                  LOAD RTN CODE                    29700021
         LA    RD,RCC4                 LOAD OFFSET                      30000021
         B     ERROR                                                    30300021
ML01     L     RATL,ATNLV              LOAD PTR                         30600021
         L     RATL,ZERO(RATL)         LOAD CONTROL BLOCK ADR           30900021
         USING ATTNLEVL,RATL           DEFINE DSECT                     31200021
         CLI   ATTNLVID+1,AID          IS THIS AN ATLCB                 31500021
         BNE   ML03                    BRANCH IF NO                     31800021
         ST    RATL,LEVEL              SAVE ADR                         32100021
         XC    DEVICE(4),DEVICE        CLEAR DEVICE ADR                 32400021
         LR    RA,RATL                 SAVE REG                         32700021
ML32     CLI   ATTNBPID,BPID           ATTN LEVEL POINT TO A GTMCB      33000021
         BE    ML31                    BRANCH IF YES                    33300021
         L     RATL,ATTNBKPT           LOAD PTR NEXT HIGHER ATTN LEVEL  33600021
         B     ML32                    BRANCH                           33900021
ML31     L     RGTMCB,ATTNBKPT         LOAD GTMCB ADR                   34200021
         LR    RATL,RA                 RESTORE REG                      34500021
         B     ML04                    BRANCH                           34800021
ML03     CLI   ATTNLVID+1,GID          IS THIS A GTMCB                  35100021
         BE    ML05                    BRANCH IF YES                    35400021
ML06     LA    RC,ADD1                 LOAD ADD INFO                    35700021
         B     ML02                    BRANCH                           36000021
ML05     LR    RGTMCB,RATL             LOAD REG                         36300021
         USING GTMCB,RGTMCB            DEFINE DSECT                     36600021
         CL    RGTMCB,GTMGTMCB         HAS THIS GTMCB BEEN INITIALIZE   36900021
         BNE   ML06                    BRANCH IF NO                     37200021
         ST    RGTMCB,DEVICE           SAVE ADR                         37500021
         XC    LEVEL(4),LEVEL          CLEAR LEVEL ADR                  37800021
ML04     L     RE,STATUS               LOAD PTR TO STATUS               38100021
         LA    RE,ZERO(RE)             CLEAR HIGH ORDER BYTE            38400021
         L     RGSPCB,GTMGSPCB         LOAD GSPCB ADR                   38700021
         USING GSPCB,RGSPCB            DEFINE DSECT                     39000021
         CL    RE,GSPNULLV             STATUS=ADR OF NULL               39300021
         BE    ML30                    BRANCH IF YES                    39600021
         L     RE,ZERO(RE)             LOAD STATUS VALUE                39900021
         CL    RE,ONE                  STATUS=1                         40200021
         BE    ML07                    BRANCH IF YES                    40500021
         CL    RE,TWO                  STATUS=2                         40800021
         BE    ML08                    BRANCH IF YES                    41100021
         CL    RE,THREE                STATUS=3                         41400021
         BE    ML09                    BRANCH IF YES                    41700021
         CL    RE,FOUR                 STATUS=4                         42000021
         BE    ML10                    BRANCH IF YES                    42300021
ML30     LA    RC,ADD2                 LOAD ADD INFO                    42600021
         B     ML02                    BRANCH                           42900021
ML07     CLC   LEVEL(4),ZERO1          LEVEL SPECIFIED                  43200021
         BE    ML11                    BRANCH IF LEVEL NOT SPECIFIED    43500021
         L     RATL,LEVEL              LOAD LEVEL ADR                   43800021
         LA    RE,LIT1                 LOAD OPTION                      44100021
         STC   RE,ATTNLITE             STORE OPTION                     44400021
ML13     CLC   ATTNFWPT(4),ZERO1       LEVEL ACTIVE                     44700021
         BNE   OUTRTN                  BRANCH IF NO                     45000021
ML12     LR    RE,RATL                 SAVE REG                         45300021
ML15     CLI   ATTNBPID,BPID           POINT TO GTMCB                   45600021
         BE    ML14                    BRANCH IF YES                    45900021
         L     RATL,ATTNBKPT           LOAD ADR OF NEXT LEVEL           46200021
         B     ML15                    BRANCH                           46500021
ML14     L     RGTMCB,ATTNBKPT         LOAD GTMCB ADR                   46800021
         LR    RATL,RE                 RESTORE REG                      47100021
         CLI   ATTNLITE,LIT1           OPTION 1                         47400021
         BE    ML16                    BRANCH IF YES                    47700021
         CLI   ATTNLITE,LIT2           OPTION 2                         48000021
         BE    ML19                    BRANCH IF YES                    48300021
         CLI   ATTNLITE,LIT3           OPTION 3                         48600021
         BE    ML18                    BRANCH IF YES                    48900021
         MVC   DATA(4),ATTNPFLM        MOVE IN LIGHT MASK               49200021
         B     ML19                    BRANCH                           49500021
ML18     MVC   DATA(4),ATTNPFEN        MOVE IN ENABLED KEYS             49800021
         B     ML19                    BRANCH                           50100021
ML16     CLI   GTMLIGHT,LIT2           OPTION 2                         50400021
         BE    ML19                    BRANCH IF YES                    50700021
         CLI   GTMLIGHT,LIT3           OPTION 3                         51000021
         BE    ML18                    BRANCH IF YES                    51300021
         MVC   DATA(4),GTMPFKSS        MOVE IN LIGHT MASK               51600021
ML19     EQU   *                                                        51900021
         LA    RC,DATA                 LOAD ADR OF DATA                 52200021
         L     RD,GTMGRDCB             LOAD DCB ADR                     52500021
         LA    R1,DECB                 LOAD I/O AREA ADR                52800021
         TM    GTMFEATS+1,HASPFK       DOES DEVICE HAVE A PF KEYBOARD   52900021
         BC    14,OUTRTN               BRANCH-NO                        53000021
         GCNTRL (1),IND,(11),(10),MF=E                                  53100021
         WAIT  ECB=(1)                                                  53400021
         CLI   DECB,IOK                I/O SUCCESSFULL                  53460021
         BE    OUTRTN                  BRANCH-I/O OK                    53520021
         L     RA,RCA                  LOAD RTN CODE ARRAY ADR          53580021
         OI    ZERO(RA),RC5            INDICATE I/O ERROR               53640021
         B     OUTRTN                  BRANCH                           53700021
ML08     CLC   DEVICE(4),ZERO1         DEVICE OR LEVEL                  54000021
         BE    ML20                    BRANCH-LEVEL                     54300021
         L     RGTMCB,DEVICE           LOAD GTMCB ADR                   54600021
         LA    RE,LIT2                 LOAD OPTION                      54900021
ML22     STC   RE,GTMLIGHT             STORE OPTION                     55200021
         L     RATL,GTMLATBL           LOAD ADR ACTIVE LEVEL            55500021
         LTR   RATL,RATL               IS THERE AN ACTIVE LEVEL         55800021
         BZ    OUTRTN                  BRANCH-NO ACTIVE LEVEL           56100021
         CLI   ATTNLITE,LIT1           OPTION 1                         56400021
         BE    ML16                    BRANCH IF OPT 1                  56700021
         B     OUTRTN                  BRANCH                           57000021
ML20     L     RATL,LEVEL              LOAD LEVEL ADR                   57300021
         LA    RE,LIT2                 LOAD OPTION                      57600021
ML23     STC   RE,ATTNLITE             STORE OPTION                     57900021
         B     ML13                    BRANCH                           58200021
ML09     CLC   DEVICE(4),ZERO1         DEVICE OR LEVEL                  58500021
         BE    ML21                    BRANCH-LEVEL                     58800021
         L     RGTMCB,DEVICE           LOAD GTMCB ADR                   59100021
         LA    RE,LIT3                 LOAD OPTION                      59400021
         B     ML22                    BRANCH                           59700021
ML21     L     RATL,LEVEL              LOAD LEVEL ADR                   60000021
         LA    RE,LIT3                 LOAD OPTION                      60300021
         B     ML23                    BRANCH                           60600021
ML10     TM    STATUS,LAST             LIGHTS ARGUMENT                  60900021
         BC    1,ML24                  BRANCH IF NO                     61200021
         BAL   RA,CONVERT              BRANCH TO CONVERT                61500021
         LTR   RB,RB                   LIGHTS OK                        61800021
         BZ    ML25                    BRANCH IF YES                    62100021
         LR    RC,RB                   LOAD RTN CODE                    62400021
         B     ML02                    BRANCH                           62700021
ML25     CLC   DEVICE(4),ZERO1         DEVICE OR LEVEL                  63000021
         BE    ML26                    BRANCH-LEVEL                     63300021
         L     RGTMCB,DEVICE           LOAD GTMCB ADR                   63600021
         ST    R0,GTMPFKSS             STORE MASK                       63900021
ML28     LA    RE,LIT4                 LOAD OPTION                      64200021
         B     ML22                    BRANCH                           64500021
ML26     L     RATL,LEVEL              LOAD LEVEL ADR                   64800021
         ST    R0,ATTNPFLM             STORE MASK                       65100021
ML29     LA    RE,LIT4                 LOAD OPTION                      65400021
         B     ML23                    BRANCH                           65700021
ML24     CLC   DEVICE(4),ZERO1         DEVICE OR LEVEL                  66000021
         BE    ML27                    BRANCH-LEVEL                     66300021
         L     RGTMCB,DEVICE           LOAD GTMCB ADR                   66600021
         B     ML28                    BRANCH                           66900021
ML27     L     RATL,LEVEL              LOAD LEVEL ADR                   67200021
         B     ML29                    BRANCH                           67500021
CONVERT  SAVE  (2,12)                  SAVE REGS                        67800021
         LA    RSOURCE,LIGHTS          LOAD ADR OF FIRST ARG            68100021
         LA    RFIRST,NEXT             INDICATE 1ST ARG                 68400021
         SR    RLIGHTS,RLIGHTS         CLEAR REG                        68700021
         LA    RINFO,ADD3              LOAD 1ST ADD INFO                69000021
         B     MLA18                   BRANCH                           69300021
MLAOK    SR    RB,RB                   ZERO RETURN CODE                 69600021
         LR    R0,RLIGHTS              LOAD LIGHTS ARG                  69900021
         B     MLA19                   BRANCH                           70200021
MLAERR   LR    RB,RINFO                LOAD RETURN CODE                 70500021
MLA19    RETURN (2,12)                 RETURN                           70800021
MLA18    L     RARG,ZERO(RSOURCE)      LOAD ADR OF ARG                  71100021
         LA    RARG,ZERO(RARG)         ZERO HI ORDER BYTE               71400021
         TM    ZERO(RARG),NEG          ARG NEG                          71700021
         BO    MLANEG                  BRANCH IF NEG                    72000021
         L     RVAL,ZERO(RARG)         LOAD VALUE OF ARG                72300021
MLA24    CL    RVAL,MAX                VALUE GREATER THAN ALLOWABLE     72600021
         BC    2,MLAERR                BRANCH IF YES                    72900021
MLA23    L     RSHIFT,PRIME            PRIME REG                        73200021
         SRL   RSHIFT,ZERO(RVAL)       POSITION BIT                     73500021
         OR    RLIGHTS,RSHIFT          ADD BIT TO LIGHT MASK            73800021
MLA26    TM    ZERO(RARG),NEG          ARG NEG                          74100021
         BO    MLA21                   BRANCH IF YES                    74400021
MLA22    TM    ZERO(RSOURCE),LAST      MORE ARGS                        74700021
         BO    MLAOK                   BRANCH-NO MORE ARGS              75000021
         L     RPREV,ZERO(RARG)        SAVE VALUE PRESENT ARG           75300021
         LA    RSOURCE,NEXT(RSOURCE)   STEP TO NEXT ARG                 75600021
         SR    RFIRST,RFIRST           INDICATE NOT 1ST ARG             75900021
         LA    RINFO,ONEA(RINFO)       INCREMENT ADD INFO               76200021
         B     MLA18                   BRANCH                           76500021
MLA21    LA    RSHIFT,ONEA             LOAD CONSTANT                    76800021
         SR    RVAL,RSHIFT             DECREMENT ARG BY ONE             77100021
         CLR   RPREV,RVAL              VALUE=PREVIOUS VALUE             77400021
         BE    MLA22                   BRANCH IF YES                    77700021
         B     MLA23                   BRANCH                           78000021
MLANEG   LTR   RFIRST,RFIRST           FIRST ARG                        78300021
         BC    7,MLAERR                BRANCH IF YES                    78600021
         LTR   RPREV,RPREV             PREV ARG NEGATIVE                78900021
         BC    4,MLAERR                BRANCH IF YES                    79200021
         L     RVAL,ZERO(RARG)         LOAD VALUE OF ARG                79500021
         LPR   RVAL,RVAL               MAKE ARG POSITIVE                79800021
         CLR   RVAL,RPREV              VALUE GREATER THAN PREV ARG      80100021
         BC    2,MLA24                 BRANCH IF YES                    80400021
         B     MLAERR                  BRANCH                           80700021
         DS    0F                                                       81000021
ZERO1    DC    1F'0'                                                    81300021
ONE      DC    A(1)                                                     81600021
TWO      DC    A(2)                                                     81900021
THREE    DC    A(3)                                                     82200021
FOUR     DC    A(4)                                                     82500021
MAX      DC    A(31)                                                    82800021
PRIME    DC    X'80'                                                    83100021
         DC    AL3(0)                                                   83400021
         CNOP  0,8                                                      83700021
         COPY  ATTNLEVL                                                 84000021
         COPY  GTMCB                                                    84300021
         COPY  GSPCB                                                    84600021
PARAM    DSECT                                                          84900021
DVCENAME DS    0F                                                       85200021
ATNLV    DS    1F                                                       85500021
STATUS   DS    1F                                                       85800021
LIGHTS   DS    1F                                                       86100021
WORKAREA DSECT                                                          86400021
PLIST    DS    1F                                                       86700021
RCA      DS    1F                                                       87000021
SAVE     DS    18F                                                      87300021
DECB     DS    8F                                                       87600021
DATA     DS    1F                                                       87900021
DEVICE   DS    1F                                                       88200021
LEVEL    DS    1F                                                       88500021
         END                                                            88800021
./  ADD  SSI=80330200,NAME=IFFACA08
         TITLE 'REQUEST ATTENTION INFORMATION ROUTINE'      D11         00050003
* TITLE:RQATN-REQUEST ATTENTION INFORMATION                             00100021
* STATUS:CHANGE LEVEL 0                                                 00200021
* FUNCTION:TO DETERMINE IF ANY ATTENTION HAS OCCURRED ON ANY DESIGNATED 00300021
*          SOURCE WHICH HAD BEEN ENABLED WHILE A SPECIFIED ATTENTION    00400021
*          LEVEL WAS ACTIVE.TO DELAY EXECUTION OF THE USER PROGRAM      00500021
*          UNTIL AN EXPECTED ATTENTION OCCURS ON ANY ENABLED DESIGNATED 00600021
*          SOURCE AT THE CURRENTLY ACTIVE ATTENTION LEVEL.              00700021
* ENTRY:ENTERED AT IFFACA08 VIA A CALL TO RQATN.                        00800021
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD    00900021
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 01000021
*       1.ATTNLEVEL-ADDRESS OF A VARIABLE CONTAINING THE ADDRESS OF AN  01100021
*         ATTENTION LEVEL.                                              01200021
*       2.CODELOC-ADDRESS OF A LOCATION INTO WHICH A CODE IS PLACED     01300021
*         THAT SPECIFIES THE TYPE OF ATTENTION BEING RETURNED.          01400021
*       3.WAIT-ADDRESS OF A VALUE THAT INDICATES :                      01500021
*         A. 1-IMMEDIATE RETURN IF DATA NOT AVAILABLE                   01600021
*         B. 2-DO NOT RETURN(WAIT) UNTIL DATA IS AVAILABLE              01700021
*       4.ARRAYNAME-ADDRESS OF AN ARRAY WHERE ATTENTION INFORMATION     01800021
*         MAY BE RETURNED.                                              01900021
*       5.ATTNSOURCE-ADDRESS(ES) OF A VALUE(S) DESIGNATING ATTENTION    02000021
*         TYPES THE INFORMATION IS  DESIRED ABOUT.                      02100021
* OUTPUT:ATTENTION DATA TO USER AND A UNIQUE CODE SPECIFYING TYPE OF    02200021
*        DATA BEING RETURNED.                                           02300021
* EXIT:RETURN TO CALLING PROGRAM                                        02400021
* RETURN CODES: 4,0 INCORRECT NUMBER OF PARAMETERS OR UNABLE TO DETER-  02500021
*                   MINE THE SINGLE INDIVIDUAL PARAMETER AT FAULT.      02600021
*               4,1 ATTNLEVEL DID NOT REFER TO A VALID OR EXISTING      02700021
*                   ATTENTION LEVEL.                                    02800021
*               4,3 VALUE OF WAIT INVALID                               02900021
*               4,5-N VALUE OF ATTNSOURCE INVALID                       03000021
*               0,0 SUCCESSFULL EXECUTION                               03100021
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE                            03200021
* NOTES:THIS ROUTINE EXAMINES THE FOLLOWING CONTROL BLOCKS AND TABLES:  03300021
*       1.GSPCB                                                         03400021
*       2.GTMCB                                                         03500021
*       3.GDSCB                                                         03600021
*       4.KEY TABLE                                                     03700021
*       5.BUFFER CONTROL TABLE                                          03800021
* EXTERNAL ROUTINES:ATTNINQ                                             03900021
*                   GIOCR                                               04000021
*                   CNVRT                                               04100021
         EJECT                                              D11         04105003
IFFACA08 CSECT                                                          04110003
* A33055 FIXED IN COMPONENT IO523.  GSP BYPASS WITH PTF 40613           04112003
*0843,404000-415000,422000-435000                                  000A 04113003
*0843,104000                                                       0935 04114003
*D710000-711000,D713000,A712020-713920,A136100-137000            A37965 04115003
*A68200,69200,75500-75700,A736100-736900,C737000,A738000    D11 ZA15437 04116003
*A759500                                                    D11 ZA15437 04116103
*                                                                       04117003
REG0     EQU   0                       PARAM REG 0                      04200021
REG1     EQU   1                       PARAM REG 1                      04300021
RLIST    EQU   2                       INPUT PARAM LIST                 04400021
RSOURCE  EQU   2                       ATTNSOURCE ADR REG               04500021
RFIRST   EQU   3                       FIRST ARG REG                    04600021
RPARAM   EQU   3                       USER PARAM LIST                  04700021
RATL     EQU   4                       ATTENTION LEVEL ADR              04800021
RINFO    EQU   4                       ADD INFO REG                     04900021
RGTMCB   EQU   5                       GTMCB ADR                        05000021
RKEY     EQU   5                       KEY TABLE ADR REG                05100021
RPFA     EQU   5                       PF REG                           05200021
RANA     EQU   6                       A/N REG                          05300021
RGSPCB   EQU   6                       GSPCB ADR                        05400021
RKEYEN   EQU   6                       PRESENT KEY ENTRY ADR REG        05500021
RA       EQU   7                       WORK REG A                       05600021
RGDSCB   EQU   7                       GDSCB ADR                        05700021
RB       EQU   8                       WORK REG B                       05800021
RWORKE   EQU   8                       WORK REG E                       05900021
RBASE    EQU   9                       BASE REGISTER                    06000021
RC       EQU   10                      WORK REG C                       06100021
RWORKF   EQU   10                      WORK REG F                       06200021
RD       EQU   11                      WORK REG D                       06300021
RWORKC   EQU   11                      WORK REG                         06400021
RE       EQU   12                      WORK REG E                       06500021
RWORKD   EQU   12                      WORK REG                         06600021
RSAVE    EQU   13                      SAVE AREA REG                    06700021
RWORKA   EQU   14                      WORK REG                         06800021
R14      EQU   14                  RETURN REG               D11 ZA15437 06820003
RWORKB   EQU   15                      WORK REG                         06900021
R15      EQU   15                  EP REG                   D11 ZA15437 06920003
ADD0     EQU   0                       ADD INFO 0                       07000021
ADD1     EQU   1                       ADD INFO 1                       07100021
ADD2     EQU   2                       ADD INFO 2                       07200021
ADD3     EQU   3                       ADD INFO 3                       07300021
ADD4     EQU   4                       ADD INFO 4                       07400021
ADD5     EQU   5                       ADD INFO 5                       07500021
CNVRT    EQU   X'0264'             CONVERT STATAB DISPL     D11 ZA15437 07570003
AEC      EQU   X'06'                   AE                               07600021
AID      EQU   X'04'                   ATTN LEVEL ID                    07700021
ANTYPE   EQU   X'01'                   A/N END KEY                      07800021
ATN99    EQU   99                      SOURCE 99                        07900021
ATYPE    EQU   11                      ATTN TYPE                        08000021
BCTFLAG  EQU   4                       BCT FLAGS                        08100021
BFRLEN   EQU   0                       BFR LENGTH FLD                   08200021
BFRSUB   EQU   X'28'                   BFR SUBROUTINE FLAG              08300021
BPID     EQU   X'01'                   BP ID                            08400021
CANCELC  EQU   X'05'                   CANCEL                           08500021
CCTA     EQU   6                       CHARACTER COUNT IN KEY           08520021
CCTB     EQU   5                       CHARACTER COUNT IN KEY           08540021
CCTC     EQU   8                       COUNT SHIFT VALUE                08560021
CNT      EQU   2                       CNT FLD                          08600021
CNTA     EQU   X'FF'                   COUNT FLD VALUE                  08700021
CORVAL   EQU   8                       CORVAL FLD                       08800021
DE       EQU   X'02'                   DIRECT ENTRY FLAG                08900021
DEQUEUE  EQU   X'04'                   DEQUEUE DATA OPTION              09000021
DIV256   EQU   8                       DIVIDE BY 256                    09100021
ENDC     EQU   X'01'                   END                              09200021
ENDTABLE EQU   8                       END OF TABLE                     09300021
ENTRYLEN EQU   12                      ENTRY LENGTH                     09400021
EOSC     EQU   X'04'                   EOS                              09500021
EOSRST   EQU   X'40'                   RESTART OPT FOR EOS              09600021
EOSXY    EQU   X'80'                   XY OPT FOR EOS                   09700021
EQUIV    EQU   X'08'                   EQUIVALENT GDS FALS              09750021
FIRSENT  EQU   12                      ADR OF 1ST KEY TBL ENTRY         09800021
GACBAN   EQU   12                      OFFSET TO A/N                    09900021
GACBOFF  EQU   8                       OFFSET TO START OF GACB          10000021
GACBPF   EQU   8                       OFFSET TO PF                     10100021
GACBRST  EQU   45                      OFFSET TO RESTART BYTE           10200021
GDOA     EQU   6                       GDOA ADJUSTMENT                  10300021
HIBIT    EQU   X'20'                   HI ORDER BIT                     10350021
IDVAL    EQU   X'80'                   FULL SEGMENT ID+1           0935 10400021
INBFR    EQU   X'80'                   EQUIV GDS IS IN BUFFER FLAG      10450021
IOK      EQU   X'7F'                   I/O SUCCESSFULL                  10470021
KEYNUM   EQU   10                      KEY NUMBER                       10500021
LAST     EQU   X'80'                   LAST PARAMETER                   10600021
LOGSTRT  EQU   2                       LOGICAL START FLD                10700021
LPC      EQU   X'03'                   LP                               10800021
LPCHAR   EQU   X'10'                   LP CHARACTER BIT                 10900021
LPCHRMD  EQU   X'20'                   CHARACTER MODE                   11000021
LPSTART  EQU   X'08'                   LP RESTART BIT                   11100021
LPXY     EQU   X'20'                   LP XY POS BIT                    11200021
LVL2     EQU   X'10'                   LEVEL 2 GDSCB                    11300021
MUL256   EQU   8                       MULTIPLY BY 256                  11400021
NEG      EQU   X'80'                   NEGATIVE VALUE                   11500021
NEXT     EQU   4                       NEXT SOURCE                      11600021
NEXTENTY EQU   4                       ADR OF NEXT ENTRY                11700021
NEXTKEY  EQU   0                       ADR OF NEXT KET TBL              11800021
OFFSAVE  EQU   8                       SAVE AREA CHAIN                  11900021
ONE      EQU   1                       ONE                              12000021
ORGEN    EQU   X'38'                   ORGEN KEY CODE                   12050021
OVLY     EQU   9                       OVERLAY CODE                     12100021
PENDET   EQU   X'01'                   PEN DETECT BIT                   12200021
PFC      EQU   X'02'                   RF                               12300021
PFTYPE   EQU   X'02'                   PF TYPE                          12400021
PTR      EQU   1                       PTR FLD                          12500021
RCC4     EQU   X'08'                   RETURN CODE 4                    12600021
RCC5     EQU   X'04'                   I/O ERROR                        12650021
RC4      EQU   16                      OFFSET TO RC4                    12700021
REQSRCH  EQU   X'80'                   REQATN SEARCHING QUEUE           12800021
RSTON    EQU   X'01'                   RESTART YES VALUE                12900021
RSVDA    EQU   8                       START OF DATA AREA               13000021
SCAN1    EQU   1                       VALUE OF 1                       13100021
SCAN2    EQU   2                       VALUE OF 2                       13200021
SEQNCE   EQU   X'20'                   SEQUENCE FLAG                    13300021
SOURCE99 EQU   99                      ATTN SOURCE 99                   13400021
TOBIT    EQU   X'18'                   SUBROUTINE LINKAGE               13450021
TWO      EQU   2                       TWO                              13500021
ZERO     EQU   0                       ZERO                             13600021
BSCSPC   EQU   56                  BASIC CHAR SPACING            A37965 13610000
LRGSPC   EQU   84                  LARGE CHAR SPACING            A37965 13620000
BSCSZE   EQU   X'0A'               MASK FOR BASIC SIZE CHARS     A37965 13630000
LRGSZE   EQU   X'05'               MASK FOR LARGE SIZE CHARS     A37965 13640000
NOSCISS  EQU   X'10'               MASK FOR 'NO SCISSORING'      A37965 13650000
XSCREEN  EQU   4092                MAX X FOR CHAR CENTER         A37965 13660000
YSCREEN  EQU   4092                MAX Y FOR CHAR CENTER         A37965 13670000
BSCLINE  EQU   80                  BASIC LINE SPACING            A37965 13680000
LRGLINE  EQU   120                 LARGE LINE SPACING            A37965 13690000
YLOWER   EQU   0                   MIN Y FOR CHAR CENTER         A37965 13700000
         SAVE  (14,12)                 SAVE REGISTERS                   13800021
         BALR  RBASE,0                 SET UP BASE REGISTER             13900021
         USING *,RBASE                 DEFINE BASE REG                  14000021
         LR    RLIST,REG1              SAVE INPUT PARAMETER             14100021
         USING WORKAREA,RLIST          DEFINE DSECT                     14200021
         L     RPARAM,PARAM            LOAD ADR USER PARAM LIST         14300021
         USING PLIST,RPARAM            DEFINE DSECT                     14400021
         ST    RSAVE,SAVE+4            SAVE-SAVE AREA PTR               14500021
         LA    RD,SAVE                 LOAD ADR OF MY SAVE AREA         14600021
         ST    RD,OFFSAVE(RSAVE)       STORE IN USER SAVE AREA          14700021
         LA    RSAVE,SAVE              * AREAS                          14800021
         L     RWORKA,RCA              LOAD RETURN CODE ARRAY ADR       14900021
         XC    ZERO(20,RWORKA),ZERO(RWORKA) ZERO ARRAY                  15000021
         B     AROUND                  BRANCH                           15100021
ERROR    L     RWORKA,RCA              LOAD RTN CODE ARRAY ADR          15200021
         STC   RWORKB,ZERO(RWORKA)     STORE RETURN CODE                15300021
         ST    RWORKC,ZERO(RWORKD,RWORKA) STORE ADD INFO AT PROPER      15400021
*                                         OFFSET                        15500021
OUTRTN   L     RSAVE,SAVE+4            RESTORE OLD SAVE AREA PTR        15600021
         RETURN (14,12),T              RETURN TO CALLER                 15700021
AROUND   TM    ATNLVL,LAST             LAST PARAM                       15800021
         BC    14,REQ01                BRANCH IF NO                     15900021
REQ02    LA    RWORKC,ADD0             LOAD ADD INFO                    16000021
REQ03    LA    RWORKB,RCC4             LOAD RETURN CODE                 16100021
         LA    RWORKD,RC4              LOAD OFFSET                      16200021
         B     ERROR                   BRANCH                           16300021
REQ01    L     RATL,ATNLVL             LOAD INDIRECT PTR TO ATTN LEVEL  16400021
         L     RATL,ZERO(RATL)         LOAD ATTN LEVEL ADR              16500021
         USING ATTNLEVL,RATL           DEFINE DSECT                     16600021
         CLI   ATTNLVID+1,AID          IS THIS VALID ATTN LEVEL         16700021
         BNE   REQ40                   BRANCH IF NO                     16800021
         LR    RWORKD,RATL             SAVE REG                         16900021
REQ06    CLI   ATTNBPID,BPID           THIS LEVEL POINT TO GTMCB        17000021
         BNE   REQ04                   BRANCH IF NO                     17100021
         L     RGTMCB,ATTNBKPT         LOAD GTMCB ADR                   17200021
         USING GTMCB,RGTMCB            DEFINE DSECT                     17300021
         LR    RATL,RWORKD             RESTORE REG                      17400021
         B     REQ05                   BRANCH                           17500021
REQ04    L     RATL,ATTNBKPT           LOAD ADR NEXT HIGHER LEVEL       17600021
         B     REQ06                   BRANCH                           17700021
REQ05    L     RGSPCB,GTMGSPCB         LOAD GSPCB ADR                   17800021
         USING GSPCB,RGSPCB            DEFINE DESECT                    17900021
         TM    CODELOC,LAST            IS THIS LAST PARAM               18000021
         BC    1,REQ02                 BRANCH IF YES                    18100021
         B     REQ07                   BRANCH                           18200021
REQ08    LA    RWORKC,ADD2             LOAD ADD INFO                    18300021
         B     REQ03                   BRANCH                           18400021
REQ07    CLC   CODELOC(4),GSPNULLV     IS THIS ADR OF NULL              18500021
         BE    REQ08                   BRANCH IF YES                    18600021
         CLC   CODELOC(4),ZERO1        CODE LOC ADR = ZERO              18700021
         BE    REQ08                   BRNANCH IF YES                   18800021
         TM    SCANWAIT,LAST           IS THIS THE LAST PARAM           18900021
         BC    1,REQ02                 BRANCH IF YES                    19000021
         B     REQ09                   BRANCH                           19100021
REQ10    LA    RWORKC,ADD3             LOAD ADR INFO                    19200021
         B     REQ03                   BRANCH                           19300021
REQ09    CLC   SCANWAIT(4),GSPNULLV    IS THIS ADR OF NULL              19400021
         BE    REQ10                   BRANCH IF YES                    19500021
         L     RWORKC,SCANWAIT         LOAD ADR OF SCANWAIT             19600021
         L     RWORKC,ZERO(RWORKC)     LOAD SCAN WAIT VALUE             19700021
         LA    RWORKD,SCAN1            LOAD CONSTANT                    19800021
         CLR   RWORKC,RWORKD           SCANWAIT=1                       19900021
         BE    REQ11                   BRANCH IF YES                    20000021
         LA    RWORKD,SCAN2            LOAD CONSTANT                    20100021
         CLR   RWORKC,RWORKD           SCAN WAIT=2                      20200021
         BNE   REQ10                   BRANCH IF NOT=2                  20300021
REQ11    TM    ARRAY,LAST              LAST PARAMETER                   20400021
         BC    1,REQ02                 BRANCH IF YES                    20500021
         B     REQ41                   BRANCH                           20600021
REQ13    LA    RWORKC,ADD4             LOAD ADD INFO                    20700021
         B     REQ03                   BRANCH                           20800021
REQ41    CLC   ARRAY(4),ZERO1          ARRAY ADR ZERO                   20900021
         BE    REQ13                   BRANCH IF YES                    21000021
REQ12    L     RWORKC,ATNSRCE          LOAD 1ST ATTN SOURCE ARG ADR     21100021
         LA    RWORKC,ZERO(RWORKC)     ZERO HI ORDER BYTE               21200021
         L     RWORKC,ZERO(RWORKC)     LOAD 1ST ATTN SOURCE ARG         21300021
         LA    RWORKD,SOURCE99         LOAD CONSTANT                    21400021
         CLR   RWORKC,RWORKD           IS ATTN SOURCE = 99              21500021
         BNE   REQ14                   BRANCH IF NO                     21600021
         TM    ATNSRCE,LAST            ONLY ATTN SOURCE ARG             21700021
         BC    1,REQ15                 BRANCH IF YES                    21800021
REQ16    LA    RWORKC,ADD5             LOAD ADD INFO                    21900021
         B     REQ03                   BRANCH                           22000021
REQ15    TM    ATTNFLGA,DE             ARE WE IN DIRECT ENTRY           22100021
         BC    1,REQ16                 BRANCH IF YES                    22200021
         B     ATTN99                  BRANCH TO PROCESS SOURCE 99      22300021
REQ14    BAL   RWORKA,CONVERTA         BRANCH TO ATTNSOURCE CONVERSION  22400021
         LTR   RWORKB,RWORKB           RC=0                             22500021
         BC    8,REQ17A                BRANCH IF YES                    22600021
         LR    RWORKC,RWORKB           LOAD ADD INFO                    22700021
         B     REQ03                   BRANCH                           22800021
REQ17A   ST    REG0,ANMASK             SAVE AN MASK                     22900021
         ST    REG1,PFMASK             SAVE PF MASK                     23000021
         NC    ANMASK(4),ATTNANEN      DELETE ANY ATTN SOURCES-         23100021
         NC    PFMASK(4),ATTNPFEN      NOT PREVIOUSLY ENABLED           23200021
         CLC   ANMASK(4),ZERO1         ANY SOURCES ENABLED              23300021
         BNE   REQ800                  BRANCH-YES                       23400021
         CLC   PFMASK(4),ZERO1         ANY SOURCES ENABLED              23500021
         BE    REQ62                   BRANCH-NO                        23600021
REQ800   EQU   *                                                        23700021
         L     RGDSCB,GTMGDSCB         LOAD ADR OF 1ST GDSCB            23800021
         USING GDSCB,RGDSCB            DEFINE DSECT                     23900021
REQ17    TM    ATTNFLGA,DE             ARE WE IN DIRECT ENTRY           24000021
         BC    1,DIRECT                BRANCH IF YES                    24100021
         B     NTDIRECT                BRANCH TO NOT DIRECT ENTRY       24200021
ATTN99   XC    ATTNAECB(4),ATTNAECB    CLEAR SOURCE 99 ECB              24300021
         CLI   ATTNSETA,ATN99          DATA AVAILABLE                   24400021
         BNE   REQ34                   BRANCH IF NO                     24500021
REQ39    L     RWORKA,ARRAY            LOAD ARRAY ADR                   24600021
         L     RWORKB,GSPNULLV         LOAD NULL ADR                    24700021
         CLR   RWORKA,RWORKB           IS THERE AN ARRAY                24800021
         BE    REQ35                   BRANCH IF NO                     24900021
         MVC   ZERO(8,RWORKA),ATTNSETA+4 MOVE DATA TO ARRAY             25000021
REQ35    XC    ATTNSETA(12),ATTNSETA   CLEAR DATA AREA                  25100021
         LA    RWORKB,ATN99            LOAD VALUE                       25200021
REQ36    L     RWORKA,CODELOC          LOAD CODELOC ADR                 25300021
         ST    RWORKB,ZERO(RWORKA)     STORE CODE LOC                   25400021
         B     OUTRTN                  RETURN TO CALLER                 25500021
REQ34    L     RWORKA,SCANWAIT         LOAD PTR TO SCAN WAIT            25600021
         CLC   SCANTWO(4),ZERO(RWORKA) IS A WAIT REQUESTED              25700021
         BE    REQ37                   BRANCH IF YES                    25800021
         SR    RWORKB,RWORKB           CLEAR REG                        25900021
         B     REQ36                   BRANCH                           26000021
REQ37    CLC   ATTNFWPT(4),ZERO1       IS LEVEL ACTIVE                  26100021
         BE    REQ38                   BRANCH IF YES                    26200021
         SR    RWORKC,RWORKC           ADD INFO=0                       26300021
         B     REQ03                   BRANCH                           26400021
REQ38    LA    REG1,ATTNAECB           LOAD ADR OF ECB                  26500021
         WAIT  ECB=(1)                                                  26600021
         B     REQ39                   BRANCH                           26700021
REQ40    LA    RWORKC,ADD1             LOAD ADD INFO CODE               26800021
         B     REQ03                   BRANCH                           26900021
CONVERTA SAVE  (2,12)                  SAVE REGS                        27000021
         LA    RSOURCE,ATNSRCE         LOAD ADR OF 1ST ARG              27100021
         LA    RFIRST,NEXT             INDICATE 1ST ARG                 27200021
         SR    RPFA,RPFA               CLEAR PF REG                     27300021
         SR    RANA,RANA               CLEAR A/N REG                    27400021
         LA    RINFO,ADD5              LOAD 1ST ADD INFO CODE           27500021
         B     REQ18                   BRANCH                           27600021
REQOK    SR    RWORKB,RWORKB           ZERO RETURN CODE                 27700021
         LR    REG0,RANA               LOAD A/N MASK                    27800021
         LR    REG1,RPFA               LOAD P/F MASK                    27900021
         B     REQ19                   BRANCH                           28000021
REQERR   LR    RWORKB,RINFO            LOAD RETURN CODE                 28100021
REQ19    RETURN (2,12)                 RETURN                           28200021
REQ18    L     RC,ZERO(RSOURCE)        LOAD ADR OF ARG                  28300021
         TM    ZERO(RC),NEG            ARG NEGATIVE                     28400021
         BC    1,REQNEG                BRANCH IF NEG                    28500021
         L     RB,ZERO(RC)             LOAD VALUE OF ARG                28600021
REQ24    CL    RB,MAX                  VALUE GREATER THAN ALLOWABLE     28700021
         BC    2,REQERR                BRANCH IF YES                    28800021
REQ23    CL    RB,ANSIZE               VALUE GREATER THAN 31            28900021
         BC    2,REQ20                 BRANCH IF YES                    29000021
         L     RE,PRIME                PRIME REG                        29100021
         SRL   RE,ZERO(RB)             POSITION BIT                     29200021
         OR    RPFA,RE                 ADD TO PF MASK                   29300021
REQ26    TM    ZERO(RC),NEG            ARG NEG                          29400021
         BC    1,REQ21                 BRANCH IF YES                    29500021
REQ22    TM    ZERO(RSOURCE),LAST      MORE ARGS                        29600021
         BC    1,REQOK                 BRANCH IF NO                     29700021
         L     RA,ZERO(RC)             SAVE VALUE PRESENT ARG           29800021
         LA    RSOURCE,NEXT(RSOURCE)   STEP TO NEXT ARG                 29900021
         SR    RFIRST,RFIRST           INDICATE NOT 1ST ARG             30000021
         LA    RINFO,ONE(RINFO)        INCREMENT ADD INFO               30100021
         B     REQ18                   BRANCH TO MORE ARGS              30200021
REQ21    LA    RE,ONE                  LOAD CONSTANT                    30300021
         SR    RB,RE                   DECREMENT ARG BY 1               30400021
         CLR   RA,RB                   VALUE=PREVIOUS VALUE             30500021
         BE    REQ22                   BRANCH IF YES                    30600021
         B     REQ23                   BRANCH                           30700021
REQNEG   LTR   RFIRST,RFIRST           FIRST ARG                        30800021
         BC    7,REQERR                BRANCH IF YES                    30900021
         LTR   RA,RA                   PREV ARG NEG                     31000021
         BC    4,REQERR                BRANCH IF YES                    31100021
         L     RB,ZERO(RC)             LOAD VALUE OF ARG                31200021
         LPR   RB,RB                   MAKE ARG POS                     31300021
         CLR   RB,RA                   VALUE GREATER THAN PREV ARG      31400021
         BC    2,REQ24                 BRANCH IF YES                    31500021
         B     REQERR                  BRANCH                           31600021
REQ20    LA    RD,END                  LOAD ADR OF CONSTANT             31700021
         LA    RE,ONE                  LOAD CONSTANT                    31800021
REQ27    CL    RB,ZERO(RD)             COMPARE                          31900021
         BE    REQ25                   BRANCH IF YES                    32000021
         SLL   RE,ONE                  SHIFT BIT                        32100021
         LA    RD,NEXT(RD)             LOAD NEXT CONSTANT ADR           32200021
         B     REQ27                   BRANCH                           32300021
REQ25    OR    RANA,RE                 ADD BIT TO MASK                  32400021
         B     REQ26                   BRANCH                           32500021
NTDIRECT CLC   ATTNMLEN,ZERO1          ANY DATA                         32600021
         BNE   REQ50                   BRANCH IF YES                    32700021
REQ53    CLC   ATTNFWPT,ZERO1          IS LEVEL ACTIVE                  32800021
         BE    REQ51                   BRANCH IF YES                    32900021
         L     RWORKC,SCANWAIT         LOAD PTR TO SCANWAIT             33000021
         CLC   SCANTWO(4),ZERO(RWORKC) IMMEDIATE RETURN WANTED          33100021
         BNE   REQ52                   BRANCH IF YES                    33200021
REQ62    LA    RWORKC,ADD0             LOAD ADD INFO                    33300021
         B     REQ03                   BRANCH                           33400021
REQ52    L     RWORKC,CODELOC          LOAD ADR OF CODE LOC             33500021
         SR    RWORKD,RWORKD           CLEAR REG                        33600021
         ST    RWORKD,ZERO(RWORKC)     CODE LOC=0                       33700021
         B     OUTRTN                  BRANCH                           33800021
REQ50    L     RWORKA,ATTNMLEN         LOAD ADR OF 1ST ENTRY            33900021
         SR    RWORKF,RWORKF           ZERO REG                         34000021
REQ57    CLI   ATYPE(RWORKA),PFTYPE    PF ATTN                          34100021
         BE    REQ54                   BRANCH IF YES                    34200021
         LA    RWORKB,ONE              PRIME REG                        34300021
         CLI   ATYPE(RWORKA),ANTYPE    END KEY ATTN                     34400021
         BE    REQ55                   BRANCH IF YES                    34500021
         SR    RWORKC,RWORKC           CLEAR REG                        34600021
         IC    RWORKC,ATYPE(RWORKA)    INSERT ATTN TYPE                 34700021
         LA    RWORKD,TWO              LOAD CONSTANT                    34800021
         SR    RWORKC,RWORKD           DETERMINE SHIFT CONSTANT         34900021
         SLL   RWORKB,ZERO(RWORKC)     POSITION BIT                     35000021
REQ55    N     RWORKB,ANMASK           DETERMINE IF MATCH               35100021
         LTR   RWORKB,RWORKB           WAS THERE A MATCH                35200021
         BC    7,REQ56                 BRANCH IF YES                    35300021
REQ58    LR    RWORKF,RWORKA           SAVE ADR                         35400021
         L     RWORKA,ZERO(RWORKA)     LOAD PTR TO NEXT ENTRY           35500021
         LTR   RWORKA,RWORKA           ANY MORE ENTRIES                 35600021
         BC    7,REQ57                 BRANCH IF YES                    35700021
         B     REQ53                   BRANCH                           35800021
REQ54    L     RWORKB,PRIME            PRIME PF REG                     35900021
         SR    RWORKC,RWORKC           CLEAR REG                        36000021
         IC    RWORKC,KEYNUM(RWORKA)   INSERT KEY NUMBER                36100021
         SRL   RWORKB,ZERO(RWORKC)     POSITION BIT                     36200021
         N     RWORKB,PFMASK           DETERMINE IF A MATCH             36300021
         LTR   RWORKB,RWORKB           WAS THERE A MATCH                36400021
         BC    8,REQ58                 BRANCH IF NO                     36500021
REQ56    MVC   RSVD(12),RSVDA(RWORKA)  MOVE DATA TO WORK AREA           36600021
         CLC   ATTNFWPT(4),ZERO1       LEVEL ACTIVE                     36700021
         BE    REQ1A                   BRANCH IF LEVEL ACTIVE           36800021
         LR    REG0,RWORKF             SAVE REG                         36900021
         LR    REG1,RWORKA             SAVE REG                         37000021
         TM    ATTNFLGA,DEQUEUE        MAY WE DEQUEUE FROM AN INACTIVE  37100021
*                                      LEVEL                            37200021
         BO    REQ60                   BRANCH IF NO                     37300021
REQ1A    EQU   *                                                        37400021
         LTR   RWORKF,RWORKF           1ST ENTRY                        37500021
         BC    8,REQ59                 BRANCH IF YES                    37600021
         MVC   ZERO(4,RWORKF),ZERO(RWORKA) DEQUEUE ENTRY                37700021
         B     REQ61                   BRANCH                           37800021
REQ59    MVC   ATTNMLEN(4),ZERO(RWORKA) DEQUEUE ENTRY                   37900021
REQ61    MVC   ZERO(4,RWORKA),ATTNAVAL  * ADD ENTRY TO                  38000021
         ST    RWORKA,ATTNAVAL          * AVAILABLE LIST                38100021
         B     REQ60                   BRANCH                           38200021
REQ51    SR    RWORKC,RWORKC           CLEAR REG                        38300021
         O     RWORKC,ATTNPFEN         ADD ENABLED PF KEYS FOR LEVEL    38400021
         O     RWORKC,PFMASK           ADD REQUESTED SOURCES            38500021
         X     RWORKC,ATTNPFEN         TEST IF REQUEST VALID            38600021
         LTR   RWORKC,RWORKC           REQUEST VALID                    38700021
         BC    7,REQ62                 BRANCH IF NO                     38800021
         O     RWORKC,ATTNANEN         ADD ENABLED A/N SOURCES FOR LVL  38900021
         O     RWORKC,ANMASK           ADD REQUESTED SOURCES            39000021
         X     RWORKC,ATTNANEN         DETERMINE IF VALID REQUEST       39100021
         LTR   RWORKC,RWORKC           VALID REQUEST                    39200021
         BC    7,REQ62                 BRANCH IF NO                     39300021
         L     RWORKC,GTMGACBA         LOAD PTR TO GACB                 39400021
         LA    RWORKC,GACBOFF(RWORKC)  LOAD PTR TO TRUE START OF GACB   39500021
         MVC   SAVE1(4),GACBAN(RWORKC) SAVE A/N MASK                    39600021
         MVC   SAVE2(4),GACBPF(RWORKC) SAVE P/F MASK                    39700021
         MVC   GACBAN(4,RWORKC),ANMASK MOVE IN A/N REQUEST              39800021
         MVC   GACBPF(4,RWORKC),PFMASK MOVE IN PF REQUEST               39900021
         XC    GACB(12),GACB           CLEAR MACRO AREA                 40000021
         L     RWORKA,SCANWAIT         LOAD PTR TO SCAN WAIT            40100021
         CLC   SCANTWO(4),ZERO(RWORKA) IMMEDIATE RETURN WANTED          40200021
         BNE   REQ63                   BRANCH IF YES                    40300021
         XC    LFORM(64),LFORM          ZERO LIST                  000A 40700021
         ATTNINQ (11),MODE=W,TYP=ANY,MF=(E,LFORM)                  000A 41100021
REQ66    MVC   GACBAN(4,RWORKC),SAVE1  RESTORE MASK                     41600021
         MVC   GACBPF(4,RWORKC),SAVE2  RESTORE MASK                     41700021
         L     RWORKD,ZERO(RWORKC)     LOAD COMAREA ADR                 41800021
         MVC   RSVD(12),ZERO(RWORKD)   DATA TO WORK AREA                41900021
         B     REQ60                   BRANCH                           42000021
REQ63    EQU   *                                                        42100021
         XC    LFORM(64),LFORM          ZERO LIST                  000A 42600021
         ATTNINQ (11),MODE=(C,REQ65),TYP=ANY,MF=(E,LFORM)          000A 43100021
         MVC   GACBAN(4,RWORKC),SAVE1  RESTORE MASK                     43600021
         MVC   GACBPF(4,RWORKC),SAVE2  RESTORE MASK                     43700021
         B     REQ52                   BRANCH                           43800021
REQ65    B     REQ66                   BRANCH                           43900021
REQ60    CLI   TYPE,LPC                LIGHT PEN                        44000021
         BE    REQ70                   BRANCH IF YES                    44100021
         CLI   TYPE,EOSC               EOS ATTN                         44200021
         BNE   REQ100                  BRANCH IF NO                     44300021
         CLC   ATTNFWPT(4),ZERO1       LEVEL ACTIVE                     44400021
         BE    REQ71                   BRANCH IF YES                    44500021
         XC    XPOS(4),XPOS            ENSURE XY=0                      44600021
         B     REQ101                  BRANCH                           44700021
REQ71    TM    ATTNFLGA,EOSXY          XY READ OUT WANTED               44800021
         BC    1,REQ72                 BRANCH IF YES                    44900021
REQ73    TM    ATTNFLGA,EOSRST         RESTART WANTED                   45000021
         BC    1,REQ74                 BRANCH IF YES                    45100021
         B     REQ101                  BRANCH                           45200021
REQ72    XC    DECB(36),DECB           CLEAR I/O AREA                   45300021
         XC    XPOS(4),XPOS            CLEAR DATA AREA                  45400021
         L     RWORKC,GTMGRDCB         LOAD DCB ADR                     45500021
         LA    RWORKD,XPOS             LOAD DATA AREA ADR               45600021
         LA    REG1,DECB               LOAD ADR OF PARAM LIST           45700021
         GREADR (1),XYP,(11),(12),MF=E                                  45800021
         WAIT  ECB=(1)                                                  45900021
         BAL   REG1,IOTEST             TO TEST I/O                      45950021
         B     REQ73                   BRANCH                           46000021
REQ74    XC    DECB(36),DECB           CLEAR I/O AREA                   46100021
         LA    RWORKC,SENSE+2          LOAD RESTART ADR                 46200021
         L     RWORKD,GTMGRDCB         LOAD DCB ADR                     46300021
         LA    REG1,DECB               LOAD DECB ADR                    46400021
         GCNTRL (1),STR,(12),(11),MF=E                                  46500021
         WAIT  ECB=(1)                                                  46600021
         BAL   REG1,IOTEST             TO TEST I/O                      46650021
         B     REQ101                  BRANCH                           46700021
REQ70    SR    RWORKC,RWORKC           CLEAR REG                        46800021
         LH    RWORKC,SENSE+2          LOAD BFR ADR                     46900021
         SRL   RWORKC,DIV256           DIVIDE NUMBER BY 256             47000021
         SR    RWORKF,RWORKF           CLEAR REG                        47100021
         M     RWORKF,THREE            MULTIPLY #  BY 3  RESULT=RWORKC  47200021
         L     RWORKF,GTMBCTBL         LOAD ADR OF BCT                  47300021
         LTR   RWORKF,RWORKF           IS THERE A BFR CONTROL TBL       47400021
         BC    8,REQ79                 BRANCH IF NO                     47500021
         AR    RWORKC,RWORKF           DETERMINE ADR OF BCT ENTRY       47600021
         LR    RWORKA,RWORKC           LOAD REG                         47700021
         CLC   ZERO(1,RWORKA),ZERO1    IS AN ID ASSIGNED                47800021
         BE    REQ79                   BRANCH IF NO ID                  47900021
         CLI   ZERO(RWORKA),IDVAL      IS A FULL SEGMENT ASSIGNED       48000021
         BC    4,REQ75                 BRANCH IF A FULL SEGMENT         48100021
         SR    RWORKC,RWORKC           CLEAR REG                        48200021
         SR    RWORKF,RWORKF           CLEAR REG                        48300021
         LH    RWORKC,SENSE+2          LOAD DIVIDEND                    48400021
         D     RWORKF,DIV256A          DIVIDE BY 256 RWORKF=REMAINDER   48500021
         CL    RWORKF,SUBSEG           UPPER OR LOWER HALF              48600021
         BC    4,REQ76                 BRANCH LOWER SEGMENT             48700021
         CLI   ZERO+ONE(RWORKA),IDVAL  SUB SEG ASSIGNED                 48800021
         BE    REQ79                   BRANCH IF NO                     48900021
         MVC   IDBYTE(1),ONE(RWORKA)   SAVE ID                          49000021
         B     REG755                                              7172 49100021
REQ76    CLI   ZERO(RWORKA),IDVAL      SUB REG ASSIGNED                 49200021
         BE    REQ79                   BRANCH IF NO                     49300021
REQ75    MVC   IDBYTE(1),ZERO(RWORKA)  SAVE ID                          49400021
REG755   L     RGDSCB,GTMGDSCB     GET NEXT REQUEST BLOCK          7172 49450021
REQ77    CLC   GDSBCTID(1),IDBYTE      GDS=MY ID                        49500021
         BE    REQ78                   BRANCH IF YES                    49600021
REQ80    EQU   *                                                        49650021
         CLC   GDSNXGDS(4),ZERO1       ANY MORE GDS                     49700021
         BE    REQ79                   BRANCH IF NO                     49800021
         L     RGDSCB,GDSNXGDS         LOAD ADR OF NEXT GDS             49900021
         B     REQ77                   BRANCH                           50000021
REQ78    EQU   *                                                        50010021
         TM    GDSFLAGS,EQUIV          IS THIS AN EQUIVALENT GDS        50020021
         BC    14,REQ81                BRANCH-NO                        50030021
         TM    GDSFLAGS,INBFR          GDS IN BFR                       50040021
         BO    REQ81                   BRANCH-YES                       50050021
         B     REQ80                   BRANCH                           50060021
REQ81    EQU   *                                                        50070021
         TM    GDSFLAGS,PENDET         LIGHT PEN DETECT ENABLED         50130021
         BC    1,REQ700                BRANCH IF YES                    50200021
         CLC   ATTNFWPT(4),ZERO1       LEVEL ACTIVE                     50300021
         BE    REQ79                   BRANCH IF LEVEL ACTIVE           50400021
         TM    ATTNFLGA,DEQUEUE        MAY WE DEQUEUE FROM AN INACTIVE  50500021
*                                      LEVEL                            50600021
         BC    14,NTDIRECT             BRANCH IF YES                    50700021
         LR    RWORKF,REG0             RESTORE REG                      50800021
         LR    RWORKA,REG1             RESTORE REG                      50900021
         LTR   RWORKF,RWORKF           1ST ENTRY                        51000021
         BZ    REQ59A                  BRANCH IF YES                    51100021
         MVC   ZERO(4,RWORKF),ZERO(RWORKA) DEQUEUE ENTRY                51200021
         B     REQ61A                  BRANCH                           51300021
REQ59A   MVC   ATTNMLEN(4),ZERO(RWORKA) DEQUEUE ENTRY                   51400021
REQ61A   MVC   ZERO(4,RWORKA),ATTNAVAL * ADD ENTRY TO                   51500021
         ST    RWORKA,ATTNAVAL         * AVAILABLE LIST                 51600021
         B     NTDIRECT                BRANCH                           51700021
REQ79    L     RWORKD,GTMGACBA         LOAD PTR TO GSP GACB             51800021
         LA    RWORKD,GACBOFF(RWORKD)  LOAD TRUE START GACB ADR         51900021
         CLI   GACBRST(RWORKD),RSTON   LP RESTART FLAG ON               52000021
         BE    NTDIRECT                BRANCH IF YES                    52100021
         XC    DECB(32),DECB           CLEAR I/O AREA                   52200021
         LA    REG1,DECB               LOAD ADR OF DECB                 52300021
         L     RWORKC,GTMGRDCB         LOAD DCB ADR                     52400021
         LA    RWORKD,SENSE+2          LOAD RESTART ADR PTR             52500021
         GCNTRL (1),STR,(11),(12),MF=E                                  52600021
         WAIT  ECB=(1)                                                  52700021
         BAL   REG1,IOTEST             TO TEST I/O                      52750021
         B     NTDIRECT                BRANCH                           52800021
REQ700   TM    ATTNFLGA,LPCHAR         CHARACTER WANTED                 52900021
         BC    14,REQ102               BRANCH IF NO                     53000021
         CLC   ATTNFWPT(4),ZERO1       LEVEL ACTIVE                     53100021
         BNE   REQ701                  BRANCH IF NOT ACTIVE             53200021
         TM    SENSE+1,LPCHRMD         LP IN CHARACTER MODE             53300021
         BC    14,REQ701               BRANCH IF NOT CHARACTER MODE     53400021
         XC    DECB(32),DECB           CLEAR I/O AREA                   53500021
         LA    REG1,DECB               LOAD ADR OF I/O AREA             53600021
         L     RWORKF,GTMGRDCB         LOAD DCB ADR                     53700021
         LA    RWORKC,CHARACTR         LOAD ADR OF DATA AREA            53800021
         LA    RWORKD,SENSE+2          LOAD ADR OF CHARACTER            53900021
         LA    RWORKE,ONE              LOAD NUMBER OF BYTES TO READ     54000021
         GREAD (1),BUF,(10),(8),(11),(12),MF=E                          54100021
         WAIT  ECB=(1)                                                  54200021
         BAL   REG1,IOTEST             TO TEST I/O                      54250021
         TM    ATTNFLGA,LPSTART        RESTART WANTED                   54300021
         BC    14,REQ102               BRANCH IF NO                     54400021
         XC    DECB(32),DECB           CLEAR I/O AREA                   54500021
         LA    REG1,DECB               LOAD ADR OF I/O AREA             54600021
         GCNTRL (1),STR,(10),(12),MF=E                                  54700021
         WAIT  ECB=(1)                                                  54800021
         BAL   REG1,IOTEST             TO TEST I/O                      54850021
         B     REQ102                  BRANCH                           54900021
REQ701   XC    CHARACTR(1),CHARACTR    CLEAR CHARACTER BYTE             55000021
         B     REQ102                  BRANCH                           55100021
REQ102   CLC   ARRAY(4),GSPNULLV       WAS AN ARRAY SPECIFIED           55200021
         BE    REQ103                  BRANCH IF NO                     55300021
         BAL   RWORKA,LPEOS            BRANCH TO ARRAY FILL IN          55400021
REQ103   L     RWORKC,CODELOC          LOAD ADR OF CODE LOC             55500021
         MVC   ZERO(4,RWORKC),LPD      CODE 34 TO CODE LOC              55600021
         B     OUTRTN                  BRANCH                           55700021
REQ101   CLC   ARRAY(4),GSPNULLV       WAS AN ARRAY SPECIFIED           55800021
         BE    REQ104                  BRANCH IF NO                     55900021
         BAL   RWORKA,LPEOS            BRANCH TO ARRAY FILL IN          56000021
REQ104   L     RWORKC,CODELOC          LOAD ADR OF CODE LOC             56100021
         MVC   ZERO(4,RWORKC),EOSD     CODE 35 TO CODE LOC              56200021
         B     OUTRTN                  BRANCH                           56300021
REQ100   L     RWORKC,CODELOC          LOAD ADR OF CODELOC              56400021
         CLI   TYPE,PFC                PF ATTN                          56500021
         BE    REQ105                  BRANCH IF YES                    56600021
         CLI   TYPE,ENDC               END KEY ATTN                     56700021
         BE    REQ106                  BRANCH IF YES                    56800021
         CLI   TYPE,AEC                AE ATTN                          56900021
         BE    REQ107                  BRANCH IF YES                    57000021
         MVC   ZERO(4,RWORKC),CANCELD  CODE 33 TO CODELOC               57100021
         B     OUTRTN                  BRANCH                           57200021
REQ106   MVC   ZERO(4,RWORKC),END      CODE 32 TO CODELOC               57300021
         B     OUTRTN                  BRANCH                           57400021
REQ107   MVC   ZERO(4,RWORKC),AED      CODE 36 TO CODELOC               57500021
         B     OUTRTN                  BRANCH                           57600021
REQ105   CLC   ARRAY(4),GSPNULLV       ARRAY SPECIFIED                  57700021
         BE    REQ108                  BRANCH IF NO                     57800021
         L     RWORKD,ARRAY            LOAD ARRAY ADR                   57900021
         SR    RWORKF,RWORKF           CLEAR REG                        58000021
         IC    RWORKF,OVERLAY          LOAD OVERLAY VALUE               58100021
         ST    RWORKF,ZERO(RWORKD)     OVERLAY CODE TO ARRAY            58200021
REQ108   SR    RWORKF,RWORKF           CLEAR REG                        58300021
         IC    RWORKF,KEYNO            LOAD KEY #                       58400021
         LTR   RWORKF,RWORKF            IS ATTN SOURCE PFK0        RSTH 58440021
         BNE   REQ109                   NO                         RSTH 58480021
         L     RWORKF,MIN1              SET CODE TO -1 FOR PFK0    RSTH 58520021
REQ109   ST    RWORKF,ZERO(RWORKC)      KEY= TO CODELOC            RSTH 58560021
         B     OUTRTN                  BRANCH                           58600021
LPEOS    L     RWORKE,ARRAY            LOAD ARRAY ADR                   58700021
         USING ARRAYUSE,RWORKE                                          58800021
         XC    W1(40),W1               CLEAR ARRAY                      58900021
         SR    RWORKC,RWORKC           CLEAR REG                        59000021
         LH    RWORKC,SENSE+2          LOAD BFR ADR                     59100021
         SRL   RWORKC,DIV256           DIVIDE BY 256                    59200021
         SR    RWORKF,RWORKF           CLEAR REG                        59300021
         M     RWORKF,THREE            MULTIPY BY 3                     59400021
         L     RWORKF,GTMBCTBL         LOAD ADR OF BCT                  59500021
         LTR   RWORKF,RWORKF           IS THERE A BFR CONTROL TBL       59600021
         BC    8,REQ500                BRANCH IF NO                     59700021
         AR    RWORKC,RWORKF           DETERMINE ADR OF BCT ENTRY       59800021
         LR    REG1,RWORKC             SAVE ADR                         59900021
         CLC   ZERO(1,REG1),ZERO1      IS AN ID ASSIGNED                60000021
         BE    REQ500                  BRANCH-NO ID                     60100021
         CLI   ZERO(REG1),IDVAL        IS A FULL SEGMENT ASSIGNED       60200021
         BC    4,REQ200                BRANCH IF YES                    60300021
         SR    RWORKC,RWORKC           CLEAR REG                        60400021
         SR    RWORKF,RWORKF           CLEAR REG                        60500021
         LH    RWORKC,SENSE+2          LOAD DIVIDEND                    60600021
         D     RWORKF,DIV256A          DIVIDE BY 256                    60700021
         CL    RWORKF,SUBSEG           UPPER OR LOWER HALF              60800021
         BC    4,REQ201                BRANCH LOWER SEGMENT             60900021
         CLI   ZERO+ONE(REG1),IDVAL    SUB SEG ASSIGNED                 61000021
         BE    REQ500                  BRANCH IF NO                     61100021
         MVC   IDBYTE(1),ONE(REG1)     SAVE ID                          61200021
         B     REQ202                  BRANCH                           61300021
REQ201   CLI   ZERO(REG1),IDVAL        SUB SEG ASSIGNED                 61400021
         BE    REQ500                  BRANCH IF NO                     61500021
REQ200   MVC   IDBYTE(1),ZERO(REG1)    SAVE ID                          61600021
REQ202   L     RGDSCB,GTMGDSCB         LOAD ADR OF FIRST GDSCB          61700021
REQ204   CLC   GDSBCTID(1),IDBYTE      GDS=MY ID                        61800021
         BE    REQ203                  BRANCH IF YES                    61900021
REQ205   EQU   *                                                        61950021
         CLC   GDSNXGDS(4),ZERO1       ANY MORE GDS                     62000021
         BE    REQ500                  BRANCH IF NO                     62100021
         L     RGDSCB,GDSNXGDS         LOAD ADR OF NEXT GDS             62200021
         B     REQ204                  BRANCH                           62300021
REQ203   EQU   *                                                        62310021
         TM    GDSFLAGS,EQUIV          IS THIS AN EQUIVALENT GDS        62320021
         BC    14,REQ206               BRANCH-NO                        62330021
         TM    GDSFLAGS,INBFR          GDS IN BFR                       62340021
         BO    REQ206                  BRANCH-YES                       62350021
         B     REQ205                  BRANCH                           62360021
REQ206   EQU   *                                                        62370021
         ST    RGDSCB,W1               GDS ADR TO WORD 1 ARRAY          62430021
         CLI   CNT(REG1),CNTA          COUNT FLD IN BCT =FF             62500021
         BNE   REQ400                  BRANCH IF NO                     62600021
         SR    RWORKC,RWORKC           CLEAR REG                        62700021
         SR    RWORKF,RWORKF           CLEAR REG                        62800021
         IC    RWORKC,PTR(REG1)        LOAD DIVIDEND                    62900021
         SLL   RWORKC,MUL256           MULTIPLY BY 256                  63000021
         SR    RWORKF,RWORKF           CLEAR REG                        63100021
         LH    RWORKF,SENSE+2          LOAD BFR ADR                     63200021
         SR    RWORKF,RWORKC           SUBTRACT RESULT FROM BFR ADR     63300021
         LA    RWORKC,TWO              LOAD CONSTANT                    63400021
         SR    RWORKF,RWORKC           DETERMINE LOGICAL DIFFERENCE     63500021
         ST    RWORKF,LOGDIF           SAVE VALUE                       63600021
         SR    RWORKF,RWORKF           CLEAR REG                        63700021
         IC    RWORKF,PTR(REG1)        LOAD PTR FROM BCT ENTRY          63800021
         MH    RWORKF,THREE+2          MULTIPLY BY THREE                63900021
         L     REG1,GTMBCTBL           LOAD BCT ADR                     64000021
         LA    REG1,ZERO(RWORKF,REG1)  HAVE BCT START ADR FOR THIS SEG  64100021
REQ402   SR    RWORKB,RWORKB           CLEAR REG                        64200021
         LH    RWORKB,GDSGDOAL         LOAD GDOA LENGTH                 64300021
         LA    RWORKC,GDOA             LOAD CONSTANT                    64400021
         SR    RWORKB,RWORKC           ADJUST GDOA LENGTH               64500021
         SR    RWORKC,RWORKC           CLEAR REG                        64600021
         IC    RWORKC,CNT(REG1)        INSERT COUNT                     64700021
         SR    RWORKF,RWORKF           CLEAR REG                        64800021
         MR    RWORKF,RWORKB           MULTIPY VALUES                   64900021
         A     RWORKC,LOGDIF           ADD LOGICAL DIFFERENCE           65000021
         ST    RWORKC,W3               STORE RESULT IN WORD 3 OF ARRAY  65100021
         ST    RWORKC,W3A              SAVE VALUE IN WORK AREA          65150021
         B     REQ401                  BRANCH                           65200021
REQ400   LR    RWORKC,REG1             ENTRY ADR TO WORK REG            65300021
         L     RWORKD,GTMBCTBL         LOAD ADR START OF BCT            65400021
         SR    RWORKC,RWORKD           DETERMINE PTR                    65500021
         SR    RWORKF,RWORKF           CLEAR REG                        65600021
         D     RWORKF,THREE            DIVIDE # BY 3                    65700021
         SLL   RWORKC,MUL256           MULTIPY RESULT BY 256            65800021
         SR    RWORKF,RWORKF           CLEAR REG                        65900021
         LH    RWORKF,SENSE+2          LOAD  BFR ADR                    66000021
         SR    RWORKF,RWORKC           SUBTRACT RESULT FROM BFR ADR     66100021
         LA    RWORKC,TWO              LOAD CONSTANT                    66200021
         SR    RWORKF,RWORKC           DETERMINE LOGICAL DIFFERENCE     66300021
         ST    RWORKF,LOGDIF           SAVE VALUE                       66400021
         B     REQ402                  BRANCH                           66500021
REQ401   TM    GDSFLAGS,LVL2           IS THIS A LEVEL 2 GDS            66600021
         BC    1,REQ500                BRANCH IF YES                    66700021
         CLC   GDSKEYTB(4),ZERO1       IS THERE A KEY TABLE             66800021
         BE    REQ500                  BRANCH IF NO                     66900021
REQ300   L     RKEY,GDSKEYTB           LOAD ADR OF FIRST KEY TABLE      67000021
REQ302   LA    RKEYEN,FIRSENT(RKEY)    LOAD ADR OF FIRST ENTRY          67100021
REQ304   CL    RKEYEN,NEXTENTY(RKEY)   IS SLOT BEING USED               67200021
         BNE   REQ301                  BRANCH IF SLOT BEING USED        67300021
         CLC   ZERO1(4),NEXTKEY(RKEY)  ANY MORE KEY TABLES              67400021
         BE    REQ500                  BRANCH IF NO MORE KEY TABLES     67500021
         L     RKEY,NEXTKEY(RKEY)      LOAD ADR OF NEXT KEY TABLE       67600021
         B     REQ302                  BRANCH                           67700021
REQ301   SR    RWORKC,RWORKC           CLEAR REG                        67800021
         LH    RWORKC,BFRLEN(RKEYEN)   LOAD BFR LENGTH                  67900021
         AH    RWORKC,LOGSTRT(RKEYEN)  ADD LOGICAL START                68000021
         CL    RWORKC,W3A              COMPARE VALUE TO GDS OFFSET VALU 68100021
         BC    2,REQ303                BRANCH IF WORD 3 VALUE LESS      68200021
         BE    REQ308                  BRANCH IF VALUES EQUAL           68250021
REQ305   LA    RKEYEN,ENTRYLEN(RKEYEN) LOAD ADR OF NEXT KEY ENTRY       68300021
         B     REQ304                  BRANCH                           68400021
REQ303   CLC   W3A+2(2),LOGSTRT(RKEYEN) COMPARE GDS OFFSET TO LOG START 68500021
         BC    4,REQ500                BRANCH IF WORD 3 LESS            68600021
         TM    BCTFLAG(RKEYEN),ORGEN   IS THIS AN ORGEN KEY             68630021
         BO    REQ307                  BRANCH-YES                       68660021
         TM    BCTFLAG(RKEYEN),BFRSUB  IS THIS A BFR SUBRTN KEY         68700021
         BC    1,REQ305                BRANCH IF BFR SURRTN KEY         68800021
         TM    BCTFLAG(RKEYEN),SEQNCE  IS THIS A SEQUENCE KEY           68900021
         BC    1,REQ306                BRANCH IF YES                    69000021
REQ307   EQU   *                                                        69050021
         MVC   W2(4),BFRLEN(RKEYEN)    KEY TO WORD 2 OF ARRAY           69100021
         MVC   W4(4),CORVAL(RKEYEN)    CORVAL TO WORD 4 OF ARRAY        69200021
         TM    SENSE+1,LPCHRMD         LP IN CHARACTER MODE             69205021
         BC    14,REQ309               BRANCH-NOT CHARACTER MODE        69210021
         LH    RWORKC,BFRLEN(RKEYEN)   LOAD BUFFER LENGTH               69215021
         AH    RWORKC,LOGSTRT(RKEYEN)  ADD LOGICAL START                69220021
         S     RWORKC,W3A              SUBTRACT GDS OFFSET              69225021
         STH   RWORKC,CCT              SAVE VALUE                       69230021
         SR    RWORKC,RWORKC           CLEAR REG                        69235021
         IC    RWORKC,CCTB(RKEYEN)     INSERT CHARACTER COUNT           69240021
         SLL   RWORKC,CCTC             SHIFT 1ST HALF OF COUNT          69245021
         IC    RWORKC,CCTA(RKEYEN)     INSERT CHARACTER COUNT           69250021
         SH    RWORKC,CCT              SUBTRACT SAVED VALUE             69255021
         LA    RWORKC,ADD1(RWORKC)     CHANGE OFFSET TO COUNT FOR ARRAY 69260021
         ST    RWORKC,W3               STORE RESULT IN ARRAY WORD 3     69265021
         B     REQ305                  BRANCH                           69270021
REQ309   EQU   *                                                        69275021
         L     RWORKC,W3A              LOAD GDS OFFSET VALUE            69280021
         SH    RWORKC,LOGSTRT(RKEYEN)  SUBTRACT LOGICAL START           69285021
         ST    RWORKC,W3               STORE VALUE IN WORD 3 OF ARRAY   69290021
         B     REQ305                  BRANCH                           69300021
REQ308   TM    BCTFLAG(RKEYEN),HIBIT   HIGH ORDER BIT ON                69310021
         BO    REQ305                  BRANCH-YES                       69320021
         TM    BCTFLAG(RKEYEN),TOBIT   LINK TO SUBR                     69330021
         BO    REQ307                  BRANCH-YES                       69340021
         B     REQ305                  BRANCH                           69350021
REQ306   MVC   W5(4),BFRLEN(RKEYEN)    KEY TO WORD5 OF ARRAY            69400021
         MVC   W7(4),CORVAL(RKEYEN)    CORVAL TO WORD 7 OF ARRAY        69500021
         L     RWORKC,W3A              LOAD GDS OFFSET VALUE            69600021
         SH    RWORKC,LOGSTRT(RKEYEN)  SUBTRACT LOGICAL START           69700021
         ST    RWORKC,W6               STORE VALUE IN WORD 6  OF ARRAY  69800021
         B     REQ305                  BRANCH                           69900021
REQ500   CLI   TYPE,LPC                LITE PEN ATN                     70000021
         BE    REQ501                  BRANCH IF YES                    70100021
         TM    ATTNFLGA,EOSXY          XY WANTED ON EOS                 70200021
         BC    1,REQ502                BRANCH IF YES                    70300021
         BR    RWORKA                  RETURN                           70400021
REQ502   CLC   XPOS(4),ZERO1           XY VALUE ZERO                    70500021
         BNE   REQ503                  BRANCH IF NO                     70600021
         BR    RWORKA                  RETURN                           70700021
REQ503   SR    RWORKC,RWORKC           CLEAR REG                        70800021
         SR    RWORKD,RWORKD           CLEAR REG                        70900021
         XC    GDSNAME(24),GDSNAME     CLEAR PARAM LIST                 71200021
         TM    SENSE+1,X'20'       CHECK IF CHAR ATTN            A37965 71202000
         BO    ADJUST              IF YES,ADJUST X,Y COORDS      A37965 71204000
         LH    RWORKC,XPOS         IF NO, SKIP ADJUST FIX        A37965 71206000
         LH    RWORKD,YPOS                                       A37965 71208000
         ST    RWORKC,XINPUT       USE DIRECT INPUT              A37965 71210000
         B     OLDCODE                                           A37965 71212000
* THE FOLLOWING CODE ADJUSTS THE COORDINATE VALUES RETURNED BY   A37965 71214000
* HARDWARE FOLLOWING A DETECT ON A CHARACTER TO THE CENTER OF    A37965 71216000
* CHARACTER DETECTED. HARDWARE RETURNS THE CENTER POINT OF THE   A37965 71218000
* NEXT CHARACTER GRID.                                           A37965 71220000
ADJUST   LH    RWORKC,XPOS         LOAD X FOR CHAR DETECT        A37965 71222000
         LA    RWORKD,BSCSPC       BASIC CHAR SPACING            A37965 71224000
         LA    RWORKB,BSCLINE      BASIC LINE SPACING            A37965 71226000
         TM    GDSCHARS,LRGSZE     CHECK GDS FOR LARGE CHARS     A37965 71228000
         BZ    ADJUSTX             BRANCH IF NOT LARGE CHARS     A37965 71230000
         LA    RWORKD,LRGSPC       LARGE CHAR SPACING            A37965 71232000
         LA    RWORKB,LRGLINE      LARGE LINE SPACING            A37965 71234000
ADJUSTX  EQU   *                                                 A37965 71236000
         SR    RWORKC,RWORKD       X MINUS CHAR SPACE            A37965 71238000
         BNM   XVALID              BRANCH IF X NOW VALID         A37965 71240000
         LA    RWORKC,XSCREEN      X=RIGHT LIMIT OF SCREEN       A37965 71242000
         TM    GDSSCISS,NOSCISS    CHECK GDS FOR NO SCISSORING   A37965 71244000
         BO    ADJUSTY             BRANCH IF NO SCISSORING       A37965 71246000
         SR    RWORKC,RWORKD       X=(MAX CHAR CENTER X)-SPACE   A37965 71248000
ADJUSTY  EQU   *                                                 A37965 71250000
         ST    RWORKC,XINPUT       X POS TO PARM LIST            A37965 71252000
         LH    RWORKD,YPOS         LOAD Y FOR CHAR DETECT        A37965 71254000
         AR    RWORKD,RWORKB       Y = Y+LINE SPACING            A37965 71256000
         LA    RWORKC,YSCREEN      MAX Y VALUE FOR CHAR CENTER   A37965 71258000
         CR    RWORKD,RWORKC       COMPARE Y TO SCREEN LIMIT     A37965 71260000
         BNH   YVALID              BRANCH IF Y NOW VALID         A37965 71262000
         LA    RWORKD,YLOWER       Y = MIN Y  VALUE FOR CHAR     A37965 71264000
         B     YVALID              GO SET UP FOR CONVERT RTN     A37965 71266000
XVALID   EQU   *                                                 A37965 71268000
         ST    RWORKC,XINPUT       X POS TO PARM LIST            A37965 71270000
         LH    RWORKD,YPOS         LOAD Y POS                    A37965 71272000
YVALID   EQU   *                                                 A37965 71274000
OLDCODE  ST    RWORKD,YINPUT       Y POS TO PARM LIST            A37965 71374000
         ST    RGDSCB,GDSNAME          ADR OF GDSCB TO PARM LIST        71500021
         LA    RWORKC,ONE              LOAD CONSTANT                    71600021
         ST    RWORKC,CONVERT          STORE IN PARM LIST               71700021
         LA    RWORKC,GDSNAME          LOAD PARM ADR                    71800021
         ST    RWORKC,P1               STORE IN PARM LIST               71900021
         LA    RWORKC,CONVERT          LOAD ADR                         72000021
         ST    RWORKC,P2               STORE IN PARM LIST               72100021
         LA    RWORKC,XINPUT           LOAD ADR                         72200021
         ST    RWORKC,P3               STORE IN PARM LIST               72300021
         LA    RWORKC,YINPUT           LOAD ADR                         72400021
         ST    RWORKC,P4               STORE IN PARM LIST               72500021
         LA    RWORKC,XOUTPUT          LOAD ADR                         72600021
         ST    RWORKC,P5               STORE IN PARM LIST               72700021
         LA    RWORKC,YOUTPUT          LOAD ADR                         72800021
         ST    RWORKC,P6               STORE IN PARM LIST               72900021
         MVI   P6,LAST                 INDICATE LAST PARM               73000021
         L     RWORKC,RCA              LOAD RTN CODE ARRAY ADR          73100021
         ST    RWORKC,RCAB             STORE IN PARM LIST               73200021
         LA    RWORKC,P1               LOAD ADR                         73300021
         ST    RWORKC,PASS             STORE IN PARM LIST               73400021
         LA    REG1,PASS               LOAD PLIST ADR                   73500021
         LR    RGDSCB,RWORKA           SAVE RETN REG                    73600021
         L     R15,ATTNBKPT        POINT TO PREV ATL OR GTM D11 ZA15437 73600803
         DROP  RATL                TEMPORARILY DROP RATL    D11 ZA15437 73601603
         USING ATTNLEVL,R15        ADDRESS ATTNLEVEL        D11 ZA15437 73602403
ATLAGN   CLC   ATTNLVID(2),GTMID   IS IT A GTMCB?           D11 ZA15437 73603203
         BE    GOTGTM              YES,CONTINUE CNVRT LOGIC D11 ZA15437 73604003
         L     R15,ATTNBKPT        LOAD A(ATL) OR A(GTM)    D11 ZA15437 73604803
         B     ATLAGN              TEST AGAIN               D11 ZA15437 73605603
GOTGTM   EQU   *                   GTM FOUND                D11 ZA15437 73606403
         USING GTMCB,R15           ADDRESS GTM              D11 ZA15437 73607203
         L     R15,GTMGSPCB        POINT TO GSPCB           D11 ZA15437 73608003
         USING GSPCB,R15           ADDR GSPCB               D11 ZA15437 73608803
         L     R15,GSPASTAT        POINT TO STATUS TABLE    D11 ZA15437 73610003
         DROP  R15                                          D11 ZA15437 73614003
         USING ATTNLEVL,RATL       RE-ADDRESS ATLVLCB       D11 ZA15437 73618003
         L     R15,CNVRT(R15)      AND TO CONVERT           D11 ZA15437 73620003
         LTR   R15,R15             CNVRT LOADED?            D11 ZA15437 73640003
         BZ    REQLINK1            NO,MUST USE SYSTEM LINK  D11 ZA15437 73660003
         BALR  R14,R15             GOTO CONVERT             D11 ZA15437 73680003
         B     REQRTN1             RETURN FROM CONVERT      D11 ZA15437 73690003
REQLINK1 LINK  EP=IFFAGA08,MF=(E,(1)) LINK TO CONVERT       D11 ZA15437 73700003
REQRTN1  MVC   W8(4),XOUTPUT       X POS TO WD 8 OF ARRAY   D11 ZA15437 73800021
         MVC   W9(4),YOUTPUT           Y POS TO WORD 9 OF ARRAY         73900021
         L     RWORKC,RCA              LOAD RTN CODE ARRAY ADR          74000021
         XC    ZERO(20,RWORKC),ZERO(RWORKC) INITIALIZE ARRAY            74100021
         BR    RGDSCB                  RETURN                           74200021
REQ501   TM    ATTNFLGA,LPCHAR         CHARACTER CODE WANTED            74300021
         BC    14,REQ504               BRANCH IF NO                     74400021
         MVC   W10(1),CHARACTR         CHARACTER TO WORD 10 OF ARRAY    74500021
REQ504   TM    ATTNFLGA,LPXY           XY POS WANTED                    74600021
         BC    1,REQ503                BRANCH IF YES                    74700021
         BR    RWORKA                  RETURN                           74800021
*********************************************************************** 74900021
*                  DIRECT ENTRY GOES HERE                             * 75000021
*                                                                     * 75100021
DIRECT   B     OUTRTN                                                   75200021
*                                                                     * 75300021
*                                                                     * 75400021
*********************************************************************** 75500021
IOTEST   CLI   DECB,IOK                I/O SUCCESSFULL CODE             75510021
         BCR   8,REG1                  BRANCH IF OK                     75520021
         L     RWORKA,RCA              LOAD RTN CODE ARRAY ADR          75530021
         OI    ZERO(RWORKA),RCC5       INDICATE I/O ERROR               75540021
         B     OUTRTN                  RETURN TO CALLER                 75550021
         DS    0F                                                       75600021
ZERO1    DC    1F'0'                   ZERO                             75700021
MIN1     DC    F'-1'                                               RSTH 75750021
PRIME    DC    X'80'                   PF PRIME BIT                     75800021
         DC    AL3(0)                                                   75900021
GTMID    DC    X'F202'             IDENTIFIER FOR GTM       D11 ZA15437 75950003
ANSIZE   DC    A(31)                   MAX PF SIZE                      76000021
MAX      DC    A(36)                   MAX ALLOWABLE SOURCE VALUE       76100021
END      DC    A(32)                   END                              76200021
LPD      DC    A(34)                   LP                               76300021
EOSD     DC    A(35)                   EOS                              76400021
CANCELD  DC    A(33)                   CANCEL                           76500021
AED      DC    A(36)                   AE                               76600021
SCANTWO  DC    A(2)                    SCAN VALUE OF TWO                76700021
THREE    DC    A(3)                    3                                76800021
DIV256A  DC    A(256)                  256                              76900021
SUBSEG   DC    A(128)                  SUB SEGMENT SPLIT POINT          77000021
PATCH    DC    64X'FF'             PATCH AREA               D11         77050003
         CNOP  0,8                                                      77100021
         COPY  ATTNLEVL                                                 77200021
         COPY  GDSCB                                                    77300021
         COPY  GTMCB                                                    77400021
         COPY  GSPCB                                                    77500021
PLIST    DSECT                                                          77600021
ATNLVL   DS    1F                      ATTN LEVEL                       77700021
CODELOC  DS    1F                      CODE LOC                         77800021
SCANWAIT DS    1F                      SCAN WAIT                        77900021
ARRAY    DS    1F                      ARRAY                            78000021
ATNSRCE  DS    1F                      1ST ATTN SOURCE                  78100021
WORKAREA DSECT                                                          78200021
PARAM    DS    1F                      USER PARAM LIST ADR              78300021
RCA      DS    1F                      RETURN CODE ARRAY ADR            78400021
SAVE     DS    18F                     SAVE AREA                        78500021
DECB     DS    8F                      I/O AREA DECB                    78600021
DATA     DS    1F                      I/O DATA AREA                    78700021
GACB     DS    1F                      *                                78800021
TYPEA    DS    BL1                     *                                78900021
OPT      DS    BL1                     ATTNINQ  MACRO AREA              79000021
TYP      DS    1H                      *                                79100021
BRANCH   DS    1F                      *                                79200021
ANMASK   DS    1F                      SAVE AREA FOR ANMASK             79300021
PFMASK   DS    1F                      SAVE AREA FOR PFMASK             79400021
RSVD     DS    BL1                     RSVD                             79500021
OVERLAY  DS    BL1                     OVERLAY CODE                     79600021
KEYNO    DS    BL1                     KEY NUMBER                       79700021
TYPE     DS    BL1                     ATTN TYPE                        79800021
SENSE    DS    1F                      SENSE / MI DATA                  79900021
XPOS     DS    1H                      X POS VALUE                      80000021
YPOS     DS    1H                      Y POS VALUE                      80100021
SAVE1    DS    1F                      GACB A/N MASK SAVE AREA          80200021
SAVE2    DS    1F                      GACB P/F MASK SAVE AREA          80300021
IDBYTE   DS    BL1                     GDS ID BYTE                      80400021
CHARACTR DS    BL1                     CHARACTER BYTE                   80500021
         DS    BL1                                                      80600021
         DS    BL1                                                      80700021
LOGDIF   DS    1F                      LOGICAL DIFFERENCE               80800021
GDSNAME  DS    1F                                                       80900021
CONVERT  DS    1F                                                       81000021
XINPUT   DS    1F                                                       81100021
YINPUT   DS    1F                                                       81200021
XOUTPUT  DS    1F                                                       81300021
YOUTPUT  DS    1F                                                       81400021
P1       DS    1F                                                       81500021
P2       DS    1F                                                       81600021
P3       DS    1F                                                       81700021
P4       DS    1F                                                       81800021
P5       DS    1F                                                       81900021
P6       DS    1F                                                       82000021
         ORG   WORKAREA+216            ALIGN TO A DOUBLE WORD BOUNDRY   82100021
PASS     DS    1F                                                       82200021
RCAB     DS    1F                                                       82300021
W3A      DS    1F                                                       82330021
CCT      DS    1H                                                       82360021
         DS    0F                                                  000A 82370021
LFORM    DS    16F                                                 000A 82380021
ARRAYUSE DSECT                                                          82400021
W1       DS    1F                                                       82500021
W2       DS    1F                                                       82600021
W3       DS    1F                                                       82700021
W4       DS    1F                                                       82800021
W5       DS    1F                                                       82900021
W6       DS    1F                                                       83000021
W7       DS    1F                                                       83100021
W8       DS    1F                                                       83200021
W9       DS    1F                                                       83300021
W10      DS    1F                                                       83400021
         END                                                            83500021
./  ADD  SSI=20480182,NAME=IFFACA13
* TITLE:SALRM-SOUND AUDIBLE ALARM                                       01000021
* STATUS:CHANGE LEVEL 0                                                 02000021
* FUNCTION:TO SOUND THE AUDIBLE ALARM ON A GRAPHIC TERMINAL.            03000021
* INPUT:GR#1CONTAINS THE ADDRESS OF A WORK/SAVE AREA,THE FIRST WORD     04000021
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 05000021
*       1.DEVICENAME-ADDRESS OF A VARIABLE WHICH CONTAINS THE ADDRESS   06000021
*         OF THE GTMCB.                                                 07000021
* OUTPUT:AUDIBLE ALARM SOUNDED ON TERMINAL                              08000021
* EXIT:RETURN TO CALLER VIA REGISTER 14                                 09000021
* ENTRY:ENTERED AT INFFACA13 VIA A CALL TO SALR.                        10000021
* RETURN CODES:4,1 INVALID GTMCB                                        11000021
*              0,0 SUCCESSFULL                                          12000021
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE                            13000021
* EXTERNAL ROUTINES:GIOCR                                               14000021
* NOTES:THIS ROUTINE EXAMINES THE FOLLOWING CONTROL BLOCKS:             15000021
*       1.GTMCB                                                         16000021
R0       EQU   0                       PARM REG 0                       17000021
R1       EQU   1                       PARM REG 1                       18000021
RLIST    EQU   2                       INPUT WORK/SAVE AREA             19000021
RPARM    EQU   3                       USER PARM LIST                   20000021
RGTMCB   EQU   4                       GTMCB ADR REG                    21000021
RA       EQU   5                       WORK REG                         22000021
RB       EQU   6                       WORK REG                         23000021
RC       EQU   7                       WORK REG                         24000021
RBASE    EQU   9                       BASE REG                         25000021
RD       EQU   10                      WORK REG                         26000021
RSAVE    EQU   13                      SAVE REG                         27000021
ZERO     EQU   0                       ZERO                             28000021
GID      EQU   X'02'                   GTMCB ID                         29000021
ADD1     EQU   1                       ADD INFO                         30000021
OFFSAVE  EQU   8                       SAVE AREA CHAIN                  31000021
RC4      EQU   X'08'                   RTN CODE 4                       32000021
RCC4     EQU   16                      OFFSET TO ADD INFO               33000021
RC5      EQU   X'04'                   I/O ERROR                        33300021
IOK      EQU   X'7F'                   I/O SUCCESSFULL CODE             33600021
IFFACA13 CSECT                                                          34000021
         SAVE  (14,12)                 SAVE REGS                        35000021
         BALR  RBASE,0                 SET UP BASE REG                  36000021
         USING *,RBASE                 DEFINE BASE REG                  37000021
         LR    RLIST,R1                LOAD REG                         38000021
         USING WORKAREA,RLIST          DEFINE DSECT                     39000021
         L     RPARM,PLIST             LOAD ADR OF USER PARM LIST       40000021
         USING PARAM,RPARM             DEFINE DSECT                     41000021
         L     RA,RCA                  LOAD ADR RTN CODE ARRAY          42000021
         XC    ZERO(20,RA),ZERO(RA)    INITIALIZE ARRAY                 43000021
         L     RGTMCB,DEVICE           LOAD GTMCB INDIRECT PTR          44000021
         LA    RGTMCB,ZERO(RGTMCB)     ZERO HI ORDER BYTE               45000021
         L     RGTMCB,ZERO(RGTMCB)     LOAD GTMCB ADR                   46000021
         USING GTMCB,RGTMCB            DEFINE DSECT                     47000021
         CLI   GTMTERID,GID            VALID GTMCB                      48000021
         BE    SA01                    BRANCH IF VALID                  49000021
         B     ERROR                   BRANCH                           50000021
SA01     CL    RGTMCB,GTMGTMCB         GTMCB INITIALIZED                51000021
         BE    SA02                    BRANCH IF INITIALIZED            52000021
ERROR    L     RA,RCA                  LOAD RTN CODE ARRAY ADR          53000021
         MVI   ZERO(RA),RC4            RTN CODE 4 TO ARRAY              54000021
         LA    RB,ADD1                 LOAD ADD INFO                    55000021
         ST    RB,RCC4(RA)             STORE ADD INFO                   56000021
OUTRTN   RETURN (14,12),T              RETURN                           57000021
SA02     ST    RSAVE,SAVE+4            SAVE-SAVE AREA PTR               58000021
         LA    RD,SAVE                 LOAD ADR OF MY SAVE AREA         59000021
         ST    RD,OFFSAVE(RSAVE)       STORE IN USER SAVE AREA          60000021
         LA    RSAVE,SAVE              ESTABLISH NEW SAVE AREA          61000021
         XC    DECB(32),DECB           CLEAR I10 AREA                   62000021
         LA    R1,DECB                 LOAD ADR I10 AREA                63000021
         L     RC,GTMGRDCB             LOAD DCB ADR                     64000021
         GCNTRL (1),ALM,(7),MF=E       SOUND ALARM                      65000021
         WAIT  ECB=(1)                 WAIT FOR COMPLETION              66000021
         L     RSAVE,SAVE+4            RESTORE OLD SAVE AREA PTR        67000021
         CLI   DECB,IOK                I/O SUCCESSFULL                  67200021
         BE    OUTRTN                  BRANCH IF I/O OK                 67400021
         L     RA,RCA                  LOAD RTN CODE ARRAY ADR          67600021
         OI    ZERO(RA),RC5            INDICATE I/O ERROR               67800021
         B     OUTRTN                  BRANCH                           68000021
         CNOP  0,8                                                      69000021
PARAM    DSECT                                                          70000021
DEVICE   DS    1F                                                       71000021
WORKAREA DSECT                                                          72000021
PLIST    DS    1F                                                       73000021
RCA      DS    1F                                                       74000021
SAVE     DS    18F                                                      75000021
DECB     DS    8F                                                       76000021
         COPY  GTMCB                                                    77000021
         END                                                            78000021
./  ADD  SSI=20480183,NAME=IFFACA50
*****************************     STATUS TABLE   ********************** 00400016
*  ROUTINE     TABLE              NUMBER                                00800016
*              DISPLACEMENT       ASSIGNED                              01200016
*  INDEV       0                  1                                     01600016
*  TMDEV       12                 2                                     02000016
*  INGDS       24                 3                                     02400016
*  TMGDS       36                 4                                     02800016
*  CRATL       48                 5                                     03200016
*  ENATL       60                 6                                     03600016
*  ENATN       72                 7                                     04000016
*  DSATN       84                 8                                     04400016
*  MPATL       96                 9                                     04800016
*  MLPEO       108                10                                    05200016
*  SLPAT       120                11                                    05600016
*  MLITS       132                12                                    06000016
*  RQATN       144                13                                    06400016
*  EURATL      156                14                                    06800016
*  SETATN      168                15                                    07200016
*  SALRM       180                16                                    07600016
*  GSPRD       192                17                                    08000016
*  RCURS       204                18                                    08400016
*  ICURS       216                19                                    08800016
*  SDATM       228                20                                    09200016
*  SGRAM       240                21                                    09600016
*  SDATL       252                22                                    10000016
*  SGDSL       264                23                                    10400016
*  SSCIS       276                24                                    10800016
*  SCHAM       288                25                                    11200016
*  PLINE       300                26                                    11600016
*  PPNT        312                27                                    12000016
*  PSGMT       324                28                                    12400016
*  PTEXT       336                29                                    12800016
*  STPOS       348                30                                    13200016
*  MVPOS       360                31                                    13600016
*  BGSEQ       372                32                                    14000016
*  BGSUB       384                33                                    14400016
*  ENSEQ       396                34                                    14800016
*  ENSUB       408                35                                    15200016
*  LKSUB       420                36                                    15600016
*  INCL        432                37                                    16000016
*  OMIT        444                38                                    16400016
*  EXEC        456                39                                    16800016
*  RESET       468                40                                    17200016
*  IDPOS       480                41                                    17600016
*  FSMOD       492                42                                    18000016
*  STEOS       504                43                                    18400016
*  ORGDS       516                44                                    18800016
*  LOCPN       528                45                                    19200016
*  BGTRK       540                46                                    19600016
*  RDTRK       552                47                                    20000016
*  ENTRK       564                48                                    20400016
*  DFSTR       576                49                                    20800016
*  PLSTR       588                50                                    21200016
*  ORGEN       600                51                                    21600016
*  CNVRT       612                52                                    22000016
*  ITRC        624                53                                    22400016
*  ITBP        636                54                                    22800016
*  RTBP        648                55                                    23200016
*  ITST        660                56                                    23600016
*  SPEC        672                57                                    24000016
*                                                                       24400016
*                                                                       24800016
*  0   ADDRESS IF ALREADY LOADED                                        25200016
*                                                                       25600016
*  4   LAST 4 BYTES OF NAME                                             26000016
*                                                                       26400016
*  8   X'01'-LINK   X'02'-LOAD                                          26800016
*                                                                       27200016
*  9-11 RSVD                                                            27600016
*                                                                       28000016
*                                                                       28400016
R0       EQU   0                       PARAM REG 0                      28800016
R1       EQU   1                       PARAM REG 1                      29200016
RLIST    EQU   2                       WORK AREA ADR REG                29600016
RPARM    EQU   3                       PARAM LIST ADR REG               30000016
RGSPCB   EQU   4                       GSPCB ADR REG                    30400016
RSTAT    EQU   5                       STATUS TABLE ADR REG             30800016
RPREV    EQU   6                       PREVIOUS ARG REG                 31200016
RINDX    EQU   6                       INDEX REG                        31600016
RPRES    EQU   7                       PRES ARG REG                     32000016
RTAB     EQU   7                       TABLE ADR REG                    32400016
RNO      EQU   8                       ROUTINE NUMBER REG               32800016
RMUL     EQU   8                       MULTIPLY REG                     33200016
RBASE    EQU   9                       BASE REG                         33600016
RCODE    EQU   10                      CODE REG                         34000016
RB       EQU   11                      WORK REG                         34400016
RC       EQU   12                      WORK REG                         34800016
RSAVE    EQU   13                      SAVE AREA REG                    35200016
RD       EQU   14                      WORK REG                         35600016
RA       EQU   15                      WORK REG                         36000016
LINKIT   EQU   X'01'                   LINK FLAG                        36400016
LOADIT   EQU   X'02'                   LOAD FLAG                        36800016
ADDR     EQU   0                       ROUTINE ADR                      37200016
NAME     EQU   4                       ROUTINE NAME                     37600016
FLAG     EQU   8                       ROUTINE FLAG                     38000016
NEXT     EQU   4                       NEXT ENTRY                       38400016
ZERO     EQU   0                       ZERO                             38800016
LAST     EQU   X'80'                   LAST ARGUMENT                    39200016
RCC4     EQU   X'08'                   RTN CODE 4                       39600016
RC4      EQU   16                      OFFSET TO RC4 ADD INFO           40000016
ADD1     EQU   1                       ADD INFO 1                       40400016
ADD2     EQU   2                       ADD INFO 2                       40800016
ADD3     EQU   3                       ADD INFO 3                       41200016
BACK     EQU   8                       BACK CHAIN                       41600016
GID      EQU   X'01'                   GSPCB ID                         42000016
ONEA     EQU   X'01'                   FLAG                             42400016
NEG      EQU   X'80'                   SIGN BIT                         42800016
IFFACA50 CSECT                                                          43200016
*0831,816000-820000,832000-856000,868000-908000                    000A 43400018
         SAVE  (14,12)                 SAVE REGS                        43600016
         BALR  RBASE,0                 SET UP BASE REG                  44000016
         USING *,RBASE                 DEFINE BASE REG                  44400016
         LR    RLIST,R1                LOAD WORKAREA ADR                44800016
         USING WORKAREA,RLIST                                           45200016
         L     RPARM,PLIST             LOAD ADR OF USER PARM LIST       45600016
         USING PARM,RPARM                                               46000016
         ST    RSAVE,SAVE+4            SAVE-SAVE AREA PTR               46400016
         LA    R1,SAVE                 LOAD ADR OF MY SAVE AREA         46800016
         ST    R1,BACK(RSAVE)          BACK CHAIN SAVE AREAS            47200016
         LR    RSAVE,R1                ESTABLISH NEW SAVE AREA          47600016
         L     RA,RCA                  LOAD RTN CODE ARRAY ADR          48000016
         XC    ZERO(20,RA),ZERO(RA)    ZERO ARRAY                       48400016
         XC    RTNS(56),RTNS           INITIALIZE                       48800016
         B     AROUND                  BRANCH                           49200016
ERROR    L     RA,RCA                  LOAD RTN CODE ARRAY ADR          49600016
         STC   RB,ZERO(RA)             STORE TRN CODE                   50000016
         ST    RC,ZERO(RD,RA)          STORE ADD INFO                   50400016
OUTRTN   L     RSAVE,SAVE+4            RESTORE OLD SAVE AREA            50800016
         RETURN (14,12),T              RETURN TO CALLER                 51200016
AROUND   TM    GSPN,LAST               LAST PARM                        51600016
         BC    14,SET03                BRANCH NO                        52000016
SET01    SR    RC,RC                   ZERO RC4 ADD INFO                52400016
SET02    LA    RB,RCC4                 LOAD RTN CODE                    52800016
         LA    RD,RC4                  LOAD OFFSET TO ADD INFO          53200016
         B     ERROR                   BRANCH                           53600016
SET03    L     RGSPCB,GSPN             LOAD INDIRECT PTR TO GSPCB       54000016
         L     RGSPCB,ZERO(RGSPCB)     LOAD GSPCB ADR                   54400016
         USING GSPCB,RGSPCB                                             54800016
         CLI   GSPCBID,GID             IS THIS A GSPCB                  55200016
         BE    SET04                   BRANCH-YES                       55600016
         LA    RC,ADD1                 LOAD ADD INFO                    56000016
         B     SET02                   BRANCH                           56400016
SET04    L     RSTAT,GSPASTAT          LOAD STATUS TABLE ADDR           56800016
         TM    CODE,LAST               LAST PARAM                       57200016
         BO    SET01                   BRANCH-YES                       57600016
         L     RCODE,CODE              LOAD INDIRECT PTR TO CODE        58000016
         L     RCODE,ZERO(RCODE)       LOAD VALUE OF CODE               58400016
         C     RCODE,ONE               CODE=ONE                         58800016
         BE    SET05                   BRANCH-YES                       59200016
         C     RCODE,TWO               CODE=TWO                         59600016
         BE    SET05                   BRANCH-YES                       60000016
         LA    RC,ADD2                 LOAD ADD INFO                    60400016
         B     SET02                   BRANCH                           60800016
SET05    LA    RC,ADD3                 INITIALIZE ADD INFO              61200016
         LA    RB,ONE                  INDICATE FIRST ARG               61600016
         LA    RNO,RTNO                INITIALIZE REG                   62000016
         LA    RA,RTNS                 INITIALIZE                       62400016
SET06    L     RPRES,ZERO(RNO)         LOAD INDIRECT PTR                62800016
         L     RPRES,ZERO(RPRES)       LOAD ARG                         63200016
         LTR   RPRES,RPRES             ARG ZERO OR NEGATIVE             63600016
         BZ    SET02                   BRANCH-ZERO                      64000016
         BM    SETNEG                  BRANCH-MINUS                     64400016
SET11    C     RPRES,MAX               NUMBER GREATER THAN 56           64800016
         BH    SET02                   BRANCH-YES                       65200016
         S     RPRES,ONE               DECREMENT BY ONE                 65600016
SET09    LA    RD,ONEA                 LOAD FLAG                        66000016
         STC   RD,ZERO(RPRES,RA)       SET APPROPRIATE ROUTINE FLAG     66400016
         L     RD,ZERO(RNO)            LOAD PTR TO NUMBER               66800016
         TM    ZERO(RD),NEG            NUMBER NEGATIVE                  67200016
         BO    SETNEGA                 BRANCH ON NEGATIVE NUMBER        67600016
SET08    TM    ZERO(RNO),LAST          ANY MORE ARGS                    68000016
         BO    SET07                   BRANCH-NO MORE ARGS              68400016
         L     RPREV,ZERO(RD)          SAVE VALUE                       68800016
         SR    RB,RB                   INDICATE WDT 1ST PASS            69200016
         LA    RC,ADD1(RC)             SETP ADD INFO                    69600016
         LA    RNO,NEXT(RNO)           SETP TO NEXT ARG                 70000016
         B     SET06                   BRANCH TO NEXT LOOP              70400016
SETNEGA  S     RPRES,ONE               DECREMENT NUMBER                 70800016
         CR    RPREV,RPRES             VALUE=PREVIOUS ARG               71200016
         BH    SET08                   BRANCH-YES                       71600016
         B     SET09                   BRANCH                           72000016
SETNEG   LTR   RB,RB                   1ST ARG                          72400016
         BZ    SET10                   BRANCH-NO                        72800016
         B     SET02                   BRANCH                           73200016
SET10    LTR   RPREV,RPREV             PREVIOUS ARG NEGATIVE            73600016
         BM    SET02                   BRANCH-YES                       74000016
         LPR   RPRES,RPRES             MAKE ARG POSITIVE                74400016
         CR    RPRES,RPREV             VALUE GREATER THAN PREVIOUS ARG  74800016
         BH    SET11                   BRANCH-YES                       75200016
         B     SET02                   BRANCH                           75600016
SET07    SR    RINDX,RINDX             INITIALIZE REG                   76000016
         LA    RTAB,RTNS               INITIALIZE TABLE REG             76400016
SET13    SR    RB,RB                   ZERO REG                         76800016
         IC    RB,ZERO(RTAB,RINDX)     LOAD FLAG                        77200016
         LTR   RB,RB                   FALG=0                           77600016
         BC    7,SET12                 BRANCH-FLAG NOT ZERO             78000016
SET14    LA    RINDX,ADD1(RINDX)       INCREMENT INDEX                  78400016
         C     RINDX,MAX               END OF TABLE                     78800016
         BE    OUTRTN                  BRANCH-END                       79200016
         B     SET13                   CONTINUE LOOP                    79600016
SET12    LR    RMUL,RINDX              PRIME MULTIPLY REG               80000016
         MH    RMUL,TWELVE+2           DETERMINE STAT TABLE OFFSET      80400016
         C     RCODE,TWO               CODE=TWO                         80800016
         BE    SET15                   BRANCH=TWO                       81200016
         AR    RMUL,RSTAT          ADDR OF ENTRY                   000A 81500018
         OI    FLAG(RMUL),ADD2     SET LOAD FLAG                   000A 81800018
         NI    FLAG(RMUL),X'FF'-ADD1 TURN OFF LINK FLAG            000A 82100018
         B     SET14                   BRANCH TO TEST END OF LOOP       82400016
SET15    SR    RB,RB                   CLEAR REG                        82800016
         AR    RMUL,RSTAT          ADDR OF ENTRY                   000A 83200018
         TM    FLAG(RMUL),ADD2     LOAD FLAG                       000A 83600018
         BO    SET16               BRANCH LOAD FLAG                000A 84000018
SET18    OI    FLAG(RMUL),ADD1     SET LINK FLAG                   000A 84400018
         NI    FLAG(RMUL),X'FF'-ADD2 TURN OFF LOAD FLAG            000A 84800018
         B     SET14                                               000A 85200018
SET16    L     RB,ADDR(RMUL)       LOAD ADDR FIELD OF STATUS TABLE 000A 85600018
         LTR   RB,RB                   ADR FLD 0                        86000016
         BZ    SET18                   BRANCH-ZERO                      86400016
         TM    FLAG(RMUL),X'04'    MULTIPLE ENTRY                  000A 86600018
         BZ    SET165              NO                              000A 86800018
         SR    RB,RB               ZERO REG                        000A 87000018
         IC    RB,FLAG+1(RMUL)  PICK UP ENTRY NO OF OTHER ENTRY PT 000A 87200018
         MH    RB,TWELVE+2         COMPUTE DISPLACEMENT            000A 87400018
         AR    RB,RSTAT                                            000A 87600018
         TM    FLAG(RB),ADD2       LOAD                            000A 87800018
         BO    SET18               YES-DO NOT DELETE MODULE        000A 88000018
         XC    ADDR(4,RB),ADDR(RB) ZERO ADDR                       000A 88200018
         TM    FLAG(RB),X'08'      THIS ONE LOADED                 000A 88400018
         BZ    SET165              NO                              000A 88600018
         XI    FLAG(RB),X'08'      TURN OFF FLAG                   000A 88800018
         L     R0,NAME(RB)         PICK UP NAME                    000A 89000018
         B     SET166                                              000A 89200018
SET165   XI    FLAG(RMUL),X'08'    TURN OFF FLAG                   000A 89400018
         L     R0,NAME(RMUL)       PICK UP NAME                    000A 89600018
SET166   XC    ADDR(4,RMUL),ADDR(RMUL) ZERO ADDR FIELD             000A 89800018
         ST    R0,DEL+4            STORE NAME                      000A 90000018
         MVC   DEL(4),PRIME        MOVE IN PREFIX                  000A 90200018
         LA    R0,DEL                                              000A 90400018
         DELETE EPLOC=(0)          DELETE                          000A 90600018
         B     SET18                                               000A 90800018
         DS    0F                                                       91200016
ONE      DC    A(1)                                                     91600016
TWO      DC    A(2)                                                     92000016
MAX      DC    A(56)                                                    92400016
TWELVE   DC    A(12)                                                    92800016
BYPASS   DC    A(156)                                                   93200016
PRIME    DC    CL4'IFFA'                                                93600016
         CNOP  0,8                                                      94000016
PARM     DSECT                                                          94400016
GSPN     DS    1F                                                       94800016
CODE     DS    1F                                                       95200016
RTNO     DS    1F                                                       95600016
         COPY  GSPCB                                                    96000016
WORKAREA DSECT                                                          96400016
PLIST    DS    1F                                                       96800016
RCA      DS    1F                                                       97200016
SAVE     DS    18F                                                      97600016
RTNS     DS    56X                                                      98000016
DEL      DS    2F                                                       98400016
         END                                                            98800016
./  ADD  SSI=20480184,NAME=IFFADA01
         TITLE 'GSPRD-IFFADA01-READ THE GRAPHIC BUF'                    00080021
*                                                                  6803 00180021
*                                                                  6803 00280021
*                                                                  6803 00380021
*        GSPRD IS ENTERED FROM DIRECTOR PART II WITH THE ADDRESS OF6803 00480021
*        THE WORK AREA IN REGISTER 1. THE FIRST WORD OF THE WORK   6803 00580021
*        AREA CONTAINS THE ADDRESS OF THE PARAMETER LIST LISTED    6803 00680021
*        BELOW:                                                    6803 00780021
*        +0    A(GDSNAME)                                          6803 00880021
*        +4    A(STORAGELOC)                                       6803 00980021
*        +8    A(COUNT)                                            6803 01080021
*        +12   A(RDTYP)                                            6803 01180021
*                                                                  6803 01280021
*        THE FOLLOWING ARE OPTIONAL PARAMETERS.                    6803 01380021
*                                                                  6803 01480021
*        +16   A(TERMCODE)                                         6803 01580021
*        +20   A(CORRVAL1)                                         6803 01680021
*        +24   A(KEY1)                                             6803 01780021
*        +28   A(CORRVAL2)                                         6803 01880021
*        +32   A(KEY2)                                             6803 01980021
*                                                                  6803 02080021
*        EXTERNAL REFERENCES ARE MADE TO:                          6803 02180021
*        GIOCR                                                     6803 02280021
*        KEY TABLE MANAGEMENT-IFFAHA03                             6803 02380021
*                                                                  6803 02480021
*        EXTERNAL MACROS USED ARE:                                 6803 02580021
*        GREAD                                                     6803 02680021
*        GCNTRL                                                    6803 02780021
*        WAIT                                                      6803 02880021
*                                                                  6803 02980021
*        ATTRIBUTES:                                               6803 03080021
*        REENTERANT                                                6803 03180021
*        PROBLEM PROGRAM MODE                                      6803 03280021
*                                                                  6803 03380021
*                                                                  6803 03480021
*                                                                  6803 03580021
         EJECT                                                     6803 03680021
*                                                                  6803 03780021
*        ON ENTRY THE REGISTERS ARE SAVED,THE BASE REGISTER IS     6803 03880021
*        INITIALIZED,THE WORK AREA DSECT IS SET UP,THE RETURN      6803 03980021
*        ARRAY IS INITIALIZED,AND THE GDSCB AND GTMCB DSECTS ARE   6803 04080021
*        INITIALIZED.                                              6803 04180021
*                                                                  6803 04280021
IFFADA01 CSECT                                                     6803 04380021
*                                                                A28421 04480021
         SAVE  (14,12)                                             6803 04580021
         BALR  BASE,0              ESTABLISH ADDRESSABILITY        6803 04680021
         USING *,BASE                                              6803 04780021
         LR    WORK,PARM           WORK AREA                       6803 04880021
         USING WORKAREA,WORK                                       6803 04980021
         ST    SAVE,WRKSAVE+4                                      6803 05080021
         LA    REGA,WRKSAVE        CHAIN SAVE AREAS                6803 05180021
         ST    REGA,8(SAVE)                                        6803 05280021
         LR    SAVE,REGA                                           6803 05380021
         MVC   WRKINCR,TWO                                         6803 05480021
         L     ERRCD,WRKRTNCD                                      6803 05580021
         XC    0(20,ERRCD),0(ERRCD) ZERO RETURN ARRAY              6803 05680021
         L     PARM,WRKPARM        PARM LIST                       6803 05780021
         L     GDSREG,0(PARM)                                      6803 05880021
         L     GDSREG,0(GDSREG)    GDS ADDR INTO REG               6803 05980021
         USING GDSCB,GDSREG                                        6803 06080021
         C     GDSREG,GDSGDSCB     GDS VALID                       6803 06180021
         BNE   ERR1                NO                              6803 06280021
         L     GTMREG,GDSGTMCB     SET UP ADDRESSABILITY OF GTMCB  6803 06380021
         USING GTMCB,GTMREG                                        6803 06480021
         EJECT                                                     6803 06580021
*                                                                  6803 06680021
*        THE REQUIRED PARAMETERS ARE CHECKED FOR VALIDITY AND SAVED6803 06780021
*        A WORK AREA TO HOLD THE OPTIONAL PARAMETERS IS SET TO     6803 06880021
*        ZERO AND A CHECK IS MADE TO SEE WHICH OPTIONAL PARAMETERS 6803 06980021
*        IF ANY ARE PRESENT. THOSE PRESENT ARE PLACED IN THE WORK  6803 07080021
*        AREA.                                                     6803 07180021
*                                                                  6803 07280021
         TM    0(PARM),LAST        MORE PARMS                      6803 07380021
         BO    ERR1                NO ERROR                        6803 07480021
         L     REGA,STORLOC(PARM)  LOCATION FOR DATA               6803 07580021
         ST    REGA,WRKSTRG        SAVE START                      6803 07680021
         TM    STORLOC(PARM),LAST  LAST                            6803 07780021
         BO    ERR1                ERROR                           6803 07880021
         L     REGB,COUNT(PARM)    LOAD COUNT                      6803 07980021
         L     REGB,0(REGB)                                        6803 08080021
         LTR   REGB,REGB     IS COUNT ZERO                       A28421 08110021
         BZ    ERR1             IF YES, READ NOT POSSIBLE        A28421 08140021
         ST    REGB,WRKCNT         SAVE                            6803 08180021
         TM    COUNT(PARM),LAST    LAST                            6803 08280021
         BO    ERR1                ERROR                           6803 08380021
         XC    WRKSW,WRKSW         ZERO SWITCH                     6803 08480021
         XC    WRKTRMCD(20),WRKTRMCD ZERO OPT PARMS                6803 08580021
         L     REGC,RDTYP(PARM)                                    6803 08680021
         L     REGC,0(REGC)        LOAD RD TYPE                    6803 08780021
         C     REGC,F1             VALID READ TYPE                 6803 08880021
         BE    GRD00100            YES                             6803 08980021
         C     REGC,TWO                                            6803 09080021
         BNE   ERR2                NO                              6803 09180021
GRD00100 ST    REGC,WRKRDTYP       SAVE READ TYPE                  6803 09280021
         TM    RDTYP(PARM),LAST                                    6803 09380021
         BO    GRD00600                                            6803 09480021
         EJECT                                                     6803 09580021
*                                                                  6803 09680021
*        TEST AND SAVE OPTIONAL PARMS                              6803 09780021
*                                                                  6803 09880021
         CLC   TMCD+1(3,PARM),NULL+1(ERRCD) NULL                   6803 09980021
         BE    GRD00200                                            6803 10080021
         MVC   WRKTRMCD(4),TMCD(PARM) SAVE MDDR                    6803 10180021
GRD00200 TM    TMCD(PARM),LAST     LAST                            6803 10280021
         BO    GRD00600                                            6803 10380021
         CLC   C1+1(3,PARM),NULL+1(ERRCD) NULL                     6803 10480021
         BE    GRD00300                                            6803 10580021
         MVC   WRKC1,C1(PARM)      SAVE CORVAL                     6803 10680021
GRD00300 TM    C1(PARM),LAST       LAST                            6803 10780021
         BO    GRD00600                                            6803 10880021
         CLC   K1+1(3,PARM),NULL+1(ERRCD) NULL                     6803 10980021
         BE    GRD00400                                            6803 11080021
         MVC   WRKK1,K1(PARM)      SAVE KEY                        6803 11180021
GRD00400 TM    K1(PARM),LAST       LAST PARM                       6803 11280021
         BO    GRD00600                                            6803 11380021
         CLC   C2+1(3,PARM),NULL+1(ERRCD) NULL                     6803 11480021
         BE    GRD00500                                            6803 11580021
         MVC   WRKC2,C2(PARM)      SAVE CORVAL 2                   6803 11680021
GRD00500 TM    C2(PARM),LAST       LAST PARM                       6803 11780021
         BO    GRD00600                                            6803 11880021
         CLC   K2+1(3,PARM),NULL+1(ERRCD) NULL                     6803 11980021
         BE    GRD00600                                            6803 12080021
         MVC   WRKK2,K2(PARM)      SAVE KEY 2                      6803 12180021
         EJECT                                                     6803 12280021
*                                                                  6803 12380021
*        HERE ALL PATHS JOIN AGAIN. IF THIS IS A LEVEL II GDS      6803 12480021
*        THE CORRVAL PARAMETERS ARE SET TO ZERO BECAUSE THEY ARE   6803 12580021
*        TO BE IGNORED. A CHECK IS MADE TO SEE IF A CORRVAL 1      6803 12680021
*        OR KEY 1 PARAMETER IS PASSED. IF NOT THE ENTIRE GRAPHIC   6803 12780021
*        DATA SET IS TO BE READ. THE LOGICAL START ADDRESS OF THE  6803 12880021
*        READ IS SET TO ZERO. THE LENGTH OF THE GRAPHIC DATA SET   6803 12980021
*        IS TAKEN FROM THE LOGICAL CURRENT FIELD OF THE CURRENT    6803 13080021
*        OACB. THIS LENGTH FIELD CONTAINS THE LENGTH OF THE ORDERS 6803 13180021
*        IN THE BUFFER AND IN THE GDOA IF SOME HAVE NOT YET BEEN   6803 13280021
*        EXECUTED.                                                 6803 13380021
*                                                                  6803 13480021
GRD00600 TM    GDSFLAGS,LEVL2      LEVEL 2                         6803 13580021
         BZ    GRD00650            NO                              6803 13680021
         XC    WRKC1,WRKC1         ZERO CORVAL                     6803 13780021
         XC    WRKC2,WRKC2                                         6803 13880021
GRD00650 CLC   WRKC1(16),ZERO      READ ENTIRE GDS                 6803 13980021
         BNE   GRD00700            NO                              6803 14080021
         MVC   WRKST(4),ZERO       LOGICAL START ADDR=0            6803 14180021
         L     REGC,GDSAOACB                                       6803 14280021
         L     REGC,52(REGC)       PICK UP LENGTH FROM GDOA        6803 14380021
         LTR   REGC,REGC     IS LENGTH ZERO                      A28421 14410021
         BZ    ERR1             IF YES, READ NOT POSSIBLE        A28421 14440021
         ST    REGC,WRKLEN         SAVE, SOME DATA MAY STILL BE    6803 14480021
*                                  IN THE GDOA                     6803 14580021
         B     GRD01400                                            6803 14680021
         EJECT                                                     6803 14780021
*                                                                  6803 14880021
*        IF CORRVAL AND KEY PARAMETERS ARE PASSED VALIDITY CHECKS  6803 14980021
*        ARE MADE AT THIS POINT. FOR KEY1 AND CORRVAL1 KEY TABLE   6803 15080021
*        MANAGEMENT IS CALLED TO SEE IF THEY ARE VALID. IF LEVEL II6803 15180021
*        NO CHECK IS MADE TO KEY TABLE MANAGEMENT. IF VALID,THE    6803 15280021
*        LOGICAL START ADDRESS AND LENGTH OF THE ELEMENT ARE SAVED.6803 15380021
*                                                                  6803 15480021
GRD00700 CLC   WRKC1,ZERO          CORRVAL1                        6803 15580021
         BE    GRD00800            NO                              6803 15680021
         LA    REGC,FIVE                                           6803 15780021
         ST    REGC,WRKPRLST+4     SERARCH ON CORRVAL              6803 15880021
         MVC   WRKPRLST+8(4),WRKC1                                 6803 15980021
         B     GRD00900                                            6803 16080021
GRD00800 CLC   WRKK1,ZERO                                          6803 16180021
         BE    ERR1                                                6803 16280021
         L     PARM,WRKK1                                          6803 16380021
         TM    GDSFLAGS,LEVL2      LEVEL 2                         6803 16480021
         BO    GRD01000            YES-NO KEY TABLE MGT            6803 16580021
         LA    REGC,TWO            CODE-SEARCH KEY                 6803 16680021
         ST    REGC,WRKPRLST+4                                     6803 16780021
         ST    PARM,WRKPRLST+8     KEY ADDR                        6803 16880021
GRD00900 ST    GDSREG,WRKPRLST                                     6803 16980021
         LA    PARM,WRKPRLST                                       6803 17080021
         L     R15,STAT(ERRCD)     ADDRESS OF THE KEY TABLE FROM   6803 17180021
*                                  THE STATUS TABLE                6803 17280021
         L     R15,KEYTB(R15)                                      6803 17380021
         BALR  RETURN,R15          SERARCH FOR KEY OR CORVAL       6803 17480021
         LTR   R15,R15             ERROR                           6803 17580021
         BNE   ERR1                                                6803 17680021
GRD01000 LH    REGC,2(PARM)                                        6803 17780021
         ST    REGC,WRKST          START ADDR FROM KEY             6803 17880021
         LH    REGC,0(PARM)                                        6803 17980021
         ST    REGC,WRKLEN         SAVE LENGTH                     6803 18080021
         EJECT                                                     6803 18180021
*                                                                  6803 18280021
*        IF A CORRVAL2 OR KEY2 PARAMETER IS NOT PASSED THE PATH    6803 18380021
*        WILL MOVE FOREWARD AROUND THIS SECTION. THIS CODE WILL    6803 18480021
*        CHECK THE VALIDITY OF THOSE PARAMETERS WITH KEY TABLE     6803 18580021
*        MANAGEMENT JUST AS WAS DONE FOR THE CORRVAL1 AND KEY1     6803 18680021
*        PARAMETERS. THE LOGICAL START ADDRESS OF THIS ELEMENT     6803 18780021
*        IS TAKEN,THE LOGICAL START ADDRESS PREVIOUSLY SAVED       6803 18880021
*        IS SUBTRACTED FROM IT AND THE LOGICAL LENGTH OF THIS ELEM 6803 18980021
*        IS ADDED TO THE FIGURE OBTAINED. THIS IS THE LENGTH       6803 19080021
*        OF THE READ FROM KEY TO KEY OR CORRVAL TO CORRVAL OR      6803 19180021
*        WHATEVER COMBINATION WAS USED. THIS IS SAVED IN PLACE     6803 19280021
*        OF THE LENGTH PREVIOUSLY SAVED.                           6803 19380021
*                                                                  6803 19480021
         CLC   WRKC2(8),ZERO       2ND START AND LEN TO BE CONSID  6803 19580021
         BE    GRD01400            NO                              6803 19680021
         CLC   WRKC2,ZERO                                          6803 19780021
         BE    GRD01100                                            6803 19880021
         LA    REGC,FIVE                                           6803 19980021
         ST    REGC,WRKPRLST+4     SEARCH ON CORVAL                6803 20080021
         MVC   WRKPRLST+8(4),WRKC2                                 6803 20180021
         B     GRD01200                                            6803 20280021
GRD01100 L     PARM,WRKK2                                          6803 20380021
         TM    GDSFLAGS,LEVL2      LEVEL 2                         6803 20480021
         BO    GRD01300                                            6803 20580021
         LA    REGC,TWO                                            6803 20680021
         ST    REGC,WRKPRLST+4     CODE SEARCH ON KEY              6803 20780021
         ST    PARM,WRKPRLST+8     KEY ADDR                        6803 20880021
GRD01200 ST    GDSREG,WRKPRLST                                     6803 20980021
         LA    PARM,WRKPRLST                                       6803 21080021
         L     R15,STAT(ERRCD)     ADDR OF STAT TABLE              6803 21180021
         L     R15,KEYTB(R15)      ADDR OF KEY TBL MGT             6803 21280021
         BALR  RETURN,R15          SEARCH ON KEY OR CORVAL         6803 21380021
         LTR   R15,R15             ERROR                           6803 21480021
         BNE   ERR1                                                6803 21580021
GRD01300 LH    REGC,2(PARM)        START ADDR OF THIS KEY          6803 21680021
         S     REGC,WRKST          START ADDR OF 1ST KEY           6803 21780021
         AH    REGC,0(PARM)        PLUS LENGTH OF THIS KEY         6803 21880021
         ST    REGC,WRKLEN         NEW LENGTH OF READ              6803 21980021
         EJECT                                                     6803 22080021
*                                                                  6803 22180021
*        A CHECK IS NOW MADE TO SEE IF ANY OF THE DATA TO BE READ  6803 22280021
*        IS NOT IN THE BUFFER. IF THIS IS AN EQUIVALENCE GRAPHIC   6803 22380021
*        DATA SET THAT IS IN THE BUFFER ALL DATA IN IT IS ASSUMED  6803 22480021
*        TO BE IN THE BUFFER. OTHERWISE THE LENGTH IS ADJUSTED     6803 22580021
*        SO THAT WRKLEN IS SET TO THE LENGTH IN THE BUFFER AND     6803 22680021
*        WRKEXT IS SET TO THE LENGTH IN THE GDOA.                  6803 22780021
*                                                                  6803 22880021
GRD01400 L     REGC,WRKST          START OF READ                   6803 22980021
         A     REGC,WRKLEN         LENGTH ADDED                    6803 23080021
         TM    GDSFLAGS,EQIVIN                                     6803 23180021
         BO    GRD02150            IF EQUIV IN BUF, READ FROM BUF  6803 23280021
         L     REGB,GDSAOACB                                       6803 23380021
         S     REGC,48(REGB)       HOW MUCH IN GDOA                6803 23480021
         BM    GRD02150                IF NEGATIVE SET TO ZERO     6803 23580021
GRD01450 ST    REGC,WRKEXT             SAVE                        6803 23680021
         L     REGB,WRKLEN         SEPARATE LENGTH IN EDOA         6803 23780021
         SR    REGB,REGC           FROM LENGTH IN THE              6803 23880021
         ST    REGB,WRKLEN         BUFFER                          6803 23980021
         BZ    GRD04500            ALL DATA IN GDOA                6803 24080021
         EJECT                                                     6803 24180021
*                                                                  6803 24280021
*        THE LOGICAL START ADDRESS IS TAKEN AND CONVERTED TO A     6803 24380021
*        PHYSICAL BUFFER ADDRESS USING THE SUBROUTINE WITHIN THE   6803 24480021
*        PROGRAM. THE READ IS THEN SET UP. THE BUFFER ADDRESS      6803 24580021
*        IS SAVED. THE DECB IS SET TO ZERO. THE READ IN AREA       6803 24680021
*        IS THE OTHER GDOA WHICH IS CURRENTLY NOT IN USE. THE           24780021
*        ADDRESS OF THE AREA IS COMPUTED AND STORED IN THE WORK         24880021
*        AREA FOR FUTURE REFERENCE AS WELL AS KEPT IN THE REGISTER.     24980021
*        THE COUNT PARAMETER PASSED IS MADE POSITIVE AND SET IN         25080021
*        THE RESIDUAL COUNT FIELD.                                      25180021
*                                                                  6803 25280021
GRD01500 L     PARM,WRKST                                          6803 25380021
         BAL   RETURN,GRDTRAN1     TRANS TO PHYS BUFFER ADDR       6803 25480021
*        REMAINDER IS IN REG0,PHYSICAL ADDR IN REG1                6803 25580021
         L     REGB,GTMGRDCB                                       6803 25680021
         LA    PARM,2(PARM)        2 FOR STARTING SET MODE         6803 25780021
         AR    PARM,REG0           DISPLACEMENT INTO THIS BUFFER   6803 25880021
         STH   PARM,WRKBUF         PLACE BUFFER ADDR IN STORAGE    6803 25980021
         LR    REGA,REG0                                           6803 26080021
         LA    REGA,6(REGA)                                        6803 26180021
         LH    REG0,GDSGDOAL                                       6803 26280021
         SR    REG0,REGA           LENGTH OF READ AVAIL 1ST TIME   6803 26380021
         XC    WRKDECB(32),WRKDECB ZERO DECB                       6803 26480021
         C     REG0,WRKLEN                                         6803 26580021
         BNH   GRD01550                                            6803 26680021
         L     REG0,WRKLEN                                         6803 26780021
GRD01550 ST    REG0,WRKDECB+20     LENGTH INTO DECB                6803 26880021
         L     REGA,GDSAOACB       OACB1 ADDR                           26980021
         L     REGA,0(REGA)        OACB2 ADDR                           27080021
         L     REGA,4(REGA)        GDOA2 ADDR                           27180021
         LA    REGA,6(REGA)        SKIP SM AND GTRU OVERHEAD BYTES      27280021
         ST    REGA,WRKPL          SAVE ADDR                       6803 27380021
         L     REGC,WRKCNT                                         6803 27480021
         LPR   REGC,REGC           GET COUNT POSITIVE              6803 27580021
         ST    REGC,WRKRESCT       SAVE AS A RESIDUAL              6803 27680021
         EJECT                                                     6803 27780021
*                                                                  6803 27880021
*        THE COUNT FIELD IS EXAMINED HERE TO SEE IF A READ TO      6803 27980021
*        CURSOR IS DESIRED. IF THE FIELD IS NEGATIVE A BRANCH      6803 28080021
*        TO THAT READ IS TAKEN. OTHERWISE A READ BUFFER IS         6803 28180021
*        DONE.                                                     6803 28280021
*                                                                  6803 28380021
GRD01600 L     R15,WRKCNT                                          6803 28480021
         C     R15,ZERO                                            6803 28580021
         BE    GRDEXIT             NO DATA                              28680021
         BL    GRD02700            READ TO CURSOR                  6803 28780021
         GREAD WRKDECB,BUF,(REGB),,(REGA),WRKBUF,MF=E              6803 28880021
         LTR   R15,R15                 CHECK FOR SUCCESSFUL START  0557 28910021
         BNZ   ERR3                         IF NOT, RETURN         0557 28940021
         WAIT  ECB=WRKDECB                                         6803 28980021
         CLI   WRKDECB,X'7F'                                       6803 29080021
         BNE   ERR3                                                6803 29180021
         L     REG0,WRKDECB+20      RESET COUNT IN REG0            6803 29280021
         EJECT                                                     6803 29380021
*                                                                  6803 29480021
*        A CHECK IS MADE HERE TO SEE IF A READ ALL DATA OR READ    6803 29580021
*        TEXT DATA IS DESIRED. THE READ TEXT DATA GOES TO ANOTHER  6803 29680021
*        PART OF THE PROGRAM. FOR READ ALL DATA A CHECK IS MADE    6803 29780021
*        TO SEE IF THE RESIDUAL COUNT IS LESS THAN OR GREATER THAN 6803 29880021
*        THE COUNT OF DATA READ WITH THIS READ. IF THE RESIDUAL    6803 29980021
*        COUNT IS GREATER THE NOT DONE SWITCH IS SET. OTHERWISE    6803 30080021
*        THE SWITCH IS TURNED OFF. THE DATA IS MOVED INTO THE      6803 30180021
*        USER PROVIDED AREA.                                       6803 30280021
*                                                                  6803 30380021
GRD01700 CLI   WRKRDTYP+3,X'01'    READ TEXT ONLY                  6803 30480021
         BE    GRD02900            YES                             6803 30580021
         LR    REGC,REG0                                           6803 30680021
         LA    REG0,0(REGC)                                        6803 30780021
         L     REGC,WRKRESCT                                       6803 30880021
         CR    REG0,REGC           HAVE WE READ ENOUGH DATA YET    6803 30980021
         BL    GRD02300            NO                              6803 31080021
         XC    WRKRESCT,WRKRESCT                                   6803 31180021
GRD01750 NI    WRKSW,ANTIDNE                                       6803 31280021
GRD01800 L     REGE,WRKSTRG        PLACE TO MOVE                   6803 31380021
         LR    REGF,REGA           PLACE FROM                      6803 31480021
         ST    REGC,WRKTEMP                                        6803 31580021
GRD01900 CH    REGC,H256           GR THAN 256                     6803 31680021
         BH    GRD02200            YES                             6803 31780021
         BCTR   REGC,0                                             6803 31880021
         EX    REGC,MOVE           MOVE IN DATA                    6803 31980021
         L     REGC,WRKTEMP                                        6803 32080021
*                                                                  6803 32180021
*        IF THE NOT DONE SWITCH IS NOT SET, TERM CODE IS COMPUTED  6803 32280021
*        AND SET IN THE PARAMETER IF IT WAS PASSED. THE DISPLAY IS 6803 32380021
*        RESTARTED AND CONTROL IS THEN PASSED TO THE CALLING       6803 32480021
*        PROGRAM.                                                  6803 32580021
*                                                                  6803 32680021
         TM    WRKSW,NOTDONE                                       6803 32780021
         BO    GRD02500            NOT DONE YET                    6803 32880021
         CLC   WRKRESCT,ZERO       COUNT ZERO                      6803 32980021
         BNE   GRD01950            NO                              6803 33080021
         SR    REGA,REGA           SET TERMCODE=0                  6803 33180021
         B     GRD02000                                            6803 33280021
         EJECT                                                     6803 33380021
GRD01950 TM    WRKSW,CURSOR        CURSOR ENCOUNTERED              6803 33480021
         BZ    GRD02400            NO                              6803 33580021
         L     REGA,WRKCNT         NEG NO                          6803 33680021
         A     REGA,WRKRESCT       ADD POSITIVE AMNT LEFT          6803 33780021
GRD02000 L     REGC,WRKTRMCD                                       6803 33880021
         LTR   REGC,REGC           TERM CODE PRESENT               6803 33980021
         BZ    GRD02100            NO                              6803 34080021
         ST    REGA,0(REGC)                                        6803 34180021
GRD02100 XC    WRKDECB(4),WRKDECB  ZERO ECB                        6803 34280021
         GCNTRL WRKDECB,STR,(REGB),GDSFCBUF,MF=E                   6803 34380021
         LTR   R15,R15                 CHECK FOR SUCCESSFUL START  0557 34410021
         BNZ   ERR3                         IF NOT, RETURN         0557 34440021
         WAIT  ECB=WRKDECB         RESTART REGENERATION            6803 34480021
         CLI   WRKDECB,X'7F'       ERROR                           6803 34580021
         BNE   ERR3                YES                             6803 34680021
GRDEXIT  L     SAVE,4(SAVE)        RETURN                          6803 34780021
         RETURN (14,12),RC=(15)        KEEP RETURN CODE            0557 34880021
         EJECT                                                     6803 34980021
GRD02150 SR    REGC,REGC                                           6803 35080021
         B     GRD01450                                            6803 35180021
GRD02200 LA    RETURN,255                                          6803 35280021
         EX    RETURN,MOVE         MOVE IN 256                     6803 35380021
         SH    REGC,H256           UPDATE                          6803 35480021
         AH    REGE,H256           PTRS                            6803 35580021
         AH    REGF,H256                                           6803 35680021
         B     GRD01900            CONTINUE                        6803 35780021
GRD02300 OI    WRKSW,NOTDONE       SET NOT DONE SW                 6803 35880021
         LR    REGC,REG0           MOVE IN ALL DATA READ           6803 35980021
         B     GRD01800                                            6803 36080021
GRD02400 L     REGA,WRKCNT                                         6803 36180021
         LPR   REGA,REGA           COMPUTE RESIDUAL COUNT          6803 36280021
         S     REGA,WRKRESCT                                       6803 36380021
         B     GRD02000                                            6803 36480021
         EJECT                                                     6803 36580021
*                                                                  6803 36680021
*                                                                  6803 36780021
*        IF THE NOT DONE SWITCH WAS SET THE STORAGE ADDR WHERE THE 6803 36880021
*        DATA IS TO BE MOVED IS UPDATED BY THE LENGTH OF THE READ. 6803 36980021
*        THE RESIDUAL COUNT IS DECREASED BY THE LENGTH OF THE READ 6803 37080021
*        AND THE BUFFER LENGTH IS DECREASED BY THE LENGTH OF THE   6803 37180021
*        READ. IF THE LENGTH IS NEGATIVE (THE LAST READ WAS FROM   6803 37280021
*        THE GDOA) OR ZERO A BRANCH IS TAKEN TO SEE IF THERE IS    6803 37380021
*        DATA IN THE GDOA TO BE READ. OTHERWISE THE NEXT BUFFER    6803 37480021
*        ADDRESS IS COMPUTED,THE LENGTH OF THE READ IS COMPUTED    6803 37580021
*        AND ANOTHER READ IS INITIATED.                            6803 37680021
*                                                                  6803 37780021
*                                                                  6803 37880021
GRD02500 L     REGE,WRKSTRG        UPDATE STORAGE ADDR             6803 37980021
         AR    REGE,REGC           BY LENGTH MOVED IN              6803 38080021
         ST    REGE,WRKSTRG                                        6803 38180021
         L     REGE,WRKRESCT       DECREMENT                       6803 38280021
         SR    REGE,REGC           RESIDUAL COUNT                  6803 38380021
         ST    REGE,WRKRESCT                                       6803 38480021
GRD02550 L     REGE,WRKLEN         DECREMENT LENGTH IN BUFFER      6803 38580021
         SR    REGE,REGC                                           6803 38680021
         ST    REGE,WRKLEN             SAVE IN LENGTH              6803 38780021
         BNH   GRD04500            NO MORE DATA IN BUFFER          6803 38880021
         SR    REG0,REG0                ZERO OUT FOR DIVIDE        2449 38980021
         LH    PARM,WRKBUF         GET LAST BUFFER ADDRESS         6803 39080021
         D     REG0,F256               CONVERT IT TO AN INDEX      0546 39180021
         M     REG0,F3                         TO THE              0546 39280021
         L     REGC,GTMBCTBL       BUFFER CONTROL TABLE            6803 39380021
         SR    REGE,REGE                                           6803 39480021
         IC    REGE,1(REGC,PARM)   GET PTR TO NEXT BUFFER          6803 39580021
         LR    REGF,REGE                                           6803 39680021
         MH    REGF,F3+2                                           6803 39780021
         CR    REGF,PARM           IS IT POINTING TO ITSELF        6803 39880021
         BE    ERR1                YES NO MORE BUFFER              6803 39980021
         MH    REGE,H256                                           6803 40080021
         LA    REGE,2(REGE)                                        6803 40180021
         STH   REGE,WRKBUF         NEW BUFFER ADDRESS              6803 40280021
         LH    REG0,GDSGDOAL                                       6803 40380021
         S     REG0,SIX                                            6803 40480021
         C     REG0,WRKLEN         CAN WE READ IN THE WHOLE BUFFER 6803 40580021
         BNH   GRD02600            YES                             6803 40680021
         L     REG0,WRKLEN         NO ONLY READ WHAT IS THERE      6803 40780021
GRD02600 ST    REG0,WRKDECB+20     STORE LENGTH                    6803 40880021
         XC    WRKDECB(4),WRKDECB  ZERO ECB                        6803 40980021
         B     GRD01600                                            6803 41080021
         EJECT                                                     6803 41180021
*                                                                  6803 41280021
*                                                                  6803 41380021
*        IF A READ TO CURSOR WAS DESIRED THAT TYPE OF READ IS      6803 41480021
*        DONE HERE,  WHEN THE                                      2449 41680021
*        RESIDUAL COUNT OF THE READ IS ZERO A CHECK MUST BE        6803 41980021
*        MADE TO SEE IF THE CURSOR WAS FOUND IN THE LAST BYTE      6803 42080021
*        OF DATA.  IF NOT THE CURSOR WAS NOT FOUND.                2449 42180021
*        IF NO CURSOR WAS FOUND THE DATA                           2449 42280021
*        IS TREATED JUST AS THE OTHER READ AND A BRANCH IS         6803 42480021
*        TAKEN TO CHECK WHAT TYPE OF READ WAS DESIRED, CHARACTER   6803 42580021
*        OR ALL,ETC. IF THE CURSOR WAS FOUND AND A READ OF         6803 42680021
*        ALL DATA WAS DESIRED THE LENGTH OF THE DATA READ          6803 42780021
*        IN IS MODIFIED AND THE RESIDUAL COUNT IS REDUCED BY       6803 42880021
*        THE LENGTH OF THE READ.                                   6803 42980021
*                                                                  6803 43080021
*                                                                  6803 43180021
GRD02700 GREAD WRKDECB,CUR,(REGB),,(REGA),WRKBUF,MF=E              6803 43280021
         LTR   R15,R15                 CHECK FOR SUCCESSFUL START  0557 43310021
         BNZ   ERR3                         IF NOT, RETURN         0557 43340021
         WAIT  ECB=WRKDECB                                         6803 43380021
         L     REG0,WRKDECB+20      RESET COUNT IN REG0            6803 43480021
         EJECT                                                     6803 43580021
         CLI   WRKDECB,X'7F'        ERROR                          6803 43680021
         BNE   ERR3                     PERMANENT I/O ERROR, BRANCH2449 43780021
         CLI   WRKDECB+16,X'43'    CURSOR                          6803 43880021
         BE    GDR02725                 CURSOR WAS FOUND, BRANCH   2449 43900021
         CLC   WRKDECB+16,ZERO          WAS CURSOR NOT FOUND (IF   2449 43920021
*                                       NOT DECB +16 SHOULD STILL  2449 43940021
*                                       BE ZERO)                   2449 43960021
         BNE   ERR3                     IF NON ZERO TAKE BRANCH    2449 43980021
*                                       GO SEE IF STILL MORE TO    2449 44000021
*                                       READ OR IF CURSOR WAS LAST 2449 44020021
*                                       BYTE TRANSMITTED           2449 44040021
GDR02725 EQU   *                                                   2449 44060021
         CLC   WRKDECB+17(3),ZERO     RESIDUAL COUNT ZERO          6803 44080021
         BNE   GRD02750                                            6803 44180021
         LR    R15,REGA                                            6803 44280021
         AR    R15,REG0                                            6803 44380021
         S     R15,F1              WAS A CURSOR IN FACT FOUND      6803 44480021
         CLI   0(R15),X'1A'                                        6803 44580021
         BNE   GRD01700            NO                              6803 44680021
GRD02750 XC    WRKDECB+16(1),WRKDECB+16                            6803 44780021
         S     REG0,WRKDECB+16     AMOUNT READ                     6803 44880021
         S     REG0,F1             ONE FOR THE CURSOR              6803 44980021
         CLI   WRKRDTYP+3,X'01'    CONTINUE TO PROCESS DATA        6803 45080021
         BE    GRD02800                                            6803 45180021
         C     REG0,WRKRESCT       CURSOR BEFORE END OF READ       6803 45280021
         BNL   GRD01700            NO  IGNORE                      6803 45380021
         OI    WRKSW,CURSOR                                        6803 45480021
         L     RETURN,WRKRESCT     REDUCE RESIDUAL COUNT           6803 45580021
         SR    RETURN,REG0                                         6803 45680021
         ST    RETURN,WRKRESCT     SAVE                            6803 45780021
         LR    REGC,REG0                                           6803 45880021
         B     GRD01750                                            6803 45980021
*                                                                  6803 46080021
*        IF THE CURSOR WAS INCOUNTERED THE SWITCH IS SET.          6803 46180021
*                                                                  6803 46280021
GRD02800 OI    WRKSW,CURSOR        SET SWITCH CURSOR FOUND         6803 46380021
         EJECT                                                     6803 46480021
*                                                                  6803 46580021
*                                                                  6803 46680021
*        A READ OF CHARACTERS ONLY IS DONE HERE. FIRST REGISTERS   6803 46780021
*        ARE INITIALIZED WITH THE RESIDUAL COUNT,THE LENGTH OF     6803 46880021
*        DATA READ,THE CURRENT INCREMENT,AND THE STORAGE ADDRESS   6803 46980021
*        WHERE THE DATA IS TO BE MOVED. IF,ON THE LAST READ THE    6803 47080021
*        CURRENT MODE WAS TEXT A BRANCH IS TAKEN TO THE TEXT       6803 47180021
*        CURRENT SECTION. OTHERWISE A CHECK IS MADE TO SEE IF A    6803 47280021
*        SET MODE IS PRESENT. IF YES THE TYPE OF SET MODE IS       6803 47380021
*        INSPECTED. OTHERWISE THE INCREMENT IS ADDED TO THE        6803 47480021
*        INPUT ADDRESS AND SUBTRACTED FROM THE LENGTH OF THE READ  6803 47580021
*        AND THE LOOP IS CONTINUED.                                6803 47680021
*                                                                  6803 47780021
GRD02900 L     R15,WRKRESCT        COUNT OF CHAR LEFT TO READ      6803 47880021
         LR    RETURN,REG0         LENGTH READ OUT OF REG0         6803 47980021
         L     REG0,WRKINCR        CURRENT INCR                    6803 48080021
         L     REGE,WRKSTRG                                        6803 48180021
         TM    WRKSW,TEXT          CURRENT MODE TEXT               6803 48280021
         BO    GRD04400            YES                             6803 48380021
GRD03000 LTR   RETURN,RETURN       MORE TO READ                    6803 48480021
         BNH   GRD04300            DONE-GET BUFFER OR TERM         6803 48580021
         CLI   0(REGA),X'2A'       SETMODE                         6803 48680021
         BE    GRD03200            YES                             6803 48780021
GRD03100 AR    REGA,REG0           INDEX THROUGH                   6803 48880021
         SR    RETURN,REG0                                         6803 48980021
         B     GRD03000            CONTINUE                        6803 49080021
         EJECT                                                     6803 49180021
*                                                                  6803 49280021
*        IF A SET MODE WAS ENCOUNTERED THE TYPE OF SET MODE IS     6803 49380021
*        DETERMINED AND THE INCREMENT FIELD IS SET ACCORDINGLY.    6803 49480021
*        IF THE MODE WAS A FOUR BYTE POINT OR LINE,THE DATA        6803 49580021
*        FIELD IS UPDATED TWO BYTES TO GET BEYOND THE SET MODE     6803 49680021
*        AND THE LENGTH IS REDUCED BY TWO. THE INCREMENT FIELD     6803 49780021
*        IS SET TO FOUR,THE LENGTH OF THE X AND Y COORDINATES.     6803 49880021
*        IT THEN CONTINUES THE SCAN. FOR ALL OTHER TYPES EXCEPT    6803 49980021
*        TEXT,THE INCREMENT IS SET TO THE LENGTH OF THE ORDER      6803 50080021
*        AND THE SCAN CONTINUES.                                   6803 50180021
*                                                                  6803 50280021
GRD03200 CLI   1(REGA),X'02'       4 BYTE ORDER                    6803 50380021
         BNH   GRD03300                                            6803 50480021
         CLI   1(REGA),X'05'       2 BYTE ORDER                    6803 50580021
         BNH   GRD03400                                            6803 50680021
         CLI   1(REGA),X'45'       TEXT                            6803 50780021
         BNH   GRD03700            YES                             6803 50880021
         CLI   1(REGA),X'89'       TWOBYTE                         6803 50980021
         BNH   GRD03400                                            6803 51080021
         CLI   1(REGA),X'EA'       4 BYTE ORDER                    6803 51180021
         BNH   GRD03500                                            6803 51280021
         CLI   1(REGA),X'EC'       6 BYTE ORDER                    6803 51380021
         BNH   GRD03600                                            6803 51480021
         B     GRD03500            4BYTE                           6803 51580021
GRD03300 LA    REGA,2(REGA)        UPDATE BEYOND SETMODE           6803 51680021
         S     RETURN,TWO                                          6803 51780021
         LA    REG0,4                                              6803 51880021
         B     GRD03000            CONTINUE                        6803 51980021
GRD03400 LA    REG0,2              SET TO 2 BYTE                   6803 52080021
         B     GRD03100            CONTINUE                        6803 52180021
GRD03500 LA    REG0,4              SET TO 4 BYTE                   6803 52280021
         B     GRD03100                                            6803 52380021
GRD03600 LA    REG0,6              SET TO 6 BYTE                   6803 52480021
         B     GRD03100                                            6803 52580021
         EJECT                                                     6803 52680021
*                                                                  6803 52780021
*                                                                  6803 52880021
*        FOR TEXT DATA,THE DATA FIELD IS UPDATED TWO BYTES,THE     6803 52980021
*        LENGTH READ IS REDUCED BY TWO AND A CHECK IS MADE TO SEE  6803 53080021
*        IF ONLY ONE MORE CHARACTER IS DESIRED. IF LESS WE ARE     6803 53180021
*        DONE. OTHERWISE A SIMILAR SCAN IS DONE HERE FOR A SET     6803 53280021
*        MODE. IF NOT PRESENT TWO CHARACTERS ARE MOVED IN AND      6803 53380021
*        THE FIELDS ARE UPDATED BY TWO. THE LOOP CONTINUES.        6803 53480021
*                                                                  6803 53580021
*                                                                  6803 53680021
GRD03700 LA    REG0,2              TEXT                            6803 53780021
GRD03800 SR    RETURN,REG0         REDUCE BY 2                     6803 53880021
         AR    REGA,REG0           MOVE BY 2                       6803 53980021
GRD03850 C     RETURN,F1                                           6803 54080021
         BE    GRD04100                                            6803 54180021
         BNH   GRD04200                                            6803 54280021
         CLI   0(REGA),X'2A'       SET MODE                        6803 54380021
         BE    GRD03000            YES EXIT                        6803 54480021
         CR    REG15,REG0          TWO LEFT                        6803 54580021
         BL    GRD03900            NO FINISH UP                    6803 54680021
         MVC   0(2,REGE),0(REGA)   MOVE IN 2 CHAR                  6803 54780021
         AR    REGE,REG0           INCR BY TWO                     6803 54880021
         SR    REG15,REG0          DECREMENT BY TWO                6803 54980021
         BZ    GRD04000            NO MORE TO DO                   6803 55080021
         B     GRD03800                                            6803 55180021
GRD03900 MVC   0(1,REGE),0(REGA)   MOVE IN LAST CHAR               6803 55280021
GRD04000 SR    REGA,REGA           SET TERM CODE=0                 6803 55380021
         B     GRD02000            EXIT                            6803 55480021
GRD04100 MVC   0(1,REGE),0(REGA)   MOVE IN LAST CHAR               6803 55580021
         S     REG15,F1                                            6803 55680021
         BZ    GRD04000                                            6803 55780021
         EJECT                                                     6803 55880021
*                                                                  6803 55980021
*                                                                  6803 56080021
*        IF ALL THE TEXT IN THIS READ IS REMOVED THE TEXT SW IS    6803 56180021
*       SET TO SAY WE ARE CURRENTLY PROCESSING TEXT. THE CASE WHERE6803 56280021
*        THE CURRENT MODE WAS NOT TEXT IS BRANCHED IN BELOW THE    6803 56380021
*        SWITCH SETTING INSTRUCTION. THEN THE RESIDUAL COUNT IS    6803 56480021
*        SAVED,IF A CURSOR HAD BEEN ENCOUNTERED,THE TERMCODE AND   6803 56580021
*        EXIT PROCESSING IS BRANCHED TO,AND THE STORAGE ADDRESS,   6803 56680021
*        INCREMENT,AND SO FORTH ARE SAVED.                         6803 56780021
*                                                                  6803 56880021
GRD04200 OI    WRKSW,TEXT          WE'RE PROCESSING TEXT           6803 56980021
GRD04300  ST   R15,WRKRESCT                                        6803 57080021
         TM    WRKSW,CURSOR                                        6803 57180021
         BO    GRD01950            FIX UP RESIDUAL & EXIT          6803 57280021
         L     REGA,WRKPL          DATA IN AREA                    6803 57380021
         L     REGC,WRKDECB+20     LENGTH LAST READ                6803 57480021
         ST    REGE,WRKSTRG        SAVE STORAGE ADDR               6803 57580021
         ST    REG0,WRKINCR        SAVE INCR                       6803 57680021
         B     GRD02550                                            6803 57780021
GRD04400 XI    WRKSW,TEXT          TURN OFF SW                     6803 57880021
         B     GRD03850                                            6803 57980021
         EJECT                                                     6803 58080021
*                                                                  6803 58180021
*                                                                  6803 58280021
*        THIS AREA OF CODING SIMULATES A READ FROM THE GDOA. IF    6803 58380021
*        IT WAS ALREADY DONE THE TERMCODE AND EXIT PROCESSING IS   6803 58480021
*        BRANCHED TO. OTHERWISE THE DONE SWITCH IS SET. IF THERE   6803 58580021
*        IS NO DATA IN THE GDOA THE TERMCODE AND EXIT PROCESSING   6803 58680021
*        IS BRANCHED TO. OTHERWISE THE GDOA IS POINTED TO,THE      6803 58780021
*        LENGTH FIELD IS SET UP AND PROCESSING PROCEEDS JUST       6803 58880021
*        BEYOND THE READS.                                         6803 58980021
*                                                                  6803 59080021
*                                                                  6803 59180021
GRD04500 TM    WRKSW,DONE                                          6803 59280021
         BO    GRD02400                                            6803 59380021
         OI    WRKSW,DONE          SET DONE SW-MEANS DATA          6803 59480021
         CLC   WRKEXT,ZERO         ANY IN GDOA                     6803 59580021
         BZ    GRD02400            NO-DONE                         6803 59680021
         L     REG0,WRKEXT                                         6803 59780021
         L     R15,GDSAOACB        OACB                            6803 59880021
         L     REGA,12(R15)         CRSA                           6803 59980021
         CLC   GDSGDOAL,30(R15)                                    6803 60080021
         BNE   GRD04600                                            6803 60180021
         LA    REGA,2(REGA)        POSITION BEYOND SET MODE        6803 60280021
GRD04600 B     GRD01700           PORCESS IN GDOA                  6803 60380021
         EJECT                                                     6803 60480021
*                                                                  6803 60580021
*              ROUTINE TO TRANSLATE LOGICAL BUFFER ADDRESS         6803 60680021
*              TO PHYSICAL BUFER ADDRESS-LOG ADDR IN REG1          6803 60780021
*                                                                  6803 60880021
GRDTRAN1 SR    REG0,REG0           ZERO EVEN REG                   6803 60980021
         LH    REGE,GDSGDOAL                                       6803 61080021
         S     REGE,SIX            GDOA LEN-6                      6803 61180021
         DR    REG0,REGE           REM IN R0 RET TO CALLING PROG   6803 61280021
         LH    REGE,GDSBCTEL       BCT ELEM PTR                    6803 61380021
         L     REGF,GTMBCTBL       BCT ADDR                        6803 61480021
         MH    REGE,F3+2                                           6803 61580021
         CLC   GDSGDOAL,H256                                       6803 61680021
         BL    GRDTRAN5                                            6803 61780021
GRDTRAN2 SR    REGC,REGC           ZERO                            6803 61880021
         IC    REGC,2(REGE,REGF)   1ST COUNT                       6803 61980021
         CR    REGC,PARM           EQUAL                           6803 62080021
         BE    GRDTRAN3            YES SEGMENT FOUND               6803 62180021
         IC    REGC,1(REGE,REGF)   GET PTR TO NEXT                 6803 62280021
         MH    REGC,F3+2                                           6803 62380021
         CR    REGC,REGE           ANOTHER ENTRY                   6803 62480021
         BE    ERR1                                                6803 62580021
         LR    REGE,REGC                                           6803 62680021
         B     GRDTRAN2            CONTINUE                        6803 62780021
GRDTRAN3 SRDA  REGE,32             CONVERT TO                      6803 62880021
         D     REGE,F3             PHYSICAL ADDR                   6803 62980021
         MH    REGF,H256           FROM ENTRY COUNT                6803 63080021
GRDTRAN4 LR    PARM,REGF           PUT IN REG1                     6803 63180021
         BR    RETURN              REM IN REG0-RETURN              6803 63280021
GRDTRAN5 AR    REGE,REGF                                           6803 63380021
         LH    REGF,GDSBCTEL                                       6803 63480021
         MH    REGF,H256           COMPUTE BUFFER ADDR             6803 63580021
         CLC   0(1,REGE),GDSBCTID  IN 1ST HALF                     6803 63680021
         BE    GRDTRAN4                                            6803 63780021
         LA    REGF,128(REGF)      POINT TO SECOND HALF            6803 63880021
         B     GRDTRAN4                                            6803 63980021
         EJECT                                                     6803 64080021
ERR1     MVI   0(ERRCD),PARMER     SET PARM ERROR                  6803 64180021
         B     GRDEXIT                                             6803 64280021
ERR2     MVI   19(ERRCD),RDTERR    RDTYPE PARM IN ERROR            6803 64380021
         B     ERR1                                                6803 64480021
ERR3     MVI   0(ERRCD),IO         IO ERROR                        6803 64580021
         B     GRDEXIT                                                  64680021
         EJECT                                                     6803 64780021
STORLOC  EQU   4                                                   6803 64880021
NULL     EQU   20                                                  6803 64980021
LAST     EQU   X'80'                                               6803 65080021
COUNT    EQU   8                                                   6803 65180021
RDTYP    EQU   12                                                  6803 65280021
TMCD     EQU   16                                                  6803 65380021
C1       EQU   20                                                  6803 65480021
K1       EQU   24                                                  6803 65580021
C2       EQU   28                                                  6803 65680021
K2       EQU   32                                                  6803 65780021
LEVL2    EQU   X'10'                                               6803 65880021
KEYTB    EQU   X'33C'                                              6803 65980021
STAT     EQU   24                                                  6803 66080021
NOTDONE  EQU   X'01'                                               6803 66180021
CURSOR   EQU   X'02'                                               6803 66280021
TEXT     EQU   X'04'                                               6803 66380021
DONE     EQU   X'08'                                               6803 66480021
PARMER   EQU   X'08'                                               6803 66580021
RDTERR   EQU   X'04'                                               6803 66680021
IO       EQU   X'04'                                               6803 66780021
REG0     EQU   0                                                   6803 66880021
PARM     EQU   1                                                   6803 66980021
REGA     EQU   2                                                   6803 67080021
REGB     EQU   3                                                   6803 67180021
REGC     EQU   4                                                   6803 67280021
WORK     EQU   5                                                   6803 67380021
ERRCD    EQU   6                                                   6803 67480021
GTMREG   EQU   7                                                   6803 67580021
GDSREG   EQU   8                                                   6803 67680021
BASE     EQU   9                                                   6803 67780021
REGE     EQU   10                                                  6803 67880021
REGF     EQU   11                                                  6803 67980021
SAVE     EQU   13                                                  6803 68080021
RETURN   EQU   14                                                  6803 68180021
R15      EQU   15                                                  6803 68280021
REG15    EQU   15                                                  6803 68380021
ANTIDNE  EQU   X'FE'                                               6803 68480021
EQIVIN   EQU   X'80'                                               6803 68580021
         EJECT                                                     6803 68680021
F1       DC    F'1'                                                6803 68780021
ZERO     DC    4F'0'                                               6803 68880021
TWO      DC    F'2'                                                6803 68980021
FIVE     DC    F'5'                                                6803 69080021
SIX      DC    F'6'                                                6803 69180021
F3       DC    F'3'                                                6803 69280021
F256     DC    H'0'                                                6803 69380021
H256     DC    H'256'                                              6803 69480021
MOVE     MVC   0(1,REGE),0(REGF)                                   6803 69580021
         EJECT                                                     6803 69680021
WORKAREA DSECT                                                     6803 69780021
WRKPARM  DS    F                                                   6803 69880021
WRKRTNCD DS    F                                                   6803 69980021
WRKSTRG  DS    F                                                   6803 70080021
WRKCNT   DS    F                                                   6803 70180021
WRKRDTYP DS    F                                                   6803 70280021
WRKTRMCD DS    F                                                   6803 70380021
WRKC1    DS    F                                                   6803 70480021
WRKK1    DS    F                                                   6803 70580021
WRKC2    DS    F                                                   6803 70680021
WRKK2    DS    F                                                   6803 70780021
WRKST    DS    F                                                   6803 70880021
WRKLEN   DS    F                                                   6803 70980021
WRKEXT   DS    F                                                   6803 71080021
WRKDECB  DS    8F                                                  6803 71180021
WRKPL    DS    F                                                   6803 71280021
WRKBUF   DS    H                                                   6803 71380021
WRKSW    DS    H                                                   6803 71480021
WRKRESCT DS    F                                                   6803 71580021
WRKSAVE  DS    18F                                                 6803 71680021
WRKINCR  DS    F                                                   6803 71780021
WRKTEMP  DS    F                                                   6803 71880021
WRKPRLST DS    4F                                                  6803 71980021
         COPY  GDSCB                                                    94480021
         COPY  GSPCB                                                    94560021
         COPY  GTMCB                                                    94640021
         END                                                            94720021
./  ADD  SSI=20480185,NAME=IFFADA02
*STATUS  CHANGE LEVEL 001                                               00500021
*FUNCTION/OPERATION  ACCESSES THE GTMCB BY REFERENCING THE GDSCB.       01000021
*   IF NO CURSOR IS PRESENT IN THE TERMINAL ALL CURSOR PRESENT FLAGS    01500021
*   IN THE GTMCB AND ALL GDSCB'S CHAINED TO IT ARE REMOVED. IF A        02000021
*   CURSOR IS PRESENT THE BUFFER CONTROL TABLE IS REFERENCED. THE       02500021
*   LOGICAL AND PHYSICAL EXTENTS OF ASSIGNED BUFFER ARE COMPUTED,       03000021
*   THE BUFFER IS SEARCHED, AND ALL CURSORS ARE REMOVED. ALL 'CURSOR    03500021
*   PRESENT' FLAGS IN THE GTMCB AND ASSOCIATED GDSCB'S ARE RESET        04000021
*   AND RETURN IS MADE TO DIRECTOR 2.                                   04500021
*ENTRYPOINT  IFFADA02                                                   05000021
*INPUT  REGISTER 1 POINTS TO A WORKAREA, WORD 1 OF WHICH POINTS TO      05500021
*   A PARAMETER LIST WHICH CONTAINS THE ADDRESS OF THE GDSCB; WORD 2    06000021
*   POINTS TO THE RETURN CODE ARRAY                                     06500021
*OUTPUT  CURSORS ARE REMOVED                                            07000021
*EXTERNAL ROUTINES  GREAD, GCNTRL                                       07500021
*EXITS-NORMAL  RETURN TO DIRECTOR 2 VIA RETURN MACRO                    08000021
*     -ERRORS  AS ABOVE, WITH ERROR CODE                                08500021
*TABLES/WORK AREAS  GSP WORKAREA, BUFFER CONTROL TABLE                  09000021
*ATTRIBUTES  PROBLEM PROGRAM, REENTRANT                                 09500021
*NOTES  NONE                                                            10000021
IFFADA02 CSECT                                                          10500021
*C395000                                                         A37141 10600000
*D320000                                                         A33269 10700021
*2025,000000-999999                                           000A,8662 11000021
         SAVE  (14,12)                                                  11500021
         BALR  BASE,0              BASE                                 12000021
         USING *,BASE                                                   12500021
         LR    WORK,PARM                                                13000021
         USING WORKAREA,WORK       WORK AREA DSECT                      13500021
         L     ERRCD,WRKRTNCD      RETURN ARRAY                         14000021
         XC    0(20,ERRCD),0(ERRCD) ZERO RETURN ARRAY                   14500021
         L     GDSREG,WRKPARM                                           15000021
         L     GDSREG,0(GDSREG)                                         15500021
         L     GDSREG,0(GDSREG)    GDSCB ADDR                           16000021
         USING GDSCB,GDSREG                                             16500021
         CLI   GDSGDSID,X'03'      VALID GDSCB                          17000021
         BNE   ERR1                NO PARM ERROR                        17500021
         L     GTMREG,GDSGTMCB     GTMCB DSECT                          18000021
         USING GTMCB,GTMREG                                             18500021
         LA    REGA,WRKSAVE                                             19000021
         ST    REGA,8(SAVE)        CHAIN SAVE AREAS                     19500021
         ST    SAVE,4(REGA)                                             20000021
         LR    SAVE,REGA                                                20500021
         TM    GTMFLAGS,CUR        CURSOR IN TERMINAL                   21000021
         BZ    INS01000            NO ZERO FLAGS AND EXIT               21500021
         XI    GTMFLAGS,CUR        TURN OFF FLAG                        22000021
         CLC   GTMCRLOC,ZERO       CURSOR NOT WRITTEN YET               22500021
         BE    INS00100                                                 23000021
         MVC   GTMCRLOC,ZERO       ZERO ADDRESS                         23500021
         B     INS01000                                                 24000021
INS00100 L     REGA,GTMBCTBL       BUFFER CONTROL TABLE                 24500021
         SR    REGB,REGB           INDEX                                25000021
         XC    WRKDECB(32),WRKDECB ZERO DECB                            25500021
         L     DCB,GTMGRDCB        DCB ADDRESS                          26000021
         MVI   WRKSW,X'00'         ZERO SWITCH                          26500021
INS00200 SR    REGC,REGC           COUNT FOR LENGTH                     27000021
         SR    R15,R15                                                  27500021
INS00300 CH    REGB,H384           ALL ASSIGNED BUFFER SEARCHED         28000021
         BNL   INS00800            YES                                  28500021
         IC    R15,0(REGA,REGB)    ASSIGNED                             29000021
         LTR   R15,R15                                                  29500021
         BNE   INS00500            YES                                  30000021
         LA    REGB,3(REGB)                                             30500021
         LTR   REGC,REGC           ZERO-ANY ASSIGNED SO FAR             31000021
         BZ    INS00300            NO KEEP SEARCHING                    31500021
INS00350 STH   REGD,WRKBUFAD       PLACE IN BUFFER ADDR FIELD           32500021
         STH   REGD,WRAP               SAVE STARTING ADDRESS FOR END    33000021
*                                      OF BUFFER COMPARE                33500021
INS00400 ST    REGC,WRKDECB+20                                          34000021
         GREAD WRKDECB,FND,(DCB),,WRKSENSE,WRKBUFAD,MF=E                34500021
         WAIT  ECB=WRKDECB                                              35000021
         CLI   WRKDECB,X'7F'       SUCCESSFUL I/O                       35500021
         BNE   ERR2                NO                                   36000021
         SR    REGD,REGD               INITIALIZE REGISTER              36500021
         SR    REGC,REGC               INITIALIZE BUFFER REGISTER       37000021
         LH    REGD,WRKBUFAD       START ADDR                           37500021
         A     REGD,WRKDECB+20     PLUS LENGTH                          38000021
         LA    REGD,1(REGD)                                             38500021
         CH    REGD,WRKSENSE+2     CURSOR FOUND                         39000021
         BNH   INS00700           NO GO TO NEXT SEARCH           A37141 39500000
         LH    REGC,WRKSENSE+2     ADDR STOPPED                         40000021
         CH    REGC,WRAP               Q. HAS WRAPAROUND OCCURRED       40500021
         BNH   BUFFLIM                 YES - CHECK FOR CURSOR IN LAST   41000021
*                                      BYTE OF BUFFER                   41500021
         BCTR  REGC,0                                                   42000021
         STH   REGC,CURSOR                                              42500021
         MVC   WRKBUFAD(2),WRKSENSE+2                                   43000021
         BCTR  REGD,0                                                   43500021
         SH    REGD,WRKSENSE+2                                          44000021
         LR    REGC,REGD                                                44500021
INSRET   EQU   *                                                        45000021
         XC    WRKDECB(32),WRKDECB ZERO DECB                            45500021
         GCNTRL WRKDECB,RMV,(DCB),CURSOR,MF=E                           46000021
         WAIT  ECB=WRKDECB         WAIT                                 46500021
         CLI   WRKDECB,X'7F'       I/O ERROR                            47000021
         BNE   ERR2                NO                                   47500021
         TM    WRKSW,EIGHTY            Q. HAVE WE WRAPPED AROUND        48000021
         BO    INS00700                YES - BRANCH TO EXIT             48500021
         XC    WRKDECB(32),WRKDECB ZERO DECB                            49000021
         B     INS00400            CONTINUE SEARCH                      49500021
BUFFLIM  EQU   *                                                        50000021
         LTR   REGC,REGC               IS ZERO IF CURSOR IS IN          50500021
*                                      LAST BYTE OF BUFFER              51000021
         BNZ   INS00700                NO CURSOR - EXIT                 51500021
         BCTR  REGD,0                                                   52000021
         BCTR  REGD,0                  DECREMENT BY TWO TO GET          52500021
*                                      LAST PHYSICAL BUFFER ADDRESS     53000021
         STH   REGD,CURSOR             STORE CURSOR ADDRESS FOR RMV     53500021
         OI    WRKSW,EIGHTY            TURN ON WRAP SWITCH              54000021
         B     INSRET                  BRANCH TO REMOVE CURSOR          54500021
INS00500 LTR   REGC,REGC           START ADDR COMPUTED                  55000021
         LA    REGC,256(REGC)                                           55500021
         BNE   INS00600                                                 56000021
         LR    PARM,REGB           INDEX                                56500021
         M     REG0,F256           X256                                 57000021
         D     REG0,F3             DIV BY 3                             57500021
         LR    REGD,PARM           IS BUFFER ADDR                       58000021
INS00600 LA    REGB,3(REGB)        ADD TO INDEX                         58500021
         B     INS00300            CONTINUE SEARCH                      59000021
INS00700 TM    WRKSW,DONE          DONE                                 59500021
         BZ    INS00200            NO                                   60000021
         B     INS00900            YES                                  60500021
INS00800 OI    WRKSW,DONE          SET DONE SW                          61000021
         LTR   REGC,REGC           READ DONE                            61500021
         BNE   INS00350            NO                                   62000021
INS00900 GCNTRL WRKDECB,STR,(DCB),GDSFCBUF,MF=E RESTART REG.            62500021
         WAIT  ECB=WRKDECB                                              63000021
         CLI   WRKDECB,X'7F'                                            63500021
         BNE   ERR2                                                     64000021
INS01000 L     GDSREG,GTMGDSCB                                          64500021
INS01100 NI    GDSFLAGS,OUTCUR     REMOVE CURSOR PRES FLAG              65000021
         L     GDSREG,GDSNXGDS                                          65500021
         LTR   GDSREG,GDSREG       ALL DONE                             66000021
         BE    INS01200                                                 66500021
         B     INS01100                                                 67000021
INS01200 L     SAVE,4(SAVE)                                             67500021
         RETURN (14,12)                                                 68000021
ERR1     OI    0(ERRCD),PARMER     PARM ERROR                           68500021
         OI    19(ERRCD),X'01'     1ST PARM                             69000021
         B     INS01200                                                 69500021
ERR2     OI    0(ERRCD),IO         IO ERROR                             70000021
         B     INS01200                                                 70500021
REG0     EQU   0                                                        71000021
PARM     EQU   1                                                        71500021
REGA     EQU   2                                                        72000021
REGB     EQU   3                                                        72500021
ERRCD    EQU   4                                                        73000021
WORK     EQU   5                                                        73500021
DCB      EQU   6                                                        74000021
GTMREG   EQU   7                                                        74500021
GDSREG   EQU   8                                                        75000021
BASE     EQU   9                                                        75500021
REGC     EQU   10                                                       76000021
REGD     EQU   11                                                       76500021
SAVE     EQU   13                                                       77000021
RET      EQU   14                                                       77500021
R15      EQU   15                                                       78000021
CUR      EQU   X'01'                                                    78500021
OUTCUR   EQU   X'DF'                                                    79000021
PARMER   EQU   X'08'                                                    79500021
DONE     EQU   X'01'                                                    80000021
EIGHTY   EQU   X'08'                                                    80500021
IO       EQU   X'04'                                                    81000021
F3       DC    F'3'                                                     81500021
F256     DC    F'256'                                                   82000021
ZERO     DC    H'0'                                                     82500021
H384     DC    H'384'                                                   83000021
WORKAREA DSECT                                                          83500021
WRKPARM  DS    F                                                        84000021
WRKRTNCD DS    F                                                        84500021
WRKSAVE  DS    18F                                                      85000021
WRKBUFAD DS    H                                                        85500021
CURSOR   DS    H                                                        86000021
WRKSENSE DS    F                                                        86500021
WRKDECB  DS    8F                                                       87000021
WRAP     DS    H                                                        87500021
WRKSW    DS    X                                                        88000021
         COPY  GSPCB                                                    88500021
         COPY  GTMCB                                                    89000021
         COPY  GDSCB                                                    89500021
         END                                                            90000021
./  ADD  SSI=20480186,NAME=IFFADA03
         TITLE 'IFFADA03 - ICURS - INSERT CURSOR'                       00007021
*STATUS: CHANGE LEVEL 000                                               00014021
*                                                                       00021021
*FUNCTION/OPERATION:  THE PARAMETERS PASSED ARE CHECKED FOR VALIDITY.   00028021
*        IF LEVEL 1 CORRELATION IS USED, KEY TABLE MANAGEMENT IS        00035021
*        CALLED TO LOCATE THE FULL KEY. IF LEVEL 2 CORRELATION IS       00042021
*        USED, THE FIRST CHARACTER IS ASSUMED TO BE LOCATED AT THE      00049021
*        LOGICAL ADDRESS PASSED IN THE KEY. IF LEVEL 1 CORRELATION IS   00056021
*        USED, THE KEY IS CHECKED TO INSURE THE ELEMENT IS A TEXT       00063021
*        ELEMENT. IF IT IS, THE LOGICAL ADDRESS OF THE FIRST CHARACTER  00070021
*        IS COMPUTED. THE LOGICAL ADDRESS OF THE FIRST CHARACTER IS     00077021
*        THEN MODIFIED BY THE COUNT PARAMETER IF IT IS PRESENT IN BOTH  00084021
*        LEVEL 1 AND 2 CORRELATION.                                     00091021
*                                                                       00098021
*        THE PHYSICAL ADDRESS WHERE THE CURSOR IS TO BE PLACED IS THEN  00105021
*        COMPUTED FROM THE LOGICAL ADDRESS BY REFERENCING THE BUFFER    00112021
*        CONTROL TABLE.  IF A CURSOR IS IN THE TERMINAL, RCURS IS       00119021
*        CALLED TO REMOVE IT. THE OACB IS CHECKED TO SEE IF THE DATA    00126021
*        FOR THE CURSOR LOCATION IS STILL IN MAIN CORE. IF SO, THE      00133021
*        PHYSICAL ADDRESS OF THE CURSOR IS STORED AT GTMCRLOC. IF THE   00140021
*        DATA IS IN THE BUFFER, THE CURSOR IS INSERTED IN THE BUFFER    00147021
*        BY A GCNTRL.                                                   00154021
*                                                                       00161021
*ENTRY POINTS: IFFADA03                                                 00168021
*                                                                       00175021
*INPUT: REGISTER 1 POINTS TO A WORKAREA. THE FIRST WORD CONTAINS THE    00182021
*        ADDRESS OF THE PARAMETER LIST, THE SECOND, THAT OF THE RETURN  00189021
*        CODE ARRAY.                                                    00196021
*                                                                       00203021
*        THE PARAMETER LIST IS                                          00210021
*    + 0 A(POINTER TO THE GDSCB)                                        00217021
*                                                                       00224021
*        AT LEAST ONE OF THE FOLLOWING TWO PARAMETERS MUST BE VALID IF  00231021
*        LEVEL 1 CORRELATION IS USED. IF LEVEL 2 CORRELATION IS USED,   00238021
*        A VALID KEY MUST BE PRESENT.                                   00245021
*    + 4 A(CORRVAL)                                                     00252021
*                                                                       00259021
*    + 8 A(KEY)                                                         00266021
*                                                                       00273021
*        THE LAST PARAMETER IS OPTIONAL. A COUNT OF 1 IS ASSUMED IF IT  00280021
*        IS NOT PRESENT                                                 00287021
*    +12 A(CHARACTER COUNT)                                             00294021
*                                                                       00301021
*OUTPUT: NONE TO THE USER. THE GTMCB AND GDSCB CURSOR FIELDS ARE SET    00308021
*        APPROPRIATELY. IF THE ELEMENT IS IN THE BUFFER, THE CURSOR IS  00315021
*        INSERTED.                                                      00322021
*                                                                       00329021
*EXTERNAL ROUTINES: RCURS, KEY TABLE MANAGEMENT, GCNTRL                 00336021
*                                                                       00343021
*EXITS-NORMAL AND ERROR: VIA RETURN MACRO TO DIRECTOR                   00350021
*                                                                       00357021
*TABLES/WORKAREAS: GSP WORKAREA, BUFFER CONTROL TABLE, OACB             00364021
*                                                                       00371021
*ATTRIBUTES: PROBLEM STATE, REENTRANT                                   00378021
*                                                                       00385021
IFFADA03 CSECT                                                          00392021
*2025,220000,232000,246000-252000                                  000A 00394021
*2025                                                              9375 00396021
R0       EQU   0                                                        00400021
R1       EQU   1                       SYSTEM USE                       00600021
R2       EQU   2                       WORK                             00800021
R3       EQU   3                       WORK                             01000021
R4       EQU   4                       WORK                             01200021
R5       EQU   5                                                        01400021
R6       EQU   6                                                        01600021
R7       EQU   7                                                        01800021
PARBSE7  EQU   7                       PARAM LIST BASE                  02000021
BASE8    EQU   8                       GSPCB BASE                       02200021
BASE9    EQU   9                       INSCUR CSECT BASE                02400021
BASE10   EQU   10                      WORK AREA BASE                   02600021
BASE11   EQU   11                      GDSCB BASE                       02800021
BASE12   EQU   6                       GTMCB BASE                       03000021
R13      EQU   13                      SYSTEM USE                       03200021
R14      EQU   14                      SYSTEM USE                       03400021
R15      EQU   15                      SYSTEM USE                       03600021
D0       EQU   0                                                        03800021
D1       EQU   1                                                        04000021
D2       EQU   2                                                        04200021
D4       EQU   4                                                        04400021
D5       EQU   5                                                        04600021
D6       EQU   6                                                        04800021
D8       EQU   8                                                        05000021
D16      EQU   16                                                       05200021
D12      EQU   12                                                       05400021
D24      EQU   24                                                       05600021
D48      EQU   48                                                       05800021
D52      EQU   52                                                       06000021
D204     EQU   204                                                      06200021
D828     EQU   828                                                      06400021
EIGHT    EQU   8                                                        06600021
HEX00    EQU   X'00'                                                    06800021
HEX01    EQU   X'01'                                                    07000021
HEX02    EQU   X'02'                                                    07200021
HEX03    EQU   X'03'                                                    07400021
HEX04    EQU   X'04'                                                    07600021
HEX08    EQU   X'08'                                                    07800021
HEX10    EQU   X'10'                                                    08000021
HEX15    EQU   X'15'                                                    08200021
HEX20    EQU   X'20'                                                    08400021
HEX30    EQU   X'30'                                                    08600021
HEX40    EQU   X'40'                                                    08800021
HEX2A    EQU   X'2A'                                                    09000021
HEX7F    EQU   X'7F'                                                    09200021
HEXBF    EQU   X'BF'                                                    09400021
HEXC0    EQU   X'C0'                                                    09600021
HEXEB    EQU   X'EB'                                                    09800021
HEXEC    EQU   X'EC'                                                    10000021
HEXFF    EQU   X'FF'                                                    10200021
L8       EQU   8                                                        10400021
LASTPARM EQU   X'80'                                                    10600021
LVL2     EQU   X'10'                                                    10800021
TSTCUR   EQU   X'01'                                                    11000021
TWO      EQU   2                                                        11200021
         TITLE 'ICURS-IFFADA03-INSERT CURSOR'                           11400021
INSCUR   SAVE  (14,12)                                                  11600021
         BALR  BASE9,0                 INITIALIZE R9 AS CSECT BASE      11800021
         USING *,BASE9                                                  12000021
         USING GSPCB,BASE8                                              12200021
         USING WKADSECT,BASE10                                          12400021
         USING GDSCB,BASE11                                             12600021
         USING GTMCB,BASE12                                             12800021
         USING PARLIST,PARBSE7                                          13000021
         LR    BASE10,R1               INITIALIZE R10 AS WORK AREA BASE 13200021
         L     PARBSE7,D0(R1)          INITIALIZE R7 AS PARAM LIST BASE 13400021
*                                      LOAD ADDR OF PARAM LIST          13600021
         L     R3,PARGDSNM             LOAD ADDR OF VARIABLE GDS        13800021
         L     BASE11,D0(R3)           INITIALIZE R11 AS GDSCB BASE     14000021
         L     BASE12,GDSGTMCB         INITIALIZE R12 AS GTMCB BASE     14200021
         L     BASE8,GTMGSPCB          INITIALIZE R8 AS GSPCB BASE      14400021
         XC    GSPARRAY(20),GSPARRAY   ZERO RETURN ARRAY                14600021
*   INITIALIZE SAVE FIELDS                                              14800021
         ST    R13,SAVE+4              CHAIN SAVE AREAS                 15000021
         LA    R2,SAVE                                                  15200021
         ST    R2,8(R13)                                                15400021
         LR    R13,R2                  ESTABLISH NEW SAVE AREA          15600021
*   IS THERE A VALID GDS                                                15800021
         CL    BASE11,GDSGDSCB         HAS THE GDS BEEN OPENED          16000021
         BNE   INVALID                 NO                               16200021
         XC    CVSW(256),CVSW          ZERO WORK AREA                   16400021
         XC    CVSW+256(256),CVSW+256  ZERO WORK AREA                   16600021
         CLI   PARGDSNM,LASTPARM       IS GDSNAME LAST PARM             16800021
         BE    INVALID                 YES                              17000021
TEMPSTRT EQU   *                                                        17200021
*   TEST AND SAVE PARAMETERS BASED ON LEVEL 1 OR 2                      17400021
         TM    GDSFLAGS,LVL2           IS GDS LEVEL 2                   17600021
         BO    PARMCKL2                YES                              17800021
*   I HAVE A LEVEL 1 GDS WHICH INDICATES THE PRESENCE OF A KEYTABLE     18000021
         L     R3,PARCVAL              LOAD SECOND PARM-CORRVAL         18200021
         CLC   PARCVAL+1(3),GSPNULLV+1     TEST FOR NULL                18400021
         BNE   SETCVSW                 NO-I HAVE GOOD CORRVAL           18600021
*   IF CORRVAL IS LAST PARM AND IT IS NULL AN INVALID CONDITION EXISTS  18800021
         CLI   PARCVAL,LASTPARM        IS CV LAST PARAMETER             19000021
         BE    NOCVKEY                 YES                              19200021
*   NO CORRVAL PRESENT - TEST FOR KEY PRESENT                           19400021
         CLC   PARKEY+1(3),GSPNULLV+1  IS KEY PARM = NULL               19600021
         BE    NOCVKEY                 YES-IT IS NULL KEY PRESENT       19800021
KEYSRCH  EQU   *                                                        20000021
*   USE KEYTABLE ROUTINE TO GET ADDR OF KEY                             20200021
         MVI   CVKEYSW,HEX10           SET SW EQUAL KEY SEARCH          20400021
         MVC   MYPARLST+8(4),PARKEY    PUT ADDR OF KEY INTO PARM LIST   20600021
         MVC   CODEADDR(4),CODE2                                        20800021
*   INVOKE KEYTABLE ROUTINE                                             21000021
KEYTBL   EQU   *                                                        21200021
         L     R5,GSPASTAT             GET ADDR OF STATUS TABLE         21400021
         L     R15,D828(R5)            GET EP ADR OF KEYTABLE           21600021
         LTR   R15,R15                 IF ZERO,ROUTINE NOT IN           21800021
         BZ    INVALID             GO TO ERROR RTN                 000A 22000021
GOKT     LA    R3,CODEADDR                                              22200021
         ST    R3,MYPARLST+4                                            22400021
         ST    BASE11,MYPARLST         STORE ADDRESS OF GDS             22600021
         OI    MYPARLST+8,LASTPARM     INSERT LAST PARM BIT             22800021
         LA    R1,MYPARLST             PASS ADDR OF MY PARLIST          23000021
         BALR  R14,R15             BRANCH TO KEY TABLE MGMT        000A 23200021
         LTR   R15,R15                 ANY ERRORS                       23400021
         BC    7,TEST                                                   23600021
         CLI   CVKEYSW,HEX10           IS RETURN TO KEY                 23800021
         BNE   TOCVAL                  NO, RETURN TO CORVAL             24000021
         B     TOKEY                                                    24200021
*                                                                       24400021
*                                                                       25400021
**********                                                              25600021
TOKEY    EQU   *                                                        25800021
         LTR   R1,R1                   WAS ADDRESS FOUND                26000021
         BZ    PARMERR3                NO                               26200021
         ST    R1,KEYCHAR              SAVE KEY ADDR                    26400021
TSTCOUNT EQU   *                                                        26600021
         CLI   PARKEY,LASTPARM         IS KEY LAST PARAMETER            26800021
         BE    NOCTPARM                YES                              27000021
         L     R2,PARCOUNT             LOAD ADDR OF FOURTH PARAM-COUNT  27200021
         CLC   PARCOUNT+1(3),GSPNULLV+1   TEST FOR NULL                 27400021
         BE    NOCTPARM                YES-THERE IS NO COUNT PARAM      27600021
         L     R3,D0(R2)               PICK UP COUNT FIELD              27800021
         STH   R3,COUNTSV              SAVE THE COUNT PARAM             28000021
TSTCVSW  EQU   *                                                        28200021
*   TEST SWITCH TO SEE IF CORRVAL PRSEENT                               28400021
         CLI   CVSW,HEX01              CORRVAL PRESENT                  28600021
         BE    UPDATECV                YES-REPLACE OLD CORRVAL          28800021
COMMON   EQU   *                                                        29000021
*   COUNTSV FIELD CONTAINS COUNT-IF ANY OR ZERO                         29200021
*   KEYCHAR FIELD CONTAINS PTR TO KEYTABLE IF LVL 1 OR TO USER KEY      29400021
*   IF LVL 2                                                            29600021
*   TEST OACB ADDRESSES TO SEE IF DATA IN MAIN STORAGE                  29800021
         L     R2,KEYCHAR              GET ADDRESS OF KEY               30000021
         LH    R3,D2(R2)               GET LOG BUF ADDR FRM KEY         30200021
         L     R4,GDSAOACB             GET ADDR OF ACTIVE OACB          30400021
         L     R5,D48(R4)              GET LOG BUFF START ADDR FRM OACB 30600021
         CR    R5,R3                   BUF START OACB MORE THAN FRM KEY 30800021
         BH    COMPPHYS                YES-DATA HAS GONE TO BUFFER      31000021
         L     R2,D52(R4)              GET LOG ADDR NEXT AVAIL IN GDOA  31200021
         CR    R2,R3                   BUF END OACB MORE THAN FRM KEY   31400021
         BL    INVALID                 NO-NOT IN MAIN STORAGE OR BUFFER 31600021
*   DATA MUST BE IN MAIN STORAGE OF GDOA                                31800021
*   SET FLAG TO INDICATE PHYS LOCATION IS STILL IN MAIN STORAGE         32000021
         MVI   MSTOSW,HEX01                                             32200021
COMPPHYS EQU   *                                                        32400021
*   COMPUTE PHYS BUFF-ADDR INITIALIZE POINTER AND FLAGS                 32600021
*   R3 MUST CONTAIN ADDRESS OF LOGICAL BUFFER UPON ENTRY                32800021
         ST    R2,TMPSV                SAVE R2                          33000021
         STM   R4,R7,TMPSV+4           SAVE R4,R5,R6,R7                 33200021
*   COMPUTE PHYSICAL ADDR FROM LOG ADDR FOR LVL1                        33400021
         L     R2,KEYCHAR              GET ADDRESS OF KEY               33600021
         LH    R3,D2(R2)               GET LOG BUF ADDR FRM KEY         33800021
         TM    GDSFLAGS,LVL2           IS GDS LEVEL2                    34000021
         BO    CTPARTST                YES                              34200021
         TM    D4(R2),HEX08            DOES ELEMENT CONTAIN             34400021
         BZ    INDFPRER                CHARACTER OUTPUT                 34600021
         TM    D4(R2),HEX30            NO, INVALID KEY, GDS             34800021
         BC    7,INDFPRER              OR CORRVAL                       35000021
         LH    R4,D0(R2)               GET LOG BUF LNGTH FRM KEY        35200021
         SR    R5,R5                                                    35400021
*   PICK YP COUNT OF CHAR FROM KEY WHICH IS NOT ON HALF WORD BOUNDARY   35600021
         IC    R5,D5(R2)               GET FIRST BYTE OF CHAR CT        35800021
         SLL   R5,L8                   SHIFT IT LEFT                    36000021
         IC    R5,D6(R2)               PICK UP COUNT OF CHAR FRM KEY    36200021
         SR    R4,R5                   SUB CHAR CT FRM BUF LNGTH        36400021
         LA    R2,0(R3,R4)             ADD THE BUF LNGTH TO LOG ADDR    36600021
CTPARTST EQU   *                                                        36800021
         LH    R1,COUNTSV              PICK UP COUNT PARAM              37000021
         LTR   R1,R1                   IS IT ZERO                       37200021
         BC    7,ADDLGTH               NO                               37400021
DVDGDOA  EQU   *                                                        37600021
         LH    R7,GDSGDOAL             GET LENGTH OF GDOA               37800021
         S     R7,SIX                                                   38000021
         SRDA  R2,32                                                    38200021
         DR    R2,R7                   DVD GDOA-6 INTO MODIFIED LOG B A 38400021
         STH   R2,REMAINDR             SAVE THE REMAINDER               38600021
         LH    R4,GDSBCTEL             GET BUF CTL ELEMENT              38800021
STRTBCT  EQU   *                                                        39000021
         MH    R4,THREE+2                                               39200021
         A     R4,GTMBCTBL             ADD START OF BCT(R4=POS IN BCT)  39400021
         SR    R2,R2                                                    39600021
         IC    R2,D2(R4)               GET CT FIELD FROM BCT            39800021
         CR    R2,R3                   IS BCT CT FLD EQUAL QUOT OF DVDE 40000021
         BNE   NXTENTRY                                                 40200021
         LR    R5,R4         SAVE BCT ENTRY ADR FOR HALF BFR CHECK 9375 40300021
         S     R4,GTMBCTBL             SUB START ADDR OF BCT            40400021
         LR    R2,R4                   PREPARE FOR DIVIDE               40600021
         SRDA  R2,32                                                    40800021
         D     R2,THREE                DIVIDE BCT ELEMENT BY 3          41000021
         SLA   R3,EIGHT                MPY QUOT BY 256                  41200021
         AH    R3,REMAINDR             ADD REMAINDER                    41400021
         AH    R3,CONTWO               ADD TWO FOR SET MODE             41600021
         CLC   GDSBCTID,D0(R5)    IF NOT EQUAL ID IS IN BYTE 2,    9375 41640021
         BE    NOHALF               INDICATING 128 BYTE BFR SIZE   9375 41680021
         AH    R3,HALFBUF           LOCATED IN LAST HALF OF BFR    9375 41720021
NOHALF   EQU   *                                                   9375 41760021
*   R3 NOW CONTAINS PHYS ADDR                                           41800021
         L     R2,TMPSV                RESTORE R2                       42000021
         LM    R4,R7,TMPSV+4           RESTORE R4,R5,R6,R7              42200021
*   IS THERE A CURSOR PRESENT IN THIS TERMINAL                          42400021
         TM    GTMFLAGS,TSTCUR                                          42600021
         BO    RESET                   YES, REMOVE IT                   42800021
*   R3 NOW CONTAINS THE PHYSICAL BUFF ADR FROM THE LOG VIA BCT          43000021
*   STORE PHYS ADDR OF LOCATION REQUIRING CURSOR IN GTMCB               43200021
RESETRTN EQU   *                                                        43400021
         STH   R3,GTMCRLOC             PUT PHY BUF LOC NEEDING CUR GTM  43600021
         OI    GTMFLAGS,HEX01          SET GTM CURSOR IN FLAG           43800021
         OI    GDSFLAGS,HEX20          SET GDS CURSOR IN FLAG           44000021
*   TEST FLAG TO SEE IF DATA IS IN MAIN STORAGE                         44200021
         CLI   MSTOSW,HEX01                                             44400021
         BE    ALLDONE                                                  44600021
INSRTCUR EQU   *                                                        44800021
**********                                                              45000021
*** SET UP PARAMETERS AND ISSUE GCNTRL                                  45200021
**********                                                              45400021
         STH   R3,INSADDR                                               45600021
         LA    R1,DUMYCTL1                                              45800021
         LA    R4,INSADDR                                               46000021
         L     R5,GTMGRDCB             GET ADDR OF TERM DCB             46200021
         XC    0(32,R1),0(R1)          ZERO DECB                        46400021
         GCNTRL (R1),INS,(R5),(R4),MF=E   BUILD ECB AND INSERT CURSOR   46600021
         WAIT  ECB=DUMYCTL1                                             46800021
         CLI   DUMYCTL1,X'7F'          I/O SUCESSFUL                    47000021
         BNE   IOERRTN                 NO                               47200021
*   USE FLO CTL ADR FROM GDSCB FOR RESTART GENERATION                   47400021
         L     R3,GTMGRDCB             GET ADR OF UNIT DCB              47600021
         L     R4,GTMFCTBL             GET POINTER TO BUFFER            47800021
         LA    R4,8(R4)                ADDRESS IN FCT                   48000021
         XC    REGENCTL(32),REGENCTL    ZERO DECB                       48200021
         GCNTRL REGENCTL,STR,(R3),(R4),MF=E  RESTART REGENERATION       48400021
         WAIT  ECB=REGENCTL                                             48600021
         CLI   REGENCTL,HEX7F          I/O SUCCESSFUR                   48800021
         BNE   IOERRTN                 NO                               49000021
         XC    GTMCRLOC(2),GTMCRLOC    ZERO CURSOR LOCATION AFTER       49200021
*                                      IT IS INSERTED                   49400021
         B     ALLDONE                 RETURN CODE IS ZERO              49600021
IOERRTN  EQU   *                                                        49800021
         MVI   GSPARRAY,HEX04          I/O ERROR                        50000021
         MVI   GSPARRAY+19,HEX00       NO ADD INFO CODE                 50200021
         B     ALLDONE                                                  50400021
ADDLGTH  EQU   *                                                        50600021
         AR    R2,R1                   ADD COUNT TO LOG ADDR            50800021
         S     R2,ONE                                                   51000021
         L     R1,GDSAOACB             GET ADDRESS OF OACB              51200021
         C     R2,D52(R1)              ADDRESS LESS THAN OLP            51400021
         BNL   INDFPRER                NO, INVALID PARAMETER(S)         51600021
         C     R2,D48(R1)              IN BUFFER                        51800021
         BL    DVDGDOA                 YES, GET PHYSICAL ADDRESS        52000021
         MVI   MSTOSW,HEX01            NO, SET IN CORE FLAG             52200021
         B     DVDGDOA                                                  52400021
NXTENTRY EQU   *                                                        52600021
*   IF OLD BCTL IS THE SAME AS THE PTR FIELD IN BCT AND CT FIELD IN     52800021
*   BCT DOES NOT EQUAL QUOT THEN THE PHYS ADDR IS NOT IN USERS BUFFER   53000021
         SR    R5,R5                                                    53200021
         IC    R5,D1(R4)               GET PTR FLD FRM BCT              53400021
         CR    R2,R5                   CPR TO OLD BCTEL                 53600021
         BE    ERR                                                      53800021
         LR    R4,R5                   PUT NEW PTR INTO OLD BCTEL       54000021
         B     STRTBCT                                                  54200021
NOCTPARM EQU   *                                                        54400021
*   RESET COUNT PARAM SAVE AREA TO ZERO                                 54600021
         XC    COUNTSV(2),COUNTSV      ZERO COUNTSV FIELD               54800021
         B     TSTCVSW                                                  55000021
UPDATECV EQU   *                                                        55200021
*   REPLACE CORVAL IN KEY TABLE WITH CORRVAL FROM PARAM LIST            55400021
         L     R2,KEYCHAR                                               55600021
         L     R1,PARCVAL              GET ADDR OF CORVAL               55800021
         MVC   D8(D4,R2),D0(R1)        MOVE CV TO KEY                   56000021
         B     COMMON                                                   56200021
RESET    EQU   *                                                        56400021
*   CONSTRUCT PARAM LIST AND INVOKE REMOVE CURSOR  TO CLEAN             56600021
*   TERMINAL BEFORE INSERTING NEW CURSOR                                56800021
*   INVOKE RESET CURSOR ROUTINE                                         57000021
         MVC   MYPARLST(4),PARGDSNM    GDSNAME FOR RCURS                57200021
         OI    MYPARLST,LASTPARM       INSERT LAST PARAM BIT            57400021
         LA    R2,MYPARLST             POINTERS TO GDSNAME              57600021
         ST    R2,MYPARLST+4                                            57800021
         MVC   MYPARLST+8(4),WKADSECT+4 AND GSPARRAY                    58000021
         LA    R1,MYPARLST+4                                            58200021
         XC    SUPVWORK(16),SUPVWORK   CLEAR SUPERVISOR AREA            58400021
         LA    R15,SUPVWORK            GET POINTER TO IT                58600021
         LINK  EP=IFFADA02,MF=(E,(1)),SF=(E,(15))                       58800021
         CLI   GSPARRAY,HEX00          ANY ERRORS                       59000021
         BNE   INVALID                 YES                              59200021
         B     RESETRTN                NO, CONTINUE PROCESSING          59400021
PARMCKL2 EQU   *                                                        59600021
*   IF LAST PARM BIT IS ON IN CV AN ERROR CONDITION EXISTS              59800021
         CLI   PARCVAL,LASTPARM        IS CV LAST PARAM                 60000021
         BE    NOCVKEY                                                  60200021
*   I HAVE A LEVEL TWO GDS NO KEYTABLE PRESENT                          60400021
*   GET LOG BUF ADDR FROM USER SUPPLIED LOCATION                        60600021
         CLC   PARKEY+1(3),GSPNULLV+1  IS KEY PARM = NULL               60800021
         BE    INDFPRER                YES, INVALID CALL                61000021
         MVC   KEYCHAR(4),PARKEY       SAVE ADDRESS OF USER KEY WORD    61200021
         B     TSTCOUNT                                                 61400021
SETCVSW1 EQU   *                                                        61600021
*   VALID CORRVAL-SEARCH USING R3 FOR CVAL ADDR                         61800021
*   USE KEYTABLE RTN TO GET ADDR OF KEY ASSOCIATED WITH CV ADDR         62000021
         MVI   CVKEYSW,HEX00           SET SWITCH EQUAL TO CV SEARCH    62200021
SETCVSW2 EQU   *                                                        62400021
         MVC   MYPARLST+8(4),PARCVAL   PUT ADDR OF CORL IN PARM LIST    62600021
         MVC   CODEADDR(4),CODE5                                        62800021
         B     KEYTBL                                                   63000021
**********                                                              63200021
TOCVAL   EQU   *                                                        63400021
         LTR   R1,R1                   WAS ADDR FOUND                   63600021
         BZ    NOCVKEY                 NO                               63800021
         ST    R1,KEYCHAR              PUT INTO KEY SAVE                64000021
         CLI   CVKEYSW,HEX00           CORVAL LAST PARAMETER            64200021
         BE    TSTCOUNT                NO, TEST COUNT                   64400021
         B     NOCTPARM                YES, SET COUNT=0                 64600021
TEST     EQU   *                                                        64800021
         CLI   CVKEYSW,HEX10                                            65000021
         BE    PARMERR3                                                 65200021
         B     NOCVKEY                                                  65400021
SETCVSW  EQU   *                                                        65600021
*   IS CORRVAL LAST PARM                                                65800021
         CLI   PARCVAL,LASTPARM        LAST PARM BIT ON                 66000021
         BE    NOPARM                  YES                              66200021
*   I HAVE A LVL 1 CORRVAL-TEST FOR KEY PARM                            66400021
         L     2,PARKEY                GET THE ADDRESS OF THE KEY       66600021
         CLC   PARKEY+1(3),GSPNULLV+1  IS KEY PARM = NULL               66800021
         BE    SETCVSW1                YES-IT IS NULL KEY PRESENT       67000021
         L     R3,D0(R2)               PICK UP KEY                      67200021
NOPARTN  EQU   *                                                        67400021
         MVI   CVSW,HEX01              PARM CV GOES TO KEY CV           67600021
         B     KEYSRCH                                                  67800021
NOPARM   EQU   *                                                        68000021
         MVI   CVKEYSW,HEX20           CORVAL SEARCH, NO KEY OR COUNT   68200021
         B     SETCVSW2                                                 68400021
INDFPRER MVI   GSPARRAY,HEX08          INDEFINITE PARAMETER ERROR       68600021
         B     ALLDONE                                                  68800021
INVALID  EQU   *                                                        69000021
         MVI   GSPARRAY,HEX08          PARM ERROR                       69200021
         MVI   GSPARRAY+19,HEX01       GDSNAME INVALID                  69400021
         B     ALLDONE                                                  69600021
NOCVKEY  EQU   *                                                        69800021
         MVI   GSPARRAY,HEX08          PARM ERROR                       70000021
         MVI   GSPARRAY+19,HEX02       CORRVAL PARM INVALID             70200021
         B     ALLDONE                                                  70400021
PARMERR3 EQU   *                                                        70600021
         MVI   GSPARRAY,HEX08          PARM ERROR                       70800021
         MVI   GSPARRAY+19,HEX03       KEY   PARAM INVALID              71000021
         B     ALLDONE                                                  71200021
ERR      EQU   *                                                        71400021
*   NO SUCH ADDR                                                        71600021
         MVI   GSPARRAY,HEX08          PARM ERROR                       71800021
         MVI   GSPARRAY+19,HEX04       COUNT PARAM INVALID              72000021
ALLDONE  EQU   *                                                        72200021
         L     R13,SAVE+4              RESTORE REG 13                   72400021
         RETURN (14,12),T                                               72600021
MDFYCT   EQU   *                                                        72800021
         DS    0F                                                       73000021
GRDCBTMP EQU   *                                                        73200021
TMPCURTO EQU   *                                                        73400021
CONTWO   DC    H'2'                                                     73600021
HALFBUF  DC    H'128'                  ADJUST TO LAST HALF OF BFR  9375 73700021
ZERO     DC    F'0'                                                     73800021
ONE      DC    F'1'                                                     74000021
CODE2    DC    F'2'                                                     74200021
CODE5    DC    F'5'                                                     74400021
THREE    DC    F'3'                                                     74600021
SIX      DC    F'6'                                                     74800021
ORDRTAB  DC    X'40414445505152FF'     TABLE OF POSSIBLE SET CHARACTER  75000021
*                                      MODE ORDER CODES                 75200021
         EJECT                                                          75400021
*   THIS DSECT PROVIDES SYMBOLIC REFERENCES TO                          75600021
*   FIELDS OF THE WORK AREA OF USER CORE                                75800021
WKADSECT DSECT                                                          76000021
         DS    F                       CONTAINS POINTER TO PARM LIST    76200021
         DS    F                       POINTS TO RETURN ARRAY           76400021
SAVE     DS    18F                     INSCUR SAVE AREA                 76600021
CVSW     DS    X                       IS CORRVAL PRESENT               76800021
SWONE    DS    X                       SET ON FIRST TEST FOR SM         77000021
MSTOSW   DS    X                       PHYS LOC IN MAIN STORAGE         77200021
CVKEYSW  DS    X                                                        77400021
COUNTSV  DS    H                       CONTAINS COUNT PARM VALUE        77600021
REMAINDR DS    H                       PHYS BUF REM SAVE AREA           77800021
PRODUCT  DS    H                       PHYS BUF STRT ADDR ?             78000021
INSADDR  DS    H                       PTR TO CURSOR ISERT LOCATION     78200021
REGENCTL DS    19F                     GCNTL EXPANSION                  78400021
KEYCHAR  DS    F                       CONTAINS ADDR OF KEY             78600021
TMPSV    DS    6F                      SAVE FOR COM PHY BUF RTN         78800021
DUMYCTL1 DS    19F                     DECB SAVE AREA FOR GCNTRL        79000021
SUPVWORK DS    4F                                                       79200021
CODEADDR DS    F                                                        79400021
MYPARLST DS    3F                      PAR LIST FOR MY CALLS            79600021
         EJECT                                                          79800021
*   THIS DSECT PROVIDES SYMBOLIC REFERENCES TO                          80000021
*   FIELDS IN THE PARAMETER LIST                                        80200021
PARLIST  DSECT                                                          80400021
PARGDSNM DS    F                       GDSNAME                          80600021
PARCVAL  DS    F                       CORRVAL(VALID ONLY IN LVL 1)     80800021
PARKEY   DS    F                       KEY                              81000021
PARCOUNT DS    F                       CHAR COUNT (L1 COUNT VALUE IS    81200021
*                                      CHAR ONLY - L2 COUNT VALUE       81400021
*                                      INCLUDES CHAR AND ORDERS)        81600021
         COPY  GSPCB                                                    81800021
         COPY  GTMCB                                                    82000021
         COPY  GDSCB                                                    82200021
         END                                                            82400021
./  ADD  SSI=20480130,NAME=IFFAEA01
         TITLE 'IFFAEA01 - SDATM - SET DATA MODE'                       00600021
*STATUS: CHANGE LEVEL 000                                               00900021
*                                                                       01200021
*FUNCTION/OPERATION:  SETS GDSDATMD TO INDICATE MODE AND FORM OF INPUT  01500021
*        COORDINATES PASSED FOR A GDS .                                 01800021
*                                                                       02100021
*        IF THE DATA MODE IS CHANGED BY THE CALL, THE MODE OF THE DATA  02400021
*        LIMITS IN THE GDSCB ARE CONVERTED AS NECESSARY.                02700021
*                                                                       03000021
*ENTRY POINTS: IFFAEA01                                                 03300021
*                                                                       03600021
*INPUT:  REGISTER 1 POINTS TO A WORKAREA. THE FIRST WORD CONTAINS THE   03900021
*        ADDRESS OF THE PARAMETER LIST. THE SECOND CONTAINS THE ADDRESS 04200021
*        OF THE RETURN ARRAY                                            04500021
*                                                                       04800021
*        REQUIRED PARAMETERS ARE                                        05100021
*     +0 A(POINTER TO GDSCB)                                            05400021
*                                                                       05700021
*     +4 A(X-MODE CODE)                                                 06000021
*                                                                       06300021
*        AN OPTIONAL PARAMETER IS                                       06600021
*     +8 A(Y-MODE CODE)                                                 06900021
*        IF THIS IS NOT PRESENT, THE SAME MODE IS ASSUMED FOR X AND Y   07200021
*                                                                       07500021
*OUTPUT: NONE TO USER. GDSDATMD SWITCH IS SET IN THE GDSCB.             07800021
*                                                                       08100021
*EXTERNAL ROUTINES: IFFAHA15                                            08400021
*                                                                       08700021
*EXITS-NORMAL: VIA RETURN MACRO TO DIRECTOR                             09000021
*                                                                       09300021
*     -ERROR: VIA RETURN MACRO TO DIRECTOR                              09600021
*                                                                       09900021
*TABLES/WORKAREA: GSP WORKAREA                                          10200021
*                                                                       10500021
*ATTRIBUTES: PROBLEM STATE, REENTRANT                                   10800021
*                                                                       11100021
IFFAEA01 CSECT                                                          11400021
         SAVE  (14,12)                                                  11700021
         BALR  DAT09,0                 ESTABLISH ADDRESSABILITY         12000021
         USING *,DAT09                 FOR CSECT                        12300021
*                                                                       12600021
         LR    DAT11,DAT01             ADDRESSABILITY FOR               12900021
         USING DATWORK,DAT11           WORKAREA                         13200021
*                                                                       13500021
         LA    DAT02,DWKSAVE           CHAIN                            13800021
         ST    DAT13,HSVA(DAT02)       SAVE AREAS                       14100021
         ST    DAT02,MSVA(DAT13)       AND ESTABLISH                    14400021
         LR    DAT13,DAT02             NEW SAVE AREA                    14700021
         L     DAT10,DWKPARM           ADDRESSABILITY FOR               15000021
         USING DATPARM,DAT10           PARAMETER LIST                   15300021
*                                                                       15600021
         L     DAT12,DPMGDSCB          ADDRESSABILITY FOR               15900021
         L     DAT12,0(DAT12)          GDSCB                            16200021
         USING GDSCB,DAT12                                              16500021
*                                                                       16800021
         L     DAT08,DWKRTNA           ADDRESSABILITY FOR RETURN ARRAY  17100021
         USING GSPARRAY,DAT08          AND NULL VARIABLE                17400021
*                                                                       17700021
         XC    DWKDAT(4),DWKDAT        CLEAR WORKAREA                   18000021
         C     DAT12,GDSGDSCB          IS GDSCB OPEN                    18300021
         BNE   DAT010                  NO, SET RETURN CODE              18600021
*                                                                       18900021
         XC    DWKFIX(4),DWKFIX                                         19000021
         TM    DPMGDSCB,X'80'          UMODE PARAMETER PRESENT          19200021
         BO    DAT012                  NO, INVALID                      19500021
         L     DAT02,DPMUMODE          GET ADDRESS OF UMODE             19800021
         CLC   DPMUMODE+1(3),GSPNULLV+1  EQUAL TO NULL VARIABLE         20100021
         BE    DAT012                  YES, INVALID CODE                20400021
         L     DAT03,0(DAT02)          GET VALUE OF PARAMETER           20700021
         C     DAT03,DAT0001           X REAL, ABSOLUTE                 21000021
         BNE   DAT001                  CHECK FURTHER                    21300021
         MVI   DWKDATA,XRA                                              21600021
         B     DAT004                  CHECK VMODE                      21900021
*                                                                       22200021
DAT001   C     DAT03,DAT0002           X REAL, INCREMENTAL              22500021
         BNE   DAT002                  CHECK FURTHER                    22800021
         MVI   DWKDATA,XRI                                              23100021
         B     DAT004                  CHECK VMODE                      23400021
*                                                                       23700021
DAT002   C     DAT03,DAT0003           X INTEGER, ABSOLUTE              24000021
         BNE   DAT003                  CHECK FURTHER                    24300021
         MVI   DWKDATA,XIA                                              24600021
         B     DAT004                  CHECK VMODE                      24900021
*                                                                       25200021
DAT003   C     DAT03,DAT0004           X INTEGER, INCREMENTAL           25500021
         BNE   DAT012                  INVALID CODE                     25800021
         MVI   DWKDATA,XII                                              26100021
*                                                                       26400021
DAT004   TM    DPMUMODE,X'80'          VMODE PASSED                     26700021
         BO    DAT009                  NO, SET = UMODE                  27000021
         L     DAT02,DPMVMODE          GET ADDRESS OF VMODE             27300021
         CLC   DPMVMODE+1(3),GSPNULLV+1  EUAL TO NULL VARIABLE          27600021
         BE    DAT009                  YES, SET = UMODE                 27900021
*                                                                       28200021
         L     DAT03,0(DAT02)          GET VALUE OF PARAMETER           28500021
         C     DAT03,DAT0001           Y REAL, ABSOLUTE                 28800021
         BNE   DAT005                  CHECK FURTHER                    29100021
         OI    DWKDATA,YRA                                              29400021
         B     DAT008                  SET GDSDATMD                     29700021
*                                                                       30000021
DAT005   C     DAT03,DAT0002           Y REAL, INCREMENTAL              30300021
         BNE   DAT006                  CHECK FURTHER                    30600021
         OI    DWKDATA,YRI                                              30900021
         B     DAT008                  SET GDSDATMD                     31200021
*                                                                       31500021
DAT006   C     DAT03,DAT0003           Y INTEGER, ABSOLUTE              31800021
         BNE   DAT007                  CHECK FURTHER                    32100021
         OI    DWKDATA,YIA                                              32400021
         B     DAT008                  SET GDSDATMD                     32700021
*                                                                       33000021
DAT007   C     DAT03,DAT0004           Y INTEGER, INCREMENTAL           33300021
         BNE   DAT013                  INVALID CODE                     33600021
         OI    DWKDATA,YII                                              33900021
*                                                                       34200021
DAT008   MVC   DWKDLLX(16),GDSUVLLL    GET DATA LIMITS                  34500021
         TM    GDSDATMD,XREAL          OLD X-MODE IS REAL               34800021
         BZ    DAT014                  NO                               35100021
         TM    DWKDATA,XREAL           YES, NEW X-MODE IS REAL          35400021
         BZ    DAT015                  NO, CONVERT                      35700021
DAT0080  TM    GDSDATMD,YREAL          YES, OLD Y-MODE IS REAL          36000021
         BZ    DAT016                  NO                               36300021
         TM    DWKDATA,YREAL           YES, NEW Y MODE IS REAL          36600021
         BZ    DAT017                  NO, CONVERT                      36900021
DAT0081  MVC   GDSUVLLL(16),DWKDLLX    STORE NEW DATA LIMITS AND        37200021
         MVC   GDSDATMD(1),DWKDATA     DATA MODE SWITCH                 37500021
         MVI   GSPARRAY,X'00'          GOOD RETURN                      37800021
         L     DAT13,HSVA(DAT13)                                        38100021
         RETURN (14,12)                                                 38400021
*                                                                       38700021
DAT009   L     DAT03,DWKDAT            GET SWITCH SETTING FOR UMODE     39000021
         SRL   DAT03,4                 SHIFT INTO POSITION FOR VMODE    39300021
         O     DAT03,DWKDAT            ASSEMBLE FULL SWITCH             39600021
         ST    DAT03,DWKDAT            AND STORE                        39900021
         B     DAT008                  SET GDSDATMD                     40200021
DAT010   MVC   GSPARRAY+16(4),DAT0001  GDSCB NOT OPEN                   40500021
DAT011   OI    GSPARRAY,BIT4           PARAMETER ERROR                  40800021
         L     DAT13,HSVA(DAT13)                                        41100021
         RETURN (14,12)                                                 41400021
*                                                                       41700021
DAT012   MVC   GSPARRAY+16(4),DAT0002  UMODE INVALID                    42000021
         B     DAT011                                                   42300021
*                                                                       42600021
DAT013   MVC   GSPARRAY+16(4),DAT0003  VMODE INVALID                    42900021
         B     DAT011                                                   43200021
*                                                                       43500021
DAT014   TM    DWKDATA,XREAL           NEW X-MODE IS REAL               43800021
         BZ    DAT0080                 NO, NO CONVERSION NECESSARY      44100021
         LA    DAT01,DWKDLLX           CONVERT                          44400021
         BAL   DAT14,DATFLOAT          DLLX AND DURX                    44700021
         LA    DAT01,DWKDURX           TO REAL VALUES                   45000021
         BAL   DAT14,DATFLOAT                                           45300021
         B     DAT0080                 TEST Y MODES                     45600021
*                                                                       45900021
DAT015   L     DAT02,GSPASTAT          IS CONVERSION ROUTINE IN CORE    46000021
         CLC   HA15(4,DAT02),DAT0000D                                   46100021
         BC    7,DAT015A               YES, GET ADDRESS                 46200021
         LOAD  EP=IFFAHA15             NO, LOAD IT                      46300021
         ST    DAT00,HA15(DAT02)       STORE ADDRESS IN STAT TAB        46400021
DAT015A  MVC   DWKFIX(4),HA15(DAT02)   GET ADDRESS IN WORKAREA          46500021
         L     DAT15,DWKFIX                     AND REGISTER 15         46600021
         L     DAT01,DWKDLLX           CONVERT                          47100021
         CALL  (15)                    DLLX                             47400021
         ST    DAT01,DWKDLLX           AND                              47700021
         LTR   DAT15,DAT15             DURX                             48000021
         BP    DAT018                  FROM                             48300021
         L     DAT01,DWKDURX           REAL                             48600021
         L     DAT15,DWKFIX            TO                               48900021
         CALL  (15)                    INTEGER                          49200021
         LTR   DAT15,DAT15                                              49500021
         BP    DAT018                                                   49800021
         ST    DAT01,DWKDURX                                            50100021
         B     DAT0080                                                  50400021
*                                                                       50700021
DAT016   TM    DWKDATA,YREAL           NEW Y MODE IS REAL               51000021
         BZ    DAT0081                 NO, NO CONVERSION NECCESSARY     51300021
         LA    DAT01,DWKDLLY           CONVERT                          51600021
         BAL   DAT14,DATFLOAT          DLLY AND DURY                    51900021
         LA    DAT01,DWKDURY           FROM INTEGER                     52200021
         BAL   DAT14,DATFLOAT          TO REAL                          52500021
         B     DAT0081                                                  52800021
*                                                                       53100021
DAT017   CLC   DWKFIX(4),DAT0000D      SEE IF CONVERSION ALREADY IN     53200021
         BNE   DAT017B                 HAVE ADDRESS IN WORKAREA         53300021
         L     DAT02,GSPASTAT                                           53400021
         CLC   HA15(4,DAT02),DAT0000D  SEE IF IN CORE                   53500021
         BNE   DAT017A                 YES, PUT ADDRESS IN WORKAREA     53600021
         LOAD  EP=IFFAHA15             NO, LOAD IT                      53700021
         ST    DAT00,HA15(DAT02)       STORE ADDRESS IN STAT TAB        53800021
DAT017A  MVC   DWKFIX(4),HA15(DAT02)   GET ADDRESS IN WORKAREA          53900021
DAT017B  L     DAT15,DWKFIX            GET ADDRDSS IN REGISTER 15       54000021
         L     DAT01,DWKDLLY           CONVERT                          54300021
         CALL  (15)                    DLLY                             54600021
         LTR   DAT15,DAT15             AND                              54900021
         BP    DAT018                  DURY                             55200021
         ST    DAT01,DWKDLLY           FROM                             55500021
         L     DAT01,DWKDURY           REAL                             55800021
         L     DAT15,DWKFIX            TO                               56100021
         CALL  (15)                    INTEGER                          56400021
         LTR   DAT15,DAT15                                              56700021
         BP    DAT018                                                   57000021
         ST    DAT01,DWKDURY                                            57300021
         B     DAT0081                                                  57600021
*                                                                       57900021
DAT018   OI    GSPARRAY,SCERR          SCALING ERROR IF REAL TO         58200021
         XC    GSPARRAY+8(4),GSPARRAY+8                                 58500021
         L     DAT13,HSVA(DAT13)       INTEGER CONVERSION CANNOT        58800021
         RETURN (14,12)                BE MADE                          59100021
*                                                                       59400021
DATFLOAT CLC   0(4,DAT01),DAT0000D     SEE IF NUMBER TO BE FLOATED      59700021
*                                      IS EQUAL TO ZERO                 60000021
         BCR   8,DAT14                 YES, RETURN                      60300021
         MVC   DWKDBLE(4),DATCON       SET UP CONVERSION CONSTANT       60600021
         TM    0(DAT01),X'80'          NEGATIVE NUMBER                  60900021
         BO    DATFLT2                 YES, SET SIGN BIT                61200021
DATFLT1A MVC   DWKDBLE+4(4),0(DAT01)   NO, MOVE NUMBER INTO AREA        61500021
DATFLT1  LD    DAT00F,DWKDBLE          NORMALIZE IT                     61800021
         AD    DAT00F,DAT0000D                                          62100021
         STE   DAT00F,0(DAT01)         STORE IT                         62400021
         BR    DAT14                   RETURN                           62700021
*                                                                       63000021
DATFLT2  OI    DWKDBLE,X'80'           SET SIGN BIT                     63300021
         CLC   DATMXNEG(4),0(DAT01)    MAXIMUM NEGATIVE NUMBER          63600021
         BE    DATFLT1A                                                 63900021
         L     DAT02,0(DAT01)          GET MAGNITUDE                    64200021
         LPR   DAT02,DAT02             OF NUMBER                        64500021
         ST    DAT02,DWKDBLE+4                                          64800021
         B     DATFLT1                                                  65100021
*                                                                       65400021
DAT0001  DC    F'1'                                                     65700021
DAT0002  DC    F'2'                                                     66000021
DAT0003  DC    F'3'                                                     66300021
DAT0004  DC    F'4'                                                     66600021
         DS    0D                                                       66900021
DAT0000D DC    XL8'00'                                                  67200021
DATCON   DC    XL4'4E000000'                                            67500021
DATMXNEG DC    XL4'80000000'                                            67800021
HSVA     EQU   4                                                        68100021
MSVA     EQU   8                                                        68400021
*                                                                       68700021
*        REGISTER EQUATES                                               69000021
*                                                                       69300021
DAT00    EQU   0                                                        69600021
DAT01    EQU   1                       PARAMETER LIST REGISTER          69900021
DAT02    EQU   2                       WORK REGISTERS                   70200021
DAT03    EQU   3                                                        70500021
DAT08    EQU   8                       BASE REGISTER-RETURN ARRAY       70800021
*                                           AND NULL VARIABLE           71100021
DAT09    EQU   9                       BASE REGISTER-CSECT              71400021
DAT10    EQU   10                      BASE REGISTER-PARAMETER LIST     71700021
DAT11    EQU   11                      BASE REGISTER-WORKAREA           72000021
DAT12    EQU   7                       BASE REGISTER-GDSCB              72300021
DAT13    EQU   13                                                       72600021
DAT14    EQU   14                                                       72900021
DAT15    EQU   15                                                       73200021
DAT00F   EQU   0                                                        73500021
*                                                                       73800021
*        SWITCH SETTINGS                                                74100021
*                                                                       74400021
XRA      EQU   X'80'                   X REAL, ABSOLUTE                 74700021
XRI      EQU   X'40'                   X REAL, INCREMENTAL              75000021
XIA      EQU   X'20'                   X INTEGER, ABSOLUTE              75300021
XII      EQU   X'10'                   X INTEGER, INCREMENTAL           75600021
YRA      EQU   X'08'                   Y REAL ABSOLUTE                  75900021
YRI      EQU   X'04'                   Y REAL, INCREMENTAL              76200021
YIA      EQU   X'02'                   Y INTEGER, ABSOLUTE              76500021
YII      EQU   X'01'                   Y INTEGER, INCREMENTAL           76800021
XREAL    EQU   X'C0'                                                    77100021
YREAL    EQU   X'0C'                                                    77400021
SCERR    EQU   X'20'                                                    77700021
BIT4     EQU   X'08'                   INVALID PARAMETER                78000021
HA15     EQU   X'39C'                  STAT TAB DISPLACEMENT            78100021
DATWORK  DSECT                                                          78300021
DWKPARM  DS    F                                                        78600021
DWKRTNA  DS    F                                                        78900021
DWKDAT   DS    CL3                                                      79200021
DWKDATA  DS    C                                                        79500021
DWKFIX   DS    F                                                        79800021
DWKDLLX  DS    F                                                        80100021
DWKDLLY  DS    F                                                        80400021
DWKDURX  DS    F                                                        80700021
DWKDURY  DS    F                                                        81000021
DWKSAVE  DS    18F                                                      81300021
DWKDBLE  DS    D                                                        81600021
DATPARM  DSECT                                                          81900021
DPMGDSCB DS    F                                                        82200021
DPMUMODE DS    F                                                        82500021
DPMVMODE DS    F                                                        82800021
*                                                                       83100021
         COPY  GDSCB                                                    83400021
         COPY  GSPCB                                                    83700021
         END                                                            84000021
./  ADD  SSI=20480199,NAME=IFFAEA02
         TITLE 'IFFAEA02 - SGRAM - SET GRAPHIC MODE'                    01000021
*STATUS: CHANGE LEVEL 000                                               02000021
*                                                                       03000021
*FUNCTION/OPERATION: SETS SWITCHES IN THE GDSCB TO INDICATE MODE        04000021
*        (ABSOLUTE, INCREMENTAL, OR OPTIMIZED) OF GRAPHIC OUTPUT FOR    05000021
*        A GDS.                                                         06000021
*                                                                       07000021
*ENTRY POINTS: IFFAEA02                                                 08000021
*                                                                       09000021
*INPUT:  REGISTER 1 POINTS TO A WORKAREA. THE FIRST WORD CONTAINS THE   10000021
*        ADDRESS OF THE PARAMETER LIST.  THE SECOND CONTAINS THE        11000021
*        ADDRESS OF THE RETURN ARRAY.                                   12000021
*                                                                       13000021
*        THE FIXED-LENGTH PARAMETER LIST IS                             14000021
*     +0 A(POINTER TO THE GDSCB)                                        15000021
*                                                                       16000021
*     +4 A(GRAPHIC MODE CODE)                                           17000021
*                                                                       18000021
*OUTPUT: NONE TO USER. GDSCURMD SET AS APPROPRIATE.                     19000021
*                                                                       20000021
*EXTERNAL ROUTINES: NONE                                                21000021
*                                                                       22000021
*EXITS-NORMAL AND ERROR: VIA RETURN MACRO TO DIRECTOR                   23000021
*                                                                       24000021
*TABLES/WORKAREAS: GSP WORKAREA                                         25000021
*                                                                       26000021
*ATTRIBUTES: PROBLEM STATE, REENTRANT                                   27000021
*                                                                       28000021
IFFAEA02 CSECT                                                          29000021
         SAVE  (14,12)                                                  30000021
         BALR  GRBASE,0                                                 31000021
         USING *,GRBASE           SET CSECT ADDRESSABILITY              32000021
         L     GRWORK,0(1)        GET PARAM LIST ADDR                   33000021
         L     GRSLAVE,0(GRWORK)  GET POINTER TO GDSCB                  34000021
         L     GRGDSCB,0(GRSLAVE) GET GDSCB ADDR                        35000021
         USING GDSCB,GRGDSCB      SET GDSCB DSECT ADDRESSABILITY        36000021
         L     GRGSPCB,4(1)            GET ADDRESS OF GSPARRAY          37000021
         USING GSPARRAY,GRGSPCB        RETURN ARRAY AND NULL VARIABLE   38000021
*                                      ADDRESSABILITY                   39000021
         MVI   GSPARRAY,X'00'     INDICATE SUCCESSFUL COMPLETION        40000021
         C     GRGDSCB,GDSGDSCB        IS DATA SET NAME VALID           41000021
         BNE   GRBADGDS           NO                                    42000021
         L     GRTASK,4(GRWORK)   GET GMODE ADDR                        43000021
         L     GRTASK,0(GRTASK)        GET CODE                         44000021
         CH    GRTASK,GR3         TEST FOR MODE OPTION                  45000021
         BNE   GRTST2                                                   46000021
         MVI   GDSCURMD,X'01'     SET GRAPHIC MODE - INCREMENTAL        47000021
         B     GRRETRN                                                  48000021
GRTST2   CH    GRTASK,GR2         TEST FOR MODE OPTION                  49000021
         BNE   GRTST1                                                   50000021
         MVI   GDSCURMD,X'02'     SET GRAPHIC MODE - ABSOLUTE           51000021
         B     GRRETRN                                                  52000021
GRTST1   CH    GRTASK,GR1         TEST FOR MODE OPTION                  53000021
         BNE   GRPRMERR                                                 54000021
         MVI   GDSCURMD,X'04'     SET GRAPHIC MODE - OPTIMIZED          55000021
         B     GRRETRN                                                  56000021
GRBADGDS MVI   GSPARRAY,X'08'     INDICATE PARAM ERROR                  57000021
         MVC   GSPARRAY+16(4),GR1      GDSCB NOT OPENED                 58000021
         B     GRRETRN                                                  59000021
GRPRMERR MVI   GSPARRAY,X'08'     INDICATE PARAM ERROR                  60000021
         MVC   GSPARRAY+16(4),GR2      INVALID CODE                     61000021
GRRETRN  L     GRWORK,GDSGTMCB         GET ADDRESS OF GTMCB             62000021
         USING GTMCB,GRWORK                                             63000021
         TM    GDSCURMD,GRINCR         IF ONLY ABSOLUTE ORDERS USED,    64000021
         BZ    GRRETRNA                THEN RETURN                      65000021
         TM    GTMFEATS,GRMOD3         IS A MOD 3 AVAILABLE,            66000021
         BO    GRRETRNA                YES, INCREMENTAL ORDERS O.K.     67000021
         TM    GTMFEATS,GRMOD1         IS DEVICE A MOD 1                68000021
         BZ    GRRETRNB                NO, FORCE TO ABSOLUTE ORDERS     69000021
         TM    GTMFEATS+1,GRGDF        DOES IT HAVE GDF                 70000021
         BO    GRRETRNA                YES, INCREMENTAL ORDERS O.K.     71000021
GRRETRNB MVI   GDSCURMD,GRABS          NO, FORCE TO ABSOLUTE            72000021
GRRETRNA RETURN (14,12),T                                               73000021
GR3      DC    H'3'                                                     74000021
GR2      DC    H'2'                                                     75000021
GR1      DC    H'1'                                                     76000021
GRBASE   EQU   9                                                        77000021
GRGSPCB  EQU   6                                                        78000021
GRGDSCB  EQU   8                                                        79000021
GRWORK   EQU   2                                                        80000021
GRTASK   EQU   3                                                        81000021
GRSLAVE  EQU   4                                                        82000021
GRMOD1   EQU   X'01'                                                    83000021
GRMOD3   EQU   X'03'                                                    84000021
GRGDF    EQU   X'04'                                                    85000021
GRABS    EQU   X'02'                                                    86000021
GRINCR   EQU   X'05'                                                    87000021
         COPY  GDSCB                                                    88000021
         COPY  GTMCB                                                    89000021
         COPY  GSPCB                                                    90000021
         END                                                            91000021
./  ADD  SSI=20480203,NAME=IFFAEA03
         TITLE 'IFFAEA03 - SDATL - SET DATA LIMITS'                     00700021
*STATUS: CHANGE LEVEL 000                                               01400021
*                                                                       02100021
*FUNCTION/OPERATION: SETS THE DATA LIMITS FIELDS IN THE GDSCB EQUAL     02800021
*        TO THE VALUES SPECIFIED BY THE USER. A FLAG IS ALSO SET IN THE 03500021
*        GDSCB TO INDICATE THAT THIS ROUTINE HAS BEEN CALLED            04200021
*                                                                       04900021
*ENTRY POINTS: IFFAEA04                                                 05600021
*                                                                       06300021
*INPUT:  REGISTER 1 CONTAINS THE ADDRESS OF A WORKAREA. THE FIRST WORD  07000021
*        CONTAINS THE ADDRESS OF THE PARAMETER LIST AND THE SECOND,     07700021
*        THAT OF THE RETURN ARRAY.                                      08400021
*                                                                       09100021
*        THE FIXED-LENGTH PARAMETER LIST IS                             09800021
*    + 0 A(POINTER TO THE GDSCB)                                        10500021
*                                                                       11200021
*    + 4 A(LOWER-LEFT X DATA LIMIT)                                     11900021
*                                                                       12600021
*    + 8 A(LOWER-LEFT Y DATA LIMIT)                                     13300021
*                                                                       14000021
*    +12 A(UPPER-RIGHT X DATA LIMIT)                                    14700021
*                                                                       15400021
*    +16 A(UPPER-RIGHT Y DATA LIMIT)                                    16100021
*                                                                       16800021
*OUTPUT: NONE TO USER. DATA LIMIT FIELDS IN THE GDSCB ARE SET. GDSFLGS2 17500021
*        IS SET TO INDICATE THE ROUTINE HAS BEEN CALLED.                18200021
*                                                                       18900021
*EXTERNAL ROUTINES: NONE                                                19600021
*                                                                       20300021
*EXITS-NORMAL AND ERROR: VIA RETURN MACRO TO DIRECTOR.                  21000021
*                                                                       21700021
*TABLES/WORKAREAS:  GSP WORKAREA                                        22400021
*                                                                       23100021
*ATTRIBUTES:  PROBLEM STATE, REENTRANT.                                 23800021
IFFAEA03 CSECT                                                          24500021
         SAVE  (14,12)                                                  25200021
         BALR  SDL09,0                 ADDRESSABILITY FOR               25900021
         USING *,SDL09                 CSECT                            26600021
*                                                                       27300021
         LR    SDL02,SDL01             TEMPORARY ADDRESSABILITY         28000021
         USING SDLWORK,SDL02           FOR WORK AREA                    28700021
         L     SDL10,SDWPARM           ADDRESSABILITY FOR               29400021
         USING SDLPARM,SDL10           PARAMETER LIST                   30100021
*                                                                       30800021
         L     SDL12,SDWRTNA           ADDRESSABILITY FOR NULL VARIABLE 31500021
         USING GSPARRAY,SDL12          AND RETURN ARRAY                 32200021
         DROP  SDL02                   DROP WORKAREA ADDRESSABILITY     32900021
*                                                                       33600021
         L     SDL11,SDPGDSCB          GET POINTER TO GDSCB             34300021
         L     SDL11,0(SDL11)          ADDRESSABILITY FOR               35000021
         USING GDSCB,SDL11             GDSCB                            35700021
*                                                                       36400021
         C     SDL11,GDSGDSCB          IS GDSCB OPEN                    37100021
         BNE   SDL002                  NO                               37800021
*                                                                       38500021
         SR    SDL04,SDL04             INITIALIZE COUNTER               39200021
         LA    SDL02,4                 INITIALIZE INCREMENT             39900021
         LA    SDL03,12                INITIALIZE COMPARAND             40600021
*                                                                       41300021
SDL001   LA    SDL05,SDPGDSCB(SDL04)   GET ADDRESS OF PARAMETER         42000021
         TM    0(SDL05),X'80'          IS IT THE LAST ONE               42700021
         BO    SDL005                  YES, ERROR                       43400021
         CLC   1(3,SDL05),GSPNULLV+1   EQUAL TO THE NULL VARIABLE       44100021
         BE    SDL004                  YES, ERROR                       44800021
         BXLE  SDL04,SDL02,SDL001                                       45500021
         CLC   1(3,SDL05),GSPNULLV+1   EQUAL TO THE NULL VARIABLE       46200021
         BE    SDL004                  VARIABLE. YES, ERROR             46900021
*                                                                       47600021
         LM    SDL02,SDL05,SDPU1       GET ADDRESSES OF PARAMETERS      48300021
         CLC   0(4,SDL02),0(SDL04)     PARAMETER ERROR IF U1=U2         49000021
         BE    SDL005                                                   49700021
         CLC   0(4,SDL03),0(SDL05)     OR IF V1=V2                      50400021
         BE    SDL005                                                   51100021
         MVC   GDSUVLLL(4),0(SDL02)    MOVE U1 INTO GDSCB               51800021
         MVC   GDSVVLLL(4),0(SDL03)    MOVE V1 INTO GDSCB               52500021
         MVC   GDSUVLUR(4),0(SDL04)    MOVE U2 INTO GDSCB               53200021
         MVC   GDSVVLUR(4),0(SDL05)    MOVE V2 INTO GDSCB               53900021
         MVI   GSPARRAY,ZERO           GOOD RETURN                      54600021
         OI    GDSFLGS2,SDATLFLG       SET FLAG TO SHOW SDATL CALLED    55300021
         RETURN (14,12)                                                 56000021
*                                                                       56700021
SDL002   MVC   GSPARRAY+16(4),SDL0001  GDSCB NOT OPEN                   57400021
SDL003   MVI   GSPARRAY,INVCD          INVALID CODE                     58100021
         RETURN (14,12)                                                 58800021
*                                                                       59500021
SDL004   LA    SDL02,SDL0001(SDL04)    GET NUMBER OF BAD PARAMETER      60200021
         MVC   GSPARRAY+16(4),0(SDL02) SET RETURN CODE                  60900021
         B     SDL003                                                   61600021
*                                                                       62300021
SDL005   MVC   GSPARRAY+16(4),SDL0000  SHORT PARAMETER LIST             63000021
         B     SDL003                                                   63700021
*                                                                       64400021
SDL0000  DC    F'0'                                                     65100021
SDL0001  DC    F'1'                                                     65800021
SDL0002  DC    F'2'                                                     66500021
SDL0003  DC    F'3'                                                     67200021
SDL0004  DC    F'4'                                                     67900021
SDL0005  DC    F'5'                                                     68600021
ZERO     EQU   0                                                        69300021
INVCD    EQU   X'08'                   INVALID CODE FLAG                70000021
SDATLFLG EQU   X'01'                                                    70700021
*                                                                       71400021
*        REGISTER EQUATES                                               72100021
*                                                                       72800021
SDL01    EQU   1                       PARAMETER LIST REGISTER          73500021
SDL02    EQU   2                       WORK REGISTERS                   74200021
SDL03    EQU   3                                                        74900021
SDL04    EQU   4                                                        75600021
SDL05    EQU   5                                                        76300021
SDL09    EQU   9                       BASE REGISTER-CSECT              77000021
SDL10    EQU   10                      BASE REGISTER-PARAMETER LIST     77700021
SDL11    EQU   11                      BASE REGISTER-GDSCB              78400021
SDL12    EQU   8                       BASE REGISTER-RETURN ARRAY       79100021
*                                           AND NULL VARUABLE           79800021
SDLPARM  DSECT                                                          80500021
SDPGDSCB DS    F                                                        81200021
SDPU1    DS    F                                                        81900021
SDPV1    DS    F                                                        82600021
SDPU2    DS    F                                                        83300021
SDPV2    DS    F                                                        84000021
SDLWORK  DSECT                                                          84700021
SDWPARM  DS    F                                                        85400021
SDWRTNA  DS    F                                                        86100021
         COPY  GDSCB                                                    86800021
         COPY  GSPCB                                                    87500021
         END                                                            88200021
./  ADD  SSI=20480204,NAME=IFFAEA04
         TITLE 'IFFAEA04 - SGDSL - SET GDS LIMITS'                      00200021
*STATUS: CHANGE LEVEL 000                                               00400021
*                                                                       00600021
*FUNCTION/OPERATION: CONVERTS GDS LIMITS TO RASTER UNITS.  STORES THEM  00800021
*        IN THE GDS IN BOTH FLOATING-POINT AND INTEGER,  IF SDATL HAS   01000021
*        NOT BEEN CALLED,  THE DATA LIMITS ARE SET EQUAL TO THE         01200021
*        UNCONVERTED GDS LIMITS.                                        01400021
*                                                                       01600021
*ENTRY POINTS: IFFEA04                                                  01800021
*                                                                       02000021
*INPUT: REGISTER 1 POINTS TO A WORKAREA. THE FIRST WORD CONTAINS THE    02200021
*        ADDRESS OF THE PARAMETER LIST AND THE SECOND, THAT OF THE      02400021
*        RETURN ARRAY.                                                  02600021
*                                                                       02800021
*        REQUIRED PARAMETERS ARE                                        03000021
*    + 0 A(POINTER TO THE GDSCB)                                        03200021
*                                                                       03400021
*    + 4 A(LOWER-LEFT X GDS LIMIT)                                      03600021
*                                                                       03800021
*    + 8 A(LOWER-LEFT Y GDS LIMIT)                                      04000021
*                                                                       04200021
*    +12 A(UPPER-RIGHT X GDS LIMIT)                                     04400021
*                                                                       04600021
*    +16 A(UPPER-RIGHT Y GDS LIMIT)                                     04800021
*                                                                       05000021
*        OPTIONAL PARAMETERS (ALL MUST BE PROVIDED IF ANY ARE)          05200021
*    +20 A(LOWER-LEFT X SCREEN LIMIT)                                   05400021
*                                                                       05600021
*    +24 A(LOWER-LEFT Y SCREEN LIMIT)                                   05800021
*                                                                       06000021
*    +28 A(UPPER-RIGHT X SCREEN LIMIT)                                  06200021
*                                                                       06400021
*    +32 A(UPPER-RIGHT Y SCREEN LIMIT)                                  06600021
*                                                                       06800021
*OUTPUT: NONE TO USER. GDS LIMIT FIELDS ARE FILLED IN THE GDSCB. DATA   07000021
*        LIMIT FIELD MAY BE FILLED IN.                                  07200021
*                                                                       07400021
*EXTERNAL ROUTINES: IFFAHA15 (FLOATING-POINT TO INTEGER CONVERSION)     07600021
*                                                                       07800021
*EXITS-NORMAL AND ERROR: VIA RETURN MACRO TO DIRECTOR                   08000021
*                                                                       08200021
*TABLES/WORKAREAS: GSP WORKAREA                                         08400021
*                                                                       08600021
*ATTRIBUTES: PROBLEM STATE, REENTRANT.                                  08800021
*                                                                       09000021
IFFAEA04 CSECT                                                          09200021
         SAVE  (14,12)                                                  09400021
         LR    SGL10,SGL01             ADDRESSABILITY FOR WORKAREA      09600021
         USING GLWORK,SGL10                                             09800021
         BALR  SGL09,0                 ADDRESSABILITY FOR CSECT         10000021
         USING *,SGL09                                                  10200021
         LA    SGL02,GLWSAVE           GET ADDRESS OF SAVE AREA         10400021
         ST    SGL13,GLWSAVE+4         CHAIN SAVE AREAS                 10600021
         ST    SGL02,MSVA(SGL13)                                        10800021
         LR    SGL13,SGL02             SET UP NEW SAVE AREA             11000021
*                                                                       11200021
         L     SGL11,GLWPARM           ADDRESSABILITY FOR PARAMETER     11400021
         USING SGLPARM,SGL11           LIST                             11600021
*                                                                       11800021
         L     SGL08,GLWRTNA           ADDRESSABILITY FOR RETURN ARRAY, 12000021
         USING GSPARRAY,SGL08          NULL VARIABLE, STATUS TABLE      12200021
*                                                                       12400021
         L     SGL12,GLPGDSCB          GET POINTER TO GDSCB ADDRESS     12600021
         L     SGL12,0(SGL12)          ADDRESSABILITY FOR               12800021
         USING GDSCB,SGL12             GDSCB                            13000021
*                                                                       13200021
         C     SGL12,GDSGDSCB          GDSCB OPEN                       13400021
         BNE   SGL022                  NO, ERROR RETURN                 13600021
*                                                                       13800021
         LA    SGL02,GSPNULLV          GET THE NULL VARIABLE            14000021
         SR    SGL03,SGL03             INITIALIZE COUNTER               14200021
         LA    SGL04,4                 INITIALIZE INCREMENT             14400021
         LA    SGL05,12                INITIALIZE COMPARAND             14600021
*                                                                       14800021
*        GET GRID LIMITS                                                15000021
*                                                                       15200021
SGL001   LA    SGL06,GLPGDSCB(SGL03)   GET ADDRESS OF PARAMETER         15400021
         TM    0(SGL06),X'80'          LAST PARAMETER                   15600021
         BO    SGL021                  YES, ERROR                       15800021
         BXLE  SGL03,SGL04,SGL001      CONTINUE CHECKING                16000021
*                                                                       16200021
         LM    SGL03,SGL06,GLPGLLX     GET ADDRESSES OF GRID LIMITS     16400021
         MVC   GLWGLLX(4),0(SGL03)     TRANSFER GRID                    16600021
         MVC   GLWGLLY(4),0(SGL04)     LIMITS TO                        16800021
         MVC   GLWGURX(4),0(SGL05)     WORKAREA                         17000021
         MVC   GLWGURY(4),0(SGL06)                                      17200021
*                                                                       17400021
         TM    GLPGURY,X'80'           SCREEN PARAMETERS PASSED         17600021
         BO    SGL004                  NO, TAKE DEFAULT                 17800021
*                                      YES, CHECK THEM FOR VALIDITY     18000021
         LA    SGL03,16                INITIALIZE COUNTER               18200021
         LA    SGL04,4                 INITIALIZE INCREMENT             18400021
         LA    SGL05,28                INITIALIZE COMPARAND             18600021
*                                                                       18800021
SGL002   LA    SGL06,GLPGDSCB(SGL03)   GET ADDRESS OF PARAMETER         19000021
         TM    0(SGL06),X'80'          LAST PARAMETER                   19200021
         BO    SGL021                  YES, ERROR                       19400021
         CLC   1(3,SGL02),5(SGL06)     NEXT PARAMETER = NULL            19600021
         BE    SGL003                  YES, CHECK FOR ERROR             19800021
         BXLE  SGL03,SGL04,SGL002                                       20000021
*                                                                       20200021
         LM    SGL02,SGL05,GLPSLLX     GET ADDRESS OF SCREEN LIMITS     20400021
         MVC   GLWSLLX(4),0(SGL02)     MOVE SCREEN                      20600021
         MVC   GLWSLLY(4),0(SGL03)     LIMITS INTO                      20800021
         MVC   GLWSURX(4),0(SGL04)     WORKAREA                         21000021
         MVC   GLWSURY(4),0(SGL05)                                      21200021
*                                                                       21400021
         B     SGL008                  SET GDS LIMITS IN GDSCB          21600021
*                                                                       21800021
SGL003   C     SGL03,SGL0016           NULL ON FIRST SCREEN LIMIT       22000021
         BNE   SGL021                  NO, ERROR                        22200021
         CLC   1(3,SGL02),GLPSLLY+1    YES, ARE ALL                     22400021
         BNE   SGL021                  SCREEN LIMITS                    22600021
         CLC   1(3,SGL02),GLPSURX+1    SET TO THE NULL VARIABLE         22800021
         BNE   SGL021                  NO, ERROR                        23000021
         CLC   1(3,SGL02),GLPSURY+1    YES, TAKE DEFAULT FOR NO         23200021
         BNE   SGL021                  SCREEN LIMITS                    23400021
*                                                                       23600021
SGL004   MVC   GLWSLLX(4),SGL0000      SET LOWER-LEFT SCREEN            23800021
         MVC   GLWSLLY(4),SGL0000      LIMITS = 0                       24000021
         TM    GDSDATMD,REALX          CHECK UMODE                      24200021
         BZ    SGL005                  INTEGER                          24400021
         MVC   GLWSURX(4),SGL4095E     REAL-SET UPPER RIGHT LIMIT=4095  24600021
         B     SGL006                                                   24800021
*                                                                       25000021
SGL005   MVC   GLWSURX(4),SGL4095      INTEGER X- SET UPPER-RIGHT LIMIT 25200021
SGL006   TM    GDSDATMD,REALY          CHECK VMODE                      25400021
         BZ    SGL007                                                   25600021
         MVC   GLWSURY(4),SGL4095E     SET UPPER-RIGHT                  25800021
         B     SGL008                  LIMIT= 4095                      26000021
SGL007   MVC   GLWSURY(4),SGL4095      IN PROPER MODE                   26200021
*                                                                       26400021
SGL008   TM    GDSDATMD,REALX          CHECK MODE OF X'S                26600021
         BZ    SGL009                  INTEGER                          26800021
         LE    SGL00F,GLWGURX          IS GURX VALID                    27000021
         CE    SGL00F,GLWSLLX                                           27200021
         BNH   SGL021                  NO, ERROR                        27400021
         LE    SGL00F,GLWGLLX          IS GLLX VALID                    27600021
         CE    SGL00F,GLWSURX                                           27800021
         BNL   SGL021                  NO, ERROR                        28000021
         B     SGL010                  CHECK Y LIMITS                   28200021
*                                                                       28400021
SGL009   L     SGL02,GLWGURX           IS GURX VALID                    28600021
         C     SGL02,GLWSLLX                                            28800021
         BNH   SGL021                  NO, ERROR                        29000021
         L     SGL02,GLWGLLX           IS GLLX VALID                    29200021
         C     SGL02,GLWSURX                                            29400021
         BNL   SGL021                  NO, ERROR                        29600021
*                                                                       29800021
SGL010   TM    GDSDATMD,REALY          CHECK MODE OF Y'S                30000021
         BZ    SGL011                  INTEGER                          30200021
         LE    SGL00F,GLWGURY          IS GURY VALID                    30400021
         CE    SGL00F,GLWSLLY                                           30600021
         BNH   SGL021                  NO, ERROR                        30800021
         LE    SGL00F,GLWGLLY          IS GLLY VALID                    31000021
         CE    SGL00F,GLWSURY                                           31200021
         BNL   SGL021                  NO, ERROR                        31400021
         B     SGL012                                                   31600021
*                                                                       31800021
SGL011   L     SGL02,GLWGURY           IS GURY VALID                    32000021
         C     SGL02,GLWSLLY                                            32200021
         BNH   SGL021                  NO, ERROR                        32400021
         L     SGL02,GLWGLLY           IS GLLY VALID                    32600021
         C     SGL02,GLWSURY                                            32800021
         BNL   SGL021                  NO, ERROR                        33000021
SGL012   L     SGL02,GSPASTAT          SEE IF CONVERSION ROUTINE IN     33080021
         CLC   HA15(4,SGL02),SGL0000   CORE                             33160021
         BNE   SGL012A                 YES, GET ADDRESS                 33240021
         LOAD  EP=IFFAHA15             NO, LOAD IT                      33320021
         ST    SGL00,HA15(SGL02)       STORE ADDRESS IN STAT TAB        33400021
SGL012A  MVC   GLWFIX(4),HA15(SGL02)   GET ADDRESS INTO WORKAREA        33480021
*                                                                       33600021
SGL013   TM    GDSDATMD,REALX          CHECK MODE OF X'S                33800021
         BZ    SGL015                  INTEGER                          34000021
SGL014   LE    SGL00F,GLWSURX          COMPUTE SURX-SLLX                34200021
         SE    SGL00F,GLWSLLX                                           34400021
         BZ    SGL021                  IF DIFFERENCE = 0, ERROR         34600021
         LE    SGL02F,GLWGLLX          COMPUTE GLLX-SLLX                34800021
         SE    SGL02F,GLWSLLX                                           35000021
         ME    SGL02F,SGL4095E         SCALE GLLX COORDINATE            35200021
         DER   SGL02F,SGL00F                                            35400021
         STE   SGL02F,GLWGLLX          STORE SCALED VALUE               35600021
*                                                                       35800021
         LE    SGL02F,GLWGURX          COMPUTE GURX-SLLX                36000021
         SE    SGL02F,GLWSLLX                                           36200021
         ME    SGL02F,SGL4095E         SCALE GURX COORDINATE            36400021
         DER   SGL02F,SGL00F                                            36600021
         STE   SGL02F,GLWGURX          STORE SCALED VALUE               36800021
         B     SGL016                                                   37000021
*                                                                       37200021
SGL015   LA    SGL01,GLWSLLX           CONVERT SLLX TO REAL             37400021
         BAL   SGL14,SGLFLOAT                                           37600021
         LA    SGL01,GLWSURX           CONVERT SURX TO REAL             37800021
         BAL   SGL14,SGLFLOAT                                           38000021
         LA    SGL01,GLWGLLX           CONVERT GLLX TO REAL             38200021
         BAL   SGL14,SGLFLOAT                                           38400021
         LA    SGL01,GLWGURX           CONVERT GURX TO REAL             38600021
         BAL   SGL14,SGLFLOAT                                           38800021
         B     SGL014                  SCALE COORDINATES IN REAL        39000021
*                                                                       39200021
SGL016   TM    GDSDATMD,REALY          CHECK MODE OF Y INPUT            39400021
         BZ    SGL018                  CONVERT TO REAL                  39600021
SGL017   LE    SGL00F,GLWSURY          COMPUT SURY-SLLY                 39800021
         SE    SGL00F,GLWSLLY                                           40000021
         BZ    SGL021                  IF SURY-SLLY, ERROR              40200021
         LE    SGL02F,GLWGLLY          COMPUTE GLLY-SLLY                40400021
         SE    SGL02F,GLWSLLY                                           40600021
         ME    SGL02F,SGL4095E         SCALE GLLY COORDINATE            40800021
         DER   SGL02F,SGL00F                                            41000021
         STE   SGL02F,GLWGLLY          AND STORE                        41200021
*                                                                       41400021
         LE    SGL02F,GLWGURY          COMPUTE GURY-SLLY                41600021
         SE    SGL02F,GLWSLLY                                           41800021
         ME    SGL02F,SGL4095E         SCALE GURY COORDINATE            42000021
         DER   SGL02F,SGL00F                                            42200021
         STE   SGL02F,GLWGURY          AND STORE                        42400021
         B     SGL019                                                   42600021
*                                                                       42800021
SGL018   LA    SGL01,GLWSLLY           CONVERT SLLY TO REAL             43000021
         BAL   SGL14,SGLFLOAT                                           43200021
         LA    SGL01,GLWSURY           CONVERT SURY TO REAL             43400021
         BAL   SGL14,SGLFLOAT                                           43600021
         LA    SGL01,GLWGLLY           CONVERT GLLY TO REAL             43800021
         BAL   SGL14,SGLFLOAT                                           44000021
         LA    SGL01,GLWGURY           CONVERT GURY TO REAL             44200021
         BAL   SGL14,SGLFLOAT                                           44400021
         B     SGL017                  SCALE IN REAL                    44600021
*                                                                       44800021
SGL019   L     SGL15,GLWFIX            GET REAL TO INTEGER CONVERSION   45000021
*                                      ROUTINE                          45200021
         L     SGL01,GLWGLLX           CONVERT GLLX                     45400021
         BALR  SGL14,SGL15             TO INTEGER                       45600021
         LTR   SGL15,SGL15             TEST RETURN CODE                 45800021
         BC    7,SGL021                REGISTER 15 NON-ZERO, ERROR      46000021
         ST    SGL01,GLWGLX            STORE                            46200021
*                                                                       46400021
         L     SGL15,GLWFIX            CONVERT                          46600021
         L     SGL01,GLWGLLY           GLLY                             46800021
         BALR  SGL14,SGL15             TO                               47000021
         LTR   SGL15,SGL15             INTEGER                          47200021
         BC    7,SGL021                AND                              47400021
         ST    SGL01,GLWGLY            STORE                            47600021
*                                                                       47800021
         L     SGL15,GLWFIX            CONVERT                          48000021
         L     SGL01,GLWGURX           GURX                             48200021
         BALR  SGL14,SGL15             TO                               48400021
         LTR   SGL15,SGL15             INTEGER                          48600021
         BC    7,SGL021                AND                              48800021
         ST    SGL01,GLWGUX            STORE                            49000021
*                                                                       49200021
         L     SGL15,GLWFIX            CONVERT                          49400021
         L     SGL01,GLWGURY           GURY                             49600021
         BALR  SGL14,SGL15             TO                               49800021
         LTR   SGL15,SGL15             INTEGER                          50000021
         BC    7,SGL021                AND                              50200021
         ST    SGL01,GLWGUY            STORE                            50400021
*                                                                       50600021
         MVC   GDSXVILL(4),GLWGLX      STORE INTEGER                    50800021
         MVC   GDSYVILL(4),GLWGLY      GRID LIMITS                      51000021
         MVC   GDSXVIUR(4),GLWGUX      IN GDSCB                         51200021
         MVC   GDSYVIUR(4),GLWGUY                                       51400021
*                                                                       51600021
         MVC   GDSXVRLL(4),GLWGLLX     STORE REAL                       51800021
         MVC   GDSYVRLL(4),GLWGLLY     GRID LIMITS                      52000021
         MVC   GDSXVRUR(4),GLWGURX     IN GDSCB                         52200021
         MVC   GDSYVRUR(4),GLWGURY                                      52400021
*                                                                       52600021
         MVI   GSPARRAY,X'00'          SET NORMAL RETURN                52800021
         TM    GDSFLGS2,SDATLFLG       HAS SDATL BEEN CALLED            53000021
         BZ    SGL023                  NO, SET DATA LIMITS=GDS LIMITS   53200021
*                                                                       53220021
SGL020   L     SGL02,GDSAOACB          GET ADDRESS OF OACB              53240021
         TM    OACBFLGS(SGL02),NODATA  IS ANY DATA IN GDS               53260021
         BZ    SGL020B                 YES, EXIT                        53280021
         SR    SGL02,SGL02             NO, SEE IF (0,0) IN GDS          53300021
         C     SGL02,GDSXVILL                                           53320021
         BL    SGL020A                                                  53340021
         C     SGL02,GDSYVILL          IF IT IS, EXIT NORMALLY          53360021
         BNL   SGL020B                                                  53380021
*                                                                       53400021
SGL020A  MVC   GDSXLAST(8),GDSXVILL    IF IT IS NOT IN THE GDS, SET     53420021
         MVC   GDSXCURR(2),GDSXVILL+2  INITIAL VALUES OF GDSXLAST,      53440021
         MVC   GDSYCURR(2),GDSYVILL+2  GDSYLAST, GDSXCURR, & GDSYCURR   53460021
         NI    GDSXCURR+1,TRUNC        TO THE LOWER-LEFT CORNER OF THE  53480021
         NI    GDSYCURR+1,TRUNC        GDS                              53500021
*                                                                       53520021
SGL020B  L     SGL13,HSVA(SGL13)       GET ADDRESS OF SAVE AREA         53540021
         RETURN (14,12),T                                               53600021
*                                                                       53800021
*        PARAMETER ERROR                                                54000021
*                                                                       54200021
SGL021   MVI   GSPARRAY,PARERR         INDICATE PARAMETER ERROR         54400021
         XC    GSPARRAY+16(4),GSPARRAY+16 SET ADDITIONAL WORD = 0       54600021
         B     SGL020                                                   54800021
*                                                                       55000021
SGL022   MVI   GSPARRAY,PARERR         INDICATE PARAMETER ERROR         55200021
         MVC   GSPARRAY+16,SGL0001     BAD GDSCB                        55400021
         B     SGL020                                                   55600021
*                                                                       55800021
SGL023   LM    SGL02,SGL05,GLPGLLX     GET ADDRESSES OF INPUT GDS LIMS  56000021
         MVC   GDSUVLLL(4),0(SGL02)    SET DATA LIMITS                  56200021
         MVC   GDSVVLLL(4),0(SGL03)    EQUAL TO THE                     56400021
         MVC   GDSUVLUR(4),0(SGL04)    INPUT GDS LIMITS                 56600021
         MVC   GDSVVLUR(4),0(SGL05)                                     56800021
         B     SGL020                                                   57000021
*                                                                       57200021
SGLFLOAT CLC   0(4,SGL01),SGL0000      NUMBER TO BE CONVERTED =0        57400021
         BCR   8,SGL14                 YES, IMMEDIATE RETURN            57600021
         MVC   GLWCONV(4),SGLCON       SET UP CONVERSION CONSTANT       57800021
         TM    0(SGL01),X'80'          IS NUMBER TO BE CONVERTED        58000021
         BO    SGLFLT2                 NEGATIVE. YES.                   58200021
SGLFLT1A MVC   GLWCONV+4(4),0(SGL01)   NO, MOVE NUMBER INTO AREA        58400021
SGLFLT1  LD    SGL00F,GLWCONV          GET UNNORMALIZED NUMBER          58600021
         AD    SGL00F,SGL0000          AND NORMALIZE                    58800021
         STE   SGL00F,0(SGL01)         STORE NORMALIZED NUMBER          59000021
         BR    SGL14                   RETURN                           59200021
*                                                                       59400021
SGLFLT2  OI    GLWCONV,X'80'           SET SIGN BIT                     59600021
         CLC   SGLMAXN(4),0(SGL01)     MAMIMUM NAGATIVE NUMBER          59800021
         BE    SGLFLT1A                YES, TREAT AS POSITIVE NUMBER    60000021
         L     SGL02,0(SGL01)          N3, GET MAGNITUDE                60200021
         LPR   SGL02,SGL02                                              60400021
         ST    SGL02,GLWCONV+4         STORE IN WORKAREA                60600021
         B     SGLFLT1                 AND NORMALIZE                    60800021
*                                                                       61000021
*                                                                       61200021
*        CONSTANT AREA                                                  61400021
*                                                                       61600021
SGL4095  DC    F'4095'                                                  61800021
SGL4095E DC    E'4095'                                                  62000021
SGLCON   DC    X'4E000000'                                              62200021
SGL0016  DC    F'16'                                                    62400021
SGLMAXN  DC    X'80000000'                                              62600021
SGL0001  DC    F'1'                                                     62800021
SGL0000  DC    D'0'                                                     63000021
HSVA     EQU   4                                                        63200021
MSVA     EQU   8                                                        63400021
CVTLINK  EQU   8                                                        63600021
CVTPTR   EQU   16                                                       63800021
REALPARS EQU   X'CC'                                                    64200021
REALX    EQU   X'C0'                                                    64400021
REALY    EQU   X'0C'                                                    64600021
PARERR   EQU   X'08'                                                    64800021
SDATLFLG EQU   X'01'                                                    65000021
NODATA   EQU   X'80'                                                    65050021
OACBFLGS EQU   8                                                        65100021
TRUNC    EQU   X'FC'                                                    65150021
HA15     EQU   X'39C'                  STAT TAB DISPLACEMENT            65170021
*                                                                       65200021
*        REGISTER EQUATES                                               65400021
*                                                                       65600021
SGL00    EQU   0                                                        65800021
SGL01    EQU   1                                                        66000021
SGL02    EQU   2                                                        66200021
SGL03    EQU   3                                                        66400021
SGL04    EQU   4                                                        66600021
SGL05    EQU   5                                                        66800021
SGL06    EQU   6                                                        67000021
SGL08    EQU   8                                                        67200021
SGL09    EQU   9                                                        67400021
SGL10    EQU   10                                                       67600021
SGL11    EQU   11                                                       67800021
SGL12    EQU   7                                                        68000021
SGL13    EQU   13                                                       68200021
SGL14    EQU   14                                                       68400021
SGL15    EQU   15                                                       68600021
SGL00F   EQU   0                                                        68800021
SGL02F   EQU   2                                                        69000021
SGLPARM  DSECT                                                          69200021
GLPGDSCB DS    F                                                        69400021
GLPGLLX  DS    F                                                        69600021
GLPGLLY  DS    F                                                        69800021
GLPGURX  DS    F                                                        70000021
GLPGURY  DS    F                                                        70200021
GLPSLLX  DS    F                                                        70400021
GLPSLLY  DS    F                                                        70600021
GLPSURX  DS    F                                                        70800021
GLPSURY  DS    F                                                        71000021
GLWORK   DSECT                                                          71200021
GLWPARM  DS    F                                                        71400021
GLWRTNA  DS    F                                                        71600021
GLWSAVE  DS    18F                                                      71800021
GLWSLLX  DS    F                                                        72000021
GLWSLLY  DS    F                                                        72200021
GLWSURX  DS    F                                                        72400021
GLWSURY  DS    F                                                        72600021
GLWGLLX  DS    F                                                        72800021
GLWGLLY  DS    F                                                        73000021
GLWGURX  DS    F                                                        73200021
GLWGURY  DS    F                                                        73400021
GLWFIX   DS    F                                                        73600021
GLWCONV  DS    D                                                        73800021
GLWGLX   DS    F                                                        74000021
GLWGLY   DS    F                                                        74200021
GLWGUX   DS    F                                                        74400021
GLWGUY   DS    F                                                        74600021
         COPY  GSPCB                                                    74800021
         COPY  GDSCB                                                    75000021
         END                                                            75200021
./  ADD  SSI=20480225,NAME=IFFAEA06
         TITLE 'IFFAEA06 - SSCIS - SET SCISSOR OPTION'                  00060013
*STATUS: CHANGE LEVEL 000                                               00120013
*                                                                       00180013
*FUNCTION/OPERATION:  SETS GDSSCISS TO INDICATE THE SCISSORING OPTION   00240013
*        SELECTED BY THE USER FOR THE GDS.                              00300013
*                                                                       00360013
*ENTRY POINTS: IFFAEA06                                                 00420013
*                                                                       00480013
*INPUT:  REGISTER 1 CONTAINS THE ADDRESS OF A WORKAREA.  THE FIRST WORD 00540013
*        CONTAINS THE ADDRESS OF THE PARAMETER LIST AND THE SECOND,     00600013
*        THAT OF THE RETURN ARRAY.                                      00660013
*                                                                       00720013
*        THE PARAMETER LIST IS                                          00780013
*     +0 A(POINTER TO THE GDSCB)                                        00840013
*                                                                       00900013
*     +4 A(OPTION CODE)                                                 00960013
*                                                                       01020013
*OUTPUT: NONE TO USER. GDSSCISS IN THE GDSCB IS SET APPROPRIATELY       01080013
*                                                                       01140013
*EXTERNAL ROUTINES: NONE                                                01200013
*                                                                       01260013
*EXITS-NORMAL AND ERROR: VIA RETURN MACRO TO THE DIRECTOR               01320013
*                                                                       01380013
*TABLES/WORKAREAS: GSP WORKAREA                                         01440013
*                                                                       01500013
*ATTRIBUTES: PROBLEM STATE, REENTRANT                                   01560013
*                                                                       01620013
IFFAEA06 CSECT                                                          01680013
         SAVE  (14,12)                                                  02000013
         BALR  OPBASE,0                                                 03000013
         USING *,OPBASE           SET CSECT ADDR                        04000013
         L     OPWORK,0(1)        GET PARAM LIST ADDR                   05000013
         L     OPSLAVE,0(OPWORK)  GET POINYER TO GDSCB                  06000013
         L     OPGDSCB,0(OPSLAVE) GET GDSCB ADDR                        07000013
         USING GDSCB,OPGDSCB      SET GDSCB DSECT ADDRESSABILITY        08000013
         L     OPGSPCB,4(1)            GET ADDRESS OF THE GSPARRAY      09000013
         USING GSPARRAY,OPGSPCB        SET ADDRESSABILITY FOR THE       10000013
*                                      RETURN ARRAY AND NULL VARIABLE   11000013
         MVI   GSPARRAY,X'00'     INDICATE SUCCESSFUL COMPLETION        12000013
         C     OPGDSCB,GDSGDSCB        IS DATA SET NAME VALID           13000013
         BNE   OPBADGDS           NO                                    14000013
         L     OPTASK,4(OPWORK)   GET CODE ADDR                         15000013
         L     OPTASK,0(OPTASK)        GET CODE                         16000013
         CH    OPTASK,OP3         TEST FOR MODE OPTION                  17000013
         BNE   OPTST2                                                   18000013
         MVI   GDSSCISS,X'12'     SET SCISSOR MODE - NO SCISSORING      19000013
         B     OPRETRN                                                  20000013
OPTST2   CH    OPTASK,OP2         TEST FOR MODE OPTION                  21000013
         BNE   OPTST1                                                   22000013
         MVI   GDSSCISS,X'06'     SET MODE - SCISSOR GRID - CONT GEN    23000013
         B     OPRETRN                                                  24000013
OPTST1   CH    OPTASK,OP1         TEST FOR MODE OPTION                  25000013
         BNE   OPTSTN1                                                  26000013
         MVI   GDSSCISS,X'0A'     SET MODE - SCISSOR SCREEN, CONT GEN   27000013
         B     OPRETRN                                                  28000013
OPTSTN1  CH    OPTASK,OPN1        TEST FOR MODE OPTION                  29000013
         BNE   OPTSTN2                                                  30000013
         MVI   GDSSCISS,X'09'     SET MODE - SCISS SCREEN, DISCONT GEN  31000013
         B     OPRETRN                                                  32000013
OPTSTN2  CH    OPTASK,OPN2        TEST FOR MODE OPTION                  33000013
         BNE   OPPRMERR                                                 34000013
         MVI   GDSSCISS,X'05'     SET MODE - SCISSOR GRID, DISCONT GEN  35000013
         B     OPRETRN                                                  36000013
OPBADGDS MVI   GSPARRAY,X'08'     INDICATE PARAM ERROR                  37000013
         MVC   GSPARRAY+16(4),OP1      GDSCB NOT OPEN                   38000013
         B     OPRETRN                                                  39000013
OPPRMERR MVI   GSPARRAY,X'08'     INDICATE PARAM ERROR                  40000013
         MVC   GSPARRAY+16(4),OP2      INVALID CODE                     41000013
OPRETRN  RETURN (14,12),T                                               42000013
OP3      DC    H'3'                                                     43000013
OP2      DC    H'2'                                                     44000013
OP1      DC    H'1'                                                     45000013
OPN1     DC    H'-1'                                                    46000013
OPN2     DC    H'-2'                                                    47000013
OPBASE   EQU   9                                                        48000013
OPGSPCB  EQU   6                                                        49000013
OPGDSCB  EQU   8                                                        50000013
OPWORK   EQU   2                                                        51000013
OPTASK   EQU   3                                                        52000013
OPSLAVE  EQU   4                                                        53000013
         COPY  GDSCB                                                    54000013
         COPY  GSPCB                                                    55000013
         END                                                            56000013
./  ADD  SSI=80590590,NAME=IFFAEA07
         TITLE 'IFFAEA07 - CHAM - SET CHARACTER MODE'                   00060021
*STATUS:  CHANGE LEVEL 000                                              00120021
*                                                                       00180021
*                                                                       00190000
*        CHANGE ACTIVITY                                                00200000
*          ZA30013  (02/23/78)                                          00210000
*FUNCTION/OPERATIONS: SETS GDSCHARS IN THE GDSCB TO INDICATE THE        00240000
*        CHARACTER SIZE (BASIC OR LARGE) AND TYPE (PROTECTED OR         00300021
*        UNPROTECTED) SELECTED BY THE USER.                             00360021
*                                                                       00420021
*ENTRY POINTS: IFFAEA07                                                 00480021
*                                                                       00540021
*INPUT:  REGISTER 1 CONTAINS THE ADDRESS OF A WORKAREA. THE FIRST WORD  00600021
*        CONTAINS THE ADDRESS OF THE PARAMETER LIST, AND THE SECOND,    00660021
*        THAT OF THE RETURN ARRAY.                                      00720021
*                                                                       00780021
*        THE PARAMETER LIST IS                                          00840021
*     +0 A(POINTER TO THE GDSCB)                                        00900021
*                                                                       00960021
*     +4 A(OPTION CODE)                                                 01020021
*                                                                       01080021
*OUTPUT:  NONE TO USER. GDSCHARS IN THE GDSCB IS SET APPROPRIATELY.     01140021
*                                                                       01200021
*EXTERNAL ROUTINES: NONE                                                01260021
*                                                                       01320021
*EXITS-NORMAL AND ERROR: VIA RETURN MACRO TO THE DIRECTOR               01380021
*                                                                       01440021
*TABLES/WORKAREAS: GSP WORKAREA                                         01500021
*                                                                       01560021
*ATTRIBUTES: PROBLEM STATE, REENTRANT.                                  01620021
*                                                                       01680021
IFFAEA07 CSECT                                                          01740021
         SAVE  (14,12)                                                  02000021
         BALR  CHBASE,0                                                 03000021
         USING *,CHBASE           SET CSECT ADDRESSABILITY              04000021
         L     CHWORK,0(1)        GET PARAM LIST ADDR                   05000021
         L     CHSLAVE,0(CHWORK)  GET POINTER TO GDSCB                  06000021
         L     CHGDSCB,0(CHSLAVE) GET GDSCB ADDR                        07000021
         USING GDSCB,CHGDSCB      SET GDSCB DSECT ADDRESSSABILITY       08000021
         L     CHGSPCB,4(1)            GET ADDRESS OF GSPARRAY          09000021
         USING GSPARRAY,CHGSPCB        ADDRESSABILITY FOR RETURN ARRAY  10000021
*                                      AND THE NULL VARIABLE            11000021
         MVI   GSPARRAY,X'00'     INDICATE SUCCESSFUL COMPLETION        12000021
         C     CHGDSCB,GDSGDSCB        IS DATA SET NAME VALID           13000021
         BNE   CHBADGDS           NO                                    14000021
         L     CHTASK,4(CHWORK)   GET CODE ADDR                         15000021
         L     CHTASK,0(CHTASK)        GET CODE                         16000021
         CH    CHTASK,CH4         TEST FOR MODE OPTION                  17000021
         BNE   CHTST3                                                   18000021
         MVI   GDSCHARS,X'01'     SET CHAR MODE - LARGE, UNPROTECTED    19000021
         B     CHRETRN                                                  20000021
CHTST3   CH    CHTASK,CH3         TEST FOR MODE OPTION                  21000021
         BNE   CHTST2                                                   22000021
         MVI   GDSCHARS,X'02'     SET CHAR MODE - BASIC, UNPROTECTED    23000021
         B     CHRETRN                                                  24000021
CHTST2   CH    CHTASK,CH2         TEST FOR MODE OPTION                  25000021
         BNE   CHTST1                                                   26000021
         MVI   GDSCHARS,X'04'     SET CHAR MODE - LARGE, PROTECTED      27000021
         B     CHRETRN                                                  28000021
CHTST1   CH    CHTASK,CH1         TEST FOR MODE OPTION                  29000021
         BNE   CHPRMERR                                                 30000021
         MVI   GDSCHARS,X'08'     SET CHAR MODE - BASIC PROTECTED       31000021
         B     CHRETRN                                                  32000021
CHBADGDS MVI   GSPARRAY,X'08'     INDICATE PARAM ERROR                  33000021
         MVC   GSPARRAY+16(4),CHERR1   GDSCB NOT OPEN       E12 ZA30013 33050000
         B     CHRETRN                                                  35000021
CHPRMERR MVI   GSPARRAY,X'08'     INDICATE PARAM ERROR                  36000021
         MVC   GSPARRAY+16(4),CHERR2   INVALID CODE         E12 ZA30013 36050000
CHRETRN  RETURN (14,12),T                                               38000021
CH4      DC    H'4'                                                     39000021
CH3      DC    H'3'                                                     40000021
CH2      DC    H'2'                                                     41000021
CH1      DC    H'1'                                                     42000021
CHERR1   DC    F'1'                                         E12 ZA30013 42050000
CHERR2   DC    F'2'                                         E12 ZA30013 42100000
CHBASE   EQU   9                                                        43000021
CHGSPCB  EQU   6                                                        44000021
CHWORK   EQU   2                                                        45000021
CHTASK   EQU   3                                                        46000021
CHSLAVE EQU 4                                                           47000021
CHGDSCB  EQU   8                                                        48000021
         COPY  GDSCB                                                    49000021
         COPY  GSPCB                                                    50000021
         END                                                            51000021
./  ADD  SSI=80330201,NAME=IFFAFA01
         TITLE 'IFFAFA01 -- PLINE / PPOINT MODULE'          D11         00100000
*                                                                       00200000
*        PLINE AND PPOINT ARE ENTERED FROM DIRECTOR PART 2 WITH THE     00300000
*        ADDRESS OF A WORK AREA IN REGISTER 1.  THE FIRST WORD OF THE   00400000
*        WORK AREA CONTAINS THE ADDRESS OF THE PARAMETER LIST BELOW.    00500000
*                                                                       00600000
*                             PLINE AND PPOINT                          00700000
*                                                                       00800000
*                             INPUT PARAMETER LIST                      00900000
*                                                                       01000000
*                             +0  A(GDSVAR)                             01100000
*                             +4  A(X-COORD)                            01200000
*                             +8  A(Y-COORD)                            01300000
*                             +12 A(CORVAL)                             01400000
*                             +16 A(KEY)                                01500000
*                             +20 A(GENCODE)                            01600000
*                             +24 A(COUNT)                              01700000
*                             +28 A(X-INDEX)                            01800000
*                             +32 A(Y-INDEX)                            01900000
*                             +36 A(X-INCR)                             02000000
*                             +40 A(Y-INCR)                             02100000
*                                                                       02200000
*        EXTERNAL ROUTINES CALLED:                                      02300000
*                                                                       02400000
*        SCALE-IFFAHA06                                                 02500000
*        SCISSOR-IFFAHA07                                               02600000
*        KEY TABLE MANAGEMENT- IFFAHA03                                 02700000
*        DATA GENERATOR-IFFAHA04                                        02800000
*        UPDATE-IFFAHA13 AND IFFAHA14                                   02900000
*        EXTERNAL MACROS USED:                                          03000000
*                                                                       03100000
*        LINK                                                           03200000
*                                                                       03300000
         EJECT                                                          03400000
*        PLINE AND PPOINT WILL SPEND A GOOD PORTION OF ITS TIME         03500000
*        BUILDING A PARAMETER LIST WHICH IS USED AS THE INPUT           03600000
*        PARAMETER LIST TO SCALE, SCISSOR, DATA GENERATOR, AND          03700000
*        UPDATE.                                                        03800000
*                                                                       03900000
*        WORD 0 IS THE KEY WHICH IS RETURNED TO THE USER.  THE FIRST    04000000
*        HALFWORD CONTAINS THE LENGTH OF THE ELEMENT AND THE SECOND     04100000
*        HALFWORD CONTAINS THE LOGICAL START ADDRESS OF THE ELEMENT.    04200000
*                                                                       04300000
*        WORD 1 CONTAINS BIT SWITCHES.                                  04400000
*        BIT 0: 0=SINGLE ENTRY/1=MULTIPLE ENTRY                         04500000
*        BIT 1: INITIALIZED TO ZERO.  SET BY DATA GEN TO SHOW IF        04600000
*        FOR A SINGLE ENTRY IF THE DATA CONTAINS A SET MODE ORDER.      04700000
*        BITS 2,3,4:                                                    04800000
*        000 IS VECTOR INPUT                                            04900000
*        010 IS POINT INPUT                                             05000000
*        BIT 5: 0=OMIT/1=INCLUDE                                        05100000
*        BITS 6&7:                                                      05200000
*        00 IS ABSOLUTE OUTPUT                                          05300000
*        01 IS INCREMENTAL OUTPUT                                       05400000
*        11 IS OPTIMIZED OUTPUT                                         05500000
*        BITS 8-15: ARE RESERVED AND INITIALIZED TO ZERO. DATA          05600000
*        GEN WILL PLACE THE BYTE OF DATA CONTAINING THE BEAM BIT        05700000
*        HERE IF IT IS A SINGLE ENTRY WHICH IS KEYED OR CORRELATED.     05800000
*        BITS 16&17:                                                    05900000
*        00 IS FIRST PASS                                               06000000
*        01 IS NOT FIRST PASS, NOT LAST PASS                            06100000
*        11 IS LAST PASS                                                06200000
*        FOR SINGLE ELEMENTS THIS IS SET TO FIRST PASS.                 06300000
*        BIT 18: 0=DATA NOT KEYED/1=DATA KEYED                          06400000
*        BIT 19: 0=DATA NOT CORRELATED/1=DATA CORRELATED                06500000
*        BIT 20: 0=BEAM OFF/1=BEAM ON                                   06600000
*        BIT 21: 0=REPOSITION/1=NO REPOSITIONING                        06700000
*        BITS 22&23: RESERVED AND SET TO ZERO                           06800000
*        BIT 24: 0=NOT PART OF A SUBROUTINE/1:PART OF A SUBROUTINE      06900000
*        BIT 25: 0=NOT PART OF A SEQUENCE/1=PART OF A SWQUEN            07000000
*        BIT 25: 0=NOT PART OF A SEQUENCE/1=PART OF A SEQUENCE          07100000
*        BITS26-31: RESERVED AND SET TO ZERO                            07200000
*                                                                       07300000
*                                                                       07400000
*                                                                       07500000
         EJECT                                                          07600000
*        WORD 2 CONTAINS THE CORVAL                                     07700000
*                                                                       07800000
*        WORD 3 CONTAINS THE ADDRESS OF THE KEY.                        07900000
*                                                                       08000000
*        WORD 4 CONTAINS THE ADDRESS OF THE GDSCB.                      08100000
*                                                                       08200000
*        WORDS5,6,7&8: ARE SET TO ZERO AND IF A POSITIONING             08300000
*        VECTOR IS REQUIRED BECAUSE OF PREVIOUS SCISSORING, SCISSOR     08400000
*        WILL FILL THE FIELDS IN WITH X ABSOLUTE, Y ABSOLUTE,           08500000
*        X INCREMENTAL, AND Y INCREMENTAL FOR THE POSITIONING           08600000
*        VECTOR.                                                        08700000
*                                                                       08800000
*        WORD 9 CONTAINS X ABSOLUTE.                                    08900000
*                                                                       09000000
*        WORD 10 CONTAINS Y ABSOLUTE.                                   09100000
*                                                                       09200000
*        WORD 11 CONTAINS X INCREMENTAL.                                09300000
*                                                                       09400000
*        WORD 12 CONTAINS Y INCREMENTAL.                                09500000
*                                                                       09600000
*        THE ABOVE WORDS WILL BE SET FROM THE INPUT PASSED AS EITHER    09700000
*        INCREMENTAL OR ABSOLUTE IN USERS UNITS.  SCALE WILL CONVERT    09800000
*        TO RASTER UNITS AND FILL IN THE FORM NOT PASSED.               09900000
*                                                                       10000000
*        WORD 13 CONTAINS THE TOTAL X INCREMENT THUS FAR.               10100000
*                                                                       10200000
*        WORD 14 CONTAINS THE TOTAL Y INCREMENT THUS FAR.               10300000
*                                                                       10400000
*        THE ABOVE WORDS ARE USED IF AN INCREMENTAL REPOSITIONING       10500000
*        VECTOR IS REQUIRED TO REPOSITION WHEN THE ELEMENT IS IN        10600000
*        OMIT STATUS.                                                   10700000
*                                                                       10800000
*        WORD 15 CONTAINS THE ELEMENT COUNT.  IT IS SET TO ZERO         10900000
*        ORIGINALLY AND INCREMENTED BY SCALE. IF THERE IS A             11000000
*        SCALING OR SCISSORING ERROR THE ELEMENT NUMBER IS PLACED       11100000
*        IN THE RETURN ARRAY.                                           11200000
*                                                                       11300000
*                                                                       11400000
         EJECT                                                          11500000
*                                                                       11600000
*        PLINE IS ENTERED AT THE TOP OF THE MODULE AND AFTER SAVING     11700000
*        REGISTERS A REGISTER IS SET TO ZERO AS A SWITCH TO SAY         11800000
*        THAT PLINE WAS CALLED.  PPOINT IS ENTERED AT IFFAFA16 AND      11900000
*        A REGISTER IS SET TO ONE TO SAY THAT PPOINT WAS CALLED.        12000000
*        ALL FUTURE COMMENTS WILL REFER TO THIS MODULE BY THE NAME      12100000
*        PLINE.                                                         12200000
*                                                                       12300000
IFFAFA01 CSECT                     PLINE                                12400000
*2055,270000-272000                                                000A 12500000
*D539500,D541400                                                 YM1963 12600000
*A459500-459980,A750600-750920                                LD YM5163 12700000
*A468600,A780600                                            D11 ZA04161 12800000
*A468300,A480300                                            D11 ZA04162 12900000
*C538000-540000,A541000-542050,C577000-580000,542100-542300 D11 ZA15418 13000000
*587000-590000,A813200-813400                               D11 ZA15418 13050000
*C472000,D474000-482000                                     E12 ZA17700 13070000
         ENTRY IFFAFA16                                                 13100000
         USING *,15                                                     13200000
         SAVE  (14,12)                                                  13300000
         LA    REGA,0              SET PLINE FLAG                       13400000
         B     PLT00100                                                 13500000
         DROP  15                                                       13600000
IFFAFA16 SAVE  (14,12)             ENTRY-PPOINT                         13700000
         LA    REGA,1              SET POINT FLAG                       13800000
*                                                                       13900000
*        THE BASE REGISTER IS SET UP, THE WORK AREA DSECT IS            14000000
*        INITIALIZED, AND THE RETURN ARRAY IS INITIALIZED.  THE GDSCB   14100000
*        IS INITIALIZED AND CHECKED FOR VALIDITY.  THE SAVE AREAS       14200000
*        ARE CHAINED.  THE INPUT PARAMETER LIST FOR DATA GEN IS         14300000
*        SET TO ZERO AND THE SKELETON SWITCHES ARE SET.  THE INITIAL    14400000
*        SETTINGS ARE SINGLE ELEMENT, VECTOR, INCLUDE STATUS,           14500000
*        OPTIMIZE OUTPUT, FIRST PASS, NOT KEYED, NOT CORRELATED,        14600000
*        BEAM ON AND A REPOSITIONING VECTOR REQUIRED.  THE GDSCB        14700000
*        ADDRESS AND RETURN ARRAY ADDRESS ARE PLACED IN THE PARAMETER   14800000
*        LIST.  GDSDATMD SWITCH IN THE GDSCB IS SAVED IN CASE IT        14900000
*        MUST BE CHANGED TEMPORARILY FOR SCALE IN THE CASE OF           15000000
*        BUFFER SUBROUTINE MEMBERS REQUIRING INCREMENTAL INPUT.         15100000
*                                                                       15200000
PLT00100 BALR  BASE,0                                                   15300000
         USING *,BASE                                                   15400000
         LR    WORK,PARM           WORK AREA                            15500000
         USING WORKAREA,WORK                                            15600000
         ST    REGA,WRKSWTCH       SET SWITCH FOR LINE OR POINT         15700000
         L     PARM,WRKPARM        LOAD PARM LIST ADDR                  15800000
         L     ERRCD,WRKRTNCD                                           15900000
         XC    0(20,ERRCD),0(ERRCD) ZERO RETURN ARRAY                   16000000
         L     GDSREG,GDS(PARM)    GDS VAR ADDR                         16100000
         L     GDSREG,0(GDSREG)    GDSCB ADDR                           16200000
         USING GDSCB,GDSREG                                             16300000
         MVC   WRKSWTCH+2(1),GDSDATMD  TEMP SETTING OF DZT MODE         16400000
         LA    REGA,WRKSAVE        CHAIN SAVE AREAS                     16500000
         ST    REGA,8(SAVE)                                             16600000
         ST    SAVE,4(REGA)                                             16700000
         LR    SAVE,REGA                                                16800000
         C     GDSREG,GDSGDSCB     IS GDSCB VALID                       16900000
         BNE   ERR1                NO                                   17000000
         XC    WRKSPVSR(12),WRKSPVSR ZERO SUPERVISOR PARAMETER LIST     17100000
         XC    WRKADDR(68),WRKADDR ZERO PARM LIST                       17200000
         MVC   WRKBITS,BITS        MOVE IN SKELETON                     17300000
         ST    GDSREG,WRKGDS       GDSCB ADDR                           17400000
         MVC   WRKRTN,WRKRTNCD     RTN CODE ADDR                        17500000
         TM    GDSFLAGS,SUBR       PART OF SUBR                         17600000
         BZ    PLT00150            YES,GO CHANGE DATA INPUT SWITCH      17700000
         OI    WRKBITS+3,MEMSUB    SET SUBR SW                          17800000
*                                                                       17900000
*        THE PRESENCE OF THE X AND Y PARAMETERS IS CHECKED AND THEY     18000000
*        ARE PICKED UP IN REGISTERS AND PLACED IN THE DATA ARRAY        18100000
*        DEPENDING ON WHETHER THEY ARE INCREMENTAL OR ABSOLUTE.         18200000
         EJECT                                                          18300000
PLT00150 L     REGE,ONE            SET COUNT TO ONE                     18400000
         TM    GDS(PARM),LAST      LAST PARM                            18500000
         BO    ERRPRM              YES-ERROR                            18600000
         L     REGA,X(PARM)        X ADDR                               18700000
         L     REGA,0(REGA)        X VALUE                              18800000
         TM    GDSDATMD,XABS       IS X ABS                             18900000
         BZ    PLT01600            NO                                   19000000
         ST    REGA,WRKXABS                                             19100000
PLT00200 TM    X(PARM),LAST        LAST PARM                            19200000
         BO    ERRPRM                                                   19300000
         L     REGB,Y(PARM)        Y ADDR                               19400000
         L     REGB,0(REGB)        Y VALUE                              19500000
         TM    GDSDATMD,YABS       IS Y ABS                             19600000
         BZ    PLT01700                                                 19700000
         ST    REGB,WRKYABS                                             19800000
*                                                                       19900000
*        IF THE CORVAL IS PASSED AND THE GDS IS NOT A LEVEL 2 GDS       20000000
*        IT IS PLACED IN THE PARAMETER LIST.  IF THE KEY IS PASSED      20100000
*        THE ADDRESS OF THE VARIABLE IS PLACED IN THE PARAMETER         20200000
*        LIST.  IF THE KEY IS A LEVEL 2 KEY THE SWITCH IN THE PARAMETER 20300000
*        LIST IS NOT SET BECAUSE IT WOULD CAUSE THE GENERATION          20400000
*        OF THE INCLUDE/OMIT STRUCTURE WHICH IS USELESS IN A LEVEL 2    20500000
*        ENVIRONMENT.                                                   20600000
PLT00300 TM    Y(PARM),LAST        ANY OPTIONAL PARMS.                  20700000
         BO    PLT02000            NO                                   20800000
         CLC   NULL+1(3,ERRCD),COR+1(PARM) IS CORVAL NULL               20900000
         BE    PLT00400            NO                                   21000000
         TM    GDSFLAGS,LEVEL2                                          21100000
         BO    PLT00400                                                 21200000
         L     REGD,COR(PARM)      LOAD ADDR OF CORVAL                  21300000
         MVC   WRKCORVL,0(REGD)    PLACE CORVAL IN PARM LIST            21400000
         OI    WRKBITS+2,CORRE     SET CORVAL SW                        21500000
PLT00400 TM    COR(PARM),LAST      ANY MORE                             21600000
         BO    PLT02000            NO                                   21700000
         CLC   NULL+1(3,ERRCD),KEY+1(PARM) IS KEY NULL                  21800000
         BE    PLT00500            YES                                  21900000
         MVC   WRKKEY,KEY(PARM)    PLACE ADDR OF KEY IN LIST            22000000
         TM    GDSFLAGS,LEVEL2     LEVEL 2 KEY                          22100000
         BO    PLT00500            YES                                  22200000
         OI    WRKBITS+2,KEYED     NO SET KEYED SO IN PRM LST           22300000
         EJECT                                                          22400000
*                                                                       22500000
*        THE GENCODE IS CHECKED.  IF ONE THE SWITCH IS ALREADY SET.     22600000
*        FOR 2 OR 3 A KEY OR CORVAL MUST BE PRESENT.  A GENCODE OF      22700000
*        2 FOR A LEVEL 2 GDS IS INVALID.  IF THE GENCODE IS THREE,      22800000
*        AND THIS IS A LEVEL 1 GDS THE KEY OR CORVAL IS SEARCHED        22900000
*        FOR IN THE KEY TABLE.                                          23000000
PLT00500 TM    KEY(PARM),LAST      MORE                                 23100000
         BO    PLT02000            NO                                   23200000
         CLC   NULL+1(3,ERRCD),GEN+1(PARM) IS GENCODE NULL              23300000
         BE    PLT00600            NO                                   23400000
         L     REGD,GEN(PARM)      ADDR OF CODE                         23500000
         L     REGD,0(REGD)        CODE                                 23600000
         C     REGD,ONE            INCLUDE                              23700000
         BE    PLT00600            YES ALREADY SET                      23800000
         CLC   WRKCORVL(8),ZERO                                         23900000
         BZ    ERR3                NO                                   24000000
         C     REGD,TWO            OMIT                                 24100000
         BNE   PLT00700            NO                                   24200000
         TM    GDSFLAGS,LEVEL2     LEVEL2                               24300000
         BO    ERR3                YES-ERROR                            24400000
         NI    WRKBITS,OMIT        TURN OFF INCLUDE SW                  24500000
PLT00600 TM    WRKBITS+2,CORRE     CORRELATED                           24600000
         BZ    PLT00950                                                 24700000
         CLC   WRKCORVL,ZERO       IS CORVAL ZERO                       24800000
         BE    ERR4                BAD CORVAL                           24900000
         B     PLT00950                                                 25000000
PLT00620 OI    GDSDATMD,XINTINC    SET X INPUT INTEGER,INC              25100000
         B     PLT02870            P                                    25200000
PLT00640 OI    GDSDATMD,YINTINC    Y INPUT INTEGER INC                  25300000
         B     PLT02880                                                 25400000
         EJECT                                                          25500000
*                                                                       25600000
*        THE LOGICAL START ADDRESS AND THE LENGTH OF THE KEY FOR        25700000
*        THE UPDATE ELEMENT ARE SAVED.                                  25800000
*                                                                       25900000
PLT00700 C     REGD,THREE                                               26000000
         BNE   ERR3                BAD GENCODE                          26100000
         TM    GDSFLAGS,SUBR       ARE WE CURRENTLY GEN A SUBR          26200000
         BO    ERRPRM              YES, THIS CALL INVALID               26300000
         TM    GDSFLAGS,LEVEL2     LEVEL2                               26400000
         BO    PLT01800            SET KEY                              26500000
         TM    WRKBITS+2,KEYED     KEY                                  26600000
         BZ    PLT01900            NO                                   26700000
         L     REGD,KEY(PARM)      LOAD KEY ADDR                        26800000
*//                                                                     26900000
*//      SEARCH ON KEY                                                  27000000
*//                                                                     27100000
         ST    REGD,WRKKADDR       ADDR OF KEY                          27200000
         ST    GDSREG,WRKGDS1      GDSCB                                27300000
         LA    REGD,TWO            CODE TO SEARCH ON KEY                27400000
         ST    REGD,WRKCODE                                             27500000
PLT00800 LA    PARM,WRKGDS1                                             27600000
         L     REGD,GDSGTMCB       GET POINTER TO GTMCB            000A 27700000
         L     REGD,4(REGD)        GET POINTER TO GSPCB            000A 27800000
         L     REGD,FE(REGD)       GET POINTER TO STATUS TABLE     000A 27900000
         L      REGFIFTN,ETE(REGD) GET ADRS OF KEY TABLE MGMT      000A 28000000
         BALR  RETURN,REGFIFTN     BRANCH TO KEY TABLE MGMT        000A 28100000
         LTR   REGFIFTN,REGFIFTN                                        28200000
         BNE   ERRPRM              INVALID KEY                          28300000
         MVC   WRKADDR,0(PARM)     MOVE IN KEY START                    28400000
         TM    4(PARM),INCL        WAS PREVIOUS INCLUDE                 28500000
         BO    PLT00820            YES                                  28600000
         NI    WRKBITS,OMIT        SET TO OMIT                          28700000
PLT00820 MVC   WRKBITS+3(1),7(PARM)    MOVE IN SEQ/SUBR MEMBER SW       28800000
         ST    PARM,WRKKEY         SAVE ADDR OF KEY IN KEY TABLE        28900000
PLT00900 OI    WRKSWTCH,UPDATE     SET UPDATE SWITCH                    29000000
         L     PARM,WRKPARM        RESET REG                            29100000
         EJECT                                                          29200000
*                                                                       29300000
*        THE COUNT IS CHECKED AND IF GREATER THAN ONE THE INDEX AND     29400000
*        INCREMENT PARAMETERS MUST BE CHECKED FOR. IF NONE ARE          29500000
*        PASSED, THE INDEX IS ASSUMED TO BE ONE.  IF BOTH INDEX AND     29600000
*        INCREMENT ARE PASSED, IT IS AN ERROR.  THE PRESENCE OF         29700000
*        ONE OR THE OTHER IS VERIFIED AND FLAGS ARE SET TO SHOW         29800000
*        WHICH ONE WAS PASSED AND THE INCREMENT OR INDEX IS SAVED.      29900000
PLT00950 TM    GEN(PARM),LAST      IS THIS LAST                         30000000
         BO    PLT02000            YES                                  30100000
         CLC   NULL+1(3,ERRCD),CT+1(PARM)  IS COUNT NULL                30200000
         L     REGE,ONE            SET CT=1                             30300000
         BE    PLT02000            YES                                  30400000
         L     REGE,CT(PARM)                                            30500000
         L     REGE,0(REGE)        PLACE COUNT IN REGE                  30600000
         C     REGE,ZERO           IS COUNT=0                           30700000
         BE    PLT02700            YES,RETURN                           30800000
         BL    ERR7                LOWER=ERROR                          30900000
         C     REGE,ONE            COUNT=1                              31000000
         BE    PLT02000            YES                                  31100000
         TM    CT(PARM),LAST       LAST                                 31200000
         BO    PLT01300            YES                                  31300000
         CLC   NULL+1(3,ERRCD),XINDEX+1(PARM) IS X INDEX NULL           31400000
         BE    PLT01000            YES                                  31500000
         L     REGD,XINDEX(PARM)                                        31600000
         L     REGD,0(REGD)                                             31700000
         ST    REGC,WRKTEMP        SAVE NULL VARIABLE                   31800000
         M     REGC,FOUR           MULTIPLY INDEX BY FOUR               31900000
         L     REGC,WRKTEMP        RELOAD REGISTER                      32000000
         ST    REGD,WRKXCHNG       PLACE INDEX IN AREA                  32100000
         OI    WRKSWTCH+1,XINDX                                         32200000
PLT01000 TM    XINDEX(PARM),LAST   IS THIS THE LAST PARAMETER ?         32300000
         BO    PLT01300                                                 32400000
         CLC   NULL+1(3,ERRCD),YINDEX+1(PARM) IS Y INDEX NULL           32500000
         BE    PLT01100            YES                                  32600000
         L     REGD,YINDEX(PARM)                                        32700000
         L     REGD,0(REGD)        PICK UP INDEX                        32800000
         ST    REGC,WRKTEMP        SAVE NULL VARIABLE                   32900000
         M     REGC,FOUR           MULTIPLY DISP BY FOUR                33000000
         L     REGC,WRKTEMP        LOAC NULL AGAIN                      33100000
         ST    REGD,WRKYCHNG       PLACE INDEX IN AREA                  33200000
         OI    WRKSWTCH+1,YINDX                                         33300000
         EJECT                                                          33400000
PLT01100 TM    YINDEX(PARM),LAST   IS Y INDEX LAST PARM                 33500000
         BO    PLT01300                                                 33600000
         CLC   NULL+1(3,ERRCD),XINCR+1(PARM) IS X INCR NULL             33700000
         BE    PLT01200            YES                                  33800000
         TM    WRKSWTCH+1,XINDX    XINDEX ALSO PASSED                   33900000
         BO    ERRPRM              YES-ERROR                            34000000
         L     REGD,XINCR(PARM)                                         34100000
         MVC   WRKXCHNG,0(REGD)    SAVE INCR                            34200000
         OI    WRKSWTCH+1,XINC     SET SW                               34300000
PLT01200 TM    XINCR(PARM),LAST    LAST                                 34400000
         BO    PLT01300            YES                                  34500000
         CLC   NULL+1(3,ERRCD),YINCR+1(PARM) IS Y INCR NULL             34600000
         BE    PLT01300                                                 34700000
         TM    WRKSWTCH+1,YINDX    YINDEX PASSED ALSO                   34800000
         BO    ERRPRM              YES,ERROR                            34900000
         L     REGD,YINCR(PARM)                                         35000000
         MVC   WRKYCHNG,0(REGD)    SAVE INCR                            35100000
         OI    WRKSWTCH+1,YINC                                          35200000
PLT01300 TM    WRKSWTCH+1,XINDX+XINC    IS AN X PASSED                  35300000
         BZ    PLT01500                                                 35400000
PLT01400 TM    WRKSWTCH+1,YINDX+YINC    IS A Y PASSED                   35500000
         BM    PLT02000                                                 35600000
         MVC   WRKYCHNG,FOUR            NO                              35700000
         OI    WRKSWTCH+1,YINDX         SET INDEX=4                     35800000
         B     PLT02000                                                 35900000
PLT01500 MVC   WRKXCHNG,FOUR                                            36000000
         OI    WRKSWTCH+1,XINDX         SET INDEX=4                     36100000
         B     PLT01400                                                 36200000
PLT01600 ST    REGA,WRKXINCR       STORE X INCR                         36300000
         B     PLT00200                                                 36400000
PLT01700 ST    REGB,WRKYINCR       STORE Y INCR                         36500000
         B     PLT00300                                                 36600000
PLT01800 L     REGD,KEY(PARM)      LOAD KEY ADDR                        36700000
         MVC   WRKADDR,0(REGD)     PLACE KEY IN PARM LIST               36800000
         B     PLT00900                                                 36900000
PLT01900 CLC   WRKCORVL,ZERO                                            37000000
         BE    ERRPRM              BAD PARM COMBINATION                 37100000
*//                                                                     37200000
*//      SEARCH ON CORVAL KEY RETURNED IN REG1                          37300000
*//                                                                     37400000
         LA    REGD,WRKCORVL       ADDR OF CORVAL                       37500000
         ST    REGD,WRKKADDR       IN PARM LIST                         37600000
         LA    REGD,FIVE           CODE SEARCH ON CORVAL                37700000
         ST    REGD,WRKCODE        IN CODE                              37800000
         ST    GDSREG,WRKGDS1      GDSCB ADDR                           37900000
         B     PLT00800                                                 38000000
         EJECT                                                          38100000
**                                                                      38200000
**       ALL THE PARAMETERS ARE CHECKED WE WILL NOW GET SOME            38300000
**       DATA GENERATED.                                                38400000
**                                                                      38500000
*                                                                       38600000
*        THE SWITCH SET ON ENTRY IN THE REGISTER WHICH HAS SINCE        38700000
*        BEEN PLACED IN STORAGE IS CHECKED FOR VECTOR OR POINT          38800000
*        AND THE SWITCH IS SET IN THE PARAMETER LIST. IF THE            38900000
*        CALL IS A MULTIPLE CALL THE SWITCH IS SET. IF IT IS            39000000
*        A SEQUENCE MEMBER OR A SUBROUTINE MEMBER THE SWITCH IS         39100000
*        SET. THE OUTPUT MODE IS SET TO INCREMENTAL FOR PART            39200000
*        OF A SUBROUTINE, OTHERWISE IT IS SET ACCORDING TO THE          39300000
*        GDSCURMD.  THE GDSXLAST, GDSYLAST, GDSXCURR, AND GDSYCURR      39400000
*        FIELDS ARE SAVED IN CASE THE CALL FAILS AND RESET IS           39500000
*        NECESSARY. IF NOT UPDATE THE LOGICAL ADDRESS FROM THE          39600000
*        OACB IS PLACED IN THE KEY. IF UPDATE THE UPDATE GDOAS          39700000
*        WILL BE OBTAINED NOW.                                          39800000
PLT02000 TM    WRKSWTCH+3,POINT    POINT                                39900000
         BZ    PLT02100            NO                                   40000000
         OI    WRKBITS,PT          SET SW FOR POINT                     40100000
PLT02100 C     REGE,ONE            MULTIPLE                             40200000
         BE    PLT02150                                                 40300000
         OI    WRKBITS,MULT        SET SW MULTIPLE ENTRY                40400000
PLT02150 TM    WRKSWTCH,UPDATE     IS THIS AN UPDATE                    40500000
         BO    PLT02200            YES BYPASS CHECK                     40600000
         TM    GDSFLAGS,SEQ        PART OF A SEQUENCE                   40700000
         BZ    PLT02200            NO                                   40800000
         OI    WRKBITS+3,MEMSEQ    YES SET SW IN KEY                    40900000
PLT02200 TM    WRKBITS+3,MEMSUB    PART OF A SUBROUTINE                 41000000
         BO    PLT02850            YES, INCREMENTAL                     41100000
         TM    GDSCURMD,OPT        OPTIMIZE                             41200000
         BO    PLT02300            YES, ALREADY SET                     41300000
         TM    GDSCURMD,INC        INCR                                 41400000
         BO    PLT02900            YES                                  41500000
         XI    WRKBITS,ABSSW       SET TO ABSOLUTE                      41600000
PLT02300 MVC   WRKXCURR(4),GDSXCURR SAVE X-Y CURR                       41700000
         MVC   WRKXLAST(8),GDSXLAST SAVE X-Y LAST                       41800000
         TM    WRKSWTCH,UPDATE     UPDATE                               41900000
         BO    PLT03200            YES                                  42000000
         L     REGD,GDSAOACB       OACB                                 42100000
         L     REGD,CURRLOG(REGD)  LOGICAL START                        42200000
         STH   REGD,WRKADDR+2      IN ELEMENT                           42300000
*                                                                       42400000
*        IF THE ELEMENT IS A MULTIPLE ONE THE FUTURE LOOP IS SET        42500000
*        UP. THE ADDRESS OF THE GDSCB IN THE PARAMETER LIST             42600000
*        WE HAVE BEEN BUILDING IS PLACED IN REGISTER 1 AND THE          42700000
*        DATA IS SCALED. IF THE CALL IS TO A BUFFER SUBROUTINE          42800000
*        MEMBER NO SCISSORING WILL TAKE PLACE. IF THE OPTION            42900000
*        IS NO SCISSORING THE GDSXLAST, GDSYLAST, GDSXCURR,             43000000
*        AND GDSYCURR FIELDS IN THE GDSCB ARE UPDATED. THE              43100000
*        SCISSORING FLAGS ARE ALSO SET SUCH THAT IT APPEARS AS          43200000
*        IF THE LAST CALL WAS ON THE SCREEN AND ON THE GRID.            43300000
PLT02350 OI    WRKSWTCH,FIRST      SET FIRST TIME SWITCH SO THAT THE    43400000
*        FIRST CALL TO DATA GENERATOR IS NOT BYPASSED BECAUSE OF NO     43500000
*        MOVEMENT FROM THE LAST BEAM POSITION                           43600000
         C     REGE,ONE            MORE THAN ONE                        43700000
         BH    PLT03400            YES SET UP FUTURE LOOP               43800000
         EJECT                                                          43900000
*                                                                       44000000
*        COUNT IN REGE   X IN REGA  Y IN REGB                           44100000
*                                                                       44200000
PLT02400 LA    PARM,WRKGDS                                              44300000
*/*                                                                     44400000
*/*      CALL  SCALE                                                    44500000
*/*                                                                     44600000
         L     REGFIFTN,STAT(ERRCD) ADDR OF STATUS TABLE                44700000
         L     REGFIFTN,SCALE(REGFIFTN) ADDRESS OF SCALE                44800000
         BALR  RETURN,REGFIFTN     BRANCH TO SCALE                      44900000
         LTR   REGFIFTN,REGFIFTN   SCALE OK                             45000000
         BNE   ERR10               RESET AND RETURN                     45100000
         TM    GDSFLAGS,SUBR       SUBR                                 45200000
         BO    PLT02450            NO SCISS OR CHANGE OF BEAM IN GDSCV  45300000
         TM    GDSSCISS,NOSCISS    NO SCISS WANTED                      45400000
         BO    PLT03000            NONE                                 45500000
         LA    PARM,WRKGDS                                              45600000
*//      CALL SCISSOR                                                   45700000
*//                                                                     45800000
         L     REGFIFTN,STAT(ERRCD)                                     45900000
         L     REGFIFTN,SCISS(REGFIFTN) ADDRESS OF SCISSOR              46000000
         BALR  RETURN,REGFIFTN                                          46100000
         LTR   REGFIFTN,REGFIFTN   ERROR                                46200000
         BNE   PLT03100            YES                                  46300000
         TM    WRKSWTCH,FIRST      FIRST ONE                            46400000
         BO    PLT02401            YES, GENERATE ANYWAY     L5 @ZA04162 46500000
         CLC   WRKXINCR(8),ZERO    ANY MOVEMENT?                        46600000
         BE    PLT02500            NO-DON'T GENERATE                    46700000
PLT02401 EQU   *                                            L5 @ZA04162 46800000
         EJECT                                                          46900000
         L     REGFIFTN,GDSGTMCB        GET POINTER TO GTMCB  LD YM5163 47000000
         TM    WRKSWTCH,UPDATE          UPDATE CALL?        L5 @ZA04162 47100000
         BNO   PLT02450                 NO,SKIP DGEN FLGS  E12 @ZA17700 47200000
         OI    GTMUPDT(REGFIFTN),UPDATE  SET DGEN FLG       L5 @ZA04162 47300000
*    THE NEXT SEVEN LINES HAVE BEEN DELETED BY APAR ------>E12 @ZA17700 47350000
*PLT02402 EQU   *                                           L5 @ZA04162 47400000
*        L     REGFIFTN,GSPPTR(REGFIFTN) GET PTR TO GSPCB     LD YM5163 47440000
*        TM    ARRAY(REGFIFTN),SCISORED WAS SCISSORING USED?  LD YM5163 47560000
*        BZ    PLT02450                 BRANCH IF NO          LD YM5163 47700000
*        TM    WRKSWTCH+3,PLTPTNT       WAS POINT SCISSORED?  LD YM5163 47750000
*        BZ    PLT02450                 BRANCH IF NO          LD YM5163 47800000
*        NI    WRKBITS+2,BLANK          SET FLAGS SO DATA...  LD YM5163 47850000
*                                       GEN WILL BLANK....    LD YM5163 48100000
*                                       THE BEAM.             LD YM5163 48200000
PLT02450 LA    PARM,WRKADDR                                             48300000
*//                                                                     48400000
*//      CALL DATA GEN                                                  48500000
*//                                                                     48600000
         L     REGFIFTN,STAT(ERRCD)                                     48700000
         L     REGFIFTN,DGEN(REGFIFTN)  ADDRESS OF DATA GEN             48800000
         BALR  RETURN,REGFIFTN                                          48900000
         LTR   REGFIFTN,REGFIFTN   ERROR                                49000000
         BNE   ERR10               RESET AND RETURN                     49100000
         L     REGFIFTN,GDSGTMCB   GET GTMCB ADDRESS        L5 @ZA04162 49200000
         NI    GTMUPDT(REGFIFTN),UPDTOFF  TURN OFF DGEN FLG L5 @ZA04161 49300000
         NI    WRKSWTCH,OFF        TURN OFF FIRST SWITCH                49400000
*                                                                       49500000
*        THE VECTOR OR POINT IS GENERATED BY DATA GEN AND               49600000
*        STORED IN THE GDOA BY DATA STORE.  IF THERE ARE NO             49700000
*        MORE TO DO THE UPDATE GDOAS ARE WRITTEN OUT IF UPDATE,         49800000
*        OR THE KEY IS COMPLETED AND PLACED IN THE KEY TABLE IF         49900000
*        NECESSARY AND IN THE USER VARIABLE IF PASSED.  THE             50000000
*        SWITCHES IN THE GDSDATMD FIELD ARE RESET AND CONTROL           50100000
*        IS RETURNED TO THE CALLING PROGRAM.                            50200000
*                                                                       50300000
PLT02500 BCT   REGE,PLT03700       MORE TO DO                           50400000
         TM    WRKSWTCH,FIRST      HAS ANY DATA BEEN GEN                50500000
         BO    ERR8                NO                                   50600000
         TM    WRKSWTCH,LSTONE     WAS LAST ONE GENERATED               50700000
         BZ    PLT02550            YES                                  50800000
         OI    WRKBITS+2,REPONLY   SET FLAG TO GEN REPOS VECT           50900000
         XC    WRKDATA1(32),WRKDATA1                                    51000000
         MVC   WRKXABS+2(2),GDSXCURR    PLACE CURRENT BEAM POSITION     51100000
         MVC   WRKYABS+2(2),GDSYCURR FROM GDS INTO DATA ARRAY           51200000
         LA    REGE,1              RESET COUNT TO FALL THROUGH          51300000
         B     PLT02450            CALL DATA GEN                        51400000
PLT02550 TM    WRKSWTCH,UPDATE     UPDATE                               51500000
         BO    PLT03300            YES                                  51600000
         L     REGE,GDSAOACB       NO                                   51700000
         L     REGE,CURRLOG(REGE)  GET CURR LOG ADDR                    51800000
         SH    REGE,WRKADDR+2      COMPUTE ELEM LEN                     51900000
         LTR   REGE,REGE           ANY DATA GENERATED                   52000000
         BE    ERR8                NO ERROR                             52100000
         STH   REGE,WRKADDR        PLACE LENGTH IN KEY                  52200000
         L     REGE,WRKKEY                                              52300000
         LTR   REGE,REGE                                                52400000
         BE    PLT02600                                                 52500000
         MVC   0(4,REGE),WRKADDR   PLACE KEY IN USER VARIABLE           52600000
PLT02600 TM    WRKBITS+2,KEYED+CORRE KEYED OR CORRELATED                52700000
         BZ    PLT02700            NO                                   52800000
*//                                                                     52900000
*//      CALL KEY TABLE TO ADD KEY                                      53000000
*//                                                                     53100000
         ST    GDSREG,WRKGDS1      GDSCB FOR KEY TABLE MGT              53200000
         LA    REGA,ONE            CODE                                 53300000
         ST    REGA,WRKCODE        IN PARM LIST                         53400000
         LA    REGA,WRKADDR        ADDR OF KEY                          53500000
         ST    REGA,WRKKADDR       IN PARM LIST                         53600000
         LA    PARM,WRKGDS1                                             53700000
         L     REGFIFTN,GDSGTMCB   GET POINTER TO GTMCB     D11 OZ15418 53800000
         L     REGFIFTN,4(REGFIFTN) GET POINTER TO GSPCB    D11 OZ15418 53900000
         L     REGFIFTN,FE(REGFIFTN) POINT TO STATUS TABLE  D11 ZA15418 54000000
         L     REGFIFTN,ETE(REGFIFTN) ADDR OF KEYTBL MGR    D11 ZA15418 54100000
         LTR   REGFIFTN,REGFIFTN   LOADED YET ?             D11 ZA15418 54130000
         BZ    PLTLINK1            NO,MUST USE SYSTEM LINK  D11 ZA15418 54160000
         BALR  RETURN,REGFIFTN     BRANCH TO KEY TABLE MGMT D11 ZA15418 54200000
         B     PLTRTN1             RETURN FROM BALR         D11 ZA15418 54206000
PLTLINK1 LA    REGA,16             CVT                      D11 ZA15418 54212000
         L     REGA,CVTLINK(REGA)  LINKLIB DCB                          54218000
         LINK  EP=IFFAHA03,MF=(E,(1)),SF=(E,WRKSPVSR)                   54224000
PLTRTN1  LTR   REGFIFTN,REGFIFTN   SUCCESSFUL               D11 ZA15418 54230000
         BNE   ERR9                NO                                   54260000
PLT02700 L     SAVE,4(SAVE)                                             54300000
         MVC   GDSDATMD,WRKSWTCH+2 RESET DATA MODE                      54400000
PLT02800 RETURN (14,12),T          RETURN                               54500000
         EJECT                                                          54600000
*                                                                       54700000
*        IF THIS CALL IS TO GENERATE DATA THAT IS TO BE PART OF A       54800000
*        BUFFER SUBROUTINE, THE GDSDATMD SWITCH IS CHANGED TO           54900000
*        REFLECT EITHER REAL OR INTEGER INCREMENTAL DATA AS INPUT.      55000000
PLT02850 XC    GDSDATMD,GDSDATMD   ZERO DATA MODE SW                    55100000
         TM    WRKSWTCH+2,REALX    REAL                                 55200000
         BZ    PLT00620            NO                                   55300000
         OI    GDSDATMD,XRELINC    SET X INPUT REAL,INC                 55400000
PLT02870 TM    WRKSWTCH+2,REALY    REAL                                 55500000
         BZ    PLT00640            NO                                   55600000
         OI    GDSDATMD,YRELINC    SET Y INPUT REAL,INC                 55700000
PLT02880 XC    WRKXABS(16),WRKXABS                                      55800000
         ST    REGA,WRKXINCR      SET X INCREMENTAL                     55900000
         ST    REGB,WRKYINCR      SET Y INCREMENTAL                     56000000
PLT02900 XI    WRKBITS,INCSW                                            56100000
         B     PLT02300                                                 56200000
PLT03000 L     PARM,WRKXABS        LOAD X                               56300000
         ST    PARM,GDSXLAST       STORE IN LAST LOC                    56400000
         SH    PARM,GDSXCURR       COMPUTE NEW INCR                     56500000
         ST    PARM,WRKXINCR       STORE                                56600000
         MVC   GDSXCURR,WRKXABS+2      XCURR                            56700000
         L     PARM,WRKYABS        LOAD Y                               56800000
         ST    PARM,GDSYLAST       STORE IN LAST LOC                    56900000
         SH    PARM,GDSYCURR       COMPUTE NEW INCR                     57000000
         ST    PARM,WRKYINCR       STORE                                57100000
         MVC   GDSYCURR,WRKYABS+2      YCURR IN GDSCB                   57200000
         NI    GDSSCISS,LASTON                                          57300000
         B     PLT02450                                                 57400000
PLT03100 C     REGFIFTN,FOUR            STOP GENERATION                 57500000
         BE    ERR10               YES, RESET AND RETURN                57600000
         B     PLT02500                                                 57700000
*//      GET GDOA'S FOR UPDATE                                          57800000
PLT03200 LA    PARM,WRKADDR        PARMLIST FOR IFFAHA13    D11 ZA15418 57900000
         L     REGFIFTN,STAT(ERRCD) POINT TO STATUS TABLE   D11 ZA15418 58000000
         L     REGFIFTN,UPDH13(REGFIFTN) AND TO IFFAHA13    D11 ZA15418 58100000
         BALR  RETURN,REGFIFTN     GOTO IFFAHA13            D11 ZA15418 58200000
         LTR   REGFIFTN,REGFIFTN   SUCCESS                              58300000
         BNE   PLT02700            NO                                   58400000
         B     PLT02350                                                 58500000
         EJECT                                                          58600000
*/                                                                      58700000
*//      WRITE OUT UPDATE                                               58800000
PLT03300 LA    PARM,WRKADDR        PARMLIST ADDRESS FOR H14 D11 ZA15418 58900000
         L     REGFIFTN,STAT(ERRCD) POINT TO STATUS TABLE   D11 ZA15418 59000000
         L     REGFIFTN,UPDH14(REGFIFTN) AND TO IFFAHA14    D11 ZA15418 59100000
         BALR  RETURN,REGFIFTN     GOTO IFFAHA14            D11 ZA15418 59200000
         TM    GDSFLAGS,LEVEL2                                          59300000
         BO    PLT02700                                                 59400000
         L     REGD,WRKKEY                                              59500000
         MVC   0(8,REGD),WRKADDR   REPLACE KEY                          59600000
         TM    WRKBITS+2,CORRE     IS IS IT CORRELATED                  59700000
         BZ    PLT02700            NO EXIT                              59800000
         L     REGD,WRKKEY         ADDR OF KEY IN KEY TABLE             59900000
         MVC   8(4,REGD),WRKCORVL  REPLACE CORVAL                       60000000
         B     PLT02700                                                 60100000
PLT03400 L     PARM,WRKPARM        RESET REG                            60200000
         TM    WRKSWTCH+1,XINDX    X INDEX                              60300000
         BO    PLT03600            YES                                  60400000
PLT03500 TM    WRKSWTCH+1,YINDX    Y INDEX                              60500000
         BZ    PLT02400            NO                                   60600000
         L     REGB,Y(PARM)        REP Y VAL WITH Y ADDR                60700000
         B     PLT02400                                                 60800000
         EJECT                                                          60900000
PLT03600 L     REGA,X(PARM)        REP X VAL WITH X ADDR                61000000
         B     PLT03500                                                 61100000
*                                                                       61200000
*        IN ORDER TO GENERATE THE NEXT DATA THE DATA FIELDS IN          61300000
*        THE PARAMETER LIST ARE ZEROED.  THE NOT FIRST NOT              61400000
*        LAST SWITCH IS SET. IF THIS IS THE LAST TIME THEN THE          61500000
*        LAST SWITCH IS SET. THE ARRAY IS INDEXED THROUGH OR            61600000
*        THE INCREMENT IS ADDED TO THE PREVIOUS DATA TO FORM            61700000
*        THE NEW DATA. THEN SCALE IS CALLED, SCISSOR, ETC.              61800000
*                                                                       61900000
PLT03700 XC    WRKDATA1(32),WRKDATA1 ZERO DATA                          62000000
         TM    WRKSWTCH,FIRST      HAS ANY DATA BEEN GENERATED YET      62100000
         BO    PLT03730            NO SO DONT CHANGE THE FIRST SW IN PL 62200000
         OI    WRKBITS+2,NFNL      SET NOT FIRST LAST SWITCH            62300000
PLT03730 C     REGE,ONE            IS THIS THE LAST ONE                 62400000
         BE    PLT04900            LAST TIME                            62500000
PLT03750 TM    WRKSWTCH+1,XINDX    INDEX X                              62600000
         BZ    PLT04100            NO                                   62700000
         A     REGA,WRKXCHNG                                            62800000
         TM    GDSDATMD,ABSOLX     X ABS                                62900000
         BZ    PLT03900                                                 63000000
         MVC   WRKXABS,0(REGA)     MOVE IN X ABS                        63100000
PLT03800 TM    WRKSWTCH+1,YINDX    Y INDEX                              63200000
         BZ    PLT04300            NO                                   63300000
         A     REGB,WRKYCHNG                                            63400000
         TM    GDSDATMD,ABSOLY     Y ABS                                63500000
         BZ    PLT04000            NO                                   63600000
         MVC   WRKYABS,0(REGB)     MOVE IN Y ABS                        63700000
         B     PLT02400                                                 63800000
PLT03900 MVC   WRKXINCR,0(REGA)    MOVE IN X INCR                       63900000
         B     PLT03800                                                 64000000
PLT04000 MVC   WRKYINCR,0(REGB)    MOVE IN Y INCR                       64100000
         B     PLT02400                                                 64200000
         EJECT                                                          64300000
PLT04100 TM    GDSDATMD,REALX      X IN FLOAT                           64400000
         BM    PLT04500            YES                                  64500000
         A     REGA,WRKXCHNG       ADD X INCRE                          64600000
PLT04200 TM    GDSDATMD,ABSOLX     ABSOLUTE                             64700000
         BZ    PLT04600            NO                                   64800000
         ST    REGA,WRKXABS        STORE IN ABS LOC                     64900000
         B     PLT03800            CHECK Y                              65000000
PLT04300 TM    GDSDATMD,REALY      Y REAL                               65100000
         BM    PLT04700            YES                                  65200000
         A     REGB,WRKYCHNG       ADD Y INCR                           65300000
PLT04400 TM    GDSDATMD,ABSOLY     Y ABS                                65400000
         BZ    PLT04800            NO                                   65500000
         ST    REGB,WRKYABS        STORE IN ABS                         65600000
         B     PLT02400                                                 65700000
PLT04500 ST    REGA,WRKTEMP        STORE # IN CORE                      65800000
         LE    FLT2,WRKTEMP                                             65900000
         AE    FLT2,WRKXCHNG       ADD INCR IN FLOAT INSTR              66000000
         STE   FLT2,WRKTEMP                                             66100000
         L     REGA,WRKTEMP        REPLACE IN REG                       66200000
         B     PLT04200                                                 66300000
PLT04600 MVC   WRKXINCR,WRKXCHNG   STORE X IN INCR                      66400000
         B     PLT03800            CHECK Y                              66500000
PLT04700 ST    REGB,WRKTEMP        STORE IN CORE                        66600000
         LE    FLT2,WRKTEMP                                             66700000
         AE    FLT2,WRKYCHNG       ADD Y INCR IN                        66800000
         STE   FLT2,WRKTEMP        FLOAT INSTR                          66900000
         L     REGB,WRKTEMP        RELOAD REG                           67000000
         B     PLT04400                                                 67100000
PLT04800 MVC   WRKYINCR,WRKYCHNG   STORE Y INCR                         67200000
         B     PLT02400                                                 67300000
PLT04900 TM    WRKSWTCH,FIRST      ANY GENERATED YET                    67400000
         BO    PLT05000            NO CHANGE ENTRY TO SINGEL            67500000
         OI    WRKBITS+2,LASTIN    SET LAST TIME SWITCH                 67600000
         OI    WRKSWTCH,LSTONE     SET SWITCH TO SAY LAST TIME IN       67700000
         B     PLT03750            CONTINUE ON                          67800000
PLT05000 XI    WRKBITS,MULT        MULTIPLE ENTRY HAS BECOME A SINGLE   67900000
         B     PLT03750            CONTINUE                             68000000
         EJECT                                                          68100000
ERR1     MVC   PARMERR(4,ERRCD),ONE GDS INVALID                         68200000
ERRPRM   OI    0(ERRCD),PRM        PARM ERROR                           68300000
         B     PLT02700                                                 68400000
ERR3     MVC   PARMERR(4,ERRCD),SIX GENCODE                             68500000
         B     ERRPRM                                                   68600000
ERR4     MVC   PARMERR(4,ERRCD),FOUR CORVAL                             68700000
         B     ERRPRM                                                   68800000
ERR7     MVC   PARMERR(4,ERRCD),SEVEN COUNT                             68900000
ERR8     OI    0(ERRCD),SCISSOR    NO DATA GEN                          69000000
         XC    4(4,ERRCD),4(ERRCD) ZERO SCISSOR COUNT                   69100000
         B     PLT02700                                                 69200000
ERR9     OI    0(ERRCD),STRG       MAIN STORAGE EXCEEDED                69300000
         MVC   STOR(4,ERRCD),FOUR                                       69400000
ERR10    MVC   GDSXLAST(8),WRKXLAST RESET SYSTEM                        69500000
         MVC   GDSXCURR(4),WRKXCURR                                     69600000
         TM    WRKSWTCH,UPDATE     UPDATE                               69700000
         BO    PLT02700            NO RESET RQD                         69800000
*//                                                                     69900000
*//      CALL RESET TO RESET SYSTEM                                     70000000
*//                                                                     70100000
         MVC   WRKDATA2(20),0(ERRCD)   SAVE RETURN ARRAY                70200000
         LA    REGA,GDSGDSCB       VAR CONTAINING ADDR OF GDS           70300000
         ST    REGA,WRKGDS         IN PARAMETER LIST                    70400000
         L     REGA,NULL(ERRCD)    NULL FOR CORVAL                      70500000
         ST    REGA,WRKRTN         IN PARM LIST                         70600000
         LA    REGA,WRKADDR        ADDRESS OF KEY                       70700000
         ST    REGA,WRKDATA1       IN PARAMETER LIST                    70800000
         OI    WRKDATA1,LAST       LAST PARM SW                         70900000
         LA    REGA,WRKGDS         ADDR OF PARM LIST                    71000000
         ST    REGA,WRKGDS1        IN WORK AREA                         71100000
         ST    ERRCD,WRKCODE       ERROR CODE IN PARM LIST              71200000
         LA    PARM,WRKGDS1        ADDR OF WRK AREA IN R1               71300000
         LINK  EP=IFFAFA12,MF=(E,(1)),SF=(E,WRKSPVSR)                   71400000
*        LINK TO RESET ROUTINE                                          71500000
         MVC   0(20,ERRCD),WRKDATA2                                     71600000
*        RESET RETURN ARRAY                                             71700000
         B     PLT02700                                                 71800000
         EJECT                                                          71900000
* REGISTERS                                                             72000000
REGZERO  EQU   0                                                        72100000
PARM     EQU   1                                                        72200000
REGA     EQU   2                                                        72300000
REGB     EQU   3                                                        72400000
REGE     EQU   4                                                        72500000
WORK     EQU   5                                                        72600000
ERRCD    EQU   6                                                        72700000
GTMREG   EQU   7                                                        72800000
GDSREG   EQU   8                                                        72900000
BASE     EQU   9                                                        73000000
REGC     EQU   10                                                       73100000
REGD     EQU   11                                                       73200000
SAVE     EQU   13                                                       73300000
RETURN   EQU   14                                                       73400000
REGFIFTN EQU   15                                                       73500000
FLT2     EQU   2                   FLOATING PT REG                      73600000
         EJECT                                                          73700000
ZERO     DC    2F'0'                                                    73800000
ONE      DC    F'1'                                                     73900000
TWO      DC    F'2'                                                     74000000
THREE    DC    F'3'                                                     74100000
FOUR     DC    F'4'                                                     74200000
BITS     DC    B'00000111'         SINGLE,VECTOR,INCLUDE,OPTIMIZE       74300000
         DC    X'00'                                                    74400000
         DC    B'00001000'         FIRST PASS,NOT KEY,COR,BEAMON,REPOS  74500000
         DC    X'00'                                                    74600000
SIX      DC    F'6'                                                     74700000
SEVEN    DC    F'7'                                                     74800000
PATCH    DC    10F'0'                                       L5 @ZA04162 74900000
SCISSOR  EQU   X'40'                                                    75000000
FE       EQU   48                                                  000A 75100000
ETE      EQU   828                                                 000A 75200000
         EJECT                                                          75300000
OMIT     EQU   X'FB'                                                    75400000
XINDX    EQU   X'C0'                                                    75500000
YINDX    EQU   X'0C'                                                    75600000
XINC     EQU   X'30'                                                    75700000
YINC     EQU   X'03'                                                    75800000
MULT     EQU   X'80'                                                    75900000
OPT      EQU   X'04'                                                    76000000
ABS      EQU   X'02'                                                    76100000
ABSSW    EQU   X'03'                                                    76200000
INCSW    EQU   X'02'                                                    76300000
SUBR     EQU   X'02'                                                    76400000
INC      EQU   X'01'                                                    76500000
NOSCISS  EQU   X'10'                                                    76600000
LASTON   EQU   X'1F'                                                    76700000
CURRLOG  EQU   52                                                       76800000
ABSOLX   EQU   X'A0'                                                    76900000
ABSOLY   EQU   X'0A'                                                    77000000
REALX    EQU   X'C0'                                                    77100000
REALY    EQU   X'0C'                                                    77200000
PT       EQU   X'10'                                                    77300000
NULL     EQU   20                                                       77400000
LAST     EQU   X'80'                                                    77500000
XABS     EQU   X'A0'                                                    77600000
YABS     EQU   X'0A'                                                    77700000
CORRE    EQU   X'10'                                                    77800000
KEYED    EQU   X'20'                                                    77900000
LEVEL2   EQU   X'10'                                                    78000000
POINT    EQU   X'01'                                                    78100000
MEMSUB   EQU   X'80'                                                    78200000
MEMSEQ   EQU   X'40'                                                    78300000
SEQ      EQU   X'04'                                                    78400000
XINTINC  EQU   X'10'                                                    78500000
XRELINC  EQU   X'40'                                                    78600000
YINTINC  EQU   X'01'                                                    78700000
YRELINC  EQU   X'04'                                                    78800000
EVENFOUR EQU   X'FC'                                                    78900000
ARRAY    EQU   X'18'               OFFSET TO GSPARRAY         LD YM5163 79000000
GSPPTR   EQU   4                   OFFSET TO GSPCB IN GTMCB   LD YM5163 79100000
SCISORED EQU   X'40'               SCISSOR FLAGS IN ARRAY     LD YM5163 79200000
PLTPTNT  EQU   X'01'               PLOT POINT FLAGS           LD YM5163 79300000
BLANK    EQU   X'F7'               BLANK BEAM BIT MASK        LD YM5163 79400000
* PARM LIST EQUATES                                                     79500000
GDS      EQU   0                                                        79600000
X        EQU   4                                                        79700000
Y        EQU   8                                                        79800000
COR      EQU   12                                                       79900000
KEY      EQU   16                                                       80000000
GEN      EQU   20                                                       80100000
CT       EQU   24                                                       80200000
XINDEX   EQU   28                                                       80300000
YINDEX   EQU   32                                                       80400000
XINCR    EQU   36                                                       80500000
YINCR    EQU   40                                                       80600000
PARMERR  EQU   16                                                       80700000
PRM      EQU   X'08'                                                    80800000
STRG     EQU   X'10'                                                    80900000
STOR     EQU   12                                                       81000000
NFNL     EQU   X'40'                                                    81100000
LASTIN   EQU   X'C0'                                                    81200000
DGEN     EQU   840                                                      81300000
SCISS    EQU   876                                                      81400000
SCALE    EQU   864                                                      81500000
UPDH13   EQU   936               DISPL OF H13 IN STATAB     D11 ZA15418 81600000
UPDH14   EQU   948               DISPL OF H14 IN STATAB     D11 ZA15418 81700000
STAT     EQU   24                                                       81800000
FIVE     DC    F'5'                                                     81900000
CVTLINK  EQU   8                                                        82000000
INCL     EQU   X'04'                                                    82100000
REPONLY  EQU   X'02'                                                    82200000
FIRST    EQU   X'02'                                                    82300000
LSTONE   EQU   X'01'                                                    82400000
OFF      EQU   X'FC'                                                    82500000
UPDATE   EQU   X'80'                                                    82600000
GTMUPDT  EQU   X'3C'             DISP IN GTMCB FOR DGN FLG  L5 @ZA04162 82700000
UPDTOFF  EQU   X'7E'             MASK TO TURN OFF DGEN FLG  L5 @ZA04161 82800000
         EJECT                                                          82900000
WORKAREA DSECT                                                          83000000
WRKPARM  DS    F                                                        83100000
WRKRTNCD DS    F                                                        83200000
WRKSWTCH DS    F                                                        83300000
*        SWITCH SETTINGS FOR WRKSWTCH - PLINE AND PPOINT                83400000
*                                                                       83500000
*        WRKSWTCH+1                                                     83600000
*        C0 = X INDEX PASSED                                            83700000
*        30 = X INCREMENT PASSED                                        83800000
*        0C = Y INDEX PASSED                                            83900000
*        03 = Y INCREMENT PASSED                                        84000000
*                                                                       84100000
*        WRKSWTCH+2                                                     84200000
*        80 = X IS REAL,ABSOLUTE                                        84300000
*        40 = X IS REAL,INCREMENTAL                                     84400000
*        20 = X IS INTEGER,ABSOLUTE                                     84500000
*        10 = X IS INTEGER,INCREMENTAL                                  84600000
*        08 = Y IS REAL,ABSOLUTE                                        84700000
*        04 = Y IS REAL,INCREMENTAL                                     84800000
*        02 = Y IS INTEGER,ABSOLUTE                                     84900000
*        01 = Y IS INTEGER,INCREMENTAL                                  85000000
*                                                                       85100000
*        WRKSWTCH+3                                                     85200000
*        00 = PLINE                                                     85300000
*        O1 = PPOINT                                                    85400000
*                                                                       85500000
WRKSAVE  DS    18F                                                      85600000
WRKSPVSR DS    3F                                                       85700000
WRKXCURR DS    H                                                        85800000
WRKYCURR DS    H                                                        85900000
WRKXLAST DS    F                                                        86000000
WRKYLAST DS    F                                                        86100000
WRKXCHNG DS    F                                                        86200000
WRKYCHNG DS    F                                                        86300000
WRKTEMP  DS    F                                                        86400000
WRKADDR  DS    F                                                        86500000
WRKBITS  DS    F                                                        86600000
WRKCORVL DS    F                                                        86700000
WRKKEY   DS    F                                                        86800000
WRKGDS   DS    F                                                        86900000
WRKRTN   DS    F                                                        87000000
WRKDATA1 DS    F                                                        87100000
WRKDATA2 DS    F                                                        87200000
WRKDATA3 DS    F                                                        87300000
WRKDATA4 DS    F                                                        87400000
WRKXABS  DS    F                                                        87500000
WRKYABS  DS    F                                                        87600000
WRKXINCR DS    F                                                        87700000
WRKYINCR DS    F                                                        87800000
WRKTOTX  DS    F                                                        87900000
WRKTOTY  DS    F                                                        88000000
WRKENTCT DS    F                                                        88100000
WRKGDS1  DS    F                                                        88200000
WRKCODE  DS    F                                                        88300000
WRKKADDR DS    F                                                        88400000
         COPY  GDSCB                                                    88500000
         COPY  GTMCB                                                    88600000
         COPY  GSPCB                                                    88700000
         END                                                            88800000
./  ADD  SSI=80330202,NAME=IFFAFA02
         TITLE 'PSGMT --IFFAFA02'                                       00090000
*********************************************************************** 00180000
*                                                                       00270000
*TITLE         PSGMT                                                  * 00360000
*                                                                     * 00450000
*MODULE NAME   IFFAFA02                                               * 00540000
*                                                                     * 00630000
*STATUS        CHANGE LEVEL 000                                       * 00720000
*                                                                     * 00810000
*FUNCTION/OPERATION                                                   * 00900000
*  TO PRODUCE LINE SEGMENTS ON THE GRAPHIC OUTPUT MEDIUM AT THE       * 00990000
*  POSITIONS SPECIFIED BY THE ARGUMENTS, AND TO UPDATE GRAPHIC        * 01080000
*  DATA PREVIOUSLY PRODUCED BY PSGMT. EACH LINE SEGMENT IS IS         * 01170000
*  DETERMINED BY TWO SUPPLIED ARGUMENT POINTS.                        * 01260000
*  EACH LINE SEGMENT TO BE DISPLAYED DEMANDS TWO CALLS TO THE DATA    * 01350000
*  GENERATION ROUTINE, THE FIRST TO MOVE THE BEAM TO THE SEGMENT      * 01440000
*  START POINT (BLANKED MODE), THE SECOND TO DISPLAY THE LINE         * 01530000
*  SEGMENT(UNBLANKED MODE).                                           * 01620000
*                                                                     * 01710000
*ENTRY POINT   IFFAFA02- CSECT NAME                                   * 01800000
*                                                                     * 01890000
*INPUT   REGISTER 1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA. THE     * 01980000
*  FIRST WORD CONTAINS THE ADDRESS OF A VARIABLE LENGTH PARAMETER     * 02070000
*  LIST ON A FULL WORD BOUNDARY, THE SECOND WORD CONTAINS THE         * 02160000
*  ADDRESS OF THE RETURN ARRAY. THE NULL VARIABLE IS AT AN OFFSET     * 02250000
*  OF 20 FROM THE RETURN ARRAY, AND THE ADDRESS OF THE STATUS TABLE   * 02340000
*  IS AT AN OFFSET OF 24 FROM THE RETURN ARRAY.                       * 02430000
*FORMAT OF PARAMETER LIST                                             * 02520000
* REQUIRED PARAMETERS                                                 * 02610000
*                                                                     * 02700000
*  +0   A(VAR)      ADDRESS OF A VARIABLE WHICH CONTAINS THE GDSCB    * 02790000
*                   ADDRESS.                                          * 02880000
*  +4   A(UVAL1)    ADDRESS OF THE U VALUE PARAMETER FOR THE SEGMENT  * 02970000
*                   START.                                            * 03060000
*  +8   A(VVAL1)    ADDRESS OF THE V VALUE PARAMETER FOR THE SEGMENT  * 03150000
*                   START.                                            * 03240000
* +12   A(UVAL2)    ADDRESS OF THE U VALUE PARAMETER FOR THE SEGMENT  * 03330000
*                   END.                                              * 03420000
* +16   A(VVAL2)    ADDRESS OF THE V VALUE PARAMETER FOR THE SEGMENT  * 03510000
*                   END.                                              * 03600000
*                                                                     * 03690000
*  OPTIONAL PARAMETERS                                                * 03780000
*                                                                     * 03870000
* +20   A(CORRVAL)  ADDRESS OF A FULL WORD CONTAINING A CORRELATION   * 03960000
*                   VALUE.                                            * 04050000
* +24   A(KEY)      ADDRESS OF KEY VARIABLE                             04140000
* +28   A(GENCODE)  ADDRESS OF THE CODE WHICH SPECIFIES THE TYPE OF     04230000
*                   OUTPUT - EITHER BLANKED, UNBLANKED, OR UPDATE     * 04320000
* +32   A(COUNT)    ADDRESS OF A VARIABLE WHICH CONTAINS THE COUNT    * 04410000
*                   OF THE NUMBER OF DATA ELEMENTS TO BE GENERATED.   * 04500000
* +36   A(U-INDEX1) ADDRESS OF THE INDEX TO BE USED IN OBTAINING THE  * 04590000
*                   NEXT U ELEMENT FOR THE START OF THE SEGMENT, WHEN * 04680000
*                   MORE THAN ONE DATA ELEMENT IS BEING GENERATED.    * 04770000
* +40   A(V-INDEX1) ADDRESS OF THE INDEX TO BE USED IN OBTAINING THE  * 04860000
*                   NEXT V ELEMENT FOR THE START OF THE SEGMENT, WHEN * 04950000
*                   MORE THAN ONE DATA ELEMENT IS BEING GENERATED.    * 05040000
* +44   A(U-INDEX2) ADDRESS OF THE INDEX TO BE USED IN OBTAINING THE  * 05130000
*                   NEXT U ELEMENT FOR THE END OF THE SEGMENT WHEN    * 05220000
*                   MORE THAN ONE DATA ELEMENT IS BEING GENERATED.    * 05310000
* +48   A(V-INDEX2) ADDRESS OF THE INDEX TO BE USED IN OBTAINING THE  * 05400000
*                   NEXT V.ELEMENT FOR THE END OF THE SEGMENT WHEN    * 05490000
*                   MORE THAN ONE DATA ELEMENT IS BEING GENERATED.    * 05580000
* +52   A(U-INCR1)  ADDRESS OF A VALUE TO BE ADDED TO THE UVAL1 TO    * 05670000
*                   OBTAIN THE NEXT UVAL1 FOR THE START OF THE LINE   * 05760000
*                   SEGMENT WHEN MORE THAN ONE DATA ELEMENT IS BEING  * 05850000
*                   GENERATED.                                        * 05940000
* +56   A(V-INCR1)  ADDRESS OF A VALUE TO BE ADDED TO THE VVAL1 TO    * 06030000
*                   OBTAIN THE NEXT VVAL1 FOR THE START OF THE LINE   * 06120000
*                   SEGMENT WHEN MORE THAN ONE DATA ELEMENT IS BEING  * 06210000
*                   GENERATED                                         * 06300000
* +60   A(U-INCR2)  ADDRESS OF A VALUE TO BE ADDED TO UVAL2 TO OBTAIN * 06390000
*                   THE NEXT UVAL2 FOR THE END OF THE LINE SEGMENT    * 06480000
*                   WHEN MORE THAN ONE DATA ELEMENT IS BEING GENER-   * 06570000
*                   ATED.                                             * 06660000
* +64   A(V-INCR2)  ADDRESS OF A VALUE TO BE ADDED TO VVAL2 TO OBTAIN * 06750000
*                   THE NEXT VVAL2 FOR THE END OF THE LINE SEGMENT    * 06840000
*                   WHEN MORE THAN ONE DATA ELEMENT IS BEING GENER-   * 06930000
*                   ATED.                                             * 07020000
*                                                                     * 07110000
*OUTPUT                                                               * 07200000
*  THE DATA WILL BE SCISSORED AND SCALED AND IF IT APPEARS ON THE     * 07290000
*  SCREEN AND/OR GRID, ORDERS WILL BE GENERATED FOR IT IN THE GDOA.   * 07380000
*                                                                     * 07470000
*EXTERNAL ROUTINES                                                    * 07560000
*  IFFAFA12 - RESET                                                   * 07650000
*  IFFAHA03 - KEY TABLE MANAGEMENT                                    * 07740000
*  IFFAHA04 - DATA GENERATION                                         * 07830000
*  IFFAHA06 - SCALE                                                   * 07920000
*  IFFAHA07 - SCISSOR                                                 * 08010000
*  IFFAHA13 - GET GDOA'S FOR UPDATE                                   * 08100000
*  IFFAHA14 - WRITE OUT UPDATE                                        * 08190000
*                                                                     * 08280000
*EXITS - NORMAL- BACK TO CALLER VIA REGISTER 14                       * 08370000
*      - ERROR - BACK TO CALLER VIA REGISTER 14                       * 08460000
*  APPROPRIATE CODES ARE SET IN THE RETURN ARRAY -VALUES = 0,1,2,3,4  * 08550000
*                                                                     * 08640000
*                                                                     * 08730000
*                                                                     * 08820000
*TABLES/WORKAREAS -  SEE WORKAREA DSECT                               * 08910000
*                                                                     * 09000000
*ATTRIBUTES       -  REENTRANT, PROBLEM PROGRAM MODE                  * 09090000
*                                                                     * 09180000
*********************************************************************** 09270000
         EJECT                                                          09360000
IFFAFA02 CSECT                          PSEGMT                          09450000
*2024,695700-698400                                                000A 09540000
*D601500-601800                                                  YM1963 09630000
*A179300-179500,C570600,C572400-575100,C685800-688500       D11 ZA15418 09720000
         SPACE                                                          09810000
* REGISTERS                                                             09900000
REGZERO  EQU   0                                                        09990000
PARM     EQU   1                                                        10080000
LOOPCT   EQU   1                                                        10170000
REGA     EQU   2                                                        10260000
ERRCD    EQU   3                                                        10350000
REGB     EQU   4                                                        10440000
WORK     EQU   5                                                        10530000
REGD     EQU   6                                                        10620000
GTMREG   EQU   7                                                        10710000
GDSREG   EQU   8                                                        10800000
BASE     EQU   9                                                        10890000
REGC     EQU   10                                                       10980000
COUNT    EQU   11                                                       11070000
REGE     EQU   11                                                       11160000
SAVE     EQU   13                                                       11250000
RETURN   EQU   14                                                       11340000
REGFIFTN EQU   15                                                       11430000
FLT2     EQU   2                        FLOATING POINT REG              11520000
         SPACE 2                                                        11610000
*        PARAMETER LIST EQUATES                                         11700000
*                        REQUIRED PARAMETERS                            11790000
GDS      EQU   0                        ADR OF VARIABLE HOLDING GDS ADR 11880000
X        EQU   4                        ADR OF X VALUE FOR SEGMT START  11970000
Y        EQU   8                        ADR OF Y VALUE FOR SEGMT START  12060000
X2       EQU   12                       ADR OF X VALUE FOR SEGMT END    12150000
Y2       EQU   16                       ADR OF Y VALUE FOR SEGMT END    12240000
*                        OPTIONAL PARAMETERS                            12330000
FE       EQU   48                                                  000A 12420000
ETE      EQU   828                                                 000A 12510000
COR      EQU   20                       ADR OF CORRELATION VALUE        12600000
KEY      EQU   24                       ADR OF KEY LOCATION             12690000
GEN      EQU   28                       ADR OF CODE                     12780000
CT       EQU   32                       ADR OF COUNT                    12870000
XINDEX   EQU   36                       ADR OF X START INDEX            12960000
YINDEX   EQU   40                       ADR OF Y START INDEX            13050000
XINDEX2  EQU   44                       ADR OF X END INDEX              13140000
YINDEX2  EQU   48                       ADR OF Y END INDEX              13230000
XINCR    EQU   52                       ADR OF X START INCREMENT        13320000
YINCR    EQU   56                       ADR OF Y START INCREMENT        13410000
XINCR2   EQU   60                       ADR OF X END INCREMENT          13500000
YINCR2   EQU   64                       ADR OF Y END INCREMENT          13590000
         EJECT                                                          13680000
ON       EQU   X'FF'                                                    13770000
REPONLY  EQU   X'02'                                                    13860000
UPDATE   EQU   X'FF'                                                    13950000
INCLUDE  EQU   X'04'                                                    14040000
SWOFF    EQU    X'3F'                                                   14130000
OMIT     EQU   X'FB'                                                    14220000
XINDX    EQU   X'C0'                                                    14310000
YINDX    EQU   X'0C'                                                    14400000
XINC     EQU   X'30'                                                    14490000
YINC     EQU   X'03'                                                    14580000
NOX      EQU   X'0F'                                                    14670000
NOY      EQU   X'F0'                                                    14760000
PRM      EQU   X'08'                                                    14850000
STRG     EQU   X'10'                                                    14940000
SCISSOR  EQU   X'40'                                                    15030000
NOSCISS  EQU   X'10'                                                    15120000
LEVEL2   EQU   X'10'                                                    15210000
OPT      EQU   X'04'                                                    15300000
INC      EQU   X'01'                                                    15390000
INCSW    EQU   X'02'                                                    15480000
ABS      EQU   X'02'                                                    15570000
ABSSW    EQU   X'03'                                                    15660000
SUBR     EQU   X'02'                                                    15750000
MEMSUB   EQU   X'80'                                                    15840000
SEQ      EQU   X'04'                                                    15930000
MEMSEQ   EQU   X'40'                                                    16020000
NFNL     EQU   X'40'                                                    16110000
MULT     EQU   X'80'                                                    16200000
BEAMSW   EQU   X'08'                                                    16290000
CORRE    EQU   X'10'                                                    16380000
KEYED    EQU   X'20'                                                    16470000
REALY    EQU   X'0C'                                                    16560000
REALX    EQU   X'C0'                                                    16650000
ABSOLXY  EQU   X'AA'                                                    16740000
XABS     EQU   X'A0'                    SWITCH SETTING IN GDSCB         16830000
YABS     EQU   X'0A'                                                    16920000
XREALI   EQU   X'40'                                                    17010000
YREALI   EQU   X'04'                                                    17100000
XINTGI   EQU   X'10'                                                    17190000
YINTGI   EQU   X'01'                                                    17280000
LAST     EQU   X'80'                                                    17370000
LASTIN   EQU   X'C0'                                                    17460000
LASTON   EQU   X'1F'                                                    17550000
XFOUR    EQU   X'FC'                                                    17640000
STOR     EQU   12                                                       17730000
PARMERR  EQU   16                                                       17820000
NULL     EQU   20                                                       17910000
NL       EQU   21                                                       18000000
CURRLOG  EQU   52                                                       18090000
STAT     EQU   24                                                       18180000
DGEN     EQU   840                                                      18270000
SCISS    EQU   876                                                      18360000
SCALE    EQU   864                                                      18450000
UPDH13   EQU   936         STATAB DISPL OF IFFAHA13 ENTRY   D11 ZA15418 18540000
UPDH14   EQU   948         STATAB DISPL OF IFFAHA14 ENTRY   D11 ZA15418 18630000
CVTLINK  EQU   8                                                        18720000
         EJECT                                                          18810000
*        THIS CODE ESTABLIHES ADDRESSABILITY FOR IFFAFA02, FOR THE      18900000
*        GDSCB AND FOR THE WORKAREA. THE RETURN ARRAY IS SET TO ZERO,   18990000
*        AND THE SAVE AREAS ARE CHAINED.                                19080000
         SPACE                                                          19170000
         USING *,15                                                     19260000
         SAVE  (14,12)                                                  19350000
         DROP  15                                                       19440000
         LR    BASE,15                  LOAD CONTROL SECTION BASE       19530000
         USING IFFAFA02,BASE                                            19620000
         LR    WORK,PARM                LOAD WORK AREA BASE             19710000
         USING WORKAREA,WORK                                            19800000
         XC    WKSWITCH(8),WKSWITCH     ZERO SWITCH AREAS               19890000
         L     PARM,WKPARM              LOAD PARAMETER LIST ADDRESS     19980000
         L     ERRCD,WKRTNCD                                            20070000
         XC    0(20,ERRCD),0(ERRCD)     ZERO RETURN ARRAY               20160000
         L     GDSREG,GDS(PARM)         PICK UP ADDRESS OF GDS ADDRESS  20250000
         L     GDSREG,0(GDSREG)         ADDRESS OF GDSCB                20340000
         USING GDSCB,GDSREG                                             20430000
         L     COUNT,TWO                SET COUNT DEFAULT TO TWO        20520000
         LA    REGA,WKSAVE              CHAIN SAVE AREAS                20610000
         ST    REGA,8(SAVE)                                             20700000
         ST    SAVE,4(REGA)                                             20790000
         LR    SAVE,REGA                REG 13 CONTAINS ADR OF THIS     20880000
*                                          SAVE AREA                    20970000
*                                                                       21060000
*        THE GDSCB PASSED IS CHECKED FOR VALIDITY, AND IF IT IS VALID,  21150000
*        A SKELETON PARAMETER LIST FOR DATA GENERATION IS SET UP,       21240000
*        WITH SWITCHES INITIALIZED TO MULTIPLE ENTRY, OUTPUT TYPE=      21330000
*        VECTOR, STATUS IS INCLUDE,OUTPUT IS OPTIMIZED, FIRST ENTRY,    21420000
*        NOT KEYED, NOT CORVALED, BEAM OFF.                             21510000
*                                                                       21600000
         MVC   WKSWAREA+1(1),GDSDATMD  SAVE DATA MODE SW FROM GDSCB     21690000
         C     GDSREG,GDSGDSCB                                          21780000
         BNE   AFAERR10                 BRANCH IF INVALID GDSCB         21870000
         XC    WKSPVSR(12),WKSPVSR     ZERO PARM LIST FOR LINK MACRO    21960000
         XC    WKADDR(68),WKADDR        ZERO PARAMETER FIELDS           22050000
         MVC   WKBITS,BITS              MOVE OPTION SWITCHES,           22140000
         ST    GDSREG,WKGDS              GDSCB ADDRESS, AND             22230000
         MVC   WKRTN,WKRTNCD             RETURN CODE ARRAY ADDRESS      22320000
*                                       INTO PARAMETER LIST             22410000
         EJECT                                                          22500000
*        REQUIRED PARAMETERS (X AND Y VALUES FOR START AND END OF       22590000
*        SEGMENT) ARE EXAMINED, AND THE TYPE OF DATA PASSED IS          22680000
*        DETERMINED.                                                    22770000
         TM    GDS(PARM),LAST                                           22860000
         BO    AFAERR20                 BRANCH IF REQ PARMS NOT PRESENT 22950000
         MVC   WKSWITCH+3(1),GDSDATMD  IINITIALIZE DATA MODE SWITCH     23040000
*                                         IN WORK AREA                  23130000
         TM    GDSFLAGS,SEQ                                             23220000
         BZ    AFAREQ03                                                 23310000
         OI    WKBITS+3,MEMSEQ          OTHERWISE SET SWITCH IN KEY     23400000
AFAREQ03 TM    GDSFLAGS,SUBR                                            23490000
         BZ    AFAREQ05                                                 23580000
         OI    WKBITS+3,MEMSUB         SET SWITCH IN KEY                23670000
         BAL   RETURN,AFAREQ90         IF SUBR, GO CHECK DATA MODE      23760000
AFAREQ05 TM    X(PARM),LAST                                             23850000
         BO    AFAERR20                 BRANCH IF REQ PARMS NOT PRESENT 23940000
         TM    Y(PARM),LAST                                             24030000
         BO    AFAERR20                 BRANCH IF REQ PARMS NOT PRESENT 24120000
         TM    X2(PARM),LAST                                            24210000
         BO    AFAERR20                 BRANCH IF REQ PARMS NOT PRESENT 24300000
         TM    Y2(PARM),LAST                                            24390000
         BO    AFAREQ10                 START PROCESSING PARMS          24480000
         TM    COR(PARM),LAST                                           24570000
         BO    AFAREQ10                 START PROCESSING PARMS          24660000
         TM    KEY(PARM),LAST                                           24750000
         BO    AFAREQ10             START PROCESSING PARMS              24840000
*                                                                       24930000
*CHECK FOR GENCODE OF 3- AND IF IT IS, PROCESS IT                       25020000
*                                                                       25110000
         CLC   NL(3,ERRCD),GEN+1(PARM)                                  25200000
         BE    AFAREQ10                 BRANCH IF GENCODE NULL          25290000
         L     REGA,GEN(PARM)                                           25380000
         L     REGA,0(REGA)             PICK UP GENCODE                 25470000
         C     REGA,THREE                                               25560000
         BE    AFAOPT10                                                 25650000
*                                                                       25740000
AFAREQ10 L     REGA,X(PARM)             ADDRESS OF X START VALUE        25830000
         L     REGA,0(REGA)             X VALUE                         25920000
         TM    WKSWITCH+3,XABS                                          26010000
         BZ    AFAREQ60                 BRANCH IF X INCREMENTAL         26100000
         ST    REGA,WKXABS              PUT ABSOLUTE VALUE IN PARM LIST 26190000
AFAREQ20 ST    REGA,WKXVAL              SAVE COPY OF X VALUE            26280000
         L     REGB,Y(PARM)             ADDRESS OF Y START VALUE        26370000
         L     REGB,0(REGB)             Y VALUE                         26460000
         TM    WKSWITCH+3,YABS                                          26550000
         BZ    AFAREQ65                 BRANCH IF Y INCREMENTAL         26640000
         ST    REGB,WKYABS              PUT ABSOLUTE VALUE IN PARM LIST 26730000
AFAREQ30 ST    REGB,WKYVAL              SAVE COPY OF Y VALUE            26820000
         L     REGA,X2(PARM)            ADDRESS OF X END VALUE          26910000
         L     REGA,0(REGA)             X END VALUE                     27000000
         ST    REGA,WKXVAL2             SAVE COPY OF X END VALUE        27090000
         TM    WKSWITCH+3,XABS                                          27180000
         BZ    AFAREQ50                 BRANCH IF X END INCREMENTAL     27270000
AFAREQ35 L     REGB,Y2(PARM)                                            27360000
         L     REGB,0(REGB)             Y END VALUE                     27450000
         ST    REGB,WKYVAL2                                             27540000
         TM    WKSWITCH+3,YABS                                          27630000
         BZ    AFAREQ70                BRANCH IF Y END INCREMENTAL      27720000
AFAREQ40 TM    Y2(PARM),LAST                                            27810000
         BO    AFADAT10                 BRANCH IF NO OPTIONAL PARMS     27900000
         CLI   WKSWITCH,UPDATE                                          27990000
         BE    AFAOPT55                BRANCH IF UPDATE- CORRBAL,KEY    28080000
*                                       AND GENCODE ALREADY PROCESSED   28170000
         B     AFAOPT10                                                 28260000
         EJECT                                                          28350000
*INITIALIZATION OF INCREMENT TOTALS                                     28440000
*                                                                       28530000
AFAREQ60 ST    REGA,WKXINCR             PUT X INCR VALUE IN PARM LIST   28620000
         ST    REGA,WKXTOT               AND SAVE COPY FOR COMPUTING    28710000
         B     AFAREQ20                                                 28800000
*                                                                       28890000
*                                                                       28980000
AFAREQ65 ST    REGB,WKYINCR             PUT Y INCR VALUE IN PARM LIST   29070000
         ST    REGB,WKYTOT               AND SAVE COPY FOR COM          29160000
         B     AFAREQ30                                                 29250000
*                                                                       29340000
*REGA CONTAINS X END INCREMENT                                          29430000
*                                                                       29520000
AFAREQ50 TM    WKSWITCH+3,REALX                                         29610000
         BM    AFAREQ55                 BRANCH IF REAL NUMBER           29700000
         A     REGA,WKXTOT              1ST X END INCR IS FROM X START  29790000
         ST    REGA,WKXTOT2             KEEP CURRENT POINTER TO BEAM    29880000
         B     AFAREQ35                                                 29970000
AFAREQ55 LE    FLT2,WKXVAL2                                             30060000
         AE    FLT2,WKXTOT              ADD X START INCREMENT           30150000
         STE   FLT2,WKXTOT2             SAVE TOTAL                      30240000
         B     AFAREQ35                                                 30330000
*                                                                       30420000
*REGB CONTAINS Y END INCREMENT                                          30510000
*                                                                       30600000
AFAREQ70 TM    WKSWITCH+3,REALY                                         30690000
         BM    AFAREQ75                 BRANCH IF REAL NUMBER           30780000
         A     REGB,WKYTOT              ADD TO Y START INCREMENT        30870000
         ST    REGB,WKYTOT2             SAVE TOTAL                      30960000
         B     AFAREQ40                                                 31050000
AFAREQ75 LE    FLT2,WKYVAL2                                             31140000
         AE    FLT2,WKYTOT              ADD Y START INCREMENT           31230000
         STE   FLT2,WKYTOT2             SAVE TOTAL                      31320000
         B     AFAREQ40                                                 31410000
         EJECT                                                          31500000
*        RESETS DATA MODE SWITCHES IN TEMPORARY WORK AREA FOR           31590000
*        BUFFER SUBROUTINE. INPUT DATA SET TO INCREMENTAL MODE          31680000
*                                                                       31770000
AFAREQ90 MVI   WKSWITCH+3,X'00'         ZERO OUT SWITCH AREA            31860000
         TM    GDSDATMD,REALX                                           31950000
         BZ    AFAREQ96                 BRANCH IF X VALUE INTEGER       32040000
         OI    WKSWITCH+3,XREALI        SET SWITCH FOR REAL,INCR  X     32130000
AFAREQ92 TM    GDSDATMD,REALY                                           32220000
         BZ    AFAREQ98                 BRANCH IF Y VALUE INTEGER       32310000
         OI    WKSWITCH+3,YREALI        SET SWITCH FOR REAL,INCR  Y     32400000
         MVC   GDSDATMD(1),WKSWITCH+3  STORE NEW SWITCH IN GDSCB        32490000
         BR    RETURN                                                   32580000
*                                                                       32670000
AFAREQ96 OI    WKSWITCH+3,XINTGI        SET SWITCH FOR INTEGER,INCR X   32760000
         B     AFAREQ92                                                 32850000
AFAREQ98 OI    WKSWITCH+3,YINTGI        SET SWITCH FOR INTEGER,INCR Y   32940000
         MVC   GDSDATMD(1),WKSWITCH+3  STORE NEW SWITCH IN GDSCB        33030000
         BR    RETURN                                                   33120000
         EJECT                                                          33210000
*        THIS SECTION OF CODE EXAMINES THE OPTIONAL PARAMETERS          33300000
*        CORRVAL, KEY, AND GENCODE, AND TESTS THEM FOR VALIDITY         33390000
AFAOPT10 CLC   NL(3,ERRCD),COR+1(PARM)                                  33480000
         BE    AFAOPT15                 BRANCH IF CORRVAL NOT PASSED    33570000
         TM    GDSFLAGS,LEVEL2                                          33660000
         BO    AFAOPT15                BRANCH IF LEVEL 2 CORRVAL        33750000
         L     REGD,COR(PARM)           LOAD ADDRESS OF CORRVAL         33840000
         MVC   WKCORVL,0(REGD)          PLACE CORRVAL IN PARAM LIST     33930000
         OI    WKBITS+2,CORRE          SET CORRVAL SWITCH IN PARM LIST  34020000
AFAOPT15 TM    COR(PARM),LAST                                           34110000
         BO    AFADAT10                 BRANCH IF NO MORE PARAMETERS    34200000
         CLC   NL(3,ERRCD),KEY+1(PARM)                                  34290000
         BE    AFAOPT20                 BRANCH IF KEY NOT PASSED        34380000
         MVC   WKKEY,KEY(PARM)          PLACE ADDRESS OF KEY IN PARM    34470000
*                                           LIST                        34560000
         TM    GDSFLAGS,LEVEL2                                          34650000
         BO    AFAOPT20                 BRANCH IF LEVEL 2 KEY           34740000
         OI    WKBITS+2,KEYED           OTHERWISE SET KEY SWITCH IN     34830000
*                                           PARM LIST                   34920000
AFAOPT20 TM    KEY(PARM),LAST                                           35010000
         BO    AFADAT10                 BRANCH IF NO MORE PARAMETERS    35100000
         CLC   NL(3,ERRCD),GEN+1(PARM)                                  35190000
         BE    AFAOPT25                 BRANCH IF GENCODE NOT PASSED    35280000
         L     REGD,GEN(PARM)           PICK UP CODE ADDRESS            35370000
         L     REGD,0(REGD)             PICK UP ACTUAL CODE             35460000
         C     REGD,ONE                                                 35550000
         BE    AFAOPT25                 BRANCH IF STATUS='INCLUDE'      35640000
*                                      (SWT ALREADY SET IN PARM LIST)   35730000
         CLC   WKCORVL(8),ZERO         CHECK FOR CORRVAL AND/OR KEY     35820000
         BZ    AFAERR30                 BRANCH IF STATUS NOT INCLUDE    35910000
*                                         AND ELEMENT NOT KEYED OR      36000000
*                                         CORRVALED-ERROR               36090000
         C     REGD,TWO                                                 36180000
         BNE   AFAOPT30                 BRANCH IF STATUS NOT 'OMIT'     36270000
         TM    GDSFLAGS,LEVEL2                                          36360000
         BO    AFAERR30                 BRANCH IF LEVEL 2 AND 'OMIT'    36450000
*                                         STATUS SPECIFIED-ERROR        36540000
         NI    WKBITS,OMIT              TURN OFF INCLUDE SWITCH         36630000
AFAOPT25 TM    WKBITS+2,CORRE                                           36720000
         BZ    AFAOPT55                 BRANCH IF NOT CORRELATED        36810000
         CLC   WKCORVL,ZERO                                             36900000
         BE    AFAERR40                 BRANCH IF CORRVAL=0,-ERROR      36990000
         B     AFAOPT55                                                 37080000
*                                                                       37170000
AFAOPT30 C     REGD,THREE                                               37260000
         BNE   AFAERR30                 BRANCH IF NOT 'UPDATE'  -ERROR  37350000
         TM    GDSFLAGS,SUBR                                            37440000
         BO    AFAERR20                 BRANCH IF UPDATE WHEN GENERAT-  37530000
*                                         ING SUBROUTINE -ERROR         37620000
         TM    GDSFLAGS,LEVEL2                                          37710000
         BO    AFAOPT45                 BRANCH IF LEVEL2 TO SET KEY     37800000
         TM    WKBITS+2,KEYED                                           37890000
         BZ    AFAOPT50                 BRANCH IF ELEMENT NOT KEYED     37980000
*                                       PREPARE PARAMS FOR KEY SEARCH   38070000
         L     REGD,KEY(PARM)           LOAD KEY ADDRESS                38160000
         ST    REGD,WKKADDR             AND PUT IN PARAMETER LIST       38250000
         LA    REGD,TWO                CODE FOR SEARCH ON KEY           38340000
AFAOPT35 ST    REGD,WKCODE              WORK CODE ADDRESS               38430000
         LA    REGD,AFAOPT37                                            38520000
         ST    REGD,WKTEMP             SAVE RETURN ADDRESS              38610000
*                                                                       38700000
*SEARCH ON KEY OR CORRVAL - ADDRESS IN REGISTER 1                       38790000
*                                                                       38880000
         B     AFAKEY10                                                 38970000
AFAOPT37 LTR   REGFIFTN,REGFIFTN       TEST RETURN CODE                 39060000
         BNE   AFAERR20                 BRANCH IF INVALID KEY           39150000
         MVC   WKADDR,0(PARM)           MOVE KEY FIELDS INTO PARM LIST  39240000
         OC    WKBITS+3(1),7(PARM)      GET FLAGS FROM OLD KEY          39330000
         TM    WKBITS+3,MEMSUB                                          39420000
         BZ    AFAOPT38                                                 39510000
         BAL   RETURN,AFAREQ90                                          39600000
AFAOPT38 TM    4(PARM),INCLUDE                                          39690000
         BO    AFAOPT39                                                 39780000
         NI    WKBITS,OMIT              TURN OFF INCLUDE SWITCH         39870000
AFAOPT39 ST    PARM,WKSTORAD           SAVE KEY ADDR IN KEY TABLE       39960000
AFAOPT40 MVI   WKSWITCH,UPDATE          SET UPDATE SWITCH               40050000
AFAOPT42 L     PARM,WKPARM             RESTORE PARAMETER REG. POINTER   40140000
         B     AFAREQ10                                                 40230000
*                                                                       40320000
*                                                                       40410000
*                                                                       40500000
*                                                                       40590000
AFAOPT45 L     REGD,KEY(PARM)           LOAD KEY ADDRESS                40680000
         MVC   WKADDR,0(REGD)           PLACE KEY IN PARM LIST          40770000
         B     AFAOPT40                                                 40860000
*                                                                       40950000
AFAOPT50 CLC  WKCORVL,ZERO                                              41040000
         BE    AFAERR20                 BAD PARAMETER COMBINATION       41130000
*                                                                       41220000
*PREPARE FOR SEARCH ON CORRVAL                                          41310000
*                                                                       41400000
         LA    REGD,WKCORVL             LOAD CORRVAL ADDRESS            41490000
         ST    REGD,WKKADDR             AND PUT IN PARAMETER LIST       41580000
         LA    REGD,FIVE                 SEARCH                         41670000
         B     AFAOPT35                 BRANCH TO GET REST OF PARAMS    41760000
*                                         AND TO CALL KEY MANAGEMENT    41850000
         EJECT                                                          41940000
*        THIS SECTION EXAMINES THE COUNT PARAMETER, IF THE COUNT IS     42030000
*        NOT SPECIFIED IT IS SET TO TWO (TWO CALLS TO THE DATA          42120000
*        GENERATION ROUTINE ARE NEEDED FOR EACH LINE SEGMENT). IF       42210000
*        THE COUNT IS 0, NO DATA IS GENERATED AND CONTROL IS RETURNED   42300000
*        TO THE CALLER. IF THE COUNT IS LESS THAN ZERO AN ERROR         42390000
*        RETURN IS MADE. OTHERWISE THE COUNT IS MULTIPLIED BY TWO,      42480000
*        AND PROCESSING CONTINUES.                                      42570000
*                                                                       42660000
AFAOPT55 TM    GEN(PARM),LAST                                           42750000
         BO    AFADAT10                 BRANCH IF END OF PARM LIST      42840000
         CLC   NL(3,ERRCD),CT+1(PARM)                                   42930000
         BE    AFADAT10                 BRANCH IF COUNT NULL            43020000
         L     COUNT,CT(PARM)                                           43110000
         L     COUNT,0(COUNT)           LOAD COUNT                      43200000
         LTR   COUNT,COUNT                                              43290000
         BZ    AFARET10                 RETURN IF COUNT = 0             43380000
         BM    AFAERR70                 ERROR IF COUNT LESS THAN ZERO   43470000
         SLA   COUNT,1                 MULTIPLY COUNT BY 2              43560000
         C     COUNT,TWO                                                43650000
         BE    AFADAT10                 BRANCH IF ONE LINE TO BE        43740000
*                                       DISPLAYED                       43830000
         EJECT                                                          43920000
*        THIS SECTION EXAMINES THE X START INDEX, Y START INDEX,        44010000
*        X END INDEX, Y END INDEX, X START INCR, Y START INCR,          44100000
*        X END INCR, AND Y END INCR PARAMETERS.                         44190000
*        THESE PARAMETERS ARE CHECKED ONLY WHEN MORE THAN ONE LINE      44280000
*        SEGMENT IS TO BE DISPLAYED.                                    44370000
         TM    CT(PARM),LAST                                            44460000
         BO    AFAINX50                 BRANCH IF END OF PARAMETER LIST 44550000
         CLC   NL(3,ERRCD),XINDEX+1(PARM)                               44640000
         BE    AFAINX10                 BRANCH IF X START INDEX NULL    44730000
         L     REGD,XINDEX(PARM)                                        44820000
         L     REGD,0(REGD)             PICK UP INDEX VALUE             44910000
         SLA   REGD,2                   MULTIPLY BY 4                   45000000
         ST    REGD,WKXCHNG             SAVE INDEXING FACTOR            45090000
         OI    WKSWITCH+1,XINDX         SET SWITCH IN WORK AREA         45180000
AFAINX10 TM    XINDEX(PARM),LAST                                        45270000
         BO    AFAINX50                 BRANCH IF END OF PARAMETER LIST 45360000
         CLC   NL(3,ERRCD),YINDEX+1(PARM)                               45450000
         BE    AFAINX15                 BRANCH IF Y START INDEX NULL    45540000
         L     REGD,YINDEX(PARM)                                        45630000
         L     REGD,0(REGD)             PICK UP INDEX VALUE             45720000
         SLA   REGD,2                   MULTIPLY BY 4                   45810000
         ST    REGD,WKYCHNG             SAVE INDEXING FACTOR            45900000
         OI    WKSWITCH+1,YINDX         SET SWITCH IN WORK AREA         45990000
AFAINX15 TM    YINDEX(PARM),LAST                                        46080000
         BO    AFAINX50                 BRANCH IF END OF PARM LIST      46170000
         CLC   NL(3,ERRCD),XINDEX2+1(PARM)                              46260000
         BE    AFAINX20                 BRANCH IF X END INDEX NULL      46350000
         L     REGD,XINDEX2(PARM)                                       46440000
         L     REGD,0(REGD)            PICK UP INDES VALUE              46530000
         SLA   REGD,2                   MULTIPLY BY 4                   46620000
         ST    REGD,WKXCHNG2            SAVE INDEX FACTOR               46710000
         OI    WKSWITCH+2,XINDX        SET SWITCH IN WORK AREA          46800000
AFAINX20 TM    XINDEX2(PARM),LAST                                       46890000
         BO    AFAINX50                 BRANCH IF END OF PARM LIST      46980000
         CLC   NL(3,ERRCD),YINDEX2+1(PARM)                              47070000
         BE    AFAINX25                 BRANCH IF Y END INDEX NULL      47160000
         L     REGD,YINDEX2(PARM)                                       47250000
         L     REGD,0(REGD)             PICK UP INDEX VALUE             47340000
         SLL   REGD,2                   MULTIPLY BY 4                   47430000
         ST    REGD,WKYCHNG2            SAVE INDEX FACTOR               47520000
         OI    WKSWITCH+2,YINDX        SET SWITCH IN WORK AREA          47610000
         EJECT                                                          47700000
AFAINX25 TM    YINDEX2(PARM),LAST                                       47790000
         BO    AFAINX50                 BRANCH IF END OF PARAMETER LIST 47880000
         CLC   NL(3,ERRCD),XINCR+1(PARM)                                47970000
         BE    AFAINX30                 BRANCH IF X START INCR NULL     48060000
         TM    WKSWITCH+1,XINDX         WAS X START INDEX ALSO PASSED   48150000
         BO    AFAERR20                 BRANCH IF YES-ERROR             48240000
         L     REGD,XINCR(PARM)                                         48330000
         MVC   WKXCHNG,0(REGD)          SACE INCREMENT VALUE            48420000
         OI    WKSWITCH+1,XINC          SET SWITCH IN WORK AREA         48510000
AFAINX30 TM    XINCR(PARM),LAST                                         48600000
         BO    AFAINX50                 BRANCH IF END OF PARAMETER LIST 48690000
         CLC   NL(3,ERRCD),YINCR+1(PARM)                                48780000
         BE    AFAINX35                 BRANCH IF Y START INCR NULL     48870000
         TM    WKSWITCH+1,YINC          WAS Y START INDEX ALSO PASSED   48960000
         BO    AFAERR20                 BRANCH IF YES- ERROR            49050000
         L     REGD,YINCR(PARM)                                         49140000
         MVC   WKYCHNG,0(REGD)          SAVE INCREMENT VALUE            49230000
         OI    WKSWITCH+1,YINC                                          49320000
AFAINX35 TM    YINCR(PARM),LAST                                         49410000
         BO    AFAINX50                 BRANCH IF END OF PARAMETER LIST 49500000
         CLC   NL(3,ERRCD),XINCR2+1(PARM)                               49590000
         BE    AFAINX40                 BRANCH IF X END INCREMENT NULL  49680000
         TM    WKSWITCH+2,XINDX         WAS X END INDEX ALSO PASSED     49770000
         BO    AFAERR20                 BRANCH IF YES- ERROR            49860000
         L     REGD,XINCR2(PARM)                                        49950000
         MVC   WKXCHNG2,0(REGD)         SAVE INCREMENT VALUE            50040000
         OI    WKSWITCH+2,XINC          SET SWITCH IN WORK AREA         50130000
AFAINX40 TM    XINCR2(PARM),LAST                                        50220000
         BO    AFAINX50                 BRANCH IF END OF PARAMETER LIST 50310000
         CLC   NL(3,ERRCD),YINCR2+1(PARM)                               50400000
         BE    AFAINX50                 BRANCH IF Y ENC INCREMENT NULL  50490000
         TM    WKSWITCH+2,YINDX         WAS Y END INDEX ALSO PASSED     50580000
         BO    AFAERR20                 BRANCH IF YES- ERROR            50670000
         L     REGD,YINCR2(PARM)                                        50760000
         MVC   WKYCHNG2,0(REGD)         SAVE INCREMENT VALUE            50850000
         OI    WKSWITCH+2,YINC          SET SWITCH IN WORK AREA         50940000
         EJECT                                                          51030000
*        THIS SECTION CHECKS WHICH OF THE INDEX AND INCREMENT PARAMS    51120000
*        HAVE BEEN PASSED AND SETS UP DEFAULT CONDITIONS WHERE          51210000
*        NECESSARY.                                                     51300000
*                                                                       51390000
AFAINX50 TM    WKSWITCH+1,XINDX+XINC                                    51480000
         BM    AFAINX55                 BRANCH IF X START IX/INC THERE  51570000
         MVC   WKXCHNG,FOUR              OTHERWISE, SET INDEX VALUE=4   51660000
         OI    WKSWITCH+1,XINDX         AND SET SWITCH IN WORK AREA     51750000
AFAINX55 TM    WKSWITCH+1,YINDX+YINC                                    51840000
         BM    AFAINX60                 BRANCH IF Y START IX/INC THERE  51930000
         MVC   WKYCHNG,FOUR              OTHERWISE, SET INDEX VALUE=4   52020000
         OI    WKSWITCH+1,YINDX          AND SET SWITCH IN WORK AREA    52110000
AFAINX60 TM    WKSWITCH+2,XINDX+XINC                                    52200000
         BM    AFAINX65                 BRANCH IF X END IX/INC PRESENT  52290000
         MVC   WKXCHNG2,FOUR             OTHERWISE, SET INDEX VALUE=4   52380000
         OI    WKSWITCH+2,XINDX          AND SET SWITCH IN WORK AREA    52470000
AFAINX65 TM    WKSWITCH+2,YINDX+YINC                                    52560000
         BM    AFADAT10                 BRANCH IF Y END IX/INC PRESENT  52650000
         MVC   WKYCHNG2,FOUR             OTHERWISE,SET INDEX VALUE=4    52740000
         OI    WKSWITCH+2,YINDX          AND SET SWOTCH IN WORK AREA    52830000
         EJECT                                                          52920000
*        THIS SECTION COMPLETES THE PARAMETER LIST FOR THE CALL TO      53010000
*        THE DATA GENERATION ROUTINE AND, IF MORE THAN ONE LINE         53100000
*        SEGMENT IS TO BE DISPLAYED, SETS UP THE LOOP FOR FUTURE        53190000
*        ENTRIES. PSGMT WILL ALWAYS MAKE MULTIPLE ENTRIES TO THE        53280000
*        DATA GENERATION ROUTINE, AND OUTPUT WILL ALWAYS BE VECTOR.     53370000
*                                                                       53460000
AFADAT10 TM    WKBITS+3,MEMSUB                                          53550000
         BO    AFADAT70                BRANCH IF BUFFER SUBROUTINE      53640000
*                                        SUBROUTINE-OUTPUT INCREMENTAL  53730000
*TEST FOR OUTPUT DATA MODE                                              53820000
*                                                                       53910000
         TM    GDSCURMD,OPT                                             54000000
         BO    AFADAT20                 BRANCH IF OPTIMIZE MODE- SWITCH 54090000
*                                        ALREADY SET                    54180000
         TM    GDSCURMD,INC                                             54270000
         BO    AFADAT70                 BRANCH IF INCREMENTAL MODE      54360000
         XI    WKBITS,ABSSW            SET SWITCH TO ABSOLUTE MODE      54450000
*                                                                       54540000
*                                                                       54630000
AFADAT20 MVC   WKXCURR(4),GDSXCURR      SAVE X-Y CURRENT VALUE          54720000
         MVC   WKXLAST(8),GDSXLAST      SAVE X-Y LAST VALUE             54810000
         CLI   WKSWITCH,UPDATE                                          54900000
         BE    AFADAT75                 BRANCH IF UPDATE                54990000
         L     REGD,GDSAOACB            GET OACB ADDRESS                55080000
         L     REGD,CURRLOG(REGD)       GET LOGICAL START AND           55170000
         STH   REGD,WKADDR+2             STORE IN PARAMETER LIST        55260000
         EJECT                                                          55350000
*SET UP LOOP CONTROL IF MORE THAN ONE LINE SEGMENT TO BE GENERATED.     55440000
*                                                                       55530000
AFADAT25 C     COUNT,TWO                                                55620000
         BE    AFASSD10                 BRANCH IF ONE LINE TO GENERATE  55710000
AFADAT30 TM    WKSWITCH+1,XINDX                                         55800000
         BZ    AFADAT35                 BRANCH IF X START INCREMENTAL   55890000
         MVC   WKXVAL,X(PARM)           REPLACE X VALUE WITH X ADDR     55980000
AFADAT35 TM    WKSWITCH+1,YINDX                                         56070000
         BZ    AFADAT40                 BRANCH IF Y START INCREMENTAL   56160000
         MVC   WKYVAL,Y(PARM)           REPLACE Y VALUE WITH Y ADDR     56250000
AFADAT40 TM    WKSWITCH+2,XINDX                                         56340000
         BZ    AFADAT45                 BRANCH IF X END INCREMENTAL     56430000
         MVC   WKXVAL2,X2(PARM)         REPLACE X2 VALUE WITH X2 ADDR   56520000
AFADAT45 TM    WKSWITCH+2,YINDX                                         56610000
         BZ    AFASSD10                 BRANCH IF Y END INCREMENTAL     56700000
         MVC   WKYVAL2,Y2(PARM)         REPLACE Y2 VALUE WITH Y2 ADDR   56790000
         B     AFASSD10                                                 56880000
*                                                                       56970000
*                                                                       57060000
*                                                                       57150000
AFADAT70 XI    WKBITS,INCSW                                             57240000
         B     AFADAT20                                                 57330000
*/                                                                      57420000
*GET GDOA'S FOR UPDATE                                                  57510000
*                                                                       57600000
AFADAT75 EQU   *                                            D11 ZA15418 57690000
         LA    PARM,WKADDR                                              57780000
         L     REGFIFTN,STAT(ERRCD)  POINT TO STATUS TABLE  D11 ZA15418 57870000
         L     REGFIFTN,UPDH13(REGFIFTN) POINT TO IFFAHA13  D11 ZA15418 57960000
         BALR  RETURN,REGFIFTN       GOTO IFFAHA13          D11 ZA15418 58050000
* IFFAHA13 IS NOW CALLED VIA GSP LOGIC TO SAVE SYS OVERHEAD D11 ZA15418 58140000
         LTR   REGFIFTN,REGFIFTN                                        58230000
         BNE   AFAERR90                                                 58320000
         L     PARM,WKPARM             RESTORE PARAMETER POINTER        58410000
         B     AFADAT25                                                 58500000
         EJECT                                                          58590000
*THIS SECTION OF CODE IS ENTERED TWICE FOR EVERY LINE SEGMENT TO BE     58680000
*GENERATED. IT INCLUDES CALLS TO THE SCALE, SCISSOR(WHEN REQUESTED),    58770000
*AND DATA GENERATION ROUTINES.                                          58860000
         SPACE                                                          58950000
AFASSD10 LA    PARM,WKGDS                                               59040000
*/       CALL  SCALE                                                    59130000
*/                                                                      59220000
         L     REGFIFTN,STAT(ERRCD)     ADDRESS OF STATUS TABLE         59310000
         L     REGFIFTN,SCALE(REGFIFTN) ADDRESS OF SCALE                59400000
         BALR  RETURN,REGFIFTN          BRANCH TO SCALE                 59490000
         LTR   REGFIFTN,REGFIFTN                                        59580000
         BNE   AFARES10                                                 59670000
         TM    WKBITS+3,MEMSUB         TEST FOR BUFFER SUBROUTINE       59760000
         BO    AFASSD25                IF IS, NO SCISS, NO BEAM REPOS   59850000
         TM    GDSSCISS,NOSCISS                                         59940000
         BZ    AFASSD15                 BRANCH IF SCISSOR WANTED        60030000
*                                                                       60120000
*THESE VALUES ARE SET BY THE SCISSOR ROUTINE, SO ARE SET IN PSEGMT ONLY 60210000
*WHEN THERE IS TO BE NO SCISSORING                                      60300000
*                                                                       60390000
         MVC   GDSXLAST,WKXABS          * SET XLAST                     60480000
         L     PARM,WKXABS                                              60570000
         SH    PARM,GDSXCURR            RECOMPUTE INCREMENT AND PUT     60660000
         ST    PARM,WKXINCR              IN PARAMETER LIST              60750000
         MVC   GDSXCURR,WKXABS+2        *     XCURR                     60840000
         MVC   GDSYLAST,WKYABS          *     YLAST AND                 60930000
         L     PARM,WKYABS                                              61020000
         SH    PARM,GDSYCURR            RECOMPUTE INCREMENT AND PUT     61110000
         ST    PARM,WKYINCR              IN PARAMETER LIST              61200000
         MVC   GDSYCURR,WKYABS+2        *     YCURR IN GDSCB            61290000
         NI    GDSSCISS,LASTON                                          61380000
         B     AFASSD25                                                 61470000
*                                                                       61560000
*CALL TO SCISSOR ROUTINE                                                61650000
*                                                                       61740000
AFASSD15 LA    PARM,WKGDS                                               61830000
*/                                                                      61920000
*/       CALL  SCISSOR                                                  62010000
         L     REGFIFTN,STAT(ERRCD)     ADDRESS OF STATUS TABLE         62100000
         L     REGFIFTN,SCISS(REGFIFTN) ADDRESS OF SCISSOR              62190000
         BALR  RETURN,REGFIFTN          BRANCH TO SCISSOR               62280000
         LTR   REGFIFTN,REGFIFTN                                        62370000
         BZ    AFASSD20                 BRANCH IF SCISSOR RETURN OK     62460000
         C     REGFIFTN,FOUR                                            62550000
         BE    AFARES10                                                 62640000
         B     AFASSD30                 OTHERWISE SKIP CALL TO DATA GEN 62730000
         EJECT                                                          62820000
AFASSD20 TM    WKBITS+2,LASTIN                                          62910000
         BZ    AFASSD25                ALWAYS GENERATE FIRST VECTOR     63000000
         CLC   WKXINCR(8),ZERO          IF NO MOVEMENT                  63090000
         BE    AFASSD30                  BRANCH PAST CALL TO DATA GEN   63180000
*CALL TO DATA GENERATION ROUTINE                                        63270000
*                                                                       63360000
AFASSD25 LA    PARM,WKADDR                                              63450000
*/                                                                      63540000
*/       CALL  DATA GEN                                                 63630000
*/                                                                      63720000
         L     REGFIFTN,STAT(ERRCD)     ADDRESS OF STATUS TABLE         63810000
         L     REGFIFTN,DGEN(REGFIFTN)  ADDRESS OF DATA GEN             63900000
         BALR  RETURN,REGFIFTN          BRANCH TO DATA GEN              63990000
         LTR   REGFIFTN,REGFIFTN                                        64080000
         BNE   AFARES10                                                 64170000
         NI    WKBITS+2,SWOFF                                           64260000
         OI    WKBITS+2,NFNL            SET NOT FIRST NOT LAST SWITCH   64350000
         SPACE                                                          64440000
AFASSD30 BCT   COUNT,AFASET05          BRANCH IF MORE TO DO             64530000
         TM    WKBITS+2,LASTIN                                          64620000
         BZ    AFAERR80                BRANCH IF FIRST PASS SWITCH      64710000
*                                      STILL ON - NO DATA GENERATED     64800000
         BO    AFASSD50                B-&NCH &F L&00 &&-   &&          64890000
*                                      CALL DATA GEN AGAIN              64980000
         CLI   WKSWITCH,UPDATE                                          65070000
         BE    AFASSD80                 BRANCH IF UPDATE                65160000
         SPACE                                                          65250000
*PREPARE KEY                                                            65340000
*                                                                       65430000
         L     COUNT,GDSAOACB                                           65520000
         L     COUNT,CURRLOG(COUNT)    GET CURRENT LOGICAL ADDRESS      65610000
         SH    COUNT,WKADDR+2          COMPUTE ELEMENT LENGTH           65700000
         LTR   COUNT,COUNT                                              65790000
         BZ    AFAERR80                 ERROR IF NO DATA GENERATED      65880000
         STH   COUNT,WKADDR            PLACE LENGTH IN KEY              65970000
         L     COUNT,WKKEY                                              66060000
         LTR   COUNT,COUNT                                              66150000
         BE    AFASSD35                 BRANCH IF NO USER VARIABLE      66240000
         MVC   0(4,COUNT),WKADDR       PLACE KEY IN USER VARIABLE       66330000
AFASSD35 TM    WKBITS+2,KEYED+CORRE                                     66420000
         BZ    AFARET10                BRANCH IF NOT KEYED OR CORREL    66510000
*                                                                       66600000
*   PREPARE PARAM LIST                                                  66690000
         SPACE                                                          66780000
         LA    REGA,ONE                CODE FOR ADDING KEY TO TABLE     66870000
         ST    REGA,WKCODE                                              66960000
         LA    REGA,AFASSD40           SAVE RETURN ADDRESS              67050000
         ST    REGA,WKTEMP                                              67140000
         LA    REGA,WKADDR                                              67230000
         ST    REGA,WKKADDR                                             67320000
         B     AFAKEY10                                                 67410000
*                                                                       67500000
AFASSD40 LTR   REGFIFTN,REGFIFTN                                        67590000
         BNE   AFAERR90                 BRANCH IF NOT ENOUGH STORAGE    67680000
         SPACE                                                          67770000
AFARET10 CLI   WKSWITCH,UPDATE                                          67860000
         BNE   AFARET15                 BRANCH IF NOT UPDATE            67950000
         TM    GDSFLAGS,LEVEL2                                          68040000
         BO    AFARET15                BRANCH IF LEVEL 2-NO KEY TABLE   68130000
         L     PARM,WKSTORAD                                            68220000
         MVC   4(4,PARM),WKBITS        MOVE IN NEW KEY SWITCHES         68310000
         TM    WKBITS+2,CORRE                                           68400000
         BZ    AFARET15                 BRANCH IF NO CORRVAL            68490000
         MVC   8(4,PARM),WKCORVL        MOVE IN NEW CORRVAL             68580000
AFARET15 MVC   GDSDATMD(1),WKSWAREA+1   RESTORE DATA MODE SWITCH        68670000
AFARET17 L     SAVE,4(SAVE)                                             68760000
AFARET20 RETURN (14,12),T                                               68850000
         SPACE 2                                                        68940000
AFASSD50 OI  WKBITS+2,REPONLY          SET FLAG TO GENERATE REPOS VECT  69030000
         XC    WKDATA1(32),WKDATA1                                      69120000
         MVC   WKXABS+2(2),GDSXCURR    PLACE CURRENT BEAM POSITION      69210000
         MVC   WKYABS+2(2),GDSYCURR    FROM GDS INTO PARAMETER LIST     69300000
         LA    COUNT,1                 RESET COUNT REGISTER             69390000
         B     AFASSD25                CALL DATA GEN AGAIN              69480000
         EJECT                                                          69570000
*CALL DATA STORE TO WRITE OUT UPDATE                                    69660000
*                                                                       69750000
*WRITE OUT UPDATE                                                       69840000
*                                                                       69930000
AFASSD80 LA    PARM,WKADDR                                              70020000
         L     REGFIFTN,STAT(ERRCD) POINT TO STATUS TABLE   D11 ZA15418 70110000
         L     REGFIFTN,UPDH14(REGFIFTN) AND TO IFFAHA14    D11 ZA15418 70200000
         BALR  RETURN,REGFIFTN     GOTO IFFAHA14            D11 ZA15418 70290000
* IFFAHA14 IS NOW CALLED VIA GSP LOGIC TO AVOID SYS OVRHD   D11 ZA15418 70380000
         B     AFARET10                                                 70470000
         SPACE                                                          70560000
*                                                                       70650000
*LINKAGE TO KEY MANAGEMENT ROUTINE                                      70740000
*                                                                       70830000
AFAKEY10 ST    GDSREG,WKGDS1                                            70920000
         LA    PARM,WKGDS1                                              71010000
         L     REGA,GDSGTMCB       GET POINTER TO GTMCB            000A 71100000
         L     REGA,4(REGA)        GET POINTER TO GSPCB            000A 71190000
         L     REGA,FE(REGA)       GET POINTER TO STATUS TABLE     000A 71280000
         L     REGFIFTN,ETE(REGA)  GET ADRS OF KEY TABLE MGMT      000A 71370000
         BALR  RETURN,REGFIFTN     BRANCH TO KEY TABLE MGMT        000A 71460000
         L     RETURN,WKTEMP            PICK UP RETURN ADDRESS          71550000
         BR    RETURN                                                   71640000
         EJECT                                                          71730000
*THIS SECTION IS ENTERED ON RETURN FROM THE DATA GENERATION ROUTINE   * 71820000
*WHEN DATA REMAINS TO BE GENERATED. THE DATA AREA IN THE PARAMETER    * 71910000
*LIST IS ZEROED, AND THE BEAM OFF/ON SWITCH IS FLIPPED. THE X AND Y   * 72000000
*VALUES TO BE USED (X AN Y START IF THE BEAM IS OFF, AND X AND Y END  * 72090000
*IF THE BEAM IS ON) ARE UPDATED AND PLACED IN THE PARAMETER LIST        72180000
*                                                                       72270000
*RESETTING AND INITIALIZATION                                           72360000
*                                                                       72450000
AFASET05 XC    WKDATA1(32),WKDATA1      ZERO DATA FIELDS IN PARM LIST   72540000
         XI    WKBITS+2,BEAMSW          FLIP BEAM OFF/ON SWITCH         72630000
         LA    LOOPCT,2                 SET UP LOOP CONTROL FOR UPDATE  72720000
*                                                                       72810000
*INITIALIZE FOR FIRST PASS- X ENTRY                                     72900000
*                                                                       72990000
         SR    REGB,REGB                INDEX TO PARM LIST, FOR X=0     73080000
         MVC   WKSWAREA(1),WKSWITCH+3   MOVE DATA MODE SWITCH TO WORK   73170000
         NI    WKSWAREA,NOY              AREA AND ELIMINATE Y SWITCHES  73260000
         TM    WKBITS+2,BEAMSW                                          73350000
         BO    AFASET10                 BRANCH IF X AND Y END VALUES    73440000
*                                        TO BE USED                     73530000
*INITIALIZE FOR X-Y START VALUES                                        73620000
         SR    REGD,REGD                INDEX TO WKAREAS =0 FOR X START 73710000
         LA    REGC,WKSWITCH+1          SWITCH ADDRESS FOR X-Y START    73800000
         B     AFASET15                 GO TO PROCESS                   73890000
*                                                                       73980000
*INITIALIZE FOR X-Y END VALUES                                          74070000
*                                                                       74160000
AFASET10 LA    REGD,8                   INDEX TO WKAREAS=8 FOR X END    74250000
         LA    REGC,WKSWITCH+2          SWITCH ADDRESS FOR X-Y END      74340000
*                                                                       74430000
*LOOPCT= LOOP CONTROL INFORMATION                                       74520000
*REGB  = INDEX TO VALUES IN PARM LIST                                   74610000
*REGC  = ADDRESS OF SWITCH AREA                                         74700000
*REGD  = INDEX TO WORK AREA                                             74790000
*                                                                       74880000
AFASET15 TM    0(REGC),XINDX                                            74970000
         BZ    AFASET50                 BRANCH IF INCREMENT PARM PASSED 75060000
         EJECT                                                          75150000
*THIS SECTION ENTERED WHEN INDEX PARAMETER PASSED                       75240000
*                                                                       75330000
AFASET20 L     REGA,WKXVAL(REGD)        PICK UP POINTER TO DATA         75420000
         TM    WKSWAREA+2,ON                                            75510000
         BZ    AFASET90                 BRANCH IF 1ST TIME X-Y END USED 75600000
         A     REGA,WKXCHNG(REGD)       OTHERWISE, UPDATE POINTER       75690000
         ST    REGA,WKXVAL(REGD)         AND SAVE IT                    75780000
         TM    WKSWAREA,ABSOLXY                                         75870000
         BZ    AFASET95                 BRANCH IF DATA MODE INCREMENTAL 75960000
AFASET25 LA    REGB,WKXABS(REGB)        GET POINTER TO PARM LIST ENTRY  76050000
         MVC   0(4,REGB),0(REGA)        MOVE VALUE INTO PARM LIST       76140000
AFASET30 BCT   LOOPCT,AFASET40          *                               76230000
*                                                                       76320000
*X AND Y VALUES NOW UPDATED                                             76410000
         C     COUNT,ONE                                                76500000
         BE    AFASET35                 BRANCH IF LAST CALL TO DATA GEN 76590000
         OI    WKSWAREA+2,ON           SET SWITCH 1ST X,Y END USED      76680000
         B     AFASSD10                                                 76770000
*                                                                       76860000
AFASET35 TM    WKBITS+2,LASTIN                                          76950000
         BZ    AFASET37      BRANCH IF NO DATA GENERATED YET            77040000
         OI    WKBITS+2,LASTIN         SET LAST PASS SWITCH             77130000
         B     AFASSD10                                                 77220000
AFASET37 XI    WKBITS,MULT             MULT ENTRY HAS BECOME SINGLE     77310000
         B     AFASSD10                                                 77400000
         EJECT                                                          77490000
*INITIALIZATION FOR SECOND PASS THROUGH LOOP (Y VALUES)                 77580000
*                                                                       77670000
AFASET40 LA    REGB,4                   IX VALUE FOR PARM LIST=4 FOR Y  77760000
         AR    REGD,REGB                IX TO WK AREA FOR Y=4 PLUS X IX 77850000
*                                       SWITCH ADDR (REG C) REMAINS     77940000
         MVC   WKSWAREA(1),WKSWITCH+3   MOVE DATA MODE SWITCH AND       78030000
         NI    WKSWAREA,NOX              ELIMINATE ANY X SWITCHES       78120000
         TM    0(REGC),YINDX                                            78210000
         BZ    AFASET50                 BRANCH IF INCREMENT PARM PASSED 78300000
         B     AFASET20                                                 78390000
         EJECT                                                          78480000
*INCREMENT PARAMETER PASSED, DATA MODE ABSOLUTE OR INCREMENTAL          78570000
*                                                                       78660000
AFASET50 TM    WKSWAREA+2,ON                                            78750000
         BZ    AFASET60                 BRANCH IF 1ST TIME X-Y END USED 78840000
         TM    WKSWAREA,ABSOLXY                                         78930000
         BZ    AFASET65                 BRANCH IF DATA MODE INCREMENTAL 79020000
         TM    WKSWAREA,REALX+REALY                                     79110000
         BM    AFASET55                 BRANCH IF INCREMENT REAL        79200000
         L     REGA,WKXVAL(REGD)                                        79290000
         A     REGA,WKXCHNG(REGD)       ADD INCREMENT                   79380000
         ST    REGA,WKXVAL(REGD)        SAVE NEW VALUE AND              79470000
AFASET52 ST    REGA,WKXABS(REGB)         PLACE IT IN PARM LIST          79560000
         B     AFASET30                 RETURN TO CHECK LOOP COUNT      79650000
*                                                                       79740000
*INCREMENT VALUE REAL                                                   79830000
         SPACE                                                          79920000
AFASET55 LE    FLT2,WKXVAL(REGD)                                        80010000
         AE    FLT2,WKXCHNG(REGD)       ADD INCREMENT                   80100000
         STE   FLT2,WKXVAL(REGD)        SAVE NEW VALUE AND              80190000
         STE   FLT2,WKXABS(REGB)         PLACE IT IN PARAMETER LIST     80280000
         B     AFASET30                 RETURN TO CHECK LOOP COUNT      80370000
*                                                                       80460000
* X OR Y END INCREMENTED, FIRST TIME REFERENCED                         80550000
         SPACE                                                          80640000
AFASET60 L     REGA,WKXVAL(REGD)        PICK UP VALUE                   80730000
         TM    WKSWAREA,ABSOLXY                                         80820000
         BM    AFASET52                 BRANCH IF DATA MODE ABSOLUTE    80910000
         ST    REGA,WKXINCR(REGB)      PLACE INCR IN PARM LIST          81000000
         B     AFASET30                 RETURN TO CHECK LOOP COUNT      81090000
*                                                                       81180000
*DATA MODE INCREMENTAL, INCREMENT PARAMETER PASSED                      81270000
*                                                                       81360000
AFASET65 L     REGA,WKXCHNG(REGD)                                       81450000
         ST    REGA,WKTEMP                                              81540000
         B     AFASUB10                                                 81630000
         SPACE                                                          81720000
* X OR Y END INDEXED, FIRST TIME REFERENCED                             81810000
*                                                                       81900000
AFASET90 TM    WKSWAREA,ABSOLXY                                         81990000
         BM    AFASET25                 BRANCH IF DATA MODE ABSOLUTE    82080000
         LA    REGB,WKXINCR(REGB)       GET POINTER TO PARM LIST ENTRY  82170000
         MVC   0(4,REGB),0(REGA)        PLACE VALUE IN PARM LIST        82260000
         B     AFASET30                                                 82350000
*                                                                       82440000
*X OR Y INDEXED, DATA MODE INCREMENTAL                                  82530000
*                                                                       82620000
AFASET95 MVC   WKTEMP,0(REGA)           MOVE INCREMENT INTO WORK AREA   82710000
         B     AFASUB10                 GO TO COMPUTE INCREMENT         82800000
         EJECT                                                          82890000
*THIS ROUTINE COMPUTES THE INCREMENT TO BE PASSED TO THE SCALE          82980000
*ROUTINE. IT EXPECTS WKTEMP TO HOLD THE INCREMENT, AND THE VARIOUS      83070000
*REGISTERS AS SET UP- REGB-INDEX TO PARAMETER LIST, REGD-INDEX TO       83160000
*WORK AREAS, AND REGC-SWITCH ADDRESS. REGISTER 15 IS USED AS A          83250000
*WORK REGISTER                                                          83340000
*                                                                       83430000
AFASUB10 LR    REGFIFTN,REGD                                            83520000
         C     REGFIFTN,EIGHT                                           83610000
         BL    AFASUB50                 BRANCH IF UPDATING X OR Y START 83700000
         S     REGFIFTN,EIGHT           ESTABLISH IX TO X OR Y START    83790000
AFASUB15 TM    WKSWAREA,REALX+REALY                                     83880000
         BM    AFASUB60                 BRANCH IF FLOATING POINT        83970000
         L     REGA,WKTEMP              PICK UP INCREMENT               84060000
         A     REGA,WKXTOT(REGD)         ADD TO CUMULATIVE POSITION     84150000
         ST    REGA,WKXTOT(REGD)         AND SAVE NEW TOTAL             84240000
         S     REGA,WKXTOT(REGFIFTN)    FIND DIFFERENCE FROM LAST POSIT 84330000
         ST    REGA,WKXINCR(REGB)      AND SAVE IN PARM LIST            84420000
         B     AFASET30                 RETURN TO CHECK LOOP COUNT      84510000
*                                                                       84600000
AFASUB50 LA    REGFIFTN,8(REGFIFTN)     ESTABLISH INDEX TO X OR Y END   84690000
         B     AFASUB15                                                 84780000
*                                                                       84870000
*INCREMENT REAL NUMBER                                                  84960000
*                                                                       85050000
AFASUB60 LE    FLT2,WKTEMP             PICK UP INCREMENT                85140000
         AE    FLT2,WKXTOT(REGD)         ADD TO CUMULATIVE POAITION     85230000
         STE   FLT2,WKXTOT(REGD)         AND SAVE NEW TOTAL             85320000
         SE    FLT2,WKXTOT(REGFIFTN)    COMPUTE INCREMENT               85410000
         STE   FLT2,WKXINCR(REGB)        AND PUT IN PARAMETER LIST      85500000
         B     AFASET30                 RETURN TO CHECK LOOP COUNT      85590000
         EJECT                                                          85680000
AFAERR10 MVC   PARMERR(4,ERRCD),ONE     GDS INVALID                     85770000
         OI     0(ERRCD),PRM                                            85860000
         B     AFARET17                                                 85950000
*                                                                       86040000
AFAERR20 OI    0(ERRCD),PRM             PARAMETER ERROR                 86130000
         B     AFARET15                                                 86220000
*                                                                       86310000
AFAERR30 MVC   PARMERR(4,ERRCD),EIGHT   GENCODE ERROR                   86400000
         B     AFAERR20                                                 86490000
*                                                                       86580000
AFAERR40 MVC   PARMERR(4,ERRCD),SIX     CORRVAL ERROR                   86670000
         B     AFAERR20                                                 86760000
*                                                                       86850000
AFAERR70 MVC   PARMERR(4,ERRCD),NINE    COUNT ERROR                     86940000
AFAERR80 OI    0(ERRCD),SCISSOR         NO DATA GENERATION              87030000
         B     AFARET15                                                 87120000
*                                                                       87210000
AFAERR90 OI    0(ERRCD),STRG            MAIN STORAGE EXCEEDED           87300000
         MVC   STOR(4,ERRCD),FOUR                                       87390000
         B     AFARES10                                                 87480000
*                                                                       87570000
*CALL RESET IF ERROR RETURN FROM SCALE OR DATA GEN                      87660000
*                                                                       87750000
AFARES10 MVC   GDSXCURR(4),WKXCURR      RESTORE BEAM POINTERS           87840000
         MVC   GDSXLAST(8),WKXLAST                                      87930000
         CLI   WKSWITCH,UPDATE                                          88020000
         BE    AFARET15                BRANCH IF UPDATE-RESET NOT       88110000
*                                       NECESSARY                       88200000
         MVC   WKDATA2(20),0(ERRCD)     SAVE RETURN ARRAY               88290000
         LA    REGA,GDSGDSCB            VAR HOLDING ADDR OF GDSCB       88380000
         ST    REGA,WKGDS                                               88470000
         LA    REGA,WKGDS               ADDRESS OF PARAMETER LIST       88560000
         ST    REGA,WKGDS1               STORED IN WORK AREA            88650000
         L     REGA,NULL(ERRCD)         NULL FOR CORRVAL IN PARM LIST   88740000
         ST    REGA,WKRTN                                               88830000
         LA    REGA,WKADDR              ADDRESS OF KEY IN PARM LIST     88920000
         ST    REGA,WKDATA1                                             89010000
         OI    WKDATA1,LAST             LAST PARM INDICATION            89100000
         ST    ERRCD,WKCODE             ADDRESS OF RETURN ARRAY         89190000
         LA    PARM,WKGDS1              ADDRESS OF WORK AREA            89280000
         L     REGA,16                                                  89370000
         L     REGA,CVTLINK(REGA)       LINK LIB DCB                    89460000
*      LINK EP=IFFAFA12,DCB=(REGA),MF=(E,(1)),SF=(E,WKSPVSR)            89550000
         LINK  EP=IFFAFA12,MF=(E,(1)),SF=(E,WKSPVSR)                    89640000
         MVC   0(20,ERRCD),WKDATA2      RESTORE RETURN ARRAY            89730000
         B     AFARET15                                                 89820000
         EJECT                                                          89910000
*CONSTANTS                                                              90000000
*                                                                       90090000
ZERO     DC    2F'0'                                                    90180000
ONE      DC    F'1'                                                     90270000
TWO      DC    F'2'                                                     90360000
THREE    DC    F'3'                                                     90450000
FOUR     DC    F'4'                                                     90540000
FIVE     DC    F'5'                                                     90630000
SIX      DC    F'6'                                                     90720000
SEVEN    DC    F'7'                                                     90810000
EIGHT    DC    F'8'                                                     90900000
NINE     DC    F'9'                                                     90990000
BITS     DC    B'10000111'              MULTIPLE,VECTOR,INCLUDE,        91080000
         DC    X'00'                     OPTIMIZED, FIRST PASS, NO KEY, 91170000
         DC    B'00000000'               NO CORRVAL, BEAM OFF           91260000
         DC    X'00'                                                    91350000
PATCH    DC    64X'FF'             PATCH AREA               D11         91440000
         EJECT                                                          91530000
WORKAREA DSECT                                                          91620000
WKPARM   DS    F                        ADDRESS OF PARAMETER LIST       91710000
WKRTNCD  DS    F                        ADDRESS OF RETURN ARRAY         91800000
WKSAVE   DS    18F                      REGISTER SAVE AREA              91890000
WKSWITCH DS    F                                                        91980000
*                                       BYTE 0 - UPDATE SWITCH          92070000
*                                       BYTE 1                          92160000
*                                          X'C0' - X INDEX              92250000
*                                          X'0C' - Y INDEX              92340000
*                                          X'30' - X INCREMENT          92430000
*                                          X'03' - Y INCREMENT          92520000
*                                       BYTE 2                          92610000
*                                          X'C0' - X2 INDEX             92700000
*                                          X'0C' - Y2 INDEX             92790000
*                                          X'30' - X2 INCREMENT         92880000
*                                          X'03' - Y2 INCREMENT         92970000
*                                       BYTE 3   - COPY OF INPUT DATA   93060000
*                                          MODE SWITCH FROM GDSCB       93150000
WKSWAREA DS    F                                                        93240000
WKSPVSR  DS    3F                                                       93330000
WKSTORAD DS    F                                                        93420000
WKTEMP   DS    F                                                        93510000
WKXCHNG  DS    F                                                        93600000
WKYCHNG  DS    F                                                        93690000
WKXCHNG2 DS    F                                                        93780000
WKYCHNG2 DS    F                                                        93870000
WKXVAL   DS    F                                                        93960000
WKYVAL   DS    F                                                        94050000
WKXVAL2  DS    F                                                        94140000
WKYVAL2  DS    F                                                        94230000
WKXTOT   DS    F                                                        94320000
WKYTOT   DS    F                                                        94410000
WKXTOT2  DS    F                                                        94500000
WKYTOT2  DS    F                                                        94590000
WKXCURR  DS    H                        *                               94680000
WKYCURR  DS    H                        *SAVE AREA FOR INFORMATION      94770000
WKXLAST  DS    F                        *  FROM GDSCB                   94860000
WKYLAST  DS    F                        *                               94950000
* START OF PARAMETER LIST PASSED TO DATA GENERATION ROUTINE             95040000
*                                                                       95130000
WKADDR   DS    F                        BUFFER LENGTH & LOG. BUFF ADDR  95220000
WKBITS   DS    F                        SWITCHES                        95310000
WKCORVL  DS    F                        CORRVAL                         95400000
WKKEY    DS    F                        KEY                             95490000
* START OF PARAMETER LIST PASSED TO SCALING AND SCISSORING ROUTINES     95580000
WKGDS    DS    F                        ADDRESS OF GDSCB                95670000
WKRTN    DS    F                        ADDRESS OF RETURN ARRAY         95760000
WKDATA1  DS    F                            *                           95850000
WKDATA2  DS    F                            *                           95940000
WKDATA3  DS    F                            *                           96030000
WKDATA4  DS    F                        DATA ARRAY                      96120000
WKXABS   DS    F                            *                           96210000
WKYABS   DS    F                            *                           96300000
WKXINCR  DS    F                            *                           96390000
WKYINCR  DS    F                            *                           96480000
WKTOTX   DS    F                        X INCREMENT THUS FAR            96570000
WKTOTY   DS    F                        Y INCREMENT THUS FAR            96660000
WKENDCT  DS    F                                                        96750000
* PARAMETERS FOR KEY MANAGEMENT ROUTINE                                 96840000
WKGDS1   DS    F                        ADDRESS OF GDSCB                96930000
WKCODE   DS    F                        CODE FOR KEY MANAGEMENT         97020000
WKKADDR  DS    F                        ADDRESS OF KEY                  97110000
         COPY  GDSCB                                                    97200000
         COPY  GTMCB                                                    97290000
         END                                                            97380000
./  ADD  SSI=80330203,NAME=IFFAFA03
     TITLE   'PTEXT - IFFAFA03 '                                        00090000
*********************************************************************** 00180000
*                                                                     * 00270000
*TITLE         PTEXT                                                  * 00360000
*                                                                     * 00450000
*MODULE NAME   IFFAFA03                                               * 00540000
*                                                                     * 00630000
*STATUS        CHANGE LEVEL 000                                       * 00720000
*                                                                     * 00810000
*FUNCTION/OPERATION                                                   * 00900000
*  TO PRODUCE CHARACTER TEXT ON THE GRAPHIC OUTPUT MEDIUM USING THE   * 00990000
*  CHARACTER GENERATOR. TO UPDATE PREVIOUSLY GENERATED PTEXT GRAPHIC  * 01080000
*  DATA.                                                              * 01170000
*                                                                     * 01260000
*ENTRY POINT   IFFAFA03- CSECT NAME                                   * 01350000
*                                                                     * 01440000
*INPUT   REGISTER 1 CONTAINS THE ADDRESS OF A WORK SAVE AREA. THE     * 01530000
*  FIRST WORD CONTAINS THE ADDRESS OF A VARIABLE LENGTH PARAMETER     * 01620000
*  LIST ON A FULL WORD BOUNDARY. THE SECOND WORD CONTAINS THE         * 01710000
*  ADDRESS OF THE RETURN ARRAY. THE NULL VARIABLE IS AT AN OFFSET     * 01800000
*  OF 20 FROM THE RETURN ARRAY, AND THE ADDRESS OF THE STATUS TABLE   * 01890000
*  IS AT AN OFFSET OF 24 FROM THE RETURN ARRAY                        * 01980000
*FORMAT OF PARAMETER LIST                                             * 02070000
* REQUIRED PARAMETERS                                                 * 02160000
*                                                                     * 02250000
*  +0    A(VAR)     ADDRESS OF A VARIABLE WHICH CONTAINS THE GDSCB    * 02340000
*                   ADDRESS.                                          * 02430000
*  +4    A(TEXT)    ADDRESS OF THE TEXT ARRAY WHICH CONTAINS THE      * 02520000
*                   CHARACTERS TO BE DISPLAYED, LEFT ADJUSTED AND     * 02610000
*                   PACKED FOUR TO THE FULL WORD.                     * 02700000
*  +8    A(COUNT)   ADDRESS OF THE COUNT OF THE NUMBER OF ALPHAMERIC  * 02790000
*                   CHARACTERS TO BE PLACED ON THE SCREEN.            * 02880000
*                                                                     * 02970000
* OPTIONAL PARAMETERS                                                 * 03060000
*                                                                     * 03150000
*  +12   A(CORRVAL) ADDRESS OF A CORRELATION VALUE                    * 03240000
*                                                                     * 03330000
*  +16   A(KEY)     ADDRESS OF A LOCATION INTO WHICH THE KEY IS TO    * 03420000
*                   BE INSERTED ON ORIGINAL GENERATION OR THE         * 03510000
*                   ADDRESS OF THE KEY ON UPDATE GENERATION.          * 03600000
*  +20   A(GENCODE) ADDRESS OF A CODE                                 * 03690000
*                     1 = INCLUDE                                     * 03780000
*                     2 = OMIT                                        * 03870000
*                     3 = UPDATE                                      * 03960000
*  +24   A(UVAL)    THE X VALUE TO WHICH THE CHARACTER STRING IS TO   * 04050000
*                   BE POSITIONED                                     * 04140000
*  +28   A(VVAL)    THE Y VALUE TO WHICH THE CHARACTER STRING IS TO   * 04230000
*                   BE POSITIONED                                     * 04320000
*                                                                     * 04410000
*OUTPUT                                                               * 04500000
*  NONE TO CALLER. THE DATA WILL BE SCISSORED, AND IF IT APPEARS ON   * 04590000
*  THE SCREEN, ORDERS WILL BE GENERATED FOR IT IN THE GDOA            * 04680000
*                                                                     * 04770000
*EXTERNAL ROUTINES                                                    * 04860000
*  IFFAFA12 - RESET                                                     04950000
*  IFFAFA17 - MVPOS USED TO POSITION BEAM WHEN X AND Y PARAMETERS     * 05040000
*             PASSED.                                                 * 05130000
*  IFFAHA03   KEY TABLE MANAGEMENT                                    * 05220000
*  IFFAHA04   DATA GENERATION                                         * 05310000
*  IFFAHA05   DATA STORE                                              * 05400000
*  IFFAHA07   SCISSOR                                                 * 05490000
*  IFFAHA13   GET GDOA'S FOR UPDATE                                   * 05580000
*  IFFAHA14   WRITE OUT UPDATE                                        * 05670000
*                                                                     * 05760000
*EXITS - BACK TO CALLER VIA REGISTER 14                               * 05850000
*  APPROPRIATE CODES ARE SET IN THE RETURN ARRAY- SEE GSPARRAY        * 05940000
*                                                                     * 06030000
*TABLES/WORKAREAS - SEE WORKAREA DSECT                                * 06120000
*                                                                     * 06210000
*ATTRIBUTES       - REENTRANT, PROBLEM PROGRAM MODE.                  * 06300000
*                                                                     * 06390000
*                                                                     * 06480000
*                                                                     * 06570000
*                                                                     * 06660000
*                                                                     * 06750000
*********************************************************************** 06840000
         EJECT                                                          06930000
IFFAFA03 CSECT                          PTEXT                           07020000
*D482300-482600,584000                                           A32072 07110000
*                                                                A32087 07200000
* 790000                                                         A29414 07290000
*2277,320800-322400,589000-590000,852000-853000                    000B 07380000
*2277,400000-403000,591000-593000,774000-777000,786000-789000      000C 07470000
*2277,601000,855000                                                000D 07560000
*D692000-694000                                                  YM1963 07650000
*A692000-694400                                                  YM1963 07740000
*A163140-163160,399500-400000,C401000,A785300-785600,C786000D11 ZA15418 07830000
*A163180,851200-852200,C853000-856000                       D11 ZA15437 07920000
         SPACE 2                                                        08010000
*REGISTERS                                                              08100000
*                                                                       08190000
EVEN     EQU   0                                                        08280000
PARM     EQU   1                                                        08370000
REGA     EQU   2                                                        08460000
REGB     EQU   3                                                        08550000
REGC     EQU   4                                                        08640000
WORK     EQU   5                                                        08730000
ERRCD    EQU   6                                                        08820000
GTMREG   EQU   7                                                        08910000
GDSREG   EQU   8                                                        09000000
BASE     EQU   9                                                        09090000
REGD     EQU   10                                                       09180000
COUNT    EQU   11                                                       09270000
SAVE     EQU   13                                                       09360000
RETREG   EQU   14                                                       09450000
BRANCH   EQU   15                                                       09540000
         SPACE 2                                                        09630000
*PARAMETER LIST EQUATES                                                 09720000
GDS      EQU   0                        ADDRESS OF GDS VARIABLE         09810000
TXT      EQU   4                        ADDRESS OF TEXT ARRAY           09900000
CT       EQU   8                        ADDRESS OF NUMBER OF CHARACTERS 09990000
COR      EQU   12                       ADDRESS OF CORRVAL              10080000
KEY      EQU   16                       ADDRESS OF KEY                  10170000
GEN      EQU   20                       ADDRESS OF GENCODE              10260000
X        EQU   24                       ADDRESS OF X COORD FOR START    10350000
Y        EQU   28                       ADDRESS OF Y COORD FOR START    10440000
*                                                                       10530000
NL       EQU   21                                                       10620000
SCERR    EQU   4                                                        10710000
MVPOS    EQU   360                                                      10800000
DGEN     EQU   840                                                      10890000
DSTORE   EQU   852                                                      10980000
SCISS    EQU   876                                                      11070000
CURRLOG  EQU   52                                                       11160000
CVTLINK  EQU   8                                                        11250000
LNK      EQU   8                                                        11340000
NULL     EQU   20                                                       11430000
PARMERR  EQU   16                                                       11520000
STAT     EQU   24                                                       11610000
STOR     EQU   12                                                       11700000
FE       EQU   48                                                  000A 11790000
ETE      EQU   828                                                 000A 11880000
         SPACE 2                                                        11970000
GRBP     EQU   X'80'                    GRAPHIC MODE SWITCH SETTINGS    12060000
GRLP     EQU   X'40'                    *                               12150000
GRBU     EQU   X'20'                    *                               12240000
GRLU     EQU   X'10'                    *                               12330000
BP       EQU   X'08'                                                    12420000
LP       EQU   X'04'                                                    12510000
BU       EQU   X'02'                                                    12600000
LU       EQU   X'01'                                                    12690000
BASIC    EQU   X'0A'                                                    12780000
LARGE    EQU   X'05'                                                    12870000
         SPACE 2                                                        12960000
CORRE    EQU   X'10'                                                    13050000
KEYED    EQU   X'20'                                                    13140000
OPT      EQU   X'04'                                                    13230000
MULT     EQU   X'80'                                                    13320000
OMIT     EQU   X'FB'                                                    13410000
INCLUDE  EQU   X'04'                                                    13500000
UPDATE   EQU   X'FF'                                                    13590000
LASTON   EQU   X'1F'                                                    13680000
CONTROL  EQU   X'00'                                                    13770000
UNRES    EQU   X'01'                                                    13860000
MEMSUB   EQU   X'80'                                                    13950000
MEMSEQ   EQU   X'40'                                                    14040000
SEQ      EQU   X'04'                                                    14130000
OFF      EQU   X'00'                                                    14220000
STRG     EQU   X'10'                                                    14310000
PRM      EQU   X'08'                                                    14400000
NOSCISS  EQU   X'10'                                                    14490000
SCISSOR  EQU   X'40'                                                    14580000
POS      EQU   X'11'                                                    14670000
YCOR     EQU   X'01'                                                    14760000
XCOR     EQU   X'10'                                                    14850000
SUBR     EQU   X'02'                                                    14940000
LEVEL2   EQU   X'10'                                                    15030000
LAST     EQU   X'80'                                                    15120000
LINKSW   EQU   X'01'                                                    15210000
ODD      EQU   X'01'                                                    15300000
CHARGEN  EQU   X'08'                                                    15390000
RESOL    EQU   X'02'                                                    15480000
ALIGN    EQU   X'00'                                                    15570000
STOP     EQU   X'01'                                                    15660000
SCISSON  EQU   X'40'                                                    15750000
WORD1    EQU   0        USE ZERO DISPLACEMENT FOR GSPARRAY       A29414 15840000
IOERR    EQU   X'04'    I/O ERROR FLAG, WORD 1, GSPARRAY         A29414 15930000
UPDH13   EQU   936                 STATAB DISPL-IFFAHA13    D11 ZA15418 16020000
UPDH14   EQU   948                 STATAB DISPL-IFFAHA14    D11 ZA15418 16110000
RESET    EQU   468                 STATAB DISPL-IFFAFA12    D11 ZA15437 16200000
DSP04    EQU   X'15C'                                              000C 16290000
STABADR  EQU   24                      DISPLACEMENT TO GSPASTAT    000C 16380000
R14      EQU   14                                                  000C 16470000
R15      EQU   15                                                  000C 16560000
         EJECT                                                          16650000
         USING *,15                                                     16740000
         SAVE  (14,12)                                                  16830000
         DROP  15                                                       16920000
*                                                                       17010000
*INITIALIZATION                                                         17100000
*THIS CODE ESTABLISHED ADDRESSABILITY FOR IFFAFA03, FOR THE GDSCB, AND  17190000
*FOR THE WORKAREA. THE RETURN ARRAY IS SET TO ZERO, AND THE SAVE AREAS  17280000
*ARE CHAINED.                                                           17370000
*                                                                       17460000
*                                       ESTABLISH BASES FOR             17550000
         LR    BASE,15                  IFFAFA03                        17640000
         USING IFFAFA03,BASE                                            17730000
         LR    WORK,PARM                WORK AREA                       17820000
         USING WORKAREA,WORK                                            17910000
         L     PARM,WKPARM              LOAD PARAMETER LIST ADDRESS     18000000
         L     GDSREG,GDS(PARM)         PCIK UP GDSCB VARIABLE ADDRESS  18090000
         L     GDSREG,0(GDSREG)         ESTABLISH BASE FOR GDSCB        18180000
         USING GDSCB,GDSREG                                             18270000
         L     ERRCD,WKRTNCD                                            18360000
         XC    0(20,ERRCD),0(ERRCD)     ZERO RETURN ARRAY               18450000
         LA    REGA,WKSAVE              CHAIN SAVE AREAS                18540000
         ST    REGA,8(SAVE)                                             18630000
         ST    SAVE,4(REGA)                                             18720000
         LR    SAVE,REGA                                                18810000
         EJECT                                                          18900000
*PARAMETER LIST SCAN                                                    18990000
*                                                                       19080000
*TEST FOR VALID GDSCB AND CHARACTER GENERATOR PRESENT                   19170000
*IF THE CHARACTER GENERATOR IS NOT PRESENT, IT IS AN INVALID CALL.      19260000
*                                                                       19350000
         C     GDSREG,GDSGDSCB                                          19440000
         BNE   AFAERR10                 BRANCH IF INVALID GDSCB- ERROR  19530000
         L     GTMREG,GDSGTMCB          PICK UP GTMCB ADDRESS           19620000
         USING GTMCB,GTMREG                                             19710000
         TM    GTMFEATS+1,CHARGEN                                       19800000
         BZ    AFAERR00                 BRANCH IF NO CHARACTER GENER.   19890000
*                                        -INVALID CALL- ERROR           19980000
         DROP  GTMREG                                                   20070000
*                                                                       20160000
*PREPARE SKELETON KEY AND PARAMETER LIST                                20250000
*THE SWITCHES IN THE KEY ARE INITIALIZED AS CHARACTER MODE, AND INCLUDE 20340000
*STATUS. APPROPRIATE SWITCHES ARE SET IF THE ELEMENT IS A MEMBER OF A   20430000
*SEQUENCE OR SUBROUTINE.                                                20520000
*                                                                       20610000
         XC    WKSPVSR(12),WKSPVSR     ZERO PARM LIST FOR LINK MACRO    20700000
         XC    WKBITSA(8),WKBITSA       ZERO WORK AREA AND              20790000
         XC    WKADDR(68),WKADDR         PARAMETER LIST                 20880000
         MVC   WKBITS,BITS              MOVE SKELETON KEY IN            20970000
         TM    GDSFLAGS,SEQ                                             21060000
         BZ    AFAPAR05                 BRANCH IF NOT MEMBER OF SEQ     21150000
         OI    WKBITS+3,MEMSEQ          SET SWITCH IN KEY               21240000
AFAPAR05 TM    GDSFLAGS,SUBR                                            21330000
         BZ    AFAPAR10                 BRANCH IF NOT SUBROUTINE MEM    21420000
         OI    WKBITS+3,MEMSUB          SET SWITCH IN KEY               21510000
AFAPAR10 ST    GDSREG,WKGDS             GDSCB ADDRESS                   21600000
         MVC   WKRTN,WKRTNCD            ADDRESS-OF RETURN ARRAY         21690000
*                                                                       21780000
*                                                                     * 21870000
*TEST FOR TEXT AND COUNT PARAMETERS PRESENT. SET UP COUNT IN REGISTER   21960000
*FOR LATER USE, AND PLACE THE CHARACTER COUNT IN THE KEY                22050000
*                                                                     * 22140000
         TM    GDS(PARM),LAST                                           22230000
         BO    AFAERR00                 BRANCH IF REQ PARMS NOT PRESENT 22320000
         CLC   NL(3,ERRCD),TXT+1(PARM)                                  22410000
         BE    AFAERR20                 BRANCH IF TEXT NULL - ERROR     22500000
         TM    TXT(PARM),LAST                                           22590000
         BO    AFAERR00                 BRANCH IF REQ PARMS NOT PRESENT 22680000
         CLC   NL(3,ERRCD),CT+1(PARM)                                   22770000
         BE    AFAERR30                 BRANCH IF COUNT NULL-ERROR      22860000
         L     COUNT,CT(PARM)           ADDRESS OF COUNT                22950000
         L     COUNT,0(COUNT)           PICK UP COUNT                   23040000
         LTR   COUNT,COUNT                                              23130000
         BZ    AFARET10                 BRANCH IF COUNT ZERO- RETURN    23220000
         BM    AFAERR30                 BRANCH IF COUNT NEGATIVE-ERROR  23310000
         STC   COUNT,WKBITS+2           STORE CHARACTER COUNT IN KEY    23400000
         SRA   COUNT,8                                                  23490000
         STC   COUNT,WKBITS+1                                           23580000
         L     COUNT,CT(PARM)           RESET COUNT REGISTER            23670000
         L     COUNT,0(COUNT)                                           23760000
         TM    CT(PARM),LAST                                            23850000
         BO    AFADAT10                 BRANCH IF NO OPTIONAL PARMS     23940000
     EJECT                                                              24030000
*THIS SECTION EXAMINES THE OPTIONAL PARAMETERS CORRVAL, KEY AND GENCODE 24120000
*AND TESTS THEM FOR VALIDITY. IF NECESSARY, THE INCLUDE-OMIT STRUCTURE  24210000
*IS BUILT. IF THERE IS A VALID UPDATE, KEY MANAGEMENT IS CALLED. IF     24300000
*NECESSARY DATA STORE IS CALLED TO ENTER ORDERS IN THE GDOA.            24390000
*                                                                       24480000
         CLC   NL(3,ERRCD),COR+1(PARM)                                  24570000
         BE    AFAPAR20                 BRANCH IF CORRVAL NULL          24660000
         TM    GDSFLAGS,LEVEL2                                          24750000
         BO    AFAPAR20                 BRANCH IF PASSED, BUT LEVEL 2   24840000
         L     REGC,COR(PARM)           LOAD ADDRESS OF CORRVAL AND     24930000
         MVC   WKCORVL,0(REGC)          PLACE CORRVAL IN KEY AREA       25020000
         OI    WKSWITCH+2,CORRE         SET CORRVAL SWITCH              25110000
*                                                                       25200000
AFAPAR20 TM    COR(PARM),LAST                                           25290000
         BO    AFADAT10                 BRANCH IF NO MORE PARAMS        25380000
         CLC   NL(3,ERRCD),KEY+1(PARM)                                  25470000
         BE    AFAPAR25                 BRANCH IF KEY NULL              25560000
         MVC   WKKEY,KEY(PARM)          SAVE KEY ADDRESS                25650000
         TM    GDSFLAGS,LEVEL2                                          25740000
         BO    AFAPAR25                 BRANCH IF LEVEL 2 KEY           25830000
         OI    WKSWITCH+2,KEYED         SET KEY SWITCH                  25920000
AFAPAR25 TM    KEY(PARM),LAST                                           26010000
         BO    AFADAT10                 BRANCH IF NO MORE PARAMETERS    26100000
         CLC   NL(3,ERRCD),GEN+1(PARM)                                  26190000
         BE    AFAPAR30                 BRANCH IF GENCODE NULL          26280000
         L     REGC,GEN(PARM)           PICK UP ADDRESS OF CODE AND     26370000
         L     REGC,0(REGC)             ACTUAL CODE                     26460000
         C     REGC,ONE                                                 26550000
         BE    AFAPAR30                 BRANCH IF 'INCLUDE' - SWITCH    26640000
*                                       ALREADY SET                     26730000
         CLC   WKCORVL(8),ZERO                                          26820000
         BE    AFAERR60                 BRANCH IF NO KEY OR CORRVAL     26910000
         C     REGC,TWO                                                 27000000
         BNE   AFAPAR50                 BRANCH IF NOT 'OMIT'            27090000
         TM    GDSFLAGS,LEVEL2                                          27180000
         BO    AFAERR60                 BRANCH IF LEVEL 2 - ERROR       27270000
         NI    WKBITS,OMIT              TURN OFF INCLUDE SWITCH         27360000
AFAPAR30 TM    WKSWITCH+2,CORRE                                         27450000
         BZ    AFAPAR35                                                 27540000
         CLC   WKCORVL,ZERO                                             27630000
         BE    AFAERR40                 BRANCH IF CORRVAL ZERO - ERROR  27720000
         EJECT                                                          27810000
*THIS SECTION EXAMINES THE X AND Y COORDINATE PARAMETERS. IF THEY       27900000
*ARE PRESENT MVPOS WILL BE CALLED TO POSITION THE BEAM                  27990000
*                                                                       28080000
AFAPAR35 TM    GEN(PARM),LAST                                           28170000
         BO    AFADAT10                 BRANCH IF NO MORE PARAMETERS    28260000
         CLC   NL(3,ERRCD),X+1(PARM)                                    28350000
         BE    AFAPAR40                 BRANCH IF X NULL                28440000
         OI    WKSWITCH+1,XCOR          SET SW&TCH, X PRESENT           28530000
AFAPAR40 TM    X(PARM),LAST                                             28620000
         BO    AFAPAR45                 BRANCH IF LAST                  28710000
         CLC   NL(3,ERRCD),Y+1(PARM)                                    28800000
         BE    AFAPAR45                 BRANCH IF Y NULL                28890000
         OI    WKSWITCH+1,YCOR          SET SWITCH, Y PRESENT           28980000
AFAPAR45 TM    WKSWITCH+1,POS                                           29070000
         BM    AFAERR00                 ERROR IS ONE COORDINATE PASSED  29160000
         B     AFADAT10                                                 29250000
         EJECT                                                          29340000
*CHECK FOR VALID UPDATE                                                 29430000
*                                                                       29520000
AFAPAR50 C     REGC,THREE                                               29610000
         BNE   AFAERR60                 BRANCH IF INVALID GENCODE       29700000
         TM    GDSFLAGS,SUBR                                            29790000
         BO    AFAERR00                 BRANCH IF BUFF SUBR- ERROR      29880000
         TM    GDSFLAGS,LEVEL2                                          29970000
         BO    AFAPAR80                 BRANCH IF LEVEL 2 TO SET KEY    30060000
         TM    WKSWITCH+2,KEYED                                         30150000
         BZ    AFAPAR85                 BRANCH IF NOT KEYED             30240000
*                                                                       30330000
*PREPARE FOR SEARCH ON KEY              PARAMETERS--                    30420000
*                                                                       30510000
         L     REGB,KEY(PARM)           ADDRESS OF KEY IN PARM LIST     30600000
         ST    REGB,WKKADDR                                             30690000
         LA    REGB,TWO                 CODE FOR SEARCH ON KEY          30780000
AFAPAR55 ST    REGB,WKCODE                                              30870000
         ST    GDSREG,WKGDS1            ADDRESS OF GDSCB                30960000
         LA    PARM,WKGDS1                                              31050000
*                                                                       31140000
*LINK TO KEY TABLE MANAGEMENT FOR SEARCH ON KEY OR CORRVAL              31230000
*                                                                       31320000
         L     REGB,STABADR(ERRCD)      GET STATUS TABLE ADDR      000B 31410000
         L     BRANCH,ETE(REGB)    GET ADRS OF KEY TABLE MGMT      000A 31500000
         BALR  RETREG,BRANCH       BRANCH TO KEY TABLE MGMT        000A 31590000
AFAPAR60 LTR   BRANCH,BRANCH                                            31680000
         BNE   AFAERR00                 BRANCH IF INVALID KEY           31770000
         MVC   WKADDR,0(PARM)           MOVE IN KEY START               31860000
         OC    WKBITS+3(1),7(PARM)      MOVE IN FLAGS FORM OLD KEY      31950000
         TM    4(PARM),INCLUDE                                          32040000
         BO    AFAPAR62                                                 32130000
         NI    WKBITS,OMIT              TURN OFF INCLUDE SWITCH         32220000
AFAPAR62 TM    WKSWITCH+2,CORRE                                         32310000
         BZ    AFAPAR65                 BRANCH IF NO CORRVAL            32400000
         ST    PARM,WKSTORAD            SAVE KEY ADDRESS                32490000
AFAPAR65 MVI   WKSWITCH,UPDATE          SET UPDATE SWITCH               32580000
         L     PARM,WKPARM              RESET PARAMETER REGISTER        32670000
         B     AFAPAR35                                                 32760000
         SPACE 2                                                        32850000
*                                                                       32940000
AFAPAR80 L     REGC,KEY(PARM)           LOAD KEY ADDRESS AND            33030000
         MVC   WKADDR,0(REGC)            PUT FIRST WORD IN NEW KEY      33120000
         B     AFAPAR65                                                 33210000
*                                                                       33300000
*PREPARE FOR SEARCH ON CORRVAL                                          33390000
*                                                                       33480000
AFAPAR85 CLC   WKCORVL,ZERO                                             33570000
         BE    AFAERR00                 BAD PARAMETER COMBINATION       33660000
         LA    REGB,WKCORVL             PREPARE PARAMS FOR SEARCH ON    33750000
         ST    REGB,WKKADDR                CORRVAL                      33840000
         LA    REGB,FIVE                WORK CODE FOR SEARCH ON CORRVAL 33930000
         B     AFAPAR55                                                 34020000
         EJECT                                                          34110000
*                                                                       34200000
*THIS SECTION INITIALIZES FOR CHARACTER OUTPUT. IF IT IS AN UPDATE,     34290000
*GDOA'S ARE OBTAINED. IF THE ELEMENT IS KEYED OR CORRVALED, THE         34380000
*INCLUDE OMIT STRUCTURE IS BUILT                                        34470000
AFADAT10 CLI   WKSWITCH,UPDATE                                          34560000
         BE    AFADAT70                 BRANCH IF UPDATE                34650000
         L     REGD,GDSAOACB            OACB                            34740000
         L     REGD,CURRLOG(REGD)       LOGICAL START                   34830000
         STH   REGD,WKADDR+2            IN ELEMENT                      34920000
*                                                                       35010000
*CHECK FOR KEY AND CORRVAL                                              35100000
*                                                                       35190000
AFADAT25 TM    WKSWITCH+2,KEYED+CORRE                                   35280000
         BZ    AFAPOS10                 BRANCH IF NO KEY OR CORRVAL     35370000
*                                                                       35460000
*SET UP TO CALL DATA STORE                                              35550000
*                                                                       35640000
         ST    GDSREG,WKGDS1            ADDRESS OF GDSCB                35730000
         MVC   WKRTN1,WKRTNCD           ADDRESS OF RETURN ARRAY         35820000
         LA    REGC,WKOUTPT+4           ADDRESS OF ORDERS               35910000
         XC    WKOUTPT(4),WKOUTPT       ZERO FIRST WORD                 36000000
         TM    WKBITS,INCLUDE                                           36090000
         BO    AFADAT75                 BRANCH IF INCLUDE STATUS        36180000
         MVC   0(4,REGC),GTRUORD        MOVE IN GTRU                    36270000
AFADAT30 MVI   WKOUTPT,UNRES                                            36360000
         NI    GDSGRMOD,CONTROL         SET TO CONTROL MODE             36450000
         LA    REGD,4                                                   36540000
         STH   REGD,WKOUTPT+2           SET LENGTH TO 4                 36630000
         LA    PARM,WKGDS1                                              36720000
*/                                                                      36810000
*/CALL DATA STORE TO SET UP INCLUDE/OMIT STRUCTURE                      36900000
*/                                                                      36990000
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         37080000
         L     BRANCH,DSTORE(BRANCH)    ADDRESS OF DATA STORE           37170000
         BALR  RETREG,BRANCH                                            37260000
*                                                                       37350000
         LTR   BRANCH,BRANCH                                            37440000
         BNE   AFARES11                                            0544 37530000
         L     REGD,GDSAOACB           OACB                             37620000
         L     REGD,CURRLOG(REGD)      LOGICAL ADDRESS IN BUFFER        37710000
         S     REGD,FOUR               POINT TO ELEMENT START           37800000
         STH   REGD,WKADDR+2           AND STORE IN KEY                 37890000
         B     AFAPOS10                                                 37980000
         EJECT                                                          38070000
*CALL TO GET GDOA'S FOR UPDATE                                          38160000
*                                                                       38250000
AFADAT70 LA    PARM,WKADDR              PARAMETER LIST ADDRESS          38340000
         L     BRANCH,STABADR(ERRCD) POINT TO STATUS TABLE  D11 ZA15418 38430000
         L     BRANCH,UPDH13(BRANCH) AND TO IFFAHA13        D11 ZA15418 38520000
         BALR  RETREG,BRANCH       GOTO UPDATE              D11 ZA15418 38610000
         LTR   BRANCH,BRANCH                                            38700000
         BE    AFADAT25                 BRANCH IS SUCCESSFUL            38790000
         B     AFAERR81                                            0544 38880000
*                                                                       38970000
*SET UP INCLUDE-OMIT STRUCTURE FOR INCLUDE                              39060000
*                                                                       39150000
AFADAT75 MVC   0(4,REGC),GNOPORD        MOVE IN GNOP                    39240000
         B     AFADAT30                                                 39330000
     EJECT                                                              39420000
*THIS SECTION CALLS MVPOS IF THE X AND Y COORDINATES WERE PASSED        39510000
*                                                                       39600000
AFAPOS10 MVC   WKXCURR(4),GDSXCURR      SAVE X-Y CURR                   39690000
         MVC   WKXLAST(8),GDSXLAST      SAVE X- Y LAST                  39780000
AFAPOS20 TM    WKSWITCH+1,POS                                           39870000
         BZ    AFASCS30                 BRANCH IF POSITION NOT REQ      39960000
*SET UP PARAMETERS FOR MOVE POSITION                                    40050000
*                                                                       40140000
         MVC   WKSWITCH+3(1),GDSFLAGS                                   40230000
         TM    WKBITS+3,MEMSUB          TEST FOR GENERATING OR UPDATING 40320000
         BZ    AFAPOS15                  SUBR- BRANCH IF NOT            40410000
         TM    GDSFLAGS,SUBR                                            40500000
         BO    AFAPOS15                 BRANCH IF GENERATING SUBR       40590000
*                                                                       40680000
*IF UPDATING SUBROUTINE, GDSFLAGS MUST BE CHANGED FOR MOVE POSITION     40770000
*                                                                       40860000
         OI    GDSFLAGS,SUBR            SET SWITCH FOR SUBROUTINE       40950000
AFAPOS15 L     PARM,WKPARM             RESTORE PARM REGISTER            41040000
         LA    REGC,WKGDSADR            ADDRESS OF PARAM LIST           41130000
         ST    REGC,WKPARM1                                             41220000
         ST    ERRCD,WKRTN2            ADDRESS OF RETURN ARRAY          41310000
         MVC   WKGDSADR(4),GDS(PARM)    ADDRESS OF GDSCB VARIABLE       41400000
         MVC   WKUVAL(8),X(PARM)        ADDRESS OF X AND Y PARAMS       41490000
         OI    WKVVAL,LAST              SET LAST PARAMETER SWITCH       41580000
*/                                                                      41670000
*/CALL MVPOS TO POSITION BEAM                                           41760000
*/                                                                      41850000
         LA    PARM,WKPARM1             ADDRESS OF PARAM LIST           41940000
         L     REGB,STAT(ERRCD)         ADDRESS OF STATUS TABLE         42030000
         L     BRANCH,MVPOS(REGB)       START ADDRESS OF ROUTINE        42120000
         LTR   BRANCH,BRANCH            IF ZERO, ROUTINE NOT IN,        42210000
         BZ    AFAPOS30                 GO TO LINK OR LOAD              42300000
*                                                                       42390000
*BRANCH AND LINK TO MOVE POSITION                                       42480000
*                                                                       42570000
AFAPOS16 BALR  RETREG,BRANCH                                            42660000
         SPACE 2                                                        42750000
*TEST RETURN ARRAY AFTER CALL TO MVPOS                                  42840000
*                                                                       42930000
AFAPOS17 MVC   GDSFLAGS(1),WKSWITCH+3   REPLACE GDSFLAGS                43020000
         CLI   0(ERRCD),OFF                                             43110000
         BE    AFASCS30                 BRANCH IF CALL TO MVPOS O.K.    43200000
         CLI   0(ERRCD),SCISSON                                         43290000
         BNE   AFAERR90                                                 43380000
         TM    GDSSCISS,STOP                                            43470000
         BO    AFAERR90                BRANCH IF STOP GENERATION        43560000
*                                        OPTION SET.                    43650000
     EJECT                                                              43740000
*WHEN THIS SECTION IS ENTERED, THE BEAM HAS BEEN POSITIONED TO THE      43830000
*START OF THE CHARACTER STRING. IF THE SCISSOR OPTION IS IN EFFECT      43920000
*A VECTOR THE LENGTH OF THE CHARACTER STRING MUST BE SCISSORED.         44010000
*                                                                       44100000
AFASCS30 TM    WKBITS+3,MEMSUB                                          44190000
         BO    AFASET20                 BRANCH IF SUBROUTINE-NO SCISS,  44280000
*                                        NO BEAM REPOSITIONING          44370000
         TM    GDSSCISS,NOSCISS                                         44460000
         BO    AFASET10                 BRANCH IF NO SCISSORING.        44550000
*                                                                       44640000
*SCISSORING OPTION IN EFFECT                                            44730000
*IF THE CURRENT BEAM POSITION IS OFF TO THE LEFT OF THE SCREEN, THE     44820000
*BEGINNING OF THE TEXT STRING MUST BE SCISSORED.                        44910000
*                                                                       45000000
         LH    REGA,GDSXCURR                                            45090000
         S     REGA,GDSXLAST            AMOUNT TO BE SCISSORED FROM     45180000
*                                       FRONT OF CHARACTER STRING       45270000
         C     REGA,THREE                                               45360000
         BH    AFASCS32                 IF SCISS LESS THAN 3  NO SCISS  45450000
         SR    REGA,REGA                IF OFF TO RIGHT, EVERYTHING OFF 45540000
*                                                                       45630000
*THE AMOUNT TO BE SCISSORED FROM LEFT (IN RASTER UNITS) IS SAVED.       45720000
*THE CHARACTER COUNT IS MULTIPLIED BY RASTER UNITS/CHARACTER (56 FOR    45810000
*BASIC, 84 FOR LARGE) TO DETERMINE THE INCREMENT IN THE X DIRECTION,    45900000
*WHICH IS PASSED TO SCISSOR. THE Y COORDINATE REMAINS UNCHANGED         45990000
*                                                                       46080000
AFASCS32 ST    REGA,WKSCI1                                              46170000
         LR    EVEN,COUNT                                               46260000
         TM    GDSCHARS,LARGE                                           46350000
         BM    AFASCS90                 BRANCH IF CHARACTERS LARGE      46440000
         MH    EVEN,SMALL+2             56 RASTER UNITS/CHARACTER       46530000
*                                        IF CHARACTERS BASIC            46620000
*REGISTER 0 CONTAINS LENGTH IN RASTER UNITS OF CHARACTER STRING         46710000
*                                                                       46800000
*SET UP PARAMETERS FOR SCISSOR                                          46890000
AFASCS35 ST    EVEN,WKXINCR                                             46980000
         A     EVEN,GDSXLAST            X ABSOLUTE                      47070000
         ST    EVEN,WKXABS                                              47160000
         MVC   WKYABS(4),GDSYLAST       X POSITION UNCHANGED            47250000
*CALL TO SCISSOR ROUTINE                                                47340000
*                                                                       47430000
         LA    PARM,WKGDS                                               47520000
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         47610000
         L     BRANCH,SCISS(BRANCH)     ADDRESS OF SCISSOR              47700000
         BALR  RETREG,BRANCH            BRANCH TO SCISSOR               47790000
         LTR   BRANCH,BRANCH                                            47880000
         BNE   AFARES05                 BRANCH IF NO DATA GENERATION    47970000
*                                                                       48060000
*ON RETURN FROM THE SCISSOR ROUTINE,THE AMOUNT (IN RASTER UNITS) TO BE  48150000
*SCISSORED FROM THE END OF THE TEXT STRING (IF ANY) IS COMPUTED AND     48240000
*SAVED.                                                                 48330000
*                                                                       48420000
         L     REGA,GDSXLAST                                            48510000
         SH    REGA,GDSXCURR                                            48600000
         BNL   AFASCS37                 BRANCH IF ON SCREEN, OR TO RGHT 48690000
         SR    REGA,REGA                                                48780000
AFASCS37 C     REGA,THREE               IF SCISSORED THREE OR LESS      48870000
         BH    AFASCS38                  RUS, IT IS IGNORED             48960000
         B     AFASC394            GO TO ZERO SCISSOR LENGTH       5962 49050000
AFASCS38 TM    GDSCHARS,LARGE      LARGE CHARS                     5962 49140000
         BM    AFASCS39            YES                             5962 49230000
         S     REGA,HALFSM         SUBTRACT 1/2 CHAR FOR                49320000
         B     AFASC392            CHAR GEN OVERLAP OF SCREEN EDGE 5962 49410000
AFASCS39 S     REGA,HALFBIG        SUB. 1/2 CHAR FOR CHRGEN             49500000
AFASC392 C     REGA,THREE          IF LESS THAN 3 NO SCISS DONE    5962 49590000
         BH    AFASC396            NOT LESS                        5962 49680000
AFASC394 SR    REGA,REGA           ZERO SCISS REG                  5962 49770000
AFASC396 ST    REGA,WKSCI2         SAVE AMNT TO BE SCISSORED       5962 49860000
     EJECT                                                              49950000
*TEST FOR POSITIONING VECTOR NECESSARY                                  50040000
*IF  POSITIONING VECTOR IS NECESSARY, THE DATA GENERATION ROUTINE IS    50130000
*CALLED TO GENERATE THE BLANKED VECTOR.                                 50220000
*                                                                       50310000
         CLC   WKDATA1(8),ZERO                                          50400000
         BE    AFASCS40                BRANCH IF POSITIONING VECTOR     50490000
*                                        UNNECESSARY                    50580000
         MVC   WKXABS(16),WKDATA1       SET UP PARMS FOR DATA GEN       50670000
         MVC   WKBITSA(4),WKBITS        SAVE KEY STRUCTURE              50760000
         MVC   WKBITS,BITSA             MOVE IN PARM FOR DATA GEN       50850000
         XC    WKDATA1(16),WKDATA1      ZERO POSITIONING VECTOR AREA    50940000
*                                                                       51030000
*CALL TO DATA GENERATION ROUTINE                                        51120000
*                                                                       51210000
         LA    PARM,WKADDR              ADDRESS OF PARAMETER LIST       51300000
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         51390000
         L     BRANCH,DGEN(BRANCH)      ADDRESS OF DATA GEN             51480000
         BALR  RETREG,BRANCH            BRANCH TO DATA GEN              51570000
         LTR   BRANCH,BRANCH                                            51660000
         BNE   AFARES10                                                 51750000
         MVC   WKBITS(4),WKBITSA        RESET KEY SWITCHES              51840000
         EJECT                                                          51930000
*THIS SECTION COMPUTES THE SCISSORING NECESSARY FOR CHARACTERS          52020000
*REGISTER 1 IS USED AS A WORK REGISTER                                  52110000
*THE TOTAL AMOUNT TO BE SCISSORED (INRASTER UNITS) IS DIVIDED BY        52200000
*RASTER UNITS/CHARACTER. IF THERE IS A REMAINDER, 1 IS ADDED TO THE     52290000
*NUMBER OF CHARACTERS TO BE SCISSORED. IF THE SCISSORING OCCURS ONLY    52380000
*ON THE END OF THE TEXT STRING, THE COUNT IS DECREMENTED BY THE NUMBER  52470000
*OF CHARACTERS TO BE SCISSORED. IF SCISSORING OCCURS ONLY AT THE        52560000
*START OF THE TEXT STRING, THE POINTER TO THE TEXT ARRAY IS INCREMENTED 52650000
*BY THE NUMBER OF CHARACTERS TO BE SCISSORED, AND THE COUNT IS          52740000
*DECREMENTED BY THE NUMBER OF CHARACTERS TO BE SCISSORED. IF THERE      52830000
*IS SCISSORING AT BOTH START AND END, THE NUMBER OF CHARACTERS          52920000
*SCISSORED FROM EACH IS COMPUTED, AND ACTION PROCEEDS AS ABOVE.         53010000
*                                                                       53100000
*INITIALIZE WITH ADDRESS OF TEXT ARRAY                                  53190000
AFASCS40 L     PARM,WKPARM                                              53280000
         L     REGD,TXT(PARM)           PICK UP TEXT ADDRESS            53370000
*                                                                       53460000
         L     PARM,WKSCI1                                              53550000
         A     PARM,WKSCI2              TOTAL AMOUNT TO BE SICSSORED    53640000
         BZ    AFAGEN10                 BRANCH IF NOTHING SCISSORED     53730000
         SR    EVEN,EVEN                SET UP FOR DIVISION             53820000
         TM    GDSCHARS,LARGE                                           53910000
         BM    AFASCS85                 BRANCH IF CHARACTERS LARGE      54000000
         D     EVEN,SMALL               NO. CHARS TO BE SCISSORED=      54090000
*                                       NO. RASTER UNITS/56             54180000
AFASCS45 LTR   EVEN,EVEN                                                54270000
         BZ    AFASCS50                 BRANCH IF NO REMAINDER          54360000
         A     PARM,ONE                 OTHERWISE ADD 1 TO QUOTIENT     54450000
AFASCS50 LR    REGA,PARM                SAVE NO OF CHARS TO BE SCISS    54540000
         CR    REGA,COUNT                                               54630000
         BNL   AFARES05                 BRANCH IF NO DATA WILL BE       54720000
*                                        GENERATED                      54810000
         CLC   WKSCI1(4),ZERO                                           54900000
         BE    AFASCS65                 BRANCH IF NO SCISS AT START     54990000
         CLC   WKSCI2(4),ZERO                                           55080000
         BE    AFASCS60                 BRANCH IF NO SCISS AT END       55170000
         MVC   SCERR(4,ERRCD),ONE       SET SCISS COUNT TO 1,IF SCISS   55260000
*                                       AT START                        55350000
         L     PARM,WKSCI1              PICK UP RU'S TO BE SICSS FROM   55440000
         SR    EVEN,EVEN                 BEGINNING                      55530000
         TM    GDSCHARS,LARGE                                           55620000
         BM    AFASCS80                                                 55710000
         D     EVEN,SMALL               NO. CHARS SCISSORED FROM LEFT   55800000
AFASCS55 LTR   PARM,PARM                                                55890000
         BZ    AFASCS65                 BRANCH IF NO FULL CHAR OFF LEFT 55980000
AFASCS60 AR    REGD,PARM                UPDATE POINTER TO TEXT ARRAY    56070000
*                                        BY NUMBER OF CHARACTERS TO     56160000
*                                        BE SCISSORED.                  56250000
AFASCS65 SR    COUNT,REGA               NUMBER OF CHARACTERS TO BE      56340000
*                                        GENERATED                      56430000
*IF SCISSORING OCCURS, NEW CHARACTER COUNT MUST GO IN KEY               56520000
*                                                                       56610000
         STC   COUNT,WKBITS+2                                           56700000
         SRA   COUNT,8                                                  56790000
         STC   COUNT,WKBITS+1                                           56880000
*                                                                       56970000
*RESTORE COUNT IN REGISTER                                              57060000
         SLA   COUNT,8                                                  57150000
         IC    COUNT,WKBITS+2                                           57240000
         CLC   WKSCI1(4),ZERO                                           57330000
         BNE   AFAGEN10                 BRANCH IF SCISS AT START        57420000
         LA    COUNT,1(COUNT)                                           57510000
         ST    COUNT,SCERR(ERRCD)       SET CHARACTER SCISSORED NUMBER  57600000
*                                        IN RETURN ARRAY                57690000
         BCTR  COUNT,0                  RESET COUNT REGISTER            57780000
         B     AFAGEN10                                                 57870000
*                                                                       57960000
*                                                                       58050000
AFASCS80 D     EVEN,BIG                 NO OF CHARACTERS TO BE          58140000
         B     AFASCS55                  SCISSORED FROM FRONT           58230000
*                                                                       58320000
*                                                                       58410000
AFASCS85 D     EVEN,BIG                 NO. CHARS TO BE SICSSORED=      58500000
         B     AFASCS45                  NO. RASTER UNITS/84            58590000
*                                                                       58680000
*                                                                       58770000
AFASCS90 MH    EVEN,BIG+2               LENGTH OF CHARACTER STRING=     58860000
*                                  COUNT * 84 RASTER UNITS         5962 58950000
         B     AFASCS35            GEN OVERLAP                     5962 59040000
*                                                                       59130000
*                                                                       59220000
*LINK OR LOAD MOVE POSITION                                             59310000
*                                                                       59400000
AFAPOS30 TM    MVPOS+LNK(REGB),LINKSW   TEST LINK/LOAD FLAG        000C 59490000
         BO    AFAPOS40                 BRANCH IF YES                   59580000
         LOAD  EP=IFFAFA17                                              59670000
         ST    EVEN,MVPOS(REGB)        STORE ENT PT IN STATAB      5962 59760000
         LR    BRANCH,EVEN              PUT ENTRY POINT ADD IN 15       59850000
         S     EVEN,TWO                 FIND ENTRY POINT OF FA04   000C 59940000
         ST    EVEN,DSP04(REGB)         SAVE ADDR IN STATUS TABLE  000C 60030000
         LA    PARM,WKPARM1             RELOAD PARAM REGISTER           60120000
         B     AFAPOS16                                                 60210000
*                                                                       60300000
AFAPOS40 LINK  EP=IFFAFA17                                              60390000
         B     AFAPOS17                                                 60480000
         EJECT                                                          60570000
*THIS SECTION WILL BE ENTERED IF NO SCISSORING OPTION IS SET            60660000
*                                                                       60750000
*RESET BEAM POSITION IN GDSCB                                           60840000
AFASET10 LR    EVEN,COUNT                                               60930000
         TM    GDSCHARS,LARGE                                           61020000
         BM    AFASET50                 BRANCH IF CHARACTERS LARGE      61110000
         MH    EVEN,SMALL+2              OTHERWISE 56RU'S/CHARACTER     61200000
AFASET15 A     EVEN,GDSXLAST                                            61290000
         ST    EVEN,GDSXLAST                                            61380000
         SRA   EVEN,2                   ROUND X CURRENT FIELD TO        61470000
         SLA   EVEN,2                   MULTIPLE OF 4                   61560000
         STH   EVEN,GDSXCURR            REPOSITION X IN GDSCB           61650000
         NI    GDSSCISS,LASTON                                          61740000
*                                                                       61830000
*                                                                       61920000
AFASET20 L     PARM,WKPARM                                              62010000
         L     REGD,TXT(PARM)           ADDRESS OF TEXT ARRAY           62100000
         B     AFAGEN10                                                 62190000
*                                                                       62280000
*                                                                       62370000
*                                                                       62460000
AFASET50 MH    EVEN,BIG+2               IF LARGE CHARS, 84RU'S/CHAR     62550000
         B     AFASET15                                                 62640000
*                                                                       62730000
         EJECT                                                          62820000
*                                                                       62910000
*CHARACTER GENERATION                                                   63000000
*REGD CONTAINS BEGIN ADDRESS OF TEXT ARRAY                              63090000
*COUNT CONTAINS NUMBER OF CHARACTERS TO BE GENERATED                    63180000
*                                                                       63270000
*SET UP PARAMETERS FOR DATA STORE                                       63360000
*                                                                       63450000
AFAGEN10 ST    GDSREG,WKGDS1            ADDRESS OF GDSCB                63540000
         ST    ERRCD,WKRTN1             ADDRESS OF RETURN ARRAY         63630000
         LA    REGC,WKOUTPT+4           ADDRESS OF DATA AREA            63720000
         LA    REGB,36                  NUMBER OF BYTES IN OUTPUT AREA  63810000
         SR    REGA,REGA               SET WORK COUNT TO 0              63900000
*REGC CONTAINS ADDRESS OF OUTPUT AREA                                   63990000
*REGB CONTAINS COUNT OF BYTES REMAINING IN OUTPUT AREA                  64080000
*REGA CONTAINS A WORK COUNT FIELD                                       64170000
*                                                                       64260000
         TM    WKBITS+3,MEMSUB                                          64350000
         BZ    AFAGEN15                 BRANCH IF NOT PART OF SUBR      64440000
         TM    WKSWITCH+1,POS                                           64530000
         BO    AFAGEN15                 BRANCH IF POSITIONING VECTOR    64620000
         MVC   0(2,REGC),GEVI2ORD       OTHERWISE,ENSURE NO WRAP AROUND 64710000
         LA    REGC,2(REGC)             UPDATE POINTER AND              64800000
         S     REGB,TWO                 DECREMENT COUNT                 64890000
         A     REGA,TWO                 SET LENGTH TO 2                 64980000
*SET CHARACTER MODE                                                     65070000
*                                                                       65160000
AFAGEN15 TM    GDSCHARS,LP                                              65250000
         BO    AFAGEN85                 BRANCH IF CHARS LARGE, PROTECT  65340000
         TM    GDSCHARS,LU                                              65430000
         BO    AFAGEN90                 BRANCH IF CHARS LARGE, UNPROTEC 65520000
         TM    GDSCHARS,BP                                              65610000
         BO    AFAGEN95                 BRANCH IF CHARS BASIC, PROTECT  65700000
         MVC   0(2,REGC),CHRBU          SETS MODE-CHARS BASIC, UNPROTEC 65790000
         MVI   GDSGRMOD,GRBU            SET CURRENT MODE SW IN GDSCB    65880000
*                                                                       65970000
AFAGEN20 LA    REGC,2(REGC)             UPDATE POINTER AND              66060000
         S     REGB,TWO                  DECREMENT COUNT                66150000
         A     REGA,TWO                                                 66240000
         CR    COUNT,REGB                                               66330000
         BH    AFAGEN70                 BRANCH IF MORE CHARS THAN ROOM  66420000
*                                        IN OUTPUT AREA                 66510000
         AR    REGA,COUNT               COMPUTE LENGTH FOR FIRST TIME   66600000
AFAGEN25 ST    REGA,WKOUTPT            LENGTH STORED IN OUTPUT AREA     66690000
         LR    REGA,COUNT                                               66780000
         SR    COUNT,REGA               SET COUNT FOR NEXT TIME         66870000
AFAGEN27 BCTR  REGA,0                   DECREMENT COUNT BY 1            66960000
         EX    REGA,MOVE                MOVE IN CHARACTERS              67050000
         LTR   COUNT,COUNT                                              67140000
         BNE   AFAGEN30                 BRANCH IF MORE CALLS NECESSARY  67230000
*                                                                       67320000
         TM    WKOUTPT+3,ODD                                            67410000
         BZ    AFAGEN30                 BRANCH IF LENGTH EVEN           67500000
         LA    REGA,1(REGA)             SET UP INDEX                    67590000
         AR    REGC,REGA                POINTER TO OUTPUT AREA          67680000
         MVI   0(REGC),ALIGN            MOVE IN NULL CHARACTER TO ALIGN 67770000
         SR    REGA,REGA                                                67860000
         IC    REGA,WKBITS+1           PICK UP CHARACTER COUNT FROM KEY 67950000
         SLA   REGA,8                                                   68040000
         IC    REGA,WKBITS+2                                            68130000
         LA    REGA,1(REGA)            ADD 1 TO CHAR COUNT FOR NULL CHR 68220000
         STC   REGA,WKBITS+2                                            68310000
         SRA   REGA,8                                                   68400000
         STC   REGA,WKBITS+1                                            68490000
         LA    REGA,1                                                   68580000
         AH    REGA,WKOUTPT+2                                           68670000
         STH   REGA,WKOUTPT+2           RESET LENGTH INDICATOR IN PARM  68760000
         EJECT                                                          68850000
*CALL DATA STORE                                                        68940000
*                                                                       69030000
AFAGEN30 LA    PARM,WKGDS1                                              69120000
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         69210000
         L     BRANCH,DSTORE(BRANCH)    ADDRESS OF DATA STORE           69300000
         BALR  RETREG,BRANCH            BRANCH TO DATA STORE            69390000
         B     RC(BRANCH)               BRANCH ON RETURN CODE    YM1963 69480000
RC       B     CHRCNT                   DATA STORE SUCCESSFULLY  YM1963 69570000
         B     AFARES10                 DATA STORE FAILED        YM1963 69660000
         MVC   GDSXCURR(4),WKXCURR      IF UPDATE OVERFLOW....   YM1963 69750000
         MVC   GDSXLAST(8),WKXLAST      RESTORE BEAM POINTERS    YM1963 69840000
         B     AFARET20                 RETURN TO CALLER         YM1963 69930000
CHRCNT   C     COUNT,ZERO               ANY MORE CHARACTERS??    YM1963 70020000
         BE    AFATST10                 BRANCH IF NO MORE CHARACTERS    70110000
*                                       TO BE GENERATED.                70200000
*REINITIALIZE FOR NEXT PASS                                             70290000
*                                                                       70380000
*                                                                       70470000
*ADJUST POINTER TO TEXT ADDRESS                                         70560000
         LA    REGD,1(REGA,REGD)        NEW ADDR= OLD + COUNT OF CHARS  70650000
*                                                                       70740000
*RESET OUTPUT AREA POINTER + COUNT                                      70830000
         LA    REGC,WKOUTPT+4                                           70920000
         LA    REGB,36                  LENGTH OF OUTPUT AREA           71010000
         LR    REGA,COUNT                                               71100000
         CR    COUNT,REGB                                               71190000
         BNH   AFAGEN25                 BRANCH IF ALL CHARS WILL GO OUT 71280000
         LR    REGA,REGB                                                71370000
         ST    REGA,WKOUTPT             SET LENGTH                      71460000
         SR    COUNT,REGA               RESET CHARACTER COUNT           71550000
         B     AFAGEN27                                                 71640000
*                                                                       71730000
*                                                                       71820000
*                                                                       71910000
*                                                                       72000000
AFAGEN70 SR    COUNT,REGB               SET CHARACTER COUNT             72090000
         AR    REGA,REGB                                                72180000
         ST    REGA,WKOUTPT             SET LENGTH PARAMETER            72270000
         LR    REGA,REGB                # OF CHARS OUTPUT               72360000
         B     AFAGEN27                                                 72450000
*                                                                       72540000
AFAGEN85 MVC   0(2,REGC),CHRLP          CHARS LARGE, PROTECTED          72630000
         MVI   GDSGRMOD,GRLP            SET CURRENT MODE SW IN GDSCB    72720000
         B     AFAGEN20                                                 72810000
*                                                                       72900000
AFAGEN90 MVC   0(2,REGC),CHRLU          CHARS LARGE, UNPROTECTED        72990000
         MVI   GDSGRMOD,GRLU            SET CURRENT MODE SW IN GDSCB    73080000
         B     AFAGEN20                                                 73170000
*                                                                       73260000
AFAGEN95 MVC   0(2,REGC),CHRBP          CHARS BASIC, PROTECTED          73350000
         MVI   GDSGRMOD,GRBP            SET CURRENT MODE SW IN GDSCB    73440000
         B     AFAGEN20                                                 73530000
         EJECT                                                          73620000
*                                                                       73710000
*THIS SECTION IS ENTERED AFTER THE CHARACTERS HAVE BEEN GENERATED       73800000
*                                                                       73890000
AFATST10 TM    WKSWITCH+2,KEYED+CORRE                                   73980000
         BZ    AFATST12                BRANCH IF NO KEY OR CORRVAL      74070000
         XC    WKOUTPT(4),WKOUTPT       ZERO                            74160000
         MVI   WKOUTPT,RESOL                                            74250000
         LA    PARM,WKGDS1                                              74340000
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         74430000
         L     BRANCH,DSTORE(BRANCH)   ADDRESS OF DATA STORE            74520000
         BALR  RETREG,BRANCH            BRANCH TO DATA STORE            74610000
         LTR   BRANCH,BRANCH                                            74700000
         BNE   AFARES10                                                 74790000
AFATST12 CLI   WKSWITCH,UPDATE                                          74880000
         BE    AFATST30                 BRANCH IF UPDATE                74970000
*                                                                       75060000
*PREPARE KEY                                                            75150000
*                                                                       75240000
         L     COUNT,GDSAOACB                                           75330000
         L     COUNT,CURRLOG(COUNT)     GET CURRENT LOGICAL ADDRESS     75420000
         SH    COUNT,WKADDR+2           COMPUTE ELEMENT LENGTH          75510000
         LTR   COUNT,COUNT                                              75600000
         BZ    AFAERR70                 ERROR IF NO DATA GENERATED      75690000
         STH   COUNT,WKADDR             PLACE LENGTH IN KEY             75780000
         L     COUNT,WKKEY                                              75870000
         LTR   COUNT,COUNT                                              75960000
         BE    AFATST15                 BRANCH IF NO USER VARIABLE      76050000
         MVC   0(4,COUNT),WKADDR        PLACE KEY IN USER VARIABLE      76140000
AFATST15 TM    WKSWITCH+2,KEYED+CORRE                                   76230000
         BZ    AFARET10                 BRANCH IF NO KEY OR CORRVAL     76320000
*                                                                       76410000
*CALL KEY TABLE MANAGEMENT TO ADD KEY                                   76500000
*                                                                       76590000
         LA    REGA,ONE                 CODE FOR ADDING KEY TO TABLE    76680000
         ST    REGA,WKCODE                                              76770000
         LA    REGA,WKADDR              ADDRESS OF KEY                  76860000
         ST    REGA,WKKADDR                                             76950000
         ST    GDSREG,WKGDS1            ADDRESS OF GDSCB                77040000
         LA    PARM,WKGDS1                                              77130000
         L     REGA,STABADR(ERRCD)      GET STATUS TABLE ADDR      000C 77220000
         L     BRANCH,ETE(REGA)         GET ADDR OF HA03           000C 77310000
         BALR  RETREG,BRANCH                                       000C 77400000
         LTR   BRANCH,BRANCH                                            77490000
         BNE   AFAERR80                 BRANCH IF NOT ENOUGH STORAGE    77580000
*                                                                       77670000
         B     AFARET10                                                 77760000
         EJECT                                                          77850000
*CALL UPDATE TO WRITE OUT UPDATE                                        77940000
*                                                                       78030000
AFATST30 LA    PARM,WKADDR                                              78120000
         L     BRANCH,STABADR(ERRCD) POINT TO STATUS TABLE  D11 ZA15418 78210000
         L     BRANCH,UPDH14(BRANCH) AND TO IFFAHA14        D11 ZA15418 78300000
         BALR  RETREG,BRANCH       GOTO UPDATE              D11 ZA15418 78390000
         LTR   BRANCH,BRANCH       UPDATED OK                    A29414 78480000
         BZ    AFARET10              IF YES, CONTINUE            A29414 78570000
         OI    WORD1(ERRCD),IOERR    IF NO,  INDICATE I/O ERROR  A29414 78660000
         B     AFARET20                                          A29414 78750000
       SPACE     4                                                      78840000
AFARET10 CLI   WKSWITCH,UPDATE                                          78930000
         BNE   AFARET20                 BRANCH IF NOT UPDATE            79020000
         TM    WKSWITCH+2,CORRE                                         79110000
         BZ    AFARET20                 BRANCH IF NOT CORRELATED        79200000
         L     PARM,WKSTORAD            PICK UP KEY ADDRESS             79290000
         MVC   8(4,PARM),WKCORVL        PUT NEW CORRVAL IN KEY TABLE    79380000
AFARET20 L     SAVE,4(SAVE)                                             79470000
         RETURN (14,12),T                                               79560000
         EJECT                                                          79650000
AFAERR00 OI    0(ERRCD),PRM             PARAMETER ERROR                 79740000
         B     AFARET20                                                 79830000
*                                                                       79920000
AFAERR10 MVC   PARMERR(4,ERRCD),ONE     INVALID GDSCB                   80010000
         B     AFAERR00                                                 80100000
*                                                                       80190000
AFAERR20 MVC   PARMERR(4,ERRCD),TWO     INVALID TEXT-NULL               80280000
         B     AFAERR00                                                 80370000
*                                                                       80460000
AFAERR30 MVC   PARMERR(4,ERRCD),THREE   COUNT ERROR-                    80550000
         B     AFAERR70                                                 80640000
*                                                                       80730000
AFAERR40 MVC   PARMERR(4,ERRCD),FOUR    CORRVAL ERROR                   80820000
         B     AFAERR00                                                 80910000
*                                                                       81000000
AFAERR60 MVC   PARMERR(4,ERRCD),SIX     GENCODE ERROR                   81090000
         B     AFAERR00                                                 81180000
*                                                                       81270000
AFAERR70 OI    0(ERRCD),SCISSOR         NO DATA GENERATION              81360000
         B     AFARET20                                                 81450000
AFAERR80 OI    0(ERRCD),STRG            MAIN STORAGE EXCEEDED           81540000
         MVC   STOR(4,ERRCD),FOUR                                       81630000
         B     AFARES11                                            0544 81720000
*                                                                       81810000
AFAERR81 OI    0(ERRCD),STRG            MAIN STORAGE EXCEEDED      0544 81900000
*                                       FOR UPDATE                 0544 81990000
         MVC   STOR(4,ERRCD),FOUR       SET ERROR CODE             0544 82080000
         B     AFARES12                                            0544 82170000
*                                                                  0544 82260000
AFAERR90 TM    WKSWITCH+2,KEYED+CORRE                                   82350000
         BZ    AFARET20                RETURN IF NOT KEYED+CORRE        82440000
         B     AFARES10                OTHERWISE GO TO RESET            82530000
         EJECT                                                          82620000
*                                                                       82710000
*CALL RESET IF ERROR RETURN FROM DATA STORE                             82800000
*                                                                       82890000
AFARES05 MVC   SCERR(4,ERRCD),ONE       SET SCISS COUNT TO ONE IF       82980000
*                                        NO CHARS GENERATED             83070000
AFARES10 MVC   GDSXCURR(4),WKXCURR      RESTORE BEAM POINTERS           83160000
         MVC   GDSXLAST(8),WKXLAST                                      83250000
AFARES11 EQU   *                                                   0544 83340000
         CLI   WKSWITCH,UPDATE                                          83430000
         BE    AFATST30            WRITE UPDATE WITH NO DATA       5962 83520000
         MVC   WKDATA2(20),0(ERRCD)     SAVE RETURN ARRAY               83610000
AFARES12 EQU   *                                                   0544 83700000
         LA    REGA,GDSGDSCB            VAR HOLDING ADDRESS OF GDSCB    83790000
         ST    REGA,WKGDS                                               83880000
         LA    REGA,WKGDS               ADDRESS OF PARAMETER LIST       83970000
         ST    REGA,WKGDS1               STORED IN WORK AREA            84060000
         L     REGA,NULL(ERRCD)         NULL FOR CORRVAL IN PARM LIST   84150000
         ST    REGA,WKRTN                                               84240000
         LA    REGA,WKADDR              ADDRESS OF KEY IN PARM LIST     84330000
         ST    REGA,WKDATA1                                             84420000
         OI    WKDATA1,LAST             LAST PARM INDICATION            84510000
         ST    ERRCD,WKCODE             ERROR CODE IN PARM LIST         84600000
         LA    PARM,WKGDS1              ADDRESS OF WORK AREA            84690000
         L     BRANCH,STABADR(ERRCD) POINT TO STATUS TABLE  D11 ZA15437 84780000
         L     BRANCH,RESET(BRANCH) AND TO IFFAFA12 (RESET) D11 ZA15437 84870000
         LTR   BRANCH,BRANCH       RESET SPEC'D BY CALLER?  D11 ZA15437 84960000
         BZ    AFALINK1            NO,MUST USE SYSTEM LINK  D11 ZA15437 85050000
         BALR  RETREG,BRANCH       GOTO RESET               D11 ZA15437 85140000
         B     AFARTN1             RETURN FROM RESET        D11 ZA15437 85230000
AFALINK1 LINK  EP=IFFAFA12         LINK TO RESET            D11 ZA15437 85320000
AFARTN1  MVC   0(20,ERRCD),WKDATA2 RESTORE RETURN ARRAY     D11 ZA15437 85410000
         B     AFARET20                                                 85500000
         EJECT                                                          85590000
MOVE     MVC   0(0,REGC),0(REGD)                                        85680000
         SPACE 2                                                        85770000
ZERO     DC    D'0'                                                     85860000
ONE      DC    F'1'                                                     85950000
TWO      DC    F'2'                                                     86040000
THREE    DC    F'3'                                                     86130000
FOUR     DC    F'4'                                                     86220000
FIVE     DC    F'5'                                                     86310000
SIX      DC    F'6'                                                     86400000
SEVEN    DC    F'7'                                                     86490000
EIGHT    DC    F'8'                                                     86580000
BIG      DC    F'84'                                                    86670000
SMALL    DC    F'56'                                                    86760000
HALFBIG  DC    F'42'                                                    86850000
HALFSM   DC    F'28'                                                    86940000
         SPACE 2                                                        87030000
BITS     DC    B'10001100'              MULTIPLE,CHARACTER, INCLUDE     87120000
         DC    X'00'                                                    87210000
         DC    X'00'                                                    87300000
         DC    X'00'                                                    87390000
*                                                                       87480000
*BITSA- PASSED TO DATA GENERATION IF POSITIONING VECTOR NECESSARY       87570000
*                                                                       87660000
BITSA    DC    B'10000100'              MULTIPLE, VECTOR, INCLUDE,      87750000
         DC    X'00'                    ABSOLUTE                        87840000
         DC    B'00000000'              FIRST PASS, NO KEY, NO CORRVAL, 87930000
         DC    X'00'                    BEAM OFF, NOT UPDATE            88020000
*ORDERS                                                                 88110000
*                                                                       88200000
         GINIT                                                          88290000
GTRUORD  GTRU  0                                                        88380000
GNOPORD  GNOP4 0                                                        88470000
GEVI2ORD GEVI2                                                          88560000
CHRBP    GECP  B                                                        88650000
CHRLP    GECP  L                                                        88740000
CHRBU    GECF  B                                                        88830000
CHRLU    GECF  L                                                        88920000
         DS    0F                                           D11         89010000
PATCH    DC    40X'FF'             PATCH AREA               D11         89100000
         EJECT                                                          89190000
WORKAREA DSECT                                                          89280000
WKPARM   DS    F                                                        89370000
WKRTNCD  DS    F                                                        89460000
WKSAVE   DS    18F                                                      89550000
WKXCURR  DS    H                                                        89640000
WKYCURR  DS    H                                                        89730000
WKXLAST  DS    F                                                        89820000
WKYLAST  DS    F                                                        89910000
WKBITSA  DS    F                                                        90000000
WKSWITCH DS    F                        FORMAT                          90090000
*                                       BYTE 0 -                        90180000
*                                         UPDATE = X'FF'                90270000
*                                       BYTE 1                          90360000
*                                         X COOR PASSED=X'10'           90450000
*                                         Y COOR PASSED=X'01'           90540000
*                                       BYTE2                           90630000
*                                         KEYED= X'20'                  90720000
*                                         CORRE= X'10'                  90810000
WKSCI1   DS    F                                                        90900000
WKSCI2   DS    F                                                        90990000
WKSPVSR  DS    3F                                                       91080000
WKTEMP   DS    F                                                        91170000
WKSTORAD DS    F                                                        91260000
*PARAMETERS PASSED TO DATA GENERATION ROUTINE                           91350000
WKADDR   DS    F                        *                               91440000
WKBITS   DS    F                        *KEY                            91530000
WKCORVL  DS    F                        *                               91620000
WKKEY    DS    F                        ADDRESS OF USER'S KEY VARIABLE  91710000
*PARAMETERS PASSED TO SCISSOR BEGIN HERE                                91800000
WKGDS    DS    F                        ADDRESS OF GDSCB                91890000
WKRTN    DS    F                        ADDRESS OF RETURN ARRAY         91980000
WKDATA1  DS    F                        *                               92070000
WKDATA2  DS    F                        *USED BY SCISSOR IF POSITIONING 92160000
WKDATA3  DS    F                        * VECTOR IS NECESSARY           92250000
WKDATA4  DS    F                        *                               92340000
WKXABS   DS    F                                                        92430000
WKYABS   DS    F                                                        92520000
WKXINCR  DS    F                                                        92610000
WKYINCR  DS    F                                                        92700000
WKTOTX   DS    F                                                        92790000
WKTOTY   DS    F                                                        92880000
WKENTCT  DS    F                                                        92970000
         EJECT                                                          93060000
*PARAMETERS PASSED TO KEY MANAGEMENT, DATA STORE, UPDATE, AND MVPOS     93150000
*FOR DATA STORE                                                         93240000
WKGDS1   DS    F                        ADDR OF GDSCB                   93330000
WKRTN1   DS    F                        ADDRESS OF RETURN ARRAY         93420000
WKOUTPT  DS    10F                                                      93510000
*FOR KEY MANAGEMENT                                                     93600000
*WKGDS1  EQU   WKGDS1                   ADDR OF GDSCB                   93690000
WKCODE   EQU   WKRTN1                   CODE                            93780000
WKKADDR  EQU   WKOUTPT                  KEY ADDRESS                     93870000
*                                                                       93960000
*                                                                       94050000
*FOR MOVPOS                                                             94140000
WKGDSADR EQU   WKGDS1                                                   94230000
WKUVAL   EQU   WKRTN1                                                   94320000
WKVVAL   EQU   WKOUTPT                                                  94410000
WKPARM1  EQU   WKOUTPT+4                                                94500000
WKRTN2   EQU   WKOUTPT+8                                                94590000
         COPY  GDSCB                                                    94680000
         COPY  GTMCB                                                    94770000
         END                                                            94860000
./  ADD  SSI=80330204,NAME=IFFAFA04
         TITLE 'IFFAFA04 -- STPOS/MVPOS MODULE'             D11         00100000
*                                                                       00200000
*        STPOS AND MVPOS ARE ENTERED FROM DIRECTOR PART 2 WITH THE      00300000
*        ADDRESS OF A WORK AREA IN REGISTER 1.  THE FIRST WORD OF THE   00400000
*        WORK AREA CONTAINS THE ADDRESS OF THE PARAMETER LIST BELOW.    00500000
*                                                                       00600000
*                             STPOS AND MVPOS                           00700000
*                                                                       00800000
*                             INPUT PARAMETER LIST                      00900000
*                                                                       01000000
*                             +0  A(GDSVAR)                             01100000
*                             +4  A(X-COORD)                            01200000
*                             +8  A(Y-COORD)                            01300000
*                             +12 A(CORVAL)                             01400000
*                             +16 A(KEY)                                01500000
*                             +20 A(GENCODE)                            01600000
*                                                                       01700000
*        EXTERNAL ROUTINES CALLED:                                      01800000
*                                                                       01900000
*        SCALE-IFFAHA06                                                 02000000
*        SCISSOR-IFFAHA07                                               02100000
*        KEY TABLE MANAGEMENT- IFFAHA03                                 02200000
*        DATA GENERATOR-IFFAHA04                                        02300000
*        UPDATE-IFFAHA13 AND IFFAHA14                                   02400000
*        EXTERNAL MACROS USED:                                          02500000
*                                                                       02600000
*        LINK                                                           02700000
*                                                                       02800000
         EJECT                                                          02900000
*        MVPOS AND STPOS WILL SPEND A GOOD PORTION OF ITS TIME          03000000
*        BUILDING A PARAMETER LIST WHICH IS USED AS THE INPUT           03100000
*        PARAMETER LIST TO SCALE, SCISSOR, DATA GENERATOR, AND          03200000
*        UPDATE.                                                        03300000
*                                                                       03400000
*        WORD 0 IS THE KEY WHICH IS RETURNED TO THE USER.  THE FIRST    03500000
*        HALFWORD CONTAINS THE LENGTH OF THE ELEMENT AND THE SECOND     03600000
*        HALFWORD CONTAINS THE LOGICAL START ADDRESS OF THE ELEMENT.    03700000
*                                                                       03800000
*        WORD 1 CONTAINS BIT SWITCHES.                                  03900000
*        BIT 0: 0=SINGLE ENTRY/1=MULTIPLE ENTRY                         04000000
*        BIT 1: INITIALIZED TO ZERO.  SET BY DATA GEN TO SHOW IF        04100000
*        FOR A SINGLE ENTRY IF THE DATA CONTAINS A SET MODE ORDER.      04200000
*        BITS 2,3,4:                                                    04300000
*        000 IS VECTOR INPUT                                            04400000
*        010 IS POINT INPUT                                             04500000
*        BIT 5: 0=OMIT/1=INCLUDE                                        04600000
*        BITS 6&7:                                                      04700000
*        00 IS ABSOLUTE OUTPUT                                          04800000
*        01 IS INCREMENTAL OUTPUT                                       04900000
*        11 IS OPTIMIZED OUTPUT                                         05000000
*        BITS 8-15: ARE RESERVED AND INITIALIZED TO ZERO. DATA          05100000
*        GEN WILL PLACE THE BYTE OF DATA CONTAINING THE BEAM BIT        05200000
*        HERE IF IT IS A SINGLE ENTRY WHICH IS KEYED OR CORRELATED.     05300000
*        BITS 16&17:                                                    05400000
*        00 IS FIRST PASS                                               05500000
*        01 IS NOT FIRST PASS, NOT LAST PASS                            05600000
*        11 IS LAST PASS                                                05700000
*        FOR SINGLE ELEMENTS THIS IS SET TO FIRST PASS.                 05800000
*        BIT 18: 0=DATA NOT KEYED/1=DATA KEYED                          05900000
*        BIT 19: 0=DATA NOT CORRELATED/1=DATA CORRELATED                06000000
*        BIT 20: 0=BEAM OFF/1=BEAM ON                                   06100000
*        BIT 21: 0=REPOSITION/1=NO REPOSITIONING                        06200000
*        BITS 22&23: RESERVED AND SET TO ZERO                           06300000
*        BIT 24: 0=NOT PART OF A SUBROUTINE/1:PART OF A SUBROUTINE      06400000
*        BIT 25: 0=NOT PART OF A SEQUENCE/1=PART OF A SEQUENCE          06500000
*        BITS26-31: RESERVED AND SET TO ZERO                            06600000
*                                                                       06700000
*                                                                       06800000
*                                                                       06900000
         EJECT                                                          07000000
*        WORD 2 CONTAINS THE CORVAL                                     07100000
*                                                                       07200000
*        WORD 3 CONTAINS THE ADDRESS OF THE KEY.                        07300000
*                                                                       07400000
*        WORD 4 CONTAINS THE ADDRESS OF THE GDSCB.                      07500000
*                                                                       07600000
*        WORDS5,6,7&8: ARE SET TO ZERO AND IF A POSITIONING             07700000
*        VECTOR IS REQUIRED BECAUSE OF PREVIOUS SCISSORING, SCISSOR     07800000
*        WILL FILL THE FIELDS IN WITH X ABSOLUTE, Y ABSOLUTE,           07900000
*        X INCREMENTAL, AND Y INCREMENTAL FOR THE POSITIONING           08000000
*        VECTOR.                                                        08100000
*                                                                       08200000
*        WORD 9 CONTAINS X ABSOLUTE.                                    08300000
*                                                                       08400000
*        WORD 10 CONTAINS Y ABSOLUTE.                                   08500000
*                                                                       08600000
*        WORD 11 CONTAINS X INCREMENTAL.                                08700000
*                                                                       08800000
*        WORD 12 CONTAINS Y INCREMENTAL.                                08900000
*                                                                       09000000
*        THE ABOVE WORDS WILL BE SET FROM THE INPUT PASSED AS EITHER    09100000
*        INCREMENTAL OR ABSOLUTE IN USERS UNITS.  SCALE WILL CONVERT    09200000
*        TO RASTER UNITS AND FILL IN THE FORM NOT PASSED.               09300000
*                                                                       09400000
*        WORD 13 CONTAINS THE TOTAL X INCREMENT THUS FAR.               09500000
*                                                                       09600000
*        WORD 14 CONTAINS THE TOTAL Y INCREMENT THUS FAR.               09700000
*                                                                       09800000
*        THE ABOVE WORDS ARE USED IF AN INCREMENTAL REPOSITIONING       09900000
*        VECTOR IS REQUIRED TO REPOSITION WHEN THE ELEMENT IS IN        10000000
*        OMIT STATUS.                                                   10100000
*                                                                       10200000
*        WORD 15 CONTAINS THE ELEMENT COUNT.  IT IS SET TO ZERO         10300000
*        ORIGINALLY AND INCREMENTED BY SCALE. IF THERE IS A             10400000
*        SCALING OR SCISSORING ERROR THE ELEMENT NUMBER IS PLACED       10500000
*        IN THE RETURN ARRAY.                                           10600000
*                                                                       10700000
*                                                                       10800000
         EJECT                                                          10900000
IFFAFA04 CSECT                     ENTRY FOR STPOS                      11000000
*0876,230000                                                            11100000
*0514,157000-159000                                                000A 11200000
*2101                                                              5489 11300000
*D308600,D311600                                                 YM1963 11400000
*C315000-317000,320000,325000-327000,330000,A497200-497400  D11 ZA15418 11500000
*A479100-479800,C480000,C483000                             E12 ZA28573 11550000
         ENTRY IFFAFA17                                                 11600000
         NOPR  0                                                        11700000
IFFAFA17 SAVE  (14,12)             ENTRY FOR MOVPOS                     11800000
         BALR  BASE,0                                                   11900000
         USING *,BASE                                                   12000000
         L     REGB,ENTRYADD                                            12100000
         LA    REGFIFTN,0(REGFIFTN)                                     12200000
         SR    REGB,REGFIFTN       REGB=0 ENTRY BY MOVPOS               12300000
*                                  REGB=2 ENTRY BY SETPOS               12400000
         LR    WORK,PARM           WORK CORE                            12500000
         USING WORKAREA,WORK                                            12600000
         L     ERRREG,WRKRTNCD                                          12700000
         XC    ZERO(20,ERRREG),ZERO(ERRREG) ZERO RTN ARRAY              12800000
         L     PARM,WRKPARM        PARAMETER LIST                       12900000
         ST    SAVE,WRKSAVE+4                                           13000000
         LA    REGA,WRKSAVE                                             13100000
         ST    REGA,EIGHT(SAVE)    CHAIN SAVE AREAS                     13200000
         LR    SAVE,REGA                                                13300000
         XC    WRKSPVSR(12),WRKSPVSR ZERO SUPERVISOR PARAMETER LIST     13400000
         L     GDSREG,GDSPARM(PARM)                                     13500000
         L     GDSREG,ZERO(GDSREG) REMOVE GDSCB ADDR FROM VARIABLE      13600000
         USING GDSCB,GDSREG                                             13700000
         CLI   GDSGDSID,GDSIDSW    GDSCB VALID                          13800000
         BNE   ERR1                                                     13900000
         ST    REGB,WRKSWTCH       ZERO SWITCH EXCEPT SET ENTRY TYPE    14000000
         MVC   WRKSWTCH+2(1),GDSDATMD SAVE DATA A MODE SWITCH           14100000
         SR    REGA,REGA                                                14200000
         EJECT                                                          14300000
*                                                                       14400000
*              FIRST OF ALL A COUNT OF THE PARAMETERS IS MADE.          14500000
*              THE PRESENCE OF THE REQUIRED PARAMETERS IS THEN          14600000
*              VERIFIED AND THEY ARE PLACED IN THE DATA ARRAY           14700000
*                                                                       14800000
POS00010 TM    ZERO(PARM),LSTPARM  LOOP TO COUNT PARMS EXCEPT GDS       14900000
         BO    POS00020                                                 15000000
         LA    REGA,ONE(REGA)      ADD TO COUNT                         15100000
         LA    PARM,FOUR(PARM)                                          15200000
         B     POS00010                                                 15300000
POS00020 C     REGA,REQCT          TOO FEW PARAMETERS                   15400000
         BL    ERR1A2              YES                                  15500000
         C     REGA,MAXCT          TOO MANY PARMS                       15600000
         BH    ERR1A2              YES                                  15700000
         L     PARM,WRKPARM        START OF PARM LIST                   15800000
         L     GTMREG,GDSGTMCB     GTMCB ADDR                           15900000
         USING GTMCB,GTMREG                                             16000000
         L     REGB,GTMGSPCB       GSPCB ADDR                           16100000
         USING GSPCB,REGB                                               16200000
         LA    REGB,GSPNULLV       NULL VARIABLE                        16300000
         DROP  REGB                                                     16400000
         LR    COUNT,REGA          CT OF PARMS                          16500000
         LA    REGA,ONE                                                 16600000
         CLC   1(3,REGB),UPARM+1(PARM) UVAL MISSISN                     16700000
         BE    ERR1A               YES                                  16800000
         CLC   1(3,REGB),VPARM+1(PARM) VVAL MISSISN                     16900000
         LA    REGA,ONE(REGA)      INCR CT                              17000000
         BE    ERR1A                                                    17100000
         S     COUNT,REQCT         NO OF ADDL PARMS                     17200000
         XC    WRKADDR(LISTLEN),WRKADDR ZERO OUT DATA LIST              17300000
         MVC   WRKRTN,WRKRTNCD     MOVE IN ADDR OF RTN ARRAY            17400000
         MVC   WRKBITS(FOUR),BITS  MOVE IN DEFAULT SETTINGS             17500000
         L     REGA,UPARM(PARM)    ADDR OF U PARM                       17600000
         TM    GDSFLAGS,SUBR       IS THIS PART OF A BUFFER SUBR        17700000
         BZ    POS00023            YES                                  17800000
         OI    WRKBITS+3,MEMSUB    SET FLAG IN KEY                      17900000
         B     POS00027                                                 18000000
         EJECT                                                          18100000
POS00023 TM    GDSFLAGS,SEQ        PART OF A SEQUENCE                   18200000
         BZ    POS00025            NO                                   18300000
         OI    WRKBITS+3,MEMSEQ    YES SET FLAG IN KEY                  18400000
POS00025 TM    WRKSWTCH+3,SET      SET POSITION                         18500000
         BO    POS00330                                                 18600000
         TM    GDSDATMD,INCRU      U INCR                               18700000
         BZ    POS00200            NO                                   18800000
POS00027 MVC   WRKXINCR(FOUR),ZERO(REGA) PLACE IN ARRAY                 18900000
POS00030 L     REGA,VPARM(PARM)    ADDR OF V PARM                       19000000
         TM    WRKBITS+3,MEMSUB    IS THIS A SUBROUTINE MEMBER          19100000
         BO    POS00035            INCREMENTAL IF YES                   19200000
         TM    GDSDATMD,INCRV      V INCR                               19300000
         BZ    POS00210            NO                                   19400000
POS00035 MVC   WRKYINCR(FOUR),ZERO(REGA) PLACE IN ARRAY                 19500000
         SPACE 3                                                        19600000
*                                                                       19700000
*              THE OPTIONAL PARAMETERS ARE CHECKED NEXT. CORVAL         19800000
*              AND KEY IF PRESENT ARE PLACED IN THE KEY.  THE           19900000
*              LEVEL 2 KEY IF PASSED WILL NOT SET A FLAG IN THE         20000000
*              INPUT PARM LIST BECAUSE THE INCLUDE OMIT STRUCTURE       20100000
*              IS NOT DESIRED.                                          20200000
*                                                                       20300000
POS00040 LTR   COUNT,COUNT         ANY OPTIONAL PARMS                   20400000
         BZ    POS00100            NO                                   20500000
         CLC   1(3,REGB),CORVAL+1(PARM) CORVAL PASSED                   20600000
         BE    POS00050            NO                                   20700000
         TM    GDSFLAGS,LEVEL2     LEVEL 2                              20800000
         BO    POS00050            CORVAL ON LEVEL 2 = IGNORD           20900000
         L     REGA,CORVAL(PARM)   ADDR OF CORVAL                       21000000
         MVC   WRKCORVL(FOUR),ZERO(REGA) MOVE IN CORVAL                 21100000
         OI    WRKBITS+2,CORV      SET CORVAL SW                        21200000
POS00050 BCTR  COUNT,0             REDUCE COUNT                         21300000
         LTR   COUNT,COUNT         ALL CHECKED                          21400000
         BZ    POS00070                                                 21500000
         CLC   1(3,REGB),KEY+1(PARM) KEY PASSED     D                   21600000
         BE    POS00060                                                 21700000
         MVC   WRKKEY(FOUR),KEY(PARM) MOVE IN KEY ADDR                  21800000
         TM    GDSFLAGS,LEVEL2     LEVEL 2 KEY                          21900000
         BO    POS00060                                                 22000000
         OI    WRKBITS+2,KEYSW     SET KEY PASSED SW                    22100000
         EJECT                                                          22200000
*                                                                       22300000
*              THE GENCODE IS CHECKED.  A KEY OR CORVAL IS REQUIRED     22400000
*              FOR CODES 2 AND 3. CODE 2, OMIT, IS NOT VALID FOR        22500000
*              A LEVEL 2 GDS.  FOR UPDATE  THE FOLLOWING CONDITIONS     22600000
*              ARE CHECKED. UPDATE CANNOT BE CALLED BETWEEN BEGIN       22700000
*              AND END SUBROUTINE BECAUSE OF THE INCREMENTAL INPUT/     22800000
*              OUTPUT REQUIREMENT. IF THE UPDATE IS OF AN ELEMENT       22900000
*              WHICH IS PART OF A SUBROUTINE, THE INPUT IS EXPECTED     23000000
*              TO BE INCREMENTAL AND THE OUTPUT WILL BE INCREMENTAL.    23100000
*                                                                       23200000
POS00060 BCTR  COUNT,0             REDUCE COUNT                         23300000
         LTR   COUNT,COUNT                                              23400000
         BZ    POS00070                                                 23500000
         CLC   1(3,REGB),GENCODE+1(PARM) GENCODE PASSED                 23600000
         BE    POS00070            NO                                   23700000
         L     REGA,GENCODE(PARM)  ADDR OF GENCODE                      23800000
         L     REGA,ZERO(REGA)     LOAD CODE                            23900000
         C     REGA,ZEROFLD        CODE VALID                           24000000
         BNH   ERR1D               NO                                   24100000
         C     REGA,FOURFLD        CODE VALID                           24200000
         BNL   ERR1D               NO                                   24300000
         C     REGA,ONEFLD         INCLUDE                              24400000
         BE    POS00070                                                 24500000
         CLC   WRKCORVL(8),ZEROFLD KEY OR CORVAL                        24600000
         BZ    ERR1D                                                    24700000
         C     REGA,TWOFLD         OMIT                                 24800000
         BNE   POS00080                                                 24900000
         TM    GDSFLAGS,LEVEL2     LEVEL2                               25000000
         BO    ERR1D               OMIT INVALID FOR LEVEL 2             25100000
         NI    WRKBITS,OMIT        TURN OFF INCLUDE SW                  25200000
POS00070 TM    WRKBITS+2,CORV      CORVAL                               25300000
         BZ    POS00100                                                 25400000
         CLC   WRKCORVL(FOUR),ZEROFLD CORVAL ZERO?                      25500000
         BE    ERR1C               INVALID CORVAL                       25600000
         B     POS00100                                                 25700000
POS00080 TM    GDSFLAGS,SUBR       SUBR GEN NOW                         25800000
         BO    ERR1A2              YES, THIS CALL IS ILLOGICAL          25900000
         TM    GDSFLAGS,LEVEL2     LEVEL 2                              26000000
         BO    POS00220                                                 26100000
         TM    WRKBITS+2,KEYSW                                          26200000
         BZ    POS00230                                                 26300000
         L     REGA,KEY(PARM)      LOAD KEY ADDR                        26400000
         EJECT                                                          26500000
*//                                                                     26600000
*//      SEARCH ON KEY IN KEY TABLE                                     26700000
*//                                                                     26800000
         ST    REGA,WRKKADDR       KEY IN PARM LIST                     26900000
         ST    GDSREG,WRKGDS1      GDSCB ADDR                           27000000
         LA    REGA,TWOFLD         CODE TO SEARCH ON KEY                27100000
         ST    REGA,WRKCODE                                             27200000
POS00085 LA    PARM,WRKGDS1                                             27300000
         L     REGA,GTMGSPCB       GET POINTER TO GSPCB            000A 27400000
         L     REGA,FE(REGA)       GET POINTER TO STATUS TABLE     000A 27500000
         L     REGFIFTN,ETE(REGA)  GET A&RS OF KEY TABLE MGMT      000A 27600000
         BALR  RETURN,REGFIFTN     BRANCH TO KEY TABLE MGMT        000A 27700000
         LTR   REGFIFTN,REGFIFTN   SUCCESS                              27800000
         BNE   ERR1A2              NO                                   27900000
POS00090 MVC   WRKADDR(FOUR),ZERO(PARM) MOVE IN LOG ADDR & LEN          28000000
         OC    WRKBITS+3(1),7(PARM) PICK UP SWITCH FOR PART OF SEQ OR S 28100000
         ST    PARM,WRKKEY         SAVE ADDR OF KEY IN KEY TALE         28200000
         TM    WRKBITS+3,MEMSUB    PART OF A SUBROUTINE                 28300000
         BZ    POS00095            NO CONTINUE ON                       28400000
         XC    WRKXABS(16),WRKXABS SSET DATA ARRAY TO ZERO TO REINIT    28500000
         L     PARM,WRKPARM        RESET REG1                           28600000
         L     REGB,UPARM(PARM)    LOAC ADDR OF U                       28700000
         MVC   WRKXINCR,0(REGB)    PLACE X IN LOC FOR INCREMENTAL       28800000
         L     REGB,VPARM(PARM)    LOAD ADDR OF V                       28900000
         MVC   WRKYINCR,0(REGB)    MOVE IN Y INCREMENT                  29000000
POS00095 MVI   WRKSWTCH,UPDATE     SET UPDATE SW                        29100000
         EJECT                                                          29200000
*                                                                       29300000
*              THE OUTPUT MODE IS NEXT SET.  THE SPECIAL CASES ARE      29400000
*              HANDLED SEPARATELY.  BUFFER SUBR- OUTPUT ALWAYS          29500000
*              INCREMENTAL.   STPOS (EXCEPT IN A BUFFER SUBR)           29600000
*              ALWAYS ABSOLUTE. MVPOS SET AS PER GDSGRMOD.              29700000
*                                                                       29800000
POS00100 TM    WRKBITS+3,MEMSUB    MEMBER OF A SUBROUTINE               29900000
         BO    POS00370            YES, CHANGE SW FOR MODE              30000000
         TM    GDSCURMD,ABS        OUTPUT ABS                           30100000
         BO    POS00120            YES-ALREADY SET                      30200000
         TM    WRKSWTCH+3,SET      SETPOS YES-ABS OUTPUT                30300000
         BO    POS00120                                                 30400000
         TM    GDSCURMD,OPT        OPTIMIZE                             30500000
         BZ    POS00110            NO                                   30600000
         OI    WRKBITS,OPTIHALF    SET HALF OF OPT SW                   30700000
POS00110 OI    WRKBITS,OPTINCR     SET OTHER HALF OR INCRE SW           30800000
         SPACE 3                                                        30900000
*                                                                       31000000
*              THE BEAM POSITIONS AND SCISSOR FLAGS ARE SAVED           31100000
*              IN CASE OF FAILURE. THEN THE DATA IS SCALED.             31200000
*              THE SCALE ROUTINE WILL COMPLETE THE DATA ARRAY           31300000
*              AND SET IT UP FOR SCISSOR.                               31400000
*                                                                       31500000
POS00120 ST    GDSREG,WRKGDS                                            31600000
         MVC   WRKXCURR,GDSXCURR   SAVE GDSCB FIELDS WHICH SCALE        31700000
         MVC   WRKYCURR,GDSYCURR   AND SCISSOR MAY CHANGE SO            31800000
         MVC   WRKXLAST,GDSXLAST   THAT IN CASE OF NO GENERATION        31900000
         MVC   WRKYLAST,GDSYLAST   THEY MAY BE RESET TO WHAT THEY       32000000
         MVC   WRKSWTCH+1(ONE),GDSSCISS WERE BEFORE THE CALL            32100000
*//                                                                     32200000
*//      CALL SCALE                                                     32300000
*//                                                                     32400000
         LA    PARM,WRKGDS         PARM LIST                            32500000
         L     REGFIFTN,STAT(ERRREG) STATUS TABLE                       32600000
         L     REGFIFTN,SCALE(REGFIFTN) ADDR OF SCALE                   32700000
         BALR  RETURN,REGFIFTN                                          32800000
         LTR   REGFIFTN,REGFIFTN   SUCCESS                              32900000
         BNE   POS00180                                                 33000000
         EJECT                                                          33100000
*              IF THE NO SCISSORING OPTION IS REQUESTED THE             33200000
*              GDSXLAST, YLAST, XCURR, AND YCURR OPTIONS                33300000
*              MUST BE UPDATED AND THE LAST ON SCREEN SWITCH            33400000
*              MUST BE SET. IF IT IS A BUFFER SUBROUTINE, NO            33500000
*              SCISSORING OR FIELD UPDATE WILL TAKE PLACE.              33600000
*              ALL OTHER CASES WILL GO TO THE SCISSOR ROUTINE.          33700000
*                                                                       33800000
POS00158 TM    GDSFLAGS,SUBR                                            33900000
         BO    POS00160            SUBR NO SCISS OR PTR UPDATING        34000000
         TM    GDSSCISS,NOSCISS                                         34100000
         BO    POS00240                                                 34200000
*//                                                                     34300000
*//      CALL SCISSOR                                                   34400000
*//                                                                     34500000
         LA    PARM,WRKGDS         ADDR OF PARM LIST                    34600000
         L     REGFIFTN,STAT(ERRREG)    STATUS TABLE                    34700000
         L     REGFIFTN,SCISS(REGFIFTN) ADDR OF SCISSOR                 34800000
         BALR  RETURN,REGFIFTN                                          34900000
         LTR   REGFIFTN,REGFIFTN                                        35000000
         BNE   ERR4BTAB(REGFIFTN)      USE BRANCH TABLE            9328 35100000
*                                                                       35200000
*              THE VECTOR THAT MAY HAVE BEEN GENERATED BY               35300000
*              SCISSORING AS A POSITIONING VECTOR IS ADDED              35400000
*              TO THE ACTUAL VECTOR BECAUSE BOTH ARE BLANKED.           35500000
*              THE DATA IS THEN GENERATED.                              35600000
*                                                                       35700000
         L     REGA,WRKXINCR                                            35800000
         A     REGA,WRKDATA3       ADD TO  POSITIONING                  35900000
         ST    REGA,WRKXINCR       NEW X INCR                           36000000
         L     REGA,WRKYINCR                                            36100000
         A     REGA,WRKDATA4       ADD TO POSITIONING                   36200000
         ST    REGA,WRKYINCR       NEW Y INCR                           36300000
         XC    WRKDATA1(16),WRKDATA1 ZERO POSITIONING VECT              36400000
         SPACE 3                                                        36500000
*                                                                       36600000
*              IF UPDATE, THE UPDATE MODULE IS CALLED TO SET            36700000
*              UP THE OUTPUT AREA FOR THE NEW DATA.                     36800000
*              IF NOT, THE LOGICAL START ADDRESS IS PLACED IN           36900000
*              THE KEY.                                                 37000000
*                                                                       37100000
POS00160 CLI   WRKSWTCH,UPDATE     UPDATE                               37200000
         BE    POS00280            YES, GO TO SET UP GDOAS              37300000
         L     REGA,GDSAOACB                                            37400000
         L     REGB,CURRLOG(REGA)  LOGICAL ADDR OF START OF ELEM        37500000
         STH   REGB,WRKADDR+2      STORE IN KEY                         37600000
         EJECT                                                          37700000
POS00170 LA    PARM,WRKADDR                                             37800000
*//                                                                     37900000
*//      CALL  DATA GENERATOR                                           38000000
*//                                                                     38100000
         L     REGFIFTN,STAT(ERRREG) STATUS TABLE                       38200000
         L     REGFIFTN,DGEN(REGFIFTN) DATA GEN                         38300000
         BALR  RETURN,REGFIFTN                                          38400000
         LTR   REGFIFTN,REGFIFTN   SUCCESS?                             38500000
         BNE   ERR2A               NO ERROR CODE IN RETURN ARRAY        38600000
*                                  ALREADY SET BY ROUTINE DETECTING     38700000
*                                  ERROR. GDSCB WILL BE RESET & RETURN  38800000
*                                                                       38900000
*              AFTER GENERATION IF UPDATE THE UPDATED ELEMENT           39000000
*              IS WRITTEN OUT. OTHERWISE THE LOGICAL LENGTH             39100000
*              IS COMPUTED AND THEN THE ROUTINE KEYS IF NECESSARY       39200000
*              AND EXITS.                                               39300000
*                                                                       39400000
         CLI   WRKSWTCH,UPDATE     UPDATE?                              39500000
         BE    POS00290            YES, WRITE OUT UPDATE                39600000
         L     REGA,GDSAOACB                                       5489 39700000
         LH    REGB,WRKADDR+2                                      5489 39800000
         L     REGA,CURRLOG(REGA)                                       39900000
         SR    REGA,REGB           LENGTH OF ELEMENT                    40000000
         STH   REGA,WRKADDR        IN KEY                               40100000
         L     REGA,WRKKEY                                              40200000
         LTR   REGA,REGA           KEY DESIRED                          40300000
         BZ    POS00175            NO                                   40400000
         MVC   ZERO(FOUR,REGA),WRKADDR MOVE IN LEVEL2 KEY IN VAR        40500000
POS00175 TM    WRKBITS+2,CORKEY    KEYED OR CORRELATED LEVEL ONE        40600000
         BNE   POS00300            YES                                  40700000
POS00180 L     SAVE,FOUR(SAVE)     RESET SAVE REG                       40800000
         MVC   GDSDATMD,WRKSWTCH+2 RESET DATA MODE SWITHC               40900000
POS00190 RETURN (14,12),T          RETURN                               41000000
         EJECT                                                          41100000
POS00200 MVC   WRKXABS(FOUR),ZERO(REGA) PLACE IN ARRAY                  41200000
         B     POS00030                                                 41300000
POS00210 MVC   WRKYABS(FOUR),ZERO(REGA) PLACE IN ARRAY                  41400000
         B     POS00040                                                 41500000
POS00220 L     REGA,KEY(PARM)      LOAD KEY ADDR                        41600000
         MVC   WRKADDR(FOUR),ZERO(REGA) MOVE IN KEY                     41700000
         B     POS00095                                                 41800000
         SPACE 3                                                        41900000
POS00230 CLC   WRKCORVL(FOUR),ZEROFLD WAS CORVAL ZERO                   42000000
         BE    ERR1C               YES, ERROR                           42100000
*/                                                                      42200000
*/       SEARCH ON CORVAL                                               42300000
*/       KEY ADDR RET IN REG1                                           42400000
         LA    REGA,WRKCORVL       ADDR OF CORVAL                       42500000
         ST    REGA,WRKKADDR       IN PARM LIST                         42600000
         LA    REGA,FIVEFLD        CODE.                                42700000
         ST    REGA,WRKCODE        SEARCH                               42800000
         ST    GDSREG,WRKGDS1      GDSCB                                42900000
         B     POS00085            GO TO LINK KEY TO TBC MGT            43000000
         EJECT                                                          43100000
POS00240 L     REGA,WRKXABS                                             43200000
         ST    REGA,GDSXLAST       UPDATE GDSCB                         43300000
         SH    REGA,GDSXCURR       COMPUTE ADJUSTED INCREMENT           43400000
         ST    REGA,WRKXINCR                                            43500000
         MVC   GDSXCURR,WRKXABS+2                                       43600000
         L     REGA,WRKYABS        NEW BEAM                             43700000
         ST    REGA,GDSYLAST       POSITION                             43800000
         SH    REGA,GDSYCURR       COMPUTE ADJ INCR                     43900000
         ST    REGA,WRKYINCR                                            44000000
         MVC   GDSYCURR,WRKYABS+2                                       44100000
         NI    GDSSCISS,LASTON     SET SCISSOR FLAGS TO LAST ON SCREEN  44200000
         B     POS00160                                                 44300000
         SPACE 3                                                        44400000
POS00280 LA    PARM,WRKADDR        PARM LIST                            44500000
         L     REGFIFTN,STAT(ERRREG) POINT TO STATUS TABLE  D11 ZA15418 44600000
         L     REGFIFTN,UPDH13(REGFIFTN) AND TO IFFAHA13    D11 ZA15418 44700000
         BALR  RETURN,REGFIFTN         GOTO IFFAHA13        D11 ZA15418 44800000
*//                                                                     44900000
*//      CALL UPDATE FOR UPDATE GDOAS                                   45000000
*//IFFAHA13 CALLED VIA GSP LOGIC TO MINIMIZE SYS OVRHD      D11 ZA15418 45100000
         LTR   REGFIFTN,REGFIFTN   SUCCESS                              45200000
         BNE   POS00180            NO                                   45300000
         B     POS00170                                                 45400000
         EJECT                                                          45500000
POS00290 LA    PARM,WRKADDR        PARM LIST                            45600000
         L     REGFIFTN,STAT(ERRREG) POINT TO STATUS TABLE  D11 ZA15418 45700000
         L     REGFIFTN,UPDH14(REGFIFTN) AND TO IFFAHA14    D11 ZA15418 45800000
         BALR  RETURN,REGFIFTN     GOTO IFFAHA14            D11 ZA15418 45900000
*//                                                                     46000000
*//      CALL UPDATE TO WRITE OUT UPDATED DATA                          46100000
*// IFFAHA14 IS CALLED VIA GSP LOGIC TO MINIMIZE SYS OVRHD  D11 ZA15418 46200000
         TM    GDSFLAGS,LEVEL2                                          46300000
         BO    POS00180                                                 46400000
         L     REGA,WRKKEY                                              46500000
         MVC   0(8,REGA),WRKADDR   REPLACE KEY                          46600000
         TM    WRKBITS+2,CORV      IS IT CORRELATED                     46700000
         BZ    POS00180            NO EXIT                              46800000
         L     REGA,WRKKEY         LOAD ADDR OF KEY IN KEY TBLE         46900000
         MVC   8(4,REGA),WRKCORVL  REPLACE VORVAL IN KEY BALE           47000000
         B     POS00180                                                 47100000
         SPACE 3                                                        47200000
POS00300 ST    GDSREG,WRKGDS1      GDSCB FOR KEY TABLE MGT              47300000
         LA    REGA,ONEFLD         CODE                                 47400000
         ST    REGA,WRKCODE                                             47500000
         LA    REGA,WRKADDR        KEY ADDR                             47600000
         ST    REGA,WRKKADDR       IN PARM LIST                         47700000
         LA    PARM,WRKGDS1                                             47800000
*//      CALL KEY TABLE TO ADD KEY                                      47900000
         L     REGFIFTN,GDSGTMCB  GET ADDR OF GTMCB         E12 ZA28573 47910000
         L     REGFIFTN,4(REGFIFTN) POINTER TO GSPCB        E12 ZA28573 47920000
         L     REGFIFTN,FE(REGFIFTN) STAT TBL ADDR          E12 ZA28573 47930000
         L     REGFIFTN,ETE(REGFIFTN) ADDR OF KEY TBL MGR   E12 ZA28573 47940000
         LTR   REGFIFTN,REGFIFTN  LOADED YET?               E12 ZA28573 47950000
         BZ    POSLINK            NO USE LINK               E12 ZA28573 47960000
         BALR  RETURN,REGFIFTN    BRANCH TO KEY TABLE MGR   E12 ZA28573 47970000
         B     POSRTN             CONTINUE AFTER LINK       E12 ZA28573 47980000
POSLINK  L     REGD,16             ADDR OF CVT              E12 ZA28573 48000000
         L     REGD,CVTLINK(REGD)  LINK LIBRARY DCB                     48100000
         LINK  EP=IFFAHA03,MF=(E,(1)),SF=(E,WRKSPVSR)                   48200000
POSRTN   LTR   REGFIFTN,REGFIFTN   SUCCESSFUL               E12 ZA28573 48300000
         BNE   ERR3                NO                                   48400000
         B     POS00180                                                 48500000
         EJECT                                                          48600000
POS00310 OI    GDSDATMD,XRELINC    SET SW X REAL INCREMENTAL            48700000
         B     POS00380                                                 48800000
POS00320 OI    GDSDATMD,YRELINC    SET SW Y REAL INCRE                  48900000
         B     POS00110                                                 49000000
         SPACE                                                          49100000
POS00330 NI    GDSDATMD,ZERO       ZERO SWITCH FOR RESET                49200000
         TM    WRKSWTCH+2,REALX    IS REAL THE X                        49300000
         BM    POS00350            YES                                  49400000
         OI    GDSDATMD,XINTABS    SET X INTEGER ABSOLUTE               49500000
POS00340 TM    WRKSWTCH+2,REALY    IS Y REAL                            49600000
         BM    POS00360            YES                                  49700000
         OI    GDSDATMD,YINTABS    SET Y INTEGER ABSOLUTE               49800000
         B     POS00200                                                 49900000
         SPACE                                                          50000000
POS00350 OI    GDSDATMD,XRELABS    SET X REAL ABSOLUTE                  50100000
         B     POS00340                                                 50200000
POS00360 OI    GDSDATMD,YRELABS    SET Y REAL ABSOLUTE                  50300000
         B     POS00200                                                 50400000
         SPACE                                                          50500000
POS00370 NI    GDSDATMD,ZERO       SET SW TO ZERO FOR TEMP RESET        50600000
         TM    WRKSWTCH+2,REALX    IS X REAL                            50700000
         BM    POS00310            YES                                  50800000
         OI    GDSDATMD,XINTINC    SET SW X INTEGER INCRE               50900000
POS00380 TM    WRKSWTCH+2,REALY    IS Y REAL                            51000000
         BM    POS00320            YES                                  51100000
         OI    GDSDATMD,YINTINC    SET SW Y INTEGER  INCREMENTAL        51200000
         B     POS00110                                                 51300000
         EJECT                                                          51400000
ERR1     MVI   PARMERR+3(ERRREG),BADGDS GDSCB ERROR                     51500000
         B     ERR1A2                                                   51600000
ERR1A    LA    REGA,ONE(REGA)      PARM BAD IN REGA ACTUALLY ONE LESS   51700000
ERR1A1   ST    REGA,PARMERR(ERRREG) STORE PARM ERROR                    51800000
ERR1A2   MVI   RTNCODE(ERRREG),PARMSW  SET ERROR SW                     51900000
         B     POS00180                                                 52000000
ERR1B    L     REGA,MAXCT          MAXCT - TOO MANY GO TO ADD ONE TO IT 52100000
         B     ERR1A                                                    52200000
ERR1C    LA    REGA,CORNO                                               52300000
         B     ERR1A1                                                   52400000
ERR1D    LA    REGA,GENNO                                               52500000
         B     ERR1A1                                                   52600000
         SPACE 3                                                        52700000
ERR2A    MVC   GDSXLAST,WRKXLAST        RESET GDSCB                     52800000
         MVC   GDSYLAST,WRKYLAST        TO CONDITION                    52900000
         MVC   GDSXCURR,WRKXCURR        BEFORE CALL                     53000000
         MVC   GDSYCURR,WRKYCURR                                        53100000
         MVC   GDSSCISS(ONE),WRKSWTCH+1                                 53200000
         TM    WRKSWTCH,UPDATE     UPDATE                               53300000
         BO    POS00180            YES NO RESET REQUIRED                53400000
*//                                                                     53500000
*//      RESET TO KEY                                                   53600000
*//                                                                     53700000
         MVC   WRKDATA2(20),0(ERRREG) SAVE RETURN ARRAY                 53800000
         LA    REGA,GDSGDSCB       VAR CONTAINING ADDR OF GDS           53900000
         ST    REGA,WRKGDS         IN PARAMETER LIST                    54000000
         L     REGA,NULL(ERRREG)   NULL FOR CORVAL                      54100000
         ST    REGA,WRKRTN         IN PARM LIST                         54200000
         LA    REGA,WRKADDR        ADDRESS OF KEY                       54300000
         ST    REGA,WRKDATA1       IN PARAMETER LIST                    54400000
         OI    WRKDATA1,LAST       LAST PARM SW                         54500000
         LA    REGA,WRKGDS         ADDR OF PARM LIST                    54600000
         ST    REGA,WRKGDS1        IN WORK AREA                         54700000
         ST    ERRREG,WRKCODE      ERROR CODE IN PARM LIST              54800000
         LA    PARM,WRKGDS1        ADDR OF WRK AREA IN R1               54900000
         LINK  EP=IFFAFA12,MF=(E,(1)),SF=(E,WRKSPVSR)                   55000000
*        LINK TO RESET ROUTINE                                          55100000
         MVC   0(20,ERRREG),WRKDATA2                                    55200000
*        RESET RETURN ARRAY                                             55300000
         B     POS00180                                                 55400000
         EJECT                                                          55500000
ERR3     OI    RTNCODE(ERRREG),STRG                                     55600000
         MVC   STOR(4,ERRREG),FOURFLD                                   55700000
ERR4BTAB B     ERR2A              STORAGE EXCEEDED                 9328 55800000
         B     POS00180      RC=4, NO ORDERS TO GEN, RETURN NORM   9328 55900000
         LH    REGA,WRKXCURR RC=8, STPOS SCISSORED. USE CURRENT    9328 56000000
         ST    REGA,WRKXABS        LOCATION TO ESTABLISH BEAM POS  9328 56100000
         LH    REGA,WRKYCURR       SO INCREMENTAL ORDERS HAVE A    9328 56200000
         ST    REGA,WRKYABS        VALID STARTING POINT.           9328 56300000
         B     POS00160      BACK TO MAINLINE FOR ORDER GEN        9328 56400000
         EJECT                                                          56500000
*        REGISTERS                                                      56600000
REGZERO  EQU   0                   ZERO                                 56700000
PARM     EQU   1                   PARAMETER                            56800000
REGA     EQU   2                   GEN                                  56900000
REGB     EQU   3                   GEN                                  57000000
COUNT    EQU   4                   PARM COUNT                           57100000
WORK     EQU   5                   WORK AREA                            57200000
ERRREG   EQU   6                                                        57300000
GTMREG   EQU   7                   GTMCB                                57400000
GDSREG   EQU   8                   GDSCB                                57500000
BASE     EQU   9                   BASE REG                             57600000
REGC     EQU   10                  GEN                                  57700000
REGD     EQU   11                  GEN                                  57800000
SAVE     EQU   13                  SAVE AREA                            57900000
RETURN   EQU   14                  RETURN                               58000000
REGFIFTN EQU   15                  RTN CODE                             58100000
         EJECT                                                          58200000
*        CONSTANTS                                                      58300000
ENTRYADD DC    A(IFFAFA17)                                              58400000
BITS     DC    B'00000100'         SINGLE,VECTOR,INCLUDE,ABSOLUTE       58500000
         DC    X'00'               RESERVED                             58600000
         DC    B'00000100'         FIRST PASS,NO KEY-CORVAL-UPDATE-REPO 58700000
         DC    X'00'               RESERVED                             58800000
ZEROFLD  DC    2F'0'                                                    58900000
ONEFLD   DC    F'1'                                                     59000000
TWOFLD   DC    F'2'                                                     59100000
FOURFLD  DC    F'4'                                                     59200000
FIVEFLD  DC    F'5'                                                     59300000
REQCT    DC    F'2'                                                     59400000
MAXCT    DC    F'5'                                                     59500000
PATCH    DC    64X'FF'             PATCH AREA               D11         59600000
         EJECT                                                          59700000
*        DISPLACEMENTS                                                  59800000
GDSPARM  EQU   0                   GDSCB PARM                           59900000
UPARM    EQU   4                   UVAL PARM                            60000000
VPARM    EQU   8                   VVAL PARM                            60100000
CORVAL   EQU   12                  CORVAL PARM                          60200000
KEY      EQU   16                  KEY PARM                             60300000
GENCODE  EQU   20                  GENCODE PARM                         60400000
ZERO     EQU   0                                                        60500000
GDSIDSW  EQU   3                   SETTING TO SAY GDSCB IS VALID        60600000
EIGHT    EQU   8                                                        60700000
LSTPARM  EQU   X'80'               SETTING ON LAST PARAMETER            60800000
ONE      EQU   1                                                        60900000
FOUR     EQU   4                                                        61000000
INCRU    EQU   X'50'               DATA MODE U INCR SW                  61100000
SET      EQU   2                   SETPOS SW                            61200000
INCRV    EQU   X'05'               DATA MODE V INCR SW                  61300000
LEVEL2   EQU   X'10'               LEVEL 2 IN GDSFLAGS                  61400000
CORV     EQU   X'10'               CORVAL SW IN KEY                     61500000
KEYSW    EQU   X'20'               KEY SW IN KEY                        61600000
CORKEY   EQU   X'30'               CORVAL OR KEY IN KEY                 61700000
OMIT     EQU   X'FB'               OMIT SW TO TURN OFF INCLUDE FLAG     61800000
ABS      EQU   X'02'               GRAPHIC MODE ABS                     61900000
OPT      EQU   X'04'               GRAPHIC MODE OPT                     62000000
OPTIHALF EQU   X'02'               HALF OF OPT SW IN KEY                62100000
OPTINCR  EQU   X'01'               OTHER HALF OR INCR SW                62200000
SCALERQD EQU   X'40'               SCALE RQD SW                         62300000
FLOATX   EQU   X'C0'               X INPUT FLOAT                        62400000
FLOATY   EQU   X'0C'               Y INPUT FLOAT                        62500000
NOSCISS  EQU   X'10'               NO SCISSOR                           62600000
UPDATE   EQU   X'FF'               UPDATE IN WORK FLAGS                 62700000
PARMERR  EQU   16                  PARM ERROR IN RET ARRAY              62800000
RTNCODE  EQU   0                   RETURN CODE IN ARRAY                 62900000
BADGDS   EQU   1                   GDS IN ERROR                         63000000
CORNO    EQU   4                   CORVAL PARM NUMBER                   63100000
GENNO    EQU   6                   GENCODE PARM NUMBER                  63200000
PARMSW   EQU   X'08'               SW TO SAY PARM ERROR RETURN CODE     63300000
LISTLEN  EQU   68                  LENGTH OF PARM LIST FOR DATA GEN     63400000
LASTON   EQU   X'1F'               TURNS OFF SCISSOR FLAGS TO SAY LAST  63500000
*                                  BEAM ON                              63600000
CURRLOG  EQU   52                                                       63700000
SUBR     EQU   X'02'                                                    63800000
STRG     EQU   X'10'                                                    63900000
STOR     EQU   12                                                       64000000
SEQ      EQU   X'04'                                                    64100000
MEMSUB   EQU   X'80'                                                    64200000
MEMSEQ   EQU   X'40'                                                    64300000
EVENFOUR EQU   X'FC'                                                    64400000
NULL     EQU   20                                                       64500000
STAT     EQU   24                                                       64600000
DGEN     EQU   840                                                      64700000
SCISS    EQU   876                                                      64800000
SCALE    EQU   864                                                      64900000
UPDH13   EQU   936                 STATAB DISPL IFFAHA13    D11 ZA15418 65000000
UPDH14   EQU   948                 STATAB DISPL IFFAHA14    D11 ZA15418 65100000
CVTLINK  EQU   8                                                        65200000
REALX    EQU   X'C0'                                                    65300000
REALY    EQU   X'0C'                                                    65400000
XINTINC  EQU   X'10'                                                    65500000
YINTINC  EQU   X'01'                                                    65600000
XRELINC  EQU   X'40'                                                    65700000
YRELINC  EQU   X'04'                                                    65800000
XINTABS  EQU   X'20'                                                    65900000
YINTABS  EQU   X'02'                                                    66000000
XRELABS  EQU   X'80'                                                    66100000
YRELABS  EQU   X'08'                                                    66200000
LAST     EQU   X'80'                                                    66300000
FE       EQU   48                                                  000A 66400000
ETE      EQU   828                                                 000A 66500000
         EJECT                                                          66600000
*        WORK AREA                                                      66700000
WORKAREA DSECT                                                          66800000
WRKPARM  DS    F                                                        66900000
WRKRTNCD DS    F                                                        67000000
WRKSWTCH DS    F                                                        67100000
WRKSPVSR DS    3F                                                       67200000
WRKSAVE  DS    18F                                                      67300000
WRKXCURR DS    H                                                        67400000
WRKYCURR DS    H                                                        67500000
WRKXLAST DS    F                                                        67600000
WRKYLAST DS    F                                                        67700000
WRKKEYAD DS    F                                                        67800000
WRKADDR  DS    F                                                        67900000
WRKBITS  DS    F                                                        68000000
WRKCORVL DS    F                                                        68100000
WRKKEY   DS    F                                                        68200000
WRKGDS   DS    F                                                        68300000
WRKRTN   DS    F                                                        68400000
WRKDATA1 DS    F                                                        68500000
WRKDATA2 DS    F                                                        68600000
WRKDATA3 DS    F                                                        68700000
WRKDATA4 DS    F                                                        68800000
WRKXABS  DS    F                                                        68900000
WRKYABS  DS    F                                                        69000000
WRKXINCR DS    F                                                        69100000
WRKYINCR DS    F                                                        69200000
WRKNTUSD DS    2F                                                       69300000
WRKENTCT DS    F                                                        69400000
WRKGDS1  DS    F                                                        69500000
WRKCODE  DS    F                                                        69600000
WRKKADDR DS    F                                                        69700000
         COPY  GSPCB                                                    69800000
         COPY  GTMCB                                                    69900000
         COPY  GDSCB                                                    70000000
         END                                                            70100000
./  ADD  SSI=20480141,NAME=IFFAFA05
*TITLE         BGSEQ/BGSUB                                              00200021
*                                                                       00400021
*ENTRY POINT   IFFAFA05/IFFAFA18                                        00600021
*                                                                       00800021
*INPUT         IN REGISTER 1 THE ADDRESS OF A WORK AREA                 01000021
*                 IN THE FIRST WORD OF THE WORK AREA THE ADDRESS OF A   01200021
*                 VARIABLE LENGTH PARAMETER LIST.                       01400021
*                    +0  A(GDSCB)                                       01600021
*                    +4  A(CORRVAL)    OPTIONAL   EITHER CORRVAL OR     01800021
*                    +8  A(KEY)        OPTIONAL   KEY MUST BE SPECIFIED 02000021
*                    +12 A(GENCODE)    OPTIONAL   CANNOT BE 3           02200021
*                                                                       02400021
*OUTPUT        A KEY IF THE KEY PARAMETE WAS SPECIFIED. NOTE THAT THIS  02600021
*              KEY IS VALID ONLY UNTIL ENSEQ IS CALLED.                 02800021
*                                                                       03000021
*FUNCTION      TO CREATE THE STRUCTURE NECESSARY TO FORM SUCCEEDING     03200021
*              ELEMENTS INTO A SEQUENCE, A SEQUENCE IS A GROUP OF       03400021
*              ELEMENTS IDENTIFIABLE AS AN ENTITY. ALL ELEMENTS CREATED 03600021
*              BETWEEN THE CALLS TO BGSEQ AND ENSEQ (FOR THE SAME GDS)  03800021
*              FORM THE SEQUENCE.                                       04000021
*                                                                       04200021
*EXIT          TO CALLER WITH RETURN ARRAY SET                          04400021
*                                                                       04600021
         EJECT                                                          04800021
IFFAFA05 CSECT                                                          05000021
*2023,538000,542000,546000-556000                                  000A 05100021
*                                                                       05200021
*ENTRY TO BGSEQ. SAVE REGISTERS AND SET SWITCH TO REMEMBER ENTRY POINT. 05400021
*                                                                       05600021
         ENTRY IFFAFA18                                                 05800021
         USING *,R15                                                    06000021
         SAVE  (14,12)                                                  06200021
         SR    R0,R0                   INDICATE ENTRY AT BEGSEQ         06400021
         B     BEGLPB2                                                  06600021
         DROP  R15                                                      06800021
*                                                                       07000021
*ENTRY TO BGSUB. SAVE REGISTERS AND SET SWITCH TO REMEMBER ENTRY POINT. 07200021
*                                                                       07400021
         USING *,R15                                                    07600021
IFFAFA18 SAVE  (14,12)                                                  07800021
         LA    R0,N1                   INDICATE ENTRY AT BEGSUB         08000021
         DROP  R15                                                      08200021
*                                                                       08400021
*PERFORM NORMAL HOUSEKEEPING AND INITIALIZATION FUNCTIONS - CHAIN SAVE  08600021
*AREAS, ESTABLISH ADDRESSABILITIES, ZERO FIELDS, ETC.                   08800021
*                                                                       09000021
BEGLPB2  BALR  R9,R0                                                    09200021
         USING *,R9                                                     09400021
         L     R2,N0(R1)               GET PLIST ADDR                   09600021
         L     R3,N4(R1)               GET GSPARRAY ADDR                09800021
         LA    R10,0(R1)               GET WORK AREA ADDR               10000021
         USING BEGWRK,R10              WORK AREA ADDRESSABILITY         10200021
         ST    R13,BEGSAVE+4           CHAIN SAVE AREAS                 10400021
         LA    R4,BEGSAVE                                               10600021
         ST    R4,N8(R13)                                               10800021
         LR    R13,R4                  SET SAVE AREA REG                11000021
         L     R8,N0(R2)               GET GDSCB PTR                    11200021
         L     R8,N0(R8)               GET GDSCB ADDR                   11400021
         USING GDSCB,R8                                                 11600021
         L     R7,GDSGTMCB             GET GTMCB ADDR                   11800021
         USING GTMCB,R7                GTMCB ADDRESSABILITY             12000021
         XC    KEY(N12),KEY            ZERO KEY                         12200021
         XC    N0(N20,R3),N0(R3)       ZERO GSPARRAY                    12400021
         XC    GDSKEYSV(2),GDSKEYSV    ZERO KEYSV AREA IN GDSCB         12600021
         XC    PARMS(16),PARMS         ZERO NEW PARAMETER LIST          12800021
         NI    GDSGRMOD,X'00'          SET CURRENT MODE DEVICE FLAG     13000021
*                                                                       13200021
*TEST FOR CONTROL BLOCK VALIDITY. IF GDS IS UNOPEN OR INVALID THE       13400021
*GSPARRAY IS SET TO INDICATE THE ERROR.                                 13600021
*                                                                       13800021
         CLC   GDSVALID(2),GDSID       IS GDS VALID                     14000021
         BE    BEGLPD2                 YES                              14200021
         MVI   19(R3),X'01'            ERROR - GDS NOT OPEN             14400021
BEGLPC3  MVI   N0(R3),X'08'            INDICATE PARAM ERROR             14600021
         B     BEGPGF3B                                                 14800021
*                                                                       15000021
*A SEQUENCE/SUBROUTINE CAN NOT APPEAR WITHIN ANOTHER SEQUENCE OR        15200021
*SUBROUTINE. TEST FOR AN ATTEMPT TO NEST SEQUENCES/SUBROUTINES. IF A    15400021
*PREVIOUS SEQUENCE OR SUBROUTINE HAS BEEN STARTED BUT NOT ENDED SET     15600021
*THE GSPARRAY TO INDICATE THE ERROR.                                    15800021
*                                                                       16000021
BEGLPD2  TM    GDSFLAGS,X'06'          HAS A SEQ/SUBRTN BEEN BEGUN      16200021
         BC    5,BEGLPC3               YES                              16400021
*                                                                       16600021
*A SUBROUTINE IS VALID ONLY WITH A 2250 MOD 3. IF BGSUB WAS CALLED AND  16800021
*A MOD 3 HAS NOT BEEN INDICATED THE GSPARRAY IS SET TO INDICATE THE     17000021
*ERROR.                                                                 17200021
*                                                                       17400021
BEGLPE2  LTR   R0,R0                   WAS BEGSUB CALLED                17600021
         BZ    BEGLPF2                 NO                               17800021
         TM    GTMFEATS,X'03'          WAS MOD 3 SPECIFIED              18000021
         BM    BEGLPC3                 NO                               18200021
         OI    GDSFLAGS,X'02'          INDICATE SUBRTN BEGUN            18260021
         B     BEGLPH2                                                  18320021
*                                                                       20400021
*A SEQUENCE IS NOT VALID UNDER LEVEL 2 SUPPORT. IF SEQUENCE, LEVEL 2    20600021
*THE GSPARRAY IS SET TO INDICATE THE ERROR.                             20800021
*                                                                       21000021
BEGLPF2  TM    GDSFLAGS,X'10'          WAS LEVEL 2 SUPPORT REQUESTED    21200021
         BO    BEGLPC3                 YES                              21400021
         OI    GDSFLAGS,X'04'          INDICATE SEQUENCE BEGUN          21600021
*                                                                       21800021
*REFORM PARAMETER LIST - UNUSED PARAMETERS BECOME ZERO                  22000021
*                                                                       22200021
BEGLPH2  LA    R5,PARMS                GET NEW PLIST ADDR               22400021
BEGLPH2A TM    0(R2),X'80'             HAS LAST PARAM BEEN CHECKED      22600021
         BO    BEGLPH2C                                                 22800021
         CLC   0(4,R2),20(R3)          HAS NULL VAR REPLACED PARAM      23000021
         BE    BEGLPH2B                YES                              23200021
         MVC   0(4,R5),0(R2)           TRANSFER PARAMETER               23400021
BEGLPH2B AH    R2,C4                   INCREMENT PLIST POINTERS         23600021
         AH    R5,C4                                                    23800021
         B     BEGLPH2A                                                 24000021
BEGLPH2C CLC   1(3,R2),21(R3)          HAS NULL VAR REPLACED PARAM      24200021
         BE    BEGLPH3                 YES                              24400021
         MVC   1(3,R5),1(R2)           TRANSFER PARAMETER               24600021
*                                                                       26600021
*IF THE SEQUENCE OR SUBROUTINE IS CORRELATED PUT THE CORRELATION VALUE  26800021
*IN THE KEY.                                                            27000021
*                                                                       27200021
BEGLPH3  CLC   PARMS+4(4),ZERO         WAS CORVAL SPECIFIED             27600021
         BNE   BEGLQC3                 YES                              28000021
         OI    GDSFLAGS,X'40'          INDICATE BGSEQ/BGSUB NOT CORLATD 28200021
         B     BEGLQE3                                                  28600021
BEGLQC3  L     R4,PARMS+4              GET CORVAL ADDR                  31800021
         L     R5,0(R4)                GET CORVAL                       32000021
         ST    R5,KEY+8                PUT CORVAL IN KEY                32200021
BEGLQE3  LA    R4,KEY                  GET KEY ADDR                     32400021
         ST    R4,KEYPARMS+8           PUT KEY ADDR IN KEY TBL PLIST    32600021
*                                                                       32800021
*SET KEY FLAGS TO INDICATE MULTIPLE ELEMENTS AND TEST GENCODE FOR       33000021
*INCLUDE OR OMIT STATUS.                                                33200021
*                                                                       33400021
         OI    KEY+4,X'80'             INDICATE MULTIPLE                33600021
         CLC   PARMS+12(4),ZERO        WAS A GENCODE SPECIFIED          33800021
         BE    BEGLQH2                 NO                               34000021
         L     R5,PARMS+12             GET GENCODE ADDR                 34200021
         L     R5,N0(R5)               GET GENCODE                      34400021
         CH    R5,C2                   IS OMIT STATUS REQUESTED         34600021
         BE    BEGLQG4                 YES                              34800021
         CH    R5,C1                   IS INCLUDE STATUS REQUESTED      35000021
         BNE   BEGLPC3                 NO                               35200021
BEGLQH2  OI    KEY+4,X'04'             SET KEY FLAG TO INDICATE INCLUDE 35400021
         B     BEGLQJ4                                                  35600021
*                                                                       35800021
*UNDER LEVEL 2 A SUBROUTINE MUST BE GENERATED IN INCLUDE STATUS.        36000021
*OTHERWISE THE GSPARRAY IS SET TO INDICATE THE ERROR.                   36200021
*                                                                       36400021
BEGLQG4  TM    GDSFLAGS,X'10'          WAS LEVEL 2 SUPPORT REQUESTED    36600021
         BO    BEGLPC3                 YES                              36800021
         NI    KEY+4,X'FB'             SET KEY FLAG TO INDICATE OMIT    37000021
BEGLQJ4  LTR   R0,R0                   WAS BEGSEQ CALLED                37200021
         BZ    BEGPGB1                 YES                              37400021
*                                                                       37600021
*CONSTRUCT ORDERS NEEDED TO FORM A BUFFER SUBROUTINE.                   37800021
*                                                                       38000021
         MVC   DATSTOR+8(18),SUBCONST  START DATA STORE PLIST           38200021
         TM    KEY+4,X'04'             IS INCLUDE STATUS REQUESTED      38400021
         BO    BEGPGA2                 YES                              38600021
         LH    R4,GTRU                                                  38800021
         STH   R4,DATSTOR+20                                            39000021
         B     BEGPGD2                                                  39200021
BEGPGA2  LH    R4,GNOP4                                                 39400021
         STH   R4,DATSTOR+20           CHANGE GTRU TO GNOP              39600021
         B     BEGPGD2                                                  39800021
*                                                                       40000021
*CONSTRUCT ORDERS NEEDED TO FORM A SEQUENCE.                            40200021
*                                                                       40400021
BEGPGB1  MVC   DATSTOR+8(N8),SEQCONST  START DATA STORE PLIST           40600021
         TM    N4(R4),X'04'            IS INCLUDE STATUS REQUESTED      40800021
         BO    BEGPGB2                 YES                              41000021
         LH    R4,GTRU                                                  41200021
         STH   R4,DATSTOR+12                                            41400021
         B     BEGPGD2                                                  41600021
BEGPGB2  LH    R4,GNOP4                                                 41800021
         LH    R4,GNOP4                                                 42000021
         STH   R4,DATSTOR+12           CHANGE GTRU TO GNOP              42200021
*                                                                       42400021
*BUILD DATA STORE PARAMETER LIST                                        42600021
*                                                                       42800021
BEGPGD2  ST    R8,DATSTOR              COMPLETE DATA STORE PLIST        43000021
         ST    R3,DATSTOR+4                                             43200021
         MVC   DATSTOR+14(2),GDSOVDAT+2  TRANSFER TO FLOW CONTROL       43400021
*                                                                       43600021
*INVOKE DATA STORE. THE DATA STORE ROUTINE IS USED TO PUT THE SEQUENCE  43800021
*OR SUBROUTINE STRUCTURE IN THE GDOA.                                   44000021
*                                                                       44200021
         L     R5,N24(R3)              GET STATUS TABLE ADDR            44400021
         L     R15,DATDISP(R5)         GET RTN EP ADDR                  44600021
         LA    R1,DATSTOR              GET PLIST ADDR                   44800021
         BALR  R14,R15                 LINK WITH DATA STORE RTN         45000021
         LTR   R15,R15                 WAS DATA STORE SUCCESSFUL        45200021
         BP    BEGPGF3B                NO                               45400021
*                                                                       45600021
*SETUP TEMPORARY KEY FOR USE UNTIL ENSEQ IS CALLED.                     45800021
*                                                                       46000021
         LTR   R0,R0                   WAS BGSUB CALLED                 46200021
         BZ    BEGPGD2A                NO                               46400021
         LA    R5,14                   LENGTH OF SUBRTN STRUCTURE       46600021
         B     BEGPGD2B                                                 46800021
BEGPGD2A LA    R5,4                    LENGTH OF SEQUENCE STRUCTURE     47000021
BEGPGD2B L     R4,GDSAOACB             GET OACB ADDR                    47200021
         L     R4,52(R4)               GET LOG ORDER LOAD POINT         47400021
         SR    R4,R5                   COMPUTE LOG BFR START ADDR       47600021
         STH   R4,KEY+2                PUT LOG BFR START ADDR IN KEY    47800021
         STH   R4,GDSKEYSV             PUT LOG BFR START ADDR IN GDSCB  48000021
         SR    R4,R4                                                    48200021
         STH   R4,KEY                  SETUP DUMMY KEY                  48400021
*                                                                       48600021
*SET KEY FLAG TO INDICATE SEQUENCE OR SUBROUTINE                        48800021
*                                                                       49000021
         OI    KEY+4,X'80'             SET KEY LAG TO MULTIPLE          49200021
         LTR   R0,R0                   WAS BEGSEQ CALLED                49400021
         BZ    BEGPGE2A                YES                              49600021
         OI    KEY+4,X'28'             SET KEY FLAG TO BFR SUBRTN       49800021
         B     BEGPGF2                                                  50000021
BEGPGE2A OI    KEY+4,X'20'             SET KEY FLAG TO SEQUENCE         50200021
*                                                                       50400021
*IF LEVEL 2 KEYS ARE NOT MAINTAINED BY GSP.                             50600021
*                                                                       50800021
BEGPGF2  TM    GDSFLAGS,X'10'          WAS LEVEL 2 SUPPORT REQUESTED    51000021
         BO    BEGPGF3A                YES                              51200021
*                                                                       51400021
*BUILD KEY TABLE MANAGEMENT PARAMETER LIST.                             51600021
*                                                                       51800021
         ST    R8,KEYPARMS             PUT GDSCB ADDR IN KEY TBL PLIST  52000021
         LA    R4,KEYCODE1                                              52200021
         ST    R4,KEYPARMS+4           PUT CODE ADDR IN KEY TBL PLIST   52400021
*                                                                       52600021
*INVOKE KEY TABLE MGMT                                                  52800021
*                                                                       53000021
         L     R4,N24(R3)              GET STATUS TABLE ADDR            53200021
         L     R15,KEYDISP(R4)         GET RTN EP ADDR                  53400021
         LTR   R15,R15                 IS RTN IN CORE                   53600021
         BZ    BEGLPC3             NO-ERROR                        000A 53800021
BEGPGG2A LA    R1,KEYPARMS             GET KEY TBL MGMT PLIST           54000021
         BALR  R14,R15             BRANCH TO KEY TABLE MGMT        000A 54200021
         B     BEGPGG2D                                                 54400021
BEGPGG2D LTR   R15,R15                 WAS KEY TBL MGMT SUCCESSFUL      55800021
         BP    BEGPGG2E                NO                               56000021
*                                                                       56200021
*IF KEY PARAMETER WAS SPECIFIED RETURN KEY TO USER, OTHERWISE JUST      56400021
*RETURN.                                                                56600021
BEGPGF3A CLC   PARMS+8(4),ZERO         WAS KEY SPECIFIED                56800021
         BE    BEGPGF3                 NO                               57000021
         L     R4,PARMS+8              GET KEY RETURN WORD ADDR         57200021
         MVC   0(4,R4),KEY             RETURN KEY                       57400021
         B     BEGPGF3                                                  57600021
BEGPGG2E LA    R4,2                                                     57800021
         ST    R4,N16(R3)              ERROR - KEY NOT ADDED            58000021
BEGPGF3B NI    GDSFLAGS,X'B9'          ERROR RETUEN - RESET SWITCHES    58200021
BEGPGF3  L     R13,BEGSAVE+4                                            58400021
         RETURN (14,12),T                                               58600021
*                                                                       58800021
*CONSTANTS AND WORK AREAS                                               59000021
*                                                                       59200021
SUBCONST DC    X'1400000E'                                              59400021
         GINIT                                                          59600021
         GTRU  0                                                        59800021
         GTRU  0                                                        60000021
         GTRU  0                                                        60200021
         GDRD                                                           60400021
SEQCONST DC    X'01000004'                                              60600021
         GINIT                                                          60800021
         GTRU  0                                                        61000021
N0       EQU   0                                                        61200021
N1       EQU   1                                                        61400021
N2       EQU   2                                                        61600021
N3       EQU   3                                                        61800021
N4       EQU   4                                                        62000021
N5       EQU   5                                                        62200021
N8       EQU   8                                                        62400021
N9       EQU   9                                                        62600021
N12      EQU   12                                                       62800021
N13      EQU   13                                                       63000021
N16      EQU   16                                                       63200021
N20      EQU   20                                                       63400021
N21      EQU   21                                                       63600021
N24      EQU   24                                                       63800021
DATDISP  EQU   852                                                      64000021
KEYDISP  EQU   828                                                      64200021
CVTLINK  EQU   8                                                        64400021
ZERO     DC    F'0'                                                     64600021
KEYCODE1 DC    F'1'                                                     64800021
C4       DC    H'4'                                                     65000021
GDSID    DC    X'F203'                                                  65200021
GNOP4    DC    X'2AC0'                                                  65400021
GTRU     DC    X'2AFF'                                                  65600021
C1       DC    H'1'                                                     65800021
C2       DC    H'2'                                                     66000021
BEGWRK   DSECT                                                          66200021
BEGSAVE  DS    18F                                                      66400021
PARMS    DS    4F                                                       66600021
KEYPARMS DS    10F                                                      66800021
KEY      DS    3F                                                       67000021
SUPPLIST DS    12F                                                      67200021
DATSTOR  DS    12F                                                      67400021
*                                                                       67600021
*REGISTER UTILIZATION                                                   67800021
*                                                                       68000021
R0       EQU   0        BEGSEQ/BEGSUB SWITCH                            68200021
R1       EQU   1        PLIST                                           68400021
R2       EQU   2        USER PLIST                                      68600021
R3       EQU   3        GSPARRAY                                        68800021
R4       EQU   4        WORK                                            69000021
R5       EQU   5        WORK                                            69200021
R6       EQU   6        GENCODE SWITCH                                  69400021
R7       EQU   7        GTMCB DSECT                                     69600021
R8       EQU   8        GDSCB DSECT                                     69800021
R9       EQU   9        BASE                                            70000021
R10      EQU   10       WORK DSECT                                      70200021
R11      EQU   11       SUBRTN LEVEL 2 SWITCH                           70400021
R13      EQU   13       SAVE                                            70600021
R14      EQU   14                                                       70800021
R15      EQU   15       BRANCH                                          71000021
         COPY  GDSCB                                                    71200021
         COPY  GTMCB                                                    71400021
         END                                                            71600021
./  ADD  SSI=20480247,NAME=IFFAFA06
*TITLE         END SEQUENCE                                             00500021
*                                                                       01000021
*MODULE NAME   IFFAFA06                                                 01500021
*                                                                       02000021
*INPUT         REG1 ADDRESS OF WORK AREA                                02500021
*                                                                       03000021
*              WORK AREA + 0  ADDRESS OF VARIABLE LENGTH PARAMETER LIST 03500021
*                  +0 ADDRESS OF GDSCB                                  04000021
*                  +4 ADDRESS OF A KEY (OPTIONAL)                       04500021
*                                                                       05000021
*              WORK AREA + 4  ADDRESS OF GSPARRAY                       05500021
*                                                                       06000021
*OUTPUT        KEY THAT IDENTIFIES THE SEQUENCE                         06500021
*                                                                       07000021
*FUNCTION      TO TERMINATE A PREVIOUSLY INITIATED SEQUENCE             07500021
         EJECT                                                          08000021
*                                                                       08500021
*REGISTER UTILIZATION                                                   09000021
*                                                                       09500021
R0       EQU   0                                                        10000021
R1       EQU   1                                                        10500021
R2       EQU   2                                                        11000021
R3       EQU   3                                                        11500021
R4       EQU   4                                                        12000021
R5       EQU   5                                                        12500021
R6       EQU   6                                                        13000021
R7       EQU   7                                                        13500021
R8       EQU   8                                                        14000021
R9       EQU   9                                                        14500021
R10      EQU   10                                                       15000021
R11      EQU   11                                                       15500021
R12      EQU   12                                                       16000021
R13      EQU   13                                                       16500021
R14      EQU   14                                                       17000021
R15      EQU   15                                                       17500021
         EJECT                                                          18000021
IFFAFA06 CSECT                                                          18500021
*1711,535000,545000,555000-580000                                  000A 18700021
*                                                                       19000021
*PERFORM NORMAL HOUSEKEEPING FUNCTIONS                                  19500021
*ESTABLISH ADDRESSABILITIES                                             20000021
*                                                                       20500021
         SAVE  (14,12)                                                  21000021
         BALR  R9,R0                                                    21500021
         USING *,R9                    ESTABLISH CSECT ADDRESSABILITY   22000021
         LA    R10,8(R1)                                                22500021
         USING WRKSECT,R10             ESTABLISH WORK AREA              23000021
         L     R2,0(R1)                GET PLIST ADDR                   23500021
         L     R8,0(R2)                GET GDSCB PTR                    24000021
         L     R8,0(R8)                GET GDSCB ADDR                   24500021
         USING GDSCB,R8                ESTABLISH GDSCB ADDRESSABILITY   25000021
*                                                                       25500021
*CHAIN SAVE AREAS                                                       26000021
*                                                                       26500021
         ST    R13,SVAREA+4            FORWARD CHAIN                    27000021
         LA    R4,SVAREA                                                27500021
         ST    R4,8(R13)               BACK CHAIN                       28000021
*                                                                       28500021
*PERFORM INITIALIZATION FUNCTIONS                                       29000021
*                                                                       29500021
         LR    R13,R4                  SET SAVE AREA REG                30000021
         L     R3,4(R1)                GET GSPARRAY ADDR                30500021
         XC    0(20,R3),0(R3)          ZERO GSPARRAY                    31000021
         XC    TEMPKEY,TEMPKEY         ZERO TEMPORARY KEY               31500021
         NI    GDSGRMOD,X'00'          SET CURRENT MODE DEVICE FLAG     32000021
*                                                                       32500021
*TEST GDS FOR VALIDITY. IF THE GDS HAS NOT BEEN OPENED AN ERROR RETURN  33000021
*IS MADE.                                                               33500021
*                                                                       34000021
         CLC   GDSVALID(2),GDSID       IS DDSCB VALID                   34500021
         BE    NDQLRA3                 YES                              35000021
NDQLRB2  LA    R4,1                                                     35500021
NDQLRB2A ST    R4,16(R3)               ERROR - GDS NOT OPEN             36000021
NDQLRB2B OI    0(R3),X'08'             INDICATE PARAM ERROR             36500021
         B     NDQLRH3                                                  37000021
*                                                                       37500021
*TEST IF A SEQUENCE HAS BEEN STARTED. IF NOT AN ERROR RETURN IS MADE.   38000021
*                                                                       38500021
NDQLRA3  TM    GDSFLAGS,X'04'          HAS A SEQUENCE BEEN STARTED      39000021
         BZ    NDQLRB2B                NO                               39500021
*                                                                       40000021
*CHECK PARAMETERS FOR PROPER COMBINATIONS. IF A KEY HAS NOT BEEN        40500021
*SPECIFIED AND NO COEEELATION VALUE WAS SPECIFIED IN THE CALL TO        41000021
*BEGIN SEQUENCE AN ERROR RETURN IS MADE                                 41500021
*                                                                       42000021
         TM    0(R2),X'80'             WAS KEY PARAM FIELD USED         42500021
         BO    NDQLRC4                 NO                               43000021
         CLC   5(3,R2),21(R3)          HAS NULL VAR REPLACED KEY        43500021
         BNE   NDQLRD4                 NO                               44000021
NDQLRC4  TM    GDSFLAGS,X'40'          WAS BGSEQ CORRELATED             44500021
         BO    NDQLRB2                 NO                               45000021
NDQLRD4  LH    R4,GDSKEYSV             GET LOG BFR ADDR FROM GDSCB      45500021
         STH   R4,TEMPKEY+2            SETUP KEY FOR KEY TABLE SEARCH   46000021
         LA    R4,TEMPKEY                                               46500021
*                                                                       47000021
*BUILD PARAMETER LIST FOR KEY TABLE MANAGEMENT                          47500021
*                                                                       48000021
NDQLRE3P ST    R8,KEYPLIST             PUT GDSCB ADDR IN PLIST          48500021
         LA    R5,KEYCODE                                               49000021
         ST    R5,KEYPLIST+4           PUT CODE ADDR IN PLIST           49500021
         ST    R4,KEYPLIST+8           PUT KEY ADDR IN PLIST            50000021
*                                                                       50500021
*INVOKE KEY TABLE MANAGEMENT                                            51000021
*                                                                       51500021
NDQLRE3  L     R5,24(R3)               GET STATUS TABLE ADDR            52000021
         L     R15,KEYDISP(R5)         GET EP ADDR                      52500021
         LTR   R15,R15                 HAS MODULE BEEN LOADED           53000021
         BZ    NDQLRB2B            NO-ERROR                        000A 53500021
NDQLRE3A LA    R1,KEYPLIST             LOAD PLIST ADDR                  54000021
         BALR  R14,R15             BRANCH TO KEY TABLE MGMT        000A 54500021
         B     NDQLRE3D                                                 55000021
*                                                                       58500021
*TEST FOR SUCCESSFUL COMPLETION OF INVOKED ROUTINE. IF UNSUCCESSFULL    59000021
*MAKE AN ERROR RETURN.                                                  59500021
*                                                                       60000021
NDQLRE3D LTR   R15,R15                 WAS KEY TBL MGMT SUCCESSFUL      60500021
         BZ    NDQLRF3                 YES                              61000021
         LA    R4,2                    ERROR - KEY NOT FOUND            61500021
         B     NDQLRB2A                                                 62000021
*                                                                       62500021
*COMPUTE THE LENGTH OF THE SEQUENCE, IN BYTES. COMPLETE THE KEY BY      63000021
*PUTTING THE LENGTH IN IT.                                              63500021
*                                                                       64000021
NDQLRF3  L     R7,GDSAOACB             GET OACB ADDR                    64500021
         L     R5,52(R7)               GET CURRENT ORDER LOAD POINT     65000021
         SH    R5,2(R1)                COMPUTE LENGTH OF SEQUENCE       65500021
         STH   R5,0(R1)                COMPLETE KEY                     66000021
         OI    4(R1),X'A0'             SET MULT AND SEQUENCE FLAGS      66500021
         TM    0(R2),X'80'             WAS KEY PARAM SPECIFIED          67000021
         BO    NDQLRG3                 NO                               67500021
         L     R5,4(R2)                GET KEY RETURN WORD ADDR         68000021
         MVC   0(4,R5),0(R1)           RETURN KEY                       68500021
*                                                                       69000021
*SETUP PARAMETERS NEEDED BY DATA STORE.                                 69500021
*                                                                       70000021
NDQLRG3  ST    R8,DATASTOR             PUT GDSCB ADDR IN PLIST          70500021
         ST    R3,DATASTOR+4           PUT GSPARRAY ADDR IN PLIST       71000021
         MVI   DATASTOR+8,X'02'        PUT CODE IN PLIST                71500021
         XC    DATASTOR+9(3),DATASTOR+9  PUT LENGTH IN PLIST            72000021
         LA    R1,DATASTOR             GET DATA STORE PLIST ADDR        72500021
*                                                                       73000021
*INVOKE DATA STORE. THE DATA STORE ROUTINE IS USED TO RESOLVE THE       73500021
*TRANSFER ADDRESS PAST THE SEQUENCE. THIS TRANSFER PERMITS OMITTING     74000021
*THE SEQUENCE.                                                          74500021
*                                                                       75000021
         L     R4,24(R3)               GET STATUS TABLE ADDR            75500021
         L     R15,DATDISP(R4)         GET EP ADDR                      76000021
         BALR  R14,R15                                                  76500021
*                                                                       77000021
*MAKE NORMAL RETURN                                                     77500021
*                                                                       78000021
NDQLRH3  L     R13,SVAREA+4                                             78500021
         NI    GDSFLAGS,X'BB'          RESET SEQUENCE BEGUN AND NO      79000021
*                                      CORRVAL FLAGS                    79500021
         RETURN (14,12),T                                               80000021
         EJECT                                                          80500021
*                                                                       81000021
*EQUATES                                                                81500021
*                                                                       82000021
CVTLINK  EQU   8                                                        82500021
KEYDISP  EQU   828                                                      83000021
DATDISP  EQU   852                                                      83500021
*                                                                       84000021
*CONSTANTS AND DSECTS                                                   84500021
*                                                                       85000021
KEYCODE  DC    F'2'                                                     85500021
C4       DC    H'4'                                                     86000021
GDSID    DC    X'F203'                                                  86500021
IFFA     DC    C'IFFA'                                                  87000021
WRKSECT  DSECT                                                          87500021
SVAREA   DS    18F                                                      88000021
SUPPLIST DS    4F                                                       88500021
TEMPKEY  DS    F                                                        89000021
KEYPLIST DS    10F                                                      89500021
STATDISP DS    F                                                        90000021
EPLOC    DS    D                                                        90500021
DATASTOR DS    12F                                                      91000021
         COPY  GDSCB                                                    91500021
         END                                                            92000021
./  ADD  SSI=20480248,NAME=IFFAFA07
*TITLE         ENSUB                                                    00300021
*                                                                       00600021
*MODULE NAME   IFFAFA07                                                 00900021
*                                                                       01200021
*INPUT         REGISTER 1 ADDRESS OF WORK AREA                          01500021
*              FIRST WORD OF WORK AREA IS ADDRESS PARAMETER LIST        01800021
*                  +0 A(GDSCB)                                          02100021
*                  +4 A(KEY)  OPTIONAL                                  02400021
*              SECOND WORD OF WORK AREA IS ADDRESS OF GSPARRAY          02700021
*                                                                       03000021
*FUNCTION      TO TERMINATE A BUFFER SUBROUTINE                         03300021
*                                                                       03600021
*OUTPUT        NONE TO CALLER. KEY IS COMPLETED IF LEVEL 1              03900021
         EJECT                                                          04200021
*                                                                       04500021
*REGISTER UTILIZATION                                                   04800021
*                                                                       05100021
R0       EQU   0                                                        05400021
R1       EQU   1         PLIST REG                                      05700021
R2       EQU   2         ADDR OF USERS PLIST                            06000021
R3       EQU   3         KEY ADDR                                       06300021
R4       EQU   4         WORK                                           06600021
R5       EQU   5         WORK                                           06900021
R6       EQU   6                                                        07200021
R7       EQU   7         GTMCB                                          07500021
R8       EQU   8         GDSCB                                          07800021
R9       EQU   9         BASE                                           08100021
R10      EQU   10        WORK AREA                                      08400021
R11      EQU   11        GSPARRAY ADDR                                  08700021
R13      EQU   13        SAVE AREA                                      09000021
R14      EQU   14        RETURN REG                                     09300021
R15      EQU   15        BRANCH REG                                     09600021
*                                                                       09900021
*PROGRAM EQUATES                                                        10200021
*                                                                       10500021
CVTLINK  EQU   8                                                        10800021
KEYDISP  EQU   828                                                      11100021
DATDISP  EQU   852                                                      11400021
         EJECT                                                          11700021
IFFAFA07 CSECT                                                          12000021
*2239,810000,816000,822000-837000                                  000A 12100021
*                                                                       12300021
*PERFORM NORMAL HOUSEKEEPING FUNCTIONS - SAVE REGISTERS, ESTABLISH      12600021
*ADDRESSABILITIES, CHAIN SAVE AREAS                                     12900021
*                                                                       13200021
         SAVE  (14,12)                 SAVE REGS                        13500021
         BALR  R9,R0                                                    13800021
         USING *,R9                    ESTABLISH CSECT ADDRESSABILITY   14100021
         LA    R10,8(R1)                                                14400021
         USING WRKSECT,R10             ESTABLISH WORK AREA ADDRESSABLTY 14700021
         ST    R13,SVAREA+4            FORWARD CHAIN SAVE AREAS         15000021
         LA    R4,SVAREA                                                15300021
         ST    R4,8(R13)               BACK CHAIN SAVE AREAS            15600021
         LR    R13,R4                  SET SAVE AREA REG                15900021
*                                                                       16200021
*PERFORM INITIALIZATION FUNCTIONS                                       16500021
*                                                                       16800021
         L     R2,0(R1)                GET PLIST ADDR                   17100021
         ST    R2,SAVEPAD                                               17400021
         L     R11,4(R1)               GET GSPARRAY ADDR                17700021
         XC    0(20,R11),0(R11)        ZERO GSPARRAY                    18000021
         XC    TEMPKEY(4),TEMPKEY      ZERO TEMPORARY KEY               18300021
*                                                                       18600021
*ESTABLISH GDSCB ADDRESSABILITY                                         18900021
*                                                                       19200021
         L     R8,0(R2)                GET GDSCB PNTR FROM PLIST        19500021
         L     R8,0(R8)                GET GDSCB ADDR                   19800021
         USING GDSCB,R8                ESTABLISH GDSCB ADDRESSABILITY   20100021
         NI    GDSGRMOD,X'00'          SET CURRENT MODE DEVICE FLAG     20400021
*                                                                       20700021
*TEST FOR VALID GDS. IF GDS IS NOT OPEN OR IF A GDSCB ADDR IS NOT A     21000021
*PARAMETER THE GSPARRAY IS SET AND AN ERROR RETURN IS MADE.             21300021
*                                                                       21600021
         CLC   GDSVALID(2),GDSID                                        21900021
         BE    NDBLSA3                                                  22200021
         MVI   19(R11),X'01'           ERROR - GDS INVALID OR UNOPEN    22500021
NDBLSB2  MVI   0(R11),X'08'            PARAM ERROR                      22800021
         B     NDBLSH5                                                  23100021
*                                                                       23400021
*TEST IF A BUFFER SUBROUTINE HAS BEEN STARTED. IF NOT THE GSPARRAY IS   23700021
*SET AND AN ERROR RETURN IS MADE.                                       24000021
*                                                                       24300021
NDBLSA3  TM    GDSFLAGS,X'02'          HAS A SUBRTN BEEN STARTED        24600021
         BZ    NDBLSB2                 NO                               24900021
*                                                                       25200021
*TEST FOR LRVEL OF SUPPORT. IF LEVEL 1 AND BGSUB WAS NOT CORRELATED     25500021
*ENSUB MUST BE KKEYED. IF LEVEL 2 ENSUB MUST BE KEYED,                  25800021
*                                                                       26100021
         TM    GDSFLAGS,X'10'          WAS LEVEL 2 REQUESTED            26400021
         BO    NDBLSB4                 YES                              26700021
*                                                                       27000021
*LEVEL 1 SUPPORT. TEST PARAMETERS                                       27300021
*                                                                       27600021
         TM    0(R2),X'80'             WAS KEY FIELD USED               27900021
         BO    NDBLSC2                 NO                               28200021
         CLC   5(3,R2),21(R11)         HAS NULL VAR REPLACED KEY        28500021
         BE    NDBLSC2                 YES                              28800021
*                                                                       29100021
*BGSUB WAS CORRELATED. FIND TEMPORARY KEY IN IN THE TABLE SO            29400021
*THAT A PERMANENT KEY CAN BE CREATED.                                   29700021
*                                                                       30000021
NDBLSD2  LH    R4,GDSKEYSV             GET LOG BFR ADDR OF START OF     30300021
*                                      SUBRTN FROM GDSCB                30600021
         STH   R4,TEMPKEY+2            SETUP TEMPORARY KEY FOR          30900021
         LA    R4,TEMPKEY              KEY TABLE SEARCH                 31200021
*                                                                       31500021
*BUILD PARAMETER LIST FOR KEY TABLE MANAGEMENT.                         31800021
NDBLSE3  LA    R5,KEYCODE2             CODE FOR KEY SEARCH              32100021
         ST    R5,KEYPLIST+4           PUT CODE ADDR IN PLIST           32400021
         ST    R8,KEYPLIST             PUT GDSCB IN PLIST               32700021
         ST    R4,KEYPLIST+8           PUT KEY ADDR IN PLIST            33000021
*                                                                       33300021
*LINK TO CODE THAT WILL INVOKE KEY TABLE MANAGEMENT                     33600021
*                                                                       33900021
         LA    R15,NDBLSF3                                              34200021
         BALR  R4,R15                                                   34500021
*                                                                       34800021
*TEST FOR SUCCESSFUL COMPLETION OF KEY TABLE MANAGEMENT                 35100021
*                                                                       35400021
         LTR   R15,R15                 WAS RTN SUCCESSFUL               35700021
         BP    NDBLSB5                 NO                               36000021
         ST    R1,KEYSV                SAVE KEY ADDR                    36300021
         B     NDBLSC4                                                  36600021
NDBLSB5  MVI   19(R11),X'02'           ERROR - KEY NOT FOUND            36900021
         B     NDBLSB2                                                  37200021
*                                                                       37500021
*LEVEL 1 SUPPORT. ENDSUB HAS NOT BEEN KEYED. BEGSUB MUST HAVE BEEN      37800021
*CORRELATED, IF NOT THE KEY TABLE IS RESET AS IT WAS BEFOR BGSUB WAS    38100021
*CALLED AND AN ERROR RETURN IS MADE.                                    38400021
*                                                                       38700021
NDBLSC2  TM    GDSFLAGS,X'40'          WAS BGSUB CORRELATED             39000021
         BZ    NDBLSD2                 YES                              39300021
*                                                                       39600021
*BUILD PARAMETER LIST FOR KEY TABLE MANAGEMENT - RESET TO KEY           39900021
*                                                                       40200021
         LA    R5,KEYCODE3                                              40500021
         ST    R5,KEYPLIST+4                                            40800021
         ST    R8,KEYPLIST                                              41100021
         MVC   TEMPKEY+2(2),GDSKEYSV                                    41400021
         LA    R4,TEMPKEY                                               41700021
         ST    R4,KEYPLIST+8                                            42000021
*                                                                       42300021
*LINK TO CODE THAT WILL INVOKE KEY TABLE MANAGEMENT                     42600021
*                                                                       42900021
         LA    R15,NDBLSF3                                              43200021
         BALR  R4,R15                                                   43500021
         B     NDBLSB2                                                  43800021
*                                                                       44100021
*LEVEL 2 SUPPORT. ENDSUB MUST BE KEYED, IF NOT AN ERROR RETURN IS MADE  44400021
*                                                                       44700021
NDBLSB4  TM    0(R2),X'80'             WAS KEY FIELD USED               45000021
         BO    NDBLSB5                 NO                               45300021
         CLC   5(3,R2),21(R11)         HAS NULL VAR REPLACED KEY        45600021
         BE    NDBLSB5                 YES                              45900021
*                                                                       45930021
*A VALID LEVEL 2 SUBROUTINE HAS BEEN CREATED.  BUILD A DUMMY KEY FOR    45960021
*USE IN COMPUTING THE PHYSICAL BUFFER ADDRESS.                          45990021
*                                                                       46020021
         SR    R1,R1                                                    46050021
         LH    R1,GDSKEYSV             GET LOG BUFFER STARRT ADDR       46080021
         ST    R1,TEMPKEY              SETUP DUMMY KEY                  46110021
         LA    R1,TEMPKEY                                               46140021
         ST    R1,KEYSV                SAVE KEY ADDR                    46170021
*                                                                       46200021
*A SUBROUTINE HAS BEEN CORRECTLY CREATED. TEST FOR 128 BYTE GDOA.       46500021
*                                                                       46800021
NDBLSC4  LA    R4,128                                                   47100021
         CH    R4,GDSGDOAL             IS GDOA 128 BYTES                47400021
         BE    NDBLSC5                 YES                              47700021
*                                                                       48000021
*COMPUTE PHYSICAL BUFFER ADDRESS OF START OF SUBROUTINE.                48300021
*                                                                       48600021
*MULTIPLE 256 GDOA                                                      48900021
*                                                                       49200021
         LH    R6,GDSGDOAL             GET GDOA LENGTH FROM GDSCB       49500021
         SH    R6,C6                   COMPUTE DIVISOR                  49800021
         LH    R5,2(R1)                GET LOG BFR START ADDR FROM KEY  50100021
         M     R4,C1                   PROPAGATE SIGN BIT               50400021
         DR    R4,R6                   COMPUTE ELEMENT NUMBER IN GDS    50700021
*                                                                       51000021
*SEARCH BUFFER CONTROL TABLE FOR      BUFFER SEGMENT                    51300021
*                                                                       51600021
         LH    R6,GDSBCTEL             GET BCT INDEX                    51900021
         MH    R6,CH3                  EXPAND BCT INDEX                 52200021
         L     R7,GDSGTMCB             GET GTMCB ADDR                   52500021
         USING GTMCB,R7                ESTABLISH GTMCB ADDRESSABILITY   52800021
         L     R2,GTMBCTBL             GET BCT ADDR FROM GTMCB          53100021
NDBLSD4A SR    R3,R3                                                    53400021
         IC    R3,2(R6,R2)             GET CT FIELD FROM BCT            53700021
         CR    R3,R5                   IS THIS THE LAST SEGMENT         54000021
         BE    NDBLSD4B                YES                              54300021
*                                                                       54600021
*TEST LOGICAL BUFFER ADDRESS IN KEY FOR CORRECTNESS.                    54900021
*                                                                       55200021
         SR    R3,R3                                                    55500021
         IC    R3,1(R2,R6)             GET PTR TO NEXT SEGMENT          55800021
         MH    R3,CH3                  COMPUTE PTR TO NEXT SEGMENT      56100021
         CR    R6,R3                   ARE PTR AND INDEX EQUAL          56400021
         BE    NDBLSB2                 YES                              56700021
         LR    R6,R3                                                    57000021
         B     NDBLSD4A                                                 57300021
*                                                                       57600021
*PROPER BUFFER CONTROL TABLE ENTRY HAS BEEN FOUND. COMPUTE PHYSICAL     57900021
*BUFFER ADDRESS.                                                        58200021
*                                                                       58500021
NDBLSD4B LR    R5,R6                   PREPARE DIVIDEND                 58800021
         LR    R6,R4                   TRANSFER REMAINDER               59100021
         M     R4,C1                   PROPAGATE SIGN BIT               59400021
         D     R4,C3                   COMPUTE SEGMENT NUMBER           59700021
         MH    R5,C256                 COMPUTE NUMBER OF BYTES          60000021
         LA    R5,6(R5,R6)             COMPUTE PHYS BFR ADDR            60300021
         B     NDBLSE4                                                  60600021
*                                                                       60900021
*COMPUTE PHYSICAL BUFFER ADDRESS FOR 128 BYTE GDOA                      61200021
*                                                                       61500021
NDBLSC5  LH    R3,GDSBCTEL             GET BCT INDEX                    61800021
         LH    R6,2(R1)                GET LOG BFR START ADDR FROM KEY  62100021
         LR    R5,R3                                                    62400021
         MH    R5,C256                 COMPUTE BFR START ADR OF SEGMENT 62700021
         MH    R3,CH3                  EXPAND BCT INDEX                 63000021
         L     R7,GDSGTMCB                                              63100021
         L     R4,GTMBCTBL             GET BCT ADDR                     63300021
         AR    R4,R3                   COMPUTE BCT SEGMENT ADDR         63380021
         CLC   0(1,R4),GDSBCTID        FIRST OR SECOND HALF OF SEGMENT  63460021
         BE    NDBLSC5A                FIRST                            63540021
         LA    R5,134(R5,R6)           COMPUTE PHYS BUFFER ADDR         63620021
         B     NDBLSE4                                                  63700021
NDBLSC5A LA    R5,6(R5,R6)             COMPUTE PHYS BUFFER ADDR         63780021
*                                                                       63900021
*SETUP DATA STORE PARAMETERS. GTRU TO START OF SUBROUTINE               64200021
*                                                                       64500021
NDBLSE4  ST    R8,DATSTOR              PUT GDSCB ADDR IN PLIST          64800021
         ST    R11,DATSTOR+4           PUT GSPARRAY ADDR IN PLIST       65100021
         MVC   DATSTOR+8(8),SUBCONST    SET FLAG FIELDS AND GTRU        65400021
         STH   R5,DATSTOR+14           COMPLETE GTRU                    65700021
*                                                                       66000021
*INVOKE DATA STORE. THE DATA STORE ROUTINE IS USED TO PUT THE TRANSFER  66300021
*ORDER TO THE START OF THE ROUTINE IN THE GDOA.                         66600021
*                                                                       66900021
         LA    R1,DATSTOR              GET PLIST ADDR                   67200021
         L     R5,24(R11)              GET STATAB ADDR                  67500021
         L     R15,DATDISP(R5)         GET EP ADDR                      67800021
         BALR  R14,R15                 LINK WITH DATA STORE             68100021
*                                                                       68400021
*WAS DATA STORE SUCCESSFUL                                              68700021
*                                                                       69000021
         LTR   R15,R15                 WAS DATA STORE SUCCESSFUL        69300021
         BP    NDBLSH5                 NO                               69600021
*                                                                       69900021
*SETUP PARAMETERS NEEDED BY DATA STORE TO RESOLVE SUBROUTINE ADDRESS    70200021
*                                                                       70500021
         MVI   DATSTOR+8,X'02'         INDICATE TO DATA STORE THET      70800021
         XC    DATSTOR+9(3),DATSTOR+9  IT SHOULD RESOLVE SUBRTN ADDR    71100021
         LA    R1,DATSTOR              GET PLIST ADDR                   71400021
*                                                                       71700021
*INVOKE DATA STORE. THE DATA STORE ROUTINE IS USED TO RESOLVE THE       72000021
*TRANSFER ADDRESS PAST THE SUBROUTINE. THIS TRANSFER PREVENTS INLINE    72300021
*EXECUTION OF THE SUBROUTINE.                                           72600021
*                                                                       72900021
         L     R5,24(R11)              GET STATUS TABLE ADDR            73200021
         L     R15,DATDISP(R5)         GET EP ADDR                      73500021
         BALR  R14,R15                 LINK WITH DATA STORE             73800021
*                                                                       74100021
*COMPLETE KEY BY INCLUDING SUBROUTINE LENGTH. RETURN THE KEY IN THE     74400021
*KEY RETURN WORD IF ONE WAS SPECIFIED.                                  74700021
*                                                                       75000021
         L     R3,KEYSV                GET KEY ADDR                     75300021
         L     R2,SAVEPAD                                               75600021
         L     R4,GDSAOACB             GET OACB ADDR                    75900021
         L     R5,52(R4)               GET BFR ORDER LOAD POINT         76200021
         SH    R5,2(R3)                COMPUTE LENGTH                   76500021
         STH   R5,0(R3)                COMPLETE KEY                     76800021
         TM    0(R2),X'80'             WAS KEY PARAM SPECIFIED          77100021
         BO    NDBLSH5                 NO                               77400021
         L     R5,4(R2)                GET KEY RETURN WORD ADDR         77700021
         MVC   0(4,R5),0(R3)           RETURN KEY                       78000021
NDBLSH5  L     R13,SVAREA+4                                             78300021
         NI    GDSFLAGS,X'BD'          TURN OFF SUBROUTINE BEGUN FLAG   78600021
         RETURN (14,12),T                                               78900021
*                                                                       79200021
*INVOKE KEY TABLE MANAGEMENT                                            79500021
*                                                                       79800021
NDBLSF3  L     R5,24(R11)              GET STATAB ADDR                  80100021
         L     R15,KEYDISP(R5)         GET EP ADDR                      80400021
         LTR   R15,R15                 HAS MODULE BEEN LOADED           80700021
         BZ    NDBLSB2             NO-ERROR                        000A 81000021
NDBLSF3A LA    R1,KEYPLIST                                              81300021
         BALR  R14,R15             BRANCH TO KEY TABLE MGMT        000A 81600021
         BR    R4                                                       81900021
         EJECT                                                          84000021
*                                                                       84300021
*DEFINED CONSTANTS                                                      84600021
*                                                                       84900021
SUBCONST DC    F'4'                                                     85200021
         GINIT                                                          85500021
         GTRU  0                                                        85800021
KEYCODE2 DC    F'2'                                                     86100021
KEYCODE3 DC    F'3'                                                     86400021
C1       DC    F'1'                                                     86700021
C3       DC    F'3'                                                     87000021
CF256    DC    F'256'                                                   87300021
GDSID    DC    X'F203'                                                  87600021
CH3      DC    H'3'                                                     87900021
C6       DC    H'6'                                                     88200021
C256     DC    H'256'                                                   88500021
*                                                                       88800021
*WORK AREA DSECT                                                        89100021
*                                                                       89400021
WRKSECT  DSECT                                                          89700021
KEYSV    DS    F                                                        90000021
SAVEPAD  DS    F                                                        90300021
SVAREA   DS    18F                                                      90600021
KEYPLIST DS    10F                                                      90900021
TEMPKEY  DS    F                                                        91200021
SUPPLIST DS    4F                                                       91500021
DATSTOR  DS    12F                                                      91800021
         COPY  GDSCB                                                    92100021
         COPY  GTMCB                                                    92400021
         END                                                            92700021
./  ADD  SSI=20480249,NAME=IFFAFA08
*TITLE         LINK TO A BUFFER SUBROUTINE                              00200021
*                                                                       00400021
*ENTRY POINT   IFFAFA08                                                 00600021
*                                                                       00800021
*INPUT         IN REGISTER ONE THE ADDRESS OF A VARIABLE LENGTH         01000021
*              PARAMETER LIST.                                          01200021
*                 +0 A(GDSCB)                                           01400021
*                 +4 A(BUFCORRVAL)   OPTIONAL    IDENTIFIES SUBROUTINE  01600021
*                 +8 A(BUFKEY)       OPTIONAL                           01800021
*                +12 A(LINKCORRVAL)  OPTIONAL    IDENTIFIES LINKAGE     02000021
*                +16 A(LINKKEY)      OPTIONAL                           02200021
*                +20 A(GENCODE)      OPTIONAL    CANNOT BE 3            02400021
*                      EITHER OR BOTH THE BUFCORRVAL OR BUFKEY          02600021
*                      PARAMETERS MUST BE SPECIFIED DEPENDING ON        02800021
*                      WHETHER THE SUBROUTINE WAS CORRELATED OR KEYED   03000021
*                                                                       03200021
*OUTPUT        THE ORDERS NEDED TO PERFORM BUFFER SUBROUTINE LINKAGE    03400021
*              ARE GENERATED IN THE GDOA                                03600021
*                                                                       03800021
*EXTERNAL RTNS KEY TABLE MANAGEMENT                                     04000021
*              DATA STORE                                               04200021
*                                                                       04400021
*FUNCTION      TO GENERATE THE GRAPHIC ORDERS NECESSARY FOR PROPER      04600021
*              FUCTIONING OF BUFFER SUBROUTINES.                        04800021
         EJECT                                                          05000021
*                                                                       05200021
*REGISTER UTILIZATION                                                   05400021
*                                                                       05600021
R0       EQU   0                                                        05800021
R1       EQU   1             PLIST REG                                  06000021
R2       EQU   2                                                        06200021
R3       EQU   3             GSPARRAY ADDR                              06400021
R4       EQU   4             WORK                                       06600021
R5       EQU   5             WORK                                       06800021
R6       EQU   6                                                        07000021
R7       EQU   7             GTMCB                                      07200021
R8       EQU   8             GDSCB                                      07400021
R9       EQU   9             BASE                                       07600021
R10      EQU   10            WRKSECT                                    07800021
R11      EQU   11                                                       08000021
R13      EQU   13            SAVE AREA                                  08200021
R14      EQU   14            RETURN REG                                 08400021
R15      EQU   15            BRANCH REG                                 08600021
         EJECT                                                          08800021
IFFAFA08 CSECT                                                          09000021
*2023,646000,650000,654000-664000                                  000A 09100021
*                                                                       09200021
*PERFORM NORMAL HOUSEKEEPING FUNCTIONS - SAVE REGISTERS, ESTABLISH      09400021
*ADDRESSABILITIES, CHAIN SAVE AREAS                                     09600021
*                                                                       09800021
         SAVE  (14,12)                 SAVE REGISTERS                   10000021
         BALR  R9,R0                                                    10200021
         USING *,R9                    ESTABLISH CSECT ADDRESSABILITY   10400021
         LA    R10,8(R1)                                                10600021
         USING WRKSECT,R10             ESTABLISH WORK AREA ADDRESSABLTY 10800021
         ST    R13,SVAREA+4            FORWARD CHAIN                    11000021
         LA    R4,SVAREA                                                11200021
         ST    R4,8(R13)               BACK CHAIN                       11400021
         LR    R13,R4                  SET SAVE AREA REG                11600021
*                                                                       11800021
*PERFORM INITIALIZATION FUNCTIONS                                       12000021
*                                                                       12200021
         L     R2,0(R1)                GET PLIST ADDR                   12400021
         L     R3,4(R1)                GET GSPARRAY ADDR                12600021
         XC    0(20,R3),0(R3)          ZERO GSPARRAY                    12800021
         XC    PARMS(24),PARMS         ZERO REVISED PLIST               13000021
         XC    KEY(12),KEY             ZERO KEY                         13200021
*                                                                       13400021
*ESTABLISH GDSCB ADDRESSABILITY                                         13600021
*                                                                       13800021
         L     R8,0(R2)                GET PTR TO GDSCB                 14000021
         L     R8,0(R8)                GET GDSCB ADDR                   14200021
         USING GDSCB,R8                ESTABLISH GDSCB ADDRESSABILITY   14400021
         NI    GDSGRMOD,X'00'          SET CURRENT MODE DEVICE FLAG     14600021
*                                                                       14800021
*REFORM PARAMETER LIST                                                  15000021
*                                                                       15200021
         LA    R5,PARMS                GET REVISED PLIST ADDR           15400021
LKBLTA0A TM    0(R2),X'80'             HAS LAST PARAM BEEN CHECKED      15600021
         BO    LKBLTA0C                YES                              15800021
         CLC   0(4,R2),20(R3)          HAS NULL VAR REPLACED PARAM      16000021
         BE    LKBLTA0B                YES                              16200021
         MVC   0(4,R5),0(R2)           TRANSFER PARAMETER               16400021
LKBLTA0B AH    R2,C4                   INCREMENT PLIST POINTERS         16600021
         AH    R5,C4                                                    16800021
         B     LKBLTA0A                                                 17000021
LKBLTA0C CLC   1(3,R2),21(R3)          HAS NULL VAR REPLACED PARAM      17200021
         BE    LKBLTB1                 YES                              17400021
         MVC   1(3,R5),1(R2)           TRANSFER PARAMETER               17600021
*                                                                       17800021
*TEST FOR GDS VALIDITY. IF INVALID OR UNOPEN SET THE GSPARRAY TO        18000021
*INDICATE THE ERROR AND MAKE AN ERROR RETURN.                           18200021
*                                                                       18400021
LKBLTB1  CLC   GDSVALID(2),GDSID       IS GDS VALID                     18600021
         BE    LKBLTB2                 YES                              18800021
         MVI   19(R3),X'01'            ERROR - GDS INVALID OR UNOPEN    19000021
LKBLTC1  MVI   0(R3),X'08'             INDICATE PARAM ERROR             19200021
         B     LKBLTH4                                                  19400021
*                                                                       19600021
*TEST LEVEL OF SUPPORT. IF LEVEL 1 THE SUBROUTINE MUST HAVE BEEN KEYED  19800021
*OR CORRELATED. IF LEVEL 2 THE SUBROUTINE MUST HAVE BEEN KEYED.         20000021
*                                                                       20200021
LKBLTB2  TM    GDSFLAGS,X'10'          WAS LEVEL 2 SUPPORT REQUESTED    20400021
         BZ    LKBLTB3                 NO                               20600021
*                                                                       20800021
*LEVEL 2 SUPPORT. IF SUBROUTINE KEY HAS NOT BEEN PASSED AS A PARAMETER  21000021
*THE GSPARRAY IS SET TO INDICATE THE ERROR.                             21200021
*                                                                       21400021
         CLC   PARMS+8(4),ZERO         WAS SUBRTN KEY PARAM PASSED      21600021
         BNE   LKBLTD2                 YES                              21800021
         MVI   19(R3),X'03'            ERROR - LEVEL 2, NO SUBRTN KEY   22000021
         B     LKBLTC1                                                  22200021
*                                                                       22400021
*BUILD PARAMETER LIST FOR DATA STOR ROUTINE                             22600021
*                                                                       22800021
LKBLTD2  MVC   DATASTOR+8(16),DATSTOR1 PUT DATA IN DATA STORE PLIST     23000021
         L     R1,PARMS+8                                               23100021
         LA    R15,LKBPHYS             LINK TO RTN THAT WILL            23200021
         BALR  R14,R15                 COMPUTE PHYSICAL BFR ADDR        23400021
         STH   R4,DATASTOR+14          COMPLETE GMVA ORDER              23600021
         STH   R5,DATASTOR+20          COMPLETE GTRU ORDER              23800021
*                                                                       24000021
*DETERMINE IF LINKAGE SHOULD BE INCLUDED OR OMITTED                     24200021
*                                                                       24400021
         CLC   PARMS+20(4),ZERO        SHOULD LINKAGE BE INCLUDED       24600021
         BE    LKBLTD2A                YES                              24800021
         L     R4,PARMS+20             GET GENCODE ADDR                 25000021
         L     R4,0(R4)                GET GENCODE                      25200021
         CH    R4,C2                   SHOULD LINKAGE BE OMITTED        25400021
         BE    LKBLTD2B                YES                              25600021
LKBLTD2A LH    R4,GNOP4                                                 25800021
         STH   R4,DATASTOR+18          CAUSE LINKAGE TO BE INCLUDED     26000021
         B     LKBLTE3                                                  26200021
LKBLTD2B LH    R4,GTRU                                                  26400021
         STH   R4,DATASTOR+18          CAUSE LINKAGE TO BE OMITTED      26600021
         B     LKBLTE3                                                  26800021
*                                                                       27000021
*LEVEL 1 SUPPORT. SUBROUTINE MUST HAVE BEEN KEYED OR CORRELATED. IF     27200021
*NOT THE GSPARRAY IS SET TO INDICATE THE ERROR.                         27400021
*                                                                       27600021
LKBLTB3  CLC   PARMS+4(4),ZERO         WAS SUBRTN CORVAL PARAM PASSED   27800021
         BNE   LKBLTB3A                YES                              28000021
         CLC   PARMS+8(4),ZERO         WAS SUBRTN KEY PARAM PASSED      28200021
         BE    LKBLTC1                 NO                               28400021
*                                                                       28600021
*SETUP KEY TABLE MANAGEMENT PARAMETERS.                                 28800021
*                                                                       29000021
*SEARCH FOR KEY                                                         29200021
*                                                                       29400021
         LA    R4,KEYCODE2             GET CODE ADDR                    29600021
         L     R5,PARMS+8              GET PTR TO KEY ADDR              29800021
         B     LKBLTB4                                                  30000021
*                                                                       30200021
*SEARCH FOR CORVAL                                                      30400021
*                                                                       30600021
LKBLTB3A LA    R4,KEYCODE5             GET CODE ADDR                    30800021
         L     R5,PARMS+4              GET CORVAL ADDR                  31000021
*                                                                       31200021
*BUILD KEY TABLE MANAGEMENT PARAMETER LIST                              31400021
*                                                                       31600021
LKBLTB4  ST    R8,KEYPLIST             PUT GDSCB ADDR IN PLIST          31800021
         ST    R4,KEYPLIST+4           PUT CODE ADDR IN PLIST           32000021
         ST    R5,KEYPLIST+8           PUT KEY/CORVAL ADDR IN PLIST     32200021
         LA    R15,LKBKEY              LINK TO RTN THAT WILL INVOKE     32400021
         BALR  R6,R15                  KEY TABLE MANAGEMENT             32600021
*                                                                       32800021
*TEST FOR SUCCESSFUL COMPLETION OF KEY TABLE MAGAGEMENT                 33000021
*                                                                       33200021
         LTR   R15,R15                 WAS KEY TABLE MGMT SUCCESSFUL    33400021
         BZ    LKBLTC4                 YES                              33600021
         MVI   19(R3),X'02'            ERROR - KEY NOT FOUND            33800021
         B     LKBLTC1                                                  34000021
*                                                                       34200021
*TEST IF A SUBROUTINE HAS BEEN STARTED. IF NOT THE GSPARRAY IS SET      34400021
*TO INDICATE THE ERROR.                                                 34600021
*                                                                       34800021
LKBLTC4  TM    4(R1),X'28'             HAS A SUBRTN BEEN STARTED        35000021
         BO    LKBLTD4                 YES                              35200021
         MVI   19(R3),X'04'            ERROR - SUBRTN NOT BEGUN         35400021
         B     LKBLTC1                                                  35600021
*                                                                       35800021
*BUILD PARAMETER LIST FOR DATA STORE ROUTINE.                           36000021
*                                                                       36200021
LKBLTD4  MVC   DATASTOR+8(20),DATSTOR2 PUT DATA IN PLIST                36400021
         LA    R15,LKBPHYS             LINK TO CODE THAT WILL COMPUTE   36600021
         BALR  R14,R15                 PHYSICAL BUFFER ADDRESSES        36800021
         STH   R4,DATASTOR+18          COMPLETE GMVA ORDER              37000021
         STH   R5,DATASTOR+24          COMPLETE GTRU ORDER              37200021
*                                                                       37400021
*DETERMINE IF LINKAGE IS TO BE INCLUDED OR OMITTED.                     37600021
*                                                                       37800021
         CLC   PARMS+20(4),ZERO        SHOULD LINKAGE BE INCLUDED       38000021
         BE    LKBLTD4A                YES                              38200021
         L     R4,PARMS+20             GET GENCODE ADDR                 38400021
         L     R4,0(R4)                GET GENCODE                      38600021
         CH    R4,C2                   SHOULD MODULE BE OMITTED         38800021
         BE    LKBLTD4B                YES                              39000021
LKBLTD4A LH    R4,GNOP4                                                 39200021
         STH   R4,DATASTOR+12          CAUSE LINKAGE TO BE INCLUDED     39400021
         B     LKBLTE3                                                  39600021
LKBLTD4B LH    R4,GTRU                                                  39800021
         STH   R4,DATASTOR+12          CAUSE LINKAGE TO BE OMITTED      40000021
*                                                                       40200021
*INVOKE DATA STORE. THE DATA STORE ROUTINE IS USED TO PUT THE LINKAGE   40400021
*STRUCTURE IN THE GDOA.                                                 40600021
*                                                                       40800021
LKBLTE3  ST    R8,DATASTOR             PUT GDSCB ADDR IN PLIST          41000021
         ST    R3,DATASTOR+4           PUT GSPARRAY ADDR IN PLIST       41200021
         LA    R1,DATASTOR             SET PLIST REG                    41400021
         L     R5,24(R3)               GET STATAB ADDR                  41600021
         L     R15,DATDISP(R5)         GET EP ADDR                      41800021
         BALR  R14,R15                 LINK WITH DATA STORE             42000021
*                                                                       42200021
*TEST FOR SUCCESSFUL COMPLETION OF DATA STORE ROUTINE.                  42400021
*                                                                       42600021
         LTR   R15,R15                                                  42800021
         BP    LKBLTH4                                                  43000021
*                                                                       43200021
*TEST GENCODE FOR STATUS. GENCODE=1, STATUS IS INCLUDE. GENCODE=2,      43400021
*STATUS IS OMIT. IF NO GENCODE IS GIVEN STATUS IS INCLUDE. IF GENCODE   43600021
*IS SPECIFIED NOT EQUAL TO 1 OR 2 THE GSPARRAY IS SET TO INDICATE THE   43800021
*ERROR.                                                                 44000021
*                                                                       44200021
LKBLTF3  CLC   PARMS+20(4),ZERO        WSS GENCODE PARAM PASSED         44400021
         BE    LKBLTF4                 NO                               44600021
         L     R4,PARMS+20             GET GENCODE ADDR                 44800021
         LA    R5,1                                                     45000021
         C     R5,0(R4)                DOES GENCODE = 1                 45200021
         BE    LKBLTF4                 YES                              45400021
         LA    R5,2                                                     45600021
         C     R5,0(R4)                DOES GENCODE = 2                 45800021
         BE    LKBLTJ3                 YES                              46000021
LKBLTF3A MVI   19(R3),X'06'            ERROR - GENCODE INCORRECT        46200021
         B     LKBLTC1                                                  46400021
*                                                                       46600021
*GENCODE = 2. IF LEVEL 2 HAS BEEN SPECIFIED THE GSPARRAY IS SET TO      46800021
*INDICATE THE ERROR.                                                    47000021
*                                                                       47200021
LKBLTJ3  TM    GDSFLAGS,X'10'          WAS LEVEL 2 SUPPOER REQUESTED    47400021
         BO    LKBLTF3A                YES                              47600021
*                                                                       47800021
*GENCODE = 2, LEVEL = 1. IF LKSUB HAS NOT BEEN KEYED OR CORRELATED THE  48000021
*GSPARRAY IS SET TO INDICATE THE ERROR.                                 48200021
*                                                                       48400021
LKBLTK3  CLC   PARMS+12(4),ZERO        WAS LINK CORVAL PARAM PASSED     48600021
         BE    LKBLTK3A                NO                               48800021
         L     R4,PARMS+12             GET CORVAL ADDR FROM PLIST       49000021
         MVC   KEY+8(4),0(R4)          PUT CORVAL IN KEY                49200021
         B     LKBLTK4                                                  49400021
LKBLTK3A CLC   PARMS+16(4),ZERO        WAS LINK KEY PARAM PASSED        49600021
         BE    LKBLTC1                 NO                               49800021
*                                                                       50000021
*SET LINKAGE STATUS TO OMIT                                             50200021
*                                                                       50400021
LKBLTK4  NI    KEY+4,X'FB'             SET STATUS TO OMIT               50600021
         B     LKBLTG5                                                  50800021
*                                                                       51000021
*GENCODE WAS NOT SPECIFIED OR GENCODE=1. SET STATUS TO INCLUDE. IF A    51200021
*LINKCORVAL AND/OR A LINKKEY PARAM WAS PASSED A KEY IS BUILT. IF        51400021
*NEITHER PARAM WAS PASSED EXIT TO MAINLINE.                             51600021
*                                                                       51800021
LKBLTF4  OI    KEY+4,X'04'             SET STATUS TO INCLUDE            52000021
         CLC   PARMS+12(4),ZERO        WAS LINK CORVAL PASSED           52200021
         BE    LKBLTF4A                NO                               52400021
         L     R4,PARMS+12             GET CORVAL ADDR FROM PLIST       52600021
         MVC   KEY+8(4),0(R4)          PYT CORVAL IN KYE                52800021
         B     LKBLTG5                                                  53000021
LKBLTF4A CLC   PARMS+16(4),ZERO        WAS LINK KEY PASSED              53200021
         BE    LKBLTH4                 NO                               53400021
*                                                                       53600021
*LINKEY AND/OR LINKCORVAL HAVE BEEN PASSED. BUILD KEY TO RETURN. IF     53800021
*LEVEL 1 STORE KEY IN KEY TABLE.                                        54000021
*                                                                       54200021
LKBLTG5  OI    KEY+4,X'80'             SET MULTIPLE FLAG                54400021
         OI    KEY+4,X'18'             IDENTIFY AS KEY FOR SUBRTN LINK  54600021
         L     R4,GDSAOACB             GET OACB ADDR                    54800021
         L     R4,52(R4)               GET LOG BFR ADDR OF OLP          55000021
         TM    GDSFLAGS,X'10'          WAS LEVEL 1 REQUESTED            55200021
         BO    LKBLTG5A                NO                               55400021
         SH    R4,C16                  COMPUTE LOG BFR START ADDR       55600021
         STH   R4,KEY+2                PUT LOG BFR START ADDR IN KEY    55800021
         LA    R4,16                   GET LINKAGE LENGTH               56000021
         STH   R4,KEY                  PUT LENGTH IN KEY                56200021
         B     LKBLTJ5                                                  56400021
LKBLTG5A SH    R4,C12                  COMPUTE LOG BFR START ADDR       56600021
         STH   R4,KEY+2                PUT LOG BFR START ADDR IN KEY    56800021
         LA    R4,12                   GET LINKAGE LENGTH               57000021
         STH   R4,KEY                  PUT LENGTH IN KEY                57200021
         B     LKBLTH4                                                  57400021
*                                                                       57600021
*SETUP KEY TABLE MANAGEMENT PLIST                                       57800021
*                                                                       58000021
LKBLTJ5  ST    R8,KEYPLIST             PUT GDSCB ADDR IN PLIST          58200021
         LA    R4,KEYCODE1                                              58400021
         ST    R4,KEYPLIST+4           PUT CODE ADDR IN PLIST           58600021
         LA    R4,KEY                                                   58800021
         ST    R4,KEYPLIST+8                                            59000021
         LA    R15,LKBKEY              LINK TO RTN THAT WILL INVOKE     59200021
         BALR  R6,R15                  KEY TABLE MANAGEMENT             59400021
*                                                                       59600021
*TEST FOR SUCCESSFUL COMPLETION OF KEY TABLE MANAGEMENT                 59800021
*                                                                       60000021
         LTR   R15,R15                 WAS KEY TABLE MGMT SUCCESSFUL    60200021
         BZ    LKBLTJ5A                YES                              60400021
         MVI   19(R3),X'02'            ERROR - KEY NOT ADDED TO TABLE   60600021
         B     LKBLTC1                                                  60800021
*                                                                       61000021
*RETURN KEY IN WORD PROVIDED IF LKSUB HAS BEEN KEYED                    61200021
*                                                                       61400021
LKBLTJ5A CLC   PARMS+16(4),ZERO        WAS LINKEY PARAM SPECIFIED       61600021
         BE    LKBLTH4                 NO                               61800021
         L     R4,PARMS+16             GET RETURN WORD ADDR             62000021
         MVC   0(4,R4),KEY             RETURN KEY                       62200021
*                                                                       62400021
*RETURN TO MAINLINE                                                     62600021
*                                                                       62800021
LKBLTH4  L     R13,SVAREA+4                                             63000021
         RETURN (14,12),T                                               63200021
*                                                                       63400021
*INVOKE KEY TABLE MANAGEMENT                                            63600021
*                                                                       63800021
LKBKEY   L     R5,24(R3)               GET STATUS TABLE ADDR            64000021
         L     R15,KEYDISP(R5)         GET EP ADDR                      64200021
         LTR   R15,R15                 HAS MODULE BEEN LOADED           64400021
         BZ    LKBLTC1             NO-ERROR                        000A 64600021
LKBKEYA  LA    R1,KEYPLIST                                              64800021
         BALR  R14,R15             BRANCH TO KEY TABLE MGMT        000A 65000021
         BR    R6                      RETURN                           65200021
*                                                                       66600021
*COMPUTE PHYSICAL BUFFER ADDRESSES NEEDED TP PROVIDE SUBROUTINE LINKAGE 66800021
*                                                                       67000021
*TEST FOR 128 BYTE GDOA                                                 67200021
*                                                                       67400021
LKBPHYS  LA    R4,128                                                   67600021
         CH    R4,GDSGDOAL             IS GDOA 128 BYTES                67800021
         BE    LKBPHYSD                YES                              68000021
*                                                                       68200021
*MULTIPLE 256 BYTE GDOA                                                 68400021
*                                                                       68600021
         LH    R6,GDSGDOAL             GET GDOA LENGTH FROM GDSCB       68800021
         SH    R6,C6                   COMPUTE DIVISOR                  69000021
LKBPHYSA LH    R5,2(R1)                GET LOG BFR START ADDR FROM KEY  69200021
         M     R4,C1                   PROPAGATE SIGN BIT               69400021
         DR    R4,R6                   COMPUTE ELEMENT NUMBER IN GDS.   69600021
*                                                                       69800021
*SEARCH BUFFER CONTROL TABLE FOR THIS BUFFER SEGMENT                    70000021
*                                                                       70200021
         LH    R6,GDSBCTEL             GET BCT INDEX                    70400021
         MH    R6,CH3                  COMPUTE PTR TP NEXT SEGMENT      70600021
         L     R7,GDSGTMCB             GET GTMCB ADDR                   70800021
         USING GTMCB,R7                ESTABLISH GTMCB ADDRESSABILITY   71000021
         L     R2,GTMBCTBL             GET BCT ADDR                     71200021
LKBPHYSB SR    R11,R11                                                  71400021
         IC    R11,2(R6,R2)            GET CT FIELD FROM BCT            71600021
         CR    R11,R5                  IS THIS THE SOUGHT AFTER SEGMENT 71800021
         BE    LKBPHYSC                YES                              72000021
*                                                                       72200021
*TEST LOGICAL BUFFER ADDRESS IN KEY FOR CORRECTNESS                     72400021
*                                                                       72600021
         IC    R11,1(R2,R6)            GET PTR TO NEXT SEGMENT          72800021
         MH    R11,CH3                 EXPAND BCT INDEX                 73000021
         CR    R6,R11                  ARE PTR AND INDEX EQUAL          73200021
         BE    LKBLTC1                 YES                              73400021
         LR    R6,R11                                                   73600021
         B     LKBPHYSB                                                 73800021
*                                                                       74000021
*PROPER BUFFER CONTROL TABLE ENTRY HAS BEEN FOUND. COMPUTE PHYSICAL     74200021
*BUFFER ADDRESS.                                                        74400021
*                                                                       74600021
LKBPHYSC LR    R5,R6                   PREPARE DIVIDEND                 74800021
         LR    R6,R4                   TRASFER REMAINDER                75000021
         M     R4,C1                   PROPAGATE SIGN                   75200021
         D     R4,C3                   COMPUTE SEGMENT NUMBER           75400021
         MH    R5,C256                 COMPUTE NUMBER OF BYTES          75600021
         LA    R4,8(R5,R6)             COMPUTE PHYS BFR ADDR FOR GMVA   75800021
         LA    R5,2(R4)                COMPUTE PHYS BFR ADDR FOR GTRU   76000021
         BR    R14                                                      76200021
*                                                                       76400021
*COMPUTE PHYSICAL BUFFER ADDR FOR A 128 BYTE GDOA                       76600021
*                                                                       76800021
LKBPHYSD LH    R11,GDSBCTEL            GET BCT INDEX                    77000021
         LH    R6,2(R1)                GET LOG BFR START ADDR FROM KEY  77200021
         LR    R5,R11                                                   77400021
         MH    R5,C256                 COMPUTE BFR STAT ADR OF SEGMENT  77600021
         MH    R11,CH3                 EXPAND BCT INDEX                 77800021
         L     R4,GTMBCTBL             GET BCT ADDR                     78000021
         AR    R4,R11                  COMPUTE BCT SEGMENT ADDR         78040021
         CLC   0(1,R4),GDSBCTID        FIRST OR SECOND HALF OF SEGMENT  78080021
         BE    LKBPHYSE                FIRST                            78120021
         LA    R4,136(R5,R6)           COMPUTE PHYS BFR ADDR FOR GMVA   78160021
         LA    R5,2(R4)                COMPUTE PHYS BFR ADDR FOR GTRU   78200021
         BR    R14                                                      78240021
LKBPHYSE LA    R4,8(R5,R6)             COMPUTE PHYS BFR ADDR FOR GMVA   78280021
         LA    R5,2(R4)                COMPUTE PHYS BFR ADDR FOR GTRU   78320021
         BR    R14                                                      78400021
         EJECT                                                          78600021
*                                                                       78800021
*DEFINED CONSTANTS                                                      79000021
*                                                                       79200021
DATSTOR2 DC    X'18000010'                                              79400021
         GINIT                                                          79600021
LABEL    GTRU  0                                                        79800021
         GMVA  0,LABEL                                                  80000021
         GTRU  0                                                        80200021
         GPDI                                                           80400021
DATSTOR1 DC    X'0800000C'                                              80600021
         GINIT                                                          80800021
         GMVA  0,LABEL                                                  81000021
LABLE    GTRU  0                                                        81200021
         GPDI                                                           81400021
KEYCODE1 DC    F'1'                                                     81600021
KEYCODE2 DC    F'2'                                                     81800021
KEYCODE5 DC    F'5'                                                     82000021
ZERO     DC    F'0'                                                     82200021
C1       DC    F'1'                                                     82400021
C3       DC    F'3'                                                     82600021
CF256    DC    F'256'                                                   82800021
GDSID    DC    X'F203'                                                  83000021
GTRU     DC    X'2AFF'                                                  83200021
GNOP4    DC    X'2AC0'                                                  83400021
C2       DC    H'2'                                                     83600021
CH3      DC    H'3'                                                     83800021
C4       DC    H'4'                                                     84000021
C6       DC    H'6'                                                     84200021
C12      DC    H'12'                                                    84400021
C16      DC    H'16'                                                    84600021
C256     DC    H'256'                                                   84800021
*                                                                       85000021
*EQUATES                                                                85200021
*                                                                       85400021
CVTLINK  EQU   8                                                        85600021
KEYDISP  EQU   828                                                      85800021
DATDISP  EQU   852                                                      86000021
*                                                                       86200021
*WORK AREA DSECT                                                        86400021
*                                                                       86600021
WRKSECT  DSECT                                                          86800021
SVAREA   DS    18F                                                      87000021
PARMS    DS    6F                                                       87200021
KEYPLIST DS    10F                                                      87400021
KEY      DS    3F                                                       87600021
DATASTOR DS    12F                                                      87800021
         COPY  GDSCB                                                    88000021
         COPY  GSPCB                                                    88200021
         COPY  GTMCB                                                    88400021
         END                                                            88600021
./  ADD  SSI=20480251,NAME=IFFAFA09
*TITLE         INCL/OMIT                                                00200021
*                                                                       00400021
*ENTRY POINT   IFFAFA09/IFFAFA10                                        00600021
*                                                                       00800021
*INPUT         IN REGISTER 1 THE ADDRESS OF A WORK AREA                 01000021
*                 IN THE FIRST WORD OF THE WORK AREA THE ADDRESS OF     01200021
*                 A VARIABLE LENGTH PARAMETER LIST                      01400021
*                    +0 A(GDSCB)                                        01600021
*                    +4 A(CORRVAL)   OPTIONAL                           01800021
*                    +8 A(KEY)       OPTIONAL                           02000021
*                 IN THE SECOND WORD OF THE WORK AREA THE ADDRESS OF    02200021
*                 THE GSP RETURN ARRAY                                  02400021
*                                                                       02600021
*OUTPUT        NONE TO CALLER. THE SPECIFIED ELEMENT, SEQUENCE, GRAPHIC 02800021
*              SUBROUTINE, OR GRAPHIC DATA SET WILL BE PUT IN EITHER    03000021
*              INCLUDE STATUS (IN WHICH CASE THE IMAGE WILL APPEAR) OR  03200021
*              OMIT STATUS (IN WHICH CASE THE IMAGE WILL NOT APPEAR)    03400021
*                                                                       03600021
*FUNCTION      TO CAUSE A SPECIFIED TO APPEAR OR NOT TO APPEAR. NOTE    03800021
*              THAT IF NEITHER A KEY NOR A CORRELATION VALUE IS         04000021
*              SPECIFIED OR IF LEVEL 2 HAS BEEN REQUESTED PREVIOUSLY    04200021
*              THE ENTIRE CURRENT GRAPHIC DATA SET WILL BE PUT IN THE   04400021
*              REQUESTED STATUS.                                        04600021
*                                                                       04800021
*                                                                       05000021
*INTERNAL ROUTINES  KEY TABLE MGMT, GWRITE MACRO INSTRUCTION            05200021
*                                                                       05400021
*EXIT          TO CALLER WITH RETURN CODE SET                           05600021
*                                                                       05800021
         EJECT                                                          06000021
*                                                                       06200021
*REGISTER UTILIZATION                                                   06400021
*                                                                       06600021
R0       EQU   0                                                        06800021
R1       EQU   1        PLIST REG                                       07000021
R2       EQU   2        HOLDS P/P PLIST                                 07200021
R3       EQU   3        HOLDS GSPARRAY ADDR                             07400021
R4       EQU   4        WORK REG                                        07600021
R5       EQU   5        WORK REG                                        07800021
R6       EQU   6                                                        08000021
R7       EQU   7                                                        08200021
R8       EQU   8                                                        08400021
R9       EQU   9                                                        08600021
R10      EQU   10                                                       08800021
R11      EQU   11                                                       09000021
R13      EQU   13                                                       09200021
R14      EQU   14                                                       09400021
R15      EQU   15                                                       09600021
         EJECT                                                          09800021
IFFAFA09 CSECT                                                          10000021
*0875,                                                             9293 10030021
*0875,512600                                                       5398 10060021
*2230,308000,312000,326000-338000                                  000A 10100021
*                                                                       10200021
*ENTRY TO INCLUDE. SAVE REGISTERS AND SET SWITCH TO REMEMBER ENTRY      10400021
*POINT                                                                  10600021
*                                                                       10800021
         ENTRY IFFAFA10                                                 11000021
         USING *,15                                                     11200021
         SAVE  (14,12)                                                  11400021
         LA    R11,N1                  SET SW TO INDICATE INCLUDE       11600021
         B     INOLWB2                                                  11800021
         DROP  R15                                                      12000021
*                                                                       12200021
*ENTRY TO OMIT. SAVE REGISTERS AND SET SWITCH TO REMEMBER ENTRY POINT.  12400021
*                                                                       12600021
IFFAFA10 SAVE  (14,12)                                                  12800021
         SR    R11,R11                 SET SW TO INDICATE OMIT          13000021
*                                                                       13200021
*PERFORM NORMAL HOUSEKEEPING AND INITIALIZATION FUNCTIONS - CHAIN SAVE  13400021
*AREAS, ESTABLISH ADDRESSABILITIES, ZERO FIELDS, ETC                    13600021
*                                                                       13800021
INOLWB2  BALR  R9,R0                                                    14000021
         USING *,R9                    ESTABLISH CSECT ADDRESSABILITY   14200021
         LA    R10,N8(R1)              GET WORK AREA ADDR               14400021
         USING INOWORK,R10             ESTABLISH WORK AREA ADDRESSABIL  14600021
         L     R2,N0(R1)               GET PLIST ADDR                   14800021
         L     R3,N4(R1)               GET GSPARRAY ADDR                15000021
         ST    R13,INOSAVE+4           CHAIN SAVE AREAS                 15200021
         LA    R4,INOSAVE                                               15400021
         ST    R4,N8(R13)                                               15600021
         LR    R13,R4                  SET SAVE AREA REG                15800021
         L     R8,N0(R2)               GET PTR TO GDSCB ADDR            16000021
         L     R8,N0(R8)               GET GDSCB ADDR                   16200021
         USING GDSCB,R8                ESTABLISH GDSCB ADDRESSABILITY   16400021
         L     R7,GDSGTMCB             GET GTMCB ADDR FROM GDSCB        16600021
         USING GTMCB,R7                ESTABLISH GTMCB ADDRESSABILITY   16800021
         XC    N0(N20,R3),N0(R3)       ZERO GSPARRAY                    17000021
         XC    WRKSW(2),WRKSW           ZERO SWITCH AREA                17100021
         EJECT                                                          17150021
*                                                                       17200021
*TEST FOR CONTROL BLOCK VALIDITY. IF GDS IS UNOPEN OR INVALID THE       17400021
*GSPARRAY IS SET TO INDICATE THE ERROR.                                 17600021
*                                                                       17800021
         CLC   GDSVALID(2),GDSID       IS CONTROL BLOCK VALID           18000021
         BE    INOLWC2                 YES                              18200021
         MVI   19(R3),X'01'                                             18400021
INOLWD1  MVI   0(R3),X'08'             PARAM ERROR                      18600021
         B     INOLVG3                                                  18800021
         SPACE 3                                                        18900021
*                                                                       19000021
*TEST FOR LEVEL OF SUPPORT. IF LEVEL 1 A KEY AND/OR A CORVAL MUST HAVE  19200021
*BEEN SPECIFIED IF THE ENTIRE GDS IS NOT TO BE INCLUDED. IF LEVEL 2     19400021
*A KEY MUST NOT HAVE BEEN PASSED.                                       19600021
*                                                                       19800021
INOLWC2  TM    GDSFLAGS,X'10'          IS LEVEL 2 SUPPORT REQUESTED     20000021
         BO    INOLWD2                 YES                              20200021
*                                                                       20400021
*LEVEL 1. KEY AY AND/OR CORVAL WAS PASSED LOCATE KEY IN KEY TABLE. IF   20600021
*NEITHER WAS PASSED INCLUDE/OMIT THE ENTIRE CURRENT GDS.                20800021
*                                                                       21000021
         TM    N0(R2),X'80'            WAS A KEY AND/OR CORVAL PASSED   21200021
         BO    INOLWC4                 NO                               21400021
         TM    N4(R2),X'80'            WAS A KEY FIELD PARAM PASSED     21600021
         BO    INOLWC3B                NO                               21800021
         CLC   N9(N3,R2),N21(R3)       WAS NULL VAR PASSED IN KEY FIELD 22000021
         BNE   INOLWD3                 NO                               22200021
INOLWC3B CLC   N5(N3,R2),N21(R3)       WAS NULL PASSED IN CORVAL FIELD  22400021
         BE    INOLWC4                 YES                              22600021
*                                                                       22800021
*CORVAL HAS BEEN SPECIFIED. BEGIN KEY TABLE MGMT PARAMETER LIST.        23000021
*                                                                       23200021
         LA    R4,KEYCODE5                                              23400021
         ST    R4,KEYPLIST+4           INDICATE SEARCH FOR CORVAL       23600021
         MVC   KEYPLIST+9(3),5(R2)     PUT CORVAL ADDR IN PLIST         23800021
         B     INOLWD3A                                                 24000021
INOLWD2  TM    N0(R2),X'80'            WAS A KEY AND/OR A CORVAL PASSED 24200021
         BO    INOLWC4                 NO                               24400021
         TM    N4(R2),X'80'            WAS A KEY FIELD PARAM PASSED     24600021
         BO    INOLWC4                 NO                               24800021
         CLC   N9(N3,R2),N21(R3)       HAS NULL VAR REPLACED KEY        25000021
         BNE   INOLWD1                 NO                               25200021
         EJECT                                                          25300021
*                                                                       25400021
*LEVEL 2. IF NO KEY HAS BEEN SPECIFIED THE ENTIRE GDS WILL BE INCLUDED  25600021
*OR OMITTED. IF A KEY IS SPECIFIED THE GSPARRAY IS SET TO INDICATE THE  25800021
*ERROR.                                                                 26000021
*                                                                       26200021
INOLWC4  LH    R14,GDSFCBUF            GET BFR ADDR OF FLOW CTL ENTRY   26400021
         LTR   R14,R14                 IS THERE A FLOW CONTROL ENTRY    26600021
         BZ    INOLWD1                 NO                               26800021
         OI    WRKSW,X'01'             INDICATE INCLUDE/OMIT ENTIRE GDS 26900021
         LA    R3,2(R14)               COMPUTE PHYSICAL BFR ADDR        27000021
         LA    R5,GNOP                 GET GNOP ADDR                    27200021
         LTR   R11,R11                 WAS OMIT REQUESTED               27400021
         BZ    INOLVE1                 YES                              27600021
         B     INOLWD4                                                  27800021
*                                                                       28000021
*LEVEL 1, KEY PARAMETER SPECIFIED. BEGIN KEY TABLE MANAGEMENT PARAMETER 28200021
*LIST.                                                                  28400021
*                                                                       28600021
INOLWD3  LA    R4,KEYCODE                                               28800021
         ST    R4,KEYPLIST+4           INDICATE SEARCH FOR KEY          29000021
*                                                                       29200021
*COMPLETE PARAMETER LIST. INVOKE KEY TABLE MANAGEMENT.                  29400021
*                                                                       29600021
         MVC   KEYPLIST+8,N8(R2)       PUT KEY ADDR IN PLIST            29800021
INOLWD3A ST    R8,KEYPLIST             PUT GDSCB ADDR IN PLIST          30000021
         L     R4,N24(R3)              GET STATUS TABLE ADDR            30200021
         L     R15,KEYDISP(R4)         GET KEY TABLE MGMT EP ADDR       30400021
         LTR   R15,R15                 HAS KEY TBL MGMT BEEN LOADED     30600021
         BZ    INOLWD1             NO-ERROR                        000A 30800021
INOLWD3B LA    R1,KEYPLIST             GET KEY TABLE MGMT PLIST         31000021
         BALR  R14,R15             BRANCH TO KEY TABLE MGMT        000A 31200021
*                                                                       31400021
*TEST FOR SUCCESSFUL COMPLETION OF KEY TABLE MANAGEMENT.                31600021
*                                                                       31800021
         LTR   R15,R15                 WAS KEY/CORVAL FOUND             32000021
         BP    INOLWD1                 NO                               32200021
         B     INOLWF3                                                  32400021
         EJECT                                                          33200021
*SET KEY FLAG TO INDICATE WHETHER INCLUDE OR OMIT STATUS.               34000021
*                                                                       34200021
INOLWF3  LTR   R11,R11                 WAS OMIT CALLED                  34400021
         BZ    INOLWF4                 YES                              34600021
         OI    4(R1),X'04'             SET KEY FLAG TO INCLUDE          34800021
         B     INOLWH3                                                  35000021
INOLWF4  NI    4(R1),X'FB'             SET KEY FLAG FOR OMIT            35200021
*                                                                       35400021
*SET SWITCH TO REMEMBER SINGLE OR MULTIPLE VECTORS.                     35600021
*                                                                       35800021
INOLWH3  TM    N4(R1),X'80'            TEST FOR MULTIPLE VECTORS        36000021
         BZ    INOLWH2                 SINGLE                           36200021
         LA    R0,1                    SET SW TO INDICATE MULT VECTORS  36400021
         B     INOLWJ3                                                  36600021
INOLWH2  SR    R0,R0                   SET SW TO INKICATE SINGLE VECTOR 36800021
*                                                                       37000021
*TEST FOR 128 BYTE GDOA                                                 37200021
*                                                                       37400021
INOLWJ3  LA    R4,128                                                   37600021
         CH    R4,GDSGDOAL             IS GDOA 128 BYTES                37800021
         BE    INOLWJ4                 YES                              38000021
         EJECT                                                          38100021
*                                                                       38200021
*COMPUTE PHYSICAL BUFFER ADDRESS FOR A 256 BYTE MULTIPLE GDOA.          38400021
*                                                                       38600021
         LH    R6,GDSGDOAL             GET GDOA LENGTH FROM GDSCB       38800021
         SH    R6,C6                                                    39000021
         LH    R5,N2(R1)               GET LOG BFR START ADDR           39200021
         M     R4,C1                                                    39400021
         DR    R4,R6                   COMPUTE ELEMENT NUMBER IN GDS    39600021
         LH    R6,GDSBCTEL             GET BCT INDEX                    39800021
         MH    R6,CH3                  EXPAND BCT INDEX                 40000021
         L     R2,GTMBCTBL             GET BCT ADDR FROM GTMCB          40200021
INOLWK3A SR    R14,R14                                                  40400021
         IC    R14,2(R6,R2)            GET CT FIELD FROM BCT            40600021
         CR    R14,R5                  IS THIS LAST SEGMENT OF ELEMENT  40800021
         BE    INOLWK3B                YES                              41000021
         SR    R14,R14                                                  41200021
         IC    R14,1(R6,R2)            GET PTR TO MEXT SEGMENT          41400021
         MH    R14,CH3                 COMPUTE PTR TO NEXT SEGMENT      41600021
         CR    R6,R14                  ARE PTR AND INDEX EQUAL          41800021
         BE    INOLWD1                 YES                              42000021
         LR    R6,R14                                                   42200021
         B     INOLWK3A                                                 42400021
INOLWK3B LR    R5,R6                   TRANSFER BCT INDEX               42600021
         LR    R6,R4                   TRANSFER REMAINDER               42800021
         M     R4,C1                   PROPAGATE SIGN FOR DIVIDE        43000021
         D     R4,C3                   COMPUTE SEGMENT NUMBER           43200021
         MH    R5,C256                 COMPUTE NUMBER OF BYTES          43400021
         LA    R3,N2(R5,R6)            COMPUTE PHYSICAL BFR ADDR        43600021
         B     INOLVA2                                                  43800021
*                                                                       44000021
*COMPUTE PHYSICAL BUFFER ADDRESS FOR A 128 BYTE GDOA.                   44200021
*                                                                       44400021
INOLWJ4  LH    R3,GDSBCTEL             GET BCT INDEX                    44600021
         LH    R6,2(R1)                GET LOG BFR START ADDR FROM KEY  44800021
         LR    R5,R3                                                    45000021
         MH    R5,C256                 COMPUTE BFR START ADR OF SEGMENT 45200021
         L     R4,GTMBCTBL             GET BCT ADDR                     45400021
         MH    R3,CH3             CALCULATE DISPL FROM INDEX       5398 45420021
         AR    R4,R3                   COMPUTE BCT SEGMENT ADDR         45450021
         CLC   0(1,R4),GDSBCTID        FIRST OR SECOND HALF OF SEGMENT  45500021
         BE    INOLWJ4A                FIRST                            45550021
         LA    R3,130(R5,R6)           COMPUTE PHYS BFR ADDR            45600021
         B     INOLVA2                                                  45650021
INOLWJ4A LA    R3,2(R5,R6)             COMPUTE PHYS BFR ADDR            45700021
         EJECT                                                          45750021
*                                                                       45800021
*IF MULTIPLE VECTORS AND BUFFER SUBROUTINE ADD 8 TO THE PHYSICAL        46000021
*BUFFER ADDRESS. IF OMIT STATUS SETUP A GTRU ORDER. IF INCLUDE STATUS   46200021
*SETUP A GNOP ORDER                                                     46400021
*                                                                       46600021
INOLVA2  LTR   R0,R0                   TEST FOR SINGLE VECTOR           46800021
         BE    INOLVA3                 SINGLE                           47000021
         TM    N4(R1),X'38'       ORGEN PUTS INCL/OMIT AT TOP SO   9293 47060021
         BO    INOLVC1               SKIP CHECK FOR BFR SUBRTN     9293 47120021
         TM    N4(R1),X'28'            TEST FOR BFR SUBRTN              47200021
         BC    14,INOLVC1              NOT A SUBRTN                     47400021
INOLVB1  LA    R3,N8(R3)               COMPUTE PHYSICAL BFR ADDR        47600021
INOLVC1  LTR   R11,R11                 WAS OMIT CALLED                  47800021
         BZ    INOLWD4                 YES                              48000021
         LA    R5,GNOP                 GET GNOP ADDR                    48200021
         B     INOLVE1                                                  48400021
INOLWD4  LA    R5,GTRU                 GET GTRU ADDR                    48600021
*                                                                       48800021
*SETUP GWRITE MACRO PARAMETERS                                          49000021
*                                                                       49200021
*                                                                       49400021
INOLVE1  LA    R6,2                    SET LENTH COUNT                  49600021
INOLVE1A STH   R3,BFRAD                                                 49800021
         L     R4,GTMGRDCB             GET GRAPHIC DCB ADDR             50000021
         EJECT                                                          50005021
*                                                                       50010021
*IF AN EQUIVALENT GDS HAS BEEN REFERENCED THE BUFFER COPY (IF THERE IS  50020021
*A COPY IN THE BUFFER) AND THE GDOA COPY MUST BOTH BE CHANGED. IF THE   50030021
*GDS IS NOT EQUIVALENT OR IF THE STATUS OF THE ENTIRE GDS IS TO CHANGE  50034021
*ONLY THE BUFFER COPY MUST BE CHANGED                                   50038021
         TM    WRKSW,X'01'             WAS STATUS OF ENTIRE GDS CHANGED 50042021
         BO    INOLVE1B                YES                              50046021
*                                                                       50050021
         TM    GDSFLAGS,X'08'          WAS AN EQUIVALENT GDS REFERENCED 50060021
         BZ    INOLVE1B                NO                               50070021
         L     R2,GDSAOACB             GET OACB ADDR                    50080021
         S     R3,24(R2)               COMPUTE ADDR OF ORDER IN GDOA    50090021
         A     R3,12(R2)                                                50100021
         S     R6,C1                   SETUP LENGTH FIELD FOR EXECUTE   50110021
         EX    R6,MOVE                 MOVE ORDER INTO GDOA             50120021
         LA    R6,1(R6)                 RESTORE LENGTH COUNT            50125021
         TM    GDSFLAGS,X'80'          IS EQUIVALENT GDS IN BUFFER      50130021
         BZ    INOLVG3                 NO                               50140021
         EJECT                                                          50170021
*                                                                       50200021
*ISSUE WAIT FOR LAST I/O. PUT GTRU/GNOP ORDER IN BUFFER.                50400021
*                                                                       50600021
INOLVE1B L     R1,GTMDECB1             GET GRAPHIC ECB ADDR             50800021
         WAIT  ECB=(1)                 WAIT FOR COMPLETION OF LAST I/O  51000021
         L     R1,GTMDECB1                                              51200021
         CLI   0(R1),X'7F'             TEST FOR SUCCESSFUL I/O          51220021
         BE    INOLVE1C                SUCCESS                          51240021
IOERET   L     R3,GTMGSPCB        GSPCB ADDR                       5398 51260021
         USING GSPCB,R3                                                 51280021
         MVI   GSPARRAY,X'04'          SET I/O ERROR CODE               51300021
         B     INOLVG3                                                  51320021
INOLVE1C NI    0(R1),X'BF'             TURN OFF ECB COMPLETION FLAG     51340021
         ST    R6,20(R1)               PUT LENGTH IN DECB               51400021
         L     R6,GDSAOACB                                              51420021
         L     R6,0(R6)                                                 51440021
         L     R6,4(R6)                                                 51460021
         MVC   0(2,R6),BFRAD            BUFFER START ADDRESS            51480021
         MVC   2(2,R6),0(R5)            GRAPHIC ORDER                   51500021
         LA    R5,2(R6)                                                 51520021
         GWRITE (1),STR,(4),,(5),(6),GDSFCBUF,MF=E                      52020021
         LTR   R15,R15            I/O START OK                     5398 52120021
         BNZ   IOERET                IF NO, USE I/O ERROR RETURN   5398 52220021
INOLVG3  L     R13,INOSAVE+4                                            52320021
         RETURN (14,12),T                                               52420021
         EJECT                                                          52520021
*                                                                       52800021
*THE CASE OF A SINGLE VECTOR HAS BEEN DETERMINED. NOW DETERMINE THE     53000021
*MODE. THE BYTE OF THE MODE ORDER WHICH CONTAINS THE BEAM BIT IS KEPT   53200021
*IN THE FIFTH BYTE OF THE KEY. IF THE MODE IS ABSOLUTE THE BEAM BIT IS  53400021
*THE SECOND BIT OF THE DATA BYTE. IF THE MODE IS INCREMENTAL THE BEAM   53600021
*BIT IS THE EIGHTH BIT OF THE DATA BYTE. THE VECTOR IS OMITTED BY       53800021
*TURNING THE BEAM BIT ON, IT IS INCLUDED BY TURNING THE BEAM BIT OFF.   54000021
*WHEN THE BEAM BIT HAS BEEN SET THE PHYSICAL BUFFER ADDRESS AT WHICH    54200021
*IT IS TO BE STORED IS COMPUTED AND IT IS WRITTEN TO THE BUFFER.        54400021
*                                                                       54600021
INOLVA3  TM    N4(R1),X'03'            IS MODE ABSOLUTE                 54800021
         BM    INOLVA4                 NO                               55000021
*                                                                       55200021
*THE MODE IS ABSOLUTE. DETERMINE WHETHER TO INCLUDE OR OMIT.            55400021
*                                                                       55600021
         LTR   R11,R11                 WAS OMIT CALLED                  55800021
         BZ    INOLVC3                 YES                              56000021
*                                                                       56200021
*INCLUDE                                                                56400021
*                                                                       56600021
         NI    N5(R1),X'BF'            UNBLANK MODE ORDER               56800021
         B     INOLVD3                                                  57000021
*                                                                       57200021
*OMIT                                                                   57400021
*                                                                       57600021
INOLVC3  OI    N5(R1),X'40'            BLANK MODE ORDER                 57800021
*                                                                       58000021
*DETERMINE IF,, IN THE BUFFER, A SET MODE ORDER PRECEDES THE VECTOR     58200021
*BEING CONSIDERED. IF THERE IS, TWO BYTES MUST BE ADDED TO THE BUFFER   58400021
*ADDRESS PREVIOUSLY COMPUTED.                                           58600021
*                                                                       58800021
INOLVD3  TM    N4(R1),X'40'            IS A MODE ORDER PRESENT          59000021
         BZ    INOLVF3                 NO                               59200021
         LA    R3,N2(R3)               COMPUTE PHYSICAL BFR ADDR        59400021
*                                                                       59600021
*PREPARE PARAMETERS FOR THE GWRITE MACRO                                59800021
*                                                                       60000021
INOLVF3  LA    R5,5(R1)                ADDR TO BE WRITTEN FROM          60200021
         LA    R6,1                    LENGTH TO BE WRITTEN             60400021
         B     INOLVE1A                                                 60600021
         EJECT                                                          60700021
*                                                                       60800021
*THE MODE IS INCREMENTAL. DETERMINE WHETHER TO INCLUDE OR OMIT.         61000021
*                                                                       61200021
INOLVA4  LTR   R11,R11                 WAS OMIT CALLED                  61400021
         BZ    INOLVA5                 YES                              61600021
*                                                                       61800021
*INCLUDE                                                                62000021
*                                                                       62200021
         NI    N5(R1),X'FE'            UNBLANK MODE ORDER               62400021
         B     INOLVC4                                                  62600021
*                                                                       62800021
*OMIT                                                                   63000021
*                                                                       63200021
INOLVA5  OI    N5(R1),X'01'            BLANK MODE ORDER                 63400021
*                                                                       63600021
*DETERMINE IF , IN THE BUFFER, A SET MODE ORDER PRECEDES THE VECTOR     63800021
*BEING CONSIDERED. IF THERE IS THREE BYTES MUST BE ADDED TO THE BUFFER  64000021
*ADDRESS PREVIOUSLY COMPUTED. IF THERE IS NOT, ONE BYTE MUST BE ADDED.  64200021
*                                                                       64400021
INOLVC4  TM    N4(R1),X'40'            IS A MODE ORDER PRESENT          64600021
         BZ    INOLVC5                 NO                               64800021
*                                                                       65000021
*SET MODE ORDER IS PRESENT. COMPUTE PHYSICAL BUFFER ADDRESS WHERE THE   65200021
*DATA BYTE IS TO BE WRITTEN                                             65400021
*                                                                       65600021
         LA    R3,N3(R3)               COMPUTE PHYSICAL BFR ADDR        65800021
         B     INOLVF3                                                  66000021
*                                                                       66200021
*SET MODE ORDER IS NOT PRESENT. COMPUTE PHYSICAL BUFFER ADDRESS WHERE   66400021
*THE DATA BYTE IS TO BE WRITTEN.                                        66600021
*                                                                       66800021
INOLVC5  LA    R3,N1(R3)               COMPUTE PHYSICAL BFR ADDR        67000021
         B     INOLVF3                                                  67200021
         EJECT                                                          67800021
*                                                                       68000021
*DEFINED CONSTANTS                                                      68200021
*                                                                       68400021
N0       EQU   0                                                        68600021
N1       EQU   1                                                        68800021
N2       EQU   2                                                        69000021
N3       EQU   3                                                        69200021
N4       EQU   4                                                        69400021
N5       EQU   5                                                        69600021
N8       EQU   8                                                        69800021
CVTLINK  EQU   8                                                        70000021
N9       EQU   9                                                        70200021
N20      EQU   20                                                       70400021
N21      EQU   21                                                       70600021
N24      EQU   24                                                       70800021
KEYDISP  EQU   828                                                      71000021
         GINIT                                                          71200021
GTRU     GTRU  0                                                        71400021
GNOP     GNOP4 0                                                        71600021
C1       DC    F'1'                                                     71800021
KEYCODE  DC    F'2'                                                     72000021
C3       DC    F'3'                                                     72200021
KEYCODE5 DC    F'5'                                                     72400021
CF256    DC    F'256'                                                   72600021
CH3      DC    H'3'                                                     72800021
C6       DC    H'6'                                                     73000021
C256     DC    H'256'                                                   73200021
GDSID    DC    X'F203'                                                  73400021
MOVE     MVC   0(0,R3),0(R5)           USED WITH EX INSTR               73500021
INOWORK  DSECT                                                          73600021
INOSAVE  DS    18F                                                      73800021
KEYPLIST DS    10F                                                      74000021
SUPPLIST DS    2F                                                       74200021
BFRAD    DS    H                                                        74400021
BFRSTART DS    H                                                        74500021
WRKSW    DS    H                                                        74550021
         COPY  GDSCB                                                    74600021
         COPY  GSPCB                                                    74700021
         COPY  GTMCB                                                    74800021
         END                                                            75000021
./  ADD  SSI=20480252,NAME=IFFAFA11
*                                                                       00100021
*        EXEC IS ENTERED FROM DIRECTOR PART 2 WITH THE ADDRESS OF       00200021
*        A WORK AREA IN REGISTER 1.  THE FIRST WORD OF THE WORK AREA    00300021
*        CONTAINS THE ADDRESS OF THE PARAMETER LIST BELOW.              00400021
*                                                                       00500021
*                   +0   A(GDSCB)                                       00600021
*                                                                       01000021
*                                                                       01500021
*                                                                       02000021
*                                                                       02040021
*        EXEC HAS NO EXTERNAL REFERENCES.                               02080021
*                                                                       02120021
*        EXTERNAL MACROS USED ARE:                                      02160021
*                                                                       02200021
*        GWRITE                                                         02240021
*        GCNTRL                                                         02280021
*        WAIT                                                           02320021
*                                                                       02360021
*                                                                       02400021
         EJECT                                                          02500021
*                                                                       02600021
*        ON ENTRY THE REGISTERS ARE SAVED, THE SAVE AREAS ARE CHAINED   02700021
*        AND THE RETURN ARRAY IS SET TO ZERO. IF THE GDSCB ADDRESS      02800021
*        IS FOUND TO BE VALID PROCESSING PROCEEDS.                      02900021
IFFAFA11 CSECT                                                          03000021
* 415000                                                         A25386 03200021
         SAVE  (14,12)                                                  03500021
         BALR  BASE,0                                                   04000021
         USING *,BASE              BASE REGISTER                        04500021
         LR    WORK,PARM                                                05000021
         USING WORKAREA,WORK       WORK AREA                            05500021
         L     PARM,WRKPARM                                             06000021
         L     REGC,WRKRTNCD                                            06500021
         XC    0(20,REGC),0(REGC)  ZERO RETURN ARRAY                    07000021
         LA    REGA,WRKSAVE        CHAIN SAVE AREAS                     07500021
         ST    REGA,8(SAVE)                                             08000021
         ST    SAVE,4(REGA)                                             08500021
         LR    SAVE,REGA                                                09000021
         L     GDSREG,0(PARM)                                           09500021
         L     GDSREG,0(GDSREG)                                         10000021
         USING GDSCB,GDSREG        GDSCB                                10500021
         C     GDSREG,GDSGDSCB     IS IT VALID                          11000021
         BNE   ERR1                NO EXIT                              11500021
         L     GTMREG,GDSGTMCB     GTMCB                                12000021
         USING GTMCB,GTMREG                                             12500021
         L     OACB,GDSAOACB       LOAD ADDR OF OACB                    13000021
         USING OACBAREA,OACB                                            13500021
*                                                                       13530021
*        EXEC IS CALLED TO WRITE DATA OUT FROM TWO AREAS, THE GDOA      13560021
*        AND THE GDSREPDT FIELD IN THE GDSCB.  IT MAY ALSO BE CALLED    13590021
*        TO MERELY START REGENERATION. IF INCUR HAD BEEN CALLED TO      13620021
*        INSERT A CURSOR INTO DATA THAT WAS IN THE GDOA AT THE TIME     13650021
*        THE ADDRESS OF THE CURSOR LOCATION WAS SAVED IN THE GDSCB      13680021
*        AND EXEC WILL WRITE THE CURSOR OUT.                            13710021
*        A CHECK IS MADE TO SEE IF ANY DATA HAD EVER BEEN PLACED IN     13740021
*        THE GDS.  IT NOT, THE ROUTINE EXITS WITH A GOOD RETURN CODE.   13770021
*        NEXT A CHECK IS MADE TO SEE IF ANY DATA IS IN THE GDOA.  IF    13800021
*        NONE EXISTS THE PROGRAM BRANCHES TO SEE IF THERE IS ANY        13830021
*        REPLACEMENT DATA IN THE GDSCB OR IF ALL THAT IS REQUIRED       13860021
*        IA A RESTART OF THE BUFFER.                                    13890021
*                                                                       13920021
         TM    STATUS,NOTUSED      HAS ANYTHING EVER BEEN PLACED IN GDS 14000021
         BO    EXC00400            NO, EXIT                             14500021
         CLC   CRSA,OLP            IS THERE ANYTHING IN THE GDOA        15000021
         BE    EXC00500            NO                                   15500021
         EJECT                                                          16000021
EXC00100 L     REGA,OLP                                                 16500021
         L     REGB,GTMGRDCB       LOAD DCB                             17000021
*                                                                       17100021
*        A CHECK IS MADE TO SEE IF THERE IS ANY REPLACEMENT DATA IN     17200021
*        THE GDSCB.  IF THERE IS IT IS WRITTEN OUT.                     17300021
         CLC   GDSREPDT,ZERO       ANY REPLACEMENT DATA TO BE WRITTEN   17500021
         BE    EXC00200            NO                                   18000021
         L     PARM,GTMDECB1       LOAD DECB                            18500021
         WAIT  ECB=(1)             WAIT                                 18700021
         L     PARM,GTMDECB1       WRITE OUT OVERLAY DATA               18900021
         CLI   0(PARM),X'7F'                                            19100021
         BNE   ERR2                                                     19300021
         NI    0(PARM),X'BF'                                            19800021
         GWRITE (PARM),BUF,(REGB),4,GDSREPDT,GDSREPPB,MF=E              20000021
         LTR   15,15                                                    20100021
         BNZ   ERR2                                                     20200021
         EJECT                                                          20500021
*                                                                       20580021
*        NEXT ANY DATA IN THE GDOA IS TO BE WRITTEN OUT. IF THIS IS     20660021
*        AN EQUIVALINCE GDS THE GTRU BACK TO THE FLOW CONTROL ENTRY     20740021
*        IS PLACED IN THE GDOA AND THE LENGTH OF THIS GWRITE IS         20820021
*        INCREASED BY FOUR.  THIS DATA IS THEN WRITTEN OUT.             20900021
EXC00200 CLC   CRSA,OLP            ANY DATA TO BE WRITTEN FROM GDOA     21000021
         BE    EXC00320            NO                                   21500021
         L     PARM,GTMDECB1       LOAD DECB                            22000021
         WAIT  ECB=(1)             WAIT                                 22500021
         L     REGC,OLP            CURRENT POS                          23000021
         S     REGC,CRSA           MINUS START = LENGTH                 23500021
         L     PARM,GTMDECB1                                            24000021
         TM    GDSFLAGS,EQUIV      IS THIS AN EQUIV                     24500021
         BO    EXC01000            YES, MOVE IN GTRU TO F/C             25000021
EXC00250 ST    REGC,LEN(PARM)      PLACE LENGTH IN DECB                 25500021
         L     REGD,CRSA                                                26000021
         CLI   0(PARM),X'7F'                                            26100021
         BNE   ERR2                                                     26200021
         NI    0(PARM),X'BF'                                            26300021
         GWRITE (PARM),BUF,(REGB),,(REGD),BUFSTART+2,MF=E               26500021
         LTR   15,15                                                    26600021
         BNZ   ERR2                                                     26700021
         EJECT                                                          27500021
*                                                                       27600021
*        IF THIS IS AN EQUIVALENCE GDS NO UPDATE OF THE OACB TAKES      27700021
*        PLACE.  OTHERWISE THE CRSA, BLP, BUFFER START, AND THE         27800021
*        LOGICAL START ADDRESS ARE UPDATED.                             27900021
         TM    GDSFLAGS,EQUIV      IS THIS PART OF AN EQUIV             28000021
         BO    EXC00340            YES                                  28500021
         CLC   CPU1,ZERO           IS UNRES ADDR IN CORE                29000021
         BE    EXC00300            NO                                   29500021
         L     REGA,CPU1           YES SET TO A BUFFER ADDR             30000021
         S     REGA,CRSA                                                30500021
         A     REGA,BUFSTART                                            31000021
         ST    REGA,BUF1                                                31500021
         XC    CPU1,CPU1           ZERO CPU ADDR                        31700021
EXC00300 A     REGC,BUFSTART       ADD LENGTH TO COMPUTE NEW BUFFER ST  32000021
         ST    REGC,BLP                                                 33000021
         MVC   CRSA,OLP            SET CRSA TO OLP                      33500021
         MVC   LOGSTART,LOGCURR    SET LOGSTART=LOGCURR                 34000021
         L     REGA,LENLEFT        BUFFER LENGTH=                       34500021
         LA    REGA,4(REGA)        LENGTH LEFT+4                        35000021
         ST    REGA,BUFLEN                                              35500021
EXC00320 OI    STATUS,DATAREP      SET SW TO SAVE 4 BYTES FOR DATA REP  36000021
         MVC   GDSREPDT,ZERO       ZERO DATA REP FIELDS IN GDSCB-DATA   36500021
         MVC   GDSREPPB,ZERO       PHYS BUFFER                          37000021
         EJECT                                                          37050021
*                                                                       37100021
*        A TEST IS MADE TO SEE IF THE CURSOR IS IN THIS GDS.  IF IT     37200021
*        IA AND IF IT STILL NEEDS TO BE WRITTEN OUT, IT IS WRITTEN      37300021
*        OUT AT THIS POINT.                                             37400021
EXC00340 L     PARM,GTMDECB1       GET DECB                             37500021
         TM    GDSFLAGS,CURSOR     IS THERE A CURSOR IN THIS GDS        38000021
         BZ    EXC00350            NO                                   38500021
         CLC   GTMCRLOC,ZERO       MUST IT BE WRITTEN OUT               39000021
         BE    EXC00350            NO                                   39500021
         L     PARM,GTMDECB1                                            40000021
         WAIT  ECB=(1)             WAIT                                 40200021
         L     PARM,GTMDECB1       WRITE OUT OVERLAY DATA               40400021
         CLI   0(PARM),X'7F'                                            40600021
         BNE   ERR2                                                     40800021
         NI    0(PARM),X'BF'                                            41300021
         GCNTRL (PARM),INS,(REGB),GTMCRLOC,MF=E  INSERT CURSOR          41500021
         LTR   15,15                                                    41520021
         BNZ   ERR2                                                     41540021
         EJECT                                                          41570021
*                                                                       41640021
*        AT THIS POINT THE EQUIVALENCE GDS WILL GO EXECUTE A GCNTRL     41710021
*        MACRO TO RESTART REGENERATION.  ALL OTHERS WILL WRITE OUT      41780021
*        THE GTRU BACK TO FLOW CONTROL INTO THE BUFFER AND EXIT.        41850021
*                                                                       41920021
EXC00350 TM    GDSFLAGS,EQUIV      IS THIS EQUIV                        42000021
         BO    EXC00600            YEX, WE ARE DONE                     42500021
         L     PARM,GTMDECB1       LOAD DECB                            42900021
         WAIT  ECB=(1)             WAIT                                 43300021
         MVC   BUFSTART,BLP                                             43700021
         L     PARM,GTMDECB1       DECB                                 44000021
         CLI   0(PARM),X'7F'                                            44100021
         BNE   ERR2                                                     44200021
         NI    0(PARM),X'BF'                                            44300021
         GWRITE (PARM),STR,(REGB),4,GDSOVDAT,BUFSTART+2,GDSFCBUF,MF=E   44500021
         LTR   15,15                                                    44600021
         BNZ   ERR2                                                     44700021
         EJECT                                                          45000021
         TM    GDSFLAGS,EQUIV      IS THIS EQUIV GDS                    45500021
         BO    EXC00600            YES                                  46000021
EXC00400 L     SAVE,4(SAVE)                                             46500021
         TM    GDSFLAGS,CURSOR     IS CURSOR PRESENT                    46600021
         BZ    EXC00450            NO                                   46700021
         XC    GTMCRLOC,GTMCRLOC   ZERO LOCATION                        46800021
EXC00450 RETURN (14,12),T,RC=(15)                                       47100021
         EJECT                                                          47300021
EXC00500 CLC   GDSREPDT,ZERO       IS ANYTHING IN REP DATA              47500021
         BNE   EXC00100            YES, SOMETHING HAS BEEN GEN SINCE    48000021
*                                  LAST EXEC                            48500021
*                                                                       48580021
*        IF NOTHING HAS BEEN GENERATED SINCE THE LAST CALL TO EXEC      48660021
*        AND THIS IS NOT AN EQUIVALENCE GRAPHIC DATA SET, REGENERATION  48740021
*        WILL BE STARTED WITH GCNTRL MACRO.                             48820021
*                                                                       48900021
         TM    GDSFLAGS,EQUIV      EQUIV                                49000021
         BO    EXC00200            YES, WRITE TO THE BUFFER             49500021
EXC00550 L     PARM,GTMDECB1       RESTART BUFFER REGENERATION          49800021
         WAIT  ECB=(1)             WAIT ON I/O                          50100021
         L     REGA,GTMGRDCB       ADDR OF DCB                          50400021
         L     PARM,GTMDECB1       ADDR OF DECB                         50700021
         CLI   0(PARM),X'7F'                                            51000021
         BNE   ERR2                                                     51300021
         NI    0(PARM),X'BF'                                            51800021
         GCNTRL (PARM),STR,(REGA),GDSFCBUF,MF=E                         52000021
         LTR   15,15                                                    52100021
         BNZ   ERR2                                                     52200021
         B     EXC00400            NO, RETURN                           52500021
         EJECT                                                          52550021
*                                                                       52600021
*        AT THIS POINT THE EQUIVALENCE GRAPHIC DATA SET HAS TO SHOW     52650021
*        THAT IT IS THE ONE IN THE BUFFER.  THIS INVOLVES TURNING OFF   52700021
*        THE FLAG IN ALL THE OTHER EQUIVALENCE GRAPHIC DATA SETS        52750021
*        ON THE CHAIN AND TURNING ON THE FLAG IN THIS GRAPHIC DATA      52800021
*        SET.  AFTER THIS IS DONE REGENERATION IS STARTED.              52850021
*                                                                       52900021
EXC00600 OI    GDSFLAGS,INBUF      SET SW TO SAY THIS EQUIV IN BUFFER   53000021
         L     REGA,GDSSHDBK       LOAD SHARED PTR BACK                 53500021
         LR    REGC,GDSREG    SAVE REGISTER                             53700021
         L     REGB,GDSSHDFD       LOAD FOREWARD                        54000021
         LR    GDSREG,REGA                                              54500021
EXC00700 C     GDSREG,ZERO         ANY MORE BACK                        55000021
         BE    EXC00800            NO                                   55500021
         NI    GDSFLAGS,NOTIN      TURN OFF IN BUFFER FLAG              56000021
         L     GDSREG,GDSSHDBK     PICK UP NEXT                         56500021
         B     EXC00700                                                 57000021
EXC00800 LR    GDSREG,REGB         PICK UP FOREWARD                     57500021
EXC00900 C     GDSREG,ZERO         ANY MORE                             58000021
         BE    EXC01100       RESET REG AND START REGENERATION          58500021
         NI    GDSFLAGS,NOTIN      TURN OFF IN BUFFER FLAG              59000021
         L     GDSREG,GDSSHDFD     PICK UP NEXT                         59500021
         B     EXC00900                                                 60000021
EXC01000 A     REGC,FOUR           ADD FOUR TO LENGTH                   60500021
         L     REGD,OLP            PICK UP OLP                          61000021
         MVC   0(4,REGD),GDSOVDAT  MOVE IN TO GDOA TEMPORARILY          61500021
         B     EXC00250            GO WRITE OUT GDOA                    62000021
EXC01100 LR    GDSREG,REGC    RESET REG                                 62100021
         B     EXC00550                                                 62200021
ERR1     OI    0(REGC),PARERR      SET PARM ERR                         62500021
         LA    REGB,ONE                                                 63000021
         ST    REGB,PARE(REGC)     ON GDSCB                             63500021
         B     EXC00400            RETURN                               64000021
ERR2     L     REGC,WRKRTNCD                                            64100021
         OI    0(REGC),IO                                               64200021
         B     EXC00400                                                 64300021
         EJECT                                                          64500021
* REGISTERS                                                             65000021
REGZERO  EQU   0                                                        65500021
PARM     EQU   1                                                        66000021
REGA     EQU   2                                                        66500021
REGB     EQU   3                                                        67000021
OACB     EQU   4                                                        67500021
WORK     EQU   5                                                        68000021
GTMREG   EQU   7                                                        68500021
GDSREG   EQU   8                                                        69000021
BASE     EQU   9                                                        69500021
REGC     EQU   10                                                       70000021
REGD     EQU   11                                                       70500021
SAVE     EQU   13                                                       71000021
RETURN   EQU   14                                                       71500021
REGFIFTN EQU   15                                                       72000021
         EJECT                                                          72500021
ZERO     DC    F'0'                                                     73000021
FOUR     DC    F'4'                                                     73500021
NOTUSED  EQU   X'80'                                                    74000021
EQUIV    EQU   X'08'                                                    74500021
DATAREP  EQU   X'40'                                                    75000021
INBUF    EQU   X'80'                                                    75500021
NOTIN    EQU   X'7F'                                                    76000021
PARERR   EQU   X'08'                                                    76500021
CURSOR   EQU   X'20'                                                    77000021
LEN      EQU   20                                                       77500021
ONE      EQU   1                                                        78000021
PARE     EQU   16                                                       78500021
IO       EQU   X'04'                                                    78700021
         EJECT                                                          79000021
OACBAREA DSECT                                                          79500021
OTHER    DS    F                                                        80000021
GDOA     DS    F                                                        80500021
STATUS   DS    F                                                        81000021
CRSA     DS    F                                                        81500021
OLP      DS    F                                                        82000021
BLP      DS    F                                                        82500021
BUFSTART DS    F                                                        83000021
BUFLEN   DS    F                                                        83500021
CPU1     DS    F                                                        84000021
BUF1     DS    F                                                        84500021
CPU2     DS    F                                                        85000021
BUF2     DS    F                                                        85500021
LOGSTART DS    F                                                        86000021
LOGCURR  DS    F                                                        86500021
LENLEFT  DS    F                                                        87000021
         EJECT                                                          87500021
WORKAREA DSECT                                                          88000021
WRKPARM  DS    F                                                        88500021
WRKRTNCD DS    F                                                        89000021
WRKSAVE  DS    18F                                                      89500021
         COPY  GDSCB                                                    90000021
         COPY  GTMCB                                                    90500021
         COPY  GSPCB                                                    91000021
         END                                                            91500021
./  ADD  SSI=20480254,NAME=IFFAFA12
*                                                                       00100021
*                                                                       00200021
*                             RESET INPUT PARAMETER LIST                00300021
*                                                                       00400021
*                             +0   A(GDSVAR) VARIABLE CONTAINING        00500021
*                                            THE ADDRESS OF THE         00600021
*                                            GDSCB                      00700021
*                                                                       00800021
*                             OPTIONAL:                                 00900021
*                             +4   A(CORVAL) CORRELATION VALUE          01000021
*                             +8   A(KEY)    KEY                        01100021
*                                                                       01200021
*                                                                       01300021
*                                                                       01400021
*                                                                       01500021
*                                                                       01600021
*                                                                       01700021
*                                                                       01800021
*        RESET IS ENTERED FROM THE DIRECTOR PART 2 WHEN BEING CALLED    01900021
*        BY A PROGRAM EXTERNAL TO GSP.  INTERNALLY, RESET IS CALLED     02000021
*        FROM ANY DATA GENERATING ROUTINE (SUCH AS PLINE) WHICH         02100021
*        ENCOUNTERS AN ERROR WHILE GENERATING DATA AND MUST RESTORE     02200021
*        THE SYSTEM TO THE CONDITION BEFORE THE CALL.  THE WAY RESET    02300021
*        DETERMINES IF THE CALL IS FROM AN INTERNAL ROUTINE FOR A KEY   02400021
*        LEVEL 1 GDS IS THAT IS SEARCHES THE KEY TABLE FOR THE KEY.     02500021
*        IF THE KEY IS NOT FOUND, THE LENGTH FIELD OF THE KEY IS        02600021
*        CHECKED FOR ZERO.  IF THE LENGTH IS ZERO IT IS ASSUMED         02700021
*        THAT THE CALL IS FROM THE INTERNAL ROUTINE.                    02800021
*                                                                       02900021
*        EXTERNAL ROUTINES REFERENCES ARE:                              03000021
*        KEY TABLE MANAGEMENT-IFFAHA03                                  03100021
*        BUFFER MANAGEMENT-IFFAHA02                                     03200021
*        EXEC-IFFAFA11                                                  03300021
*                                                                       03400021
*        EXTERNAL MACROS USED ARE:                                      03500021
*        LINK                                                           03600021
*        GWRITE                                                         03700021
*        WAIT                                                           03800021
*                                                                       03900021
         EJECT                                                          04000021
IFFAFA12 CSECT                                                          04100021
*2101,111000,121000                                                000A 04150021
*                                                                       04200021
*        ON ENTRY RESET ESTABLISHES A BASE REGISTER, SET UP THE WORK    04300021
*        AREA DSECT, ZEROS THE RETURN ARRAY, AND CHAINS THE SAVE        04400021
*        AREAS.                                                         04500021
         SAVE  (14,12)                                                  04600021
         BALR  BASE,0                                                   04700021
         USING *,BASE                                                   04800021
         LR    WORK,PARM           SET UP WORK AREA DSECT               04900021
         USING WORKAREA,WORK                                            05000021
         L     PARM,WRKPARM        LOAD ADDR OF PARM LIST               05100021
         L     ERRCD,WRKRTNCD                                           05200021
         XC    WRKSPVSR(12),WRKSPVSR ZERO SUPERVISOR PARAMETER LIST     05300021
         XC    0(20,ERRCD),0(ERRCD) ZERO RETURN ARRAY                   05400021
         ST    SAVE,WRKSAVE+4      CHAIN SAVE AREAS                     05500021
         LA    REGA,WRKSAVE                                             05600021
         ST    REGA,8(SAVE)                                             05700021
         LR    SAVE,REGA                                                05800021
*                                                                       05900021
*        RESET PICKS UP THE FIRST PARAMETER, THE GDSCB ADDRESS, INIT-   06000021
*        IALIZES THE DSCET AND CHECKS ITS VALIDITY.  IF VALID IT        06100021
*        NEXT INITIALIZES THE GTMCB DSECT.  IT ZEROS THE CORVAL         06200021
*        AND KEY LOCATION.  THE KEY IS THE FULL THREE WORDS OF          06300021
*        THE ACTUAL KEY THAT WOULD BE EXPECTED BACK FROM KEY            06400021
*        TABLE MANAGEMENT.                                              06500021
         L     GDSREG,GDS(PARM)    PICK UP ADDRESS OF GDSCB             06600021
         L     GDSREG,0(GDSREG)                                         06700021
         USING GDSCB,GDSREG        SET UP DSECT                         06800021
         C     GDSREG,GDSGDSCB     IS GDSCB VALID                       06900021
         BNE   ERR1                NO                                   07000021
         L     GTMREG,GDSGTMCB                                          07100021
         USING GTMCB,GTMREG        SET UP GTMCB DSECT                   07200021
         XC    WRKCORVL,WRKCORVL   ZERO CORVAL                          07300021
         XC    WRKKEY(12),WRKKEY   ZERO KEY                             07400021
         EJECT                                                          07500021
*                                                                       07600021
*        A CHECK IS MADE TO SEE IF THE GDS IS THE LAST PARAMETER        07700021
*        PASSED IN WHICH CASE THE ENTIRE GDS MUST BE RESET.  IF         07800021
*        THIS IS THE CASE A DUMMY KEY IS SET UP WITH A LOGICAL          07900021
*        ADDRESS OF ZERO.                                               08000021
         TM    GDS(PARM),LAST      IS THERE ONLY ONE PARM               08100021
         BO    RST00800            YES, RESET ENTIRE GDS                08200021
*                                                                       08300021
*        THE ADDITIONAL PARAMETERS, KEY AND CORVAL ARE CHECKED.         08400021
*        IF THE KEY IS PASSED THAT IS WHAT IS USED TO SEARCH THE        08500021
*        KEY TABLE.  IF THE KEY IS NOT FOUND, AND IN FACT WAS           08600021
*        PASSED, AND THE LENGTH IF THE KEY IS ZERO IT IS ASSUMED        08700021
*        THAT THIS IS A GSP RESET AND THE KEY TABLE RESET IS            08800021
*        BYPASSED.  IF THE KEY IS FOUND IT IS PLACED IN THE WORK        08900021
*        AREA AND THEN THE KEY TABLE IS RESET.  NOTE THAT FOR           09000021
*        LEVEL TWO ALL KEY TABLE MANIPULATION IS BYPASSED.              09100021
*                                                                       09200021
         CLC   NULL+1(3,ERRCD),CORVL+1(PARM)                            09300021
         BE    RST00100            YES                                  09500021
         L     REGB,CORVL(PARM)                                         09600021
         MVC   WRKCORVL,0(REGB)    PLACE CORVAL IN WORK AREA            09700021
RST00100 TM    CORVL(PARM),LAST    IS KEY PASSED                        09800021
         BO    RST00850                                                 09850021
         CLC   NULL+1(3,ERRCD),KEY+1(PARM) NULL                         09900021
         BE    RST00850            YES                                  09950021
         L     REGB,KEY(PARM)                                           10000021
         MVC   WRKKEY,0(REGB)      YES, PLACE KEY IN WORK AREA          10100021
         TM    GDSFLAGS,LEVEL2     IS THIS LEVEL 2                      10200021
         BO    RST00400            YES                                  10300021
         LA    REGB,WRKKEY                                              10400021
         ST    REGB,WRKPRLST+8     ADDR OF KEY                          10500021
         LA    REGB,KEYSRCH        SEARCH ON KEY CODE                   10600021
         EJECT                                                          10700021
RST00200 ST    REGB,WRKPRLST+4                                          10800021
         ST    GDSREG,WRKPRLST     ADDRESS OF GDSCB                     10900021
         LA    PARM,WRKPRLST                                            11000021
         L     REGB,GTMGSPCB       GET POINTER TO GSPCB            000A 11040021
         L     REGB,FE(REGB)       GET POINTER TO STATUS TABLE     000A 11080021
         L     REG15,ETE(REGB)     GET A&RS OF KEY TABLE MGMT      000A 11120021
         BALR  REG14,REG15         BRANCH TO KEY TABLE MGMT        000A 11160021
         LTR   REG15,REG15         FOUND                                11200021
         BNE   RST01000            NO                                   11300021
         MVC   WRKKEY(12),0(PARM)  SAVE ENTIRE KEY                      11400021
RST00300 LA    REGB,WRKKEY         BUILD PARM LIST TO RESET KEY TABLE   11500021
         ST    REGB,WRKPRLST+8     A KEY OF ZERO WILL RESET THE         11600021
         LA    REGB,RESETCDE       ENTIRE TABLE. FROM NOW ON A KEY      11700021
         ST    REGB,WRKPRLST+4     CONTAINING ZERO WILL                 11800021
         ST    GDSREG,WRKPRLST     SIGNIFY RESET THE ENTIRE GDS         11900021
         LA    PARM,WRKPRLST                                            12000021
         L     REGB,GTMGSPCB       GET POINTER TO GSPCB            000A 12040021
         L     REGB,FE(REGB)       GET POINTER TO STATUS TABLE     000A 12080021
         L     REG15,ETE(REGB)     GET ADRS OF KEY TABLE MGMT      000A 12120021
         BALR  REG14,REG15         BRANCH TO KEY TABLE MGMT        000A 12160021
         EJECT                                                          12200021
*                                                                       12300021
*        AT THIS POINT ALL POSSIBLE CASES THAT HAVE NOT EXITED          12400021
*        BECAUSE OF ERRORS ARE TOGETHER FOR THE LAST TIME.              12500021
*        WE HAVE A GUY RESETING THE GDS.  FOR THAT WRKKEY CONTAINS      12600021
*        ZERO.  THERE IS THE GUY RESETING A KEY OR CORVAL LEVEL         12700021
*        ONE.  FOR HIM WE HAVE A TWELVE BYTE KEY FROM THE KEY TABLE     12800021
*        CONTAINING ASSORTED INFORMATION ABOUT THE ELEMENT WE ARE       12900021
*        RESETING TO.  LAST WE HAVE A LEVEL TWO KEY OR A GSP            13000021
*        RESET KEY CONTAINING A LOGICAL BUFFER ADDRESS BUT NO           13100021
*        INFORMATION ABOUT THE ELEMENT WE ARE RESETING TO.              13200021
*        WE WILL SET UP THE OACB DSECT AND THE PROCESSING WILL          13300021
*        SPLIT INTO TWO PATHS.  ONE IS FOR THE RESET WHICH WILL         13400021
*        TAKE PLACE IN THE GDOA AND THE OTHER IS WHERE RESET            13500021
*        IN THE BUFFER.  NOTE THAT FOR EQUIVALENCE GDSS THE RESET       13600021
*        WILL ALWAYS BE IN THE GDOA.  ALSO, IF THE RESET IS             13700021
*        IN THE GDOA NO BUFFER WILL HAVE TO BE RELEASED SO THE          13800021
*        CALL TO BUFFER MANAGEMENT IS AT THE RESET TO THE BUFFER        13900021
*        ONLY.  A CHECK IS MADE TO SEE IF ANY DATA WAS EVER             14000021
*        GENERATED BECAUSE A RESET TO THE GDS MIGHT BE CALLED           14100021
*        BEFORE THIS.                                                   14200021
*                                                                       14300021
RST00400 LH    REGA,WRKKEY+2       LOAD LOGICAL START ADDR              14400021
         L     OACB,GDSAOACB       INITIALIZE OACB DSECT                14500021
         USING OACBARA,OACB                                             14600021
         TM    STATUS,NO           WAS BUFFER EVER ASSIGNED             14700021
         BO    RST00500            EXIT                                 14800021
         C     REGA,LOGSTRT        IS DATA IN GDOA                      14900021
         BL    RST00600            NO                                   15000021
         EJECT                                                          15100021
*                                                                       15200021
*        IF THE RESET IS IN THE GDOA THE LOGICAL CURRENT ADDRESS        15300021
*        IS SET TO THE ADDRESS IN THE KEY.  FOR THE RESET OF A          15400021
*        GDS THIS IS ZERO.  THE OLP IS SET BACK THE LENGTH OF THE       15500021
*        RESET.  THE LENGTH LEFT IS INCREASED THE LENGTH OF THE         15600021
*        RESET.  THE UNRESOLVED ADDRESS POINTER WHICH WOULD ALWAYS      15700021
*        BE SET FOR AN ELEMENT (NOT SEQUENCE OR SUBROUTINE) IS          15800021
*        SET TO ZERO.                                                   15900021
         L     REGB,LOGCURR        PICK UP LOGICAL CURRENT              16000021
         SR    REGB,REGA           SUBTRACT RESET LOGICAL TO DETERMINE  16100021
         ST    REGA,LOGCURR        LENGTH-KEY ADDR=NEW LOGCURR          16200021
         L     REGA,OLP            OLP                                  16300021
         SR    REGA,REGB           MINUS LENGTH OF RESET                16400021
         ST    REGA,OLP            IS NEW OLP                           16500021
         A     REGB,LENLEFT        LENGTH LEFT INCREASED BY LENGTH      16600021
         ST    REGB,LENLEFT        OF RESET                             16700021
         XC    CPU2(8),CPU2        ZERO UNRES ADDR POINTER              16800021
         EJECT                                                          16900021
*                                                                       17000021
*        A CHECK IS MADE TO SEE IF THERE IS A SEQUENCE OR SUBROUTINE    17100021
*        OPEN BEFORE THE RESET.  IF SO A CHECK IS MADE TO SEE IF        17200021
*        WE ARE RESETING WITHIN THE SEQUENCE OR SUBROUTINE, TO IT,      17300021
*        OR BEYOND IT.  IF WE ARE STILL WITHIN IT ALL SEQUENCE,         17400021
*        SUBROUTINE UPDATING IS COMPLETE.  IF WE ARE RESETING TO        17500021
*        IT, THE SEQUENCE, SUBROUTINE SWITCH IS SET TO ZERO,            17600021
*        THE GDSKEYSV ADDRESS IS SET TO ZERO AND THE UNRESOLVED         17700021
*        ADDRESS IN THE OACB, CPU1 OR BUF1 IS SET TO ZERO.  IF          17800021
*        WE ARE RESETING BEYOND IT A CHECK IS MADE TO SEE IF THIS       17900021
*        IS A SEQUENCE OR SUBROUTINE MEMBER KEY.  FOR A GDS, OR         18000021
*        A LEVEL TWO KEY THIS WILL ALWAYS BE ZERO.  IF THE KEY          18100021
*        DOES NOT BELONG TO A SEQUENCE OR SUBROUTINE THE SAME           18200021
*        PROCESSING TAKES PLACE AS FOR A RESET TO A SEQUENCE OR         18300021
*        SUBROUTINE KEY.  OTHERWISE THE KEY TABLE IS SEARCHED           18400021
*        FOR THE LAST SEQUENCE OR SUBROUTINE KEY BEFORE THIS            18500021
*        KEY (NOTE IT HAS ALREADY BEEN RESET TO THIS KEY SO             18600021
*        THE LAST KEY FOR A SEQUENCE OR SUBROUTINE WILL BE THE          18700021
*        ONE TO WHICH OUR KEY BELONGS.  THE SEQUENCE OR                 18800021
*        SUBROUTINE IS REOPENED BY SETTING THE LENGTH OF THE            18900021
*        SEQUENCE OR SUBROUTINE KEY IN THE KEY TABLE TO ZERO.           19000021
*        THE GDSKEYSV LOCATION IN THE GDSCB WILL BE SET TO THE          19100021
*        LOGICAL ADDRESS OF THE KEY AND THE SEQUENCE OR SUBROUTINE      19200021
*        STARTED WHICH WILL BE SET.  THE FLOW CONTROL RETURN ADDRESS    19300021
*        IS PLACED AT THE TOP OF THE SEQUENCE OR SUBROUTINE IN THE      19400021
*        GDOA AND THE CPU ADDRESS OF THE UNRESOLVED ADDRESS IS          19500021
*        SAVED IN THE CPU1 LOCATION IN THE OACB.                        19600021
*                                                                       19700021
RST00410 TM    GDSFLAGS,SEQ+SUB    IS A SEQ,SUB ALREADY OPEN            19800021
         BZ    RST00413            NO                                   19900021
         CLC   GDSKEYSV,WRKKEY+2   IS THIS THE ONE ALREADY OPEN         20000021
         BL    RST00440            WITHIN STARTED SEQ A OK              20100021
         BE    RST03200            RESET TO SEQUENCE KEY                20200021
RST00413 TM    WRKKEY+7,SEQM+SUBM  IS THE KEY SEQ OR SUBR MEMBER        20300021
         BZ    RST03200            NO ZERO SEQ AND EXIT                 20400021
         BAL   REG15,RST01920      SEARCH FOR DEQ KEY& CONVRT TO PHYSBF 20500021
         CLC   GDSGDOAL,H128       SUB SEG                              20600021
         BNE   RST00415            NO                                   20700021
         BAL   REG14,RST01100      GO GET SUBSEG ADDR                   20800021
         L     REGB,WRK128TP       PICK UP 128 START ADDR               20900021
RST00415 L     REGA,BLP            BUFFER LOAD POINT                    21000021
         SR    REGB,REGA           MINUS PHYS BUFFER                    21100021
         A     REGB,CRSA           POS IN GDOA OF START OF SEQ OR SUBR  21200021
         NI    GDSFLAGS,NTSEQSUB   ZERO SEQ/SUBR SW                     21300021
         L     REGC,WRKSEQKY       LOAD SEQ/SUBR KEY                    21400021
         TM    5(REGC),X'08'       SEQ                                  21500021
         BO    RST00420                                                 21600021
         OI    GDSFLAGS,SEQ        SET SEQ SW                           21700021
         B     RST00430                                                 21800021
         EJECT                                                          21900021
RST00420 OI    GDSFLAGS,SUB        SET SUBR SW                          22000021
         LA    REGB,8(REGB)        UPDATE TO INCLUDE OMIT               22100021
RST00430 LA    REGB,2(REGB)        TO THE ADDR                          22200021
         MVC   0(2,REGB),GDSOVDAT+2 MOVE IN FLOW CTL RTN ADDR           22300021
         ST    REGB,CPU1           SAVE CPU ADDR OF UNRES               22400021
         XC    BUF1,BUF1           ZERO BUFFER ADDR LOC                 22500021
         CLC   8(4,REGC),ZERO      IS IT CORRELATED                     22600021
         BNE   RST00440            NO                                   22700021
         OI    GDSFLAGS,CRVLPRES   SET CORRELATED FLAG IN GDS           22800021
*                                                                       22900021
*        A CHECK IS MADE TO SEE IF THIS IS AN EQUIVALENCE GDS WHICH     23000021
*        IS CURRENTLY IN THE BUFFER.  IF SO A CALL TO EXEC-IFFAFA11     23100021
*        IS MADE TO PLACE THE NEW COPY OF THE GDS OUT INTO THE BUFFER.  23200021
RST00440 TM    GDSFLAGS,EQUIV      IS THIS AN EQUIV IN THE BUFFER       23300021
         BZ    RST00500            NO EXIT                              23400021
         LA    REGA,GDSGDSCB       GDSCB                                23500021
         ST    REGA,WRKPRLST       IN PARM LIST                         23600021
         OI    WRKPRLST,LAST       SET LAST PARM SW                     23700021
         LA    REGA,WRKPRLST                                            23800021
         ST    REGA,WRKPRM         PARM LIST IN WORK AREA               23900021
         ST    ERRCD,WRKERR        FOR EXEC                             24000021
         LA    PARM,WRKPRM                                              24100021
         EJECT                                                          24200021
*//                                                                     24300021
*//      GO EXECUTE THIS EQUIVALENCE GDS                                24400021
*//                                                                     24500021
         LINK  EP=IFFAFA11,MF=(E,(1)),SF=(E,WRKSPVSR)                   24600021
*                                                                       24700021
*        THE CURRENT MODE SWITCH IS SET TO ZERO SO THAT THE NEXT        24800021
*        CALL TO A DATA GENERATING SUBROUTINE WILL GENERATE A SET       24900021
*        MODE ORDER.  CONTROL IS THEN RETURNED TO THE CALLING PROGRAM.  25000021
*                                                                       25100021
RST00500 MVI   GDSGRMOD,0          SET TO CONTROL MODE                  25200021
RST00550 L     SAVE,4(SAVE)        RETURN                               25300021
         RETURN (14,12),T                                               25400021
         EJECT                                                          25500021
*                                                                       25600021
*        IT HAS BEEN DETERMINED THAT THE RESET MUST TAKE PLACE          25700021
*        IN THE BUFFER.  A CHECK IS MADE TO SEE IF THE GDOA LENGTH      25800021
*        IS 128.  IF NOT THE LOGICAL ADDRESS OF THIS KEY IS DIVIDED     25900021
*        BY THE GDOA LENGTH LESS SIX FOR THE CONTROL BYTES TO DETER-    26000021
*        MINE WHICH SEGMENT OF BUFFER THIS BELONGS IN.  THE             26100021
*        QUOTIENT OF THE DIVIDE IS THE COUNT FIELD INTO THE BUFFER      26200021
*        CONTROL TABLE AND THE REMAINDER IS THE DISTANCE FROM THE       26300021
*        TOP OF THE SEGMENT THAT THIS LOGICAL ADDRESS IS LOCATED        26400021
*        AT.                                                            26500021
*                                                                       26600021
RST00600 CLC   GDSGDOAL,H128       IS GDOA A SUB SEGMENT                26700021
         BE    RST01050            YES, MUST BE HANDLED SEPARATELY      26800021
         SRDA  REGA,32             LOAD LOG INTO ODD REGISTER           26900021
         LH    REGC,GDSGDOAL       GDOA LEN                             27000021
         S     REGC,SIX            MINUS SIX                            27100021
         DR    REGA,REGC           DIVIDED INTO LOG ADDR=CT             27200021
         SR    REGD,REGD           ZERO REG                             27300021
         LH    REGC,GDSBCTEL       PICK UP DISPLACEMENT                 27400021
         MH    REGC,F3+2                                                27500021
         L     REG14,GTMBCTBL      TABLE ADDR                           27600021
RST00700 IC    REGD,2(REGC,REG14)  PICK UP COUNT                        27700021
         CR    REGD,REGB           EQUAL TO COUNT I HAVE                27800021
         BE    RST01300            YES                                  27900021
         IC    REGD,1(REGC,REG14)  PICK UP PTR TO NEXT                  28000021
         MH    REGD,F3+2                                                28100021
         CR    REGD,REGC           IS THIS LAST                         28200021
         BE    ERR2                                                     28300021
         LR    REGC,REGD                                                28400021
         SR    REGD,REGD                                                28500021
         B     RST00700                                                 28600021
RST00800 TM    GDSFLAGS,LEVEL2     LEVEL2                               28700021
         BO    RST00400            YES, DO NOT RESET KEY TABLE          28800021
         CLC   GDSKEYTB,ZERO       IS THERE A KEY TABLE                 28900021
         BE    RST00400            NO BYPASS DELETION                   29000021
         B     RST00300            RESET ENTIRE KEY TABLE               29100021
         EJECT                                                          29200021
RST00850 CLC   WRKCORVL,ZERO       IS IT CORRELATED                     29230021
         BE    RST00800            RESET GDS                            29260021
RST00900 LA    REGB,WRKCORVL       ADDR OF CORVL                        29300021
         ST    REGB,WRKPRLST+8                                          29400021
         LA    REGB,CORVSRCH       SEARCH ON CORVAL CODE                29500021
         B     RST00200            GO SEARCH                            29600021
RST01000 CLC   WRKKEY(2),ZERO      IS LENGTH IN KEY ZERO                29700021
         BE    RST00400            YES THIS IS A SYSTEM ERROR RESET     29800021
         B     ERR2                BAD KEY/CORVAL                       29900021
*                                                                       30000021
*        IF THE GDOA IS A SUBSEGMENT THE PHYSICAL ADDRESS OF THE        30100021
*        SUBSEGMENT IS COMPUTED AND THE LOGICAL ADDRESS IS THE          30200021
*        DISPLACEMENT INTO THE SEGMENT WHERE THE ELEMENT IS LOCATED.    30300021
*                                                                       30400021
RST01050 LA    REG14,RST01400                                           30500021
RST01100 LH    REGD,GDSBCTEL       PICK UP ELEM                         30600021
         M     REGC,F256                                                30700021
         LH    REGB,GDSBCTEL       DISP IN TABLE                        30800021
         MH    REGB,F3+2                                                30900021
         A     REGB,GTMBCTBL       ADDR OF TABLE                        31000021
         CLC   GDSBCTID,0(REGB)    IS SUBSEGMENT FIRST HALF             31100021
         BE    RST01200            YES                                  31200021
         AH    REGD,H128           NO, ADD 128 TO ADDR                  31300021
RST01200 LH    REGA,WRKKEY+2       LOAD LOG ADDR                        31400021
         ST    REGD,WRK128TP       SAVE 128 START                       31500021
         AR    REGD,REGA           COMPUTE BUFFER LOC                   31600021
         LA    REGD,2(REGD)        +2 FOR SET MODE                      31700021
         BR    REG14               RETURN TO CALLER                     31800021
         EJECT                                                          31900021
RST01300 L     REGD,F256           256                                  32000021
         ST    REGC,WRKDSP         SAVE DISP                            32100021
         M     REGC,WRKDSP         256 X DISP                           32200021
         D     REGC,F3             DIV BY 3                             32300021
         AR    REGD,REGA           PLUS DIST FROM TOP                   32400021
         LA    REGD,2(REGD)        +2 FOR SET MODE                      32500021
*                                                                       32600021
*        THE BUFFER ADDRESS IS SAVED.  THE CRSA IS SET EQUAL TO         32700021
*        THE GDOA AND SO IS THE OLP.  THE UNRESOLVED ADDRESS FOR AN     32800021
*        ELEMENT IS SET TO ZERO.  THE LOGICAL ADDRESS IN THE KEY        32900021
*        BECOMES THE LOGICAL CURRENT AND LOGICAL START ADDRESS.         33000021
*        THE BUFFER ADDRESS COMPUTED IS THE BLP.  IT IS ALSO THE        33100021
*        BUFFER START.  THE DISPLACEMENT INTO THE SEGMENT PLUS THE      33200021
*        SIX CONTROL BYTES SUBTRACTED FROM THE GDOA LENGTH BECOMES      33300021
*        THE LENGTH LEFT IN THE GDOA.  IF IT IS A SUBSEGMENT THE        33400021
*        CALL TO BUFFER MANAGEMENT IS BYPASSED.                         33500021
*                                                                       33600021
RST01400 ST    REGD,WRKBUFR        SAVE BUFFER ADDRESS                  33700021
         MVC   CRSA,GDOA           SET CRSA=GDOA                        33800021
         MVC   OLP,GDOA            SET OLP=CRSA,GDOA                    33900021
         XC    CPU2(8),CPU2        ZERO SECOND UNRES ADDR               34000021
         MVC   LOGSTRT+2(2),WRKKEY+2  SET UP NEW                        34100021
         MVC   LOGCURR,LOGSTRT     LOG START AND LOG CURRENT            34200021
         ST    REGD,BLP            SET UP BUFFER LOAD POINT             34300021
         ST    REGD,BUFSTART       AND BUFFER START                     34400021
         LH    REGB,GDSGDOAL       COMPUTE                              34500021
         S     REGB,SIX            LENGTH                               34600021
         SR    REGB,REGA           LEFT                                 34700021
         ST    REGB,LENLEFT        AND STORE                            34800021
         A     REGB,FOUR           ADD FOUR FOR TRANS ORD               34900021
         ST    REGB,BUFLEN          IN BUFFER LENGTH                    35000021
         CLC   GDSGDOAL,H128       IS THIS A SUBSEGMENT                 35100021
         BE    RST01600            YES                                  35200021
         EJECT                                                          35300021
*                                                                       35400021
*        HERE BUFFER MANAGEMENT IS CALLED PASSING IT IN DISPLACE-       35500021
*        MENT INTO THE BUFFER CONTROL TABLE OF THIS SEGMENT.  ANY       35600021
*        SUCCEEDING SEGMENTS WILL BE RELEASED TO THE SYSTEM BY          35700021
*        BUFFER MANAGEMENT.  A CHECK IS MADE TO SEE IF THE              35800021
*        REPLACEMENT DATA IF ANY IN THE GDSCB IS PART OF THE            35900021
*        RESET.  IF NOT IT IS LEFT AS IS.  IF YES THE FIELDS ARE        36000021
*        ZEROED AND THE FLAG TO SAVE THE NEXT FOUR BYTES AS             36100021
*        REPLACEMENT DATA ARE SET IN THE OACB FOR THE NEXT OVERFLOW.    36200021
*                                                                       36300021
         MVC   WRKPRLST(4),SIX     NO GO TO UBFFER MANAGEMENT           36400021
         ST    GDSREG,WRKPRLST+4   TO RESET BUFFER                      36500021
         L     PARM,WRKDSP                                              36600021
         SR    REG0,REG0                                                36700021
         D     REG0,F3                                                  36800021
         ST    PARM,WRKPRLST+8     DISP OF THIS ENTRY                   36900021
         LA    PARM,WRKPRLST                                            37000021
         ST    PARM,WRKPRM                                              37100021
         LA    PARM,WRKPRM                                              37200021
         ST    ERRCD,WRKERR                                             37300021
         L     REG15,STAT(ERRCD)                                        37400021
         L     REG15,BMGT(REG15)                                        37500021
         BALR  REG14,REG15         CALL BUFFER MANAGEMENT               37600021
         LH    REGB,GDSREPPB       PICK UP REPLACEMENT DATA ADDR        37700021
         LTR   REGB,REGB           ANY REPL DATA                        37800021
         BE    RST01600            NO                                   37900021
         EJECT                                                          38000021
         M     REGA,F3                                                  38100021
         D     REGA,F256           REFERENCE BCT FOR ENTRY FOR          38200021
         A     REGB,GTMBCTBL       THIS BUFFER ADDRESS                  38300021
         CLI   0(REGB),0           HAS BEEN RESET                       38400021
         BNE   RST03000            NO                                   38500021
RST01500 XC    GDSREPPB,GDSREPPB   ZERO REPLACEMENT DATA                38600021
         XC    GDSREPDT,GDSREPDT                                        38700021
         OI    STATUS,SAVEFOUR     SET  STATUS TO SAVE FOUR             38800021
RST01600 L     REGA,GTMDECB1       GRAPHIC DECB                         38900021
         L     REGB,GTMGRDCB       DCB                                  39000021
         LR    PARM,REGA                                                39100021
         WAIT  ECB=(1)             WAIT ON OLD I/O                      39200021
*                                                                       39300021
*        WE WILL NOW WRITE OUT A GTRU TO FLOW CONTROL                   39400021
*        AT THE ADDRESS DETERMINED. IN ALL CASES IT MAY                 39500021
*        NOT BE NEEDED BUT I CAN'T FIGURE OUT EASILY IF                 39600021
*        IT IS OR NOT                                                   39700021
*                                                                       39800021
         LR    PARM,REGA                                                39900021
         CLI   0(PARM),X'7F'                                            39920021
         BNE   ERR3                                                     39940021
         NI    0(PARM),X'BF'                                            39960021
         GWRITE (PARM),STR,(REGB),4,GDSOVDAT,BUFSTART+2,GDSFCBUF,MF=E   40000021
         EJECT                                                          40100021
*                                                                       40200021
*        A CHECK IS MADE TO SEE IF A SEQUENCE OR SUBROUTINE HAS BEEN    40300021
*        BEGUN BUT NOT COMPLETED.  IF YES A TEST IS MADE TO SEE IF      40400021
*        WE ARE RESETING WITHIN THE SEQUENCE OR SUBROUTINE, TO IT       40500021
*        OR BEYOND IT.  IF WE RESET TO THE SUBROUTINE OR SEQUENCE       40600021
*        THE FLAGS, UNRESOLVED ADDRESS AND LOGICAL ADDRESS OF THE       40700021
*        KEY IN THE GDSCB MUST BE SET TO ZERO.  IF WE ARE               40800021
*        RESETING BEYOND IT BUT NOT INTO ANOTHER SEQUENCE OR            40900021
*        SUBROUTINE THE SAME THING TAKES PLACE.  AFTER THIS CONTROL     41000021
*        IS RETURNED TO THE CALLING PROGRAM.                            41100021
*                                                                       41200021
RST01700 TM    GDSFLAGS,SEQ+SUB    IS SEQ/SUB BEGUN                     41300021
         BZ    RST01900            NO                                   41400021
         CLC   GDSKEYSV,WRKKEY+2   IS ELEMENT WITHIN THIS SEQ/SUB       41500021
         BL    RST00500            YES EXIT                             41600021
         BH    RST01900            NO                                   41700021
RST01750 NI    GDSFLAGS,NTSEQSUB   SET GDS NOT SEQ OR SUBR              41800021
         XC    CPU1(8),CPU1        ZERO UNRES ADDR                      41900021
         XC    GDSKEYSV,GDSKEYSV   ZERO ANY KEY                         42000021
         B     RST00500                                                 42100021
         EJECT                                                          42200021
*                                                                       42300021
*        WE NOW MUST FIND THE KEY TO THIS SEQUENCE OR SUBROUTINE,       42400021
*        AND REOPEN IT.  WE MUST SET UP AN UNRESOLVED ADDRESS           42500021
*        FOR THIS SEQ-SUBR AND GO INTO THE BUFFER  AND CHANGE           42600021
*        THE BRANCH ADDRESS OF THE INCLUDE/OMIT STRUCTURE TO            42700021
*        THE FLOW CONTROL RETURN ADDRESS SO THAT IF HE OMITS AN         42800021
*        UNFINISHED SEQ-SUBR HE WILL NOT BRANCH INTO BUFFER THAT        42900021
*        MAY NO LONGER BELONG TO HIM OR THAT CONTAINS OVERFLOW DATA     43000021
*                                                                       43100021
RST01900 TM    WRKKEY+7,SEQM+SUBM  IS THIS A SEQ/SUB MEMBER             43200021
         BZ    RST01750            NO RESET SW AND EXIT                 43300021
         LA    REG15,RST02750      SET TO FALL THROUGH                  43400021
RST01920 LH    REGA,WRKKEY+2       LOGICAL START ADDR OF KEY            43500021
         L     REGB,GDSKEYTB       KEY TABLE ADDR                       43600021
RST01950 LA    REGC,12(REGB)       ADDR OF FIRST KEY                    43700021
         L     REGD,4(REGB)        ADDR OF NEXT FREE LOCATION           43800021
RST02000 TM    4(REGC),X'20'       IS THIS KEY SEQ,SUBR,EOS, OR STROKE  43900021
         BO    RST02200            YES                                  44000021
RST02100 LA    REGC,12(REGC)       NEXT KEY                             44100021
         CR    REGC,REGD           ALL KEYS IN THIS TABLE CHECKED       44200021
         BNE   RST02000            NO                                   44300021
         L     REGB,0(REGB)        ALL TABLES CHECKED                   44400021
         LTR   REGB,REGB                                                44500021
         BZ    RST02300            YES                                  44600021
         B     RST01950            GO AGAIN                             44700021
         EJECT                                                          44800021
*                                                                       44900021
*        BECAUSE THE SEQUENCE/SUBROUTINE KEY IS THE LAST ONE IN         45000021
*        THE KEY TABLE, THE ADDRESS OF ANY KEY IS SAVED. THE            45100021
*        SECOND KEY REPLACES THE FIRST,ETC UNTIL THE ENTIRE             45200021
*        TABLE(S) IS SEARCHED. WHEN THIS IS DONE THE ADDRESS            45300021
*        I HAVE IS THE ADDRESS OF THE KEY I WANT.                       45400021
*                                                                       45500021
RST02200 TM    4(REGC),X'10'       IS THIS SEQ OR SUBR                  45600021
         BO    RST02100            NO                                   45700021
         ST    REGC,WRKSEQKY       SAVE                                 45800021
         B     RST02100                                                 45900021
RST02300 L     REGA,WRKSEQKY       PICK UP KEY ADDR                     46000021
         MVC   0(2,REGA),ZERO      ZERO LENGTH IN KEY                   46100021
         MVC   GDSKEYSV,2(REGA)    SAVE LOG ADDR OF KEY IN GDSCB        46200021
         LH    REGC,2(REGA)        OBTAIN LOGICAL ADDR OF KEY           46300021
         CLC   GDSGDOAL,H128       SUB SEGMENT                          46400021
         BE    RST02500            YES-WE ALREADY HAVE THE ADDR         46500021
         SRDA  REGC,32             SHIFT INTO ODD REGISTER              46600021
         LH    REGB,GDSGDOAL       GDOA LEN                             46700021
         S     REGB,SIX            MINUS SIX                            46800021
         DR    REGC,REGB           DIVIDE                               46900021
         L     REGA,GTMBCTBL                                            47000021
         LH    REGB,GDSBCTEL       BCT DISP                             47100021
         MH    REGB,F3+2                                                47200021
         SR    REG14,REG14                                              47300021
RST02400 IC    REG14,2(REGA,REGB)  PICK UP CNT FROM ENTRY               47400021
         CR    REG14,REGD          IS THIS THE SUBSEGMENT               47500021
         BE    RST02600            YES                                  47600021
         IC    REG14,1(REGA,REGB)  GET PTR TO NEXT                      47700021
         MH    REG14,F3+2                                               47800021
         CR    REG14,REGB          WAS THIS THE LAST                    47900021
         BE    ERR2                YES                                  48000021
         LR    REGB,REG14          KEEP LOOKING                         48100021
         SR    REG14,REG14                                              48200021
         B     RST02400                                                 48300021
RST02500 L     REGB,WRK128TP       ADDR OF 128 SUBSEGMENT               48400021
         B     RST02700                                                 48500021
         EJECT                                                          48600021
*                                                                       48700021
*        THE PHYSICAL BUFFER ADDRESS OF THE SEQUENCE MUST BE            48800021
*        COMPUTED SO THAT THE FLOW CONTROL ADDRESS CAN REPLACE          48900021
*        THE PREVIOUS RESOLVING ADDRESS THAT BRANCHES TO THE            49000021
*        END OF THE SEQUENCE.                                           49100021
*                                                                       49200021
RST02600 M     REGA,F256                                                49300021
         D     REGA,F3             COMPUTE PHYSICAL BEFFER ADDRESS      49500021
RST02700 AR    REGB,REGC           DISPL INTO PHYS ADDR                 49600021
         LA    REGB,2(REGB)        PLUS 2 FOR SET MODE                  49700021
         L     REGA,WRKSEQKY       LOAD SEQ-SUB KEY                     49800021
         BR    REG15                                                    49900021
         EJECT                                                          50000021
RST02750 NI    GDSFLAGS,NTSEQSUB   TURN OFF BOTH SWITCHES               50100021
         CLC   8(4,REGA),ZERO      CORRELATED                           50200021
         BNE   RST02770            NO                                   50300021
         OI    GDSFLAGS,CRVLPRES   SET SW                               50400021
RST02770 TM    4(REGA),X'08'       IS THIS A SEQUENCE                   50500021
         BO    RST02800            NO                                   50600021
         OI    GDSFLAGS,SEQ        SET SEQ SW                           50700021
         B     RST02900                                                 50800021
RST02800 OI    GDSFLAGS,SUB        SET SUBR SW                          50900021
RST02900 LA    REGB,2(REGB)        UPDATE TO ADDR LOCATION              51100021
         ST    REGB,WRKBUFR                                             51200021
         L     PARM,GTMDECB1       DECB                                 51300021
         WAIT  ECB=(1)             WAIT                                 51400021
         L     PARM,GTMDECB1                                            51500021
         CLI   0(PARM),X'7F'                                            51520021
         BNE   ERR3                                                     51540021
         NI    0(PARM),X'BF'                                            51560021
         L     REGA,GTMGRDCB       DCB                                  51600021
*                                  WRITE OUT F/C ADDR                   51700021
         GWRITE (PARM),STR,(REGA),2,GDSOVDAT+2,WRKBUFR+2,GDSFCBUF,MF=E  51800021
         ST    REGB,BUF1           SAVE LOC OF UNRES ADDR               51900021
         XC    CPU1,CPU1                                                52000021
         B     RST00500                                                 52100021
RST03000 CLC   WRKBUFR+2(2),GDSREPPB IS ADDR GR THAN OURS               52200021
         BH    RST03300            NO                                   52300021
         L     REGC,WRKBUFR                                             52400021
         A     REGC,LENLEFT        COMPUTE ADDR OF                      52500021
         LA    REGC,4(REGC)        END    OF SEGMENT                    52600021
         EJECT                                                          52700021
*                                                                       52800021
*        A CHECK IS MADE TO SEE IF THE REPLACEMENT DATA IS TO BE        52900021
*        RESET ALSO.  IF NOT IT IS LEFT AS IS.  IF YES, THE FIELDS      53000021
*        ARE SET TO ZERO AND THE FLAG TO SAVE THE NEXT FOUR BYTES       53100021
*        AS REPLACEMENT DATA ARE SET IN THE OACB FOR THE NEXT           53200021
*        OVERFLOW.                                                      53300021
         CH    REGC,GDSREPPB       IS ADDR LESS THEN END                53400021
         BH    RST01500            YES IT IS WITHIN AREA RESET          53500021
         B     RST01600            NO DO NOT RESET                      53600021
RST03200 NI    GDSFLAGS,NTSEQSUB   ZERO SEQ SUB SW                      53700021
         XC    CPU1(8),CPU1        ZERO UNRES ADDR                      53800021
         XC    GDSKEYSV,GDSKEYSV    SET SEQ KEY TO ZERO                 53900021
         B     RST00440                                                 54000021
RST03300 LH    REGC,GDSREPPB       ADDR FOR REPL DATA                   54005021
         A     REGC,F2                                                  54010021
         C     REGC,WRKBUFR        RESET HALF OF REP DATA               54015021
         BNE   RST01600            NO-DO NOT ZERO REP DATA              54020021
*        HALF THE REPLACEMENT DATA IS TO BE RESET. IT WILL BE RETURNED  54025021
*        TO THE GDOA AND THE PTRS WILL BE SET UP. THEN THE REPLACEMENT  54030021
*        DATA FIELDS IN THE GDSCB WILL BE ZEROED.                       54035021
         L     REGC,BUFSTART                                            54040021
         S     REGC,F2                                                  54045021
         ST    REGC,BUFSTART       BACK UP BUFFER START                 54050021
         ST    REGC,BLP            AND BLP                              54055021
         L     REGC,BUFLEN                                              54060021
         A     REGC,F2                                                  54065021
         ST    REGC,BUFLEN         ADD TWO TO LENGTH                    54070021
         L     REGC,OLP                                                 54075021
         MVC   0(2,REGC),GDSREPDT  MOVE FIRST TWO BYTES IN GDOA         54080021
         A     REGC,F2                                                  54085021
         ST    REGC,OLP            UPDATE OLP                           54090021
         B     RST01500            RESET REP DATA                       54095021
         EJECT                                                          54100021
ERR1     LA    REGA,ONE            FIRST PARM IN ERROR                  54200021
ERR1A    ST    REGA,PARER(ERRCD)                                        54300021
         OI    0(ERRCD),PRMER                                           54400021
         B     RST00550            RETURN                               54500021
ERR2     LA    REGA,TWO            CODE-BAD CORVAL                      54600021
         L     REGB,WRKKEY         IS THERE A KEY                       54700021
         LTR   REGB,REGB                                                54800021
         BZ    ERR1A               NO                                   54900021
         LA    REGA,ONE(REGA)      YES CODE FOR BAD KEY                 55000021
         B     ERR1A                                                    55100021
ERR3     OI    0(ERRCD),IO                                              55130021
         B     RST00550                                                 55160021
         EJECT                                                          55200021
*                                                                       55300021
*REGISTERS                                                              55400021
*                                                                       55500021
REG0     EQU   0                                                        55600021
PARM     EQU   1                                                        55700021
REGA     EQU   2                                                        55800021
REGB     EQU   3                                                        55900021
OACB     EQU   4                                                        56000021
WORK     EQU   5                   RST35800                             56100021
ERRCD    EQU   6                                                        56200021
GTMREG   EQU   7                   RST36000                             56300021
GDSREG   EQU   8                                                        56400021
BASE     EQU   9                                                        56500021
REGC     EQU   10                                                       56600021
REGD     EQU   11                                                       56700021
SAVE     EQU   13                                                       56800021
REG14    EQU   14                                                       56900021
REG15    EQU   15                                                       57000021
         EJECT                                                          57100021
GDS      EQU   0                                                        57200021
CORVL    EQU   4                                                        57300021
KEY      EQU   8                                                        57400021
LAST     EQU   X'80'                                                    57500021
NULL     EQU   20                                                       57600021
LEVEL2   EQU   X'10'                                                    57700021
NO       EQU   X'80'                                                    57800021
SEQ      EQU   X'04'                                                    57900021
SUB      EQU   X'02'                                                    58000021
STAT     EQU   24                                                       58100021
BMGT     EQU   816                                                      58200021
SAVEFOUR EQU   X'40'                                                    58300021
SEQM     EQU   X'40'                                                    58400021
SUBM     EQU   X'80'                                                    58500021
NTSEQSUB EQU   X'B9'                                                    58600021
CRVLPRES EQU   X'40'                                                    58700021
EQUIV    EQU   X'80'                                                    58800021
ONE      EQU   1                                                        58900021
PARER    EQU   16                                                       59000021
PRMER    EQU   X'08'                                                    59100021
TWO      EQU   2                                                        59200021
IO       EQU   X'04'                                                    59250021
ETE      EQU   828                                                 000A 59260021
FE       EQU   48                                                  000A 59270021
         EJECT                                                          59300021
RESETCDE DC    F'3'                                                     59400021
KEYSRCH  DC    F'2'                                                     59500021
CORVSRCH DC    F'5'                                                     59600021
H128     DC    H'128'                                                   59700021
F256     DC    F'256'                                                   59800021
F3       DC    F'3'                                                     59900021
SIX      DC    F'6'                                                     60000021
ZERO     DC    F'0'                                                     60100021
FOUR     DC    F'4'                                                     60200021
F2       DC    F'2'                                                     60250021
         EJECT                                                          60300021
WORKAREA DSECT                                                          60400021
WRKPARM  DS    F                                                        60500021
WRKRTNCD DS    F                                                        60600021
WRKSAVE  DS    18F                                                      60700021
WRKSPVSR DS    3F                                                       60800021
WRKCORVL DS    F                                                        60900021
WRKKEY   DS    3F                                                       61000021
WRKPRLST DS    4F                                                       61100021
WRKBUFR  DS    F                                                        61200021
WRKDSP   DS    F                                                        61300021
WRKSEQKY DS    F                                                        61400021
WRK128TP DS    F                                                        61500021
WRKPRM   DS    F                                                        61600021
WRKERR   DS    F                                                        61700021
         EJECT                                                          61800021
OACBARA  DSECT                                                          61900021
OTHER    DS    F                                                        62000021
GDOA     DS    F                                                        62100021
STATUS   DS    F                                                        62200021
CRSA     DS    F                                                        62300021
OLP      DS    F                                                        62400021
BLP      DS    F                                                        62500021
BUFSTART DS    F                                                        62600021
BUFLEN   DS    F                                                        62700021
CPU1     DS    F                                                        62800021
BUF1     DS    F                                                        62900021
CPU2     DS    F                                                        63000021
BUF2     DS    F                                                        63100021
LOGSTRT  DS    F                                                        63200021
LOGCURR  DS    F                                                        63300021
LENLEFT  DS    F                                                        63400021
         COPY  GDSCB                                                    63500021
         COPY  GTMCB                                                    63600021
         END                                                            63700021
./  ADD  SSI=20480255,NAME=IFFAFA13
* TITLE:IDPOS-INDICATE POSITION                                         00400021
* STATUS:CHANGE LEVEL 0                                                 00800021
* FUNCTION:TO PASS TO GSP THE POSITION OF THE BEAM FOR SUBSEQUENT DATA  01200021
*          GENERATION.                                                  01600021
* ENTRY:ENTERED AT IFFAFA13 VIA A CALL TO IDPOS.                        02000021
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD    02400021
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 02800021
*       1.GDSNAME:ADDRESS OF A VARIABLE WHICH CONTAINS THE ADDRESS OF   03200021
*         THE GDSCB.                                                    03600021
*       2.XCOOR:ADDRESS OF A CONSTANT OR VARIABLE,THE VALUE OF WHICH    04000021
*         DESIGNATES THE POSITION THAT IS TO BE USED AS THE ABSOLUTE    04400021
*         STARTING POINT FROM WHICH OTHER X CO-ORDINATES ARE TO BE      04800021
*         COMPUTED.                                                     05200021
*       3.YCOOR-SAME AS X EXCEPT IN THE Y DIRECTION.                    05600021
*             4.XBEAM-ADDRESS OF A CONSTANT OR VARIABLE WHICH CONTAINS  06000021
*                     THE VALUE OF THE XBEAM POSITION.                  06400021
*             5.YBEAM-SAME AS XBEAM EXCEPT IN Y DIRECTION.              06800021
* OUTPUT:NONE TO CALLER.THE GPSXLAST AND GPSYLAST FIELDS OF THE GPSCB   07200021
*        ARE UPDATED TO REFLECT THE NEW POSITION.GDSXCURR AND           07600021
*        GDSYCURR FIELDS ARE SET EQUAL TO GDSXLAST AND GDSYLAST(NO BEAM 08000021
*        PARAMETERS PASSED) OR ARE UPDATED TO REFLECT THE NEW BEAM      08400021
*        POSITIONS.                                                     08800021
* EXIT:RETURN TO CALLER VIA REGISTER  14.                               09200021
* RETURN CODES:2,0  SCALING ERROR                                       09600021
*              4,0  INSUFFICIENT NUMBER OF PARAMETERS                   10000021
*              4,1  INVALID GDSCB                                       10400021
*              0,0  SUCCESSFULL                                         10800021
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE                            11200021
* EXTERNAL ROUTINES:SCALE                                               11600021
* NOTES:THIS ROUTINE EXAMINES THE FOLLOWING CONTROL BLOCKS:             12000021
*       1.GDSCB                                                         12400021
*       2.GTMCB                                                         12800021
*       3.GSPCB                                                         13200021
R0       EQU   0                       PARM REQ 0                       13600021
R1       EQU   1                       PARM REG 1                       14000021
RLIST    EQU   2                       WORKAREA REG                     14400021
RPARAM   EQU   3                       USER PARAM LIST REG              14800021
RGDSCB   EQU   4                       GDSCB ADR REG                    15200021
RE       EQU   8                       WORK REG                         15600021
RBASE    EQU   9                       BASE REG                         16000021
RA       EQU   10                      WORK REG                         16400021
RB       EQU   11                      WORK REG                         16800021
SPARE1   EQU   12                      RSVD PL1                         17200021
RSAVE    EQU   13                      SAVE AREA PTR                    17600021
RC       EQU   14                      WORK REG                         18000021
RD       EQU   15                      WORK REG                         18400021
ZERO     EQU   0                       ZERO                             18800021
RC4      EQU   X'08'                   RTN CODE 4                       19200021
RCC4     EQU   16                      OFFSET TO RC 4                   19600021
ADD1     EQU   1                       ADD INFO                         20000021
LAST     EQU   X'80'                   LAST PARAM                       20400021
GID      EQU   X'03'                   GDSCB ADR                        20800021
OFFSAVE  EQU   8                       SAVE AREA CHAIN                  21200021
XREAL    EQU   X'C0'                   REAL MODE X                      21600021
XINTG    EQU   X'30'                   INTEGER MODE X                   22000021
YREAL    EQU   X'0C'                   REAL MODE Y                      22400021
YINTG    EQU   X'03'                   INTEGER MODE Y                   22800021
XREL     EQU   X'80'                   X-REAL-ABSOLUTE                  23200021
XINT     EQU   X'20'                   X-INTEGER ABSOLUTE               23600021
YREL     EQU   X'08'                   Y-REAL-ABSOLUTE                  24000021
YINT     EQU   X'02'                   Y-INTEGER-ABSOLUTE               24400021
IFFAFA13 CSECT                                                          24800021
         SAVE  (14,12)                                                  25200021
         BALR  RBASE,0                 SET UP BASE REG                  25600021
         USING *,RBASE                 DEFINE BASE REG                  26000021
         LR    RLIST,R1                LOAD REG                         26400021
         USING WORKAREA,RLIST          DEFINE DSECT                     26800021
         L     RPARAM,PLIST            LOAD ADR USER PARM LIST          27200021
         USING PARAM,RPARAM            DEFINE DSECT                     27600021
         ST    RSAVE,SAVE+4            SAVE-SAVE AREA PTR               28000021
         LA    RD,SAVE                 LOAD ADR OF MY SAVE AREA         28400021
         ST    RD,OFFSAVE(RSAVE)       STORE IN USER SAVE AREA          28800021
         LA    RSAVE,SAVE              ESTABLISH NEW SAVE AREA          29200021
         L     RA,RCA                  LOAD RTN CODE ARRAY ADR          29600021
         XC    ZERO(20,RA),ZERO(RA)    INITIALIZE ARRAY                 30000021
         B     AROUND                  BRANCH                           30400021
ERROR    L     RA,RCA                  LOAD RTN CODE ARRAY ADR          30800021
         STC   RB,ZERO(RA)             STORE RTN CODE                   31200021
         ST    RC,ZERO(RA,RD)          STORE ADD INFO                   31600021
OUTRTN   L     RSAVE,SAVE+4            RESTORE OLD SAVE AREA PTR        32000021
         RETURN (14,12),T              RETURN TO CALLING PROGRAM        32400021
AROUND   TM    GDSNM,LAST              LAST PARAM                       32800021
         BO    IND01                   BRANCH-YES                       33200021
         TM    XCOOR,LAST              LAST PARAM                       33600021
         BO    IND01                   BRANCH-YES                       34000021
         B     IND02                   BRANCH                           34400021
IND01    SR    RC,RC                   ADD INFO=0                       34800021
IND03    LA    RB,RC4                  LOAD RTN CODE                    35200021
         LA    RD,RCC4                 LOAD OFFSET                      35600021
         B     ERROR                   BRANCH                           36000021
IND02    L     RGDSCB,GDSNM            LOAD IN DIRECT PTR TO GDSCB      36400021
         L     RGDSCB,ZERO(RGDSCB)     LOAD PTR TO GDSCB                36800021
         USING GDSCB,RGDSCB            DEFINE DSECT                     37200021
         CLI   GDSGDSID,GID            IS THIS VALID GDSCB              37600021
         BE    IND04                   BRANCH IF YES                    38000021
         LA    RC,ADD1                 LOAD ADD INFO                    38400021
         B     IND03                   BRANCH                           38800021
IND04    L     RA,GDSGTMCB             LOAD GTMCB ADR                   39200021
         USING GTMCB,RA                DEFINE DSECT                     39600021
         L     RB,GTMGSPCB             LOAD GSPCB ADR                   40000021
         USING GSPCB,RB                DEFINE DSECT                     40400021
         L     RC,XCOOR                LOAD XCOOR PARM                  40800021
         CL    RC,GSPNULLV             XCOOR=NULL                       41200021
         BE    IND01                   BRANCH-YES                       41600021
         L     RC,YCOOR                L YCOOR PARM                     42000021
         LA    RC,ZERO(RC)             ZERO HI-ORDER BYTE               42400021
         CL    RC,GSPNULLV             YCOOR=NULL                       42800021
         BE    IND01                   BRANCH-YES                       43200021
         XC    DATARAY(52),DATARAY     CLEAR INPUT DATA ARRAY           43600021
         ST    RGDSCB,DATARAY          GDSCB ADR TO ARRAY               44000021
         MVC   RTNARAY(4),RCA          ADR OF RTN CODE ARRAY TO ARRAY   44400021
         L     RA,XCOOR                LOAD ADR OF X CO-ORD INATE       44800021
         MVC   XABS(4),ZERO(RA)        X CO-ORD TO ARRAY                45200021
         L     RA,YCOOR                LOAD ADR OF Y CO-ORDINATE        45600021
         LA    RA,ZERO(RA)             CLEAR HI ORDER BYTE              46000021
         MVC   YABS(4),ZERO(RA)        Y CO-ORD TO ARRAY                46400021
         IC    RE,GDSDATMD             SAVE DATA MODE                   46800021
         XC    MODE(1),MODE            CLEAR TEMP MODE AREA             47200021
         TM    GDSDATMD,XREAL          IS X REAL                        47600021
         BC    5,IND05                 BRANCH-X REAL                    48000021
         OI    MODE,XINT               SET X=INTEGER                    48400021
         B     IND06                   BRANCH                           48800021
IND05    OI    MODE,XREL               SET X=REAL                       49200021
IND06    TM    GDSDATMD,YREAL          IS Y REAL                        49600021
         BC    5,IND07                 BRANCH-Y REAL                    50000021
         OI    MODE,YINT               SET Y= INTEGER                   50400021
         B     IND08                   BRANCH                           50800021
IND07    OI    MODE,YREL               SET Y=REAL                       51200021
IND08    MVC   GDSDATMD(1),MODE        MOVE IN DUMMY MODE               51600021
         LA    R1,DATARAY              LOAD INPUT PARAM LIST ADR        52000021
         LINK  EP=IFFAHA06,MF=(E,(1))                                   52400021
         LTR   RD,RD                   WAS SCALE SUCCESSFULL            52800021
         BZ    IND09                   BRANCH IF YES                    53200021
         STC   RE,GDSDATMD             RESTORE DATA MODE                53600021
         B     OUTRTN                  BRANCH                           54000021
IND09    MVC   SAVEX(4),GDSXLAST       SAVE VALUE                       54400021
         MVC   SAVEY(4),GDSYLAST       SAVE VALUE                       54800021
         MVC   GDSXLAST(4),XABS        MOVE IN SCALED DATA              55200021
         MVC   GDSYLAST(4),YABS        MOVE IN SCALED DATA              55600021
         TM    YCOOR,LAST              WAS BEAM PASSED                  56000021
         BO    IND10                   BRANCH-NO BEAM PASSED            56400021
         B     IND11                   BRANCH TO BEAM PROCESSING        56800021
IND10    MVC   GDSXCURR(2),XABS+2      MOVE IN SCALLED DATA             57200021
         MVC   GDSYCURR(2),YABS+2      MOVE IN SCALED DATA              57600021
         STC   RE,GDSDATMD             RESTORE DATA MODE IN GDSCB       58000021
         B     OUTRTN                  BRANCH                           58400021
IND11    XC    DATARAY(52),DATARAY     CLEAR DATA ARRAY                 58800021
         ST    RGDSCB,DATARAY          GDSCB ADR TO DATA ARRAY          59200021
         MVC   RTNARAY(4),RCA          MOVE IN ADR OF RTN CODE ARRAY    59600021
         L     RA,GDSGTMCB             LOAD GTMCB ADR                   60000021
         L     RB,GTMGSPCB             LOAD GSPCB ADR                   60400021
         L     RA,XBEAM                LOAD ADR OF XBEAM                60800021
         LA    RA,ZERO(RA)             ZERO HI ORDER BYTE               61200021
         CL    RA,GSPNULLV             XBEAM=NULL                       61600021
         BE    IND17                   BRANCH=NULL                      62000021
         MVC   XABS(4),ZERO(RA)        X BEAM TO INPUT ARRAY            62400021
IND12    TM    XBEAM,LAST              LAST PARAM                       62800021
         BO    IND17                   BRANCH LAST PARAM                63200021
         L     RA,YBEAM                LOAD ADR OF YBEAM                63600021
         LA    RA,ZERO(RA)             ZERO HI ORDER BYTE               64000021
         CL    RA,GSPNULLV             YBEAM=NULL                       64400021
         BE    IND17                   BRANCH=NULL                      64800021
         MVC   YABS(4),ZERO(RA)        MOVE IN YBEAM TO INPUT ARRAY     65200021
IND14    LA    R1,DATARAY              LOAD ADR OF PARAM LIST           65600021
         LINK  EP=IFFAHA06,MF=(E,(1))  LINK TO SCALE                    66000021
         LTR   RD,RD                   WAS SCALE SUCCESSFULL            66400021
         BZ    IND15                   BRANCH-SCALE SUCCESSFULL         66800021
         STC   RE,GDSDATMD             RESTORE DATA MODE                67200021
         MVC   GDSXLAST(4),SAVEX       RESTORE GDSXLAST TO PREVIOUS VAL 67600021
         MVC   GDSYLAST(4),SAVEY       RESTORE GDSYLAST TO PREVIOUS VAL 68000021
         B     OUTRTN                  BRANCH                           68400021
IND15    STC   RE,GDSDATMD             RESTORE DATA MODE                68800021
         MVC   GDSXCURR(2),XABS+2      MOVE IN SCALED XBEAM             69200021
         MVC   GDSYCURR(2),YABS+2      MOVE IN SCALED YBEAM             69600021
         B     OUTRTN                  BRANCH                           70000021
IND17    MVC   GDSXLAST(4),SAVEX       RESTORE XLAST                    70400021
         MVC   GDSYLAST(4),SAVEY       RESTORE YLAST                    70800021
         STC   RE,GDSDATMD             RESTORE DATA MODE                71200021
         B     IND01                   BRANCH                           71600021
         CNOP  0,8                                                      72000021
         COPY  GTMCB                                                    72400021
         COPY  GSPCB                                                    72800021
         COPY  GDSCB                                                    73200021
PARAM    DSECT                                                          73600021
GDSNM    DS    1F                                                       74000021
XCOOR    DS    1F                                                       74400021
YCOOR    DS    1F                                                       74800021
XBEAM    DS    1F                                                       75200021
YBEAM    DS    1F                                                       75600021
WORKAREA DSECT                                                          76600021
PLIST    DS    1F                                                       77600021
RCA      DS    1F                                                       78600021
SAVE     DS    18F                                                      79600021
SAVEX    DS    1F                                                       80600021
SAVEY    DS    1F                                                       81600021
MODE     DS    1F                                                       82600021
DATARAY  DS    1F                                                       83600021
RTNARAY  DS    1F                                                       84600021
DUMMY1   DS    4F                                                       85600021
XABS     DS    1F                                                       86600021
YABS     DS    1F                                                       87600021
DUMMY2   DS    5F                                                       88600021
         END                                                            89600021
./  ADD  SSI=20480256,NAME=IFFAFA14
* TITLE:FSMOD-FORCE MODE                                                01000021
* STATIS:CHANGE LEVEL 0                                                 02000021
* FUNCTION:THIS ROUTINE WILL CAUSE THE NEXT CALL TO A DATA GENERATION   03000021
*          ROUTINE TO SET THE MODE BEFORE PLACING ORDERS IN THE BUFFER  04000021
*          REGARDLESS OF WHAT THE CURRENT MODE SETTING WAS.             05000021
* ENTRY:ENTERED AT IFFAFA14 VIA A CALL TO FSMOD.                        06000021
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD    07000021
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 08000021
*       1.GDSNAME-A VARIABLE WHICH CONTAINS THE ADDRESS OF THE GDSCB.   09000021
* OUTPUT:NONE TO CALLER.GDSGRMOO FIELD OF GDSCB IS SET TO ZERO.         10000021
* EXIT:RETURN TO CALLER VIA REGISTER 14.                                11000021
* RETURN CODES:4,1 INVALID GDSCB                                        12000021
*              0,0 SUCCESSFULL                                          13000021
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE.                           14000021
* NOTES:THE FOLLOWING CONTROL BLOCKS ARE EXAMINED BY THIS ROUTINE:      15000021
*       1.GDSCB                                                         16000021
R0       EQU   0                       PARM REG 0                       17000021
R1       EQU   1                       PARM REG 1                       18000021
RLIST    EQU   2                       LIST REG                         19000021
RPARAM   EQU   3                       PARAM REG                        20000021
RGDSCB   EQU   4                       GDSCB ADR REG                    21000021
RA       EQU   5                       WORK REG                         22000021
RB       EQU   6                       WORK REG                         23000021
RC       EQU   7                       WORK REG                         24000021
RD       EQU   8                       WORK REG                         25000021
RBASE    EQU   9                       BASE REG                         26000021
ADD1     EQU   1                       ADD INFO=1                       27000021
ZERO     EQU   0                       ZERO                             28000021
RCC4     EQU   16                      OFFSET                           29000021
RC4      EQU   X'08'                   INVALID PARAM RTN CODE           30000021
GID      EQU   X'03'                   GDSCB ID                         31000021
IFFAFA14 CSECT                                                          32000021
         SAVE  (14,12)                                                  33000021
         BALR  RBASE,0                 SET UP BASE REG                  34000021
         USING *,RBASE                 DEFINE BASE REG                  35000021
         LR    RLIST,R1                SAVE REG                         36000021
         USING WORKAREA,RLIST          DEFINE DSECT                     37000021
         L     RPARAM,PLIST            LOAD ADR USER PARM LIST          38000021
         USING PARAM,RPARAM            DEFINE DSECT                     39000021
         L     RA,RCA                  LOAD RTN CODE ARRAY ADR          40000021
         XC    ZERO(20,RA),ZERO(RA)    INITIALIZE ARRAY                 41000021
         B     AROUND                  BRANCH                           42000021
ERROR    L     RA,RCA                  LOAD RTN CODE ARRAY ADR          43000021
         STC   RB,ZERO(RA)             STORE RTN CODE                   44000021
         ST    RC,ZERO(RA,RD)          STORE ADD INFO                   45000021
OUTRTN   RETURN (14,12),T              RETURN                           46000021
AROUND   L     RGDSCB,GDSNAME          LOAD INDIRECT PTR TO GDSCB       47000021
         LA    RGDSCB,ZERO(RGDSCB)     ZERO HI ORDER BYTE               48000021
         L     RGDSCB,ZERO(RGDSCB)     LOAD PTR TO GDSCB                49000021
         USING GDSCB,RGDSCB            DEFINE DSECT                     50000021
         CLI   GDSGDSID,GID            IS THIS A VALID GDSCB            51000021
         BE    F1                      BRANCH IF YES                    52000021
         LA    RB,RC4                  LOAD RET CODE                    53000021
         LA    RC,ADD1                 LOAD ADD INFO                    54000021
         LA    RD,RCC4                 LOAD OFFSET                      55000021
         B     ERROR                   BRANCH                           56000021
F1       XC    GDSGRMOD(1),GDSGRMOD    CLEAR BYTE                       57000021
         B     OUTRTN                                                   58000021
         DS    0F                                                       59000021
ZERO1    DC    1F'0'                                                    60000021
         CNOP  0,8                                                      61000021
WORKAREA DSECT                                                          62000021
PLIST    DS    1F                                                       63000021
RCA      DS    1F                                                       64000021
PARAM    DSECT                                                          65000021
GDSNAME  DS    1F                                                       66000021
         COPY  GDSCB                                                    67000021
         END                                                            68000021
./  ADD  SSI=20480258,NAME=IFFAFA15
* TITLE:STEOS-SET EOS                                                   00200021
* STATUS:CHANGE LEVEL0                                                  00400021
* FUNCTION:TO SET AND END ORDER SEQUENCE ORDER INTO THE BUFFER.         00600021
* ENTRY:ENTERED AT IFFAFA15 VIA A CALL TO STEOS.                        00800021
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD    01000021
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 01200021
*       1.GDSNAME-A VARIABLE WHICH CONTAINS THE ADDRESS OF THE GASCB.   01400021
*       2.CORVAL-A VARIABLE WHICH CONTAINS A USER CORRELATION VALUE.    01600021
*       3.KEY-A VARIABLE INTO WHICH STEOS WILL PLACE A KEY.             01800021
*       4.GENCODE-A VARIABLE WHOSE VALUE INDICATES:                     02000021
*         1-GENERATE IN INCLUDE STATUS                                  02200021
*         2-GENERATE IN OMIT STATUS                                     02400021
* OUTPUT:THE END ORDER SEQUENCE ORDER IS PLACED IN THE BUFFER IN THE    02600021
*        STATUS REQUESTED BY GENCODE.THE KEY IS RETURNED TO THE CALLER. 02800021
* EXIT:RETURN TO CALLER VIA REGISTER 14.                                03000021
* RETURN CODES:3,0 NO STORAGE OR NO BUFFER AVAILABLE                    03200021
*              4,1 INVALID GDSCB                                        03400021
*              4,2 CORVAL IS 0                                          03600021
*              4,4 INVALID GENCODE                                      03800021
*              0,0 SUCCESSFULL                                          04000021
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE                            04200021
* EXTERNAL ROUTINES:DATA STORE                                          04400021
*                   KEY MANAGEMENT                                      04600021
*                   RESET                                               04800021
* NOTES:THE FOLLOWING CONTROL BLOCKS ARE EXAMINED BY THIS ROUTINE:      05000021
*       1.GDSCB                                                         05200021
*       2.GTMCB                                                         05400021
*       3.GSPCB                                                         05600021
*       4.OACB                                                          05800021
R0       EQU   0                       PARM REG 0                       06000021
R1       EQU   1                       PARM REG 1                       06200021
RLIST    EQU   2                       WORKAREA REG                     06400021
RPARM    EQU   3                       USER PARM LIST REG               06600021
RGDSCB   EQU   4                       GDSCB ADR REG                    06800021
RBASE    EQU   9                       BASE REG                         07000021
RA       EQU   10                      WORK REG                         07200021
RB       EQU   11                      WORK REG                         07400021
SPARE1   EQU   12                      RESERVED FOR PL1                 07600021
RSAVE    EQU   13                      SAVE AREA PTR REG                07800021
RC       EQU   14                      WORK REG                         08000021
RD       EQU   15                      WORK REG                         08200021
ADD1     EQU   1                       ADD INFO 1                       08400021
ADD4     EQU   4                       ADD INFO 4                       08600021
BFRSUB   EQU   X'80'                   BUFFER SUBROUTINE                08800021
BFRSUBA  EQU   X'02'                   BFR SUBROUTINE BEGUN             09000021
DUMKEY   EQU   X'08'                   DUMMY KEY                        09200021
EOS      EQU   X'30'                   END ORDER SEQUENCE               09400021
GID      EQU   X'03'                   GDSCB ID                         09600021
INCLUDE  EQU   X'04'                   INCLUDE                          09800021
INTKYCOR EQU   X'80'                   INTERNAL KEY/CORVAL SWITCH       10000021
LAST     EQU   X'80'                   LAST PARM                        10200021
LEVEL2   EQU   X'10'                   LEVEL 2 GDS                      10400021
LOGS     EQU   52                      OFFSET TO LOGICAL BFR START      10600021
LOGSTART EQU   2                       LOG START IN KEY                 10800021
MULTIPLE EQU   X'80'                   MULTIPLE KEY BIT                 11000021
OFFSAVE  EQU   8                       SAVE AREA CHAIN                  11200021
RCC3     EQU   12                      OFFSET TO ADD INFO               11400021
RCC4     EQU   16                      OFFSET TO ADD INFO               11600021
RC3      EQU   X'10'                   RTN CODE 3                       11800021
RC4      EQU   X'08'                   RTN CODE 4                       12000021
SEQ      EQU   X'40'                   SEQUENCE PART                    12200021
SEQA     EQU   X'04'                   SEQUENCE BEGUN                   12400021
USECOR   EQU   X'40'                   USER CORVAL                      12600021
USEGEN   EQU   X'10'                   USER GENCODE                     12800021
USEKEY   EQU   X'20'                   USER KEY                         13000021
ZERO     EQU   0                       ZERO                             13200021
FE       EQU   48                                                  000A 13260021
ETE      EQU   828                                                 000A 13320021
IFFAFA15 CSECT                                                          13400021
*1677,536000                                                       000A 13500021
         SAVE  (14,12)                 SAVE REGS                        13600021
         BALR  RBASE,0                 SET UP BASE REG                  13800021
         USING *,RBASE                 DEFINE BASE REG                  14000021
         LR    RLIST,R1                LOAD REGISTER                    14200021
         USING WORKAREA,RLIST          DEFINE DSECT                     14400021
         L     RPARM,PLIST             LOAD ADR OF USER PARAM LIST      14600021
         USING PARAM,RPARM             DEFINE DSECT                     14800021
         ST    RSAVE,SAVE+4            SAVE-SAVE AREA PTR               15000021
         LA    RD,SAVE                 LOAD ADR OF MY SAVE AREA         15200021
         ST    RD,OFFSAVE(RSAVE)       STORE IN USER SAVE AREA          15400021
         LA    RSAVE,SAVE              ESTABLISH NEW SAVE AREA          15600021
         L     RA,RCA                  LOAD RTN CODE ARRAY ADR          15800021
         XC    ZERO(20,RA),ZERO(RA)    INITIALIZE RTN CODE ARRAY        16000021
         B     AROUND                  BRANCH                           16200021
ERROR    L     RA,RCA                  LOAD RTN CODE ARRAY ADR          16400021
         STC   RB,ZERO(RA)             STORE RTN CODE                   16600021
         ST    RC,ZERO(RA,RD)          STORE ADD INFO AT PROPER OFFSET  16800021
OUTRTN   L     RSAVE,SAVE+4            RESTORE OLD SAVE AREA PTR        17000021
         RETURN (14,12),T              RETURN                           17200021
AROUND   XC    SWITCH(1),SWITCH        INITIALIZE SWITCH                17400021
         XC    TEMPKEY(12),TEMPKEY     INITIALIZE TEMPORARY KEY         17600021
         L     RGDSCB,GDSNM            LOAD INDIRECT PTR TO GDSCB       17800021
         LA    RGDSCB,ZERO(RGDSCB)     ZERO HI ORDER BYTE               18000021
         L     RGDSCB,ZERO(RGDSCB)     LOAD GDSCB ADR                   18200021
         USING GDSCB,RGDSCB            DEFINE DSECT                     18400021
         CLI   GDSGDSID,GID            VALID  GDSCB                     18600021
         BE    ST01                    BRANCH IF VALID                  18800021
         LA    RC,ADD1                 LOAD ADD INFO                    19000021
ST02     LA    RB,RC4                  LOAD RTN CODE                    19200021
         LA    RD,RCC4                 LOAD ADD INFO OFFSET             19400021
         B     ERROR                   BRANCH                           19600021
ST01     TM    GDSNM,LAST              IS THIS THE LAST PARM            19800021
         BO    ST03                    BRANCH-LAST PARAM                20000021
         L     RA,GDSGTMCB             LOAD GTMCB ADR                   20200021
         USING GTMCB,RA                DEFINE DSECT                     20400021
         L     RB,GTMGSPCB             LOAD GSPCB ADR                   20600021
         USING GSPCB,RB                DEFINE DSECT                     20800021
         L     RC,CORVAL               LOAD CORVAL ADR                  21000021
         LA    RC,ZERO(RC)             ZERO HI ORDER BYTE               21200021
         CL    RC,GSPNULLV             CORVAL=NULL                      21400021
         BE    ST04                    BRANCH-CORVAL=NULL               21600021
         OI    SWITCH,USECOR           INDICATE USER CORVAL PRESENT     21800021
         CLC   ZERO(4,RC),ZERO1        USER CORVAL=0                    22000021
         BNE   ST04                    BRANCH-CORVAL NOT EQUAL TO 0     22200021
         L     RC,TWO                  LOAD ADD INFO                    22400021
         B     ST02                    BRANCH                           22600021
ST04     TM    CORVAL,LAST             IS THIS THE LAST PARM            22800021
         BO    ST03                    BRANCH-LAST PARM                 23000021
         L     RC,KEY                  LOAD KEY ADR                     23200021
         LA    RC,ZERO(RC)             ZERO HI ORDER BYTE               23400021
         CL    RC,GSPNULLV             KEY=NULL                         23600021
         BE    ST05                    BRANCH-KEY=NULL                  23800021
         OI    SWITCH,USEKEY           INDICATE USER KEY PRESENT        24000021
ST05     TM    KEY,LAST                LAST PARAM                       24200021
         BO    ST03                    BRANCH-LAST PARM                 24400021
         L     RC,GENCODE              LOAD GENCODE ADR                 24600021
         LA    RC,ZERO(RC)             ZERO HI ORDER BYTE               24800021
         CL    RC,GSPNULLV             GEN CODE=NULL                    25000021
         BE    ST03                    BRANCH-GENCODE=NULL              25200021
         OI    SWITCH,USEGEN           INDICATE USER GENCODE PRESENT    25400021
         L     RC,ZERO(RC)             LOAD VALUE OF GENCODE            25600021
         CL    RC,ONE                  GEN CODE=1                       25800021
         BE    ST03                    BRANCH IF YES                    26000021
         CL    RC,TWO                  GEN CODE=2                       26200021
         BE    ST03                    BRANCH IF YES                    26400021
ST23     LA    RC,ADD4                 LOAD ADD INFO CODE               26600021
         B     ST02                    BRANCH                           26800021
ST03     TM    GDSFLAGS,LEVEL2         LEVEL 2 GDS                      27000021
         BO    ST06                    BRANCH-LEVEL 2                   27200021
         TM    SWITCH,USECOR           USER CORVAL PRESENT              27400021
         BC    14,ST06                 BRANCH IF NO                     27600021
ST19     L     RC,GDSAOACB             LOAD ADR OF OACB                 27800021
         L     RD,LOGS(RC)             LOAD LOGICAL START (BFR)         28000021
         STH   RD,TEMPKEY+2            STORE IN KEY                     28200021
         OI    W1A,MULTIPLE            INDICATE MULTIPLE IN KEY         28400021
         OI    W1A,EOS                 INDICATE END ORDER SEQUENCE      28600021
         TM    SWITCH,USEGEN           USER GEN CODE                    28800021
         BO    ST07                    BRANCH-YES                       29000021
ST09     OI    W1A,INCLUDE             SET INCLUDE STATUS               29200021
         B     ST08                    BRANCH                           29400021
ST07     L     RA,GENCODE              LOAD ADR OF GENCODE VALUE        29600021
         LA    RA,ZERO(RA)             ZERO HI ORDER BYTE               29800021
         CLC   ZERO(4,RA),ONE          GENCODE=ONE                      30000021
         BE    ST09                    BRANCH IF YES                    30200021
ST08     TM    GDSFLAGS,SEQA           PART OF SEQUENCE                 30400021
         BC    14,ST10                 BRANCH-NO                        30600021
         OI    W1D,SEQ                 INDICATE PART OF SEQUENCE        30800021
ST10     TM    GDSFLAGS,BFRSUBA        PART OF BFR SUBROUTINE           31000021
         BC    14,ST11                 BRANCH-NO                        31200021
         OI    W1D,BFRSUB              INDICATE PART OF BFR SUB         31400021
ST11     TM    SWITCH,DUMKEY           IS THIS OUT OF LINE REQUEST      31600021
         BO    ST20                    BRANCH IF YES                    31800021
         L     RA,CORVAL               LOAD CORVAL ADR                  32000021
         LA    RA,ZERO(RA)             ZERO HI ORDER BYTE               32200021
         MVC   CORVALA(4),ZERO(RA)     MOVE IN CORVAL                   32400021
         OI    SWITCH,INTKYCOR         SET INTERNAL SWITCH              32600021
ST06     TM    SWITCH,USEKEY           IS THERE KEY PARAM               32800021
         BO    ST12                    BRANCH IF YES                    33000021
ST13     TM    SWITCH,USEGEN           USER GENCODE                     33200021
         BO    ST14                    BRANCH IF YES                    33400021
ST21     TM    SWITCH,INTKYCOR         INTERNAL SWITCH ON               33600021
         BO    ST15                    BRANCH IF YES                    33800021
         MVC   RTNARY(4),RCA           MOVE IN RTN CODE ARRAY ADR       34000021
         ST    RGDSCB,GDSCBA           STORE GDSCB ADR                  34200021
         MVC   VALUEA(4),TWO           MOVE IN VALUE                    34400021
         MVC   ORDER(2),GEOS           MOVE IN ORDER                    34600021
         LA    R1,GDSCBA               LOAD PARAM LIST ADR              34800021
         LINK  EP=IFFAHA05,MF=(E,(1))  LINK TO DATA STORE               35000021
         XC    GDSGRMOD(1),GDSGRMOD    CLEAR MODE                       35200021
         LTR   RD,RD                   DATA STORE SUCCESSFULL           35400021
         BZ    ST16                    BRANCH-YES                       35600021
         B     OUTRTN                  BRANCH                           35800021
ST16     TM    SWITCH,USEKEY           IS THERE A KEY                   36000021
         BC    14,OUTRTN               BRANCH IF NO                     36200021
         L     RA,KEY                  LOAD ADR OF KEY                  36400021
         LA    RA,ZERO(RA)             ZERO HIGH ORDER BYTE             36600021
         SR    RB,RB                   CLEAR REG                        36800021
         LH    RB,LOGSTART(RA)         LOAD PREV LOGICAL START          37000021
         L     RC,GDSAOACB             LOAD OACB ADDRESS                37200021
         L     RD,LOGS(RC)             LOAD NEW LOGICAL START           37400021
         SR    RD,RB                   DETERMINE LENGTH                 37600021
         STH   RD,ZERO(RA)             STORE IN USER KEY                37800021
         B     OUTRTN                  BRANCH                           38000021
ST12     TM    GDSFLAGS,LEVEL2         LEVEL2 GDS                       38200021
         BC    14,ST17                 BRANCH IF NO                     38400021
         L     RA,GDSAOACB             LOAD OACB ADR                    38600021
         L     RB,LOGS(RA)             LOAD LOGICAL BFR START           38800021
         L     RA,KEY                  LOAD KEY ADR                     39000021
         LA    RA,ZERO(RA)             ZERO HI ORDER BYTE               39200021
         STH   RB,LOGSTART(RA)         STORE IN USER KEY                39400021
         B     ST13                    BRANCH                           39600021
ST17     TM    SWITCH,INTKYCOR         INTERNAL SWITCH ON               39800021
         BC    14,ST18                 BRANCH IF NO                     40000021
         L     RA,KEY                  LOAD ADR OF KEY                  40200021
         LA    RA,ZERO(RA)             ZERO HI ORDER BYTE               40400021
         MVC   LOGSTART(2,RA),TEMPKEY+2 OVE IN LOGICAL START            40600021
         B     ST13                    BRANCH                           40800021
ST18     OI    SWITCH,DUMKEY           SET OUT OF LINE REQUEST          41000021
         B     ST19                    BRANCH                           41200021
ST20     OI    SWITCH,INTKYCOR         INDICATE INTERNAL KEY            41400021
         L     RA,KEY                  LOAD KEY ADR                     41600021
         LA    RA,ZERO(RA)             ZERO HI ORDER BYTE               41800021
         MVC   LOGSTART(2,RA),TEMPKEY+2  MOVE IN LOGICAL START          42000021
         B     ST13                    BRANCH                           42200021
ST14     L     RA,GENCODE              LOAD GEN CODE ADR                42400021
         LA    RA,ZERO(RA)             ZERO HI ORDER BYTE               42600021
         CLC   ZERO(4,RA),ONE          GENCODE=1                        42800021
         BE    ST21                    BRANCH IF YES                    43000021
         TM    SWITCH,INTKYCOR         INTERNAL SWITCH ON               43200021
         BO    ST22                    BRANCH IF YES                    43400021
         B     ST23                    BRANCH-GENCODE ERROR             43600021
ST22     MVC   ORDER(2),GTRU           SET UP OMIT                      43800021
ST24     ST    RGDSCB,GDSCBA           STORE GDSCB ADR                  44000021
         MVC   RTNARY(4),RCA           MOVE IN RTN CODE ARRAY ADR       44200021
         MVC   VALUEA(4),CALL1         MOVE IN VALUE                    44400021
         B     ST25                    BRANCH                           44600021
ST15     MVC   ORDER(2),GNOP4          SET UP INCLUDE                   44800021
         B     ST24                    BRANCH                           45000021
ST25     LA    R1,GDSCBA               LOAD PARAM LIST ADR              45200021
         LINK  EP=IFFAHA05,MF=(E,(1))  TO DATA STORE                    45400021
         LTR   RD,RD                   DATA STORE SUCCESSFULL           45600021
         BZ    ST26                    BRANCH IF YES                    45800021
         B     OUTRTN                  BRANCH                           46000021
ST26     ST    RGDSCB,GDSCBA           STORE GDSCB ADR                  46200021
         MVC   RTNARY(4),RCA           MOVE IN RTN CODE ARRAY ADDRESS   46400021
         MVC   VALUEA(4),TWO           MOVE IN CONSTANT                 46600021
         MVC   ORDER(2),GEOS           MOVE IN ORDER                    46800021
         LA    R1,GDSCBA               LOAD PARM LIST ADR               47000021
         LINK  EP=IFFAHA05,MF=(E,(1))  TO DATA STORE                    47200021
         LTR   RD,RD                   DATA STORE SUCCESSFULL           47400021
         BZ    ST27                    BRANCH IF YES                    47600021
         B     RESET                   BRANCH                           47800021
ST27     ST    RGDSCB,GDSCBA           STORE GDSCB ADR                  48000021
         MVC   RTNARY(4),RCA           MOVE IN RTN CODE ARRAY ADR       48200021
         MVC   VALUEA(4),CALL3         MOVE IN CONSTANT                 48400021
         LA    R1,GDSCBA               LOAD ADR OF PARM LIST            48600021
         LINK  EP=IFFAHA05,MF=(E,(1))  TO DATA STORE                    48800021
         XC    GDSGRMOD(1),GDSGRMOD    CLEAR MODE                       49000021
         LTR   RD,RD                   DATA STORE SUCCESSFULL           49200021
         BZ    ST28                    BRANCH IF YES                    49400021
         B     RESET                   BRANCH                           49600021
ST28     L     RA,GDSAOACB             LOAD OACB ADR                    49800021
         L     RA,LOGS(RA)             LOAD NEW LOGICAL START ADR       50000021
         SR    RB,RB                   CLEAR REG                        50200021
         LH    RB,TEMPKEY+2            LOAD OLD LOGICAL START ADR       50400021
         SR    RA,RB                   DETERMINE LENGTH                 50600021
         STH   RA,TEMPKEY              STORE LENGTH IN KEY              50800021
         TM    SWITCH,USEKEY           USER KEY                         51000021
         BO    ST29                    BRANCH IF YES                    51200021
         B     ST30                    BRANCH                           51400021
ST29     L     RA,KEY                  LOAD ADR USER KEY                51600021
         LA    RA,ZERO(RA)             ZERO HI ORDER BYTE               51800021
         MVC   ZERO(4,RA),TEMPKEY      MOVE IN KEY                      52000021
ST30     MVC   CODEA(4),CODE           MOVE IN CODE                     52200021
         ST    RGDSCB,GDSCBB           STORE GDSCB ADR                  52400021
         LA    RA,CODEA                LOAD ADR OF CODE                 52600021
         ST    RA,CODEB                STORE CODE ADR                   52800021
         LA    RA,TEMPKEY              LOAD ADR OF KEY                  53000021
         ST    RA,KEYB                 STORE KEY ADR                    53200021
         LA    R1,GDSCBB               LOAD ADR OF PARM LIST            53400021
         L     RA,GDSGTMCB         GET POINTER TO GTMCB            000A 53460021
         L     RA,4(RA)            GET POINTER TO GSPCB            000A 53520021
         L     RA,FE(RA)           GET POINTER TO STATUS TABLE     000A 53580021
         L     RD,ETE(RA)          GET ADRS OF KEY TABLE MGMT      000A 53640021
         BALR  RC,RD               BRANCH TO KEY TABLE MGMT        000A 53700021
         LTR   RD,RD                   KEY TABLE SUCCESSFULL            53800021
         BZ    OUTRTN                  BRANCH IF YES                    54000021
         L     RA,RCA                  LOAD RTN CODE ARRAY ADR          54200021
         MVI   ZERO(RA),RC3            MOVE IN RTN CODE                 54400021
         LA    RB,ADD4                 LOAD ADD INFO                    54600021
         ST    RB,RCC3(RA)             STORE ADD INFO                   54800021
RESET    L     RA,RCA                  LOAD RTN CODE ARRAY ADR          55000021
         MVC   SAVE1(20),ZERO(RA)      SAVE ARRAY                       55200021
         XC    GDSGRMOD(1),GDSGRMOD    RESET MODE                       55400021
         L     RB,GDSAOACB             LOAD OACB ADR                    55600021
         L     RB,LOGS(RB)             LOAD NEW LOGICAL START ADR       55800021
         SR    RC,RC                   CLEAR REG                        56000021
         LH    RC,TEMPKEY+2            LOAD OLD LOGICAL START ADR       56200021
         SR    RB,RC                   DETERMINE LENGTH                 56400021
         STH   RB,TEMPKEY              STORE LENGTH                     56600021
         LA    RB,GDSCBC               LOAD ADR OF PARM                 56800021
         ST    RB,GDSCBD               STORE ADR                        57000021
         ST    RGDSCB,GDSCBC           STORE GDSCB ADR                  57200021
         LA    RB,TEMPKEY              LOAD ADR OF KEY                  57400021
         ST    RB,KEYD                 STORE KEY ADR                    57600021
         TM    SWITCH,USECOR           USER CORVAL                      57800021
         BO    ST31                    BRANCH IF YES                    58000021
         XC    CORVALC(4),CORVALC      INDICATE ZERO CORVAL             58200021
         B     ST32                    BRANCH                           58400021
ST31     L     RB,CORVAL               LOAD ADR OF CORVAL               58600021
         LA    RB,ZERO(RB)             ZERO HI ORDER BYTE               58800021
         MVC   CORVALC(4),ZERO(RB)     MOVE IN USER CORVAL              59000021
ST32     LA    RB,CORVALC              LOAD PARM ADR                    59200021
         ST    RB,CORVALD              STORE ADR                        59400021
         MVI   KEYD,LAST               INDICATE LAST PARM               59600021
         MVC   RTNARYB(4),RCA          MOVE IN RTN CODE ARRAY ADR       59800021
         LA    RB,GDSCBD               LOAD ADR PARM LIST               60000021
         ST    RB,PLISTB               STORE ADR                        60200021
         LA    R1,PLISTB               LOAD ADR OF PARM LIST            60400021
         LINK  EP=IFFAFA12,MF=(E,(1))  TO RESET                         60600021
         MVC   ZERO(20,RA),SAVE1       RESTORE RTN CODE ARRAY           60800021
         B     OUTRTN                  BRANCH                           61000021
         DS    0F                                                       61200021
ZERO1    DC    1F'0'                                                    61400021
ONE      DC    A(1)                                                     61600021
TWO      DC    A(2)                                                     61800021
GNOP4    DC    X'2AC0'                                                  62000021
GTRU     DC    X'2AFF'                                                  62200021
GEOS     DC    X'2A81'                                                  62400021
CALL1    DC    X'01000004'                                              62600021
CALL3    DC    X'02000000'                                              62800021
         DS    0F                                                       63000021
CODE     DC    1F'1'                                                    63200021
         CNOP  0,8                                                      63400021
         COPY  GSPCB                                                    63600021
         COPY  GTMCB                                                    63800021
         COPY  GDSCB                                                    64000021
PARAM    DSECT                                                          64200021
GDSNM    DS    1F                                                       64400021
CORVAL   DS    1F                                                       64600021
KEY      DS    1F                                                       64800021
GENCODE  DS    1F                                                       65000021
WORKAREA DSECT                                                          65200021
PLIST    DS    1F                                                       65400021
RCA      DS    1F                                                       65600021
SAVE     DS    18F                                                      65800021
SWITCH   DS    X   '                                                    66000021
*              X'80'                   KEY/CORVAL INTERNALLY            66200021
*              X'40'                   USER CORVAL                      66400021
*              X'20'                   USER KEY                         66600021
*              X'10'                   USER GENCODE                     66800021
TEMPKEY  DS    1F                                                       67000021
W1A      DS    1X                                                       67200021
W1B      DS    1X                                                       67400021
W1C      DS    1X                                                       67600021
W1D      DS    1X                                                       67800021
CORVALA  DS    1F                                                       68000021
GDSCBA   DS    1F                                                       68200021
RTNARY   DS    1F                                                       68400021
VALUEA   DS    1H                                                       68600021
VALUEB   DS    1H                                                       68800021
ORDER    DS    1H                                                       69000021
         DS    1H                                                       69200021
CODEA    DS    1F                                                       69400021
GDSCBB   DS    1F                                                       69600021
CODEB    DS    1F                                                       69800021
KEYB     DS    1F                                                       70000021
SAVE1    DS    5F                                                       70200021
GDSCBC   DS    1F                                                       70400021
CORVALC  DS    1F                                                       70600021
GDSCBD   DS    1F                                                       70800021
CORVALD  DS    1F                                                       71000021
KEYD     DS    1F                                                       71200021
PLISTB   DS    1F                                                       71400021
RTNARYB  DS    1F                                                       71600021
         END                                                            71800021
./  ADD  SSI=20480153,NAME=IFFAFA19
         TITLE 'IFFAFA19 - ORGDS - ORDER GDS'                           00010013
*STATUS: CHANGE LEVEL 000                                               00020013
*                                                                       00030013
*FUNCTION/OPERATION: BUILDS A LIST OF ALL GDS'S ON THE TERMINAL IN THE  00040013
*        NEW DISPLAY ORDER. READS THE FLOW CONTROL STRUCTURE INTO CORE. 00050013
*        MODIFY THE FLOW CONTROL STRUCTURE TO ESTABLISH NEW DISPLAY     00060013
*        ORDER AND BUILD NEW FLOW CONTROL TABLE. WRITE OUT NEW FLOW     00070013
*        CONTROL STRUCTURE AND OVERLAY OLD FLOW CONTROL TABLE WITH THE  00080013
*        NEW ONE.                                                       00090013
*                                                                       00100013
*ENTRY POINTS: IFFAFA19                                                 00110013
*                                                                       00120013
*INPUT:  REGISTER 1 POINTS TO A WORK AREA.  THE FIRST WORD CONTAINS THE 00130013
*        ADDRESS OF THE PARAMETER LIST, AND THE SECOND, THAT OF THE     00140013
*        RETURN CODE ARRAY.  THE PARAMETER LIST IS OF VARIABLE LENGTH,  00150013
*        AT LEAST ONE ENTRY   LONG, WITH EACH ENTRY CONTAINING THE      00160013
*        ADDRESS OF A POINTER TO A GDSCB.                               00170013
*                                                                       00180013
*OUTPUT: NONE TO THE USER.  THE MODIFIED FLOW CONTROL STRUCTURE AND     00190013
*        THE NEW FLOW CONTROL TABLE REPLACE THOSE WHICH EXISTED         00200013
*        PREVIOUSLY.                                                    00210013
*                                                                       00220013
*EXTERNAL ROUTINES: GREAD, GWRITE                                       00230013
*                                                                       00240013
*EXITS-NORMAL AND ERROR: VIA RETURN MACRO TO DIRECTOR                   00250013
*                                                                       00260013
*TABLES/WORKAREAS: GSP WORKAREA, FLOW CONTROL TABLE                     00270013
*                                                                       00280013
*ATTRIBUTES:  PROBLEM STATE, REENTRANT                                  00290013
*                                                                       00300013
IFFAFA19 CSECT                                                          00310013
ORG00    EQU   0                       REGISTER EQUATES                 00600013
ORG01    EQU   1                                                        00900013
ORG02    EQU   2                                                        01200013
ORG03    EQU   3                                                        01500013
ORG04    EQU   4                                                        01800013
ORG05    EQU   5                                                        02100013
ORG06    EQU   6                                                        02400013
ORG07    EQU   7                                                        02700013
ORG08    EQU   8                                                        03000013
ORG09    EQU   9                                                        03300013
ORG10    EQU   10                                                       03600013
ORG11    EQU   11                                                       03900013
ORG13    EQU   13                                                       04200013
ORG15    EQU   15                                                       04500013
*                                                                       04800013
         SAVE  (14,12)                                                  05100013
         BALR  ORG09,0                 CSECT ADDRESSABILITY             05400013
         USING *,ORG09                                                  05700013
         LR    ORG10,ORG01             WORKAREA ADDRESSABILITY          06000013
         USING ORDGDS,ORG10                                             06300013
         LA    ORG01,ORGSAVE           CHAIN SAVE AREAS                 06600013
         ST    ORG01,MSVA(ORG13)                                        06900013
         ST    ORG13,HSVA(ORG01)                                        07200013
         LR    ORG13,ORG01             ESTABLISH NEW SAVE AREA          07500013
*                                                                       07800013
         L     ORG11,ORGPARM           POINTER TO PARAMETER LIST        08100013
         L     ORG07,ORGRTNA           RETURN ARRAY ADDRESSABILITY      08400013
         USING GSPARRAY,ORG07                                           08700013
         MVI   GSPARRAY,X'00'          SUCESSFUL COMPLETION CODE        09000013
*                                                                       09300013
*        STAGE 1:                                                       09600013
*        CHECK PARAMETERS FOR VALIDITY AND BUILD LIST OF GDS'S          09900013
*        IN NEW EXECUTION ORDER                                         10200013
*                                                                       10500013
         L     ORG08,0(ORG11)          GET ADDRESS OF GDSCB             11400013
         L     ORG08,0(ORG08)                                           11700013
         USING GDSCB,ORG08             GDSCB ADDRESSABILITY             12000013
         C     ORG08,GDSGDSCB          VALID GDSCB                      12300013
         BNE   ORG017                  NO, ERROR                        12600013
         L     ORG06,GDSGTMCB          YES, GET THE GTMCB               12900013
         USING GTMCB,ORG06             GTMCB ADDRESSABILITY             13200013
         L     ORG05,GTMFCTBL          FLOW CONTROL TABLE               13500013
         USING FCTABLE,ORG05           ADDRESSABILITY                   13800013
*                                                                       14100013
         MVC   ORGFCTBL(FCTHEAD),FCTABLE COPY FIRST 3 WORDS OF FCT      14400013
*                                      INTO WORKAREA                    14700013
*                                                                       15000013
         XC    ORGFCTBL+FCTHEAD(48),ORGFCTBL+FCTHEAD                    15300013
         L     ORG02,GTMSYGDS          PLACE SYSTEM GDS IN GDS LIST     15600013
         ST    ORG02,ORGDSLST                                           15900013
         LA    ORG03,4                 INITIALIZE GDS LIST POINTER      16200013
*                                                                       16500013
ORG001   LA    ORG04,2                 SET   FLOW CONTROL TABLE POINTER 16800013
         LH    ORG02,GDSFCBUF          GET BUFFER ADDRESS OF FLOW       17100013
*                                      CONTROL ELEMENT                  17400013
*        SEARCH FLOW CONTROL TABLE FOR CORESPONDING ENTRY               17700013
*        AND ENTER IT IN WORK TABLE                                     18000013
*                                                                       18300013
ORG002   CH    ORG02,FCTSYGDS(ORG04)   ENTRY = BUFFER ADDRESS           18600013
         BE    ORG003                  YES, CONTINUE                    18900013
         LA    ORG04,2(ORG04)          NO, INCREMENT POINTER            19200013
         C     ORG04,FCTINUSE          CHECKED ALL IN-USE ENTRIES       19500013
         BL    ORG002                  NO, CHECK NEXT                   19800013
         B     ORG004A                 YES, SKIP GDS SPECIFIED          20100013
*                                                                       20400013
ORG003   STH   ORG02,ORGFCTSY(ORG04)   ENTER IN WORK TABLE              20700013
         ST    ORG08,ORGDSLST(ORG03)   ENTER GDS IN GDS LIST            21000013
*                                                                       21300013
         LA    ORG03,4(ORG03)          NO, INCREMENT POINTERS           21600013
ORG004A  TM    0(ORG11),X'80'          LAST PARAMETER CHECK             21900013
         BO    ORG005                  YES, CHECK GDSLIST FOR           22200013
*                                      COMPLETENESS                     22500013
         C     ORG03,ORG0100           NO. ALL PERMISSABLE GDS'S PASSED 22800013
         BNL   ORG015                  YES, ERROR                       23100013
ORG004   LA    ORG11,4(ORG11)                                           23400013
*                                                                       23700013
         L     ORG08,0(ORG11)          GET NEXT GDS                     24000013
         L     ORG08,0(ORG08)                                           24300013
         C     ORG08,GDSGDSCB          A GOOD GDSCB                     24600013
         BNE   ORG017                  NO, ERROR                        24900013
         C     ORG06,GDSGTMCB          ON SAME TERMINAL                 25200013
         BE    ORG001                  YES, CHECK FLOW CONTROL TABLE    25500013
         B     ORG017                  NO, ERROR                        25800013
*                                                                       26100013
*        ADD ANY GDS'S NOT SPECIFIED IN CALL BUT ON TERMINAL            26400013
*        TO LIST OF GDS'S                                               26700013
*                                                                       27000013
ORG005   LA    ORG04,2                 INITIALIZE POINTERS              27300013
         LA    ORG02,ORGFCTSY+2                                         27600013
*                                                                       27900013
ORG006   C     ORG04,FCTINUSE          ALL IN USE FLOW CONTROL ENTRIES  28200013
         BE    ORG011                  CHECKED. YES, CONTINUE           28500013
         LA    ORG01,FCTSYGDS(ORG04)   NO, GET ADDRESS OF ENTRY         28800013
         CLC   0(2,ORG01),0(ORG02)     THIS GDS BEING REORDERED         29100013
         BNE   ORG008                  NO, SEARCH FOR GDS               29400013
ORG007   LA    ORG04,2(ORG04)          CHECK NEXT ENTRY                 29700013
         LA    ORG02,2(ORG02)                                           30000013
         B     ORG006                                                   30300013
*                                                                       30600013
ORG008   L     ORG08,GTMGDSCB          GET FIRST GDSCB ON CHAIN         30900013
*                                                                       31200013
ORG009   C     ORG08,ORG0000           LAST GDS ON CHAIN                31500013
         BE    ORG007                  CHECK NEXT FLOW CONTROL ENTRY    31800013
         CLC   GDSFCBUF(2),0(ORG01)    THIS THE GDS BEING LOOKED FOR    32100013
         BE    ORG010                  YES, PLACE IT IN THE GDS LIST    32400013
         L     ORG08,GDSNXGDS          NO, GET NEXT AND CHECK IT        32700013
         B     ORG009                                                   33000013
*                                                                       33300013
ORG010   C     ORG03,ORG0100           25 GDS'S ALREADY LOCATED         33600013
         BE    ORG015                  YES, ERROR                       33900013
         ST    ORG08,ORGDSLST(ORG03)   PLACE GDS IN GDS LIST            34200013
         LA    ORG03,4(ORG03)                                           34500013
         B     ORG007                  CHECK NEXT FLOW CONTROL ENTRY    34800013
*                                                                       35100013
ORG011   LA    ORG02,ORGDSLST-4(ORG03) GET ADDRESS OF LAST ENTRY IN     35400013
         OI    0(ORG02),X'80'          GDS LIST AND SET FLAG BIT=1      35700013
         LA    ORG02,49                                                 36000013
         L     ORG01,ORGFCTIU          GET BYTES IN USE IN FCT          36300013
         SR    ORG02,ORG01             NO. OF BYTES TO COPY -1          36600013
         LA    ORG03,FCTSYGDS(ORG01)   START COPY FROM                  36900013
         LA    ORG01,ORGFCTSY(ORG01)   START COPY TO                    37200013
         EX    ORG02,ORG019            COPY PARTS OF FCT NOT IN USE     37500013
*                                                                       37800013
*        READ IN FLOW CONTROL STRUCTURE AND RESTART GENERATION          38100013
*                                                                       38400013
         XC    ORGDECB(32),ORGDECB     CLEAR DECB                       38700013
         LA    ORG01,ORGDECB           DECB                             39000013
         L     ORG02,GTMGRDCB          DCB                              39300013
         LA    ORG03,ORGFCBUF          INPUT AREA                       39600013
         LA    ORG04,FCTBUFFR          BUFFER ADDRESS & RESTART ADDRESS 39900013
         GREAD (ORG01),STR,(ORG02),256,(ORG03),(ORG04),(ORG04),MF=E     40200013
         LTR   ORG15,ORG15             TEST RETURN CODE                 40500013
         BP    ORG018                  NON-ZERO,I/O ERROR               40800013
         LA    ORG01,ORGDECB                                            41100013
         WAIT  ECB=(1)                                                  41400013
         CLI   ORGDECB,POSTCODE        POST CODE NOT= 7F                41700013
         BNE   ORG018                  I/O ERROR                        42000013
*                                                                       42300013
*        END OF STAGE1. BEGINNING OF STAGE 2. CHANGE ADDRESSABILITY     42600013
*        WHERE NECESSARY                                                42900013
         DROP  ORG07,ORG06,ORG05                                        43200013
*                                                                       43500013
*        STAGE 2:                                                       43800013
*        MODIFY FLOW CONTROL STRUCTURE AND BUILD NEW FLOW               44100013
*        CONTROL TABEL                                                  44400013
*                                                                       44700013
         LA    ORG11,ORGDSLST          POINTER TO GDS LIST              45000013
         LA    ORG07,ORGFCTUS          POINTER TO FIRST AVAILABLE       45300013
*                                      ENTRY IN FLOW CONTROL TABLE      45600013
         TM    0(ORG11),X'80'          SYSTEM GDS ONLY ONE              45900013
         BO    ORG014                  YES, DON'T BOTHER MODIFYING      46200013
*                                      FLOW CONTROL                     46500013
         LH    ORG06,ORGFCTSY          GET DISPLACEMENT TO SYSTEM       46800013
         SH    ORG06,ORGFCTBF          GDS FLOW CONTROL ELEMENT         47100013
*                                                                       47400013
ORG012   LA    ORG11,4(ORG11)          INCREMENT POINTER TO NEXT GDS    47700013
*                                                                       48000013
         L     ORG08,0(ORG11)          GET GDS ADDRESS                  48300013
         LH    ORG05,GDSFCBUF          GET BUFFER ADDRESS OF FLOW       48600013
*                                      CONTROL ELEMENT                  48900013
         STH   ORG05,ORGFCBUF+ELGTRU(ORG06) STORE IN PREVIOUS FLOW      49200013
*                                      CONTROL ELEMENT                  49500013
         STH   ORG05,0(ORG07)          AND FLOW CONTROL TABLE           49800013
         LR    ORG06,ORG05             DISPLACEMENT TO THIS ELEMENT     50100013
         SH    ORG06,ORGFCTBF                                           50400013
*                                                                       50700013
         TM    0(ORG11),X'80'          LAST PARAMETER                   51000013
         BO    ORG013                                                   51300013
         LA    ORG07,2(ORG07)          NO, INCREMENT FLOW CONTROL       51600013
         B     ORG012                  TABLE POINTER                    51900013
*                                                                       52200013
ORG013   LH    ORG05,ORGFCTBF          GET BUFFER ADDRESS OF FLOW       52500013
*                                      CONTROL SEGMENT AND STORE IN     52800013
         STH   ORG05,ORGFCBUF+ELGTRU(ORG06) THE FLOW CONTROL ELEMENT    53100013
*                                                                       53400013
*        END OF STAGE 2. BEGINNING OF STAGE 3. REESTABLISH              53700013
*        ADDRESSABILITY TO THE RETURN ARRAY AND THE GTMCB               54000013
*                                                                       54300013
         L     ORG07,ORGRTNA                                            54600013
         USING GSPARRAY,ORG07                                           54900013
         L     ORG08,ORGDSLST          GET SYSTEM GDS                   55200013
         L     ORG06,GDSGTMCB          AND GTMCB                        55500013
         USING GTMCB,ORG06                                              55800013
*                                                                       56100013
*        STAGE 3:                                                       56400013
*        PUT OUT THE NEW FLOW CONTROL STRUCTURE AND THE NEW             56700013
*        FLOW CONTROL TABLE                                             57000013
*                                                                       57300013
         XC    ORGDECB(32),ORGDECB     CLEAR DECB                       57600013
         LA    ORG01,ORGDECB           DECB                             57900013
         L     ORG02,GTMGRDCB          DCB                              58200013
         LA    ORG03,ORGFCBUF          OUTPUT AREA                      58500013
         LA    ORG04,ORGFCTBF          BUFFER ADDRESS & RESTART ADDRESS 58800013
*                                                                       59100013
         GWRITE (ORG01),STR,(ORG02),256,(ORG03),(ORG04),(ORG04),MF=E    59400013
         LTR   ORG15,ORG15             RETURN CODE NON-ZERO,            59700013
         BP    ORG018                  I/O ERROR                        60000013
         LA    ORG01,ORGDECB                                            60300013
         WAIT  ECB=(1)                                                  60600013
         CLI   ORGDECB,POSTCODE        POST CODE NOT= 7F                60900013
         BNE   ORG018                  I/O ERROR                        61200013
*                                                                       61500013
         L     ORG05,GTMFCTBL          IF I/O SUCESSFUL, OVERLAY OLD    61800013
         MVC   0(60,ORG05),ORGFCTBL    FLOW CONTROL TABLE WITH NEW      62100013
*                                                                       62400013
ORG014   L     ORG13,HSVA(ORG13)       RETURN                           62700013
         RETURN (14,12),T                                               63000013
*                                                                       63300013
*        ERROR PROCESSING                                               63600013
*                                                                       63900013
ORG015   XC    GSPARRAY+16(4),GSPARRAY+16   SHORT/LONG PARAMETER LIST   64200013
ORG016   OI    GSPARRAY,PARERR         PARAMETER ERROR                  64500013
         B     ORG014                  RETURN                           64800013
*                                                                       65100013
ORG017   S     ORG11,ORGPARM           GET DISPLACEMENT FROM BEGINNING  65400013
*                                      OF PARAMETER LIST                65700013
         SRA   ORG11,2                 GET PARAMETER NUMBER             66000013
         LA    ORG11,1(ORG11)                                           66300013
         ST    ORG11,GSPARRAY+16       BAD GDSCB                        66600013
         B     ORG016                                                   66900013
*                                                                       67200013
ORG018   OI    GSPARRAY,IOERR          I/O ERROR                        67500013
         B     ORG014                                                   67800013
*                                                                       68100013
ORG019   MVC   0(0,ORG01),0(ORG03)                                      68400013
*        CONSTANTS, EQUATES, AND DSECTS                                 68700013
*                                                                       69000013
ORG0000  DC    F'0'                                                     69300013
ORG0100  DC    F'100'                                                   69600013
*                                                                       69900013
FCTHEAD  EQU   12                                                       70200013
POSTCODE EQU   X'7F'                                                    70500013
ELGTRU   EQU   8                                                        70800013
ELLNGTH  EQU   10                                                       71100013
PARERR   EQU   X'08'                                                    71400013
IOERR    EQU   X'04'                                                    71700013
MSVA     EQU   8                                                        72000013
HSVA     EQU   4                                                        72300013
*                                                                       72600013
ORDGDS   DSECT                                                          72900013
ORGPARM  DS    F                       ADDRESS OF PARAMETER LIST        73200013
ORGRTNA  DS    F                       ADDRESS OF RETURN ARRAY          73500013
ORGSAVE  DS    18F                     SAVE AREA                        73800013
ORGDSLST DS    25F                     GDS LIST                         74100013
ORGFCTBL DS    15F                     FLOW CONTROL TABLE WORKAREA      74400013
         ORG   ORGFCTBL                                                 74700013
ORGFCTFR DS    F                                                        75000013
ORGFCTIU DS    F                                                        75300013
ORGFCTBF DS    H                                                        75600013
ORGFCTSY DS    H                                                        75900013
ORGFCTUS DS    24H                                                      76200013
ORGFCBUF DS    64F                     FLOW CONTROL STRUCTURE           76500013
ORGDECB  DS    8F                      DECB FOR I/O OPERATIONS          76800013
*                                                                       77100013
FCTABLE  DSECT                                                          77400013
FCTFREE  DS    F                                                        77700013
FCTINUSE DS    F                                                        78000013
FCTBUFFR DS    H                                                        78300013
FCTSYGDS DS    H                                                        78600013
FCTGDS   DS    24H                                                      78900013
*                                                                       79200013
         COPY  GSPCB                                                    79500013
         COPY  GTMCB                                                    79800013
         COPY  GDSCB                                                    80100013
*                                                                       80400013
         END                                                            80700013
./  ADD  SSI=80330205,NAME=IFFAGA01
         TITLE 'IFFAGA01 - LOCPN - LOCATE LIGHT-PEN'                    00200000
*STATUS: CHANGE LEVEL 000                                               00400000
*                                                                       00600000
*FUNCTION/OPERATION:  ESTABLISHES NEW GACB TO HANDLE LIGHT-PEN          00800000
*        INTERRUPTS.  CALLS ORGEN TO INSERT AN ORDER LOOP TO BLAST THE  01000000
*        SCREEN WITH W'S IN THE SYSTEM GDS.  LOOP FOR ABOUT 1/2 SECOND. 01200000
*        IF NO LIGHT-PEN INTERRUPT OCCURS, REGENERATION IS STOPPED AND  01400000
*        RESTARTED AT THE FLOW CONTROL GSRT.  IF A LIGHT-PEN INTERRUPT  01600000
*        OCCURS, THE RASTER UNIT COORDINATES RETURNED BY ATTNINQ ARE    01800000
*        CONVERTED TO USER UNITS BY A CALL TO CNVRT. THE CONVERTED      02000000
*        COORDINATES ARE PLACED IN THE USER'S OUTPUT LOCATIONS. RESET   02200000
*        IS CALLED TO REMOVE THE ORDER LOOP FROM THE SYSTEM GDS AND     02400000
*        THE LIGHT-PEN GACB IS DISABLED.                                02600000
*                                                                       02800000
*ENTRY POINTS: IFFAGA01                                                 03000000
*                                                                       03200000
*INPUT:  REGISTER 1 POINTS TO A WORKAREA. THE FIRST WORD CONTAINS THE   03400000
*        ADDRESS OF THE PARAMETER LIST, AND THE SECOND, THAT OF THE     03600000
*        RETURN CODE ARRAY.  THE FIXED-LENGTH PARAMETER LIST IS         03800000
*    + 0 A(POINTER TO THE GDSCB)                                        04000000
*                                                                       04200000
*    + 4 A(X-POSITION VARIABLE)                                         04400000
*                                                                       04600000
*    + 8 A(Y-POSITION VARIABLE)                                         04800000
*                                                                       05000000
*OUTPUT: USER COORDINATES OF THE POINT WHERE THE LIGHT-PEN DETECT       05200000
*        OCCURED ARE RETURNED TO THE USER.                              05400000
*                                                                       05600000
*EXTERNAL ROUTINES: ORGEN, EXEC, RESET, SPAR, DAR, ATTNINQ, GCNTRL      05800000
*                   ,CNVRT                                         3319 06000000
*                                                                       06200000
*TABLES/WORKAREAS: GSP WORKAREA                                         06400000
*                                                                       06600000
*ATTRIBUTES: PROBLEM STATE, REENTRANT                                   06800000
*                                                                       07000000
IFFAGA01 CSECT                                                          07200000
*2102,294000-351000,615000                                         000A 07400000
*2102,591000                                                       2254 07600000
*2102,411400-421000    INSERTIONS MISFLAGGED FOR 22254             2283 07800000
*2102,021000-024000,285000-288000,540000-543000,564000             3319 08000000
*199400,269000,288000,473000,514000-515000,538400,573000         A42825 08200000
*573600-575400                                                   A42825 08400000
*A120000-128000,A310000-314500,C315000,318000,              D11 ZA15437 08600000
*A328000-332500,C333000,334000,A530000-534500,              D11 ZA15437 08700000
*C535000,536000,A566000-570500,C571000,574000               D11 ZA15437 08800000
LPN01    EQU   1                       REGISTER EQUATES-WORK REGISTERS  09000000
LPN02    EQU   2                                                        09200000
LPN03    EQU   3                                                        09400000
LPN04    EQU   4                                                        09600000
LPN06    EQU   6                       REGISTER EQUATES-BASE REGISTERS  09800000
LPN07    EQU   7                        GRAPHIC DATA SET CONTROL   3319 10000000
*                                       BLOCK POINTER              3319 10200000
LPN08    EQU   8                        GSP ERROR ARRAY POINTER    3319 10400000
LPN09    EQU   9                                                        10600000
LPN10    EQU   10                                                       10800000
LPN11    EQU   11                                                       11000000
LPN13    EQU   13                      REGISTER EQUATES-STANDARD        11200000
LPN14    EQU   14                      LINKAGE REGISTERS                11400000
LPN15    EQU   15                                                       11600000
*                                                                       11800000
STAT     EQU   24                  RTNARRAY-TO STATABLE ADDRD11 OZ15437 12000000
ORGEN    EQU   X'0258'             STATAB ORGEN ENTRY DISPL D11 OZ15437 12200000
CONVERT  EQU   X'0264'             STATAB CNVRT ENTRY DISPL D11 OZ15437 12400000
EXEC     EQU   X'01C8'             STATAB EXEC  ENTRY DISPL D11 OZ15437 12600000
RESET    EQU   X'01D4'             STATAB RESET ENTRY DISPL D11 OZ15437 12800000
HSVA     EQU   4                                                        13000000
MSVA     EQU   8                                                        13200000
INCLUDE  EQU   1                                                        13400000
X08      EQU   X'08'                                                    13600000
LPN08A   EQU   8                       DISPLACEMENT TO BUFFER ADDRESS   13800000
L20      EQU   20                       LENGTH FOR MVC        LB A42825 14000000
IOERR    EQU   X'04'                                                    14200000
ERRCOND  EQU   X'3C'                   ERROR MASK FOR GSP ERROR    3319 14400000
*                                       ARRAY                      3319 14600000
PSTCD    EQU   X'7F'                                                    14800000
CHARW    EQU   56                       A BASIC CHARACTER WIDTH IN 2234 15000000
*                                       HEXADECIMAL UNITS          2234 15200000
CHARH    EQU   80                       A BASIC CHARACTER HIGHTH IN2234 15400000
*                                       HEXADECIMAL UNITS          2234 15600000
XRIGHT   EQU   4088                     THE RIGHT MOST CHARACTER   2234 15800000
*                                       CENTER POINT IN HEX UNITS  2234 16000000
*                                       ON X - AXIS                2234 16200000
YBOTTOM  EQU   12                       THE BOTTOM MOST CHARACTER  2254 16400000
*                                       CENTER POINT IN HEX UNITS  2254 16600000
*                                       ON Y - AXIS                2254 16800000
YTOP     EQU   4092                     THE TOP MOST CHARACTER     2254 17000000
*                                       CENTER POINT IN HEX UNITS  2254 17200000
*                                       ON Y - AXIS                2254 17400000
*                                                                       17600000
         SAVE  (14,12)                                                  17800000
         BALR  LPN09,0                 ADDRESSABILITY FOR CSECT         18000000
         USING *,LPN09                                                  18200000
*                                                                       18400000
         LR    LPN10,LPN01             ADDRESSABILITY FOR WORKAREA,     18600000
         USING  LOCPEN,LPN10                                            18800000
         LA    LPN02,LPNSAVE           CHAIN SAVE AREAS                 19000000
         ST    LPN13,HSVA(LPN02)                                        19200000
         ST    LPN02,MSVA(LPN13)                                        19400000
         LR    LPN13,LPN02             ESTABLISH NEW SAVE AREA          19600000
         L     LPN11,LPNPARM           PARAMETER LIST,                  19800000
         USING LPNPRMLT,LPN11                                           20000000
         L     LPN08,LPNRTNA           AND RETURN ARRAY                 20200000
         USING GSPARRAY,LPN08                                           20400000
*                                                                       20600000
         L     LPN07,LPNGDS            GET ADDRESS OF GDSCB             20800000
         L     LPN07,0(LPN07)                                           21000000
         USING GDSCB,LPN07             ADDRESSABILITY FOR GDSCB         21200000
         C     LPN07,GDSGDSCB          VALID GDSCB                      21400000
         BNE   LPN004                  NO, ERROR RETURN                 21600000
*                                                                       21800000
         TM    LPNGDS,X'80'            MAKE SURE                        22000000
         BO    LPN005                                                   22200000
         TM    LPNXPOSO,X'80'          THE PARAMETER LIST               22400000
         BO    LPN005                                                   22600000
         TM    LPNYPOSO,X'80'          IS 3    LOCATIONS                22800000
         BZ    LPN005                  IF NOT, ERROR RETURN             23000000
*                                                                       23200000
         L     LPN06,GDSGTMCB          ADDRESSABILITY FOR GTMCB         23400000
         USING GTMCB,LPN06                                              23600000
         MVC   LPNGACB(56),LPNMGACB    MOVE SKELETON GACB INTO          23800000
*                                      WORKAREA                         24000000
         LA    LPN02,LPNGACB           GET POINTERS TO GACB,            24200000
         LA    LPN03,LPNCOM            COMMUNICATIONS AREA,             24400000
         L     LPN04,GTMGRDCB          AND DCB                          24600000
         SAEC  DCB=(4),COMAREA=(3),MF=(E,(2))                           24800000
         XC    LPNSUPP(16),LPNSUPP     ZERO SUPERVISOR WORK AREA        25000000
         LA    LPN03,LPNGACB                                            25200000
         LA    LPN02,LPNORGDS                                           25400000
         L     LPN01,LPN0002           STORE SPAR PARAMETER             25600000
         STH   LPN01,2(LPN02)          LIST LENGTH                      25800000
         SPAR  ((3)),PRTY=126,MF=(E,(2))                                26000000
*                                                                       26200000
         LTR   LPN15,LPN15              RETURN CODE ZERO           3319 26400000
         BNE   LPN006                   GO TO PARM ERR EXIT   LB A42825 26600000
*                                            BASIC FOUND AN ERROR  3319 26800000
         LA    LPN02,GTMSYGDS          GET ADDRESS OF POINTER TO        27000000
*                                      SYSTEM GDS                       27200000
         ST    LPN02,LPNORGDS          STORE IN PARAMETER LIST FOR      27400000
*                                      CNVRT AND EXEC                   27600000
         LA    LPN02,LPNLNGTH          POINTER TO BYTE COUNT            27800000
         ST    LPN02,LPNORCNT                                           28000000
         LA    LPN02,LPNORDRS          POINTER TO ORDERS                28200000
         ST    LPN02,LPNORORD                                           28400000
         MVC   LPNOREXT(4),GSPNULLV    SET UNUSED PARAMETERS TO         28600000
         MVC   LPNORCOR(4),GSPNULLV    TO NULL VARIABLE                 28800000
         LA    LPN02,LPNKEY            STORE POINTER TO KEY             29000000
         ST    LPN02,LPNORKEY                                           29200000
         LA    LPN02,LPN0001           SET GENCODE FPR INCLUDE          29400000
         ST    LPN02,LPNORGCD                                           29600000
         OI    LPNORGCD,X'80'          END OF PARAMETER LIST FLAG       29800000
         LA    LPN02,LPNORGDS          SET UP POINTERS TO PARAMETER     30000000
         ST    LPN02,LPNORPRM          LIST                             30200000
         MVC   LPNORRTN(4),LPNRTNA     AND THE RETURN ARRAY             30400000
         XC    LPNSUPP(16),LPNSUPP     ZERO SUPERVISOR WORK AREA        30600000
         LA    LPN01,LPNORPRM          SET UP CALL TO ORGEN             30800000
         L     LPN15,STAT(LPN08)   POINT TO STATUS TABLE    D11 ZA15437 31000000
         L     LPN15,ORGEN(LPN15)  AND ORGEN ENTRY POINT    D11 ZA15437 31200000
         LTR   LPN15,LPN15         ORGEN LOADED YET?        D11 ZA15437 31260000
         BZ    LPNLINK1            NO,MUST USE SYSTEM LINK  D11 ZA15437 31320000
         BALR  LPN14,LPN15         GO TO ORGEN              D11 ZA15437 31400000
         B     LPNRTN1             RETURN FROM BALR         D11 ZA15437 31450000
LPNLINK1 LA    LPN15,LPNSUPP                                D11 ZA15437 31500000
         LINK  EP=IFFAGA07,MF=(E,(1)),SF=(E,(15)) LNK ORGEN             31550000
*                                                                       31600000
LPNRTN1  TM    GSPARRAY,ERRCOND    WAS AN ERROR DETECTED    D11 ZA15437 31800000
         BNZ   LPDAR                   ERROR BRANCH           LB A42825 32000000
         OI    LPNORGDS,X'80'                                           32200000
         XC    LPNSUPP(16),LPNSUPP     ZERO SUPERVISOR WORK AREA        32400000
         LA    LPN01,LPNORPRM                                           32600000
         L     LPN15,STAT(LPN08)   POINT TO STATUS TABLE    D11 ZA15437 32800000
         L     LPN15,EXEC(LPN15)   AND TO EXEC ROUTINE EP   D11 ZA15437 33000000
         LTR   LPN15,LPN15         EXEC LOADED YET?         D11 ZA15437 33060000
         BZ    LPNLINK2            NO,MUST USE SYSTEM LINK  D11 ZA15437 33120000
         BALR  LPN14,LPN15         GO EXEC                  D11 ZA15437 33200000
         B     LPNRTN2             RETURN FROM BALR         D11 ZA15437 33250000
LPNLINK2 LA    LPN15,LPNSUPP                                D11 ZA15437 33300000
         LINK  EP=IFFAFA11,MF=(E,(1)),SF=(E,(15)) LINK EXEC             33350000
LPNRTN2  TM    GSPARRAY,ERRCOND    WAS AN ERROR DETECTED    D11 ZA15437 33400000
         BNZ   LPRESET                 BRANCH TO ERROR EXIT   LB A42825 33600000
*                                                                       33800000
LPN000   EQU   *                                                   000A 34000000
LPN001   EQU   *                                                   000A 34200000
         STIMER WAIT,DINTVL=LPN7HT                                 000A 34400000
         XC    LPNSUPP(16),LPNSUPP                                 000A 34600000
         XC    LFORM(64),LFORM          ZERO LIST                  000A 34800000
         LA    LPN02,LPNGACB                                       000A 35000000
         ATTNINQ (2),MODE=(C,LPN003),TYP=ANY,MF=(E,LFORM)          000A 35200000
         LA    LPN01,LPNSUPP           DECB                             35400000
*              THE FOLLOWING TEST CAN BE MADE WHEN BASIC GRAPHICS  3319 35600000
*              IS CLEANED UP AND ATTENTION INQUIRY IS MADE TO      3319 35800000
*              RETURN A ZERO RETURN CODE FOR A CALL TO IT IF       3319 36000000
*              THERE IS NOTHING ON THE USERS ATTENTION QUEUE       3319 36200000
*        LTR   LPN15,LPN15              RETURN CODE ZERO           3319 36400000
*        BNE   LPN0085                  IF NOT TAKE BRANCH         3319 36600000
*                                            ATTNINQ FOUND AN ERROR3319 36800000
         L     LPN02,GTMGRDCB          DCB                              37000000
         L     LPN03,GTMFCTBL          BUFFER ADDRESS                   37200000
         LA    LPN03,LPN08A(LPN03)                                      37400000
*                                                                       37600000
         XC    LPNSUPP(32),LPNSUPP     ZERO DECB                        37800000
         GCNTRL (LPN01),HLT,(LPN02),(LPN03),MF=E  STOP REGENERATION     38000000
         LTR   LPN15,LPN15              RETURN CODE ZERO           3319 38200000
         BNE   LPN0085                  IF NOT TAKE BRANCH         3319 38400000
*                                            GCNTRL FOUND AN ERROR 3319 38600000
         WAIT  ECB=LPNSUPP                                              38800000
         CLI   LPNSUPP,PSTCD           I/O SUCESSFUL                    39000000
         BNE   LPN008                  NO, ERROR RETURN                 39200000
*                                                                       39400000
         XC    LPNSUPP(32),LPNSUPP     ZERO DECB                        39600000
         LA    LPN01,LPNSUPP                                            39800000
         GCNTRL (LPN01),STR,(LPN02),(LPN03),MF=E  RESTART REGENERATION  40000000
         LTR   LPN15,LPN15              RETURN CODE ZERO           3319 40200000
         BNE   LPN0085                  IF NOT TAKE BRANCH         3319 40400000
*                                            GCNTRL FOUND AN ERROR 3319 40600000
         WAIT  ECB=LPNSUPP                                              40800000
         CLI   LPNSUPP,PSTCD           I/O SUCESSFUL                    41000000
         BNE   LPN008                  NO, ERROR RETURN                 41200000
         B     LPN000                  YES, CONTINUE SCAN               41400000
*                                                                       41600000
*        LIGHT-PEN DETECT ON SCAN                                       41800000
         EJECT                                                     2254 42000000
*              THE HARDWARE PRESENTS A PROBLEM IN CHARACTER        2254 42200000
*              DETECTION IN THAT THE X AND Y COORDINATE VALUES     2254 42400000
*              RETURNED ARE THOSE OF THE NEXT CHARACTER CENTER     2254 42600000
*              TO BE DISPLAYED NOT THE ONE THAT THE LIGHTPEN       2254 42800000
*              DETECT IS ON. THUS THE FOLLOWING CODE WILL BACK     2254 43000000
*              UP THE X AND Y REGISTER VALUE TO THE CENTER OF      2254 43200000
*        THE CHARACTER THE DETECT WAS ON, THIS BACK UP             2254 43400000
*              TAKES INTO ACCOUNT ALSO THE JUMPING FROM LINE TO    2254 43600000
*              LINE AND BOTTOM TO TOP OF THE PAGE.                 2254 43800000
LPN003   LH    LPN02,LPNXPOS           GET COORDINATES OF               44000000
*                                       THE LIGHT - PEN INTERRUPT  2254 44200000
         LA    LPN04,CHARW              GET CHARCTER WIDTH TO      2254 44400000
         SR    LPN02,LPN04              SUBSTRACT FROM VALUE       2254 44600000
*                                       HARDWARE RETURNS SO CAN    2254 44800000
*                                       RETURN TO CALLER THE VALUE 2254 45000000
*                                       OF THE CHARACTER LIGHTPENED2254 45200000
         BNM   LPN0035                  IF THE VALUE IS NOW LESS   2254 45400000
*                                       THAN ZERO                  2254 45600000
         LA    LPN02,XRIGHT             SET X-AXIS VALUE TO RIGHT  2254 45800000
*                                       MOST CHARACTER CENTER      2254 46000000
         ST    LPN02,LPNXVAL            STORE X-AXIS VALUE         2254 46200000
         LH    LPN02,LPNYPOS            GET Y-AXIS COORDINATE OF   2254 46400000
*                                       CHARATER DETECTED ON       2254 46600000
         LA    LPN04,CHARH              UP VALUE OF Y-AXIS BY 80   2254 46800000
         AR    LPN02,LPN04          FOR NEXT LINE SINCE X VALUE WAS2254 47000000
*                                       LESS THAN ZERO MEANING THAT2254 47200000
*                                       THE DETECT WAS ON THE LAST 2254 47400000
*                                       CHARACHER OF THE LINE      2254 47600000
         LA    LPN04,YTOP               MAXIMUM Y-AXIS VALUE       2254 47800000
         CR    LPN04,LPN02              IS Y-AXIS VALUE ABOVE LIMIT2254 48000000
*                                       OF SCREEN                  2254 48200000
         BNL   LPN0036                  IF NOT TAKE BRANCH         2254 48400000
         LA    LPN02,YBOTTOM            SET Y-AXIS VALUE TO        2254 48600000
*                                       BOTTOM OF SCREEN           2254 48800000
         B     LPN0036                  GO SET Y-AXIS VALUE        2234 49000000
LPN0035  EQU   *                                                        49200000
         ST    LPN02,LPNXVAL           THE LIGHT-PEN INTERRURT          49400000
         LH    LPN02,LPNYPOS                                            49600000
LPN0036  EQU   *                                                   2234 49800000
         ST    LPN02,LPNYVAL                                            50000000
         MVC   LPNCVGDS(4),LPNGDS      MOVE IN POINTER TO USER'S GDS    50200000
         LA    LPN02,LPN0001           CONVERT VARIABLE                 50400000
         ST    LPN02,LPNCVCVT                                           50600000
         LA    LPN02,LPNXVAL           STORE POINTERS                   50800000
         ST    LPN02,LPNCVXIN          TO INPUT VALUES                  51000000
         LA    LPN02,LPNYVAL                                            51200000
         ST    LPN02,LPNCVYIN                                           51400000
         MVC   LPNCVXOT(8),LPNCVXIN    AND OUTPUT ADDRESSES             51600000
         OI    LPNCVYOT,X'80'                                           51800000
         LA    LPN02,LPNCVGDS          POINTER TO PARAMETER LIST        52000000
         ST    LPN02,LPNCVPRM                                           52200000
         MVC   LPNCVRTN(4),LPNRTNA                                      52400000
         LA    LPN01,LPNCVPRM                                           52600000
         XC    LPNSUPP(16),LPNSUPP                                      52800000
         L     LPN15,STAT(LPN08)   POINT TO STATUS TABLE    D11 ZA15437 53000000
         L     LPN15,CONVERT(LPN15) AND TO CONVERT EP       D11 ZA15437 53200000
         LTR   LPN15,LPN15         CONVERT LOADED YET?      D11 ZA15437 53260000
         BZ    LPNLINK3            NO,MUST USE SYSTEM LINK  D11 ZA15437 53320000
         BALR  LPN14,LPN15         GO CONVERT               D11 ZA15437 53400000
         B     LPNRTN3             RETURN FROM BALR         D11 ZA15437 53450000
LPNLINK3 LA    LPN15,LPNSUPP                                D11 ZA15437 53500000
         LINK  EP=IFFAGA08,MF=(E,(1)),SF=(E,(15)) CONVERT TO USRUNITS   53550000
LPNRTN3  TM    GSPARRAY,ERRCOND    WAS AN ERROR DETECTED    D11 ZA15437 53600000
         BNZ   LPRESET                 BRANCH TO ERROR EXIT   LB A42825 53800000
         LM    LPN02,LPN03,LPNXPOSO                                     54000000
         MVC   0(4,LPN02),LPNXVAL      STORE VALUES IN USER'S AREA      54200000
         MVC   0(4,LPN03),LPNYVAL                                       54400000
         LA    LPN03,LPDAR             NSI AFTER RESET DONE   LB A42825 54600000
*                                                                       54800000
LPN002   XC    LPNSUPP(16),LPNSUPP     ZERO SUPERVISOR AREA             55000000
         MVC   LPNRSGDS(4),LPNORGDS    GET POINTER TO GDS NAME          55200000
         MVI   LPNRSGDS,X'00'                                           55400000
         OI    LPNRSKEY,X'80'          LAST PARAMETER                   55600000
         LA    LPN02,LPNRSGDS          POINTER TO PARAMETER LIST        55800000
         ST    LPN02,LPNRSPRM          FOR RESET                        56000000
         MVC   LPNRSRTN(4),LPNRTNA                                      56200000
         LA    LPN01,LPNRSPRM                                           56400000
         L     LPN15,STAT(LPN08)   POINT TO STATUS TABLE    D11 ZA15437 56600000
         L     LPN15,RESET(LPN15)  AND TO RESET EP          D11 ZA15437 56800000
         LTR   LPN15,LPN15         RESET LOADED YET?        D11 ZA15437 56860000
         BZ    LPNLINK4            NO,MUST USE SYSTEM LINK  D11 ZA15437 56920000
         BALR  LPN14,LPN15         GO RESET                 D11 ZA15437 57000000
         B     LPNRET4             RETURN FROM BALR         D11 ZA15437 57050000
LPNLINK4 LA    LPN15,LPNSUPP                                D11 ZA15437 57100000
         LINK  EP=IFFAFA12,MF=(E,(1)),SF=(E,(15)) CALL RESET            57150000
* ADDRESS IN REG LPN03 DETERMINES IF GSPARRAY TO BE RESTORED  LB A42825 57200000
LPNRET4  BR    LPN03               CONTINUE PROCESSING      D11 ZA15437 57400000
*                                                                       57600000
LPDAR    EQU   *                       SET UP FOR DAR         LB A42825 57800000
         LA    LPN02,LPNGACB                                            58000000
         XC    LPNSUPP(16),LPNSUPP                                      58200000
         LA    LPN03,LPNSUPP                                            58400000
         L     LPN01,LPN0002                                            58600000
         STH   LPN01,2(LPN03)          DAR PARAMETER LIST LENGTH        58800000
         DAR   ((2)),MF=(E,(3))        ELIMINATE INTERRUPT HANDLING     59000000
*                                                                       59200000
         LTR   LPN15,LPN15              RETURN CODE ZERO           3319 59400000
         BNE   LPN006                  GO INDICATE PARM ERROR LB A42825 59600000
*                                            DAR FOUND AN ERROR    3319 59800000
         B     LPN007                   GO RETURN TO CALLER        3319 60000000
*                                                                       60200000
LPN004   MVC   GSPARRAY+16(4),LPN0001  BAD GDSCB                        60400000
         B     LPN006                                                   60600000
LPN005   XC    GSPARRAY+16(4),GSPARRAY+16   UNDETERMINED ORIGIN         60800000
LPN006   OI    GSPARRAY,X08            BAD PARAMETER                    61000000
LPN007   L     LPN13,HSVA(LPN13)                                        61200000
         SR    LPN15,LPN15              SET RETURN CODE TO ZERO    3319 61400000
LPN0075  RETURN (14,12),T,RC=(15)                                  3319 61600000
*                                                                       61800000
LPN008   OI    GSPARRAY,IOERR          I/O ERROR                        62000000
         B     LPRESET                 GO TO ERROR EXIT       LB A42825 62200000
LPN0085  EQU   *                                              LB A42825 62400000
         OI    GSPARRAY,X08            INDICATE PARM ERROR    LB A42825 62600000
LPRESET  EQU   *                                              LB A42825 62800000
* ERROR EXIT WHEN BOTH RESET,DAR MUST BE USED FOR CLEANUP     LB A42825 63000000
         MVC   LPNGSPAY(L20),GSPARRAY  SAVE GSP ARRAY         LB A42825 63200000
         BAL   LPN03,LPN002            GO INVOKE RESET        LB A42825 63400000
         MVC   GSPARRAY(L20),LPNGSPAY  RESTORE GSPARRAY       LB A42825 63600000
         B     LPDAR                   GO INVOKE DAR          LB A42825 63800000
*                                                                       64000000
LPNMGACB SAEC  EP=0,ATTNTYP=(R,LP),RESTART=NO                           64200000
         GINIT BLC=0                                                    64400000
LPNORDRS GSXY  LPNPOS                                                   64600000
         GEPM  A                                                        64800000
*                                       SET BEAM TO CENTER OF      2254 65000000
*                                       CHARACTER IN CENTER OF     2254 65200000
LPNPOS   GDV   2016,2072,U              SCREEN                     2254 65400000
         GESD                                                           65600000
         GPDI                                                           65800000
LPNTAG   GECP  B                                                        66000000
         GTXT  'WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW',0 66200000
         GCNOP C                                                        66400000
         GTRU  LPNTAG                                                   66600000
LPNLNGTH DC    A(LPNLNGTH-LPNORDRS)                                     66800000
         DS    0D                                                  000A 67000000
LPN7HT   DC    X'F0F0F0F0F0F0F5C0'                                 000A 67200000
LPN0002  DC    F'2'                                                     67400000
LPN0001  DC    F'1'                                                     67600000
*                                                                       67800000
LOCPEN   DSECT                                                          68000000
LPNPARM  DS    F                       POINTER TO PARAMETER LIST        68200000
LPNRTNA  DS    F                       POINTER TO RETURN ARRAY          68400000
LFORM    DS    16F                                                 000A 68600000
LPNSAVE  DS    18F                     SAVE AREA                        68800000
LPNSUPP  DS    8F                                                       69000000
LPNGACB  DS    14F                     LIGHT-PEN ATTENTION GACB         69200000
LPNCOM   DS    4F                      COMUNICATIONS AREA               69400000
         ORG   LPNCOM+8                                                 69600000
LPNXPOS  DS    H                       X AND Y                          69800000
LPNYPOS  DS    H                       POSITION REGISTERS               70000000
         ORG   LPNCOM+16                                                70200000
LPNKEY   DS    F                                                        70400000
LPNORGDS DS    F                       GDSNAME FOR ORGEN AND EXEC       70600000
LPNORORD DS    F                       POINTER TO ORDERS                70800000
LPNORCNT DS    F                       POINTER TO BYTE COUNT            71000000
LPNOREXT DS    F                       POINTER TO EXTERNAL REFERENCE    71200000
*                                      TABLE (SET TO 0)                 71400000
LPNORCOR DS    F                       CORRVAL                          71600000
LPNORKEY DS    F                       KEY                              71800000
LPNORGCD DS    F                       GENCODE                          72000000
LPNORPRM DS    F                       POINTER TO ORGEN AND EXEC        72200000
*                                      PARAMETER LIST                   72400000
LPNORRTN DS    F                       POINTER TO RETURN ARRAY          72600000
*                                      FOR INTERNAL CALLS TO ORGEN      72800000
*                                      AND EXEC, REGISTER 1 WILL POINT  73000000
*                                      TO LPNORPRM                      73200000
*                                                                       73400000
         ORG   LPNORGCD                                                 73600000
LPNCVGDS DS    F                       GDSNAME FOR CNVRT                73800000
LPNCVCVT DS    F                       CONVERT VARIABLE (SET = 1)       74000000
LPNCVXIN DS    F                       POINTER TO INPUT AREAS           74200000
LPNCVYIN DS    F                                                        74400000
LPNCVXOT DS    F                       POINTER TO OUTPUT AREAS          74600000
LPNCVYOT DS    F                                                        74800000
LPNXVAL  DS    F                       POSITION STORAGE AREAS. USED FOR 75000000
LPNYVAL  DS    F                       INPUT AND OUTPUT FORM CNVRT      75200000
         DS    0D                                                       75400000
LPNCVPRM DS    F                       POINTER TO CNVRT PARAMETER LIST  75600000
LPNCVRTN DS    F                       POINTER TO RETURN ARRAY          75800000
LPNGSPAY DS    5F                      SAVE GSPARRAY          LB A42825 76000000
*                                                                       76200000
         ORG   LPNOREXT                                                 76400000
LPNRSGDS DS    F                       GDSNAME FOR RESET                76600000
LPNRSCOR DS    F                       CORRVAL (SET BY ORGEN)           76800000
LPNRSKEY DS    F                       KEY (SET BY ORGEN)               77000000
*                                      PARAMETER LIST FOR RESET         77200000
*                                      OVERLAYED OVER THAT FOR ORGEN    77400000
LPNRSPRM DS    F                       POINTER TO RESET PARAMETER LIST  77600000
LPNRSRTN DS    F                       POINTER TO RETURN ARRAY          77800000
*                                                                       78000000
LPNPRMLT DSECT                                                          78200000
LPNGDS   DS    F                       POINTER TO GDSNAME               78400000
LPNXPOSO DS    F                       X AND Y POSITION                 78600000
LPNYPOSO DS    F                       OUTPUT LOCATIONS                 78800000
*                                                                       79000000
         COPY  GSPCB                                                    79200000
         COPY  GTMCB                                                    79400000
         COPY  GDSCB                                                    79600000
*                                                                       79800000
         END                                                            80000000
./  ADD  SSI=80330206,NAME=IFFAGA02
         TITLE 'IFFAGA02 - BGTRK - BEGIN LIGHT-PEN TRACKING'            00200000
*STATUS: CHANGE LEVEL 000                                               00400000
*                                                                       00600000
*FUNCTION/OPERATION:  CALLS ORGEN TO RELOCATE LIGHT-PEN TRACKING        00800000
*        ROUTINE AND EXEC TO PLACE IT ON SCREEN.  CALLS CNVRT TO        01000000
*        CONVERT USER SUPPLIED COORDINATES TO RASTER UNIT COORDINATES.  01200000
*        ASSEMBLES A GDV FROM THESE COORDINATES AND WRITES IT TO THE    01400000
*        BUFFER.  BUFFER ADDRESS OF THE REPOSITIONING VECTOR IS PLACED  01600000
*        AT GTMREPOS.  GTMFLAGS SET TO INDICATE TRACKING ROUTINE IS IN  01800000
*        BUFFER                                                         02000000
*                                                                       02200000
*ENTRY POINTS: IFFAGA02                                                 02400000
*                                                                       02600000
*INPUT:  REGISTER 1 POINTS TO A WORKAREA.  THE FIRST WORD CONTAINS THE  02800000
*        ADDRESS OF THE PARAMETER LIST, AND THE SECOND, THAT OF THE     03000000
*        RETURN CODE ARRAY.  THE FIXED-LENGTH PARAMETER LIST IS         03200000
*    + 0 A(POINTER TO THE GDSCB)                                        03400000
*                                                                       03600000
*    + 4 A(ABSOLUTE X POSITIONING VALUE)                                03800000
*                                                                       04000000
*    + 8 A(ABSOLUTE Y POSITIONING VALUE)                                04200000
*                                                                       04400000
*OUTPUT: NONE TO USER.  TRACKING SYMBOL WILL APPEAR ON DEVICE WITH      04600000
*        SPECIFIED GDS.                                                 04800000
*                                                                       05000000
*EXTERNAL ROUTINES: ORGEN, EXEC, CNVRT, GWRITE                          05200000
*                                                                       05400000
*EXITS-NORMAL AND ERROR: VIA RETURN MACRO TO DIRECTOR                   05600000
*                                                                       05800000
*TABLES/WORKAREAS: GSP WORKAREA                                         06000000
*                                                                       06200000
*ATTRIBUTES: PROBLEM STATE, REENTRANT                                   06400000
*                                                                       06600000
*A98000,A200000-204500,C205000,206000,A264000-268500        D11 ZA15437 06800000
*C269000,270000,A276000-280500,C281000,282000               D11 ZA15437 06900000
*652000-658000                                              D11 ZA15437 07000000
IFFAGA02 CSECT                                                          07200000
BTK01    EQU   1                                                        07400000
BTK02    EQU   2                                                        07600000
BTK03    EQU   3                                                        07800000
BTK04    EQU   4                                                        08000000
BTK05    EQU   5                                                        08200000
BTK06    EQU   6                   GTM ADDRESSIBILITY                   08400000
BTK07    EQU   7                   RETCODE ARRAY ADDRESSIBILITY         08600000
BTK08    EQU   8                   GDS ADDRESSIBILITY REG               08800000
BTK09    EQU   9                   BASEREG                              09000000
BTK10    EQU   10                  WORKAREA ADDRESSIBILITY              09200000
BTK11    EQU   11                  PARMLIST ADDRESSIBILITY              09400000
BTK13    EQU   13                  SAVEAREA POINTER                     09600000
BTK14    EQU   14                  LINKAGE REGISTER         D11 ZA15437 09800000
BTK15    EQU   15                                                       10000000
         SAVE  (14,12)                                                  10200000
         BALR  BTK09,0                 CSECT ADDRESSABILITY             10400000
         USING *,BTK09                                                  10600000
         LR    BTK10,BTK01        WORKAREA ADDRESSABILITY               10800000
         USING BEGTRK,BTK10                                             11000000
*                                                                       11200000
         LA    BTK02,BTKSAVE           CHAIN SAVE AREAS                 11400000
         ST    BTK02,MSVA(BTK13)                                        11600000
         ST    BTK13,HSVA(BTK02)                                        11800000
         LR    BTK13,BTK02             ESTABLISH NEW SAVE AREA          12000000
*                                                                       12200000
         L     BTK11,BTKPARM           PARAMETER LIST ADDRESSABILITY    12400000
         USING BEGPARM,BTK11                                            12600000
*                                                                       12800000
         L     BTK08,BTKGDSCB          USER GDSCB ADDRESSABILITY        13000000
         L     BTK08,0(BTK08)                                           13200000
         USING GDSCB,BTK08                                              13400000
         L     BTK07,BTKRTNA           RETURN ARRAY ADDRESSABILITY      13600000
         USING GSPARRAY,BTK07                                           13800000
         MVI   GSPARRAY,X'00'          CLEAR RETURN CODE                14000000
*                                                                       14200000
         C     BTK08,GDSGDSCB          VALID GDSCB                      14400000
         BNE   BTK006                  NO, ERROR RETURN                 14600000
         L     BTK06,GDSGTMCB          GTMCB ADDRESSABILITY             14800000
         USING GTMCB,BTK06                                              15000000
*                                                                       15200000
         TM    GTMFEATS,MOD3           TRACKING REQUESTED ON MODEL 3    15400000
         BM    BTK008                  NO, ERROR RETURN                 15600000
         TM    BTKGDSCB,X'80'          IF PARAMETER LIST                15800000
         BO    BTK008                                                   16000000
         TM    BTKXCOOR,X'80'          IS NOT THREE ENTRIES LONG,       16200000
         BO    BTK008                                                   16400000
         TM    BTKYCOOR,X'80'          GIVE AN ERROR RETURN             16600000
         BZ    BTK008                                                   16800000
*                                                                       17000000
         MVC   BTKCVGDS(4),BTKGDSCB    POINTER TO GDSNAME               17200000
         LA    BTK02,BTK0002           CONVERT VARIABLE =2              17400000
         ST    BTK02,BTKCVCVT                                           17600000
         MVC   BTKCVXIN(8),BTKXCOOR    POINTER TO COORDINATES           17800000
         NI    BTKCVYIN,X'7F'          SET END-OF-LIST BIT=0            18000000
         LA    BTK02,BTKXABS           POINTERS TO                      18200000
         ST    BTK02,BTKCVXOT          OUTPUT LOCATIONS                 18400000
         LA    BTK02,BTKYABS                                            18600000
         ST    BTK02,BTKCVYOT                                           18800000
         LA    BTK02,BTKCVGDS          POINTER TO PARAMETER LIST        19000000
         ST    BTK02,BTKCVPRM                                           19200000
         MVC   BTKCVRTN(4),BTKRTNA     POINTER TO RETURN ARRAY          19400000
         XC    BTKSUPV(16),BTKSUPV                                      19600000
         LA    BTK01,BTKCVPRM                               D11         19800000
         L     BTK15,STAT(BTK07)   POINT TO STATUS TABLE    D11 ZA15437 20000000
         L     BTK15,CONVERT(BTK15) AND TO CONVERT EP       D11 ZA15437 20200000
         LTR   BTK15,BTK15         CONVERT LOADED YET?      D11 ZA15437 20260000
         BZ    BTKLINK1            NO,MUST USE SYSTEM LINK  D11 ZA15437 20320000
         BALR  BTK14,BTK15         GO CONVERT               D11 ZA15437 20400000
         B     BTKRTN1             RETURN FROM BALR         D11 ZA15437 20450000
BTKLINK1 LA    BTK15,BTKSUPV                                D11 ZA15437 20500000
         LINK  EP=IFFAGA08,MF=(E,(1)),SF=(E,(15)) CALL CONVERT          20550000
BTKRTN1  TM    GSPARRAY,SCALERR    SCALING SUCCESSFUL       D11 ZA15437 20600000
         BO    BTK004                  NO, POINT OFF-SCREEN             20800000
*                                                                       21000000
         SR    BTK02,BTK02             IF POSITION                      21200000
         C     BTK02,BTKXABS                                            21400000
         BH    BTK005                  PROVIDED IS                      21600000
         C     BTK02,BTKYABS                                            21800000
         BH    BTK005                  INVALID,                         22000000
         LA    BTK02,4095                                               22200000
         C     BTK02,BTKXABS           SET RETURN CODE                  22400000
         BL    BTK005                                                   22600000
         C     BTK02,BTKYABS                                            22800000
         BL    BTK005                                                   23000000
*                                                                       23200000
BTK001   TM    GTMFLAGS,TRKIN          SEE IF TRACKING ROUTINE OUT      23400000
         BO    BTK003                  YES, UPDATE POSITION ONLY        23600000
*                                                                       23800000
         LA    BTK02,GTMSYGDS          POINTER TO SYSTEM GDS            24000000
         ST    BTK02,BTKORGDS                                           24200000
         LA    BTK02,POSEL             POINTER TO ORDERS                24400000
         ST    BTK02,BTKORORD                                           24600000
         LA    BTK02,TRKCNT            BYTE COUNT                       24800000
         ST    BTK02,BTKORCNT                                           25000000
         OI    BTKORCNT,X'80'          END-OF-LIST FLAG                 25200000
         LA    BTK02,BTKORGDS          GET POINTERS TO                  25400000
         ST    BTK02,BTKORPRM          PARAMETER LIST                   25600000
         MVC   BTKORRTN(4),BTKRTNA     AND RETURN ARRAY                 25800000
         XC    BTKSUPV(16),BTKSUPV                                      26000000
         LA    BTK01,BTKORPRM                               D11         26200000
         L     BTK15,STAT(BTK07)   POINT TO STATUS TABLE    D11 ZA15437 26400000
         L     BTK15,ORGEN(BTK15)      AND ORGEN EP         D11 ZA15437 26600000
         LTR   BTK15,BTK15         ORGEN LOADED YET?        D11 ZA15437 26660000
         BZ    BTKLINK2            NO,MUST USE SYSTEM LINK  D11 ZA15437 26720000
         BALR  BTK14,BTK15         GOTO ORGEN               D11 ZA15437 26800000
         B     BTKRTN2             RETURN FROM BALR         D11 ZA15437 26850000
BTKLINK2 LA    BTK15,BTKSUPV                                D11 ZA15437 26900000
         LINK  EP=IFFAGA07,MF=(E,(1)),SF=(E,(15))  LINK ORGEN           26950000
BTKRTN2  OI    BTKORGDS,X'80'                               D11 ZA15437 27000000
         XC    BTKSUPV(16),BTKSUPV                                      27200000
         LA    BTK01,BTKORPRM                               D11         27400000
         L     BTK15,STAT(BTK07)   POINT TO STATUS TABLE    D11 ZA15437 27600000
         L     BTK15,EXEC(BTK15)   AND TO EXEC EP           D11 ZA15437 27800000
         LTR   BTK15,BTK15         EXEC LOADED YET?         D11 ZA15437 27860000
         BZ    BTKLINK3            NO,MUST USE SYSTEM LINK  D11 ZA15437 27920000
         BALR  BTK14,BTK15         GOTO EXEC                D11 ZA15437 28000000
         B     BTKRTN3             RETURN FROM BALR         D11 ZA15437 28050000
BTKLINK3 LA    BTK15,BTKSUPV                                D11 ZA15437 28100000
         LINK  EP=IFFAFA11,MF=(E,(1)),SF=(E,(15)) LINK EXEC             28150000
BTKRTN3  TM    GSPARRAY,IOERR          I/O ERROR IN EXEC    D11 ZA15437 28200000
         BO    BTK002                  IMMEDIATE EXIT                   28400000
*                                      SYMBOL OUT ON SCREEN             28600000
         OI    GTMFLAGS,TRKIN          SET FLAG                         28800000
         L     BTK08,GTMSYGDS          CHANGE ADDRESSABILITY TO         29000000
*                                      SYSTEM GDSCB                     29200000
         LH    BTK03,GDSBCTEL          GET BUFFER CONTROL ELEMENT       29400000
         MH    BTK03,BTK0256H          GET BUFFER ADDRESS OF            29600000
         LA    BTK03,XDISPL+2(BTK03)   THE REPOSITIONING VECTOR         29800000
         STH   BTK03,GTMREPOS          AND STORE IT                     30000000
*                                                                       30200000
*                                                                       30400000
BTK003   MVC   BTKWORK(2),BTKXABS+2    ASSEMBLE POSITIONING VECTOR      30600000
         MVC   BTKWORK+2(2),BTKYABS+2                                   30800000
         XC    BTKSUPV(32),BTKSUPV     CLEAR DECB                       31000000
         LA    BTK01,BTKSUPV           DECB                             31200000
         L     BTK02,GTMGRDCB          DCB                              31400000
         LA    BTK03,BTKWORK           OUTPUT AREA                      31600000
         LA    BTK04,GTMREPOS          BUFFER ADDRESS                   31800000
         L     BTK05,GTMFCTBL          START ADDRESS                    32000000
         LA    BTK05,BTK08A(BTK05)                                      32200000
         GWRITE (BTK01),STR,(BTK02),4,(BTK03),(BTK04),(BTK05),MF=E      32400000
         LA    BTK01,BTKSUPV                                            32600000
         WAIT  ECB=(1)                                                  32800000
         CLI   BTKSUPV,PSTCD           I/O SUCESSFUL                    33000000
         BE    BTK002                  YES, EXIT                        33200000
         OI    GSPARRAY,IOERR          NO, SET RETURN CODE              33400000
BTK002   L     BTK13,HSVA(BTK13)       RETURN                           33600000
         RETURN (14,12),T,RC=0                                          33800000
*                                                                       34000000
BTK004   MVI   GSPARRAY,X'00'          CLEAR THE RETURN CODE            34200000
BTK005   OI    GSPARRAY,SCISERR        SET SCISSORING ERROR CODE        34400000
         XC    GSPARRAY+4(8),GSPARRAY+4                                 34600000
         LA    BTK02,2048              SET POSITION TO CENTER           34800000
         ST    BTK02,BTKXABS           OF SCREEN                        35000000
         ST    BTK02,BTKYABS                                            35200000
         B     BTK001                  BRANCH TO PUT OUT SYMBOL         35400000
*                                                                       35600000
BTK006   MVC   GSPARRAY+16(4),BTK0001  BAD GDSCB                        35800000
BTK007   OI    GSPARRAY,PARERR         PARAMETER ERROR                  36000000
         B     BTK002                                                   36200000
BTK008   XC    GSPARRAY+16(4),GSPARRAY+16   INCORRECT LENGTH            36400000
         B     BTK007                                                   36600000
*                                                                       36800000
BTK0001  DC    F'1'                                                     37000000
BTK0002  DC    F'2'                                                     37200000
BTK0003  DC    F'3'                                                     37400000
BTK0256H DC    H'256'                                                   37600000
TRKCNT   DC    A(TRKEND-POSEL)                                          37800000
*                                                                       38000000
         GINIT                                                          38200000
POSEL    GENSD                                                          38400000
         GDRD                                                           38600000
         GEPM  A                                                        38800000
POSVEC   GDV   2048,2048,U                                              39000000
*                                                                       39200000
         GTDD  TRK01                                                    39400000
HXGN1    GEPI2                                                          39600000
         GDV   40,0,U                                                   39800000
         GTDD  TRK01                                                    40000000
         GEPI2                                                          40200000
         GDV   -20,32,U                                                 40400000
         GTDD  TRK01                                                    40600000
         GEPI2                                                          40800000
         GDV   -40,0,U                                                  41000000
         GTDD  TRK01                                                    41200000
         GEPI2                                                          41400000
         GDV   -20,-32,U                                                41600000
         GTDD  TRK01                                                    41800000
         GEPI2                                                          42000000
         GDV   20,-32,U                                                 42200000
         GTDD  TRK01                                                    42400000
         GEPI2                                                          42600000
         GDV   40,0,U                                                   42800000
         GTDD  TRK01                                                    43000000
*                                                                       43200000
HXGN2    GEPI2                                                          43400000
         GDV   60,32,U                                                  43600000
         GTDD  TRK01                                                    43800000
         GEPI2                                                          44000000
         GDV   -20,32,U                                                 44200000
         GTDD  TRK01                                                    44400000
         GEPI2                                                          44600000
         GDV   -20,32,U                                                 44800000
         GTDD  TRK01                                                    45000000
         GEPI2                                                          45200000
         GDV   -40,0,U                                                  45400000
         GTDD  TRK01                                                    45600000
         GEPI2                                                          45800000
         GDV   -40,0,U                                                  46000000
         GTDD  TRK01                                                    46200000
         GEPI2                                                          46400000
         GDV   -20,-32,U                                                46600000
         GTDD  TRK01                                                    46800000
         GEPI2                                                          47000000
         GDV   -20,-32,U                                                47200000
         GTDD  TRK01                                                    47400000
         GEPI2                                                          47600000
         GDV   20,-32,U                                                 47800000
         GTDD  TRK01                                                    48000000
         GEPI2                                                          48200000
         GDV   20,-32,U                                                 48400000
         GTDD  TRK01                                                    48600000
         GEPI2                                                          48800000
         GDV   40,0,U                                                   49000000
         GTDD  TRK01                                                    49200000
         GEPI2                                                          49400000
         GDV   40,0,U                                                   49600000
         GTDD  TRK01                                                    49800000
         GEPI2                                                          50000000
         GDV   20,32,U                                                  50200000
         GTDD  TRK01                                                    50400000
*                                                                       50600000
HXGN3    GEPI2                                                          50800000
         GDV   60,32,U                                                  51000000
         GTDD  TRK01                                                    51200000
         GEPI2                                                          51400000
         GDV   -20,32,U                                                 51600000
         GTDD  TRK01                                                    51800000
         GEPI2                                                          52000000
         GDV   -20,32,U                                                 52200000
         GTDD  TRK01                                                    52400000
         GEPI2                                                          52600000
         GDV   -20,32,U                                                 52800000
         GTDD  TRK01                                                    53000000
         GEPI2                                                          53200000
         GDV   -40,0,U                                                  53400000
         GTDD  TRK01                                                    53600000
         GEPI2                                                          53800000
         GDV   -40,0,U                                                  54000000
         GTDD  TRK01                                                    54200000
         GEPI2                                                          54400000
         GDV   -40,0,U                                                  54600000
         GTDD  TRK01                                                    54800000
         GEPI2                                                          55000000
         GDV   -20,-32,U                                                55200000
         GTDD  TRK01                                                    55400000
         GEPI2                                                          55600000
         GDV   -20,-32,U                                                55800000
         GTDD  TRK01                                                    56000000
         GEPI2                                                          56200000
         GDV   -20,-32,U                                                56400000
         GTDD  TRK01                                                    56600000
         GEPI2                                                          56800000
         GDV   20,-32,U                                                 57000000
         GTDD  TRK01                                                    57200000
         GEPI2                                                          57400000
         GDV   20,-32,U                                                 57600000
         GTDD  TRK01                                                    57800000
         GEPI2                                                          58000000
         GDV   20,-32,U                                                 58200000
         GTDD  TRK01                                                    58400000
         GEPI2                                                          58600000
         GDV   40,0,U                                                   58800000
         GTDD  TRK01                                                    59000000
         GEPI2                                                          59200000
         GDV   40,0,U                                                   59400000
         GTDD  TRK01                                                    59600000
         GEPI2                                                          59800000
         GDV   40,0,U                                                   60000000
         GTDD  TRK01                                                    60200000
         GEPI2                                                          60400000
         GDV   20,32,U                                                  60600000
         GTDD  TRK01                                                    60800000
         GEPI2                                                          61000000
         GDV   20,32,U                                                  61200000
         GTDD  TRK01                                                    61400000
         GEVI2                                                          61600000
         GDV   -100,32,B                                                61800000
TRK01    GSXY  POSVEC                                                   62000000
         GPDI                                                           62200000
TRKEND   DS    0H                                                       62400000
PATCH    DC    64X'FF'             PATCH AREA               D11         62600000
HSVA     EQU   4                                                        62800000
MSVA     EQU   8                                                        63000000
PARERR   EQU   X'08'                                                    63200000
SCALERR  EQU   X'20'                                                    63400000
SCISERR  EQU   X'40'                                                    63600000
XDISPL   EQU   6                                                        63800000
YDISPL   EQU   8                                                        64000000
BTK08A   EQU   8                                                        64200000
TRKIN    EQU   X'08'                                                    64400000
IOERR    EQU   X'04'                                                    64600000
PSTCD    EQU   X'7F'                                                    64800000
MOD3     EQU   X'03'                                                    65000000
CONVERT  EQU   X'0264'             STATAB CNVRT ENTRY DISPL D11 ZA15437 65200000
EXEC     EQU   X'01C8'             STATAB EXEC  ENTRY DISPL D11 ZA15437 65400000
ORGEN    EQU   X'0258'             STATAB ORGEN ENTRY DISPL D11 ZA15437 65600000
STAT     EQU   24                A(STATAB)-A(RTNARR) IN GSP D11 ZA15437 65800000
*                                                                       66000000
BEGTRK   DSECT                                                          66200000
BTKPARM  DS    F                                                        66400000
BTKRTNA  DS    F                                                        66600000
BTKSAVE  DS    18F                                                      66800000
BTKSUPV  DS    8F                                                       67000000
*                                                                       67200000
BTKXABS  DS    F                                                        67400000
BTKYABS  DS    F                                                        67600000
*                                                                       67800000
BTKCVGDS DS    F                                                        68000000
BTKCVCVT DS    F                                                        68200000
BTKCVXIN DS    F                                                        68400000
BTKCVYIN DS    F                                                        68600000
BTKCVXOT DS    F                                                        68800000
BTKCVYOT DS    F                                                        69000000
BTKCVPRM DS    F                                                        69200000
BTKCVRTN DS    F                                                        69400000
*                                                                       69600000
         ORG   BTKCVGDS                                                 69800000
BTKWORK  DS    4F                                                       70000000
*                                                                       70200000
BTKORGDS DS    F                                                        70400000
BTKORORD DS    F                                                        70600000
BTKORCNT DS    F                                                        70800000
BTKORPRM DS    F                                                        71000000
BTKORRTN DS    F                                                        71200000
BEGPARM  DSECT                                                          71400000
BTKGDSCB DS    F                                                        71600000
BTKXCOOR DS    F                                                        71800000
BTKYCOOR DS    F                                                        72000000
*                                                                       72200000
         COPY  GSPCB                                                    72400000
         COPY  GDSCB                                                    72600000
         COPY  GTMCB                                                    72800000
*                                                                       73000000
         END                                                            73200000
./  ADD  SSI=80330207,NAME=IFFAGA03
         TITLE 'IFFAGA03 - RDTRK - READ POSITION OF TRACKING SYMBOL'    00500000
*STATUS: CHANGE LEVEL 000                                               01000000
*                                                                       01500000
*FUNCTION/OPERATION:  READS THE TRACKING SYMBOL'S POSITIONING VECTOR    02000000
*        INTO MAIN CORE.  CONVERTS THE RASTER UNIT COORDINATES IN THE   02500000
*        VECTOR INTO USER COORDINATES BY A CALL TO CNVRT.               03000000
*                                                                       03500000
*ENTRY POINTS: IFFAGA03                                                 04000000
*                                                                       04500000
*INPUT:  REGISTER 1 POINTS TO A WORKAREA.  THE FIRST WORD CONTAINS THE  05000000
*        ADDRESS OF THE PARAMETER LIST, AND THE SECOND, THAT OF THE     05500000
*        RETURN CODE ARRAY.  THE FIXED LENGTH PARAMETER LIST IS         06000000
*    + 0 A(POINTER TO THE GDSCB)                                        06500000
*                                                                       07000000
*    + 4 A(X POSITION OF TRACKING SYMBOL)                               07500000
*                                                                       08000000
*    + 8 A(Y POSITION OF TRACKING SYMBOL)                               08500000
*                                                                       09000000
*OUTPUT: USER COORDINATES OF THE LATEST POSITION OF THE TRACKING SYMBOL 09500000
*                                                                       10000000
*EXTERNAL ROUTINES: CNVRT, GREAD                                        10500000
*                                                                       11000000
*EXITS-NORMAL AND ERROR: VIA RETURN MACRO TO DIRECTOR                   11500000
*                                                                       12000000
*TABLES/WORKAREAS: GSP WORKAREA                                         12500000
*                                                                       13000000
*ATTRIBUTES: PROBLEM STATE, REENTRANT                                   13500000
*                                                                       14000000
*A92000,A142000-144000,C637000-651000                       D11 ZA15437 14500000
IFFAGA03 CSECT                                                          15000000
RTK01    EQU   1                       REGISTER EQUATES                 15500000
RTK02    EQU   2                                                        16000000
RTK03    EQU   3                                                        16500000
RTK04    EQU   4                                                        17000000
RTK05    EQU   5                                                        17500000
RTK06    EQU   6                   GTM ADDRESSIBILITY                   18000000
RTK07    EQU   7                   RETCODE ARRAY ADDRESSIBILITY         18500000
RTK08    EQU   8                   GDS ADDRESSIBILITY                   19000000
RTK09    EQU   9                   BASEREG                              19500000
RTK10    EQU   10                  WORKAREA ADDRESSIBILITY              20000000
RTK11    EQU   11                  PARMLIST ADDRESSIBILITY              20500000
RTK13    EQU   13                                                       21000000
RTK14    EQU   14                  LINKAGE REGISTER         D11 ZA15437 21500000
RTK15    EQU   15                                                       22000000
*                                                                       22500000
HSVA     EQU   4                                                        23000000
MSVA     EQU   8                                                        23500000
FCT8     EQU   8                                                        24000000
PARERR   EQU   X'08'                                                    24500000
TRKIN    EQU   X'08'                                                    25000000
STAT     EQU   24                A(STATAB)-A(RTNARR) IN GSP D11 ZA15437 25500000
CONVERT  EQU   X'0264'             STATAB CNVRT ENTRY DISPL D11 ZA15437 26000000
*                                                                       26500000
         SAVE  (14,12)                                                  27000000
         BALR  RTK09,0                 CSECT ADDRESSABILITY             27500000
         USING *,RTK09                                                  28000000
         LR    RTK10,RTK01                                              28500000
         USING READTRK,RTK10           WORKAREA ADDRESSABILITY          29000000
*                                                                       29500000
         LA    RTK02,RTKSAVE           CHAIN SAVE AREAS                 30000000
         ST    RTK02,MSVA(RTK13)                                        30500000
         ST    RTK13,HSVA(RTK02)                                        31000000
         LR    RTK13,RTK02             ESTABLISH NEW SAVE AREA          31500000
*                                                                       32000000
         L     RTK07,RTKRTNA           RETURN ARRAY ADDRESSABILITY      32500000
         USING GSPARRAY,RTK07                                           33000000
         L     RTK11,RTKPARM           PARAMETER ADDRESSABILITY         33500000
         USING READPARM,RTK11                                           34000000
         L     RTK08,RTKGDSCB                                           34500000
         L     RTK08,0(RTK08)          GDSCB ADDRESSABILITY             35000000
         USING GDSCB,RTK08                                              35500000
*                                                                       36000000
         C     RTK08,GDSGDSCB          VALID GDS                        36500000
         BNE   RTK001                  NO, ERROR RETURN                 37000000
*                                                                       37500000
         TM    RTKGDSCB,X'80'          MAKE SURE PARAMETER              38000000
         BO    RTK002                                                   38500000
         TM    RTKXPOS,X'80'           LIST HAS THREE ENTRIES           39000000
         BO    RTK002                                                   39500000
         TM    RTKYPOS,X'80'           NO, ERROR RETURN                 40000000
         BZ    RTK002                                                   40500000
*                                                                       41000000
         L     RTK06,GDSGTMCB          GTMCB ADDRESSABILITY             41500000
         USING GTMCB,RTK06                                              42000000
*                                                                       42500000
         TM    GTMFLAGS,TRKIN          TRACKING ROUTINE IN              43000000
         BZ    RTK002                  NO, ERROR RETURN                 43500000
*                                                                       44000000
         XC    RTKSUPV(32),RTKSUPV     YES, CLEAR DECB AREA             44500000
         LA    RTK01,RTKSUPV           GET ADDRESS OF DECB              45000000
         L     RTK02,GTMGRDCB          GET ADDRESS OF DCB               45500000
         LA    RTK03,RTKIOBUF          INPUT AREA                       46000000
         LA    RTK04,GTMREPOS          BUFFER READ ADDRESS              46500000
         L     RTK05,GTMFCTBL          BUFFER START ADDRESS             47000000
         LA    RTK05,FCT8(RTK05)                                        47500000
         GREAD (RTK01),STR,(RTK02),4,(RTK03),(RTK04),(RTK05),MF=E       48000000
         LA    RTK01,RTKSUPV                                            48500000
         WAIT  ECB=(1)                                                  49000000
*                                                                       49500000
*                                                                       50000000
         LH    RTK02,RTKIOBUF          GET X VALUE                      50500000
         ST    RTK02,RTKXVAL                                            51000000
         LH    RTK02,RTKIOBUF+2        AND Y VALUE                      51500000
         ST    RTK02,RTKYVAL                                            52000000
*                                                                       52500000
*        SET UP PARAMETERS FOR CALL TO CNVRT                            53000000
*                                                                       53500000
         MVC   RTKCVGDS(4),RTKGDSCB    GDSNAME                          54000000
         LA    RTK02,RTK0001           CONVERT VARIABLE (SET = 1)       54500000
         ST    RTK02,RTKCVCVT                                           55000000
         LA    RTK02,RTKXVAL           X INPUT VALUE                    55500000
         ST    RTK02,RTKCVXIN                                           56000000
         LA    RTK02,RTKYVAL           Y INPUT VALUE                    56500000
         ST    RTK02,RTKCVYIN                                           57000000
         MVC   RTKCVXOT(8),RTKCVXIN    OUTPUT VALUES                    57500000
         OI    RTKCVYOT,X'80'          END OF LIST FLAG                 58000000
*                                                                       58500000
         LA    RTK02,RTKCVGDS          POINTER TO PARAMETERS            59000000
         ST    RTK02,RTKCVPRM                                           59500000
         MVC   RTKCVRTN(4),RTKRTNA     AND RETURN ARRAY                 60000000
         XC    RTKSUPV(16),RTKSUPV     CLEAR SUPERVISOR AREA            60500000
         LA    RTK01,RTKCVPRM                                           61000000
         L     RTK15,STAT(RTK07)   POINT TO STATUS TABLE    D11 ZA15437 61500000
         L     RTK15,CONVERT(RTK15) AND TO CONVERT EP       D11 ZA15437 62000000
         LTR   RTK15,RTK15         CONVERT LOADED YET?      D11 ZA15437 62100000
         BZ    RTKLINK1            NO,MUST USE SYSTEM LINK  D11 ZA15437 62200000
         BALR  RTK14,RTK15         GO CONVERT               D11 ZA15437 62500000
         B     RTKRTN1             RETURN FROM BALR         D11 ZA15437 62600000
RTKLINK1 LA    RTK15,RTKSUPV                                D11 ZA15437 62700000
         LINK  EP=IFFAGA08,MF=(E,(1)),SF=(E,(15)) LINK CONVERT          62800000
RTKRTN1  LM    RTK02,RTK03,RTKXPOS     GET OUTPUT LOCATIONS D11 ZA15437 63000000
         MVC   0(4,RTK02),RTKXVAL      STORE OUTPUT VALUES              63500000
         MVC   0(4,RTK03),RTKYVAL                                       64000000
         MVI   GSPARRAY,X'00'          SET RETURN CODE                  64500000
         L     RTK13,HSVA(RTK13)       RETURN                           65000000
         RETURN (14,12),T,RC=0                                          65500000
*                                                                       66000000
RTK001   MVC   GSPARRAY+16(4),RTK0001  BAD GDSCB                        66500000
         B     RTK003                                                   67000000
RTK002   XC    GSPARRAY+16(4),GSPARRAY+16 BAD PARAMETER LIST            67500000
RTK003   OI    GSPARRAY,PARERR         SET RETURN CODE                  68000000
         L     RTK13,HSVA(RTK13)       RETURN                           68500000
         RETURN (14,12),T,RC=0                                          69000000
*                                                                       69500000
*                                                                       70000000
RTK0001  DC    F'1'                                                     70500000
PATCH    DC    64X'FF'             PATCH AREA               D11         71000000
*                                                                       71500000
READTRK  DSECT                                                          72000000
RTKPARM  DS    F                                                        72500000
RTKRTNA  DS    F                                                        73000000
RTKSAVE  DS    18F                     SAVE AREA                        73500000
RTKSUPV  DS    8F                      SUPERVISOR WORK AREA             74000000
*                                      PARAMETERS FOR CNVRT             74500000
RTKCVGDS DS    F                            GDSNAME                     75000000
RTKCVCVT DS    F                            CONVERT VARIABLE (SET = 1)  75500000
RTKCVXIN DS    F                            INPUT VALUES                76000000
RTKCVYIN DS    F                                                        76500000
RTKCVXOT DS    F                            OUTPUT VALUES               77000000
RTKCVYOT DS    F                                                        77500000
RTKXVAL  DS    F                            COORDINATES TO BE CONVERED  78000000
RTKYVAL  DS    F                                                        78500000
RTKIOBUF DS    2F                      I/O BUFFER                       79000000
RTKCVPRM DS    F                       POINTER TO PARAMETERS FOR CNVRT  79500000
RTKCVRTN DS    F                       POINTER TO RETURN ARRAY          80000000
*                                                                       80500000
READPARM DSECT                                                          81000000
RTKGDSCB DS    F                       POINTER TO GDS                   81500000
RTKXPOS  DS    F                       OUTPUT LOCATIONS                 82000000
RTKYPOS  DS    F                                                        82500000
         COPY  GSPCB                                                    83000000
         COPY  GDSCB                                                    83500000
         COPY  GTMCB                                                    84000000
         END                                                            84500000
./  ADD  SSI=20480284,NAME=IFFAGA04
         TITLE 'IFFAGA04 - ENTRK - END LIGHT-PEN TRACKING'              00070021
*STATUS: CHANGE LEVEL 000                                               00140021
*                                                                       00210021
*FUNCTION/OPERATION: REMOVES THE TRACKING SYMBOL FROM THE DEVICE        00280021
*        ASSOCIATED WITH THE GDS PASSED.                                00350021
*                                                                       00420021
*ENTRY POINTS: IFFAGA04                                                 00490021
*                                                                       00560021
*INPUT:  REGISTER 1 POINTS TO A WORKAREA.  THE FIRST WORD CONTAINS THE  00630021
*        ADDRESS OF THE PARAMETER LIST, AND THE SECOND, THAT OF THE     00700021
*        RETURN CODE ARRAY.  THE FIXED-LENGTH PARAMETER LIST IS         00770021
*    + 0 A(POINTER TO THE GDSCB)                                        00840021
*                                                                       00910021
*OUTPUT: NONE TO THE USER.  THE SYSTEM GDS IS RESET, REMOVING THE       00980021
*        TRACKING ROUTINE FROM THE DEVICE.                              01050021
*                                                                       01120021
*EXTERNAL ROUTINES: RESET                                               01190021
*                                                                       01260021
*EXITS-NORMAL AND ERROR: VIA RETURN MACRO TO DIRECTOR                   01330021
*                                                                       01400021
*TABLES/WORKAREAS: GSP WORKAREA                                         01470021
*                                                                       01540021
*ATTRIBUTES: PROBLEM STATE, REENTRANT                                   01610021
*                                                                       01680021
IFFAGA04 CSECT                                                          01750021
         SAVE  (14,12)                                                  02000021
         BALR  ETK09,0                 CSECT ADDRESSABILITY             03000021
         USING *,ETK09                                                  04000021
         LR    ETK10,ETK01             WORKAREA ADDRESSABILITY          05000021
         USING ENDTRK,ETK10                                             06000021
*                                                                       07000021
         LA    ETK02,ETKSAVE           CHAIN SAVE AREAS                 08000021
         ST    ETK02,MSVA(ETK13)                                        09000021
         ST    ETK13,HSVA(ETK02)                                        10000021
         LR    ETK13,ETK02             ESTABLISH NEW SAVE AREA          11000021
*                                                                       12000021
         L     ETK08,ETKPARM           GET ADDRESS OF PARAMETER LIST    13000021
         L     ETK08,0(ETK08)          GET POINTER TO GDSNAME           14000021
         L     ETK08,0(ETK08)          GET ADDRESS OF GDSCB             15000021
         USING GDSCB,ETK08             GDSCB ADDRESSABILITY             16000021
         L     ETK07,ETKRTNA                                            17000021
         USING GSPARRAY,ETK07          RETURN ARRAY ADDRESSABILITY      18000021
*                                                                       19000021
         C     ETK08,GDSGDSCB          VALID GDS                        20000021
         BNE   ETK002                  NO, ERROR RETURN                 21000021
*                                                                       22000021
         L     ETK06,GDSGTMCB          YES, GET GTMCB                   23000021
         USING GTMCB,ETK06                                              24000021
*                                                                       25000021
         TM    GTMFLAGS,TRKFLG         TRACKING IN                      26000021
         BZ    ETK003                  NO, INVALID CALL                 27000021
*                                                                       28000021
         LA    ETK02,GTMSYGDS          YES, GET ADDRESS OF POINTER TO   29000021
         ST    ETK02,ETKRSGDS          THE SYSTEM GDS                   30000021
         OI    ETKRSGDS,X'80'                                           31000021
         LA    ETK02,ETKRSGDS          SET UP PARAMETERS FOR RESET      32000021
         ST    ETK02,ETKRSPRM                                           33000021
         MVC   ETKRSRTN(4),ETKRTNA                                      34000021
         XC    ETKSUPV(16),ETKSUPV     CLEAR SUPERVISOR WORK AREA       35000021
*                                                                       36000021
         LA    ETK01,ETKRSPRM                                           37000021
         LA    ETK15,ETKSUPV                                            38000021
         LINK  EP=IFFAFA12,MF=(E,(1)),SF=(E,(15)) CALL RESET            39000021
         NI    GTMFLAGS,TRKFLGO        TURN OFF FLAG BIT                40000021
         XC    GTMREPOS(2),GTMREPOS    RESET REPOSITIONING ADDRESS=0    41000021
         MVI   GSPARRAY,X'00'          CLEAR RETURN CODE                41500021
*                                                                       42000021
ETK001   L     ETK13,HSVA(ETK13)       RETURN                           43000021
         RETURN (14,12),T,RC=0                                          45000021
*                                                                       46000021
ETK002   OI    GSPARRAY,PARERR         SET RETURN CODE                  47000021
         MVC   GSPARRAY+16(4),ETK0001  BAD GDSCB                        48000021
         B     ETK001                                                   49000021
*                                                                       50000021
ETK003   OI    GSPARRAY,PARERR         CALLED WITHOUT TRACKING IN       50200021
         XC    GSPARRAY+16(4),GSPARRAY+16                               50400021
         B     ETK001                                                   50600021
*                                                                       50800021
TRKFLG   EQU   X'08'                                                    51000021
TRKFLGO  EQU   X'F7'                                                    52000021
MSVA     EQU   8                                                        53000021
HSVA     EQU   4                                                        54000021
PARERR   EQU   X'08'                                                    55000021
*                                                                       56000021
ETK0001  DC    F'1'                                                     57000021
*                                                                       58000021
ETK01    EQU   1                       REGISTER EQUATES                 59000021
ETK02    EQU   2                                                        60000021
ETK06    EQU   6                       REGISTERS ETK06,ETK07,ETK08,     61000021
ETK07    EQU   7                       ETK09, AND ETK10 ARE             62000021
ETK08    EQU   8                       BASE REGISTERS                   63000021
ETK09    EQU   9                                                        64000021
ETK10    EQU   10                                                       65000021
ETK13    EQU   13                                                       66000021
ETK15    EQU   15                                                       67000021
*                                                                       68000021
ENDTRK   DSECT                                                          69000021
ETKPARM  DS    F                                                        70000021
ETKRTNA  DS    F                                                        71000021
ETKSAVE  DS    18F                                                      72000021
ETKSUPV  DS    4F                                                       73000021
ETKRSGDS DS    F                                                        74000021
ETKRSPRM DS    F                                                        75000021
ETKRSRTN DS    F                                                        76000021
*                                                                       77000021
         COPY  GSPCB                                                    78000021
         COPY  GTMCB                                                    79000021
         COPY  GDSCB                                                    80000021
         END                                                            81000021
./  ADD  SSI=20480286,NAME=IFFAGA05
         TITLE 'DFSTR - IFFAGA05'                                       00300021
*********************************************************************** 00600021
*                                                                     * 00900021
*MODULE NAME   IFFAGA05                                               * 01200021
*                                                                     * 01500021
*STATUS        CHANGE LEVEL 000                                       * 01800021
*                                                                     * 02100021
*FUNCTION/OPERATION                                                   * 02400021
*  MODIFIES A DESIGNATED ENTRY IN A DESIGNATED STROKE TABLE, ALLOWING * 02700021
*  THE STROKES DEFINING A CHARACTER TO BE DEFINED OR ALTERED.         * 03000021
*                                                                     * 03300021
*ENTRY POINT   IFFAGA05 - CSECT NAME                                  * 03600021
*                                                                     * 03900021
*INPUT   REGISTER 1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA. THE     * 04200021
*  FIRST WORD CONTAINS THE ADDRESS OF THE PARAMETER LIST ON A FULL    * 04500021
*  WORD BOUNDARY. THE NULL VARIABLE IS AT AN OFFSET OF 20 FROM THE    * 04800021
*  RETURN ARRAY                                                       * 05100021
* PARAMETERS                                                          * 05400021
*  +0    A(VAR)          ADDRESS OF A VARIABLE WHICH CONTAINS THE     * 05700021
*                        GDSCB ADDRESS                                * 06000021
*  +4    A(TABLE)        ADDRESS OF AN INTEGER FROM 1-99 WHICH        * 06300021
*                        IDENTIFIES THE STROKE TABLE                  * 06600021
*  +8    A(STROKE ARRAY) ADDRESS OF AN ARRAY DEFINING THE STROKES     * 06900021
*                        TO BE USED IN GENERATING THE CHARACTER.      * 07200021
*                        ENTRIES IN THE ARRAY ARE INTEGER FULL WORD   * 07500021
*                        PAIRS, CORRESPONDING TO X AND Y CORRDINATES. * 07800021
*                        THEIR VALUES INDICATE BEAM POSITION ON AN    * 08100021
*                        128*128 MATRIX. A PLUS SIGN IN THE X         X 08400021
*                        COORDINATE WORD INDICATES BEAM ON, A MINUS   X 08700021
*                        SIGN, BEAM OFF.                              X 09000021
*  +12   A(SYMBOL)       ADDRESS OF THE INTEGER VALUE OF THE EBCDIC   * 09300021
*                        CHARACTER WHOSE GRAPHIC IS BEING DEFINED     * 09600021
*  +16   A(COUNT)        ADDRESS OF THE NUMBER OF FULL WORD PAIRS     * 09900021
*                                                                     * 10200021
*OUTPUT  NONE TO CALLER. THE COPY OF THE STROKE TABLE IN STORAGE      * 10500021
*                        IS MODIFIED.                                 * 10800021
*                                                                     * 11100021
*EXTERNAL MACROS                                                      * 11400021
*  LOAD                                                               * 11700021
*                                                                     * 12000021
*EXITS  -NORMAL- BACK TO CALLER VIA REGISTER 14                       * 12300021
*       -ERROR - IF ERROR IN PARAMETER PASSED, BACK TO CALLER VIA     * 12600021
*                REGISTER 14, WITH AN APPROPRIATE CODE SET IN THE     * 12900021
*                RETURN ARRAY                                         * 13200021
*              - IF THE STROKE TABLE CANNOT BE LOCATED, AN ABEND      * 13500021
*                WILL BE CAUSED BY THE OPERATING SYSTEM.              * 13800021
*                                                                     * 14100021
*TABLES/WORKAREAS   -SEE WORKAREA DSECT                               * 14400021
*                                                                     * 14700021
*ATTRIBUTES    -REENTRANT, PROBLEM PROGRAM MODE                       * 15000021
*********************************************************************** 15900021
         EJECT                                                          16200021
IFFAGA05 CSECT                          DFSTR                           16500021
*C786000                                                         A19165 16550021
*A777000                                                         A36606 16600021
         SPACE 4                                                        16800021
*REGISTERS                                                              17100021
         SPACE                                                          17400021
RZERO    EQU   0                                                        17700021
PARM     EQU   1                                                        18000021
REGA     EQU   2                                                        18300021
REGB     EQU   3                                                        18600021
ERRCD    EQU   4                                                        18900021
WORK     EQU   5                                                        19200021
GSPREG   EQU   6                                                        19500021
GTMREG   EQU   7                                                        19800021
GDSREG   EQU   8                                                        20100021
BASE     EQU   9                                                        20400021
REGC     EQU   10                                                       20700021
COUNT    EQU   11                                                       21000021
SAVE     EQU   13                                                       21300021
RETREG   EQU   14                                                       21600021
BRANCH   EQU   15                                                       21900021
         SPACE 4                                                        22200021
*PARAMETER LIST EQUATES                                                 22500021
         SPACE                                                          22800021
GDS      EQU   0                        ADDRESS OF GDSCB VARIABLE       23100021
TABLE    EQU   4                        ADDRESS OF STROKE TABLE IDENT   23400021
STROKE   EQU   8                        ADDRESS OF STROKE ARRAY         23700021
SYMBOL   EQU   12                       ADDR OF INTEGER VALUE OF CHAR   24000021
SCOUNT   EQU   16                       ADDR OF NUMBER OF STROKES       24300021
         SPACE 2                                                        24600021
PRM      EQU   X'08'                    PARM ERROR INDICATOR            24900021
LAST     EQU   X'80'                                                    25200021
SWITCH   EQU   X'80'                    SWITCH SETTER FOR STROKE TABLE  25500021
         SPACE                                                          25800021
*DISPLACEMENTS                                                          26100021
*                                                                       26400021
PARMERR  EQU   16                       DISPLACEMENT FROM RETURN ARRAY  26700021
ID       EQU   0                        DISPLACEMENT FROM STROKE TABLE  27000021
NEXTAB   EQU   4                          *                             27300021
STKADDR  EQU   8                          *                             27600021
ZORM     EQU   12                                                       27900021
SIGN     EQU   X'F0'                                                    28200021
         EJECT                                                          28500021
         USING *,15                                                     28800021
         SAVE  (14,12)                                                  29100021
         DROP  15                                                       29400021
         LR    BASE,15                  LOAD CONTROL SECTION BASE       29700021
         USING IFFAGA05,BASE                                            30000021
         LR    WORK,PARM                LOAD WORK AREA BASE             30300021
         USING WORKAREA,WORK                                            30600021
         L     PARM,WKPARM              LOAD PARAMETER LIST ADDRESS     30900021
         L     ERRCD,WKRTNCD            ADDRESS OF RETURN ARRAY         31200021
         XC    0(20,ERRCD),0(ERRCD)     ZERO RETURN ARRAY               31500021
         LA    REGA,WKSAVE              CHAIN SAVE AREAS                31800021
         ST    REGA,8(SAVE)                                             32100021
         ST    SAVE,4(REGA)                                             32400021
         LR    SAVE,REGA                                                32700021
*                                                                       33000021
*CHECK GDSCB FOR VALIDITY                                               33300021
*                                                                       33600021
         L     GDSREG,GDS(PARM)         ADDRESS OF GDSCB VARIABLE       33900021
         L     GDSREG,0(GDSREG)         ADDRESS OF GDSCB                34200021
         USING GDSCB,GDSREG                                             34500021
         C     GDSREG,GDSGDSCB                                          34800021
         BNE   AGAERR10                 BRANCH IF INVALID GDSGDSCB      35100021
*                                                                       35400021
*IF GDSCB IS VALID, CONTINUE INITIALIZATION                             35700021
*                                                                       36000021
         L     GTMREG,GDSGTMCB          PICK UP ADDRESS OF GTMCB        36300021
         USING GTMCB,GTMREG                                             36600021
         L     GSPREG,GTMGSPCB          PICK UP ADDRESS OF GSPCB        36900021
         DROP  GTMREG                                                   37200021
         USING GSPCB,GSPREG                                             37500021
*CONTINUE PARAMETER CHECK- CHECK FOR ALL REQUIRED PARAMETERS PRESENT    37800021
*                                                                       38100021
         TM    GDS(PARM),LAST                                           38400021
         BO    AGAERR00                 BRANCH IF REQ PARMS NOT PRESENT 38700021
         CLC   GSPNULLV+1(3),TABLE+1(PARM)                              39000021
         BE    AGAERR20                      ERROR IF TABLE NULL        39300021
         TM    TABLE(PARM),LAST                                         39600021
         BO    AGAERR00                 BRANCH IF REQ PARMS NOT PRESENT 39900021
         CLC   GSPNULLV+1(3),STROKE+1(PARM)                             40200021
         BE    AGAERR30                      ERROR IF STROKES NULL      40500021
         TM    STROKE(PARM),LAST                                        40800021
         BO    AGAERR00                 BRANCH IF REQ PARMS NOT PRESENT 41100021
         CLC   GSPNULLV+1(3),SYMBOL+1(PARM)                             41400021
         BE    AGAERR40                      ERROR IF SYMBOL NULL       41700021
         TM    SYMBOL(PARM),LAST                                        42000021
         BO    AGAERR00                 BRANCH IF REQ PARMS NOT PRESENT 42300021
         CLC   GSPNULLV+1(3),COUNT+1(PARM)                              42600021
         BE    AGAERR50                      ERROR IF COUNT NULL        42900021
         L     COUNT,SCOUNT(PARM)       PICK UP ADDRESS OF COUNT        43200021
         L     COUNT,0(COUNT)           COUNT                           43500021
         LTR   COUNT,COUNT                                              43800021
         BZ    AGARET10                 RETURN IF STROKE COUNT ZERO     44100021
         BM    AGAERR50                 ERROR IF COUNT NEGATIVE         44400021
         EJECT                                                          44700021
*                                                                       45000021
*CHECK TABLE IDENTIFICATION                                             45300021
*                                                                       45600021
         L     REGA,TABLE(PARM)         ADDRESS OF TABLE ID             45900021
         L     REGA,0(REGA)             PICK UP ID                      46200021
         LTR   REGA,REGA                                                46500021
         BC    ZORM,AGAERR20            BRANCH IF ZERO OR LESS- ERROR   46800021
         C     REGA,ONEH                                                47100021
         BNL   AGAERR20                 BRANCH IF NOT LESS THAN 100     47400021
         SPACE 2                                                        47700021
*THIS SECTION TESTS TO SEE THAT ALL ENTRIES IN THE STROKE ARRAY         48000021
*ARE WITHIN THE 1-128 RANGE SPECIFIED                                   48300021
*                                                                       48600021
         L     REGC,STROKE(PARM)       POINTER TO STROKE ARRAY          48900021
         ST    COUNT,WKCOUNT                                            49200021
         MH    COUNT,EIGHT+2            SET UP INDEX TO STROKE ARRAY    49500021
         S     COUNT,EIGHT              POSITION TO LAST DBL WORD PAIR  49800021
         AR    REGC,COUNT                                               50100021
AGASTR20 LM    RZERO,PARM,0(REGC)      LOAD X,Y COORDINATES             50400021
         C     RZERO,MEIGHT                                             50700021
         BL    AGAERR30                 BRANCH IF X LESS THAN -128      51000021
         C     RZERO,ONE28                                              51300021
         BH    AGAERR30                 BRANCH IF X GREATER THAN +128   51600021
         LTR   RZERO,RZERO                                              51900021
         BZ    AGAERR30                 BRANCH IF X COOR =0 -ERROR      52200021
         C     PARM,ONE                                                 52500021
         BL    AGAERR30                 BRANCH IF Y LESS THAN +1        52800021
         C     PARM,ONE28                                               53100021
         BH    AGAERR30                 BRANCH IF Y GREATER THAN +128   53400021
         S     REGC,EIGHT                                               53700021
         S     COUNT,EIGHT                                              54000021
         LTR   COUNT,COUNT                                              54300021
         BNL   AGASTR20                 BRANCH IF NOT FINISHED          54600021
         L     COUNT,WKCOUNT                                            54900021
         L     PARM,WKPARM             RESET PARM REG                   55000021
         EJECT                                                          55200021
*                                                                       55500021
*THIS SECTION CHECKS TO SEE IF THE STROKE TABLE IS IN CORE. IF IT IS    55800021
*NOT IN, IT WILL BE LOADED AND CHAINED TO THOSE ALREADY IN.             56100021
*                                                                       56400021
*SET UP LOOP TO CHECK                                                   56700021
*                                                                       57000021
         L     REGB,GSPSTRTB            LOAD ADDRESS OF STROKE TABLE    57300021
         SR    REGC,REGC                INITIALIZE REG TO CONTAIN PTR   57600021
AGATAB10 LTR   REGB,REGB                                                57900021
         BZ    AGATAB20                 BRANCH IF NO MORE TABLES        58200021
         C     REGA,ID(REGB)            CHECK FOR ID EQUAL              58500021
         BE    AGASTR10                 BRANCH IF STROKE TABLE FOUND    58800021
         LR    REGC,REGB                SAVE POINTER TO CURRENT TABLE   59100021
         L     REGB,NEXTAB(REGB)        PICK UP CHAIN ADDRESS           59400021
         B     AGATAB10                                                 59700021
*                                                                       60000021
*LOAD THE STROKE TABLE AND CHAIN IT TO OTHERS.                          60300021
*  TABLE CODE CONVERTED TO EBCIDIC                                      60600021
*                                                                       60900021
AGATAB20 MVC   WKNAME(8),FIXNAME        SET UP 'GSP     ' IN WORK AREA  61200021
         CVD   REGA,WKDBL               PACKED DECIMAL                  61500021
         UNPK  WKNAME+3(2),WKDBL+6(2)   STORE EBCIDIC NAME              61800021
         OI    WKNAME+4,SIGN                                            62100021
         XC    WKSPVSR(12),WKSPVSR      ZERO SUPV PARM LIST             62400021
         LOAD  EPLOC=WKNAME                                             62700021
         L     PARM,WKPARM              RESET PARAMETER REGISTER        63000021
         LR    REGB,RZERO               ADDR OF STROKE TAB IN REGB      63300021
         ST    REGA,ID(REGB)            PUT ID IN STROKE TABLE          63600021
         XC    NEXTAB(4,REGB),NEXTAB(REGB)  ZERO CHAIN FIELD            63900021
         LTR   REGC,REGC                                                64200021
         BZ    AGATAB30                 BRANCH IF FIRST STROKE TABLE    64500021
         ST    REGB,NEXTAB(REGC)        CHAIN STROKE TABLES             64800021
         B     AGASTR10                                                 65100021
*                                                                       65400021
*                                                                       65700021
*IF FIRST STROKE TABLE, ADDRESS IS ENTERED IN GSPCB                     66000021
*                                                                       66300021
AGATAB30 ST    REGB,GSPSTRTB                                            66600021
         EJECT                                                          66900021
*                                                                       67200021
*THIS SECTION INITIALIZES FOR CONVERTING STROKE ARRAY TO INTERNAL       67500021
*REPRESENTATION                                                         67800021
*REGB ON ENTRY CONTAINS THE STROKE TABLE ADDRESS                        68100021
*COUNT CONTAINS STROKE COUNT                                            68400021
AGASTR10 L     REGC,STROKE(PARM)        LOAD ADDRESS OF STROKE ARRAY    68700021
         L     REGA,SYMBOL(PARM)        PICK UP EBCDIC SYMBOL ADDRESS   69000021
         L     REGA,0(REGA)             SYMBOL                          69300021
         SLA   REGA,2                   MULTIPLY BY 4 FOR INDEXING      69600021
         L     REGB,STKADDR(REGA,REGB)  ADDRESS OF STROKES              69900021
         LA    REGA,SWITCH              SET UP WORK SWITCH              70200021
*                                                                     * 70500021
*REGB CONTAINS POINTER TO STROKES                                       70800021
         LTR   REGB,REGB                IF=0, NO SPACE ALLOCACATED FOR  71100021
*                                        UPDATING -ERROR IN SYMBOL      71400021
*                                                                       71700021
         BZ    AGAERR40                                                 72000021
*                                                                       72300021
*THIS SECTION CONDENSES AND STORES STROKES FROM THE STROKE ARRAY        72600021
*INTO THE STROKE TABLE.                                                 72900021
*REGB POINTS TO STROKE TABLE POSITION                                   73200021
*COUNT CONTAINS THE COUNT OF STROKES                                    73500021
*REGC  POINTS TO THE STROKE ARRAY                                       73800021
*REGA  CONTAINS SWITCH SETTER                                           74100021
*CONDENSED FROM= 1 BYTE PER STROKE                                      74400021
*        BIT 0 = 1 BEAM OFF                                             74700021
*              = 0 BEAM ON                                              75000021
*        BITS1-3   XCOORDINATE                                          75300021
*        BIT4  = 1 LAST STROKE                                          75600021
*              = 0 NOT LAST                                             75900021
*        BITS5-7   Y COORDINATE                                         76200021
*                                                                       76500021
AGASET10 LM    RZERO,PARM,0(REGC)       PICK UP X AND Y COORDINATES     76800021
         LTR   RZERO,RZERO                                              77100021
         BZ    AGAERR30                BRANCH IF X CORD 0 - ERROR       77400021
         BM    AGASET50                 BRANCH IF BEAM OFF              77700021
         S     RZERO,ONE                DECREMENT X BY ONE       A36606 77750021
AGASET20 SLA   RZERO,8                  SHIFT TO HIGH ORDER BYTE        78000021
         AR    RZERO,PARM               INSERT Y COORDINATE             78300021
         S     RZERO,ONE                DECREMENT Y BY ONE       A19165 78600021
         STH   RZERO,0(REGB)                                            78900021
         BCT   COUNT,AGASET60                                           79200021
         OI    1(REGB),SWITCH           SET SWITCH TO SHOW END          79500021
         SPACE 4                                                        79800021
AGARET10 L     SAVE,4(SAVE)                                             80100021
         RETURN (14,12),T                                               80400021
         SPACE 4                                                        80700021
AGASET50 LPR   RZERO,RZERO              MAKE REGISTER POSITIVE          81000021
         S     RZERO,ONE                DECREMENT X BY ONE       A19165 81050021
         OR    RZERO,REGA               SET SWITCH FOR BLANK STROKE     81300021
         B     AGASET20                                                 81600021
         SPACE                                                          81900021
*RESET POINTERS FOR LOOP                                                82200021
AGASET60 LA    REGB,2(REGB)             POINT TO NEXT STROKE TABLE      82500021
         LA    REGC,8(REGC)             POINT TO NEXT ENTRY IN STROKE   82800021
*                                       ARRAY                           83100021
         B     AGASET10                                                 83400021
         EJECT                                                          83700021
*ERRORS                                                                 84000021
*                                                                       84300021
AGAERR00 OI    0(ERRCD),PRM                                             84600021
         B     AGARET10                                                 84900021
*                                                                       85200021
AGAERR10 MVC   PARMERR(4,ERRCD),ONE     GDS INVALID                     85500021
         B     AGARET10                                                 85800021
*                                                                       86100021
AGAERR20 MVC   PARMERR(4,ERRCD),TWO     INVALID TABLE ID                86400021
         B     AGAERR00                                                 86700021
*                                                                       87000021
AGAERR30 MVC   PARMERR(4,ERRCD),THREE  INVALID VALUE IN ARRAY           87300021
         B     AGAERR00                                                 87600021
*                                                                       87900021
AGAERR40 MVC   PARMERR(4,ERRCD),FOUR    INVALID SYMBOL                  88200021
         B     AGAERR00                                                 88500021
*                                                                       88800021
AGAERR50 MVC   PARMERR(4,ERRCD),FIVE    INVALID STROKE COUNT            89100021
         B     AGAERR00                                                 89400021
         EJECT                                                          89700021
*CONSTANTS                                                              90000021
*                                                                       90300021
FIXNAME  DC    C'GSP     '                                              90600021
ONE      DC    F'1'                                                     90900021
TWO      DC    F'2'                                                     91200021
THREE    DC    F'3'                                                     91500021
FOUR     DC    F'4'                                                     91800021
FIVE     DC    F'5'                                                     92100021
EIGHT    DC    F'8'                                                     92400021
ONE28    DC    F'128'                                                   92700021
XLEVEN   DC    X'00000101'                                              93000021
MEIGHT   DC    F'-128'                                                  93300021
ONEH     DC    F'100'                                                   93600021
         SPACE 4                                                        93900021
WORKAREA DSECT                                                          94200021
WKPARM   DS    F                        ADDR OF PARAMETER LIST          94500021
WKRTNCD  DS    F                        ADDR OF RETURN ARRAY            94800021
WKSAVE   DS    18F                      SAVE AREA                       95100021
WKNAME   DS    D                        SPACE FOR STROKE TABLE NAME     95400021
WKDBL    DS    D                        DOUBLE WORD FOR CONVT TO DEC    95700021
WKCOUNT  DS    F                                                        96000021
WKSPVSR  DS    3F                       SUPV PARM LIST FOR LOAD         96300021
         COPY  GDSCB                                                    96600021
         COPY  GSPCB                                                    96900021
         COPY  GTMCB                                                    97200021
         END                                                            97500021
./  ADD  SSI=21290234,NAME=IFFAGA06
*TITLE         PLSTR- PLOT STROKES                                    * 00320021
*                                                                     * 00400021
*MODULE NAME   IFFAGA06                                               * 00480021
*                                                                     * 00560021
*FUNCTION/OPERATION                                                   * 00640021
*  TRANSLATES STROKE TABLE ENTRIES INTO CHARACTERS ON THE SCREEN,     * 00720021
*  OF A SIZE AND AT AN ORIENTATION DETERMINED BY THE PARAMETERS       * 00800021
*  PASSED. THE STROKE TABLE ENTRIES REFERENCED ARE GOVERNED BY THE    * 00880021
*  VALUE OF THE EBCDIC TEXT GIVEN AS INPUT.                           * 00960021
*                                                                     * 01040021
*ENTRY POINT   IFFAGA06 - CSECT NAME                                  * 01120021
*                                                                     * 01200021
*INPUT  REGISTER 1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA. THE FIRST* 01280021
*  WORD CONTAINS THE ADDRESS OF THE PARAMETER LIST ON A FULL WORD     * 01360021
*  BOUNDARY. THE NULL VARIABLE IS AT AN OFFSET OF 20 FROM THE RETURN  * 01440021
*  ARRAY, AND THE ADDRESS OF THE STATUS TABLE IS AT AN OFFSET OF 24   * 01520021
*  FROM THE RETURN ARRAY.                                             * 01600021
*FORMAT OF PARAMETER LIST                                             * 01680021
* REQUIRED PARAMETERS                                                 * 01760021
*                                                                     * 01840021
*  +0    A(VAR)          ADDRESS OF A VARIABLE WHICH CONTAINS THE     * 01920021
*                        GDSCB ADDRESS                                * 02000021
*  +4    A(TABLE ID)     ADDRESS OF AN INTEGER VALUE FROM 1-99 WHICH  * 02080021
*                        IDENTIFIES THE STROKE TABLE REFERENCED.      * 02160021
*  +8    A(TEXT)         ADDRESS OF AN ARRAY CONTAINING THE           * 02240021
*                        CHARACTERS TO BE GENERATED                   * 02320021
*  +12   A(COUNT)        ADDRESS OF THE COUNT OF THE NUMBER OF        * 02400021
*                        CHARACTERS TO BE GENERATED, THE COUNT IS     * 02480021
*                        POSITIVE IF THERE ARE14 CHARACTERS PER WORD  * 02560021
*                        IN THE TEXT ARRAY, AND NEGATIVE IS THERE     * 02640021
*                        IS 1 CHARACTER/PER WORD (RIGHT ALIGNED).     * 02720021
*  +16   A(HEIGHT)       ADDRESS OF HEIGHT IN INCHES OF THE CHARACTERS* 02800021
*                        (MINIMUM = 1/8 INCH)                         * 02880021
*  OPTIONAL PARAMETERS                                                * 02960021
*                                                                     * 03040021
*  +20   A(WIDTH)        ADDRESS OF WIDTH IN INCHES OF THE CHARACTERS.* 03120021
*                        (MINIMUM = 1/8 INCH)                         * 03200021
*  +24   A(SPACING)      ADDRESS OF SPACE IN INCHES FROM CENTER OF    * 03280021
*                        ONE CHARACTER TO CENTER OF NEXT.             * 03360021
*  +28   A(ORIENTATION)  ADDRESS OF A FOUR WORD ARRAY                 * 03440021
*                          WORD 1= SINE OF ANGLE OF ROTATION FROM     * 03520021
*                                  POSITIVE X AXIS OF CHARACTER.      * 03600021
*                          WORD 2= COSINE OF ANGLE OF ROTATION FROM   * 03680021
*                                  POSITIVE X AXIS OF CHARACTER       * 03760021
*                          WORD 3= SINE OF ANGLE OF ROTATION FROM     * 03840021
*                                  POSITIVE X AXIS OF CHARACTER STRING* 03920021
*                          WORD 4= COSINE OF ANGLE OF ROTATION FROM   * 04000021
*                                  POSITIVE X AXIS OF CHARACTER STRING* 04080021
*  +36   A(CORRVAL)      ADDRESS OF CORRELATION VALUE.                * 04160021
*                                                                     * 04240021
*  +40   A(KEY)          ADDRESS OF USER KEY VARIABLE.                * 04320021
*                                                                     * 04400021
*  +44   A(GENCODE)      ADDRESS OF THE CODE WHICH SPECIFIED THE TYPE * 04480021
*                        OF OUTPUT - EITHER INCLUDE,OMIT OR UPDATE    * 04560021
*  +48   A(X COR)        ADDRESS OF THE X VALUE TO WHICH THE BEAM IS  * 04640021
*                        TO BE POSITIONED.                            * 04720021
*  +52   A(Y COR)        ADDRESS OF THE Y VALUE TO WHICH THE BEAM IS  * 04800021
*                        TO BE POSITIONED.                            * 04880021
*                                                                     * 04960021
*NOTE: HEIGHT, WIDTH, SPACING, AND THE CONTENTS OF THE ORIENTATION    * 05040021
*      ARRAY ARE ALL REAL VALUES.                                     * 05120021
*                                                                     * 05200021
*OUTPUT  NONE TO CALLER. THE DATA WILL BE SCISSORED AND IF IT APPEARS * 05280021
*  ON THE SCREEN ORDERS WILL BE GENERATED FOR IT IN THE GDOA.         * 05360021
*                                                                     * 05440021
*EXTERNAL ROUTINES                                                    * 05520021
*  IFFAFA12 - RESET                                                     05600021
*  IFFAHA03    KEY TABLE MANAGEMENT                                   * 05680021
*  IFFAHA04    DATA GENERATION                                        * 05760021
*  IFFAHA05    DATA STORE                                             * 05840021
*  IFFAHA06    SCALE     TO SCALE X,Y PARAMETERS IF PASSED.           * 05920021
*  IFFAHA07    SCISSOR                                                * 06000021
*  IFFAHA13    GET GDOA'S FOR UPDATE                                  * 06080021
*  IFFAHA14    WRITE OUT UPDATE                                       * 06160021
*                                                                     * 06240021
*EXITS - NORMAL- BACK TO CALLER VIA REGISTER 14                       * 06320021
*        ERROR - BACK TO CALLER VIA REGISTER 14                       * 06400021
*  APPRORIATE CODES ARE SET IN THE RETURN ARRAY- SEE GSPARRAY         * 06480021
*NOTE: IF THE STROKE TABLE REFERENCED CANNOT BE LOCATED, AN ABEND     * 06560021
*      WILL BE CAUSED BY THE OPERATING SYSTEM                         * 06640021
*                                                                     * 06720021
*TABLES/WORKAREAS   - SEE WORKAREA DSECT                              * 06800021
*                                                                     * 06880021
*ATTRIBUTES         - REENTRANT, PROBLEM PROGRAM MODE                 * 06960021
*                                                                     * 07040021
*********************************************************************** 07120021
         EJECT                                                          07200021
IFFAGA06 CSECT                          PLSTR                           07280021
*A779700-779900,946100-946300                                    A29395 07290021
*A779904                                                         F40704 07292021
*C388800                                                         A30726 07294021
*0874,200800                                                       9326 07300021
*2239,379200-384800                                                000A 07320021
*D792200-792400                                                  YM1963 07330000
         SPACE 4                                                        07360021
*REGISTERS                                                              07440021
RZERO    EQU   0                                                        07520021
PARM     EQU   1                                                        07600021
REGA     EQU   2                                                        07680021
REGB     EQU   3                                                        07760021
ERRCD    EQU   4                                                        07840021
WORK     EQU   5                                                        07920021
GSPREG   EQU   6                                                        08000021
REGD     EQU   6                                                        08080021
GTMREG   EQU   7                                                        08160021
REGE     EQU   7                                                        08240021
GDSREG   EQU   8                                                        08320021
BASE     EQU   9                                                        08400021
REGC     EQU   10                                                       08480021
COUNT    EQU   11                                                       08560021
SAVE     EQU   13                                                       08640021
RETREG   EQU   14                                                       08720021
BRANCH   EQU   15                                                       08800021
FE       EQU   48                                                  000A 08820021
ETE      EQU   828                                                 000A 08840021
         SPACE 2                                                        08880021
FLT0     EQU   0                                                        08960021
FLT2     EQU   2                                                        09040021
FLT4     EQU   4                                                        09120021
FLT6     EQU   6                                                        09200021
         EJECT                                                          09280021
*PARAMETER LIST DISPLACEMENTS                                           09360021
*                                                                       09440021
GDS      EQU   0                        ADDR OF GDSCB VARIABLE          09520021
TAB      EQU   4                        ADDR OF TABLE IDENTIFIER        09600021
TEXT     EQU   8                        ADDRESS OF ARRAY                09680021
CT       EQU   12                                                       09760021
HGT      EQU   16                                                       09840021
*                                                                       09920021
*THE FOLLOWING ARE OPTIONAL PARAMETERS                                  10000021
*                                                                       10080021
WIDTH    EQU   20                       ADDR OF WIDTH OF CHAR           10160021
SPACING  EQU   24                                                       10240021
ORIENT   EQU   28                       ADDR OF ARRAY                   10320021
COR      EQU   32                       ADDR OF CORRVAL                 10400021
KEY      EQU   36                                                       10480021
GEN      EQU   40                                                       10560021
XCOR     EQU   44                                                       10640021
YCOR     EQU   48                                                       10720021
STOR     EQU   12                                                       10880021
PARMERR  EQU   16                                                       10960021
NULL     EQU   20                                                       11040021
NL       EQU   21                                                       11120021
CURRLOG  EQU   52                                                       11200021
STAT     EQU   24                                                       11280021
DGEN     EQU   840                                                      11360021
CVRT     EQU   924                                                      11440021
DSTORE   EQU   852                                                      11520021
SCISS    EQU   876                                                      11600021
SCALE    EQU   864                                                      11680021
CVTLINK  EQU   8                                                        11760021
ID       EQU   0                        DISPLACEMENTS FOR STROKE TABLE  11840021
NEXTAB   EQU   4                             *                          11920021
ADDR     EQU   8                             *                          12000021
         EJECT                                                          12080021
*SWITCHES                                                               12160021
REPONLY  EQU   X'02'                                                    12240021
OPT      EQU   X'04'                    OUTPUT MODE SWITCHES            12320021
INC      EQU   X'01'                         *                          12400021
ABSSW    EQU   X'03'                         *                          12480021
INCSW    EQU   X'02'                         *                          12560021
YABS     EQU   X'0A'                                                    12640021
XABS     EQU   X'A0'                                                    12720021
NOSCISS  EQU   X'10'                                                    12800021
LASTON   EQU   X'1F'                                                    12880021
NEG      EQU   X'80'                                                    12960021
BLANK    EQU   X'80'                                                    13040021
RESOL    EQU   X'02'                                                    13120021
BEAMON   EQU   X'08'                                                    13200021
NFNL     EQU   X'40'                                                    13280021
LASTT    EQU   X'C0'                                                    13360021
BOFF     EQU   X'F7'                                                    13440021
LASSTR   EQU   X'80'                                                    13520021
MULT     EQU   X'80'                                                    13600021
SWOFF    EQU   X'3F'                                                    13680021
OFF      EQU   X'00'                                                    13760021
XSIGN    EQU   X'F0'                                                    13840021
XFOUR    EQU   X'FC'                                                    13880021
*                                                                       13920021
PRM      EQU   X'08'                                                    14000021
LAST     EQU   X'80'                                                    14080021
IX       EQU   X'04'                                                    14160021
STRG     EQU   X'10'                                                    14240021
SCISSOR  EQU   X'40'                                                    14320021
LEVEL2   EQU   X'10'                                                    14400021
OMIT     EQU   X'FB'                                                    14480021
KEYED    EQU   X'20'                                                    14560021
CORRE    EQU   X'10'                                                    14640021
SUBR     EQU   X'02'                                                    14720021
INCLUDE  EQU   X'04'                                                    14800021
UPDATE   EQU   X'FF'                                                    14880021
MEMSUB   EQU   X'80'                                                    14960021
MEMSEQ   EQU   X'40'                                                    15040021
SEQ      EQU   X'04'                                                    15120021
XREALI   EQU   X'40'                                                    15200021
REALX    EQU   X'C0'                                                    15280021
REALY    EQU   X'0C'                                                    15360021
YREALI   EQU   X'04'                                                    15440021
XINTGI   EQU   X'10'                                                    15520021
YINTGI   EQU   X'01'                                                    15600021
POS      EQU   X'11'                                                    15680021
X        EQU   X'01'                                                    15760021
Y        EQU   X'10'                                                    15840021
*BRANCHING CONDITION                                                    15920021
PLUS     EQU   2                                                        16000021
ZORM     EQU   12                       BRANCH ON ZERO OR MINUS         16080021
         EJECT                                                          16160021
*                                                                       16240021
*THIS CODE ESTABLISHES ADDRESSABILITY FOR IFFAGA06, FOR THE GDSCB AND   16320021
*FOR THE WORKAREA. THE RETURN ARRAY IS SET TO ZERO, AND THE SAVE AREAS  16400021
*ARE CHAINED.                                                           16480021
*                                                                       16560021
         USING *,15                                                     16640021
         SAVE  (14,12)                                                  16720021
         DROP  15                                                       16800021
         LR    BASE,15                  LOAD CSECT BASE                 16880021
         USING IFFAGA06,BASE                                            16960021
         LR    WORK,PARM                LOAD WORKAREA BASE              17040021
         USING WORKAREA,WORK                                            17120021
         XC    WKSWITCH(4),WKSWITCH                                     17200021
         XC    WKSPVSR(12),WKSPVSR                                      17280021
         L     PARM,WKPARM              LOAD PARAMETER LIST ADDRESS     17360021
         L     ERRCD,WKRTNCD            LOAD ADDRESS OF RETURN ARRAY    17440021
         XC    0(20,ERRCD),0(ERRCD)     ZERO RETURN ARRAY               17520021
         L     GDSREG,GDS(PARM)        GET ADDR OF ARG 1                17650021
         L     GDSREG,0(GDSREG)         ADDRESS OF GDSCB                17680021
         USING GDSCB,GDSREG                                             17760021
         LA    REGA,WKSAVE              CHAIN SAVE AREAS                17840021
         ST    REGA,8(SAVE)                                             17920021
         ST    SAVE,4(REGA)                                             18000021
         LR    SAVE,REGA                REG 13 CONTAINS SAVE AREA ADDR  18080021
         EJECT                                                          18120021
*                                                                       18160021
*THE GDSCB PASSED IS CHECKED FOR VALIDITY, AND IF IT IS VALID, A        18240021
*SKELETON PARAMETER LIST FOR DATA GENERATION IS SET UP, WITH SWITCHES   18320021
*INITIALIZED TO MULTIPLE ENTRY, OUTPUT TYPE=VECTOR, STATUS=INCLUDE,     18400021
*OUTPUT=OPTIMIZED, FIRST ENTRY, NOT KEYED, NOT CORRVALLED, BEAM OFF.    18480021
*SWITCHES ARE SET IN THE KEY IF ELEMENT IS A SEQUENCE MEMBER AND/OR     18560021
*PART OF A BUFFER SUBROUTINE.                                           18640021
*                                                                       18720021
         C     GDSREG,GDSGDSCB                                          18800021
         BNE   AGAERR10                 BRANCH IF INVALID GDSCB         18880021
         MVC   WKSWITCH+2(1),GDSDATMD   SAVE DATA MODE SWITCH           18960021
         MVC   WKXLAST(8),GDSXLAST      SAVE X-Y LAST VALUE             19040021
         MVC   WKXCURR(4),GDSXCURR                                      19120021
         XC    WKADDR(68),WKADDR        ZERO PARAMETER FIELDS           19200021
         MVC   WKBITS,BITS              MOVE IN OPTION SWITCHES,        19280021
         ST    GDSREG,WKGDS             GDSCB ADDRESS, AND              19360021
         ST    ERRCD,WKRTN              RETURN ARRAY ADDRESS INTO       19440021
*                                       PARAMETER LIST                  19520021
         TM    GDSFLAGS,SUBR                                            19600021
         BZ    AGAREQ05                 BRANCH IF NOT GENERATING SUBR   19680021
         OI    WKBITS+3,MEMSUB          SET SWITCH IN KEY               19760021
         BAL   RETREG,AGASDM10                                          19840021
AGAREQ05 TM    GDSFLAGS,SEQ                                             19920021
         BZ    AGAREQ07                 BRANCH IF NOT PART OF SEQUENCE  20000021
         OI    WKBITS+3,MEMSEQ          SET SWITCH IN KEY          9326 20080021
         EJECT                                                          20160021
*                                                                       20240021
*REQUIRED PARAMETERS (TABLE, TEXT, COUNT AND HEIGHT ) ARE CHECKED       20320021
*FOR PRESENCE.                                                          20400021
AGAREQ07 TM    GDS(PARM),LAST                                           20480021
         BO    AGAERR00                 BRANCH IF REQ PARMS NOT PRESENT 20560021
         TM    TAB(PARM),LAST                                           20640021
         BO    AGAERR00                 BRANCH IF REQ PARMS NOT PRESENT 20720021
         TM    TEXT(PARM),LAST                                          20800021
         BO    AGAERR00                 BRANCH IF REQ PARMS NOT PRESENT 20880021
         TM    CT(PARM),LAST                                            20960021
         BO    AGAERR00                 BRANCH IF REQ PARMS NOT PRESENT 21040021
*                                                                       21120021
*CHECK FOR VALID TABLE IDENTIFIER                                       21200021
*                                                                       21280021
         CLC   NL(3,ERRCD),TAB+1(PARM)                                  21360021
         BE    AGAERR20                 BRANCH IF TAB NULL- ERROR       21440021
         L     REGA,TAB(PARM)                                           21520021
         L     REGA,0(REGA)             PICK UP TABLE IDENT             21600021
         LTR   REGA,REGA                                                21680021
         BC    ZORM,AGAERR20            BRANCH IF ZERO OR NEGATIVE      21760021
         C     REGA,ONEH                                                21840021
         BNL   AGAERR20                 BRANCH IF GREATER THAN 99       21920021
         ST    REGA,WKDBL               SAVE ID                         22000021
*                                                                       22080021
*                                                                       22160021
         CLC   NL(3,ERRCD),TEXT+1(PARM)                                 22240021
         BE    AGAERR30                 BRANCH IF TEXT ARRAY NULL-ERROR 22320021
*                                                                       22400021
*CHECK COUNT                                                            22480021
*                                                                       22560021
         CLC   NL(3,ERRCD),CT+1(PARM)                                   22640021
         BE    AGAERR40                 BRANCH IF COUNT NULL- ERROR     22720021
         L     COUNT,CT(PARM)                                           22800021
         L     COUNT,0(COUNT)           PICK UP CHARACTER COUNT         22880021
         LTR   COUNT,COUNT                                              22960021
         BZ    AGARET10                 RETURN IF COUNT ZERO            23040021
         BM    AGAREQ90                 BRANCH IF COUNT NEG= 1 CHAR     23120021
*                                        PER WORD IN TEXT ARRAY         23200021
*                                                                       23280021
*THIS SECTION CHECKS THE PARAMETERS HEIGHT, WIDTH, SPACING, AND         23360021
*ORIENTATION.  IF THEY ARE NOT ALL PRESENT, DEFAULT VALUES ARE          23440021
*INITIALIZED. THESE PARAMETERS ARE ALL REAL VALUES.                     23520021
*                                                                       23600021
AGAREQ10 CLC   NL(3,ERRCD),HGT+1(PARM)                                  23680021
         BE    AGAERR50                 BRANCH IF HEIGHT NULL-ERROR     23760021
         L     REGA,HGT(PARM)           ADDRESS OF HEIGHT               23840021
         LE    FLT4,0(REGA)             HEIGHT                          23920021
         CE    FLT4,EIGHTH              MINIMAL VALUE=1/8 INCH          24000021
         BL    AGAERR50                 BRANCH IF TOO SMALL-ERROR       24080021
         EJECT                                                          24120021
*                                                                       24160021
*FLOATING POINT REGISTER 4 CONTAINS THE HEIGHT IN INCHES                24240021
*CONVERT HEIGHT (IN INCHES) OF 8*8 MATRIX INTO DELTAY IN RASTER UNITS   24320021
*PER POINT.                                                             24400021
         LER   FLT2,FLT4                                                24480021
         ME    FLT2,RAST                MULTIPLY HGT(IN) BY 4096 AND    24560021
         DE    FLT2,INCH                 DIVIDE BY 96 TO GET DELTA Y    24640021
         STE   FLT2,WKHGT               SAVE DELTA Y / POINT ON MATRIC  24720021
         TM    HGT(PARM),LAST                                           24800021
         BO    AGAREQ80                 BRANCH IF NO MORE PARAMETERS    24880021
         CLC   NL(3,ERRCD),WIDTH+1(PARM)                                24960021
         BE    AGAREQ85                 BRANCH IF WIDTH NULL            25040021
         L     REGA,WIDTH(PARM)         ADDRESS OF WIDTH                25120021
*                                                                       25200021
*CONVERT WIDTH (IN INCHES) OF 8*8 MATRIX INTO DELTA X IN RASTER UNITS   25280021
*PER POINT                                                              25360021
*                                                                       25440021
         LE    FLT2,0(REGA)                                             25520021
         CE    FLT2,EIGHTH                                              25600021
         BL    AGAERR60                 BRANCH IF HGT LESS THAN 1/8 IN  25680021
AGAREQ20 ME    FLT2,RAST                MULTIPLY WIDTH(IN) BY 4096 AND  25760021
         DE    FLT2,INCH                 DIVIDE BY 96 TO GET DELTA X    25840021
         STE   FLT2,WKWIDTH             SAVE DELTA X / POINT ON MATRIC  25920021
         TM    WKSWITCH+3,LAST                                          26000021
         BO    AGAREQ75                 BRANCH IF NO PARMS              26080021
         TM    WIDTH(PARM),LAST                                         26160021
         BO    AGAREQ70                 BRANCH IF WIDTH=LAST PARM       26240021
         CLC   NL(3,ERRCD),SPACING+1(PARM)                              26320021
         BE    AGAREQ75                 BRANCH IF SPACING NULL          26400021
*                                                                       26480021
*CONVERT SPACING FROM CHARACTER CENTER TO CHARACTER CENTER (IN INCHES)  26560021
*INTO SPACING IN RASTER UNITS                                           26640021
         L     REGA,SPACING(PARM)       ADDRESS OF CHARACTER SPACING    26720021
         LE    FLT4,0(REGA)                                             26800021
AGAREQ30 ME    FLT4,RAST                MULTIPLY SPACING(IN) BY 4096    26880021
         DE    FLT4,ONE2                 AND DIVIDE BY 12 TO GET RUS    26960021
         STE   FLT4,WKSPACE             SAVE SPACING                    27040021
         EJECT                                                          27080021
*                                                                       27120021
*CHECK FOR ORIENTATION PARAMETERS PASSED                                27200021
*                                                                       27280021
         TM    WKSWITCH+3,LAST                                          27360021
         BO    AGAREQ65                 BRANCH IF REACHED END OF PARMS  27440021
         TM    SPACING(PARM),LAST                                       27520021
         BO    AGAREQ60                 BRANCH IF SPACING WAS LAST PARM 27600021
         LA    REGB,4                   SET UP LOOP FOR CHECKING ORIENT 27680021
         CLC   NL(3,ERRCD),ORIENT+1(PARM)                               27760021
         BE    AGAREQ65                 BRANCH IF ORIENTATION NULL      27840021
         L     REGA,ORIENT(PARM)        PICK UP ADDR OF ARRAY           27920021
AGAREQ40 LE    FLT2,0(REGA)                                             28000021
         CE    FLT2,ONEA                                                28080021
         BH    AGAERR80                 BRANCH IF TOO LARGE-ERROR       28160021
         CE    FLT2,ONEB                                                28240021
         BL    AGAERR80                 BRANCH IF TOO LOW-ERROR         28320021
         BCT   REGB,AGAREQ50                                            28400021
*                                                                       28480021
*IF ALL ARE CORRECT, MOVE INTO WORK AREA                                28560021
*                                                                       28640021
         L     REGA,ORIENT(PARM)                                        28720021
         MVC   WKSIN(16),0(REGA)                                        28800021
         B     AGAOPT10                                                 28880021
AGAREQ50 LA    REGA,4(REGA)             UPDATE POINTER AND              29040021
         B     AGAREQ40                                                 29120021
         EJECT                                                          29200021
*                                                                       29280021
*SET SINE AND COSINE VALUES FOR CHARACTER AND STRING DEFAULTS           29360021
AGAREQ60 OI    WKSWITCH+3,LAST          SET SWITCH- NO MORE PARMS       29440021
AGAREQ65 MVC   WKSIN(4),A0             CHARACTER ORIENTATION            29520021
         MVC   WKCOS(4),ONEA           *                                29600021
         MVC   WKSINS(4),A0            STRING ORIENTATION               29680021
         MVC   WKCOSS(4),ONEA          *                                29760021
         B     AGAOPT10                                                 29840021
         SPACE 2                                                        29920021
*SET SPACE EQUAL TO ONE AND ONE THIRD HEIGHT                            30000021
*                                                                       30080021
AGAREQ70 OI    WKSWITCH+3,LAST          SET SWITCH-NO MORE PARAMETERS   30160021
AGAREQ75 ME    FLT4,ONEONE3             SPACING DEFAULT=1-1/3 * HEIGHT  30240021
         B     AGAREQ30                                                 30320021
*                                                                       30400021
*                                                                       30480021
         SPACE 2                                                        30560021
*                                                                       30640021
*SET WIDTH = TWO-THIRDS HEIGHT                                          30720021
*                                                                       30800021
AGAREQ80 OI    WKSWITCH+3,LAST          SET SWITCH SHOWING NO MORE PARM 30880021
AGAREQ85 LER   FLT2,FLT4                                                30960021
         ME    FLT2,TWO3RD              WIDTH= 2/3 HEIGHT               31040021
         CE    FLT2,EIGHTH                                              31120021
         BNL   AGAREQ20                 BRANCH IF WIDTH AT LEAST 1/8 IN 31200021
         LE    FLT2,EIGHTH              SET HEIGHT TO 1/8 INCH          31280021
         B     AGAREQ20                                                 31360021
         SPACE 2                                                        31440021
AGAREQ90 OI    WKSWITCH+3,IX            SET SWITCH FOR 1 CHAR/WORD      31520021
         LPR   COUNT,COUNT              SET COUNT POSITIVE              31600021
         B     AGAREQ10                                                 31680021
         EJECT                                                          31760021
*                                                                       31840021
*WHEN THIS SECTION IS ENTERED THE REQUIRED PARAMETERS HAVE BEEN         31920021
*CHECKED AND THE NECESSARY DEFAULT CONDITIONS HAVE BEEN SET UP.         32000021
*                                                                       32080021
*TEST CORRVAL AND KEY FOR VALIDITY                                      32160021
*                                                                       32240021
AGAOPT10 TM    WKSWITCH+3,LAST                                          32320021
         BO    AGADAT10                 BRANCH IF PARM LIST ENDED       32400021
         TM    ORIENT(PARM),LAST                                        32480021
         BO    AGADAT10                 BRANCH IF ORIENT WAS LAST PARM  32560021
         CLC   NL(3,ERRCD),COR+1(PARM)                                  32640021
         BE    AGAOPT15                 BRANCH IF CORRVAL NOT PASSED    32720021
         TM    GDSFLAGS,LEVEL2                                          32800021
         BO    AGAOPT15                 BRANCH IF LEVEL 2 CORRVAL       32880021
         L     REGA,COR(PARM)           LOAD ADDRESS OF CORRVAL         32960021
         MVC   WKCORVL,0(REGA)          PLACE CORRVAL IN PARM LIST      33040021
         OI    WKBITS+2,CORRE           SET CORRVAL SWITCH IN PARM LIST 33120021
AGAOPT15 TM    COR(PARM),LAST                                           33200021
         BO    AGADAT10                 BRANCH IF NO MORE PARAMETERS    33280021
         CLC   NL(3,ERRCD),KEY+1(PARM)                                  33360021
         BE    AGAOPT20                 BRANCH IF KEY NOT PASSED        33440021
         MVC   WKKEY,KEY(PARM)          PLACE ADDRESS OF KEY IN PARM    33520021
*                                        LIST                           33600021
         TM    GDSFLAGS,LEVEL2                                          33680021
         BO    AGAOPT20                 BRANCH IF LEVEL 2 KEY           33760021
         OI    WKBITS+2,KEYED           OTHERWISE SET KEY SWITCH IN     33840021
*                                       PARM LIST                       33920021
AGAOPT20 TM    KEY(PARM),LAST                                           34000021
         BO    AGADAT10                 BRANCH IF NO MORE PARAMETERS    34080021
         CLC   NL(3,ERRCD),GEN+1(PARM)                                  34160021
         BE    AGAOPT25                 BRANCH IF GENCODE NOT PASSED    34240021
         EJECT                                                          34280021
*                                                                       34320021
*TEST FOR VALID GENCODE       CODE=1    STATUS 'INCLUDE'                34400021
*                             CODE=2    STATUS 'OMIT'                   34480021
*                             CODE=3    STATUS 'UPDAT'                  34560021
         L     REGA,GEN(PARM)           PICK UP CODE ADDRESS            34640021
         L     REGA,0(REGA)             PICK UP ACTUAL CODE             34720021
         C     REGA,ONE                                                 34800021
         BE    AGAOPT25                 BRANCH IF STATUS 'INCLUDE'      34880021
*                                       (SWT ALREADY SET IN PARM LIST)  34960021
         CLC   WKCORVL(8),ZERO          CHECK FOR CORRVAL AND/OR KEY    35040021
         BZ    AGAERR90                 BRANCH IF STATUS NOT INCLUDE    35120021
*                                        AND ELEMENT NOT KEYED OR       35200021
*                                        CORRVALLED--ERROR              35280021
         C     REGA,TWO                                                 35360021
         BNE   AGAOPT30                                                 35440021
         TM    GDSFLAGS,LEVEL2          BRANCH IF LEVEL 2 AND 'OMIT'    35520021
         BO    AGAERR90                                                 35600021
         NI    WKBITS,OMIT               STATUS SPECIFIED-ERROR         35680021
AGAOPT25 TM    WKBITS+2,CORRE                                           35760021
         BZ    AGAOPT55                 BRANCH IF NOT CORRELATED        35840021
         CLC   WKCORVL,ZERO                                             35920021
         BE    AGAERR95                 BRANCH IF CORRVAL=0 - ERROR     36000021
         B     AGAOPT55                                                 36080021
         EJECT                                                          36160021
*                                                                       36240021
*THIS SECTION IS ENTERED WHEN STATUS 'UPDATE'  IS SPECIFIED             36320021
*                                                                       36400021
AGAOPT30 C     REGA,THREE                                               36480021
         BNE   AGAERR90                 BRANCH IF NOT 'UPDATE'- ERROR   36560021
         TM    GDSFLAGS,SUBR                                            36640021
         BO    AGAERR00                 BRANCH IF UPDATE WHEN GENERAT-  36720021
*                                        ING SUBROUTINE- ERROR          36800021
         TM    GDSFLAGS,LEVEL2                                          36880021
         BO    AGAOPT45                 BRANCH IF LEVEL 2 TO SET KEY    36960021
         TM    WKBITS+2,KEYED                                           37040021
         BZ    AGAOPT50                 BRANCH IF ELEMENT NOT KEYED     37120021
*                                                                       37200021
*PREPARE PARAMETERS FOR KEY SEARCH                                      37280021
*                                                                       37360021
         L     REGA,KEY(PARM)           LOAD KEY ADDRESS                37440021
         ST    REGA,WKKADDR             AND PUT IN PARAMETER LIST       37520021
         LA    REGA,TWO                 CODE FOR SEARCH ON KEY          37600021
AGAOPT35 ST    REGA,WKCODE                                              37680021
         ST    GDSREG,WKGDS1            ADDRESS OF GDSCB                37760021
         LA    PARM,WKGDS1                                              37840021
         L     REGA,GDSGTMCB       GET POINTER TO GTMCB            000A 37940021
         L     REGA,4(REGA)        GET POINTER TO GSPCB            000A 38040021
         L     REGA,FE(REGA)       GET POINTER TO STATUS TABLE     000A 38140021
         L     BRANCH,ETE(REGA)    GET ADRS OF KEY TABLE MGMT      000A 38240021
         BALR  RETREG,BRANCH       BRANCH TO KEY TABLE MGMT        000A 38340021
*                                                                       38560021
         LTR   BRANCH,BRANCH            TEST RETURN CODE                38640021
         BNE   AGAERR00                 BRANCH IF INVALID KEY           38720021
         MVC   WKADDR,0(PARM)           MOVE KEY FIELDS INTO PARM LIST  38800021
         OC    WKBITS+3(1),7(PARM) CHECK KEY FOR SUBRTN STATUS   A30726 38940021
         BZ    AGAOPT36                 BRANCH IF NOT PART OF SUBROUT   38960021
         BAL   RETREG,AGASDM10                                          39040021
AGAOPT36 TM    4(PARM),INCLUDE                                          39120021
         BO    AGAOPT39                 BRANCH IF INCLUDE STATUS        39200021
         NI    WKBITS,OMIT              TURN OFF INCLUDE SWITCH         39280021
AGAOPT39 ST    PARM,WKSTORAD           SAVE KEY ADDR IN KEY TABLE       39380021
AGAOPT43 MVI   WKSWITCH,UPDATE          SET UPDATE SWITCH               39600021
         L     PARM,WKPARM              RESTORE PARM REGISTER           39680021
         B     AGAOPT55                                                 39760021
         EJECT                                                          39840021
*                                                                       39920021
*ENTERED WHEN UPDATE ON LEVEL 2 KEY                                     40000021
*                                                                       40080021
AGAOPT45 L     REGA,KEY(PARM)           LOAD KEY ADDRESS                40160021
         MVC   WKADDR,0(REGD)           PLACE KEY IN PARM LIST          40240021
         B     AGAOPT43                                                 40320021
*                                                                       40400021
AGAOPT50 CLC   WKCORVL,ZERO             BAD PARAMETER COMBINATION       40480021
         BE    AGAERR00                                                 40560021
*                                                                       40640021
*PREPARE FOR SEARCH ON CORRVAL                                          40720021
         LA    REGA,WKCORVL             LOAD CORRVAL ADDRESS            40800021
         ST    REGA,WKKADDR             AND PUT IN PARAMETER LIST       40880021
         LA    REGA,FIVE                CODE FOR SEARCH ON CORRVAL      40960021
         B     AGAOPT35                                                 41040021
         EJECT                                                          41120021
*                                                                       41200021
*THIS SECTION CHECKS FOR THE X AND Y PARAMETERS. AN ERROR RETURN IS     41280021
*MADE IF ONLY ONE OF THESE PARAMETERS IS PASSED                         41360021
*                                                                       41440021
AGAOPT55 TM    GEN(PARM),LAST                                           41520021
         BO    AGADAT10                 BRANCH IF NO MORE PARAMETERS    41600021
         CLC   NL(3,ERRCD),XCOR+1(PARM)                                 41680021
         BE    AGAOPT60                 BRANCH IF X NULL                41760021
         OI    WKSWITCH+1,X             SET SWITCH, X PRESENT           41840021
AGAOPT60 TM    XCOR(PARM),LAST                                          41920021
         BO    AGAOPT65                 BRANCH IF LAST                  42000021
         CLC   NL(3,ERRCD),YCOR+1(PARM)                                 42080021
         BE    AGAOPT65                 BRANCH IF Y NULL                42160021
         OI    WKSWITCH+1,Y             SET SWITCH, Y PRESENT           42240021
AGAOPT65 TM    WKSWITCH+1,POS                                           42320021
         BM    AGAERR00                 ERROR IF ONE COORD PASSED       42400021
         B     AGADAT10                                                 42480021
         EJECT                                                          42560021
*THIS SECTION LOADS THE STROKE TABLE AND SETS UP FOR THE ACTUAL         42640021
*GENERATION OF DATA.                                                    42720021
*                                                                       42800021
AGADAT10 L     REGA,WKDBL               PICK UP TABLE ID                42880021
         L     GTMREG,GDSGTMCB          PICK UP ADDRESS OF GTMCB        42960021
         USING GTMCB,GTMREG                                             43040021
         L     GSPREG,GTMGSPCB          PICK UP ADDRESS OF GSPCB        43120021
         DROP  GTMREG                                                   43200021
         USING GSPCB,GSPREG                                             43280021
         L     REGB,GSPSTRTB            LOAD ADDRESS OF STROKE TAB      43360021
*                                                                       43440021
*SET UP LOOP TO CHECK WHETHER STROKE TABLE LOADED                       43520021
*                                                                       43600021
         SR    REGC,REGC                INITIALIZE REG TO CONTAIN PTR   43680021
AGADAT20 LTR   REGB,REGB                                                43760021
         BZ    AGADAT80                 BRANCH IF NO MORE TABLES        43840021
         C     REGA,ID(REGB)            CHECK FOR ID EQUAL              43920021
         BE    AGAGEN10                 BRANCH IF STROKE TABLE FOUND    44000021
         LR    REGC,REGB                SAVE POINTER TO CURRENT TABLE   44080021
         L     REGB,NEXTAB(REGB)        PICK UP CHAIN ADDRESS           44160021
         B     AGADAT20                                                 44240021
*                                                                       44320021
*LOAD THE STROKE TABLE AND CHAIN IT TO OTHERS                           44400021
* TABLE CODE CONVERTED TO EBCDIC                                        44480021
*                                                                       44560021
AGADAT80 MVC   WKNAME(8),FIXNAME        SET UP 'GSP     ' IN WORK AREA  44640021
         CVD   REGA,WKDBL               PACKED DECIMAL                  44720021
         UNPK  WKNAME+3(2),WKDBL+6(2)   STORE EBCIDIC NAME              44800021
         OI    WKNAME+4,XSIGN                                           44880021
         LOAD  EPLOC=WKNAME                                             44960021
         LR    REGB,RZERO               ADDRESS OF STROKE TABLE         45040021
         ST    REGA,ID(REGB)            PUT ID IN STROKE TABLE          45120021
         XC    NEXTAB(4,REGB),NEXTAB(REGB) ZERO CHAIN FIELD             45200021
         LTR   REGC,REGC                                                45280021
         BZ    AGADAT90                                                 45360021
         ST    REGB,NEXTAB(REGC)        CHAIN STROKE TABLES             45440021
         B     AGAGEN10                                                 45520021
*                                                                       45600021
*IF FIRST STROKE TABLE, ADDRESS IS ENTERED IN GSPCB                     45680021
*                                                                       45760021
AGADAT90 ST    REGB,GSPSTRTB                                            45840021
         DROP  GSPREG                                                   45920021
         EJECT                                                          46000021
*AFTER ALL PARAMETERS ARE CHECKED, AND THE STROKE TABLE IS LOCATED,     46080021
*THE CONVERT RUUTINE IS LOADED,AND ITS ENTRY POINT ADDRESS IS PLACED    46160021
*IN THE STATUS TABLE. IF THE X AND Y COORDINATES HAVE BEEN PASSED,      46240021
*THEY ARE SCALED, AND A BLANKED LINE IS GENERATED.                      46320021
*                                                                       46400021
*                                                                       46480021
AGAGEN10 L     REGA,STAT(ERRCD)                                         46500021
         L     REGA,CVRT(REGA)         CHECK IF CNVT ALREADY LOADED     46520021
         LTR   REGA,REGA                                                46540021
         BNE   AGAGEN15                BRANCH IF ALREADY LOADED         46560021
         L     REGA,16                 CVT                              46580021
         L     REGA,CVTLINK(REGA)      LINK LIB DCB                     46640021
*        LOAD EP=IFFAHA15,DCB=(REGA)                                    46720021
         LOAD  EP=IFFAHA15                                              46800021
         L     REGA,STAT(ERRCD)                                         46880021
         ST    RZERO,CVRT(REGA)        STORE ENTRY POINT ADDREXS        46960021
*                                                                       47040021
AGAGEN15 TM    WKBITS+3,MEMSUB                                          47120021
         BO    AGAGEN70                 BRANCH IF PART OF BUFFER SUBR,  47200021
*                                        OUTPUT INCREMENAL              47280021
*TEST FOR OUTPUT DATA MODE                                              47360021
*                                                                       47440021
         TM    GDSCURMD,OPT                                             47520021
         BO    AGAGEN20                 BRANCH IF OPTIMIZED OUTPUT-     47600021
*                                        SWITCH ALREADY SET             47680021
         TM    GDSCURMD,INC                                             47760021
         BO    AGAGEN70                 BRANCH IF INCREMENTAL MODE      47840021
         XI    WKBITS,ABSSW             SET SWITCH TO ABSOLUTE          47920021
*                                                                       48000021
*                                                                       48080021
AGAGEN20 TM    WKBITS+3,MEMSUB                                          48160021
         BO    AGAGEN90                BRANCH IF BUFFER SUBR            48240021
AGAGEN22 CLI   WKSWITCH,UPDATE                                          48320021
         BE    AGAGEN75                 BRANCH IF UPDATE                48400021
         L     REGD,GDSAOACB            GET OACB ADDRESS                48480021
         L     REGD,CURRLOG(REGD)       GET LOGICAL START AND STORE     48560021
         STH   REGD,WKADDR+2              IN PARM LIST                  48640021
         EJECT                                                          48680021
*                                                                       48720021
*REG B CONTAINS POINTER TO STROKE TABLE                                 48800021
*REG COUNT CONTAINS COUNT OF NUMBER OF CHARACTERS                       48880021
*REG E IS INITIALIZED AS AN INDEX TO THE TEXT ARRAY AND                 48960021
*REGC IS INITIALIZED TO POINT TO THE FIRST SYMBOL IN THE TEXT ARRAY.    49040021
*                                                                       49120021
AGAGEN25 L     PARM,WKPARM              REINITIALIZE POINTER TO PARM    49200021
         L     REGC,TEXT(PARM)         PICK UP POINTER TO TEXT          49280021
         LA    REGB,ADDR(REGB)          POINTER TO FIRST ENTRY IN       49360021
*                                        STROKE TABLE                   49440021
         LA    REGE,1                   SET UP INDEX                    49520021
         TM    WKSWITCH+3,IX                                            49600021
         BZ     AGAGEN29                                                49680021
         LA    REGE,4                   SET INDEX TO 4                  49760021
         LA    REGC,3(REGC)             POINT TO FIRST CHARACTER        49840021
AGAGEN29 TM    WKSWITCH+1,POS                                           49920021
         BZ    AGAGEN65                BRANCH IF NO POSITIONING VECTOR  50000021
         L     REGA,XCOR(PARM)          PICK UP X COORDINATE            50080021
         L     REGA,0(REGA)                                             50160021
         TM    GDSDATMD,XABS                                            50240021
         BZ    AGAGEN80                 BRANCH IF X INCREMENTAL         50320021
         ST    REGA,WKXABS                                              50400021
AGAGEN30 L     REGA,YCOR(PARM)          PICK UP Y COORDINATE            50480021
         L     REGA,0(REGA)                                             50560021
         TM    GDSDATMD,YABS                                            50640021
         BZ    AGAGEN85                 BRANCH IF Y INCREMENTAL         50720021
         ST    REGA,WKYABS                                              50800021
         EJECT                                                          50840021
*                                                                       50880021
*CALL SCALE TO SCALE THE X AND Y COORDINATES                            50960021
*                                                                       51040021
AGAGEN35 LA    PARM,WKGDS                                               51120021
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         51200021
         L     BRANCH,SCALE(BRANCH)     ADDRESS OF SCALE                51280021
         BALR  RETREG,BRANCH                                            51360021
         LTR   BRANCH,BRANCH                                            51440021
         BNE   AGARES10                 BRANCH IF SCALE ERROR-RESET     51520021
         LA    PARM,WKXABS                                              51600021
         LA    REGA,WKYABS                                              51680021
         BAL   RETREG,AGAFLT10                                          51760021
         LA    RETREG,AGATXT30                                          51840021
         B     AGAGDO25                CO CALL SCISSOR AND DATA GEN     51920021
AGAGEN65 LA    PARM,GDSXLAST                                            52080021
         LA    REGA,GDSYLAST                                            52160021
         BAL   RETREG,AGAFLT10         CONVERT BEAM POS TO REAL NUM     52240021
         MVC   WKENTCT(4),ONE           INITIALIZE ENTRY COUNT          52280021
         B     AGATXT30                                                 52320021
AGAGEN70 XI    WKBITS,INCSW                                             52400021
         B     AGAGEN20                                                 52480021
         EJECT                                                          52520021
*                                                                       52560021
*GET GDOA'S FOR UPDATE                                                  52640021
*                                                                       52720021
AGAGEN75 L     REGD,16                  CVT                             52800021
         L     REGD,CVTLINK(REGD)       LINK LIB DCB                    52880021
         LA    PARM,WKADDR                                              52960021
*                                                                       53040021
*        LINK  EP=IFFAHA13,DCB=(REGD),MF=(E,(1)),SF=(E,WKSPVSR)         53120021
         LINK  EP=IFFAHA13,MF=(E,(1)),SF=(E,WKSPVSR)                    53200021
         LTR   BRANCH,BRANCH                                            53280021
         BNE   AGAERR97                                                 53360021
         B     AGAGEN25                                                 53440021
*                                                                       53520021
AGAGEN80 ST    REGA,WKXINCR                                             53600021
         B     AGAGEN30                                                 53680021
*                                                                       53760021
AGAGEN85 ST    REGA,WKYINCR                                             53840021
         B     AGAGEN35                                                 53920021
*                                                                       54000021
*SET GDSXLAST,GDSYLAST,GDSXCURR,AND GDSYCURR TO ZERO WHEN GENERATING    54080021
*OR UPDATING A BUFFER SUBROUTINE.                                       54160021
AGAGEN90 MVC   GDSXLAST(8),ZERO        SET CURRENT POSITION TO ZERO     54240021
         MVC   GDSXCURR(4),ZERO        BEAM POSITION TO ZERO            54320021
         B     AGAGEN22                                                 54400021
         EJECT                                                          54480021
*THIS SECTION IS ENTERED EACH TIME A SYMBOL IS TO BE GENERATED.         54560021
*THE SPACE TO THE NEXT CHARACTER IS COMPUTED AND SAVED.                 54640021
*  SPACE IN THE X DIRECTION= SPACE*COS THETA + CURRENT X                54720021
*  SPACE IN THE Y DIRECTION= SPACE*SIN THETA + CURRENT Y                54800021
*                                                                       54880021
AGATXT30 LE    FLT2,WKSPACE                                             54960021
         ME    FLT2,WKCOSS                                              55040021
         AE    FLT2,WKXNOW                                              55120021
         STE   FLT2,WKXNOW              X COR FOR NEXT CHAR             55200021
         LE    FLT2,WKSPACE                                             55280021
         ME    FLT2,WKSINS                                              55360021
         AE    FLT2,WKYNOW              Y COR FOR NEXT CHARACTER        55440021
         STE   FLT2,WKYNOW                                              55520021
*                                                                       55600021
*REG D IS INITIALIZED TO POINT TO THE STROKES. IF NO STROKES ARE        55680021
*DEFINED FOR THE SYMBOL, NO DATA IS GENERATED, AND THE NEXT             55760021
*SYMBOL IS PROCESSED.                                                   55840021
*                                                                       55920021
AGATXT35 SR    REGD,REGD                                                56000021
         IC    REGD,0(REGC)             PICK UP SYMBOL                  56080021
         SLA   REGD,2                   MULTIPLY BY 4 TO ALIGN TO WORD  56160021
         L     REGD,0(REGD,REGB)        PICK UP POINTER TO STROKES      56240021
         LTR   REGD,REGD                                                56320021
         BZ    AGAGOT40                                                 56400021
*                                                                       56480021
*FIRST STROKE DETERMINED FROM POINT 63,63 OF 128*128 MATRIX             56560021
*                                                                       56640021
         MVC   WKXLGRID(4),A3           INITIALIZE GRID POSITION        56720021
         MVC   WKYLGRID(4),A3                                           56800021
*                                                                       56880021
*                                                                       56960021
*THIS SECTION CONVERTS STROKE DEFINITIONS FROM THE STROKE TABLE INTO    57040021
*ACTUAL  X AND Y COORDINATES.                                           57120021
*STROKE TABLE FORMAT- 2 BYTES/STROKE                                    57200021
*                     BYTE 0- BIT0 = 1-BLANKED STROKE                   57280021
*                                  = 0-UNBLANKED STROKE                 57360021
*                             BITS 1-7= INTEGER FROM 0-127 INDICATING   57440021
*                                  X COORD ON 128*128 MATRIX            57520021
*                     BYTE 1- BIT0 = 1-LAST STROKE                      57600021
*                                  = 0-NOT LAST STROKE                  57680021
*                                                                       57760021
*REGISTER 0 AND 1 ARE USED AS WORK REGISTERS                            57840021
*                                                                       57920021
AGATXT37 LH    RZERO,0(REGD)                                            58000021
         TM    0(REGD),BLANK                                            58080021
         BO    AGATXT90                 BRANCH IF BLANKED STROKE        58160021
         OI    WKBITS+2,BEAMON                                          58240021
AGATXT45 N     RZERO,MASK               TURN OFF SWITCHES               58320021
         EJECT                                                          58360021
*                                                                       58400021
*CONVERT STROKES TO REAL VALUES                                         58480021
*                                                                       58560021
         MVC   CONCON2(4),CCON2                                         58600021
         STC   RZERO,CONCON2+1                                          58640021
         CLI   CONCON2+1,OFF                                            58720021
         BE    AGATXT48                 BRANCH IF ZERO                  58800021
         LE    FLT4,CONCON2                                             58880021
         AE    FLT4,ZERO                NORMALIZE FLOATING PT Y         58960021
AGATXT46 SRL   RZERO,8                  MOVE OUT Y COOR                 59040021
         STC   RZERO,CONCON2+1                                          59120021
         CLI   CONCON2+1,OFF                                            59200021
         BE    AGATXT49                                                 59280021
         LE    FLT0,CONCON2                                             59360021
         AE    FLT0,ZERO                                                59440021
AGATXT47 LER   FLT6,FLT4                                                59520021
         LER   FLT2,FLT0                SAVE COPY                       59600021
         SE    FLT2,WKXLGRID                                            59680021
         STE   FLT0,WKXLGRID           SAVE LAST POINT                  59760021
         ME    FLT2,WKWIDTH             GET CHANGE IN X IN RASTER UNITS 59840021
         SE    FLT4,WKYLGRID                                            59920021
         STE   FLT6,WKYLGRID                                            60000021
         ME    FLT4,WKHGT               GET CHANGE IN Y IN RASTER UNITS 60080021
         LER   FLT0,FLT2               X'S IN REGS 0 AND 2              60160021
         LER   FLT6,FLT4               Y'S IN REGS 4 AND 6              60240021
         EJECT                                                          60280021
*                                                                       60320021
*COMPUTE X INCREMENT IN RASTER UNITS, AND SAVE IT                       60480021
*                                                                       60560021
         ME    FLT4,WKSIN                                               60640021
         ME    FLT0,WKCOS                                               60720021
         SER   FLT0,FLT4                                                60800021
         STE   FLT0,WKXINCR                                             60880021
*                                                                       60960021
*COMPUTE Y INCREMENT IN RASTER UNITS, AND SAVE IT                       61040021
*                                                                       61120021
         ME    FLT6,WKCOS                                               61200021
         ME    FLT2,WKSIN                                               61280021
         AER   FLT2,FLT6                                                61360021
         STE   FLT2,WKYINCR                                             61440021
*                                                                       61520021
*CONVERT X AND Y INCREMENT FROM REAL TO INTEGER VALUES, AND COMPUTE     61600021
*THE ABSOLUTE BEAM POSITIONS.                                           61680021
*                                                                       61760021
         SR    REGA,REGA               SET UP LOOP CONTROL AND INDES    61840021
AGATXT50 L     PARM,WKXINCR(REGA)       PICK UP REAL VALUE              61920021
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         62000021
         L     BRANCH,CVRT(BRANCH)      ADDRESS OF CONVERT              62080021
         BALR  RETREG,BRANCH                                            62160021
         LTR   BRANCH,BRANCH            BRANCH IF CONVERSION ERROR      62240021
         BNE   AGARES10                                                 62320021
         ST    PARM,WKXINCR(REGA)      SAVE INTEGER INCREMENT           62400021
         A     PARM,GDSXLAST(REGA)     COMPUTE ABSOLUTE VALUE           62480021
         ST    PARM,WKXABS(REGA)       AND PUT IN PARAMETER LIST        62560021
         LTR   REGA,REGA                                                62640021
         BP    AGATXT65                 BRANCH IF X AND Y FINISHED      62720021
         LA    REGA,4                  SET UP NEW INDEX                 62800021
         B     AGATXT50                                                 62880021
         EJECT                                                          62920021
*                                                                       62960021
*CALL SCISSOR AND DATA GENERATOR TO ENTER DATA IN GDOA                  63040021
*                                                                       63120021
AGATXT65 BAL   RETREG,AGAGDO25                                          63200021
         TM    1(REGD),LASSTR                                           63280021
         BO    AGAGOT10                BRANCH IF LAST STROKE IN         63360021
*                                       SYMBOL JUST GENERATED.          63440021
         LA    REGD,2(REGD)             UPDATE POINTER TO NEXT STROKE   63520021
         B     AGATXT37                                                 63600021
*                                                                       63680021
*TURN OFF BEAM SWITCH FOR BLANKED LINE                                  63760021
*                                                                       63840021
AGATXT75 XI    WKBITS,MULT                                              63920021
         B     AGAGOT18                                                 64000021
*                                                                       64080021
AGATXT90 NI    WKBITS+2,BOFF            TURN OFF BEAM SWIT              64160021
         B     AGATXT45                                                 64240021
*                                                                       64320021
AGATXT48 LE    FLT4,ZERO                                                64400021
         B     AGATXT46                                                 64480021
*                                                                       64560021
AGATXT49 LE    FLT0,ZERO                                                64640021
         B     AGATXT47                                                 64720021
         EJECT                                                          64800021
*IF THE LAST STROKE IN A CHARACTER IS GENERATED, A BLANKED VECTOR       64880021
*IS GENERATED TO THE CENTER OF THE NEXT CHARACTER, AND THE CHARACTER    64960021
*COUNT IS DECREMENTED BY ONE. IF NO MORE SYMBOLS REMAIN TO BE           65040021
*GENERATED, THE KEY IS COMPLETED AND CONTROL IS RETURNED TO THE         65120021
*CALLING PROGRAM.                                                       65200021
*REGC CONTAINS A POINTER TO THE TEXT ARRAY                              65280021
*REGE CONTAINS THE INDEX TO THE TEXT ARRAY                              65360021
*                                                                       65440021
AGAGOT10 SR    REGA,REGA                                                65520021
AGAGOT15 L     PARM,WKXNOW(REGA)                                        65600021
         L     BRANCH,STAT(ERRCD)      ADDRESS OF STATUS TABLE          65680021
         L     BRANCH,CVRT(BRANCH)     ADDRESS OF CONVERT               65760021
         BALR  RETREG,BRANCH                                            65840021
         LTR   BRANCH,BRANCH                                            65920021
         BNE   AGARES10                BRANCH IF CONVERSION ERROR       66000021
         ST    PARM,WKXABS(REGA)       SAVE INTEGER VALUE               66080021
         S     PARM,GDSXLAST(REGA)     COMPUTE INCREMENT                66160021
         ST    PARM,WKXINCR(REGA)      AND PUT IN PARAMETER LIST        66240021
         LTR   REGA,REGA                                                66320021
         BP    AGAGOT17                BRANCH IF FINISHED               66400021
         LA    REGA,4                  SET UP NEW INDES                 66480021
         B     AGAGOT15                CONTINUE LOOP                    66560021
*                                                                       66640021
AGAGOT17 NI    WKBITS+2,BOFF           SET BEAM SWITCH OFF              66720021
         C     COUNT,ONE                                                66800021
         BNE   AGAGOT18                BRANCH IF NOT LAST               66880021
         TM    WKBITS+2,LASTT                                           66960021
         BZ    AGATXT75                 BRANCH IF NO DATA GENERATED YET 67040021
         OI    WKBITS+2,LASTT           SET LAST PASS SWITCH ON         67120021
*                                                                       67200021
AGAGOT18 BAL   RETREG,AGAGDO25         GO CALL SCISSOR AND DATA GEN     67280021
AGAGOT20 AR    REGC,REGE               UPDATE POINTER TO TEXT           67360021
         LA    REGD,1                                                   67380021
         A     REGD,WKENTCT                                             67400021
         ST    REGD,WKENTCT             UPDATE ENTRY COUNT              67420021
         BCT   COUNT,AGATXT30                                           67440021
         TM    WKBITS+2,LASTT                                           67520021
         BZ    AGAERR98                 NO DATA GENERATION              67600021
         BO    AGAGOT50                 LAST ENTRY SCISSORED            67680021
         CLI   WKSWITCH,UPDATE                                          67760021
         BE    AGACOM10                                                 67840021
         EJECT                                                          67880021
*                                                                       67920021
*PREPARE KEY                                                            68000021
         L     COUNT,GDSAOACB                                           68080021
         L     COUNT,CURRLOG(COUNT)     GET CURRENT LOGICAL ADDRESS     68160021
         SH    COUNT,WKADDR+2           COMPUTE ELEMENT LENGTH          68240021
         LTR   COUNT,COUNT                                              68320021
         BZ    AGAERR98                 ERROR IF NO DATA GENERATED      68400021
         STH   COUNT,WKADDR             PLACE LENGTH IN KEY             68480021
         L     COUNT,WKKEY                                              68560021
         LTR   COUNT,COUNT                                              68640021
         BZ    AGAEND10                 BRANCH IF NO USER VARIABLE      68720021
         MVC   0(4,COUNT),WKADDR        PLACE KEY IN USER VARIABLE      68800021
AGAEND10 TM    WKBITS+2,KEYED+CORRE                                     68804021
         BZ    AGARET10                 BRANCH IF NOT KEYED OR CORRE    68808021
*                                                                       68812021
*PREPARE LINK TO KEY MANAGEMENT TO ADD KEY                              68816021
*                                                                       68820021
         LA    REGA,ONE                 CODE FOR ADDING KET TO TABLE    68824021
         ST    REGA,WKCODE                                              68828021
         LA    REGA,WKADDR              KEY ADDRESS                     68832021
         ST    REGA,WKKADDR                                             68836021
         ST    GDSREG,WKGDS1            ADD OF GDSCB                    68840021
         LA    PARM,WKGDS1                                              68844021
         L     REGA,16                  CVT                             68848021
         L     REGA,CVTLINK(REGA)       LINK LIB DCB                    68852021
*        LINK  EP=IFFAHA03,DCB=(REGA),MF=(E,(1)),SF=(E,WKSPVSR)         68856021
         LINK  EP=IFFAHA03,MF=(E,(1)),SF=(E,WKSPVSR)                    68860021
         LTR   BRANCH,BRANCH                                            68864021
         BNE   AGAERR97                 BRANCH IF NOT ENOUGH STORAGE    68868021
         EJECT                                                          68872021
AGARET10 CLI   WKSWITCH,UPDATE                                          68876021
         BNE   AGARET20                 BRANCH IF NOT UPDATE            68880021
         TM    GDSFLAGS,LEVEL2                                          68884021
         BO    AGARET20                BRANCH IF LEVEL 2-NO KEY TABLE   68888021
         L     PARM,WKSTORAD                                            68892021
         MVC   4(4,PARM),WKBITS        MOVE IN NEW KEY SWITCHES         68896021
         TM    WKBITS+2,CORRE                                           68900021
         BZ    AGARET20                 BRANCH IF NOR CORRELATED        68904021
         MVC   8(4,PARM),WKCORVL        MOVE NEW CORRVAL INTO KEY       68908021
AGARET20 MVC   GDSDATMD(1),WKSWITCH+2   RESTORE DATA MODE SWITCH        68912021
         TM    WKBITS+3,MEMSUB                                          68916021
         BZ    AGARET30                BRANCH IF NOT SUBROUTINE         68920021
         MVC   GDSXLAST(8),WKXLAST     RESTORE REAM POINTERS            68924021
         MVC   GDSXCURR(4),WKXCURR                                      68928021
AGARET30 L     SAVE,4(SAVE)                                             68932021
         RETURN (14,12),T                                               68936021
         EJECT                                                          68940021
*                                                                       68960021
*THIS SECTION IS ENTERED WHEN A SYMBOL IS REFERENCED WHICH HAS NO       69040021
*STROKES DEFINING IT.                                                   69120021
*                                                                       69200021
AGAGOT40 C     COUNT,ONE                                                69280021
         BNE   AGAGOT55                 BRANCH IF NOT LAST CHARACTER    69360021
         TM    WKBITS+2,LASTT                                           69440021
         BZ    AGAERR98                 ERROR IF NO DATA GENERATED      69520021
         OI    WKBITS+2,LASTT           SET SWITCH SO MAKE LAST ENTRY   69600021
         B     AGAGOT20                                                 69680021
AGAGOT50 OI    WKBITS+2,REPONLY         SET FLAG TO GENERATE REPOS VECT 69760021
         XC    WKDATA1(32),WKDATA1                                      69840021
         MVC   WKXABS+2(2),GDSXCURR     PLACE CURRENT BEAM POSITION     69920021
         MVC   WKYABS+2(2),GDSYCURR     FROM GDS INTO PARAM LIST        70000021
         LA    COUNT,1                  RESET COUNT REG                 70080021
         LA    RETREG,AGAGOT20                                          70160021
         ST    RETREG,WKTEMP            SET RETURN ADDRESS              70240021
         B     AGAGDO40                 CALL DATA GENERATOR             70320021
*                                                                       70400021
AGAGOT55 AR    REGC,REGE               UPDATE POINTR                    70480021
         S     COUNT,ONE               DECREMENT COUNT                  70560021
         LA    REGD,1                                                   70580021
         A     REGD,WKENTCT                                             70600021
         ST    REGD,WKENTCT             UPDATE ENTRY COUNT              70620021
         B     AGATXT35                                                 70640021
         EJECT                                                          73360021
*                                                                       73410021
*CALL RESET IF ERROR IN CALL TO SCALE OR DATA GEN                       73440021
*                                                                       73490021
*                                                                       73520021
AGARES10 MVC   GDSXCURR(4),WKXCURR                                      73600021
         MVC   GDSXLAST(8),WKXLAST                                      73680021
         CLI   WKSWITCH,UPDATE                                          73760021
         BE    AGARET20                BRANCH IF UPDATE - RESET NOT     73840021
*                                       NECESSARY                       73920021
         MVC   WKDATA2(20),0(ERRCD)     SAVE RETURN ARRAY               74000021
         LA    REGA,GDSGDSCB            VAR HOLDING ADDRESS OF GDSCB    74080021
         ST    REGA,WKGDS                                               74160021
         LA    REGA,WKGDS               ADDRESS OF PARAMETER LIST       74240021
         ST    REGA,WKGDS1               STORED IN WORK AREA            74320021
         L     REGA,NULL(ERRCD)         NULL FOR CORRVAL IN PARM LIST   74400021
         ST    REGA,WKRTN                                               74480021
         LA    REGA,WKADDR              ADDRESS OF KEY IN PARM LIST     74560021
         ST    REGA,WKDATA1                                             74640021
         OI    WKDATA1,LAST             LAST PARM INDICATION            74720021
         ST    ERRCD,WKCODE             ERROR CODE IN PARM LIST         74800021
         LA    PARM,WKGDS1              ADDRESS OF WORK AREA            74880021
         L     REGA,16                                                  74960021
         L     REGA,CVTLINK(REGA)       LINK LIB DCB                    75040021
*        LINK  EP=IFFAFA12,DCB=(REGA),MF=(E,(1)),SF=(E,WKSPVSR)         75120021
         LINK  EP=IFFAFA12,MF=(E,(1)),SF=(E,WKSPVSR)                    75200021
         MVC   0(20,ERRCD),WKDATA2      RESTORE RETURN ARRAY            75280021
         B     AGARET20                                                 75360021
         EJECT                                                          75520021
*                                                                       75570021
*THIS ROUTINE CALLS SCISSOR (IF SCISSOR OPTION IS SET) AND DATA         75600021
*GENERATION, AND CHECKS THE RETURN CODES.                               75680021
*                                                                       75760021
*CALL SCISSOR IF SCISSOR OPTION SET                                     75840021
*                                                                       75920021
AGAGDO25 ST    RETREG,WKTEMP           SAVE RETURN ADDRESS              76000021
         TM    WKBITS+3,MEMSUB          TEST FOR BUFFER SUBROUTINE      76080021
         BO    AGAGDO85                BRANCH IF PART OF SUBROUTINE     76160021
         TM    GDSSCISS,NOSCISS                                         76240021
         BO    AGAGDO85                BRANCH IF NO SCISSORING          76320021
*                                                                       76400021
         LA    PARM,WKGDS                                               76480021
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         76560021
         L     BRANCH,SCISS(BRANCH)     ADDRESS OF SCISSOR              76640021
         BALR  RETREG,BRANCH                                            76720021
         LTR   BRANCH,BRANCH                                            76800021
         BZ    AGAGDO35                BRANCH IF SCISSOR RETURN OK      76880021
         C     BRANCH,FOUR                                              76960021
         BE    AGARES10                 BRANCH IF STOP GENERATION       77040021
         B     AGAGDO45                OTHERWISE SKIP CALL TO DATA GEN  77120021
AGAGDO35 TM    WKBITS+2,LASTT                                           77200021
         BZ    AGAGDO40                 ALWAYS GENERATE FIRST VECTOR    77280021
         CLC   WKXINCR(8),ZERO          IF NO MOVEMENT                  77360021
         BE    AGAGDO45                                                 77440021
         EJECT                                                          77480021
*                                                                       77520021
*CALL DATA GENERATOR                                                    77600021
*                                                                       77680021
AGAGDO40 LA PARM,WKADDR                                                 77760021
         L     BRANCH,STAT(ERRCD)                                       77840021
         L     BRANCH,DGEN(BRANCH)                                      77920021
         TM    WKBITS+2,LASTT     CK IF FIRST CALL TO DGEN       A29395 77970021
         BNZ   AGAGDO42             IF NO, USE LAST CALC POS     A29395 77980021
         MVC   WKXPREV(8),WKXLAST   IF YES, USE LAST BEAM POS    A29395 77990021
         OI    WKBITS+3,INC       SET ADJUST INCR FLAG           F40704 77990421
AGAGDO42 BALR  RETREG,BRANCH                                            78000021
         LTR   BRANCH,BRANCH                                            78080021
         BNE   AGARES10                BRANCH IF ERROR RETURN           78160021
         XC    WKDATA1(16),WKDATA1      ZERO DATA FIELDS                78240021
         NI    WKBITS+2,SWOFF           TURN SWITCHES OFF               78320021
         OI    WKBITS+2,NFNL           SET NOT FIRST,NOT LAST SW        78400021
AGAGDO45 L     RETREG,WKTEMP           LOAD RETURN ADDRESS              78480021
         BR    RETREG                  RETURN                           78560021
*                                                                       78640021
*                                                                       78720021
*BEAM POSITION SET IN GDSCB WHEN NO SCISSOR OPTION                      78800021
*                                                                       78880021
AGAGDO85 MVC   GDSXLAST,WKXABS         SET XLAST                        78960021
         L     PARM,WKXABS                                              78980021
         SH    PARM,GDSXCURR            RECOMPUTE INCREMENT AND PUT     79000021
         ST    PARM,WKXINCR              IN PARAMETER                   79020021
         MVC   GDSXCURR,WKXABS+2        *    XCURR                      79040021
         MVC   GDSYLAST,WKYABS          *    YLAST AND                  79120021
         L     PARM,WKYABS                                              79140021
         SH    PARM,GDSYCURR            RECOMPUTE INCREMENT AND PUT     79160021
         ST    PARM,WKYINCR              IN PARAMETER LIST              79180021
         MVC   GDSYCURR,WKYABS+2        *    YCURR IN GDSCB             79200021
         NI    GDSSCISS,LASTON                                          79280021
         B     AGAGDO40                                                 79360021
         EJECT                                                          79440021
*                                                                       79520021
*THIS ROUTINE CHECKS THE DATA MODE SWITCH IN THE GDSCB WHEN A           79600021
*SUBROUTINE IS BEING GENERATED OR UPDATED, AND ENSURES THAT             79680021
*THE INPUT MODE IS SET TO INCREMENTAL.                                  79760021
*                                                                       79840021
*                                                                       79920021
AGASDM10 MVI   GDSDATMD,X'00'           ZERO SWITCH AREA                80000021
         TM    WKSWITCH+2,REALX                                         80080021
         BZ    AGASDM30                 BRANCH IF X VALUE INTEGER       80160021
         OI    GDSDATMD,XREALI          SWT SWITCH FOR REAL, INCR X     80240021
AGASDM20 TM    WKSWITCH+2,REALY                                         80320021
         BZ    AGASDM40                 BRANCH IF Y VALUE INTEGER       80400021
         OI    GDSDATMD,YREALI          SWT SWITCH FOR REAL, INCR Y     80480021
         BR    RETREG                                                   80560021
*                                                                       80640021
AGASDM30 OI    GDSDATMD,XINTGI          SET SWITCH FOR INTEGER, INCR X  80720021
         B     AGASDM20                                                 80800021
*                                                                       80880021
AGASDM40 OI    GDSDATMD,YINTGI          SET SWITCH FOR INTEGER, INCR Y  80960021
         BR    RETREG                                                   81040021
         EJECT                                                          81120021
*THIS ROUTINE CONVERTS THE BEAM POSITION TO REAL VALUES AND             81200021
*STORES THEM IN THE WORK AREA.                                          81280021
*ADDRESS OF X IN REG PARM                                               81360021
*ADDRESS OF Y IN REG A                                                  81440021
*                                                                       81520021
AGAFLT10 SR    REGD,REGD               SET UP LOOP CONTROL AND INDES    81600021
AGAFLT15 MVC   WKDBL(4),CONCON         SET UP CONVERSION CONST          81680021
         CLC   0(4,PARM),ZERO                                           81760021
         BE    AGAFLT50                                                 81840021
         TM    0(PARM),NEG                                              81920021
         BO    AGAFLT40                 BRANCH IF NUMBER NEGATIVE       82000021
AGAFLT20 MVC   WKDBL+4(4),0(PARM)       NO, MOVE NUMBER INTO AREA       82080021
AGAFLT30 LD    FLT0,WKDBL               GET UNNORMALIZED NUMBER INTO    82160021
*                                        FLOATING POINT REGISTER        82240021
         AD    FLT0,ZERO               NORMALIZE                        82320021
AGAFLT35 STE   FLT0,WKXNOW(REGD)                                        82400021
         LTR   REGD,REGD                                                82480021
         BCR   PLUS,RETREG             RETURN IF FINISHED               82560021
*                                                                       82640021
         LR    PARM,REGA                                                82720021
         LA    REGD,4                  SET UP NEW INDEX                 82800021
         B     AGAFLT15                                                 82880021
AGAFLT40 OI    WKDBL,NEG                SET SIGN BIT IN CONVERSION AREA 82960021
         CLC   MAXNEG(4),0(PARM)                                        83040021
         BE    AGAFLT20                 IF MAX NEG #, TREAT AS POSIT.   83120021
         L     RZERO,0(PARM)            NO,GET MAGNITUDE OF NUMBER      83200021
         LPR   RZERO,RZERO                                              83280021
         ST    RZERO,WKDBL+4                                            83360021
         B     AGAFLT30                                                 83440021
AGAFLT50 LE    FLT0,A0                                                  83520021
         B     AGAFLT35                                                 83600021
*                                                                       83680021
         EJECT                                                          83760021
*WRITE OUT UPDATE                                                       83840021
AGACOM10 LA    PARM,WKADDR                                              83920021
         L     REGA,16                  CVT                             84000021
         L     REGA,CVTLINK(REGA)       LINK LIB DCB                    84080021
*        LINK  EP=IFFAHA14,DCB=(REGA),MF=(E,(1)),SF=(E,WKSPVSR)         84160021
         LINK  EP=IFFAHA14,MF=(E,(1)),SF=(E,WKSPVSR)                    84240021
         B     AGARET10                                                 84320021
*                                                                       84400021
         EJECT                                                          84480021
*ERRORS                                                                 84560021
AGAERR00 OI    0(ERRCD),PRM             PARAMETER ERROR                 84640021
         B     AGARET20                                                 84720021
*                                                                       84800021
AGAERR10 MVC   PARMERR(4,ERRCD),ONE     GDS INVALID                     84880021
         OI    0(ERRCD),PRM                                             84960021
         B     AGARET30                                                 85040021
*                                                                       85120021
AGAERR20 MVC   PARMERR(4,ERRCD),TWO     INVALID TABLE ID                85200021
         B     AGAERR00                                                 85280021
*                                                                       85360021
AGAERR30 MVC   PARMERR(4,ERRCD),THREE   INVALID TEXT ADDRESS            85440021
         B     AGAERR00                                                 85520021
*                                                                       85600021
AGAERR40 MVC   PARMERR(4,ERRCD),FOUR    INVALID COUNT                   85680021
         B     AGAERR00                                                 85760021
*                                                                       85840021
AGAERR50 MVC   PARMERR(4,ERRCD),FIVE    INVALID HEIGHT                  85920021
         B     AGAERR00                                                 86000021
*                                                                       86080021
AGAERR60 MVC   PARMERR(4,ERRCD),SIX     INVALID WIDTH                   86160021
         B     AGAERR00                                                 86240021
*                                                                       86320021
AGAERR80 MVC   PARMERR(4,ERRCD),EIGHT   INVALID ORIENTATION             86400021
         B     AGAERR00                                                 86480021
*                                                                       86560021
AGAERR90 MVC   PARMERR(4,ERRCD),ELEVEN  GENCODE ERROR                   86640021
         B     AGAERR00                                                 86720021
*                                                                       86800021
AGAERR95 MVC   PARMERR(4,ERRCD),NINE    CORRVAL ERROR                   86880021
         B     AGAERR00                                                 86960021
*                                                                       87040021
AGAERR97 OI    0(ERRCD),STRG            MAIN STORAGE EXCEEDED           87120021
         MVC   STOR(4,ERRCD),FOUR                                       87200021
         B     AGARES10                                                 87280021
AGAERR98 OI    0(ERRCD),SCISSOR         NO DATA GENERATION              87360021
*                                                                       87440021
         B     AGARES10                                                 87520021
         EJECT                                                          87600021
*CONSTANTS                                                              87680021
ONE      DC    F'1'                                                     87760021
TWO      DC    F'2'                                                     87840021
THREE    DC    F'3'                                                     87920021
FOUR     DC    F'4'                                                     88000021
FIVE     DC    F'5'                                                     88080021
SIX      DC    F'6'                                                     88160021
SEVEN    DC    F'7'                                                     88240021
EIGHT    DC    F'8'                                                     88320021
ZERO     DC    D'0'                                                     88400021
ONEB     DC    E'-1.0'                                                  88480021
BITS     DC    B'10000111'              MULTIPLE,VECTOR,INCLUDE,        88560021
         DC    X'00'                     OPTIMIZED,FIRST PASS,NO KEY,   88640021
         DC    B'00000000'               NO CORRVAL, BEAM OFF           88720021
         DC    X'00'                                                    88800021
ONEH     DC    F'100'                                                   88880021
MASK     DC    X'FFFF7F7F'                                              88960021
EIGHTH   DC    E'0.125'                                                 89040021
TWO3RD   DC    E'0.6666667'             2/3                             89120021
RAST     DC    E'4096.0'                                                89200021
INCH     DC    E'1536.0'                                                89280021
ONEONE3  DC    E'1.333333'                                              89360021
ONE2     DC    E'12.0'                                                  89440021
ELEVEN   DC    F'11'                                                    89520021
NINE     DC    F'9'                                                     89600021
CONCON   DC    XL4'4E000000'            CONVERSION CONSTANT             89680021
CCON2    DC    X'42000000'                                              89760021
MAXNEG   DC    XL4'80000000'            MAXIMUM NEGATIVE NUMBER         89840021
FIXNAME  DC    C'GSP     '                                              89920021
A0       DC    E'0.0'                                                   90000021
ONEA     DC    E'1.0'                                                   90080021
A3       DC    E'63.0'                                                  90160021
ZAP      DS    10F                  PATCH AREA                   F40704 90210021
         EJECT                                                          90240021
WORKAREA DSECT                                                          90320021
WKPARM   DS    F                                                        90400021
WKRTNCD  DS    F                                                        90480021
WKSAVE   DS    18F                                                      90560021
WKSPVSR  DS    3F                                                       90640021
WKXCURR  DS    H                                                        90720021
WKYCURR  DS    H                                                        90800021
WKXLAST  DS    F                                                        91010021
WKYLAST  DS    F                                                        91020021
WKXNOW   DS    F                                                        91040021
WKYNOW   DS    F                                                        91120021
WKSWITCH DS    F                                                        91200021
*SWITCH FORMAT                                                          91280021
*                                       BYTE 0 - X'FF' = UPDATE         91360021
*                                       BYTE 1 - X'10' = X COR PASSED   91440021
*                                                X'01' = Y COR PASSED   91520021
*                                       BYTE 2 - COPY OF GDSDATMD SW    91600021
*                                       BYTE 3 - X'04' = 1 CHAR/WORD    91680021
*                                                X'80' = LAST PARM HIT  91760021
WKSTORAD DS    F                                                        91840021
CONCON2  DS    F                                                        91880021
WKSIN    DS    F                                                        91920021
WKCOS    DS    F                                                        92000021
WKSINS   DS    F                                                        92080021
WKCOSS   DS    F                                                        92160021
WKSPACE  DS    F                                                        92240021
WKHGT    DS    F                                                        92320021
WKWIDTH  DS    F                                                        92400021
WKNAME   DS    D                                                        92480021
WKDBL    DS    D                                                        92560021
WKXLGRID DS    F                        LAST X ON 8*8 MATRIX            92640021
WKYLGRID DS    F                        LAST Y ON 8*8 MATRIX            92720021
WKTEMP   DS    F                                                        92800021
*                                                                       92880021
*PARAMETERS PASSED TO DATA GENERATION ROUTINE                           92960021
*                                                                       93040021
WKADDR   DS    F                        KEY                             93120021
WKBITS   DS    F                         *                              93200021
WKCORVL  DS    F                         *                              93280021
WKKEY    DS    F                        ADDR OF USER KEY VARIABLE       93360021
*                                                                       93440021
*PARAMETERS PASSED TO SCALE AND SCISSOR START HERE                      93520021
WKGDS    DS    F                        ADDRESS OF GDSCB                93600021
WKRTN    DS    F                        ADDRESS OF RETURN ARRAY         93680021
WKDATA1  DS    F                                                        93760021
WKDATA2  DS    F                                                        93840021
WKDATA3  DS    F                                                        93920021
WKDATA4  DS    F                                                        94000021
WKXABS   DS    F                                                        94080021
WKYABS   DS    F                                                        94160021
WKXINCR  DS    F                                                        94240021
WKYINCR  DS    F                                                        94320021
WKTOTX   DS    F                                                        94400021
WKTOTY   DS    F                                                        94480021
WKENTCT  DS    F                                                        94560021
WKXPREV  DS    F                  ADDED TO PLIST FOR DATA GEN    A29395 94610021
WKYPREV  DS    F                  ADDED TO PLIST FOR DATA GEN    A29395 94630021
*                                                                       94640021
*PARAMETERS PASSED TO KEY TABLE MANAGEMENT START HERE                   94720021
WKGDS1   DS    F                                                        94800021
WKCODE   DS    F                                                        94880021
WKKADDR  DS    F                                                        94960021
         COPY  GDSCB                                                    95040021
         COPY  GTMCB                                                    95120021
         COPY  GSPCB                                                    95200021
         END                                                            95280021
./  ADD  SSI=80330208,NAME=IFFAGA07
         TITLE 'IFFAGA07-ORDER GENERATION MODULE'           D11         00090000
*        ORGEN IS ENTERED FROM DIRECTOR PART 2 WITH THE                 00180000
*        ADDRESS OF A WORK AREA IN REGISTER 1. THE FIRST                00270000
*        WORD OF THE WORK AREA CONTAINS THE FOLLOWING PARAMETER LIST:   00360000
*                                                                       00450000
*        +0    A(GDSCBVAR)    GDSCB VAR                                 00540000
*        +4    A(ARRAY)       ARRAY OF ORDERS                           00630000
*        +8    A(COUNT)       LENGTH OF ARRAY                           00720000
*        OPTIONAL:                                                      00810000
*        +12   A(KEYLIST)     KEYS FOR MISSING ADDRESSES                00900000
*        +16   A(CORVAL)      CORRELATION VALUE                         00990000
*        +20   A(KEY)         KEY                                       01080000
*        +24   A(GENCODE)     GENCODE                                   01170000
*                                                                       01260000
*                                                                       01350000
*        EXTERNAL ROUTINES CALLED:                                      01440000
*                                                                       01530000
*        DATA STORE-IFFAHA05                                            01620000
*        UPDATE-IFFAHA13                                                01710000
*        KEY TABLE MANAGEMENT-IFFAHA03                                  01800000
*                                                                       01890000
*        EXTERNAL MACROS USED:                                          01980000
*                                                                       02070000
*        LINK                                                           02160000
*        FREEMAIN                                                       02250000
*                                                                       02340000
*                                                                       02430000
*        ON ENTRY REGISTERS ARE SAVED, WORKAREA DSECT IS INITIALIZED,   02520000
*        SAVE AREAS CHAINED, RETURN ARRAY SET TO ZERO, GDSCB INITIAL-   02610000
*        IZED.                                                          02700000
*                                                                       02790000
*        NOTE: THE KEYLIST KEYS ARE NOT CHECKED FOR VALIDITY IN         02880000
*        THE KEY TABLE.  THIS WILL ALLOW THE PROGRAMMER THAT KNOWS      02970000
*        WHAT HE IS DOING TO REFERENCE AN ELEMENT WITH A GSXY FOR       03060000
*        EXAMPLE NOT EXACTLY AT THE TOP BY CHANGING THE LOGICAL         03150000
*        ADDRESS.                                                       03240000
*                                                                       03330000
         EJECT                                                          03420000
IFFAGA07 CSECT                                                          03510000
*C820700                                                         A34801 03600000
* 511000                                                         A27472 03690000
* 797000                                                         A29394 03780000
*A294500,A480200-480800,A486500,A863500,A800200-800600       LD YA00806 03870000
*A184500,A189500,C364000,A633200-633300,A800800              LD YA00808 03960000
*A306200-306600,A800900                                      LD YA00815 04050000
* C510200                                                     LD YM5164 04140000
*A264500                                                        XA02055 04230000
*A184100-184200,C184500                                     D11 ZA05402 04320000
*A577200-577600,C578000                                     D11 ZA06414 04410000
*C510150                                                    D11 ZA13186 04500000
*C184700-188000,C488000,A488010-488020,A803300-803500       D11 ZA15418 04590000
*                                                                       04680000
ORGEN    SAVE  (14,12)                                                  04770000
         BALR  BASE,0              ESTABLISH BASE                       04860000
         USING *,BASE                                                   04950000
         LR    WORK,PARM                                                05040000
         USING WORKAREA,WORK       SET UP WORKAREA DSECT                05130000
         LA    REGA,WRKSAVE                                             05220000
         ST    REGA,8(SAVE)        CHAIN SAVE AREAS                     05310000
         ST    SAVE,4(REGA)                                             05400000
         LR    SAVE,REGA                                                05490000
         L     PARM,WRKPARM        PICK UP PARAMETER LIST               05580000
         L     ERRCD,WRKRTNCD      PICK UP RETURN ARRAY ADDR            05670000
         XC    0(20,ERRCD),0(ERRCD) ZERO RETURN ARRAY                   05760000
         L     RSTABADR,STAT(ERRCD)    SAVE STATUS TABLE ADDR      000B 05850000
         L     GDSREG,GDS(PARM)    GDS VAR                              05940000
         L     GDSREG,0(GDSREG)    GDSCB ADDR                           06030000
         USING GDSCB,GDSREG        GDSCB DSECT                          06120000
         C     GDSREG,GDSGDSCB     GDS VALID                            06210000
         BNE   ERR1                                                     06300000
         L     GTMREG,GDSGTMCB     ADDR OF GTMCB                        06390000
         USING GTMCB,GTMREG                                             06480000
         TM    GDS(PARM),LAST      LAST ONE                             06570000
         BO    ERRPRM              YES                                  06660000
         TM    ARRAY(PARM),LAST    LAST ONE                             06750000
         BO    ERRPRM              YES                                  06840000
*        THE   FIRST THREE PARAMETERS ARE CHECKED FOR PRESENCE          06930000
*        AND   VALIDITY                                                 07020000
         L     OACB,GDSAOACB                                            07110000
         USING OACBAREA,OACB                                            07200000
         TM    STATUS,NOBUF        MUST BUFFER BE OBTAINED & FLOW CTL   07290000
*                                  INITIALIZED?                         07380000
         BZ    ORG00050            NO                                   07470000
         ST    GDSREG,WRKGDS1                                           07560000
         ST    ERRCD,WRKCODE       CALL DATA STORE                      07650000
         XC    WRKKADDR,WRKKADDR   WITH NO FLAGS AND A                  07740000
         LA    PARM,WRKGDS1        LENGTH OF ZERO TO GET                07830000
         L     R15,DSTOR(RSTABADR)                                 000B 07920000
         BALR  RET,R15                                                  08010000
         LTR   R15,R15                                                  08100000
         BNE   ORG04600                                                 08190000
         L     PARM,WRKPARM        RESET REG                            08280000
         EJECT                                                          08370000
*                                                                       08460000
*        THE FOLLOWING AREAS ARE SET TO ZERO:                           08550000
*        SWITCHES                                                       08640000
*        KEYLIST PARAMETER LOCATION                                     08730000
*        THREE WORD KEY                                                 08820000
*        SUBROUTINE PARAMETER LIST                                      08910000
*        THE INITIAL KEY BIT SETTINGS ARE MOVED INTO THE KEY.           09000000
*        SEQUENCE AND SUBROUTINE MEMBER SWITCHES ARE SET IN THE KEY.    09090000
*                                                                       09180000
ORG00050 XC    WRKSW,WRKSW         ZERO SWITCHES                        09270000
         XC    WRKKYLST,WRKKYLST   ZERO KEYLIST PARM                    09360000
         XC    WRKADDR(16),WRKADDR ZERO 3 WD KEY & KEY ADDR             09450000
         XC    WRKARA(12),WRKARA   ZERO SUB PARM LIST                   09540000
         MVC   WRKBITS,BITS        MOVE IN INITIAL SETTINGS             09630000
         TM    GDSFLAGS,SEQ        PART OF A SEQ                        09720000
         BZ    ORG00060            NO                                   09810000
         OI    WRKBITS+3,MEMSEQ    SET SW IN KEY                        09900000
ORG00060 TM    GDSFLAGS,SUB        MEM OF SUBR                          09990000
         BZ    ORG00070            NO                                   10080000
         OI    WRKBITS+3,MEMSUB    SET SW IN KEY                        10170000
ORG00070 L     REGC,COUNT(PARM)                                         10260000
         L     REGC,0(REGC)                                             10350000
         ST    REGC,WRKCNT                                              10440000
*                                                                       10530000
*        THE OPTIONAL PARAMETERS, KEYLIST, CORVAL, KEY, AND GENCODE     10620000
*        ARE CHECKED.                                                   10710000
         TM    COUNT(PARM),LAST    ANY OPTIONAL PARMS                   10800000
         BO    ORG00700            NO                                   10890000
         CLC   NULL+1(3,ERRCD),KEYLST+1(PARM) IS KEYLIST NULL           10980000
         BE    ORG00100            YES                                  11070000
         MVC   WRKKYLST,KEYLST(PARM) PLACE KEY LIST IN PARM LIST        11160000
ORG00100 TM    KEYLST(PARM),LAST   IS THIS LAST                         11250000
         BO    ORG00700                                                 11340000
         CLC   NULL+1(3,ERRCD),CORVAL+1(PARM) IS CORVAL      NULL       11430000
         BE    ORG00200            YES                                  11520000
         TM    GDSFLAGS,LEVEL2                                          11610000
         BO    ORG00200                                                 11700000
         L     REGA,CORVAL(PARM)   PICK UP CORVAL                       11790000
         MVC   WRKCORVL,0(REGA)    SAVE CORVAL                          11880000
         OI    WRKBITS+2,CORRE     SET CORRELATED SW                    11970000
ORG00200 TM    CORVAL(PARM),LAST   ANY MORE                             12060000
         BO    ORG00700                                                 12150000
         CLC   NULL+1(3,ERRCD),KEY+1(PARM) IS KEY NULL                  12240000
         BE    ORG00300                                                 12330000
         MVC   WRKKEY,KEY(PARM)    SAVE KEY PARM                        12420000
         TM    GDSFLAGS,LEVEL2                                          12510000
         BO    ORG00300                                                 12600000
         OI    WRKBITS+2,KEYED     SET KEY SW                           12690000
ORG00300 TM    KEY(PARM),LAST      IS KEY LAST                          12780000
         BO    ORG00700            YES                                  12870000
         CLC   NULL+1(3,ERRCD),GENCDE+1(PARM) IS GENCODE NULL           12960000
         BE    ORG00700            YES                                  13050000
         L     REGA,GENCDE(PARM)   LOAD GENCODE VAR                     13140000
         L     REGA,0(REGA)        LOAD GENCODE VALUE                   13230000
         C     REGA,ONE            INCL                                 13320000
         BE    ORG00700            YES                                  13410000
         CLC   WRKCORVL(8),ZERO       KEYED OR CORRELATED               13500000
         BE    ERR3                NO-BAD GENCODE                       13590000
         C     REGA,TWO            OMIT                                 13680000
         BNE   ORG00400            NO                                   13770000
         TM    GDSFLAGS,LEVEL2     LEVEL 2                              13860000
         BO    ERR3                YES-INVALID                          13950000
         NI    WRKBITS,OMIT        SET OMIT SW                          14040000
         B     ORG00700                                                 14130000
         EJECT                                                          14220000
*                                                                       14310000
*        FOR AN UPDATE THE KEY OR CORVAL IS SEARCHED FOR IF LEVEL 1.    14400000
*        NOTE THAT IF THE ELEMENT IS AN UPDATE THE UPDATE GDOAS ARE     14490000
*        OBTAINED AND THEN THE INCLUDE/OMIT STRUCTURE IS PLACED IN      14580000
*        THE GDOA.  IF THE ELEMENT IS NOT UPDATE, THE INCLUDE/OMIT      14670000
*        STRUCTURE IS PLACED IN THE GDOA FIRST AND THEN THE UPDATE      14760000
*        MODULE IS CALLED FOR WORK AREA.                                14850000
*                                                                       14940000
ORG00400 C     REGA,THREE          UPDATE                               15030000
         BNE   ERR3                NO-INVALID GENCODE                   15120000
         OI    WRKSW,UPDT          SET UPDATE SWITCH                    15210000
         CLC   WRKKEY,ZERO         IS IT KEYED                          15300000
         BE    ORG00600            NO                                   15390000
         L     REGA,WRKKEY         PICK UP KEY VAR                      15480000
         MVC   WRKADDR,0(REGA)     PLACE IN KEY VARIABLE                15570000
         TM    GDSFLAGS,LEVEL2     LEVEL2                               15660000
         BO    ORG00800            YES, DO NOT SEARCH KEY TABLE         15750000
         ST    REGA,WRKKADDR       ADDR OF KEY VAR                      15840000
         ST    GDSREG,WRKGDS1      GDSCB                                15930000
         LA    REGA,TWO                                                 16020000
         ST    REGA,WRKCODE        CODE TO SEARCH ON KEY                16110000
ORG00500 LA    PARM,WRKGDS1                                             16200000
         L     R15,ETE(RSTABADR)       GET HA03 ADDR               000B 16290000
         BALR  RET,R15             BRANCH                          000A 16380000
*//                                                                     16470000
*//      SEARCH FOR KEY/CORVAL                                          16560000
*//                                                                     16650000
         LTR   R15,R15                                                  16740000
         BNE   ERRPRM                                                   16830000
         MVC   WRKADDR,0(PARM)                                          16920000
         ST    PARM,WRKKEY         SAVE ADDR OF KEY IN TABLE            17010000
         TM    4(PARM),INCL        INCLUDE                              17100000
         BO    ORG00800            YES                                  17190000
         NI    WRKBITS,OMIT        SET TO OMIT                          17280000
         B     ORG00800                                                 17370000
ORG00600 CLC   WRKCORVL,ZERO       IS CORVAL ZERO                       17460000
         BE    ERR4                YES                                  17550000
         LA    REGA,WRKCORVL       SET                                  17640000
         ST    REGA,WRKKADDR       UP PARM LIST                         17730000
         LA    REGA,FIVE           TO SEARCH                            17820000
         ST    REGA,WRKCODE        KEY TABLE FOR                        17910000
         ST    GDSREG,WRKGDS1      CORVAL                               18000000
         B     ORG00500                                                 18090000
         EJECT                                                          18180000
*                                                                       18270000
*        IF THIS IS NOT AN UPDATE A LENGTH MUST BE CALCULATED FOR       18360000
*        THE DATA GENERATION.                                           18450000
*                                                                       18540000
ORG00700 L     REGA,WRKCNT         PICK UP LENGTH OF DATA               18630000
         SRDA  REGA,32             PLACE IN ODD REGISTER                18720000
         LH    REGC,GDSGDOAL                                            18810000
         S     REGC,SIX            GDOA LENGTH MINUS SIX                18900000
         DR    REGA,REGC           GET A COUNT OF GDOAS                 18990000
         LA    REGB,1(REGB)        ADD ONE FOR ANY REMAINDER            19080000
         A     REGC,SIX                                                 19170000
         MR    REGA,REGC           LENGTH REQUESTED WILL BE MORE THAN   19260000
         STH   REGB,WRKADDR        ADEQUATE IN ALL CASES.               19350000
         TM    WRKBITS+2,KEYED+CORRE KEYED OR CORRELATED                19440000
         BZ    ORG00750            NO                                   19530000
         BAL   RET,ORGGTRU1        GO GET INCL/OMIT                     19620000
         LTR   R15,R15             SUCCESS                              19710000
         BNE   ORG04600            NO REUTNR                            19800000
ORG00750 L     REGA,GDSAOACB                                            19890000
         L     REGA,CURLOG(REGA)   PICK UP CURRENT LOG.                 19980000
         STH   REGA,WRKADDR+2      AND PLACE IN KEY                     20070000
ORG00800 ST    GDSREG,WRKGDS       GDSCB ADDR                           20160000
         ST    ERRCD,WRKRTN        RETURN ADDR                          20250000
         LA    PARM,WRKADDR                                             20340000
         TM    GDSFLAGS,LEVEL2     LVL2?                    D11 ZA05402 20430000
         BO    LINK13              YES,DONT SET ORGEN FLAGS D11 ZA05402 20520000
         MVI   ORGFLGS,X'FC'       SET ORGEN CALL FLAGS      LD YA00808 20610000
LINK13   L     R15,UPDH13(RSTABADR)  POINT TO UPDATE ADDR   E12 ZA29658 20700000
*              ONE LINE DELETED BY APAR---------------->    E12 ZA29658 20750000
         BALR  RET,R15             GOTO IFFAHA13            D11 ZA15418 20880000
* IFFAHA13 ACCESSED VIA GSP-TYPE LOAD FOR PERFORMANCE' SAKE D11 ZA15418 20970000
*//                                                                     21060000
         MVI   ORGFLGS,X'00'       TURN OFF ORGEN CALL FLAG  LD YA00808 21150000
         LTR   R15,R15             SUCCESS                              21240000
         BNE   ORG04600            ERROR-NO STORE OR SOMETHING          21330000
         TM    WRKSW,UPDT          UPDATE                               21420000
         BO    ORG00820            YES                                  21510000
         TM    WRKBITS+2,KEYED+CORRE KEYED OR CORRELATED                21600000
         BZ    ORG00840                                                 21690000
         LH    REGA,WRKADDR+2      CORRECT LOGICAL START                21780000
         S     REGA,FOUR           ADDR IN KEY TO BEFORE THE GTRU/GNOP  21870000
         STH   REGA,WRKADDR+2                                           21960000
         B     ORG00840                                                 22050000
         EJECT                                                          22140000
ORG00820 TM    GDSFLAGS,LEVEL2     LEVEL 2                              22230000
         BO    ORG00840            YES                                  22320000
         BAL   RET,ORGGTRU1        GO GENERATE INCL/OMIT STRUCTURE      22410000
         LTR   R15,R15             SUCCESS                              22500000
         BNE   ORG04600            NO REUTRN                            22590000
*                                                                       22680000
*        WE WILL NOW BEGIN MOVING THE DATA IN THE OUTPUT AREA           22770000
*        WE WILL CHANGE THE LOGICAL ADDRESSES TO ZERO-ON AND THEY       22860000
*        WILL BE USED IN COMBINATION WITH THE PHYSICAL BUFFER           22950000
*        ADDRESSES FOR RELOCATION.                                      23040000
ORG00840 MVC   WRKSTMD,GNOP2       SET MODE TO CONTROL                  23130000
         L     R15,ZERO            LOGICAL ADDRESS IS ZERO              23220000
         L     OACB,GDSAOACB                                            23310000
         USING OACBAREA,OACB                                            23400000
         L     PARM,WRKPARM                                             23490000
         L     REGA,ARRAY(PARM)    START OF ARRAY                       23580000
         L     REGB,WRKCNT         LENGTH OF ARRAY                      23670000
         L     REGC,OLP            ORDER LOAD POINT                     23760000
         L     REGD,LENLEFT        LENGTH LEFT                          23850000
         C     REGD,FOUR           ARE THERE AT LEAST 4 BYTES           23940000
         BNL   ORG00900            IN THE FIRST GDOA-YES                24030000
ORG00860 L     OACB,OTHER          GET NEXT                             24120000
         LTR   OACB,OACB           IS THERE ANOTHER                     24210000
         BZ    ERR6                NO                                   24300000
         L     REGD,LENLEFT        LENGTH LEFT                          24390000
         L     REGC,OLP            OLP                                  24480000
         MVC   0(2,REGC),WRKSTMD   SET SET MODE                         24570000
         A     REGC,TWO                                                 24660000
         ST    REGC,OLP            UPDATE TO BEYOND SET MODE            24750000
ORG00900 CR    REGB,REGD           WILL IT FIT IN THIS ONE              24840000
         BH    ORG01000            NO                                   24930000
         LR    REGD,REGB           SET LENGTH TO MOVE IN=LENGTH         25020000
ORG01000 C     REGD,F256           GR THAN 256                          25110000
         BH    ORG01500                                                 25200000
         BCTR  REGD,0                                                   25290000
         EX    REGD,MOVE1          MOVE IN DATA                         25380000
         LA    REGD,1(REGD)        RESET COUNT                          25470000
         AR    REGC,REGD           ADD TO OLP                           25560000
         AR    REGA,REGD           ADD TO ARRAY ADDR                    25650000
         SR    REGB,REGD           SUBTRACT FROM LENGTH                 25740000
         EJECT                                                          25830000
*                                                                       25920000
*        WE HAVE MOVED IN AS MUCH AS WE COULD. NOW WE MUST DETERMINE,   26010000
*        IF THERE IS MORE DATA TO BE MOVED IN, IF WE HAVE BROKEN ON     26100000
*        A PROPER BOUNDARY OR IF WE MUST MODIFY THE BREAK.              26190000
*                                                                       26280000
         ST    R15,LOGCURR         LOGICAL ADDRESS IS SET               26370000
         C     REGB,ZERO           HAS ALL THE DATA BEEN MOVED IN       26460000
         BE    ORG01800            YES                                  26550000
*                                                                       26640000
*        WE WILL INDEX THE GDOA  FORWARDS UNTIL WE FIND THE LAST SET    26730000
*        MODE.                                                          26820000
*                                                                       26910000
         L     PARM,OLP            ORDER LOAD PT                        27000000
         L     RET,LENLEFT         LENGTH LEFT                          27090000
         L     REGZERO,TWO         INCREMENT BY TWO                     27180000
ORG01100 BAL   ERRCD,ORGSTMD1      GO SEARCH FOR SET MODE               27270000
ORG01200 B     ORG01600            1ST RETURN PT                        27360000
         CLI   1(PARM),SAVEMODE    2ND RTN PT-MUST MODE BE SAVED        27450000
         BNH   ORG01400                                                 27540000
         MVC   WRKSTMD,GNOP2       SET MODE=CONTROL                     27630000
         CR    REGZERO,RET         WILL THIS ONE FIR                    27720000
         BH    ORG01600            NO                                   27810000
         LA    ERRCD,ORG01200      CONTINUE SCAN                        27900000
         L     REGZERO,TWO         INCREMENT BY TWO             XA02055 27990000
         B     ORGSTMDX                                                 28080000
ORG01300 LA    ERRCD,ORG01200      SET RETURN                           28170000
         B     ORGSTMD2            CONTINUE LOOP                        28260000
ORG01400 MVC   WRKSTMD,0(PARM)     SAVE SET MODE                        28350000
         LA    PARM,2(PARM)        UPDATE TO BEYOND THE SET MODE        28440000
         S     RET,TWO             REDUCE LENGTH BY TWO                 28530000
         B     ORG01300                                                 28620000
ORG01500 L     PARM,F256           MOVE IN 256                          28710000
         BCTR  PARM,0                                                   28800000
         EX    PARM,MOVE1                                               28890000
         S     REGD,F256           REDUCE LENGTH OF GDOA                28980000
         S     REGB,F256           REDUCE LENGTH OF ARRAY               29070000
         A     REGA,F256           ADD TO ARRAY ADDR                    29160000
         A     REGC,F256           ADD TO OLP                           29250000
         B     ORG01000            CONTINUE                             29340000
         EJECT                                                          29430000
ORG01600 A     R15,LENLEFT         UPDATE LOGICAL ADDRESS               29520000
         LTR   RET,RET             EVEN FIT                             29610000
         BE    ORG01700            YES                                  29700000
         SR    REGC,RET            BACK UP OLP                          29790000
         SR    REGA,RET            BACK UP ARRAY ADDR                   29880000
         AR    REGB,RET            ADD BACK TO LENGTH                   29970000
         SR    R15,RET             SUBTRACT FROM LOGICAL                30060000
ORG01700 ST    RET,LENLEFT         SET LENGTH LEFT                      30150000
*                                                                       30240000
ORG01800 ST    REGC,OLP            SAVE OLP                             30330000
         L     ERRCD,WRKRTNCD      RESET ERROR REGISTER                 30420000
         LTR   REGB,REGB           ARE WE DONE                          30510000
         BNE   ORG00860            NO.PROCEED                           30600000
         OI    STATUS,LASTGDOA     SET SW THAT THIS IS LAST ONE         30690000
         ST    OACB,WRKLSTOA       SAVE LAST OACB ADDRESS    LD YA00806 30780000
         L     OACB,GDSAOACB       LOAD FIRST OACB                      30870000
ORG01900 TM    STATUS,LASTGDOA     IS THIS LAST                         30960000
         BO    ORG02100            YES                                  31050000
         CLC   LENLEFT,ZERO        DOES THIS NEED TO BE FILLED OUT      31140000
         BE    ORG02000            NO                                   31230000
         L     REGD,LENLEFT        PICK UP LENGTH                       31320000
         BCTR  REGD,0                                                   31410000
         L     REGC,OLP                                                 31500000
         EX    REGD,ZEROOUT        ZERO THE END OUT                     31590000
         MVC   0(2,REGC),GNOP2     MOVE IN A NO-OP                      31680000
         A     REGC,LENLEFT                                             31770000
         ST    REGC,OLP            SET OLP TO POINT TO GTRU TO NEXT     31860000
         LA    REGD,RESET(REGD)    RESET LEN-LEFT REGISTER   LD YA00815 31950000
         S     REGD,TWO            UPDATE LENGTH LEFT...     LD YA00815 32040000
         ST    REGD,LENLEFT        AND STORE INOACB          LD YA00815 32130000
ORG02000 L     REGC,OLP                                                 32220000
         MVC   0(2,REGC),GTRU      MOVE IN GTRU                         32310000
         L     OACB,OTHER          GET NEXT                             32400000
         B     ORG01900                                                 32490000
         EJECT                                                          32580000
*                                                                       32670000
*        HERE WE WILL OBTAIN THE BUFFER NEEDED FOR THE ORGEN CALL       32760000
*        FOR EACH GDOA USED.  THE FIRST OF COURSE WILL GO INTO THE      32850000
*        CURRENT GDOA AND NO BUFFER IS NEEDED.  FOR UPDATE THIS         32940000
*        PORTION WILL BE BYPASSED.                                      33030000
*                                                                       33120000
ORG02100 TM    WRKSW,UPDT          IS THIS UPDATE                       33210000
         BO    ORG02300            YES, BUFFER ALREADY EXISTS           33300000
         MVC   WRKARA,THREE        CODE FOR MORE BUFFER                 33390000
         ST    GDSREG,WRKARA+4     GDSCB ADDR                           33480000
         LA    REGA,WRKARA                                              33570000
         ST    REGA,WRKGDS1        PARM LIST SET UP FOR                 33660000
         ST    ERRCD,WRKCODE       BUFFER MGT                           33750000
         L     OACB,ORIG           PICK UP ORIGINAL OACB                33840000
         L     REGA,BLP                                                 33930000
         A     REGA,OLP            COMPUTE PHYSICAL BUFFER ADDR         34020000
         S     REGA,CRSA           OF FIRST ONE                         34110000
         L     OACB,GDSAOACB       GO TO MY FIRST                       34200000
ORG02200 ST    REGA,BUFSTART       STORE IN START                       34290000
         ST    REGA,BLP            AND BUFFER LOAD PT                   34380000
         TM    STATUS,LASTGDOA     ANOTHER GDOA                         34470000
         BO    ORG02500            NO                                   34560000
         LA    PARM,WRKGDS1        POINT TO PARM LIST,RTN ARRAY, WKAREA 34650000
         L     R15,BMGT(RSTABADR)                                  000B 34740000
         BALR  RET,R15             CALL BUFFER MFT                      34830000
         LTR   R15,R15             SUCCESS                              34920000
         BNE   ERR7                NO                                   35010000
         LR    REGA,PARM           BUFFER ADDRESS                       35100000
         L     REGB,OLP                                                 35190000
         STH   REGA,2(REGB)        PLACE ADDR IN TRANS ORDER            35280000
         L     OACB,OTHER                                               35370000
         B     ORG02200                                                 35460000
ORG02300 L     OACB,GDSAOACB       OACB                                 35550000
ORG02400 L     REGB,OLP            ADDR OF TRANS TO NEXT                35640000
         TM    STATUS,LASTGDOA     IS THIS LAST                         35730000
         BO    ORG02500            YES                                  35820000
         L     OACB,OTHER          GET NEXT                             35910000
         MVC   2(2,REGB),BLP+2     MOVE BUFFER ADDR INTO PREV GTRU      36000000
         B     ORG02400            CONTINUE                             36090000
         EJECT                                                          36180000
*                                                                       36270000
*        THE GDOAS ARE SET UP. NOW THE ADDRESS MANIPULATION             36360000
*        WILL TAKE PLACE.                                               36450000
*                                                                       36540000
*                                                                       36630000
*        PLACE HERE.  FIRST OF ALL IS THE SIMPLE RELOCATION.  THE       36720000
*        ADDRESS PASSED IS RELATIVE TO THE ASSEMBLY OF THESE            36810000
*        ORDERS AT ZERO AND THEY WILL BE RELOCATED TO THE ACTUAL        36900000
*        PHYSICAL BUFFER ADDRESS.  THE OTHER CASE IS WHERE THE          36990000
*        ADDRESS FIELD CONTAINS X'FFFF' A KEY WILL BE REMOVED FROM      37080000
*        THE KEY LIST, COMPUTED INTO A PHYSICAL BUFFER ADDRESS AND      37170000
*        THAT ADDRESS WILL BE PLACED IN THE ORDER.                      37260000
*                                                                       37350000
ORG02500 L     REGA,WRKKYLST                                            37440000
         L     REGB,OLP            THE LENGTH OF THE LAST GDOA          37530000
         S     REGB,CRSA           IS COMPUTED. IT WILL BE USED TO      37620000
         ST    REGB,WRKLEN         INSURE THAT NO RELOCATION WILL       37710000
*                                  TAKE PLACE OUTSIDE THIS ORDER SET    37800000
         L     OACB,GDSAOACB       PICK UP OACB                         37890000
         L     REGZERO,BLP         FIRST BUFFER LOAD PT MODIFIED FOR    37980000
         S     REGZERO,TWO         THE TWO BYTE SET MODE WHICH OCCURS   38070000
         ST    REGZERO,BLP         IN ALL OTHER CASES SO THAT           38160000
*        RELOCATION WILL BE CORRECT IN ALL CASES.                       38250000
         L     REGZERO,TWO         LENGTH OF ORDER=2                    38340000
ORG02600 L     PARM,CRSA           CRSA- START POINT                    38430000
         L     RET,OLP                                                  38520000
         SR    RET,PARM            LENGTH OF DATA IN GDOA               38610000
         BAL   ERRCD,ORGSTMD0      GET ORDERS WITH ADDRS     LD YA00808 38700000
ORG02700 B     ORG02900            RETURN IF GDOA IS FINISHED           38790000
         CLI   1(PARM),TWO1        IS THIS AN ORDER WITH AN ADDRESS     38880000
         BH    ORG03000            YES                                  38970000
ORG02800 LA    ERRCD,ORG02700      NO-                                  39060000
         LA    PARM,2(PARM)        UPDATE BEYOND SET MODE               39150000
         S     RET,TWO             REDUCE LENGTH BY TWO                 39240000
         B     ORGSTMD2            KEEP GOING                           39330000
ORG02900 TM    STATUS,LASTGDOA     IS THIS ONE LAST                     39420000
         BO    ORG04400            YES                                  39510000
         L     OACB,OTHER          GET NEXT                             39600000
         B     ORG02600            CONTINUE SCAN                        39690000
ORG03000 CLC   2(2,PARM),KEYPASS   IS THIS A KEY ADDRESS                39780000
         BE    ORG03800            YES                                  39870000
*                                                                       39960000
         EJECT                                                          40050000
*        WE HAVE A SIMPLE(?) RELOCATION HERE                            40140000
*                                                                       40230000
         LR    REGC,OACB           SAVE THE OACB                        40320000
         L     OACB,GDSAOACB                                            40410000
ORG03100 TM    STATUS,LASTGDOA     IS THIS THE LAST ONE                 40500000
         BO    ORG03400            YES                                  40590000
         LR    REGB,OACB           SAVE THIS ONE                        40680000
         L     OACB,OTHER          GET NEXT                             40770000
         CLC   2(2,PARM),LOGCURR+2 IS THE ADDR IN THE PREVIOUS ONE      40860000
         BNL   ORG03100            NO                                   40950000
         LR    OACB,REGB           RESET OACB REGISTER                  41040000
         LH    REGD,2(PARM)                                             41130000
         S     REGD,LOGCURR        DISPLACEMENT INTO BUFFER             41220000
ORG03200 A     REGD,BLP            ADD BUFFER LOAD PT                   41310000
         A     REGD,TWO            SET MODE--POSITION BEYOND            41400000
         STH   REGD,2(PARM)        PLACE INTO ORDERS                    41490000
         TM    WRKSW,SCNDPASS      IS THIS THE SECOND PASS              41580000
         BO    ORG03500            YES WERE DONE                        41670000
         CLI   1(PARM),GMVA        IS THIS THE ONE WITH TWO ADDRESSES   41760000
         BE    ORG03600            YES                                  41850000
ORG03300 LR    OACB,REGC           RESET REGISTER                       41940000
ORG03350 LA    ERRCD,ORG02700      RETURN POINT                         42030000
         B     ORGSTMDX            CONTINUE                             42120000
ORG03400 LH    REGD,2(PARM)                                             42210000
         S     REGD,LOGCURR                                             42300000
         C     REGD,WRKLEN         IS THIS ADDR OUTSIDE THE GDOA        42390000
         BH    ERR8                ERRCD NOT SET--                      42480000
         B     ORG03200                                                 42570000
ORG03500 S     PARM,TWO            RESET PARM                           42660000
         XI    WRKSW,SCNDPASS      TURN OFF SECOND PASS SW              42750000
         B     ORG03300                                                 42840000
ORG03600 LR    OACB,REGC                                                42930000
ORG03700 LA    PARM,2(PARM)        POINT UP 2 BYTES                     43020000
         OI    WRKSW,SCNDPASS      SET SECOND PASS SW                   43110000
         B     ORG03000            PROCESS SECOND                       43200000
         EJECT                                                          43290000
*                                                                       43380000
*        A KEY WILL BE REMOVED FROM THE KEY LIST, CONVERTED TO A        43470000
*        PHYS BUFFER ADDR AND THE ADDR WILL BE PLACED IN THE ORDERS     43560000
*                                                                       43650000
ORG03800 LTR   REGA,REGA           KEYLIST PARM PASSED                  43740000
         BZ    ERR9                NO                                   43830000
         LH    REGC,2(REGA)        GET LOGICAL ADDR FROM KEY            43920000
         LA    REGA,4(REGA)        UPDATE TO NEXT KEY                   44010000
         SRDA  REGC,32             PLACE IN ODD REG                     44100000
         LH    REGB,GDSGDOAL                                            44190000
         S     REGB,SIX            DIVIDE BY GDOA-SIX                   44280000
         DR    REGC,REGB                                                44370000
         A     REGC,TWO            ADD TWO TO REMAINDER FOR SET MODE    44460000
         L     R15,GTMBCTBL        BUFFER CONTROL                       44550000
         SR    REGB,REGB                                                44640000
         ST    REGC,WRKDSP         SAVE DISPL                           44730000
         LH    REGC,GDSBCTEL       BCT DISP                             44820000
         MH    REGC,THREE+2                                             44910000
         CLC   GDSGDOAL,SUBSEG     IS THIS A SUBSEG                     45000000
         BE    ORG04000            YES                                  45090000
ORG03900 IC    REGB,2(REGC,R15)    PICK UP COUNT                        45180000
         CR    REGB,REGD           IN THIS ONE                          45270000
         BE    ORG04100            YES                                  45360000
         IC    REGB,1(REGC,R15)    GET PTR                              45450000
         MH    REGB,THREE+2                                             45540000
         CR    REGB,REGC           ANOTHER ON CHAIN                     45630000
         BE    ERR9                ERRCD NOT SET                        45720000
         LR    REGC,REGB           YES                                  45810000
         SR    REGB,REGB                                                45900000
         B     ORG03900                                                 45990000
ORG04000 LTR   REGD,REGD           COUNT ZERO                           46080000
         BNE   ERR9                NO KEY INVALID                       46170000
*                                                                       46260000
         AR    R15,REGC            ADD DISP TO TBL                      46350000
         LR    REGD,REGC                                                46440000
         M     REGC,F256           COMPUTE PHYS ADDR                    46530000
         D     REGC,THREE                                               46620000
         CLC   0(1,R15),GDSBCTID   IN FIRST HALF                        46710000
         BE    ORG04200            YES                                  46800000
         AH    REGD,SUBSEG         UPDATE ADDR TO SECOND                46890000
         B     ORG04200                                                 46980000
         EJECT                                                          47070000
ORG04100 LR    REGD,REGC           COMPUTE                              47160000
         M     REGC,F256           PHYS ADDR                            47250000
         D     REGC,THREE                                               47340000
ORG04200 A     REGD,WRKDSP         ADD DISP TO PHYS                     47430000
         STH   REGD,2(PARM)        STORE IN DATA                        47520000
         TM    WRKSW,SCNDPASS      SECOND PASS                          47610000
         BO    ORG04300            YES                                  47700000
         CLI   1(PARM),GMVA        IS THIS ONE WITH TWO ADDR            47790000
         BE    ORG03700            YES                                  47880000
         B     ORG03350            CONTINUE SCAN                        47970000
ORG04300 S     PARM,TWO            RESET PARM                           48060000
         XI    WRKSW,SCNDPASS      TURN OFF SW                          48150000
         B     ORG03350            CONTINUE SCAN                        48240000
         EJECT                                                          48330000
*                                                                       48420000
*        NOW EVERYTHING IS RELOCATED.  I WILL NOW SET UP THE ORIGINAL   48510000
*                                                                       48600000
*        OACB AND OVERFLOW,ETC                                          48690000
*                                                                       48780000
*                                                                       48870000
*        NOW THAT ALL DATA HAS BEEN RELOCATED IT MUST BE PLACED IN      48960000
*        THE ACTUAL GDOA OR WRITTEN OUT.  IF UPDATE THE UPDATE          49050000
*        MODULE WILL DO THIS FOR ME SO I WILL COMPLETE THE INCLUDE      49140000
*        OMIT STRUCTURE AND CALL UPDATE TO WRITE OUT THE GDOAS.         49230000
*                                                                       49320000
ORG04400 TM    WRKSW,UPDT          UPDATE                               49410000
         BZ    ORG04700            NO                                   49500000
         TM    GDSFLAGS,LEVEL2                                          49590000
         BO    ORG04450                                                 49680000
         L     OACB,GDSAOACB       SAVE PTR TO FIRST OACB    LD YA00806 49770000
         L     REGA,WRKLSTOA       GET LAST FOR ADDR RES     LD YA00806 49860000
         MVC   LOACPBF2(CPBF2,REGA),CPU2 MOVE TO LAST OACB   LD YA00806 49950000
         ST    REGA,GDSAOACB       STORE POINTER TO LAST     LD YA00806 50040000
         ST    GDSREG,WRKGDS1      CALL DATA STORE                      50130000
         MVC   WRKCODE,WRKRTNCD    TO RESOLVE INCLUDE/OMIT              50220000
         XC    WRKKADDR,WRKKADDR   ADDRESS                              50310000
         OI    WRKKADDR,RESOL                                           50400000
         LA    PARM,WRKGDS1       LOAD THE PARAMETER REG           6852 50490000
         L     R15,DSTOR(RSTABADR)                                 000B 50580000
         BALR  RET,R15                                                  50670000
         ST    OACB,GDSAOACB       RESTORE PTR TO 1ST OACB   LD YA00806 50760000
ORG04450 LA    PARM,WRKADDR                                             50850000
         L     R15,UPDH14(RSTABADR)  POINT TO UPDATE RTN    E12 ZA29658 50940000
*              ONE LINE DELETED BY APAR----------------->   E12 ZA29658 50990000
         BALR  RET,R15             GOTO IFFAHA14            D11 ZA15418 51120000
         TM    GDSFLAGS,LEVEL2                                          51210000
         BO    ORG04500            LEVEL 2-YES                          51300000
         L     REGA,WRKKEY                                              51390000
         MVC   0(8,REGA),WRKADDR   REPLACE KEY                          51480000
         TM    WRKBITS+2,CORRE     CORRELATED                           51570000
         BZ    ORG04500            NO                                   51660000
         L     REGA,WRKKEY                                              51750000
         MVC   8(4,REGA),WRKCORVL  REPLACE CORVAL                       51840000
ORG04500 MVI   GDSGRMOD,CNTL       SET CURRENT MODE TO CONTROL          51930000
ORG04600 L     SAVE,4(SAVE)                                             52020000
         RETURN (14,12),T          RETURN                               52110000
         EJECT                                                          52200000
*                                                                       52290000
*                                                                       52380000
*        IF THE DATA FITS ENTIRELY IN THE CURRENT GDOA WITHOUT          52470000
*        OVERFLOW IT IS PLACED THERE, POINTERS ARE UPDATED, AND         52560000
*        THE STORAGE OBTAINED IS FREED.  IF KEYED THE ROUTINE           52650000
*        COMPLETES THE INCLUDE OMIT STRUCTURE, ADDS THE KEY             52740000
*        TO THE KEY TABLE AND RETURNS TO THE CALLING ROUTINE.           52830000
*        IF NOT KEYED IT RETURNS AT THIS TIME.                          52920000
*                                                                       53010000
ORG04700 L     OACB,GDSAOACB       LOAD FIRST OACB                      53100000
         TM    STATUS,LASTGDOA     IS THIS FITTING IN THE GDOA          53190000
         BZ    ORG05000            NO                                   53280000
         L     REGA,CRSA           START ADDR                           53370000
         L     REGB,OLP                                                 53460000
         S     REGB,CRSA           LENGTH                               53550000
         L     OACB,ORIG           ORIGINAL                             53640000
         L     REGD,LENLEFT                                             53730000
         SR    REGD,REGB           UPDATE LENGTH LEFT                   53820000
         LTR   REGD,REGD           IS ANY ROOM LEFT IN GDOA      A27472 53910000
         BNL   ORG04750            IF YES,CONT STORE        D11 ZA13186 54000000
         LA    PARM,WRKGDS1          IF NO, GET MORE BUFFER      A27472 54090000
         ST    GDSREG,WRKGDS1          SET UP HA05 PLIST         A27472 54180000
         XC    WRKKADDR,WRKKADDR                                 A27472 54270000
         OI    WRKKADDR,BFOVRFL        SET BUFFER OVERFLOW FLAG  A27472 54360000
         L     REGD,GDSAOACB           KEEP ORGEN OACB CHAIN     A27472 54450000
         ST    OACB,GDSAOACB           RESTORE ORIG OACB         A27472 54540000
         L     R15,DSTOR(RSTABADR)                               A27472 54630000
         BALR  RET,R15                                           A27472 54720000
         LTR   R15,R15             WAS PROCESSING SUCCESSFUL     A27472 54810000
         BNZ   ERR6A                 IF NO, FREE CORE            A27472 54900000
         L     OACB,GDSAOACB         IF YES, GET NEW OACB ADDR   A27472 54990000
         ST    REGD,GDSAOACB                RESET UPDATE OACB    A27472 55080000
         L     REGD,LENLEFT                 CONTINUE STORING     A27472 55170000
         SR    REGD,REGB                                         A27472 55260000
ORG04750 ST    REGD,LENLEFT                                      A27472 55350000
         L     REGC,OLP                                          A27472 55440000
         LR    REGD,REGC                                                55530000
         AR    REGD,REGB           UPDATE OLP                           55620000
         ST    REGD,OLP                                                 55710000
         L     REGD,LOGCURR                                             55800000
         AR    REGD,REGB           UPDATE LOGICAL  CURRENT              55890000
         ST    REGD,LOGCURR                                             55980000
ORG04800 C     REGB,F256                                                56070000
         BH    ORG04900                                                 56160000
         BCTR  REGB,0                                                   56250000
         EX    REGB,MOVE1          MOVE ORDERS IN GDOA                  56340000
         L     REGD,GDSAOACB                                            56430000
         ST    OACB,GDSAOACB       RESET GDOA/OACB ADDR                 56520000
ORG04850 LR    OACB,REGD                                                56610000
         L     REGZERO,LENGTH                                           56700000
         L     PARM,FIRST                                               56790000
         FREEMAIN R,LV=(0),A=(1)   FREE STORAGE                         56880000
         L     OACB,GDSAOACB       WEE WILL CONPLETE THE KEY            56970000
         L     REGA,LOGCURR                                             57060000
         SH    REGA,WRKADDR+2      LENGTH FOR KEY                       57150000
         STH   REGA,WRKADDR        IN KEY                               57240000
         L     REGA,WRKKEY         KEY PARM                             57330000
         LTR   REGA,REGA           IS THER A KEY PARM                   57420000
         BZ    ORG04870            NO                                   57510000
         MVC   0(4,REGA),WRKADDR   MOVE KEY IN USER VARIABLE            57600000
         EJECT                                                          57690000
ORG04870 TM    WRKBITS+2,KEYED+CORRE KEYED OR CORRELATED                57780000
         BZ    ORG04500               NO                                57870000
         ST    GDSREG,WRKGDS1                                           57960000
         MVC   WRKCODE,WRKRTNCD                                         58050000
         XC    WRKKADDR,WRKKADDR   COMPLETE INCL/OMIT                   58140000
         MVI   WRKKADDR,RESOL                                           58230000
         LA    PARM,WRKGDS1        ADDR OF PARAMETER LIST               58320000
         L     R15,DSTOR(RSTABADR)                                 000B 58410000
         BALR  RET,R15                                                  58500000
         LA    REGA,ONE                 CODE TO ADD A KEY               58590000
         ST    REGA,WRKCODE             IN PARM LIST                    58680000
         ST    GDSREG,WRKGDS1                                           58770000
         LA    REGA,WRKADDR             ADDR OF KEY TO BE ADDED         58860000
         ST    REGA,WRKKADDR            IN PARM LIST                    58950000
         LA    PARM,WRKGDS1        ADDR OF PARM LIST                    59040000
         L     R15,ETE(RSTABADR)       GET HA03 ADDR               000C 59130000
         BALR  RET,R15                                             000C 59220000
         B     ORG04500                                                 59310000
         EJECT                                                          59400000
*                                                                       59490000
*        IF THE ORGEN GENERATION OVERFLOWS THE CURRENT GDOA             59580000
*        AS MUSH AS FITS IN AND DATA STORE IS CALLED                    59670000
*        TO OVERFLOW ONLY.  THIS IS DONE CONTINUALLY UNTIL THE          59760000
*        LAST GDOA ON THE ORGEN WORK CHAIN IS ENCOUNTERED.  THAT        59850000
*        ONE IS JUST MOVED INTO THE GDOA AND THE POINTERS ARE           59940000
*        UPDATED.  THEN THE STORAGE IS RELEASED, ETC.  JUST             60030000
*        AS FOR THE CASE WHERE THE DATA FIT IN THE FIRST GDOA.          60120000
*                                                                       60210000
ORG04900 L     REGD,F256                                                60300000
         SR    REGB,REGD           REDUCE LENGTH                        60390000
         BCTR  REGD,0                                                   60480000
         EX    REGD,MOVE1                                               60570000
         A     REGA,F256           UPDATE                               60660000
         A     REGC,F256           MOVE ADDRESSES                       60750000
         B     ORG04800                                                 60840000
ORG05000 ST    GDSREG,WRKGDS1                                           60930000
         MVC   WRKCODE,WRKRTNCD    SET UP PARM LIST FOR                 61020000
         XC    WRKKADDR,WRKKADDR   DATA STORE TO OVERFLOW ONLY          61110000
         OI    WRKKADDR,OVERFLOW                                        61200000
         L     OACB,GDSAOACB       MY OACBS                             61290000
         L     REGA,CRSA           CRSA                                 61380000
         L     REGB,BUFLEN         LENGTH                               61470000
         LR    REGD,OACB           SAVE MY OACBS                        61560000
         L     OACB,ORIG           PICK UP ORIGINAL                     61650000
         ST    OACB,GDSAOACB       RESET PTR                            61740000
ORG05100 L     REGC,LOGCURR        UPDATE                               61830000
         A     REGC,LENLEFT        LOGICAL CURRENT                      61920000
         ST    REGC,LOGCURR                                             62010000
ORG05150 L     REGC,OLP                                                 62100000
ORG05200 C     REGB,F256           WILL IT REQUIRE MULTIPLE MOVES       62190000
         BH    ORG05300            YES                                  62280000
         BCTR  REGB,0                                                   62370000
         C     REGA,4(REGD)        CRSA=START OF GDOA?      D11 ZA06414 62460000
         BNE   ORG05225            NO,BR                    D11 ZA06414 62550000
         LA    REGB,6(REGB)        ADD SIX TO MOVED LEN     D11 ZA06414 62640000
ORG05225 EX    REGB,MOVE1          MOVE DATA IN             D11 ZA06414 62730000
         TM    WRKSW,LSTONE                                             62820000
         BO    ORG05500                                                 62910000
         LA    PARM,WRKGDS1                                             63000000
         L     R15,DSTOR(RSTABADR)                                 000B 63090000
         BALR  RET,R15             GO OVERFLOW                          63180000
         LR    OACB,REGD           GET NEXT ON MY CHAIN                 63270000
         L     OACB,OTHER                                               63360000
         LR    REGD,OACB                                                63450000
         TM    STATUS,LASTGDOA     LAST                                 63540000
         BO    ORG05400            YES                                  63630000
         EJECT                                                          63720000
ORG05250 L     REGC,BUFSTART       GET BUFFER ADDR                      63810000
         L     REGB,BUFLEN                                              63900000
         L     REGA,CRSA           AND START LOCATION                   63990000
         L     R15,OLP             ORDER LOAD PT IF THIS LAST           64080000
         L     OACB,GDSAOACB       REGULAR OACB                         64170000
         ST    REGC,BUFSTART       PUT BUFFER ADDR IN                   64260000
         ST    REGC,BLP                                                 64350000
         TM    WRKSW,LSTONE                                             64440000
         BO    ORG05500                                                 64530000
         B     ORG05100            KEEP GOING                           64620000
ORG05300 L     R15,F256                                                 64710000
         BCTR  R15,0               MOVE IN 256                          64800000
         EX    R15,MOVE1                                                64890000
         S     REGB,F256           AND UPDATE LENGTH                    64980000
         A     REGA,F256           AND                                  65070000
         A     REGC,F256           PTRS                                 65160000
         B     ORG05200                                                 65250000
ORG05400 OI    WRKSW,LSTONE        SET LAST ONE SW                      65340000
         B     ORG05250                                                 65430000
ORG05500 SR    R15,REGA            COMPUTE LENGTH                       65520000
         LR    REGB,R15            PLACE IN ANOTHER REGISTER            65610000
         L     REGC,OLP            OBTAIN OLP                           65700000
ORG05600 C     R15,F256            WILL ONE MOVE DO IT                  65790000
         BH    ORG05700            NO                                   65880000
         BCTR  R15,0               SHORTEN LENGTH                       65970000
         EX    R15,MOVE1           MOVE DATA IN                         66060000
         L     REGC,OLP            LOAD ORDER LOAD OLP                  66150000
         AR    REGC,REGB                                                66240000
         ST    REGC,OLP            UPDATE OLP                           66330000
         L     REGA,LOGCURR        LOAICAL CURRENT ADDRESS              66420000
         S     REGB,TWO                                                 66510000
         AR    REGA,REGB           UPDATE LOGICAL CURRENT               66600000
         ST    REGA,LOGCURR                                             66690000
         L     REGA,LENLEFT                                             66780000
         SR    REGA,REGB           UPDATE LENGTH LEFT                   66870000
         ST    REGA,LENLEFT                                             66960000
         B     ORG04850                                                 67050000
ORG05700 L     RET,F256            LENGTH OF MOVE                       67140000
         BCTR  RET,0               REDUCE BY ONE FOR EXECUTE            67230000
         EX    RET,MOVE1           MOVE PART OF IT IN                   67320000
         S     R15,F256            REDUCE LENGTH                        67410000
         A     REGA,F256           ADD TO CRSA IN MY GDOA/OACB          67500000
         A     REGC,F256           ADD TO OLP IN GDS OACB/GDOA          67590000
         B     ORG05600            KEEP GOING                           67680000
ORGSTMD0 LTR   RET,RET             CHECK FOR ZERO LGH        LD YA00808 67770000
         BCR   BZ,ERRCD            IF YES, RETURN SINCE...   LD YA00808 67860000
*                                  ...NO CHECK QS NEEDED     LD YA00808 67950000
         EJECT                                                          68040000
ORGSTMD1 CLI   0(PARM),STMD        IS THIS A SET MODE                   68130000
         BE    ORGSTMD3            YES                                  68220000
ORGSTMDX AR    PARM,REGZERO        ADD INCREMENT TO ORDER LOAD POINT    68310000
         SR    RET,REGZERO         SUBTRACT INCREMENT FROM LENGTH TO GO 68400000
ORGSTMD2 CR    REGZERO,RET         ROOM FOR ANOTHER                     68490000
         BNH   ORGSTMD1            YES                                  68580000
         BR    ERRCD               NO RETURN TO FIRST EXIT POINT        68670000
ORGSTMD3 L     REGZERO,FOUR        SET LENGTH TO FOUR                   68760000
         LA    ERRCD,4(ERRCD)      SET RETURN REGISTER TO SCND EXIT     68850000
*                                                                       68940000
*        THIS SEQUENCE WILL DETERMINE THE LENGTH OF THE ORDER AND       69030000
*        PLACE THAT LENGTH IN REGZERO. PARM WILL POINT TO THE ORDER     69120000
*        ON RETURN.                                                     69210000
*                                                                       69300000
         CLI   1(PARM),FOUR1       FOUR BYTE ABS MODE INSTR             69390000
         BCR   BNH,ERRCD           YES                                  69480000
         L     REGZERO,TWO         SET TO TWO BYTE                      69570000
         CLI   1(PARM),TWO1        TWO BYTE ORDER                       69660000
         BCR   BNH,ERRCD           YES                                  69750000
         L     REGZERO,FOUR        SET TO FOUR BYTE                     69840000
         CLI   1(PARM),FOUR2       GSXY OR GNOP4                        69930000
         BCR   BNH,ERRCD           YES                                  70020000
         L     REGZERO,SIX         SET TO SIX BYTE                      70110000
         CLI   1(PARM),SIX1        GMVD,GMVA                            70200000
         BCR   BNH,ERRCD           YES                                  70290000
         L     REGZERO,FOUR        SET TO FOUR BYTE                     70380000
         BR    ERRCD               GTDD,GTND,GTRU                       70470000
         EJECT                                                          70560000
ORGGTRU1 TM    WRKBITS,INCL        INCLUDE                              70650000
         BZ    ORGGTRU2            NO                                   70740000
         LA    REGA,GNOP4          ADDR OF GNOP                         70830000
         B     ORGGTRU3                                                 70920000
ORGGTRU2 LA    REGA,GTRU           ADDR OF GTRU                         71010000
ORGGTRU3 ST    GDSREG,WRKGDS1                                           71100000
         ST    ERRCD,WRKCODE                                            71190000
         MVC   WRKKADDR,FOUR       LENGTH OF FOUR                       71280000
         OI    WRKKADDR,CONTUNRE                                        71370000
         MVC   WRKOUTPT,0(REGA)                                         71460000
         LA    PARM,WRKGDS1                                             71550000
         L     R15,DSTOR(RSTABADR)                                 000B 71640000
         BR    R15                                                      71730000
*                                                                       71820000
*        THE INCLUDE OMIT STRUCTURE WILL BE PUT OUT BY DATA             71910000
*        STORE BEFORE THE STORAGE ALLOCATION IN THE CASE OF A           72000000
*        REGULAR CALL AND AFTER THE STORAGE ALLOCATION IN THE           72090000
*        CASE OF AN UPDATE CALL. THE SUBROUTINE USES REGA, AND          72180000
*        R15. IT IS CALLED WITH THE RETURN ADDRESS IN REG14             72270000
*        AND DATA STORE WILL RETURN CONTROL TO THAT POINT.              72360000
*                                                                       72450000
         EJECT                                                          72540000
ERR1     MVC   PRMER(4,ERRCD),ONE  GDSCB                                72630000
ERRPRM   OI    0(ERRCD),PRM                                             72720000
         B     ORG04600                                                 72810000
ERR3     MVC   PRMER(4,ERRCD),SEVEN GENCODE                             72900000
         B     ERRPRM                                                   72990000
ERR4     MVC   PRMER(4,ERRCD),FIVE CORVAL                               73080000
         B     ERRPRM                                                   73170000
ERR5     MVC   STRG(4,ERRCD),FOUR  MAIN STORAGE                         73260000
ERR5A    OI    0(ERRCD),ST                                              73350000
         B     ORG04600                                                 73440000
ERR6     TM    WRKSW,UPDT          UPDATE OVERFLOW                      73530000
         BO    ERR6A               YES                                  73620000
ERR6A    MVC   STRG(4,ERRCD),ONE   UPDATE OVERFLOW                      73710000
         OI    0(ERRCD),ST                                              73800000
ERR6B    L     OACB,GDSAOACB                                            73890000
         L     REGZERO,LENGTH                                           73980000
         L     PARM,FIRST                                               74070000
         L     OACB,ORIG                                                74160000
         ST    OACB,GDSAOACB       RESET OACB                           74250000
         FREEMAIN R,LV=(0),A=(1)   DO FREEMAIN                          74340000
         B     ORG04600                                                 74430000
         EJECT                                                          74520000
ERR7     MVC   STRG(4,ERRCD),THREE NO BUFFER                            74610000
         OI    0(ERRCD),ST                                              74700000
ERR7A    L     OACB,GDSAOACB                                            74790000
         L     OACB,ORIG                                                74880000
         L     REGD,BUFSTART       COMPUTE A DISPLACEMENT FOR BUFFER MG 74970000
         M     REGC,THREE                                               75060000
         D     REGC,F256                                                75150000
         ST    REGD,WRKARA+8       IN PARM LIST                         75240000
         MVC   WRKARA,SIX          CODE TO RESET                        75330000
         L     R15,BMGT(RSTABADR)                                  000B 75420000
         LA    PARM,WRKGDS1        RELEASE BUFFER                       75510000
         BALR  RET,R15                                                  75600000
         B     ERR6B               GO TO RELEASE STORAGE                75690000
ERR8     L     ERRCD,WRKRTNCD                                           75780000
         OI    0(ERRCD),PRM                                             75870000
         MVC   PRMER(4,ERRCD),TWO  BAD RELOC IN ARRAY                   75960000
ERR8A    TM    WRKSW,UPDT                                               76050000
         BO    ERR6B                                                    76140000
         B     ERR7A                                                    76230000
ERR9     L     ERRCD,WRKRTNCD                                           76320000
         OI    0(ERRCD),PRM                                             76410000
         MVC   PRMER(4,ERRCD),FOUR BAD KEY K IN KEYLIST                 76500000
         B     ERR8A                                                    76590000
         EJECT                                                          76680000
* REGISTERS                                                             76770000
*                                                                       76860000
REGZERO  EQU   0                                                        76950000
PARM     EQU   1                                                        77040000
REGA     EQU   2                                                        77130000
REGB     EQU   3                                                        77220000
ERRCD    EQU   4                                                        77310000
WORK     EQU   5                                                        77400000
OACB     EQU   6                                                        77490000
GTMREG   EQU   7                                                        77580000
GDSREG   EQU   8                                                        77670000
BASE     EQU   9                                                        77760000
REGC     EQU   10                                                       77850000
REGD     EQU   11                                                       77940000
RSTABADR EQU   12                      STATUS TABLE ADDR           000B 78030000
SAVE     EQU   13                                                       78120000
RET      EQU   14                                                       78210000
R15      EQU   15                                                       78300000
         EJECT                                                          78390000
         GINIT                                                          78480000
GTRU     GTRU  0                                                        78570000
GNOP4    GNOP4 0                                                        78660000
GNOP2    GNOP2                                                          78750000
         DC    C'40 BYTE PATCH AREA'                                    78840000
PATCH    DC    40X'FF'             PATCH AREA               D11         78930000
         EJECT                                                          79020000
ZERO     DC    2F'0'                                                    79110000
ONE      DC    F'1'                                                     79200000
TWO      DC    F'2'                                                     79290000
THREE    DC    F'3'                                                     79380000
FOUR     DC    F'4'                                                     79470000
FIVE     DC    F'5'                                                     79560000
SIX      DC    F'6'                                                     79650000
SEVEN    DC    F'7'                                                     79740000
TWTY     DC    F'20'                                                    79830000
F256     DC    F'256'                                                   79920000
BITS     DC    B'10111110'                                              80010000
         DC    X'00'                                                    80100000
         DC    B'00000000'                                              80190000
         DC    B'00000000'                                              80280000
KEYPASS  DC    X'FFFF'                                                  80370000
SUBSEG   DC    H'128'                                                   80460000
MOVE1    MVC   0(1,REGC),0(REGA)                                        80550000
ZEROOUT  XC    0(1,REGC),0(REGC)                                        80640000
         EJECT                                                          80730000
* PARAMETER LIST EQUATES                                                80820000
*                                                                       80910000
GDS      EQU   0                                                        81000000
ARRAY    EQU   4                                                        81090000
COUNT    EQU   8                                                        81180000
KEYLST   EQU   12                                                       81270000
CORVAL   EQU   16                                                       81360000
KEY      EQU   20                                                       81450000
GENCDE   EQU   24                                                       81540000
LAST     EQU   X'80'                                                    81630000
         EJECT                                                          81720000
* OTHER EQUATES                                                         81810000
NULL     EQU   20                                                       81900000
LEVEL2   EQU   X'10'                                                    81990000
OMIT     EQU   X'FB'                                                    82080000
UPDT     EQU   X'40'                                                    82170000
KEYED    EQU   X'20'                                                    82260000
INCL     EQU   X'04'                                                    82350000
CURLOG   EQU   52                                                       82440000
CONTUNRE EQU   X'01'                                                    82530000
STAT     EQU   24                                                       82620000
DSTOR    EQU   852                                                      82710000
STMD     EQU   X'2A'                                                    82800000
FOUR1    EQU   X'02'                                                    82890000
TWO1     EQU   X'BF'          MAXIMUM VALUE FOR 2 BYTE ORDER     A29394 82980000
SIX1     EQU   X'EC'                                                    83070000
FOUR2    EQU   X'EA'                                                    83160000
BNH      EQU   13                                                       83250000
LOACPBF2 EQU   40                  CPU2 AND BUF2 FIELDS      LD YA00806 83340000
*                                  ...OF LAST OACB           LD YA00806 83430000
CPBF2    EQU   8                   OACB CPU2 AND BUF2        LD YA00806 83520000
BZ       EQU   8                   MASK OF ZERO              LD YA00808 83610000
RESET    EQU   1                   VALUE USED TO RESET LEN   LD YA00815 83700000
SAVEMODE EQU   X'45'                                                    83790000
LASTGDOA EQU   X'10'                                                    83880000
BMGT     EQU   816                                                      83970000
UPDH13   EQU   936                 STATAB DISPL -IFFAHA13-  D11 ZA15418 84060000
UPDH14   EQU   948                 STATAB DISPL -IFFAHA14-  D11 ZA15418 84150000
NOBUF    EQU   X'80'                                                    84240000
SCNDPASS EQU   X'20'                                                    84330000
CNTL     EQU   0                                                        84420000
RESOL    EQU   X'02'                                                    84510000
GMVA     EQU   X'EB'                                                    84600000
OVERFLOW EQU   X'20'                                                    84690000
LSTONE   EQU   X'10'                                                    84780000
BUFLEN1  EQU   28                                                       84870000
PRM      EQU   X'08'                                                    84960000
PRMER    EQU   16                                                       85050000
STRG     EQU   12                                                       85140000
ST       EQU   X'10'                                                    85230000
CORRE    EQU   X'10'                                                    85320000
MEMSUB   EQU   X'80'                                                    85410000
MEMSEQ   EQU   X'40'                                                    85500000
SEQ      EQU   X'04'                                                    85590000
SUB      EQU   X'02'                                                    85680000
ETE      EQU   828                                                 000A 85770000
BFOVRFL  EQU   X'60'          BUFFER OVERFLOW REQUIRED           A34801 85860000
         EJECT                                                          85950000
OACBAREA DSECT                                                          86040000
OTHER    DS    F                                                        86130000
GDOA     DS    F                                                        86220000
STATUS   DS    F                                                        86310000
CRSA     DS    F                                                        86400000
OLP      DS    F                                                        86490000
BLP      DS    F                                                        86580000
BUFSTART DS    F                                                        86670000
BUFLEN   DS    F                                                        86760000
FIRST    DS    F                                                        86850000
LENGTH   DS    F                                                        86940000
CPU2     DS    F                                                        87030000
BUF2     DS    F                                                        87120000
LOGSTRT  DS    F                   LOGICAL IN RELATION TO GDS           87210000
LOGCURR  DS    F                   LOGICAL IN RELATION TO ORGEN         87300000
LENLEFT  DS    F                                                        87390000
ORIG     DS    F                                                        87480000
         EJECT                                                          87570000
WORKAREA DSECT                                                          87660000
WRKPARM  DS    F                                                        87750000
WRKRTNCD DS    F                                                        87840000
WRKSAVE  DS    18F                                                      87930000
WRKSW    DS    F                                                        88020000
WRKKYLST DS    F                                                        88110000
WRKARA   DS    3F                                                       88200000
WRKCNT   DS    F                                                        88290000
WRKDSP   DS    F                                                        88380000
WRKLEN   DS    F                                                        88470000
WRKGDOA  DS    F                                                        88560000
WRKDSTOR DS    F                                                        88650000
WRKSTMD  DS    F                                                        88740000
WRKBMGT  DS    F                                                        88830000
WRKADDR  DS    F                                                        88920000
WRKBITS  DS    F                                                        89010000
WRKCORVL DS    F                                                        89100000
WRKKEY   DS    F                                                        89190000
WRKGDS   DS    F                                                        89280000
WRKRTN   DS    F                                                        89370000
WRKGDS1  DS    F                                                        89460000
WRKCODE  DS    F                                                        89550000
WRKKADDR DS    F                                                        89640000
WRKOUTPT DS    F                                                        89730000
WRKLSTOA DS    F                   LAST OACB POINTER         LD YA00806 89820000
ORGFLGS  DS    F                   ORGEN FLAGS FOR UPDATE    LD YA00808 89910000
         COPY  GTMCB                                                    90000000
         COPY  GDSCB                                                    90090000
         END                                                            90180000
./  ADD  SSI=20480294,NAME=IFFAGA08
*STATUS: CHANGE LEVEL 000                                               00200021
*                                                                       00400021
*FUNCTION/OPERATION: CONVERTS ABSOLUTE USER COORDINATES TO ABSOLUTE     00600021
*        INTEGER RASTER UNIT COORDINATES BY CALLING SCALE OR IT         00800021
*        CONVERTS ABSOLUTE INTEGER RASTER UNIT COORDINATES INTO         01000021
*        ABSOLUTE USER COORDINATES.  THE X AND/OR THE Y COORDINATES     01200021
*        MAY BE CONVERTED                                               01400021
*                                                                       01600021
*ENTRY POINTS: IFFAGA08                                                 01800021
*                                                                       02000021
*INPUT:  REGISTER 1 POINTS TO A WORKAREA.  THE FIRST WORD CONTAINS THE  02200021
*        ADDRESS OF THE PARAMETER LIST, AND THE SECOND, THAT OF THE     02400021
*        RETURN CODE ARRAY.                                             02600021
*                                                                       02800021
*        THE VARIABLE LENGTH PARAMETER LIST IS AS FOLLOWS.              03000021
*        REQUIRED PARAMETERS                                            03200021
*    + 0 A(POINTER TO THE GDSCB)                                        03400021
*                                                                       03600021
*    + 4 A(CONVERT FUNCTION VARIABLE)                                   03800021
*                                                                       04000021
*        OPTIONAL PARAMETERS                                            04200021
*    + 8 A(X-INPUT VALUE)    IF NON-NULL, NEXT 2 PARAMETERS MUST BE     04400021
*                            PASSED WITH THE X-OUTPUT VALUE NON-NULL    04600021
*    +12 A(Y-INPUT VALUE)    IF NON-NULL, NEXT 2 PARAMETERS MUST BE     04800021
*                            PASSED WITH THE Y-OUTPUT VALUE NON-NULL    05000021
*    +16 A(X-OUTPUT VALUE)   MUST BE NON-NULL IF X-INPUT VALUE NON-NULL 05200021
*                                                                       05400021
*    +20 A(Y-OUTPUT VALUE)   MUST BE NON-NULL IF Y-INPUT VALUE NON-NULL 05600021
*                                                                       05800021
*OUTPUT: CONVERTED COORDINATES AS APPROPRIATE                           06000021
*                                                                       06200021
*EXTERNAL ROUTINES: SCALE (BOTH ENTRY POINTS IFFAHA06 AND IFFAAA15)     06400021
*                                                                       06600021
*EXITS-NORMAL AND ERROR:  VIA RETURN MACRO TO CALLING PROGRAM           06800021
*                                                                       07000021
*TABLES/WORKAREAS: GSP WORKAREA                                         07200021
*                                                                       07400021
* ATTRIBUTES: PROBLEM STATE, REENTRANT                                  07600021
IFFAGA08 CSECT                                                          07800021
*2421,438000,537000                                                6292 08000021
         SAVE  (14,12)                                                  08200021
         BALR  CVT09,0                 ADDRESSABILITY FOR               08400021
         USING *,CVT09                 CSECT                            08600021
         LR    CVT08,CVT01             ADDRESSABILITY FOR WORK AREA     08800021
         USING CVTWORK,CVT08                                            09000021
         LA    CVT02,CVTSAVE           CHAIN                            09200021
         ST    CVT13,CVTSAVE+HSVA      SAVE                             09400021
         ST    CVT02,MSVA(CVT13)       AREAS                            09600021
         LR    CVT13,CVT02                                              09800021
         L     CVT07,CVTPARM           ADDRESSABILITY FOR PARAMETERS    10000021
         USING CVTPARTB,CVT07                                           10200021
         L     CVT10,CVTGDSCB          GET POINTER TO GDSCB             10400021
         L     CVT10,0(CVT10)          ADDRESSABILITY FOR GDSCB         10600021
         USING GDSCB,CVT10                                              10800021
         L     CVT11,CVTRTNA           ADDRESSABILITY FOR RETURN ARRAY, 11000021
         USING GSPARRAY,CVT11          NULL VARIABLE, AND STATUS TABLE  11200021
         XC    CVTCTRL(1),CVTCTRL      SET CONTROL SWITCHES = 0         11400021
         MVI   GSPARRAY,X'00'          SUCCESSFUL COMPLETION            11600021
         C     CVT10,GDSGDSCB          INVALID GDSCB                    11800021
         BNE   CVT018                  YES, ERROR RETURN                12000021
*                                                                       12200021
*                                                                       12400021
*        CHECK PARAMETER VALIDITY                                       12600021
*                                                                       12800021
         TM    CVTGDSCB,X'80'          IS GDSCB PTR. ONLY PARAMETER     13000021
         BO    CVT019                  YES, ERROR-SHORT PARAMETER LIST  13200021
         CLC   CVTCNVRT+1(3),GSPNULLV+1 CONVERT VARIABLE NULLED         13400021
         BE    CVT022                  YES, ERROR RETURN                13600021
         L     CVT02,CVTCNVRT                                           13800021
         L     CVT02,0(CVT02)          GET CONVERT VARIABLE             14000021
         C     CVT02,CVT0001           LESS THAN 1                      14200021
         BL    CVT022                  YES, ERROR RETURN                14400021
         C     CVT02,CVT0002           GREATER THAN 2                   14600021
         BH    CVT022                  YES, ERROR RETURN                14800021
         TM    CVTCNVRT,X'80'          CONVERT LAST PARAMETER           15000021
         BO    CVT013                  YES, IMMEDIATE RETURN            15200021
*                                                                       15400021
         CLC   CVTXINP+1(3),GSPNULLV+1 IS X-INPUT NULLED                15600021
         BE    CVT001                  YES, CHECK Y                     15800021
         TM    CVTXINP,X'80'           NO, IS IT END OF LIST            16000021
         BO    CVT020                  YES, ERROR-X OUTPUT NOT PASSED   16200021
         TM    CVTYINP,X'80'           Y INPUT PRESENT                  16400021
         BO    CVT020                  NO, ERROR-X OUTPUT NOT PASSED    16600021
         CLC   CVTXOUT+1(3),GSPNULLV+1 IS X OUTPUT NULLED               16800021
         BE    CVT020                  YES, ERROR-X OUTPUT NOT PASSED   17000021
         OI    CVTCTRL,XPROC           NO, X TO BE PROCESSED            17200021
*                                                                       17400021
CVT001   TM    CVTXINP,X'80'           X INPUT END OF LIST              17600021
         BO    CVT013                  YES, IMMEDIATE RETURN            17800021
         CLC   CVTYINP+1(3),GSPNULLV+1 IS Y INPUT NULLED                18000021
         BE    CVT002                  YES, DO ANY PROCESSING           18200021
         TM    CVTYINP,X'80'           NO, IS IT END OF LIST            18400021
         BO    CVT021                  YES, ERROR-Y OUTPUT NOT PASSED   18600021
         TM    CVTXOUT,X'80'           IS X OUTPUT PRESENT              18800021
         BO    CVT021                  NO, ERROR-Y OUTPUT NOT PASSED    19000021
         CLC   CVTYOUT+1(3),GSPNULLV+1 IS Y OUTPUT NULLED               19200021
         BE    CVT021                  YES, ERROR-Y OUTPUT NOT PASSED   19400021
         OI    CVTCTRL,YPROC           NO, Y TO BE PROCESSED            19600021
*                                                                       19800021
CVT002   CLC   CVTCNVRT+1(3),GSPNULLV+1  CNVRT VARIABLE NULLED          20000021
         BE    CVT022                  YES, ERROR- CNVRT VARIABLE BAD   20200021
         L     CVT02,CVTCNVRT          GET ADDRESS OF VARIABLE          20400021
         CLC   0(4,CVT02),CVT0001      IS IT = 1                        20600021
         BE    CVT014                  YES, CONVERT TO USER UNITS       20800021
         CLC   0(4,CVT02),CVT0002      IS IT = 2                        21000021
         BNE   CVT022                  NO, ERROR- CNVRT VARIABLE BAD    21200021
*                                      YES, CONVERT TO RASTER UNITS     21400021
*        IN CONVERTING TO RASTER UNITS, THE DATA MODE IS TEMPORARILY    21600021
*        FORCED TO ABSOLUTE.  A PARAMETER TABLE FOR SCALE IS THEN       21800021
*        GENERATED IN THE WORKAREA.  SCALE IS THEN CALLED TO PERFORM    22000021
*        THE CONVERSION.                                                22200021
*                                                                       22400021
         MVC   CVTDATA(1),GDSDATMD     SAVE DATA MODE SWITCH            22600021
         TM    CVTDATA,XREAL           CHECK X DATA MODE                22800021
         BZ    CVT003                                                   23000021
         MVI   GDSDATMD,XREALABS       FORCE TO                         23200021
         B     CVT004                  ABSOLUTE INPUT                   23400021
CVT003   MVI   GDSDATMD,XINTABS        IN PROPER MODE                   23600021
*                                                                       23800021
CVT004   TM    CVTDATA,YREAL           CHECK Y DATA MODE                24000021
         BZ    CVT005                                                   24200021
         OI    GDSDATMD,YREALABS       FORCE TO                         24400021
         B     CVT006                  ABSOLUTE INPUT                   24600021
CVT005   OI    GDSDATMD,YINTABS        IN PROPER MODE                   24800021
CVT006   TM    CVTCTRL,XPROC           X TO BE PROCESSED                25000021
         BZ    CVT007                  NO, SET TO ZERO                  25200021
         L     CVT02,CVTXINP           YES, GET ADDRESS OF INPUT VALUE  25400021
         MVC   CVTXABS(4),0(CVT02)     MOVE INTO PARAMETER TABLE        25600021
         B     CVT008                                                   25800021
CVT007   XC    CVTXABS(4),CVTXABS                                       26000021
*                                                                       26200021
CVT008   TM    CVTCTRL,YPROC           Y TO BE PROCESSED                26400021
         BZ    CVT009                  NO, SET TO ZERO                  26600021
         L     CVT02,CVTYINP           GET ADDRESS OF INPUT VALUE       26800021
         MVC   CVTYABS(4),0(CVT02)     MOVE INTO PARAMETER TABLE        27000021
         B     CVT010                                                   27200021
CVT009   XC    CVTYABS(4),CVTYABS                                       27400021
*                                                                       27600021
CVT010   XC    CVTSCNT(4),CVTSCNT      SET COUNT TO ZERO                27800021
         ST    CVT10,CVTGDS2           STORE POINTERS TO GDSCB          28000021
         ST    CVT11,CVTRTNA2          AND RETURN ARRAY                 28200021
         L     CVT02,GSPASTAT          GET ADDRESS OF SCALE             28400021
         L     CVT15,HA06(CVT02)                                        28600021
         LA    CVT01,CVTGDS2           GET POINTER TO WORKAREA          28800021
         BALR  CVT14,CVT15             CALL SCALE                       29000021
         MVC   GDSDATMD(1),CVTDATA     RESTORE DATA MODE SWITCH         29200021
         LTR   CVT15,CVT15             ANY SCALING ERROR                29400021
         BP    CVT024                                                   29600021
*                                                                       29800021
CVT011   TM    CVTCTRL,XPROC           X OUTPUT                         30000021
         BZ    CVT012                                                   30200021
         L     CVT02,CVTXOUT           YES, GET OUTPUT LOCATION         30400021
         MVC   0(4,CVT02),CVTXABS      PLACE VALUE THERE                30600021
*                                                                       30800021
CVT012   TM    CVTCTRL,YPROC           Y OUTPUT                         31000021
         BZ    CVT013                                                   31200021
         L     CVT02,CVTYOUT           YES, GET OUTPUT LOCATION         31400021
         MVC   0(4,CVT02),CVTYABS      PLACE VALUE THERE                31600021
*                                                                       31800021
CVT013   L     CVT13,HSVA(CVT13)                                        32000021
         RETURN (14,12),T                                               32200021
*                                                                       33000021
CVT014   TM    CVTCTRL,XPROC           X TO BE PROCESSED                33200021
         BZ    CVT016                  NO, GO DO Y                      33400021
         L     CVT02,CVTXINP           YES, GET INPUT VALUE             33600021
         MVC   CVTXABS(4),0(CVT02)                                      33800021
*                                                                       34000021
         TM    GDSDATMD,XREAL          IS X INPUT REAL                  34200021
         BZ    CVT015                  NO, INTEGER                      34400021
         LA    CVT01,CVTXABS           FLOAT RASTER UNIT COORDINATE     34600021
         BAL   CVT14,CVTFLOAT                                           34800021
*                                                                       35000021
         LE    CVT00F,CVTXABS          COMPUTE  X-GLLX                  35200021
         SE    CVT00F,GDSXVRLL                                          35400021
         LE    CVT02F,GDSUVLUR         COMPUTE  GURU-GLLU               35600021
         SE    CVT02F,GDSUVLLL                                          35800021
         MER   CVT00F,CVT02F           COMPUTE (X-GLLX)(GURU-GLLU)      36000021
         LE    CVT02F,GDSXVRUR         COMPUTE (GURX-GLLX)              36200021
         SE    CVT02F,GDSXVRLL                                          36400021
         DER   CVT00F,CVT02F           COMPUTE U                        36600021
         AE    CVT00F,GDSUVLLL         ADD GLLU                         36800021
         STE   CVT00F,CVTXABS          AND STORE                        37000021
         B     CVT016                                                   37200021
*                                                                       37400021
CVT015   L     CVT03,CVTXABS           COMPUTE (X-GLLX)                 37600021
         S     CVT03,GDSXVILL                                           37800021
         L     CVT04,GDSUVLUR          COMPUTE (GURU-GLLU)              38000021
         S     CVT04,GDSUVLLL                                           38200021
         MR    CVT02,CVT04             COMPUTE (X-GLLX)(GURU-GLLU)      38400021
         L     CVT04,GDSXVIUR          COMPUTE (GURX-GLLX)              38600021
         S     CVT04,GDSXVILL                                           38800021
         DR    CVT02,CVT04             COMPUTE U                        39000021
         LTR   CVT02,CVT02             CHECK FOR REMAINDER         6292 39200021
         BZ    CVT0151                 BRANCH IF NO REMAINDER      6292 39400021
         A     CVT03,CVT0001           ADD ONE  ROUNDING UPER      6292 39600021
CVT0151  A     CVT03,GDSUVLLL          ADD GLLU                         39800021
         ST    CVT03,CVTXABS           AND STORE                        40000021
*                                                                       40200021
CVT016   TM    CVTCTRL,YPROC           Y TO BE PROCESSED                40400021
         BZ    CVT011                  NO, STORE ANY VALUES             40600021
         L     CVT02,CVTYINP           YES. GET INPUT VALUE             40800021
         MVC   CVTYABS(4),0(CVT02)                                      41000021
*                                                                       41200021
         TM    GDSDATMD,YREAL          IS Y INPUT REAL                  41400021
         BZ    CVT017                  NO, INTEGER                      41600021
         LA    CVT01,CVTYABS           FLOAT RASTER UNIT COORDINATE     41800021
         BAL   CVT14,CVTFLOAT                                           42000021
*                                                                       42200021
         LE    CVT00F,CVTYABS          COMPUTE Y-GLLY                   42400021
         SE    CVT00F,GDSYVRLL                                          42600021
         LE    CVT02F,GDSVVLUR         COMPUTE GURV-GLLV                42800021
         SE    CVT02F,GDSVVLLL                                          43000021
         MER   CVT00F,CVT02F           COMPUTE (Y-GLLY)(GURV-GLLV)      43200021
         LE    CVT02F,GDSYVRUR         COMPUTE GURY-GLLY                43400021
         SE    CVT02F,GDSYVRLL                                          43600021
         DER   CVT00F,CVT02F           COMPUTE V                        43800021
         AE    CVT00F,GDSVVLLL         ADD GLLV                         44000021
         STE   CVT00F,CVTYABS          AND STORE                        44200021
         B     CVT011                                                   44400021
*                                                                       44600021
CVT017   L     CVT03,CVTYABS           COMPUTE  Y-GLLY                  44800021
         S     CVT03,GDSYVILL                                           45000021
         L     CVT04,GDSVVLUR          COMPUTE  GURV-GLLV               45200021
         S     CVT04,GDSVVLLL                                           45400021
         MR    CVT02,CVT04             COMPUTE (Y-GLLY)(GURV-GLLV)      45600021
         L     CVT04,GDSYVIUR          COMPUTE  GURY-GLLY               45800021
         S     CVT04,GDSYVILL                                           46000021
         DR    CVT02,CVT04             COMPUTE V                        46200021
         LTR   CVT02,CVT02             CHECK FOR REMAINDER         6292 46400021
         BZ    CVT0171                 BRANCH IF NO REMAINDER      6292 46600021
         A     CVT03,CVT0001           ADD ONE  ROUNDING UP        6292 46800021
CVT0171  A     CVT03,GDSVVLLL                                      6292 47000021
         ST    CVT03,CVTYABS           AND STORE                        47200021
         B     CVT011                                                   47400021
*                                                                       47600021
CVT018   MVC   GSPARRAY+16(4),CVT0001  BAD GDSCB                        47800021
         B     CVT023                                                   48000021
*                                                                       48200021
CVT019   XC    GSPARRAY+16(4),GSPARRAY+16 BAD PARAMETER LIST            48400021
         B     CVT023                                                   48600021
*                                                                       48800021
CVT020   MVC   GSPARRAY+16(4),CVT0005  X OUTPUT NOT PASSED              49000021
         B     CVT023                                                   49200021
*                                                                       49400021
CVT021   MVC   GSPARRAY+16(4),CVT0006  Y OUTPUT NOT PASSED              49600021
         B     CVT023                                                   49800021
*                                                                       50000021
CVT022   MVC   GSPARRAY+16(4),CVT0002  INVALID CNVRT VARIABLE           50200021
*                                                                       50400021
CVT023   MVI   GSPARRAY,PARERR         SET PARAMETER ERROR FLAG         50600021
         B     CVT013                                                   50800021
*                                                                       51000021
CVT024   MVI   GSPARRAY,SCERR          SCALING ERROR                    51200021
         XC    GSPARRAY+8(4),GSPARRAY+8                                 51400021
         B     CVT013                                                   51600021
CVTFLOAT CLC   0(4,CVT01),CVT0000D     VALUE TO BE FLOATED = 0          51800021
         BCR   8,CVT14                 YES, RETURN                      52000021
         MVC   CVTDBLE(4),CVTFCON      SET UP CONVERSION CONSTANT       52200021
         TM    0(CVT01),X'80'          IS NUMBER NEGATIVE               52400021
         BO    CVTFLT2                 YES                              52600021
CVTFLT1A MVC   CVTDBLE+4(4),0(CVT01)   NO, MOVE MAGNITUDE INTO AREA     52800021
CVTFLT1  LD    CVT00F,CVTDBLE          GET UNNORMALIZED NUMBER INTO     53000021
*                                      FLOATING-POINT REGISTER          53200021
         AD    CVT00F,CVT0000D         NORMALIZE                        53400021
         STE   CVT00F,0(CVT01)         STORE CONVERTED VALUE            53600021
         BR    CVT14                   RETURN                           53800021
*                                                                       54000021
CVTFLT2  OI    CVTDBLE,X'80'           SET SIGN BIT                     54200021
         CLC   CVTMXNEG(4),0(CVT01)    MAXIMUM NEGATIVE INTEGER         54400021
         BE    CVTFLT1A                YES, TREAT AS POSITIVE           54600021
         L     CVT02,0(CVT01)          NO, GET MAGNITUDE                54800021
         LPR   CVT02,CVT02             OF NUMBER                        55000021
         ST    CVT02,CVTDBLE+4         STORE IN CONVERSION AREA         55200021
         B     CVTFLT1                                                  55400021
CVT0001  DC    F'1'                                                     55600021
CVT0002  DC    F'2'                                                     55800021
CVT0005  DC    F'5'                                                     56000021
CVT0006  DC    F'6'                                                     56200021
CVTFCON  DC    X'4E000000'                                              56400021
         DS    0D                                                       56600021
CVT0000D DC    XL8'00'                                                  56800021
CVTMXNEG DC    XL4'80000000'                                            57000021
XPROC    EQU   X'F0'                                                    57200021
YPROC    EQU   X'0F'                                                    57400021
XREAL    EQU   X'C0'                                                    57600021
YREAL    EQU   X'0C'                                                    57800021
XREALABS EQU   X'80'                                                    58000021
YREALABS EQU   X'08'                                                    58200021
XINTABS  EQU   X'20'                                                    58400021
YINTABS  EQU   X'02'                                                    58600021
HA06     EQU   864                                                      58800021
PARERR   EQU   X'08'                                                    59000021
SCERR    EQU   X'20'                                                    59200021
HSVA     EQU   4                                                        59400021
MSVA     EQU   8                                                        59600021
*        REGISTER EQUATES                                               59800021
CVT01    EQU   1                                                        60000021
CVT02    EQU   2                                                        60200021
CVT08    EQU   8                                                        60400021
CVT09    EQU   9                                                        60600021
CVT13    EQU   13                                                       60800021
CVT14    EQU   14                                                       61000021
CVT07    EQU   7                                                        61200021
CVT10    EQU   10                                                       61400021
CVT11    EQU   11                                                       61600021
CVT15    EQU   15                                                       61800021
CVT00F   EQU   0                                                        62000021
CVT02F   EQU   2                                                        62200021
CVT03    EQU   3                                                        62400021
CVT04    EQU   4                                                        62600021
CVTPARTB DSECT                                                          62800021
CVTGDSCB DS    F                       ADDRESS OF POINTER TO GDSCB      63000021
CVTCNVRT DS    F                       CONVERT VARIABLE                 63200021
CVTXINP  DS    F                       X INPUT                          63400021
CVTYINP  DS    F                       Y INPUT                          63600021
CVTXOUT  DS    F                       X OUTPUT                         63800021
CVTYOUT  DS    F                       Y OUTPUT                         64000021
CVTWORK  DSECT                                                          64200021
CVTPARM  DS    F                                                        64400021
CVTRTNA  DS    F                                                        64600021
CVTSAVE  DS    18F           SAVE AREA                                  64800021
CVTGDS2  DS    F             PARAMETERS FOR CALL TO SCALE               65000021
CVTRTNA2 DS    F                                                        65200021
CVTDATA  DS    C             SAVE AREA FOR GDSDATMD                     65400021
CVTCTRL  DS    C                                                        65600021
*              X'F0'         X TO BE PROCESSED                          65800021
*              X'0F'         Y TO BE PROCESSED                          66000021
         DS    H                                                        66200021
         DS    3F                                                       66400021
CVTXABS  DS    F                                                        66600021
CVTYABS  DS    F                                                        66800021
         DS    4F                                                       67000021
CVTSCNT  DS    F                                                        67200021
CVTDBLE  DS    D                                                        67400021
         COPY  GSPCB                                                    67600021
         COPY  GTMCB                                                    67800021
         COPY  GDSCB                                                    68000021
         END                                                            68200021
./  ADD  SSI=20480297,NAME=IFFAHA01
         TITLE 'IFFAHA01 - FLOWCTL - FLOW CONTROL MANAGEMENT'      1720 00200021
*                                                                       00400021
*                        FLOW CONTROL MANAGEMENT                        00600021
*                                                                       00800021
*        FLOW CONTROL MANAGEMENT IS ENTERED FROM SEVERAL ROUTINES FOR   01000021
*        SEVERAL DIFFERENT PURPOSES.                                    01200021
*                                                                       01400021
*        CODE 1                                                         01600021
*        ENTRY AT CODE 1 IS MADE TO SET UP THE FLOW CONTROL TABLE       01800021
*        AND BUILD THE FLOW CONTROL STRUCTURE.  IT IS CALLED BY         02000021
*        INDEV-IFFAAA03.  REGISTER ONE CONTAINS THE ADDRESS OF A        02200021
*        WORK AREA.  THE FIRST WORD OF THE WORK AREA CONTAINS THE       02400021
*        ADDRESS OF THE PARAMETER LIST CONSISTING OF THE FOLLOWING:     02600021
*                                                                       02800021
*        +0   A(1)                                                      03000021
*        +4   A(GTMCB)                                                  03200021
*                                                                       03400021
*        CODE 2                                                         03600021
*        ENTRY AT CODE 2 IS MADE TO ADD A GDS TO THE FLOW CONTROL       03800021
*        STRUCTURE IN THE BUFFER.  IT IS CALLED BY DATA STORE-          04000021
*        IFFAHA05.  THE PARAMETER LIST IS LISTED BELOW:                 04200021
*                                                                       04400021
*        +0   A(2)                                                      04600021
*        +4   A(GDSCB)                                                  04800021
*        +8   A(BUFFER)                                                 05000021
*                                                                       05200021
*        CODE 3                                                         05400021
*        CODE 3 IS ENTERED FROM TMGDS-IFFAAA06 TO REMOVE A GDS          05600021
*        FROM THE FLOW CONTROL STRUCTURE.  THE PARAMETER LIST           05800021
*        IS AS FOLLOWS:                                                 06000021
*                                                                       06200021
*        +0   A(3)                                                      06400021
*        +4   A(GDSCB)                                                  06600021
*                                                                       06800021
*        CODE 4                                                         07000021
*        CODE 4 IS ENTERED FROM TMDEV-IFFAAA04 TO DELETE THE FLOW       07200021
*        CONTROL STRUCTURE AND THE FLOW CONTROL TABLE.  THE PARAMETER   07400021
*        LIST CONSISTS OF THE FOLLOWING:                                07600021
*                                                                       07800021
*        +4   A(4)                                                      08000021
*        +4   A(GTMCB)                                                  08200021
*                                                                       08400021
*        THE SYSTEM DECB IS SET UP WHEN THE FLOW CONTROL TABLE IS       08600021
*        INITIALIZED AND IS USED FOR THE FIRST TIME BY FLOW CONTROL     08800021
*        WHICH LEAVES THE LAST I/O PENDING.  WHEN FLOW CONTROL IS       09000021
*        CALLED TO TERMINATE THE LAST I/O IS WAITED ON BEFORE THE       09200021
*        DECB IS DESTROYED.                                             09400021
*                                                                       09600021
*        MACROS USED ARE:                                               09800021
*                                                                       10000021
*        ASGNBFR                                                        10200021
*        GETMAIN                                                        10400021
*        GWRITE                                                         10600021
*        WAIT                                                           10800021
*        GCNTRL                                                         11000021
*        FREEMAIN                                                       11200021
*        RLSEBFR                                                        11400021
*                                                                       11600021
*                                                                       11800021
*        THE FLOW CONTROL TABLE APPEARS AS FOLLOWS:                     12000021
*       *************************************                           12200021
*     +0*        A(FREE ENTRY)              *                           12400021
*     +4*          IN USE LENGTH 2 PER ENTRY*                           12600021
*     +8*A(BUFFER)       *  BUFFER+6        *  ENTRIES                  12800021
*    +12*   BUFFER+16    *  BUFFER+26       *                           13000021
*    +16*   BUFFER+36    *  BUFFER+46       *                           13200021
*    +20*   BUFFER+56    *  BUFFER+66       *                           13400021
*    +24*   BUFFER+76    *  BUFFER+86       *                           13600021
*    +28*   BUFFER+96    *  BUFFER+106      *                           13800021
*    +32*   BUFFER+116   *  BUFFER+126      *                           14000021
*    +36*   BUFFER+136   *  BUFFER+146      *                           14200021
*    +40*   BUFFER+156   *  BUFFER+166      *                           14400021
*    +44*   BUFFER+176   *  BUFFER+186      *                           14600021
*    +48*   BUFFER+196   *  BUFFER+206      *                           14800021
*    +52*   BUFFER+216   *  BUFFER+226      *                           15000021
*    +56*   BUFFER+236   *  BUFFER+246      *                           15200021
*       *************************************                           15400021
         EJECT                                                          15600021
IFFAHA01 CSECT                                                          15800021
*2412,562000-564000                                                5743 15900021
*2131,002000,790000                                                1720 15950021
*                                                                       16000021
*        REGARDLESS OF THE REASON OF THIS CALL THE CODES PERFORM THE    16200021
*        FOLLOWING: THE BASE REGISTER IS INITIALIZED AND THE WORK       16400021
*        AREA DSECT IS SET UP. THE SAVE AREAS ARE CHAINED. THE REASON   16600021
*        FOR ENTRY IS DETERMINED AND DEPENDING ON THE SERVICE DESIRED,  16800021
*        CONTROL IS TURNED OVER TO A SPECIFIC SECTION OF THE PROGRAM    17000021
FLOWCTL  SAVE  (14,12)                                                  17200021
         BALR  BASE,0                                                   17400021
         USING *,BASE                                                   17600021
LABEL    LR    WORK,PARM           ADDRESS OF WORK AREA                 17800021
         USING WORKAREA,WORK                                            18000021
         L     PARM,WRKPARM        PARAMETER LIST                       18200021
         ST    SAVE,WRKSAVE+4      SET UP SAVE AREA CHAIN               18400021
         LA    REGA,WRKSAVE                                             18600021
         ST    REGA,8(SAVE)                                             18800021
         LR    SAVE,REGA           PLACE MY SAVE AREA IN THE REGISTER   19000021
         CLI   CODE(PARM),X'01'    CODE 1                               19200021
         BE    FLC00010                                                 19400021
         CLI   CODE(PARM),X'02'    CODE 2                               19600021
         BE    FLC00040                                                 19800021
         CLI   CODE(PARM),X'03'    CODE 3                               20000021
         BE    FLC00050                                                 20200021
         CLI   CODE(PARM),X'04'    CODE 4                               20400021
         BE    FLC00100                                                 20600021
         B     FLC00030                                                 20900021
         EJECT                                                          21200021
**                                                                      21400021
**                                                                      21600021
**       CODE 1                                                         21800021
**       SET UP FLOW CONTROL STRUCTURE AT GTMCB OPEN TIME.              22000021
**                                                                      22200021
**                                                                      22400021
*                                                                       22600021
*        TO SET UP THE FLOW CONTROL STRUCTURE AND TABLE THE REQUIRED    22800021
*        BUFFER, 256 BYTES, IS REQUESTED, AND THE REQUIRED STORAGE      23000021
*        FOR THE TABLE IS OBTAINED.                                     23200021
*                                                                       23400021
FLC00010 L     GTMREG,4(PARM)      ADDR OF TERM CTL BLK                 23600021
         USING GTMCB,GTMREG                                             23800021
         LA    REGA,256            LENGTH REQD                          24000021
         STH   REGA,WRKSPACE+8                                          24200021
         L     REGA,GTMGRDCB                                            24400021
         SPACE 3                                                   1720 24500021
         ASGNBFR (REGA),WRKSPACE+8,MF=(E,WRKSPACE)  GET BUFFER          24600021
         LTR   15,15                                                    24800021
         BNE   ERR1                NO BUFFER AVAILABLE                  25000021
         SPACE 3                                                   1720 25100021
         GETMAIN EC,LV=FLCTLTBL,A=WRKSPACE+12,SP=0,MF=(E,WRKSPACE)      25200021
         LTR   15,15                                                    25400021
         EJECT                                                     1720 25500021
         BNE   ERR2                NO CORE AVAILABLE                    25600021
*                                                                       25800021
*        THE TABLE IS INITIALIZED WITH POINTERS TO THE FREE LIST        26000021
*        AND THE LENGTH OF THE INUSE LIST. THE INUSE LIST IS            26200021
*        INITIALLY TWO BECAUSE OF THE FIRST ENTRY BEING RESERVED        26400021
*        FOR THE SYSTEM GDS. THEN THE ADDRESSES IN THE BUFFER           26600021
*        OBTAINED WHICH WILL BE AVAILABLE FOR EACH ENTRY ARE            26800021
*        COMPUTED AND PLACED IN THE TABLE.                              27000021
*                                                                       27200021
         L     TABLE,WRKSPACE+12   ADDR OF CORE OBTAINED                27400021
         LA    REGA,12(TABLE)      FREE LIST STARTS TWELVE BEYOND       27600021
         ST    REGA,FREE(TABLE)    PTR SET                              27800021
         LA    REGA,2                                                   28000021
         ST    REGA,INUSE(TABLE)   LENGTH OF INUSE LIST                 28200021
         L     REGA,GTMGRDCB       ADDR OF DCB                          28400021
         LH    REGB,16(REGA)       ADDR OF BUFFER OBTAINED              28600021
         STH   REGB,BUFADR(TABLE)  IN TABLE                             28800021
         LA    REGA,TBLEND(TABLE)  DECB ADDR                            29000021
         ST    REGA,GTMDECB1       IN GTMCB                             29200021
         LA    REGB,6(REGB)        DUMMY ENTRY BUFFER ADDR              29400021
         STH   REGB,DUMMY(TABLE)   IN TABLE                             29600021
         LA    REGA,24             COUNT                                29800021
         LA    REGC,DUMMY+2        ADDR OF FREE ELEMENTS                30000021
FLC00020 LA    REGB,10(REGB)       EACH TEN BYTES BEYOND LAST           30200021
         STH   REGB,0(REGC,TABLE)  STORE BUFFER ADDR                    30400021
         LA    REGC,2(REGC)        NEXT IN TABLE                        30600021
         BCT   REGA,FLC00020       DO ALL 24 ENTRIES                    30800021
         EJECT                                                     1720 30900021
**                                                                      31000021
**       THE TABLE HAS BEEN INITIALIZED. THE BUFFER MUST NOW BE INIT.   31200021
**                                                                      31400021
*                                                                       31600021
*        THE SKELETON FOR THE FLOW CONTROL STRUCTURE ARE                31800021
*        PLACED IN THE WORK AREA AND THE ADDRESSES ARE RESOLVED.        32000021
         MVC   WRKSPACE(16),FIRSTORD MOVE SKELETON ORDERS IN WORK AREA  32200021
         LH    REGB,BUFADR(TABLE)                                       32400021
         STH   REGB,WRKSPACE+14    BUFFER ADDR IN LAST GTRU             32600021
         LA    REGB,6(REGB)        ADDRESS TO GO IN 1ST GTRU            32800021
         STH   REGB,WRKSPACE+4     PLACE IN WORK AREA                   33000021
         LA    REGB,6(REGB)        DUMMY THE SYS GDS                    33200021
         STH   REGB,WRKSPACE+10                                         33400021
         EJECT                                                          33600021
*                                                                       33800021
*        BUILD DECB BELOW FLOW CONTROL TABLE                            34000021
*                                                                       34200021
*                                                                       34400021
*        THE DECB IS BUILT BEYOND THE FLOW CONTROL TABLE. THIS          34600021
*        WILL SERVE AS THE SYSTEM DECB FOR THE DATA GENERATING          34800021
*        ROUTINES WHILE THIS 2250 IS OPEN. THE FLOW CONTROL             35000021
*        STRUCTURE IS WRITTEN TO THE BUFFER AND THE I/O IS NOT          35200021
*        WAITED UPON. THIS IS THE START OF THE I/O OVERLAP. FUTURE      35400021
*        ROUTINES THAT WILL DO I/O USING THIS DECB WILL FIRST WAIT      35600021
*        AND THEN ISSUE THEIR I/O. ADDRESS OF THE DECB AND              35800021
*        THE FOLOW CONTROL TABLE ARE PLACED IN THE GTMCB AND            36000021
*        CONTROL IS RETURNED TO THE CALLING PROGRAM.                    36200021
         XC    TBLEND(32,TABLE),TBLEND(TABLE) ZERO OUT DECB             36400021
         LA    REGB,TBLEND(TABLE)  DECB ADDR                            36600021
         L     REGA,GTMGRDCB       DCB ADDR                             36800021
         LA    REGC,BUFADR(TABLE)                                       37000021
         LR    PARM,REGB                                                37200021
         SPACE 3                                                   1720 37300021
         GWRITE (PARM),BUF,(REGA),16,WRKSPACE,(REGC),MF=E               37400021
         ST    TABLE,GTMFCTBL      SAVE ADDR OF FLOW CTL TABLE          37600021
FLC00030 L     SAVE,4(SAVE)                                             37800021
         RETURN (14,12),RC=0       RETURN                               38000021
         EJECT                                                          38200021
**                                                                      38400021
**                                                                      38600021
**       CODE 2                                                         38800021
**       ADD A GDS                                                      39000021
**                                                                      39200021
**                                                                      39400021
*                                                                       39600021
*        TO ADD A GDS TO THE FLOW CONTROL STRUCTURE THE GDSCB AND       39800021
*        GTMCB DSECTS ARE FIRST INITIALIZED. THE ADDRESS OF THE         40000021
*        FLOW CONTROL TABLE IS TAKEN FROM THE GTMCB AND ALSO            40200021
*        THE DCB ADDRESS AND THE DECB ADDRESS. A CHECK IS MADE          40400021
*        TO SEE IF THIS GDS IS THE SYSTEM GDS AND IF SO IT IS           40600021
*        ADDED TO THE TOP OF THE TABLE. OTHERWISE A CHECK IS            40800021
*        MADE TO SEE IF ALL THE FLOW CONTROL ENTRIES HAVE BEEN          41000021
*        USED.  IF YES THIS IS AN ERROR CONDITION AND CONTROL IS        41200021
*        RETURNED TO THE CALLING PROGRAM WITH A RETURN CODE.            41400021
FLC00040 L     GDSREG,GDS(PARM)    GDSCB ADDR                           41600021
         USING GDSCB,GDSREG                                             41800021
         L     GTMREG,GDSGTMCB     ADDRESS OF GTMCB                     42000021
         L     TABLE,GTMFCTBL      FLOW CTL TABLE                       42200021
         L     REGA,INUSE(TABLE)   COUNT OF INUSE ELEM                  42400021
         L     REGC,GTMDECB1       DECB                                 42600021
         L     REGE,GTMGRDCB       DCB ADDR                             42800021
         C     GDSREG,GTMSYGDS     SYS GDS                              43000021
         BE    FLC00045            YES                                  43200021
         C     REGA,INUSELEN       ALL USED                             43400021
         BE    ERR1                YES- ERROR                           43600021
         EJECT                                                     1720 43700021
*                                                                       43800021
*        IF THERE IS A FREE ELEMENT THE ADDRESS IS REMOVED FROM THE     44000021
*        TABLE AND THE ENTRY IS ADDED TO THE IN USE LIST AND A COUNT    44200021
*        OF TWO IS ADDED TO THE INUSE COUNT.  THE SKELETON ORDERS       44400021
*        FOR THE FLOW CONTROL ENTRY ARE MOVED INTO THE WORK AREA AND    44600021
*        THE ADDRESSES IN THE BUFFER ARE RESOLVED.  THE PREVIOUS        44800021
*        I/O CALL IS WAITED UPON AND THE FLOW CONTROL ENTRY IS          45000021
*        WRITTEN TO THE BUFFER.                                         45200021
         L     REGB,FREE(TABLE)    FREE ELEMENT ADDR                    45400021
         LA    REGA,2(REGA)                                             45600021
         ST    REGA,INUSE(TABLE)   UPDATE INUSE COUNT                   45800021
         LA    REGA,2(REGB)                                             46000021
         ST    REGA,FREE(TABLE)    FIX FREE PTR                         46200021
         LA    ENTRY,4                                                  46400021
         SR    REGA,ENTRY          POSITION TO PREV ENTRY               46600021
         MVC   WRKSPACE(10),ENTRYORD MOVE IN SKELETON ORDERS            46800021
         MVC   WRKSPACE+4(2),10(PARM) MOVE IN GDS BUFFER ADDR           47000021
         MVC   WRKSPACE+8(2),BUFADR(TABLE) MOVE IN RETURN TO F/C        47200021
         LR    PARM,REGC                                                47400021
         WAIT  ECB=(1)             WAIT ON I/O                          47600021
         CLI   0(REGC),X'7F'                                            47660021
         BNE   ERR3                                                     47720021
         XC    0(4,REGC),0(REGC)   ZERO ECB                             47800021
         LR    PARM,REGC                                                48000021
         GWRITE (PARM),BUF,(REGE),10,WRKSPACE,(REGB),MF=E               48200021
         EJECT                                                          48400021
*                                                                       48600021
*        THE RETURN ADDRESS TO THE FLOW CONTROL ENTRY FROM THE GDS      48800021
*        BUFFER IS COMPUTED AND PLACED IN THE GDSOVDAT FIELD OF THE     49000021
*        GDSCB AS IS THE START OF THE FLOW CONTROL ENTRY PLACED IN      49200021
*        THE GDSFCBUF FIELD.  THE PREVIOUS I/O IS WAITED ON AND THE     49400021
*        ADDRESS OF THIS ENTRY IS WRITTEN OUT TO THE PREVIOUS           49600021
*        ENTRY SO THAT IT IS ADDED TO THE FLOW.  IF THIS IS             49800021
*        SYSTEM GDS THIS IS NOT NECESSARY BECAUSE THE FLOW CONTROL      50000021
*        ENTRY FOR THE SYSTEM GDS ALREADY GOES TO THE NEXT ENTRY        50200021
*        IN THE STRUCTURE.                                              50400021
*                                                                       50600021
         LH    REGB,0(REGB)                                             50800021
FLC00042 STH   REGB,GDSFCBUF       ADDR OF FLOW CTL ENTRY               51000021
         STH   REGB,GDSFCBUF       ADDR OF FLOW CTL ENTRY               51200021
         LA    REGB,6(REGB)                                             51400021
         STH   REGB,GDSOVDAT+2     RETURN PT IN FLOW CTL ENTRY          51600021
         LR    PARM,REGC                                                51800021
         WAIT  ECB=(1)             WAIT ON I/O                          52000021
         CLI   0(REGC),X'7F'                                            52060021
         BNE   ERR3                                                     52120021
         XC    0(4,REGC),0(REGC)   ZERO ECB                             52200021
         C     GDSREG,GTMSYGDS                                          52400021
         BE    FLC00044                                                 52600021
         LH    REGB,0(REGA)        ADDR OF PREV ENTRY                   52800021
         LA    REGB,8(REGB)        ADDR OF TRANS LOC                    53000021
         LA    REGA,2(REGA)        ADDR OF DATA                         53200021
         STH   REGB,WRKSPACE                                            53400021
         LR    PARM,REGC                                                53600021
         GWRITE  (PARM),BUF,(REGE),2,(REGA),WRKSPACE,MF=E               53800021
         LR    PARM,REGC                                                54000021
         WAIT  ECB=(1)             WAIT ON I/O                          54200021
         CLI   0(REGC),X'7F'                                            54260021
         BNE   ERR3                                                     54320021
         XC    0(4,REGC),0(REGC)   ZERO ECB                             54400021
         EJECT                                                     1720 54500021
*                                                                       54600021
*        THE PREVIOUS I/O IS WAITED ON AND A GTRU BACK TO THE           54800021
*        FLOW CONTROL ENTRY IS WRITTEN OUT TO THE USER BUFFER           55000021
*        SO THAT THE CYCLE IS COMPLETE.  WITH THIS CALL REGENERATION    55200021
*        OF THE BUFFER IS STARTED.                                      55400021
*                                                                       55600021
FLC00044 LR    PARM,REGC                                                55800021
         L     REGB,WRKPARM                                        5743 55805021
         L     REGC,GDSAOACB       ADDR OF OACB                    5743 55810021
* PLACE ADDR OF BUFFER INTO OACB TO REFERENCE FOR THE WRITE        5743 55815021
         MVC   BUFSTART+2(2,REGC),10(REGB)                         5743 55820021
         LA    REGB,BUFSTART+2(REGC)                               5743 55825021
         LA    REGC,BUFADR(TABLE)                                       56000021
         GWRITE (PARM),STR,(REGE),4,GDSOVDAT,(REGB),(REGC),MF=E         56600021
         B     FLC00030                                                 56800021
*                                                                       57000021
         EJECT                                                     1720 57100021
*        FOR THE SYSTEM GDS THE FLOW CONTROL ENTRY ALREADY EXISTS.      57200021
*        THEREFORE, THE ADDRESS OF THE SYSTEM GDS BUFFER IS ALL THAT    57400021
*        IS NEEDED TO COMPLETE THE ENTRY AND THAT ADDRESS IS WRITTEN    57600021
*        TO THE BUFFER AFTER THE PREVIOUS I/O IS WAITED UPON.           57800021
FLC00045 LH    REGB,DUMMY(TABLE)   ADDR OF DUMMY FOR SYSGDS             58000021
         LA    REGF,4(REGB)        ADDR TO WRITE TO                     58200021
         STH   REGF,WRKSPACE+2                                          58400021
         MVC   WRKSPACE(2),10(PARM) BUFFER ADDR TO BE WRITTEN IN DUMMY  58600021
         LR    PARM,REGC                                                58800021
         WAIT  ECB=(1)             WAIT ON I/O                          59000021
         CLI   0(REGC),X'7F'                                            59060021
         BNE   ERR3                                                     59120021
         XC    0(4,REGC),0(REGC)   ZERO ECB                             59200021
         LR    PARM,REGC                                                59400021
         GWRITE (PARM),BUF,(REGE),2,WRKSPACE,WRKSPACE+2,MF=E            59600021
         B     FLC00042                                                 59800021
         EJECT                                                          60000021
**                                                                      60200021
**                                                                      60400021
**       CODE 3                                                         60600021
**       DELETE A GDS                                                   60800021
**                                                                      61000021
**                                                                      61200021
*                                                                       61400021
*        WHEN A CALL IS MADE TO DELETE THE GDS A CHECK IS FIRST MADE    61600021
*        TO SEE IF THE FLOW CONTROL STRUCTURE IS ALREADY DELETED.  THIS 61800021
*        MAY OCCUR WHEN THE GDS IS BEING TERMINATED BY TMDEV AND        62000021
*        TMDEV HAS ALREADY DELETED THE FLOW CONTROL STRUCTURE.          62200021
*        A CHECK IS MADE TO SEE IF A FLOW CONTROL ENTRY WAS ADDED       62400021
*        FOR THIS GDS.  TWO IS SUBTRACTED FROM THE INUSE COUNT AND THE  62600021
*        ELEMENT IS REMOVED FROM THE INUSE LIST.  THE ADDRESS OF THE    62800021
*        ENTRY BEFORE AND AFTER IS SAVED.  THE ADDRESS OF THE ENTRY     63000021
*        AFTER THIS ONE (OR THE START OF THE TABLE IF THIS IS THE       63200021
*        LAST ENTRY) IS WRITTEN IN THE ENTRY PRECEEDING THIS ONE.       63400021
*        THUS THIS ENTRY IS BYPASSED IN THE REGENERATION.               63600021
FLC00050 L     GDSREG,4(PARM)      ADDR OF GDSCB                        63800021
         L     GTMREG,GDSGTMCB     ADDR OF THE GTMCB                    64000021
         L     TABLE,GTMFCTBL      FLOW CONTROL TABLE                   64200021
         LTR   TABLE,TABLE         ALREADY CLOSED?                      64400021
         BE    FLC00030            YES, EXIT                            64600021
         LH    REGB,GDSFCBUF       ADDR OF FLOW CONTROL ENTRY           64800021
         LTR   REGB,REGB           WAS AN ENTRY MADE                    65000021
         BZ    FLC00030            NO, EXIT                             65200021
         LA    REGA,10             FIRST IN USE ELEMENT                 65400021
         L     REGE,INUSE(TABLE)   COUNT                                65600021
         S     REGE,TWO            LESS TWO                             65800021
         ST    REGE,INUSE(TABLE)   NEW COUNT                            66000021
FLC00060 CH    REGB,2(REGA,TABLE)  FOUND ? SKIP 1 ELEM - DUMMY NEVER DL 66200021
         BE    FLC00070                                                 66400021
         LA    REGA,2(REGA)        NEXT                                 66600021
         S     REGE,TWO                                                 66800021
         B     FLC00060                                                 67000021
FLC00070 LH    REGC,0(REGA,TABLE)  ONE BEFORE                           67200021
         LA    ENTRY,4(REGA,TABLE)                                      67400021
         C     ENTRY,FREE(TABLE)                                        67600021
         BE    FLC00090                                                 67800021
         LH    ENTRY,4(REGA,TABLE)      ONE AFTER                       68000021
FLC00080 AR    REGA,TABLE                                               68200021
         BCTR  REGE,0              SUBTRACT 1 FOR EX OF MOVE            68400021
         EX    REGE,MOVE           MOVE UP TABLE                        68600021
         L     REGE,FREE(TABLE)    ADDR OF FREE                         68800021
         S     REGE,TWO            ADD ONE ENTRY                        69000021
         STH   REGB,0(REGE)        ADD TO FREE LIST                     69200021
         ST    REGE,FREE(TABLE)    UPDATE ADDRESS                       69400021
         STH   ENTRY,WRKSPACE                                           69600021
         L     PARM,GTMDECB1                                            69800021
         WAIT  ECB=(1)             WAIT ON I/O                          70000021
         EJECT                                                          70200021
         LA    REGC,8(REGC)                                             70400021
         STH   REGC,WRKSPACE+4                                          70600021
         L     REGB,GTMGRDCB       LOAD DCB ADDR                        70800021
         LA    REGA,BUFADR(TABLE)  START ADDR                           71000021
         L     PARM,GTMDECB1                                            71200021
         CLI   0(PARM),X'7F'                                            71250021
         BNE   ERR3                                                     71300021
         NI    0(PARM),X'BF'                                            71350021
         GWRITE (PARM),BUF,(REGB),2,WRKSPACE,WRKSPACE+4,MF=E            71400021
         L     PARM,GTMDECB1                                            71600021
         WAIT  ECB=(1)                                                  71800021
         L     PARM,GTMDECB1                                            72000021
         CLI   0(PARM),X'7F'                                            72050021
         BNE   ERR3                                                     72100021
         NI    0(PARM),X'BF'                                            72150021
         GCNTRL (PARM),STR,(REGB),(REGA),MF=E                           72200021
*                                                                       72400021
         EJECT                                                     1720 72500021
*        THE GDSOVDAT AND GDSFCBUF FIELDS IN THE GDSCB ARE SET TO       72600021
*        ZERO TO INDICATE THAT THERE IS NO FLOW CONTROL ENTRY FOR       72800021
*        THIS GDS AND CONTROL IS RETURNED TO THE CALLING PROGRAM.       73000021
         XC    GDSOVDAT(4),GDSOVDAT ZERO GDSCB FIELDS                   73200021
         XC    GDSFCBUF(2),GDSFCBUF                                     73400021
         B     FLC00030            EXIT                                 73600021
FLC00090 LH    ENTRY,BUFADR(TABLE)                                      73800021
         B     FLC00080                                                 74000021
         EJECT                                                          74200021
**                                                                      74400021
**                                                                      74600021
**       CODE 4                                                         74800021
**       DELETE THE FLOW CONTROL STRUCTURE                              75000021
**                                                                      75200021
**                                                                      75400021
*                                                                       75600021
*        TO DELETE THE FLOW CONTROL STRUCTURE AND TABLE THE FOLLOWING   75800021
*        OCCURS.  FIRST OUTSTANDING I/O IS WAITED ON.  THEN THE         76000021
*        REGENERATION IN THE BUFFER IS HALTED.  THIS IS WAITED ON AND   76200021
*        THEN THE STORAGE OBTAINED FOR THE FLOW CONTROL TABLE AND THE   76400021
*        DECB IS FREED.                                                 76600021
*                                                                       76800021
FLC00100 L     GTMREG,4(PARM)      LOAD GTMCB                           77000021
         L     REGB,GTMDECB1       LOAD DECB                            77200021
         LR    PARM,REGB                                                77400021
         WAIT  ECB=(1)             WAIT ON PRIOR I/O                    77600021
         CLI   0(REGB),X'7F'                                            77660021
         BNE   ERR3                                                     77720021
         XC    0(4,REGB),0(REGB)   ZERO ECB                             77800021
         L     TABLE,GTMFCTBL      TABLE ADDR                           78000021
         LA    REGA,BUFADR(TABLE)  ADDRESS AT WHICH TO STOP             78200021
         L     REGC,GTMGRDCB       DCB ADDR                             78400021
         LR    PARM,REGB                                                78600021
         GCNTRL (PARM),HLT,(REGC),(REGA),MF=E HALT REGENERATION         78800021
         LR    PARM,REGB                                                79200021
         WAIT  ECB=(1)             WAIT ON I/O                          79400021
         CLI   0(REGB),X'7F'                                            79460021
         BNE   ERR3                                                     79520021
         LA    REGZERO,FLCTLTBL         LENGTH OF TABLE            1720 79560021
         LR    PARM,TABLE          ADDR OF TABLE                        79600021
         FREEMAIN R,LV=(0),A=(1)   FREE TABLE & DECB                    79800021
*                                                                       80000021
*        BUFFER IS NOT FREED BECAUSE BUFFER MANAGEMENT WILL             80200021
*        DO A RLSEALL WHEN TRMDEV CALLS IT.                             80400021
*                                                                       80600021
*                                                                       80800021
*        THE ADDRESS OF THE FLOW CONTROL TABLE AND THE DECB ARE SET     81000021
*        TO ZERO IN THE GDMCB AND CONTROL IS RETURNED TO THE CALLING    81200021
*        PROGRAM.                                                       81400021
*                                                                       81600021
         XC    GTMFCTBL(4),GTMFCTBL ZERO ADDR OF FLOW CTL TABLE         81800021
         XC    GTMDECB1(4),GTMDECB1 ZERO DECB ADDR                      82000021
         B     FLC00030            EXIT                                 82200021
         EJECT                                                          82400021
*                                                                       82600021
ERR1     L     REGA,WRKRTNCD                                            82800021
         MVC   STOREXCD(4,REGA),BUFFER SET BUFFER EXCEED                83000021
ERR1A    MVI   0(REGA),EXCEED      SET STORAGE EXCEEDED CODE            83200021
ERR1B    L     SAVE,4(SAVE)                                             83400021
         RETURN (14,12),RC=4                                            83600021
*                                                                       83800021
ERR2     L     REGA,GTMGRDCB                                            84000021
         MVC   WRKSPACE+8(2),16(REGA) MOVE IN BUFFER ADDR               84200021
         LA    REGB,WRKSPACE+8                                          84400021
         RLSEBFR (REGA),(REGB),MF=(E,WRKSPACE) RELEASE BUFFER           84600021
         L     REGA,WRKRTNCD                                            84800021
         MVC   STOREXCD(4,REGA),STORAGE                                 85000021
         B     ERR1A                                                    85200021
ERR3     L     REGA,WRKRTNCD                                            85250021
         OI    0(REGA),IO                                               85300021
         B     ERR1B                                                    85350021
         EJECT                                                          85400021
FLC00110 EQU   ERR2                                                     85600021
REGZERO  EQU   0                                                        85800021
PARM     EQU   1                                                        86000021
REGA     EQU   2                                                        86200021
REGB     EQU   3                                                        86400021
REGE     EQU   4                                                        86600021
WORK     EQU   5                                                        86800021
GSPREG   EQU   6                                                        87000021
REGF     EQU   6                   ONLY USED IN CODE 2                  87200021
GTMREG   EQU   7                                                        87400021
GDSREG   EQU   8                                                        87600021
BASE     EQU   9                                                        87800021
TABLE    EQU   10                                                       88000021
REGC     EQU   11                                                       88200021
SAVE     EQU   13                                                       88400021
RETURN   EQU   14                                                       88600021
ENTRY    EQU   15                                                       88800021
FREE     EQU   0                                                        89000021
INUSE    EQU   4                                                        89200021
BUFADR   EQU   8                                                        89400021
DUMMY    EQU   10                                                       89600021
TBLEND   EQU   60                                                       89800021
FLCTLTBL EQU   92                                                       90000021
GETMN    EQU   4                                                        90200021
ASGNBFR  EQU   71                                                       90400021
INUSELEN DC    F'50'                                                    90600021
IO       EQU   X'04'                                                    90800021
BUFSTART EQU   24                                                  5743 90850021
MOVE     MVC   2(1,REGA),4(REGA)   OVERLAY TABLE TO REMOVE ENTRY        91000021
         EJECT                                                          91200021
ORDER    GINIT                                                          91400021
FIRSTORD GSRT                                                           91600021
         GTRU  *+2                                                      91800021
         GESD                                                           92000021
         GTRU  *+2                                                      92200021
         GTRU  FIRSTORD                                                 92400021
ENTRYORD GDPD                                                           92600021
         GTRU  *+2                                                      92800021
         GTRU  FIRSTORD                                                 93000021
CODE     EQU   3                                                        93200021
GDS      EQU   4                                                        93400021
TWO      DC    F'2'                                                     93600021
STOREXCD EQU   12                                                       93800021
BUFFER   DC    F'3'                                                     94000021
EXCEED   EQU   X'10'                                                    94200021
STORAGE  DC    F'4'                                                     94400021
         EJECT                                                          94600021
WORKAREA DSECT                                                          94800021
WRKPARM  DS    F                                                        95000021
WRKRTNCD DS    F                                                        95200021
WRKSPACE DS    4F                                                       95400021
WRKSAVE  DS    18F                                                      95600021
         COPY  GSPCB                                                    95800021
         COPY  GTMCB                                                    96000021
         COPY  GDSCB                                                    96200021
         END                                                            96400021
./  ADD  SSI=20740240,NAME=IFFAHA02
*                                                                       00100013
*        BUFFER MANAGEMENT IS ENTERED FROM SEVERAL ROUTINES FROM        00200013
*        SEVERAL DIFFERENT PURPOSES.  THE BUFFER CONTROL TABLE IS       00300013
*        INITIALIZED TO ZERO BY INDEV.                                  00400013
*                                                                       00500013
*        CODE 1                                                         00600013
*        ENTRY IS MADE FROM DATA STORE-IFFAHAO5 REQUESTING 128 BYTES    00700013
*        OF BUFFER.  THIS IS THE FIRST BUFFER REQUEST FOR THIS GDS.     00800013
*        REGISTER ONE CONTAINS THE ADDRESS OF A WORK AREA.  THE         00900013
*        FIRST WORD OF THIS WORK AREA CONTAINS THE ADDRESS OF           01000013
*        A PARAMETER LIST:                                              01100013
*                                                                       01200013
*        +0     A(1)                                                    01300013
*        +4     A(GDSCB)                                                01400013
*                                                                       01500013
*        CODE 2                                                         01600013
*        ENTRY IS MADE FROM DATA STORE-IFFAHAO5 REQUESTING BUFFER FOR   01700013
*        THE FIRST TIME FOR THIS GDS.  REGISTER ONE CONTAINS THE        01800013
*        ADDRESS OF A WORK AREA.  THE FIRST WORD OF THIS WORK AREA      01900013
*        CONTAINS THE ADDRESS OF A PARAMETER LIST:                      02000013
*                                                                       02100013
*        +0     A(2)                                                    02200013
*        +4     A(GDSCB)                                                02300013
*        +8     A(SIZE)                                                 02400013
*                                                                       02500013
*        CODE 3                                                         02600013
*        ENTRY IS MADE FROM DATA STORE-IFFAHAO5 REQUESTING ADDITIONAL   02700013
*        BUFFER FOR A GDS.  THE AMOUNT OF BUFFER REQUIRED WILL BE       02800013
*        TAKEN FROM THE GDSGDOAL FIELD IN THE GDSCB.  THE PARAMETER     02900013
*        LIST IS AS FOLLOWS:                                            03000013
*                                                                       03100013
*        +0     A(3)                                                    03200013
*        +4     A(GDSCB)                                                03300013
*                                                                       03400013
*        CODE 4                                                         03500013
*        ENTRY IS MADE FROM TMGDS-IFFAAAO6 REQUESTING THAT THE          03600013
*        128 BYTE SUBSEGMENT OBTAINED FOR THIS GDS BE FREED.            03700013
*        THE PARAMETER LIST IS AS FOLLOWS:                              03800013
*                                                                       03900013
*        +0     A(4)                                                    04000013
*        +4     A(GDSCB)                                                04100013
*                                                                       04200013
*        CODE 5                                                         04300013
*        ENTRY IS MADE FROM TMGDS-IFFAAAO6 REQUESTING THAT ALL          04400013
*        BUFFER ASSIGNED TO THIS GDS BE FREED.                          04500013
*        THE PARAMETER LIST IS AS FOLLOWS:                              04600013
*                                                                       04700013
*        +0     A(5)                                                    04800013
*        +4     A(GDSCB)                                                04900013
*                                                                       05000013
*        CODE 6                                                         05100013
*        ENTRY IS MADE FROM RESET-IFFAFA12 REQUESTING THAT ALL          05200013
*        BUFFER BEYOND THE ONE WHOSE DISPLACEMENT IS PASSED BE          05300013
*        FREED.  THE PARAMETER LIST CONTAINS THE DISPLACEMENT IN        05400013
*        THE BUFFER CONTROL TABLE FOR THE LAST BUFFER SEGMENT           05500013
*        TO BE RETAINED.  THE PARAMETER LIST IS AS FOLLOWS:             05600013
*                                                                       05700013
*        +0     A(6)                                                    05800013
*        +4     A(GDSCB)                                                05900013
*        +8     A(DISP)                                                 06000013
*                                                                       06100013
*        CODE 7                                                         06200013
*        ENTRY IS MADE FROM TMDEV-IFFAAAO4 TO RELEASE ALL BUFFER        06300013
*        ASSIGNED TO THIS 2250.  BUFFER MANAGEMENT WILL ISSUE A         06400013
*        RLSEBFR-ALL MACRO AND THIS WILL ALSO RELEASE THE BUFFER        06500013
*        FLOW CONTROL MANAGEMENT OBTAINED EVEN THOUGH BUFFER MANAGE-    06600013
*        MENT DOES NOT KEEP A RECORD OF THAT BUFFER.                    06700013
*        THE PARAMETER LIST IS AS FOLLOWS:                              06800013
*                                                                       06900013
*        +0     A(7)                                                    07000013
*        +4     A(GTMCB)                                                07100013
*                                                                       07200013
*        EXTERNAL MACROS USED ARE:                                      07300013
*                                                                       07400013
*        ASGNBFR                                                        07500013
*        RLSEBFR                                                        07600013
*                                                                       07700013
*                                                                       07800013
*        THE BUFFER CONTROL TABLE CONTAINS THREE BYTE ENTRIES WHICH     07900013
*        VARY DEPENDING ON HOW THE BUFFER IS ASSIGNED.  THE DIFFERENT   08000013
*        RECOGNIZEABLE CODES USED ARE AS FOLLOWS:                       08100013
*        00 IF ALL THREE TYPES CONTAIN ZERO THE SEGMENT IS NOT          08200013
*        ASSIGNED.                                                      08300013
*        01-7F IF THE FIRST BYTE CONTAINS ONE OF THESE CODES THE        08400013
*        SEGMENT IS ASSIGNED TO A GDS WHICH HAS A GDOA LENGTH WHICH     08500013
*        IS A MULTIPLE OF 256.                                          08600013
*        80 THIS IS THE CODE WHEN HALF OF A SEGMENT IS NOT ASSIGNED     08700013
*        AND THE OTHER HALF IS ASSIGNED TO A 128 GDS.  IT MAY           08800013
*        APPEAR IN THE FIRST OR SECOND BYTE OF THE ENTRY BUT IF         08900013
*        IT IS IN THE SECOND BYTE, THE FIRST BYTE WILL CONTAIN A        09000013
*        NUMBER BETWEEN 81 AND FF.                                      09100013
*        81-FF IF EITHER THE FIRST OR SECOND TYTE OF AN ENTRY           09200013
*        CONTAINS ONE OF THESE CODES HALF THE BUFFER IS ASSIGNED TO     09300013
*        THE GDS WHICH HAS THIS ID.  IF THE CODE IS IN THE FIRST        09400013
*        HALF THE FIRST HALF IS ASSIGNED, IF IN THE SECOND HALF,        09500013
*        THE SECOND HALF IS ASSIGNED.                                   09600013
*                                                                       09700013
*                                                                       09800013
*        EXAMPLES OF SUBSEGMENTS (128 BYTE GDOA)                        09900013
*        BYTE 1     BYTE2     BYTE3                                     10000013
*        X'80'      X'92'     X'00' FIRST UNASSIGNED, SECOND ASSIGNED   10100013
*        X'87'      X'80'     X'00' FIRST ASSIGNED, SECOND UNASSIGNED   10200013
*        X'83'      X'F2'     X'00' BOTH ASSIGNED.                      10300013
*                                                                       10400013
*        NOTE THAT BYTE3 IS ALWAYS ZERO. X'80' IN BYTES ONE AND TWO     10500013
*        CAN NEVER OCCUR BECAUSE IF BOTH ARE FREE THE SLOT IS SET TO    10600013
*        ZERO AND THE BUFFER IS RETURNED TO THE SYSTEM.                 10700013
*                                                                       10800013
*        EXAMPLES OF 256 SEGMENTS (256 BYTE GDOA)                       10900013
* DISP   BYTE1      BYTE2     BYTE3                                     11000013
* +0     X'02'      X'02'     X'00' FIRST ASSIGNED                      11100013
* +3     X'02'      X'01'     X'02' LAST ON CHAIN                       11200013
* +6     X'02'      X'01'     X'01' SECOND ASSIGNED                     11300013
*                                                                       11400013
*        THE FIRST ASSIGNED GETS THE UNIQUE CODE, X'02' THE COUNT (BYTE 11500013
*        3) IS ZERO TO SIGNIFY THIS IS THE FIRST ASSIGNED.  THE SECOND  11600013
*        BYTE POINTS TO THE NEXT ON THE CHAIN.  THE SECOND ASSIGNED HAS 11700013
*        A COUNT OF ONE AND POINTS TO THE THIRD.  THE THIRD HAS A COUNT 11800013
*        OF TWO AND POINTS TO ITSELF TO SIGNIFY LAST ON CHAIN.  THE     11900013
*        REASON FOR THE COUNT IS THAT THE LOGICAL ADDRESS DIVIDED BY    12000013
*        THE GDOA LENGTH WILL GIVE THE SEGMENT COUNT WHEN CONVERTING    12100013
*        FROM LOGICAL TO PHYSICAL BUFFER ADDRESSES                      12200013
*                                                                       12300013
*                                                                       12400013
*        EXAMPLE OF 768 SEGMENT (768 BYTE GDOA)                         12500013
* DISP   BYTE1      BYTE2     BYTE3                                     12600013
* +0                                                                    12700013
* +3     X'05'      X'04'     X'00' FIRST ASSIGNED                      12800013
* +6     X'05'      X'01'     X'FF'                                     12900013
* +9     X'05'      X'01'     X'FF'                                     13000013
* +12    X'05'      X'04'     X'01' SECOND ASSIGNED                     13100013
* +15    X'05'      X'04'     X'FF'                                     13200013
* +18    X'05'      X'04'     X'FF'                                     13300013
*                                                                       13400013
*        THE FIRST ASSIGNED HAS THE ID, PTR TO NEXT, AND COUNT IN       13500013
*        THE FIRST ENTRY.  FOR THE OTHER TWO WHICH ARE CONTINUOUS       13600013
*        WITH THE FIRST AND TOGETHER WITH THE FIRST FORM THE 768        13700013
*        BYTES, THE CODE ALSO IS SET.  THE POINTER FIELD POINTS         13800013
*        BACK TO THE FIRST SEGMENT AND THE COUNT FIELD IS SET TO        13900013
*        X'FF' TO SIGNIFY IT IS A PART OF A LARGER SEGMENT BUT          14000013
*        NOT THE TOP.                                                   14100013
*                                                                       14200013
         EJECT                                                          14300013
IFFAHA02 CSECT                                                          14400013
*2413,299000,300000                                                5858 14450016
*                                                                       14500013
*        ON ENTRY REGARDLESS OF THE REQUEST, BASE REGISTER IS           14600013
*        INITIALIZED, THE SAVE AREAS ARE CHAINED, THE FLAGS ARE         14700013
*        SET TO ZERO.  IF THE CODE IS NOT 7 (RELEASE ALL) THE           14800013
*        GDSCB IS INITIALIZED AND THE GTMCB IS INITIALIZED, AND         14900013
*        REGA CONTAINS THE ADDRESS OF THE BUFFER CONTROL TABLE.         15000013
*        THEN THE ENTRY REQUEST IS DETERMINED AND THE PROPER            15100013
*        LOCATION IN BUFFER MANAGEMENT RECEIVES CONTROL.                15200013
*                                                                       15300013
BUFMGT   SAVE  (14,12)                                                  15400013
         BALR  BASE,0                                                   15500013
         USING *,BASE                                                   15600013
         LR    WORK,PARM           LOAD INTO DSECT REGISTER             15700013
         USING WORKAREA,WORK                                            15800013
         L     PARM,WRKPARM        PICK UP PARAMETER LIST               15900013
         LA    REGA,WRKSAVE        SET UP SAVE AREA                     16000013
         ST    SAVE,WRKSAVE+4                                           16100013
         ST    REGA,8(SAVE)                                             16200013
         LR    SAVE,REGA                                                16300013
         XC    WRKFLAGS(4),WRKFLAGS CLEAR FLAGS                         16400013
         CLI   CODE(PARM),TRMCLS   CODE TO CLOSE TERM                   16500013
         BE    BUF00260                                                 16600013
         L     GDSREG,GDS(PARM)    PICK UP GDS ADDR                     16700013
         USING GDSCB,GDSREG                                             16800013
         L     GTMREG,GDSGTMCB     GTMCB ADDR                           16900013
         USING GTMCB,GTMREG                                             17000013
         L     REGA,GTMBCTBL       BCT TABLE ADDR                       17100013
         CLI   CODE(PARM),SEG128   CODE TO ALLOC 128                    17200013
         BE    BUF00005                                                 17300013
         CLI   CODE(PARM),SEG256   NEW 256 MULTIPLE                     17400013
         BE    BUF00080                                                 17500013
         CLI   CODE(PARM),MORE256  MORE 256 MULT                        17600013
         BE    BUF00130                                                 17700013
         CLI   CODE(PARM),GDSCL128 CLOSE 128                            17800013
         BE    BUF00160                                                 17900013
         CLI   CODE(PARM),GDSCL256 CLOSE MULT 256                       18000013
         BE    BUF00200                                                 18100013
         CLI   CODE(PARM),RESET    RESET                                18200013
         BE    BUF00250                                                 18300013
         WTO   'BUFMGT WRONG CODE'                                      18400013
         EJECT                                                          18500013
**                                                                      18600013
**                                                                      18700013
**       CODE 1                                                         18800013
**       ALLOCATE 128 BYTE BUFFER SEGMENT TO A GDS BEING OPENED         18900013
**                                                                      19000013
**                                                                      19100013
*                                                                       19200013
*        THE CODE 1 THE ENTIRE BUFFER CONTROL TABLE IS SEARCHED         19300013
*        FOR A FREE SUBSEGMENT.  IF ONE IS NOT FOUND, BUFFER IS         19400013
*        ASSIGNED AND THE SECOND HALF OF THE ENTRY FOR THE BUFFER       19500013
*        RECEIVED IS SET TO X'80' SIGNIFYING NOT IN USE AND THE         19600013
*        FIRST HALF IS USED.  A UNIQUE CODE IS OBTAINED BY ADDING       19700013
*        X'81' TO THE GTMBCTSM FIELD OF THE GTMCB OR BY USING           19800013
*        THE INTERNAL SUBROUTINE TO FIND A UNIQUE CODE NOT IN           19900013
*        USE.  THE UNIQUE CODE IS PLACED IN THE BUFFER CONTROL          20000013
*        TABLE AND IN THE GDSCB.  THE ADDRESS OF THE BUFFER             20100013
*        OBTAINED IS RETURNED IN REGISTER ONE AND CONTROL IS            20200013
*        RETURNED TO THE CALLING PROGRAM                                20300013
*                                                                       20400013
BUF00005 LR    REGD,REGA           ADDR OF BCT                          20500013
         LR    REGB,REGA           ADDR OF BCT                          20600013
         LA    REGC,3              ENTRY SIZE                           20700013
         LA    REGD,BCTLEN(REGD)   ADD LENGTH ( FOR LOOP )              20800013
BUF00010 CLI   0(REGB),X'80'       IS SEG DIV?                          20900013
         BNL   BUF00030            YES                                  21000013
BUF00020 BXLE  REGB,REGC,BUF00010  NO LOOK MORE                         21100013
         L     REGB,GTMGRDCB       ADDR OF DCB                          21200013
         LA    REGC,256            ASSIGN                               21300013
         STH   REGC,WRKSPACE+8     BUFFER                               21400013
         ASGNBFR (REGB),WRKSPACE+8,MF=(E,WRKSPACE) ASSIGN BUFFER        21500013
         LTR   15,15                                                    21600013
         BNE   ERR1                                                     21700013
         LH    REGD,16(REGB)       ADDR OF BUFFER                       21800013
         ST    REGD,WRKSPACE       SAVE ADDR OF BUFFER                  21900013
         SRA   REGD,8              DIVIDE BY 256                        22000013
         STH   REGD,GDSBCTEL        PLACE INDEX IN GDSCB                22100013
         M     REGC,=F'3'          MULTIPLY BY 3 FOR DISPLACEMENT       22200013
         AR    REGD,REGA                                                22300013
         MVI   1(REGD),X'80'       SET SECOND BYTE=NOT IN USE           22400013
         B     BUF00060                                                 22500013
BUF00030 CLI   0(REGB),X'80'       IS BYTE IN USE                       22600013
         BE    BUF00040            NO                                   22700013
         CLI   1(REGB),X'80'       YES, IS SECOND IN USE                22800013
         BNE   BUF00020            YES, LOOK SOME MORE                  22900013
         OI    WRKFLAGS,X'01'      SET SECOND BYTE FLAG                 23000013
BUF00040 LR    REGD,REGB           COMPUTE DISPLACEMENT                 23100013
         SR    REGD,REGA                                                23200013
         SR    REGC,REGC           FOR DIVIDE                           23300013
         D     REGC,=F'3'     BUFFER ADDRESS IN REGD                    23400013
         STH   REGD,GDSBCTEL       INDEX TO ELEMENT                     23500013
         SLA   REGD,8              MULTIPLY BY 256                      23600013
         CLI   WRKFLAGS,X'01'                                           23700013
         BNE   BUF00050                                                 23800013
         LA    REGD,128(REGD)                                           23900013
         ST    REGD,WRKSPACE  SAVE BUFFER ADDRESS                       24000013
         LA    REGB,1(REGB)   UPDATE TO SECOND BYTE                     24100013
BUF00050 LR    REGD,REGB      SET PTR IN REGD                           24200013
BUF00060 CLI   GTMBCTSM,X'7E' CAN ID BE OBTAINED EASILY                 24300013
         BH    BUF00075       LINK TO CODE FINE ROUTINE                 24400013
         IC    REGC,GTMBCTSM                                            24500013
         LA    REGB,X'81'     COMPUTE NEW ID                            24600013
         AR    REGB,REGC                                                24700013
         LA    REGC,1(REGC)                                             24800013
         STC   REGC,GTMBCTSM  UPDATE INDEX                              24900013
BUF00065 STC   REGB,GDSBCTID  PLACE IN GDSCB                            25000013
         STC   REGB,0(REGD)   PLACE CODE IN BCT                         25100013
BUF00067 LH    PARM,WRKSPACE+2     SET BUFFER ADDR IN REG 1             25200013
BUF00070 L     SAVE,4(SAVE)   RESET SAVE AREA                           25300013
         LM    14,0,12(SAVE)  RELOAD REGS                               25400013
         LM    2,12,28(SAVE)                                            25500013
         LA    15,0           SET RETURN = 0                            25600013
         BR    14             RETURN                                    25700013
BUF00075 LA    RETURN,BUF00065     RETURN ADDRESS                       25800013
         LA    REGB,X'81'          FIRST CODE                           25900013
         B     BUF00280            GO TO UNIQUE CODE FIND ROUTINE       26000013
         EJECT                                                          26100013
**                                                                      26200013
**                                                                      26300013
**       CODE 2                                                         26400013
**       ALLOCATE 256 BYTE SEGMENT(S) TO A GDS BEING OPENED             26500013
**                                                                      26600013
**                                                                      26700013
*                                                                       26800013
*        FOR CODE 2 BUFFER IS ASSIGNED FOR THE LENGTH DESIRED.          26900013
*        A UNIQUE CODE IS OBTAINED BY ADDING X'01' TO THE               27000013
*        GTMBCTLG FIELD IN THE GTMCB OR BY USING THE INTERNAL           27100013
*        SUBROUTINE TO FIND A UNIQUE CODE NOT IN USE.  THE              27200013
*        BUFFER CONTROL TABLE ENTRY IS SET UP AND THE UNIQUE            27300013
*        CODE, AND THE DISPLACEMENT IN THE BUFFER CONTROL               27400013
*        TABLE ARE PLACED IN THE GDSBCTID AND GDSBCTEL FIELDS           27500013
*        IN THE GDSCB.  THE ADDRESS OF THE BUFFER OBTAINED IS           27600013
*        RETURNED IN REGISTER ONE AND CONTROL IS RETURNED TO            27700013
*        THE CALLING PROGRAM.                                           27800013
*                                                                       27900013
BUF00080 L     REGB,8(PARM)        LENGTH OF BUFFER DESIRED             28000013
         STH   REGB,WRKSPACE+8                                          28100013
         L     REGB,GTMGRDCB       ADDR OF DCB                          28200013
         ASGNBFR (REGB),WRKSPACE+8,MF=(E,WRKSPACE) ASSIGN BUFFER        28300013
         LTR   15,15                                                    28400013
         BNE   ERR1                NO MORE BUFFER                       28500013
         LH    REGD,16(REGB)       ADDR OF BUFFER                       28600013
         ST    REGD,WRKSPACE       SAVE IT                              28700013
         SRA   REGD,8              DIVIDE BY 256                        28800013
         STH   REGD,GDSBCTEL       SAVE IN GDS                          28900013
         LR    REGF,REGD           BCT DISP                             29000013
         M     REGC,=F'3'                                               29100013
         LR    REGC,REGF                                           5858 29150016
         AR    REGD,REGA           DISP IN BCT                          29200013
         LH    REGA,18(REGB)       LENGTH                               29300013
         CLI   GTMBCTLG,X'7E'      HAVE ALL LARGE CODES BEEN USED       29400013
         BH    BUF00125            YES                                  29500013
         IC    REGB,GTMBCTLG       PICK UP CODE                         29600013
         LA    REGB,1(REGB)        TO GET ACTUAL CODE                   29700013
         STC   REGB,GTMBCTLG       FOR NEXT PASS                        29800013
BUF00090 STC   REGB,GDSBCTID       SAVE ID IN GDS                  5858 29870016
         LR    REGF,REGC                                           5858 29940016
         SR    REGC,REGC           INDEX                           5858 30010016
         SRA   REGA,8              DIVIDE BY 256 TO DET NO OF SEGMENTS  30100013
         LR    REGE,REGA           SAVE COUNT OF SEGMENTS               30200013
BUF00100 STC   REGB,0(REGC,REGD)   STORE CODE                           30300013
         LA    REGC,3(REGC)        TO NEXT SEGMENT                      30400013
         BCT   REGA,BUF00100       ALL DONE                             30500013
         LR    REGB,REGF           PTR TO SELF                          30600013
         SR    REGC,REGC           INDEX REG                            30700013
         LR    REGA,REGE           COUNT                                30800013
         STC   REGF,1(REGD)        LAST ON CHAIN INDICATOR              30900013
         B     BUF00115            BRANCH AROUND FIRST STORE            31000013
BUF00110 STC   REGB,1(REGC,REGD)   STORE PTR                            31100013
BUF00115 LA    REGC,3(REGC)        TO NEXT                              31200013
         BCT   REGA,BUF00110       ALL DONE                             31300013
*                                  COUNT IN FIRST SEGMENT IS ZERO THREE 31400013
*                                  FORE IT NEED NOT BE SET.             31500013
*                                  CODE 3 WILL SET COUNT FIRST          31600013
         BCTR  REGE,0              REDUCE CT BY ONE IF ONLY ONE         31700013
         LTR   REGE,REGE           ONLY ONE                             31800013
         BE    BUF00067                                                 31900013
         LA    REGB,X'FF'          CODE SAYING PART OF LARGE SEGMENT    32000013
BUF00120 LA    REGD,3(REGD)        UPDATE TO NEXT SEGMENT               32100013
         STC   REGB,2(REGD)        STORE CODE IN COUNT FIELD            32200013
         BCT   REGE,BUF00120       CONTINUE                             32300013
         B     BUF00067            EXIT                                 32400013
BUF00125 LA    RETURN,BUF00090     RETURN                               32500013
         LA    REGB,X'01'          FIRST CODE                           32600013
         B     BUF00280            ROUTINE TO FIND A CODE               32700013
         EJECT                                                          32800013
**                                                                      32900013
**                                                                      33000013
**       CODE 3                                                         33100013
**       ALLOCATE AN ADDITIONAL 256 OR MORE TO A GDS ALREADY OPEN       33200013
**                                                                      33300013
**                                                                      33400013
*                                                                       33500013
*        FOR CODE 3 A CHECK IS MADE TO SEE IF THE GDS IS NOT            33600013
*        A 128 SUBSEGMENT GDS AND IF NOT THE !UFFER IS ASSIGNED         33700013
*        FOR THE GDOA LENGTH IN THE GDSCB.  THE ENTRY IS BUILT          33800013
*        IN THE BUFFER CONTROL TABLE, THE ENTRY IS CHAINED TO           33900013
*        THE PREVIOUS ENTRY AND THE ADDRESS OF THE BUFFER OBTAINED      34000013
*        IS RETURNED IN REGISTER ONE.  THIS ENTRY USES PART OF          34100013
*        THE CODE FOR CODE 2 ENTRIES.                                   34200013
*                                                                       34300013
BUF00130 CLI   GDSBCTID,X'80'      WAS A SUBSEGMENT ASSIGNED            34400013
         BH    ERR2                YES, NO MORE BUFFER ALLOWED          34500013
         TM    GDSFLAGS,EQUIV        IS THIS AN EQUIV                   34600013
         BO    ERR2                YES NO MORE BUFFER ALLOWED           34700013
         L     REGB,GTMGRDCB       PICK UP DCB                          34800013
         ASGNBFR (REGB),GDSGDOAL,MF=(E,WRKSPACE)                        34900013
         LTR   15,15                                                    35000013
         BNE   ERR1                NO BUFFER                            35100013
         LH    REGD,16(REGB)       ADDR OF BUFFER                       35200013
         ST    REGD,WRKSPACE       SAVE ADDR                            35300013
         SRA   REGD,8              DIVIDE BY 256                        35400013
         LH    REGC,GDSBCTEL                                            35500013
         MH    REGC,THREE+2                                             35600013
         SR    REGE,REGE                                                35700013
         LA    REGF,1              REGF=1 FOR COUNT                     35800013
BUF00140 IC    REGE,1(REGC,REGA)   POINTER FIELD                        35900013
         MH    REGE,THREE+2        DISP IN TABLE                        36000013
         CR    REGE,REGC           LAST ONE                             36100013
         BE    BUF00150                                                 36200013
         LR    REGC,REGE           PTR TO NEXT                          36300013
         SR    REGE,REGE                                                36400013
         LA    REGF,1(REGF)        UPDATE COUNT                         36500013
         B     BUF00140            LOOK SOME MORE                       36600013
BUF00150 STC   REGD,1(REGC,REGA)   UPDATE PTR                           36700013
         LR    REGC,REGD           SAVE PTR                             36800013
         MH    REGD,THREE+2        DISP                                 36900013
         STC   REGF,2(REGD,REGA)   STORE COUNT                          37000013
         LR    REGF,REGC                                                37100013
         AR    REGD,REGA           DISP & TABLE START                   37200013
*                                  THE REMAINDER OF CODE 3 IS JUST LIKE 37300013
*                                  CODE 2 SO WE WILL USE THAT CODING.   37400013
         LH    REGA,18(REGB)       REGA HAS LENGTH                      37500013
*                                  REGD HAS TABLE LOC OF SEGMENT        37600013
         IC    REGB,GDSBCTID       REGB HAS ID CODE                     37700013
         B     BUF00090            GO TO CODE 2 CODE                    37800013
         EJECT                                                          37900013
**                                                                      38000013
**                                                                      38100013
**       CODE 4                                                         38200013
**       RELEASE 128 BYTES OF A SEGMENT BEING CLOSED                    38300013
**                                                                      38400013
**                                                                      38500013
*                                                                       38600013
*        FOR CODE 4 IT IS DETERMINED IF THE OTHER HALF OF THE           38700013
*        BUFFER SEGMENT IS ASSIGNED.  IF IT IS THE CODE FOR THIS        38800013
*        GDS IS REMOVED FROM THE GDSCB AND THE BUFFER CONTROL           38900013
*        TABLE ENTRY AND CONTROL IS RETURNED TO THE CALLING             39000013
*        PROGRAM.  IF BOTH SEGMENTS ARE FREE THE BUFFER IS              39100013
*        RELEASED AND THE ENTIRE BUFFER CONTROL ENTRY IS SET TO         39200013
*        ZERO.  THE ID IS ZEROED IN THE GDSCB AND CONTROL               39300013
*        IS RETURNED TO THE CALLING PROGRAM.                            39400013
BUF00160 L     REGB,THREE                                               39500013
         MH    REGB,GDSBCTEL       DISP IN TABLE                        39600013
         AR    REGA,REGB           PLUS TABLE ADDR                      39700013
         CLC   0(1,REGA),GDSBCTID  IS FIRST HALF ASSIGNED               39800013
         BE    BUF00180            YES                                  39900013
         MVI   1(REGA),X'80'       SET FREE SWITCH                      40000013
         CLI   0(REGA),X'80'       IS OTHER HALF FREE                   40100013
         BE    BUF00190                                                 40200013
BUF00170 XC    GDSBCTEL(2),GDSBCTEL ZERO INDEX                          40300013
         MVI   GDSBCTID,X'00'      ZERO ID                              40400013
         B     BUF00070            RETURN                               40500013
BUF00180 MVI   0(REGA),X'80'       SET FREE SWITCH                      40600013
         CLI   1(REGA),X'80'       SECOND FREE                          40700013
         BNE   BUF00170            NO                                   40800013
BUF00190 XC    0(3,REGA),0(REGA)   ZERO OUT SLOT                        40900013
         LH    REGB,GDSBCTEL       DISP IN TABLE                        41000013
         SLA   REGB,8              ADDR OF BUFFER                       41100013
         STH   REGB,WRKSPACE+8     STORE IN HALFWORD                    41200013
         LA    REGB,256            LENGTH                               41300013
         STH   REGB,WRKSPACE+10    IN OTHER HALFWORD                    41400013
         L     REGB,GTMGRDCB       DCB                                  41500013
         RLSEBFR (REGB),WRKSPACE+8,MF=(E,WRKSPACE) RELEASE BUFFER       41600013
         B     BUF00170                                                 41700013
         EJECT                                                          41800013
**                                                                      41900013
**                                                                      42000013
**       CODE 5                                                         42100013
**       RELEASE ALL 256 BYTE SEGMENTS ALLOCATED TO A GDS BEING CLOSED  42200013
**                                                                      42300013
**                                                                      42400013
*                                                                       42500013
*        FOR CODE 5 A CHECK IS MADE TO SEE IF ALL BUFFER WAS            42600013
*        RELEASED BY THE TMDEV ROUTINE PREVIOUSLY AND IF SO             42700013
*        RETURN IS MADE TO THE CALLING PROGRAM.  OTHERWISE THE          42800013
*        BUFFER CONTROL TABLE IS CHAINED THROUGH, THE BUFFER            42900013
*        IS FREED AND ALL ENTRIES ARE SET TO ZERO.  THE GDSBCTEL        43000013
*        AND GDSBCTID FIELDS OF THE GDSCB ARE SET TO ZERO.  WHEN        43100013
*        ALL BUFFER IS FREED, RETURN IS MADE TO THE CALLING PROGRAM.    43200013
*                                                                       43300013
BUF00200 CLI   GDSBCTID,X'00'      RELEASED BY TERMINAL                 43400013
         BE    BUF00070            RETURN                               43500013
         LH    REGB,GDSBCTEL       DISP                                 43600013
         MH    REGB,THREE+2        DISP IN TBL                          43700013
         XC    GDSBCTEL(2),GDSBCTEL ZERO OUT FIELD                      43800013
         MVI   GDSBCTID,X'00'      ZERO ID                              43900013
BUF00210 L     REGF,GTMGRDCB       LOAD DCB                             44000013
         MVC   WRKSPACE+10(2),GDSGDOAL LEN OF BUFFER                    44100013
BUF00215 LR    REGC,REGB           DISP                                 44200013
         SLA   REGC,8              TIMES BUFFER LEN OF 256 = BUF ADDR   44300013
         SRDA  REGC,32             SHIFT TO ODD REGISTER FOR DIVIDE     44400013
         D     REGC,THREE          DIVIDE BY THREE                      44500013
         STH   REGD,WRKSPACE+8                                          44600013
         RLSEBFR (REGF),WRKSPACE+8,MF=(E,WRKSPACE)                      44700013
         SR    REGD,REGD           ZERO REGISTER                        44800013
         IC    REGD,1(REGB,REGA)   PICK UP NEXT PTR                     44900013
         MH    REGD,THREE+2        DISP IN TBL                          45000013
         CR    REGD,REGB           ALL DONE                             45100013
         BE    BUF00240            YES                                  45200013
BUF00220 LH    REGE,GDSGDOAL       LENGTH DIV BY                        45300013
         SRA   REGE,8              256 = NO OF SEGMENTS                 45400013
         AR    REGB,REGA           DISP + BCT ADD                       45500013
BUF00230 XC    0(3,REGB),0(REGB)   ZERO SLOT                            45600013
         LA    REGB,3(REGB)        TO NEXT SLOT                         45700013
         BCT   REGE,BUF00230                                            45800013
         CLI   WRKFLAGS,X'FF'      ALL DONE                             45900013
         BE    BUF00070            YES, LEAVE                           46000013
         LR    REGB,REGD           UPDATE REGS                          46100013
         B     BUF00215            GO RELEASE REST                      46200013
BUF00240 MVI   WRKFLAGS,X'FF'      SET ALL DONE FLAGS                   46300013
         B     BUF00220            RETURN TO CLEAR SLOTS                46400013
         EJECT                                                          46500013
**                                                                      46600013
**                                                                      46700013
**       CODE 6                                                         46800013
**       RELEASE ONE OR MORE 256 BYTE SEGMENTS RECENTLY ALLOCATED TO A  46900013
**       GDS REMAINING OPEN.                                            47000013
**                                                                      47100013
*                                                                       47200013
*        FOR CODE 6 A CHECK IS MADE TO SEE IF THE DISPLACEMENT IN       47300013
*        THE BUFFER CONTROL TABLE THAT WAS PASSED POINTS TO THE         47400013
*        LAST ENTRY IN THE TABLE FOR THAT GDS.  IF SO CONTROL IS        47500013
*        RETURNED TO THE CALLING PROGRAM.  OTHERWISE POINTERS ARE       47600013
*        SET UP TO THE BUFFER THAT MUST BE RELEASED AND THE CODING      47700013
*        FOR CODE 5 IS USED TO FREE THE BUFFER AND ZERO THE BUFFER      47800013
*        CONTROL TABLE.  THEN RETURN IS MADE TO THE CALLING PROGRAM.    47900013
*                                                                       48000013
BUF00250 SR    REGB,REGB                                                48100013
         L     REGC,8(PARM)        LOAD BUFFER SEGMENT ADDR             48200013
         LR    REGD,REGC           PTR TO SELF                          48300013
         MH    REGC,THREE+2        DISP IN TBL                          48400013
         IC    REGB,1(REGC,REGA)   OBTAIN PTR                           48500013
         MH    REGB,THREE+2                                             48600013
         CR    REGB,REGC           IS THIS THE LAST SEGMENT             48700013
         BE    BUF00070            YES                                  48800013
         STC   REGD,1(REGC,REGA)   SET PTRS TO LAST ON CHAIN            48900013
         B     BUF00210            NO GO TO CODE 5 TO RELEASE BUFFER.   49000013
         EJECT                                                          49100013
**                                                                      49200013
**                                                                      49300013
**       CODE 7                                                         49400013
**       RELEASE ALL BUFFER SEGMENTS CURRENTLY ASSIGNED TO A TERM BEING 49500013
**       CLOSED                                                         49600013
**                                                                      49700013
*                                                                       49800013
*        FOR CODE 7 ALL BUFFER IS RELEASED USING THE ALL PARAMETER      49900013
*        IN THE RLSEBFR MACRO.  THE ENTIRE BUFFER CONTROL TABLE IS      50000013
*        SET TO ZERO.  ALL GDSS STILL OPEN HAVE THEIR ID BYTES AND      50100013
*        DISPLACEMENT FIELDS SET TO ZERO.  CONTROL IS THEN RETURNED     50200013
*        TO THE CALLING PROGRAM.                                        50300013
*                                                                       50400013
BUF00260 L     GTMREG,4(PARM)      LOAD ADDR OF GTMCB                   50500013
         L     REGB,GTMGRDCB            ADDR OF DCB                     50600013
         RLSEBFR (REGB),ALL,MF=(E,WRKSPACE) RELEASE ALL BUFFER          50700013
         L     REGA,GTMBCTBL       LOAD ADDR OF BCT                     50900013
         XC    0(256,REGA),0(REGA) ZERO BCT                             51000013
         XC    256(BCTACTLN-256,REGA),256(REGA)                         51100013
         L     GDSREG,GTMGDSCB     PICK UP GDS                          51200013
BUF00270 LTR   GDSREG,GDSREG       ANY THERE                            51300013
         BE    BUF00070            EXIT                                 51400013
         MVI   GDSBCTID,X'00'       ZERO ID                             51500013
         XC    GDSBCTEL(2),GDSBCTEL ZERO ELEM                           51600013
         L     GDSREG,GDSNXGDS     NEXT ON CHAIN                        51700013
         B     BUF00270                                                 51800013
         EJECT                                                          51900013
**                                                                      52000013
**                                                                      52100013
**       ROUTINE TO FIND A UNIQUE CODE. THERE MUST BE ONE AT LEAST      52200013
**       BECAUSE ONLY 24 SEPARATE GDS' ARE ALLOWED                      52300013
**       USES REGS E AND F RETURNS CODE IN REGB                         52400013
**                                                                      52500013
BUF00280 MVI   WRKFLAGS+1,X'00'    ZERO FLAGS TO SAY ONLY ONCE          52600013
BUF00290 STC   REGB,WRKSPACE       CODE                                 52700013
         L     REGF,GTMBCTBL       ADDR OF TABLE                        52800013
BUF00300 LA    REGE,BCTENTRS       LOOP CONTROL (INNER)                 52900013
BUF00310 CLC   0(1,REGF),WRKSPACE  IS IT USED                           53000013
         BE    BUF00320            YES                                  53100013
         LA    REGF,3(REGF)        NOT YET                              53200013
         BCT   REGE,BUF00310                                            53300013
         CLI   WRKSPACE,X'80'      IS IT A LARGE CODE                   53400013
         BCR   4,RETURN            YES, WE FOUND IT                     53500013
         CLI   WRKFLAGS+1,X'01'    NO, HAVE WE LOOPED TWICE             53600013
         BCR   8,RETURN            YES                                  53700013
         L     REGF,GTMBCTBL                                            53800013
         LA    REGF,1(REGF)        POSITION TO SECOND BYTE              53900013
         MVI   WRKFLAGS+1,X'01'    SET FLAG                             54000013
         B     BUF00300                                                 54100013
BUF00320 MVI   WRKFLAGS+1,X'00'    CLEAR FLAGS                          54200013
         LA    REGB,1(REGB)        UPDATE TO NEXT ID                    54300013
         B     BUF00290                                                 54400013
BUF00330 L     SAVE,4(SAVE)        RESET SAVE AREA                      54500013
         RETURN (14,12),RC=0       RETURN                               54600013
ERR1     L     REGB,WRKRTNCD                                            54700013
         MVI   0(REGB),X'10'       STORAGE EXCEEDED                     54800013
         MVI   15(REGB),X'03'      BUFFER EXCEEDED                      54900013
BUF00340 L     SAVE,4(SAVE)                                             55000013
         RETURN (14,12),T,RC=4                                          55100013
ERR2     L     REGB,WRKRTNCD                                            55200013
         MVI   0(REGB),X'10'       STORAGE EXCEEDED                     55300013
         MVI   15(REGB),X'02'      SELF IMPOSED LIMIT                   55400013
         B     BUF00340            RETURN                               55500013
         EJECT                                                          55600013
REGZERO  EQU   0                                                        55700013
PARM     EQU   1                                                        55800013
REGA     EQU   2                                                        55900013
REGB     EQU   3                                                        56000013
REGE     EQU   4                                                        56100013
WORK     EQU   5                                                        56200013
REGF     EQU   6                                                        56300013
GTMREG   EQU   7                                                        56400013
GDSREG   EQU   8                                                        56500013
BASE     EQU   9                                                        56600013
REGC     EQU   10                  EVEN/ODD PAIR                        56700013
REGD     EQU   11                  EVEN/ODD PAIR                        56800013
SAVE     EQU   13                                                       56900013
RETURN   EQU   14                                                       57000013
RLSEBFR  EQU   71                                                       57100013
ASGNBFR  EQU   71                                                       57200013
BCTLEN   EQU   381                 NOTE: THIS IS LENGTH LESS THREE      57300013
BCTACTLN EQU   384                                                      57400013
BCTENTRS EQU   128                                                      57500013
EQUIV    EQU   X'80'                                                    57600013
CODE     EQU   3                                                        57700013
GDS      EQU   4                                                        57800013
TRMCLS   EQU   7                                                        57900013
SEG128   EQU   1                                                        58000013
SEG256   EQU   2                                                        58100013
MORE256  EQU   3                                                        58200013
GDSCL128 EQU   4                                                        58300013
GDSCL256 EQU   5                                                        58400013
RESET    EQU   6                                                        58500013
THREE    DC    F'3'                                                     58600013
         EJECT                                                          58700013
WORKAREA DSECT                                                          58800013
WRKPARM  DS    F                                                        58900013
WRKRTNCD DS    F                                                        59000013
WRKFLAGS DS    F                                                        59100013
WRKSPACE DS    3F                                                       59200013
WRKSAVE  DS    18F                                                      59300013
         COPY  GSPCB                                                    59400013
         COPY  GTMCB                                                    59500013
         COPY  GDSCB                                                    59600013
         END                                                            59700013
./  ADD  SSI=20480319,NAME=IFFAHA03
*TITLE         KEY TABLE MANAGEMENT                                     00300021
*                                                                       00600021
*ENTRY POINT   IFFAHA03                                                 00900021
*                                                                       01200021
*INPUT         IN REGISTER 1 THE ADDRESS OF A PARAMETER LIST            01500021
*                 +0 A(GDSCB)                                           01800021
*                 +4 A(CODE)                                            02100021
*                 +8 A(KEY) OR A(CORVAL)                                02400021
*              THE CODES ARE INTEGER CONSTANTS                          02700021
*                 CODE=1 ADD A KEY TO THE TABLE                         03000021
*                      2 FIND A KEY IN THE TABLE                        03300021
*                      3 RESET TO A KEY                                 03600021
*                      4 DELETE THE KEY TABLE                           03900021
*                      5 FIND A CORRVAL IN THE TABLE                    04200021
*                                                                       04500021
*OUTPUT        VARIES RCCORDING TO CODE                                 04800021
*                 CODE=1  NEW KEY TABLE ENTRY                           05100021
*                 CODE=2  THE TABLE ADDRESS OF THE KEY IN REGISTER 1    05400021
*                 CODE=3  ALL KEYS FOLLOWING AND INCLUDING THE ONE      05700021
*                        SPECIFIED IN THE PARAMETER LIST ARE DELETED    06000021
*                 CODE=4  ALL STORAGE USED FOR KEY TABLES IS FREED      06300021
*                 CODE=5  THE TABLE ADDRESS OF THE KEY CONTAINING THE   06600021
*                        CORRVAL IN REGISTER 1.                         06900021
*                                                                       07200021
*ERROR RETURNS REGISTER 15=0 IF GOOD RETURN                             07500021
*                          4 IF KEY OR CORRVAL CANNOT BE FOUND          07800021
*              THE RETURN ARRAY IS NOT SET.                             08100021
*                                                                       08400021
*FUNCTION      TO MAINTAIN A TABLE OF USER KEYS. UPON REQUEST TO ADD    08700021
*              NEW KEYS, TO RETURN THE TABLE ADDRESS OF A SPECIFIC KEY  09000021
*              OR CORRVAL, TO DELETE KEYS, TO DELETE THE KEY TABLE.     09300021
*                                                                       09600021
         EJECT                                                          09900021
*                                                                       10200021
*REGISTER UTILIZATION                                                   10500021
*                                                                       10800021
R0       EQU   0                                                        11100021
R1       EQU   1                  PLIST REG/KEY TABLE ADDR              11400021
R2       EQU   2                  HOLDS OPTION CODE                     11700021
R3       EQU   3                  HOLDS KEY/CORVAL ADDR                 12000021
R4       EQU   4                  WORK REG                              12300021
R5       EQU   5                  HOLDS KEY TABLE ADDR                  12600021
R6       EQU   6                  LOOP CONTROL                          12900021
R7       EQU   7                  LOOP CONTROL                          13200021
R8       EQU   8                  GDSCB DSECT BASE                      13500021
R9       EQU   9                  CSECT BASE                            13800021
R11      EQU   11                                                       14100021
R13      EQU   13                 SAVE AREA REG                         14400021
R14      EQU   14                 RETURN REG                            14700021
R15      EQU   15                 RETURN CODE REG                       15000021
         EJECT                                                          15300021
IFFAHA03 CSECT                                                          15600021
*2230,711000,717000,720000                                         3840 15700021
         SAVE  (14,12)                                                  15900021
         BALR  R9,R0                                                    16200021
         USING *,R9               ESTABLISH CSECT ADDRESSABILITY        16500021
         LA    R11,N12(R1)                                              16800021
         USING WRKSECT,R11        ESTABLISH WORK AREA ADDRESSABILITY    17100021
         L     R8,N0(R1)          GET GDSCB ADDR FROM PLIST             17400021
         USING GDSCB,R8           ESTABLISH GDSCB DSECT ADDRESSABILITY  17700021
         L     R2,N4(R1)          GET CODE ADDR FROM PLIST              18000021
         L     R2,N0(R2)          GET CODE                              18300021
         L     R3,N8(R1)          GET KEY ADDR/CORVAL ADDR FROM PLIST   18600021
*                                                                       18900021
*TEST OPTION CODE                                                       19200021
*                                                                       19500021
         CH    R2,C1              TEST CODE                             19800021
         BE    KEYELE1            CODE=1 ADD A KEY                      20100021
         CH    R2,C2                                                    20400021
         BE    KEYEMA1            CODE=2 SEARCH FOR KEY                 20700021
         CH    R2,C3                                                    21000021
         BE    KEYEME1            CODE=3 RESET TO KEY                   21300021
         CH    R2,C4                                                    21600021
         BE    KEYEMH1            CODE=4 DELETE KEY TABLE               21900021
         CH    R2,C5                                                    22200021
         BE    KEYEMA1            CODE=5 SEARCH FOR CORVAL              22500021
         LA    R15,N8             ERROR RETURN - INCORRECT CODE         22800021
         B     KEYEMJ3                                                  23100021
*                                                                       23400021
*ADD A KEY TO THE KEY TABLE. IF THERE IS NO KEY TABLE OR IF IT IS FULL  23700021
*A MAIN STORAGE AREA IS PROVIDED INITIALIZED AS A KEY TABLE. ANY        24000021
*NECESSARY CHAINING IS DONE.                                            24300021
*                                                                       24600021
*                                                                       24900021
*DETERMINE IF A KEY TABLE EXISTS, THE ADDRESS OF THE FIRST TABLE IN THE 25200021
*KEY TABLE CHAIN IS KEPT IN THE GDSCB.                                  25500021
*                                                                       25800021
KEYELE1  L     R5,GDSKEYTB        GET KEY TABLE ADDR FROM GDSCB         26100021
         LTR   R5,R5              IS THERE A KEY TABLE                  26400021
         BZ    KEYELF1            NO                                    26700021
*                                                                       27000021
*THERE IS A KEY TABLE. FOLLOW CHAIN TO LAST TABLE.                      27300021
*                                                                       27600021
KEYELE2  L     R4,N0(R5)          GET ADDR OF NEXT TABLE IN CHAIN       27900021
         LTR   R4,R4              HAS END OF CHAIN BEEN REACHED         28200021
         BZ    KEYELE3            YES                                   28500021
         LR    R5,R4                                                    28800021
         B     KEYELE2                                                  29100021
*                                                                       29400021
*DETERMINE IF TABLE IS FULL. IF IT IS GET CORE STORAGE FOR ANOTHER      29700021
*TABLE, CHAIN TABLES, ADD KEY. IF IT IS NOT FULL ADD THE KEY.           30000021
*                                                                       30300021
KEYELE3  CLC   N4(N4,R5),N8(R5)   IS KEY TABLE FULL                     30600021
         BL    KEYELE4            NO                                    30900021
*                                                                       31200021
*EITHER THERE IS NO CURRENT TABLE OR IT IS FULL. GET CORE FOR TABLE.    31500021
*                                                                       31800021
KEYELF1  LA    R4,MFAREA                                                32100021
         GETMAIN EC,LV=496,A=AREA,SP=0,MF=(E,(4)) GET CORE FOR KEY TABL 32400021
         LTR   R15,R15            WAS REQUEST SATISFIED                 32700021
         BP    KEYEMA3                                                  33000021
*                                                                       33300021
*INITIALIZE POINTERS IN NEW TABLE.                                      33600021
*                                                                       33900021
         L     R1,AREA                 GET ADDR OF NEW KEY TABLE        34200021
         SR    R4,R4                                                    34500021
         ST    R4,N0(R1)          IDENTIFY AS LAST TABLE IN CHAIN       34800021
         LA    R4,N12(R1)                                               35100021
         ST    R4,N4(R1)          INITIALIZE ENTRY PTR                  35400021
         LA    R4,N492(R1)                                              35700021
         ST    R4,N8(R1)          SET TABLE END PTR                     36000021
         LTR   R5,R5              IS THERE A CHAIN                      36300021
         BZ    KEYELJ1            NO                                    36600021
         ST    R1,N0(R5)          CHAIN KEY TABLES                      36900021
         B     KEYELF4                                                  37200021
KEYELJ1  ST    R1,GDSKEYTB        START KEY TABLE CHAIN                 37500021
         B     KEYELF4                                                  37800021
KEYELE4  LR    R1,R5                                                    38100021
KEYELF4  L     R4,N4(R1)          GET NEXT ENTRY ADDR                   38400021
*                                                                       38700021
*PUT KEY IN TABLE AND RESET POINTERS.                                   39000021
*                                                                       39300021
         MVC   N0(N12,R4),N0(R3)  PUT KEY IN KEY TABLE                  39600021
         LA    R4,N12(R4)                                               39900021
         ST    R4,N4(R1)          SET PTR TO NEXT ENTRY                 40200021
         B     KEYEMJ3A                                                 40500021
         EJECT                                                          40800021
*                                                                       41100021
*SEARCH FOR KEY/SEARCH FOR CORVAL. A SEQUENTIAL SEARCH OF THE KEY TABLE 41400021
*IS PERFORMED. IF THE KEY OR CORRVAL IS FOUND THE TABLE ADDRESS OF THE  41700021
*KEY IS RETURNED IN REGISTER 1. IF IT IS NOT FOUND AN ERROR CODE OF     42000021
*FOUR IS RETURNED IN REGISTER 15.                                       42300021
*                                                                       42600021
*                                                                       42900021
*IF THERE IS NO KEY TABLE GIVE ERROR RETURN                             43200021
*                                                                       43500021
KEYEMA1  L     R5,GDSKEYTB        GET KEY TABLE ADDR FROM GDSCB         43800021
         LTR   R5,R5              IS THERE A KEY TABLE                  44100021
         BZ    KEYEMA3            NO                                    44400021
*                                                                       44700021
*DETERMINE IF SEARCH IS FOR KEY OR CORRVAL. IF SEARCH IS FOR KEY THE    45000021
*FIRST WORD OF EACH KEY TABLE ENTRY MUST BE COMPARED. IF SEARCH IS FOR  45300021
*CORVAL THE THIRD WORD OF EACH KEY TABLE ENTRY MUST BE COMPARED.        45600021
*                                                                       45900021
KEYEMB2  CH    R2,C5              SEARCH FOR KEY OR CORVAL              46200021
         BE    KEYEMC2            CORVAL                                46500021
*                                                                       46800021
*SEARCH FOR KEY. SET POINTER TO FIRST WORD IN TABLE ENTRY. INITIALIZE   47100021
*SEARCH LOOP. THERE ARE FORTY KEYS IN A TABLE                           47400021
*                                                                       47700021
         LA    R4,N12(R5)         GET ADDR OF FIRST KEY IN TABLE        48000021
KEYEMB3A LA    R7,N40             LOOP CONTROL                          48300021
KEYEMB3  C     R4,4(R5)                HAS LAST KEY IN TABLE BEEN CHECK 48400021
         BNL   KEYEMA3                 YES                              48500021
         CLC   N0(N4,R3),N0(R4)         HAS KEY/CORVAL BEEN FOUND       48700021
         BE    KEYEMB5            YES                                   48900021
         LA    R4,N12(R4)         GET ADDR OF NEXT KEY/CORVAL IN TABLE  49200021
         BCT   R7,KEYEMB3                                               49500021
*                                                                       49800021
*DETERMINE IF THE LAST TABLE ON THE CHAIN HAS BEEN SEARCHED. IF NOT     50100021
*SEARCH THE NEXT TABLE ON THE CHAIN. IF IT HAS, MAKE ERROR RETURN.      50400021
*                                                                       50700021
         SR    R4,R4                                                    51000021
         C     R4,N0(R5)          HAS LAST KEY IN CHAIN BEEN CHECKED    51300021
         BE    KEYEMA3            YES                                   51600021
         L     R5,N0(R5)          GET ADDR OF NEXT TABLE ON CHAIN       51900021
         B     KEYEMB2                                                  52200021
*                                                                       52500021
*                                                                       52800021
*                                                                       53100021
*KEY OR CORRVAL HAS BEEN FOUND. DETERMINE IF CALL IS FOR SEARCH OR      53400021
*RESET. IF RESET, CHANGE TABLE ENTRY POINTER. IF SEARCH, DETERMINE IF   53700021
*SEARCH WAS FOR KEY OR CORRVAL.                                         54000021
*                                                                       54300021
KEYEMB5  CH    R2,C3              WAS OPTION CODE 3 PASSED              54600021
         BE    KEYEMF1            YES                                   54900021
         CH    R2,C5              WAS SEARCH FOR CORVAL                 55200021
         BE    KEYEMC5B           YES                                   55500021
*                                                                       55800021
*THE SEARCH WAS FOR A KEY. REGISTER FOUR CONTAINS THE ADDRESS OF THE    56100021
*KEY TABLE ENTRY IN WHICH THE KEY IS KEPT. RETURN THIS ADDRESS IN       56400021
*REGISTER ONE.                                                          56700021
*                                                                       57000021
KEYEMC5A LR    R1,R4              PUT KEY ADDR/CORVAL AD IN RETURN REG  57300021
         B     KEYEMJ3B                                                 57600021
*                                                                       57900021
*THE SEARCH WAS FOR A CORRVAL. SUBTRACT EIGHT TO GET THE ADDRESS OF     58200021
*THE KEY TABLE ENTRY IN WHICH THE CORRVAL IS KEPT.                      58500021
*                                                                       58800021
KEYEMC5B SH    R4,C8              COMPUTE KEY ADDR                      59100021
         B     KEYEMC5A                                                 59400021
*                                                                       59700021
*SEARCH IS FOR CORRVAL. SET POINTER TO THIRD WORD IN TABLE ENTRY.       60000021
*                                                                       60300021
KEYEMC2  LA    R4,N20(R5)         GET ADDR OF FIRST CORVAL IN TABLE     60600021
         B     KEYEMB3A                                                 60900021
KEYEMA3  LA    R15,N4             ERROR RETURN - KEY/CORVAL NOT FOUND   61200021
         B     KEYEMJ3                                                  61500021
         EJECT                                                          61800021
*                                                                       62100021
*RESET TO KEY. ALL KEYS, STARTING AT THE ONE SPECIFIED, ARE DELETED.    62400021
*ALL KEYS CAN BE DELETED BY SPECIFYING ZERO IN PLACE OF THE KEY ADDRESS 62700021
*PARAMETER. ALL TABLES CONTAINING ONLY DELETED KEYS ARE FREED.          63000021
*                                                                       63300021
*                                                                       63600021
*DETERMINE IF ALL KEYS SHOULD BE DELETED. IF YES, RESET ENTRY POINTER   63900021
*TO TOP OF FIRST TABLE. UNCHAIN AND FREE ALL OTHER TABLES.              64200021
*                                                                       64500021
KEYEME1  L     R4,N0(R3)          GET KEY VALUE                         64800021
         LTR   R4,R4              SHOULD ALL KEYS BE DELETED            65100021
         BP    KEYEMA1            NO                                    65400021
*                                                                       65700021
*DELETE ALL KEYS IF THERE IS A KEY TABLE. IF THERE IS NOT GIVE AN ERROR 66000021
*RETURN.                                                                66300021
*                                                                       66600021
         L     R5,GDSKEYTB        GET KEY TABLE ADDR FROM GDSCB         66900021
         LTR   R5,R5              IS THERE A KEY TABLE                  67200021
         BZ    KEYEMA3            NO                                    67500021
         LA    R4,N12(R5)         GET FIRST ENTRY ADDR                  67800021
KEYEMF1  ST    R4,N4(R5)          RESET ENTRY PTR                       68100021
*                                                                       68400021
*UNCHAIN AND FREE ALL TABLES FOLLOWING THE ONE WHICH STILL HOLDS VALID  68700021
*KEYS. DO NOT FREE THE FIRST TABLE ON CHAIN BUT DO UNCHAIN IT SO THAT   69000021
*SUBSEQUENT REQUESTS TO EITHER RESET TO KEY OR DELETE KEY TABLE WILL    69300021
*NOT ATTEMPT TO FREE THE SAME AREA AGAIN.                               69600021
*                                                                       69900021
KEYEMF2  LR    R6,R5                                                    70200021
         L     R5,0(R5)                GET NEXT TABLE ADDR              70500021
         XC    0(4,R6),0(R6)           ZERO POINTER                     70800021
KEYEMF3  LTR   R5,R5               HAS ED OF CHAIN BEEN REACHED    3840 71100021
         BZ    KEYEMJ3A                YES                              71400021
         LR    R6,R5                                               3840 71500021
         L     R5,0(R6)            SAVE PTR TO NEXT AREA           3840 71600021
         FREEMAIN R,LV=496,A=(6)                                   3840 71700021
         B     KEYEMF3                                             3840 72000021
         EJECT                                                          72300021
*                                                                       72600021
*DELETE KEY TABLE. ALL KEY TABLE AREAS ARE FREED AND THE KEY TABLE      72900021
*STRUCTURE IS DESTROYED.                                                73200021
*                                                                       73500021
*                                                                       73800021
*IF THERE IS NO KEY TABLE SIMPLY EXIT TO CALLER                         74100021
*                                                                       74400021
KEYEMH1  L     R5,GDSKEYTB                                              74700021
         LTR   R5,R5                   IS THERE A KEY TABLE             75000021
         BZ    KEYEMJ3A                NO                               75300021
*                                                                       75600021
*UNCHAIN AND FREE ALL AREAS STARTING AT THE FRONT END OF THE CHAIN.     75900021
*                                                                       76200021
         XC    GDSKEYTB(4),GDSKEYTB    ZERO KEY TABLE POINTER           76500021
KEYEMH3  LR    R6,R5              COPY KEY TABLE ADDR                   76800021
         L     R5,N0(R5)          GET ADDR OF NEXT TABLE IN CHAIN       77100021
         XC    0(4,R6),0(R6)           ZERO CHAIN POINTER               77400021
         FREEMAIN R,LV=496,A=(6)  RELEASE KEY TABLE CORE                77700021
KEYEMH3A LTR   R5,R5              IS THERE ANOTHER TABLE ON CHAIN       78000021
         BZ    KEYEMJ3A           NO                                    78300021
         B     KEYEMH3                                                  78600021
*                                                                       78900021
*RETURN FROM HERE IF REGISTER ONE CONTAINS KEY TABLE ENTRY ADDRSS.      79200021
*                                                                       79500021
KEYEMJ3A L     R1,N24(R13)        RESTORE REG1                          79800021
*                                                                       80100021
*RETURN THROUGH HERE IF THERE HAS NOT BEEN AN ERROR.                    80400021
*                                                                       80700021
KEYEMJ3B SR    R15,R15            INDICATE SUCCESSFUL COMPLETION        81000021
*                                                                       81300021
*RETURN THROUGH HERE IF THERE HAS BEEN AN ERROR.                        81600021
*                                                                       81900021
KEYEMJ3  L     R14,N12(R13)       RESTORE REG14                         82200021
         L     R0,N20(R13)        RESTORE REG0                          82500021
         RETURN (2,12)                                                  82800021
         EJECT                                                          83100021
*                                                                       83400021
*DEFINED CONSTANTS                                                      83700021
*                                                                       84000021
N0       EQU   0                                                        84300021
N4       EQU   4                                                        84600021
N8       EQU   8                                                        84900021
N12      EQU   12                                                       85200021
N20      EQU   20                                                       85500021
N24      EQU   24                                                       85800021
N40      EQU   40                                                       86100021
N492     EQU   492                                                      86400021
C1       DC    H'1'                                                     86700021
C2       DC    H'2'                                                     87000021
C3       DC    H'3'                                                     87300021
C4       DC    H'4'                                                     87600021
C5       DC    H'5'                                                     87900021
C8       DC    H'8'                                                     88200021
WRKSECT  DSECT                                                          88500021
AREA     DS    F                                                        88800021
MFAREA   DS    5F                                                       89100021
         COPY  GDSCB                                                    89400021
         END                                                            89700021
./  ADD  SSI=80330209,NAME=IFFAHA04
         TITLE 'DATA GEN ROUTINE-IFFAHA04'                              00100000
*                                                                       00200000
*        THE DATA GENERATOR IS ENTERED FROM PLINE/PPNT,STPOS/MVPOS,     00300000
*        PSGMT,AND PLSTR. ITS FUNCTION IS TO GENERATE VECTORS AND       00400000
*        POINTS, BLANKED AND UNBLANKED,KEYED AND NOT KEYED,ABSOLUTE,    00500000
*        INCREMENTAL, OR OPTIMIZED. IT WILL PROVIDE THE INCLUDE/        00600000
*        OMIT STRUCTURE FOR BOTH SINGLE AND MULTIPLE ELEMENTS AND       00700000
*        WILL GENERATE THE REPOSITIONING VECTOR WHEN NECESSARY.         00800000
*                                                                       00900000
*                       DATA GENERATOR WILL BE ENTERED WITH             01000000
*                       THE ADDRESS OF THE FOLLOWING AREA IN            01100000
*                       REGISTER 1                                      01200000
*                                                                       01300000
*                       +0  KEY START                                   01400000
*                       +4  FLAGS                                       01500000
*                       +8  CORVAL                                      01600000
*                       +12 ADDR IN USER PROG TO PLACE KEY IN           01700000
*                       +16 GDSCB ADDR                                  01800000
*                       +20 RETURN CODE ARRAY ADDR                      01900000
*                       +24 POSITIONING VECT X ABS                      02000000
*                       +28 POSITIONING VECT Y ABS                      02100000
*                       +32 POSIT VECT X INCR                           02200000
*                       +36 POSIT VECT Y INCR                           02300000
*                       +40 X ABS                                       02400000
*                       +44 Y ABS                                       02500000
*                       +48 X INCR                                      02600000
*                       +52 Y INCR                                      02700000
*                       +56 TOTAL X INCR                                02800000
*                       +60 TOTAL Y INCR                                02900000
*                       +64 ENTRY NUMBER (NOT USED BY THIS RTN)         03000000
*                                                                       03100000
*                                                                       03200000
*                                                                       03300000
*        EXTERNAL REFERENCES:                                           03400000
*                                                                       03500000
*        IFFAHA05-DATA STORE                                            03600000
*                                                                       03700000
*        EXTERNAL MACROS:                                               03800000
*                                                                       03900000
*        NONE                                                           04000000
*                                                                       04100000
         EJECT                                                          04200000
*        ON ENTRY THE REGISTERS ARE SAVED, THE SAVE AREAS ARE           04300000
*        CHAINED, SWITCHES ARE INITIALIZED, DSECTS ARE INITIALIZED,     04400000
*        AND THE ADDRESS OF DATA STORE IS OBTAINED FROM THE STATUS      04500000
*        TABLE AND SAVED.                                               04600000
*                                                                       04700000
IFFAHA04 CSECT                                                          04800000
*A122000-122600,A204050-204800,D243100-245000,D263100-264966,    YM1963 04900000
*A325040-325800,C454000,D455500,A477200-477600,D496500-496600,   YM1963 05000000
*A509300-509600                                                  YM1963 05100000
*A319300-319600,A324500,C325040-325080,D325440-325640,       LD YA00805 05200000
*A325440-325540,C325680,D325760,D465600,C477200,             LD YA00805 05300000
*D477600                                                                05400000
*C323000,C324500-325200,D325240-325400,A325300-325340,       LD YA01038 05500000
*A477900                                                     LD YA01038 05600000
*A325640-325668                                              JM YA02056 05700000
*C116000,A115540-115980,A117500,A120500,A477920-477980      L5 @ZA04162 05800000
*C325664,325800                                             L5 @ZA04160 05900000
*A166000-166800,A167500                                     D11 ZA04870 06000000
*A586200-586400,A743000                                     D11 ZA10055 06100000
*A400000-405400,C415000,609500                              D11 ZA14052 06200000
*A405600-406000                                             D11 ZA16577 06250000
*D609500,C612000-613000,D614000-615000                      D11 ZA17700 06270000
*                                                                       06300000
         SAVE  (14,12)                                                  06400000
         BALR  BASE,0                                                   06500000
         USING *,BASE              ADDRESSABILITY                       06600000
         LR    WORK,PARM                                                06700000
         USING WORKAREA,WORK       SET UP WORK DSECT                    06800000
         L     GDSREG,WRKGDS                                            06900000
         USING GDSCB,GDSREG        SET UP GDSCB DSECT                   07000000
         ST    SAVE,WRKSAVE+4      CHAIN SAVE AREAS                     07100000
         LA    REGA,WRKSAVE                                             07200000
         ST    REGA,EIGHT(SAVE)                                         07300000
         LR    SAVE,REGA                                                07400000
         L     REGFIFTN,WRKRTN     LOCATE THE ADDRESS                   07500000
         L     REGFIFTN,STAT(REGFIFTN)  OF DATA STORE FROM              07600000
         L     REGFIFTN,DSTOR(REGFIFTN) THE STATUS TABLE AND            07700000
         ST    REGFIFTN,WRKDSTOR   PLACE IN THE WORK AREA               07800000
         LA    REGD,0              COUNT                                07900000
         LA    REGC,WRKOUTPT+4     ADDR OF ORDERS                       08000000
         XC    WRKOUTPT(4),WRKOUTPT    ZERO FIRST WORD                  08100000
         MVI   WRKSW,FIRST         SET FIRST IN SW                      08200000
         MVI   WRKSW+1,X'00'       SET NO POSIT VECT SW                 08300000
         EJECT                                                          08400000
*                                                                       08500000
*        A CHECK IS MADE TO SEE IF ENTRY IS MADE MERELY TO COMPLETE     08600000
*        A MULTIPLE KEY WHICH REQUIRES THE GENERATION OF A REPOSI-      08700000
*        TIONING VECTOR. IF SO A BRANCH IS MADE TO THAT PART OF THE     08800000
*        PROGRAM.                                                       08900000
*                                                                       09000000
         TM    WRKBITS+2,REPONLY   CALLED FOR ONLY REPOS VECT           09100000
         BO    DAT01870            YES                                  09200000
*                                                                       09300000
*        WHEN THIS ROUTINE IS ENTERED THERE MAY BE ONE OR TWO           09400000
*        VECTORS OR POINTS TO BE GENERATED. NOTE: OFTEN I WILL          09500000
*        REFER TO BOTH VECTORS AND POINTS AS JUST VECTORS.              09600000
*        IF SCISSORING HAS OCCURED AND AS A RESULT A BLANKED            09700000
*        POSITIONING VECTOR IS NEEDED IN ADDITION TO THE VECTOR         09800000
*        REQUESTED THIS WILL EXPLAIN THE SECOND VECTOR. IF A            09900000
*        POSITIONING VECTOR IS REQUIRED IT IS MOVED INTO THE            10000000
*        WORK FIELD. IF NONE IS REQUIRED, THE FIRST SWITCH IS           10100000
*        TURNED OFF AND THE REQUESTED VECTOR IS MOVED INTO THE          10200000
*        WORK FIELD.                                                    10300000
*                                                                       10400000
         CLC   WRKDATA1(SIXTN),ZERO IS THERE A POS VECT                 10500000
         BE    DAT00400            NO                                   10600000
         MVC   WRKTXABS(SIXTN),WRKDATA1 MOVE POS VECT INTO WORK AREA    10700000
*                                                                       10800000
*        A CHECK IS MADE TO SEE IF THIS IS THE FIRST PASS, IN           10900000
*        OTHER WORDS, DOES AN INCLUDE OMIT STRUCTURE NEED TO            11000000
*        BE BUILT FIRST?                                                11100000
*                                                                       11200000
DAT00050 TM    WRKBITS+2,FRSTPASS  IS THIS THE FIRST PASS               11300000
         BNE   DAT00150            NO                                   11400000
*                                  IF NOT FIRST PASS, MODE IS ALREADY   11500000
*                                  SET OR OPTIMIZED SO DOESN'T MATTER   11600000
*                                  IF KEYED OR NOT                      11700000
DAT00100 TM    WRKBITS+2,KEYED+CORVLD KEYED OR CORRELATED FIRST PASS    11800000
         BNE   DAT03400            YES, GO TO SET UP INCLUDE/OMIT STR.  11900000
*                                                                       12000000
*        THIS POINT IS WHERE THE DATA GENERATOR IS REENTERED            12100000
*        FROM SEVERAL PLACES. IF IT IS NOT A FIRST PASS THE             12200000
*        CODING FALLS THROUGH TO THIS POINT. IF THE SECOND              12300000
*        VECTOR IS TO BE GENERATED WHEN TWO ARE REQUIRED THIS           12400000
*        POINT IS BRANCHED TO. IF GENERATION OF THE FIRST               12500000
*        VECTOR IS TO BE DONE AFTER AN INCLUDE OMIT STRUCTURE           12600000
*        HAS BEEN BUILT, THIS POINT IS BRANCHED TO. AND LAST,           12700000
*        FOR THE REPOSITIONING VECTOR AT THE END OF THE ELEMENT         12800000
*        THIS POINT IS BRANCHED TO. AT THIS POINT THE PATHS             12900000
*        WILL SPLIT DEPENDING ON WHETHER ABSOLUTE, INCREMENTAL,         13000000
*        OR OPTIMIZED OUTPUT IS DESIRED. OPTIMIZED OUTPUT IS            13100000
*        MERELY THE PATH THAT DETERMINES WHETHER THE VECTOR             13200000
*        WOULD BEST BE PUT OUT AS INCREMENTAL OR ABSOLUTE.              13300000
*                                                                       13400000
DAT00150 TM    WRKBITS,ABS         ABSOLUTE                             13500000
         BZ    DAT01100            YES                                  13600000
         TM    WRKBITS,INCR        INCREMENTAL                          13700000
         BM    DAT01900            YES                                  13800000
         EJECT                                                          13900000
*                                                                       14000000
*        WHEN OPTIMIZED OUTPUT IS DESIRED, THE LENGTH OF THE INCRE-     14100000
*        MENTAL VECTOR IS COMPUTED. THE TESTING PATHS WILL SPLIT        14200000
*        DEPENDING ON WHETHER POINT(S) OR VECTOR(S) ARE DESIRED.        14300000
*                                                                       14400000
*        DETERMINATION OF INCREMENTAL OR ABSOLUTE GENERATION            14500000
*        IS AS FOLLOWS:                                                 14600000
*                                                                       14700000
*  A.    IF THE MODE SET IS CURRENTLY INCREMENTAL:                      14800000
*        THREE OR LESS INCREMENTAL VECTORS WILL BE GENERATED            14900000
*        INCREMENTAL. IF MORE THAN THREE INCREMENTAL VECTORS            15000000
*        IS DESIRED THEY ARE GENERATED ABSOLUTE.                        15100000
*  B.    IF THE MODE IS CURRENTLY ABSOLUTE:                             15200000
*        IF ONE INCREMENTAL VECTOR IS DESIRED IT IS GENERATED           15300000
*        INCREMENTAL. OTHERWISE THE VECTOR IS GENERATED                 15400000
*        ABSOLUTE.                                                      15500000
*  C.    IF NEITHER MODE IS SET:                                        15600000
*        THREE OR LESS INCREMENTAL VECTORS WILL BE GENERATED            15700000
*        INCREMENTAL. IF MORE THAN THREE ARE DESIRED THEY ARE           15800000
*        GENERATED ABSOLUTE.                                            15900000
*                                                                       16000000
*        OPTIMIZED OUTPUT                                               16100000
DAT00200 L     REGA,WRKTXINC       LOAD INCR                            16200000
         L     REGB,WRKTYINC       LOAD INCR                            16300000
         LPR   REGA,REGA           COMPUTE +                            16400000
         LPR   REGB,REGB           COMPUTE +                            16500000
         SRA   REGA,2              DIV BY 4 TO 1024 BASE                16600000
         SRA   REGB,2              DIV BY 4 TO 1024 BASE                16700000
         SRA   REGA,6              DIV BY 64 TO COMPUTE NO OF INCR VECT 16800000
         SRA   REGB,6              REQD                                 16900000
         CR    REGB,REGA           FIND LARGEST IF ANY                  17000000
         BL    DAT00500                                                 17100000
DAT00300 LA    REGB,ONE(REGB)      ADD ONE FOR ONE SHIFTED OFF EVEN IF  17200000
*                                  EVEN MULT OF 64, LARGEST + VECT IS   17300000
*                                  63                                   17400000
         TM    WRKBITS,VECT        VECTOR                               17500000
         BZ    DAT00800            YES                                  17600000
         TM    GDSGRMOD,PI         POINT,INCR=CURR MODE?                17700000
         BO    DAT00600            YES                                  17800000
         TM    GDSGRMOD,PA         POINT, ABS                           17900000
         BO    DAT00700            YES                                  18000000
         C     REGB,THREE          THREE OR LESS INCR                   18100000
         BH    DAT01250            GENERATE ABS & SET MODE-PT           18200000
         B     DAT02000            GENERATE INCR & SET MODE PT          18300000
         EJECT                                                          18400000
DAT00400 MVI   WRKSW,OFF           TURN OFF FIRST SWITCH                18500000
         MVC   WRKTXABS(SIXTN),WRKXABS MOVE IN SECOND VECTOR            18600000
         B     DAT00050                                                 18700000
DAT00500 LR    REGB,REGA           PLACE LARGEST IN REGB                18800000
         B     DAT00300                                                 18900000
DAT00600 C     REGB,THREE          3 INCR RQD                           19000000
         BH    DAT01250            MORE- GENERATE AN ABS PNT & SET MODE 19100000
         B     DAT02100            NO, GO GENERATE REQD INCR PNT        19200000
DAT00700 C     REGB,ONEFLD         1 INCR RQD                           19300000
         BE    DAT02000            YES GEN INCR PNT  & SET MODE         19400000
         B     DAT01300            NO GENERATE ABS PNT                  19500000
DAT00800 TM    GDSGRMOD,VI         VECTOR INCR= CURRENT MODE            19600000
         BO    DAT00900            YES                                  19700000
         TM    GDSGRMOD,VA         VECT ABS?                            19800000
         BO    DAT01000            YES                                  19900000
         C     REGB,THREE          3 OR LESS INCR                       20000000
         BH    DAT01700            GENER ABS & SET MODE-VECT            20100000
         B     DAT03100            GENER INCR & SET MODE-VECT           20200000
DAT00900 C     REGB,THREE          3 INCR RQD                           20300000
         BH    DAT01700            MORE-GEN AN ABS VECT & SET MODE      20400000
         B     DAT02100            NO, GEN REQD INCR VECT               20500000
DAT01000 C     REGB,ONEFLD         1 INCR RQD                           20600000
         BE    DAT03100            YES, GEN INCR VECT & SET MODE        20700000
         B     DAT01300            NO, GENERATE ABS VECT                20800000
         EJECT                                                          20900000
*                                                                       21000000
*        WHEN ABSOLUTE OUTPUT IS TO BE GENERATED: A TEST IS             21100000
*        MADE TO SEE IF VECTORS OR POINTS ARE DESIRED, THEN IT          21200000
*        IS DETERMINED IF THE MODE IS ALREADY SET TO VECTOR             21300000
*        ABSOLUTE OR POINT ABSOLUTE, RESPECTIVELY. IF NOT,              21400000
*        THE SET MODE ORDER IS PLACED IN THE WORK AREA FOR              21500000
*        THE DATA STORE ROUTINE AND THE LENGTH OF THE ELEMENT           21600000
*        THUS FAR IS SET TO TWO. THE POINT AND VECTOR                   21700000
*        PATH THEN COME TOGETHER AGAIN BECAUSE THE ACTUAL               21800000
*        COORDINATES APPEAR THE SAME REGARDLESS OF POINT OR             21900000
*        VECTOR.                                                        22000000
* ABSOLUTE OUTPUT                                                       22100000
* DAT01100  EQU  DAT01200                                               22200000
DAT01200 TM    WRKBITS,VECT        VECTOR                               22300000
         BZ    DAT01700            YES                                  22400000
DAT01250 EQU   *                                            L5 @ZA04162 22500000
         L     REGA,GDSGTMCB       GET ADDR GTMCB           L5 @ZA04162 22600000
         TM    GTMUPDT(REGA),PPNTUPDT  POINT UPDATE?        L5 @ZA04162 22700000
         BNO   DAT01251            BRANCH IF NO             L5 @ZA04162 22800000
         L     REGA,WRKKEY         ADDRESS OF KEY           L5 @ZA04162 22900000
         TM    KEYWD2(REGA),STMODE  1'ST ORDER SET MODE?    L5 @ZA04162 23000000
         BO    DAT01252            IF YES,WE WILL ADD       L5 @ZA04162 23100000
*                                  ELSE IT MAY NOT FIT      L5 @ZA04162 23200000
DAT01251 EQU   *                                            L5 @ZA04162 23300000
         TM    GDSGRMOD,PA         MODE ALREADY SET                     23400000
         BO    DAT01300            YES                                  23500000
DAT01252 EQU   *                                            L5 @ZA04162 23600000
         MVC   0(2,REGC),GEPMORD   MOVE IN SET MODE                     23700000
         LA    REGD,2(REGD)        ADD TO COUNT                         23800000
         LA    REGC,2(REGC)        POSIT OUTPUT AREA                    23900000
DAT01253 EQU   *                                            L5 @ZA04162 24000000
         MVI   GDSGRMOD,PA         SET CURRENT MODE=PT   ABS            24100000
*                                                                       24200000
*        THE X AND Y VALUES ARE PLACED IN THE AREA FOR DATA             24300000
*        STORE . IF THIS IS THE FIRST VECTOR OF TWO THE BEAM            24400000
*        BIT IS TURNED ON TO INDICATE BLANKED. IF THIS IS               24500000
*        THE REPOSITIONING VECTOR IT IS ALSO BLANKED. FINALLY,          24600000
*        IF THE BEAM IS TO BE BLANKED AS IN A REQUEST FROM              24700000
*        STPOS THE BEAM IS SET TO BE BLANKED                            24800000
DAT01300 MVC   GDSXCOR(8),ZERO          ZERO X AND Y CORR FACTOR YM1963 24900000
*                                       THE MODE FOR THIS GDS    YM1963 25000000
*                                       IS NOW ABSOLUTE          YM1963 25100000
         MVC   0(2,REGC),WRKTXABS+2     XABS IN OUT AREA         YM1963 25200000
         MVC   2(2,REGC),WRKTYABS+2 YABS                                25300000
         CLI   WRKSW,FIRST         FIRST                                25400000
         BE    DAT01350            NO                                   25500000
         CLI   WRKSW+1,REPOS       IS THIS THE REPOSITIONING VECT       25600000
         BE    DAT01350            YES BLANK IT                         25700000
         TM    WRKBITS+2,BEAMON    BEAM ON                              25800000
         BO    DAT01400            YES                                  25900000
DAT01350 OI    0(REGC),BEAMABS     TURN BEAM OFF                        26000000
DAT01400 LA    REGD,4(REGD)        ADD LENGTH OF VECTOR                 26100000
         LA    REGC,4(REGC)        POSITION OUTPUT AREA                 26200000
DAT01500 CLI   WRKSW,FIRST         BOTH DONE                            26300000
         BE    DAT01850                                                 26400000
         EJECT                                                          26500000
*                                                                       26600000
*        AT THIS POINT IF THE SECOND OR ONLY VECTOR HAS BEEN            26700000
*        GENERATED, THE TOTAL X AND Y INCREMENT FIELDS ARE              26800000
*        INCREASED BY THE INCREMENTS OF THIS CALL TO THE                26900000
*        GENERATOR. THESE FIELDS ARE USED BY THE DATA GENERATOR         27000000
*        TO GENERATE THE INCREMENTAL REPOSITIONING VECTOR IF            27100000
*        DESIRED. IF THIS IS NOT A SINGLE ENTRY, THE DATA               27200000
*        STORE ROUTINE IS CALLED TO PLACE THE DATA IN THE               27300000
*        GDOA AND OVERFLOW IF NECESSARY.                                27400000
*                                                                       27500000
         L     REGA,WRKTOTX                                             27600000
         A     REGA,WRKDATA3       COMPUTE TOTAL X INCR                 27700000
         A     REGA,WRKXINCR       THUS FAR                             27800000
         ST    REGA,WRKTOTX                                             27900000
         L     REGA,WRKTOTY                                             28000000
         A     REGA,WRKDATA4       COMPUTE TOTAL Y INCR                 28100000
         A     REGA,WRKYINCR       THUS FAR                             28200000
         ST    REGA,WRKTOTY                                             28300000
         ST    REGD,WRKOUTPT       LENGTH OF DATA GENERATED             28400000
         TM    WRKBITS,MULT        MULTIPLE ENTRY                       28500000
         BZ    DAT01800            NO GO SEE IF KEY NEEDS FIXING        28600000
DAT01550 MVC   WRKGDS1(EIGHT),WRKGDS                                    28700000
         LA    PARM,WRKGDS1                                             28800000
*//      CALL  DATA STORE                                               28900000
*//                                                                     29000000
         L     REGFIFTN,WRKDSTOR   ADDR OF DATA STORE                   29100000
         BALR  RETURN,REGFIFTN                                          29200000
         LTR   REGFIFTN,REGFIFTN   SUCCESS                              29300000
         BNE   ERR1                ALAS  NO                             29400000
         TM    WRKBITS+2,FRSTPASS  TEST FOR A LAST PASS                 29500000
         BO    DAT01870                                                 29600000
         TM    WRKBITS,MULT        IS THIS A SINGLE ENTRY               29700000
         BO    DAT01600            NO, EXIT                             29800000
*        THE LOGICAL ADDRESS IN THE KEY MUST BE SET PROPERLY ON A SINGL 29900000
*        ENTRY.   THIS IS WHAT IS DONE HERE                             30000000
         L     REGA,GDSAOACB       ADDR OF OACB                         30100000
         L     REGA,LOGCUR(REGA)   OBTAIN THE CURRENT LOGICAL ADDR      30200000
         SR    REGA,REGD           BACK IT UP THE LENGTH OF THE GENERAT 30300000
         STH   REGA,WRKADDR+2      STORE IT IN THE KEY                  30400000
*                                                                       30500000
*        IF THIS IS NOT A LAST PASS AND IF THIS IS NOT A                30600000
*        SINGLE ENTRY THE ROUTINE WILL EXIT BACK TO THE CALLING         30700000
*        PROGRAM                                                        30800000
*                                                                       30900000
DAT01600 L     SAVE,4(SAVE)                                             31000000
         RETURN (14,12),T,RC=0     GOOD RETURN                          31100000
DAT01700 EQU   *                                            D11 ZA04870 31200000
         L     REGA,GDSGTMCB       ADDR OF GTMCB            D11 ZA04870 31300000
         TM    GTMUPDT(REGA),PPNTUPDT LINE UPDATE?          D11 ZA04870 31400000
         BNO   DAT01701            BRANCH IF NOT            D11 ZA04870 31500000
         L     REGA,WRKKEY         POINT TO KEY             D11 ZA04870 31600000
         TM    KEYWD2(REGA),STMODE 1ST ORDER SETMODE?       D11 ZA04870 31700000
         BO    DAT01702            YES,ADD TO UPDATE        D11 ZA04870 31800000
DAT01701 EQU   *                                            D11 ZA04870 31900000
         TM    GDSGRMOD,VA         ALREADY SET              D11 ZA04870 32000000
         BO    DAT01300            YES                                  32100000
DAT01702 EQU   *                                            D11 ZA04870 32200000
         MVC   0(2,REGC),GEVMORD   MOVE IN SET MODE                     32300000
         LA    REGD,2(REGD)        ADD TO COUNT                         32400000
         MVI   GDSGRMOD,VA         SET CURRENT MODE=VT ABS              32500000
         LA    REGC,2(REGC)        POSIT OUTPUT AREA                    32600000
         B     DAT01300                                                 32700000
DAT01800 TM    WRKBITS+2,KEYED+CORVLD KEYED OR CORRELATED               32800000
         BNE   DAT04050            YES,FINISH KEY                       32900000
         B     DAT01550            CALL DATA GEN AND EXIT               33000000
*                                                                       33100000
*        IF THIS IS THE FIRST OF TWO VECTORS IT IS STORED BY DATA       33200000
*        STORE AND THE NEXT VECTOR IS MOVED INTO THE WORK AREA.         33300000
*        THEN CONTROL IS RETURNED TO THE START TO GENERATE THIS         33400000
*        VECTOR.                                                        33500000
*                                                                       33600000
DAT01850 ST    REGD,WRKOUTPT        LENGTH IN OUTPUT AREA               33700000
         MVC   WRKGDS1(EIGHT),WRKGDS MOVE IN GDS ADDR                   33800000
         LA    PARM,WRKGDS1        LOAD ADDR OF LIST                    33900000
*//     CALL DATA STORE                                                 34000000
         L     REGFIFTN,WRKDSTOR   ADDR OF DATA STORE                   34100000
         BALR  RETURN,REGFIFTN                                          34200000
         LTR   REGFIFTN,REGFIFTN   SUCCESSFUL                           34300000
         BNE   ERR1                NP                                   34400000
         LA    REGD,0                                                   34500000
         LA    REGC,WRKOUTPT+4     RESET OUTPUT TO ZERO DATA            34600000
         MVI   WRKSW,OFF           TURN OFF FIRST SW                    34700000
         MVC   WRKTXABS(SIXTN),WRKXABS MOVE IN SECOND VECTOR            34800000
         B     DAT00150                                                 34900000
DAT01870 TM    WRKBITS+2,KEYED+CORVLD KEYED OR CORRELATED               35000000
         BNE   DAT04050                 YES                             35100000
         B     DAT01600                 NO EXIT                         35200000
         EJECT                                                          35300000
*                                                                       35400000
*        WHEN INCREMENTAL OUTPUT IS DESIRED, THE NUMBER OF INCRE-       35500000
*        MENTAL VECTORS IS COMPUTED. THE VECTORS WILL BE GENERATED      35600000
*        AS NEARLY AT EQUAL LENGTH AS POSSIBLE. ANY REMAINDER           35700000
*        WHEN THE LENGTH IS DIVIDED BY THE NUMBER OF VECTORS IS         35800000
*        ADDED AT THE RATE OF ONE RASTER UNIT A VECTOR UNTIL IT         35900000
*        HAS BEEN USED UP. FIRST A CHECK IS MADE TO SEE IF THE          36000000
*        MODE IS ALREADY SET AND IF NOT A SET MODE ORDER IS PLACED      36100000
*        IN THE INPUT AREA TO THE DATA STORE ROUTINE.                   36200000
* INCREMENTAL OUTPUT                                                    36300000
* DAT01900 EQU DAT01950                                                 36400000
DAT01950 TM    WRKBITS,VECT        VECTOR                               36500000
         BZ    DAT03100                                                 36600000
DAT02000 TM    GDSGRMOD,PI         MODE ALREADY SET                     36700000
         BO    DAT02100                                                 36800000
         MVC   0(2,REGC),GEPI2ORD  MOVE IN ORDER                        36900000
         LA    REGD,2(REGD)        ADD TO CT                            37000000
         LA    REGC,2(REGC)        REPOS OUTPUT AREA                    37100000
         MVI   GDSGRMOD,PI         SET MODE POINT INCREMENTAL           37200000
DAT02100 L     REGA,WRKTXINC                                            37300000
         L     REGF,WRKTYINC                                            37400000
         A     REGA,GDSXCOR             ADD X CORR FACTOR OR 0   YM1963 37500000
         A     REGF,GDSYCOR             ADD Y CORR FACTOR OR 0   YM1963 37600000
         LR    REGB,REGA                SAVE X VALUE             YM1963 37700000
         LR    REGG,REGF                SAVE Y VALUE             YM1963 37800000
         SRA   REGA,2                   DIVIDE X BY 4            YM1963 37900000
         SRA   REGF,2                   DIVIDE Y BY 4            YM1963 38000000
         SLA   REGA,2                   RESTORE X                YM1963 38100000
         SLA   REGF,2                   RESTORE Y                YM1963 38200000
* NOTE THAT THE ABOVE SHIFTS WILL MAKE A NEGATIVE NUMBER MORE    YM1963 38300000
* NEGATIVE AND A POSITIVE NUMBER LESS POSSITIVE                  YM1963 38400000
         SR    REGB,REGA                NEW X CORR IN REG B      YM1963 38500000
         SR    REGG,REGF                NEW Y CORR IN REG G      YM1963 38600000
         ST    REGB,GDSXCOR             STORE NEW X CORR         YM1963 38700000
         ST    REGG,GDSYCOR             STORE NEW Y CORR         YM1963 38800000
         AR    REGA,REGB                RESET X REGISTER         YM1963 38900000
         AR    REGF,REGG                RESET Y REGISTER         YM1963 39000000
         SRDA  REGA,TR4            DIVIDE BY 4, AND                     39100000
         SRDA  REGF,TR4            POSITION IN ODD REGISTER             39200000
         LPR   SAVE,REGB           POSITIVE X                           39300000
         LPR   RETURN,REGG         POSITIVE Y                           39400000
         CR    RETURN,SAVE                                              39500000
         BNL   DAT02200                                                 39600000
         LR    RETURN,SAVE         LARGEST IN RETURN                    39700000
DAT02200 SRDA  RETURN,32                                                39800000
         D     RETURN,SIX3         DIVIDE BY 63                         39900000
         LTR   RETURN,RETURN       ANY REMAINDER?           D11 ZA14052 40000000
         BZ    DAT02250            NO,NUMBER OF VECTS IS OK D11 ZA14052 40100000
         LA    RETURN,1            1 VECT FOR REMAINDER     D11 ZA14052 40200000
DAT02250 AR    RETURN,REGFIFTN     AND ADD COMPUTED NUMBER  D11 ZA14052 40300000
         LTR   RETURN,RETURN  TOT. NUMBER OF VECTORS EQ 0?  D11 ZA14052 40400000
         BNZ   DAT02270            NO,PROCEED W DIVIDE      D11 ZA14052 40500000
* IF THE NUMBER OF VECTORS WANTED COMPUTES TO ZERO, WE HAVE D11 ZA14052 40520000
* SATISFIED THE CALLER'S REQUEST BY NOT GENNING ANYTHING,   D11 ZA14052 40540000
* BUT WE SHOULD GEN 1 VECTOR WITH MOVEMENT=0 IN CASE IT IS  D11 ZA16577 40560000
* A REPOSITIONING VECTOR, THE LACK OF WHICH CAUSES PROBLEMS.D11 ZA16577 40580000
         LA    RETURN,1            MUST GEN AT LEAST ONE    D11 ZA16577 40600000
*        THE NUMBER OF VECTORS REQD IS NOW IN RETURN                    40900000
*        THE X INCR BASE 1024 IS IN REGB                                41000000
*        THE Y INCR BASE 1024 IS IN REGG                                41100000
*        THE VECTORS/POINTS GENERATED WILL BE OF EQUAL LENGTH           41200000
*        ERROR FACTORS OF ONE UNIT PER VECTOR WILL BE ADDED             41300000
*        UNTIL THE ENTIRE CORRECTION IS MADE                            41400000
DAT02270 DR    REGA,RETURN                                  D11 ZA14052 41500000
         DR    REGF,RETURN                                              41600000
*        THE VECTOR/POINT LENGTH FOR EACH IS IN REGB AND REGG RESPECT.  41700000
*        THE ERROR FACTOR IS IN REGA AND REGF RESPECTIVELY              41800000
*        THE LAST VECTOR WILL HAVE NO CORRECTION FACTOR ADDED           41900000
         EJECT                                                          42000000
         LTR   REGA,REGA           ANY X CORR FACT                      42100000
         BZ    DAT03200            NO                                   42200000
         LA    SAVE,ONE                                                 42300000
DAT02300 LTR   REGF,REGF           ANY Y CORR FACT                      42400000
         BZ    DAT03300            NO                                   42500000
         LA    REGFIFTN,ONE                                             42600000
DAT02400 LTR   REGA,REGA           X NEG                         A29395 42700000
         BNL   DAT02500            NO                                   42800000
         LNR   SAVE,SAVE           LOAD -1                              42900000
DAT02500 LTR   REGF,REGF           Y NEG                         A29395 43000000
         BNL   DAT02600                                                 43100000
         LNR   REGFIFTN,REGFIFTN   LOAD -1                              43200000
DAT02600 LPR   REGA,REGA           NO. OF CORR.                         43300000
         LPR   REGF,REGF           NO. OF CORR.                         43400000
*                                                                       43500000
*        WHEN GENERATING THE CORRECTION FACTOR IS ADDED TO THE          43600000
*        INCREMENTAL VECTOR.  THEY ARE SHIFTED LEFT ONE BIT BECAUSE     43700000
*        THE VECTOR APPEARS THIS WAY IN THE MACHINE. THE ONE BIT        43800000
*        IS TURNED ON IN THE X BECAUSE THE HARDWARE DOES NOT WANT       43900000
*        ITS INCREMENTAL VECTORS LOOKING LIKE SET MODE ORDERS.          44000000
*        THESE FIELDS ARE PLACED IN THE OUTPUT AREA. IF THIS IS         44100000
*        NOT A VECTOR THE BEAM IS SET TO BLANKED. IF VECTOR, IT         44200000
*        IS BLANKED IF IT IS A POSITIONING VECTOR, A REPOSITIONING      44300000
*        VECTOR, OR IF THE BEAM IS REQUESTED BLANKED.                   44400000
DAT02700 LR    REGZERO,REGB        INCR IN ANOTHER REG (X)              44500000
         LR    PARM,REGG           INCR IN ANOTHER REG (Y)              44600000
         AR    REGZERO,SAVE        ADD CORRECTION FACTOR OR ZERO        44700000
         AR    PARM,REGFIFTN       ADD ERROR FACTOR OR ZERO             44800000
         SLA   REGZERO,ONE              POSITIVE FOR INCR        YM1963 44900000
         SLA   PARM,ONE                 POSITIVE FOR INCR        YM1963 45000000
         A     REGZERO,ONEFLD      ONE BIT ALWAYS SET IN X              45100000
*                                  BEAM ON CURRENTLYY                   45200000
         STC   REGZERO,0(REGC)     PLACE IN OUTPUT                      45300000
         STC   PARM,1(REGC)        PLACE IN OUTPUT                      45400000
         TM    WRKBITS,VECT        VECTOR                               45500000
         BNE   DAT02750            NO                                   45600000
         TM    WRKSW,FIRST         IF FIRST ONE, BEAN OFF               45700000
         BO    DAT02750                                                 45800000
         CLI   WRKSW+1,REPOS       IS THIS THE REPOS VECT               45900000
         BE    DAT02750            YES, BLANK                           46000000
         TM    WRKBITS+2,BEAMON    TURN BEAM OFF IF NEEDED              46100000
         BO    DAT02800            NOT NEEDED                           46200000
DAT02750 OI    1(REGC),BEAMINCR    TURN BEAM OFF                        46300000
         EJECT                                                          46400000
*                                                                       46500000
*        HERE THE CORRECTION FACTOR REGISTERS ARE CHECKED TO SEE        46600000
*        IF MORE CORRECTION MUST TAKE PLACE. IF NOT THE REGISTERS       46700000
*        ARE SET TO ZERO.                                               46800000
DAT02800 LA    REGC,2(REGC)        POSITION OUTPUT AREA                 46900000
         LA    REGD,2(REGD)        ADD TO COUNT                         47000000
         BCT   REGA,DAT02900                                            47100000
         SR    SAVE,SAVE           X CORR ALL DONE                      47200000
DAT02900 BCT   REGF,DAT03000                                            47300000
         SR    REGFIFTN,REGFIFTN   Y CORR ALL DONE                      47400000
*                                                                       47500000
*        WHEN ALL INCREMENTAL VECTORS ARE GENERATED A CHECK IS MADE     47600000
*        TO SEE IF THE BEAM BIT NEEDS MODIFYING ON THE LAST ONE.        47700000
*        IF THIS IS THE POSITIONING VECTOR, THE REPOSITIONING VECTOR    47800000
*        OR THE REQUESTED BLANKED VECTOR THE BEAM REMAINS AS IS.        47900000
*        IF THIS IS POINT OR VECTOR OTHERWISE THE BEAM IS TURNED ON     48000000
*        BY TURNING OFF THE BLANK BIT. THEN THE DATA IS HANDLED         48100000
*        AS FOR ABSOLUTE BY  CALLING DATA STORE, ETC.                   48200000
DAT03000 BCT   RETURN,DAT02700     ALL DONE                             48300000
         LA    SAVE,WRKSAVE             RESET SAVE AREA REG      YM1963 48400000
         TM    WRKSW,FIRST         IF FIRST ONE, BEAM OFF               48500000
         BO    DAT01500                                                 48600000
         CLI   WRKSW+1,REPOS       REPOS VECT                           48700000
         BE    DAT01500       YES, BLANK                                48800000
         TM    WRKBITS+2,BEAMON    YES, DOES LAST POINT NEED BEAM       48900000
         BZ    DAT01500            NO, GO TO STORE OR DO OTHER ONE      49000000
         BCTR  REGC,0              POSIT BACK                           49100000
         NI    0(REGC),BEAMOFFI    TURN BEAM ON                         49200000
         LA    REGC,ONE(REGC)      REPOSITION                           49300000
         B     DAT01500            GO TO STORE OR DO TOHER ONE          49400000
DAT03100 TM    GDSGRMOD,VI         ALREADY SET                          49500000
         BO    DAT02100                                                 49600000
         MVC   0(2,REGC),GEVI2ORD  MOVE IN ORDER                        49700000
         LA    REGD,2(REGD)        ADD TO COUNT                         49800000
         LA    REGC,2(REGC)        POSITION IN OUTPUT AREA              49900000
         MVI   GDSGRMOD,VI         SET MODE VECTOR INCREMENTAL          50000000
         B     DAT02100                                                 50100000
DAT03200 SR    SAVE,SAVE           ZERO REG WITH CORR FACT              50200000
         B     DAT02300                                                 50300000
DAT03300 SR    REGFIFTN,REGFIFTN   ZERO REG WITH CORRECTION FACT        50400000
         B     DAT02400                                                 50500000
         EJECT                                                          50600000
*                                                                       50700000
*        IF THE INPUT DATA IS KEYED IT IS OF ONE OF TWO TYPES. IT       50800000
*        IS EITHER SINGLE OR MULTIPLE. IF IT IS MULTIPLE A GTRU         50900000
*        TO AN UNRESOLVED ADDRESS (OR A GNOP FOR INCLUDE) IS            51000000
*        GENERATED AND SENT OUT TO DATA STORE. A CORRECTION IS          51100000
*        MADE TO THE LOGICAL START ADDRESS IN THE KEY AND THEN          51200000
*        THE VECTORS ARE PROCESSED.                                     51300000
* KEYED INPUT FIRST ENTRY                                               51400000
DAT03400 TM    WRKBITS,MULT        MULTIPLE ENTRY                       51500000
         BZ    DAT03700            NO                                   51600000
DAT03450 TM    WRKBITS,INCLUDE     INCLUDE STATUS                       51700000
         BO    DAT03600            YES                                  51800000
         MVC   0(4,REGC),GTRUORD   MOVE IN GTRU                         51900000
DAT03500 MVI   WRKOUTPT,UNRES      MOVE IN UNRES ADDR SW                52000000
         NI    GDSGRMOD,X'00'      SET TO CONTROL MODE                  52100000
         LA    PARM,4              LENGTH                               52200000
         STH   PARM,WRKOUTPT+2                                          52300000
         MVC   WRKGDS1(EIGHT),WRKGDS                                    52400000
         LA    PARM,WRKGDS1                                             52500000
*//                                                                     52600000
*//      CALL  DATA STORE                                               52700000
         L     REGFIFTN,WRKDSTOR   ADDR OF DATA STORE                   52800000
         BALR  RETURN,REGFIFTN                                          52900000
         LTR   REGFIFTN,REGFIFTN   SUCCESSFUL                           53000000
         BNE   ERR1                NO                                   53100000
         L     REGA,GDSAOACB       ADDR OF THE OACB                     53200000
         L     REGA,LOGCUR(REGA)   LOGICAL ADDRESS OF CURRENT OLP       53300000
         S     REGA,FOUR           SUBTRACT FOUR FOR THE DATA WE        53400000
*        JUST PLACED OUT IN THE GDOA TO GET THE ACCURATE LOGICAL        53500000
*        ADDRESS FOR THE KEY                                            53600000
         STH   REGA,WRKADDR+2      STORE IT IT IN THE KEY               53700000
         B     DAT00150                                                 53800000
DAT03600 MVC   0(4,REGC),GNOPORD   MOVE IN GNOP                         53900000
         B     DAT03500                                                 54000000
         EJECT                                                          54100000
*                                                                       54200000
*        IF THIS IS A SINGLE ENTRY A CHECK IS MADE TO SEE IF INDEED     54300000
*        IT CAN BE GENERATED AS A SINGLE ENTRY. SINGLE ENTRIES          54400000
*        DO NOT HAVE INCLUDE/OMIT STRUCTURES. THEY MERELY HAVE          54500000
*        INFORMATION IN THE KEY WHICH ENABLES INCL OR OMIT TO           54600000
*        TURN THE BEAM BIT ON OR OFF.                                   54700000
*                                                                       54800000
*        IF THERE IS A POSITIONING VECTOR THIS CANNOT BECOME A          54900000
*        SINGLE ENTRY AND IT IS CHANGED TO A MULTIPLE ENTRY, LAST       55000000
*        PASS.  THEN THE BEGINNING OF THE MULTIPLE ENTRY IS GENER-      55100000
*        ATED BEFORE THE VECTORS ARE GENERATED.  IF NO REPOSITIONING    55200000
*        IS REQUIRED THIS MUST ALSO BE TREATED AS A MULTIPLE            55300000
*        AND THE ABOVE OCCURS.  IF IT IS ABSOLUTE A BRANCH IS MADE      55400000
*        TO THE ABSOLUTE GENERATION AREA.  OTHERWISE THE LENGTH OF      55500000
*        THE INCREMENTAL VECTOR IS COMPUTED.  IF IT IS TWO THE          55600000
*        INCREMENTAL PROCESSING AREA IS BRANCHED TO.  IF THE OUTPUT     55700000
*        IS OPTIMIZED, AN ABSOLUTE VECTOR IS GENERATED. OTHERWISE       55800000
*        THE INCREMENTAL VECTOR IS TREATED AS A MULTIPLE ENTRY.         55900000
*                                                                       56000000
DAT03700 CLC   WRKDATA1(SIXTN),ZERO POSITIONING VECTOR                  56100000
         BNE   DAT03900            YES, MUST BE KEYED                   56200000
         TM    WRKBITS+2,REPOSRQD  IS THIS A MOVE-SET POSIT ENTRY       56300000
         BO    DAT03900            YES, INCLUD/OMIT STR MUST BE BUILT   56400000
         TM    WRKBITS,ABS         OUTPUT INCR                          56500000
         BZ    DAT01200                                                 56600000
         L     REGA,WRKTXINC       XINCR                                56700000
         L     REGB,WRKTYINC       YINCR                                56800000
         A     REGA,GDSXCOR        ADD X COR OR 0            LD YA00805 56900000
         A     REGB,GDSYCOR        ADD Y COR OR 0            LD YA00805 57000000
         LPR   REGA,REGA           POSITIVE                             57100000
         LPR   REGB,REGB           POSITIVE                             57200000
         CR    REGA,REGB           WHICH LARGER                         57300000
         BNL   NEGX                BRANCH IF X LARGER        LD YA01038 57400000
         LR    REGA,REGB                                                57500000
NEGY     TM    WRKTYINC,NEGATIVE   IS Y INCR NEG???          LD YA01038 57600000
         BZ    RPOS                BRANCH IF NO              LD YA01038 57700000
         LA    REGB,VLEN2          LOAD CRITICAL VALUE       LD YA01038 57800000
         B     DAT03800            BRANCH,GET VECTOR LENGTH  LD YA01038 57900000
NEGX     TM    WRKTXINC,NEGATIVE   IS X INCR NEG???          LD YA01038 58000000
         BZ    RPOS                BRANCH IF NO              LD YA01038 58100000
         LA    REGB,VLEN2          LOAD CRITICAL VALUE       LD YA01038 58200000
         B     DAT03800            BRANCH,GET VECTOR LENGTH  LD YA01038 58300000
RPOS     LA    REGB,VLEN1          INCR IS POSITIVE??        LD YA01038 58400000
DAT03800 LA    REGA,ONE(REGA)      ADD ONE BECAUSE 63 IS...  LD YA01038 58500000
*                                  ...LARGEST INCREMENT      LD YA01038 58600000
         TM    WRKBITS,OPT         CALLER WANT OPTIMIZED?   D11 ZA10055 58630000
         BO    DAT03802            YES,BRANCH               D11 ZA10055 58660000
ERR      CR    REGA,REGB     NO,SEE IF VECTOR IS IN RANGE    LD YA00805 58700000
         BL    DAT03801            BRANCH IF NO              LD YA00805 58800000
         SRA   REGA,EIGHT       DIVIDE BY 256                JM YA02056 59100000
         LTR   REGA,REGA        MORE THAN ONE INCR NEEDED    JM YA02056 59200000
         BNE   DAT01950         BRANCH IF YES               L5 @ZA04160 59300000
         B     DAT03803    ONLY ONE INCR VECT IS REQUIRED    JM YA02056 59400000
DAT03801 EQU   *                                             LD YA00805 59500000
         LR    REGF,REGA           SAVE VECTOR LENGTH        LD YA00805 59800000
         SRDA  REGF,32             POSITION IN ODD REG       LD YA00805 59900000
         D     REGF,SIX3                DIVIDE BY 252            YM1963 60000000
         B     DAT01950            GO GEN INCREMENTAL VECTOR  L5ZA04160 60100000
DAT03802 EQU   *                   OPTIMIZED TEST           D11  YM1963 60200000
         SRA   REGA,EIGHT          DIVIDE BY 256                        60300000
         LTR   REGA,REGA           MOVE THAN ONE INCR REQD?             60400000
         BNZ   DAT04000            YES,GO SEE IF INCR                   60500000
DAT03803 EQU   *                   OPT CAN BE GENNED AS INCR     YM1963 60600000
         NI    WRKBITS,OPTOFF      TURN OFF OPT-MAKE INCR               60700000
         B     DAT01900            GO GEN INCR VECTOR                   60800000
DAT03900 OI    WRKBITS,MULT        SET MULT SW                          60900000
         OI    WRKBITS+2,FRSTPASS  TURN ON LAST PASS SW                 61000000
         B     DAT03450            SET UP KEY STRU.                     61100000
DAT04000 TM    WRKBITS,INCR        INCREMENTAL MODE?                    61120000
         BM    DAT04025             YES                                 61140000
         XI    WRKBITS,ABS                                              61160000
         B     DAT01200                                                 61180000
DAT04025 NI    WRKBITS,OPTOFF      MAKE THE KEY INCR TYPE   D11 ZA17700 61200000
         B     DAT03900            THEN GO MAKE IT A MULT   D11 ZA17700 61300000
         EJECT                                                          61600000
*                                                                       61700000
*        FOR A KEYED ELEMENT AFTER THE VECTOR OR VECTORS HAVE BEEN      61800000
*        GENERATED, IF THIS IS A SINGLE ENTRY OF IF THIS IS THE         61900000
*        LAST PASS OF A MULTIPLE ENTRY CERTAIN PROCESSING MUST          62000000
*        TAKE PLACE.  FOR THE SINGLE ENTRY, IF A SET MODE ORDER         62100000
*        IS  PRESENT A FLAG IS SET IN THE KEY. THE BYTE OF DATA         62200000
*        THAT CONTAINS THE BEAM BIT IS ALSO SET IN THE KEY.             62300000
*        IF IT IS IN OMIT STATUS THE BEAM IS BLANKED, OTHERWISE         62400000
*        IT IS UNBLANKED.  THEN THE ROUTINE EXITS.                      62500000
*        KEYED OUTPUT LAST IN OR SINGLE                                 62600000
DAT04050 TM    WRKBITS,MULT        MULTIPLE                             62700000
         BO    DAT04900            YES                                  62800000
         TM    WRKBITS,ABS         ABS                                  62900000
         BZ    DAT04400            YES                                  63000000
         C     REGD,FOUR           INCRE-SET MODE                       63100000
         BNE   DAT04100            NO                                   63200000
         OI    WRKBITS,FRSTORD     SET SW                               63300000
DAT04100 BCTR  REGC,0              BACK UP ONE TO BYTE WITH BEAM        63400000
         TM    WRKBITS,INCLUDE                                          63500000
         BZ    DAT04300                                                 63600000
         NI    0(REGC),BEAMOFFI    TURN BEAM ON                         63700000
DAT04200 MVC   WRKBITS+1(1),0(REGC) SAVE BYTE OF DATA                   63800000
         B     DAT01550                                                 63900000
DAT04300 OI    0(REGC),BEAMINCR    TURN BEAM OFF                        64000000
         B     DAT04200                                                 64100000
DAT04400 C     REGD,SIXFLD         FIRST ORDER=SET MODE                 64200000
         BNE   DAT04500            NO                                   64300000
         OI    WRKBITS,FRSTORD     SET SW                               64400000
DAT04500 S     REGC,FOUR           POSIT TO BEAM LOC                    64500000
         TM    WRKBITS,INCLUDE     INCLUDE                              64600000
         BZ    DAT04700            NO                                   64700000
         NI    0(REGC),BEAMOFFA    TURN BEAM ON                         64800000
DAT04600 MVC   WRKBITS+1(1),0(REGC) SAVE ONE BYTE OF DATA               64900000
         B     DAT01550                                                 65000000
DAT04700 OI    0(REGC),BEAMABS     TURN OFF BEAM                        65100000
         B     DAT04600                                                 65200000
         EJECT                                                          65300000
*                                                                       65400000
*        FOR A MULTIPLE ELEMENT A CHECK IS MADE TO SEE IF THE           65500000
*        GENERATOR HAD JUST FINISHED PROCESSING THE REPOSITIONING       65600000
*        VECTOR.  IF NOT A CHECK IS MADE TO SEE IF A REPOSITIONING      65700000
*        VECTOR IS REQUIRED. IF NOT, A CALL IS MADE TO DATA STORE       65800000
*        TO RESOLVE THE UNRESOLVED ADDRESS IN THE INCLUDE OMIT          65900000
*        STRUCTURE AND THE ROUTINE EXITS.  OTHERWISE A CALL IS          66000000
*        MADE TO DATA STORE TO RESOLVE THE UNRESOLVED ADDRESS           66100000
*        IN THE INCLUDE OMIT STRUCTURE AS WELL AS GENERATE A            66200000
*        TRANSFER AROUND THE REPOSITIONING VECTOR.  THEN THE            66300000
*        REPOSITIONING VECTOR IS PLACED IN THE WORK FIELD, THE          66400000
*        SWITCH IS SET AND A BRANCH IS MADE TO GENERATE THE             66500000
*        REPOSITIONING VECTOR.                                          66600000
*                                                                       66700000
DAT04900 CLI   WRKSW+1,X'00'       WAS GENERATOR CALLED FOR INCR POS VT 66800000
         BNE   DAT05000            YES                                  66900000
         TM    WRKBITS+2,REPOSRQD  REPOS REQD                           67000000
         BO    DAT05000            NO                                   67100000
         MVI   WRKSW,OFF           SET FOR ONLY ONE                     67200000
         MVC   WRKOUTPT+4(4),GTRUORD MOVE IN GTRU AROUND POSIT VECT     67300000
         MVC   WRKOUTPT(4),FOUR    ELNGTH                               67400000
         MVI   WRKOUTPT,RESOL+UNRES SET SW TO RESOLVE ONE ADDR AND ADD  67500000
*                                  AN UNRESOLVED TO HIS CHAIN           67600000
         LA    PARM,WRKGDS1                                             67700000
*//                                                                     67800000
*//      CALL DATA STORE                                                67900000
         L     REGFIFTN,WRKDSTOR   ADDR OF DATA STORE                   68000000
         BALR  RETURN,REGFIFTN                                          68100000
         MVI   GDSGRMOD,X'00'      TURN OFF MODE SETTINGS               68200000
         MVC   WRKTXABS(EIGHT),WRKXABS MOVE IN POS VECT ABS             68300000
         MVC   WRKTXINC(EIGHT),WRKTOTX MOVE IN POS VECT INCR            68400000
         SR    REGD,REGD           ZERO COUNT                           68500000
         LA    REGC,WRKOUTPT+4                                          68600000
         MVI   WRKSW+1,REPOS       SET SWITCH THIS IS REPOS VECT        68700000
         B     DAT00150            GENERATE POSIT VECT                  68800000
         EJECT                                                          68900000
*                                                                       69000000
*        IF THE REPOSITIONING VECTOR HAS ALREADY BEEN GENERATED         69100000
*        A CALL IS MADE TO THE DATA STORE ROUTINE TO RESOLVE            69200000
*        THE UNRESOLVED ADDRESS IN THE BRANCH AROUND THE                69300000
*        REPOSITIONING  VECTOR, THE CIRRENT MODE IS SET TO              69400000
*        CONTROL AND THE ROUTINE EXITS.                                 69500000
*                                                                       69600000
DAT05000 XC    WRKOUTPT(4),WRKOUTPT     ZERO                            69700000
         MVI   WRKOUTPT,RESOL           SET SW TO RESOLVE AN ADDR       69800000
         LA    PARM,WRKGDS1                                             69900000
*//                                                                     70000000
*//      CALL DATA STORE                                                70100000
         L     REGFIFTN,WRKDSTOR   ADDR OF DATA STORE                   70200000
         BALR  RETURN,REGFIFTN                                          70300000
         MVI   GDSGRMOD,X'00'      SET MODE TO CONTROL BECAUSE OF BRAN- 70400000
*        CH INTO THE NEXT ELEMENT                                       70500000
         B     DAT01600                                                 70600000
         EJECT                                                          70700000
ERR1     L     SAVE,4(SAVE)                                             70800000
         RETURN (14,12),T,RC=4     RETURN WITH ERROR CODE               70900000
         EJECT                                                          71000000
* GDSGRMOD SWITCHES                                                     71100000
VA       EQU   X'08'               VECTOR ABS                           71200000
VI       EQU   X'04'               VECTOR INCR                          71300000
PA       EQU   X'02'               POINT ABS                            71400000
PI       EQU   X'01'               POINT INCR                           71500000
         EJECT                                                          71600000
* ORDERS                                                                71700000
         GINIT                                                          71800000
GEVMORD  GEVM                                                           71900000
GEPMORD  GEPM                                                           72000000
GEVI2ORD GEVI2                                                          72100000
GEPI2ORD GEPI2                                                          72200000
GTRUORD  GTRU  0                                                        72300000
GNOPORD  GNOP4 0                                                        72400000
         EJECT                                                          72500000
BEAMOFFI EQU   X'FE'                                                    72600000
BEAMOFFA EQU   X'BF'                                                    72700000
BEAMABS  EQU   X'40'                                                    72800000
BEAMINCR EQU   X'01'                                                    72900000
*                                                                       73000000
FIRST    EQU   X'FF'                                                    73100000
OFF      EQU   X'00'                                                    73200000
RESOL    EQU   X'02'                                                    73300000
         EJECT                                                          73400000
* TO TEST FLAGS PASSED                                                  73500000
* FLAGS+0                                                               73600000
MULT     EQU   X'80'                                                    73700000
FRSTORD  EQU   X'40'                                                    73800000
VECT     EQU   X'38'                                                    73900000
INCLUDE  EQU   X'04'                                                    74000000
ABS      EQU   X'03'               TM WRKBITS,ABS--BZ       D11         74100000
INCR     EQU   X'03'               TM WRKBITS,INCR-BM       D11         74200000
OPT      EQU   X'03'               TM WRKBITS,OPT--BO       D11 OZ10055 74300000
OPTOFF   EQU   X'FD'  USED TO MAKE OPT (X'03') INTO INCR (X'01')        74400000
* FLAGS+1 ONE BYTE OF DATA                                              74500000
* FLAGS+2                                                               74600000
FRSTPASS EQU   X'C0'                                                    74700000
KEYED    EQU   X'20'                                                    74800000
CORVLD   EQU   X'10'                                                    74900000
BEAMON   EQU   X'08'                                                    75000000
REPOSRQD EQU   X'04'                                                    75100000
REPONLY  EQU   X'02'                                                    75200000
         EJECT                                                          75300000
* REGISTERS                                                             75400000
REGZERO  EQU   0                                                        75500000
PARM     EQU   1                                                        75600000
REGA     EQU   2                   EVEN ODD PAIR                        75700000
REGB     EQU   3                   EVEN ODD PAIR                        75800000
REGC     EQU   4                                                        75900000
WORK     EQU   5                                                        76000000
REGF     EQU   6                   EVEN ODD PAIR                        76100000
REGG     EQU   7                   EVEN ODD PAIR                        76200000
GDSREG   EQU   8                                                        76300000
BASE     EQU   9                                                        76400000
ERRCD    EQU   10                                                YM1963 76500000
REGD     EQU   11                                                       76600000
SAVE     EQU   13                                                       76700000
RETURN   EQU   14                                                       76800000
REGFIFTN EQU   15                                                       76900000
         EJECT                                                          77000000
* CONSTANTS AND EQUATES                                                 77100000
ZERO     DC    4F'0'                                                    77200000
ONEFLD   DC    F'1'                                                     77300000
THREE    DC    F'3'                                                     77400000
FOUR     DC    F'4'                                                     77500000
SIXFLD   DC    F'6'                                                     77600000
SIX3     DC    F'63'                                                    77700000
FLAGS    DC    X'10'                                         LD YA00805 77800000
UNRES    EQU   X'01'                                                    77900000
PATCH    DS    0F                  40 (DEC) BYTE PATCH AREA D11         78000000
         DC    40X'FF'             ALL THE LITTLE FOXES     D11         78100000
ONE      EQU   1                                                        78200000
SIX      EQU   6                                                        78300000
EIGHT    EQU   8                                                        78400000
SIXTN    EQU   16                                                       78500000
TR4      EQU   34                                                       78600000
LOGCUR   EQU   52                                                       78700000
REPOS    EQU   X'FF'                                                    78800000
DSTOR    EQU   852                                                      78900000
STAT     EQU   24                                                       79000000
DAT01100 EQU   DAT01200                                                 79100000
DAT01900 EQU   DAT01950                                                 79200000
VLEN1    EQU   253                 CRITICAL POSITION RANGE   LD YA00805 79300000
VLEN2    EQU   251                      CRITICAL NEGATIVE RANGE  YM1963 79400000
NEGATIVE EQU   X'80'               USED TO TEST NEG INCR.    LD YA01038 79500000
GTMUPDT  EQU   X'3C'               PPNT FLG IN GTMCB        L5 @ZA04162 79600000
PPNTUPDT EQU   X'80'               SET BY PPNT IF UPDATE    L5 @ZA04162 79700000
KEYWD2   EQU   4                   2'ND WORD OF KEY         L5 @ZA04162 79800000
STMODE   EQU   X'40'               I'ST ORDER IS SET MODE   L5 @ZA04162 79900000
         EJECT                                                          80000000
WORKAREA DSECT      MAP OF INPUT PARAMETER LIST             D11         80100000
WRKADDR  DS    F                                                        80200000
WRKBITS  DS    F                                                        80300000
WRKCORVL DS    F                                                        80400000
WRKKEY   DS    F                                                        80500000
WRKGDS   DS    F                                                        80600000
WRKRTN   DS    F                                                        80700000
WRKDATA1 DS    F                                                        80800000
WRKDATA2 DS    F                                                        80900000
WRKDATA3 DS    F                                                        81000000
WRKDATA4 DS    F                                                        81100000
WRKXABS  DS    F                                                        81200000
WRKYABS  DS    F                                                        81300000
WRKXINCR DS    F                                                        81400000
WRKYINCR DS    F                                                        81500000
WRKTOTX  DS    F                                                        81600000
WRKTOTY  DS    F                                                        81700000
WRKENTCT DS    F                                                        81800000
WRKTXABS DS    F                   INITIALIZED BY SCALE                 81900000
WRKTYABS DS    F                   INITIALIZED BY SCALE                 82000000
WRKTXINC DS    F                   INITIALIZED BY SCALE                 82100000
WRKTYINC DS    F                   INITIALIZED BY SCALE                 82200000
WRKXERR  DS    F                                                        82300000
WRKYERR  DS    F                                                        82400000
WRKSW    DS    F                                                        82500000
WRKDSTOR DS    F                                                        82600000
WRKSAVE  DS    18F                 DATAGEN SAVEAREA                     82700000
*                                                                       82800000
WRKGDS1  DS    F       GDS         DATASTORE PARAMETER LIST             82900000
WRKRTN1  DS    F       RETURNCODE ARRAY                                 83000000
WRKOUTPT DS    10F     DATA TO BE OUTPUT                                83100000
         COPY  GDSCB                                                    83200000
* FOLLOWING TWO (2) FIELDS LOGICALLY APPENDED TO GDSCB FOR  D11         83300000
* ADDRESSIBILITY PURPOSES.                                  D11         83400000
GDSXCOR  DS    F                        X CORR FACTOR FOR DGEN   YM1963 83500000
GDSYCOR  DS    F                        Y CORR FACTOR FOR DGEN   YM1963 83600000
         COPY  GTMCB                                                    83700000
         COPY  GSPCB                                                    83800000
         END                                                            83900000
./  ADD  SSI=32960263,NAME=IFFAHA05
*                                                                       00100002
*                                                                       00109002
*        THE DATA STORE ROUTINE IS ENTERED FROM:                        00118002
*        DATA GENERATOR                                                 00127002
*        BGSEQ/BGSUB                                                    00136002
*        ENSEQ                                                          00145002
*        ENSUB                                                          00154002
*        LKSUB                                                          00163002
*        PTEXT                                                          00172002
*        ORGEN                                                          00181002
*                                                                       00190002
*                                                                       00200002
*                        INPUT TO THE DATA STORE ROUTINE                00300002
*                        WILL BE POINTED TO BY REGISTER 1.              00400002
*                                                                       00500002
*                        +0   A(GDSCB)                                  00600002
*                        +4   A(GSPARRAY)                               00700002
*                        +8   FLAGS                                     00800002
*                        +10  LENGTH                                    00900002
*                        +12  9 WORDS OF OUTPUT                         01000002
*                        +48  WORK AREA                                 01100002
*                                                                       01107002
*                                                                       01114002
*        EXTERNAL MACROS:                                               01121002
*                                                                       01128002
*        GWRITE                                                         01135002
*        WAIT                                                           01142002
*                                                                       01149002
*        EXTERNAL ROUTINES:                                             01156002
*                                                                       01163002
*        BUFFER MANAGEMENT                                              01170002
*        FLOW CONTROL MANAGEMENT                                        01177002
*                                                                       01184002
*                                                                       01200002
         EJECT                                                          01210002
*                                                                       01220002
*        THERE IS ONE ENTRY POINT AND THE FLAGS PASSED ARE USED TO      01230002
*        DETERMINE THE FUNCTION DESIRED.                                01240002
*                                                                       01250002
*                                                                       01300002
*                        WHEN FLAGS+0 HAVE THE FOLLOWING                01400002
*                        SETTINGS THE INPUT WILL APPEAR                 01500002
*                        AS FOLLOWS:                                    01600002
*                                                                       01700002
*   FROM BEGSEQ,DATA GEN 01   GTRU UNRES ADDR                           01800002
*                                                                       01900002
*   FROM ENDSEQ,ENDSUB   02   NO DATA RESOLVE ADDR TO                   02000002
*        DATA GEN             CURRENT LOCATION                          02100002
*                                                                       02200002
*   FROM DATA GEN        03   GTRU UNRES ADDR                           02300002
*                             ALSO RESOLVE PREVIOUS                     02400002
*                             UNRESOLVED TO CURRENT+4                   02500002
*                                                                       02600002
*    FROM BEGSUB         04   GTRU UNRES ADDR                           02700002
*                             GTRU 0                                    02800002
*                             GDRD                                      02900002
*                                                                       03000002
*    FROM BEGSUB         14   GTRU UNRES ADDR                           03100002
*                             GTRU 0                                    03200002
*                             GTRU *-4                                  03300002
*                             GDRD                                      03400002
*                                                                       03500002
*    FROM BUFSUB         08   GMVA LOC,*+10                             03600002
*                             GTRU SUBR+4                               03700002
*                             GPDI                                      03800002
*                                                                       03900002
*    FROM BUFSUB         18   GTRU *+14                                 04000002
*                             GMVA LOC,*+14                             04100002
*                             GTRU SUBR+4                               04200002
*                             GPDI                                      04300002
*                                                                       04400002
*        FROM ORGEN     20   OVERFLOW ONLY                              04430002
*                                                                       04460002
*    ALL ADDRESSES NOTED AS *+ OR *- MUST BE RESOLVED BY DATA STORE     04500002
*                                                                       04600002
*                                                                       04700002
         EJECT                                                          04800002
*                                                                       04810002
*        ON ENTRY THE WORK AREA DSECT IS INITIALIZED, THE BASE IS       04820002
*        SET UP, THE GDSCB DSECT IS INITIALIZED, THE GTMCB DSECT IS     04830002
*        INITIALIZED, AND THE SAVE AREAS ARE CHAINED.                   04840002
*                                                                       04850002
IFFAHA05 CSECT                                                          04900002
*A394500,394600;D396060,396120                                   A35620 04902002
*C595500                                                         A34801 04910002
*C132000,495000                                                  A33271 04926002
*117000-118000                                                   A27472 04930002
*138000,144000                                                   A25112 04960002
*D090000-091000,A090000-091200,C497000-498000,A540300-540600     YM1963 04980002
*A517500-517600                                                 OY02461 04990002
         SAVE  (14,12)                                                  05000002
         BALR  BASE,0              ADDRESSABILITY                       05100002
         USING *,BASE                                                   05200002
         LR    WORK,PARM           WORKAREA                             05300002
         USING WORKAREA,WORK                                            05400002
         L     GDSREG,WRKGDS       GDSCB                                05500002
         USING GDSCB,GDSREG                                             05600002
         L     ERRCD,WRKRTNCD      ERROR LOCATION                       05700002
         XC    WRKSPVSR(12),WRKSPVSR ZERO SUPERVISOR PARAMETER LIST     05800002
         L     OACB,GDSAOACB       OACB                                 05900002
         USING OACBAREA,OACB                                            06000002
         LA    REGA,WRKSAVE        CHAIN SAVE AREAS                     06100002
         ST    SAVE,WRKSAVE+4                                           06200002
         ST    REGA,8(SAVE)                                             06300002
         LR    SAVE,REGA                                                06400002
         L     GTMREG,GDSGTMCB                                          06500002
         USING GTMCB,GTMREG        STMCB                                06600002
         MVC   WRKRTN,WRKRTNCD     MOVE RETURN CODE ARRAY ADDR IN CALL  06700002
*                                  AREA FOR FUTURE CALLS                06800002
*                                                                       06820002
*        A CHECK IS MADE TO SEE IF DATA HAS EVER BEEN GENERATED         06840002
*        AND IF NOT BUFFER AND A FLOW CONTROL ENTRY ARE OBTAINED.       06860002
*                                                                       06880002
         TM    STATUS,NOBUF        HAS ANY DATA BEEN GENERATED FOR      06900002
         BO    STR00800            THIS GDS--NO-GO GET BUFFER AND ADD   07000002
*                                  TO FLOW CTL                          07100002
         EJECT                                                          07110002
*                                                                       07120002
*        IF NO FLAGS ARE PASSED IT IS ASSUMED THAT DATA IS TO BE        07130002
*        PLACED IN THE GDOA.  A CHECK IS MADE TO SEE IF THE :ATA        07140002
*        WILL FIT.  IF SO IT IS MOVED INTO THE GDOA.  THE LENGTH        07150002
*        LEFT IS REDUCED BY THE LENGTH OF THE DATA AND THE LOGICAL      07160002
*        START ADDRESS IS UPDATED BY THE LENGTH OF THE DATA.  THE       07170002
*        OLP IS ALSO UPDATED BY THE LENGTH OF THE DATA.                 07180002
*                                                                       07190002
STR00100 CLC   WRKFLAGS,ZERO       ANY FLAGS SET                        07200002
         BNE   STR01100            YES GO HANDLE THEM                   07300002
STR00150 LH    REGA,WRKLEN         PICK UP LENGTH                       07400002
         LTR   REGA,REGA           ANY DATA TO BE GENERATED             07500002
         BZ    STR00200            NO,EXIT                              07600002
         C     REGA,LENLEFT        DOES IT FIT                          07700002
         BH    STR00300            NO                                   07800002
         L     REGB,OLP            ORDER LOAD PT                        07900002
         BCTR  REGA,0              REDUCE LEN BY 1                      08000002
         EX    REGA,MOVE           MOVE INTO OUTPUT AREA                08100002
         LH    REGA,WRKLEN                                              08200002
         AR    REGB,REGA                                                08300002
         ST    REGB,OLP            UPDATE OLP                           08400002
         L     REGB,LENLEFT        REDUCE LENGTH LEFT                   08500002
         SR    REGB,REGA           BY LENGH OF DATA GENERATED           08600002
         ST    REGB,LENLEFT                                             08700002
         A     REGA,LOGCURR                                             08800002
         ST    REGA,LOGCURR        UPDATE CURRENT LOGICAL ADDR          08900002
         SPACE 3                                                        08910002
*                                                                       08920002
*        HERE THE ROUTINE RETURNS TO THE CALLING PROGRAM.               08940002
*                                                                       08960002
STR00200 LA    REGFIFTN,CODE0      RETURN CODE FOR CALLER        YM1963 09000002
STR00205 L     SAVE,4(SAVE)        RESTORE PTR TO CALLER'S SAVE  YM1963 09060002
         RETURN (14,12),T,RC=(15)  RETURN TO CALLER              YM1963 09120002
         EJECT                                                          09200002
*                                                                       09209002
*        IF THE DATA DOES NOT FIT IN THE GDOA THE ROUTINE MUST          09218002
*        OVERFLOW.  IF THE GDOA LENGTH IS 128 NO MORE BUFFER CAN        09227002
*        BE OBTAINED AND THE ROUTINE EXITS.  A CHECK IS MADE TO         09236002
*        SEE IF THE DATA CAN BE SPLIT BY COMPARING THE LENGTH TO        09245002
*        SIX.  IF THE DATA IS ABSOLUTE ORDERS THE MAXIMUM LENGTH        09254002
*        TO DATA STORE IS SIX.  IF IT IS INCREMENTAL ORDERS OR          09263002
*        TEXT THE DATA CAN BE SPLIT ON ANY HALF WORD BOUNDARY SO        09272002
*        AS MUCH AS POSSIBLE IS MOVED IN.                               09281002
*                                                                       09290002
STR00300 CLC   GDSGDOAL,F128+2                                          09300002
         BE    ERR2                                                     09400002
         TM    GDSGRMOD,X'F0'      TEXT                                 09430002
         BM    STR00320                                                 09460002
         C     REGA,SIX            CAN THE DATA BE SPLIT                09500002
         BNH   STR01000            NO                                   09600002
STR00320 L     REGB,OLP            LOAD THE OLP                         09700002
         L     REGA,LENLEFT        LOAD THE LENGTH REMAINING            09800002
         LTR   REGA,REGA           ANY DATA SPACE LEFT                  09900002
         BZ    STR03600            NO                                   10000002
         BCTR  REGA,0                                                   10100002
         EX    REGA,MOVE           MOVE IN AS MUCH AS POSSIBLE          10200002
         LH    REGB,WRKLEN         LENGTH DESIRED                       10300002
         LA    REGA,1(REGA)        RESET COUNT                          10400002
         SR    REGB,REGA           LENGTH TO GO                         10500002
         L     REGD,OLP                                                 10600002
         AR    REGD,REGA                                                10700002
         ST    REGD,OLP            UPDATE OLP                           10800002
         LA    REGC,WRKOUTPT(REGA) ADDR OF NEXT DATA                    10900002
         A     REGA,LOGCURR                                             11000002
         ST    REGA,LOGCURR        UPDATE LOGICAL BUFFER ADDR           11100002
         EJECT                                                          11110002
*                                                                       11120002
*        THE MAIN PART OF THE OVERFLOW ROUTINE IS ENTERED BY            11130002
*        LOADING THE RETURN ADDRESS IN REGISTER 14 SO THAT THE          11140002
*        PROGRAM WILL FALL THROUGH WHEN THE MAIN PORTION OF OVERFLOW    11150002
*        IS COMPLETE.  THE ENTRY POINTS WHICH BUILD INCLUDE/OMIT        11160002
*        STRUCTURES OR SEQUENCE OR SUBROUTINE STRUCTURES OR SUBROUTINE  11170002
*        LINKAGE OR THE ENTRY FOR JUST OVERFLOW WILL USE THIS PORTION   11180002
*        OF THE PROGRAM TO PROVIDE THEIR OVERFLOW FUNCTIONS ALSO.       11190002
         SPACE                                                          11195002
STR00330 LA    RETURN,STR00550     SET TO FALL THROUGH                  11200002
         SPACE 3                                                        11205002
*                                                                       11210002
*        IF THIS IS A UPDATE OVERFLOW THE ROUTINE FREES THE STORAGE     11220002
*        FOR THE UPDATE AND RETURNS A RETURN CODE TO THE CALLING        11230002
*        PROGRAM AS WELL AS PLACING ONE IN THE RETURN ARRAY.  IF        11240002
*        THIS IS AN EQUIVALINCE GRAPHIC DATA SET THE RETURN CODE        11250002
*        IS PLACED IN THE RETURN ARRAY AND A RETURN CODE IS ALSO        11260002
*        RETURNED TO THE CALLING PROGRAM.                               11270002
         SPACE                                                          11280002
STR00350 TM    STATUS,UPDT         UPDATE OVERFLOW                      11300002
         BO    STR00520            YES                                  11400002
         TM    GDSFLAGS,EQUIV      IS THIS AN EQUIV                     11500002
         BO    ERR2                YES NO MORE BUFFER CAN BE OBTAINED   11600002
         EJECT                                                          11605002
*                                                                       11610002
*        IF THE CALL WAS TO OVERFLOW ONLY THE GTRU TO THE NEXT          11620002
*        BUFFER SEGMENT IS ALREADY IN THE GDOA AND ORGEN HAS ALREADY    11630002
*        OBTAINED THE NEXT BUFFER SEGMENT SO THIS PORTION OF THE        11640002
*        OVERFLOW ROUTINE IS BYPASSED.  OTHERWISE A GTRU IS MOVED       11650002
*        INTO THE GDOA AND BUFFER IS OBTAINED.  THE BUFFER ADDRESS      11660002
*        OBTAINED IS PLACED IN THE GTRU ORDER.                          11670002
         SPACE 2                                                        11680002
         TM    WRKFLAGS,BFROVFLW   IS BUFFER REQUIRED FOR OVERFL A27472 11750002
         BM    STR00370               IF YES, GET NEXT SEGMENT   A27472 11820002
         L     REGD,OLP            LOAD THE OLP                         11900002
         MVC   0(2,REGD),GTRU      MOVE IN GTRU TO NEXT SEGMENT         12000002
         MVC   WRKPRLST,THREE      CODE FOR ADDL BUFFER                 12100002
         ST    GDSREG,WRKPRLST+4   GDSCB IN AREA                        12200002
         LA    REGA,WRKPRLST                                            12300002
         ST    REGA,WRKPRM                                              12400002
         LA    PARM,WRKPRM                                              12500002
         ST    RETURN,WRKTEMP                                           12600002
*//      CALL  BUFFER MGT          GET BUFFER                           12700002
         L     REGA,STAT(ERRCD)    ADDRESS OF STATUS TABLE              12800002
         L     REGFIFTN,BMGT(REGA) ADDR OF BUFFER MTGT                  12900002
         BALR  RETURN,REGFIFTN     BRANCH TO BUFFER MANAGEMENT          13000002
         LTR   REGFIFTN,REGFIFTN   SUCCESSFUL                           13100002
         BNE   ERR01               NO, RETURN                    A33271 13250002
         L     RETURN,WRKTEMP                                           13300002
         ST    PARM,WRKBUFR        SAVE BUFFER ADDR                     13500002
         STH   PARM,2(REGD)        STORE BUFFER ADDR IN PREV GDOA       13600002
         EJECT                                                          13605002
*                                                                       13610002
*        HERE WE PICK UP THE OVERFLOW ONLY PATH AGAIN AS WELL AS        13620002
*        THE OTHERS AND WE DETERMINE IF THERE ARE ANY UNRESOLVED        13630002
*        ADDRESSES IN THE GDOA.  IF THERE ARE THE ASSOCIATED BUFFER     13640002
*        ADDRESS IS COMPUTED AND THE CPU ADDRESS IS ZEROED AND THE      13650002
*        BUFFER ADDRESS IS SET IN THE OACB.                             13660002
STR00370 CLC   CPU1,ZERO           ANY UNRES ADDR IN GDOA               13700002
         BE    STR00390           CK IF CPU2 STILL UNRESOLVED      9293 13800002
         L     REGA,CPU1           PICK UP CPU ADDR                     13900002
         S     REGA,CRSA           SUBTRACT TO FIND DISP FROM TOP       14000002
         A     REGA,BUFSTART       ADD BUFFER START                     14100002
         ST    REGA,BUF1           SAVE BUFFER ADDR FOR RESOLUTION      14200002
         MVC   CPU1,ZERO           SET CPU TO ZERO                      14300002
STR00390 CLC   CPU2,ZERO          ANOTHER UNRES                    9293 14400002
         BE    STR00400            NO                                   14500002
         L     REGA,CPU2           PICK UP CPU                          14600002
         S     REGA,CRSA           FIND DIS                             14700002
         A     REGA,BUFSTART       ADD BUFFER START                     14800002
         ST    REGA,BUF2           SAVE BUFFER ADDR                     14900002
         MVC   CPU2,ZERO           SET CPU TO ZERO                      15000002
         EJECT                                                          15100002
*                                                                       15110002
*        NOW WE ARE READY TO WRITE THE DATA OUT.  IF FOUR BYTES OF      15120002
*        DATA MUST BE SAVED IN THE GDSCB (THESE FOUR BYTES WILL         15130002
*        BE WRITTEN OUT AT EXEC TIME TO OVERLAY THE PREVIOUS GTRU       15140002
*        TO FLOW CONTROL AND THE DATA GENERATED SINCE THE LAST          15150002
*        EXEC WILL THEN APPEAR)  THEY ARE PLACED THERE AND THE          15160002
*        START OF THE GDOA AND THE BUFFER ADDRESS WILL BY UPDATED       15170002
*        BY FOUR.                                                       15180002
STR00400 L     REGA,GTMDECB1                                            15200002
         LR    PARM,REGA                                                15300002
         L     REGE,BUFLEN         LENGTH                               15400002
         TM    STATUS,SAVEFOUR     MUST FOUR BE SAVED IN GDS            15500002
         BO    STR00700                                                 15600002
         L     REGD,CRSA                                                15700002
         EJECT                                                          15800002
*        THE PREVIOUS I/O OPERATION IS WAITED ON THEN THE GDOA IS       15900002
*        WRITTEN OUT TO THE 2250 BUFFER.                                16000002
STR00500 WAIT  ECB=(1)                                                  16100002
         ST    REGE,LEN(REGA)       MACRO REQUIRES INTEGER              16200002
         L     REGE,GTMGRDCB                                            16300002
         ST    RETURN,WRKTEMP                                           16400002
         LR    PARM,REGA                                                16500002
         CLI   0(PARM),X'7F'                                            16520002
         BNE   ERR3                                                     16540002
         NI    0(PARM),X'BF'                                            16560002
         GWRITE (PARM),STR,(REGE),,(REGD),BUFSTART+2,GDSFCBUF,MF=E      16600002
         LTR   REGFIFTN,REGFIFTN   WAS I/O START SUCCESSFUL        000B 16630002
         BNZ   ERR3                  IF NO, USE I/O ERROR CODE     000B 16660002
         L     RETURN,WRKTEMP      RESET RETURN REGISTER                16800002
         EJECT                                                          16900002
*                                                                       16910002
*        THE NEXT OACB/GDOA WILL BE INITIALIZED BY DUPLICATING          16920002
*        THE STATUS, SETTING THE LOGICAL CURRENT AND LOGICAL            16930002
*        START ADDRESS TO THE LOGICAL CURRENT ADDRESS IN THIS           16940002
*        GDOA/OACB, SETTING THE BUFFER LENGTH TO THE GDOA LENGTH        16950002
*        AND SETTING THE OLP AND CRSA ADDRESSES TO THE GDOA             16960002
*        ADDRESS.  THE BUFFER OBTAINED WILL BE PLACED IN THE            16970002
*        BUFFER START FIELD.  IF THE ENTRY WAS FOR OVERFLOW ONLY        16980002
*        IT WILL EXIT THE OVERFLOW PORTION HERE.                        16990002
STR00505 L     REGA,OTHER          PICK UP OTHER OACB                   17000002
         L     ERRCD,WRKRTNCD      RESET ERROR REG                      17100002
         MVC   STAT1(4,REGA),STATUS     SAVE STATUS                     17200002
         MVC   LOGCURR1(4,REGA),LOGCURR LOG CURRENT                     17300002
         MVC   LOGSTRT1(4,REGA),LOGCURR LOG START                       17400002
         LH    REGD,GDSGDOAL            LENGTH                          17500002
         ST    REGD,BUFLN1(REGA)   IN OACB                              17600002
         S     REGD,SIX            FOR OVERHEAD BYTES                   17700002
         ST    REGD,LENLFT1(REGA)       IN LENGTH LEFT                  17800002
         MVC   CPU3(16,REGA),CPU1       UNRES ADDRS                     17900002
         LR    OACB,REGA                RESET DSECT                     18000002
         L     REGA,GDOA           SET UP                               18100002
         ST    REGA,OLP            OLP                                  18200002
         ST    REGA,CRSA           CRSA                                 18300002
         MVC   BUFSTART,WRKBUFR                                         18400002
         MVC   BLP,WRKBUFR                                              18450002
         TM    WRKFLAGS,OVERFLOW   OVERFLOW ONLY                        18500002
         BZ    STR00510            NO                                   18600002
         BR    RETURN              YES, RETURN                          18700002
         EJECT                                                          18720002
*                                                                       18740002
*        THE CURRENT MODE SETTING IS DETERMINED AND THAT ORDER IS       18760002
*        MOVED INTO THE FIRST TWO BYTES OF THE GDOA.                    18780002
STR00510 LA    REGD,CHRBP          ADDR OF LIST OF ORDERS PT TO CHAR BP 18800002
         TM    GDSGRMOD,CBP        IS IT CHAR BASIC PROT                18900002
         BO    STR00600            YES                                  19000002
         LA    REGD,2(REGD)        NO, POINT TO CLP                     19100002
         TM    GDSGRMOD,CLP        CHAR LGE PROT                        19200002
         BO    STR00600            YES                                  19300002
         LA    REGD,2(REGD)        NO, POINT TO CBU                     19400002
         TM    GDSGRMOD,CBU        CHAR BASIC UNPROT                    19500002
         BO    STR00600            YES                                  19600002
         LA    REGD,2(REGD)        NO, POINT TO CLU                     19700002
         TM    GDSGRMOD,CLU        CHAR LGE UNPROT                      19800002
         BO    STR00600            YES                                  19900002
         LA    REGD,2(REGD)        NO POINT TO VA                       20000002
         TM    GDSGRMOD,VA         VECT ABS                             20100002
         BO    STR00600            YES                                  20200002
         LA    REGD,2(REGD)        NO PT TO VI                          20300002
         TM    GDSGRMOD,VI         VECT INCR                            20400002
         BO    STR00600            YES                                  20500002
         LA    REGD,2(REGD)        NO POINT TO PA                       20600002
         TM    GDSGRMOD,PA         POINT ABS                            20700002
         BO    STR00600            YES                                  20800002
         LA    REGD,2(REGD)        NO, POINT TO PI                      20900002
         TM    GDSGRMOD,PI         POINT INCR                           21000002
         BO    STR00600            YES                                  21100002
         LA    REGD,2(REGD)        NO, POINT TO NO OP                   21200002
         B     STR00600            STORE GNOP                           21300002
STR00520 LR    REGD,OACB           SAVE OLD OACB                        21400002
         L     REGA,OLP            LOCATION OF GTRU TO NEXT SEG         21450002
         L     OACB,OTHER          GET NEXT ON CHAIN                    21500002
         LTR   OACB,OACB           ANY MORE                             21600002
         BZ    ERR2A               NO, UPDATE OVERFLOW                  21700002
         MVC   0(2,REGA),GTRU      MOVE IN GTRU                         21730002
         MVC   2(2,REGA),BUFSTART+2 MOVE IN ADDR                        21760002
         MVC   CPU2,40(REGD)       SAVE CPU ADDR OF UNRES LOC           21800002
         L     REGA,GDOA           GET NEXT                             21900002
         B     STR00510                                                 22000002
         EJECT                                                          22100002
*                                                                       22120002
*        HERER THE DATA IS MOVED INTO THE BUFFER AND THE FIELDS ARE     22140002
*        UPDATED AND THE ROUTINE RETURNS TO THE CALLING PROGRAM.        22160002
STR00550 BCTR  REGB,0              REDUCE LENGTH BY ONE                 22200002
         EX    REGB,MOVE1          MOVE DATA IN OUTPUT AREA             22300002
         LA    REGB,ONE(REGB)                                           22400002
         L     REGD,LOGCURR                                             22500002
         AR    REGD,REGB                                                22600002
         ST    REGD,LOGCURR        UPDATE LOGICAL CURRENT               22700002
         L     REGD,LENLEFT        LENGTH LEFT                          22800002
         SR    REGD,REGB           REDUCE BY DATA LENGTH                22900002
         ST    REGD,LENLEFT                                             23000002
         LA    REGB,2(REGB)        ADD LENGTH OF SET MODE               23100002
         AR    REGB,REGA           ADD GDOA START                       23200002
         ST    REGB,OLP            IN ORDER LOAD PT                     23300002
         B     STR00200            EXIT                                 23400002
*                                                                       23420002
*        HERE THE OVERFLOW ROUTINE PLACES THE ORDER IN THE GDOA.        23440002
*        AND RETURNS TO THE PORTION OF DATA STORE AS NEEDED BY          23460002
*        THE INPUT.                                                     23480002
STR00600 MVC   0(2,REGA),0(REGD)   MOVE IN ORDER TO RESET MODE          23500002
         ST    OACB,GDSAOACB       RESET OACB ADDR IN GDSCB             23600002
         BR    RETURN                                                   23700002
*                                                                       23710002
*        THIS PORTION MOVES THE DATA INTO THE GDSCB IF ON OVERFLOW      23720002
*        IT WAS REQUIRED.  IT CHECKS TO SEE IF ANY DATA NEEDS TO        23730002
*        BE WRITTEN AFTER THE FOUR BYTES HAVE BEEN SAVED.  IF NOT       23740002
*        IT BYPASSES THE WRITE ON THE RETURN.                           23750002
STR00700 S     REGE,FOUR           REDUCE LENGTH BY FOUR                23800002
         L     REGD,BUFSTART                                            23900002
         STH   REGD,GDSREPPB       SAVE IN GDS                          24000002
         A     REGD,FOUR                                                24100002
         ST    REGD,BUFSTART       NEW BUFFER START                     24200002
         L     REGD,CRSA                                                24300002
         MVC   GDSREPDT,0(REGD)    SAVE REPL DATA                       24400002
         XI    STATUS,SAVEFOUR     TURN OFF SW                          24500002
         A     REGD,FOUR           NEW WRITE ADDR                       24600002
         LTR   REGE,REGE           IS LENGTH ZERO                       24700002
         BZ    STR00505            IYES DO NOT WRITE                    24800002
         B     STR00500                                                 24900002
         EJECT                                                          25000002
*                                                                       25010002
*        THIS PORTION OF THE DATA STORE ROUTINE OBTAINS THE BUFFER      25020002
*        AND THE FLOW CONTROL ENTRY WHEN A DATA GENERATION ROUTINE HAS  25030002
*        BEEN CALLED FOR THE FIRST TIME.  IT DETERMINES THE LENGTH OF   25040002
*        BUFFER REQUIRED AND OBTAINS IT FROM BUFFER MANAGEMENT.  THEN   25050002
*        IT CALLS FLOW CONTROL MANAGEMENT FOR A FLOW CONTROL ENTRY.     25060002
STR00800 LA    REGA,ONE            CODE FOR 128 SEGMENT                 25100002
         LH    REGB,GDSGDOAL                                            25200002
         C     REGB,F128           IS 128 DESIRED                       25300002
         BNH   STR00900            YES                                  25400002
         LA    REGA,ONE(REGA)      CODE FOR 256 MULTIPLE                25500002
         ST    REGB,WRKPRLST+8     LENGTH IN LIST                       25600002
STR00900 ST    REGA,WRKPRLST       CODE IN LIST                         25700002
         ST    GDSREG,WRKPRLST+4   GDSCB IN LIST                        25800002
         LA    REGA,WRKPRLST                                            25900002
         ST    REGA,WRKPRM                                              26000002
         LA    PARM,WRKPRM                                              26100002
*//                                                                     26200002
*//      CALL BUFFER MGT                                                26300002
*//                                                                     26400002
         L     REGB,STAT(ERRCD)    ADDR OF STATUS TABLE                 26500002
         L     REGFIFTN,BMGT(REGB) ADDR OF BUFFER MGT                   26600002
         BALR  RETURN,REGFIFTN     BRANCH TO BUFFER MGT                 26700002
         LTR   REGFIFTN,REGFIFTN   AVAILABLE                            26800002
         BNE   ERR1                NO EXIT                              26900002
         LR    REGA,PARM           SAVE BUFFER ADDR                     27000002
         ST    PARM,WRKPRLST+8     ADDR FOR FLOW CTL                    27100002
         MVC   WRKPRLST,TWO        CODE TO ADD FLOW CTL ENTRY           27200002
         LA    PARM,WRKPRM                                              27300002
*//                                                                     27400002
*//      CALL FLOW CONTROL MANAGEMENT                                   27500002
         LINK  EP=IFFAHA01                                              27700002
         LTR   REGFIFTN,REGFIFTN                                        27900002
         BNE   ERR1A               FREE BUFFER AND EXIT                 28000002
         EJECT                                                          28010002
*                                                                       28020002
*        IF SLPAT HAS BEEN CALLED BEFORE A CALL TO A DATA GENERATION    28030002
*        ROUTINE AND HAS CHANGED THE PEN MODE TO PERMIT THE PERMIT      28040002
*        ORDER IS WRITTEN OUT TO THE FLOW CONTROL ENTRY AT THIS TIME.   28050002
*                                                                       28060002
         TM    GDSFLAGS,PERMIT     IS PEN MODE PERMIT                   28100002
         BZ    STR00920            NO, NO ORDER NEED BE WRITTEN         28200002
         LA    REGB,GESD           ADDR OF ORDER                        28300002
         L     REGC,GTMGRDCB       ADDR OF DCB                          28400002
         L     PARM,GTMDECB1       ADDR OF DECB                         28500002
         WAIT  ECB=(1)             WAIT ON I/O                          28550002
         L     PARM,GTMDECB1       ADDR OF DECB                         28600002
         CLI   0(PARM),X'7F'                                            28650002
         BNE   ERR3                                                     28700002
         NI    0(PARM),X'BF'                                            28760002
         GWRITE (PARM),STR,(REGC),2,(REGB),GDSFCBUF,GDSFCBUF,MF=E       28800002
         LTR   REGFIFTN,REGFIFTN   WAS I/O START SUCCESSFUL        000B 28803002
         BNZ   ERR3                  IF NO, USE I/O ERROR CODE     000B 28806002
         EJECT                                                          28810002
*                                                                       28820002
*        THIS INLINE SUBROUTINE TURNS OFF THE BUFFER REQUIRED FLAG      28830002
*        AND SETS THE SAVE FOUR FLAG.                                   28840002
*                                                                       28850002
STR00920 LA    RETURN,STR00950     SET TO FALL THROUGH                  28900002
STR00930 ST    REGA,BUFSTART       SAVE BUFFER ADDR                     29000002
         ST    REGA,BLP            SAVE BUFFER LOAD PT                  29100002
         NI    STATUS,BUFACQ       TURN OFF BUFFER REQ SW               29200002
         OI    STATUS,SAVEFOUR     SAY ON OVERFLOW TO SAVE FOUR BYTES   29300002
         BR    RETURN              RETURN                               29400002
*                                                                       29410002
*        IF THIS IS AN EQUIVALENCE GRAPHIC DATA SET ALL OTHER           29420002
*        EQUIVALENCE GRAPHIC DATA SETS MUST BE SET UP TO SHOW THAT      29430002
*        BUFFER HAD BEEN OBTAINED, WHERE THE BUFFER IS AND WHAT         29440002
*        THE FLOW CONTROL ENTRY IS.                                     29450002
STR00950 TM    GDSFLAGS,EQUIV      IS IT EQUIV                          29500002
         BZ    STR00100            NO                                   29600002
         LR    REGB,GDSREG         SAVE GDS ADDR                        29700002
         LR    REGC,OACB           SAVE OACB ADDR                       29800002
         L     REGD,GDSSHDFD       PICK UP SHARED FOREWARD FLAG         29900002
         L     REGZERO,GDSOVDAT    PICK UP FLOW CONTROL DATA            30000002
         LH    PARM,GDSFCBUF                                            30100002
         LH    REGFIFTN,GDSBCTEL   BUFFER CONTROL TABLE ELEMENT         30200002
         MVC   WRKTEMP(1),GDSBCTID                                      30250002
STR00960 L     GDSREG,GDSSHDBK     LOAC WITH SHARED BACK                30300002
         LTR   GDSREG,GDSREG       ALL BACK PTRS DONE                   30400002
         BZ    STR00970            YES                                  30500002
         L     OACB,GDSAOACB       PICK UP OACB                         30600002
         ST    REGZERO,GDSOVDAT    STORE IN EQUIV                       30700002
         STH   PARM,GDSFCBUF                                            30800002
         STH   REGFIFTN,GDSBCTEL   BUFFER CONTROL TABLE ELEMENT         30900002
         MVC   GDSBCTID(1),WRKTEMP                                      30950002
         BAL   RETURN,STR00930     GO DET FLAGS AND SAVE BUFFER ADDR    31000002
         B     STR00960            GO TO NEXT                           31100002
STR00970 LR    GDSREG,REGD         PICK UP FOREWARD FLAGS               31200002
STR00980 LTR   GDSREG,GDSREG       ALL FOREWARD DONE                    31300002
         BZ    STR00990            YES                                  31400002
         L     OACB,GDSAOACB       GET OACB                             31500002
         ST    REGZERO,GDSOVDAT    STORE IN EQUIV                       31600002
         STH   PARM,GDSFCBUF                                            31700002
         STH   REGFIFTN,GDSBCTEL                                        31730002
         MVC   GDSBCTID(1),WRKTEMP                                      31760002
         BAL   RETURN,STR00930     GO SET FLAGS AND SAVE BUFFER ADDR    31800002
         L     GDSREG,GDSSHDFD     GET NEXT                             31900002
         B     STR00980                                                 32000002
STR00990 LR    GDSREG,REGB         RESET GDSCB                          32100002
         LR    OACB,REGC           RESET OACB                           32200002
         B     STR00100                                                 32300002
         EJECT                                                          32500002
*                                                                       32510002
*        THIS SECTION OF DATA DETERMINES IF THERE IS ANY                32520002
*        ROOM LEFT IN THE GDOA WHEN OVERFLOW WAS REQUIRED AND THE       32530002
*        DATA IS NOT TO BE SPLIT UP.  A GNOP ORDER IS PLACED IN THE     32540002
*        GDOA AND ANY REMAINING AREA IS ZEROED OUT.                     32550002
STR01000 L     REGA,LENLEFT        LOAD THE LENGTH LEFT                 32600002
         LTR   REGA,REGA           ANY ROOM LEFT                        32700002
         BE    STR03600            NO                                   32800002
         BCTR  REGA,0              REDUCE LENGTH FOR EXECUTE            32900002
         L     REGB,OLP            ADDRESS OF OLP                       33000002
         EX    REGA,ZEROOU         ZERO IT OUT                          33100002
         MVC   0(2,REGB),GNOP2     MOVE IN NOP AT START                 33200002
         LA    REGA,1(REGA)        ADD LENGTH TO RESET                  33300002
         AR    REGB,REGA           ADD LENGTH TO OLP                    33400002
         ST    REGB,OLP            STORE BACK                           33500002
         A     REGA,LOGCURR        UPDATE LOGICAL CURRENT ADDR          33600002
         ST    REGA,LOGCURR        LOGICAL CURRENT                      33700002
         B     STR03600                                                 33800002
         EJECT                                                          33820002
*                                                                       33840002
*        AT THIS LOCATION THE INPUT FLAGS ARE CHECKED TO DETERMINE WHAT 33860002
*        SPECIAL SERVICE IS DESIRED.                                    33880002
STR01100 TM    WRKFLAGS,RESOLVE    RESOLVING ADDR                       33900002
         BO    STR01300            YES                                  34000002
STR01200 TM    WRKFLAGS,CONTUNRE   CONTAIN UNRES ADDR                   34100002
         BO    STR02200                                                 34200002
         TM    WRKFLAGS,BEGSUB     BEGIN SUBR LINKAGE                   34300002
         BO    STR02600                                                 34400002
         TM    WRKFLAGS,BUFSUB     BUFSUB LINKAGE                       34500002
         BO    STR03100                                                 34600002
         TM    WRKFLAGS,OVERFLOW   OVERFLOW ONLY                        34700002
         BZ    STR00200            NO                                   34800002
         BAL   RETURN,STR00350     OVERFLOW                             34900002
         ST    OACB,GDSAOACB       RESET GDSCB                          35000002
         B     STR00200            EXIT                                 35100002
         EJECT                                                          35200002
*                                                                       35206002
*        THIS ENTRY IS MADE TO RESOLVE AN UNRESOLVED ADDRESS.  IT       35212002
*        MAY BE MADE NO DATA TO BE PLACED IN THE GDOA IN WHICH          35218002
*        CASE THE ADDRESS IS RESOLVED TO THE CURRENT ADDRESS OR         35224002
*        IT MAY BE MADE WITH A GTRU THAT CONTAINS AN UNRESOLVED         35230002
*        ADDRESS AS WELL IN WHICH CASE THE ADDRESS IS RESOLVED          35236002
*        TO THE CURRENT LOCATION PLUS FOUR.  THE ADDRESSES ARE          35242002
*        RESOLVED IN A LAST IN FIRST OUT METHOD THEREFORE THE           35248002
*        LOCATIONS CPU2, BUF2 ARE CHECKED FOR AN ADDRESS FIRST.         35254002
*        NOTE THAT IF THE ADDRESS MUST BE RESOLVED TO THE CURRENT       35260002
*        LOCATION PLUS FOUR A CHECK IS MADE TO SEE IF THERE ARE         35266002
*        AT LEAST FOUR BYTES IN THE GDOA AND IF NOT THE ROUTINE         35272002
*        WILL OVERFLOW FIRST.                                           35278002
*                                                                       35284002
STR01300 L     REGB,OLP            PICK UP ORDER LOAD PT                35300002
         TM    WRKFLAGS,CONTUNRE   UNRES ALSO                           35400002
         BZ    STR01500            NO, RESOLVE TO CURRENT               35500002
         CLC   LENLEFT,FOUR                                             35600002
         BL    STR02100            ENOUGH SPACE TO FIT                  35700002
STR01400 LA    REGB,4(REGB)        POSITION TO END OF GTRU              35800002
*                                                                       35810002
*        THE RESOLVING ADDRESS IS COMPUTED.  IF IT IS TO BE PLACED      35820002
*        IN THE CPU IT IS MOVED IN AND THE ADDRESS IS ZEROED OUT.       35830002
*        IF IT IS TO BE PLACED IN THE BUFFER IT IS WRITTEN OUT          35840002
*        TO THE BUFFER AND THE ADDRESS IN THE OACB IS THEN ZEROED OUT.  35850002
STR01500 S     REGB,CRSA           DISP FROM TOP                        35900002
         A     REGB,BUFSTART       ADDR TO RESOLVE WITH                 36000002
         CLC   CPU2(8),ZERO        IS THERE A SECOND ADDR               36100002
         BZ    STR01600            NO                                   36200002
         CLC   CPU2,ZERO           IN CPU                               36300002
         BE    STR01700            NO                                   36400002
         L     REGA,CPU2           WHERE TO BE RESOLVED                 36500002
         STH   REGB,0(REGA)        RESOLVE IT                           36600002
         MVC   CPU2(8),ZERO        ZERO IT OUT                          36700002
         B     STR01200                                                 36800002
STR01600 CLC   CPU1,ZERO           IN CPU                               36900002
         BE    STR01800            NO                                   37000002
         L     REGA,CPU1           WHERE TO BE RESOLVED                 37100002
         STH   REGB,0(REGA)        RESOLVE IT                           37200002
         MVC   CPU1(8),ZERO        ZERO OUT                             37300002
         B     STR01200                                                 37400002
STR01700 LA    REGA,BUF2+2         ADDR WHERE                           37500002
         B     STR01900                                                 37600002
         EJECT                                                          37700002
STR01750 STH   REGB,0(REGD)        STORE RESOLVING ADDR IN REP DATA     37800002
         XC    0(2,REGA),0(REGA)   ZERO OUT ADDR                        37850002
         B     STR02000            CONTINUE                             37920002
STR01800 LA    REGA,BUF1+2         ADDR WHERE                           38000002
*                                                                       38010002
*        IF THE ADDRESS IS TO BE PLACED IN THE BUFFER A CHECK IS        38020002
*        MADE TO SEE IF IT HAPPENS TO BE IN THE GDSCB INSTEAD OF        38030002
*        IN THE BUFFER ALREADY.  IF YES IT IS PLACED IN THE GDSCB.      38040002
*        OTHERWISE IT IS WRITTEN OUT.                                   38050002
STR01900 LH    REGC,GDSREPPB       GET BUFFER ADDR OF REPLACEMENT DAT   38100002
         CLC   GDSREPDT,ZERO       IS IT ZERO                           38200002
         BE    STR01920            YES                                  38300002
         LA    REGD,GDSREPDT       ADDR OF REP DATA IN GDSCB            38400002
         CH    REGC,0(REGA)        IS IT IN THE FIRST HALF              38500002
         BE    STR01750            YES                                  38600002
         LA    REGD,2(REGD)        UPDATE TO SECOND HALF                38700002
         LA    REGC,2(REGC)        UPDATE ADDR BY TWO                   38800002
         CH    REGC,0(REGA)        IS IT IN THE SECDOND HALF            38900002
         BE    STR01750            YES                                  39000002
STR01920 L     REGC,OTHER                                               39100002
         L     REGC,GDOA1(REGC)    ADDR OF OTHER GDOA                   39400002
         L     PARM,GTMDECB1      GET GSP DECB FOR I/O           A35620 39450002
         WAIT ECB=(1)             WAIT ON OVERLAPPED I/O         A35620 39460002
         STH   REGB,0(REGC)        PLACE ADDR IN OTHER GDOA             39500002
         MVC   2(2,REGC),0(REGA)   MOVE BUFFER ADDR TO A SAFE PLACE     39520002
         XC    0(2,REGA),0(REGA)                                        39540002
         LA    REGA,2(REGC)                                             39560002
         L     PARM,GTMDECB1       DECB                                 39600002
         CLI   0(PARM),X'7F'                                            39618002
         BNE   ERR3                                                     39624002
         EJECT                                                          39630002
         NI    0(PARM),X'BF'                                            39660002
         L     REGD,GTMGRDCB                                            39700002
         GWRITE (PARM),STR,(REGD),2,(REGC),(REGA),GDSFCBUF,MF=E         39800002
         LTR   REGFIFTN,REGFIFTN   WAS I/O START SUCCESSFUL        000B 39860002
         BNZ   ERR3                  IF NO, USE I/O ERROR CODE     000B 39920002
STR02000 CLC   WRKLEN,ZERO         ANY DATA TO BE GENERATED             40000002
         BE    STR00200            NO EXIT                              40100002
         B     STR01200                                                 40200002
STR02100 L     REGD,OLP            PICK UP OLP                          40400002
         CLC   LENLEFT,ZERO                                             40430002
         BE    STR02150                                                 40460002
         MVC   0(2,REGD),GNOP2     MOVE IN A NO OP IN REMAIN 2 BYTES    40500002
         LA    REGD,2(REGD)        POSITION TO GTRU                     40600002
         ST    REGD,OLP            STORE OLP                       4743 40620002
         L     REGD,LOGCURR                                        4743 40640002
         A     REGD,TWO            UPDATE LOGICAL ADDR             4743 40660002
         ST    REGD,LOGCURR                                        4743 40680002
STR02150 BAL   RETURN,STR00350          GO OVERFLOW                     40700002
         L     REGB,OLP            RETURN TO ADDR SOLUTION              40800002
         MVC   0(2,REGB),GNOP2                                     4743 40820002
         LA    REGB,2(REGB)         RESET MODE IS A NOOP           4743 40840002
         ST    REGB,OLP                                            4743 40860002
         B     STR01400                                                 40900002
         EJECT                                                          40909002
*                                                                       40918002
*        IF THE DATA TO BE GENERATED CONATINS AN UNRESOLVED ADDRESS     40927002
*        ITS LENGTH IS FOUR BYTES.  A CHECK IS MADE TO SEE IF THERE     40936002
*        ARE FOUR BYTES LEFT IN THE BUFFER.  IF NOT, IT WILL OVERFLOW.  40945002
*        OTHERWISE AN UNRESOLVED ADDRESS NOTATION IS SET UP IN THE      40954002
*        OACB FOR THIS ADDRESS AND THEN THE ROUTINE BRANCHES TO         40963002
*        THAT PORTION OF DATA STORE THAT WILL PLACE THE ORDER IN        40972002
*        THE GDOA.                                                      40981002
*                                                                       40990002
STR02200 CLC   LENLEFT,FOUR        LENGTH LEFT GREATER THAN 2           41000002
         BL    STR02500            NO                                   41100002
STR02300 L     REGD,OLP            LOAD OLP                             41200002
         LA    REGD,2(REGD)        GET CPU ADDR OF ADDR TO BE RESOLVED  41300002
         CLC   CPU1(8),ZERO        CPU1 IN USE                          41400002
         BNE   STR02400            YES                                  41500002
         ST    REGD,CPU1           NO SAVE ADDR                         41600002
         B     STR00150            GO STORE DATA                        41700002
STR02400 ST    REGD,CPU2           PLACE IN CPU2                        41800002
         B     STR00150            GO STORE DATA                        41900002
         EJECT                                                          41910002
*                                                                       41920002
*        THIS SECTION WILL TAKE CARE OF OVERFLOW FOR THE SPECIAL        41930002
*        CASES.  A CHECK IS MADE TO SEE IF THERE IS ANY ROOM LEFT       41940002
*        IN THE GDOA.  IF SO IT WILL MOVE IN A GNOP AND POSITION        41950002
*        TO THE GTRU WHICH IS TO BE PLACED IN THE GDOA BY THE           41960002
*        OVERFLOW ROUTINE.                                              41970002
STR02500 CLC   LENLEFT,ZERO        ANY LENGTH LEFT                      42000002
         BE    STR02550            NO                                   42100002
         L     REGD,OLP            PI K UP OLP                          42200002
         MVC   0(2,REGD),GNOP2     PLACE NO OP IN REMAINING 2 BYTES     42300002
         LA    REGD,2(REGD)        POSITION TO GTRU                     42400002
         ST    REGD,OLP            RETURN TO OLP                        42500002
         L     REGD,LOGCURR        PICK UP LOGICAL CURRANT              42600002
         A     REGD,TWO            ADD TWO FOR NOP                      42700002
         ST    REGD,LOGCURR        RETURN TO LOGICAL CURRENT            42800002
STR02550 BAL   RETURN,STR00350     GO GET NEW BUFFER                    42900002
         L     REGD,OLP            ADDR OF OLP                          43000002
         MVC   0(2,REGD),GNOP2     MOVE IN NOP TO CONTROL               43100002
         LA    REGD,2(REGD)        ADDRESS OF OLP UPDATED               43200002
         ST    REGD,OLP            STORE IN OLP                         43300002
         B     STR02300            GO TO HANDLE UNRES ADDR              43400002
         EJECT                                                          43410002
*                                                                       43420002
*        THIS PART OF THE PROGRAM PUTS OUT THE BGSUB LINKAGE.           43430002
*        IF IT WILL NOT FIT IT WILL OVERFLOW FIRST, OTHERWISE THE       43440002
*        LOCATION OF THE UNRESOLVED ADDRESS IS NOTED.  THE BRANCHES     43450002
*        WITHIN THEMSELVES ARE COMPUTED AND STORED IN THE INPUT AREA    43460002
*        FROM THE CALLING ROUTINE AND THEN THE STORE PORTION OF         43470002
*        THIS PROGRAM WILL PLACE THE ORDERS IN THE GDOA.                43480002
*                                                                       43490002
STR02600 CLC   LENLEFT,FRTN        FIT IN OUT AREA                      43500002
         BL    STR02800            NO MAYBE NO                          43600002
STR02700 L     REGD,OLP                                                 43700002
         LA    REGD,2(REGD)                                             43800002
         ST    REGD,CPU1           UNRES CPU ADDR SAVED                 43900002
         TM    WRKFLAGS,INCL       IS INCLUDE OMIT STRUCTURE PRESENT    44000002
         BZ    STR00150            NO, GO STORE DATA                    44100002
         LA    REGD,2(REGD)        UPDATE TO RESOLVING ADDR OF          44200002
*                                  FUTURE GTRU                          44300002
         S     REGD,CRSA                                                44400002
         A     REGD,BUFSTART       ADDR USED TO RESOLVE                 44500002
         STH   REGD,WRKOUTPT+10    STORE IN OUTPUT                      44600002
         B     STR00150            GO STORE DATA                        44700002
STR02800 TM    WRKFLAGS,INCL       DO WE REALLY ONLY NEED 10            44900002
         BO    STR03000            NO, WE NEED 14                       45000002
         CLC   LENLEFT,TEN         DO WE HAVE TEN AT LEAST              45100002
         BNL   STR02700            YES                                  45200002
STR03000 LA    REGB,STR02700                                            45300002
*                                                                       45320002
*        HERE IF OVERFLOW IS NECESSARY THE GDOA IS ZEROED AND           45340002
*        A GNOP MOVED IN BEFORE GOING TO THE OVERFLOW ROUTINE.          45360002
STR02900 CLC   LENLEFT,ZERO        ANY LENGTH LEFT                      45400002
         BE    STR02950            NO                                   45500002
         L     REGC,LENLEFT        POCK UP LENGTH LEFT                  45600002
         BCTR  REGC,0              REDUCE BY 1                          45700002
         L     REGD,OLP            PICK UP OLP                          45800002
         EX    REGC,ZEROOUT        ZERO OUT TO NULL UP TO TRANS ORD     45900002
         MVC   0(2,REGD),GNOP2     MOVE IN A NO OP                      46000002
         A     REGD,LENLEFT        POSITION TO GTRU                     46100002
         ST    REGD,OLP            RESTORE LLP                          46200002
         L     REGD,LOGCURR        LOCICAL CURR                         46300002
         A     REGD,LENLEFT        ADD LENGTH LEFT                      46400002
         ST    REGD,LOGCURR        STORE                                46500002
STR02950 BAL   RETURN,STR00350     GO GET NEW BUFFER                    46600002
         L     REGD,OLP            ADDR OF OLP                          46700002
         MVC   0(2,REGD),GNOP2     MOVE IN NOP TO CONTROL               46800002
         LA    REGD,2(REGD)        ADDRESS OF OLP UPDATED               46900002
         ST    REGD,OLP            STORE IN OLP                         47000002
         BR    REGB                                                     47100002
         EJECT                                                          47110002
*                                                                       47120002
*        THIS ENTRY IS MADE TO GENERATE A SUBROUTINE LINKAGE.  IF       47130002
*        IT WILL NOT FIT IN THE GDOA THE ROUTINE WILL OVERFLOW          47140002
*        FIRST.  OTHERWISE THE TRANSFERS ARE RESOLVED AND THE           47150002
*        ROUTINE GOES TO THE STORE PORTION OF THE PROGRAM.              47160002
*                                                                       47170002
STR03100 CLC   LENLEFT,SXTN        SIXTEEN OR MORE LEFT                 47200002
         BL    STR03400            NO                                   47300002
STR03200 L     REGC,OLP                                                 47400002
         LA    REGC,10(REGC)       ADDR WHICH WILL RESOLVE IF NO INCLUD 47500002
         S     REGC,CRSA                                                47600002
         A     REGC,BUFSTART                                            47700002
         TM    WRKFLAGS,INCL       INCLUDE STRUCTURE                    47800002
         BO    STR03300            YES                                  47900002
         STH   REGC,WRKOUTPT+4     RESOLVE ADDR                         48000002
         B     STR00150            GO TO STORE DATA                     48100002
STR03300 LA    REGC,4(REGC)        LENGTH TO END 4 GR WITH INCL/OMIT    48200002
         STH   REGC,WRKOUTPT+2     RESOLVE ADDR IN INCL/OMIT            48300002
         STH   REGC,WRKOUTPT+8     RESOLVE ADDR IN OTHER                48400002
         B     STR00150            GO TO STORE DATA                     48500002
STR03400 TM    WRKFLAGS,INCL       INCLUDE                              48600002
         BO    STR03500            NO                                   48700002
         CLC   LENLEFT,TWLV        MORE THAN 12                         48800002
         BNL   STR03200            YES                                  48900002
STR03500 LA    REGB,STR03200       GO GET BUFFER                        49000002
         B     STR02900                                                 49100002
STR03600 LA    REGC,WRKOUTPT       OUTPUT ADDRESS                       49200002
         LH    REGB,WRKLEN         PICK UP ENTIRE LENGTH IN REGISTER    49300002
         B     STR00330                                                 49400002
         EJECT                                                          49450002
ERR01    SR    REGZERO,REGZERO     SET LENGTH TO ZERO            A33271 49650002
         ST    REGZERO,LENLEFT                                   A33271 49660002
ERR1     OI    0(ERRCD),STORAGE    SET STORAGE EXCEED FLAG       A33271 49670002
         MVC   STOR(4,ERRCD),THREE  BUFFER                              49692002
ERREXIT  LA    REGFIFTN,CODE8      RETURN CODE TO CALLER         YM1963 49700002
         B     STR00205            RETURN TO CALLER              YM1963 49800002
ERR1A    LA    REGA,4                                                   49900002
         CLC   GDSGDOAL,F128+2     128 SEGMENT, CODE OK                 50000002
         BE    ERR1B                                                    50100002
         LA    REGA,1(REGA)        CODE FOR IKL RELEASE                 50200002
ERR1B    ST    REGA,WRKPRLST                                            50300002
         LA    PARM,WRKPRM                                              50400002
*//      CALL BUFFER MGT                                                50500002
         L     REGFIFTN,STAT(ERRCD)                                     50600002
         L     REGFIFTN,BMGT(REGFIFTN)                                  50700002
         BALR  RETURN,REGFIFTN                                          50800002
         B     ERREXIT             EXIT                                 50900002
ERR2A    LR    OACB,REGD           RESET OACB ADDR                      51000002
         L     REGD,ORIG                                                51100002
         ST    REGD,GDSAOACB       RESET ORIG OACB                      51200002
         L     REGZERO,BUF1        LENGTH FOR FREEMAIN                  51300002
         L     PARM,CPU1           ADDR OF FREEMAIN                     51400002
         FREEMAIN R,LV=(0),A=(1)   FREEMAIN OF CORE FROM UPDATE         51500002
         OI    0(ERRCD),STORAGE                                         51520002
         OI    STOR+3(ERRCD),ONE   UPDATE OVERFLOW                      51540002
         B     ERREXIT                                                  51560002
ERR2     OI    0(ERRCD),STORAGE    SET STORAGE EXCEEDED FLAG            51600002
         MVC   STOR(4,ERRCD),TWO   SELF DEFINED LIMIT EXCEEDED          51700002
         SR    REGZERO,REGZERO      SET LENGTH TO ZERO          OY02461 51750002
         ST    REGZERO,LENLEFT      STORE IN LENLEFT FIELD      OY02461 51760002
         B     ERREXIT                                                  51800002
ERR3     L     ERRCD,WRKRTNCD                                           51820002
         OI    0(ERRCD),IO                                              51840002
         B     ERREXIT                                                  51860002
         EJECT                                                          51900002
* REGISTERS                                                             52000002
REGZERO  EQU   0                                                        52100002
PARM     EQU   1                                                        52200002
REGA     EQU   2                                                        52300002
REGB     EQU   3                                                        52400002
REGC     EQU   4                                                        52500002
WORK     EQU   5                                                        52600002
ERRCD    EQU   6                                                        52700002
*//*//*                                                                 52800002
*//*//*  CAUTION: REGE IS THE SAME REGISTER AS ERRCD                    52900002
*//*//*  ERRCD WILL BE RESET AT STR00505                                53000002
*//*//*                                                                 53100002
REGE     EQU   6         ///*** CAUTION--SAME REGISTER AS ERRCD         53200002
GTMREG   EQU   7                                                        53300002
GDSREG   EQU   8                                                        53400002
BASE     EQU   9                                                        53500002
OACB     EQU   10                                                       53600002
REGD     EQU   11                                                       53700002
SAVE     EQU   13                                                       53800002
RETURN   EQU   14                                                       53900002
REGFIFTN EQU   15                                                       54000002
CODE0    EQU   0                   RETURN CODE 0                 YM1963 54030002
CODE8    EQU   8                   RETURN CODE 8-GDOA FREED      YM1963 54060002
         EJECT                                                          54100002
         GINIT                                                          54200002
CHRBP    GECP  B                   D     R     T     P     R            54300002
CHRLP    GECP  L                    O     E     H     H     S           54400002
CHRBU    GECF  B                           O     E     I                54500002
CHRLU    GECF  L                      N     R     S     C               54600002
VABS     GEVM  A                       O     D     E                    54700002
VINC     GEVI2                          T     E           O             54800002
PABS     GEPM  A                               R    G      R            54900002
PINC     GEPI2                                       R      D           55000002
GNOP2    GNOP2                                        A      E          55100002
GESD     GESD                                                           55200002
         EJECT                                                          55300002
CBP      EQU   X'80'               SWITCH SETTINGS FOR GDSGRMOD         55400002
CLP      EQU   X'40'                                                    55500002
CBU      EQU   X'20'                                                    55600002
CLU      EQU   X'10'                                                    55700002
VA       EQU   X'08'                                                    55800002
VI       EQU   X'04'                                                    55900002
PA       EQU   X'02'                                                    56000002
PI       EQU   X'01'                                                    56100002
GDOA1    EQU   4                                                        56200002
STAT1    EQU   8                                                        56300002
CRSA1    EQU   12                                                       56400002
OLP1     EQU   16                                                       56500002
BLP1     EQU   20                                                       56600002
BUFSTRT1 EQU   24                                                       56700002
BUFLN1   EQU   28                                                       56800002
CPU3     EQU   32                                                       56900002
LOGSTRT1 EQU   48                                                       57000002
LOGCURR1 EQU   52                                                       57100002
LENLFT1  EQU   56                                                       57200002
STOR     EQU   12                                                       57300002
STORAGE  EQU   X'10'                                                    57400002
UPDT     EQU   X'20'                                                    57500002
         EJECT                                                          57600002
MOVE1    MVC   2(1,REGA),0(REGC)                                        57700002
ZEROOUT  XC    0(1,REGD),0(REGD)                                        57800002
MOVE     MVC   0(1,REGB),WRKOUTPT                                       57900002
CONTUNRE EQU   X'01'                                                    58000002
RESOLVE  EQU   X'02'                                                    58100002
BEGSUB   EQU   X'04'                                                    58200002
INCL     EQU   X'10'                                                    58300002
BUFSUB   EQU   X'08'                                                    58400002
NOBUF    EQU   X'80'                                                    58500002
ONE      EQU   1                                                        58600002
BUFACQ   EQU   X'7F'                                                    58700002
SAVEFOUR EQU   X'40'                                                    58800002
LEN      EQU   20                                                       58900002
EQUIV    EQU   X'08'                                                    59000002
CVTLINK  EQU   8                                                        59100002
BMGT     EQU   816                                                      59200002
STAT     EQU   24                                                       59300002
CURSOR   EQU   X'20'                                                    59400002
OVERFLOW EQU   X'20'                                                    59500002
BFROVFLW EQU   X'60'         ORGEN REQUIRES BUFFER FOR OVERFLOW  A34801 59550002
PERMIT   EQU   X'01'                                                    59600002
IO       EQU   X'04'                                                    59650002
FOUR     DC    F'4'                                                     59700002
ZERO     DC    2F'0'                                                    59800002
TWO      DC    F'2'                                                     59900002
F128     DC    F'128'                                                   60000002
THREE    DC    F'3'                                                     60100002
FRTN     DC    F'14'                                                    60200002
SXTN     DC    F'16'                                                    60300002
TEN      DC    F'10'                                                    60400002
TWLV     DC    F'12'                                                    60500002
GTRU     GTRU  0                                                        60600002
SIX      DC    F'6'                                                     60700002
ZEROOU   XC    0(1,REGB),0(REGB)   ZERO OUT AN AREA                     60800002
         EJECT                                                          60900002
WORKAREA DSECT                                                          61000002
WRKGDS   DS    F                                                        61100002
WRKRTNCD DS    F                                                        61200002
WRKFLAGS DS    H                                                        61300002
WRKLEN   DS    H                                                        61400002
WRKOUTPT DS    9F                                                       61500002
WRKSAVE  DS    18F                                                      61600002
WRKSPVSR DS    3F                                                       61700002
WRKTEMP  DS    F                                                        61800002
WRKPRLST DS    4F                                                       61900002
WRKBUFR  DS    F                                                        62000002
WRKPRM   DS    F                                                        62100002
WRKRTN   DS    F                                                        62200002
         EJECT                                                          62300002
OACBAREA DSECT                                                          62400002
OTHER    DS    F                                                        62500002
GDOA     DS    F                                                        62600002
STATUS   DS    F                                                        62700002
CRSA     DS    F                                                        62800002
OLP      DS    F                                                        62900002
BLP      DS    F                                                        63000002
BUFSTART DS    F                                                        63100002
BUFLEN   DS    F                                                        63200002
CPU1     DS    F                                                        63300002
BUF1     DS    F                                                        63400002
CPU2     DS    F                                                        63500002
BUF2     DS    F                                                        63600002
LOGSTRT  DS    F                                                        63700002
LOGCURR  DS    F                                                        63800002
LENLEFT  DS    F                                                        63900002
ORIG     DS    F                                                        64000002
         COPY  GDSCB                                                    64100002
         COPY  GTMCB                                                    64200002
         COPY  GSPCB                                                    64300002
         END                                                            64400002
./  ADD  SSI=20480328,NAME=IFFAHA06
         TITLE 'IFFAHA06 - SCALE'                                       00010021
*                                                                       00020021
*STATUS: CHANGE LEVEL 000                                               00030021
*                                                                       00040021
*FUNCTION/OPERATION: CONVERTS COORIDNATES SUPPLIED IN USER TYPE (ABSO-  00050021
*        LUTE OR INCREMENTAL) AND MODE (FLOATING-POINT OR INTEGER).     00060021
*        INTO INTEGER RASTER UNIT COORDINATES. THE OUTPUT IS IN BOTH    00070021
*        ABSOLUTE AND INCREMENTAL FORMS.                                00080021
*                                                                       00090021
*        WHEN ENTERED AT IFFAHA15,THE CONTENTS OF REGISTER 1 ARE        00100021
*        CONVERTED FROM FLOATING-POINT TO INTEGER DATA FORMAT.          00110021
*                                                                       00120021
*ENTRY POINTS: IFFAHA06 - SCALE                                         00130021
*              IFFAHA15 - FLOATING-POINT TO INTEGER CONVERSION          00140021
*                                                                       00150021
*INPUT:  ON ENTRY AT IFFAHA06 REGISTER 1 POINTS TO A WORKAREA, THE      00160021
*        FIRST 13 WORDS OF WHICH ARE THE PARAMETER LIST FOR SCALE       00170021
*     + 0 A(GDSCB)                                                      00180021
*     + 4 A(RETURN ARRAY)                                               00190021
*     + 8 IGNORED                                                       00200021
*     +24 ABSOLUTE X VALUE OR ZERO                                      00210021
*     +28 ABSOLUTE Y VALUE OR ZERO                                      00220021
*     +32 INCREMENTAL X VALUE OR ZERO                                   00230021
*     +36 INCREMENTAL Y VALUE OR ZERO                                   00240021
*     +40 IGNORED                                                       00250021
*     +48NUMBER OF COORDINATES PREVIOUSLY SCALED                        00260021
*                                                                       00270021
*        ON ENTRY AT IFFAHA15, REGISTER 1 CONTAINS THE NUMBER TO BE     00280021
*        CONVERTED FROM FLOATING-POINT TO INTEGER                       00290021
*                                                                       00300021
*OUTPUT: ON RETURN FROM A CALL TO IFFAHA06, THE ABSOLUTE AND INCREMEN-  00310021
*        TAL INTEGER RASTER UNITS VALUES EQUIVALENT TO THE INPUT        00320021
*        COORDINATES ARE PLACED IN THE CORRESPONDING LOCATIONS IN THE   00330021
*        INPUT ARRAY.                                                   00340021
*                                                                       00350021
*        ON RETURN FROM A CALL TO IFFAHA15, REGISTER 1 CONTAINS THE     00360021
*        INTEGER EQUIVALENT OF THE FLOATING-POINT NUMBER IT CONTAINED   00370021
*        ON ENTRY                                                       00380021
*                                                                       00390021
*EXTERNAL ROUTINES: NONE                                                00400021
*                                                                       00410021
*EXITS-NORMAL: VIA RETURN MACRO TO THE CALLER WITH REGISTER 15 EQUAL    00420021
*        TO ZERO FOR BOTH IFFAHA06 AND IFFAHA15.                        00430021
*                                                                       00440021
*     -ERROR:  VIA RETURN MACRO TO THE CALLER WITH REGISTER 15 EQUAL    00450021
*        TO FOUR FOR BOTH IFFAHA06 AND IFFAHA15.                        00460021
*                                                                       00470021
*TABLES/WORKAREAS: GSP WORKAREA                                         00480021
*                                                                       00490021
*ATTRIBUTES: PROBLEM STATE, REENTRANT                                   00500021
*                                                                       00510021
IFFAHA06 CSECT                                                          00520021
*                                                                A29395 00570021
*2024,708000-716000                                                4902 00620021
         SAVE  (14,12)                                                  00800021
         BALR  SCA09,0                 ADDRESSABILITY FOR ROUTINE       01200021
         USING *,SCA09                                                  01600021
*                                                                       02000021
         LR    SCA10,SCA01             ADDRESSABILITY FOR PARAMETERS    02400021
         USING SCALWRK,SCA10           AND WORKAREA                     02800021
*                                                                       03200021
         LA    SCA02,SCASAVE           CHAIN                            03600021
         ST    SCA13,SCASAVE+4         SAVE                             04000021
         ST    SCA02,MSVA(SCA13)       AREAS                            04400021
         LR    SCA13,SCA02             AND ESTABLISH NEW SAVE AREA      04800021
*                                                                       05200021
         L     SCA11,SCAGDSCB          ADDRESSABILITY FOR               05600021
         USING GDSCB,SCA11             GDSCB                            06000021
         L     SCA08,SCARTNA           ADDRESSABILITY FOR RETURN ARRAY  06400021
         USING GSPARRAY,SCA08                                           06800021
*                                                                       07200021
         TM    GDSDATMD,REALX          ARE X'S REAL                     07600021
         BZ    SCA004                  NO                               08000021
         LE    SCA00F,GDSXVRUR         YES, COMPUTE GURX-GLLX           08400021
         SE    SCA00F,GDSXVRLL                                          08800021
         LE    SCA02F,GDSUVLUR         COMPUTE GURU-GLLU                09200021
         SE    SCA02F,GDSUVLLL                                          09600021
         TM    GDSDATMD,XRLABS         X REAL AND ABSOLUTE              10000021
         BZ    SCA002                  NO                               10400021
         LE    SCA04F,SCAXABS          COMPUTE  U-GLLU                  10800021
         SE    SCA04F,GDSUVLLL                                          11200021
         MER   SCA00F,SCA04F           COMPUTE (U-GLLU)(GURX-GLLX)/     11600021
         DER   SCA00F,SCA02F                                            12000021
*                                      (GURU-GLLU)                      12400021
         AE    SCA00F,GDSXVRLL         ADD GLLX                         12800021
         STE   SCA00F,SCAXABS          STORE                            13200021
*                                                                       13600021
         L     SCA01,SCAXABS           CONVERT SCALED X VALUE           14000021
         LA    SCA15,IFFAHA15          TO INTEGER                       14400021
         BALR  SCA14,SCA15                                              14800021
         LTR   SCA15,SCA15             TEST RETURN CODE                 15200021
         BP    SCA013                                                   15600021
*                                                                       16000021
SCA001   ST    SCA01,SCAXABS           STORE CONVERTED VALUE            16400021
         SH    SCA01,GDSXCURR          COMPUTE INCREMENT                16800021
         ST    SCA01,SCAXINC           AND STORE                        17200021
         B     SCA006                  PROCESS Y VALUE                  17600021
SCA002   ME    SCA00F,SCAXINC          MULTIPLY BY INPUT                18000021
         DER   SCA00F,SCA02F                                            18400021
         STE   SCA00F,SCAXINC          AND STORE                        18800021
*                                                                       19200021
         L     SCA01,SCAXINC           CONVERT INCREMENT                19600021
         LA    SCA15,IFFAHA15          TO INTEGER                       20000021
         BALR  SCA14,SCA15                                              20400021
         LTR   SCA15,SCA15             TEST RETURN CODE                 20800021
         BP    SCA013                                                   21200021
*                                                                       21600021
SCA003   A     SCA01,GDSXLAST          COMPUTE ABSOLUTE X               22200021
         B     SCA001                  STORE IT AND COMPUTE INCREMENT   22800021
*                                                                       23600021
SCA004   L     SCA01,GDSXVIUR          COMPUTE GURX-GLLX                24000021
         S     SCA01,GDSXVILL                                           24400021
         L     SCA02,GDSUVLUR          COMPUTE GURU-GLLU                24800021
         S     SCA02,GDSUVLLL                                           25200021
*                                                                       25600021
         TM    GDSDATMD,XINABS         X INTEGER ABSOLUTE               26000021
         BZ    SCA005                  NO                               26400021
         L     SCA03,SCAXABS           COMPUTE  U-GLLU                  26800021
         S     SCA03,GDSUVLLL                                           27200021
         MR    SCA00,SCA03             COMPUTE (U-GLLU)(GURX-GLLX)      27600021
         DR    SCA00,SCA02             DIVIDE                           28000021
         A     SCA01,GDSXVILL          ADD GLLX                         28400021
         B     SCA001                  STORE                            28800021
*                                                                       29200021
SCA005   M     SCA00,SCAXINC           MULTIPLY BY INPUT VALUE          29600021
         DR    SCA00,SCA02             DIVIDE                           30000021
         B     SCA003                  STORE                            30400021
*                                                                       30800021
SCA006   TM    GDSDATMD,REALY          Y VALUE REAL                     31200021
         BZ    SCA011                  NO                               31600021
         LE    SCA00F,GDSYVRUR         COMPUTE GURY-GLLY                32000021
         SE    SCA00F,GDSYVRLL                                          32400021
         LE    SCA02F,GDSVVLUR         COMPUTE GURV-GLLV                32800021
         SE    SCA02F,GDSVVLLL                                          33200021
         TM    GDSDATMD,YRLABS         Y REAL ABSOLUTE                  33600021
         BZ    SCA009                  NO                               34000021
         LE    SCA04F,SCAYABS          COMPUTE  V-GLLV                  34400021
         SE    SCA04F,GDSVVLLL                                          34800021
         MER   SCA00F,SCA04F           COMPUTE FIRST TERM               35200021
         DER   SCA00F,SCA02F                                            35600021
         AE    SCA00F,GDSYVRLL         ADD GLLY                         36000021
         STE   SCA00F,SCAYABS                                           36400021
*                                                                       36800021
         L     SCA01,SCAYABS           CONVERT                          37200021
         LA    SCA15,IFFAHA15          TO INTEGER                       37600021
         BALR  SCA14,SCA15                                              38000021
         LTR   SCA15,SCA15             TEST RETURN CODE                 38400021
         BP    SCA013                                                   38800021
*                                                                       39200021
SCA007   ST    SCA01,SCAYABS           STORE INTEGER Y                  39600021
         SH    SCA01,GDSYCURR          COMPUTE INCREMENT                40000021
         ST    SCA01,SCAYINC           STORE IT                         40400021
*                                                                       40800021
SCA008   L     SCA02,SCAPTCNT          GOOD RETURN--INCREMENT           41200021
         A     SCA02,SCA0001           POINT COUNT BY ONE               41600021
         ST    SCA02,SCAPTCNT                                           42000021
         NI    GSPARRAY,NOSCALER                                        42400021
         L     SCA13,HSVA(SCA13)                                        42800021
         RETURN (14,12),T,RC=0                                          43200021
*                                                                       43600021
SCA009   ME    SCA00F,SCAYINC          MULTIPLY BY INPUT                44000021
         DER   SCA00F,SCA02F                                            44400021
         STE   SCA00F,SCAYINC          STORE                            44800021
         L     SCA01,SCAYINC           CONVERT                          45200021
         LA    SCA15,IFFAHA15          TO INTEGER                       45600021
         BALR  SCA14,SCA15                                              46000021
         LTR   SCA15,SCA15             TEST RETURN CODE                 46400021
         BP    SCA013                                                   46800021
SCA010   A     SCA01,GDSYLAST          COMPUTE ABSOLUTE Y               47400021
         B     SCA007                  STORE IT AND COMPUTE INCREMENT   48000021
*                                                                       48800021
SCA011   L     SCA01,GDSYVIUR          COMPUTE GURY-GLLY                49200021
         S     SCA01,GDSYVILL                                           49600021
         L     SCA02,GDSVVLUR          COMPUTE GURU-GLLU                50000021
         S     SCA02,GDSVVLLL                                           50400021
         TM    GDSDATMD,YINABS         Y INTEGER ABSOLUTE               50800021
         BZ    SCA012                  NO                               51200021
*                                                                       51600021
         L     SCA03,SCAYABS           COMPUTE  V-GLLV                  52000021
         S     SCA03,GDSVVLLL                                           52400021
         MR    SCA00,SCA03             COMPUTE (V-GLLV)(GURY-GLLY)      52800021
         DR    SCA00,SCA02             DIVIDE                           53200021
         A     SCA01,GDSYVILL          ADD GLLY                         53600021
         B     SCA007                  STORE                            54000021
*                                                                       54400021
SCA012   M     SCA00,SCAYINC           MULTIPLY BY INPUT                54800021
         DR    SCA00,SCA02             DIVIDE                           55200021
         B     SCA010                  STORE                            55600021
*                                                                       56000021
SCA013   OI    GSPARRAY,SCALERR        SET RETURN CODE ARRAY FLAG       56400021
         MVC   GSPARRAY+8(4),SCAPTCNT  AND COUNT                        56800021
         L     SCA13,HSVA(SCA13)       RETURN                           57200021
         RETURN (14,12),T,RC=4                                          57600021
         ENTRY IFFAHA15                                                 58000021
IFFAHA15 SAVE  (14,12)                                                  58400021
         BALR  FPI09,0                                                  58800021
         USING *,FPI09                                                  59200021
         SR    FPI15,FPI15             ZERO REGISTER 15                 59600021
         LR    FPI02,FPI01             ISOLATE THE                      60000021
         SRL   FPI02,FPI22             CHARACTERISTIC                   60400021
         N     FPI02,FPI00001          IN A REGISTER                    60800021
         S     FPI02,FPI0256           TEST EXPONENT                    61200021
         BC    12,FPI006               LESS THAN OR EQUAL TO ZERO       61600021
         C     FPI02,FPI0032           POSITIVE. SEE IF OVERFLOW        62000021
         BH    FPI005                  WILL OCCUR ON CONVERSION         62400021
         LR    FPI00,FPI01             ISOLATE MANTISSA                 62800021
         N     FPI00,FPI00002                                           63200021
         S     FPI02,FPI0024           GET SHIFT COUNT                  63600021
         BP    FPI004                  POSITIVE--SHIFT MANTISSA LEFT    64000021
         LPR   FPI02,FPI02             NEGATIVE OR ZERO--GET PROPER     64400021
         SRA   FPI00,0(FPI02)          SHIFT COUNT AND SHIFT RIGHT      64800021
*                                                                       65200021
FPI001   LTR   FPI01,FPI01             SEE IF NUMBER IS NEGATIVE        65600021
         BC    10,FPI003               POSITIVE OR ZERO                 66000021
         LNR   FPI01,FPI00             NEGATIVE--COMPLEMENT VALUE       66400021
*                                                                       66800021
FPI002   ST    FPI01,ONESV(FPI13)      STORE CONVERTED VALUE IN         67200021
*                                      SAVE AREA                        67600021
         RETURN (14,12),T,RC=(15)      AND RETURN                       68000021
*                                                                       68400021
FPI003   LR    FPI01,FPI00             PLACE CONVERTED VALUE IN         68800021
*                                      REGISTER 1                       69200021
         B     FPI002                  AND RETURN                       69600021
*                                                                       70000021
FPI004   C     FPI00,FPI00003          WILL OVERFLOW OCCUR              70400021
         BNL   FPI011(FPI02)      IF BIT 8 ON, USE BRANCH TABLE    4902 70700021
FPI010   SLA   FPI00,0(FPI02)        SHIFT MANTISSA LEFT 4 OR 8    4902 71000021
FPI011   B     FPI001                CHECK FOR NEGATIVE NUMBERS    4902 71300021
FPI012   B     FPI010             BRANCH TAB ENTRY TO CONTINUE     4902 71600021
*                                                                       72000021
FPI005   LA    FPI15,FPI04             OVERFLOW--SET NON-ZERO RETURN    72400021
*                                      CODE IN REGISTER 15              72800021
         B     FPI002                                                   73200021
*                                                                       73600021
FPI006   SR    FPI01,FPI01             SET CONVERTED VALUE TO ZERO      74000021
         B     FPI002                  AND RETURN                       74400021
*                                                                       74800021
         DS    0F                                                       75200021
FPI00001 DC    XL4'000001FC'           MASK FOR CHARACTERISTIC          75600021
FPI00002 DC    XL4'00FFFFFF'           MASK FOR MANTISSA                76000021
FPI00003 DC    XL4'00800000'           MINIMUM FOR CONVERSION OVERFLOW  76400021
FPI0024  DC    F'24'                   CONVERSION FACTOR TO SHIFT COUNT 76800021
FPI0032  DC    F'32'                   MAX BASE 2 EXPONENT              77200021
FPI0256  DC    F'256'                  BIAS FACTOR                      77600021
SCA0001  DC    F'1'                                                     78000021
HSVA     EQU   4                                                        78400021
MSVA     EQU   8                                                        78800021
SCA00    EQU   0                       REGISTER EQUATES-                79200021
SCA01    EQU   1                       GENERAL REGISTERS                79600021
SCA02    EQU   2                                                        80000021
SCA03    EQU   3                                                        80400021
SCA08    EQU   8                                                        80800021
SCA09    EQU   9                                                        81200021
SCA10    EQU   10                                                       81600021
SCA11    EQU   11                                                       82000021
SCA13    EQU   13                                                       82400021
SCA14    EQU   14                                                       82800021
SCA15    EQU   15                                                       83200021
SCA00F   EQU   0                       FLOATING-POINT REGISTERS         83600021
SCA02F   EQU   2                                                        84000021
SCA04F   EQU   4                                                        84400021
REALX    EQU   X'C0'                   FLAG EQUATES                     84800021
XRLABS   EQU   X'80'                                                    85200021
XINABS   EQU   X'20'                                                    85600021
REALY    EQU   X'0C'                                                    86000021
YRLABS   EQU   X'08'                                                    86400021
YINABS   EQU   X'02'                                                    86800021
SCALERR  EQU   X'20'                                                    87200021
NOSCALER EQU   X'00'                                                    87600021
FPI00    EQU   0                                                        88000021
FPI01    EQU   1                                                        88400021
FPI02    EQU   2                                                        88800021
FPI04    EQU   4                                                        89200021
FPI09    EQU   9                                                        89600021
FPI13    EQU   13                                                       90000021
FPI15    EQU   15                                                       90400021
FPI22    EQU   22                                                       90800021
ONESV    EQU   24                                                       91200021
*                                                                       91600021
SCALWRK  DSECT                                                          92000021
SCAGDSCB DS    F                       ADDRESS OF GDSCB                 92400021
SCARTNA  DS  F                         ADDRESS OF THE RETURN ARRAY      92800021
         DS  4F                                                         93200021
SCAXABS  DS  F                         X ABSOLUTE                       93600021
SCAYABS  DS  F                         Y ABSOLUTE                       94000021
SCAXINC  DS  F                         X INCREMENT                      94400021
SCAYINC  DS  F                         Y INCREMENT                      94800021
         DS  2F                                                         95200021
SCAPTCNT DS  F                         NO. OF ELEMENTS SCALED           95600021
SCASAVE  DS  18F                                                        96000021
         COPY  GDSCB                                                    96400021
         COPY  GSPCB                                                    96800021
         END                                                            97200021
./  ADD  SSI=21250086,NAME=IFFAHA07
         TITLE 'IFFAHA07 - SCISSOR'                                     00002013
*STATUS: CHANGE LEVEL 000                                               00004013
*                                                                       00006013
*FUNCTION/OPERATIONS:  ANALYZES IMAGE GENERATION VALUES. MODIFIES       00008013
*        COORDINATES SO THAT NO DISPLAY WILL OCCUR OUTSIDE THE USER-    00010013
*        SPECIFIED SCISSORING BOUNDARY                                  00012013
*                                                                       00014013
*ENTRY POINTS: IFFAHA07                                                 00016013
*                                                                       00018013
*INPUT:  REGISTER 1 POINTS TO A WORKAREA, THE FIRST 13 WORDS OF WHICH   00020013
*        ARE THE PARAMETER LIST                                         00022013
*    + 0 A(GDSCB)                                                       00024013
*                                                                       00026013
*    + 4 A(RETURN CODE ARRAY)                                           00028013
*                                                                       00030013
*    + 8 THE 4 WORDS STARTING HERE ARE IGNORED AS INPUT                 00032013
*                                                                       00034013
*    +24 ABSOLUTE X-VALUE TO BE SCISSORED                               00036013
*                                                                       00038013
*    +28 ABSOLUTE Y-VALUE TO BE SCISSORED                               00040013
*                                                                       00042013
*    +32 INCREMENTAL X-VALUE                                            00044013
*                                                                       00046013
*    +36 INCREMENTAL Y-VALUE                                            00048013
*                                                                       00050013
*    +40 TOTAL X-INCREMENT TO DATE                                      00052013
*                                                                       00054013
*    +44 TOTAL Y-INCREMENT TO DATE                                      00056013
*                                                                       00058013
*    +48 NUMBER OF POINTS SCISSORED TO DATE                             00060013
*                                                                       00062013
*OUTPUT: OUTPUT IS OVERLAYED OVER THE INPUT ARRAY                       00064013
*    + 0 NOT CHANGED                                                    00066013
*                                                                       00068013
*    + 4 NOT CHANGED                                                    00070013
*        THE NEXT FOUR VALUES ARE POSITIONING VALUES                    00072013
*    + 8 ABSOLUTE X                                                     00074013
*                                                                       00076013
*    +12 ABSOLUTE Y                                                     00078013
*                                                                       00080013
*    +16 INCREMENTAL X                                                  00082013
*                                                                       00084013
*    +20 INCREMENTAL Y                                                  00086013
*        THE NEXT FOUR VALUES ARE DISPLAY VALUES                        00088013
*    +24 ABSOLUTE X                                                     00090013
*                                                                       00092013
*    +28 ABSOLUTE Y                                                     00094013
*                                                                       00096013
*    +32 INCREMENTAL X                                                  00098013
*                                                                       00100013
*    +36 INCREMENTAL Y                                                  00102013
*                                                                       00104013
*    +40 UPDATED AS APPROPRIATE                                         00106013
*                                                                       00108013
*    +44 UPDATED AS APPROPRIATE                                         00110013
*                                                                       00112013
*    +48 NOT CHANGED                                                    00114013
*                                                                       00116013
*        GDSXLAST, GDSYLAST, GDSXCURR, GDSYCURR ARE UPDATE              00118013
*        APPROPRIATELY.                                                 00120013
*                                                                       00122013
*EXTERNAL ROUTINES: NONE                                                00124013
*                                                                       00126013
*EXITS-NORMAL: VIA RETURN MACRO TO CALLING PROGRAM, RETURN CODE = 0     00128013
*                                                                       00130013
*     -ERROR:  VIA RETURN MACRO, RETURN CODE=4 NO DATA, STOP GENERATION 00132013
*                                RETURN CODE=8 NO DATA,CONTINUE         00134013
*                                GENERATION                             00136013
*TABLES/WORKAREAS: GSP WORKAREA                                         00138013
*                                                                       00140013
*ATTRIBUTES: PROBLEM STATE, REENTRANT                                   00142013
*                                                                       00144013
IFFAHA07 CSECT                                                          00146013
*D070300-070600                                                  YM1963 00196000
         SAVE  (14,12)                                                  00200013
         BALR  SCS09,0                 ADDRESSABILITY FOR CSECT         00300013
         USING *,SCS09                                                  00400013
*                                                                       00500013
         LR    SCS10,SCS01             ADDRESSABILITY FOR WORKAREA      00600013
         USING SCISSR,SCS10                                             00700013
*                                                                       00800013
         L     SCS11,SCSGDSCB          ADDRESSABILITY FOR GDSCB         00900013
         USING GDSCB,SCS11                                              01000013
*                                                                       01100013
         L     SCS08,SCSRTNA           ADDRESSABILITY FOR RETURN ARRAY  01200013
         USING GSPARRAY,SCS08                                           01300013
*                                                                       01400013
         NI    GDSSCISS,ZROFLGS        MAKE SURE OLD FALGS ZERO         01450013
         LM    SCS02,SCS03,GDSXLAST                                     01500013
         C     SCS02,SCS0000           SET POSITION SWITCHES            01600013
         BL    SCS000A                 FOR CURRENT LOGICAL              01700013
         CH    SCS02,SCS4095           POSITION                         01800013
         BH    SCS000A                                                  01900013
         C     SCS03,SCS0000                                            02000013
         BL    SCS000A                                                  02100013
         CH    SCS03,SCS4095                                            02200013
         BNH   SCS000B                                                  02300013
SCS000A  OI    GDSSCISS,OFFSCR                                          02400013
*                                                                       02500013
SCS000B  C     SCS02,GDSXVILL                                           02600013
         BL    SCS000C                                                  02700013
         C     SCS02,GDSXVIUR                                           02800013
         BH    SCS000C                                                  02900013
         C     SCS03,GDSYVILL                                           03000013
         BL    SCS000C                                                  03100013
         C     SCS03,GDSYVIUR                                           03200013
         BNH   SCS000D                                                  03300013
SCS000C  OI    GDSSCISS,OFFGRID                                         03400013
*                                                                       03500013
SCS000D  LM    SCS02,SCS03,SCSXABS                                      03600013
         C     SCS02,SCS0000           ON SCREEN                        03700013
         BL    SCS001                                                   03800013
         CH    SCS02,SCS4095           NO, SET FLAG=1                   03900013
         BH    SCS001                                                   04000013
         C     SCS03,SCS0000           YES, SET FLAG=0                  04100013
         BL    SCS001                                                   04200013
         CH    SCS03,SCS4095                                            04300013
         BH    SCS001                                                   04400013
         MVI   SCSPTPOS,ONSCR                                           04500013
         B     SCS002                                                   04600013
SCS001   MVI   SCSPTPOS,OFFSCR                                          04700013
*                                                                       04800013
SCS002   C     SCS02,GDSXVILL          IS POINT                         04900013
         BL    SCS003                  ON GDS                           05000013
         C     SCS02,GDSXVIUR                                           05100013
         BH    SCS003                  YES, LEAVE FLAG SET=0            05200013
         C     SCS03,GDSYVILL                                           05300013
         BL    SCS003                  NO, SET FLAG=1                   05400013
         C     SCS03,GDSYVIUR                                           05500013
         BH    SCS003                                                   05600013
         B     SCS004                                                   05700013
SCS003   OI    SCSPTPOS,OFFGRID                                         05800013
*                                                                       05900013
SCS004   TM    GDSSCISS,SCRGDS         LAST POINT ON BOTH GDS AND       06000013
         BC    7,SCS007                SCREEN. NO, CHECK FOR SCISSORING 06100013
         TM    SCSPTPOS,SCRGDS         CURRENT POINT ON BOTH GDS AND    06200013
         BC    7,SCS007                SCREEN                           06300013
*                                                                       06400013
SCS005   XC    SCSXAPOS(16),SCSXAPOS   ZERO OUT POSITIONING VECTORS     06500013
         MVC   GDSXLAST(4),SCSXABS     SET CURRENT BEAM POSITION        06600013
         MVC   GDSYLAST(4),SCSYABS     = ABSOLUTE POSITION              06700013
SCS006   NI    GDSSCISS,ZROFLGS        REPLACE POSITION FLAGS           06800013
         MVC   GDSXCURR(2),SCSXABS+2   SET LOGICAL BEAM POSITION        06900013
         MVC   GDSYCURR(2),SCSYABS+2   = ABSOLUTE POSITION              07000013
*                                                                       08000013
         RETURN (14,12),T,RC=0                                          08100013
*                                                                       08200013
*                                                                       08300013
SCS007   TM    GDSSCISS,SCRSCIS        SCISSOR AT SCREEN                08400013
         BZ    SCS010                  NO, CHECK FOR SCISSOR AT GDS     08500013
         TM    GDSSCISS,SCR            LAST POINT ON SCREEN             08600013
         BO    SCS0070                 NO, PREPARE TO SCISSOR           08700013
         TM    SCSPTPOS,SCR            CURRENT POINT ON SCREEN          08800013
         BZ    SCS005                  YES, PLOT AS IS                  08900013
*                                                                       09000013
SCS0070  TM    GDSSCISS,STOP           DISCONTINUE GENERATION           09100013
         BO    SCS008                  YES, SET RETURN CODE AND QUIT    09200013
         MVC   SCSLIMX1(2),SCS0000     SET LIMITS = SCREEN LIMIT        09300013
         MVC   SCSLIMY1(2),SCS0000                                      09400013
         MVC   SCSLIMX2(2),SCS4095                                      09500013
         MVC   SCSLIMY2(2),SCS4095                                      09600013
         MVI   SCSSCSL,SCR             DO SCISSORING                    09700013
         B     SCS020                                                   09800013
SCS008   LA    SCS15,4                 SET REGISTER 15                  09900013
SCS009   OI    GSPARRAY,SCISS          SET RETURN CODE ARRAY            10000013
         CLC   GSPARRAY+4(4),SCS0000                                    10100013
         BNE   SCS0090                                                  10200013
         MVC   GSPARRAY+4(4),SCSCOUNT                                   10300013
SCS0090  RETURN (14,12),T,RC=(15)                                       10400013
SCS010   TM    GDSSCISS,GDS            SCISSOR AT GDS                   10500013
         BO    SCS011                  BOTH POINTS IN GDS               10600013
         TM    SCSPTPOS,GDS            NO, CHECK FOR TERMINATION        10700013
         BZ    SCS012                  YES,PREPARE FOR SCISSORING       10800013
*                                                                       10900013
SCS011   TM    GDSSCISS,STOP           DISCONTINUE GENERATION           11000013
         BO    SCS008                  YES, SET RETURN CODE AND QUIT    11100013
*                                                                       11200013
*        DETERMINE GDS SCISSORING LIMITS                                11300013
SCS012   MVI   SCSSCSL,SCRGDS                                           11400013
         L     SCS02,GDSXVILL          LOWER X LIMIT ON SCREEN          11500013
         CH    SCS02,SCS0000                                            11600013
         BL    SCS013                  YES, LOWER LEFT SCISSORING       11700013
         STH   SCS02,SCSLIMX1          LIMIT = GDS LIMIT                11800013
         B     SCS014                                                   11900013
SCS013   MVC   SCSLIMX1(2),SCS0000     NO, USE SCREEN LIMIT             12000013
*                                                                       12100013
SCS014   L     SCS02,GDSYVILL          LOWER Y LIMIT ON SCREEN          12200013
         CH    SCS02,SCS0000                                            12300013
         BL    SCS015                  YES, LOWER LEFT SCISSORING       12400013
         STH   SCS02,SCSLIMY1          LIMIT = GDS LIMITS               12500013
         B     SCS016                                                   12600013
SCS015   MVC   SCSLIMY1(2),SCS0000     NO, USE SCREEN LIMIT             12700013
*                                                                       12800013
SCS016   L     SCS02,GDSXVIUR          UPPER X LIMIT ON SCREEN          12900013
         CH    SCS02,SCS4095                                            13000013
         BH    SCS017                  YES, UPPER X SCISSORRING LIMIT   13100013
         STH   SCS02,SCSLIMX2          = GDS LIMIT                      13200013
         B     SCS018                                                   13300013
SCS017   MVC   SCSLIMX2(2),SCS4095     NO, USE SCREEN LIMIT             13400013
*                                                                       13500013
SCS018   L     SCS02,GDSYVIUR          UPPER Y LIMIT ON SCREEN          13600013
         CH    SCS02,SCS4095                                            13700013
         BH    SCS019                  YES, UPPER Y SCISSORING          13800013
         STH   SCS02,SCSLIMY2          LIMIT= GDS LIMIT                 13900013
         B     SCS020                                                   14000013
SCS019   MVC   SCSLIMY2(2),SCS4095     NO, USE SCREEN LIMIT             14100013
*                                                                       14200013
*        COMPUTE NUMBER AND LOCATION OF INTERSECTIONS WITH BOUNDARY     14300013
*                                                                       14400013
         DROP  SCS08                   DROP RETURN ARRAY ADDRESSABILITY 14500013
*                                                                       14600013
SCS020   L     SCS02,SCSXABS           COMPUTE DX                       14700013
         S     SCS02,GDSXLAST                                           14800013
         C     SCS02,SCS0000           IS DX=0                          14900013
         BNE   SCS021                  IF NOT, GO TO TEST Y             15000013
         MVC   SCSPT3X(4),GDSXLAST     OTHERWISE, SET PT3=X1,YL         15100013
         LH    SCS04,SCSLIMY1                                           15200013
         ST    SCS04,SCSPT3Y                                            15300013
         MVC   SCSPT4X(4),GDSXLAST                SET PT4=X1,YH         15400013
         LH    SCS04,SCSLIMY2                                           15500013
         ST    SCS04,SCSPT4Y                                            15600013
         B     SCS022                  GO TO SET NI VALUE TO 2          15700013
*                                                                       15800013
SCS021   L     SCS03,SCSYABS           COMPUTE DY                       15900013
         S     SCS03,GDSYLAST                                           16000013
         C     SCS03,SCS0000           IS DY =0                         16100013
         BNE   SCS023                  IF NOT GO TO SET NI=4            16200013
         LH    SCS04,SCSLIMX1          OTHERWISE SET PT3=XL,Y1          16300013
         ST    SCS04,SCSPT3X                                            16400013
         MVC   SCSPT3Y(4),GDSYLAST                                      16500013
         LH    SCS04,SCSLIMX2                AND SET PT4=XH,Y1          16600013
         ST    SCS04,SCSPT4X                                            16700013
         MVC   SCSPT4Y(4),GDSYLAST                                      16800013
*                                                                       16900013
SCS022   MVC   SCSNI,SCS0002           SET NI = 2                       17000013
         B     SCS035                  ELIMINATE OUTSIDE POINTS         17100013
*                                                                       17200013
SCS023   MVC   SCSNI,SCS0004           SET NI = 4                       17300013
         L     SCS05,GDSYLAST          COMPUTE B= Y1 - MX1              17400013
         LR    SCS06,SCS03                                              17500013
         SRDA  SCS06,32                                                 17600013
         M     SCS06,GDSXLAST          WHERE MX1=X1*DY/DX               17700013
         DR    SCS06,SCS02                                              17800013
         SR    SCS05,SCS07             Y1-MX1                           17900013
*                                                                       18000013
         LH    SCS04,SCSLIMX1          COMPARE XL TO X1                 18100013
         C     SCS04,GDSXLAST                                           18200013
         BE    SCS027                  IF EQUAL GO TO SET PT3=PT1       18300013
         C     SCS04,SCSXABS           COMPARE TO X2                    18400013
         BE    SCS028                  IF EQUAL GO TO SET PT3=PT2       18500013
         ST    SCS04,SCSPT3X                                            18600013
         LR    SCS06,SCS03             Y3 =MX2+B                        18700013
         SRDA  SCS06,32                                                 18800013
         MR    SCS06,SCS04             WHERE MX2=X1*DY/DX               18900013
         DR    SCS06,SCS02                                              19000013
         AR    SCS07,SCS05             PLUS B TO MX2                    19100013
         ST    SCS07,SCSPT3Y           SAVE COMPUTED PT3 Y COORDINATE   19200013
*                                                                       19300013
SCS024   LH    SCS04,SCSLIMX2          CHECK IF X1 OR X2 = XH           19400013
         C     SCS04,GDSXLAST                                           19500013
         BE    SCS029                  IF X1=XH GO TO SET PT4=PT1       19600013
         C     SCS04,SCSXABS                                            19700013
         BE    SCS030                  IF X2=XH GO TO SET PT4=PT2       19800013
         ST    SCS04,SCSPT4X           OTHERWISE, X4=XH                 19900013
         LR    SCS06,SCS03             Y4=MXH+B                         20000013
         SRDA  SCS06,32                                                 20100013
         MR    SCS06,SCS04                                              20200013
         DR    SCS06,SCS02                                              20300013
         AR    SCS07,SCS05                                              20400013
         ST    SCS07,SCSPT4Y                                            20500013
*                                                                       20600013
SCS025   LH    SCS04,SCSLIMY1          CHECK IF Y1 OR Y2=YL             20700013
         C     SCS04,GDSYLAST                                           20800013
         BE    SCS031                  IF Y1=YL GO TO SET PT5=PT1       20900013
         C     SCS04,SCSYABS                                            21000013
         BE    SCS032                  IF Y2=YL GO TO SET PT5=PT2       21100013
         ST    SCS04,SCSPT5Y           OTHERWISE Y5=YL                  21200013
         SR    SCS04,SCS05             X5=(YL-B)/M OR (YL-B)*DX/DY      21300013
         LR    SCS06,SCS02             WHERE M=DX/DY                    21400013
         SRDA  SCS06,32                                                 21500013
         MR    SCS06,SCS04                                              21600013
         DR    SCS06,SCS03                                              21700013
         ST    SCS07,SCSPT5X                                            21800013
*                                                                       21900013
SCS026   LH    SCS04,SCSLIMY2          CHECK IF Y1 OR Y2=YH             22000013
         C     SCS04,GDSYLAST                                           22100013
         BE    SCS033                  IF Y1=YH GO TO SET PT6=PT1       22200013
         C     SCS04,SCSYABS                                            22300013
         BE    SCS034                  IF Y2=YH GO TO SET PT6=PT2       22400013
         ST    SCS04,SCSPT6Y           OTHERWISE, Y6=YH                 22500013
         SR    SCS04,SCS05             X6=(YH-B)/M OR (YH-B)*DX/DY      22600013
         LR    SCS06,SCS02             WHERE M=DY/DX                    22700013
         SRDA  SCS06,32                                                 22800013
         MR    SCS06,SCS04                                              22900013
         DR    SCS06,SCS03                                              23000013
         ST    SCS07,SCSPT6X           STORE COMPURED X6                23100013
         B     SCS035                                                   23200013
*                                                                       23300013
SCS027   MVC   SCSPT3(8),GDSXLAST      SET PT3=PT1                      23400013
         B     SCS024                                                   23500013
SCS028   MVC   SCSPT3(8),SCSXABS       SET PT3=PT2                      23600013
         B     SCS024                                                   23700013
*                                                                       23800013
SCS029   MVC   SCSPT4(8),GDSXLAST      SET PT4=PT1                      23900013
         B     SCS025                                                   24000013
SCS030   MVC   SCSPT4(8),SCSXABS       SET PT4=PT2                      24100013
         B     SCS025                                                   24200013
*                                                                       24300013
SCS031   MVC   SCSPT5(8),GDSXLAST      SET PT5=PT1                      24400013
         B     SCS026                                                   24500013
SCS032   MVC   SCSPT5(8),SCSXABS       SET PT5=PT2                      24600013
         B     SCS026                                                   24700013
*                                                                       24800013
SCS033   MVC   SCSPT6(8),GDSXLAST      SET PT6=PT1                      24900013
         B     SCS035                                                   25000013
SCS034   MVC   SCSPT6(8),SCSXABS       SET PT6=PT2                      25100013
*                                                                       25200013
*                                                                       25300013
*        ELIMINATE POINTS OUTSIDE BOUNDARY AND/OR LINE LIMITS           25400013
*                                                                       25500013
SCS035   L     SCS07,SCS0001           LOAD 1 TO I COUNT                25600013
         SR    SCS05,SCS05             CLEAR INDEX REGISTER             25700013
         SR    SCS06,SCS06             LOAD 0 TO ZERO COUNT             25800013
         SR    SCS08,SCS08             CLEAR POSITION REGISTER          25900013
         L     SCS04,GDSXLAST          LOAD X1                          26000013
         C     SCS04,SCSXABS           COMPARE X1 TO X2                 26100013
         BH    SCS036                  AND SET XR=MIN(X1,X2)            26200013
         MVC   SCSXR(4),GDSXLAST               XS=MAX(X1,X2)            26300013
         MVC   SCSXS(4),SCSXABS                                         26400013
         B     SCS037                                                   26500013
SCS036   MVC   SCSXR(4),SCSXABS                                         26600013
         MVC   SCSXS(4),GDSXLAST                                        26700013
*                                                                       26800013
SCS037   L     SCS04,GDSYLAST          LOAD Y1                          26900013
         C     SCS04,SCSYABS           COMPARE Y1 TO Y2                 27000013
         BH    SCS038                  AND SET YR=MIN(Y1,Y2)            27100013
         MVC   SCSYR(4),GDSYLAST               YS=MAX(Y1,Y2)            27200013
         MVC   SCSYS(4),SCSYABS                                         27300013
         B     SCS039                                                   27400013
SCS038   MVC   SCSYS(4),GDSYLAST                                        27500013
         MVC   SCSYR(4),SCSYABS                                         27600013
*                                                                       27700013
SCS039   L     SCS02,SCSPT3X(SCS05)    GET COMPUTED POINTS              27800013
         LH    SCS04,SCSLIMX1                                           27900013
         CR    SCS02,SCS04             CHECK IF PT OUTSIDE LEFT LIMIT   28000013
         BL    SCS042                                                   28100013
         C     SCS02,SCSXR             COMPARE WITH LINE RANGE          28200013
         BL    SCS042                  MASK IF NOT IN RANGE             28300013
         LH    SCS04,SCSLIMX2                                           28400013
         CR    SCS02,SCS04             COMPARE THE PT WITH BOUNDARY     28500013
         BH    SCS042                  MASK IT IF OUTSIDE BOUNDARY      28600013
         C     SCS02,SCSXS             CHECK IF OUTSIDE LINE RANGE      28700013
         BH    SCS042                                                   28800013
*                                                                       28900013
         L     SCS03,SCSPT3Y(SCS05)                                     29000013
         LH    SCS04,SCSLIMY1                                           29100013
         CR    SCS03,SCS04             IS THE PT OUTSIDE THE BOUNDARY   29200013
         BL    SCS042                                                   29300013
         C     SCS03,SCSYR             IS THE PT OUTSIDE THE LINE       29400013
         BL    SCS042                                                   29500013
         LH    SCS04,SCSLIMY2                                           29600013
         CR    SCS03,SCS04             IS THE PT OUTSIDE THE BOUNDARY   29700013
         BH    SCS042                                                   29800013
         C     SCS03,SCSYS             IS PT OUTSIDE THE LINE           29900013
         BH    SCS042                                                   30000013
         C     SCS02,GDSXLAST          IS THIS PT SAME AS PT1           30100013
         BNE   SCS040                  IF NOT, COMPARE TO PT2           30200013
         C     SCS03,GDSYLAST                                           30300013
         BE    SCS042                  IDENTICAL TO PT1, ELIMINATE      30400013
*                                                                       30500013
SCS040   C     SCS02,SCSXABS           IS THIS PT SAME AS PT2           30600013
         BNE   SCS041                  NO, BUILD UP INTERSECTIONS       30700013
         C     SCS03,SCSYABS                                            30800013
         BE    SCS042                  IDENTICAL TO PT2, ELIMINATE      30900013
*                                                                       31000013
SCS041   STH   SCS02,SCSINTX1(SCS08)   BUILD UP INTERSECTIONS           31100013
         STH   SCS03,SCSINTY1(SCS08)                                    31200013
         A     SCS08,SCS0004           INDEX BY 4                       31300013
         B     SCS043                                                   31400013
SCS042   A     SCS06,SCS0001           ADD 1 TO OUT COUNT               31500013
SCS043   A     SCS07,SCS0001           I=I+1                            31600013
         C     SCS07,SCSNI             IS I GREATER THAN NI             31700013
         BH    SCS044                  YES, COMPUTE FINAL NI            31800013
         A     SCS05,SCS0008           INDEX AND CHECK NEXT             31900013
         B     SCS039                                                   32000013
*                                                                       32100013
SCS044   L     SCS04,SCSNI             NI=NI-OUT                        32200013
         SR    SCS04,SCS06                                              32300013
         ST    SCS04,SCSNI                                              32400013
SCS045   CLC   SCSNI(4),SCS0002        IS NI = 2                        32500013
         BH    SCS047                  IF YES ELIMINATE DUPLICATES      32600013
         BL    SCS050                                                   32700013
SCS046   CLC   SCSINTS1(4),SCSINTS2    CHECK IF TWO POINTS THE SAME     32800013
         BNE   SCS050                                                   32900013
         MVC   SCSNI(4),SCS0001        ELIMINATE DUPLICATE              33000013
         B     SCS050                                                   33100013
*                                                                       33200013
SCS047   CLC   SCSINTS1(4),SCSINTS2                                     33300013
         BNE   SCS049                  IF THESE TWO PTS = TAKE 2 & 3    33400013
         MVC   SCSINTS1(8),SCSINTS2                                     33500013
SCS049   MVC   SCSNI(4),SCS0002                                         33600013
SCS050   MVC   GDSXLAST(8),SCSXABS     UPDATE LOGICAL POSITION          33700013
         L     SCS08,SCSRTNA           REESTABLISH ADDRESSABILITY       33800013
         USING GSPARRAY,SCS08          TO RETURN ARRAY                  33900013
         CLC   SCSNI(4),SCS0001        CHECK NUMBER OF INTERSECTIONS    34000013
         BE    SCS054                  ONE                              34100013
         BH    SCS056                  TWO                              34200013
         IC    SCS02,SCSSCSL           ZERO, IS END-POINT ON BOUNDARY   34300013
         EX    SCS02,SCS058                                             34400013
         BC    7,SCS053                NO, SUPPRESS PLOT                34500013
SCS051   MVC   SCSXAPOS(8),SCSXABS     MOVE IN ABSOLUTE POSITIONING     34600013
*                                      VALUES                           34700013
         XC    SCSXINC(8),SCSXINC                                       34800013
         L     SCS02,SCSXAPOS          COMPUTE INCREMENTAL POSITION-    34900013
         SH    SCS02,GDSXCURR          ING VALUES FOR X                 35000013
         ST    SCS02,SCSXIPOS                                           35100013
         L     SCS02,SCSYAPOS          AND Y                            35200013
         SH    SCS02,GDSYCURR                                           35300013
         ST    SCS02,SCSYIPOS                                           35400013
SCS052   OI    GSPARRAY,SCISS          AND SET SWITCH                   35500013
         CLC   GSPARRAY+4(4),SCS0000   RETURN CODE NOT SET              35600013
         BNE   SCS006                  YES, SET IT                      35700013
         MVC   GSPARRAY+4(4),SCSCOUNT  OTHERWISE, CONTINUE              35800013
         B     SCS006                                                   35900013
*                                                                       36000013
SCS053   MVC   GDSXLAST(8),SCSXABS     UPDATE LOGICAL POSITION          36100013
         NI    GDSSCISS,ZROFLGS        REPLACE OLD POSITION             36200013
         XC    SCSXAPOS(32),SCSXAPOS   ZERO DATA                        36400013
         LA    SCS15,8                                                  36500013
         B     SCS009                                                   36600013
*                                                                       36700013
SCS054   IC    SCS02,SCSSCSL           FIRST POINT IN BOUNDARY          36800013
         EX    SCS02,SCS057                                             36900013
         BZ    SCS055                  YES                              37000013
         EX    SCS02,SCS058            NO. IS SECOND POINT IN BOUNDARY  37100013
         BC    7,SCS053                NO, SUPPRESS PLOT                37200013
         LH    SCS02,SCSINTX1          POSITION TO INTERSECTION         37300013
         ST    SCS02,SCSXAPOS          GET X ABSOLUTE                   37400013
         SH    SCS02,GDSXCURR          COMPUTE X INCREMENT              37500013
         ST    SCS02,SCSXIPOS                                           37600013
         LH    SCS02,SCSINTY1          GET Y ABSOLUTE                   37700013
         ST    SCS02,SCSYAPOS                                           37800013
         SH    SCS02,GDSYCURR          COMPUTE Y INCREMENT              37900013
         ST    SCS02,SCSYIPOS                                           38000013
         L     SCS02,SCSXABS           GET X INCREMENT FROM             38100013
         S     SCS02,SCSXAPOS          POSITIONING TO FINAL POINT       38200013
         ST    SCS02,SCSXINC                                            38300013
         L     SCS02,SCSYABS           GET CORRESPONDING                38400013
         S     SCS02,SCSYAPOS          Y INCREMENT                      38500013
         ST    SCS02,SCSYINC                                            38600013
         B     SCS052                                                   38700013
*                                                                       38800013
SCS055   XC    SCSXAPOS(16),SCSXAPOS   PLOT TO POINT OF INTERSECTION    38900013
         LH    SCS02,SCSINTX1          MOVE IN ABSOLUTE X VALUE         39000013
         ST    SCS02,SCSXABS                                            39100013
         SH    SCS02,GDSXCURR          COMPUTE NEW INCREMENT            39200013
         ST    SCS02,SCSXINC                                            39300013
         LH    SCS02,SCSINTY1          MOVE IN ABSOLUTE Y VALUE         39400013
         ST    SCS02,SCSYABS                                            39500013
         SH    SCS02,GDSYCURR          COMPUTE NEW INCREMENT            39600013
         ST    SCS02,SCSYINC                                            39700013
         B     SCS052                                                   39800013
*                                                                       39900013
SCS056   L     SCS02,GDSXLAST          GET DISPLACEMENTS FROM           40000013
         SH    SCS02,SCSINTX1          LOGICAL ENDPOINT TO              40100013
         LPR   SCS02,SCS02             BOTH INTERSECTIONS               40200013
         L     SCS03,GDSXLAST                                           40300013
         SH    SCS03,SCSINTX2                                           40400013
         LPR   SCS03,SCS03             DISPLACEMENT TO SECOND LESS,     40500013
         CR    SCS03,SCS02             PLOT AS IS                       40600013
         BL    SCS061                  EQUAL, CHECK Y DISPLACEMENTS     40700013
         BE    SCS059                  DISPLACEMENT TO FIRST LESS,      40800013
         LM    SCS02,SCS03,SCSINTS1    REVERSE INTERSECTIONS AND PLOT   40900013
         ST    SCS02,SCSINTS2                                           41000013
         ST    SCS03,SCSINTS1                                           41100013
         B     SCS061                                                   41200013
*                                                                       41300013
SCS059   L     SCS02,GDSYLAST          GET MAGNITUDE OF YDISPLACEMENTS  41400013
         SH    SCS02,SCSINTY1          FROM LOGICAL ENDPOINT            41500013
         LPR   SCS02,SCS02             TO BOTH INTERSECTIONS            41600013
         L     SCS03,GDSYLAST                                           41700013
         SH    SCS03,SCSINTY2                                           41800013
         LPR   SCS03,SCS03                                              41900013
         CR    SCS03,SCS02             DISPLACEMENT TO SECOND LESS OR   42000013
         BNH   SCS061                  EQUAL TO FIRST, PLOT AS IS       42100013
         LM    SCS02,SCS03,SCSINTS1    OTHERWISE, REVERSE INTERSECTIONS 42200013
         ST    SCS02,SCSINTS2                                           42300013
         ST    SCS03,SCSINTS1                                           42400013
*                                                                       42500013
SCS061   LH    SCS02,SCSINTX1          PLOT FROM FIRST TO SECOND        42600013
         ST    SCS02,SCSXAPOS          INTERSECTION                     42700013
         SH    SCS02,GDSXCURR          STORE ABSOLUTE AND INCREMENTAL   42800013
         ST    SCS02,SCSXIPOS          POSITIONING VALUES               42900013
         LH    SCS02,SCSINTX2          STORE FINAL ABSOLUTE POSITION    43000013
         ST    SCS02,SCSXABS                                            43100013
         S     SCS02,SCSXAPOS          AND INCREMENT TO IT              43200013
         ST    SCS02,SCSXINC                                            43300013
*                                                                       43400013
         LH    SCS02,SCSINTY1                                           43500013
         ST    SCS02,SCSYAPOS          ABSOLUTE POSITIONING VALUE       43600013
         SH    SCS02,GDSYCURR          AND INCREMENT TO IT              43700013
         ST    SCS02,SCSYIPOS                                           43800013
         LH    SCS02,SCSINTY2                                           43900013
         ST    SCS02,SCSYABS           ABSOLUTE FINAL VALUE             44000013
         S     SCS02,SCSYAPOS          AND INCREMENT TO IT              44100013
         ST    SCS02,SCSYINC                                            44200013
         B     SCS052                                                   44300013
*                                                                       44400013
SCS057   TM    GDSSCISS,X'00'                                           44500013
SCS058   TM    SCSPTPOS,X'00'                                           44600013
*                                                                       44700013
SCS4095  DC    H'4095'                                                  44800013
SCS0000  DC    F'0'                                                     44900013
SCS0001  DC    F'1'                                                     45000013
SCS0002  DC    F'2'                                                     45100013
SCS0004  DC    F'4'                                                     45200013
SCS0008  DC    F'8'                                                     45300013
*                                                                       45400013
SCS01    EQU   1                       REGISTER EQUATES                 45500013
SCS02    EQU   2                                                        45600013
SCS03    EQU   3                                                        45700013
SCS04    EQU   4                                                        45800013
SCS05    EQU   5                                                        45900013
SCS06    EQU   6                                                        46000013
SCS07    EQU   7                                                        46100013
SCS08    EQU   8                                                        46200013
SCS09    EQU   9                                                        46300013
SCS10    EQU   10                                                       46400013
SCS11    EQU   11                                                       46500013
SCS15    EQU   15                                                       46600013
*                                                                       46700013
ONSCR    EQU   0                                                        46800013
OFFSCR   EQU   X'80'                                                    46900013
OFFGRID  EQU   X'40'                                                    47000013
SCRGDS   EQU   X'C0'                                                    47100013
ZROFLGS  EQU   X'3F'                                                    47200013
SCRSCIS  EQU   X'08'                                                    47300013
SCR      EQU   X'80'                                                    47400013
GDS      EQU   X'40'                                                    47500013
STOP     EQU   X'01'                                                    47600013
SCISS    EQU   X'40'                                                    47700013
TRUNC    EQU   X'FC'                                                    47730013
*                                                                       47760013
SCISSR   DSECT                                                          47800013
SCSGDSCB DS    F                                                        47900013
SCSRTNA  DS    F                                                        48000013
SCSXAPOS DS    F                                                        48100013
SCSYAPOS DS    F                                                        48200013
SCSXIPOS DS    F                                                        48300013
SCSYIPOS DS    F                                                        48400013
SCSXABS  DS    F                                                        48500013
SCSYABS  DS    F                                                        48600013
SCSXINC  DS    F                                                        48700013
SCSYINC  DS    F                                                        48800013
SCSXITOT DS    F                                                        48900013
SCSYITOT DS    F                                                        49000013
SCSCOUNT DS    F                                                        49100013
*                                                                       49200013
SCSLIM   DS    2F                                                       49300013
         ORG   SCSLIM                                                   49400013
SCSLIMX1 DS    H                                                        49500013
SCSLIMY1 DS    H                                                        49600013
SCSLIMX2 DS    H                                                        49700013
SCSLIMY2 DS    H                                                        49800013
*                                                                       49900013
SCSNI    DS    F                                                        50000013
SCSINTS1 DS    F                                                        50100013
         ORG   SCSINTS1                                                 50200013
SCSINTX1 DS    H                                                        50300013
SCSINTY1 DS    H                                                        50400013
SCSINTS2 DS    F                                                        50500013
         ORG   SCSINTS2                                                 50600013
SCSINTX2 DS    H                                                        50700013
SCSINTY2 DS    H                                                        50800013
SCSPT3   DS    2F                                                       50900013
         ORG   SCSPT3                                                   51000013
SCSPT3X  DS    F                                                        51100013
SCSPT3Y  DS    F                                                        51200013
SCSPT4   DS    2F                                                       51300013
         ORG   SCSPT4                                                   51400013
SCSPT4X  DS    F                                                        51500013
SCSPT4Y  DS    F                                                        51600013
SCSPT5   DS    2F                                                       51700013
         ORG   SCSPT5                                                   51800013
SCSPT5X  DS    F                                                        51900013
SCSPT5Y  DS    F                                                        52000013
SCSPT6   DS    2F                                                       52100013
         ORG   SCSPT6                                                   52200013
SCSPT6X  DS    F                                                        52300013
SCSPT6Y  DS    F                                                        52400013
SCSXR    DS    F                                                        52500013
SCSXS    DS    F                                                        52600013
SCSYR    DS    F                                                        52700013
SCSYS    DS    F                                                        52800013
SCSPTPOS DS    C                                                        52900013
SCSSCSL  DS    C                                                        53000013
         COPY  GDSCB                                                    53100013
         COPY  GSPCB                                                    53200013
         END                                                            53300013
./  ADD  SSI=20740483,NAME=IFFAHA11
*TITLE         DIRECTOR PART2                                           00400021
*                                                                       00800021
*MODULE NAME   IFFAHA11                                                 01200021
*                                                                       01600021
*INPUT         OUTPUT FROM DIRECTOR PART 2                              02000021
*                                                                       02400021
*              REG1  ADDRESS OF USERS PARAMETER LIST                    02800021
*                                                                       03200021
*              REG2  ADDRESS OF GSPCB                                   03600021
*                                                                       04000021
*              REG3  DISPLACEMENT NUMBER                                04400021
*                                                                       04800021
*              REG9  ENTRY ADDRESS                                      05200021
*                                                                       05600021
*              REG13 UNCHANGED                                          06000021
*                                                                       06400021
*              REG14 UNCHANGED                                          06800021
*                                                                       07200021
*OUTPUT        NONE TO CALLER                                           07600021
*ERRORS        NONE                                                     08000021
*                                                                       08400021
*FUNCTION      USES DISPLACEMENT NUMBER * 4 IN REFERENCING              08800021
*                                                                       09200021
*              STATUS TABLE.  IT WILL CALL, LOAD AND CALL, OR           09600021
*                                                                       10000021
*              LINK TO THE MODULE IDENTIFIED IN THE STATUS              10400021
*                                                                       10800021
*              TABLE ENTRY                                              11200021
*                                                                       11600021
*OUTPUT TO GSP                                                          12000021
* SUBROUTINE   REG1  ADDRESS OF WORKAREA                                12400021
*                                                                       12800021
*              FIRST WORD OF WORK AREA IS ADDRESS OF USERS PLIST        13200021
*                                                                       13600021
*              SECOND WORD IS ADDRESS OF GSP RETURN ARRAY               14000021
*                                                                       14400021
*              REG13  ADDRESS OF SAVE AREA                              14800021
*                                                                       15200021
*              REG14 RETURN ADDRESS ( TO DIRECTOR 2)                    15600021
*                                                                       16000021
*              REG15 ENTRY ADDRESS OF INVOKED ROUTINE                   16400021
         EJECT                                                          16800021
*REGISTER EQUATES****************************************************** 17200021
R0       EQU   0                                                        17600021
R1       EQU   1                                                        18000021
R2       EQU   2                                                        18400021
R3       EQU   3                                                        18800021
R4       EQU   4                                                        19200021
R5       EQU   5                                                        19600021
R6       EQU   6                                                        20000021
R7       EQU   7                                                        20400021
R8       EQU   8                                                        20800021
R9BASE   EQU   9                                                        21200021
R12      EQU   12                                                S21016 21400021
R13      EQU   13                                                       21600021
R14      EQU   14                      RETURN ADDR REG           S21016 21800021
R15      EQU   15                                                       22000021
         EJECT                                                          22400021
IFFAHA11 CSECT                                                          22800021
*D6000000,A                                                      S21016 23000021
*A598900,C599400                                                  M1097 23050021
         USING *,R9BASE                                                 23200021
         USING GSPCB,R2                                                 23600021
         TS    GSPBUSYS                SET  GSP BUSY                    24000021
*                                                                       24400021
*NOTE:  CONDITION CODE NOT TESTED.  NEED FOR DIRECT ENTRY               24800021
*                                                                       25200021
*STRUCTURE WORK AREA                                                    25600021
*                                                                       26000021
         L     R4,GSPAWORK             GET ADDRESS OF WORK AREA         26400021
         ST    R1,0(R4)                SET USER PLIST INTO FIRST WORD,  26800021
         LA    R1,GSPARRAY                                              27200021
         ST    R1,4(R4)                SET RETURN ARRAY INTO SECOND     27600021
*                                                                       28000021
*CHAIN AND ESTABLISH SAVE AREA (IN WORK AREA)                           28400021
*                                                                       28800021
         ST    R13,USERSAVE+4(R4)                                       29200021
         LA    R5,USERSAVE(R4)                                          29600021
         ST    R5,8(R13)                                                30000021
         LR    R13,R5                                                   30400021
*                                                                       30800021
*LOCATE MODULE IN STATUS TABLE                                          31200021
*                                                                       31600021
         L     R5,GSPASTAT             GET ADDRESS OF STATUS TABLE      32000021
         LR    R10,R3              SAVE DISPLACEMENT             S21016 32200021
         MH    R3,HCON3                USE DIFF NUMBR*3 FOR INDEX       32400021
         LR    R8,R3                    SAVE COPY OF STAT ID            32800021
         AR    R8,R5                                                    33200021
         L     R15,0(R5,R3)            GET EP ADDR FROM STATAB          33600021
         LTR   R15,R15                                                  34000021
         BZ    AHAD2010                EP IS ZERO, MODULE NOT LOADED    34400021
*                                                                       34800021
*CALL GSP SUBROUTINE                                                    35200021
*                                                                       35600021
*R13 HAS CHAINED SAVE AREA                                              36000021
*R4 HAS WORK AREA ADDR, WORK AREA IS SET UP                             36400021
*R15 HAS ENTRY POINT ADDRESS                                            36800021
*                                                                       37200021
AHAD2040 LR    R1,R4                   PUT WORK AREA DDDR INTO REG1     37600021
         CALL  (15)                    CALL GSP SUBROUTINE              38000021
         EJECT                                                          38200021
*                                                                       38400021
*BACK FROM ROUTINE, SET TO EXIT TO USER                                 38800021
*                                                                       39200021
AHAD2050 CLI   GSPARRAY,R0                                              39600021
         BE    AHAD2055                                                 40000021
         L     R5,GSPASTAT        ADDRESS OF STATUS TABLE        S21016 40010021
         USING STATTBL,R5          R5 BASE FOR STATUS TABLE      S21016 40020021
         SRL   R10,TWO            DIVIDE DISP BY FOUR            S21016 40030021
         MH    R10,H5              DISP NBR * 5 FOR NAME TBL     S21016 40040021
         LA    R11,TABLE           ADDR OF NAME TABLE            S21016 40050021
         AR    R11,R10             POINTS TO SUBRTN NAME -       S21016 40060021
         TM    GSPARRAY,X'04'     TEST FOR I/O ERROR             S21016 40070021
         BO    PD10               IT WAS                         S21016 40080021
PD20     EQU   *                                                 S21016 40090021
         TM    GSPARRAY,X'08'     TEST FOR PARAMETER ERROR       S21016 40100021
         BO    PD3                IT WAS                         S21016 40110021
PD30     EQU   *                                                 S21016 40120021
         TM    GSPARRAY,X'10'     TEST FOR STORAGE EXCEEDED      S21016 40130021
         BO    PD2                IT WAS                         S21016 40140021
         B     PD4                CHECK FOR TERM MSG             S21016 40150021
PD1      MVC   N0(FIVE,R6),N0(R11) SUBRTN NAME TO MSG            S21016 40160021
         WTO   MF=(E,(R1))         ISSUE WTO                     S21016 40170021
         BR    R7                 CONTINUE PROCESSING            S21016 40180021
* AT THIS POINT CONTINUE NORMAL PROCESSING                       S21016 40190021
PD0      EQU   *                   NORMAL PROCESSING             S21016 40200021
         L     R5,GSPNULLV                                              40400021
         L     R5,0(R5)                 PICK UP NULL VARIABLE           40800021
         LTR   R5,R5                                                    41200021
         BNL   AHAD2051                 BRANCH IF PLUS OR ZERO          41600021
         MVI   GSPDUMP,DUMP                                             42000021
         LPR   R5,R5                                                    42400021
AHAD2051 C     R5,SEVEN                                                 42800021
         BL    AHAD2052                 BRANCH IF LESS THAN 7           43200021
         LA    R5,6                     OTHERWISE SET VALUE TO 6        43600021
AHAD2052 IC    R5,TAB(R5)               PICK UP CONVERSION FACTOR       44000021
         STC   R5,GSPABEND                 AND SAVE IT                  44400021
         CLC   GSPARRAY(1),GSPABEND                                     44800021
         BNH   AHAD2100                 BRANCH IF ABEND                 45200021
AHAD2055 L     R13,USERSAVE+4(R4)       GET USER SAVE AREA ADDRESS      45600021
         MVI   GSPBUSYS,X'00'          SET GSP NOT BUSY                 46000021
         RETURN (14,12),T                                               46400021
         EJECT                                                          46403021
PD2      EQU   *                                                 S21016 46406021
         LA    R7,PD4             ADDR OF NEXT                   S21016 46409021
         CLI   GSPARRAY+F,X'01'    UPDATE FAIL?                  S21016 46412021
         BE    PD5                 YES                           S21016 46415021
         CLI   GSPARRAY+F,X'02'    GDS SPACE UNAVAILABLE?        S21016 46418021
         BE    PD6                 YES                           S21016 46421021
         CLI   GSPARRAY+F,X'03'    BUFFER NOT AVAILABLE?         S21016 46424021
         BE    PD8                YES                            S21016 46427021
         CLI   GSPARRAY+F,X'04'   MAIN STORAGE EXCEEDED?         S21016 46430021
         BE    PD9                IT WAS                         S21016 46433021
         B     PD0                TAKE NO  ACTION                S21016 46436021
PD5      EQU   *                                                 S21016 46439021
         LA    R6,NAME2            ADDR OF NAME FLD IN MSG 2     S21016 46442021
         LA    R1,MSG2             POINTS TO IFF602I             S21016 46445021
         B     PD1                 GO ISSUE WTO                  S21016 46448021
*                                                                S21016 46451021
PD6      EQU   *                                                 S21016 46454021
         LA    R6,NAME3            ADDR OF NAME FLD IN MSG 3     S21016 46457021
         LA    R1,MSG3             POINTS TO IFF603I             S21016 46460021
         B     PD1                  GO ISSUE WTO                 S21016 46463021
*                                                                S21016 46466021
*                                                                S21016 46469021
PD8      EQU   *                                                 S21016 46472021
         LA    R6,NAME4            ADDR OF NAME FLD IN MSG 4     S21016 46475021
         LA    R1,MSG4             ADDR OF IFF604I               S21016 46478021
         B     PD1                 GO ISSUE WTO                  S21016 46481021
*                                                                S21016 46484021
PD9      EQU   *                                                 S21016 46487021
         LA    R6,NAME5            POINTS TO NAME FLD IN MSG 5   S21016 46490021
         LA    R1,MSG5             POINTS TO IFF605I             S21016 46493021
         B     PD1                 GO ISSUE WTO                  S21016 46496021
*                                                                S21016 46499021
PD10     EQU   *                                                 S21016 46502021
         LA    R1,MSG7             ADDR OF IFF607I               S21016 46505021
         LA    R6,NAME7            PTS TO MSG7 IN STAT TBL       S21016 46508021
           LA    R7,PD20          ADDR OF NEXT CHECK             S21016 46511021
         B     PD1                GO ISSUE WTO                   S21016 46514021
         EJECT                                                          46517021
PD3      EQU   *                                                 S21016 46520021
         SR    R6,R6               ZERO CONVERT REGISTER         S21016 46523021
         IC    R6,GSPARRAY+NINTN   INSERT FAILING ARG NBR        S21016 46526021
         CVD   R6,ARG(R2)         CONVERT ARG TO DECIMAL         S21016 46529021
         LA    R1,ARG(R2)         ADDRESS OF MOVE FIELD          S21016 46532021
         LA    R6,ARG1(R2)        ADDRESS OF MOVE FROM FIELD     S21016 46535021
         UNPK  N0(FOUR,R1),N0(TWO,R6)  UNPACK ARGUMENT NUMBER    S21016 46538021
         LA    R6,ARG3(R2)        ADDRESS OF UNPACKED ARG NBR    S21016 46541021
         OI    N0(R6),X'F0'       MOVE IN ZONE                   S21016 46544021
* PRINTABLE ARG NBR IN FORM FN FN NOW AT ARG+2                   S21016 46547021
         LA    R6,ARGNBR           POINT TO ARG PARM IN MSG6     S21016 46550021
         LA    R10,ARG4(R2)       ADDRESS OF ARG FOR MOVE        S21016 46553021
         MVC   N0(TWO,R6),N0(R10) MOVE ARG NBR TO MSG            S21016 46556021
         LA    R6,NAME6            POINT TO NAME FLD             S21016 46559021
         LA    R1,MSG6             POINT TO IFF606I              S21016 46562021
         LA    R7,PD30            ADDR OF NEXT                   S21016 46565021
         B     PD1                 GO ISSUE WTO                  S21016 46568021
PD4      EQU   *                   CODE TO TEST NULL VS RET CODE S21016 46571021
         SR    R1,R1               ZERO REG                      S21016 46574021
         SR    R6,R6               ZERO REG                      S21016 46577021
         TM    GSPARRAY,X'04'     I/O ERROR?                     S21016 46580021
         BO    RCEQ5              IT WAS                         S21016 46583021
         TM    GSPARRAY,X'08'     PARAMETER ERROR?               S21016 46586021
         BO    RCEQ4              YES                            S21016 46589021
         TM    GSPARRAY,X'10'     RET CODE = 3?                  S21016 46592021
         BO    RCEQ3              IT WAS                         S21016 46595021
         TM    GSPARRAY,X'40'      SCISSORING USED?              S21016 46598021
         BO    RCEQ1               YES                           S21016 46601021
         TM    GSPARRAY,X'20'      SCALING ERROR?                S21016 46604021
         BO    RCEQ2               YES                           S21016 46607021
         B     PD0                IRRELEVENT RET CODE - NA ACTIONS21016 46610021
*                                                                S21016 46613021
*                                                                S21016 46616021
RCEQ1    EQU   *                                                 S21016 46619021
         LA    R1,ONE              LOAD SCISSORING CODE          S21016 46622021
         B     CHKNULL             CHECK NULL VALUE              S21016 46625021
*                                                                S21016 46628021
*                                                                S21016 46631021
RCEQ2    EQU   *                                                 S21016 46634021
         LA    R1,TWO              SCALING ERROR CODE            S21016 46637021
         B     CHKNULL             CHECK NULL VALUE              S21016 46640021
*                                                                S21016 46643021
*                                                                S21016 46646021
*                                                                S21016 46649021
*                                                                S21016 46652021
RCEQ3    EQU   *                                                 S21016 46655021
         LA    R1,TH               LOAD 3                        S21016 46658021
         B     CHKNULL             GO COMPARE WITH NULL          S21016 46661021
*                                                                S21016 46664021
RCEQ5    EQU   *                                                 S21016 46667021
         LA    R1,FIVE             ASSUME I/O ERROR - LOAD 5     S21016 46670021
         B     CHKNULL             GO COMPARE WITH NULL          S21016 46673021
RCEQ4    EQU   *                                                 S21016 46676021
         LA    R1,FOUR             LOAD 4                        S21016 46679021
CHKNULL  EQU   *                   THIS CODE MASSAGES NULL       S21016 46682021
         L     R10,GSPNULLV        ADDR OF NULL VARIABLE         S21016 46685021
         L     R10,N0(R10)         LOAD ACTUAL NULL              S21016 46688021
         LPR   R10,R10             MAKE POSITIVE                 S21016 46691021
         CLR   R10,R1              COMPARE NULL AND RET CODE     S21016 46694021
         BH    PD0                BRANCH - NO TERMINATION MSG    S21016 46697021
* RETCODE IS IN R1; NULL IS IN R10                               S21016 46700021
PD7      EQU   *                                                 S21016 46703021
         O     R1,PRTMASK          INSERT ZONE                   S21016 46706021
         O     R10,PRTMASK         INSERT ZONE                   S21016 46709021
         STC   R1,RETCODE          STORE RET CODE                S21016 46712021
         STC   R10,NULL1           STORE NULL VALUE              S21016 46715021
         LA    R6,NAME1           ADDRESS OF NAME 1              S21016 46718021
         MVC   N0(FIVE,R6),N0(R11) MOVE SUBRTN NAME TO MSG       S21016 46721021
         LA    R1,MSG1             POINT TO IFF601I              S21016 46724021
         WTO   MF=(E,(R1))         ISSUE WTO                     S21016 46727021
         B     PD0                 CONTINUE "NORMAL" PROCESSING  S21016 46730021
         EJECT                                                          46800021
*                                                                       47200021
*MODULE NOT IN STORAGE.  TEST FOR LOAD AND CALL OR LINK.                47600021
*                                                                       48000021
AHAD2010 L     R7,16                   GET CVT ADDRESS                  48400021
         L     R7,CVTLINK(R7)          GET LINKLIB DCB ADDR             48800021
*                                                                       49200021
*MOVE 4 CHARACTERS OF MODULE NAME PAST IFFA FIELD IN STATUS TABLE       49600021
*                                                                       50000021
         L     R6,N4(R3,R5)            GET CHARACTERS FROM STATAB       50400021
         ST    R6,MODNAME+4(R5)        CONCATENATE WITH IFFA FIELD      50800021
         LA    R3,N0(R5,R3)            ADD STATAB ADDR AND STATAB INDEX 51200021
         TM    N8(R3),X'01'        LINK                            000A 51600021
         BO    AHAD2060            YES                             000A 52000021
*                                                                       52400021
*MODULE TO BE LOADED AND CALLED                                         52800021
*                                                                       53200021
         LR    R1,R7                   PUT LINKLIB DCB IN REG 1         53600021
         LA    R0,MODNAME(R5)          LOAD MODULE NAME ADDR            54000021
         LOAD  EPLOC=(0)                                                54400021
         LR    R15,R0                  PUT EP ADDRESS IN R15            54800021
         ST    R15,0(R3)               PPUT EP ADDR IN STATAB           55200021
         TM    N8(R3),X'04'        ANOTHER ENTRY PT                000A 55240021
         BZ    AHAD2015            NO                              000A 55280021
         SR    R1,R1                                               000A 55320021
         IC    R1,9(R3)            ENTRY NUMBER                    000A 55360021
         MH    R1,H12              DISP IN STATUS TABLE            000A 55400021
         LH    R7,10(R3)           DISP INTO MODULE                000A 55440021
         AR    R7,R15              COMPUTE ENTRY PT                000A 55480021
         ST    R7,0(R1,R5)         PLACE ENT PT IN OTHER MODULE    000A 55520021
AHAD2015 OI    N8(R3),X'08'        SET SWITCH-LOAD MODULE          000A 55560021
         B     AHAD2040                BRANCH TO CALL SUBROUTINE        55600021
*                                                                       56000021
*MODULE TO BE LINKED TO                                                 56400021
*                                                                       56800021
AHAD2060 LA    R6,MODNAME(R5)          TRANSFER MODULE NAME             57200021
         XC    SUPPLIST(16,R4),SUPPLIST(R4)                             57600021
         LINK  EPLOC=(6),MF=(E,(4)),SF=(E,SUPPLIST(4))                  58000021
         B     AHAD2050                GO TO EXIT TO USER               58400021
         EJECT                                                          58480021
*   RETURN CODE HAS EQUALED OR EXCEEDED NULL VALUE. ONE OF TWO ACTIONS  58560021
*   OCCURS NOW.                                                         58640021
*                                                                       58720021
*          1. IF A USER ERROR EXIT HAS BEEN SPECIFIED IN THE CALL TO    58800021
*             INGSP, THE EXIT ROUTINE IS GIVEN CONTROL.  CONTROL DOES   58880021
*             NOT RETURN TO DIRECTOR II AFTER EXIT ROUTINE COMPLETION,  58960021
*             SINCE THE SAVE AND RETURN REGISTERS ARE THOSE PASSED TO   59040021
*             DIRECTOR II. CONTROL INSTEAD PASSES FROM EXIT ROUTINE TO  59120021
*             SUPERVISOR TO HIGHER LANGUAGE CALLING PROGRAM.            59200021
*                                                                       59280021
*          2. IF NO EXIT ROUTINE HAS BEEN SPECIFIED, THE TASK IS        59360021
*             TERMINATED.  A DUMP IS PROVIDED IF A NEGATIVE NULL VALUE  59440021
*             HAS BEEN SPECIFIED IN THE CALL  TO INGSP.                 59520021
         SPACE 3                                                        59600021
AHAD2100 L     R15,GSPAEXIT          IS ERROR EXIT SPECIFIED     S21016 59680021
         LTR   R15,R15                                           S21016 59760021
         BZ    AHAD2120                 IF NO, ABEND             S21016 59840021
         MVI   GSPBUSYS,X'00'           IF YES,SET GSP NOT BUSY   M1097 59890021
         L     R13,USERSAVE+4(R4)              AND RESTORE        M1097 59940021
         L     R14,RETURN(R13)                  REGISTERS        S21016 60000021
         LM    R0,R12,R0SAVE(R13)               FOR USER         S21016 60080021
         BR    R15                   PASS CONTROL TO EXIT RTN    S21016 60160021
         SPACE 3                                                        60240021
AHAD2120 L     R1,CCODE              GET ABEND CODE 062          S21016 60320021
         CLI   GSPDUMP,DUMP                                             60400021
         BNE   AHAD2150                 BRANCH IF NO DUMP               60800021
         LA    R3,GSPARRAY              SET UP FOR ABEND                61200021
         LR    R2,R8                    ADDRESS OF STATUS TABLE ENTRY   61600021
         ABEND (1),DUMP                                                 62000021
*                                                                       62400021
AHAD2150 ABEND (1)                                                      62800021
         DS    0F                                                       63200021
CCODE    DC    XL4'00062000'                                            63600021
         EJECT                                                          64000021
GSPCB    DSECT                                                          64400021
GSPGTMCB DS    F                   ADDRESS OF THE FIRST GTMCB           64800021
*                                  ON THE CHAIN                         65200021
GSPDCTR2 DS    F                   ADDRESS OF PART 2 OF THE DIRECTOR    65600021
GSPSYSID DS    X                   BYTE TO SAY THIS IS A CONTROL BLK    66000021
*              X'F2'               SETTING                              66400021
GSPCBID  DS    X                   ID TO SAY THIS IS A GSPCB            66800021
*              X'01'               SETTING                              67200021
GSPBUSYS DS    X                   GSP BUSY SWITCH                      67600021
*              X'00'               GSP NOT BUSY                         68000021
*              X'FF'               GSP BUSY                             68400021
GSPFLAGS DS    X                   ASSORTED FLAGS                       68800021
*              X'01'               1=IN DE / 0=NOT IN DE                69200021
GSPDECNT DS    X                   COUNT OF DIRECT ENTRIES PENDING      69600021
GSPDUMP  DS    X                                                        70000021
GSPABEND DS    X                                                        70400021
GSPAWORK DS    F                   ADDRESS OF WORK AREA                 70800021
GSPSTRTB DS    F                   ADDRESS OF THE STROKE TABLE          71200021
GSPARRAY DS    5F                  GSP RETURN ARRAY                     71600021
GSPNULLV DS    F                   THE ADDRESS TO BE RECOGNIZED         72000021
*                                  AS THE ABSENCE OF A PARAMETER        72400021
GSPASTAT DS    F                   ADDRESS OF THE STATUS TABLE          72800021
GSPAEXIT DS    F             ADDR OF USER EXIT RTN, INGSP ARG 3  S21016 73000021
GSPCBLGN EQU   *-GSPCB                 LENGTH OF GSPCB                  73200021
         EJECT                                                          73600021
IFFAHA11 CSECT                                                          74000021
N0       EQU   0                                                        74800021
TWO      EQU   2                                                 S21016 74900021
TH       EQU   3                                                 S21016 75000021
FOUR     EQU   4                                                 S21016 75100021
N4       EQU   4                                                        75200021
FIVE     EQU   5                                                 S21016 75400021
N8       EQU   8                                                        75600021
CVTLINK  EQU   8                                                        76000021
RETURN   EQU   12             USER RETURN REGISTER 14 DISPL      S21016 76020021
R0SAVE   EQU   20             USER REGISTER 0 DISPLACEMENT       S21016 76040021
R10      EQU   10                                                S21016 76060021
R11      EQU   11                                                S21016 76080021
TWLV     EQU   12                                                S21016 76100021
F        EQU   15                                                S21016 76120021
NINTN    EQU   19                                                S21016 76140021
ARG      EQU   32                                                S21016 76160021
ARG1     EQU   38                                                S21016 76180021
ARG3     EQU   35                                                S21016 76200021
ARG4     EQU   34                                                S21016 76220021
ONE      EQU   1                                                 S21016 76240021
         DS    0F                                                S21016 76260021
PRTMASK  DC    X'000000F0'                                       S21016 76280021
H5       DC    H'5'                                              S21016 76300021
DUMP     EQU   X'FF'                                                    76400021
*                                                                       76800021
*THESE ASSUME A 1K WORKAREA                                             77600021
*                                                                       78000021
USERSAVE EQU   1020-GSPCBLGN-72                                         78400021
SUPPLIST EQU   1020-GSPCBLGN-104                                        78800021
*                                                                       79200021
*ASSUMES 66 TWELVE BYTE ENTRIES IN STATUS TABLE                  00000B 79600021
*                                                                       80000021
MODNAME  EQU   70*12+120                                                80400021
*                                                                       80800021
HCON3    DC    H'3'          FACTOR$DIFF NUM IS STATAB DISPLACEMENT     81200021
H12      DC    H'12'                                               000A 81400021
SEVEN    DC    F'7'                                                     81600021
         SPACE 3                                                        82000021
*CONVERSION TABLE FOR ABEND CODES                                       82400021
TAB      DC    X'80'                                                    82800021
         DC    X'40'                    RETURN CODE 1   -SCISSOR        83200021
         DC    X'20'                                2   -SCALE          83600021
         DC    X'10'                                3   -STOR EXCEDED   84000021
         DC    X'08'                                4   -PARAMETER      84400021
         DC    X'04'                                5   -I/O ERROR      84800021
         DC    X'02'                                6   -               85200021
         EJECT                                                          85203021
* THE FOLLOWING TABLE IS A LIST OF NAMES TO BE MOVED INTO WTO'S  S21016 85206021
* IN THE STATUS TABLE WHEN ERROR CONDITIONS ARE ENCOUNTERED; THE S21016 85209021
* TABLE IS, AND MUST REMAIN, IN THE SAME ORDER AS THE STATUS TABLS21016 85212021
TABLE    EQU   *                                                 S21016 85215021
         DC    C'INDEV'                                          S21016 85218021
         DC    C'TMDEV'                                          S21016 85221021
         DC    C'INGDS'                                          S21016 85224021
         DC    C'TMGDS'                                          S21016 85227021
         DC    C'CRATL'                                          S21016 85230021
         DC    C'ENATL'                                          S21016 85233021
         DC    C'ENATN'                                          S21016 85236021
         DC    C'DSATN'                                          S21016 85239021
         DC    C'MPATL'                                          S21016 85242021
         DC    C'MLPEO'                                          S21016 85245021
         DC    C'SLPAT'                                          S21016 85248021
         DC    C'MLITS'                                          S21016 85251021
         DC    C'RQATN'                                          S21016 85254021
         DC    C'     '            TAKES UP SPACE IN TABLE       S21016 85257021
         DC    C'     '            TAKES UP SPACE IN TABLE       S21016 85260021
         DC    C'SALRM'                                          S21016 85263021
         DC    C'GSPRD'                                          S21016 85266021
         DC    C'RCURS'                                          S21016 85269021
         DC    C'ICURS'                                          S21016 85272021
         DC    C'SDATM'                                          S21016 85275021
         DC    C'SGRAM'                                          S21016 85278021
         DC    C'SDATL'                                          S21016 85281021
         DC    C'SGDSL'                                          S21016 85284021
         DC    C'SSCIS'                                          S21016 85287021
         DC    C'SCHAM'                                          S21016 85290021
         DC    C'PLINE'                                          S21016 85293021
         DC    C'PPNT '                                          S21016 85296021
         DC    C'PSGMT'                                          S21016 85299021
         DC    C'PTEXT'                                          S21016 85302021
         DC    C'STPOS'                                          S21016 85305021
         DC    C'MVPOS'                                          S21016 85308021
         DC    C'BSGEQ'                                          S21016 85311021
         DC    C'BGSUB'                                          S21016 85314021
         DC    C'ENSEQ'                                          S21016 85317021
         DC    C'ENSUB'                                          S21016 85320021
         DC    C'LKSUB'                                          S21016 85323021
         DC    C'INCL '                                          S21016 85326021
         DC    C'OMIT '                                          S21016 85329021
         DC    C'EXEC '                                          S21016 85332021
         DC    C'RESET'                                          S21016 85335021
         DC    C'IDPOS'                                          S21016 85338021
         DC    C'FSMOD'                                          S21016 85341021
         DC    C'STEOS'                                          S21016 85344021
         DC    C'ORGDS'                                          S21016 85347021
         DC    C'LOCPN'                                          S21016 85350021
         DC    C'BGTRK'                                          S21016 85353021
         DC    C'RDTRK'                                          S21016 85356021
         DC    C'ENTRK'                                          S21016 85359021
         DC    C'DFSTR'                                          S21016 85362021
         DC    C'PLSTR'                                          S21016 85365021
         DC    C'ORGEN'                                          S21016 85368021
         DC    C'CNVRT'                                          S21016 85371021
         DC    C'ITRC '                                          S21016 85374021
         DC    C'RTBP '                                          S21016 85377021
         DC    C'ITBP '                                          S21016 85380021
         DC    C'ITST '                                          S21016 85383021
         DC    C'SPEC '                                          S21016 85386021
* END OF TABLE                                                   S21016 85389021
         EJECT                                                          85392021
STATTBL  DSECT                                                   S21016 85395021
STATSTRT DS    242F                LGTH OF STATUS TABLE UP TO MSGS21016 85398021
MSG1     DS    F                   MSG LGTH AND MCS FLAGS        S21016 85401021
         DS    8C                  IFF601I MSG ID + 1 BLANK      S21016 85404021
NAME1    DS    5C                  SUBRTN NAME                   S21016 85407021
         DS    13C                                               S21016 85410021
RETCODE  DS    C                   RETURN CODE                   S21016 85413021
         DS    28C                                               S21016 85416021
NULL1    DS    C                   NULL VALUE                    S21016 85419021
         DS    C                   ADDL INFO                     S21016 85422021
         DS    F                   DESC AND ROUTING CODES        S21016 85425021
*                                                                S21016 85428021
*                                                                S21016 85431021
*                                                                S21016 85434021
MSG2     DS    F                   MSG LGTH AND MCS FLAGS        S21016 85437021
         DS    8C                  IFF602I MSG ID + 1 BLANK      S21016 85440021
NAME2    DS    5C                  SUBRTN NAME                   S21016 85443021
         DS    51C                                               S21016 85446021
         DS    F                   DESC AND ROUTING CODES        S21016 85449021
*                                                                S21016 85452021
*                                                                S21016 85455021
*                                                                S21016 85458021
MSG3     DS    F                   MSG LGTH AND MCS FLAGS        S21016 85461021
         DS    8C                  IFF603I MSG ID + 1 BLANK      S21016 85464021
NAME3    DS    5C                  SUBRTN NAME                   S21016 85467021
         DS    48C                                               S21016 85470021
         DS    F                   DESC AND ROUTING CODES        S21016 85473021
*                                                                S21016 85476021
         EJECT                                                          85479021
*                                                                S21016 85482021
*                                                                S21016 85485021
MSG4     DS    F                   MSG LGTH AND MCS FLAGS        S21016 85488021
         DS    8C                  IFF604I MSG ID + 1 BLANK      S21016 85491021
NAME4    DS    5C                  SUBRTN NAME                   S21016 85494021
         DS    59C                                               S21016 85497021
         DS    F                   DESC AND ROUTING CODES        S21016 85500021
*                                                                S21016 85503021
*                                                                S21016 85506021
*                                                                S21016 85509021
MSG5     DS    F                   MSG LGTH AND MCS FLAGS        S21016 85512021
         DS    8C                  IFF605I MSG ID + 1 BLANK      S21016 85515021
NAME5    DS    5C                  SUBRTN NAME                   S21016 85518021
         DS    54C                                               S21016 85521021
         DS    F                   DESC AND ROUTING CODES        S21016 85524021
*                                                                S21016 85527021
*                                                                S21016 85530021
*                                                                S21016 85533021
MSG6     DS    F                   MSG LGTH AND MCS FIELDS       S21016 85536021
         DS    8C                  IFF606I MSG ID + 1 BLANK      S21016 85539021
NAME6    DS    5C                  SUBRTN NAME                   S21016 85542021
         DS    25C                ADDL INFO                      S21016 85545021
ARGNBR   DS    2C                  INVALID ARGUMENT NUMBER       S21016 85548021
         DS    8C                 ADDL INFO                      S21016 85551021
         DS    F                   DESC AND ROUTING CODES        S21016 85554021
         EJECT                                                          85557021
*                                                                S21016 85560021
*                                                                S21016 85563021
*                                                                S21016 85566021
MSG7     DS    F                   MSG LGTH AND MCS FIELDS       S21016 85569021
         DS    8C                  IFF607I MSG ID + 1 BLANK      S21016 85572021
NAME7    DS    5C                  SUBRTN NAME                   S21016 85575021
         DS    48C                 ADDL INFO                     S21016 85578021
         DS    F                   DESC AND ROUTING CODES        S21016 85581021
*                                                                S21016 85584021
*                                                                S21016 85587021
*                                                                S21016 85590021
* END OF WTO DSECT                                               S21016 85593021
         END                                                            85600021
./  ADD  SSI=80330210,NAME=IFFAHA12
IFFAHA12 CSECT                                                          00300000
*0840,321000-324000,333000-336000,369000-372000,381000-384000,     000A 00600000
*0840,393000-396000,405000-408000,453000-456000,465000-468000,     000A 00900000
*0840,657000-660000,669000-672000,768000-771000,828000-831000,     000A 01200000
*0840,840000-843000,852000-855000                                  000A 01500000
*2430,696000                                                       RSTF 01800000
*C843000,855000                                             D11 ZA15418 02100000
STATAB   DC    F'0'          INDEV                                      02400000
         DC    C'AA03'                                                  02700000
         DC    X'01'                                                    03000000
         DC    XL3'00'                                                  03300000
         DC    F'0'          TMDEV                                      03600000
         DC    C'AA04'                                                  03900000
         DC    X'01'                                                    04200000
         DC    XL3'00'                                                  04500000
         DC    F'0'          INGDS                                      04800000
         DC    C'AA05'                                                  05100000
         DC    X'01'                                                    05400000
         DC    XL3'00'                                                  05700000
         DC    F'0'          TMGDS                                      06000000
         DC    C'AA06'                                                  06300000
         DC    X'01'                                                    06600000
         DC    XL3'00'                                                  06900000
         DC    F'0'          CRATL                                      07200000
         DC    C'CA00'                                                  07500000
         DC    X'01'                                                    07800000
         DC    XL3'00'                                                  08100000
         DC    F'0'          ENATL                                      08400000
         DC    C'CA01'                                                  08700000
         DC    X'01'                                                    09000000
         DC    XL3'00'                                                  09300000
         DC    F'0'          ENATN                                      09600000
         DC    C'CA02'                                                  09900000
         DC    X'01'                                                    10200000
         DC    XL3'00'                                                  10500000
         DC    F'0'          DSATN                                      10800000
         DC    C'CA03'                                                  11100000
         DC    X'01'                                                    11400000
         DC    XL3'00'                                                  11700000
         DC    F'0'          MPATL                                      12000000
         DC    C'CA04'                                                  12300000
         DC    X'01'                                                    12600000
         DC    XL3'0'                                                   12900000
         DC    F'0'          MLPEO                                      13200000
         DC    C'CA05'                                                  13500000
         DC    X'01'                                                    13800000
         DC    XL3'00'                                                  14100000
         DC    F'0'          SLPAT                                      14400000
         DC    C'CA06'                                                  14700000
         DC    X'01'                                                    15000000
         DC    XL3'00'                                                  15300000
         DC    F'0'          MLITS                                      15600000
         DC    C'CA07'                                                  15900000
         DC    X'01'                                                    16200000
         DC    XL3'00'                                                  16500000
         DC    F'0'          RQATN                                      16800000
         DC    C'CA08'                                                  17100000
         DC    X'02'                                                    17400000
         DC    XL3'00'                                                  17700000
*                                                                       18000000
*THE NEXT TWO ENTRIES ARE FOR USE WITH DIRECT ENTRY CAPABILITY          18300000
*                                                                       18600000
         DC    6F'0'          AVAILABLE FOR FUTURE USE                  18900000
*                                                                       19200000
         DC    F'0'          SALRM                                      19500000
         DC    C'CA13'                                                  19800000
         DC    X'01'                                                    20100000
         DC    XL3'00'                                                  20400000
         DC    F'0'          GSPRD                                      20700000
         DC    C'DA01'                                                  21000000
         DC    X'02'                                                    21300000
         DC    XL3'00'                                                  21600000
         DC    F'0'          RCURS                                      21900000
         DC    C'DA02'                                                  22200000
         DC    X'02'                                                    22500000
         DC    XL3'00'                                                  22800000
         DC    F'0'          ICURS                                      23100000
         DC    C'DA03'                                                  23400000
         DC    X'02'                                                    23700000
         DC    XL3'00'                                                  24000000
         DC    F'0'          SDATM                                      24300000
         DC    C'EA01'                                                  24600000
         DC    X'01'                                                    24900000
         DC    XL3'00'                                                  25200000
         DC    F'0'          SGRAM                                      25500000
         DC    C'EA02'                                                  25800000
         DC    X'01'                                                    26100000
         DC    XL3'00'                                                  26400000
         DC    F'0'          SDATL                                      26700000
         DC    C'EA03'                                                  27000000
         DC    X'01'                                                    27300000
         DC    XL3'00'                                                  27600000
         DC    F'0'          SGDSL                                      27900000
         DC    C'EA04'                                                  28200000
         DC    X'01'                                                    28500000
         DC    XL3'00'                                                  28800000
         DC    F'0'          SSCIS                                      29100000
         DC    C'EA06'                                                  29400000
         DC    X'01'                                                    29700000
         DC    XL3'00'                                                  30000000
         DC    F'0'          SCHAM                                      30300000
         DC    C'EA07'                                                  30600000
         DC    X'01'                                                    30900000
         DC    XL3'00'                                                  31200000
         DC    F'0'          PLINE                                      31500000
         DC    C'FA01'                                                  31800000
         DC    X'06'               MULT ENT & LOAD FLAGS           000A 32100000
         DC    X'1A'               ENT NO. OF PPNT                 000A 32400000
         DC    H'12'               DISP FOR PPNT ADDR              000A 32700000
         DC    F'0'          PPNT                                       33000000
         DC    C'FA16'                                                  33300000
         DC    X'06'               MULT ENT & LOAD FLAGS           000A 33600000
         DC    X'19'               ENT NO. OF PLINE                000A 33900000
         DC    H'-12'              DISP FOR PLINE ADDR             000A 34200000
         DC    F'0'          PSGMT                                      34500000
         DC    C'FA02'                                                  34800000
         DC    X'02'                                                    35100000
         DC    XL3'00'                                                  35400000
         DC    F'0'          PTEXT                                      35700000
         DC    C'FA03'                                                  36000000
         DC    X'02'                                                    36300000
         DC    XL3'00'                                                  36600000
         DC    F'0'          STPOS                                      36900000
         DC    C'FA04'                                                  37200000
         DC    X'05'               MULT ENT & LINK FLAGS           000A 37500000
         DC    X'1E'               ENT. NO. OF MVPOS               000A 37800000
         DC    H'02'               DISP FOR MVPOS ADDR             000A 38100000
         DC    F'0'          MVPOS                                      38400000
         DC    C'FA17'                                                  38700000
         DC    X'05'               MULT ENT & LINK FLAGS           000A 39000000
         DC    X'1D'               ENT. NO. OF STPOS               000A 39300000
         DC    H'-2'               DISP FOR STPOS ADDR             000A 39600000
         DC    F'0'          BGSEQ                                      39900000
         DC    C'FA05'                                                  40200000
         DC    X'05'               MULT ENT & LINK FLAGS           000A 40500000
         DC    X'20'               ENT. NO. OF BGSUB               000A 40800000
         DC    H'10'               DISP FOR BGSUB ADDR             000A 41100000
         DC    F'0'          BGSUB                                      41400000
         DC    C'FA18'                                                  41700000
         DC    X'05'               MULT ENT AND LINK FLAGS         000A 42000000
         DC    X'1F'               ENT. NO. OF BGSEQ               000A 42300000
         DC    H'-10'              DISP FOR BGSEQ ADDR             000A 42600000
         DC    F'0'          ENSEQ                                      42900000
         DC    C'FA06'                                                  43200000
         DC    X'01'                                                    43500000
         DC    XL3'00'                                                  43800000
         DC    F'0'          ENSUB                                      44100000
         DC    C'FA07'                                                  44400000
         DC    X'01'                                                    44700000
         DC    XL3'00'                                                  45000000
         DC    F'0'          LKSUB                                      45300000
         DC    C'FA08'                                                  45600000
         DC    X'01'                                                    45900000
         DC    XL3'00'                                                  46200000
         DC    F'0'          INCL                                       46500000
         DC    C'FA09'                                                  46800000
         DC    X'05'               MULT ENT AND LINK FLAGS         000A 47100000
         DC    X'25'               ENT. NO. OF OMIT                000A 47400000
         DC    H'12'               DISP FOR OMIT ADDR              000A 47700000
         DC    F'0'          OMIT                                       48000000
         DC    C'FA10'                                                  48300000
         DC    X'05'               MULT ENT AND LINK FLAGS         000A 48600000
         DC    X'24'               ENT. NO. OF INCL                000A 48900000
         DC    H'-12'              DISP FOR INCL ADDR              000A 49200000
         DC    F'0'          EXEC                                       49500000
         DC    C'FA11'                                                  49800000
         DC    X'02'                                                    50100000
         DC    XL3'00'                                                  50400000
         DC    F'0'          RESET                                      50700000
         DC    C'FA12'                                                  51000000
         DC    X'01'                                                    51300000
         DC    XL3'00'                                                  51600000
         DC    F'0'          IDPOS                                      51900000
         DC    C'FA13'                                                  52200000
         DC    X'01'                                                    52500000
         DC    XL3'00'                                                  52800000
         DC    F'0'          FSMOD                                      53100000
         DC    C'FA14'                                                  53400000
         DC    X'01'                                                    53700000
         DC    XL3'00'                                                  54000000
         DC    F'0'          STEOS                                      54300000
         DC    C'FA15'                                                  54600000
         DC    X'01'                                                    54900000
         DC    XL3'00'                                                  55200000
         DC    F'0'          ORGDS                                      55500000
         DC    C'FA19'                                                  55800000
         DC    X'01'                                                    56100000
         DC    XL3'00'                                                  56400000
         DC    F'0'          LOCPN                                      56700000
         DC    C'GA01'                                                  57000000
         DC    X'01'                                                    57300000
         DC    XL3'00'                                                  57600000
         DC    F'0'          BGTRK                                      57900000
         DC    C'GA02'                                                  58200000
         DC    X'01'                                                    58500000
         DC    XL3'00'                                                  58800000
         DC    F'0'          RDTRK                                      59100000
         DC    C'GA03'                                                  59400000
         DC    X'01'                                                    59700000
         DC    XL3'00'                                                  60000000
         DC    F'0'          ENTRK                                      60300000
         DC    C'GA04'                                                  60600000
         DC    X'01'                                                    60900000
         DC    XL3'00'                                                  61200000
         DC    F'0'          DFSTR                                      61500000
         DC    C'GA05'                                                  61800000
         DC    X'01'                                                    62100000
         DC    XL3'00'                                                  62400000
         DC    F'0'          PLSTR                                      62700000
         DC    C'GA06'                                                  63000000
         DC    X'01'                                                    63300000
         DC    XL3'00'                                                  63600000
         DC    F'0'          ORGEN                                      63900000
         DC    C'GA07'                                                  64200000
         DC    X'01'                                                    64500000
         DC    XL3'00'                                                  64800000
         DC    F'0'          CNVRT                                      65100000
         DC    C'GA08'                                                  65400000
         DC    X'01'                                                    65700000
         DC    XL3'00'                                                  66000000
         DC    F'0'          ITRC                                       66300000
         DC    C'JA01'                                                  66600000
         DC    X'02'                                                    66900000
         DC    XL3'00'                                                  67200000
         DC    F'0'          ITBP                                       67500000
         DC    C'JA02'                                                  67800000
         DC    X'06'               MULT ENT AND LOAD FLAGS         000A 68100000
         DC    X'36'               ENT. NO. OF RTBP                000A 68400000
         DC    H'8'                DISP FOR RTBP ADDR              000A 68700000
         DC    F'0'          RTBP                                       69000000
         DC    C'JA03'                                                  69300000
         DC    X'06'               MULT ENT AND LOAD FLAGS         000A 69600000
         DC    X'35'               ENT. NO. OF ITBP                000A 69900000
         DC    H'-8'               DISP FOR ITBP ADDR              000A 70200000
         DC    F'0'          ITST                                       70500000
         DC    C'JA04'                                                  70800000
         DC    X'02'                                                    71100000
         DC    XL3'00'                                                  71400000
         DC    1F'0'         SPEC                                  RSTF 71700000
         DC    C'CA50'                                             RSTF 72000000
         DC    X'01'                                               RSTF 72300000
         DC    XL3'0'                                              RSTF 72600000
*                                                                       72900000
*SPACE FOR POSSIBLE FUTURE EXPANSION                                    73200000
*                                                                       73500000
         DC    27F'0'                                              RSTF 73800000
         DC    F'0'               FLOW CLT                              74100000
         DC    C'HA01'                                                  74400000
         DC    X'02'                                                    74700000
         DC    XL3'00'                                                  75000000
         DC    3F'0'                                                    75300000
         DC    F'0'               BUFFER MGMT                           75600000
         DC    C'HA02'                                                  75900000
         DC    X'02'                                                    76200000
         DC    XL3'00'                                                  76500000
         DC    F'0'               KEY TABLE MGMT                        76800000
         DC    C'HA03'                                                  77100000
         DC    X'02'                                                    77400000
         DC    XL3'00'                                                  77700000
         DC    F'0'               DATA GENERATOR                        78000000
         DC    C'HA04'                                                  78300000
         DC    X'02'                                                    78600000
         DC    XL3'00'                                                  78900000
         DC    F'0'               DATA STORE                            79200000
         DC    C'HA05'                                                  79500000
         DC    X'02'                                                    79800000
         DC    XL3'00'                                                  80100000
         DC    F'0'               SCALE                                 80400000
         DC    C'HA06'                                                  80700000
         DC    X'06'               MULT ENT AND LOAD FLAGS         000A 81000000
         DC    X'4D'               ENT. NO. OF CONVERT             000A 81300000
         DC    H'432'              DISP FOR CONVERT ADDR           000A 81600000
         DC    F'0'               SCISSOR                               81900000
         DC    C'HA07'                                                  82200000
         DC    X'02'                                                    82500000
         DC    XL3'00'                                                  82800000
*                                                                       83100000
         DC    9F'0'      THREE ENTRIES AVAILABLE FOR FUTURE USE        83400000
*                                                                       83700000
         DC    F'0'               CONVERT                               84000000
         DC    C'HA15'                                                  84300000
         DC    X'06'               MULT ENT AND LOAD FLAGS         000A 84600000
         DC    X'48'               ENT. NO. OF SCALE               000A 84900000
         DC    H'-432'             DISP FOR SCALE ADDR             000A 85200000
         DC    F'0'               UPDATE                                85500000
         DC    C'HA13'                                                  85800000
         DC    X'06'               MULT ENT AND LOAD FLAGS         000A 86100000
         DC    X'4F'               ENT NO. OF UPDATE 2             000A 86400000
         DC    H'008'              DISP FOR UPDATE 2        D11 ZA15418 86700000
         DC    F'0'                                                     87000000
         DC    C'HA14'                                                  87300000
         DC    X'06'               MULT ENT AND LOAD FLAGS         000A 87600000
         DC    X'4E'               ENT NO. OF UPDATE 1             000A 87900000
         DC    H'-008'             DISP FOR UPDATE 1        D11 ZA15418 88200000
DBLWRD   DC    C'IFFA'                                                  88500000
COMP     DC    F'0'                                                     88800000
* THE FOLLOWING MESSAGES ARE ISSUED BY THE DIRECTOR 2 (IFFAHA11) S21016 89100000
* WHEN THE APPLICABLE RETURN CODE IS ENCOUNTERED. THESE WTO'S    S21016 89400000
* ARE DYNAMICALLY MODIFIED BY DIR 2 TO INCLUDE THE NAME OF THE   S21016 89700000
* OFFENDING ROUTINE AND RETURN CODE; THUS, DIR 2 IS SENSITIVE    S21016 90000000
* TO THE EXPANSION OF WTO                                        S21016 90300000
*                                                                S21016 90600000
*                                                                S21016 90900000
* MSG1 IS ISSUED WHEN THE NULL VALUE IS EQUALED OR EXCEEDED      S21016 91200000
MSG1     WTO   'IFF601I       RETURN CODE    EQUALS/EXCEEDS NULL VALUE X91500000
                 ',ROUTCDE=11,DESC=7,MF=L                        S21016 91800000
*                                                                S21016 92100000
* MSG2 IS ISSUED IF AN UPDATE ATTEMPT FAILS; SUBRTN NAME STORED  S21016 92400000
* BY DIR 2 AT MSG+9                                              S21016 92700000
MSG2     WTO   'IFF602I       RETURN CODE 3; UPDATE ATTEMPT FAILED, CALX93000000
               L IGNORED',ROUTCDE=11,DESC=7,MF=L                 S21016 93300000
* MSG3 IS ISSUED IF GDS SPACE IS EXCEEDED; SUBRTN NAME IS STORED S21016 93600000
* AT MSG+9                                                       S21016 93900000
MSG3     WTO   'IFF603I       RETURN CODE 3, GDS SPACE EXCEEDED, CALL IX94200000
               GNORED',ROUTCDE=11,DESC=7,MF=L                    S21016 94500000
* MSG 4 IS ISSUED IF BUFFER SPACE IS UNAVAILABLE (RC X'|0')      S21016 94800000
MSG4     WTO   'IFF604I       RETURN CODE 3, 2250 BUFFER SPACE UNAVAILAX95100000
               BLE, CALL IGNORED',ROUTCDE=11,DESC=7,MF=L         S21016 95400000
* MSG 5 IS ISSUED IF MAIN STORAGE IS UNAVAILABLE (RC = X'10')    S21016 95700000
MSG5     WTO   'IFF605I       RETURN CODE 3, MAIN STORAGE UNAVAILABLE, X96000000
               CALL IGNORED',ROUTCDE=11,DESC=7,MF=L              S21016 96300000
* MSG 6 IS ISSUED IN THE CASE OF A BAD PARAMETER (RC = X'08')    S21016 96600000
* DIR2 STORES ARG NBR AT MSG+39                                  S21016 96900000
MSG6     WTO   'IFF606I       RETURN CODE 4, ARGUMENT    INVALID',ROUTCX97200000
               DE=11,DESC=7,MF=L                                 S21016 97500000
* MSG7 IS ISSUED IN CASE OF AN I/O ERROR                                97800000
MSG7     WTO   'IFF607I       RETURN CODE 5, INPUT/OUTPUT ERROR, CALL IX98100000
               GNORED',ROUTCDE=11,DESC=7,MF=L                    S21016 98400000
         END                                                            98700000
./  ADD  SSI=80330211,NAME=IFFAHA13
         TITLE 'IFFAHA13-UPDATE ROUTINE'                                00100000
*                                                                       00200000
*        UPDATE IS ENTERED DIRECTLY FROM PLINE/PPOINT,PSEGMT,           00300000
*        MVPOS/STPOS, AND PTEXT. IT IS ALSO ENTERED BY ORGEN TO         00400000
*        SUPPLY WORK OACBS EVEN FOR A NON-UPDATE SITUATION.             00500000
*             THE UPDATE PARMLIST IS IDENTICAL TO THE DATAGEN           00600000
*        PARMLIST THESE ROUTINES USE.   REGISTER 1 WILL POINT TO        00700000
*        THE AREA DESCRIBED BELOW.                                      00800000
*                                                                       00900000
*                                                                       01000000
*                             +0   KEY                                  01100000
*                             +4   3F  IGNORED                          01200000
*                             +16  A(GDS)                               01300000
*                             +20  A(RTN ARRAY)                         01400000
*                             +24  11F IGNORED                          01500000
*                             +68  WORK AREA(30 WDS LONG)   D11         01600000
*                                                                       01700000
*                                                                       01800000
*        ENTRY POINTS:  IFFAHA13-TO OBTAIN THE GDOAS AND OACBS          01900000
*        FOR THE UPDATE.                                                02000000
*        IFFAHA14-TO WRITE OUT THE GDOAS ON A SUCCESSFUL UPDATE.        02100000
*        FOR AN UNSUCCESSFUL UPDATE, DATA STORE WILL FREE THE           02200000
*        STORAGE OBTAINED AND THIS ENTRY POINT WILL NEVER BE            02300000
*        CALLED.                                                        02400000
*                                                                       02500000
*        EXTERNAL MACROS:          EXTERNAL ROUTINES:                   02600000
*        GETMAIN                   DATASTORE (IFFAHA05)                 02700000
*        WAIT                                                           02800000
*        GWRITE                                                         02900000
*        GCNTRL                                                         03000000
*        FREEMAIN                                                       03100000
*                                                                       03200000
*        NOTE: ORGEN WILL USE THE UPDATE MODULE TO CREATE GDOAS         03300000
*        AND OACBS FOR ITS WORK AREA EVEN THUUGH ORGEN IS NOT BEING     03400000
*        UPDATED. IT WILL EXIT BEFORE ANY BUFFER ADDRESSES ARE          03500000
*        COMPUTED.                                                      03600000
*                                                                       03700000
         EJECT                                                          03800000
*                                                                       03900000
*        ON ENTRY THE REGISTERS ARE SAVED, THE BASE REGISTER IS         04000000
*        ESTABLISHED, THE WORK AREA DSECT IS ESTABLISHED, THE           04100000
*        GDSCB DSECT IS ESTABLISHED, AND THE GTMCB DSECT IS             04200000
*        ESTABLISHED, THE SAVE AREAS ARE CHAINED AND THE RETURN         04300000
*        ARRAY ADDRESS IS PLACED IN A REGISTER.                         04400000
*A806000                                                 1046,1557,1676 04500000
*A694000-696000                                                  A43072 04600000
*A152000-174000,816000                                       LD YA00808 04700000
*A474000                                                     LD YA00807 04800000
*A778000                                                    D11 ZA08043 04900000
*A726500-727000,742100-743960,818100-818400,926200-927000   D11 ZA11418 05000000
*A434600-435200,A454600-455200,C45600,45800,A480800-481600, D11 ZA10053 05100000
*C526000,A526600-527200,A85700                              D11 OZ10053 05200000
*A100010,A100030-100100,C102000,C580000-584000              D11 OZ15418 05300000
         EJECT                                              D11         05400000
IFFAHA13 CSECT                     EP FOR IFFAHA13                      05500000
         USING *,REGFIFTN                                   D11 ZA15418 05600000
         SAVE  (14,12)                                                  05700000
         B     STARTH13                                     D11 ZA15418 05800000
         DROP  REGFIFTN                                     D11 ZA15418 05900000
         ENTRY IFFAHA14                                     D11 ZA15418 06000000
IFFAHA14 DS    0H                  EP FOR IFFAHA14          D11 ZA15418 06100000
         USING *,REGFIFTN                                   D11 ZA15418 06200000
         SAVE  (14,12)                                      D11 ZA15418 06300000
         B     STARTH14                                     D11 ZA15418 06400000
         DROP  REGFIFTN                                     D11 ZA15418 06500000
STARTH13 BALR  BASE,0              STARTS HERE              D11 ZA15418 06600000
         USING *,BASE                                                   06700000
         LR    WORK,PARM                                                06800000
         USING WORKAREA,WORK       WORKAREA                             06900000
         L     GDSREG,WRKGDS                                            07000000
         USING GDSCB,GDSREG        GDSCB                                07100000
         L     GTMREG,GDSGTMCB     GTMCB                                07200000
         USING GTMCB,GTMREG                                             07300000
         LA    REGA,WRKSAVE        CHAIN SAVE AREAS                     07400000
         ST    REGA,8(SAVE)                                             07500000
         ST    SAVE,4(REGA)                                             07600000
         LR    SAVE,REGA                                                07700000
         L     ERRCD,WRKRTN        RETURN ARRAY                         07800000
         EJECT                                                          07900000
*                                                                       08000000
*        THE LENGTH OF THE GDOAS AND ASSOCIATED OACBS IS COMPUTED       08100000
*        AND STORAGE IS OBTAINED FOR THEM. IF STORAGE IS NOT            08200000
*        AVAILABLE, AN ERROR CODE IS PLACED IN THE RETURN ARRAY         08300000
*        AND CONTROL IS RETURNED TO THE CALLING PROGRAM.                08400000
         LH    REGC,WRKADDR        LOG LENGTH AND                       08500000
         LH    REGA,WRKADDR+2      LOG ADDR FROM KEYTAB                 08600000
         SRDA  REGA,32             IN ODD REG                           08700000
         LH    REGD,GDSGDOAL       GDOA LEN                             08800000
         S     REGD,SIX            GDOA LEN - 6                         08900000
         DR    REGA,REGD           CT IN REGB, REM IN REGA              09000000
         CLI   WAORFLGS(WORK),X'FC'     ORGEN CALL?          LD YA00808 09100000
         BNE   UPD00050            NO, BRANCH AROUND         LD YA00808 09200000
         LTR   REGA,REGA           ZERO REMAINDER?           LD YA00808 09300000
         BNZ   UPD00050            IF NO, PREVIOUS ELEMENT...LD YA00808 09400000
*                                  ...SIZE IS GIVEN BY...    LD YA00808 09500000
*                                  ...THE REMAINDER          LD YA00808 09600000
         LR    REGA,REGD           IF YES,GDOALEN-6......    LD YA00808 09700000
*                                  ...BECOMES PREVIOUS...    LD YA00808 09800000
*                                  ...ELEMENT SIZE           LD YA00808 09900000
         BCTR  REGB,0              DECREMENT COUNT           LD YA00808 10000000
* THE ADDITION OF (GDOALEN-6) IS BALANCED BY DECREMENTING   D11         10100000
* THE COUNT OF SECTIONS IN REGB.                            D11         10200000
UPD00050 EQU   *                                             LD YA00808 10300000
         ST    REGB,WRKSPACE       SAVE BCT COUNT            LD YA00808 10400000
         LA    REGE,ONE            ASSUME 1 GDOA IS ENOUGH              10500000
         LR    REGB,REGD           INIT.AVAIL LEN IN GDOA               10600000
         SR    REGB,REGA   - PREV ELEM LEN = CURR AVAIL LEN             10700000
         CR    REGC,REGB  THIS ELEM LEN LT CURR AVAIL LEN??             10800000
         BNH   UPD00200            YES,ONLY 1 GDOA NEEDED               10900000
         SR    REGC,REGB NO,SUB FROM THIS ELEMLEN 1GDOA  1046,1557,1676 11000000
UPD00100 LA    REGE,ONE(REGE)      ADD ONE GDOA TO RQMNT                11100000
         CR    REGC,REGD DOES REMNDR OF LOGLEN FIT IN THIS GDOA?        11200000
         BNH   UPD00200            YES,GO GET NUMBER OF GDOAS NEEDED    11300000
         SR    REGC,REGD  NO,DECR LOGLEN RMNDR BY A GDOALEN             11400000
         B     UPD00100            AND TRY AGAIN                        11500000
         EJECT                                                          11600000
UPD00200 LH    REGD,GDSGDOAL  LEN OF EACH GDOA                          11700000
         A     REGD,OACBLEN   + LENGTH OF ITS OACB=TOT LEN FOR EACH     11800000
         L     REGB,WRKSPACE SAVE BFR CONT TABLE COUNT ACROSS GETMN     11900000
         MR    REGC,REGE     LEN PER EACH * NUMBER NEEDED               12000000
         GETMAIN EC,LV=(REGD),A=WRKSPACE+12,SP=0,MF=(E,WRKSPACE)        12100000
         LTR   REGFIFTN,REGFIFTN   CORE AVAIL?                          12200000
         BNE   ERR1                NO,ERROR                             12300000
*                                                                       12400000
*        THE OACB SET UP IS ONE WORD LONGER THAN THE OACB FOR           12500000
*        REGULAR GENERATION. THE START OF THE GETMAIN AREA              12600000
*        AND ITS LENGTH REPLACE CPU1 AND BUF1 RESPECTIVELY OF           12700000
*        THE ORIGINAL OACB.  THIS IS POSSIBLE BECAUSE UPDATE            12800000
*        TAKES PLACE ON AN ELEMENT ONLY, NOT AN A SEQUENCE OR           12900000
*        SUBROUTINE AND THERE CAN BE ONLY ONE UNRESOLVED ADDRESS        13000000
*        AT ANY ONE TIME. THE ADDRESSES ARE RESOLVED ON A LAST          13100000
*        IN FIRST OUT METHOD AND THEY ARE PLACED IN THE OACB            13200000
*        IN THE ONE THAT IS SET TO ZERO. THEREFORE, WHEN                13300000
*        DATA STORE LOOKS AT THE CPU1, BUF1 LOCATIONS AND FINDS         13400000
*        THEM NON ZERO IT WILL PLACE THE UNRESOLVED ADDRESS AT          13500000
*        CPU2, BUF2 WHICH IS EQUAL TO ZERO. WEHN DATA STORE             13600000
*        IS READY TO RESOLVE THE ADDRESS IT WILL RESOLVE CPU2,          13700000
*        BUF2, FIRST.  THE STATUS IN THE OACB IS SET TO X'20'.          13800000
*                                                                       13900000
         ST    REGB,WRKSPACE       RESTORE BCT COUNT                    14000000
         L     REGC,WRKSPACE+12    ADDR OF AREA                         14100000
         USING OACBAREA,REGC                                            14200000
         ST    REGD,LENGTH         LENGTH OF GETMAIN                    14300000
         ST    REGC,FIRST          START OF GETMAIN                     14400000
         XC    CPU2(8),CPU2        CPU AND BUF UNRES=0                  14500000
         XC    STATUS,STATUS       STATUS=0                             14600000
         OI    STATUS,UPDT         SET UPDATE SW                        14700000
         EJECT                                                          14800000
*                                                                       14900000
*        THE ADDRESS OF THE ORIGINAL OACB IS PLACED IN THE UPDATE       15000000
*        OACB. THE CRSA AND OLP ARE POSITIONED IN THE GDOA TO WHERE     15100000
*        THE ELEMENT STARTS. THE BUFLEN FIELD OF THIS OACB IS SET       15200000
*        TO THE LENGTH LEFT IN THE GDOA LESS TWO OF THE SIX CONTROL     15300000
*        THE LENGTH LEFT (LENLEFT) IS SET TO THE LENGTH LEFT IN THE     15400000
*        GDOA LESS SIX CONTROL BYTES. IF THE LENGTH LEFT IS GREATER     15500000
*        THAN THE LENGTH REQUIRED FOR THE UPDATE, LENLEFT AND BUF-      15600000
*        LEN ARE MODIFIED TO THE ACTUAL LENGTH REQUIRED FOR THE         15700000
*        UPDATE.                                                        15800000
         MVC   ORIG,GDSAOACB       SAVE ADDR OF ORIG OACB               15900000
         LA    REGD,64(REGC)       ADDR OF GDOA (WHICH FOLLOWS OACB)    16000000
         ST    REGD,GDOA           SAVE IN OACB POINTER                 16100000
         AR    REGD,REGA           ADD PREVIOUS ELEMENT LENGTH          16200000
         LA    REGD,2(REGD)        AND 2 FOR INITIAL MODESET            16300000
         ST    REGD,CRSA           GIVING CURR RTN ST ADDR,             16400000
         ST    REGD,OLP            AND (INITIALLY) ORDER LOAD PT.       16500000
         LH    REGD,GDSGDOAL       GDOALEN FROM GDS                     16600000
         S     REGD,TWO            LESS TWO FOR INITIAL MODESET         16700000
         SR    REGD,REGA           LESS PREV ELEM LEN(LENLEFT IN GDOA)  16800000
         ST    REGD,BUFLEN         GIVES BUFFER LENGTH                  16900000
         S     REGD,FOUR           LESS 4 FOR OVFLOW BR(END OF GDOA)    17000000
*   GIVES BUFFER LENGTH (UNLESS LEN REQUIRED IS LESS).                  17100000
         CH    REGD,WRKADDR        IS LENGTH LEFT GR THAN LEN REQD      17200000
         BNL   UPD00400            YES,WILL NEED ONLY 1 OACB/GDOA       17300000
         ST    REGD,LENLEFT        ELSE SAVE ABOVE BUFLEN-4=LENLEFT     17400000
*                                                                       17500000
*  FOR THE ABOVE, PREVIOUS ELEMENT LENGTH IN REGA CAN BE EITHER A       17600000
*  TRUE PREV ELEM. LEN.; OR IF AN ELEMENT'S LOGSTART ADDR IS AN         17700000
*  EXACT MULTIPLE OF (GDOALEN-6), PREV ELEM LEN IS SET TO THE VALUE     17800000
*  OF (GDOALEN-1).(BFR CONTR TBL SECT NUM.IS ALSO DECRMNTD).            17900000
*                                                                       18000000
         LH    REGE,WRKADDR        NXT ROUTINE NEEDS LOGLEN  THIS ELEM. 18100000
         EJECT                                                          18200000
*                                                                       18300000
*        IF ANY MORE OACB/DGOAS ARE REQUIRED, THE FIRST IS DUPLICATED   18400000
*        INTO THE NEXT. THE GDOA, CRSA, AND OLP ARE SET UP TO POINT     18500000
*        TO THE GDOA ADDRESS.  THE GDOAS AND OACBS ARE CYCLED THROUGH   18600000
*        UNTIL THE LAST ONE IS REACHED. ON THE LAST ONE THE LENGTH      18700000
*        LEFT AND BUFFER LENGTH ARE MODIFIED SO THAT THEY WILL          18800000
*        REFLECT THE SHORTENED GDOA.                                    18900000
*                                                                       19000000
UPD00300 SR    REGE,REGD LOGLEN-LENLEFT(THIS ELEM)=LEN REMNG TO DO      19100000
         L     REGD,OACBLEN        OACBLEN PLUS                         19200000
         AH    REGD,GDSGDOAL       GDOALEN PLUS                         19300000
         AR    REGD,REGC           THIS OACB = NEXT OACB                19400000
         ST    REGD,OTHER          PUT NXTOACB ON CHAIN                 19500000
         MVC   0(64,REGD),0(REGC)  DUP OACB CONTENT (OLD TO NEW)        19600000
         LR    REGC,REGD           ADDR NEW OACB W USING REG            19700000
         LA    REGD,64(REGC)       POINT TO GDOA                        19800000
         ST    REGD,CRSA           INIT CRSA,                           19900000
         ST    REGD,GDOA           GDOA,                                20000000
         ST    REGD,OLP            AND OLP.                             20100000
         LH    REGD,GDSGDOAL       IS (GDOALENGTH                       20200000
         S     REGD,SIX            LESS 6) LESS THAN ELEM LENGTH?       20300000
         CR    REGD,REGE           IF SO,THERE IS ANOTHER BLOCK TO DO   20400000
         BNL   UPD00350            NO,LAST BLOCK (OACB/GDOA) FINISHED   20500000
         ST    REGD,BUFLEN         ELSE GDOALEN-6=BUFLEN                20600000
         ST    REGD,LENLEFT        AND LEN LEFT                         20700000
         B     UPD00300            AND GO DO NEXT BLOCK (OACB/GDOA).    20800000
UPD00350 ST    REGE,LENLEFT   LENLEFT (LASTOACB) = ELEM LEN             20900000
         LA    REGE,2(REGE)        RESET LENGTH TO GO IN BUFLEN         21000000
         B     UPD00500                                                 21100000
UPD00400 LH    REGE,WRKADDR        LENGTH                               21200000
         ST    REGE,LENLEFT        &LENLEFT                             21300000
         EJECT                                                          21400000
UPD00500 ST    REGE,BUFLEN         IN BUFLEN                            21500000
         MVC   OTHER,ZERO          ZERO OTHER IN LAST OACB              21600000
         L     REGC,WRKSPACE+12    START OF UPD OACB CHAIN              21700000
         ST    REGC,GDSAOACB       ADDRESS OF TEMP OACB IN GDSCB        21800000
         LH    REGD,WRKADDR+2      ELEMENT LOG START ADDRESS            21900000
         ST    REGD,LOGSTRT        IS LOG START                         22000000
         ST    REGD,LOGCURR        AND LOGCURR                          22100000
         L     REGB,ORIG           POINT BACK TO THE ORIGINAL OACB      22200000
*                                                                       22300000
*        AT THIS POINT THE PHYSICAL BUFFER ADDRESSES FOR THESE          22400000
*        OACBS AND GDOAS MUST BE COMPUTED. FIRST THE START OF           22500000
*        THE CHAIN OF OACBS IS PLACED IN THE GDSAOACB LOCATION          22600000
*        IN THE GDSCB. THE LOGICAL ADDRESS OF THE KEY IS                22700000
*        PLACED IN THE LOGICAL START AND LOGICAL CURRENT LOCATION       22800000
*        IN THE FIRST OACB. THE OTHER LOGICAL ADDRESSES FOR             22900000
*        THE SUCCEEDING GDOAS WILL BE PLACED THERE BY DATA STORE.       23000000
*        THE PHYSICAL BUFFER ADDRESSES ARE COMPUTED USING THE           23100000
*        LOGICAL START ADDRESS AND THE BUFFER CONTROL TABLE.            23200000
*        CONTROL IS THEN RETURNED TO THE CALLING PROGRAM.               23300000
         CLC   CURLOG+2(2,REGB),WRKADDR+2                               23400000
         BE    UPD00850            ORGEN ENTRY RETURN NOW               23500000
         L     REGB,GTMBCTBL       BFR CNTRL TABLE ADDRESS              23600000
         LH    REGD,GDSBCTEL       DISP FOR FIRST ENTRY                 23700000
         MH    REGD,F3+2           INDEX INTO TABLE                     23800000
         CLC   GDSGDOAL,SUBSEG     THIS A SUBSEGMENT ?                  23900000
         BE    UPD00700            YES,BRANCH                           24000000
         SR    REGE,REGE           CLEAR FOR IC                         24100000
UPD00600 IC    REGE,2(REGB,REGD)   GET ASSIGNMENT NUM OF THIS SECTION   24200000
         CLC   WRKSPACE,MINUS1     ORIG LOGSTRT=0?          D11 OZ10053 24300000
         BE    UPD01000            YES,FIRST SECTION GOOD   D11 OZ10053 24400000
         C     REGE,WRKSPACE       FIRST FOUND(ASSGN NUM=WRKSPACE)?     24500000
         BE    UPD01000            YES,BR                               24600000
         IC    REGE,1(REGB,REGD)   PICK UP PTR TO NEXT BCT ENTRY        24700000
         MH    REGE,F3+2           EACH ENTRY IS THREE LONG             24800000
         CR    REGE,REGD           ANY MORE ON CHAIN?                   24900000
         BE    ERR2                NO-BAD KEY                           25000000
         LR    REGD,REGE           NEW TABLE DISP                       25100000
         SR    REGE,REGE           CLEAR FOR IC                         25200000
         B     UPD00600            LOOK FOR NEXT                        25300000
UPD00700 CLC   WRKSPACE,ZERO       IF CT NOT ZERO THEN                  25400000
         BE    UPD00750            CAN BE ONLY ONE SUBSEG   D11 ZA10053 25500000
         CLC   WRKSPACE,MINUS1     BUT IT MAY BE LOGSTRT=0  D11 ZA10053 25600000
         BNE   ERR2                NO-BADKEY                            25700000
UPD00750 AR    REGB,REGD           POINT TO GOOD ENTRY      D11 ZA10053 25800000
         M     REGC,F256           CONVERT-LEAVING                      25900000
         D     REGC,F3             BUFFER ADDR IN REGD                  26000000
         CLC   0(1,REGB),GDSBCTID  IN FIRST HALF                        26100000
         BE    UPD00800            YES                                  26200000
         AH    REGD,SUBSEG         POSIT TO SECOND SUBSEG               26300000
         EJECT                                                          26400000
UPD00800 AR    REGD,REGA                                                26500000
         A     REGD,TWO                                      LD YA00807 26600000
         L     REGC,WRKSPACE+12    ADDR OF 1ST WORK OACB                26700000
         ST    REGD,BUFSTART       PLACE ADDR IN BUFFER START           26800000
         CLC   OTHER,ZERO          MORE THAN 1 GDOA                     26900000
         BE    UPD00825            NO,GO  STORE BLP         D11 ZA10053 27000000
         CLC   WRKSPACE,MINUS1     YES, MAY BE A LOGSTRT=0  D11 ZA10053 27100000
         BNE   ERR2                NO,BAD KEY                           27200000
UPD00825 ST    REGD,BLP            PLACE ADDR IN BLP                    27300000
UPD00850 SR    REGFIFTN,REGFIFTN   SET TO GOOD RETURN                   27400000
UPD00900 L     SAVE,4(SAVE)        COME HERE IF R15 SET                 27500000
         RETURN (14,12),T,RC=(15)                                       27600000
UPD01000 LR    REGE,REGD           SAVE DISP                            27700000
         M     REGC,F256           MX256                                27800000
         D     REGC,F3             D3                                   27900000
         AR    REGD,REGA           ADD DISP FROM TOP                    28000000
         A     REGD,TWO                                                 28100000
         L     REGA,WRKSPACE+12    ADDR OF 1ST WORK OACB                28200000
         DROP  REGC                                                     28300000
         USING OACBAREA,REGA       ADDRESS 1ST WORK OACB                28400000
UPD01100 ST    REGD,BUFSTART       SAVE BUFFER START                    28500000
         ST    REGD,BLP            BLP                                  28600000
         SR    REGD,REGD           ZERO REG                             28700000
         CLC   OTHER,ZERO          ANOTHER                              28800000
         BE    UPD00850            NO,DONE                              28900000
         L     REGA,OTHER          GO TO NEXT                           29000000
         IC    REGD,1(REGE,REGB)   DISP                                 29100000
         MH    REGD,F3+2           EACH BCT ENTRY IS 3 LONG             29200000
         CR    REGD,REGE           MORE SEGMENTS                        29300000
         BNE   UPD01125            YES,DO NEXT SECTION      D11 OZ10053 29400000
         CLC   WRKSPACE,MINUS1     WAS ELEMENT LOGSTRT=0?   D11 OZ10053 29500000
         BNE   ERR2                NO,TRUE LOGIC ERROR      D11 OZ10053 29600000
UPD01125 LR    REGE,REGD           SAVE                                 29700000
         M     REGC,F256           COMPUTE BUFFER ADDR                  29800000
         D     REGC,F3             EACH BCT ENTRY 3 LONG                29900000
         B     UPD01100                                                 30000000
         EJECT                                                          30100000
ERR1     MVI   CODE(ERRCD),NOCORE  INDICATE CORE EXHAUSTED              30200000
         MVC   STRG(4,ERRCD),FOUR                                       30300000
         L     REGFIFTN,FOUR                                            30400000
         B     UPD00900                                                 30500000
ERR2     MVI   CODE(ERRCD),PARMERR INVALID KEY/CORVAL OR BAD GENCODE    30600000
         MVC   PRM(4,ERRCD),ZERO                                        30700000
         L     REGFIFTN,FOUR                                            30800000
         L     REGA,GDSAOACB       GET TEMP AREA                        30900000
         MVC   GDSAOACB,ORIG       REPLACE ADDR OF ORIGINAL             31000000
         L     PARM,FIRST          ADDR OF GETMAIN                      31100000
         L     REGZERO,LENGTH      LENGTH FOR FREEMAIN                  31200000
         FREEMAIN R,LV=(0),A=(1)   FREE STORAGE                         31300000
         B     UPD00900                                                 31400000
         DC    C'ZAP PATCH AREA, 40 BYTES'                              31500000
         DS    0H                  LINEUP PATCH             D11         31600000
PATCH13  DC    40X'FF'             PATCH AREA FOR IFFAHA13  D11         31700000
         EJECT                                                          31800000
         DROP  REGA                                                     31900000
         DROP  BASE                                                     32000000
         EJECT                                                          32100000
*                                                                       32200000
*        ENTRY AT IFFAHA14 IS MADE TO WRITE OUT A SUCCESSFUL            32300000
*        UPDATE. THE STANDARD INITIALIZATION TAKES PLACE FIRST.         32400000
*                                                           D11 ZA15418 32500000
*                                                           D11 ZA15418 32600000
STARTH14 BALR  BASE,0              STARTS HERE              D11 ZA15418 32700000
         USING *,BASE                                                   32800000
         LR    WORK,PARM           WORK AREA                            32900000
         L     GDSREG,WRKGDS       GDSCB                                33000000
         LA    REGA,WRKSAVE        SAVE AREA CHAINING                   33100000
         ST    REGA,8(SAVE)                                             33200000
         ST    SAVE,4(REGA)                                             33300000
         LR    SAVE,REGA           SET UP MY SAVE AREA                  33400000
         L     GTMREG,GDSGTMCB     GTMCB                                33500000
         USING OACBAREA,REGC                                            33600000
         L     REGC,GDSAOACB       OACB FOR UPDATE                      33700000
*                                                                       33800000
*        THE LAST GDOA/OACB ON THE CHAIN IS LOCATED AND IF THE          33900000
*        UPDATE DID NOT COMPLETELY FILL THE PREVIOUS AREA A             34000000
*        FILL IN WILL TAKE PLACE. IF ONLY TWO BYTES ARE LEFT            34100000
*        A GNOP IS PLACED IN TNE TWO BYTES. OTHERWISE A GTRU            34200000
*        TO THE END OF THE SEGMENT IS PLACED IN THE GDPA WHERE          34300000
*        GENERATION COMPLETED.                                          34400000
         L     REGA,OLP            ORDER LOAD PT                        34500000
         L     REGB,LENLEFT        LENGTH LEFT                          34600000
         C     REGB,FOUR           GREATER THAN OR EQ 4?                34700000
         BL    UPD01300            NO                                   34800000
UPD01150 CLC   OTHER,ZERO          GO TO LAST OACB-FOUND                34900000
         BE    UPD01400            YES                                  35000000
         L     REGC,OTHER          GET NEXT                             35100000
         B     UPD01150                                                 35200000
UPD01160 L     REGC,FIRST          LOAD FIRST ONE                       35300000
         MVC   GDSAOACB,ORIG       RESET REGULAR OACB                   35400000
         TM    GDSFLAGS,EQUIV      IS THIS AN EQUIVALENCE GDS           35500000
         BO    UPD01600            YES MODIFY IN CORE COPY              35600000
         EJECT                                                          35700000
*                                                                       35800000
*        UPDATE I/O CANNOT BE OVERLAPPED SO ANOTHER DECB IS CREATED     35900000
*                                                                       36000000
*                                                                       36100000
*        THE FIRST OACB/GDOA IS LOCATED AND THEY ARE ALL WRITEEN        36200000
*        OUT TO THE BUFFER. AFTER THEY ARE WRITTEN, A GCNTRL            36300000
*        MACRO IS ISSUED TO RESTART REGENERATION.                       36400000
UPD01170 XC    WRKDECB(32),WRKDECB ZERO DECB                            36500000
         L     REGA,GTMGRDCB       DCB ADDR                             36600000
UPD01200 LA    PARM,WRKDECB                                             36700000
         L     REGB,CRSA           ROUTINE START ADDR                   36800000
         MVC   WRKDECB+20(4),BUFLEN LENGTH IN DECB                      36900000
         GWRITE (PARM),BUF,(REGA),,(REGB),BUFSTART+2,MF=E               37000000
         LA    PARM,WRKDECB                                             37100000
         WAIT  ECB=(1)             WAIT                                 37200000
         CLC   OTHER,ZERO        MORE TO WRITE                          37300000
         BE    UPD01250            NO                                   37400000
         L     REGC,OTHER          NEXT ONE                             37500000
         B     UPD01200            GO WRITE THE REST                    37600000
UPD01250 LA    PARM,WRKDECB        RESTART DISPLAY                      37700000
         CLI   0(PARM),X'7F'                                            37800000
         BNE   ERR3                                                     37900000
         NI    0(PARM),X'BF'                                            38000000
         GCNTRL (PARM),STR,(REGA),GDSFCBUF,MF=E                         38100000
         LA    PARM,WRKDECB                                      A43072 38200000
         WAIT  ECB=(1)                                           A43072 38300000
*                                                                       38400000
*        THE STORAGE OBTAINED FOR THE UPDATE IS FREED AND CONTROL       38500000
*        IS RETURNED TO THE CALLING PROGRAM.                            38600000
*                                                                       38700000
*                                                                       38800000
*                                                                       38900000
UPD01270 L     PARM,FIRST                                               39000000
         L     REGZERO,LENGTH                                           39100000
         FREEMAIN R,LV=(0),A=(1)   FREE CORE FROM UPDATE                39200000
         L     SAVE,4(SAVE)                                             39300000
         RETURN (14,12),T,RC=0                                          39400000
         EJECT                                                          39500000
UPD01300 C     REGB,TWO            TWO LEFT                             39600000
         BL    UPD01500            NO                                   39700000
         MVC   0(2,REGA),GNOP      MOVE IN NO-OP                        39800000
         A     REGA,TWO            BUMP PAST GNOP AND       D11 ZA11418 39900000
         ST    REGA,OLP            UPDATE OLP               D11 ZA11418 40000000
         B     UPD01500                                                 40100000
UPD01400 L     REGB,BUFSTART       BUFSTART                             40200000
         A     REGB,BUFLEN         + LEN IS START OF NEXT ELEM          40300000
         MVC   0(2,REGA),GTRU      MOVE IN GTRU                         40400000
         STH   REGB,2(REGA)        TO NEXT ELEM                         40500000
         B     UPD01160                                                 40600000
UPD01500 CLC   OTHER,ZERO          IS THERE ANOTHER                     40700000
         BE    UPD01160            NO                                   40800000
*                                                           D11 ZA11418 40900000
*   IF A REPOSITIONING VECTOR WAS JUST PUT OUT TO THE       D11 ZA11418 41000000
*   GDOA AND THERE IS NOT ENOUGH LENGTH REMAINING FOR THE   D11 ZA11418 41100000
*   TRANSFER ORDER,OVERFLOW MUST BE DONE AND THE TRANSFER   D11 ZA11418 41200000
*   VECTOR PUT IN THE NEXT GDOA. THIS CAN BE DONE BY        D11 ZA11418 41300000
*   CALLING DATASTORE WITH THE 'OVERFLOW ONLY' CODE.        D11 ZA11418 41400000
*                                                           D11 ZA11418 41500000
*                                                           D11 ZA11418 41600000
         CLI   GDSGRMOD,CNTRL      JUST DONE REPOS VECTOR?  D11 ZA11418 41700000
         BNE   UPD01550            NO,DONT DO OVERFLOW      D11 ZA11418 41800000
         LA    PARM,WRKGDS1        SETUP CALL TO DATASTOR   D11 ZA11418 41900000
         ST    GDSREG,WRKGDS1      GDS                      D11 ZA11418 42000000
         L     ERRCD,WRKRTN                                 D11 ZA11418 42100000
         ST    ERRCD,WRKRTN1       RTNARRAY PTR             D11 ZA11418 42200000
         XC    WRKFLGS1(4),WRKFLGS1 CLEAR FLAGS AND LENGTH  D11 ZA11418 42300000
         MVI   WRKFLGS1,OVERFLOW   INDICATE O'FLOW ONLY     D11 ZA11418 42400000
         L     REGFIFTN,STAT(,ERRCD) POINT TO STATABLE      D11 ZA11418 42500000
         L     REGFIFTN,DSTOR(,REGFIFTN) AND DATASTORE      D11 ZA11418 42600000
         BALR  RETURN,REGFIFTN     CALL HIM                 D11 ZA11418 42700000
         LTR   REGFIFTN,REGFIFTN   OVERFLOW OK?             D11 ZA11418 42800000
         BNZ   ERR4                OVERFLOW ERROR           D11 ZA11418 42900000
UPD01550 CLC   OTHER,ZERO          IS THERE ANOTHER OACB?   D11 ZA11418 43000000
         BE    UPD01160            NO                       D11 ZA11418 43100000
         L     REGC,OTHER          GET NEXT                             43200000
         L     REGA,OLP            GET ORDER LOAD POINT                 43300000
         B     UPD01150            GO BUILD TRANS ORDER                 43400000
UPD01600 L     REGA,BUFSTART       START ADDR IN BUFFER                 43500000
         L     REGB,CRSA           AND IN CORE FOR UPDATE               43600000
         LR    REGE,REGC           SAVE FIRST UPD OACB PTR              43700000
         L     REGD,BUFLEN             LENGTH OF UPDATE                 43800000
         L     REGC,GDSAOACB       STORAGE COPY IN REG OACB             43900000
         S     REGA,BUFSTART       DISP IN REG OACB OF UPDATE           44000000
         A     REGA,CRSA                                                44100000
         BCTR  REGD,0              LENGTH FOR MOVE                      44200000
         EX    REGD,MOVE           MOVE UPDATE IN                       44300000
         LR    REGC,REGE           RESTORE FIRST UPD OACB PTR           44400000
         TM    GDSFLAGS,INBUF      IS THIS EQUIV IN BUFFER              44500000
         BO    UPD01170            YES WRITE OUT UPDATE                 44600000
         B     UPD01270            NO FREE STORAGE AND EXIT             44700000
ERR3     L     ERRCD,WRKRTN                                             44800000
         OI    0(ERRCD),IO                                              44900000
ERR4     L     SAVE,4(,SAVE)       REPOINT TO CALLER SA     D11 ZA08043 45000000
         RETURN (14,12),RC=4                                            45100000
         EJECT                                                          45200000
REGZERO  EQU   0                                                        45300000
PARM     EQU   1                                                        45400000
REGA     EQU   2                                                        45500000
REGB     EQU   3                                                        45600000
REGE     EQU   4                                                        45700000
WORK     EQU   5                                                        45800000
ERRCD    EQU   6                                                        45900000
GTMREG   EQU   7                                                        46000000
GDSREG   EQU   8                                                        46100000
BASE     EQU   9                                                        46200000
REGC     EQU   10                                                       46300000
REGD     EQU   11                                                       46400000
SAVE     EQU   13                                                       46500000
RETURN   EQU   14                                                       46600000
REGFIFTN EQU   15                                                       46700000
         EJECT                                                          46800000
WAORFLGS EQU   44                  ORGEN CALL                LD YA00808 46900000
CNTRL    EQU   0                   CONTROL MODE             D11 ZA11418 47000000
OVERFLOW EQU   X'20'               CODE FOR DATASTORE       D11 ZA11418 47100000
STAT     EQU   24                  STATBL DSPLCMNT          D11 ZA11418 47200000
DSTOR    EQU   852                 DSTOR IN STATBL          D11 ZA11418 47300000
PRM      EQU   16                                                       47400000
IO       EQU   X'04'                                                    47500000
PARMERR  EQU   X'08'                                                    47600000
SUBSEG   DC    H'128'                                                   47700000
F256     DC    F'256'                                                   47800000
F3       DC    F'3'                                                     47900000
         DC    C'40 BYTE PATCH AREA FOLLOWS'                            48000000
         DS    0H     ITS NICE WHEN PATCH DOESNT GIVE 0C6!! D11         48100000
PATCH14  DC    40X'FF'             PATCH AREA FOR IFFAHA14  D11         48200000
CODE     EQU   0                                                        48300000
NOCORE   EQU   X'10'                                                    48400000
STRG     EQU   12                                                       48500000
OACBLEN  DC    F'64'                                                    48600000
UPDT     EQU   X'20'                                                    48700000
CURLOG   EQU   52                                                       48800000
ONE      EQU   1                                                        48900000
SIX      DC    F'6'                                                     49000000
FOUR     DC    F'4'                                                     49100000
ZERO     DC    F'0'                                                     49200000
TWO      DC    F'2'                                                     49300000
MINUS1   DC    F'-1'               TO CHECK LOGSTRT=0 COND. D11 ZA10053 49400000
EQUIV    EQU   X'08'                                                    49500000
INBUF    EQU   X'80'                                                    49600000
MOVE     MVC   0(1,REGA),0(REGB)                                        49700000
         EJECT                                                          49800000
         GINIT                                                          49900000
GNOP     GNOP2                                                          50000000
GTRU     GTRU  0                                                        50100000
         EJECT                                                          50200000
OACBAREA DSECT                                                          50300000
OTHER    DS    F                                                        50400000
GDOA     DS    F                                                        50500000
STATUS   DS    F                                                        50600000
CRSA     DS    F                                                        50700000
OLP      DS    F                                                        50800000
BLP      DS    F                                                        50900000
BUFSTART DS    F                                                        51000000
BUFLEN   DS    F                                                        51100000
FIRST    DS    F                                                        51200000
LENGTH   DS    F                                                        51300000
CPU2     DS    F                                                        51400000
BUF2     DS    F                                                        51500000
LOGSTRT  DS    F                                                        51600000
LOGCURR  DS    F                                                        51700000
LENLEFT  DS    F                                                        51800000
ORIG     DS    F                                                        51900000
         EJECT                                                          52000000
WORKAREA DSECT                     INP PARMLIST MAPPED HERE             52100000
WRKADDR  DS    F                   KEY                                  52200000
WRKSKIP1 DS    3F                  IGNORED                              52300000
WRKGDS   DS    F                   A(GDS)                               52400000
WRKRTN   DS    F                   A(RTN ARRAY)                         52500000
WRKSKIP2 DS    11F                 IGNORED                              52600000
WRKSPACE DS    4F                  WORKAREA                             52700000
WRKSAVE  DS    18F                                                      52800000
WRKDECB  DS    8F                                                       52900000
*        PARMLIST TO DATASTORE FOLLOWS                      D11 ZA11418 53000000
WRKGDS1  DS    F                   GDS                      D11 ZA11418 53100000
WRKRTN1  DS    F                   RTNARRAY PTR             D11 ZA11418 53200000
WRKFLGS1 DS    H                   FLAGS                    D11 ZA11418 53300000
WRKLEN1  DS    H                   LENGTH                   D11 ZA11418 53400000
         COPY  GDSCB                                                    53500000
         COPY  GTMCB                                                    53600000
         COPY  GSPCB                                                    53700000
         END                                                            53800000
./  ADD  SSI=20480344,NAME=IFFAHA16
         TITLE 'SYSTEM STROKE TABLE - GSP01'                            00300013
*********************************************************************** 00310013
*                                                                     * 00320013
*TITLE              SYSTEM STROKE TABLE - GSP01                       * 00330013
*                                                                     * 00340013
*MODULE NAME        IFFAHA16                                          * 00350013
*                                                                     * 00360013
*STATUS             CHANGE LEVEL 000                                  * 00370013
*                                                                     * 00380013
*FUNCTION- TO DEFINE THE EBCDIC CHARACTERS IN TERMS OF STROKES ON A   * 00390013
*  128 BY 128 MATRIX.                                                 * 00400013
*FORMAT  - 256 ADDRESS,FOLLOWED BY DEFINE CONSTANT INSTRUCTIONS       * 00410013
*  WHICH DEFINE THE CHARACTERS. ANY ADDRESS WHICH IS EQUIVALENT TO    * 00420013
*  AN EBCDIC SYMBOL POINTS TO THE STROKE DEFINITION FOR THAT SYMBOL.  * 00430013
*  THE OTHER ADDRESSES ARE ZERO. TWO WORDS ARE RESERVED AT THE        * 00440013
*  BEGINNING OF THE TABLE AND SERVE AS ID AND CHAIN FIELDS, USED BY   * 00450013
*  PLSTR AND DFSTR.                                                   * 00460013
*  THE DEFINITION OF EACH SYMBOL RESERVES 16 HALF-WORDS (=16 STROKES) * 00470013
*  SO THE TABLE MAY BE ALLTERED BY DFSTR.                             * 00480013
*FORMAT OF STROKE DEFINITION ENTRY   - ONE HALF WORD/STROKE           * 00490013
*       BYTE 0     BIT 0 = 0-STROKE IS UNBLANKED                      * 00500013
*                        = 1-STROKE IS BLANKED                        * 00510013
*                  BITS 1-7 -A VALUE FROM 0-127 DEFINING THE X        * 00520013
*                            COORDINATE ON A 128 BY 128 MATRIX        * 00530013
*                                                                     * 00540013
*       BYTE 1     BIT 0 = 0 -NOT LAST STROKE IN DEFINITION OF SYMBOL * 00550013
*                        = 1 -LAST STROKE IN DEFINITION OF SYSTEM     * 00560013
*                  BITS 1-7  -A VALUE FROM 0-127 DEFINING THE Y       * 00570013
*                             COORDINATE ON A 128 BY 128 MATRIX       * 00580013
*                                                                     * 00590013
*ENTRY POINT  -    GSP01                                              * 00600013
*                                                                     * 00610013
*ATTRIBUTES   -    NEITHER REUSABLE NOR REENTRANT, ONLY LOADABLE      * 00620013
*                                                                     * 00630013
*                                                                     * 00640013
*********************************************************************** 00650013
         EJECT                                                          00660013
IFFAHA16 CSECT                                                          00670013
         ENTRY GSP01                                                    00900013
GSP01    DS    F                       WORD FOR STROKE TABLE ID         01200013
         DS    F                       WORD FOR CHAIN FIELD             01500013
ADDR     DC    256F'0'                                                  01800013
         ORG   ADDR+C'A'*4              A                               02100013
         DC    A(CODEA)                                                 02400013
         ORG   ADDR+C'B'*4              B                               02700013
         DC    A(CODEB)                                                 03000013
         ORG   ADDR+C'C'*4              C                               03300013
         DC    A(CODEC)                                                 03600013
         ORG   ADDR+C'D'*4              D                               03900013
         DC    A(CODED)                                                 04200013
         ORG   ADDR+C'E'*4              E                               04500013
         DC    A(CODEE)                                                 04800013
         ORG   ADDR+C'F'*4              F                               05100013
         DC    A(CODEF)                                                 05400013
         ORG   ADDR+C'G'*4              G                               05700013
         DC    A(CODEG)                                                 06000013
         ORG   ADDR+C'H'*4              H                               06300013
         DC    A(CODEH)                                                 06600013
         ORG   ADDR+C'I'*4              I                               06900013
         DC    A(CODEI)                                                 07200013
         ORG   ADDR+C'J'*4              J                               07500013
         DC    A(CODEJ)                                                 07800013
         ORG   ADDR+C'K'*4              K                               08100013
         DC    A(CODEK)                                                 08400013
         ORG   ADDR+C'L'*4              L                               08700013
         DC    A(CODEL)                                                 09000013
         ORG   ADDR+C'M'*4              M                               09300013
         DC    A(CODEM)                                                 09600013
         ORG   ADDR+C'N'*4              N                               09900013
         DC    A(CODEN)                                                 10200013
         ORG   ADDR+C'O'*4              O                               10500013
         DC    A(CODEO)                                                 10800013
         ORG   ADDR+C'P'*4              P                               11100013
         DC    A(CODEP)                                                 11400013
         ORG   ADDR+C'Q'*4              Q                               11700013
         DC    A(CODEQ)                                                 12000013
         ORG   ADDR+C'R'*4              R                               12300013
         DC    A(CODER)                                                 12600013
         ORG   ADDR+C'S'*4              S                               12900013
         DC    A(CODES)                                                 13200013
         ORG   ADDR+C'T'*4              T                               13500013
         DC    A(CODET)                                                 13800013
         ORG   ADDR+C'U'*4              U                               14100013
         DC    A(CODEU)                                                 14400013
         ORG   ADDR+C'V'*4              V                               14700013
         DC    A(CODEV)                                                 15000013
         ORG   ADDR+C'W'*4              W                               15300013
         DC    A(CODEW)                                                 15600013
         ORG   ADDR+C'X'*4              X                               15900013
         DC    A(CODEX)                                                 16200013
         ORG   ADDR+C'Y'*4                                              16500013
         DC    A(CODEY)                                                 16800013
         ORG   ADDR+C'Z'*4              Z                               17100013
         DC    A(CODEZ)                                                 17400013
         ORG   ADDR+C'0'*4              0                               17700013
         DC    A(CODE0)                                                 18000013
         ORG   ADDR+C'1'*4              1                               18300013
         DC    A(CODE1)                                                 18600013
         ORG   ADDR+C'2'*4              2                               18900013
         DC    A(CODE2)                                                 19200013
         ORG   ADDR+C'3'*4              3                               19500013
         DC    A(CODE3)                                                 19800013
         ORG   ADDR+C'4'*4              4                               20100013
         DC    A(CODE4)                                                 20400013
         ORG   ADDR+C'5'*4              5                               20700013
         DC    A(CODE5)                                                 21000013
         ORG   ADDR+C'6'*4              6                               21300013
         DC    A(CODE6)                                                 21600013
         ORG   ADDR+C'7'*4              7                               21900013
         DC    A(CODE7)                                                 22200013
         ORG   ADDR+C'8'*4              8                               22500013
         DC    A(CODE8)                                                 22800013
         ORG   ADDR+C'9'*4              9                               23100013
         DC    A(CODE9)                                                 23400013
         ORG   ADDR+C''*4                                             23700013
         DC    A(CODES1)                                                24000013
         ORG   ADDR+C'.'*4              .                               24300013
         DC    A(CODES2)                                                24600013
         ORG   ADDR+C'<'*4              <                               24900013
         DC    A(CODES3)                                                25200013
         ORG   ADDR+C'('*4              (                               25500013
         DC    A(CODES4)                                                25800013
         ORG   ADDR+C'+'*4              +                               26100013
         DC    A(CODES5)                                                26400013
         ORG   ADDR+C'|'*4              |                               26700013
         DC    A(CODES6)                                                27000013
         ORG   ADDR+C'&&'*4             &                               27300013
         DC    A(CODES7)                                                27600013
         ORG   ADDR+C'!'*4              B                               27900013
         DC    A(CODES8)                                                28200013
         ORG   ADDR+C'$'*4              $                               28500013
         DC    A(CODES9)                                                28800013
         ORG   ADDR+C'*'*4              *                               29100013
         DC    A(CODES10)                                               29400013
         ORG   ADDR+C')'*4              )                               29700013
         DC    A(CODES11)                                               30000013
         ORG   ADDR+C';'*4              ;                               30300013
         DC    A(CODES12)                                               30600013
         ORG   ADDR+C''*4                                             30900013
         DC    A(CODES13)                                               31200013
         ORG   ADDR+C'-'*4              -                               31500013
         DC    A(CODES14)                                               31800013
         ORG   ADDR+C'/'*4              /                               32100013
         DC    A(CODES15)                                               32400013
         ORG   ADDR+C','*4              ,                               32700013
         DC    A(CODES16)                                               33000013
         ORG   ADDR+C'%'*4              %                               33300013
         DC    A(CODES17)                                               33600013
         ORG   ADDR+C'_'*4              _                               33900013
         DC    A(CODES18)                                               34200013
         ORG   ADDR+C'>'*4              >                               34500013
         DC    A(CODES19)                                               34800013
         ORG   ADDR+C'?'*4              ?                               35100013
         DC    A(CODES20)                                               35400013
         ORG   ADDR+C':'*4              :                               35700013
         DC    A(CODES21)                                               36000013
         ORG   ADDR+C'#'*4              #                               36300013
         DC    A(CODES22)                                               36600013
         ORG   ADDR+C'@'*4              @                               36900013
         DC    A(CODES23)                                               37200013
         ORG   ADDR+C''''*4             '                               37500013
         DC    A(CODES24)                                               37800013
         ORG   ADDR+C'='*4              =                               38100013
         DC    A(CODES25)                                               38400013
         ORG   ADDR+C'"'*4              "                               38700013
         DC    A(CODES26)                                               39000013
         ORG   ADDR+C' '*4                                              39300013
         DC    A(CODES27)                                               39600013
         ORG                                                            39900013
CODEA    DC    X'900030605000403020B0'                                  40200013
         DC    11H'0'                                                   40500013
CODEB    DC    X'9000106040605050504040305020501040001000903040B0'      40800013
         DC    4H'0'                                                    41100013
CODEC    DC    X'D01040002000101010502060406050D0'                      41400013
         DC    8H'0'                                                    41700013
CODED    DC    X'9000400050105050406010601080'                          42000013
         DC    9H'0'                                                    42300013
CODEE    DC    X'D000100010605060C03010B0'                              42600013
         DC    10H'0'                                                   42900013
CODEF    DC    X'900010605060C03010B0'                                  43200013
         DC    11H'0'                                                   43500013
CODEG    DC    X'B020502050002000101010502060406050D0'                  43800013
         DC    7H'0'                                                    44100013
CODEH    DC    X'9000106090305030D0605080'                              44400013
         DC    10H'0'                                                   44700013
CODEI    DC    X'A0004000B0003060A06040E0'                              45000013
         DC    10H'0'                                                   45300013
CODEJ    DC    X'901020004000501050E0'                                  45600013
         DC    11H'0'                                                   45900013
CODEK    DC    X'90001060D06010305080'                                  46200013
         DC    11H'0'                                                   46500013
CODEL    DC    X'906010005080'                                          46800013
         DC    13H'0'                                                   47100013
CODEM    DC    X'90001060303050605080'                                  47400013
         DC    11H'0'                                                   47700013
CODEN    DC    X'90001060500050E0'                                      48000013
         DC    12H'0'                                                   48300013
CODEO    DC    X'A00040005010505040602060105010102080'                  48600013
         DC    7H'0'                                                    48900013
CODEP    DC    X'90001060406050505040403010B0'                          49200013
         DC    9H'0'                                                    49500013
CODEQ    DC    X'A00040005010505040602060105010102000D00030A0'          49800013
         DC    5H'0'                                                    50100013
CODER    DC    X'90001060406050505040403020305080'                      50400013
         DC    8H'0'                                                    50700013
CODES    DC    X'9010200040005010502040302030104010502060406050D0'      51000013
         DC    4H'0'                                                    51300013
CODET    DC    X'B0003060906050E0'                                      51600013
         DC    12H'0'                                                   51900013
CODEU    DC    X'9060101020004000501050E0'                              52200013
         DC    10H'0'                                                   52500013
CODEV    DC    X'9060300050E0'                                          52800013
         DC    13H'0'                                                   53100013
CODEW    DC    X'906020003030400050E0'                                  53400013
         DC    11H'0'                                                   53700013
CODEX    DC    X'90005060D00010E0'                                      54000013
         DC    12H'0'                                                   54300013
CODEY    DC    X'B00030305060906030B0'                                  54600013
         DC    11H'0'                                                   54900013
CODEZ    DC    X'9060506010005080'                                      55200013
         DC    12H'0'                                                   55500013
CODE0    DC    X'A00040005020504040602060104010202000B02830B8'          55800013
         DC    5H'0'                                                    56100013
CODE1    DC    X'A05030603080'                                          56400013
         DC    13H'0'                                                   56700013
CODE2    DC    X'9050206040605050504010005080'                          57000013
         DC    9H'0'                                                    57300013
CODE3    DC    X'90605060304050305010400020001090'                      57600013
         DC    8H'0'                                                    57900013
CODE4    DC    X'A05010205020C00040E0'                                  58200013
         DC    11H'0'                                                   58500013
CODE5    DC    X'9010200040005010503040401040106050E0'                  58800013
         DC    7H'0'                                                    59100013
CODE6    DC    X'D05040602060105010102000400050105020403010B0'          59400013
         DC    5H'0'                                                    59700013
CODE7    DC    X'9000506010E0'                                          60000013
         DC    13H'0'                                                   60300013
CODE8    DC    X'A040103010102000400050105030404020401050206040605050'  60600013
         DC    X'40C000000000'                                          60900013
CODE9    DC    X'901020004000501050504060206010501040203050B0'          61200013
         DC    5H'0'                                                    61500013
CODES1   DC    X'A0004050D040305020402020301050A0'                      61800013
         DC    8H'0'                                                    62100013
CODES2   DC    X'A00030104000B0003090'                                  62400013
         DC    11H'0'                                                   62700013
CODES3   DC    X'D000102050C0'                                          63000013
         DC    13H'0'                                                   63300013
CODES4   DC    X'D060305030105080'                                      63600013
         DC    12H'0'                                                   63900013
CODES5   DC    X'B0103050903050B0'                                      64200013
         DC    12H'0'                                                   64500013
CODES6   DC    X'B01030D0'                                              64800013
         DC    14H'0'                                                   65100013
CODES7   DC    X'D00020402050306040504040102010102000300050A0'          65400013
         DC    5H'0'                                                    65700013
CODES8   DC    X'A000301040002000B0204060306030A0'                      66000013
         DC    8H'0'                                                    66300013
CODES9   DC    X'9010200040005010502010301040205040505040B0603080'      66600013
         DC    4H'0'                                                    66900013
CODES10  DC    X'90105050D0101050B0103050903050B0'                      67200013
         DC    8H'0'                                                    67500013
CODES11  DC    X'90003010305010E0'                                      67800013
         DC    12H'0'                                                   68100013
CODES12  DC    X'90003010302020103010B0303040203030B0'                  68400013
         DC    7H'0'                                                    68700013
CODES13  DC    X'9030403040A0'                                          69000013
         DC    13H'0'                                                   69300013
CODES14  DC    X'903050B0'                                              69600013
         DC    14H'0'                                                   69900013
CODES15  DC    X'900050E0'                                              70200013
         DC    14H'0'                                                   70500013
CODES16  DC    X'90003010302020103090'                                  70800013
         DC    11H'0'                                                   71100013
CODES17  DC    X'90005060B0402050104020303040C03030204010502040B0'      71400013
         DC    4H'0'                                                    71700013
CODES18  DC    X'90005080'                                              72000013
         DC    14H'0'                                                   72300013
CODES19  DC    X'9000502010C0'                                          72600013
         DC    13H'0'                                                   72900013
CODES20  DC    X'905020604060505050403030300020104090'                  73200013
         DC    7H'0'                                                    73500013
CODES21  DC    X'A010301030302010A0303030304020B0'                      73800013
         DC    8H'0'                                                    74100013
CODES22  DC    X'90003060D0603000D0201020904050C0'                      74400013
         DC    8H'0'                                                    74700013
CODES23  DC    X'C010300010101030205030505030402030402030301030A0'      75000013
         DC    4H'0'                                                    75300013
CODES24  DC    X'A04030E0'                                              75600013
         DC    14H'0'                                                   75900013
CODES25  DC    X'90205020D04010C0'                                      76200013
         DC    12H'0'                                                   76500013
CODES26  DC    X'A0402060C06040C0'                                      76800013
         DC    12H'0'                                                   77100013
CODES27  DC    X'8080'                                                  77400013
         DC    15H'0'                                                   77700013
         END                                                            78000013
./  ADD  SSI=20480165,NAME=IFFAJA01
         TITLE 'ITRC-IFFAJA01-TEST RETURN CODE'                         00600013
*   FUNCTION   RETURNS GSP RETURN CODE INFORMATION TO THE CALLER.       01200013
*                                                                       01800013
*   ENTRY POINT   CSECT NAME                                            02400013
*                                                                       03000013
*   INPUT   REGISTERS AS SET BY GSP DIRECTOR                            03600013
*           PARAMETER LIST.                                             04200013
*              +0   GSPNAME                                             04800013
*              +4   CODE (INTEGER VARIABLE)                             05400013
*                 WHERE CODE 1-5 TESTS FOR A RETURN CODE GREATER        06000013
*                    THAN OR EQUAL TO CODE.                             06600013
*                 WHERE CODE 9 TESTS FOR ADDITIONAL INFORMATION.        07200013
*   OUTPUT   THE VALUE OF THE RETURN CODE OR ADDITIONAL INFORMATION     07800013
*               IS PLACED IN REGISTER 0.                                08400013
*                  NOTE: REGISTER 0 IS SAVED AND RESTORED BY THE        09000013
*                        DIRECTOR. TO MODIFY REGISTER 0, THE VALUE      09600013
*                        TO BE RETURNED IS STORED INTO THE SAVE AREA.   10200013
*   ATTRIBUTES   NON-RESIDENT, REENTRANT                                10800013
         SPACE 3                                                        11400013
IFFAJA01 CSECT                                                          12000013
D0       EQU   0                                                        12600013
D1       EQU   1                                                        13200013
D3       EQU   3                                                        13800013
D4       EQU   4                                                        14400013
D7       EQU   7                                                        15000013
D20      EQU   20                                                       15600013
D23      EQU   23                                                       16200013
HEX00    EQU   X'00'                                                    16800013
HEX01    EQU   X'01'                                                    17400013
HEX02    EQU   X'02'                                                    18000013
HEX03    EQU   X'03'                                                    18600013
HEX04    EQU   X'04'                                                    19200013
HEX05    EQU   X'05'                                                    19800013
HEX08    EQU   X'08'                                                    20400013
HEX09    EQU   X'09'                                                    21000013
HEX10    EQU   X'10'                                                    21600013
HEX20    EQU   X'20'                                                    22200013
HEX40    EQU   X'40'                                                    22800013
HEXBF    EQU   X'BF'                                                    23400013
HEXFB    EQU   X'FB'                                                    24000013
HEXF7    EQU   X'F7'                                                    24600013
HEXEF    EQU   X'EF'                                                    25200013
HEXDF    EQU   X'DF'                                                    25800013
R1       EQU   1                                                        26400013
R2       EQU   2                                                        27000013
R3       EQU   3                                                        27600013
R4       EQU   4                                                        28200013
R5       EQU   5                       POINTER TO USERS SAVE AREA       28800013
R6       EQU   6                                                        29400013
PARBSE7  EQU   7                       PARAMETER LIST BASE              30000013
R8       EQU   8                                                        30600013
BASE9    EQU   9                       CSECT BASE REG                   31200013
BASE10   EQU   10                      WKADSECT BASE REG                31800013
R11      EQU   11                                                       32400013
R12      EQU   12                                                       33000013
R13      EQU   13                                                       33600013
R14      EQU   14                                                       34200013
R15      EQU   15                                                       34800013
         SPACE 3                                                        35400013
         SAVE  (14,12)                                                  36000013
         BALR  BASE9,0                 INITIALIZE R9 AS CSECT BASE      36600013
         USING *,BASE9                                                  37200013
         USING PARLIST,PARBSE7                                          37800013
         USING WKADSECT,BASE10         ESTABLISH ADDRESSABILITY         38400013
         L     PARBSE7,D0(R1)          GET ADDR OF PARAM LIST           39000013
         LR    BASE10,R1               INITIALIZE R10 AS WORK AREA BASE 39600013
*   GET ADDRESS OF SAVE AREA OF CALLING PROGRAM                         40200013
         L     R4,D4(R13)              GET POINTER TO USERS SAVE AREA   40800013
         ST    R13,SAVE+4                                               41400013
         LA    R1,SAVE                                                  42000013
         ST    R1,8(13)                                                 42600013
         LR    R13,R1                                                   43200013
*   IS INPUT CODE 1 THRU 5                                              43800013
         L     R5,D4(BASE10)           GET ADDR OF RETURN ARRAY         44400013
         L     R3,D4(PARBSE7)          GET POINTER TO USERS CODE NUMBR  45000013
         CLI   D3(R3),HEX05            ARG ONE PARM 5 OR LESS           45600013
         BH    TESTNINE                NO-GO TEST FOR NINE              46200013
         CLI   D3(R3),HEX01            ARG1 PARAM LESS THAN 1           46800013
         BL    TESTNINE                YES-GO TEST FOR NINE             47400013
         MVI   D1(R5),HEX00            ZERO LAST CODE TESTED FIELD      48000013
*   LOCATE HIGHEST VALUE RETURN CODE FROM BYTE 0 OF RET ARRAY           48600013
         TM    D0(R5),HEX04            IS BIT 5 ON                      49200013
         BO    FIVE                    YES                              49800013
         TM    D0(R5),HEX08            IS BIT FOUR ON                   50400013
         BO    FOUR                    YES                              51000013
         TM    D0(R5),HEX10            IS BIT THREE ON                  51600013
         BO    THREE                   YES                              52200013
         TM    D0(R5),HEX20            IS BIT TWO ON                    52800013
         BO    TWO                     YES                              53400013
         TM    D0(R5),HEX40            IS BIT ONE ON                    54000013
         BC    14,ZONE                 BRANCH-NOT ONE                   54600013
         NI    D0(R5),HEXBF            RESET BIT ONE                    55200013
         MVI   TMPRCHLD,HEX01          CVT HIGHEST BIT SETTING TO VALUE 55800013
TSTCODES CLC   D3(1,R3),TMPRCHLD       TEST INPUT CODE AGAINST BIT VAL  56400013
         BC    12,STOVALUE             INP CDE LESS THAN HIGHEST RET CD 57000013
ZONE     MVC   D20(4,R4),ZERO          IF NO-ZERO USERS REG 0           57600013
ALLDONE  EQU   *                                                        58200013
         L     R13,SAVE+4                                               58800013
         RETURN (14,12),T                                               59400013
STOVALUE MVC   D20(4,R4),ZERO          ZERO USERS REG 0                 60000013
         MVC   D23(D1,R4),TMPRCHLD     STO HIGHER VALUE RET CDE IN R0   60600013
         MVC   D1(D1,R5),TMPRCHLD      AND IN BYTE 1 OF RET ARRAY       61200013
         B     ALLDONE                 RETURN                           61800013
TESTNINE CLI   D3(R3),HEX09            ARG1 PARAM EQUAL NINE            62400013
         BNE   STORENEG                NO                               63000013
*   IS THERE A LAST CODE TESTED FIELD OCCUPIED IN THE RETURN ARRAY      63600013
         TM    D1(R5),HEX04            IS LAST CODE TESTED A FOUR       64200013
         BO    STOWORD4                                                 64800013
         TM    D1(R5),HEX03            IS LAST CODE TESTED A THREE      65400013
         BO    STOWORD3                                                 66000013
         TM    D1(R5),HEX02            IS LAST CODE TESTED A TWO        66600013
         BO    STOWORD2                                                 67200013
         TM    D1(R5),HEX01            IS LAST CODE TESTED A ONE        67800013
         BO    STOWORD1                                                 68400013
STORENEG MVC   D20(D4,R4),NEGNUM       PUT NEG VALUE IN USERS R0        69000013
         B     ALLDONE                 RETURN                           69600013
FIVE     EQU   *                                                        70200013
         MVI   TMPRCHLD,HEX05          CVT HIGHEST BIT SETTING TO VALUE 70800013
         NI    D0(R5),HEXFB            RESET BIT FIVE                   71400013
         B     TSTCODES                TEST VALUE                       72000013
FOUR     MVI   TMPRCHLD,HEX04          CVT HIGHEST BIT SETTING TO VALUE 72600013
         NI    D0(R5),HEXF7            RESET BIT FOUR                   73200013
         B     TSTCODES                TEST VALUE                       73800013
THREE    MVI   TMPRCHLD,HEX03          CVT HIGHEST BIT SETTING TO VALUE 74400013
         NI    D0(R5),HEXEF            RESET BIT THREE                  75000013
         B     TSTCODES                TEST VALUE                       75600013
TWO      MVI   TMPRCHLD,HEX02          CVT HIGHEST BIT SETTING TO VALUE 76200013
         NI    D0(R5),HEXDF            RESET BIT TWO                    76800013
         B     TSTCODES                TEST VALUE                       77400013
STOWORD4 MVC   D20(D4,R4),16(R5)       MOVE ADD INFO 4 TO USER R 0      78000013
         B     ALLDONE                                                  78600013
STOWORD3 MVC   D20(D4,R4),12(R5)       MOVE ADD INFO 3 TO USER R 0      79200013
         B     ALLDONE                                                  79800013
STOWORD2 MVC   D20(D4,R4),8(R5)        MOVE ADD INFO 2 TO USER R 0      80400013
         B     ALLDONE                                                  81000013
STOWORD1 MVC   D20(D4,R4),4(R5)        MOVE ADD INFO 1 TO USER R 0      81600013
         B     ALLDONE                                                  82200013
ZERO     DC    F'0'                                                     82800013
NEGNUM   DC    F'-1'                                                    83400013
         EJECT                                                          84000013
*   THIS DSECT PROVIDES SYMBOLIC REFERENCES TO                          84600013
*   FIELDS OF THE WORK AREA OF USERS CORE                               85200013
WKADSECT DSECT                                                          85800013
         DS    F                       CONTAINS POINTER TO PARM LIST    86400013
         DS    F                       POINTS TO RET ARRAY              87000013
SAVE     DS    18F                                                      87600013
TMPRCHLD DS    X                                                        88200013
         EJECT                                                          88800013
PARLIST  DSECT                                                          89400013
GDSCB    DS    F                                                        90000013
CODE     DS    F                                                        90600013
         END                                                            91200013
./  ADD  SSI=80330212,NAME=IFFAJA02
* TITLE ITBP/RTBP-TEST INTEGER/REAL BEAM POSITION                       00400000
* STATUS CHANGE LEVEL 0                                                 00800000
* FUNCTION TO RETURN TO THE USER EITHER THE X OR Y COORDINATE WHERE THE 01200000
*        2250 BEAM IS CURRENTLY POSITIONED OR THE X OR Y COORDINATE     01600000
*        WHERE THE USER INTENDED THE BEAM TO BE POSITIONED.             02000000
* ENTRY ENTERED AT IFFAJA02 VIA A CALL TO ITBP OR AT IFFAJA03 VIA A     02400000
*        CALL TO RTBP.                                                  02800000
* INPUT GR=1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD OF 03200000
*        THIS AREA CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED 03600000
*        AS FOLLOWS                                                     04000000
*        1.GDSNAME-ADDRESS OF A VARIABLE WHICH CONTAINS THE ADDRESS OF  04400000
*          A GDSCB.                                                     04800000
*        2.INFO-ADDRESS OF A VARIABLE OR CONSTANT WHICH CONTAINS ONE OF 05200000
*          THE FOLLOWING VALUES                                         05600000
*          (1)-RETURN X COORDINATE WHERE BEAM IS SUPPOSED TO BE.        06000000
*          (2)-RETURN X COORDINATE WHERE BEAM ACTUALLY IS.              06400000
*          (3)-SAME AS 1 EXCEPT FOR Y.                                  06800000
*          (4)-SAME AS 2 EXCEPT FOR Y.                                  07200000
* OUTPUT GR=0(ITBP) OR FLOATING POINT REG 0(RTBP) CONTAINS THE SCALED   07600000
*        PROGRAMMER COORDINATE REQUESTED OF THE TYPE(INTEGER-ITBP OR    08000000
*        REAL-RTBP) AND FORM (ABSOLUTE OR INCREMENTAL) CURRENTLY        08400000
*        APPLICABLE FOR THE SPECIFIED GRAPHIC DATA SET.                 08800000
* EXIT RETURN TO CALLER VIA REGISTER 14.                                09200000
* ERROR EXIT IN THE EVENT OF INVALID PARAMETERS OR A CALL TO RTBP IN    09600000
*        INTEGER MODE OR A CALL TO ITBP IN REAL MODE,GR=0(ITBP) OR      10000000
*        FLOATING POINT REG=0(RTBP) WILL CONTAIN THE MAXIMUM            10400000
*        NEGATIVE VALUE UPON RETURN TO THE CALLER.                      10800000
* ATTRIBUTES RE-ENTRANT,PROBLEM PROGRAM MODE.                           11200000
* EXTERNAL ROUTINES CNVRT                                               11600000
* NOTES THIS ROUTINE EXAMINES THE FOLLOWING CONTROL BLOCKS              12000000
*        1.GDSCB                                                        12400000
*        2.GTMCB                                                        12800000
*        3.GSPCB                                                        13200000
         EJECT                                                          13600000
IFFAJA02 CSECT                                                          14000000
*C220000,C440000,C768000                                     LD YA00814 14400000
*A204000,264000-268000,A716000-725000,C726000-728000        D11 ZA15437 14800000
         SPACE 3                                                        15200000
R0       EQU   0                       PARM REG 0                       15600000
R1       EQU   1                       PARM REG 1                       16000000
RLIST    EQU   2                       WORK AREA REG                    16400000
RPARM    EQU   3                       PARAMETER(USER) REG              16800000
RDATA    EQU   4                       DATA REG                         17200000
RGDSCB   EQU   5                       GDSCB REG                        17600000
RA       EQU   6                       WORK REG                         18000000
RB       EQU   7                       WORK REG                         18400000
RC       EQU   8                       WORK REG                         18800000
RBASE    EQU   9                       BASE REG                         19200000
SPARE    EQU   12                      RSVD PL/1                        19600000
RSAVE    EQU   13                      SAVE AREA PTR                    20000000
R14      EQU   14                      LINKAGE REG          D11 ZA15437 20400000
R15      EQU   15                      ENTRY/WORK REG                   20800000
ZERO     EQU   0                       ZERO                             21200000
LAST     EQU   X'80'                   LAST PARM                        21600000
RTBPA    EQU   X'80'                   RTBP ENTRY SWITCH                22000000
PRIOR    EQU   4                       OFFSET TO NEXT HIGHER SAVE AREA  22400000
REG0     EQU   20                      OFFSET TO REG 0 IN SAVE AREA     22800000
CHAIN    EQU   8                       CHAIN SAVE AREAS                 23200000
GID      EQU   X'03'                   GDSCB ID                         23600000
XINT     EQU   X'30'                   X INTEGER                        24000000
XREAL    EQU   X'C0'                   X REAL                LD YA00814 24400000
YINT     EQU   X'03'                   Y INTEGER                        24800000
YREAL    EQU   X'0C'                   Y REAL                           25200000
RTNCDE   EQU   X'00'                   RTN CODE =ZERO                   25600000
ONEA     EQU   1                       ONE                              26000000
STAT     EQU   48                 A(STATAB) DISPL IN GSP    D11 ZA15437 26400000
CONVERT  EQU   X'0264'             STATAB CNVRT ENTRY DISPL D11 ZA15437 26800000
         EJECT                                                          27200000
         ENTRY IFFAJA02                ITBP                             27600000
         ENTRY IFFAJA03                RTBP                             28000000
         USING *,15                                                     28400000
         SAVE  (14,12)                 ITBP ENTRY POINT                 28800000
         B     NEXT                                                     29200000
IFFAJA03 SAVE  (14,12)                 RTBP ENTRY POINT                 29600000
         SR    R15,R15                 INDICATE ENTERED BY RTBP         30000000
NEXT     BALR  RBASE,0                 SET UP BASE REG                  30400000
         DROP  15                                                       30800000
         USING *,RBASE                 DEFINE BASE REG                  31200000
         LR    RLIST,R1                LOAD WORK AREA REG               31600000
         USING WORKAREA,RLIST          DEFINE DSECT                     32000000
         XC    SWITCH(1),SWITCH        CLEAR SWITCH                     32400000
         LTR   R15,R15                 IS THIS AN ITBP ENTRY            32800000
         BC    7,BP01                  BRANCH IF YES                    33200000
         OI    SWITCH,RTBPA            INDICATE RTBP ENTRY              33600000
BP01     L     RPARM,PLIST             LOAD ADDRESS OF USER PARM LIST   34000000
         USING PARM,RPARM              DEFINE DSECT                     34400000
         L     RDATA,PRIOR(RSAVE)      LOAD ADR OF PRIOR SAVE AREA      34800000
         ST    RSAVE,SAVE+4            SAVE REG 13 DAVE AREA PTR        35200000
         LA    R15,SAVE                LOAD ADR OF MY SAVE AREA         35600000
         ST    R15,CHAIN(RSAVE)        CHAIN SAVE AREAS                 36000000
         LA    RSAVE,SAVE              ESTABLISH NEW  SAVE AREA         36400000
         B     AROUND                  BRANCH                           36800000
ERROR    TM    SWITCH,RTBPA            RTBP CALL                        37200000
         BO    BP02                    BRANCH IF YES                    37600000
         L     R15,MAX                 LOAD MAX NEG NUMBER              38000000
         ST    R15,REG0(RDATA)         INDICATE ERROR IN GR=0           38400000
         B     OUTRTN                  BRANCH                           38800000
BP02     LE    R0,MAXR                 INDICATE ERROR IN FP REG=0       39200000
OUTRTN   L     RSAVE,SAVE+4            RESTORE SAVE AREA PTR            39600000
         RETURN (14,12),T              RETURN TO CALLER                 40000000
         EJECT                                                          40400000
AROUND   TM    GDSNAME,LAST            LAST PARAM                       40800000
         BO    ERROR                   BRANCH IF LAST PARAMETER         41200000
         L     RGDSCB,GDSNAME          LOAD INDIRECT PTR TO GDSCB       41600000
         L     RGDSCB,ZERO(RGDSCB)     LOAD GDSCB ADR                   42000000
         USING GDSCB,RGDSCB            DEFINE DSECT                     42400000
         CLI   GDSGDSID,GID            VALID GDSCB                      42800000
         BNE   ERROR                   BRANCH-NOT VALID                 43200000
         L     RA,GDSGTMCB             LOAD GTMCB ADR                   43600000
         USING GTMCB,RA                DEFINE DSECT                     44000000
         L     RB,GTMGSPCB             LOAD GSPCB ADR                   44400000
         USING GSPCB,RB                DEFINE DSECT                     44800000
         L     RC,INFO                 LOAD PTR TO INFO                 45200000
         LA    RC,ZERO(RC)             ZERO HI ORDER BYTE               45600000
         CL    RC,GSPNULLV             INFO=NULL                        46000000
         BE    ERROR                   BRANCH IF YES                    46400000
         L     RC,ZERO(RC)             LOAD VALUE OF INFO               46800000
         XC    GDSA(24),GDSA           CLEAR INPUT PARM AREA LD YA00814 47200000
         CL    RC,ONE                  INFO=1                           47600000
         BE    BP03                    BRANCH=1                         48000000
         CL    RC,TWO                  INFO=2                           48400000
         BE    BP04                    BRANCH=2                         48800000
         CL    RC,THREE                INFO=3                           49200000
         BE    BP05                    BRANCH=3                         49600000
         CL    RC,FOUR                 INFO=4                           50000000
         BE    BP06                    BRANCH=4                         50400000
         B     ERROR                   BRANCH                           50800000
BP03     L     RA,GDSXLAST             LOAD XLAST FIELD                 51200000
         ST    RA,XIA                  STORE INTO PARAM LIST            51600000
         B     BP07                    BRANCH                           52000000
BP04     SR    RA,RA                   CLEAR REG                        52400000
         LH    RA,GDSXCURR             LOAD X CURR FIELD                52800000
         ST    RA,XIA                  STORE INTO PARAM LIST            53200000
         B     BP07                    BRANCH                           53600000
BP05     L     RA,GDSYLAST             LOAD YLAST FIELD                 54000000
         ST    RA,YIA                  STORE IN PARAM LIST              54400000
         B     BP08                    BRANCH                           54800000
BP06     SR    RA,RA                   CLEAR REG                        55200000
         LH    RA,GDSYCURR             LOAD Y CURR FIELD                55600000
         ST    RA,YIA                  STORE IN PARAM LIST              56000000
         B     BP08                    BRANCH                           56400000
BP07     TM    SWITCH,RTBPA            RTBP ENTRY                       56800000
         BO    BP09                    BRANCH IF RTBP                   57200000
         TM    GDSDATMD,XINT           X=INTEGER                        57600000
         BC    8,ERROR                 BRANCH-X NOT INTEGER MODE        58000000
         B     BP10                    BRANCH                           58400000
BP09     TM    GDSDATMD,XREAL          X=REAL                           58800000
         BC    8,ERROR                 BRANCH- X NOT REAL MODE          59200000
         B     BP10                    BRANCH                           59600000
BP08     TM    SWITCH,RTBPA            RTBP ENTRY                       60000000
         BO    BP11                    BRANCH-RTBP                      60400000
         TM    GDSDATMD,YINT           Y=INTEGER                        60800000
         BC    8,ERROR                 BRANCH- Y NOT INTEGER MODE       61200000
         B     BP10                    BRANCH                           61600000
BP11     TM    GDSDATMD,YREAL          Y=REAL                           62000000
         BC    8,ERROR                 BRANCH-Y NOT REAL MODE           62400000
BP10     ST    RGDSCB,GDSA             ADR OF GDSCB TO PARAM LIST       62800000
         LA    RA,ONEA                 LOAD CONSTANT                    63200000
         ST    RA,CONA                 STORE VALUE IN PARAM LIST        63600000
         LA    RA,GDSA                 LOAD ADR                         64000000
         ST    RA,GDS                  PUT ADR IN PARAM LIST            64400000
         LA    RA,CONA                 LOAD ADR                         64800000
         ST    RA,CON                  STORE IN PARAM LIST              65200000
         LA    RA,XIA                  LOAD ADR                         65600000
         ST    RA,XI                   STORE IN PARAM LIST              66000000
         LA    RA,YIA                  LOAD ADR                         66400000
         ST    RA,YI                   STORE IN PARAM LIST              66800000
         LA    RA,XOA                  LOAD ADR                         67200000
         ST    RA,XO                   STORE ADR IN PARAM LIST          67600000
         LA    RA,YOA                  LOAD ADR                         68000000
         ST    RA,YO                   STORE IN PARAM LIST              68400000
         MVI   YO,LAST                 INDICATE LAST PARAM              68800000
         LA    RA,GDS                  LOAD ADR                         69200000
         ST    RA,PARAM                STORE ADR IN PARAM LIST          69600000
         LA    RA,RCC                  LOAD ADR                         70000000
         ST    RA,RCB                  STORE IN PARAM LIST              70400000
         XC    RCC(20),RCC             CLEAR RETURN CODE ARRAY          70800000
         LA    R1,PARAM                LOAD ADR                         71200000
         L     R15,STAT(RB)        POINT TO STATUS TABLE    D11 ZA15437 71600000
         L     R15,CONVERT(R15)    AND TO CONVERT EP        D11 ZA15437 72000000
         LTR   R15,R15             CONVERT LOADED?          D11 ZA15437 72200000
         BZ    BPLINK1             NO,MUST USE SYSTEM LINK  D11 ZA15437 72400000
         BALR  R14,R15             GO CONVERT               D11 ZA15437 72500000
         B     BPRTN1              RETURN FROM CONVERT      D11 ZA15437 72600000
BPLINK1  LINK  EP=IFFAGA08,MF=(E,(1))  CALL CONVERT         D11 ZA15437 72700000
BPRTN1   CLI   RCC,RTNCDE              CONVERT SUCCESSFUL   D11 ZA15437 72800000
         BNE   ERROR                   BRANCH IF NOT SUCCESSFUL         73200000
         CL    RC,TWO                  X OR Y OUTPUT                    73600000
         BC    2,BP12                  BRANCH FOR Y OUTPUT              74000000
         TM    SWITCH,RTBPA            REAL OR INTEGER OUTPUT           74400000
         BO    BP13                    BRANCH -REAL OUTPUT              74800000
         L     RA,XOA                  LOAD X RESULTS                   75200000
         ST    RA,REG0(RDATA)          STORE RESULTS                    75600000
         B     OUTRTN                  BRANCH                           76000000
BP13     LE    R0,XOA                  RESULTS TO FP REG 0              76400000
         B     OUTRTN                  BRANCH                           76800000
BP12     TM    SWITCH,RTBPA            REAL OR INTEGER OUTPUT           77200000
         BO    BP14                    BRANCH-REAL OUTPUT               77600000
         L     RA,YOA                  LOAD RESULTS                     78000000
         ST    RA,REG0(RDATA)          STORE RESULTS                    78400000
         B     OUTRTN                  BRANCH                           78800000
BP14     LE    R0,YOA                  RESULTS TO FP REG = 0            79200000
         B     OUTRTN                  BRANCH                           79600000
         EJECT                                                          80000000
         DS    0F                                                       80400000
MAX      DC    X'80000000'                                              80800000
MAXR     DC    X'FFFFFFFF'                                   LD YA00814 81200000
ONE      DC    A(1)                                                     81600000
TWO      DC    A(2)                                                     82000000
THREE    DC    A(3)                                                     82400000
FOUR     DC    A(4)                                                     82800000
         CNOP  0,8                                                      83200000
PARM     DSECT                                                          83600000
GDSNAME  DS    1F                                                       84000000
INFO     DS    1F                                                       84400000
WORKAREA DSECT                                                          84800000
PLIST    DS    1F                                                       85200000
RCA      DS    1F                                                       85600000
SWITCH   DS    1F                                                       86000000
*              BIT 0=0 IFFAJ02(ITBP) ENTRY                              86400000
*              BIT 0=1 IFFAJ03(RTBP) ENTRY                              86800000
SAVE     DC    18F'0'                                                   87200000
PATCH    DC    64X'FF'             PATCH AREA               D11         87600000
GDS      DS    1F                      ARD OR GDSA                      88000000
CON      DS    1F                      ADR OF CONA                      88400000
XI       DS    1F                      ADR OF XIA                       88800000
YI       DS    1F                      ADR OF YIA                       89200000
XO       DS    1F                      ADR OF XOA                       89600000
YO       DS    1F                      ADR OF YOA + X'80' IN HI BYTE    90000000
GDSA     DS    1F                      ADR OF GDSCB                     90400000
CONA     DS    1F                      VALUE OF ONE                     90800000
XIA      DS    1F                      VALUE OF X INPUT OR 0            91200000
YIA      DS    1F                      VALUE OF Y INPUT OR 0            91600000
XOA      DS    1F                      LOCATION WHERE X RESULTS STORED  92000000
YOA      DS    1F                      LOCATION WHERE Y RESULTS STORED  92400000
RCC      DS    5F                      RTN CODE ARRAY                   92800000
PARAM    DS    1F                      ADR OF GDS                       93200000
RCB      DS    1F                      ADR OF RTN CODE ARRAY (RCC)      93600000
         COPY  GSPCB                                                    94000000
         COPY  GTMCB                                                    94400000
         COPY  GDSCB                                                    94800000
         END                                                            95200000
./  ADD  SSI=20480419,NAME=IFFAJA04
* TITLE:ITST-TEST STATUS                                                00500013
* STATUS:CHANGE LEVEL 0                                                 01000013
* FUNCTION:TO RETURN TO THE USER A VALUE CORRESPONDING TO THE TYPE OF   01500013
*          DATA CURRENTLY IN EFFECT FOR A PARTICULAR OPTION DEFINITION  02000013
*          SUBROUTINE FOR THE ASSOCIATED GRAPHIC DATA SET.              02500013
* ENTRY:ENTERED AT IFFAJA04 VIA A CALL TO ITST.                         03000013
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD OF 03500013
*       THIS AREA CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED  04000013
*       AS FOLLOWS:                                                     04500013
*        1.GDSNAME-ADDRESS OF A VARIABLE WHICH CONTAINS THE ADDRESS OF  05000013
*          A GDSCB.                                                     05500013
*        2.OPTIONSUBRTN-ADDRESS OF A VARIABLE OR CONSTANT WHOSE VALUE   06000013
*          INDICATES ONE OF THE FOLLOWING:                              06500013
*         (1)SDATM SUBROUTINE(X COORDINATE)                             07000013
*         (2)SDATM SUBROUTINE(Y COORDINATE)                             07500013
*         (3)SGRAM SUBROUTINE                                           08000013
*         (4)SCHAM SUBROUTINE                                           08500013
* OUTPUT:GR#0 WILL CONTAIN ONE OF THE FOLLOWING VALUES:                 09000013
*        SUBRTN  VALUE  MEANING                                         09500013
*        ******  *****  *********************************************** 10000013
*        SDATM    1     X(Y) IS REAL,ABSOLUTE                           10500013
*                 2     X(Y) IS REAL,INCREMENTAL                        11000013
*                 3     X(Y) IS INTEGER,ABSOLUTE                        11500013
*                 4     X(Y) IS INTEGER,INCREMENTAL                     12000013
*        SGRAM    1     OUTPUT OPTIMIZED                                12500013
*                 2     OUTPUT ABSOLUTE                                 13000013
*                 3     OUTPUT INCREMENTAL                              13500013
*        SCHAM    1     CHARACTERS ARE BASIC SIZE AND PROTECTED         14000013
*               2       CHARACTERS ARE LARGE SIZE AND PROTECTED         14500013
*                 3     CHARACTERS ARE BASIC SIZE AND UNPROTECTED       15000013
*                 4     CHARACTERS ARE LARGE SIZE AND UNPROTECTED       15500013
* EXIT:RETURN TO CALLER VIA REGISTER 14.                                16000013
* ERROR EXIT:IN THE EVENT OF INVALID PARAMETERS OR REQUESTED INFORMATIN 16500013
*            NOT AVAILABLE,A VALUE OF 0 WILLBE RETURNED IN GR#0.        17000013
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE                            17500013
* NOTES:THIS ROUTINE EXAMINES THE FOLLOWING CONGROL BLOCKS:             18000013
*       1.GDSCB                                                         18500013
*       2.GTMCB                                                         19000013
*       3.GSPCB                                                         19500013
R0       EQU   0                       PARM REG 0                       20000013
R1       EQU   1                       PARM REG 1                       20500013
RLIST    EQU   2                       WORK AREA REG                    21000013
RPARM    EQU   3                       USER PARAMETERS REG              21500013
RDATA    EQU   4                       DATA REG                         22000013
RA       EQU   5                       WORK REG                         22500013
RB       EQU   6                       WORK REG                         23000013
RGDSCB   EQU   7                       GDSCB REG                        23500013
RBASE    EQU   9                       BASE REG                         24000013
RSAVE    EQU   13                      SAVE REG                         24500013
PRIOR    EQU   4                       PREVIOUS SAVE AREA               25000013
REG0     EQU   20                      OFFSET TO REG 0                  25500013
XRA      EQU   X'80'                   X-REAL-ABSOLUTE                  26000013
XRI      EQU   X'40'                   X-REAL-INCREMENTAL               26500013
XIA      EQU   X'20'                   X-INT-ABSOLUTE                   27000013
XII      EQU   X'10'                   X-INT-INCREMENTAL                27500013
YRA      EQU   X'08'                   Y-REAL-ABSOLUTE                  28000013
YRI      EQU   X'04'                   Y-REAL-INCREMENTAL               28500013
YIA      EQU   X'02'                   Y-INT-ABSOLUTE                   29000013
YII      EQU   X'01'                   Y-INT-INCREMENTAL                29500013
BP       EQU   X'08'                   BASIC CHAR-PROTECTED             30000013
BUP      EQU   X'02'                   BASIC CHAR-UNPROTECTED           30500013
LP       EQU   X'04'                   LARGE CHAR-PROTECTED             31000013
LUP      EQU   X'01'                   LARGE CHAR-UNPROTECTED           31500013
OPTI     EQU   X'04'                   OUTPUT OPTIMIZED                 32000013
ABS      EQU   X'02'                   OUTPUT ABSOLUTE                  32500013
INC      EQU   X'01'                   OUTPUT INCREMENTAL               33000013
LAST     EQU   X'80'                   LAST PARAM                       33500013
ZERO     EQU   0                       ZERO                             34000013
GID      EQU   X'03'                   GDSCB ID                         34500013
IFFAJA04 CSECT                                                          35000013
         SAVE  (14,12)                 SAVE REGS                        35500013
         BALR  RBASE,0                 SET UP BASE REG                  36000013
         USING *,RBASE                 DEFINE BASE REG                  36500013
         LR    RLIST,R1                LOAD REG                         37000013
         USING WORKAREA,RLIST          DEFINE DSECT                     37500013
         L     RPARM,PLIST             LOAD ADR OF USER PARM LIST       38000013
         USING PARM,RPARM              DEFINE DSECT                     38500013
         L     RDATA,PRIOR(RSAVE)      LOAD ADR OF PREVIOUS SAVE AREA   39000013
         B     AROUND                  BRANCH                           39500013
ERROR    SR    RB,RB                   INDICATE ERROR                   40000013
OUTRTN   ST    RB,REG0(RDATA)          STORE DATA                       40500013
         RETURN (14,12),T              RETURN TO CALLER                 41000013
AROUND   TM    GDS,LAST                LAST PARAM                       41500013
         BO    ERROR                   BRANCH IF YES                    42000013
         L     RGDSCB,GDS              LOAD INDIRECT PTR TO GDSCB       42500013
         L     RGDSCB,ZERO(RGDSCB)     LOAD GDSCB ADR                   43000013
         USING GDSCB,RGDSCB            DEFINE DSECT                     43500013
         CLI   GDSGDSID,GID            VALID GDSCB                      44000013
         BNE   ERROR                   BRANCH-NOT VALID                 44500013
         L     RA,GDSGTMCB             LOAD GTMCB ADR                   45000013
         USING GTMCB,RA                DEFINE DSECT                     45500013
         L     RB,GTMGSPCB             LOAD GSPCB ADR                   46000013
         USING GSPCB,RB                DEFINE DSECT                     46500013
         DROP  RA                                                       47000013
         L     RA,OPT                  LOAD OPTSUBROUTINE VALUE PTR     47500013
         LA    RA,ZERO(RA)             ZERO HI ORDER BYTE               48000013
         CL    RA,GSPNULLV             EQUAL NULL ADR                   48500013
         BE    ERROR                   BRANCH=NULL                      49000013
         DROP  RB                                                       49500013
         L     RA,ZERO(RA)             LOAD VALUE                       50000013
         CL    RA,ONE                  VALUE=1                          50500013
         BE    IT05                    BRANCH TO SDATM X CO-OR CHECKS   51000013
         CL    RA,TWO                  VALUE=2                          51500013
         BE    IT06                    BRANCH TO SDATM Y CO-OR CHECKS   52000013
         CL    RA,THREE                VALUE=3                          52500013
         BE    IT07                    BRANCH TO SGRAM CHECKS           53000013
         CL    RA,FOUR                 VALUE=4                          53500013
         BE    IT08                    BRANCH TO SCHAM CHECKS           54000013
         B     ERROR                   BRANCH                           54500013
IT01     L     RB,ONE                  LOAD CONSTANT                    55000013
         B     OUTRTN                  BRANCH                           55500013
IT02     L     RB,TWO                  LOAD CONSTANT                    56000013
         B     OUTRTN                  BRANCH                           56500013
IT03     L     RB,THREE                LOAD CONSTANT                    57000013
         B     OUTRTN                  BRANCH                           57500013
IT04     L     RB,FOUR                 LOAD CONSTANT                    58000013
         B     OUTRTN                  BRANCH                           58500013
IT05     TM    GDSDATMD,XRA            X-REAL-ABS                       59000013
         BO    IT01                    BRANCH IF YES                    59500013
         TM    GDSDATMD,XRI            X-REAL-INC                       60000013
         BO    IT02                    BRANCH IF YES                    60500013
         TM    GDSDATMD,XIA            X-INT-ABS                        61000013
         BO    IT03                    BRANCH IF YES                    61500013
         TM    GDSDATMD,XII            X-INT-INC                        62000013
         BO    IT04                    BRANCH IF YES                    62500013
         B     ERROR                   BRANCH                           63000013
IT06     TM    GDSDATMD,YRA            Y-REAL-ABS                       63500013
         BO    IT01                    BRANCH IF YES                    64000013
         TM    GDSDATMD,YRI            Y-REAL-INC                       64500013
         BO    IT02                    BRANCH IF YES                    65000013
         TM    GDSDATMD,YIA            Y-INT-ABS                        65500013
         BO    IT03                    BRANCH IF YES                    66000013
         TM    GDSDATMD,YII            Y-INT-INCR                       66500013
         BO    IT04                    BRANCH IF YES                    67000013
         B     ERROR                   BRANCH                           67500013
IT07     TM    GDSCURMD,OPTI           OUTPUT OPTIMIZE                  68000013
         BO    IT01                    BRANCH IF YES                    68500013
         TM    GDSCURMD,ABS            OUTPUT ABSOLUTE                  69000013
         BO    IT02                    BRANCH IF YES                    69500013
         TM    GDSCURMD,INC            OUTPUT INCREMENTAL               70000013
         BO    IT03                    BRANCH IF YES                    70500013
         B     ERROR                   BRANCH                           71000013
IT08     TM    GDSCHARS,BP             CHARS=BASIC PROTECTED            71500013
         BO    IT01                    BRANCH IF YES                    72000013
         TM    GDSCHARS,LP             CHARS=LARGE PROTECTED            72500013
         BO    IT02                    BRANCH IF YES                    73000013
         TM    GDSCHARS,BUP            CHARS=BASIC-UNPROTECTED          73500013
         BO    IT03                    BRANCH IF YES                    74000013
         TM    GDSCHARS,LUP            CHARS=LARGE=UNPROTECTED          74500013
         BO    IT04                    BRANCH IF YES                    75000013
         B     ERROR                   BRANCH                           75500013
         DS    0F                                                       76000013
ONE      DC    A(1)                                                     76500013
TWO      DC    A(2)                                                     77000013
THREE    DC    A(3)                                                     77500013
FOUR     DC    A(4)                                                     78000013
         CNOP  0,8                                                      78500013
WORKAREA DSECT                                                          79000013
PLIST    DS    1F                                                       79500013
PARM     DSECT                                                          80000013
GDS      DS    1F                                                       80500013
OPT      DS    1F                                                       81000013
         COPY  GDSCB                                                    81500013
         COPY GTMCB                                                     82000013
         COPY  GSPCB                                                    82500013
         END                                                            83000013
./  ADD  SSI=20480420,NAME=IHCGSP01
         SPACE 3                                                        00500021
*                                                                       01000021
*  MODULE      IHCGSP01                                                 01500021
*                                                                       02000021
*  TITLE       INITIATE GRAPHIC SUBROUTINE PACKAGE                      02500021
*                                                                       03000021
*  LEVEL       001                                                      03500021
*                                                                       04000021
*  FUNCTION    INITIALIZES GSPCB, ELIMINATING NEED FOR IFFAAA01         04500021
*                                                                       05000021
*  ENTRY       FROM           FORTRAN  PROGRAM                          05500021
*              AT             INGSP                                     06000021
*                                                                       06500021
*  EXITS       NORMAL         TO CALLER, RETURN CODE = 0                07000021
*              ERROR          TO CALLER, ARG 1 SET TO 0.                07500021
*                                                                       08000021
*  EXT REF     MODULES        NONE                                      08500021
*                                                                       09000021
*              MACROS         GETMAIN            SAVE                   09500021
*                             FREEMAIN           RETURN                 10000021
*                             LOAD                                      10500021
*                                                                       11000021
*  INPUT       REG 1          POINTER TO LIST OF ARGUMENT ADDRESSES     11500021
*                                                                       12000021
*                                 ARG 1 ADDRESS OF FIELD INTO WHICH     12500021
*                                       GSPCB ADDRESS IS PLACED         13000021
*                                                                       13500021
*                                 ARG 2 ADDRESS OF NULL VALUE           14000021
*                                                                       14500021
*                                 ARG 3 OPTIONAL, ADDR OF FIELD         15000021
*                                       CONTAINING ENTRY POINT FOR      15500021
*                                       ERROR EXIT ROUTINE              16000021
*                                                                       16500021
*              REG 13-15      OS CONVENTIONAL USE OF SAVE,              17000021
*                             RETURN, AND ENTRY POINT.                  17500021
*                                                                       18000021
*  OUTPUT      TO USER        ADDRESS OF GSPCB PUT INTO ARG 1           18500021
*                                                                       19000021
         EJECT                                                          19500021
         SPACE 3                                                        20000021
*************************    REGISTERS      **************************  20500021
         SPACE 2                                                        21000021
R0ADR    EQU   0         ENTRY POINT ADDRESS OF LOADED ROUTINE          21500021
R0SIZE   EQU   0         SIZE OF CORE REQUESTED                         22000021
R1PARM   EQU   1         SYSTEM PARAMETERS                              22500021
R2GSPCB  EQU   2         ADDRESS OF GSPCB, SEE DSECT DEFINITION         23000021
R7PLIST  EQU   7         ADDRESS OF  LIST CONTAINING ADDRESSES OF ARGS  23500021
R9BASE   EQU   9         USED DURING MACRO EXPANSIONS                   24000021
R10WORKA EQU   10        ADDRESS OF ARG 1                               24500021
R11WORKB EQU   11                                                       25000021
R13SAVE  EQU   13        USED BY LINK MACRO                             25500021
R14BACK  EQU   14                                                       26000021
R15EP    EQU   15                                                       26500021
         SPACE 2                                                        27000021
*************************    CONSTANTS      **************************  27500021
         SPACE                                                          28000021
ID       EQU   X'01'          GSPCB ID IS F201                          28500021
F2       EQU   X'F2'                                                    29000021
PERMWK   EQU   1024           1K WORK AREA ALLOWS CONTIGUOUS OVERLAP    29500021
*                                  FOR SUBROUTINE COMMUNICATION         30000021
         SPACE 2                                                        30500021
********************    DISPLACEMENT      CONSTANTS   ****************  31000021
         SPACE                                                          31500021
ARG1     EQU   0         DISPLACEMENT WITHIN ARG 1 FOR GSPCB ADDRESS    32000021
ARG1ADR  EQU   0         DISPLACEMENT WITHIN ARG LIST OF ARG 1          32500021
ARG2ADR  EQU   4         DISPLACEMENT WITHIN ARG LIST OF ARG 2          33000021
ARG3ADR  EQU   8         DISPLACEMEN WITHIN ARG LIST OF ARG 3           33500021
HSA      EQU   4         SAVE AREA DISPLACEMENT FOR ADR OF HIGHER SAVE  34000021
HYBYTE   EQU   0         DISPLACEMENT FOR ROUTINE ADDR                  34500021
WKDISPL  EQU   4         WORK AREA BEGINS AFTER GSPCB                   35000021
         EJECT                                                          39600021
IHCGSP01 CSECT                                                          40500021
*1671,009000-387000,432000-891000      MODULE REWRITTEN                 40900021
         ENTRY INGSP                                                    41400021
INGSP    SAVE  (14,12)                                                  42300021
         BALR  R9BASE,0                     ESTABLISH BASE FOR MACROS   43000021
         USING *,R9BASE                                                 43700021
         SPACE                                                          44400021
         LR    R7PLIST,R1PARM               SAVE ADDR LIST              45100021
         LA    R0SIZE,PERMWK                GET WORK AREA               45800021
         SPACE                                                          46500021
         GETMAIN R,LV=(0)                                               47200021
         SPACE                                                          47900021
         LR    R2GSPCB,R1PARM               GSPCB ESTABLISHED           48600021
         USING GSPCB,R2GSPCB                                            49300021
         XC    GSPCB(GSPCBLNG),GSPCB           PRESET TO ZEROS          50000021
         SPACE 2                                                        50700021
*      PROCESS ARGUMENT 1,GSPCB ADDRESS                                 51400021
         SPACE                                                          52100021
         L     R10WORKA,ARG1ADR(R7PLIST)    GET ADR OF ARG 1            52800021
         LTR   R10WORKA,R10WORKA               CHECK IF ONLY ARG        53500021
         BM    INGSP020                        IF YES, ERROR            54200021
         ST    R2GSPCB,ARG1(R10WORKA)          KEEP GSPCB ADR IN ARG 1  54900021
         SPACE 2                                                        55600021
*      PROCESS ARGUMENT 2, NULL VALUE                                   56300021
         SPACE                                                          57000021
         L     R11WORKB,ARG2ADR(R7PLIST)    GET ADR OF ARG 2            57700021
         LTR   R11WORKB,R11WORKB               CHECK FOR ARG 3          57750000
         LA    R11WORKB,HYBYTE(R11WORKB)     CLAER HIGH BYTE     M1097  57800000
         ST    R11WORKB,GSPNULLV               KEEP ADDR IN GSPCB       58400021
         BM    INGSP005                      IF NO ARG 3, SKIP          59800021
         SPACE 2                                                        60500021
*      PROCESS ARGUMENT 3, OPTIONAL, ADDRESS OF USER ERROR EXIT ROUTINE 61200021
         SPACE                                                          61900021
         L     R11WORKB,ARG3ADR(R7PLIST)  GET ADR OF ARG 3              62600021
         L     R11WORKB,HYBYTE(R11WORKB)     GET ADDR OF ROUTINE        63300021
         ST    R11WORKB,GSPAEXIT             KEEP ADDR IN GSPCB         64000021
         EJECT                                                          64700021
*      INITIALIZE GSPCB                                                 65400021
*           1. INSERT CONSTANTS                                         66100021
*           2. INSERT ADDRESS OF LOADED ROUTINES                        66800021
         SPACE                                                          67500021
INGSP005 MVI   GSPSYSID,F2                                              68200021
         MVI   GSPCBID,ID                                               68900021
         LA    R10WORKA,GSPAEXIT+WKDISPL     CALC WORKAREA ADDR         69600021
         ST    R10WORKA,GSPAWORK             KEEP ADDR IN GSPCB         70300021
         ST    R13SAVE,SAVE+HSA             PREPARE FOR OS CONVENTIONS  71000021
         LA    R13SAVE,SAVE                                             71700021
         SPACE 2                                                        72400021
         LOAD  EP=IFFAHA12                                              73100021
         ST    R0ADR,GSPASTAT               KEEP ADDR IN GSPCB          73800021
         SPACE 2                                                        74500021
         LOAD  EP=IFFAHA11                                              75200021
         ST    R0ADR,GSPDCTR2               KEEP ADDR IN GSPCB          75900021
         SPACE                                                          76600021
INGSP010 L     R13SAVE,SAVE+HSA             NORMAL RETURN               77300021
         RETURN (14,12)                                                 78000021
         SPACE 2                                                        78700021
*       ERROR PROCESSING FOR MISSING NULL, ARG 2                        79400021
         SPACE                                                          80100021
INGSP020 XC    ARG1(4,R10WORKA),ARG1(R10WORKA)   SET ARG 1 TO 0.        80800021
         B     INGSP010                          RETURN TO USER         81500021
         COPY  GSPCB                                                    82200021
GSPCBLNG EQU   *-GSPCB             NUMBER OF BYTES IN GSPCB             82900021
SAVE     DS    9D                  SAVE AREA FOR SYSTEM                 83600021
         END                                                            90000021
./  ADD  SSI=20480422,NAME=IHCGSP02
*TITLE         TERMINATE GSP PART 1                                     00900021
*********************************************************************** 01800021
*                                                                     * 02700021
*TITLE              TMGSP(PART 1)  TERMINATE GSP                      * 03600021
*                                                                     * 04500021
*MODULE NAME        IHCGSP02                                          * 05400021
*ENTRY              TMGSP                                             * 06300021
*FUNCTION/OPERATION                                                   * 07200021
*  LINKS TO TMGSP PART 2. ON RETURN FROM PART 2, IT DELETES ANY       * 08100021
*  STROKE TABLES WHICH HAVE BEEN LOADED, THE STATUS TABLE, AND        * 09000021
*  PART 2 OF THE DIRECTOR. ALL GSP WORK AREA IS FREED.                * 09900021
*                                                                     * 10800021
*INPUT - REGISTER 1 CONTAINS A POINTER TO THE GSPLB ADDRESS           * 11700021
*                                                                     * 12600021
*OUTPUT- NONE TO CALLER                                               * 13500021
*                                                                     * 14400021
*EXTERNAL MACROS- DELETE, FREEMAIN, LINK                              * 15300021
*                                                                     * 16200021
*EXITS- RETURN TO CALLER VIA REGISTER 14                              * 17100021
*       IF ERROR RETURN, THE PARAMETER IS SET TO ZERO                 * 18000021
*                                                                     * 18900021
*WORKAREA- SEE WKAREA DSECT                                           * 19800021
*                                                                     * 20700021
*LIBRARY - FORTLIB                                                    * 21600021
*ATTRIBUTES- REENTRANT, RESIDENT WITH USERS PROGRAM.                  * 22500021
*                                                                     * 23400021
*********************************************************************** 24300021
         EJECT                                                          25200021
*                                                                       26100021
*REGISTER UTILIZATION                                                   27000021
*                                                                       27900021
R0       EQU   0                                                        28800021
R1       EQU   1                                                        29700021
R2       EQU   2                                                        30600021
R3       EQU   3                                                        31500021
R5       EQU   5                                                        32400021
R6       EQU   6                                                        33300021
R8       EQU   8                                                        34200021
R9       EQU   9                                                        35100021
R10      EQU   10                                                       36000021
R13      EQU   13                                                       36900021
R4       EQU   4                                                        37300021
         EJECT                                                          37800021
IHCGSP02 CSECT                                                          38700021
         ENTRY TMGSP                                                    39600021
TMGSP    SAVE  (14,12)                                                  40500021
         BALR  R9,R0                                                    41400021
         USING *,R9                    ESTABLISH CSECT ADDRESSABILITY   42300021
         L     R4,0(R1)                GET GSPCB PTR                    43200021
         L     R6,0(R4)                GET GSPCB ADDR                   44100021
         USING GSPCB,R6                ESTABLISH GSPCB ADDRESSABILITY   45000021
         L     R5,GSPAWORK             GET WORK AREA ADDR FROM GSPCB    45900021
         USING WRKSECT,R5              SET WORK AREA ADDRESSABILITY     46800021
         ST    R13,SVAREA+4            CHAIN SAVE AREAS                 47700021
         LA    R2,SVAREA                                                48600021
         ST    R2,8(R13)                                                49500021
         LR    R13,R2                  SET SAVE AREA REG                50400021
         CLC   GSPSYSID(2),GSPVALID    IS CONTROL BLOCK VALID           51300021
         BE    TR1D3                   YES                              52200021
         XC    0(4,R4),0(R4)           SET PARM TO ZERO IF INVALID      53100021
         L     R13,SVAREA+4                                             54000021
         B     TR2D3                                                    54900021
TR1D3    L     R3,16                   GET CVT ADDR                     55800021
         L     R3,CVTLINK(R3)          GET LINKLIB DCB ADDR             56700021
         XC    SUPPLIST(16),SUPPLIST                                    57600021
         LINK  EP=IFFAAA02,MF=(E,(6)),SF=(E,SUPPLIST)                   58500021
*                                                                       59400021
*RETURN FROM TRMGSP PART 2                                              60300021
*                                                                       61200021
         L     R10,GSPSTRTB             ADDRESS OF STROKE TABLE         62100021
         MVC   STROKE(16),TABNAME       SET UP 'GSP  ' IN WORK AREA     63000021
TR1D4    LTR   R10,R10                                                  63900021
         BNE   TR1D6                    BRANCH IF TABLES TO DELETE      64800021
         DELETE EP=IFFAHA12            DELETE STATUS TABLE              65700021
         DELETE EP=IFFAHA11            DELETE DIRECTOR PART 2           66600021
         XC    GSPCBID(1),GSPCBID                                       67500021
         L     R8,SVAREA+4              GET SVAREA ADDRESS BEFORE FREE  68400021
         FREEMAIN R,LV=1024,A=(6)      RELEASE ALL GSP WORK AREA        69300021
         LR    R13,R8                   ADDRESS OF SVAREA               70200021
TR2D3    RETURN (14,12),T                                               71100021
         RETURN (14,12),T                                               72000021
*                                                                       72900021
         EJECT                                                          73800021
TR1D6    L     R2,CHAIN(R10)           SAVE CHAIN ADDRESS               74700021
         L     R3,ID(R10)                                               75600021
         CVD   R3,SCONVERT                                              76500021
         UNPK  STROKE+3(2),SCONVERT+6(2) STROKE EBCIDIC NAME            77400021
         OI    STROKE+4,SIGN            TURN OFF SIGN INDICATOR         78300021
         DELETE EPLOC=STROKE            DELETE STROKE TABLE             79200021
         LR    R10,R2                  SET UP TO DELETE NEXT            80100021
         B     TR1D4                                                    81000021
         SPACE 6                                                        81900021
*CONSTANTS AND DSECTS                                                   82800021
*                                                                       83700021
CVTLINK  EQU   8                                                        84600021
ID       EQU   0                                                        85500021
CHAIN    EQU   4                                                        86400021
GSPVALID DC    X'F201'                                                  87300021
TABNAME  DC    CL16'GSP '                                               88200021
SIGN     EQU   X'F0'                                                    89100021
         SPACE 2                                                        90000021
WRKSECT  DSECT                                                          90900021
SVAREA   DS    18F                                                      91800021
SUPPLIST DS    4F                                                       92700021
SCONVERT DS    D                                                        93600021
STROKE   DS    D                                                        94500021
         COPY  GSPCB                                                    95400021
         END                                                            96300021
./  ADD  SSI=20480426,NAME=IHCGSP03
* TITLE        DIRECTOR PART1                                           00300013
*                                                                       00600013
*MODULE NAME   IHCGSP03                                                 00900013
*                                                                       01200013
*INPUT         OS STANDARD FORMAT                                       01500013
*                                                                       01800013
*              FIRST PARAMETER MUST BE ADDRESS OF FIELD CONTAINING      02100013
*                                                                       02400013
*              ADDRESS OF VALID GSP CONTROL BLOCK                       02700013
*                                                                       03000013
*OUTPUT        NONE TO CALLER                                           03300013
*                                                                       03600013
*ERRORS        ABEND, USER CODE 8 IF INPUT NOT CORRECT (TEMPORARY)      03900013
*                                                                       04200013
*FUNCTION      LOCATES DIRECTOR PART2 FROM GSPCB, AND BRANCHES.         04500013
*                                                                       04800013
*              CONTROL RETURNS DIRECTLY TO USER FROM DIRECTOR 2         05100013
*                                                                       05400013
*OUTPUT TO                                                              05700013
*DIRECTOR 2    REG1 UNCHANGED                                           06000013
*                                                                       06300013
*              REG2 ADDRESS OF GSPCB                                    06600013
*                                                                       06900013
*REG3          DISPLACEMENT NUMBER OF ORIGINAL ENTRY POINT              07200013
*                                                                       07500013
*REG9          ADDRESS OF DIRECTOR 2                                    07800013
*                                                                       08100013
*REG13         UNCHANGED.  REGISTERS HAVE BEEN SAVED                    08400013
         EJECT                                                          08700013
IHCGSP03 CSECT                                                          09000013
*2430                                                              RSTG 09100016
         USING *,15                                                     09300013
         ENTRY INDEV                                                    09600013
INDEV    B     DCTR1                                                    09900013
         USING *,15                                                     10200013
         ENTRY TMDEV                                                    10500013
TMDEV    B     DCTR1                                                    10800013
         USING *,15                                                     11100013
         ENTRY INGDS                                                    11400013
INGDS    B     DCTR1                                                    11700013
         USING *,15                                                     12000013
         ENTRY TMGDS                                                    12300013
TMGDS    B     DCTR1                                                    12600013
         USING *,15                                                     12900013
         ENTRY CRATL                                                    13200013
CRATL    B     DCTR1                                                    13500013
         USING *,15                                                     13800013
         ENTRY ENATL                                                    14100013
ENATL    B     DCTR1                                                    14400013
         USING *,15                                                     14700013
         ENTRY ENATN                                                    15000013
ENATN    B     DCTR1                                                    15300013
         USING *,15                                                     15600013
         ENTRY DSATN                                                    15900013
DSATN    B     DCTR1                                                    16200013
         USING *,15                                                     16500013
         ENTRY MPATL                                                    16800013
MPATL    B     DCTR1                                                    17100013
         USING *,15                                                     17400013
         ENTRY MLPEO                                                    17700013
MLPEO    B     DCTR1                                                    18000013
         USING *,15                                                     18300013
         ENTRY SLPAT                                                    18600013
SLPAT    B     DCTR1                                                    18900013
         USING *,15                                                     19200013
         ENTRY MLITS                                                    19500013
MLITS    B     DCTR1                                                    19800013
         USING *,15                                                     20100013
         ENTRY RQATN                                                    20400013
RQATN    B     DCTR1                                                    20700013
         USING *,15                                                     21000013
         ENTRY EURATL                                                   21300013
EURATL   B     DCTR1                                                    21600013
         USING *,15                                                     21900013
         ENTRY SETATN                                                   22200013
SETATN   B     DCTR1                                                    22500013
         USING *,15                                                     22800013
         ENTRY SALRM                                                    23100013
SALRM    B     DCTR1                                                    23400013
         USING *,15                                                     23700013
         ENTRY GSPRD                                                    24000013
GSPRD    B     DCTR1                                                    24300013
         USING *,15                                                     24600013
         ENTRY RCURS                                                    24900013
RCURS    B     DCTR1                                                    25200013
         USING *,15                                                     25500013
         ENTRY ICURS                                                    25800013
ICURS    B     DCTR1                                                    26100013
         USING *,15                                                     26400013
         ENTRY SDATM                                                    26700013
SDATM    B     DCTR1                                                    27000013
         USING *,15                                                     27300013
         ENTRY SGRAM                                                    27600013
SGRAM    B     DCTR1                                                    27900013
         USING *,15                                                     28200013
         ENTRY SDATL                                                    28500013
SDATL    B     DCTR1                                                    28800013
         USING *,15                                                     29100013
         ENTRY SGDSL                                                    29400013
SGDSL    B     DCTR1                                                    29700013
         USING *,15                                                     30000013
         ENTRY SSCIS                                                    30300013
SSCIS    B     DCTR1                                                    30600013
         USING *,15                                                     30900013
         ENTRY SCHAM                                                    31200013
SCHAM    B     DCTR1                                                    31500013
         USING *,15                                                     31800013
         ENTRY PLINE                                                    32100013
PLINE    B     DCTR1                                                    32400013
         USING *,15                                                     32700013
         ENTRY PPNT                                                     33000013
PPNT     B     DCTR1                                                    33300013
         USING *,15                                                     33600013
         ENTRY PSGMT                                                    33900013
PSGMT    B     DCTR1                                                    34200013
         USING *,15                                                     34500013
         ENTRY PTEXT                                                    34800013
PTEXT    B     DCTR1                                                    35100013
         USING *,15                                                     35400013
         ENTRY STPOS                                                    35700013
STPOS    B     DCTR1                                                    36000013
         USING *,15                                                     36300013
         ENTRY MVPOS                                                    36600013
MVPOS    B     DCTR1                                                    36900013
         USING *,15                                                     37200013
         ENTRY BGSEQ                                                    37500013
BGSEQ    B     DCTR1                                                    37800013
         USING *,15                                                     38100013
         ENTRY BGSUB                                                    38400013
BGSUB    B     DCTR1                                                    38700013
         USING *,15                                                     39000013
         ENTRY ENSEQ                                                    39300013
ENSEQ    B     DCTR1                                                    39600013
         USING *,15                                                     39900013
         ENTRY ENSUB                                                    40200013
ENSUB    B     DCTR1                                                    40500013
         USING *,15                                                     40800013
         ENTRY LKSUB                                                    41100013
LKSUB    B     DCTR1                                                    41400013
         USING *,15                                                     41700013
         ENTRY INCL                                                     42000013
INCL     B     DCTR1                                                    42300013
         USING *,15                                                     42600013
         ENTRY OMIT                                                     42900013
OMIT     B     DCTR1                                                    43200013
         USING *,15                                                     43500013
         ENTRY EXEC                                                     43800013
EXEC     B     DCTR1                                                    44100013
         USING *,15                                                     44400013
         ENTRY RESET                                                    44700013
RESET    B     DCTR1                                                    45000013
         USING *,15                                                     45300013
         ENTRY IDPOS                                                    45600013
IDPOS    B     DCTR1                                                    45900013
         USING *,15                                                     46200013
         ENTRY FSMOD                                                    46500013
FSMOD    B     DCTR1                                                    46800013
         USING *,15                                                     47100013
         ENTRY STEOS                                                    47400013
STEOS    B     DCTR1                                                    47700013
         USING *,15                                                     48000013
         ENTRY ORGDS                                                    48300013
ORGDS    B     DCTR1                                                    48600013
         USING *,15                                                     48900013
         ENTRY LOCPN                                                    49200013
LOCPN    B     DCTR1                                                    49500013
         USING *,15                                                     49800013
         ENTRY BGTRK                                                    50100013
BGTRK    B     DCTR1                                                    50400013
         USING *,15                                                     50700013
         ENTRY RDTRK                                                    51000013
RDTRK    B     DCTR1                                                    51300013
         USING *,15                                                     51600013
         ENTRY ENTRK                                                    51900013
ENTRK    B     DCTR1                                                    52200013
         USING *,15                                                     52500013
         ENTRY DFSTR                                                    52800013
DFSTR    B     DCTR1                                                    53100013
         USING *,15                                                     53400013
         ENTRY PLSTR                                                    53700013
PLSTR    B     DCTR1                                                    54000013
         USING *,15                                                     54300013
         ENTRY ORGEN                                                    54600013
ORGEN    B     DCTR1                                                    54900013
         USING *,15                                                     55200013
         ENTRY CNVRT                                                    55500013
CNVRT    B     DCTR1                                                    55800013
         USING *,15                                                     56100013
         ENTRY ITRC                                                     56400013
ITRC     B     DCTR1                                                    56700013
         USING *,15                                                     57000013
         ENTRY ITBP                                                     57300013
ITBP     B     DCTR1                                                    57600013
         USING *,15                                                     57900013
         ENTRY RTBP                                                     58200013
RTBP     B     DCTR1                                                    58500013
         USING *,15                                                     58800013
         ENTRY ITST                                                     59100013
ITST     B     DCTR1                                                    59400013
         USING *,15                                                RSTG 59470016
         ENTRY SPEC                                                RSTG 59540016
SPEC     B     DCTR1                                               RSTG 59610016
* REGISTER EQUATES***************************************************** 59700013
R1       EQU   1                                                        60000013
R2       EQU   2                                                        60300013
R3       EQU   3                                                        60600013
R4       EQU   4                                                        60900013
R9BASE   EQU   9                                                        61200013
R15      EQU   15                                                       61500013
         EJECT                                                          61800013
DCTR1    SAVE  (14,12)                                                  62100013
*                                                                       62400013
*NOTE DIRECTOR1 DOES NOT CONTAIN A SAVE AREA OR CHANGE REG 13           62700013
*                                                                       63000013
         BALR  R9BASE,0                                                 63300013
         USING *,R9BASE                                                 63600013
         L     R2,0(R1)                GET ADDRESS OF FIRST PARAMETER,  63900013
         L     R2,0(R2)                CONTENTS MUST BE CNTRLBLK ADDR   64200013
         USING CBSECT,R2               GENERAL CONTROL BLOCK DSECT      64500013
         CLI   CBID,X'F2'              X'F2' IS GSP CONTROL BLOCK ID    64800013
         BNE   ERR1                    BRANCH IF NOT A GSP CNTRL BLOCK  65100013
*CONTROL BLOCK ID'S ARE                                                 65400013
*                                                                       65700013
* GSPCB  X'01'                                                          66000013
* GTMCB  X'02'                                                          66300013
* GDSCB  X'03'                                                          66600013
* ATLCB  X'04'                                                          66900013
         CLI   CBCBID,X'00'                                             67200013
         BE    ERR1                                                     67500013
         CLI   CBCBID,X'02'                                             67800013
         BL    GSPDC030                BRANCH IF GSPCB                  68100013
         BE    GSPDC020                BRANCH IF GTMCB                  68400013
         CLI   CBCBID,X'04'                                             68700013
         BL    GSPDC010                BRANCH IF GDSCB                  69000013
         BE    GSPDC040                BRANCH IF ATLCB                  69300013
         DROP  R2                                                       69600013
*                                                                       69900013
*INVALID CONTROL BLOCK                                                  70200013
*                                                                       70500013
*GSPCB CANNOT BE LOCATED, DIRECTOR PART 2 CANNOT BE LOCATED,            70800013
*                                                                       71100013
*RETURN ARRAY CANNOT BE LOCATED.                                        71400013
*                                                                       71700013
*                                                                       72000013
ERR1     L     R1,0(R1)                                                 72300013
         XC    0(4,R1),0(R1)           SET VARIABLE TO ZERO IF INVALID  72600013
         RETURN (14,12),T                                               72900013
         EJECT                                                          73200013
*                                                                       73500013
*HERE FOR GDSCB                                                         73800013
*                                                                       74100013
         USING GDSCB,R2                                                 74400013
GSPDC010 L     R2,GDSGTMCB             GET GTMCB FROM GDSCB             74700013
         DROP  R2                                                       75000013
*                                                                       75300013
*HERE FOR GTMCB                                                         75600013
*                                                                       75900013
         USING GTMCB,R2                                                 76200013
GSPDC020 L     R2,GTMGSPCB             GET GSPCB FROM GTMCB             76500013
         DROP  R2                                                       76800013
*                                                                       77100013
*HERE FOR GSPCB                                                         77400013
*                                                                       77700013
         USING GSPCB,R2                                                 78000013
GSPDC030 LA    R3,0(R15)                                                78300013
         L     R4,TOPTBLAD             GET ADDRESS OF FIRST ENTRY       78600013
         SR    R3,R4                   FORM DIFFERENCE NUMBER.  THIS    78900013
*                                      NUMBER IS USED AGAINST STATUS    79200013
*                                      TABLE IN DIEECTOR 2 TO LOCATE    79500013
*                                      ROUTINE REQUESTED.               79800013
         L     R9BASE,GSPDCTR2         GET ADDRESS OF DIRECTOR PART2    80100013
         BR    R9BASE                  GO TO DIRECTOR PART2             80400013
         DROP  R2                                                       80700013
*                                                                       81000013
*HERE IF ATLCB                                                          81300013
*                                                                       81600013
         USING ATTNLEVL,R2                                              81900013
GSPDC040 L     R2,ATTNBKPT             PICK UP BACK POINTER             82200013
         DROP  R2                                                       82500013
         USING GTMCB,R2                                                 82800013
         CLI   GTMTERID,X'02'          TEST IF POINTING AT GTMCB        83100013
         BE    GSPDC020                BRANCH IF YES                    83400013
         B     GSPDC040                ELSE, CONTINUE TILL FOUND        83700013
         EJECT                                                          84000013
*CONSTANTS AND DUMMY SECTIONS                                           84300013
TOPTBLAD DC    A(IHCGSP03)             ADDRESS OF TOP OF TABLE          84600013
CBSECT   DSECT                                                          84900013
         DS    2F                                                       85200013
CBID     DS    XL1           ALL CONTROL BLKS HAVE X'F2' HERE           85500013
CBCBID   DS    XL1           VALUE IS X'01'-X'04' FOR GSP CONTROL BLOCK 85800013
         COPY  GSPCB                                                    86100013
         COPY  GTMCB                                                    86400013
         COPY  GDSCB                                                    86700013
         COPY  ATTNLEVL                                                 87000013
         END                                                            87300013
./  ADD  SSI=31381021,NAME=IHCGSP04
         TITLE 'IHCGSP04'                                               00800002
*STATUS: CHANGE LEVEL 000                                               01200002
*FUNCTION/OPERATION: CONVERTS USER DATA TO SPECIFIED FORMAT             01600002
*   ACCORDING TO USER-SPECIFIED CODE.  VALID CODES:                     02000002
*   101-FLT PT TO EBCDIC, E FORMAT                                      02400002
*   102-FLT PT TO INTEGER, F FORMAT                                     02800002
*   103-INTEGER TO EBCDIC, I FORMAT                                     03200002
*   104-HEX TO EBCDIC, Z FORMAT                                         03600002
*   201-EBCDIC, E FORMAT, TO FLT PT                                     04000002
*   202-EBCDIC, F FORMAT, TO FLT PT                                     04400002
*   203-EBCDIC, I FORMAT, TO INTEGER                                    04800002
*   204-EBCDIC, Z FORMAT, TO HEX                                        05200002
*ENTRY POINT: BCNV                                                      05600002
*INPUT: REGISTER 1 CONTAINS TH ADDRESS OF A PARAMETER LIST              06000002
*   CONSISTING OF:                                                      06400002
*   +0 -A(INPUT)                                                        06800002
*   +4 -A(OUTPUT)                                                       07200002
*   +8 -A(CONVERSION CODE)                                              07600002
*   +12-A(WIDTH OF EBCDIC FIELD)                                        08000002
*   +16-A(DEC LGTH OF FRACTION FOR F AND E FORMATS)                     08400002
*OUTPUT: CONVERTED DATA IN USER'S OUTPUT AREA                           08800002
*EXTERNAL ROUTINES: IHCFCOMH (FORTRAN CONVERSION ROUTINE);              09200002
*   IHCERRM (FORTRAN ERROR-HANDLING ROUTINE)                            09600002
*EXITS-NORMAL: RETURN TO CALLER VIA REG 14                              10000002
*     -ERROR: RETURN TO CALLER WITH FORTRAN ERROR MESSAGE               10400002
*TABLES/WORKAREAS: NONE                                                 10800002
*ATTRIBUTES: NON-REENTRANT, SERIALLY REUSABLE                           11200002
*NOTES: NONE                                                            11600002
*  ****************************************************************TMGA 12000002
         EJECT                                                          12400002
IHCGSP04 CSECT                                                          12800002
*A585000-586000,689000-690000,C668000-672000                     A34723 12820002
*C616200,A616300-616400,C654000,A654500-655000,              LD YA00800 12850002
*A869000-869500                                              LD YA00800 12900002
         ENTRY BCNV                                                     13200002
         EXTRN IBCOM#                                            A34723 13250002
BCNV     SAVE  (14,12)                                             TMGA 13600002
         BALR  BASE,0                                              TMGA 14000002
         USING *,BASE                                              TMGA 14400002
         LA    REGA,SAVE           CHAIN SAVE AREAS                TMGA 14800002
         ST    REGA,8(R13)                                         TMGA 15200002
         ST    R13,SAVE+4                                          TMGA 15600002
         LR    R13,REGA                                            TMGA 16000002
*                                                                  TMGA 16400002
         L     REGE,0(PARM)        INPUT                           TMGA 16800002
         L     REGB,4(PARM)        OUTPUT                          TMGA 17200002
         L     REGA,8(PARM)                                        TMGA 17600002
         L     REGA,0(REGA)        CONVERSION CODE                 TMGA 18000002
         L     REGG,12(PARM)       WIDTH                           TMGA 18400002
         L     REGG,0(REGG)                                        TMGA 18800002
         LTR   REGG,REGG                                           TMGA 19200002
         BNH   ERR                                                 TMGA 19600002
         CH    REGG,C255                                           TMGA 20000002
         BH    ERR                                                 TMGA 20400002
         CH    REGA,C204                                           TMGA 20800002
         BE    BCNV0040                                            TMGA 21200002
         CH    REGA,C104                                           TMGA 21600002
         BNE   BCNV0090                                            TMGA 22000002
*                                  CONVERSION OF HEXIDECIMAL TO Z FTMGA 22400002
         SR    REGF,REGF           ZERO OUT REGISTER               TMGA 22800002
         L     REGE,0(REGE)        PLACE INPUT IN REGISTER         TMGA 23200002
         LA    REGI,8              LENGTH OF INPUT IN HALF BYTES   TMGA 23600002
BCNV0010 BCTR  REGG,0              REDUCE OUTPUT BY 1              TMGA 24000002
         LTR   REGG,REGG           MINUS-WE'RE DONE                TMGA 24400002
         BM    BCNVEXIT            EXIT                            TMGA 24800002
         BCTR  REGI,0              REDUCE BY 1                     TMGA 25200002
         LTR   REGI,REGI           IF MINUS, 8 ARE DONE            TMGA 25600002
         BM    BCNV0020                                            TMGA 26000002
         SRDL  REGE,4              SHIFT OFF  4                    TMGA 26400002
         SRL   REGF,28             POSITION TO USE AS INDEX        TMGA 26800002
         IC    REGF,TRTAB1(REGF)   PICK UP CHARACTER               TMGA 27200002
         STC   REGF,0(REGG,REGB)   PLACE IN OUTPUT                 TMGA 27600002
         B     BCNV0010            CONTINUE                        TMGA 28000002
*                                                                  TMGA 28400002
*                                                                  TMGA 28800002
BCNV0020 IC    REGF,BLANK          PICK UP A BLANK                 TMGA 29200002
BCNV0030 STC   REGF,0(REGG,REGB)   BLANK REMAINING FIELD           TMGA 29600002
         BCTR  REGG,0                                              TMGA 30000002
         LTR   REGG,REGG           DONE                            TMGA 30400002
         BNL   BCNV0030            NO                              TMGA 30800002
BCNVEXIT L     R13,4(R13)                                          TMGA 31200002
         RETURN (14,12)                                            TMGA 31600002
         EJECT                                                          32000002
BCNV0040 SR    REGH,REGH           ZERO RESULT REGISTER            TMGA 32400002
         SR    REGF,REGF           COUNTER                         TMGA 32800002
         SR    REGI,REGI           TRANSLATE INDEX                 TMGA 33200002
         SR    REGA,REGA           COUNTER                         TMGA 33600002
         STC   REGI,SW                                             TMGA 34000002
BCNV0050 CH    REGA,H8             8 VALID DONE                    TMGA 34400002
         BE    BCNV0070            YES                             TMGA 34800002
         IC    REGI,0(REGF,REGE)   PICK UP EBCDIC CHARACTER        TMGA 35200002
         CH    REGI,BLK            IS IT BLANK                     TMGA 35600002
         BE    BCNV0080                                            TMGA 36000002
         N     REGI,AND            AND OFF ZONE-EXCEPT 1 BIT IF THETMGA 36400002
         IC    REGI,TRTAB2(REGI)   PICK UP NEW CHAR                TMGA 36800002
         SLL   REGI,28             SHIFT 4 SIGNIFICANT BITS TO TOP TMGA 37200002
         SLDL  REGH,4              SHIFT INTO REGISTER CONT. HEX NUTMGA 37600002
         OI    SW,VLD              SET SW VALID NUMBER PROCESSED   TMGA 38000002
         LA    REGA,1(REGA)                                        TMGA 38400002
BCNV0060 LA    REGF,1(REGF)                                        TMGA 38800002
         BCT   REGG,BCNV0050                                       TMGA 39200002
BCNV0070 ST    REGH,0(REGB)        STORE CONV IN OUTPUT AREA       TMGA 39600002
         B     BCNVEXIT            EXIT                            TMGA 40000002
*                                                                  TMGA 40400002
BCNV0080 TM    SW,VLD              VALID CHARS ENCOUNTERED         TMGA 40800002
         BO    BCNV0070            YES WE'RE DONE                  TMGA 41200002
         B     BCNV0060            NO WE HAVEN'T STARTED YET       TMGA 41600002
*                                                                  TMGA 42000002
BCNV0090 STC   REGG,WW             WIDTH IN PARM LIST              TMGA 42400002
         TM    12(PARM),X'80'      LAST PARM                       TMGA 42800002
         BO    BCNV0115            YES                             TMGA 43200002
         L     REGF,16(PARM)                                       TMGA 43600002
         MVC   DD(1),3(REGF)       DECIMAL INPARAMETER LIST        TMGA 44000002
BCNV0100 MVI   SS,X'00'            SET SCALE FACTOR=0              TMGA 44400002
         CH    REGA,C200                                           TMGA 44800002
         BE    ERR                                                 TMGA 45200002
         BNL   BCNV0120                                            TMGA 45600002
         SH    REGA,C100                                           TMGA 46000002
         CH    REGA,C4                                             TMGA 46400002
         BNL   ERR                                                 TMGA 46800002
         CH    REGA,C0             VALID INPUT                     TMGA 47200002
         BNH   ERR                 NO                              TMGA 47600002
         MVI   0(REGB),X'40'       BLANK BUFFER                    TMGA 48000002
         BCTR  REGG,0              REDUCE BY TWO                   TMGA 48400002
         BCTR  REGG,0                                              TMGA 48800002
         LTR   REGG,REGG           ONLY EQUAL 1 ORIG               TMGA 49200002
         BM    BCNV0110            BYPASS MOVE                     TMGA 49600002
         EX    REGG,MOVE           MOVE IN REST OF BLANKS          TMGA 50000002
BCNV0110 LA    REGC,4                                              TMGA 50400002
         B     BCNV0130                                            TMGA 50800002
         EJECT                                                          51200002
BCNV0115 MVC   DD(1),C0                                            TMGA 51600002
         B     BCNV0100                                            TMGA 52000002
*                                                                  TMGA 52400002
BCNV0120 SH    REGA,C200                                           TMGA 52800002
         CH    REGA,C4             VALID CODE                      TMGA 53200002
         BNL   ERR                                                 TMGA 53600002
         LR    REGG,REGE           SWITCH INPUT/OUTPUT REG         TMGA 54000002
         LR    REGE,REGB           CORE ADDR IN REGE               TMGA 54400002
         LR    REGB,REGG           EBCDIC BUFFER ADDR IN REGB      TMGA 54800002
         SR    REGC,REGC                                           TMGA 55200002
BCNV0130 IC    REGD,LLTAB(REGA)    LENGTH ALWAYS 4                 TMGA 55600002
         STC   REGD,LL                                             TMGA 56000002
         IC    REGA,ADCONTAB(REGA)                                 TMGA 56400002
         AR    REGA,REGC           ADD 4 FOR INPUT TO EBCDIC       TMGA 56800002
         L     PARM,VADCON         ADCON TABLE                     TMGA 57200002
         L     PARM,0(PARM,REGA)   ENTRY ADDR                      TMGA 57600002
         LR    REGC,PARM                                           TMGA 58000002
         LR    REGA,REGE                                           TMGA 58400002
         L     REGE,ADIBCOM           ADDRESS OF IBCOM           A34723 58500002
         STM   R14,R13,FORTSAVE(REGE) SAVE REGS IN IBCOM         A34723 58600002
         TM    LL,X'40'            I CONVERSION                    TMGA 58800002
         BO    BCNV0140                                            TMGA 59200002
         BALR  REGG,0              ADDR OF CALLING SEQ             TMGA 59600002
CALLSEQ  BALR  REG0,PARM                                           TMGA 60000002
LL       DC    X'00'                                               TMGA 60400002
WW       DC    X'00'                                               TMGA 60800002
DD       DC    X'00'                                               TMGA 61200002
SS       DC    X'00'                                               TMGA 61600002
         OI    FORTSAVE(REGE),FORTFLGS  SET FLAGS SO...      LD YA00800 61620002
*                                       FORTRAN WILL KNOW... LD YA00800 61630002
*                                       WE HAVE EXITED       LD YA00800 61640002
         B     BCNVEXIT                                            TMGA 62000002
*                                                                  TMGA 62400002
BCNV0140 MVC   LL1,LL                                              TMGA 62800002
         MVC   WW1,WW                                              TMGA 63200002
         XI    LL1,X'40'                                           TMGA 63600002
         STM   14,13,FORTSAVE(REGE)                              A34723 63650002
         BALR  REGG,0                                              TMGA 64000002
CALLSEQ1 BALR  REG0,PARM                                           TMGA 64400002
LL1      DC    X'00'                                               TMGA 64800002
WW1      DC    X'00'                                               TMGA 65200002
         OI    FORTSAVE(REGE),FORTFLGS  SET FLAGS SO...      LD YA00800 65400002
*                                       FORTRAN WILL KNOW... LD YA00800 65450002
*                                       WE HAVE EXITED       LD YA00800 65500002
         B     BCNVEXIT                                            TMGA 65600002
         EJECT                                                          66000002
* THE FOLLOWING CODE SETS UP A PARAMETER LIST AND BALR'S TO THE    TMGA 66400002
* FORTRAN ERROR HANDLING MODULE-FORTRAN LINKAGE CONVENTIONS ARE  A34723 66800002
* FOLLOWED, USING IBCOM= PLUS 7C FOR REGISTER,SAVE AREA          A34723 67200002
*                                                                  TMGA 67600002
ERR      EQU   *                                                   TMGA 68000002
         LA    PARM,ERRLIST        POINTER TO MSG LENGTH           TMGA 68400002
         L     R15,ADERRMON        ADDRESS OF ERRMON               TMGA 68800002
         L     REGE,ADIBCOM           ADDRESS 0F IBCOM           A34723 68820002
         STM   14,13,FORTSAVE(REGE)                              A34723 68850002
         BALR  R14,R15             BRANCH                          TMGA 69200002
         B     BCNVEXIT            RETURN TO CALLER                TMGA 69600002
*                                                                  TMGA 70000002
ERRLIST  DC    A(MSGLNGTH)                                         TMGA 70400002
         DC    A(RETCODE)                                          TMGA 70800002
         DC    A(ERRNBR)                                           TMGA 71200002
         DC    X'80'                                               TMGA 71600002
         DC    AL3(ERRNBR)                                         TMGA 72000002
MSGLNGTH DC    A(MSG-ENDMSG)                                       TMGA 72400002
MSG      DC    C'IHC302I IBCOM - PARAM ERROR IN CALL TO BCNV'      TMGA 72800002
ENDMSG   EQU   *                                                   TMGA 73200002
RETCODE  DS    F                                                   TMGA 73600002
         LM    14,13,FORTSAVE(REGE)                              A34723 73650002
ERRNBR   DC    F'302'                                              TMGA 74000002
         EJECT                                                          74400002
REG0     EQU   0                                                   TMGA 74800002
PARM     EQU   1                                                   TMGA 75200002
REGA     EQU   2                                                   TMGA 75600002
REGB     EQU   3                                                   TMGA 76000002
REGC     EQU   4                                                   TMGA 76400002
REGD     EQU   5                                                   TMGA 76800002
REGE     EQU   6                                                   TMGA 77200002
REGF     EQU   7                                                   TMGA 77600002
REGG     EQU   8                                                   TMGA 78000002
BASE     EQU   9                                                   TMGA 78400002
REGH     EQU   10                                                  TMGA 78800002
REGI     EQU   11                                                  TMGA 79200002
R13      EQU   13                                                  TMGA 79600002
R14      EQU   14                                                  TMGA 80000002
R15      EQU   15                                                  TMGA 80400002
*                                                                  TMGA 80800002
BLK      DC    H'64'                                               TMGA 81200002
         DS    0F                                                  TMGA 81600002
AND      DC    X'0000001F'                                         TMGA 82000002
C255     DC    H'255'                                              TMGA 82400002
C104     DC    H'104'                                              TMGA 82800002
C204     DC    H'204'                                              TMGA 83200002
C0       DC    H'0'                                                TMGA 83600002
H8       DC    H'8'                                                TMGA 84000002
SAVE     DS    18F                                                 TMGA 84400002
SW       DC    X'0'                                                TMGA 84800002
BLANK    DC    C' '                                                TMGA 85200002
TRTAB1   DC    C'0123456789ABCDEF'                                 TMGA 85600002
TRTAB2   DC  X'000A0B0C0D0E0F00000000000000000000010203040506070809'    86000002
*                0102030405060708090A0B0C0D0E0F10111213141516171819     86400002
VLD      EQU   X'01'                                               TMGA 86800002
FORTSAVE EQU   X'7C'              DISPLACEMENT FOR SAVE AREA     A34723 86850002
FORTFLGS EQU   X'FF'         FLAGS TO INDICATE WE'VW EXITED  LD YA00800 86900002
*                            FROM THE FORTRAN I/O ROUTINE    LD YA00800 86950002
C200     DC    H'200'                                              TMGA 87200002
C4       DC    H'4'                                                TMGA 87600002
MOVE     MVC   1(0,REGB),0(REGB)                                   TMGA 88000002
C100     DC    H'100'                                              TMGA 88400002
LLTAB    DC    X'00040444'                                         TMGA 88800002
*                   E F I - 4 BIT ON FOR INTEGER                   TMGA 89200002
ADCONTAB DC    X'00080020'                                         TMGA 89600002
*                   E F I                                          TMGA 90000002
VADCON   DC    V(ADCON#)                                           TMGA 90400002
ADERRMON DC    V(ERRMON)                                           TMGA 90800002
ADIBCOM  DC    A(IBCOM#)          FORT COMMUNICATIONS AREA       A34723 90850002
         END                                                            91200002
./  ADD  SSI=20750103,NAME=IHDGSP01
         SPACE 3                                                        00700021
*                                                                       01400021
*  MODULE      IHDGSP01                                                 02100021
*                                                                       02800021
*  TITLE       INITIATE GRAPHIC SUBROUTINE PACKAGE                      03500021
*                                                                       04200021
*  LEVEL       001                                                      04900021
*                                                                       05600021
*  FUNCTION    INITIALIZES GSPCB, ELIMINATING NEED FOR IFFAAA01         06300021
*                                                                       07000021
*  ENTRY       FROM           COBOL    PROGRAM                          07700021
*              AT             INGSP                                     08400021
*                                                                       09100021
*  EXITS       NORMAL         TO CALLER, RETURN CODE = 0                09800021
*              ERROR          TO CALLER, ARG 1 SET TO 0.                10500021
*                                                                       11200021
*  EXT REF     MODULES        NONE                                      11900021
*                                                                       12600021
*              MACROS         GETMAIN            SAVE                   13300021
*                             FREEMAIN           RETURN                 14000021
*                             LOAD                                      14700021
*                                                                       15400021
*  INPUT       REG 1          POINTER TO LIST OF ARGUMENT ADDRESSES     16100021
*                                                                       16800021
*                                 ARG 1 ADDRESS OF FIELD INTO WHICH     17500021
*                                       GSPCB ADDRESS IS PLACED         18200021
*                                                                       18900021
*                                 ARG 2 ADDRESS OF NULL VALUE           19600021
*                                                                       20300021
*                                 ARG 3 OPTIONAL, ADDR OF ERROR EXIT    20400021
*                                       ROUTINE                         20500021
*                                                                       20600021
*              REG 13-15      OS CONVENTIONAL USE OF SAVE,              21000021
*                             RETURN, AND ENTRY POINT.                  21700021
*                                                                       22400021
*  OUTPUT      TO USER        ADDRESS OF GSPCB PUT INTO ARG 1           23100021
*                                                                       23800021
         EJECT                                                          24500021
         SPACE 3                                                        25200021
*************************    REGISTERS      **************************  25900021
         SPACE 2                                                        26600021
R0ADR    EQU   0         ENTRY POINT ADDRESS OF LOADED ROUTINE          27300021
R0SIZE   EQU   0         SIZE OF CORE REQUESTED                         28000021
R1PARM   EQU   1         SYSTEM PARAMETERS                              28700021
R2GSPCB  EQU   2         ADDRESS OF GSPCB, SEE DSECT DEFINITION         29400021
R7PLIST  EQU   7         ADDRESS OF  LIST CONTAINING ADDRESSES OF ARGS  30100021
R9BASE   EQU   9         USED DURING MACRO EXPANSIONS                   30800021
R10WORKA EQU   10        ADDRESS OF ARG 1                               31500021
R11WORKB EQU   11                                                       32200021
R13SAVE  EQU   13        USED BY LINK MACRO                             32900021
R14BACK  EQU   14                                                       33600021
R15EP    EQU   15                                                       34300021
         SPACE 2                                                        35000021
*************************    CONSTANTS      **************************  35700021
         SPACE                                                          36400021
ID       EQU   X'01'          GSPCB ID IS F201                          37100021
F2       EQU   X'F2'                                                    37800021
PERMWK   EQU   1024           1K WORK AREA ALLOWS CONTIGUOUS OVERLAP    38500021
*                                  FOR SUBROUTINE COMMUNICATION         39200021
         SPACE 2                                                        39900021
********************    DISPLACEMENT      CONSTANTS   ****************  40600021
         SPACE                                                          41300021
ARG1     EQU   0         DISPLACEMENT WITHIN ARG 1 FOR GSPCB ADDRESS    42000021
ARG1ADR  EQU   0         DISPLACEMENT WITHIN ARG LIST OF ARG 1          42700021
ARG2ADR  EQU   4         DISPLACEMENT WITHIN ARG LIST OF ARG 2          43400021
ARG3ADR  EQU   8         DISPLACEMEN WITHIN ARG LIST OF ARG 3           44100021
HSA      EQU   4         SAVE AREA DISPLACEMENT FOR ADR OF HIGHER SAVE  44800021
HYBYTE   EQU   0         DISPLACEMENT FOR ROUTINE ADDR            M1097 44850000
WKDISPL  EQU   4         WORK AREA BEGINS AFTER GSPCB                   45500021
         EJECT                                                          46200021
IHDGSP01 CSECT                                                          46900021
*A448500,A651500                                                  M1097 46950000
         ENTRY INGSP                                                    47600021
INGSP    SAVE  (14,12)                                                  48300021
         BALR  R9BASE,0                     ESTABLISH BASE FOR MACROS   49000021
         USING *,R9BASE                                                 49700021
         SPACE                                                          50400021
         LR    R7PLIST,R1PARM               SAVE ADDR LIST              51100021
         LA    R0SIZE,PERMWK                GET WORK AREA               51800021
         SPACE                                                          52500021
         GETMAIN R,LV=(0)                                               53200021
         SPACE                                                          53900021
         LR    R2GSPCB,R1PARM               GSPCB ESTABLISHED           54600021
         USING GSPCB,R2GSPCB                                            55300021
         XC    GSPCB(GSPCBLNG),GSPCB           PRESET TO ZEROS          56000021
         SPACE 2                                                        56700021
*      PROCESS ARGUMENT 1,GSPCB ADDRESS                                 57400021
         SPACE                                                          58100021
         L     R10WORKA,ARG1ADR(R7PLIST)    GET ADR OF ARG 1            58800021
         LTR   R10WORKA,R10WORKA               CHECK IF ONLY ARG        59500021
         BM    INGSP020                        IF YES, ERROR            60200021
         ST    R2GSPCB,ARG1(R10WORKA)          KEEP GSPCB ADR IN ARG 1  60900021
         SPACE 2                                                        61600021
*      PROCESS ARGUMENT 2, NULL VALUE                                   62300021
         SPACE                                                          63000021
         L     R11WORKB,ARG2ADR(R7PLIST)    GET ADR OF ARG 2            63700021
         LTR   R11WORKB,R11WORKB               CHECK FOR ARG 3          65100021
         LA    R11WORKB,HYBYTE(R11WORKB)     CLEAR HIGH BYTE      M1097 65150021
         ST    R11WORKB,GSPNULLV               KEEP ADDR IN GSPCB       65200021
         BM    INGSP005                      IF NO ARG 3, SKIP          65800021
         SPACE 2                                                        66500021
*      PROCESS ARGUMENT 3, OPTIONAL, ADDRESS OF USER ERROR EXIT ROUTINE 67200021
         SPACE                                                          67900021
         L     R11WORKB,ARG3ADR(R7PLIST)  GET ADR OF ARG 3              68600021
         ST    R11WORKB,GSPAEXIT             KEEP ADDR IN GSPCB         69300021
         EJECT                                                          70000021
*      INITIALIZE GSPCB                                                 70700021
*           1. INSERT CONSTANTS                                         71400021
*           2. INSERT ADDRESS OF LOADED ROUTINES                        72100021
         SPACE                                                          72800021
INGSP005 MVI   GSPSYSID,F2                                              73500021
         MVI   GSPCBID,ID                                               74200021
         LA    R10WORKA,GSPAEXIT+WKDISPL     CALC WORKAREA ADDR         74900021
         ST    R10WORKA,GSPAWORK             KEEP ADDR IN GSPCB         75600021
         ST    R13SAVE,SAVE+HSA             PREPARE FOR OS CONVENTIONS  76300021
         LA    R13SAVE,SAVE                                             77000021
         SPACE 2                                                        77700021
         LOAD  EP=IFFAHA12                                              78400021
         ST    R0ADR,GSPASTAT               KEEP ADDR IN GSPCB          79100021
         SPACE 2                                                        79800021
         LOAD  EP=IFFAHA11                                              80500021
         ST    R0ADR,GSPDCTR2               KEEP ADDR IN GSPCB          81200021
         SPACE                                                          81900021
INGSP010 L     R13SAVE,SAVE+HSA             NORMAL RETURN               82600021
         RETURN (14,12)                                                 83300021
         SPACE 2                                                        84000021
*       ERROR PROCESSING FOR MISSING NULL, ARG 2                        84700021
         SPACE                                                          85400021
INGSP020 XC    ARG1(4,R10WORKA),ARG1(R10WORKA)   SET ARG 1 TO 0.        86100021
         B     INGSP010                          RETURN TO USER         86800021
         COPY  GSPCB                                                    87500021
GSPCBLNG EQU   *-GSPCB             NUMBER OF BYTES IN GSPCB             88200021
SAVE     DS    9D                  SAVE AREA FOR SYSTEM                 88900021
         END                                                            89600021
./  ADD  SSI=20480438,NAME=IHDGSP03
*MODULE NAME   IHDGSP03                                            CDMA 00300021
*                                                                       00600021
*INPUT         OS STANDARD FORMAT                                       00900021
*                                                                       01200021
*              FIRST PARAMETER MUST BE ADDRESS OF FIELD CONTAINING      01500021
*                                                                       01800021
*              ADDRESS OF VALID GSP CONTROL BLOCK                       02100021
*                                                                       02400021
*OUTPUT        NONE TO CALLER                                           02700021
*                                                                       03000021
*ERRORS        ABEND, USER CODE 8 IF INPUT NOT CORRECT (TEMPORARY)      03300021
*                                                                       03600021
*FUNCTION      LOCATES DIRECTOR PART2 FROM GSPCB, AND BRANCHES.         03900021
*                                                                       04200021
*              CONTROL RETURNS DIRECTLY TO USER FROM DIRECTOR 2         04500021
*                                                                       04800021
*OUTPUT TO                                                              05100021
*DIRECTOR 2    REG1 UNCHANGED                                           05400021
*                                                                       05700021
*              REG2 ADDRESS OF GSPCB                                    06000021
*                                                                       06300021
*REG3          DISPLACEMENT NUMBER OF ORIGINAL ENTRY POINT              06600021
*                                                                       06900021
*REG9          ADDRESS OF DIRECTOR 2                                    07200021
*                                                                       07500021
*REG13         UNCHANGED.  REGISTERS HAVE BEEN SAVED                    07800021
         EJECT                                                          08100021
IHDGSP03 CSECT                                                     CDMA 08400021
         USING *,15                                                     08700021
         ENTRY INDEV                                                    09000021
INDEV    B     DCTR1                                                    09300021
         USING *,15                                                     09600021
         ENTRY TMDEV                                                    09900021
TMDEV    B     DCTR1                                                    10200021
         USING *,15                                                     10500021
         ENTRY INGDS                                                    10800021
INGDS    B     DCTR1                                                    11100021
         USING *,15                                                     11400021
         ENTRY TMGDS                                                    11700021
TMGDS    B     DCTR1                                                    12000021
         USING *,15                                                     12300021
         ENTRY CRATL                                                    12600021
CRATL    B     DCTR1                                                    12900021
         USING *,15                                                     13200021
         ENTRY ENATL                                                    13500021
ENATL    B     DCTR1                                                    13800021
         USING *,15                                                     14100021
         ENTRY ENATN                                                    14400021
ENATN    B     DCTR1                                                    14700021
         USING *,15                                                     15000021
         ENTRY DSATN                                                    15300021
DSATN    B     DCTR1                                                    15600021
         USING *,15                                                     15900021
         ENTRY MPATL                                                    16200021
MPATL    B     DCTR1                                                    16500021
         USING *,15                                                     16800021
         ENTRY MLPEO                                                    17100021
MLPEO    B     DCTR1                                                    17400021
         USING *,15                                                     17700021
         ENTRY SLPAT                                                    18000021
SLPAT    B     DCTR1                                                    18300021
         USING *,15                                                     18600021
         ENTRY MLITS                                                    18900021
MLITS    B     DCTR1                                                    19200021
         USING *,15                                                     19500021
         ENTRY RQATN                                                    19800021
RQATN    B     DCTR1                                                    20100021
         USING *,15                                                     20400021
         ENTRY EURATL                                                   20700021
EURATL   B     DCTR1                                                    21000021
         USING *,15                                                     21300021
         ENTRY SETATN                                                   21600021
SETATN   B     DCTR1                                                    21900021
         USING *,15                                                     22200021
         ENTRY SALRM                                                    22500021
SALRM    B     DCTR1                                                    22800021
         USING *,15                                                     23100021
         ENTRY GSPRD                                                    23400021
GSPRD    B     DCTR1                                                    23700021
         USING *,15                                                     24000021
         ENTRY RCURS                                                    24300021
RCURS    B     DCTR1                                                    24600021
         USING *,15                                                     24900021
         ENTRY ICURS                                                    25200021
ICURS    B     DCTR1                                                    25500021
         USING *,15                                                     25800021
         ENTRY SDATM                                                    26100021
SDATM    B     DCTR1                                                    26400021
         USING *,15                                                     26700021
         ENTRY SGRAM                                                    27000021
SGRAM    B     DCTR1                                                    27300021
         USING *,15                                                     27600021
         ENTRY SDATL                                                    27900021
SDATL    B     DCTR1                                                    28200021
         USING *,15                                                     28500021
         ENTRY SGDSL                                                    28800021
SGDSL    B     DCTR1                                                    29100021
         USING *,15                                                     29400021
         ENTRY SSCIS                                                    29700021
SSCIS    B     DCTR1                                                    30000021
         USING *,15                                                     30300021
         ENTRY SCHAM                                                    30600021
SCHAM    B     DCTR1                                                    30900021
         USING *,15                                                     31200021
         ENTRY PLINE                                                    31500021
PLINE    B     DCTR1                                                    31800021
         USING *,15                                                     32100021
         ENTRY PPNT                                                     32400021
PPNT     B     DCTR1                                                    32700021
         USING *,15                                                     33000021
         ENTRY PSGMT                                                    33300021
PSGMT    B     DCTR1                                                    33600021
         USING *,15                                                     33900021
         ENTRY PTEXT                                                    34200021
PTEXT    B     DCTR1                                                    34500021
         USING *,15                                                     34800021
         ENTRY STPOS                                                    35100021
STPOS    B     DCTR1                                                    35400021
         USING *,15                                                     35700021
         ENTRY MVPOS                                                    36000021
MVPOS    B     DCTR1                                                    36300021
         USING *,15                                                     36600021
         ENTRY BGSEQ                                                    36900021
BGSEQ    B     DCTR1                                                    37200021
         USING *,15                                                     37500021
         ENTRY BGSUB                                                    37800021
BGSUB    B     DCTR1                                                    38100021
         USING *,15                                                     38400021
         ENTRY ENSEQ                                                    38700021
ENSEQ    B     DCTR1                                                    39000021
         USING *,15                                                     39300021
         ENTRY ENSUB                                                    39600021
ENSUB    B     DCTR1                                                    39900021
         USING *,15                                                     40200021
         ENTRY LKSUB                                                    40500021
LKSUB    B     DCTR1                                                    40800021
         USING *,15                                                     41100021
         ENTRY INCL                                                     41400021
INCL     B     DCTR1                                                    41700021
         USING *,15                                                     42000021
         ENTRY OMIT                                                     42300021
OMIT     B     DCTR1                                                    42600021
         USING *,15                                                     42900021
         ENTRY EXEC                                                     43200021
EXEC     B     DCTR1                                                    43500021
         USING *,15                                                     43800021
         ENTRY RESET                                                    44100021
RESET    B     DCTR1                                                    44400021
         USING *,15                                                     44700021
         ENTRY IDPOS                                                    45000021
IDPOS    B     DCTR1                                                    45300021
         USING *,15                                                     45600021
         ENTRY FSMOD                                                    45900021
FSMOD    B     DCTR1                                                    46200021
         USING *,15                                                     46500021
         ENTRY STEOS                                                    46800021
STEOS    B     DCTR1                                                    47100021
         USING *,15                                                     47400021
         ENTRY ORGDS                                                    47700021
ORGDS    B     DCTR1                                                    48000021
         USING *,15                                                     48300021
         ENTRY LOCPN                                                    48600021
LOCPN    B     DCTR1                                                    48900021
         USING *,15                                                     49200021
         ENTRY BGTRK                                                    49500021
BGTRK    B     DCTR1                                                    49800021
         USING *,15                                                     50100021
         ENTRY RDTRK                                                    50400021
RDTRK    B     DCTR1                                                    50700021
         USING *,15                                                     51000021
         ENTRY ENTRK                                                    51300021
ENTRK    B     DCTR1                                                    51600021
         USING *,15                                                     51900021
         ENTRY DFSTR                                                    52200021
DFSTR    B     DCTR1                                                    52500021
         USING *,15                                                     52800021
         ENTRY PLSTR                                                    53100021
PLSTR    B     DCTR1                                                    53400021
         USING *,15                                                     53700021
         ENTRY ORGEN                                                    54000021
ORGEN    B     DCTR1                                                    54300021
         USING *,15                                                     54600021
         ENTRY CNVRT                                                    54900021
CNVRT    B     DCTR1                                                    55200021
         USING *,15                                                     55500021
         ENTRY ITRC                                                     55800021
ITRC     B     DCTR1                                                    56100021
         USING *,15                                                     56400021
         ENTRY ITBP                                                     56700021
ITBP     B     DCTR1                                                    57000021
         USING *,15                                                     57300021
         ENTRY RTBP                                                     57600021
RTBP     B     DCTR1                                                    57900021
         USING *,15                                                     58200021
         ENTRY ITST                                                     58500021
ITST     B     DCTR1                                                    58800021
         USING *,15                                                RSTB 58870021
         ENTRY SPEC                                                RSTB 58940021
SPEC     B     DCTR1                                              RSTB  59010021
* REGISTER EQUATES***************************************************** 59100021
R1       EQU   1                                                        59400021
R2       EQU   2                                                        59700021
R3       EQU   3                                                        60000021
R4       EQU   4                                                        60300021
R9BASE   EQU   9                                                        60600021
R15      EQU   15                                                       60900021
         EJECT                                                          61200021
DCTR1    SAVE  (14,12)                                                  61500021
*                                                                       61800021
*NOTE DIRECTOR1 DOES NOT CONTAIN A SAVE AREA OR CHANGE REG 13           62100021
*                                                                       62400021
         BALR  R9BASE,0                                                 62700021
         USING *,R9BASE                                                 63000021
         L     R2,0(R1)                GET ADDRESS OF FIRST PARAMETER,  63300021
         L     R2,0(R2)                CONTENTS MUST BE CNTRLBLK ADDR   63600021
         USING CBSECT,R2               GENERAL CONTROL BLOCK DSECT      63900021
         CLI   CBID,X'F2'              X'F2' IS GSP CONTROL BLOCK ID    64200021
         BNE   ERR1                    BRANCH IF NOT A GSP CNTRL BLOCK  64500021
*CONTROL BLOCK ID'S ARE                                                 64800021
*                                                                       65100021
* GSPCB  X'01'                                                          65400021
* GTMCB  X'02'                                                          65700021
* GDSCB  X'03'                                                          66000021
* ATLCB  X'04'                                                          66300021
         CLI   CBCBID,X'00'                                             66600021
         BE    ERR1                                                     66900021
         CLI   CBCBID,X'02'                                             67200021
         BL    GSPDC030                BRANCH IF GSPCB                  67500021
         BE    GSPDC020                BRANCH IF GTMCB                  67800021
         CLI   CBCBID,X'04'                                             68100021
         BL    GSPDC010                BRANCH IF GDSCB                  68400021
         BE    GSPDC040                BRANCH IF ATLCB                  68700021
         DROP  R2                                                       69000021
*                                                                       69300021
*INVALID CONTROL BLOCK                                                  69600021
*                                                                       69900021
*GSPCB CANNOT BE LOCATED, DIRECTOR PART 2 CANNOT BE LOCATED,            70200021
*                                                                       70500021
*RETURN ARRAY CANNOT BE LOCATED.                                        70800021
*                                                                       71100021
*                                                                       71400021
ERR1     L     R1,0(R1)                                                 71700021
         XC    0(4,R1),0(R1)           SET VARIABLE TO ZERO IF INVALID  72000021
         RETURN (14,12),T                                               72300021
         EJECT                                                          72600021
*                                                                       72900021
*HERE FOR GDSCB                                                         73200021
*                                                                       73500021
         USING GDSCB,R2                                                 73800021
GSPDC010 L     R2,GDSGTMCB             GET GTMCB FROM GDSCB             74100021
         DROP  R2                                                       74400021
*                                                                       74700021
*HERE FOR GTMCB                                                         75000021
*                                                                       75300021
         USING GTMCB,R2                                                 75600021
GSPDC020 L     R2,GTMGSPCB             GET GSPCB FROM GTMCB             75900021
         DROP  R2                                                       76200021
*                                                                       76500021
*HERE FOR GSPCB                                                         76800021
*                                                                       77100021
         USING GSPCB,R2                                                 77400021
GSPDC030 LA    R3,0(R15)                                                77700021
         L     R4,TOPTBLAD             GET ADDRESS OF FIRST ENTRY       78000021
         SR    R3,R4                   FORM DIFFERENCE NUMBER.  THIS    78300021
*                                      NUMBER IS USED AGAINST STATUS    78600021
*                                      TABLE IN DIEECTOR 2 TO LOCATE    78900021
*                                      ROUTINE REQUESTED.               79200021
         L     R9BASE,GSPDCTR2         GET ADDRESS OF DIRECTOR PART2    79500021
         BR    R9BASE                  GO TO DIRECTOR PART2             79800021
         DROP  R2                                                       80100021
*                                                                       80400021
*HERE IF ATLCB                                                          80700021
*                                                                       81000021
         USING ATTNLEVL,R2                                              81300021
GSPDC040 L     R2,ATTNBKPT             PICK UP BACK POINTER             81600021
         DROP  R2                                                       81900021
         USING GTMCB,R2                                                 82200021
         CLI   GTMTERID,X'02'          TEST IF POINTING AT GTMCB        82500021
         BE    GSPDC020                BRANCH IF YES                    82800021
         B     GSPDC040                ELSE, CONTINUE TILL FOUND        83100021
         EJECT                                                          83400021
*CONSTANTS AND DUMMY SECTIONS                                           83700021
TOPTBLAD DC    A(IHDGSP03)                                         CDMA 84000021
CBSECT   DSECT                                                          84300021
         DS    2F                                                       84600021
CBID     DS    XL1           ALL CONTROL BLKS HAVE X'F2' HERE           84900021
CBCBID   DS    XL1           VALUE IS X'01'-X'04' FOR GSP CONTROL BLOCK 85200021
         COPY  GSPCB                                                    85500021
         COPY  GTMCB                                                    85800021
         COPY  GDSCB                                                    86100021
         COPY  ATTNLEVL                                                 86400021
         END                                                            86700021
./  ADD  SSI=20480448,NAME=IHEGSP03
* TITLE        DIRECTOR PART1                                           00300017
*                                                                       00600017
*MODULE NAME   IHEGSP03                                            CDMA 00900017
*                                                                       01200017
* TITLE        DIRECTOR PART1                                           01500017
*                                                                       01800017
*INPUT         OS STANDARD FORMAT                                       02100017
*                                                                       02400017
*              FIRST PARAMETER MUST BE ADDRESS OF FIELD CONTAINING      02700017
*                                                                       03000017
*              ADDRESS OF VALID GSP CONTROL BLOCK                       03300017
*                                                                       03600017
*OUTPUT        NONE TO CALLER                                           03900017
*                                                                       04200017
*ERRORS        ABEND, USER CODE 8 IF INPUT NOT CORRECT (TEMPORARY)      04500017
*                                                                       04800017
*FUNCTION      LOCATES DIRECTOR PART2 FROM GSPCB, AND BRANCHES.         05100017
*                                                                       05400017
*              CONTROL RETURNS DIRECTLY TO USER FROM DIRECTOR 2         05700017
*                                                                       06000017
*OUTPUT TO                                                              06300017
*DIRECTOR 2    REG1 UNCHANGED                                           06600017
*                                                                       06900017
*              REG2 ADDRESS OF GSPCB                                    07200017
*                                                                       07500017
*REG3          DISPLACEMENT NUMBER OF ORIGINAL ENTRY POINT              07800017
*                                                                       08100017
*REG9          ADDRESS OF DIRECTOR 2                                    08400017
*                                                                       08700017
*REG13         UNCHANGED.  REGISTERS HAVE BEEN SAVED                    09000017
         EJECT                                                          09300017
IHEGSP03 CSECT                                                     CDMA 09600017
         USING *,15                                                     09900017
         ENTRY INDEV                                                    10200017
INDEV    B     DCTR1                                                    10500017
         USING *,15                                                     10800017
         ENTRY TMDEV                                                    11100017
TMDEV    B     DCTR1                                                    11400017
         USING *,15                                                     11700017
         ENTRY INGDS                                                    12000017
INGDS    B     DCTR1                                                    12300017
         USING *,15                                                     12600017
         ENTRY TMGDS                                                    12900017
TMGDS    B     DCTR1                                                    13200017
         USING *,15                                                     13500017
         ENTRY CRATL                                                    13800017
CRATL    B     DCTR1                                                    14100017
         USING *,15                                                     14400017
         ENTRY ENATL                                                    14700017
ENATL    B     DCTR1                                                    15000017
         USING *,15                                                     15300017
         ENTRY ENATN                                                    15600017
ENATN    B     DCTR1                                                    15900017
         USING *,15                                                     16200017
         ENTRY DSATN                                                    16500017
DSATN    B     DCTR1                                                    16800017
         USING *,15                                                     17100017
         ENTRY MPATL                                                    17400017
MPATL    B     DCTR1                                                    17700017
         USING *,15                                                     18000017
         ENTRY MLPEO                                                    18300017
MLPEO    B     DCTR1                                                    18600017
         USING *,15                                                     18900017
         ENTRY SLPAT                                                    19200017
SLPAT    B     DCTR1                                                    19500017
         USING *,15                                                     19800017
         ENTRY MLITS                                                    20100017
MLITS    B     DCTR1                                                    20400017
         USING *,15                                                     20700017
         ENTRY RQATN                                                    21000017
RQATN    B     DCTR1                                                    21300017
         USING *,15                                                     21600017
         ENTRY EURATL                                                   21900017
EURATL   B     DCTR1                                                    22200017
         USING *,15                                                     22500017
         ENTRY SETATN                                                   22800017
         USING *,15                                                     23100017
SETATN   B     DCTR1                                                    23400017
         USING *,15                                                     23700017
         ENTRY SALRM                                                    24000017
SALRM    B     DCTR1                                                    24300017
         USING *,15                                                     24600017
         ENTRY GSPRD                                                    24900017
GSPRD    B     DOPEVEC1                                            CDMA 25200017
         USING *,15                                                TMGG 25300017
         ENTRY RCURS                                                    25500017
RCURS    B     DCTR1                                                    25800017
         USING *,15                                                     26100017
         ENTRY ICURS                                                    26400017
ICURS    B     DCTR1                                                    26700017
         USING *,15                                                     27000017
         ENTRY SDATM                                                    27300017
SDATM    B     DCTR1                                                    27600017
         USING *,15                                                     27900017
         ENTRY SGRAM                                                    28200017
SGRAM    B     DCTR1                                                    28500017
         USING *,15                                                     28800017
         ENTRY SDATL                                                    29100017
SDATL    B     DCTR1                                                    29400017
         USING *,15                                                     29700017
         ENTRY SGDSL                                                    30000017
SGDSL    B     DCTR1                                                    30300017
         USING *,15                                                     30600017
         ENTRY SSCIS                                                    30900017
SSCIS    B     DCTR1                                                    31200017
         USING *,15                                                     31500017
         ENTRY SCHAM                                                    31800017
SCHAM    B     DCTR1                                                    32100017
         USING *,15                                                     32400017
         ENTRY PLINE                                                    32700017
PLINE    B     DCTR1                                                    33000017
         USING *,15                                                     33300017
         ENTRY PPNT                                                     33600017
PPNT     B     DCTR1                                                    33900017
         USING *,15                                                     34200017
         ENTRY PSGMT                                                    34500017
PSGMT    B     DCTR1                                                    34800017
         USING *,15                                                     35100017
         ENTRY PTEXT                                                    35400017
PTEXT    B     DOPEVEC1                                            CDMA 35700017
         USING *,15                                                     36000017
         ENTRY STPOS                                                    36300017
STPOS    B     DCTR1                                                    36600017
         USING *,15                                                     36900017
         ENTRY MVPOS                                                    37200017
MVPOS    B     DCTR1                                                    37500017
         USING *,15                                                     37800017
         ENTRY BGSEQ                                                    38100017
BGSEQ    B     DCTR1                                                    38400017
         USING *,15                                                     38700017
         ENTRY BGSUB                                                    39000017
BGSUB    B     DCTR1                                                    39300017
         USING *,15                                                     39600017
         ENTRY ENSEQ                                                    39900017
ENSEQ    B     DCTR1                                                    40200017
         USING *,15                                                     40500017
         ENTRY ENSUB                                                    40800017
ENSUB    B     DCTR1                                                    41100017
         USING *,15                                                     41400017
         ENTRY LKSUB                                                    41700017
LKSUB    B     DCTR1                                                    42000017
         USING *,15                                                     42300017
         ENTRY INCL                                                     42600017
INCL     B     DCTR1                                                    42900017
         USING *,15                                                     43200017
         ENTRY OMIT                                                     43500017
OMIT     B     DCTR1                                                    43800017
         USING *,15                                                     44100017
         ENTRY EXEC                                                     44400017
EXEC     B     DCTR1                                                    44700017
         USING *,15                                                     45000017
         ENTRY RESET                                                    45300017
RESET    B     DCTR1                                                    45600017
         USING *,15                                                     45900017
         ENTRY IDPOS                                                    46200017
IDPOS    B     DCTR1                                                    46500017
         USING *,15                                                     46800017
         ENTRY FSMOD                                                    47100017
FSMOD    B     DCTR1                                                    47400017
         USING *,15                                                     47700017
         ENTRY STEOS                                                    48000017
STEOS    B     DCTR1                                                    48300017
         USING *,15                                                     48600017
         ENTRY ORGDS                                                    48900017
ORGDS    B     DCTR1                                                    49200017
         USING *,15                                                     49500017
         ENTRY LOCPN                                                    49800017
LOCPN    B     DCTR1                                                    50100017
         USING *,15                                                     50400017
         ENTRY BGTRK                                                    50700017
BGTRK    B     DCTR1                                                    51000017
         USING *,15                                                     51300017
         ENTRY RDTRK                                                    51600017
RDTRK    B     DCTR1                                                    51900017
         USING *,15                                                     52200017
         ENTRY ENTRK                                                    52500017
ENTRK    B     DCTR1                                                    52800017
         USING *,15                                                     53100017
         ENTRY DFSTR                                                    53400017
DFSTR    B     DCTR1                                                    53700017
         USING *,15                                                     54000017
         ENTRY PLSTR                                                    54300017
PLSTR    B     DOPEVEC2                                            CDMA 54600017
         USING *,15                                                     54900017
         ENTRY ORGEN                                                    55200017
ORGEN    B     DCTR1                                                    55500017
         USING *,15                                                     55800017
         ENTRY CNVRT                                                    56100017
CNVRT    B     DCTR1                                                    56400017
         USING *,15                                                     56700017
         ENTRY ITRC                                                     57000017
ITRC     B     DCTR1                                                    57300017
         USING *,15                                                     57600017
         ENTRY ITBP                                                     57900017
ITBP     B     DCTR1                                                    58200017
         USING *,15                                                     58500017
         ENTRY RTBP                                                     58800017
RTBP     B     DCTR1                                                    59100017
         USING *,15                                                     59400017
         ENTRY ITST                                                     59700017
ITST     B     DCTR1                                                    60000017
         USING *,15                                                RSTB 60070000
         ENTRY SPEC                                                RSTB 60140000
SPEC     B     DCTR1                                              RSTB  60210000
* REGISTER EQUATES***************************************************** 60300017
R1       EQU   1                                                        60600017
R2       EQU   2                                                        60900017
R3       EQU   3                                                        61200017
R4       EQU   4                                                        61500017
R9BASE   EQU   9                                                        61800017
R15      EQU   15                                                       62100017
         EJECT                                                          62400017
DOPEVEC1 SAVE  (14,12)                                             CDMA 62700017
         BALR  8,0                                                 CDMA 63000017
         USING *,8                                                 CDMA 63300017
         TM    0(1),X'80'                                          CDMA 63600017
         BO    DPDCTR1            BRANCH IF LAST PARAMEYER         CDMA 63900017
         TM    4(1),X'80'                                          CDMA 64200017
         BO    DPDCTR1            BRANCH IF LAST PARAMETER         CDMA 64500017
         L     2,4(1)              ADDR OF STRING DOPE VECTOR      CDMA 64800017
         MVC   5(3,1),1(2)         MOVE ADDR OF STRING TO ARGUMENT LIST 65100017
         B     DPDCTR1                                             CDMA 65400017
DOPEVEC2 SAVE  (14,12)                                             CDMA 65700017
         BALR  8,0                                                 CDMA 66000017
         USING *,8                                                 CDMA 66300017
         TM    0(1),X'80'                                          CDMA 66600017
         BO    DPDCTR1            BRANCH IF LAST PARAMETER         CDMA 66900017
         TM    4(1),X'80'                                          CDMA 67200017
         BO    DPDCTR1            BRANCH IF LAST PARAMETER         CDMA 67500017
         TM    8(1),X'80'                                          CDMA 67800017
         BO    DPDCTR1            BRANCH IF LAST PARAMETER         CDMA 68100017
         L     2,8(1)              ADDR OF STRING DOPE VECTOR      CDMA 68400017
         MVC   9(3,1),1(2)         MOVE ADDR OF STRING TO ARGUMENT LIST 68700017
         B     DPDCTR1                                             CDMA 69000017
DCTR1    SAVE  (14,12)                                                  69300017
*                                                                       69600017
*NOTE DIRECTOR1 DOES NOT CONTAIN A SAVE AREA OR CHANGE REG 13           69900017
*                                                                       70200017
DPDCTR1  BALR  R9BASE,0                                            CDMA 70500017
         USING *,R9BASE                                                 70800017
         DROP  8                                                   CDMA 71100017
         L     R2,0(R1)                GET ADDRESS OF FIRST PARAMETER,  71400017
         L     R2,0(R2)                CONTENTS MUST BE CNTRLBLK ADDR   71700017
         USING CBSECT,R2               GENERAL CONTROL BLOCK DSECT      72000017
         CLI   CBID,X'F2'              X'F2' IS GSP CONTROL BLOCK ID    72300017
         BNE   ERR1                    BRANCH IF NOT A GSP CNTRL BLOCK  72600017
*CONTROL BLOCK ID'S ARE                                                 72900017
*                                                                       73200017
* GSPCB  X'01'                                                          73500017
* GTMCB  X'02'                                                          73800017
* GDSCB  X'03'                                                          74100017
* ATLCB  X'04'                                                          74400017
         CLI   CBCBID,X'00'                                             74700017
         BE    ERR1                                                     75000017
         CLI   CBCBID,X'02'                                             75300017
         BL    GSPDC030                BRANCH IF GSPCB                  75600017
         BE    GSPDC020                BRANCH IF GTMCB                  75900017
         CLI   CBCBID,X'04'                                             76200017
         BL    GSPDC010                BRANCH IF GDSCB                  76500017
         BE    GSPDC040                BRANCH IF ATLCB                  76800017
         DROP  R2                                                       77100017
*                                                                       77400017
*INVALID CONTROL BLOCK                                                  77700017
*                                                                       78000017
*GSPCB CANNOT BE LOCATED, DIRECTOR PART 2 CANNOT BE LOCATED,            78300017
*                                                                       78600017
*RETURN ARRAY CANNOT BE LOCATED.                                        78900017
*                                                                       79200017
*                                                                       79500017
ERR1     L     R1,0(R1)                                                 79800017
         XC    0(4,R1),0(R1)           SET VARIABLE TO ZERO IF INVALID  80100017
         RETURN (14,12),T                                               80400017
         EJECT                                                          80700017
*                                                                       81000017
*HERE FOR GDSCB                                                         81300017
*                                                                       81600017
         USING GDSCB,R2                                                 81900017
GSPDC010 L     R2,GDSGTMCB             GET GTMCB FROM GDSCB             82200017
         DROP  R2                                                       82500017
*                                                                       82800017
*HERE FOR GTMCB                                                         83100017
*                                                                       83400017
         USING GTMCB,R2                                                 83700017
GSPDC020 L     R2,GTMGSPCB             GET GSPCB FROM GTMCB             84000017
         DROP  R2                                                       84300017
*                                                                       84600017
*HERE FOR GSPCB                                                         84900017
*                                                                       85200017
         USING GSPCB,R2                                                 85500017
GSPDC030 LA    R3,0(R15)                                                85800017
         L     R4,TOPTBLAD             GET ADDRESS OF FIRST ENTRY       86100017
         SR    R3,R4                   FORM DIFFERENCE NUMBER.  THIS    86400017
*                                      NUMBER IS USED AGAINST STATUS    86700017
*                                      TABLE IN DIEECTOR 2 TO LOCATE    87000017
*                                      ROUTINE REQUESTED.               87300017
         L     R9BASE,GSPDCTR2         GET ADDRESS OF DIRECTOR PART2    87600017
         BR    R9BASE                  GO TO DIRECTOR PART2             87900017
         DROP  R2                                                       88200017
*                                                                       88500017
*HERE IF ATLCB                                                          88800017
*                                                                       89100017
         USING ATTNLEVL,R2                                              89400017
GSPDC040 L     R2,ATTNBKPT             PICK UP BACK POINTER             89700017
         DROP  R2                                                       90000017
         USING GTMCB,R2                                                 90300017
         CLI   GTMTERID,X'02'          TEST IF POINTING AT GTMCB        90600017
         BE    GSPDC020                BRANCH IF YES                    90900017
         B     GSPDC040                ELSE, CONTINUE TILL FOUND        91200017
         EJECT                                                          91500017
*CONSTANTS AND DUMMY SECTIONS                                           91800017
TOPTBLAD DC    A(IHEGSP03)                                         CDMA 92100017
CBSECT   DSECT                                                          92400017
         DS    2F                                                       92700017
CBID     DS    XL1           ALL CONTROL BLKS HAVE X'F2' HERE           93000017
CBCBID   DS    XL1           VALUE IS X'01'-X'04' FOR GSP CONTROL BLOCK 93300017
         COPY  GSPCB                                                    93600017
         COPY  GTMCB                                                    93900017
         COPY  GDSCB                                                    94200017
         COPY  ATTNLEVL                                                 94500017
         END                                                            94800017
