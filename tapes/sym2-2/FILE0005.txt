./  ADD  SSI=70690163,NAME=IEHINITT
* /* START OF SPECIFICATIONS ***                                      * 00002002
*01* PROCESSOR = ASSEM;                                               * 00004002
**** END OF SPECIFICATIONS ***/                                       * 00006002
 TITLE 'IEHINITT-IEHINITT ROOT MODULE'                                  00010014
* TITLE:                                                          M2840 00020002
*    'IEHINITT: TAPE LABELING UTILITY PROGRAM'                    M2840 00030002
* STATUS:                                                         M2840 00040002
*    CHANGE LEVEL 000                                             M2840 00050002
* FUNCTION/OPERATION:                                             M2840 00052002
*    THIS ROUTINE EXAMINES THE INITT CONTROL CARD AND BUILDS AN   M2840 00060002
*    IMAGE IN CORE OF THE LABEL TO BE PUT ON THE USER'S TAPE.     M2840 00080002
*    IT ALSO KEEPS TRACK OF THE NUMBER OF TAPES THAT ARE TO BE    M2840 00100002
*    LABELED AND CALLS THE SVC FOR EACH TAPE INCREMENTING THE     M2840 00120002
*    VOLUME SERIAL NUMBER BY ONE EACH TIME THE SVC IS CALLED      M2840 00132002
*    FOR A SINGLE LABEL GROUP.                                    M2840 00140002
*    THIS ROUTINE DETERMINES AND CONSTRUCTS THE VOLUME HEADER    S20038 00142020
*    LABEL AS AN OS/360 STANDARD LABEL OR AS AN ASCII STANDARD   S20038 00144020
*    LABEL.  THE DUMMY HEADER LABEL IS THEN CONSTRUCTED IN       S20038 00146020
*    CONTIGUOUS STORAGE TO THE VOLUME LABEL.  THIS LABEL GROUP   S20038 00148020
*    IS THEN TRANSLATED FROM EBCDIC TO ASCII, IF SPECIFIED BY    S20038 00150020
*    THE USER, BEFORE CALLING THE TAPE LABELING SVC.             S20038 00152020
* ENTRY POINTS:                                                         00154002
*    IEHINITT IS THE ONLY ENTRY POINT. IT IS ENTERED TO                 00170002
*    SET UP A PARAMETER LIST FOR LABELING TAPES                         00180002
* INPUT:                                                                00200002
*    THERE IS NO INPUT PASSED IN REGISTERS. IT IS THE CONTROL           00210002
*    CARDS IN THE CARD READER THAT WILL INDICATE HOW MANY AND HOW       00220002
*    THE TAPES ARE LABELED                                              00240002
* OUTPUT:                                                               00260002
*    OUTPUT IS THE TAPES THAT HAVE BEEN SUCCESSFULLY LABELED            00270002
* EXTERNAL ROUTINES:                                                    00272002
*         IEHSCAN - SCAN ROUTINE. SCANS CARD INPUT IMAGE IN             00280002
*         CORE FOR OPTIONS SPECIFIED                                    00300002
*         IEHPRNT -  PRINT ROUTINE. PRINTS OUT CARDS AND ERROR          00320002
*         MESSAGES. ALSO PUT HEADING AND PAGE NUMBERS ON EACH PAGE      00340002
*         SVC 39 - WRITES A LABEL GROUP ON A TAPE                S20038 00342020
*         GETMAIN - REQUESTS CORE STORAGE FOR WORK AREA          S20038 00344020
*         OPEN - OPENS READ AND PRINT DATA SETS                  S20038 00346020
*         RDJFCB - READS JOB FILE CONTROL BLOCK FOR DENSITY      S20038 00348020
*         XLATE - ISSUES TRANSLATE SVC FOR ASCII OR EBCDIC CODE  S20038 00350020
*         CLOSE - CLOSES READ AND PRINT DATA SETS                S20038 00352020
*         FREEMAIN - RELEASES CORE STORAGE FOR WORK AREA         S20038 00354020
* EXITS-NORMAL:                                                         00360002
*    CONTROL IS RETURNED TO THE CALLER WITH ALL REGS AS THEY            00370002
*    WERE WHEN THE UTILITY WAS CALLED                                   00380002
* EXITS, ERROR:                                                         00390002
*    EXIT IS THE SAME AS ABOVE EXCEPT PREVIOUS TO EXIT AN               00400002
*    ERROR MESSAGE HAS BEEN PRINTED OUT                                 00420002
*    THE RETURN CODE IN REGISTER 15 INDICATES THE SEVERITY OF           00430002
*    THE ERROR                                                          00432002
* TABLES/WORK AREAS:                                                    00434002
*    THE WORK AREA CONTAINS A CARD IMAGE, TAPE LABEL                    00440002
*    IMAGE, ERROR MESSAGES AND SWITCHES                                 00460002
*    THIS AREA IS OBTAINED WITH AN UNCONDITIONAL GETMAIN AND            00470002
*    IS SHARED BY IEHINITT, IEHSCAN, AND IEHPRNT                        00472002
* ATTRIBUTES:                                                           00474002
*    REENTRANT                                                          00480002
* CHARACTER CODE DEPENDENCY -                                    S20038 00480820
*    THE OPERATION OF THE SECTION, 'CHECK', WHICH VERIFIES THE   S20038 00481620
*    SERIAL NUMBER, DEPENDS UPON A CLASSIFICATION OF THE         S20038 00482420
*    EXTERNAL CHARACTER SET BY MEANS OF A TABLE.  THE TABLE IS   S20038 00483220
*    CONSTRUCTED FOR THE EBCDIC CHARACTER SET AND IS ARRANGED SO S20038 00484020
*    THAT REDEFINITION OF ALL 'CHARACTER' CONSTANTS, BY REASSEM- S20038 00484820
*    BLY, WILL RESULT IN A CORRECT TABLE FOR THE NEW DEFINITIONS S20038 00485620
*    IF THE EXTERNAL CHARACTER SET REMAINS UNCHANGED.            S20038 00486420
*    INSTRUCTIONS FOR MODIFYING THE TABLE TO ADD, DELETE, OR     S20038 00487220
*    CHANGE THE MEANING OF CHARACTERS ARE CONTAINED WITH THE     S20038 00488020
*    TABLE LOCATED IN THE 'CONSTANTS' SECTION.                   S20038 00488820
IEHINITT CSECT                                                          00490014
* 008600,064000                                                  A25710 00495018
* 071600-071800,073400,081500,112400                             A23445 00500018
*0251                                                              1599 00520018
*0251030000,075600-076400                                          3260 00540018
*                                                                M3286  00550019
* 032200,032800,049400-050200,051400-05220,053200-053400,        S20038 00552020
* 059200-060200,063600-063800,064800-065200,058000-058200,       S20038 00554020
* 058600,112800,112920,124920,127800,128200,131800,141360,144000 S20038 00556020
* 032600,117000-117800,129000-131800,085000                             00558020
*A083310                                                         A38606 00559020
*C 146260                                                         M6029 00559420
*A 125161                                                      @ZA01679 00559502
*C 008400                                                      @ZA01679 00559602
*C 017830,018000                                               @ZA01680 00559702
*C 021400,022600                                               @ZA01744 00559899
*C 094600                                                      @ZA04374 00559903
*A135684-135692,135701-135708                                  @ZA16491 00569999
*C135678,135700,135710                                         @ZA16491 00571999
IEHINIT  SAVE  (14,12),T,IEHINITT-OZ16491  SAVE REGS           @ZA16491 00573399
         LR    INITBASE,REG15          LOAD IEHINITT BASE REG     M2840 00580002
         USING IEHINIT,INITBASE        ESTABLISH ADDRESSIBILITY   M2840 00600002
         USING IEHINIT2,MSGBASE        ADDRESSABILITY FOR CSECT2  M2840 00610002
         GETMAIN R,LV=0+LAST-FIRST     GET WORK AREA              M2840 00620002
         SR    UCBSEQ,UCBSEQ           KEEP THE                   M2840 00625002
*                                         SEQUENCE NUMBER OF      15673 00630017
*                                         THE UCB BEING USED.     15673 00635017
         LR    GOTTEN,REG1             SAVE ADDRESS OF WORK AREA  M2840 00640002
*                                                                       00660000
*                  THIS SECTION CLEARS OUT THE GETMAIN AREA AND         00680000
*                     INITIALIZE THE LABEL FIELD TO THE DEFAULT OPTIONS 00700000
*                     RELATED TO THE ITITT CARD                         00720000
*                                                                       00740000
         MVI   0(REG1),BINZERO         ZERO OUT THE WORK AREA     M2840 00760002
         LA    REG2,ABS255             GET LENGTH OF 255          M2840 00780002
         LA    REG3,0+LAST-FIRST       GET LENGTH OF WORK AREA    M2840 00800002
         BCTR  REG3,REG0               SUB FIRST BYTE CLEARED     M2840 00810002
EXEC     EX    REG2,MVZO               CLEAR 255 BYTES            M2840 00820002
         LA    REG1,ABS256(REG1)       BUMP REG 1 BY 256       @ZA01679 00840002
         S     REG3,TWO56              SIZE OF AREA NOT CLEAR     M2840 00860002
         C     REG3,TWO55              LESS THAN 255 BYTES?       M2840 00880002
         BC    2,EXEC                  NO, GO CLEAR 255 BYTES     M2840 00900002
         EX    REG3,MVZO               CLEAR REMAINDER OF BYTES   M2840 00920002
         USING WORK,GOTTEN             SET UP ADDRESSIBILITY FOR  M2840 00940002
*                                         WORK AREA                     00960000
         ST    REG13,SAVE+DSP4         SAVE CALLER'S REG 13       M2840 00980002
*                                                                       01000000
*                                                                       01020000
         LA    STWREG,PRINT            GET ADDRESS OF PRINT DCB   M2840 01040002
         ST    STWREG,PRINTAD          SAVE IT FOR EXECUTE OPEN   M2840 01060002
         MVI   PRINTAD,OPENOUT         SET END-OF-LIST, OUTPUT    M2840 01080002
         LA    STWREG,LBLDCB           DUMMY ADDR OF JFCB DCB     M2840 01085002
         ST    STWREG,AGO              SAVE FOR EXECUTE, RDJFCB   M2840 01090002
         MVI   AGO,ENDLIST             SET END-OF-LIST, RDJFCB    M2840 01095002
         LA    STWREG,READ             GET ADDRESS OF READ DCB    M2840 01100002
         ST    STWREG,READAD           SAVE IT FOR EXECUTE OPEN   M2840 01120002
         MVI   READAD,ENDLIST          END-OF-LIST, INPUT         M2840 01140002
         MVC   PRINT(L'PRINT),PRINT1   COPY PRNT DCB TO WORK AREA M2840 01160002
         MVC   READ(L'READ),READ1      COPY READ DCN TO WORK AREA M2840 01180002
         EJECT                                                          01182002
*                                                                 M2840 01190002
*                  CHECK TO SEE IF ANY PARAMETERS WERE PASSED TO  M2840 01192002
*                     IEHINITT BY LINK OR ATTACH, OR BY THE PARM  M2840 01194002
*                     FIELD OF THE EXEC STATEMENT.                M2840 01194402
*                                                                 M2840 01196002
INVOC    L     REG13,SAVE+DSP4         PICK UP PARAMETER LIST PTR M2840 01200002
         L     REG1,L24(REG13)             PASSED WHEN INVOKED    M2840 01220002
         SR    REG3,REG3               CLEAR WORK REGISTER        M2840 01240002
         C     REG3,0(REG1)            ARE ANY OPTIONS SPECIFIED        01260000
         BE    NOOPT                   BRANCH IF NO OPTIONS       M2840 01280002
         L     REG2,0(REG1)            PICK UP POINTER TO OPTION        01300000
*                                         PARAMETER LIST                01320000
         CLC   0(TWO,REG2),ZERO        IS LIST LENGTH ZERO?       M2840 01340002
         BC    8,NOOPT                 BRANCH IF LENGTH IS ZERO         01380000
*                                                                 M2840 01390002
*                  THE OPTIONADDR PARAMETER WAS SPECIFIED.  ITS   M2840 01392002
*                     LENGTH MUST BE 10 BYTES, THE FIRST 8 BYTES  M2840 01392402
*                     MUST CONTAIN 'LINECNT=', AND THE LAST TWO   M2840 01392802
*                     BYTES MUST BE NUMERIC.                      M2840 01393202
*                                                                 M2840 01394002
         LH    REG3,0(REG2)            LENGTH OF OPT PARM LIST    M2840 01400002
         CH    REG3,MAXCT              LENGTH OF LINECNT PARM=10? M2840 01406002
         BNE   MESSAGE1                BRANCH IF INVALID LENGTH   M2840 01412002
LNCNT    CLC   TWO(L'LINCT,REG2),LINCT IS PARAMETER 'LINECNT='    M2840 01660002
         BNE   MESSAGE1                BRANCH IF INVALID PARM     M2840 01680002
FOUND    XC    HERE(LNG8),HERE         CLEAR USED WORK AREA       M2840 01780002
         MVC   HERE(TWO),10(REG2)      MOVE IN LINECNT         @ZA01680 01783002
         NC    HERE+ONE1(ONE1),HERE                              S20038 01786020
         TM    HERE+ONE1,FOXZERO       TEST FOR NUMERICS         S20038 01789002
         BNO   MESSAGE1                BRANCH IF NOT NUMERICS    S20038 01792020
         XC    HERE(TWO),HERE          RESTORE AREA              S20038 01795020
         PACK  HERE+DSP6(TWO),10(TWO,REG2)  GET LINES          @ZA01680 01800002
         CVB   STWREG,HERE             CONVERT LINES TO BINARY    M2840 01820002
         B     LASTP                   GO STORE PASSED LINE COUNT M2840 01880002
MESSAGE1 OI    PARMERR,BIT7            SET LINECOUNT ERROR FLAG   M2840 01890002
NOOPT    LA    STWREG,ABS60            SET DEFAULT LINES TO 60    M2840 01900002
LASTP    STH   STWREG,LINETOT          TOTAL LINES PER PAGE       M2840 01920002
         STH   STWREG,LINELEFT         LINES LEFT YET TO PRINT    M2840 01940002
         TM    0(REG1),ENDLIST         TEST FOR LAST PTR IN LIST  M2840 01960002
         BO    NONAMES                 BRANCH IF LAST             M2840 01980002
*                                                                 M2840 01990002
*                  THE DDNAMEADDR PARAMETER WAS SPECIFIED.  CHECK M2840 01992002
*                     ENTRIES 5 AND 6 FOR ALTERNATE NAMES FOR     M2840 01994002
*                     SYSIN AND SYSPRINT RESPECTIVELY.  IF        M2840 01996002
*                     ALTERNATE NAMES ARE PRESENT, PUT THOSE      M2840 01998002
*                     NAMES INTO THE READ AND PRINT DCB'S.        M2840 01998402
*                                                                 M2840 01998802
NAME     L     REG2,DSP4(REG1)         PICK UP POINTER TO DDNAMES M2840 02000002
         CLC   0(L'FIVE,REG2),FIVE     IS EITHER SYSIN OR         M2840 02020002
*                                         SYSPRINT SPECIFIED      M2840 02040002
         BL    NONAMES                 BRANCH, NEITHER SPECIFIED  M2840 02060002
         CLC   D34(LNG8,REG2),ZERO     POSITION BINARY ZEROS?     M2840 02100002
         BE    NOINNAME                BRANCH IF NOT SPECIFIED    M2840 02120002
         MVC   RDDNAME,D34(REG2)       FILL DDNAME IN DCB      @ZA01744 02140099
PRNAME   CLC   0(L'SIX,REG2),SIX       LNGTH PRESENT FOR SYSPRINT M2840 02160002
         BC    4,NOPRNAME              NO, USE DEFAULT NAME       M2840 02180002
         CLC   D42(LNG8,REG2),ZERO     SUBSTITUTE NAME SPECIFIED? M2840 02220002
         BE    NOPRNAME                NO, USE DEFAULT NAME       M2840 02240002
         MVC   PDDNAME,D42(REG2)     YES, MOVE DDNAME INTO DCB @ZA01744 02260099
         B     LASTDDNM                GO BEGIN CHECK FOR PAGE    M2840 02280002
NOINNAME MVC   RDDNAME,SYSIN           FILL IN DEFAULT FOR SYSIN  M2840 02360002
         B     PRNAME                  SEE IF NAME FOR SYSPRINT   M2840 02380002
NONAMES  MVC   RDDNAME,SYSIN           FILL IN DEFAULT FOR SYSIN  M2840 02390002
NOPRNAME MVC   PDDNAME,SYSPRINT        FILL DEFAULT FOR SYSPRINT  M2840 02400002
*                                                                 M2840 02410002
*                  PICK UP PAGE NUMBER IF HDINGADDR SPECIFIED.    M2840 02412002
*                     IF NOT SPECIFIED, START WITH PAGE 1.        M2840 02414002
*                                                                 M2840 02416002
LASTDDNM TM    0(REG1),ENDLIST         MORE OPTIONS SPECIFIED?    M2840 02420002
         BO    DFALT                   NO MORE POINTERS           M2840 02440002
         TM    DSP4(REG1),ENDLIST      MORE OPTIONS SPECIFIED?    M2840 02460002
         BO    DFALT                   NO MORE POINTERS           M2840 02480002
PAGE     L     REG2,DSP8(REG1)         POINT AT PAGE NUMBER AREA  M2840 02500002
         CLC   0(TWO,REG2),ZERO        IS PAGE NUMBER SPECIFIED   M2840 02520002
         BE    DFALT                   NO PAGE NUM, TAKE DEFAULT  M2840 02540002
CVT      XC    HERE(LNG8),HERE         CLEAR USED PART OF WORKA   M2840 02620002
         MVC   HERE(LNG4),TWO(REG2)    MOVE IN PAGECNT           S20038 02622020
         NC    HERE+ONE1(LNG3),HERE                              S20038 02624020
         TM    HERE+LNG3,FOXZERO       TEST FOR NUMERICS          M2840 02626002
         BNO   MESSAGE2                BRANCH IF NOT NUM         S20038 02628020
         CLC   LNG0(TWO,REG2),FOUR1    PAGECNT CORRECT LENGTH?   S20038 02630020
         BNE   MESSAGE2                BRANCH IF INCORRECT       S20038 02632020
         XC    HERE(LNG4),HERE         RESTORE AREA              S20038 02634020
         PACK  HERE+DSP5(LNG3),TWO(LNG4,REG2)                     M2840 02640002
         CVB   STWREG,HERE             CONVERT PAGE NO TO BINARY  M2840 02660002
         B     OUT                     GO STORE PAGE NUMBER       M2840 02662002
MESSAGE2 OI    PARMERR,BIT7            SET PAGECOUNT ERROR FLAG   M2840 02664002
DFALT    LA    STWREG,ABS1             DEFAULT OPTION IS PAGE ONE M2840 02670002
OUT      STH   STWREG,PAGENUM          SAVE STARTING PAGE NUMBER  M2840 02680002
         EJECT                                                          02690002
*                                                                 M2840 02692002
*                  OPEN SYSIN AND SYSPRINT (OR SUBSTITUTES)       M2840 02694002
*                                                                 M2840 02696002
         LA    REG13,SAVE              PTR TO IEHINITT SAVE AREA  M2840 02700002
         MVI   DFLG,NULL               INITIALIZE ERROR FLAGS     M2840 02706002
         MVI   DFLAG,NULL                                         M2840 02712002
         OPEN  MF=(E,PRINTAD)          EXECUTE OPEN CODE STORED IN WORK 02720000
*                                         AREA FOR PRINTER              02740000
         LA    REG13,SAVE              PTR TO IEHINITT SAVE AREA  M2840 02760002
         OPEN  MF=(E,READAD)           EXECUTE OPEN CODE STORED IN WORK 02780000
*                                         AREA FOR READER               02800000
         LA    STWREG,JFCBLST          MOVE EXLST ADDR INTO DCB   M2840 02960002
         ST    STWREG,JFLSTAD                                     M2840 02980002
         MVC   GO+ONE1(LNG3),JFLSTAD+ONE1 MOVE EXLST TO SAVE AREA M2840 02990002
*                                                                 M2840 03017102
*                   CALL IEHPRNT TO PRINT FIRST PAGE HEADING      M2840 03017402
*                                                                 M2840 03017802
         LA    REG13,SAVE              PTR TO IEHINITT SAVE AREA  M2840 03020002
         LA    REG12,COMTAB            PTR TO WORK AREA           M2840 03030002
         LINK  EP=IEHPRNT              GO PRINT HEADING           M2840 03060002
         C     REG15,ZERO              IS RETURN CODE ZERO        M2840 03080002
         BNE   RETURN                  BRANCH, CODE NOT ZERO      M2840 03100002
         TM    PARMERR,BIT7            TEST FOR LINECNT OR        M2840 03105002
*                                      PAGECNT ERROR             S20038 03110020
         BO    MESSAGE                 BRANCH IF ERROR           S20038 03115020
SKIPRINT TM    ROPENFLG,BADOPEN        OPEN READ DCB SUCCESFUL    M2840 03120002
         BZ    BAD                     BRANCH IF NO               M2840 03140002
         TM    DFLAG,BADOPEN           SYSIN BLKSIZE ERROR FLAG   M2840 03146002
         BO    BAD                     BRANCH IF ERROR            M2840 03152002
         MVI   RC,NULL                 INITIALIZE RETURN CODE     M2840 03156002
         EJECT                                                          03158002
REDO     MVI   LABEL,BLANKCOL          INITIALIZE LABEL TO BLANKS M2840 03160002
         MVC   LABEL+ONE1(L79),LABEL   CLEAR REMAINDER OF LABEL   M2840 03180002
         MVC   LABEL(L'VLM),VLM        MOVE CONSTANT 'VOL1'       M2840 03200002
         MVI   NUMTPS,BIT7             DEFAULT OPTION FOR NUMBER  M2840 03240002
         NI    KEY,NULL                TURN OFF ALL KEYWORD BITS  M2840 03310002
         NI    SWITCHAL,NULL           CLEAR ASCII LABEL SWITCH  S20038 03315020
         OC    SVCLST(L'UNLD),UNLD     DET DEFAULT TO UNLOAD      M2840 03320002
         LA    STWREG,HOMEJFCB         PICK UP ADDR OF JFCB AREA  M2840 03340002
         ST    STWREG,JFCBLST          SAVE IT FOR JFCB READ      M2840 03380002
         MVI   JFCBLST,ENDJFCB         SET END-OF-LIST, JFCB      M2840 03390002
         L     STWREG,ABS16            PICK UP CVT ADDRESS        M2840 03400002
         L     REG5,0(STWREG)          PICK UP DOUBLE WORD        M2840 03420002
*                                         CONTAINING TCB ADDRESS  M2840 03440002
         L     STWREG,DSP4(REG5)       PICK UP TCB ADDRESS        M2840 03460002
         ST    STWREG,TCB              SAVE TCB PTR JUST FOUND    M2840 03480002
         MVI   SWITCHRD,NULL           CLEAR SWITCHRD INDICATING  M2840 03500002
*                                         FIRST ENTRY             M2840 03520002
         EJECT                                                          03530002
SCAN1    LA    REG13,SAVE              PTR TO IEHINITT SAVE AREA  M2840 03540002
         LA    REG12,WORK              PTR TO COMMON WORK AREA    M2840 03550002
SCAN     LINK  EP=IEHSCAN                                               03580000
*                                                                       03600000
*                  THE FOLLOWING ROUTINE CHECKS FOR SUCCESS OF THE      03620000
*                     SCAN AND ALSO CHECKS TO SEE IF A DDNAME,COMMAND   03640000
*                     WORD, KEYWORD OR PARAMETER IS RETURNED            03660000
*                                                                       03680000
         TM    DISP11,BIT7             SYNAD ENTERED IN IEHSCAN   M2840 03710002
         BO    BAD                     YES,BR.                     9837 03715014
         TM    SWITCHRD,BIT0           IS ERROR BIT ON            M2840 03720002
         BNO   DNAM                    NO, SEE WHAT WAS PASSED    M2840 03740002
ERR      BAL   REG14,ERRMSG            ERROR MESSAGE SET UP       M2840 03790002
         MVC   MSGTEXT(L'ERR1),ERR1    INVALID STATEMENT MSG TEXT M2840 03800002
ERRPTR   MVI   RC,RCODE08              SET RETURN CODE TO 8       M2840 03820002
         LINK  EP=IEHPRNT                                               04000000
         C     REG15,ZERO              IS RETURN CODE ZERO        M2840 04020002
         BNE   RETURN                  RETURN CODE NOT ZERO       M2840 04040002
NEXT     TM    SWITCHRD,BIT2           IS END OF FILE BIT ON            04060000
         BO    RETURN                  BRANCH ON YES              M2840 04080002
         TM    SWITCHRD,BIT1           IS BYPASS BIT ON           M2840 04130002
         BO    REDO                    YES, SET UP FOR NEXT GROUP M2840 04180002
         B     SCAN1                   JUST READ AND PRINT CARDS  M2840 04230002
         EJECT                                                          04262002
*                                                                 M2840 04270002
*                  IEHSCAN SAVES THREE VALUES IN THE COMMON WORK  M2840 04272002
*                     AREA BEFORE RETURNING TO IEHINITT.  THESE   M2840 04274002
*                     VALUES ARE:                                 M2840 04276002
*                        PARMPTR - THE ADDRESS OF THE FIRST       M2840 04278002
*                                  POSITION IN CARD FOR THE VALUE M2840 04278402
*                                  PASSED.                        M2840 04278802
*                        LNGPARM - THE LENGTH OF THE VALUE PASSED M2840 04279202
*                        DISP12  - THE ADDRESS OF THE LAST        M2840 04279602
*                                  POSITION SCANNED               M2840 04279702
*                                                                 M2840 04279802
DNAM     L     REG1,PARMPTR            STARTING COLUMN            M2840 04279902
         L     REG2,LNGPARM            LENGTH OF SCAN             M2840 04286602
         L     REG3,DISP12             LAST COLUMN SCANNED        M2840 04288602
         TM    DISP10,BIT5             TEST FOR DDNAME BIT ON     M2840 04293302
         BC    NO,COMDWRD              SEE IF COMMAND WORD        M2840 04300002
         MVI   DDNAM,BLANKCOL          CLEAR DDNAME FIELD         M2840 04320002
         MVC   DDNAM+ONE1(LNG7),DDNAM  CLEAR DDNAME FIELD         M2840 04340002
         C     REG2,EIGHT              DDNAME LONGER THAN 8       M2840 04346002
         BH    ERR                     YES, ERROR                 M2840 04352002
         BCTR  REG2,REG0               DECREASE LENGTH BY 1       M2840 04360002
         EX    REG2,DDMVE              MOVE DDNAME TO SAVE AREA   M2840 04380002
         CLC   DDNAM,LASTDD            IS DDNAM SAME AS BEFORE?   M2840 04386002
         BE    THRU                    IF SO, DON'T REINITIALIZE  M2840 04392002
         SR    UCBSEQ,UCBSEQ           IF NOT, DO REINITIALIZE    M2840 04398002
         MVC   LASTDD,DDNAM            SAVE NEW 'DDNAM'.          M2840 04404002
         B     THRU                    GO HOUSEKEEP               M2840 04420002
COMDWRD  TM    SWITCHRD,BIT4           TEST FOR COMMAND WORD BIT        04440000
         BZ    KEYWRD                  NOT COMMAND WORD, BRANCH   M2840 04460002
CHKCOM   CLC   INITT,0(REG1)           IS COMMAND WORD CORRECT    M2840 04470002
         BE    THRU                    THE OPERATION IS 'INITT'   M2840 04472002
         OI    SWITCHRD,BIT1           SET ON BYPASS SWITCH             04472402
         B     ERR                     BAD COMMAND WORD, ERROR    M2840 04474002
         EJECT                                                          04476002
KEYWRD   TM    SWITCHRD,BIT5           TEST FOR KEYWORD BIT       M2840 04480002
         BNO   PARM                    NOT KEYWORD, BRANCH        M2840 04500002
*                                                                 M2840 04510002
*                  THE FOLLOWING FIVE TESTS (SERL, DISPL, OWNR,   M2840 04512002
*                     NUMBTAPE, AND LABTYP) TEST FOR VALID        M2840 04514002
*                     KEYWORDS.  IF THE KEYWORD IS NOT ONE OF THE M2840 04516002
*                     SPECIFIED KEYWORDS, A BRANCH IS MADE TO     M2840 04518002
*                     'WRONG' TO SET UP 'INVALID KEYWORD' ERROR   M2840 04518402
*                     MESSAGE.                                    M2840 04518802
*                                                                 M2840 04519202
SERL     CLC   SER,0(REG1)             IS KEYWORD SERIAL NUMBER?  M2840 04520002
         BNE   DISPL                   NO, KEYWORD NOT SERIAL NO. M2840 04600002
         OI    KEY,BIT0                TURN ON SERIAL NUMBER BIT        04620000
         B     SCAN1                   RETURN TO SCAN FOR PARM    M2840 04660002
DISPL    CLC   DISP,0(REG1)            IS KEYWORD DISPOSITION     M2840 04740002
         BNE   OWNR                    NO, KEYWORD NOT DISP       M2840 04780002
         OI    KEY,BIT1                TURN ON DISP BIT                 04800000
         B     SCAN1                   RETURN TO SCAN FOR PARM    M2840 04820002
OWNR     CLC   OWNRN,0(REG1)           IS KEYWORD OWNER?          M2840 04840002
         BC    7,NUMBTAP               BRANCH ON NO TO NEXT CHK  S20038 04880020
         OI    KEY,BIT2                TURN ON OWNER NAME BIT           04900000
         B     SCAN1                   RETURN TO SCAN FOR PARM    M2840 04920002
NUMBTAP  CLC   NUMBTAPE,0(REG1)        KEYWORD NUMBTAPE?          M2840 05040002
         BC    7,LABTYP                IF NO,BRANCH TO NEXT CHK  S20038 05080020
         OI    KEY,BIT4                TURN ON NUMBTAPE BIT             05100000
         B     SCAN1                   RETURN TO SCAN FOR PARM    M2840 05120002
LABTYP   CLC   LABTYPE,0(REG1)         IS KEYWORD LABTYPE?        M2840 05130002
         BC    7,WRONG                 IF NO,BRANCH TO ERROR RTN S20038 05210020
         OI    KEY,BIT6                TURN ON LABTYPE BIT       S20038 05220020
         B     SCAN1                   RETURN TO SCAN FOR PARM    M2840 05230002
WRONG    BAL   REG14,ERRMSG            ERROR MESSAGE SET UP       M2840 05270002
         MVC   MSGTEXT(L'ERR2),ERR2    INVALID KEYWORD MSG TEXT   M2840 05280002
         OI    SWITCHRD,BIT1           SET ON BYPASS SWITCH             05290002
         B     ERRPTR                  GO PRINT ERROR MSG         M2840 05300002
         EJECT                                                          05350002
PARM     TM    SWITCHRD,BIT6           IS THIS A PARAMETER              05360000
         BO    CHECK                   YES, HANDLE AS PARAMETER   M2840 05380002
         TM    SWITCHRD,BIT1           TEST BYPASS BIT            M2840 05400002
         BC    1,COL72B                BRANCH IF ON               M2840 05420002
         B     EOF                     GO SET UP FOR NEXT GROUP   M2840 05440002
*                                                                 M2840 05450002
*                  THE FOLLOWING FIVE TESTS (CHECK, CHKDISP,      M2840 05452002
*                     CHKOWNR, CHKNUMTP, AND CHKLAB) TEST FOR     M2840 05454002
*                     VALID PARAMETERS.  IF THE PARAMETER DOES    M2840 05456002
*                     NOT MEET THE SPECIFIED REQUIREMENTS, A      M2840 05458002
*                     BRANCH IS MADE TO 'BADPARM' TO SET UP       M2840 05458402
*                     'INVALID PARAMETER VALUE' ERROR MESSAGE     M2840 05458802
*                                                                 M2840 05459202
CHECK    TM    KEY,BIT0                IS SER # BIT ON                  05460000
         BC    8,CHKDISP               IF NO BRANCH                     05480000
         STM   REG1,REG3,MYSAVE        SAVE ALL REGISTERS         M2840 05482002
         LR    REG3,REG1               REG3 CONTAINS ADDR OF I/P  M2840 05484002
         TRT   0(LNG7,REG3),TABLE      TEST LEGAL CHARACTERS      M2840 05486002
         S     REG1,MYSAVE             NO. OF CHARACTERS SEARCHED M2840 05488002
         C     REG1,MYSAVE+DSP4        NO OF CHARACTERS CHANGED?  M2840 05490002
         BNE   BADPARM                 YES, GO TO ERROR ROUTINE  S20038 05492020
         LM    REG1,REG3,MYSAVE        RESTORE SAVED REGISTERS    M2840 05494002
         MVI   SERIAL,BLANKCOL         CLEAR FIRST BYTE OF SERIAL M2840 05500002
         MVC   SERIAL+ONE1(LNG5),SERIAL CLEAR REMAINDER OF SERIAL M2840 05520002
         LA    STWREG,L'SERIAL         GET LENGTH OF SERIAL       M2840 05530002
         CR    REG2,STWREG             IS PARAMETER TOO LONG      M2840 05532402
         BH    BADPARM                 YES, SET UP PARAMETER ERR  M2840 05534002
         BCTR  REG2,REG0               DECREASE LENGTH BY 1       M2840 05540002
         EX    REG2,MOVSER             MOVE SERIAL TO LABEL AREA  M2840 05560002
         B     THRU                    VALID SERIAL PARM, CONT.   M2840 05600002
CHKDISP  TM    KEY,BIT1                IS DISP BIT ON                   05620000
         BC    8,CHKOWNR               IF NO BRANCH                     05640000
         CLC   REWIND,0(REG1)          IS THE DISP REWIND         M2840 05680002
         BNE   THRU                    NO, ASSUME REWIND-UNLOAD   M2840 05700002
RE       MVC   SVCLST(L'RWND),RWND     SET FOR REWIND OPTION      M2840 05720002
         B     THRU                    VALID DISP. PARM, CONTINUE M2840 05740002
CHKOWNR  TM    KEY,BIT2                IS OWNER NAME BIT ON             05760000
         BC    8,CHKNUMTP              BRANCH ON NO              S20038 05768020
         LTR   REG2,REG2               IS PARM LENGTH EQ ZERO    S20038 05776020
         BZ    BADPARM                 BRANCH IF ZERO            S20038 05784020
         C     REG2,FOURTEEN           IS OWNER NAME G.T. 14     S20038 05800002
         BH    BADPARM                 BRANCH ON YES             S20038 05808020
         OI    SWITCHAL,OWNRSW         FLAG OWNERID SPECIFIED    S20038 05816020
         ST    REG2,OWNRLNG            SAVE LENGTH FOR LATER CHK S20038 05824020
         BCTR  REG2,REG0               DECREASE LENGTH BY 1       M2840 05840002
         EX    REG2,ONAMHOLD           HOLD OWNER FOR LATER CHK  S20038 05860020
         B     THRU                    VALID OWNER PARM, CONT     M2840 05900002
*                                                                 M2840 05950002
*                  THE NUMBER OF TAPES CAN RANGE FROM 1 TO 3      M2840 06000002
*                     BYTES (1 TO 255 TAPES) AND THE LOCATION FOR M2840 06010002
*                     THE PACK INSTRUCTION MUST VARY ACCORDINGLY  M2840 06020002
*                                                                 M2840 06030002
CHKNUMTP TM    KEY,BIT4                IS NUMBTAPE BIT ON               06040000
         BZ    CHKLAB                  NOT NUMBTAPE PARM, BRANCH  M2840 06060002
         C     REG2,FTHREE             MORE THAN THREE DIGITS     M2840 06070002
         BH    BADPARM                 YES, SET UP PARAMETER ERR  M2840 06072002
         XC    THERE(LNG3),THERE       CLEAR AREA FOR NUMB TAPES  M2840 06080002
         LA    STWREG,THERE+TWO        POINT AT LOW-ORDER BYTE    M2840 06120002
         BCTR  REG2,REG0               DECREASE PASSED LNGTH BY 1 M2840 06160002
         SR    STWREG,REG2             IF NUMBER OF TAPES GREATER M2840 06180002
*                                         THAN SINGLE DIGIT,      M2840 06192002
*                                         ADJUST MVC START COL.   M2840 06194002
         EX    REG2,TAPENUM            MOVE PARM TO AREA 'THERE'  M2840 06200002
         XC    HERE(LNG8),HERE         CLEAR PART OF WORK AREA    M2840 06240002
         PACK  HERE+DSP6(TWO),THERE(LNG3)                               06260002
         CVB   STWREG,HERE             CONVERT NO OF TAPES        M2840 06280002
         STC   STWREG,NUMTPS           STORE NUMBER OF TAPES      M2840 06300002
         NI    KEY,NULL                TURN OFF NUMBTAPE BIT      M2840 06320002
         CLI   NUMTPS,NULL             CHECK FOR NO TAPE          M2840 06326002
         BC    8,BADPARM               BRANCH ON YES             A25710 06332018
         B     THRU                    VALID NUMBTAPE PARAM, CONT M2840 06340002
CHKLAB   TM    KEY,BIT6                IS LABTYPE BIT ON         S20038 06344020
         BZ    BADPARM                 NOT LABTYPE PARM, BRANCH   M2840 06348002
         LA    STWREG,L'AL             GET LENGTH OF 'AL'         M2840 06358002
         CR    REG2,STWREG             IS PARAMETER TOO LONG      M2840 06368002
         BH    BADPARM                 YES, SET UP PARAMETER ERR  M2840 06370002
         CLC   AL(L'AL),0(REG1)        IS PARM EQUAL TO 'AL'      M2840 06372002
         BNE   BADPARM                 BRANCH ON NO              S20038 06376020
         OI    SWITCHAL,ASCIISW        FLAG ASCII LAB SPECIFIED  S20038 06384020
         B     THRU                    VALID LABTYPE PARM, CONT.  M2840 06388002
BADPARM  BAL   REG14,ERRMSG            ERROR MESSAGE SET UP       M2840 06430002
         MVC   MSGTEXT(L'ERR3),ERR3    INVALID PARAMETER TEXT     M2840 06440002
         B     ERRPTR                  GO SET UP TO CALL IEHPRNT  M2840 06460002
         EJECT                                                          06470002
THRU     MVI   KEY,NULL                RESET KEYWORD FLAG         M2840 06510002
         TM    SWITCHRD,BIT1           IS THE BYPASS SWITCH ON          06540002
         BZ    SCAN1                   BRANCH IF NO              S20038 06700002
COL72B   MVI   SWITCHRD,NULL           CLEAR SWITCH BYTE          M2840 06720002
         CLI   SERIAL,BLANKCOL         IS SERIAL NUMBER SPECIFIED M2840 06760002
         BC    8,ERR                   BRANCH IF NO SER NUMBER IS       06780000
*                                         SPECIFIED                     06800000
         TM    SWITCHAL,ASCIISW        IS ASCII LABEL SPECIFIED  S20038 06801020
         BNO   NONASCII                BRANCH ON NO              S20038 06802020
         TM    SWITCHAL,OWNRSW         IS OWNER NAME SPECIFIED   S20038 06803020
         BNO   ASCISEC                 BRANCH ON NO              S20038 06804020
         NI    SWITCHAL,OWNEROFF       TURN OFF OWNER BIT        S20038 06805020
         L     STWREG,OWNRLNG          SETUP MOVE FOR OWNER       M2840 06806002
         BCTR  STWREG,REG0             SET UP MVC LENGTH          M2840 06807002
         EX    STWREG,ONAMASCI         MOVE ASCII OWNER TO LABEL  M2840 06808002
ASCISEC  MVI   SECURITY,BLANKCOL       ASCII SECURITY DFLT=SPACE  M2840 06809002
         MVI   LABEL+DSP79,ASCIISTD    ASCII LABEL STANDARD=1    S20038 06810002
         B     TIOTPTR                 GO GET TIOT PTR            M2840 06811002
NONASCII TM    SWITCHAL,OWNRSW         IS OWNER NAME SPECIFIED   S20038 06812020
         BNO   EBCDSEC                 BRANCH ON NO              S20038 06813020
         NI    SWITCHAL,OWNEROFF       TURN OFF OWNER BIT        S20038 06814020
         CLC   OWNRLNG(L'OWNRLNG),TEN  IS OWNER NAME G.T. TEN    S20038 06815020
         BH    BADPARM                 IF YES GO TO ERROR RTN    S20038 06816020
         L     STWREG,OWNRLNG          SETUP MOVE FOR OWNER       M2840 06817002
         BCTR  STWREG,REG0             SET UP MVC LENGTH          M2840 06818002
         EX    STWREG,ONAMEBCD         MOVE EBCDIC OWNER TO LBL   M2840 06819002
EBCDSEC  MVI   SECURITY,SECURE         EBCDIC SECURITY DFLT=0     M2840 06820002
         EJECT                                                          06820402
TIOTPTR  L     STWREG,TCB              PICK UP PTR TO THE TIOT    M2840 06821002
         L     REG5,D12(STWREG)        NOW CONTAINS PTR TO TIOT   M2840 06840002
         LA    REG5,D24(REG5)          START OF TIOT DD ENTRY     M2840 06860002
NEXTTIOT SR    REG6,REG6               CLEAR WORK REGISTER        M2840 06880002
         IC    REG6,0(REG5)            GET LENGTH BYTE IN TIOT    M2840 06900002
         LTR   REG6,REG6               END OF TIOT                      06920000
         BC    8,ERR                   NO MATCHING DDNAME, ERROR  M2840 06940002
         CLC   DSP4(LNG8,REG5),DDNAM   RIGHT DD NAME              M2840 06960002
         BE    DDTIOT                  BRANCH IF YES              M2840 06980002
         AR    REG5,REG6               GET NEXT DDNAME            M2840 07000002
         B     NEXTTIOT                GO TEST NEXT DDNAME        M2840 07020002
DDTIOT   S     REG6,SIX10              SUB LENGTH OF DD ENTRY(16) M2840 07040002
         SRL   REG6,2                  DIVIDE BY 4                M2840 07060002
         STC   REG6,UCBNUM                                              07080000
         A     REG5,SIX10              POINT TO FIRST UCB POINTER       07100000
         SLL   REG6,2                                            A23445 07106018
         EX    REG6,MVEUCB             MOVE UCB PTR INTO PROG    A23445 07112018
         L     REG5,0(REG5)            PICK UP UCB POINTER              07120000
         ST    REG5,TCB                SAVE UCB POINTER           M2840 07140002
         SR    REG4,REG4               USE REG 4 TO KEEP COUNT OF BAD   07200000
*                                         UCB POINTERS                  07220000
         SR    REG6,REG6               USE REG 6 TO KEEP COUNT OF THE   07240000
         IC    REG6,UCBNUM                TOTAL NUMBER OF UCB POINTERS  07260000
         LA    REG5,UCBAREA            POINT TO UCB PTRS                07340001
         EJECT                                                          07342002
*                                      THIS CODE READS THE JFCB  A46764 07350001
*                                      TO DETERMIN IF A          A46764 07354001
*                                      VALID DENSITY WAS         A46764 07356001
*                                      SPECIFIED OR A DEFAULT    A46764 07358001
*                                      IS TO BE TAKEN            A46764 07358401
VALRJFCB LA    REG13,GPSAVE            READ JFCB TO DETERMIN DEN A46764 07390001
         MVI   GO+12,BIT6              SET DCB TO LOOK UNOPENED   M2840 07490002
         XC    GO+13(3),GO+13          ZERO DCBIFLG AND DCBMACR  A46764 07540001
         RDJFCB MF=(E,AGO)                                       A46764 07590001
         L     REG1,TCB                POINT TO UCB              A46764 07640001
         USING UCB,REG1                                          A46764 07690001
         LA    REG2,HOMEJFCB           POINT TO JFCB             A46764 07740001
         USING JFCB,REG2                                         A46764 07790001
*                                      THIS CODE IS USED TO      A46764 07810001
*                                      INITIALIZE FLAGS          A46764 07830001
         MVI   VALCOMP,BIT0+BIT1+BIT3  INIT DENSITY WORK AREA    Y02128 07840002
         MVI   VALFLGS,NULL            CLEAR VALID WORK FLAGS     M2840 07890002
*                                      VALFLGS BITS 0-5   UNUSED A46764 07940001
*                                      X'02'   6 DEFAULTING      A46764 07990001
*                                      X'01'   7 DEN IS VALID    A46764 08000001
         TM    JFCDEN,BIT6+BIT7        WILL I DEFAULT ?           M2840 08010002
         BO    VALNODEF                B IF A DEN IS SPECIFIED   A46764 08020001
         OI    VALFLGS,BIT6+BIT7       SET DEFAULTING AND NOMSG   M2840 08030002
VALNODEF NC    VALCOMP,JFCDEN          VALDEN=DENSITY BITS ONLY   M2840 08032002
*                                      BRANCH TABLE DETERMINES   A46764 08032802
*                                      PATH FOR DRIVE            A46764 08033001
*                                      SELECTED                  A46764 08033101
         TM    UCBTBYT2,UCB2OPT0+UCB2OPT1  IS IT 7 TRK ?          M2840 08034002
         BNZ   VAL7TRK                 B IF 7 TRK                A46764 08036001
         OI    SWITCHAL,ASCIMODE       ASCI IS VALID FOR 9 TRK   A46764 08038001
         TM    UCBTBYT2,UCB2OPT2       IS IT DUAL DENSITY ?       M2840 08038402
         BO    VALDDEN                 B IF DUAL DEN             A46764 08038802
         TM    UCBTBYT2,X'10'          IS IT 1600/6250 BPI?      Y02128 08038902
         BO    VAL6250                 BRANCH IF YES             Y02128 08039002
         TM    UCBTYP,UCB1FEA5         IS IT 1600 DEN?           Y02128 08039202
         BO    VALPE                   B IF 1600                 Y02128 08039602
         TM    UCBTYP,X'02'            IS IT 6250 BPI?           Y02128 08041602
         BZ    VAL9ONLY                BRANCH IF NOT 6250        Y02128 08043602
         MVI   SVCLST+15,X'D3'         SET 6250 BPI              Y02128 08043702
         CLI   VALCOMP,X'D0'           WAS 6250 SPECIFIED?       Y02128 08043802
         BE    VALID                   B IF 6250 SPECIFIED       Y02128 08043902
         B     VALCK                   SEE IF I DEFAULTED        Y02128 08044502
*                                      THIS CODE FOR 9 TRK ONLY  A46764 08046002
VAL9ONLY MVI   SVCLST+15,X'AB'         MOVE CONST. FOR 9 TRK     A46764 08046602
         CLI   VALCOMP,BIT0            WAS 800 SPECIFIED ?        M2840 08048002
         BE    VALID                   B IF YES                  A46764 08050002
         B     VALCK                   SEE IF I DEFAULTED        A46764 08052002
*                                      THIS CODE FOR DUEL DEN    A46764 08054002
VALDDEN  MVI   SVCLST+15,X'CB'         SET 800 BPI               A46764 08056002
         CLI   VALCOMP,BIT0            WAS 800 SPECIFIED ?       A46764 08058002
         BE    VALID                   B IF IT WAS               A46764 08060002
*                                      THIS IS ALSO FOR P.E.     A46764 08062002
VALPE    MVI   SVCLST+15,X'C3'         SET 1600 BPI              A46764 08064002
         CLI   VALCOMP,BIT0+BIT1       WAS 1600 SPECIFIED ?       M2840 08066002
         BE    VALID                   B IF YES                  A46764 08068002
         B     VALCK                   SEE IF I DEFAULTED        A46764 08070002
VAL6250  MVI   SVCLST+15,X'D3'         SET 6250 BPI              Y02128 08071702
         CLI   VALCOMP,X'D0'           WAS 6250 SPECIFIED?       Y02128 08071802
         BE    VALID                   B IF 6250 SPECIFIED.      Y02128 08071902
         CLI   VALCOMP,X'C0'           WAS 1600 SPECIFIED?       Y02128 08072002
         BNE   VALCK                   IF NOT, SEE IF DEFAULT    Y02128 08072102
         MVI   SVCLST+15,X'C3'         ELSE SET 1600 BPI         Y02128 08072202
         B     VALID                                             Y02128 08072302
*                                      THIS IS THE 7 TRK CODE    A46764 08072402
VAL7TRK  MVI   SVCLST+15,X'2B'         SET 7 TRK MASK            A46764 08074002
         CLI   VALCOMP,BIT0+BIT1       INVALID 1600 SPECIFIED ?   M2840 08076002
         BE    VAL800                  B IF YES AND DEFAULT      A46764 08078002
         OI    VALFLGS,BIT7            SET VALID SWITCH           M2840 08080002
         TM    VALFLGS,BIT6            DO I DEFAULT ?             M2840 08082002
         BO    VAL800                  IF SO GO DEFAULT          A46764 08084002
         OC    SVCLST+15(1),VALCOMP    SET SPECIFIED DENSITY     A46764 08086002
         B     VALCK                   SEE IF ERROR MSG NEEDED   A46764 08088002
VAL800   OI    SVCLST+15,BIT0          SET DEN 800                M2840 08090002
*                                      THIS IS THE MSG RTN FOR   A46764 08092002
*                                      INVALID DENSITY REQUESTS  A46764 08094002
VALCK    TM    VALFLGS,BIT7            VALID REQUEST ?            M2840 08096002
         BO    VALID                   SKIP THE ERROR MSG        A46764 08098002
         MVI   RC,RCODE08              SET RETURN CODE TO 8       M2840 08100002
         BAL   REG14,ERRMSG            ERROR MSG SET UP          A46764 08102002
         MVC   MSGTEXT(L'ERRB+L'ERRBC),ERRB    MOVE IN MSG        M2840 08104002
         LINK  EP=IEHPRNT              LINK TO PRINT RTN         A46764 08106002
VALID    EQU   *                                                 A46764 08108002
         EJECT                                                          08110002
DROP     LA    REG1,0(REG1)                                             08112002
         DROP  REG1                                                     08114002
         DROP  REG2                                                     08116002
         TM    SWITCHAL,ASCIISW        IS ASCII LABEL SPECIFIED  S20038 08118002
         BNO   UCBLOOP                 BRANCH ON NO              S20038 08120002
         TM    SWITCHAL,ASCIMODE       IS VALID TAPE MODE SET    S20038 08122002
         BO    TURNOFF                 BRANCH ON YES             S20038 08124002
ASCIIERR BAL   REG14,ERRMSG            ERROR MESSAGE              M2840 08126002
         MVC   MSGTEXT(L'ERR9+L'ERR9C),ERR9                       M2840 08128002
         B     ERRPTR                  GO PRINT MESSAGE           M2840 08130002
TURNOFF  NI    SWITCHAL,MODEOFF        TURN OFF ASCII MODE SET   S20038 08132002
         SPACE 3                                                        08134002
UCBLOOP  CR    UCBSEQ,REG6             IS THIS THE LAST UCB PTR   M2840 08136002
         BC    4,CONT                  BRANCH ON NO               M2840 08138002
         SR    UCBSEQ,UCBSEQ           REINITIALIZE TO FIRST UCB  M2840 08140002
         LA    REG5,UCBAREA            REINITIALIZE              A23445 08150018
CONT     LR    REG8,UCBSEQ             HAS THIS UCB BEEN ZEROED   M2840 08160002
         SLL   REG8,2                     ZEROED OUT                    08180000
         AR    REG8,REG5                                          10432 08200014
         MVC   TCB(LNG4),0(REG8)       SAVE CURRENT UCB PTR       M2840 08210002
         CLC   0(LNG4,REG8),ZERO       IS CURRENT POINTER ZERO    M2840 08220002
         BC    7,DUMMYBLD              BRANCH IF NOT ZERO        S20038 08230020
         LA    UCBSEQ,BUMP1(I0,UCBSEQ) POINT TO NEXT UCB          M2840 08250002
         LA    REG4,BUMP1(REG4)        HAVE ALL UCBS              M2840 08260002
         CR    REG4,REG6                  BEEN ZEROED OUT               08280000
         BC    10,ALLBAD                  BRANCH IF ALL BAD             08300000
         B     UCBLOOP                 EXAMINE NEXT UCB           M2840 08320002
         EJECT                                                          08320402
DUMMYBLD MVC   DUMMYHDR(L'HEADER1),HEADER1  CREATE DUMMY HDR LBL S20038 08322020
         MVC   DUMMYHDR+5(75),DUMMYHDR+4 PROPAGATE EBCDIC ZEROES S20038 08324020
         MVC   HERE(L'HERE),LABEL      HOLD VOL ID AND SERIAL NO.S20038 08326020
         TM    SWITCHAL,ASCIISW        IS ASCII LABEL SPECIFIED  S20038 08328020
         BNO   FILL                    BRANCH IF NO              S20038 08330020
         MVI   DUMMYHDR+53,BLANKCOL    BLANK IN ACCESS. BYTE     A38606 08331020
         LA    REG0,L'LABEL+L'DUMMYHDR NO.OF BYTES TO BE XLATED  S20038 08332020
         XLATE LABEL,(0),TO=A          TRANSLATE LABEL TO ASCII  S20038 08334020
FILL     STC   UCBSEQ,SVCLST+3         INSERT UCB SEQUENCE NUMBER M2840 08340002
         LA    REG1,DDNAM              GET ADDR OF DDNAME         M2840 08360002
         ST    REG1,SVCLST+4           MAKE IT 2ND WORD, SVCLIST        08380002
         LA    REG1,HERE               PASS ADDR OF EBCDIC       S20038 08386020
         ST    REG1,SVCLST+16          VOL ID AND SERIAL NO.     S20038 08392020
         LA    REG1,SVCLST                                              08400000
         OC    D12(LNG4,REG1),L80      SET LENGTH EQUAL TO 80 BYTES AND 08420002
*                                         NUMBER OF LABELS TO ONE       08440000
         LA    REG1,LABEL              PUT ADDRESS OF TAPE LABEL INTO   08460000
         ST    REG1,SVCLST+8              PARAMETER LIST FOR SVC        08480000
         L     REG4,ZERO                GOOD UCB SO INITIALIZE COUNTER  08520000
*                                          TO ZERO  AND START COUNTING  08540000
*                                          BAD UCB'S AGAIN              08560000
         LABEL MF=(E,SVCLST)           TAPE LABEL MACRO          S20038 08570020
         TM    SWITCHAL,ASCIISW        WAS ASCII LAB SPECIFIED   S20038 08585020
         BNO   OUTCOME                 BRANCH ON NO              S20038 08590020
         ST    REG15,HERE              SAVE SVC 39 RETURN CODE   S20038 08595020
         LA    REG0,L'LABEL            NO.OF BYTES TO BE XLATED  S20038 08600020
         XLATE LABEL,(0),TO=E          RESTORE EBCDIC FOR PRINTG S20038 08605020
         L     REG15,HERE              RESTORE SVC 39 RET. CODE  S20038 08610020
OUTCOME  C     REG15,EIGHT             UNACCEPTABLE PARM LIST    S20038 08615020
         BC    7,OPRATOR                  SYSTEM ERROR                  08620000
         BAL   REG14,ERRMSG            ERROR MESSAGE             S20038 08790020
         MVC   MSGTEXT(L'ERR5),ERR5    MOVE IN ERROR MESSAGE      M2840 08800002
         L     REG3,TCB                GET DEVICE NAME FROM UCB   M2840 08820002
         USING UCB,REG3                                           M2840 08840002
         MVC   MSGWTR+L'ERR5(L'UCBNAME),UCBNAME                   M2840 08860002
         DROP  REG3                                               M2840 08880002
         B     PERIO2                  GO PRINT ERROR MESSAGE     M2840 08980002
ALLBAD   MVI   RC,RCODE08              SET RETURN CODE TO 8       M2840 09000002
         BAL   REG14,ERRMSG            ERROR MESSAGE             S20038 09130020
         MVC   MSGTEXT(L'ERR7),ERR7    UNUSEABLE                  M2840 09140002
         LINK  EP=IEHPRNT                                               09220000
         B     EOF                     SEE IF ANOTHER LABEL SET   M2840 09240002
OPRATOR  C     REG15,FOUR              OPERATOR COULD NOT MOUNT TAPE    09260000
         BC    7,PERIO                 RETURN CODE NOT 4, BRANCH  M2840 09280002
         MVI   RC,RCODE08              SET RETURN CODE TO 8       M2840 09300002
         BAL   REG14,ERRMSG            ERROR MESSAGE             S20038 09430020
         MVC   MSGTEXT(L'ERR4),ERR4    OPERATOR SUPPRESSED VOL    M2840 09440002
         MVC   MSGTEXT+L'ERR4(L'SERIAL),SERIAL     LABEL       @ZA04374 09460003
         LINK  EP=IEHPRNT                                               09540000
         C     REG15,ZERO              ERROR IN IEHPRNT           M2840 09560002
         BC    7,RETURN                YES, GO END JOB            M2840 09580002
         B     PAST1                   NO, SET UP FOR NEXT LABEL  M2840 09600002
GOOD     BAL   REG14,ERRMSG            MESSAGE AREA SET UP        M2840 09660002
         MVC   MSGTEXT(L'LABEL),LABEL  PRINT LABEL JUST WRITTEN   M2840 09700002
         LINK  EP=IEHPRNT                                               09780000
PAST1    LA    UCBSEQ,BUMP1(I0,UCBSEQ) INCREMENT UCB COUNTER.     M2840 09800002
         SR    STWREG,STWREG           CLEAR WORK REG             M2840 09810002
         IC    STWREG,NUMTPS           TAPES LEFT TO LABEL        M2840 09812002
         BCT   STWREG,AGAIN            IF MORE TAPES TO LABEL FOR M2840 09820002
*                                         THIS CONTROL CARD, THEN M2840 09840002
*                                         BRANCH AND SAVE NUMTPS. M2840 09850002
         B     EOF                     IF NOT, GO TO EOF.         M2840 09860002
PERIO    C     REG15,C                 IS THIS A PERM IO ERROR    M2840 10200002
         BC    6,GOOD                  BRANCH IF NO               M2840 10220002
         BAL   REG14,ERRMSG            ERROR MESSAGE             S20038 10390020
         MVC   MSGTEXT(L'ERR6),ERR6    PERM I/O ERROR MSG TEXT    M2840 10400002
         L     REG3,TCB                GET DEVICE NAME FROM UCB   M2840 10420002
         USING UCB,REG3                                           M2840 10440002
         MVC   MSGTEXT+L'ERR6(L'UCBNAME),UCBNAME                  M2840 10460002
         DROP  REG3                                               M2840 10480002
PERIO2   MVC   0(LNG4,REG8),ZERO       ZERO OUT UCB               M2840 10530002
         MVI   RC,RCODE08              SET UP RETURN CODE OF 8    M2840 10540002
         LINK  EP=IEHPRNT              GO PRINT ERROR MESSAGE     M2840 10560002
         C     REG15,ZERO              ERROR IN IEHPRNT           M2840 10580002
         BC    7,RETURN                YES, GO END JOB            M2840 10600002
         B     UCBLOOP                 NO, SET UP FOR NEXT LABEL  M2840 10620002
AGAIN    STC   STWREG,NUMTPS           SAVE TAPES LEFT TO LABEL   M2840 10630002
         MVC   PARMKEEP(6),SERIAL      SERIAL NUMBER ALL NUMERIC  M2840 10640002
         NC    PARMKEEP+ONE1(LNG5),PARMKEEP                       M2840 10660002
         TM    PARMKEEP+5,FOXZERO      TEST FOR NUMERICS          M2840 10680002
         BNO   EOF                     BRANCH IF NOT NUMERICS    S20038 10700020
         XC    HERE(LNG8),HERE         CLEAR PART OF WORK AREA    M2840 10740002
         PACK  HERE+4(4),SERIAL        INCREMENT THE SERIAL       M2840 10760002
         CVB   STWREG,HERE                NUMBER BY ONE           M2840 10780002
         LA    STWREG,BUMP1(STWREG)                               M2840 10800002
         CVD   STWREG,HERE             SAVE INCREMENTED NUMBER    M2840 10820002
         UNPK  SERIAL,HERE+4(4)        RESTORE UPDATED SERIAL     M2840 10840002
         OI    SERIAL+5,FOXZERO        CLEAR SIGN BITS            M2840 10860002
         B     UCBLOOP                 SET UP FOR NEXT TAPE       M2840 10960002
         SPACE 3                                                        10960102
ERRMSG   MVI   MSGTEXT,BLANKCOL        CLEAR AREA FOR MESSAGE     M2840 10960402
         MVC   MSGTEXT+1(119),MSGTEXT  TO BLANKS                  M2840 10960802
         L     REG9,CS2                BASE FOR SECOND CSECT      M2840 10961202
         LA    REG13,SAVE              IEHINITT SAVE AREA         M2840 10962402
         LA    REG12,COMTAB            PORTION OF COMMON AREA     M2840 10962802
         BR    REG14                   RETURN                    S20038 10963020
         SPACE 3                                                        10965002
MESSAGE  BAL   REG14,ERRMSG            SET UP FOR ERROR MSG      S20038 10968002
         MVC   MSGTEXT(L'ERRA+L'ERRAC),ERRA   INVALID PARM        M2840 10969002
         B     CONTBAD                 BRANCH TO PRINT RTN       S20038 10971020
BAD      BAL   REG14,ERRMSG            SET UP FOR ERROR MSG      S20038 11050002
         MVC   MSGTEXT(L'ERR8),ERR8    TERMINATION                M2840 11060002
CONTBAD  LINK  EP=IEHPRNT                                         M2840 11140002
TERMIN   MVI   RC,RCODE16              SET RETURN CODE OF 16      M2840 11160002
         B     GOAHEAD                 GO CLOSE AND FREEMAIN      M2840 11200002
EOF      TM    SWITCHRD,BIT2           CHECK TO SEE IF THIS WAS THE     11400000
         BC    8,REDO                     LAST GROUP OF LABELS          11420000
RETURN   TM    POPENFLG,BADOPEN        PRINT DCB OPENED           M2840 11440002
         BO    GOAHEAD                 BR IF SYSPRINT IS OPEN      9837 11460014
*                                                                 M2840 11470002
*                  INCREMENT RETURN CODE BY FOUR WHEN SYSPRINT    M2840 11472002
*                     CARD IS OMITTED                             M2840 11474002
*                                                                 M2840 11476002
         SR    STWREG,STWREG           CLEAR WORK REGISTER        M2840 11480002
         IC    STWREG,RC               GET SAVED RETURN CODE      M2840 11500002
         LA    STWREG,DSP4(STWREG)     ADD 4 TO SAVED RC          M2840 11520002
         STC   STWREG,RC               RETURN CODE TO SAVE AREA   M2840 11540002
GOAHEAD  L     REG13,SAVE+4            RESTORE CALLER'S REG 13    M2840 11560002
         CLOSE MF=(E,READAD)                                            11580000
         CLOSE MF=(E,PRINTAD)                                           11600000
*                                                                 M2840 11610002
*                  IF IEHINITT INVOKED, SEE IF UPDATED PAGE       M2840 11612002
*                     TO BE RETURNED TO CALLING PROGRAM           M2840 11614002
*                                                                 M2840 11616002
         L     REG1,24(REG13)          GET CALLER'S PARM REG      M2840 11620002
         TM    0(REG1),ENDLIST         OPT. HIGH ORDER BIT ON?    M2840 11630002
         BO    SKPSTR                  PAGE NOT PASSED, BRANCH    M2840 11640002
         TM    DSP4(REG1),ENDLIST      DDNAME HIGH ORDER BIT ON?  M2840 11650002
         BO    SKPSTR                  PAGE NOT PASSED, BRANCH    M2840 11660002
         L     REG1,DSP8(REG1)         GET ADDR OF PAGE IN LIST   M2840 11680002
         LH    REG2,PAGENUM            PICK UP NEXT PAGE NUMBER   M2840 11683002
         CVD   REG2,HERE                                                11686020
         UNPK  TWO(LNG4,REG1),HERE+5(LNG3) UNPACK PAGE BACK TO   S20038 11689020
*                                           PARAMETER LIST       S20038 11692020
         OI    DSP5(REG1),FOXZERO      SET LOW ORDER ZONE         M2840 11695002
SKPSTR   SR    REG6,REG6               PRESERVE RETURN CODE        000C 11800000
         IC    REG6,RC                                                  11820000
         LA    REG1,LABEL                                               11840000
         FREEMAIN R,LV=0+LAST-FIRST,A=(1)                               11860000
         SR    REG15,REG15                                              11880000
         LR    REG15,REG6   SET RETURN CODE IN RETURN CODE REG.    9527 11900013
BACK     RETURN (14,12),T,RC=(15)                                 10626 11920014
         EJECT                                                          11920402
OUTEXIT  LH    REG5,PRINT+62            LOAD SYSPRINT BLKSIZE     M2840 11920702
         LTR   REG5,REG5                BLZSIZE BINARY ZEROS      M2840 11921402
         BC    8,DCBSIZ                 BRANCH IF NONE SPECIFIED   BS0H 11922117
         LA    REG6,ABS121              TEST FOR MODULAR BLKSIZE   BS0H 11922802
         SR    REG4,REG4                CLEAR REMAINDER REG       M2840 11923502
         DR    REG4,REG6                                                11924202
         LTR   REG4,REG4                                                11924902
         BCR   8,REG14                  RETURN IF MODULAR BLKSIZE  BS0H 11925617
         MVI   DFLG,BIT3                SYSPRINT BLKSIZE ERROR    M2840 11926302
DCBSIZ   MVC   PBLKSZ,PLRECL            LRECL (121) TO BLKSIZE    M2840 11927002
         RETURN                                                         11927717
         SPACE 3                                                        11929702
INEXIT   LH    REG5,READ+62             LOAD SYSIN BLKSIZE         BS0H 11929817
         LTR   REG5,REG5                                           BS0H 11930517
         BC    8,DCBFIX                 BRANCH IF NONE SPECIFIED   BS0H 11931217
         LA    REG6,80                  TEST FOR MODULAR BLKSIZE   BS0H 11931917
         SR    REG4,REG4                                           BS0H 11932617
         DR    REG4,REG6                                           BS0H 11933317
         LTR   REG4,REG4                                           BS0H 11934017
         BCR   8,REG14                  RETURN IF MODULAR BLKSIZE  BS0H 11934717
         MVI   DFLAG,X'10'        SET SYSIN BLKSIZE ERROR FLAG     BS0H 11935417
         MVC   READ+62(2),READ+82       MOVE LRECL TO BLKSIZE      BS0H 11936117
         RETURN                                                         11936817
DCBFIX   MVI   READ+63,X'50'            INSERT BLKSIZE -- 80       BS0H 11937517
         RETURN                                                         11938517
         SPACE 3                                                        11938602
*                                                                       11938702
*              THE FOLLOWING MOVE INSTRUCTIONS ARE EXECUTED             11938802
*                                                                       11938902
MVZO     MVC   1(0,REG1),0(REG1)        ZERO OUT WORK AREA              11939002
MVEUCB   MVC   UCBAREA(0),0(REG5)      MOVE IN UCB PTRS          A23445 11939102
TAPENUM  MVC   0(0,STWREG),0(REG1)     MOVE IN NUMBER OF TAPES    M2840 11942202
ONAMHOLD MVC   OWNRHOLD(0),0(REG1)     MOVE OWNER TO HOLD AREA   S20038 11944202
ONAMEBCD MVC   LABEL+41(0),OWNRHOLD    MOVE OWNER TO EBCDIC LAB  S20038 11944602
ONAMASCI MVC   LABEL+37(0),OWNRHOLD    MOVE OWNER TO ASCII LABEL S20038 11945002
MOVSER   MVC   SERIAL(0),0(REG1)       MOVE IN SERIAL NUMBER      M2840 11945402
DDMVE    MVC   DDNAM(0),CARD                                            11945802
         SPACE 3                                                        11945902
*                                                                S20038 11946002
* REGISTER ALLOCATION, MASK AND BIT SETTINGS                     S20038 11949502
*                                                                S20038 11953002
REG0     EQU   0                                                        11956502
REG1     EQU   1                                                        11960000
REG2     EQU   2                                                        11980000
REG3     EQU   3                                                        12000000
REG4     EQU   4                                                        12020000
REG5     EQU   5                                                        12040000
REG6     EQU   6                                                        12060000
REG7     EQU   7                                                        12080000
REG8     EQU   8                                                        12100000
UCBSEQ   EQU   7                       REGISTER FOR UCB SEQ NO    M2840 12110002
REG9     EQU   9                                                        12120000
MSGBASE  EQU   9                       REMOVE AND MODIFY REG 9          12130002
REG10    EQU   10                                                       12140000
GOTTEN   EQU   10                      REG TO ADDR GETMAIN AREA   M2840 12150002
REG11    EQU   11                                                       12160000
INITBASE EQU   11                      BASE FOR IEHINITT ROOT MOD M2840 12170002
REG12    EQU   12                                                       12180000
STWREG   EQU   12                      SHORT TIME WORK REGISTER   M2840 12190002
REG13    EQU   13                                                       12200000
REG14    EQU   14                                                       12220000
REG15    EQU   15                                                       12240000
BIT0     EQU   X'80'                   MASK TO SET AND TEST BIT 0 M2840 12260002
BIT1     EQU   X'40'                   MASK TO SET AND TEST BIT 1 M2840 12280002
BIT2     EQU   X'20'                   MASK TO SET AND TEST BIT 2 M2840 12300002
BIT3     EQU   X'10'                   MASK TO SET AND TEST BIT 3 M2840 12320002
BIT4     EQU   X'08'                   MASK TO SET AND TEST BIT 4 M2840 12340002
BIT5     EQU   X'04'                   MASK TO SET AND TEST BIT 5 M2840 12360002
BIT6     EQU   X'02'                   MASK TO SET AND TEST BIT 6 M2840 12380002
BIT7     EQU   X'01'                   MASK TO SET AND TEST BIT 7 M2840 12400002
NO       EQU   8                       BRANCH CONDITION           M2840 12420002
YES      EQU   1                       BRANCH CONDITION           M2840 12460002
ASCIISW  EQU   X'80'                   ASCII LAB.PARM SPECIFIED  S20038 12482020
OWNRSW   EQU   X'40'                   OWNER PARM WAS SPECIFIED  S20038 12484020
ASCIMODE EQU   X'10'                   9 TRK TAPE MODE SETTING   S20038 12486020
OWNEROFF EQU   X'BF'                   TO SET OFF THE OWNER FLAG S20038 12488020
MODEOFF  EQU   X'EF'                   TO SET OFF ASCII MODE SET S20038 12490020
SECURE   EQU   X'F0'                   EBCDIC SECURITY DEFAULT   S20038 12492020
ASCIISTD EQU   X'F1'                   ASCII LABEL STDS MET      S20038 12494020
NULL     EQU   X'00'                   TO CLEAR A 1-BYTE SWITCH  S20038 12496020
ELEVEN   EQU   11                                                       12498020
ONE1     EQU   1                       USED AS LENGTH & DISP     S20038 12500020
TWO      EQU   2                       LENGTH & DISPLACEMENT     S20038 12502020
DSP1     EQU   1                       DISPLACEMENT VALUE         M2840 12502102
DSP4     EQU   4                       DISPLACEMENT VALUE         M2840 12502202
DSP5     EQU   5                       DISPLACEMENT VALUE         M2840 12502302
DSP6     EQU   6                       DISPLACEMENT VALUE         M2840 12502902
DSP8     EQU   8                       DISPLACEMENT VALUE OF 8    M2840 12504802
DSP9     EQU   9                       DISPLACEMENT VALUE         M2840 12505402
D12      EQU   12                      DISPLACEMENT VALUE         M2840 12506002
D24      EQU   24                      DISPLACEMENT VALUE         M2840 12506602
D34      EQU   34                      DISPLACEMENT VALUE         M2840 12507202
D42      EQU   42                      DISPLACEMENT VALUE         M2840 12507802
DSP79    EQU   79                      DISPLACEMENT VALUE         M2840 12508202
LNG0     EQU   0                       LENGTH ATTRIBUTE          S20038 12508402
LNG3     EQU   3                       LENGTH ATTRIBUTE          S20038 12509002
LNG4     EQU   4                       LENGTH ATTRIBUTE          S20038 12509602
LNG5     EQU   5                       LENGTH ATTRIBUTE           M2840 12510002
LNG7     EQU   7                       LENGTH ATTRIBUTE           M2840 12510202
LNG8     EQU   8                       LENGTH ATTRIBUTE           M2840 12510802
L24      EQU   24                      LENGTH ATTRIBUTE           M2840 12511402
L79      EQU   79                      LENGTH ATTRIBUTE           M2840 12511802
L119     EQU   119                     LENGTH ATTRIBUTE           M2840 12511902
NINE     EQU   9                       DISPLACEMENT              S20038 12512002
ABS1     EQU   1                       ABSOLUTE VALUE OF 1        M2840 12512702
ABS16    EQU   16                      ABSOLUTE 16 (CVT PTR)      M2840 12514702
ABS60    EQU   60                      ABSOLUTE VALUE OF 60       M2840 12515102
ABS121   EQU   121                     ABSOLUTE VALUE OF 121      M2840 12515502
ABS255   EQU   255                     ABSOLUTE VALUE OF 255      M2840 12515702
ABS256   EQU   256                     ABSOLUTE VALUE OF 256   @ZA01679 12516102
BUMP1    EQU   1                       INCREMENT REG WITH LD ADDR M2840 12517702
I0       EQU   0                       INDEX REG VALUE OF ZERO    M2840 12517802
BADOPEN  EQU   X'10'                   DCB OPEN NOT SUCCESSFUL    M2840 12518102
RCODE08  EQU   X'08'                   RETURN CODE OF EIGHT       M2840 12518402
RCODE16  EQU   16                      RETURN CODE OF SIXTEEN     M2840 12521102
BLANKCOL EQU   X'40'                   CHARACTER OF 'BLANK'       M2840 12523802
BINZERO  EQU   X'00'                   BINARY ZERO CLEAR CHAR     M2840 12526502
OPENOUT  EQU   X'8F'                   END OF LIST, OUTPUT FILE   M2840 12529202
ENDLIST  EQU   X'80'                   END OF PARAMETER LIST      M2840 12531902
ENDJFCB  EQU   X'87'                   END OF LIST, JFCB          M2840 12532302
FOXZERO  EQU   X'F0'                   MASK TO TEST NUMERICS      M2840 12533902
*                                                                       12534602
*                  SET UP THE DCB'S TO READ IN THE CARD FROM THE CARD   12537302
*                     READER AND PRINT THEM OUT AGAIN                   12540000
*                                                                       12560000
* PRINT DATA CONTROL BLOCK MACRO                                 S20038 12566020
*                                                                S20038 12572020
PRINT1   DCB   DSORG=PS,MACRF=(PM),RECFM=FBA,LRECL=121,            BS0H*12580017
               EXLST=OPT1,BUFNO=1                                  BS0H 12600017
*                                                                S20038 12605020
* READ DATA CONTROL BLOCK MACRO                                  S20038 12610020
*                                                                S20038 12615020
READ1    DCB   DSORG=PS,MACRF=(GM),RECFM=FB,LRECL=80,              BS0H*12620017
               EXLST=OPT2,BUFNO=1                                 17128 12640017
*                                                                       12660000
* CONSTANTS                                                      S20038 12660820
* ERROR MESSAGES, CONTROL CARD INFORMATION, TABLE FOR SERIAL NO. S20038 12661620
* MAKE-UP, AND MISCELLANEOUS CONSTANTS                           S20038 12662420
*                                                                S20038 12663220
OPT1     DC    X'85'                                               BS0H 12664017
         DC    AL3(OUTEXIT)                                        BS0H 12668017
OPT2     DC    X'85'                                               BS0H 12672017
         DC    AL3(INEXIT)                                         BS0H 12676017
TWO55    DC    F'255'                  USED TO CLEAR GETMAIN AREA M2840 12680002
TWO56    DC    F'256'                  USED TO CLEAR GETMAIN AREA M2840 12690002
L80      DC    X'00500100'                                              12700000
LABTYPE  DC    CL8'LABTYPE='           INITT STATEMENT KEYWORD          12706002
AL       DC    CL2'AL'                 ASCII PARAMETER           S20038 12712020
SER      DC    CL4'SER='               INITT STATEMENT KEYWORD    M2840 12720002
DISP     DC    CL5'DISP='              INITT STATEMENT KEYWORD    M2840 12740002
OWNRN    DC    CL6'OWNER='             INITT STATEMENT KEYWORD    M2840 12760002
NUMBTAPE DC    CL9'NUMBTAPE='          INITT STATEMENT KEYWORD    M2840 12800002
REWIND   DC    CL6'REWIND'             INITT STATEMENT PARAMETER  M2840 12840002
LINCT    DC    CL8'LINECNT='           EXEC STATEMENT PARAMETER   M2840 12860002
INITT    DC    CL6'INITT '             COMMAND WORD CONSTANT      M2840 12880002
CS2      DC    A(IEHINIT2)             ADDRESS OF MSG CSECT      S20038 12892020
SIX10    DC    F'16'                                                    13260000
EIGHT    DC    F'8'                                                     13280000
ZERO     DC    D'0'                                                     13300000
TEN      DC    F'10'                   EBCDIC OWNER PARM LENGTH   M2840 13340002
FOURTEEN DC    F'14'                   ASCII OWNER PARM LENGTH   S20038 13350020
FIVE     DC    H'40'                   DDNAMEADDR, SYSIN DISP     M2840 13380002
SIX      DC    H'48'                   DDNAMEADDR, SYSPRINT DISP  M2840 13400002
FOUR1    DC    X'0004'                 PAGECNT LENGTH            S20038 13405020
MAXCT    DC    H'10'                   MAX LNG OF LINECNT PARM   S20038 13410020
SYSPRINT DC    CL8'SYSPRINT'           UTILITY OUTPUT DSN         M2840 13420002
SYSIN    DC    CL8'SYSIN'              CONTROL DATA SET DSN       M2840 13440002
C        DC    F'12'                   TO CHECK RETURN CODE       M2840 13460002
FOUR     DC    F'4'                    TO CHECK RETURN CODE       M2840 13480002
FTHREE   DC    F'3'                    TO CHECK NUMBTAPE PARM LNG M2840 13490002
VLM      DC    CL4'VOL1'               STANDARD VOLUME LABEL ID   M2840 13500002
HEADER1  DC    CL5'HDR10'              STARDARD HDR1 ID           M2840 13510002
RWND     DC    X'C00004'                                                13540000
UNLD     DC    X'C00006'                                                13560000
*                                                                S20038 13560120
* THE HYPHEN,PERIOD,ALPHAMERICS AND NATIONAL ARE ACCEPTABLE    @ZA16491 13560299
* CHARACTERS IN THE MAKEUP OF THE SERIAL NUMBER. THE FOLLOWING @ZA16491 13563099
* TABLE IS IN ORDER BY THE BINARY SEQUENCE OF THE EBCDIC CODE. @ZA16491 13564299
* ZEROES INDICATE ACCEPTABLE CHARACTERS.  HENCE, THE TABLE     @ZA16491 13565499
* COULD BE MODIFIED BY MAINTAINING THIS PRACTICE.              @ZA16491 13566699
TABLE    DC    75X'01'                 NOT ACCEPTABLE          @ZA16491 13567899
         DC    X'00'                   '.' ACCEPTABLE          @ZA16491 13568499
         DC    15X'01'                 NOT ACCEPTABLE          @ZA16491 13568899
         DC    X'00'                   '$' ACCEPTABLE          @ZA16491 13568999
         DC    4X'01'                  NOT ACCEPTABLE          @ZA16491 13569299
         DC    X'00'                   '-' ACCEPTABLE          @ZA16491 13570099
         DC    26X'01'                 NOT ACCEPTABLE          @ZA16491 13570199
         DC    X'00'                   '#' ACCEPTABLE          @ZA16491 13570499
         DC    X'00'                   '@' ACCEPTABLE          @ZA16491 13570899
         DC    68X'01'                 NOT ACCEPTABLE          @ZA16491 13571099
         DC    9X'00'                  ALPHABETIC CHARACTER       M2840 13571402
         DC    7X'01'                  NOT ACCEPTABLE             M2840 13572602
         DC    9X'00'                  ALPHABETIC CHARACTER       M2840 13573802
         DC    8X'01'                  NOT ACCEPTABLE             M2840 13575002
         DC    8X'00'                  ALPHABETIC CHARACTER       M2840 13576202
         DC    6X'01'                  NOT ACCEPTABLE             M2840 13577402
         DC    10X'00'                 NUMERIC CHARACTER          M2840 13578602
         DC    6X'01'                  NOT ACCEPTABLE             M2840 13579802
*                                                                       13581002
*                                                                       13591002
         ORG   *+200                   MAINTENANCE AREA           M2840 13601002
*                                                                       13611002
*                                                                       13613002
IEHINIT2 CSECT                                                          13621002
*        THIS CSECT CONTAINS ALL THE MESSAGES THAT THE IEHINITT  S20038 13623002
*        MODULE SENDS TO THE PRINT MODULE                        S20038 13625002
*                                                                S20038 13627002
ERR1     DC    CL33'IEH601I INVALID CONTROL STATEMENT'           S20038 13629002
ERR2     DC    CL23'IEH602I INVALID KEYWORD'                      M6029 13629402
ERR3     DC    CL31'IEH603I INVALID PARAMETER VALUE'             S20038 13629802
ERR4     DC    CL41'IEH604I OPERATOR SUPPRESSED VOLUME LABEL '          13629902
ERR5     DC    CL37'IEH605I INVALID DEVICE ALLOCATED ON  '              13633902
ERR6     DC    CL32'IEH606I PERMANENT I/O ERROR ON  '                   13636002
ERR7     DC    CL35'IEH607I ALLOCATED DEVICES EXHAUSTED'         S20038 13638002
ERR8     DC    CL43'IEH608I I/O ERROR ON SYSIN. JOB TERMINATED.' S20038 13638402
ERR9     DC    CL43'IEH609I INVALID DEVICE SPECIFIED FOR ASCII ' S20038 13638802
ERR9C    DC    CL8'LABELING'                                     S20038 13638902
ERRA     DC    CL41'IEH610I INVALID PARM OR PARM LIST PASSED '   S20038 13639202
ERRAC    DC    CL14'TO IEHINITT.'                                 M2840 13639602
ERRB     DC    CL43'IEH611I INVALID DENSITY SPECIFIED, DEFAULT ' S20038 13639702
ERRBC    DC    CL10'VALUE USED'                                   M2840 13639802
X        DS    0F                                                       13647202
*                                                                S20038 13651302
*                                                                S20038 13659502
* JOB FILE CONTROL BLOCK - SYMBOLIC NAMES                        S20038 13663602
*                        - USED TO OBTAIN DENSITY SETTING        S20038 13667702
*                                                                S20038 13671802
JFCB     DSECT                                                          13675902
         IEFJFCBN                                                       13680000
*                                                                S20038 13684020
* UNIT CONTROL BLOCK - SYMBOLIC NAMES                            S20038 13688020
*                    - USED TO DETERMINE TAPE MODE SETTING       S20038 13692020
*                                                                S20038 13696020
UCB      DSECT                                                          13700000
         IEFUCBOB                                                       13720000
*                                                                S20038 13722020
* WORKING STORAGE -                                              S20038 13724020
* THIS CONTROL MODULE OBTAINS CORE STROAGE FOR A COMMON WORKING  S20038 13726020
* AREA SHARED BY IEHINITT, IEHSCAN, IEHPRNT FOR THE PURPOSE OF   S20038 13728020
* PASSING SWITCH SETTINGS, READ AND PRINT DCB'S, MESSAGES, AND   S20038 13730020
* PARAMETERS, AS WELL AS HOLDING THE CONTROL CARD AND TAPE LABEL S20038 13732020
* IMAGES, AND SAVE AREAS.                                        S20038 13734020
*                                                                S20038 13736020
WORK     DSECT 0F                                                       13740000
FIRST    DS    0F                                                       13760000
*                                                                       13760402
*                  THE FOLLOWING AREA DESCRIBES THE VOLUME        M2840 13762002
*                       LABEL (80 BYTES) AND DUMMY HDR1           M2840 13764002
*                       RECORD (80 BYTES).  THESE AREAS           M2840 13766002
*                       MUST BE CONTIGUOUS                        M2840 13768002
*                                                                       13768402
LABEL    DS    0CL80                   MUST BE                   S20038 13770002
VOL1     DS    CL4                     CONSTANT VOL1 FIELD        M2840 13772002
SERIAL   DS    CL6                     VOLUME SERIAL FIELD        M2840 13774002
SECURITY DS    CL1                     VOLUME SECURITY FIELD      M2840 13774402
         DS    CL69                    NOT REFERENCED             M2840 13776002
DUMMYHDR DS    CL80                    CONTIGUOUS                S20038 13780020
*                                                                       13782002
*                  THE FOLLOWING AREA DESCRIBES THE LIST          M2840 13784002
*                       PASSED TO THE LABEL SVC.  THE AREA        M2840 13786002
*                       MUST BE CONTIGUOUS AND MUST BE            M2840 13788002
*                       ALIGNED ON A FULLWORD BOUNDARY            M2840 13788402
*                                                                       13788802
SVCLST   DS    0CL20                   FIVE WORD PARM LIST        M2840 13790002
SVCRUNOP DS    CL3                     REWIND/REWIND-UNLOAD       M2840 13800002
SVCUCB   DS    CL1                     UCB INDICATOR              M2840 13810002
SVCDDPTR DS    CL4                     POINTER TO DDNAME          M2840 13812002
SVCLBLPT DS    CL4                     PTR TO LABEL/DUMMY HEADER  M2840 13814002
         DS    CL8                                                      13816002
*                                                                       13818002
HOMEJFCB DS    CL176                   INPUT AREA FOR RDJFCB      M2840 13820002
*                                                                       13870002
CARD     DS    CL80                    SCANNED CARD INPUT AREA    M2840 13900002
*                                                                       13950002
DISP12   DS    F                       SAVE FOR START NEXT SCAN   M2840 14000002
PARMPTR  DS    F                       PTR TO START PASSED PARM   M2840 14020002
LNGPARM  DS    F                       LENGTH OF PASSED PARAM     M2840 14040002
COMTAB   DS    0F                                                       14140000
READAD   DS    F                       ADDRESS OF READ DCB        M2840 14160002
PRINTAD  DS    F                       ADDRESS OF PRINT DCB       M2840 14180002
JFLSTAD  DS    F                       ADDR OF HOMEJFCB (READIN)  M2840 14182002
AGO      DS    F                       ADDR DUMMY DCB FOR RDJFCB  M2840 14184002
JFCBLST  DS    F                                                        14186002
*                                                                 M2840 14190002
*                  MESSAGE LINE, INCLUDING PAGE AND LINE COUNT    M2840 14190402
*                                                                 M2840 14192002
MSGWTR   DS    0CL128                                             M2840 14200002
CC       DS    CL1                     CARRIAGE CONTROL (ASA)     M2840 14210002
MSGTEXT  DS    CL120                   PRINT LINE                 M2840 14212002
MFILL1   DS    CL1                     NOT REFERENCED             M2840 14214002
PAGENUM  DS    CL2                     STARTING PAGE NUMBER       M2840 14216002
LINETOT  DS    CL2                     TOTAL LINES PER PAGE       M2840 14218002
LINELEFT DS    CL2                     LINES NOT YET PRINTED      M2840 14218402
*                                                                 M2840 14218802
SAVE     DS    18F                     IEHINITT SAVE AREA         M2840 14220002
GPSAVE   DS    18F                     IEHSCAN SAVE AREA          M2840 14240002
SAVEX    DS    18F                     IEHPRNT SAVE AREA          M2840 14250002
SAVEY    DS    2F                                                       14250401
SAVEZ    DS    1F                                                       14252001
MYSAVE   EQU   SAVEY                   3 FULLWORD SAVE AREA       M2840 14254002
TCB      DS    1F                      TCB/UCB PTR SAVE AREA      M2840 14260002
*                                                                 M2840 14430002
*                  PRINT DCB                                      M2840 14430402
*                                                                 M2840 14432002
PRINT    DS    0CL96                                              M2840 14440002
PFILL1   DS    CL40                    NOT REFERENCED             M2840 14450002
PDDNAME  DS    CL8                     DDNAME BEFORE OPEN         M2840 14452002
POPENFLG DS    CL1                     OPEN FLAG                  M2840 14454002
PFILL2   DS    CL8                     NOT REFERENCED             M2840 14456002
PSYNAD   DS    CL3                     PRINTER SYNAD ADDRESS      M2840 14456402
PFILL3   DS    CL2                     NOT REFERENCED             M2840 14456802
PBLKSZ   DS    CL2                     BLOCKSIZE                  M2840 14457202
PFILL4   DS    CL18                    NOT REFERENCED             M2840 14457602
PLRECL   DS    CL2                     RECORD LENGTH              M2840 14457702
PFILL5   DS    CL12                    NOT REFERENCED             M2840 14457802
*                                                                 M2840 14458002
*                  READ DCB                                       M2840 14458102
*                                                                 M2840 14458402
READ     DS    0CL96                                              M2840 14460002
RFILL1   DS    CL33                    NOT REFERENCED             M2840 14470002
REODAD   DS    CL3                     END OF DATA ADDRESS        M2840 14472002
RFILL2   DS    CL4                     NOT REFERENCED             M2840 14474002
RDDNAME  DS    CL8                     DDNAME BEFORE OPEN         M2840 14476002
ROPENFLG DS    CL1                     OPEN FLAG                  M2840 14478002
RFILL3   DS    CL8                     NOT REFERENCED             M2840 14478402
RSYNAD   DS    CL3                     SYNAD ADDRESS              M2840 14482702
RFILL4   DS    CL36                    NOT REFERENCED             M2840 14487102
*                                                                       14491402
*                  THE AREAS HERE AND THERE ARE WORK AREAS USED   M2840 14501402
*                       FOR PACKING, UNPACKING, CONVERTING TO     M2840 14511402
*                       DECIMAL, CONVERTING TO BIANRY, FIELD      M2840 14521402
*                       ADJUSTMENT, AND OTHER WORK PURPOSES.      M2840 14531402
*                                                                       14533402
D        DS    0D                                                       14540000
HERE     DS    CL10                                                     14560000
THERE    DS    CL12                                               10432 14590014
*                                                                       14592002
VALFLGS  DS    CL1                     VALID FLAGS               A46764 14592402
VALCOMP  DS    CL1                     DENSITY WORK AREA         A46764 14592802
*                                                                       14593202
*                  LABEL DCB                                            14594002
*                       NOTE: THE ONLY FIELDS THAT APPLY TO             14596002
*                       THE DCB ARE GO, DDNAME, AND DCBFLAGS            14596402
*                       THESE FIELDS MUST BE AT +36, +40, AND           14596502
*                       +48 RESPECTIVELY.                               14596602
*                                                                       14596802
*                       THE REMAINDER OF THE FIELDS ARE WORK AREA       14596902
*                                                                       14646902
DISP5    DS    CL1                     IEHSCAN SWITCH BYTE        M2840 14666902
DISP8    DS    CL1                     IEHSCAN SWITCH BYTE        M2840 14676902
DISP10   DS    CL1                     IEHSCAN CURRENT DELIM      M2840 14686902
DISP11   DS    CL1                     IEHSCAN PREVIOUS DELIM     M2840 14688902
LBLDCB   DS    0CL96                   DUMMY DCB                        14689302
SWITCHRD DS    CL1                     IEHSCAN PASSBACK INDICATOR M2840 14690902
PARMLNG  DS    CL1                     PARTIAL PARM LENGTH HOLD   M2840 14692902
SWITCHAL DS    CL1                     SWITCH FOR ASCII LABEL    S20038 14694902
KEY      DS    CL1                                                      14695002
OWNRLNG  DS    F                       HOLD FOR OWNER LENGTH     S20038 14695302
OWNRHOLD DS    CL14                    HOLD FOR OWNER PARM       S20038 14695702
DFLG     DS    X                                                   BS0H 14696902
DFLAG    DS    X                                                   BS0H 14746902
LASTDD   DS    CL8                     SAVE PREVIOUS DDNAME.      15673 14796902
RC       DS    CL1                     RETURN CODE SAVE AREA      M2840 14806902
SWITCH2  DS    CL1                                                      14816902
NUMTPS   DS    CL1                                                      14826902
UCBNUM   DS    CL1                                                      14836902
GO       DC    F'0'                    SAVE AREA FOR EXLIST             14996902
DDNAM    DS    CL8                     SAVE AREA FOR DDNAME       M2840 15046902
         DC    F'0'                    SAVE AREA FOR DCBFLG,DCBMACR     15146902
PARMKEEP DS    CL44                    PARAMETER SAVE AREA        M2840 15156902
*                                                                       15206902
UCBAREA  DS    CL176                   UCB PTRS FROM DD CARD     A23445 15246902
PARMERR  DS    X                       LINECNT & PAGECNT ERROR    M2840 15256902
LAST     DS    0H                                                       15296902
         END                                                            16246902
./  ADD  SSI=31070025,NAME=IEHPRNT
* TITLE:                                                                00020002
*    'IEHPRNT'  - MESSAGE WRITER                                        00114502
* STATUS:                                                               00114802
*    CHANGE LEVEL 000                                                   00115502
* FUNCTION/OPERATION:                                                   00119002
*    TO PUT A SPECIFIED MESSAGE OUT ON THE PRINTER, WRITE               00123202
*    HEADINGS AND PAGE NUMBERS. THE ROUTINE KEEP TRACK OF THE           00127402
*    CURRENT PAGE NUMBER AND THE NUMBER OF LINES LEFT BEFORE            00131602
*    A NEW PAGE IS TO BE STARTED                                        00135802
* ENTRY POINTS:                                                         00140002
*    IEHPRINT IS THE ONLY ENTRY POINT.                                  00150002
* INPUT:                                                                00160002
*    REGISTER 3 CONTAINS THE ADDRESS OF THE MESSAGE MINUS ONE,          00170002
*    REGISTER 12 CONTAINS THE ADDRESS OF A COMMUNICATIONS AREA,         00180002
*    REGISTER 13 CONTAINS THE ADDRESS OF A SAVE AREA, AND               00200002
*    REGISTER 14 CONTAINS THE RETURN ADDRESS                            00220002
* OUTPUT:                                                               00240002
*    THE REGISTERS ARE IN THE SAME CONDITION AS FOR INPUT               00250002
* EXTERNAL ROUTINES:                                                    00260002
*    PUT - TO WRITE MESSAGE TO SYSPRINT DATA SET                        00270002
* EXITS-NORMAL:                                                         00280002
*    CONTROL IS RETURNED TO CALLER AFTER THE MESSAGE HAS                00290002
*    BEEN PUT OUT ON THE PRINTER                                        00300002
* EXITS-ERROR:                                                          00310002
*    ERROR BIT IS TURNED ON BEFORE CONTROL IS RETURNED TO THE           00320002
*    CALLER                                                             00340002
* TABLES/WORK AREAS:                                                    00360002
*    TABLES CONSIST OF MESSAGES TO BE PUT OUT, AND THE                  00370002
*    AREAS WHERE PAGE NUMBER AND LINES LEFT ON THIS PAGE ARE KEPT       00380002
* ATTRIBUTES:                                                           00400002
*    REENTRANT                                                          00402002
         EJECT                                                          00410002
IEHPRNT  CSECT                                                          00420000
IEHPRINT SAVE  (14,12),T                                                00440000
         USING IEHPRINT,PRNTBASE       BASE REGISTER FOR IEHPRNT  M2840 00460002
         USING WORK,WORKREG            PTR TO SHARED DSECT        M2840 00490002
         ST    R13,SAVEX+DSP4          SAVE CALLER'S REGISTER 13  M2840 00520002
         LR    PRNTBASE,R15            LOAD BASE                  M2840 00540002
         TM    POPENFLG,BADOPEN        WAS OPEN SUCCESSFUL        M2840 00550002
         BZ    RETURN                  RETURN TO CALLING ROUTINE  M2840 00552002
         TM    DFLG,BADOPEN            SYSPRINT BLKSIZE ERROR     M2840 00554002
         BO    RETURN                  RETURN TO CALLING ROUTINE  M2840 00556002
         LA    MSGBASE,MSGWTR          GET ADDRESS OF MSG TEXT    M2840 00558002
         TM    CC,ALLONES              IS THIS THE INITIAL ENTRY  M2840 00560002
         BZ    FRSTNTRY                YES, CONTAINS BINARY ZEROS M2840 00580002
         BAL   LINKBODY,PRINTIT        GO PRINT DETAIL LINE       M2840 00600002
         SPACE 3                                                        00610002
RETURN   L     R13,SAVEX+DSP4          RESTORE CALLER'S REG 13    M2840 00620002
         RETURN (14,12),T,RC=0         RETURN TO CALLER           M2840 00640002
         SPACE 3                                                        00650002
*                                                                       00660000
PRINTIT  L     DCBPTR,PRINTAD          PICK UP SYSPRINT DCB PTR   M2840 00720002
         LA    DCBPTR,0(I0,DCBPTR)     CLEAR FIRST BYTE           M2840 00740002
         LA    R13,SAVEX               POINT AT IEHPRNT SAVE AREA M2840 00760002
         PUT   (DCBPTR),(MSGBASE)      WRITE MESSAGE              M2840 00780002
*                                                                 M2840 00790002
         LH    R7,LINELEFT             GET LINES LEFT ON PAGE     M2840 00800002
         BCT   R7,NOTHDR               REDUCE BY ONE              M2840 00820002
         SPACE 3                                                        00820402
*                                                                       00822002
* TAKE BRANCH UNTIL LINES LEFT TO PRINT BECOMES ZERO              M2840 00830002
*                                                                       00832002
         LH    R7,LINETOT              GET TOTAL LINES PER PAGE   M2840 00840002
         STH   R7,LINELEFT             REFRESH LINES LEFT COUNT   M2840 00860002
         BAL   LINKHEAD,HEADER         BRANCH TO PRINT HEADER     M2840 00880002
         BR    LINKBODY                RETURN TO CALLING ROUTINE  M2840 00900002
*                                                                       00910002
NOTHDR   STH   R7,LINELEFT             STORE DECREMENTED COUNT    M2840 00920002
         MVI   CC,BLANKCOL             SET SINGLE SPACE CODE      M2840 00940002
         BR    LINKBODY                RETURN TO CALLING ROUTINE  M2840 00960002
*                                                                       00980000
*                                                                       01000000
HEADER   MVI   CC,BLANKCOL             CLEAR FIRST CHAR OF BUFFER M2840 01020002
         MVC   MSGTEXT(L'MSGTEXT),CC   CLEAR REST OF BUFFER       M2840 01040002
         MVC   MSGTEXT+PAGEDISP(L'PAGE),PAGE  PUT 'PAGE' INTO BUF M2840 01060002
         LH    R6,PAGENUM              GET CURRENT PAGE NUMBER    M2840 01080002
         CVD   R6,HERE                 CONVERT PAGE NUMBER FROM   M2840 01100002
         UNPK  NUMB(L4),HERE+D5(L3)    BINARY TO DECIMAL          M2840 01120002
         OI    NUMB+D3,FOXZERO         SET VALID SIGN BIT         M2840 01140002
         MVC   MSGTEXT(L'TOPLINE),TOPLINE MOVE HEADING LINE       M2840 01160002
         MVI   CC,SKPTOCH1             BEGIN NEW PAGE             M2840 01240002
         L     DCBPTR,PRINTAD          ADDR OF DCB FOR SYSPRINT   M2840 01260002
         LA    DCBPTR,0(I0,DCBPTR)     CLEAR FIRST BYTE           M2840 01280002
         LA    R13,SAVEX               POINT AT IEHPRNT SAVE AREA M2840 01300002
         PUT   (DCBPTR),(MSGBASE)      PRINT HEADER               M2840 01320002
         MVI   CC,SPACE3               TRIPLE SPACE BEFORE PRINT  M2840 01340002
         LH    R6,LINELEFT             GET LINES LEFT TO PRINT    M2840 01360002
         LA    R5,ABS2                 LOAD VALUE OF '2'          M2840 01380002
         SR    R6,R5                   SUBTRACT 2 FROM LINES LEFT M2840 01400002
         STH   R6,LINELEFT             RESTORE CURRENT LINES LEFT M2840 01420002
         LH    R6,PAGENUM              GET CURRENT PAGE NUMBER    M2840 01440002
         LA    R6,BUMP1(I0,R6)         ADD ONE TO PAGE NUMBER     M2840 01460002
         STH   R6,PAGENUM              STORE UPDATED PAGE NUMBER  M2840 01480002
         BR    LINKHEAD                RETURN TO CALLING ROUTINE  M2840 01500002
*                                                                       01520000
FRSTNTRY MVC   PSYNAD,SINAD            MOVE SYNAD INTO PRINT DCB  M2840 01550002
         BAL   LINKHEAD,HEADER         GO PRINT HEADING, NEW PAGE M2840 01620002
         B     RETURN                  GO RETURN TO CALLER        M2840 01640002
*                                                                       01660000
*                                                                       01680000
WTOPER   OI    SWITCH2,BIT7            SET PRMABORT BIT           M2840 01700002
         L     R13,SAVEX+DSP4          RESTORE CALLER'S REG 13    M2840 01720002
         RETURN (14,12),T,RC=4                                          01740000
         EJECT                                                          01752002
* REGISTER EQUATES                                                      01754002
*                                                                       01756002
R0       EQU   0                                                        01760000
R1       EQU   1                                                        01780000
R2       EQU   2                                                        01800000
MSGBASE  EQU   3                       PTR TO MSG PORTION OF WORK M2840 01820002
DCBPTR   EQU   4                       POINTER TO SYSPRINT DCB    M2840 01840002
R5       EQU   5                                                        01860000
R6       EQU   6                                                        01880000
R7       EQU   7                                                        01900000
LINKHEAD EQU   8                       LINK TO PRINT HEADER LINE  M2840 01920002
LINKBODY EQU   9                       LINK TO PRINT DETAIL LINE  M2840 01940002
WORKREG  EQU   10                      PTR TO GETMAIN WORK AREA   M2840 01950002
PRNTBASE EQU   11                      BASE REGISTER FOR IEHPRNT  M2840 01960002
COMBASE  EQU   12                      WORK DSECT SUBSECTION PTR  M2840 02050002
R13      EQU   13                                                       02055002
R14      EQU   14                                                       02060002
R15      EQU   15                      AT LINK, HAS ADDR OF EP    M2840 02065002
         SPACE 3                                                        02070002
Z        DS    0F                                                       02080000
PAGE     DC    CL4'PAGE'                                                02100000
TOPLINE  DC    CL38'SYSTEM SUPPORT UTILITIES      IEHINITT'       M2840 02150002
Y        DS    0D                                                       02180000
EIGHT    DC    F'8'                                                     02220000
SINAD    DC    AL3(WTOPER)                                              02260000
         SPACE 3                                                        02260102
D3       EQU   3                       DISPLACEMENT VALUE         M2840 02260202
DSP4     EQU   4                       DISPLACEMENT VALUE         M2840 02262402
D5       EQU   5                       DISPLACEMENT VALUE         M2840 02265502
L3       EQU   3                       LENGTH ATTRIBUTE           M2840 02267802
L4       EQU   4                       LENGTH ATTRIBUTE           M2840 02270102
ALLONES  EQU   X'FF'                   TEST MASK FOR BINARY ZEROS M2840 02272402
BLANKCOL EQU   X'40'                   TO CLEAR PRINT AREA        M2840 02274702
BADOPEN  EQU   X'10'                   SYSPRINT ERROR FLAG        M2840 02277002
PAGEDISP EQU   98                      LOCATION OF PAGE CONSTANT  M2840 02279302
SKPTOCH1 EQU   X'F1'                   ASA IMMEDIATE SKIP TO CH 1 M2840 02281602
SPACE3   EQU   X'60'                   ASA SPACE 3 BEFORE PRINT   M2840 02283902
ABS2     EQU   2                       TO DECREMENT LINES LEFT    M2840 02286202
BUMP1    EQU   1                       TO INCREMENT REGISTERS     M2840 02288502
FOXZERO  EQU   X'F0'                   MASK TO CHECK FOR NUMERICS M2840 02290802
BIT7     EQU   X'01'                   SET BIT FOR PERM ABORT     M2840 02293102
I0       EQU   0                       INDEX VALUE OF ZERO FOR LA M2840 02295402
*                                                                       02297702
*                                                                       02300000
*                 THE FOLLOWING DSECT REPRESENTS THAT PORTION     M2840 02350002
*                       OF THE COMMON WORK AREA OBTAINED BY       M2840 02400002
*                       IEHINITT THAT IS USED BY IEHPRNT          M2840 02450002
*                                                                       02480000
*                                                                       02500000
WORK     DSECT 0F                                                       02550002
FIRST    DS    0F                                                       02600002
*                                                                       02650002
*                  THE FOLLOWING AREA DESCRIBES THE VOLUME        M2840 02700002
*                       LABEL (80 BYTES) AND DUMMY HDR1           M2840 02750002
*                       RECORD (80 BYTES).  THESE AREAS           M2840 02800002
*                       MUST BE CONTIGUOUS                        M2840 02850002
*                                                                       02900002
LABEL    DS    0CL80                   MUST BE                   S20038 02950002
VOL1     DS    CL4                     CONSTANT VOL1 FIELD        M2840 02960002
SERIAL   DS    CL6                     VOLUME SERIAL FIELD        M2840 02970002
SECURITY DS    CL1                     VOLUME SECURITY FIELD      M2840 02980002
         DS    CL69                    NOT REFERENCED             M2840 02990002
DUMMYHDR DS    CL80                    CONTIGUOUS                S20038 02992002
*                                                                       02994002
*                  THE FOLLOWING AREA DESCRIBES THE LIST          M2840 02996002
*                       PASSED TO THE LABEL SVC.  THE AREA        M2840 02998002
*                       MUST BE CONTIGUOUS AND MUST BE            M2840 02998402
*                       ALIGNED ON A FULLWORD BOUNDARY            M2840 02998802
*                                                                       02999202
SVCLST   DS    0CL20                   FIVE WORD PARM LIST        M2840 02999602
SVCRUNOP DS    CL3                     REWIND/REWIND-UNLOAD       M2840 02999702
SVCUCB   DS    CL1                     UCB INDICATOR              M2840 03003002
SVCDDPTR DS    CL4                     POINTER TO DDNAME          M2840 03005002
SVCLBLPT DS    CL4                     PTR TO LABEL/DUMMY HEADER  M2840 03005402
         DS    CL8                                                      03005802
*                                                                       03006202
HOMEJFCB DS    CL176                   INPUT AREA FOR RDJFCB      M2840 03006302
*                                                                       03006402
CARD     DS    CL80                    SCANNED CARD INPUT AREA    M2840 03009702
COL2     EQU   CARD+1                  POSITION 2 OF CDS          M2840 03011702
COL15    EQU   CARD+14                 POSITION 15 OF CDS         M2840 03012102
COL16    EQU   CARD+15                 POSITION 16 OF CDS         M2840 03012502
COL71    EQU   CARD+70                 POSITION 71 OF CDS         M2840 03012902
COL72    EQU   CARD+71                 POSITION 72 OF CDS         M2840 03013002
*                                                                       03013102
DISP12   DS    F                       SAVE FOR START NEXT SCAN   M2840 03016402
PARMPTR  DS    F                       PTR TO START PASSED PARM   M2840 03018402
LNGPARM  DS    F                       LENGTH OF PASSED PARAM     M2840 03018802
COMTAB   DS    0F                                                       03019902
READAD   DS    F                       ADDRESS OF READ DCB        M2840 03023202
PRINTAD  DS    F                       ADDRESS OF PRINT DCB       M2840 03026502
JFLSTAD  DS    F                       ADDR OF HOMEJFCB (READIN)  M2840 03029802
AGO      DS    F                       ADDR DUMMY DCB FOR RDJFCB  M2840 03031802
JFCBLST  DS    F                                                        03033802
*                                                                 M2840 03035802
*                  MESSAGE LINE, INCLUDING PAGE AND LINE COUNT    M2840 03037802
*                                                                 M2840 03038202
MSGWTR   DS    0CL128                                             M2840 03038602
CC       DS    CL1                     CARRIAGE CONTROL (ASA)     M2840 03039002
MSGTEXT  DS    CL120                   PRINT LINE                 M2840 03039402
MFILL1   DS    CL1                     NOT REFERENCED             M2840 03039502
PAGENUM  DS    CL2                     STARTING PAGE NUMBER       M2840 03039602
LINETOT  DS    CL2                     TOTAL LINES PER PAGE       M2840 03039702
LINELEFT DS    CL2                     LINES NOT YET PRINTED      M2840 03089702
NUMB     EQU   MSGWTR+106              LOCATION OF PAGE NUMBER    M2840 03091702
*                                                                 M2840 03099702
SAVE     DS    18F                     IEHINITT SAVE AREA         M2840 03109702
GPSAVE   DS    18F                     IEHSCAN SAVE AREA          M2840 03119702
SAVEX    DS    18F                     IEHPRNT SAVE AREA          M2840 03129702
SAVEY    DS    2F                                                       03131702
SAVEZ    DS    1F                                                       03133702
MYSAVE   EQU   SAVEY                   3 FULLWORD SAVE AREA       M2840 03135702
TCB      DS    1F                      TCB/UCB PTR SAVE AREA      M2840 03137702
*                                                                 M2840 03138102
*                  PRINT DCB                                      M2840 03138502
*                                                                 M2840 03138902
PRINT    DS    0CL96                                              M2840 03139302
PFILL1   DS    CL40                    NOT REFERENCED             M2840 03139402
PDDNAME  DS    CL8                     DDNAME BEFORE OPEN         M2840 03139502
POPENFLG DS    CL1                     OPEN FLAG                  M2840 03139602
PFILL2   DS    CL8                     NOT REFERENCED             M2840 03189602
PSYNAD   DS    CL3                     PRINTER SYNAD ADDRESS      M2840 03199602
PFILL3   DS    CL2                     NOT REFERENCED             M2840 03209602
PBLKSZ   DS    CL2                     BLOCKSIZE                  M2840 03219602
PFILL4   DS    CL18                    NOT REFERENCED             M2840 03229602
PLRECL   DS    CL2                     RECORD LENGTH              M2840 03231602
PFILL5   DS    CL12                    NOT REFERENCED             M2840 03233602
*                                                                 M2840 03235602
*                  READ DCB                                       M2840 03237602
*                                                                 M2840 03238002
READ     DS    0CL96                                              M2840 03238402
RFILL1   DS    CL33                    NOT REFERENCED             M2840 03238802
REODAD   DS    CL3                     END OF DATA ADDRESS        M2840 03239202
RFILL2   DS    CL4                     NOT REFERENCED             M2840 03239302
RDDNAME  DS    CL8                     DDNAME BEFORE OPEN         M2840 03239402
ROPENFLG DS    CL1                     OPEN FLAG                  M2840 03239502
RFILL3   DS    CL8                     NOT REFERENCED             M2840 03289502
RSYNAD   DS    CL3                     SYNAD ADDRESS              M2840 03299502
RFILL4   DS    CL36                    NOT REFERENCED             M2840 03309502
*                                                                       03319502
*                  THE AREAS HERE AND THERE ARE WORK AREAS USED   M2840 03329502
*                       FOR PACKING, UNPACKING, CONVERTING TO     M2840 03331502
*                       DECIMAL, CONVERTING TO BIANRY, FIELD      M2840 03333502
*                       ADJUSTMENT, AND OTHER WORK PURPOSES.      M2840 03335502
*                                                                       03337502
D        DS    0D                                                       03337902
HERE     DS    CL10                                                     03338302
THERE    DS    CL12                                               10432 03338702
VALFLGS  DS    CL1                     VALID FLAGS                M2840 03338802
VALCOMP  DS    CL1                     DENSITY WORK AREA          M2840 03338902
DISP5    DS    CL1                     IEHSCAN SWITCH BYTE        M2840 03433402
DISP8    DS    CL1                     IEHSCAN SWITCH BYTE        M2840 03435402
DISP10   DS    CL1                     IEHSCAN CURRENT DELIM      M2840 03437402
DISP11   DS    CL1                     IEHSCAN PREVIOUS DELIM     M2840 03437502
*                                                                       03437602
*                  LABEL DCB                                            03437702
*                       NOTE: THE ONLY FIELDS THAT APPLY TO             03443402
*                       THE DCB ARE GO, DDNAME, AND DCBFLAGS            03445402
*                       THESE FIELDS MUST BE AT +36, +40, AND           03447402
*                       +48 RESPECTIVELY.                               03447802
*                                                                       03448202
*                       THE REMAINDER OF THE FIELDS ARE WORK AREA       03448602
*                                                                       03449002
LBLDCB   DS    0CL96                   DUMMY DCB                  M2840 03449402
SWITCHRD DS    CL1                     IEHSCAN PASSBACK INDICATOR M2840 03455102
PARMLNG  DS    CL1                     PARTIAL PARM LENGTH HOLD   M2840 03460802
SWITCHAL DS    CL1                     SWITCH FOR ASCII LABEL    S20038 03466502
KEY      DS    CL1                                                      03472202
OWNRLNG  DS    CL4                     HOLD FOR OWNER LENGTH     S20038 03477902
OWNRHOLD DS    CL14                    HOLD FOR OWNER PARM       S20038 03483602
DFLG     DS    X                                                   BS0H 03489302
DFLAG    DS    X                                                   BS0H 03499302
LASTDD   DS    CL8                     SAVE PREVIOUS DDNAME.      15673 03509302
RC       DS    CL1                     RETURN CODE SAVE AREA      M2840 03519302
SWITCH2  DS    CL1                                                      03529302
NUMTPS   DS    CL1                                                      03531302
UCBNUM   DS    CL1                                                      03533302
GO       DC    F'0'                    SAVE AREA FOR EXLIST             03535302
DDNAM    DS    CL8                     SAVE AREA FOR DDNAME       M2840 03537302
         DC    F'0'                    SAVE AREA FOR DCBFLG,DCBMACR     03537702
PARMKEEP DS    CL44                    PARAMETER SAVE AREA        M2840 03538102
*                                                                       03538502
UCBAREA  DS    CL176                   UCB PTRS FROM DD CARD     A23445 03538902
PARMERR  DS    X                       LINECNT & PAGECNT ERROR    M2840 03588902
LAST     DS    0H                                                       03638902
         END                                                            03688902
./  ADD  SSI=70690164,NAME=IEHSCAN
 TITLE 'IEHSCAN-IEHINITT SCAN MODULE'                              1581 00005014
 TITLE 'IEHSCAN-IEHINITT SCAN MODULE'                              1581 00010014
*TITLE 'IEHSCAN' SCAN CARD IMAGE FOR PARAMETERS SPECIFIED             * 00020000
*STATUS: CHANGE LEVEL 000                                             * 00040000
*FUNCTION/OPERATION: TO SCAN AN 80 BYTE AREA IN CORE AND PASS BACK A  * 00060000
* TITLE:                                                                00159202
*    'IEHSCAN' SCAN CARD IMAGE FOR PARAMETERS SPECIFIED                 00160802
* STATUS:                                                               00162402
*    CHANGE LEVEL 000                                                   00164002
* FUNCTION/OPERATION:                                                   00165602
*    TO SCAN AN 80 BYTE AREA IN CORE AND PASS BACK A POINTER            00167202
*    TO THE PARAMETER, ITS LENGTH AND AN INDICATION AS TO WHAT          00168802
*    IT IS                                                              00170402
* ENTRY POINTS:                                                         00172002
*    THE ONLY ENTRY POINT IS IEHSCAN TO SCAN THE 80 BYTE                00173602
*    CARD IMAGE                                                         00175202
* INPUT:                                                                00176802
*    REGISTER 13 POINTS TO THE WORK AREA,                               00178402
*    REGISTER 14 POINTS TO THE RETURN ADDRESS OF THE CALLING ROUTINE,   00180002
*    REGISTER 15 POINTS TO THE ENTRY POINT                              00200002
* OUTPUT:                                                               00220002
*    REGISTER 1 POINTS TO THE ITEM SCANNED,                             00230002
*    REGISTER 2 CONTAINS ITS LENGTH,                                    00232002
*    REGISTER 3 POINTS TO THE START OF THE NEXT SCAN.            S20038 00234002
*    THE FLAG BYTE 'SWITCHRD' INDICATES SYNTAX ERROR,                   00240002
*    BYPASS, END OF FILE, INITIAL ENTRY, COMMAND WORD, KEYWORD,         00260002
*    OR PARAMETER.                                                      00280002
*    ANOTHER BIT IN THE WORK AREA INDICATES DDNAME                      00300002
* EXTERNAL REFERENCES:                                                  00312002
*    IEHPRNT  - PRINT ROUTINE. PRINT OUT EACH CARD IMAGE SCANNED        00320002
* EXITS, NORMAL:                                                        00360002
*    CONTROL IS RETURNED TO THE CALLER                                  00370002
* EXITS, ERROR:                                                         00372002
*    THE ERROR BIT IS SET BEFORE CONTROL IS RETURNED                    00380002
* TABLES/WORK AREAS:                                                    00400002
*    WORK AREA IS SET UP IN CALLING ROUTINE AND PASSED                  00410002
*    TO SCAN                                                            00420002
* ATTRIBUTES:                                                           00440002
*    REENTRANT                                                          00440402
* CHARACTER CODE DEPENDENCY -                                    S20038 00442020
*    THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL       S20038 00444020
*    REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS       S20038 00446020
*    EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME. THE CODING HAS S20038 00448020
*    BEEN ARRANGED SO THAT REDEFINITION OF 'CHARACTER' CONSTANTS,S20038 00450020
*    BY REASSEMBLY, WILL RESULT IN A CORRECT MODULE FOR THE NEW  S20038 00452020
*    DEFINITIONS.                                                S20038 00454020
* NOTES:                                                                00454402
*    THE MICROFICHE FLAG 'M2840' REPRESENTS A GENERAL CLEANUP OF  M2840 00454802
*    ALL IEHINITT MODULES, WITH SPECIAL EMPHASIS ON REMOVAL OF    M2840 00455202
*    DEAD AND REDUNDANT CODE FROM THE MODULE IEHSCAN.  THE FLAG   M2840 00455602
*    ALSO REPRESENTS PARAMETERIZATION OF ABSOLUTE VALUES FOR      M2840 00455702
*    CROSS-REFERENCE PURPOSES, AND THE ADDITION OF COMMENTS       M2840 00455802
*    TO A NUMBER OF SOURCE STATEMENTS.                            M2840 00455902
         EJECT                                                          00456002
IEHSCAN  CSECT                                                          00460014
*A025500-025584,121100-121300                                  @ZA16491 00462099
*D038200-038400                                                @ZA16474 00470099
*2558068200                                                        3660 00480015
* 136000                                                         S20038 00490020
         USING IEHCDSCN,SCANBASE       ESTABLISH ADDRESSIBILITY   M2840 00500002
         USING WORK,WORKREG            ADDR OF COMMON WORK AREA   M2840 00520002
IEHCDSCN SAVE  (14,12),T,IEHSCAN-OZ16491 SAVE REGISTERS        @ZA16491 00540099
         LR    SCANBASE,R15            LOAD BASE REGISTER         M2840 00560002
         ST    R13,GPSAVE+4            SAVE CALLER'S REG 13       M2840 00580002
         MVC   REODAD,EODA             INSERT EODAD ROUTINE       M2840 00600002
         MVC   RSYNAD,SYNAD            INSERT SYNAD IN READ DCB   M2840 00610002
         LA    COL71REG,COL71          ADDR OF COLUMN 71 OF CARD  M2840 00620002
         L     NEXTCOL,DISP12          SAVED START OF NEXT SCAN   M2840 00640002
         NI    SWITCHRD,BIT0OFF        RESET ERROR BIT            M2840 00660002
         TM    SWITCHRD,BIT3           TEST FIRST ENTRY BIT             00680000
         BC    OFF,KIRSCD              FIRST ENTRY OR NEW SET     M2840 00700002
         TM    SWITCHRD,BIT1           TEST BYPASS BIT                  00720000
         BC    ON,KBYPO1               JUST READ AND PRINT CARDS  M2840 00740002
         TM    DISP5,BIT4              TEST READ CARD SWITCH            00760000
         BC    ON,KGTCD                READ AND PROCESS CARD      M2840 00780002
         TM    SWITCHRD,BIT7           COMMENT BIT ON            SM5216 00830002
         BNO   KPFOL                   CONTINUE CHECKING         SM5216 00880002
         OI    SWITCHRD,BIT1           SET BYPASS                SM5216 00890002
         NI    SWITCHRD,X'FF'-BIT6     SET OFF PARAM FOLLOW BIT  SM5216 00890402
         B     KGTCD                   READ AND PRINT CARDS      SM5216 00892002
KPFOL    TM    DISP5,BIT2              TEST PARAM FOLLOW SWITCH         00900000
         BC    ON,SCANR                SCAN FOR KEYWORD OR PARAM  M2840 00920002
         TM    DISP5,BIT1              TEST CONTINUE SWITCH             00940000
         BC    ON,KCONT                SCAN FOR COMMAND WORD      M2840 00960002
         TM    DISP10,BIT5             IS NAME BIT ON?            M2840 00962002
         BO    GETCMD                  YES, HAVE NAME, GET CMD    M2840 00964002
         EJECT                                                          00970002
*                                                                       01000000
*   THIS ROUTINE CHECKS FOR A NAME AND SETS THE POINTER TO         1581 01020014
*   THE FIRST BLANK COLUMN                                         1581 01040014
*                                                                  1581 01060014
         LA    NEXTCOL,COL2            LOAD ADDRESS OF BEGIN COL  M2840 01070002
KNAME    CLI   0(NEXTCOL),BLANKCOL     IS NEXT COLUMN BLANK?      M2840 01080002
         BE    HAVENAME                YES, END OF DDNAME, BRANCH M2840 01100002
         CR    NEXTCOL,COL71REG        NEXT COLUMN COLUMN 71?     M2840 01140002
         BE    KINVALD                 YES, SET UP AS ERROR       M2840 01160002
         LA    NEXTCOL,BUMP1(I0,NEXTCOL) INCREMENT TO NEXT COLUMN M2840 01180002
         B     KNAME                   BRANCH BACK TO CHECK FOR   M2840 01200002
*                                         END OF DDNAME           M2840 01220002
HAVENAME LA    STARTCOL,CARD           CALCULATE LENGTH OF DDNAME M2840 01280002
         LR    LENGTH,NEXTCOL          ADDRESS OF FIRST BLANK COL M2840 01320002
         SR    LENGTH,STARTCOL         CALCULATE LENGTH           M2840 01340002
         OI    DISP10,BIT5             TURN ON NAME BIT                 01400000
         B     KPASS                   RETURN DDNAME TO CALLER    M2840 01420002
*                                                                       01430002
GETCMD   MVI   DISP10,NULL             CLEAR CURRENT DELIM (NAME) M2840 01440002
         OI    DISP5,BIT5              SET COMMAND CONTROL SWITCH       01480000
         OI    SWITCHRD,BIT4           SET COMMAND BIT                  01500000
*                                                                       01540000
*                  THIS SECTION ADJUSTS THE POINTER TO THE FIRST CHAR   01560000
*                     OF COMMAND, IF NO COMMAND FOUND COL 71 SET BYPASS 01580000
*                     BIT                                               01600000
STARTCMD CLI   0(NEXTCOL),BLANKCOL     IS COLUMN BLANK            M2840 01640002
         BNE   SCAN                    NO, FIRST CHAR OF CMD WORD M2840 01660002
         CR    NEXTCOL,COL71REG        IS THIS COLUMN 71          M2840 01680002
         BE    KINVALD                 YES, SET UP AS ERROR       M2840 01700002
         LA    NEXTCOL,BUMP1(I0,NEXTCOL)  ADJUST PTR TO NEXT COL  M2840 01720002
         B     STARTCMD                EXAMINE NEXT COLUMN        M2840 01740002
         EJECT                                                          01759802
KCONT    LA    NEXTCOL,COL16           SET PTR TO CONTINUE COLUMN M2840 01759902
*                                                                       01773302
*                  RESET SWITCHRD CONTROLS, RESET EXIT CONTROLS SAVE    01780000
*                     LAST DELIMITER AND CLEAR DELIMITER INDICATOR      01800000
*                                                                       01820000
SCANR    NI    SWITCHRD,RESET1         RESET COMMAND BIT                01840000
SCAN     NI    SWITCHRD,RESET2         RESET ALL BITS BUT ERROR AND     01860000
*                                         FIRST ENTRY                   01880000
         NI    DISP5,BIT8              RESET ALL SWITCHES BUT COMMAND   01900000
*                                         CONTROL SWITCH                01920000
SCANPP   MVC   DISP11,DISP10           SAVE CURRENT IN LAST DELIM M2840 01940002
         NI    DISP10,NULL             CLEAR CURRENT DELIMITER    M2840 01960002
*                                                                       02000000
*                  THIS ROUTINE SCANS CARD UNTIL DELIMITER IS FOUND     02020000
*                     SAVES ADDRESS OF FIRST CHAR, COMPUTES LENGTH,     02040000
*                     SET BIT IN EXIT CONTROL IF DELIM IS IN END  COL   02060000
*                     OR BEFORE END COL                                 02080000
*                                                                       02100000
         SR    LENGTH,LENGTH           SET LENGTH = ZERO          M2840 02140002
         LR    STARTCOL,NEXTCOL        START SCAN WHERE LEFT OFF  M2840 02180002
KOMPAR   CLI   0(NEXTCOL),KSPLT        IS CHAR A DELIMITER        M2840 02200002
         BC    LOW,KFIND               YES, BRANCH                M2840 02220002
KOMPARA  LA    LENGTH,BUMP1(I0,LENGTH) ADD ONE TO LENGTH          M2840 02240002
         CR    NEXTCOL,COL71REG        IS THIS COLUMN 71?         M2840 02260002
         BE    KPART                   YES, PARTIAL PARM, BRANCH  M2840 02280002
KOMPARS  LA    NEXTCOL,BUMP1(I0,NEXTCOL)  ADJUST PTR TO NEXT COL  M2840 02300002
         B     KOMPAR                  KEEP LOOKING FOR DELIMETER M2840 02320002
*                                                                       02340000
*                  KFIND CHECKS FOR DELIMITER OF PERIOD OR MINUS IF     02360000
*                     PRESENT RETURNS TO SCAN ROUTINE, TESTS END COLUMN 02380000
*                     IF DELIMITER IS IN END COL SET CC2 BIT IF BEFORE  02400000
*                     END COL SET CC1 BIT AND GOES TO TEST DELIMITER    02420000
*                     ROUTINE                                           02440000
*                                                                       02460000
KFIND    CLI   0(NEXTCOL),PERIOD       IS DELIMETER A PERIOD?     M2840 02480002
         BE    KOMPARA                 IGNORE, GO LOOK FOR DELIM  M2840 02500002
         CLI   0(NEXTCOL),MINUS        IS DELIMITER MINUS SIGN?   M2840 02520002
         BE    KOMPARA                 IGNORE, GO LOOK FOR DELIM  M2840 02540002
         CLI   0(NEXTCOL),DOLLAR      IS DELIMITER DOLLAR SIGN @ZA16491 02550099
         BE    KOMPARA               IGNORE, GO LOOK FOR DELIM @ZA16491 02552099
         CLI   0(NEXTCOL),NUMB         IS DELIMITER NUMB SIGN  @ZA16491 02554099
         BE    KOMPARA               IGNORE, GO LOOK FOR DELIM @ZA16491 02556099
         CLI   0(NEXTCOL),AT           IS DELIMITER AT SIGN    @ZA16491 02558099
         BE    KOMPARA               IGNORE, GO LOOK FOR DELIM @ZA16491 02558499
         CR    NEXTCOL,COL71REG        IS THIS COLUMN 71?         M2840 02560002
         BC    NO,TESTPAR              NO, GO CHECK LENGTH        M2840 02580002
         TM    DISP5,BIT3              IS PARTIAL PARAM SWITCH ON       02620000
         BO    KINVALD                 IF ON LENGTH IS TOO LONG   M2840 02640002
*                                                                       02880000
*                  TESTPAR CHECKS FOR PRESENCE OF PARTIAL PARAMETER     02900000
*                                                                       02960000
TESTPAR  TM    DISP5,BIT3              IS PARTIAL PARAMETER SWITCH ON   02980000
         BO    KPPAR                   YES, GO HANDLE PART PARAM  M2840 03000002
*                                                                       03100000
*                  DELIM CHECKS FOR VALID DELIMETERS AND BRANCHES TO    03120000
*                     ROUTINE TO SET CONTROL SWITCHES                   03140000
*                     IF INVALID DELIMITER IS FOUND BRANCH TO KINVAL    03160000
*                                                                       03180000
DELIM    CLI   0(NEXTCOL),EQUAL        DELIMETER EQUAL SIGN?      M2840 03200002
         BE    KEY1                    GO HANDLE VALUE AS KEYWORD M2840 03220002
         CLI   0(NEXTCOL),COMMA        DELIMETER A COMMA?         M2840 03240002
         BE    PARAMC                  GO HANDLE VALUE AS PARAM   M2840 03260002
         CLI   0(NEXTCOL),APOST        DELIMETER APOSTROPHE?      M2840 03280002
         BE    PARMAPT                 GO HANDLE AS OWNER         M2840 03300002
         CLI   0(NEXTCOL),BLANKCOL     DELIMETER A BLANK          M2840 03320002
         BE    PARBLANK                GO HANDLE VALUE AS PARAM   M2840 03340002
*                                                                 M2840 03350002
*                  INVALID DELIMETER FOUND                        M2840 03352002
*                     SET 'ERROR' FOR IEHINITT (MESSAGE IS        M2840 03354002
*                     'INVALID CONTROL STATEMENT')                M2840 03356002
*                                                                 M2840 03360002
*                                                                       03362002
KINVALD  OI    SWITCHRD,BIT0+BIT1      SET ERROR BIT & BYPASS     M2840 03370002
         B     KPASS                   RETURN ERROR TO CALLER     M2840 03372002
         EJECT                                                          03382002
*                                                                       03393302
*                  KIRSCO IS THE FIRST ENTRY ROUTINE WHICH CLEARS       03400000
*                     CONTROL SWITCHES TO ZERO FOR FIRST READ           03420000
*                     GOES TO READ A CARD ROUTINE                       03440000
*                                                                       03460000
KIRSCD   OI    SWITCHRD,BIT3           SET FIRST ENTRY SWITCH           03480000
         SR    NEXTCOL,NEXTCOL         CLEAR LAST COL PTR AND     M2840 03500002
         ST    NEXTCOL,DISP5           DISP5,DISP8,DISP10,DISP11  M2840 03520002
         MVI   DISP8,FOXFOX            INDICATE FIRST ENTRY             03560002
*                                                                       03580000
*                  KGTCD READS A CARD INTO INPUT AREA IF LAST CARD      03600000
*                     HAS BEEN READ GO TO KEOF IF NOT GO TO KGTGDR      03620000
*                                                                       03640000
KGTCD    L     R1,READAD               GET ADDRESS OF SYSIN DCB   M2840 03660002
         LA    R1,0(I0,R1)             CLEAR HIGH-ORDER BYTE      M2840 03680002
         LA    R0,CARD                 LOAD ADDRESS OF INPUT AREA       03700000
         LA    R13,GPSAVE              POINT AT IEHSCAN SAVE AREA M2840 03720002
         GET   (R1),(R0)               READ A CARD                      03740000
         CLI   DISP8,FOXFOX            IS THIS THE FIRST CARD     M2840 03760002
         BNE   PRNT                    BRANCH ON NO               M2840 03780002
         MVI   DISP8,NULL              RESET FIRST ENTRY BYTE     M2840 03800002
PRNT     BAL   LINKREG,KPRNT           BRANCH TO PRINT OUT CARD   M2840 03860002
*                                                                       03880000
*                  KGTCDR                                               03900002
*                      TEST BYPASS BIT IF ON                            03920002
*                     GO TO KBYPO IF OFF GO TO ROUTINE TO TEST ENTRY    03940000
*                     CONTROL SWITCH                                    03960000
*                                                                       03980000
KGTCDR   MVI   DISP8,NULL                                               04000002
         TM    SWITCHRD,BIT1           IS BYPASS SWITCH ON        M2840 04080002
         BO    KBYPO1                  JUST READ AND PRINT CARDS  M2840 04100002
         B     KPFOL                   HOUSEKEEP, LOOK FOR DELIM  M2840 04120002
         EJECT                                                          04130002
*                                                                       04140000
KEY1     OI    SWITCHRD,BIT5           SET KEYWORD BIT                  04150002
         OI    DISP10,BIT0             SET DELIM EQUAL SIGN BIT         04152002
         B     DECID1                  CHECK FOR VALIDITY         M2840 04154002
*                                                                       04154402
PARAMC   OI    SWITCHRD,BIT6           SET PARAMETER BIT                04156002
         OI    DISP10,BIT1             SET DELIM COMMA BIT              04158002
*                                                                       04158102
DECID1   LTR   LENGTH,LENGTH           IS LENGTH EQUAL ZERO       M2840 04158402
         BC    8,KINVALD               NO KEYWORD OR VALUE, ERROR M2840 04158502
         OI    DISP5,BIT2              SET PARM FOLLOWS SWITCH          04162202
         CR    NEXTCOL,COL71REG        DELIMITER IN COLUMN 71     M2840 04166702
         BNE   KPASS                   DELIMITER OKAY, RETURN     M2840 04170402
         CLI   COL72,BLANKCOL          IS COLUMN 72 BLANK         M2840 04174102
         BE    KINVALD                 SHOULD CONTINUE, ERROR     M2840 04177802
         OI    DISP5,CONT              SET READ CARD AND CONTINUE M2840 04181502
         B     KPASS                   RETURN KEYWORD OR PARAM    M2840 04185202
*                                                                       04188902
*                  PARBLANK IS ENTERED IF DELIMITER WAS A BLANK         04192602
*                     CHECK FOR PRESENCE OF COMMAND WORD IF COMMAND     04196302
*                     ADJUST POINTER TO NEXT NON BLANK COLUMN           04200000
*                     CHECK LENGTH IF NOT ZERO SET BYPAS SWITCH         04220000
*                     IF ZERO AND PRECEEDED BY COMMA READ NEXT CARD     04240000
*                                                                       04260000
PARBLANK TM    DISP5,BIT5              IS COMMAND CONTROL SWITCH ON     04280000
         BO    KPCMD                   BRANCH IF YES             M2840  04300002
         OI    SWITCHRD,BIT6           SET PARMETER BIT                 04320000
         OI    DISP10,BIT4             SET BLANK DELIMETER BIT          04340000
*                                                                       04360000
*                  DECID2 CHECK THE EXIT CONTROL SWITCH AND DELIMITERS  04380002
*                     INDICATOR TO SET CORRECT ENTRY SWITCHES AND       04400000
*                     INFORMATION FOR USER PROGRAM                      04420000
*                                                                       04440000
DECID2   LTR   LENGTH,LENGTH           IS LENGTH EQUAL ZERO       M2840 04450002
         BC    7,NOTZERO               NOT ZERO, BRANCH           M2840 04452002
         TM    DISP11,BIT1             PREVIOUS DELIM COMMA       M2840 04454002
         BNO   KINVALD                 NOT COMMA, ERROR           M2840 04456002
         CLI   COL72,BLANKCOL          COLUMN 72 BLANK            M2840 04458002
         BE    KINVALD                 SHOULD CONTINUE, ERROR     M2840 04458402
         OI    DISP5,CONT              SET READ CARD AND CONTINUE M2840 04458802
         B     KGTCD                   READ ANOTHER CARD         SM5216 04459202
NOTZERO  CLI   COL72,BLANKCOL          ANY CONTINUATION          SM5216 04509202
         BNE   SETREAD                 NO, SET UP TO RETURN      SM5216 04519202
         OI    SWITCHRD,BIT1           SET BYPASS                SM5216 04559202
         B     KPASS                   RETURN PARAMETER          SM5216 04609202
KBYPO1   CLI   COL72,BLANKCOL          IS COLUMN 72 BLANK        SM5216 04659202
         BNE   KGTCD                   NO, KEEP READING CARDS    SM5216 04709202
         B     KPASS                   RETURN PARAMETER           M2840 04759202
SETREAD  OI    SWITCHRD,BIT7           SET ON COMMENT BIT        SM5216 04809202
         B     KPASS                   RETURN PARAMETER          SM5216 04859202
         EJECT                                                          06550002
*                                                                       06720000
*                                                                       06740000
*                                                                       06800000
KPRNT    TM    POPENFLG,BIT3           IS PRINT DCB OPEN, IF NOT  M2840 06806002
         BCR   8,LINKREG               THEN SKIP PRINTING         M2840 06812002
         MVI   MSGTEXT,BLANKCOL        SET UP BLANK CLEAR CHAR    M2840 06840002
         MVC   MSGTEXT+D1(L119),MSGTEXT  CLEAR BUFFER TO BLANKS   M2840 06860002
         MVC   MSGTEXT(L'CARD),CARD    MOVE CARD IMAGE            M2840 06900002
         ST    NEXTCOL,SAVEZ           SAVE LAST COL SCANNED      M2840 06920002
         LA    NEXTCOL,MSGWTR          POINTER TO PRINT LINE      M2840 06940002
         LA    R13,GPSAVE              PTR TO IEHSCAN SAVE AREA   M2840 06942002
         ST    R12,8(R13)              SAVE PTR TO START OF WORK  M2840 06950002
         LA    R12,COMTAB              LOAD PTR WITHIN WORK       M2840 06960002
         LINK  EP=IEHPRNT              PRINT CARD JUST READ       M2840 07060002
         L     R12,8(R13)              RESTORE PTR TO WORK START  M2840 07112002
         L     NEXTCOL,SAVEZ           RESTORE LAST COL SCANNED   M2840 07120002
         TM    SWITCH2,BIT7            IS PERM ABORT BIT ON       M2840 07140002
         BO    KINVALD                 SET UP FOR ERROR           M2840 07160002
         BR    LINKREG                 RETURN TO CALLING ROUTINE  M2840 07180002
*                                                                       07200000
         EJECT                                                          07250002
*                                                                       07500000
*                                                                       07520000
KPART    TM    DISP5,BIT3              IS PARTIAL PARM SWITCH ON        07540000
         BO    KINVALD                 TOO LONG, ERROR            M2840 07560002
KPTERR   OI    DISP5,BIT3              SET PARTIAL PARM BIT             07600000
         CLI   COL72,BLANKCOL          IS COLUMN 72 BLANK         M2840 07610002
         BE    KLAST                   YES, BLANK, BRANCH         M2840 07640002
         MVI   PARMKEEP,BLANKCOL       CLEAR FIRST BYTE           M2840 07660002
         MVC   PARMKEEP+D1(L43),PARMKEEP   CLEAR REMAINDER        M2840 07680002
         STC   LENGTH,PARMLNG          LENGTH OF PARTIAL PARM     M2840 07700002
         BCTR  LENGTH,REG0             ADJUST LENGTH FOR MOVE     M2840 07720002
         EX    LENGTH,MOVEP            MOVE PARTIAL PARM TO SAVE  M2840 07740002
         OI    DISP5,BIT1                                               07760000
         B     KGTCD                   GO READ ANOTHER CARD       M2840 07792002
KLAST    OI    SWITCHRD,BIT6           SET PARM BIT                     07794002
KBYPS    OI    SWITCHRD,BIT1           SET BYPASS SWITCH                07796002
         B     KPASS                   RETURN PARAM TO CALLER     M2840 07798002
*                                                                       07840000
*                                                                       07860000
KPPAR    SR    PPWRKREG,PPWRKREG       CLEAR REG                  M2840 07880002
         IC    PPWRKREG,PARMLNG        PICK UP PARTIAL LENGTH     M2840 07900002
         AR    PPWRKREG,LENGTH         ADD SECOND PART LENGTH     M2840 07920002
         C     PPWRKREG,FOUR4          IS TOTAL GREATER THAN 44   M2840 07940002
         BH    KINVALD                 YES, TOO LONG, ERROR       M2840 07960002
         LTR   LENGTH,LENGTH           SECOND HALF LENGTH = 0     M2840 07970002
         BC    8,KOMPL                 TOTAL PARAM IN FIRST HALF  M2840 07972002
         SR    PPWRKREG,PPWRKREG       CLEAR WORK REGISTER        M2840 08040002
         IC    PPWRKREG,PARMLNG        GET PARTIAL PARM LENGTH    M2840 08060002
         LA    WRKREG,PARMKEEP         ADDR OF PARTIAL SAVE AREA  M2840 08080002
         AR    PPWRKREG,WRKREG         ADDR OF START SECOND HALF  M2840 08100002
         BCTR  LENGTH,REG0             DECREASE LENGTH BY 1       M2840 08120002
         EX    LENGTH,MOVPP            EXECUTE MOVE INSTRUCTION   M2840 08140002
         LA    LENGTH,BUMP1(I0,LENGTH) RESTORE ORIGINAL LENGTH    M2840 08160002
KOMPL    SR    PPWRKREG,PPWRKREG       CLEAR WORK REGISTER        M2840 08180002
         IC    PPWRKREG,PARMLNG        GET FIRST PART OF LENGTH   M2840 08200002
         AR    LENGTH,PPWRKREG         ADD PART LENGTH TO LENGTH  M2840 08220002
         LA    STARTCOL,PARMKEEP       PICK UP ADDR OF SAVE AREA  M2840 08240002
         MVC   DISP11(1),DISP10        SAVE LAST DELIM INDICATOR        08320000
         NI    DISP10,RESET0           CLEAR CURRENT DELIM FLAG   M2840 08340002
         NI    DISP5,RESET6            RESET PARTIAL PARM SWITCH        08360000
         B     DELIM                   GO CHECK FOR VALID DELIM   M2840 08380002
         EJECT                                                          08390002
*                                                                       08400000
*                                                                       08420000
KPASS    LA    NEXTCOL,BUMP1(I0,NEXTCOL)  ADJUST PTR TO NEXT COL  M2840 08440002
KPASS1   NI    DISP5,X'EB'                                              08460000
         ST    STARTCOL,PARMPTR        FIRST CHAR OF THIS SCAN    M2840 08480002
         ST    NEXTCOL,DISP12          START OF NEXT SCAN         M2840 08500002
         ST    LENGTH,LNGPARM          LENGTH OF PARAMETER        M2840 08520002
KPASS2   L     R13,GPSAVE+4                                        9837 08540001
         RETURN (14,12),T              RETURN TO CALLER           M2840 08560002
*                                                                       08580000
*                                                                       08600000
KPCMD    LA    NEXTCOL,BUMP1(I0,NEXTCOL)  ADJUST PTR TO START OF NEXT   08620002
         CLI   0(NEXTCOL),BLANKCOL     THIS CHARACTER A BLANK     M2840 08640002
         BNE   KPCMA                   END OF BLANKS AFTER CMD    M2840 08660002
         CR    NEXTCOL,COL71REG        ALL BLANKS TO COL 71       M2840 08680002
         BE    KINVALD                 NO PARAM IN CARD, ERROR    M2840 08700002
         B     KPCMD                   KEEP LOOKING FOR NON-BLANK M2840 08720002
*                                                                       08740000
*                                                                       08760000
KPCMA    BCTR  NEXTCOL,REG0            POINT AT LAST BLANK        M2840 08820002
PRFOL    OI    DISP5,BIT2              SET PARM FOLLOW TO ENTRY CONTROL 09050002
         B     KPASS                   RETURN TO CALLER           M2840 09052002
*                                                                       09060000
         EJECT                                                          09110002
*                                                                       09180000
*                                                                       09200000
*                                                                       09220000
*                  THIS ROUTINE CHECKS FOR A SECOND APOSTROPHY AS A     09240000
*                     DELIMETER FOR THE OWNER FIELD                     09260000
*                                                                       09280000
PARMAPT  CLI   KEY,BIT2                WAS KEYWORD OWNER          M2840 09290002
         BNE   KINVALD                 INVALID APOSTROPHES, ERROR M2840 09292002
         OI    DISP11,BIT5             SET FIRST TIME BIT         M2840 09300002
         LA    OWNRREG,OWNRHOLD        PTR=START OF OWNER HOLD    M2840 09310002
         SR    BYTECTR,BYTECTR         ZERO OUT OWNER BYTE CNTR   M2840 09320002
ONWARD   CR    NEXTCOL,COL71REG        IS THIS COLUMN 71?         M2840 09360002
         BC    4,EVRONWRD              BRANCH IF NO               M2840 09380002
         CLI   COL72,BLANKCOL          IS CARD CONTINUED          M2840 09400002
         BE    KINVALD                 BRANCH FOR ERROR IF NO     M2840 09420002
         L     R1,READAD               GET THE NEXT CARD TO FINISH      09440000
         LA    R1,0(I0,R1)                PICKING UP THE OWNER FIELD    09460002
         LA    R0,CARD                 CARD WORK AREA             M2840 09480002
         LA    R13,GPSAVE              PTR TO IEHSCAN SAVE AREA   M2840 09500002
         GET   (R1),(R0)               READ A RECORD              M2840 09520002
         BAL   LINKREG,KPRNT           PRINT OUT  NEW CARD IMAGE  M2840 09560002
         LA    NEXTCOL,COL15           START TO SCAN NEW CARD     M2840 09600002
EVRONWRD LA    NEXTCOL,BUMP1(I0,NEXTCOL)  INCREMENT TO NEXT CHAR  M2840 09620002
         CLI   0(NEXTCOL),APOST        THIS CHAR AN APOSTROPHE    M2840 09640002
         BE    PAIRS                   BRANCH IF YES              M2840 09660002
MOVEONE  MVC   0(1,OWNRREG),0(NEXTCOL) MOVE A CHAR TO OWNER HOLD  M2840 09680002
         NI    DISP11,FOXBAKER         TURN OFF FIRST TIME BIT    M2840 09700002
         LA    OWNRREG,BUMP1(I0,OWNRREG) INCREMENT OWNER HOLD PTR M2840 09710002
         LA    BYTECTR,BUMP1(I0,BYTECTR) INCREMENT OWNER BYTE CNT M2840 09720002
         LA    OWNFULL,OWNRHOLD+14     IS OWNER HOLD FULL         M2840 09730002
         CR    OWNRREG,OWNFULL                                    M2840 09760002
         BC    2,KINVALD               BRANCH ON YES              M2840 09780002
         B     ONWARD                  GO EXAMINE NEXT CHAR       M2840 09800002
PAIRS    TM    DISP11,BIT5             IS THIS THE FIRST TIME     M2840 09820002
         BZ    TWOAPST                 BRANCH IF NO               M2840 09840002
         NI    DISP11,FOXBAKER         TURN OFF FIRST TIME BIT    M2840 09860002
         LA    NEXTCOL,BUMP1(I0,NEXTCOL)  POINT AT NEXT COL       M2840 09880002
         TM    0(NEXTCOL),APOST        ERROR IF ONLY TWO APOSTROPHIES   09900002
         BC    12,KINVALD                 AT BEGINNING OF OWNER NAME    09920002
         B     MOVEONE                 MOVE APOSTROPHE TO HOLD    M2840 09940002
TWOAPST  LA    NEXTCOL,BUMP1(I0,NEXTCOL)  POINT AT NEXT COL       M2840 09960002
         CLI   0(NEXTCOL),APOST        SECOND APOSTROPHE          M2840 09980002
         BE    MOVEONE                 END OF OWNER NAME FIELD    M2840 10000002
         NI    KEY,NULL                TURN OFF OWNER NAME BIT    M2840 10020002
         OI    SWITCHAL,OWNRSW         FLAG OWNER PARM SPECIFIED S20038 10026020
         ST    BYTECTR,OWNRLNG         SAVE OWNER PARM LENGTH     M2840 10032002
         CLI   0(NEXTCOL),COMMA        DELIMITER A COMMA          M2840 10040002
         BE    SETCOM                  YES, BRANCH                M2840 10060002
         CLI   0(NEXTCOL),BLANKCOL     DELIMITER A BLANK          M2840 10080002
         BE    SETEND                  YES, END OF SCAN           M2840 10100002
         B     KINVALD                 SET ERROR INDICATOR        M2840 10120002
*                                                                       10130002
SETCOM   OI    DISP10,BIT1             SCAN FOR KEYWORD           M2840 10140002
KPAFOL   LA    NEXTCOL,BUMP1(I0,NEXTCOL)  POINT AT NEXT COL       M2840 10160002
         B     SCANR                                                    10180000
*                                                                       10190002
SETEND   OI    SWITCHRD,BIT1           END OF SCAN, SET BYPASS    M2840 10200002
         CLI   COL72,BLANKCOL          IS COLUMN 72 BLANK?              10210002
         BE    KPASS1                  YES, END OF SCAN                 10260002
         B     KGTCD                   READ ANOTHER CARD                10320002
*                                                                       10360000
*                                                                       10380000
KEOF     MVI   SWITCHRD,BIT2           SET END OF FILE BIT ONLY   M2840 10420002
         B     KPASS                   RETURN TO CALLING PROGRAM  M2840 10440002
*                                                                       10460000
*                                                                       10480000
*                                                                       10620000
*                                                                       10640000
KSYNAD   OI    DISP11,BIT7             INDICATE SYNAD WAS ENTERED  9837 10645002
         MVI   RC,RCODE16              SET RETURN CODE OF 16      M2840 10650002
         B     KPASS2                                              9837 10655014
*                                                                       10660000
*                                                                       10680000
MOVEP    MVC   PARMKEEP(1),0(STARTCOL)                                  10700002
MOVPP    MVC   0(1,PPWRKREG),0(STARTCOL)                                10720002
EODA     DC    AL3(KEOF)                                                10760000
FOUR4    DC    F'44'                                                    10780000
SYNAD    DC    AL3(KSYNAD)             SYNAD FOR SYSIN DCB         9837 10810014
*                                                                S20038 10815020
         ORG   *+200                   MAINTENANCE AREA FOR PGM  S20038 10820020
         EJECT                                                          10822002
*                                                                S20038 10825020
* REGISTER ALLOCATION, INSTRUCTION MASK AND BIT SETTINGS         S20038 10830020
*                                                                S20038 10835020
EODAD    EQU   33                                                       10840000
REG0     EQU   0                                                        10850002
R0       EQU   0                                                        10860000
R1       EQU   1                                                        10880000
STARTCOL EQU   1                                                        10890002
LENGTH   EQU   2                                                        10910002
R3       EQU   3                                                        10920000
NEXTCOL  EQU   3                       PTR TO NEXT COL OF SCAN    M2840 10930002
OWNFULL  EQU   4                                                        10940002
PPWRKREG EQU   4                       PARTIAL PARAMETER WORK REG M2840 10950002
R5       EQU   5                                                        10960000
COL71REG EQU   5                       ADDR OF COL 71 OF CARD     M2840 10970002
BYTECTR  EQU   6                                                        10980002
OWNRREG  EQU   7                                                        11000002
WRKREG   EQU   8                                                        11020002
R9       EQU   9                                                        11040000
LINKREG  EQU   9                       LINK TO PRINT SUBROUTINE   M2840 11050002
WORKREG  EQU   10                      PTR TO GETMAIN WORK AREA   M2840 11060002
SCANBASE EQU   11                      BASE REGISTER FOR IEHSCAN  M2840 11080002
R12      EQU   12                                                       11100000
R13      EQU   13                                                       11120000
R14      EQU   14                                                       11140000
R15      EQU   15                                                       11160000
BUMP1    EQU   1                       INCREMENT REG WITH LD ADDR M2840 11170002
I0       EQU   0                       INDEX REG 0 FOR LD ADDR    M2840 11172002
BIT0     EQU   X'80'                   SET ERROR, CC0                   11180000
BIT1     EQU   X'40'                   SET BYPASS,CONT,CC1              11200000
BIT2     EQU   X'20'                   SET EOF, PARM FOLLOW, CC2        11220000
BIT3     EQU   X'10'                   SET FIRST ENTRY, PARTIAL PARM    11240000
BIT4     EQU   X'08'                   SET COMMAND,READ CARD COL 72 B   11260000
BIT5     EQU   X'04'                   SET KEYWORD,CSWITCH,COL 72 NB    11280000
BIT6     EQU   X'02'                   SET PARM LNG GTR 0               11300000
BIT7     EQU   X'01'                   SET PARM LNG = 0                 11320000
BIT8     EQU   X'14'                                                    11340000
BIT0OFF  EQU   X'7F'                   RESET BIT 0                M2840 11350002
RESET0   EQU   X'00'                                                    11380000
RESET1   EQU   X'F7'                   RESET COMMAND,RDCD,COL 72 BLANK  11400000
RESET2   EQU   X'98'                                                    11420000
RESET6   EQU   X'EF'                                                    11500000
RESET10  EQU   X'0C'                                                    11580000
NULL     EQU   X'00'                   RESET SINGLE BYTE SWITCH   M2840 11630002
CONT     EQU   X'48'                                                    11660000
ON       EQU   1                                                        11680000
OFF      EQU   8                                                        11700000
YES      EQU   8                                                        11760000
NO       EQU   7                                                        11780000
ZERO     EQU   8                                                        11820000
SAME     EQU   8                                                        11840000
KSPLT    EQU   X'7F'                                                    11860000
LOW      EQU   4                                                        11880000
EQUAL    EQU   X'7E'                                                    11960000
COMMA    EQU   X'6B'                                                    11980000
BLANKCOL EQU   X'40'                                                    12000000
APOST    EQU   X'7D'                                                    12020000
PERIOD   EQU   X'4B'                                                    12040000
MINUS    EQU   X'60'                                                    12060000
DOLLAR   EQU   X'5B'                   '$' ACCEPTABLE          @ZA16491 12110099
NUMB     EQU   X'7B'                   '#' ACCEPTABLE          @ZA16491 12120099
AT       EQU   X'7C'                   '@' ACCEPTABLE          @ZA16491 12130099
MSKE     EQU   X'42'                                                    12160000
OWNRSW   EQU   X'40'                   OWNER PARM SPECIFIED      S20038 12244020
RCODE16  EQU   X'10'                   RETURN CODE OF 16          M2840 12244402
FOXBAKER EQU   X'FB'                   RESET OWNER FIRST TIME SWITCH    12244802
FOXFOX   EQU   X'FF'                   FIRST ENTRY (OR NEW SET)   M2840 12245202
D1       EQU   1                       DISPLACEMENT               M2840 12245602
L43      EQU   43                      DISPLACEMENT               M2840 12249402
L119     EQU   119                     LENGTH                     M2840 12253402
         EJECT                                                          12257202
*                                                                S20038 12261002
* WORKING STORAGE FOR SCAN MODULE IS A COMMON AREA SHARED BY THE S20038 12264802
* CONTROL MODULE AND THE PRINT MODULE.                           S20038 12268602
*                                                                S20038 12272402
         SPACE 3                                                        12276202
WORK     DSECT 0F                                                       13773202
FIRST    DS    0F                                                       13783202
*                                                                       13793202
*                  THE FOLLOWING AREA DESCRIBES THE VOLUME        M2840 13803202
*                       LABEL (80 BYTES) AND DUMMY HDR1           M2840 13813202
*                       RECORD (80 BYTES).  THESE AREAS           M2840 13815202
*                       MUST BE CONTIGUOUS                        M2840 13817202
*                                                                       13819202
LABEL    DS    0CL80                   MUST BE                   S20038 13821202
VOL1     DS    CL4                     CONSTANT VOL1 FIELD        M2840 13821602
SERIAL   DS    CL6                     VOLUME SERIAL FIELD        M2840 13822002
SECURITY DS    CL1                     VOLUME SECURITY FIELD      M2840 13822402
         DS    CL69                    NOT REFERENCED             M2840 13822802
DUMMYHDR DS    CL80                    CONTIGUOUS                S20038 13822902
*                                                                       13823002
*                  THE FOLLOWING AREA DESCRIBES THE LIST          M2840 13823102
*                       PASSED TO THE LABEL SVC.  THE AREA        M2840 13873102
*                       MUST BE CONTIGUOUS AND MUST BE            M2840 13883102
*                       ALIGNED ON A FULLWORD BOUNDARY            M2840 13893102
*                                                                       13903102
SVCLST   DS    0CL20                   FIVE WORD PARM LIST        M2840 13913102
SVCRUNOP DS    CL3                     REWIND/REWIND-UNLOAD       M2840 13915102
SVCUCB   DS    CL1                     UCB INDICATOR              M2840 13917102
SVCDDPTR DS    CL4                     POINTER TO DDNAME          M2840 13919102
SVCLBLPT DS    CL4                     PTR TO LABEL/DUMMY HEADER  M2840 13921102
         DS    CL8                                                      13921502
*                                                                       13921902
HOMEJFCB DS    CL176                   INPUT AREA FOR RDJFCB      M2840 13922302
*                                                                       13922702
CARD     DS    CL80                    SCANNED CARD INPUT AREA    M2840 13922802
COL2     EQU   CARD+1                  POSITION 2 OF CDS          M2840 13935302
COL15    EQU   CARD+14                 POSITION 15 OF CDS         M2840 13945302
COL16    EQU   CARD+15                 POSITION 16 OF CDS         M2840 13947302
COL71    EQU   CARD+70                 POSITION 71 OF CDS         M2840 13947702
COL72    EQU   CARD+71                 POSITION 72 OF CDS         M2840 13947802
*                                                                       13948002
DISP12   DS    F                       SAVE FOR START NEXT SCAN   M2840 13960502
PARMPTR  DS    F                       PTR TO START PASSED PARM   M2840 13973002
LNGPARM  DS    F                       LENGTH OF PASSED PARAM     M2840 13983002
COMTAB   DS    0F                                                       13993002
READAD   DS    F                       ADDRESS OF READ DCB        M2840 14003002
PRINTAD  DS    F                       ADDRESS OF PRINT DCB       M2840 14013002
JFLSTAD  DS    F                       ADDR OF HOMEJFCB (READIN)  M2840 14015002
AGO      DS    F                       ADDR DUMMY DCB FOR RDJFCB  M2840 14017002
JFCBLST  DS    F                                                        14019002
*                                                                 M2840 14021002
*                  MESSAGE LINE, INCLUDING PAGE AND LINE COUNT    M2840 14021402
*                                                                 M2840 14021802
MSGWTR   DS    0CL128                                             M2840 14022202
CC       DS    CL1                     CARRIAGE CONTROL (ASA)     M2840 14022602
MSGTEXT  DS    CL120                   PRINT LINE                 M2840 14022702
MFILL1   DS    CL1                     NOT REFERENCED             M2840 14022802
PAGENUM  DS    CL2                     STARTING PAGE NUMBER       M2840 14022902
LINETOT  DS    CL2                     TOTAL LINES PER PAGE       M2840 14072902
LINELEFT DS    CL2                     LINES NOT YET PRINTED      M2840 14082902
*                                                                 M2840 14092902
SAVE     DS    18F                     IEHINITT SAVE AREA         M2840 14102902
GPSAVE   DS    18F                     IEHSCAN SAVE AREA          M2840 14112902
SAVEX    DS    18F                     IEHPRNT SAVE AREA          M2840 14114902
SAVEY    DS    2F                                                       14116902
SAVEZ    DS    1F                                                       14118902
MYSAVE   EQU   SAVEY                   3 FULLWORD SAVE AREA       M2840 14120902
TCB      DS    1F                      TCB/UCB PTR SAVE AREA      M2840 14121302
*                                                                 M2840 14121702
*                  PRINT DCB                                      M2840 14122102
*                                                                 M2840 14122502
PRINT    DS    0CL96                                              M2840 14122602
PFILL1   DS    CL40                    NOT REFERENCED             M2840 14122702
PDDNAME  DS    CL8                     DDNAME BEFORE OPEN         M2840 14122802
POPENFLG DS    CL1                     OPEN FLAG                  M2840 14172802
PFILL2   DS    CL8                     NOT REFERENCED             M2840 14182802
PSYNAD   DS    CL3                     PRINTER SYNAD ADDRESS      M2840 14192802
PFILL3   DS    CL2                     NOT REFERENCED             M2840 14202802
PBLKSZ   DS    CL2                     BLOCKSIZE                  M2840 14212802
PFILL4   DS    CL18                    NOT REFERENCED             M2840 14214802
PLRECL   DS    CL2                     RECORD LENGTH              M2840 14216802
PFILL5   DS    CL12                    NOT REFERENCED             M2840 14218802
*                                                                 M2840 14220802
*                  READ DCB                                       M2840 14221202
*                                                                 M2840 14221602
READ     DS    0CL96                                              M2840 14222002
RFILL1   DS    CL33                    NOT REFERENCED             M2840 14222402
REODAD   DS    CL3                     END OF DATA ADDRESS        M2840 14222502
RFILL2   DS    CL4                     NOT REFERENCED             M2840 14222602
RDDNAME  DS    CL8                     DDNAME BEFORE OPEN         M2840 14222702
ROPENFLG DS    CL1                     OPEN FLAG                  M2840 14272702
RFILL3   DS    CL8                     NOT REFERENCED             M2840 14282702
RSYNAD   DS    CL3                     SYNAD ADDRESS              M2840 14292702
RFILL4   DS    CL36                    NOT REFERENCED             M2840 14302702
*                                                                       14312702
*                  THE AREAS HERE AND THERE ARE WORK AREAS USED   M2840 14314702
*                       FOR PACKING, UNPACKING, CONVERTING TO     M2840 14316702
*                       DECIMAL, CONVERTING TO BIANRY, FIELD      M2840 14318702
*                       ADJUSTMENT, AND OTHER WORK PURPOSES.      M2840 14320702
*                                                                       14321102
D        DS    0D                                                       14321502
HERE     DS    CL10                                                     14321902
THERE    DS    CL12                                               10432 14322302
*                                                                       14322402
VALFLGS  DS    CL1                     VALID FLAGS               A46764 14322502
VALCOMP  DS    CL1                     DENSITY WORK AREA         A46764 14322602
DISP5    DS    CL1                     IEHSCAN SWITCH BYTE              14421002
DISP8    DS    CL1                     IEHSCAN SWITCH BYTE              14421402
DISP10   DS    CL1                     IEHSCAN CURRENT DELIM            14421802
DISP11   DS    CL1                     IEHSCAN PREVIOUS DELIM           14422202
*                                                                       14432202
*                  LABEL DCB                                            14442202
*                       NOTE: THE ONLY FIELDS THAT APPLY TO             14442302
*                       THE DCB ARE GO, DDNAME, AND DCBFLAGS            14442402
*                       THESE FIELDS MUST BE AT +36, +40, AND           14445702
*                       +48 RESPECTIVELY.                               14447702
*                                                                       14448102
*                       THE REMAINDER OF THE FIELDS ARE WORK AREA       14448502
*                                                                       14448902
LBLDCB   DS    0CL96                   DUMMY DCB                        14449202
SWITCHRD DS    CL1                     IEHSCAN PASSBACK INDICATOR M2840 14452502
PARMLNG  DS    CL1                     PARTIAL PARM LENGTH HOLD   M2840 14462502
SWITCHAL DS    CL1                     SWITCH FOR ASCII LABEL    S20038 14472502
KEY      DS    CL1                                                      14482502
OWNRLNG  DS    F                       HOLD FOR OWNER LENGTH     S20038 14492502
OWNRHOLD DS    CL14                    HOLD FOR OWNER PARM       S20038 14502502
DFLG     DS    X                                                   BS0H 14512502
DFLAG    DS    X                                                   BS0H 14514502
LASTDD   DS    CL8                     SAVE PREVIOUS DDNAME.      15673 14516502
RC       DS    CL1                     RETURN CODE SAVE AREA      M2840 14518502
SWITCH2  DS    CL1                                                      14520502
NUMTPS   DS    CL1                                                      14520902
UCBNUM   DS    CL1                                                      14521302
GO       DC    F'0'                    SAVE AREA FOR EXLIST             14521702
DDNAM    DS    CL8                     SAVE AREA FOR DDNAME       M2840 14522102
         DC    F'0'                    SAVE AREA FOR DCBFLG,DCBMACR     14522202
PARMKEEP DS    CL44                    PARAMETER SAVE AREA        M2840 14522302
*                                                                       14522402
UCBAREA  DS    CL176                   UCB PTRS FROM DD CARD     A23445 14572402
PARMERR  DS    X                       LINECNT & PAGECNT ERROR    M2840 14582402
LAST     DS    0H                                                       14592402
         END                                                            14622402
./  ADD  SSI=70690169,NAME=IGC0003I
* /* START OF SPECIFICATIONS ***                                      * 00000102
*01* PROCESSOR = ASSEM;                                               * 00000202
**** END OF SPECIFICATIONS ***/                                       * 00000302
 TITLE 'IGC0003I - TAPE INITIALIZATION - ENTRY POINT'                   00020000
**********************************************************************  00030002
* STATUS                                                                00032002
*    CHANGE LEVEL 0                                                     00034002
* FUNCTION/OPERATION                                                    00036002
*    THIS MODULE WRITES A VOLUME LABEL SET, A DUMMY HEADER LABEL,       00038002
*    AND A TAPE MARK ON TAPE UNDER CONTROL OF OS/360.                   00041102
*    (THE VOLUME LABEL SET CONSISTS ONLY OF THE VOL1 LABEL WHEN  S20038 00043102
*    THE SYSTEM TAPE LABEL UTILITY IS THE INVOKER.  THE VOLUME   S20038 00045102
*    LABEL SET AND 80-BYTE HEADER LABEL MUST BE IN CONTIGUOUS    S20038 00047102
*    STORAGE).                                                          00047502
* ENTRY POINTS                                                          00052102
*          IGC0003I                                                     00054102
* INPUT                                                                 00056102
*    AT ENTRY TO THIS MODULE, REGISTER 1 POINTS TO A 5-WORD      S20038 00056502
*    PARAMETER LIST.                                                    00056902
*         WORD 1 - BYTES 0 TO 2 - REWIND OPTION - X'C00004'      S20038 00057902
*                               - UNLOAD OPTION - X'C00006'      S20038 00064502
*                - BYTE 3 - INDICATES WHICH UCB IN TIOT TO USE          00068202
*                           FOR MOUNTING PURPOSES                       00068602
*         WORD 2 - ADDRESS OF 8-BYTE DDNAME ON DD CARD THAT             00069002
*                  ALLOCATES DEVICES FOR MOUNTING TAPES.               00069102
*         WORD 3 - ADDRESS OF VOLUME LABEL SET                          00069202
*         WORD 4 - BYTES 0 AND 1 - LENGTH OF ONE VOLUME LABEL           00069302
*                  BYTE 2 - NUMBER OF LABELS IN VOLUME LABEL SET        00069802
*                  BYTE 3 - COMMAND BYTE OF CONTROL CCW                 00070202
*         WORD 5 - ADDRESS OF FIRST TEN BYTES OF VOLUME          S20038 00070702
*                  HEADER LABEL FOR THE LABEL IDENTIFIER         S20038 00071802
*                  AND SERIAL NUMBER IN EBCDIC                   S20038 00073802
* OUTPUT                                                                00074202
*    THIS MODULE WRITES THE VOLUME LABEL SET SPECIFIED BY THE           00075302
*    CALLER, A DUMMY HEADER LABEL (HDR1 FOLLOWED BY 76 EBCDIC ZEROS),   00077302
*    AND A TAPE MARK ON THE TAPE ON THE DRIVE SPECIFIED BY THE CALLER.  00077702
* EXTERNAL ROUTINES                                                     00078002
*          GETMAIN  - REQUEST CORE STORAGE                              00078402
*          EXCP     - EXECUTE CHANNEL PROGRAM                           00078502
*          WAIT     - WAIT                                              00079402
*          WTOR     - WRITE TO OPERATOR WITH REPLY                      00079802
*          WTO      - WRITE TO OPERATOR                                 00080202
*          FREEMAIN - RELEASE CORE STORAGE                              00080602
* EXITS                                                                 00081002
*    REGISTER 15 - MEANING OF CODE                                      00081102
*         NORMAL - X'00000000'  LABELING SUCCESSFUL                     00081202
*         ERROR  - X'00000004'  OPERATOR HAS CANCELED LABELING          00081602
*         ERROR  - X'00000008'  PARAMETER LIST CANNOT BE ACCEPTED       00082002
*         ERROR  - X'0000000C'  PERMANENT I/O ERROR                     00082102
* TABLES/WORKAREAS                                                      00082202
*    SEE WORKAREA DSECT                                                 00082302
* ATTRIBUTES                                                            00082502
*    REENTRANT                                                          00082602
*    TRANSIENT                                                          00082702
* CHARACTER CODE DEPENDENCY                                             00082802
*    NOT APPLICABLE                                                     00083502
* NOTES                                                                 00083902
*********************************************************************** 00084302
*                                                                       00085202
IGC0003I CSECT                                                   S20038 00710020
*REGISTER USAGE:                                                        00720000
R0       EQU   0                        WORK REG                        00730002
R1       EQU   1                        PARM LIST & WORK REG            00732002
R2       EQU   2                        WORK REG                        00734002
R3       EQU   3                        WORK REG                        00736002
P0       EQU   4                        CONTAINS LABEL CODE             00738002
R4       EQU   4                        ADDR OF OLD LABEL               00738402
P1       EQU   5                        UCB NUM & UNLOAD OPTION         00738802
R5       EQU   5                        UNUSED                          00739202
P2       EQU   6                        ADDR OF DDNAME                  00739602
R6       EQU   6                        WORK REG                        00739702
P3       EQU   7                        ADDR OF VOL LABELS              00739802
R7       EQU   7                        STORE CCW                       00739902
P4       EQU   8                        LABEL LENGTH-MUST BE EVEN       00746602
P5       EQU   9                        NO. OF LABELS - WORK REG        00748602
PL       EQU   10                       PARAMETER LIST                  00750602
RUCB     EQU   11                                                       01040000
RBASE    EQU   12                                                       01060000
RWKAREA  EQU   13                                                       01080000
R14      EQU   14                                                       01100000
RCVT     EQU   14                                                       01120000
*                                                                       01122002
* CONSTANTS                                                             01124002
*                                                                       01126002
C1        EQU   1                         CONSTANT AREA                 01128002
C2        EQU   2                         DECIMAL                       01128402
C3        EQU   3                                                       01128802
C4        EQU   4                                                       01129202
C6        EQU   6                                                       01129602
C7        EQU   7                                                       01129702
C8        EQU   8                                                       01129802
C12       EQU   12                                                      01129902
C15       EQU   15                                                      01138602
C16       EQU   16                                                      01140602
C20       EQU   20                                                      01142602
C22       EQU   22                                                      01144602
C24       EQU   24                                                      01146602
C25       EQU   25                                                      01147002
C28       EQU   28                                                      01147402
C29       EQU   29                                                      01147502
C32       EQU   32                                                      01147602
C44       EQU   44                                                      01147702
C47       EQU   47                                                      01148402
C52       EQU   52                                                      01148802
C57       EQU   57                                                      01149202
C118      EQU   118                                                     01149602
C253      EQU   253                                                     01149702
C255      EQU   255                                                     01149802
X00       EQU   X'00'                     HEXADECIMAL                   01149902
X01       EQU   X'01'                                                   01151602
X02       EQU   X'02'                                                   01153602
X03       EQU   X'03'                                                   01154002
X07       EQU   X'07'                                                   01154402
X0F       EQU   X'0F'                                                   01154802
X1F       EQU   X'1F'                                                   01154902
X20       EQU   X'20'                                                   01162102
X40       EQU   X'40'                                                   01164102
X7F       EQU   X'7F'                                                   01166102
X80       EQU   X'80'                                                   01168102
XD4       EQU   X'D4'                                                   01168502
XE2       EQU   X'E2'                                                   01168902
XFE       EQU   X'FE'                                                   01169302
CHAINFLG EQU   X'40'                    CHAINING FLAG FOR IOB    A50980 01169602
*                                                                       01176802
WORKREG  EQU   15                                                       01184002
*                                                                A19959 01191202
*0017055200-055600                                                 MC01 01198402
* 042400,042600,043400,043600,054800                             S20038 01205602
*A 012900                                                        YM1084 01207602
*C 013000,055420                                                 YM1084 01209602
*A 028104-028108,042232,058920                                 @ZA01681 01209702
*C 028100,028120                                               @ZA01681 01209802
*A 032700,032820,032840,059500                                 @ZA13759 01211899
         BALR  RBASE,R0                                                 01212802
         USING BEGIN,RBASE                                              01220000
         USING WORKAREA,RWKAREA                                         01240000
         USING UCB,RUCB                                                 01260000
         USING CVT,RCVT                                                 01280000
BEGIN    EQU   *                                                 YM1084 01290002
* BEGIN    SSM   ENABLE                SVC IS ENTERED ENABLED    YM1084 01300002
         LA    R1,0(R1)                STRIP OFF HIGH ORDER BITS        01320000
BEGUN    L     RCVT,CVTPTR             LOAD ADDR OF COMM VECTOR TABLE   01340000
         LPR   PL,R1                    LOAD PARAMETER LIST REG         01360000
         LM    P1,P4,0(PL)              LOAD PARAMETER LIST             01380000
*                                            P1 = UCB NUM + UNLOAD OPT  01400000
*                                            P2 = DDNAME ADDRESS        01420000
*                                            P3 = VOL LABELS ADDRESS    01440000
*                                            P4 = LABEL OPTIONS         01460000
         SRDL  P4,16                    P4 CONTAINS LABEL LENGTH        01480000
         LTR   R1,R1                    TEST FOR FIRST TIME LOGIC       01500000
         BM    BYPASS                    BRANCH TO BYPASS IF NOT FIRST  01520002
         LH    WORKREG,LENGTH           PICK UP STANDARD LENGTH 80      01540000
         CLR   P4,WORKREG               ARE LABELS OF STANDARD LENGTH   01560000
         BNH   SIZEUP                   BRANCH IF YES                   01580002
         LR    WORKREG,P4               STORE LABEL LENGTH              01600000
SIZEUP   SH    WORKREG,LENGTH           DECREMENT LABEL LENGTH BY 80    01620000
         LA    R2,VARY-FIRST(WORKREG)  CALCULATE WORK AREA SIZE         01632002
         GETMAIN R,LV=(R2),SP=253                                       01660000
         LR    RWKAREA,R1               LOAD BASE REG FOR WORK AREA     01680000
         ST    R2,FIRST                 SAVE NUMBER OF WORK AREA BYTES  01700000
         XC    DCB(C118),DCB           ZERO WORKAREA                    01710002
         OI    IOB,CHAINFLG            SET CHAIN FLAG            A50980 01730002
BYPASS   LPR   PL,PL                    TURN OFF SECOND TIME LOGIC      01740000
         SLDL  P0,24                   P0 CONTAINS LABEL CODE           01760000
         SRL   P1,22                   P1 CONTAINS UCB CODE TIMES 4     01780000
         L     WORKREG,CVTTCBP         PICK UP DOUBLE WORD ADDRESS      01800000
         L     WORKREG,C4(WORKREG)     PICK UP TCB ADDRESS              01810002
         L     WORKREG,C12(WORKREG)    PICK UP TIOT ADDRESS             01812002
         LA    WORKREG,C24(WORKREG)    PICK UP DD ENTRY ADDRESS         01814002
         SR    R1,R1                                                    01880000
FINDNAME IC    R1,0(WORKREG)           LOAD DD ENTRY LENGTH             01900000
         LTR   R1,R1                   TEST FOR END OF TIOT             01920000
         BZ    BADPARM                 BRANCH IF END                    01940002
         CLC   C4(C8,WORKREG),0(P2)    CHECK DD ENTRY FOR DDNAME        01950002
         LR    R2,WORKREG              SAVE POINTER                     01980000
         LA    WORKREG,0(R1,WORKREG)   TRY NEXT DD ENTRY                02000000
         BNE   FINDNAME                BRANCH IF NO DDNAME              02020002
         LA    R3,C16(P1,R2)           PICK UP ADDRESS OF UCB POINTER   02030002
         CLR   R3,WORKREG              CHECK UPPER BOUNDARY             02060000
         BNL   BADPARM                 BRANCH IF TOO HIGH               02080002
         L     RUCB,C16(P1,R2)         PICK UP UCB ADDRESS              02090002
         TM    UCBTBYT3,UCB3TAPE       TEST FOR TAPE                    02120000
         BZ    BADPARM                 BRANCH IF NOT TAPE               02140002
         TM    UCBWGT,SRTSYSIN+SRTSYSOT TEST FOR SYS IN OR SYS OUT DEV  02160000
         BNE   BADPARM                  BRANCH IF NEITHER               02180002
         TM    SRTESTAT,SRTEONLI        TEST FOR ON LINE DEVICE         02200000
         BZ    BADPARM                  BRANCH IF NOT ON LINE           02220002
         TM    SRTESTAT,SRTECHGS+SRTERESV TEST FOR OFFLINE SCHEDULING   02240000
*                                         OR RESERVED                   02260000
         BNE   BADPARM                  BRANCH IF NOT                   02280002
         TM    SRTEDMCT,X7F            TEST FOR ZERO USERS              02290002
         BNE   BADPARM                 BRANCH IF NOT ZERO USERS         02320002
         TM    C15(PL),X03             TEST FOR CONTROL COMMAND CODE    02330002
         BZ    BADPARM                  BRANCH IF NOT CONTROL           02360002
         LA    R1,DEB                   BUILD DEB                       02380000
         MVI   C16(R1),X01             INSERT NUM OF EXITS              02390002
         LA    R2,DCB                                                   02420000
         ST    R2,C24(R1)              INSERT DCB ADDR                  02430002
         MVI   C24(R1),X0F             INSERT DEB ID                    02440002
         MVC   C29(C3,R1),CVTXAPG+C1   INSERT IOS APPAD TAB ADDR        02450002
         MVI   C28(R1),X02             INSERT EXT SCALE                 02452002
         ST    RUCB,C32(R1)            INSERT UCB ADDR                  02454002
         SRL   P5,C16                  POSITION DEVICE MOD              02456002
         STC   P5,C32(R1)              INSERT DEVICE MOD                02458002
         ST    R1,DEBPTR               BUILD DCB                        02580002
         LA    WORKREG,ECB             BUILD IOB                        02600002
         ST    WORKREG,IOB+C4          INSERT ECB ADDR                  02610002
         LA    WORKREG,CCW1                                             02640000
         ST    WORKREG,IOB+C16         INSERT CCW ADDR                  02650002
         ST    R2,IOB+C20              INSERT DCB ADDR                  02660002
         SRL   P5,8                    P5 CONTAINS NUMBER OF LABELS     02700002
         LTR   P4,P4                   TEST FOR ZERO LENGTH             02720002
         BZ    BADPARM                 BRANCH IF ZERO                   02740002
         LTR   P5,P5                   TEST FOR NO LABELS               02760002
         BZ    BADPARM                 BRANCH IF NO LABEL               02780002
         OI    SRTEDMCT,X80            SET MOUNTING INDICATOR IN UCB    02790002
         CLC   SRTEVOLI(C6),CHANPROG+C25 CHECK FOR NO VOL SER NUM       02800002
         BNE   REWUNLD                 BRANCH IF VOL SER       @ZA01681 02810002
         TM    SWITCH,X01              MSG IEC703 ISSUED?      @ZA01681 02810402
         BZ    BUILDMES                BRANCH IF NO            @ZA01681 02810802
REWUNLD  MVI   CCW1,X0F            CCW1 WILL REWIND AND UNLOAD @ZA01681 02812002
         MVI   CCW1+C7,X01                                              02814002
         EXCP  IOB                                                      02900000
         WAIT  1,ECB=ECB                                                02920000
         TM    ECB,X20                 TEST ECB FOR PERMANENT ERROR     02930002
         BZ    PERMERR                 BRANCH IF PERMANENT ERROR        02932002
         MVI   ECB,X00                 ZERO ECB CODE                    02934002
NOSERIAL XC    SRTEVOLI(C6),SRTEVOLI   ZERO VOL SER NUMBER IN UCB       02936002
BUILDMES MVC   FIXED(C57),MOUNTMES     SET UP MOUNT MESSAGE      A36341 02938002
         MVC   FIXED+C22(C3),UCBNAME   INSERT UNIT NAME INTO MESSAGE    02938402
         L     WORKREG,C16(PL)         SET UP PTR TO 5TH PARM    S20038 02938802
         CLC   STANDARD(C4),0(WORKREG) CHECK FOR STANDARD LABEL  S20038 02939202
         BNE   TESTLOAD                BRANCH IF NOT STANDARD LABEL     02939602
         MVC   FIXED+C47(C6),C4(WORKREG) PUT SER NO INTO MESS.   S20038 02939702
         MVC   SRTEVOLI(C6),C4(WORKREG)  PUT SER NO INTO UCB     S20038 02939802
         OI    SRTESTAT,X01            SET STANDARD LABEL BIT IN UCB    02939902
TESTLOAD TM    C2(PL),X02              TEST FOR UNLOAD OPTION           02946602
         BZ    MOUNT                   BRANCH IF NOT UNLOAD             02948602
         EX    R0,NOSERIAL             ZERO VOLUME SERIAL NUMBER IN UCB 02950602
         NI    SRTESTAT,XFE            RESET STANDARD LABEL BIT IN UCB  02952602
MOUNT    WTOR  ,REPLY,,ECB,MF=(E,FIXED)                                 03260000
         ST    R1,DOMSAVE              SAVE MSGNUMBER          @ZA13759 03270099
         WAIT  1,ECB=ECB                                                03280000
         L     R1,DOMSAVE              RESTORE MSGNUMBER       @ZA13759 03282099
         DOM   MSG=(1)                 DELETE MSG FROM DOC     @ZA13759 03284099
         MVI   ECB,X00                 ZERO ECB CODE                    03290002
         CLI   REPLY,XD4               TEST FOR REPLY 'MOUNTINT'        03292002
         BE    LABEL                   BRANCH IF MOUNTING               03294002
         CLI   REPLY,XE2               TEST FOR REPLY 'SKIP VOL'        03296002
         BNE   MOUNT                   BRANCH IF NOT SKIP               03346002
         LA    PL,C4                                                    03356002
         B     THISEXIT                BRANCH                           03366002
LABEL    LM    R0,R7,CHANPROG          LOAD CCW1 TO CCW4                03440002
         AR    R3,P4                   RESOLVE COUNT IN CCW2            03460002
         LA    WORKREG,FIXED                                            03480000
         AR    R6,WORKREG              RESOLVE ADDR IN CCW4             03500002
         AR    R7,P4                   RESOLVE COUNT IN CCW4            03520002
         STM   R0,R7,CCW1              STORE CCW1 TO CCW4 IN WORK AREA  03540002
         L     P3,C8(PL)               RESTORE P3                       03550002
LABELING ST    P3,CCW2                 RESOLVE ADDR IN CCW2             03552002
ENTER    MVI   CCW2,X01                SET COMMAND CODE IN CCW2         03554002
ENTRY    MVI   ECB,X00                 ZERO ECB CODE                    03556002
         EXCP  IOB                                                      03640000
         WAIT  1,ECB=ECB                                                03660000
         TM    ECB,X20                 TEST ECB FOR PERMANENT ERROR     03670002
         BZ    ERROR                   BRANCH IF PERMANENT ERROR        03672002
         TM    SWITCH,X20              TEST FOR TAPE MARK               03674002
         BO    FINISH                  BRANCH IF TAPE MARK              03676002
         TM    SWITCH,X40              TEST FOR DUMMY HEADER LABEL      03678002
         BO    ENDLABEL                BRANCH IF DUMMY LABEL            03678402
         LA    WORKREG,C255            LOAD MAXIMUM COMPARE SIZE -1     03678802
         LA    R2,C1(WORKREG)          R2 CONTAINS 256                  03679202
         LR    R3,P4                   R3 CONTAINS LENGTH OF LABELS     03840002
         LR    R4,P3                   R4 CONTAINS ADDR OF OLD LABEL    03860002
         LA    R14,FIXED               R14 CONTAINS ADDR OF NEW LABEL   03880002
TESTSIZE CLR   R3,R2                   IS THE LABEL BIGGER THAN 256     03900002
         BNH   LASTCOMP                BRANCH IF NO                     03920002
         EX    WORKREG,COMPARE         EXECUTE COMPARE INST RUCTION     03940002
         BNE   LABELERR                BRANCH IF NO COMPARE             03960002
         SR    R3,R2                   DECREMENT LABEL LENGTH BY 256    03980002
         AR    R4,R2                   INCREMENT OLD LABEL ADDR BY 256  04000002
         AR    R14,R2                  INCREMENT NEW LABEL ADDR BY 256  04020002
         B     TESTSIZE                BRANCH                           04040002
LASTCOMP LTR   R3,R3                   CHECK FOR ZERO RESIDUE           04060002
         BZ    OUTCOMP                 BRANCH IF ZERO                   04080002
         BCTR  R3,R0                   MINIMUM COMPARE SIZE - 1         04100002
         EX    R3,COMPARE              EXECUTE CLC                      04120002
         BNE   LABELERR                BRANCH IF NO COMPARE             04140002
OUTCOMP  LA    WORKREG,CCW2                                             04160000
         ST    WORKREG,IOB+C16         INSERT NEW CCW ADDR IN IOB       04170002
         AR    P3,P4                   POINT TO NEXT LABEL              04172002
         BCT   P5,LABELING             BRANCH TO DO NEXT LABEL          04174002
         OI    SWITCH,X40              TURN ON DUMMY LABEL SWITCH       04176002
         MVC   CCW2+C6(C2),LENGTH      CCW2 WILL WRITE STANDARD HEADER  04178002
         MVC   CCW4+C6(C2),LENGTH      CCW4 WILL READ STANDARD HEADER   04178402
         B     LABELING                BRANCH                           04178802
ENDLABEL MVI   CCW2,X1F                CCW2 WILL WRITE TAPE MARK        04179202
         MVI   CCW3,X03                CCW3 IS A NOP                    04179602
         MVI   CCW4,X07                CCW4 WILL REWIND TAPE            04179702
         TM    C2(PL),X02              TEST FOR UNLOAD OPTION           04179802
         BZ    TURNON                  BRANCH IF NO UNLOAD              04179902
         MVI   CCW4,X0F                CCW4 WILL REWIND/UNLOAD TAPE     04186602
TURNON   OI    SWITCH,X20              TURN ON TAPE MARK SWITCH         04188602
         B     ENTRY                   BRANCH                           04190602
ERROR    TM    IOB+C3,X02              TEST FOR FILE PROTECT            04192602
         BO    TRYAGAIN                BRANCH IF FILE PROTECT           04193002
         TM    SWITCH,X80              TEST FOR PREVIOUS ERROR          04193102
         BZ    SETERROR                BRANCH IF ERROR                  04193202
PERMERR  LA    PL,C12                  SET ERROR CODE                   04199902
         B     THISEXIT                BRANCH                           04201902
TRYAGAIN MVC   FIXED(C44),FILEMESS     SET UP ERROR MESSAGE      A36341 04203902
         MVI   ECB,X00                 ZERO ECB CODE             A19959 04205902
         B     SETUPMES                BRANCH                           04206302
LABELERR MVC   FIXED(C52),LABELMES     SET UP ERROR MESSAGE      A36341 04206402
SETUPMES MVC   FIXED+C12(C3),UCBNAME   INSERT UNIT NAME INTO MESSAGE    04206502
         WTO   MF=(E,FIXED)                                             04221202
         OI    SWITCH,X01            TURN ON MSG IEC703 SWITCH @ZA01681 04223202
SETERROR OI    SWITCH,X80              TURN ON ERROR SWITCH             04231202
         LNR   R1,PL                   SET UP SECOND TIME LOGIC         04233202
         MVI   ECB,X00                 ZERO OUT ECB                     04235202
         B     BEGUN                   BRANCH                           04235602
BADPARM  LA    PL,C8                   SET ERROR CODE                   04235702
         B     EXITHERE                BRANCH                           04235802
FINISH   TM    C2(PL),X02              TEST FOR UNLOAD OPTION           04240702
         BZ    ZEROCODE                BRANCH IF NO UNLOAD              04242702
         OI    UCBFL2,X40              SET NOT READY BIT IN UCB         04244702
ZEROCODE SR    PL,PL                   ZERO ERROR CODE                  04245102
THISEXIT MVI   SRTEDMCT,X00            RESET MOUNTING INDICATOR IN UCB  04245502
EXITHERE LA    R0,C253(R0,R0)          PICK UP SUBPOOL                  04245602
         SLL   R0,C24(R0)              SHIFT TO HI-ORDER BYTE           04250502
         O     R0,FIRST                PACK SP&LV                       05020000
         FREEMAIN R,LV=(0),A=(RWKAREA)                                  05040000
         LR    WORKREG,PL                                               05060000
         SVC   C3                      EXIT SVC                         05080002
*                                                                       05100000
*** CONSTANTS                                                           05120000
*                                                                       05140000
CHANPROG DS    0F                                                       05160000
*CCW1                                                                   05180000
         DC    X'07000000'              REWIND TAPE                     05200000
         DC    X'40000001'              CCW                             05220002
*CCW2                                                                   05240000
         DC    X'01000000'              WRITE LABEL                     05260000
         DC    X'60000000'              CCW                             05280002
*CCW3                                                                   05300000
         DC    X'27000000'              BACKSPACE LABEL                 05320000
         DC    X'40000001'              CCW                             05340002
*CCW4                                                                   05360000
         DC    X'02000000'             READ LABEL                       05380000
         DC    X'00000000'             CCW                              05400002
COMPARE  CLC   0(C1,R14),0(R4)           VERIFY LABELS CAN BE READ      05440002
STANDARD DC    C'VOL1'                 LABEL                            05460002
LGL000   DC    CL6'LGL000'             FAKE VOLUME SERIAL NUMBER        05500000
*                                                                S20038 05502020
* WTO MACROS IN LIST FORM                                        S20038 05504020
*                                                                S20038 05506020
MOUNTMES WTOR  'IEC701D M DDD,VOLUME TO BE LABELED       ',,1,,MF=L,   X05510018
               ROUTCDE=(3),DESC=(2)                                MC01 05520018
*                                                                S20038 05521020
* CONSTANTS                                                      S20038 05522020
*                                                                S20038 05523020
* ENABLE   DC    X'FF'                   ENABLE MASK             YM1084 05524002
LENGTH   DC    H'80'                   STANDARD LABEL LENGTH     S20038 05525020
*                                                                S20038 05526020
LABELMES WTO   'IEC702I DDD,VOLUME LABELS CANNOT BE VERIFIED',MF=L,    X05530018
               ROUTCDE=(3),DESC=(4)                                MC01 05540018
FILEMESS WTO   'IEC703I DDD,VOLUME IS FILE PROTECTED',MF=L,            X05550018
               ROUTCDE=(3),DESC=(4)                                MC01 05560018
*                                                                S20038 05565020
         ORG   IGC0003I+1024           MAINTENANCE AREA FOR PGM  S20038 05570020
*                                                                S20038 05575020
* WORKING STORAGE FOR TAPE-LABELING SVC.                         S20038 05580020
* CONTENTS-SYSTEM CONTROL BLOCKS,CHANNEL PROGRAM,INTERNAL SWITCH,S20038 05585020
* AND HOLD AREA FOR LABEL READ BACK OPERATION.                   S20038 05590020
*                                                                S20038 05595020
WORKAREA DSECT                                                          05600000
FIRST    DS    1F                       WORK AREA                       05620002
DCB      DS    1F                       DCB = 12F                       05640002
DEB      DS    10F                      DEB = 9F                        05660000
DEBPTR   DS    1F                       DEB POINTER                     05680002
ECB      DS    1F                       ECB                             05700002
IOB      DS    8F                       IOB                             05720002
CCW1     DS    1D                       CCW                             05740002
CCW2     DS    D                        CCW                             05760002
CCW3     DS    D                        CCW                             05780002
CCW4     DS    D                        CCW                             05800002
SWITCH   DS    CL1                      SWITCH BYTE                     05820002
*                                      BIT 0 - ERROR                    05840000
*                                      BIT 1 - DUMMY HEADER             05860000
*                                      BIT 2 - TAPE MARK                05880000
*                            BIT 7 - MSG IEC703 ISSUED         @ZA01681 05892002
REPLY    DS    CL1                     MUST                             05900000
         DS    CL2                     BE                               05920000
FIXED    DS    CL80                    CONTIGUOUS                       05940000
DOMSAVE  DC    F'0'                    SAVEAREA FOR MSG NR     @ZA13759 05950099
VARY     DS    0H                                                       05960000
*                                                                S20038 05965020
* UNIT CONTROL BLOCK - SYMBOLIC NAMES                            S20038 05970020
*                                                                S20038 05975020
UCB      DSECT                                                          05980000
         IEFUCBOB                                                       06000000
SRTSYSIN EQU   128                                                      06020000
SRTSYSOT EQU   64                                                       06040000
*                                                                S20038 06045020
* COMMUNICATION VECTOR TABLE                                     S20038 06050020
*                                                                S20038 06055020
CVT      DSECT                                                          06060000
         CVT   SYS=MIN                                                  06080000
         END                                                            06100000
